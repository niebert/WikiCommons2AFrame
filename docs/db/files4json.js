vDataJSON.files4json = {
    "date": "Tue Dec 03 2019",
    "generator": "https://niehausbert.gitlab.io/loadfile4dom/demo5_file2base64_json.html",
    "files": [
        {
            "name": "aframe-v0.9.2.js",
            "file": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuQUZSQU1FID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9ImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitpKyInIik7dGhyb3cgYS5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9ImZ1bmN0aW9uIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpKHsxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHN0ciA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcKCm1vZHVsZS5leHBvcnRzID0gYW5BcnJheQoKZnVuY3Rpb24gYW5BcnJheShhcnIpIHsKICByZXR1cm4gKAogICAgICAgYXJyLkJZVEVTX1BFUl9FTEVNRU5UCiAgICAmJiBzdHIuY2FsbChhcnIuYnVmZmVyKSA9PT0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJwogICAgfHwgQXJyYXkuaXNBcnJheShhcnIpCiAgKQp9Cgp9LHt9XSwyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBudW10eXBlKG51bSwgZGVmKSB7CglyZXR1cm4gdHlwZW9mIG51bSA9PT0gJ251bWJlcicKCQk/IG51bSAKCQk6ICh0eXBlb2YgZGVmID09PSAnbnVtYmVyJyA/IGRlZiA6IDApCn0KfSx7fV0sMzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JwoKZXhwb3J0cy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aApleHBvcnRzLnRvQnl0ZUFycmF5ID0gdG9CeXRlQXJyYXkKZXhwb3J0cy5mcm9tQnl0ZUFycmF5ID0gZnJvbUJ5dGVBcnJheQoKdmFyIGxvb2t1cCA9IFtdCnZhciByZXZMb29rdXAgPSBbXQp2YXIgQXJyID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDhBcnJheSA6IEFycmF5Cgp2YXIgY29kZSA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvJwpmb3IgKHZhciBpID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogIGxvb2t1cFtpXSA9IGNvZGVbaV0KICByZXZMb29rdXBbY29kZS5jaGFyQ29kZUF0KGkpXSA9IGkKfQoKLy8gU3VwcG9ydCBkZWNvZGluZyBVUkwtc2FmZSBiYXNlNjQgc3RyaW5ncywgYXMgTm9kZS5qcyBkb2VzLgovLyBTZWU6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Jhc2U2NCNVUkxfYXBwbGljYXRpb25zCnJldkxvb2t1cFsnLScuY2hhckNvZGVBdCgwKV0gPSA2MgpyZXZMb29rdXBbJ18nLmNoYXJDb2RlQXQoMCldID0gNjMKCmZ1bmN0aW9uIGdldExlbnMgKGI2NCkgewogIHZhciBsZW4gPSBiNjQubGVuZ3RoCgogIGlmIChsZW4gJSA0ID4gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHN0cmluZy4gTGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA0JykKICB9CgogIC8vIFRyaW0gb2ZmIGV4dHJhIGJ5dGVzIGFmdGVyIHBsYWNlaG9sZGVyIGJ5dGVzIGFyZSBmb3VuZAogIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2JlYXRnYW1taXQvYmFzZTY0LWpzL2lzc3Vlcy80MgogIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKCc9JykKICBpZiAodmFsaWRMZW4gPT09IC0xKSB2YWxpZExlbiA9IGxlbgoKICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gdmFsaWRMZW4gPT09IGxlbgogICAgPyAwCiAgICA6IDQgLSAodmFsaWRMZW4gJSA0KQoKICByZXR1cm4gW3ZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW5dCn0KCi8vIGJhc2U2NCBpcyA0LzMgKyB1cCB0byB0d28gY2hhcmFjdGVycyBvZiB0aGUgb3JpZ2luYWwgZGF0YQpmdW5jdGlvbiBieXRlTGVuZ3RoIChiNjQpIHsKICB2YXIgbGVucyA9IGdldExlbnMoYjY0KQogIHZhciB2YWxpZExlbiA9IGxlbnNbMF0KICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXQogIHJldHVybiAoKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0KSAtIHBsYWNlSG9sZGVyc0xlbgp9CgpmdW5jdGlvbiBfYnl0ZUxlbmd0aCAoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSB7CiAgcmV0dXJuICgodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQpIC0gcGxhY2VIb2xkZXJzTGVuCn0KCmZ1bmN0aW9uIHRvQnl0ZUFycmF5IChiNjQpIHsKICB2YXIgdG1wCiAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCkKICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdCiAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV0KCiAgdmFyIGFyciA9IG5ldyBBcnIoX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSkKCiAgdmFyIGN1ckJ5dGUgPSAwCgogIC8vIGlmIHRoZXJlIGFyZSBwbGFjZWhvbGRlcnMsIG9ubHkgZ2V0IHVwIHRvIHRoZSBsYXN0IGNvbXBsZXRlIDQgY2hhcnMKICB2YXIgbGVuID0gcGxhY2VIb2xkZXJzTGVuID4gMAogICAgPyB2YWxpZExlbiAtIDQKICAgIDogdmFsaWRMZW4KCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gNCkgewogICAgdG1wID0KICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMTgpIHwKICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldIDw8IDEyKSB8CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDIpXSA8PCA2KSB8CiAgICAgIHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMyldCiAgICBhcnJbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gMTYpICYgMHhGRgogICAgYXJyW2N1ckJ5dGUrK10gPSAodG1wID4+IDgpICYgMHhGRgogICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGCiAgfQoKICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7CiAgICB0bXAgPQogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAyKSB8CiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA+PiA0KQogICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGCiAgfQoKICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7CiAgICB0bXAgPQogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAxMCkgfAogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAxKV0gPDwgNCkgfAogICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkgKyAyKV0gPj4gMikKICAgIGFycltjdXJCeXRlKytdID0gKHRtcCA+PiA4KSAmIDB4RkYKICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMHhGRgogIH0KCiAgcmV0dXJuIGFycgp9CgpmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQgKG51bSkgewogIHJldHVybiBsb29rdXBbbnVtID4+IDE4ICYgMHgzRl0gKwogICAgbG9va3VwW251bSA+PiAxMiAmIDB4M0ZdICsKICAgIGxvb2t1cFtudW0gPj4gNiAmIDB4M0ZdICsKICAgIGxvb2t1cFtudW0gJiAweDNGXQp9CgpmdW5jdGlvbiBlbmNvZGVDaHVuayAodWludDgsIHN0YXJ0LCBlbmQpIHsKICB2YXIgdG1wCiAgdmFyIG91dHB1dCA9IFtdCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IDMpIHsKICAgIHRtcCA9CiAgICAgICgodWludDhbaV0gPDwgMTYpICYgMHhGRjAwMDApICsKICAgICAgKCh1aW50OFtpICsgMV0gPDwgOCkgJiAweEZGMDApICsKICAgICAgKHVpbnQ4W2kgKyAyXSAmIDB4RkYpCiAgICBvdXRwdXQucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSkKICB9CiAgcmV0dXJuIG91dHB1dC5qb2luKCcnKQp9CgpmdW5jdGlvbiBmcm9tQnl0ZUFycmF5ICh1aW50OCkgewogIHZhciB0bXAKICB2YXIgbGVuID0gdWludDgubGVuZ3RoCiAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4gJSAzIC8vIGlmIHdlIGhhdmUgMSBieXRlIGxlZnQsIHBhZCAyIGJ5dGVzCiAgdmFyIHBhcnRzID0gW10KICB2YXIgbWF4Q2h1bmtMZW5ndGggPSAxNjM4MyAvLyBtdXN0IGJlIG11bHRpcGxlIG9mIDMKCiAgLy8gZ28gdGhyb3VnaCB0aGUgYXJyYXkgZXZlcnkgdGhyZWUgYnl0ZXMsIHdlJ2xsIGRlYWwgd2l0aCB0cmFpbGluZyBzdHVmZiBsYXRlcgogIGZvciAodmFyIGkgPSAwLCBsZW4yID0gbGVuIC0gZXh0cmFCeXRlczsgaSA8IGxlbjI7IGkgKz0gbWF4Q2h1bmtMZW5ndGgpIHsKICAgIHBhcnRzLnB1c2goZW5jb2RlQ2h1bmsoCiAgICAgIHVpbnQ4LCBpLCAoaSArIG1heENodW5rTGVuZ3RoKSA+IGxlbjIgPyBsZW4yIDogKGkgKyBtYXhDaHVua0xlbmd0aCkKICAgICkpCiAgfQoKICAvLyBwYWQgdGhlIGVuZCB3aXRoIHplcm9zLCBidXQgbWFrZSBzdXJlIHRvIG5vdCBmb3JnZXQgdGhlIGV4dHJhIGJ5dGVzCiAgaWYgKGV4dHJhQnl0ZXMgPT09IDEpIHsKICAgIHRtcCA9IHVpbnQ4W2xlbiAtIDFdCiAgICBwYXJ0cy5wdXNoKAogICAgICBsb29rdXBbdG1wID4+IDJdICsKICAgICAgbG9va3VwWyh0bXAgPDwgNCkgJiAweDNGXSArCiAgICAgICc9PScKICAgICkKICB9IGVsc2UgaWYgKGV4dHJhQnl0ZXMgPT09IDIpIHsKICAgIHRtcCA9ICh1aW50OFtsZW4gLSAyXSA8PCA4KSArIHVpbnQ4W2xlbiAtIDFdCiAgICBwYXJ0cy5wdXNoKAogICAgICBsb29rdXBbdG1wID4+IDEwXSArCiAgICAgIGxvb2t1cFsodG1wID4+IDQpICYgMHgzRl0gKwogICAgICBsb29rdXBbKHRtcCA8PCAyKSAmIDB4M0ZdICsKICAgICAgJz0nCiAgICApCiAgfQoKICByZXR1cm4gcGFydHMuam9pbignJykKfQoKfSx7fV0sNDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgYnJvd3NlciBmaWVsZCwgY2hlY2sgb3V0IHRoZSBicm93c2VyIGZpZWxkIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9zdWJzdGFjay9icm93c2VyaWZ5LWhhbmRib29rI2Jyb3dzZXItZmllbGQuCgptb2R1bGUuZXhwb3J0cyA9IHsKICAgIC8vIENyZWF0ZSBhIDxsaW5rPiB0YWcgd2l0aCBvcHRpb25hbCBkYXRhIGF0dHJpYnV0ZXMKICAgIGNyZWF0ZUxpbms6IGZ1bmN0aW9uKGhyZWYsIGF0dHJpYnV0ZXMpIHsKICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTsKICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTsKCiAgICAgICAgbGluay5ocmVmID0gaHJlZjsKICAgICAgICBsaW5rLnJlbCA9ICdzdHlsZXNoZWV0JzsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgaWYgKCAhIGF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cmlidXRlc1trZXldOwogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZGF0YS0nICsga2V5LCB2YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBoZWFkLmFwcGVuZENoaWxkKGxpbmspOwogICAgfSwKICAgIC8vIENyZWF0ZSBhIDxzdHlsZT4gdGFnIHdpdGggb3B0aW9uYWwgZGF0YSBhdHRyaWJ1dGVzCiAgICBjcmVhdGVTdHlsZTogZnVuY3Rpb24oY3NzVGV4dCwgYXR0cmlidXRlcykgewogICAgICAgIHZhciBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLAogICAgICAgICAgICBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CgogICAgICAgIHN0eWxlLnR5cGUgPSAndGV4dC9jc3MnOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykgewogICAgICAgICAgICBpZiAoICEgYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyaWJ1dGVzW2tleV07CiAgICAgICAgICAgIHN0eWxlLnNldEF0dHJpYnV0ZSgnZGF0YS0nICsga2V5LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChzdHlsZS5zaGVldCkgeyAvLyBmb3IganNkb20gYW5kIElFOSsKICAgICAgICAgICAgc3R5bGUuaW5uZXJIVE1MID0gY3NzVGV4dDsKICAgICAgICAgICAgc3R5bGUuc2hlZXQuY3NzVGV4dCA9IGNzc1RleHQ7CiAgICAgICAgICAgIGhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICAgIH0gZWxzZSBpZiAoc3R5bGUuc3R5bGVTaGVldCkgeyAvLyBmb3IgSUU4IGFuZCBiZWxvdwogICAgICAgICAgICBoZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgICAgICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzVGV4dDsKICAgICAgICB9IGVsc2UgeyAvLyBmb3IgQ2hyb21lLCBGaXJlZm94LCBhbmQgU2FmYXJpCiAgICAgICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzc1RleHQpKTsKICAgICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgfQogICAgfQp9OwoKfSx7fV0sNTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3Nlcgp2YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307CgovLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXQKLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzCi8vIHdyYXBwZWQgaW4gc3RyaWN0IG1vZGUgY29kZSB3aGljaCBkb2Vzbid0IGRlZmluZSBhbnkgZ2xvYmFscy4gIEl0J3MgaW5zaWRlIGEKLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy4KCnZhciBjYWNoZWRTZXRUaW1lb3V0Owp2YXIgY2FjaGVkQ2xlYXJUaW1lb3V0OwoKZnVuY3Rpb24gZGVmYXVsdFNldFRpbW91dCgpIHsKICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpOwp9CmZ1bmN0aW9uIGRlZmF1bHRDbGVhclRpbWVvdXQgKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTsKfQooZnVuY3Rpb24gKCkgewogICAgdHJ5IHsKICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0OwogICAgfQogICAgdHJ5IHsKICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDsKICAgIH0KfSAoKSkKZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHsKICAgIGlmIChjYWNoZWRTZXRUaW1lb3V0ID09PSBzZXRUaW1lb3V0KSB7CiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zCiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTsKICAgIH0KICAgIC8vIGlmIHNldFRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkCiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHsKICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDsKICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApOwogICAgfQogICAgdHJ5IHsKICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzCiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTsKICAgIH0gY2F0Y2goZSl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5CiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwobnVsbCwgZnVuLCAwKTsKICAgICAgICB9IGNhdGNoKGUpewogICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvcgogICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKHRoaXMsIGZ1biwgMCk7CiAgICAgICAgfQogICAgfQoKCn0KZnVuY3Rpb24gcnVuQ2xlYXJUaW1lb3V0KG1hcmtlcikgewogICAgaWYgKGNhY2hlZENsZWFyVGltZW91dCA9PT0gY2xlYXJUaW1lb3V0KSB7CiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zCiAgICAgICAgcmV0dXJuIGNsZWFyVGltZW91dChtYXJrZXIpOwogICAgfQogICAgLy8gaWYgY2xlYXJUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZAogICAgaWYgKChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGRlZmF1bHRDbGVhclRpbWVvdXQgfHwgIWNhY2hlZENsZWFyVGltZW91dCkgJiYgY2xlYXJUaW1lb3V0KSB7CiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0OwogICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzcwogICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQobWFya2VyKTsKICAgIH0gY2F0Y2ggKGUpewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCAgdHJ1c3QgdGhlIGdsb2JhbCBvYmplY3Qgd2hlbiBjYWxsZWQgbm9ybWFsbHkKICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKG51bGwsIG1hcmtlcik7CiAgICAgICAgfSBjYXRjaCAoZSl7CiAgICAgICAgICAgIC8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yLgogICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0CiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpOwogICAgICAgIH0KICAgIH0KCgoKfQp2YXIgcXVldWUgPSBbXTsKdmFyIGRyYWluaW5nID0gZmFsc2U7CnZhciBjdXJyZW50UXVldWU7CnZhciBxdWV1ZUluZGV4ID0gLTE7CgpmdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7CiAgICBpZiAoIWRyYWluaW5nIHx8ICFjdXJyZW50UXVldWUpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBkcmFpbmluZyA9IGZhbHNlOwogICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHsKICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpOwogICAgfSBlbHNlIHsKICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICB9CiAgICBpZiAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgZHJhaW5RdWV1ZSgpOwogICAgfQp9CgpmdW5jdGlvbiBkcmFpblF1ZXVlKCkgewogICAgaWYgKGRyYWluaW5nKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIHRpbWVvdXQgPSBydW5UaW1lb3V0KGNsZWFuVXBOZXh0VGljayk7CiAgICBkcmFpbmluZyA9IHRydWU7CgogICAgdmFyIGxlbiA9IHF1ZXVlLmxlbmd0aDsKICAgIHdoaWxlKGxlbikgewogICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlOwogICAgICAgIHF1ZXVlID0gW107CiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikgewogICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UXVldWVbcXVldWVJbmRleF0ucnVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcXVldWVJbmRleCA9IC0xOwogICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDsKICAgIH0KICAgIGN1cnJlbnRRdWV1ZSA9IG51bGw7CiAgICBkcmFpbmluZyA9IGZhbHNlOwogICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpOwp9Cgpwcm9jZXNzLm5leHRUaWNrID0gZnVuY3Rpb24gKGZ1bikgewogICAgdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CiAgICAgICAgfQogICAgfQogICAgcXVldWUucHVzaChuZXcgSXRlbShmdW4sIGFyZ3MpKTsKICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7CiAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTsKICAgIH0KfTsKCi8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHMKZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7CiAgICB0aGlzLmZ1biA9IGZ1bjsKICAgIHRoaXMuYXJyYXkgPSBhcnJheTsKfQpJdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsKfTsKcHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJzsKcHJvY2Vzcy5icm93c2VyID0gdHJ1ZTsKcHJvY2Vzcy5lbnYgPSB7fTsKcHJvY2Vzcy5hcmd2ID0gW107CnByb2Nlc3MudmVyc2lvbiA9ICcnOyAvLyBlbXB0eSBzdHJpbmcgdG8gYXZvaWQgcmVnZXhwIGlzc3Vlcwpwcm9jZXNzLnZlcnNpb25zID0ge307CgpmdW5jdGlvbiBub29wKCkge30KCnByb2Nlc3Mub24gPSBub29wOwpwcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDsKcHJvY2Vzcy5vbmNlID0gbm9vcDsKcHJvY2Vzcy5vZmYgPSBub29wOwpwcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDsKcHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wOwpwcm9jZXNzLmVtaXQgPSBub29wOwpwcm9jZXNzLnByZXBlbmRMaXN0ZW5lciA9IG5vb3A7CnByb2Nlc3MucHJlcGVuZE9uY2VMaXN0ZW5lciA9IG5vb3A7Cgpwcm9jZXNzLmxpc3RlbmVycyA9IGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiBbXSB9Cgpwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwp9OwoKcHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTsKcHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHsKICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7Cn07CnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07Cgp9LHt9XSw2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIEJ1ZmZlciA9IF9kZXJlcV8oJ2J1ZmZlcicpLkJ1ZmZlcjsgLy8gZm9yIHVzZSB3aXRoIGJyb3dzZXJpZnkKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgIGlmICghQnVmZmVyLmlzQnVmZmVyKGEpKSByZXR1cm4gdW5kZWZpbmVkOwogICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYikpIHJldHVybiB1bmRlZmluZWQ7CiAgICBpZiAodHlwZW9mIGEuZXF1YWxzID09PSAnZnVuY3Rpb24nKSByZXR1cm4gYS5lcXVhbHMoYik7CiAgICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChhW2ldICE9PSBiW2ldKSByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIHJldHVybiB0cnVlOwp9OwoKfSx7ImJ1ZmZlciI6N31dLDc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7Ci8qIQogKiBUaGUgYnVmZmVyIG1vZHVsZSBmcm9tIG5vZGUuanMsIGZvciB0aGUgYnJvd3Nlci4KICoKICogQGF1dGhvciAgIEZlcm9zcyBBYm91a2hhZGlqZWggPGZlcm9zc0BmZXJvc3Mub3JnPiA8aHR0cDovL2Zlcm9zcy5vcmc+CiAqIEBsaWNlbnNlICBNSVQKICovCi8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovCgondXNlIHN0cmljdCcKCnZhciBiYXNlNjQgPSBfZGVyZXFfKCdiYXNlNjQtanMnKQp2YXIgaWVlZTc1NCA9IF9kZXJlcV8oJ2llZWU3NTQnKQp2YXIgaXNBcnJheSA9IF9kZXJlcV8oJ2lzYXJyYXknKQoKZXhwb3J0cy5CdWZmZXIgPSBCdWZmZXIKZXhwb3J0cy5TbG93QnVmZmVyID0gU2xvd0J1ZmZlcgpleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTAKCi8qKgogKiBJZiBgQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlRgOgogKiAgID09PSB0cnVlICAgIFVzZSBVaW50OEFycmF5IGltcGxlbWVudGF0aW9uIChmYXN0ZXN0KQogKiAgID09PSBmYWxzZSAgIFVzZSBPYmplY3QgaW1wbGVtZW50YXRpb24gKG1vc3QgY29tcGF0aWJsZSwgZXZlbiBJRTYpCiAqCiAqIEJyb3dzZXJzIHRoYXQgc3VwcG9ydCB0eXBlZCBhcnJheXMgYXJlIElFIDEwKywgRmlyZWZveCA0KywgQ2hyb21lIDcrLCBTYWZhcmkgNS4xKywKICogT3BlcmEgMTEuNissIGlPUyA0LjIrLgogKgogKiBEdWUgdG8gdmFyaW91cyBicm93c2VyIGJ1Z3MsIHNvbWV0aW1lcyB0aGUgT2JqZWN0IGltcGxlbWVudGF0aW9uIHdpbGwgYmUgdXNlZCBldmVuCiAqIHdoZW4gdGhlIGJyb3dzZXIgc3VwcG9ydHMgdHlwZWQgYXJyYXlzLgogKgogKiBOb3RlOgogKgogKiAgIC0gRmlyZWZveCA0LTI5IGxhY2tzIHN1cHBvcnQgZm9yIGFkZGluZyBuZXcgcHJvcGVydGllcyB0byBgVWludDhBcnJheWAgaW5zdGFuY2VzLAogKiAgICAgU2VlOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02OTU0MzguCiAqCiAqICAgLSBDaHJvbWUgOS0xMCBpcyBtaXNzaW5nIHRoZSBgVHlwZWRBcnJheS5wcm90b3R5cGUuc3ViYXJyYXlgIGZ1bmN0aW9uLgogKgogKiAgIC0gSUUxMCBoYXMgYSBicm9rZW4gYFR5cGVkQXJyYXkucHJvdG90eXBlLnN1YmFycmF5YCBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGFycmF5cyBvZgogKiAgICAgaW5jb3JyZWN0IGxlbmd0aCBpbiBzb21lIHNpdHVhdGlvbnMuCgogKiBXZSBkZXRlY3QgdGhlc2UgYnVnZ3kgYnJvd3NlcnMgYW5kIHNldCBgQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlRgIHRvIGBmYWxzZWAgc28gdGhleQogKiBnZXQgdGhlIE9iamVjdCBpbXBsZW1lbnRhdGlvbiwgd2hpY2ggaXMgc2xvd2VyIGJ1dCBiZWhhdmVzIGNvcnJlY3RseS4KICovCkJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUID0gZ2xvYmFsLlRZUEVEX0FSUkFZX1NVUFBPUlQgIT09IHVuZGVmaW5lZAogID8gZ2xvYmFsLlRZUEVEX0FSUkFZX1NVUFBPUlQKICA6IHR5cGVkQXJyYXlTdXBwb3J0KCkKCi8qCiAqIEV4cG9ydCBrTWF4TGVuZ3RoIGFmdGVyIHR5cGVkIGFycmF5IHN1cHBvcnQgaXMgZGV0ZXJtaW5lZC4KICovCmV4cG9ydHMua01heExlbmd0aCA9IGtNYXhMZW5ndGgoKQoKZnVuY3Rpb24gdHlwZWRBcnJheVN1cHBvcnQgKCkgewogIHRyeSB7CiAgICB2YXIgYXJyID0gbmV3IFVpbnQ4QXJyYXkoMSkKICAgIGFyci5fX3Byb3RvX18gPSB7X19wcm90b19fOiBVaW50OEFycmF5LnByb3RvdHlwZSwgZm9vOiBmdW5jdGlvbiAoKSB7IHJldHVybiA0MiB9fQogICAgcmV0dXJuIGFyci5mb28oKSA9PT0gNDIgJiYgLy8gdHlwZWQgYXJyYXkgaW5zdGFuY2VzIGNhbiBiZSBhdWdtZW50ZWQKICAgICAgICB0eXBlb2YgYXJyLnN1YmFycmF5ID09PSAnZnVuY3Rpb24nICYmIC8vIGNocm9tZSA5LTEwIGxhY2sgYHN1YmFycmF5YAogICAgICAgIGFyci5zdWJhcnJheSgxLCAxKS5ieXRlTGVuZ3RoID09PSAwIC8vIGllMTAgaGFzIGJyb2tlbiBgc3ViYXJyYXlgCiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIGZhbHNlCiAgfQp9CgpmdW5jdGlvbiBrTWF4TGVuZ3RoICgpIHsKICByZXR1cm4gQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQKICAgID8gMHg3ZmZmZmZmZgogICAgOiAweDNmZmZmZmZmCn0KCmZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlciAodGhhdCwgbGVuZ3RoKSB7CiAgaWYgKGtNYXhMZW5ndGgoKSA8IGxlbmd0aCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0ludmFsaWQgdHlwZWQgYXJyYXkgbGVuZ3RoJykKICB9CiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICAvLyBSZXR1cm4gYW4gYXVnbWVudGVkIGBVaW50OEFycmF5YCBpbnN0YW5jZSwgZm9yIGJlc3QgcGVyZm9ybWFuY2UKICAgIHRoYXQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpCiAgICB0aGF0Ll9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGUKICB9IGVsc2UgewogICAgLy8gRmFsbGJhY2s6IFJldHVybiBhbiBvYmplY3QgaW5zdGFuY2Ugb2YgdGhlIEJ1ZmZlciBjbGFzcwogICAgaWYgKHRoYXQgPT09IG51bGwpIHsKICAgICAgdGhhdCA9IG5ldyBCdWZmZXIobGVuZ3RoKQogICAgfQogICAgdGhhdC5sZW5ndGggPSBsZW5ndGgKICB9CgogIHJldHVybiB0aGF0Cn0KCi8qKgogKiBUaGUgQnVmZmVyIGNvbnN0cnVjdG9yIHJldHVybnMgaW5zdGFuY2VzIG9mIGBVaW50OEFycmF5YCB0aGF0IGhhdmUgdGhlaXIKICogcHJvdG90eXBlIGNoYW5nZWQgdG8gYEJ1ZmZlci5wcm90b3R5cGVgLiBGdXJ0aGVybW9yZSwgYEJ1ZmZlcmAgaXMgYSBzdWJjbGFzcyBvZgogKiBgVWludDhBcnJheWAsIHNvIHRoZSByZXR1cm5lZCBpbnN0YW5jZXMgd2lsbCBoYXZlIGFsbCB0aGUgbm9kZSBgQnVmZmVyYCBtZXRob2RzCiAqIGFuZCB0aGUgYFVpbnQ4QXJyYXlgIG1ldGhvZHMuIFNxdWFyZSBicmFja2V0IG5vdGF0aW9uIHdvcmtzIGFzIGV4cGVjdGVkIC0tIGl0CiAqIHJldHVybnMgYSBzaW5nbGUgb2N0ZXQuCiAqCiAqIFRoZSBgVWludDhBcnJheWAgcHJvdG90eXBlIHJlbWFpbnMgdW5tb2RpZmllZC4KICovCgpmdW5jdGlvbiBCdWZmZXIgKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCAmJiAhKHRoaXMgaW5zdGFuY2VvZiBCdWZmZXIpKSB7CiAgICByZXR1cm4gbmV3IEJ1ZmZlcihhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkKICB9CgogIC8vIENvbW1vbiBjYXNlLgogIGlmICh0eXBlb2YgYXJnID09PSAnbnVtYmVyJykgewogICAgaWYgKHR5cGVvZiBlbmNvZGluZ09yT2Zmc2V0ID09PSAnc3RyaW5nJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ0lmIGVuY29kaW5nIGlzIHNwZWNpZmllZCB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nJwogICAgICApCiAgICB9CiAgICByZXR1cm4gYWxsb2NVbnNhZmUodGhpcywgYXJnKQogIH0KICByZXR1cm4gZnJvbSh0aGlzLCBhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkKfQoKQnVmZmVyLnBvb2xTaXplID0gODE5MiAvLyBub3QgdXNlZCBieSB0aGlzIGltcGxlbWVudGF0aW9uCgovLyBUT0RPOiBMZWdhY3ksIG5vdCBuZWVkZWQgYW55bW9yZS4gUmVtb3ZlIGluIG5leHQgbWFqb3IgdmVyc2lvbi4KQnVmZmVyLl9hdWdtZW50ID0gZnVuY3Rpb24gKGFycikgewogIGFyci5fX3Byb3RvX18gPSBCdWZmZXIucHJvdG90eXBlCiAgcmV0dXJuIGFycgp9CgpmdW5jdGlvbiBmcm9tICh0aGF0LCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJ2YWx1ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgYSBudW1iZXInKQogIH0KCiAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgcmV0dXJuIGZyb21BcnJheUJ1ZmZlcih0aGF0LCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKQogIH0KCiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgIHJldHVybiBmcm9tU3RyaW5nKHRoYXQsIHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0KQogIH0KCiAgcmV0dXJuIGZyb21PYmplY3QodGhhdCwgdmFsdWUpCn0KCi8qKgogKiBGdW5jdGlvbmFsbHkgZXF1aXZhbGVudCB0byBCdWZmZXIoYXJnLCBlbmNvZGluZykgYnV0IHRocm93cyBhIFR5cGVFcnJvcgogKiBpZiB2YWx1ZSBpcyBhIG51bWJlci4KICogQnVmZmVyLmZyb20oc3RyWywgZW5jb2RpbmddKQogKiBCdWZmZXIuZnJvbShhcnJheSkKICogQnVmZmVyLmZyb20oYnVmZmVyKQogKiBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlclssIGJ5dGVPZmZzZXRbLCBsZW5ndGhdXSkKICoqLwpCdWZmZXIuZnJvbSA9IGZ1bmN0aW9uICh2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGZyb20obnVsbCwgdmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkKfQoKaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgQnVmZmVyLnByb3RvdHlwZS5fX3Byb3RvX18gPSBVaW50OEFycmF5LnByb3RvdHlwZQogIEJ1ZmZlci5fX3Byb3RvX18gPSBVaW50OEFycmF5CiAgaWYgKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC5zcGVjaWVzICYmCiAgICAgIEJ1ZmZlcltTeW1ib2wuc3BlY2llc10gPT09IEJ1ZmZlcikgewogICAgLy8gRml4IHN1YmFycmF5KCkgaW4gRVMyMDE2LiBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvYnVmZmVyL3B1bGwvOTcKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXIsIFN5bWJvbC5zcGVjaWVzLCB7CiAgICAgIHZhbHVlOiBudWxsLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pCiAgfQp9CgpmdW5jdGlvbiBhc3NlcnRTaXplIChzaXplKSB7CiAgaWYgKHR5cGVvZiBzaXplICE9PSAnbnVtYmVyJykgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcignInNpemUiIGFyZ3VtZW50IG11c3QgYmUgYSBudW1iZXInKQogIH0gZWxzZSBpZiAoc2l6ZSA8IDApIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCcic2l6ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgbmVnYXRpdmUnKQogIH0KfQoKZnVuY3Rpb24gYWxsb2MgKHRoYXQsIHNpemUsIGZpbGwsIGVuY29kaW5nKSB7CiAgYXNzZXJ0U2l6ZShzaXplKQogIGlmIChzaXplIDw9IDApIHsKICAgIHJldHVybiBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSkKICB9CiAgaWYgKGZpbGwgIT09IHVuZGVmaW5lZCkgewogICAgLy8gT25seSBwYXkgYXR0ZW50aW9uIHRvIGVuY29kaW5nIGlmIGl0J3MgYSBzdHJpbmcuIFRoaXMKICAgIC8vIHByZXZlbnRzIGFjY2lkZW50YWxseSBzZW5kaW5nIGluIGEgbnVtYmVyIHRoYXQgd291bGQKICAgIC8vIGJlIGludGVycHJldHRlZCBhcyBhIHN0YXJ0IG9mZnNldC4KICAgIHJldHVybiB0eXBlb2YgZW5jb2RpbmcgPT09ICdzdHJpbmcnCiAgICAgID8gY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUpLmZpbGwoZmlsbCwgZW5jb2RpbmcpCiAgICAgIDogY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUpLmZpbGwoZmlsbCkKICB9CiAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplKQp9CgovKioKICogQ3JlYXRlcyBhIG5ldyBmaWxsZWQgQnVmZmVyIGluc3RhbmNlLgogKiBhbGxvYyhzaXplWywgZmlsbFssIGVuY29kaW5nXV0pCiAqKi8KQnVmZmVyLmFsbG9jID0gZnVuY3Rpb24gKHNpemUsIGZpbGwsIGVuY29kaW5nKSB7CiAgcmV0dXJuIGFsbG9jKG51bGwsIHNpemUsIGZpbGwsIGVuY29kaW5nKQp9CgpmdW5jdGlvbiBhbGxvY1Vuc2FmZSAodGhhdCwgc2l6ZSkgewogIGFzc2VydFNpemUoc2l6ZSkKICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIHNpemUgPCAwID8gMCA6IGNoZWNrZWQoc2l6ZSkgfCAwKQogIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgKytpKSB7CiAgICAgIHRoYXRbaV0gPSAwCiAgICB9CiAgfQogIHJldHVybiB0aGF0Cn0KCi8qKgogKiBFcXVpdmFsZW50IHRvIEJ1ZmZlcihudW0pLCBieSBkZWZhdWx0IGNyZWF0ZXMgYSBub24temVyby1maWxsZWQgQnVmZmVyIGluc3RhbmNlLgogKiAqLwpCdWZmZXIuYWxsb2NVbnNhZmUgPSBmdW5jdGlvbiAoc2l6ZSkgewogIHJldHVybiBhbGxvY1Vuc2FmZShudWxsLCBzaXplKQp9Ci8qKgogKiBFcXVpdmFsZW50IHRvIFNsb3dCdWZmZXIobnVtKSwgYnkgZGVmYXVsdCBjcmVhdGVzIGEgbm9uLXplcm8tZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS4KICovCkJ1ZmZlci5hbGxvY1Vuc2FmZVNsb3cgPSBmdW5jdGlvbiAoc2l6ZSkgewogIHJldHVybiBhbGxvY1Vuc2FmZShudWxsLCBzaXplKQp9CgpmdW5jdGlvbiBmcm9tU3RyaW5nICh0aGF0LCBzdHJpbmcsIGVuY29kaW5nKSB7CiAgaWYgKHR5cGVvZiBlbmNvZGluZyAhPT0gJ3N0cmluZycgfHwgZW5jb2RpbmcgPT09ICcnKSB7CiAgICBlbmNvZGluZyA9ICd1dGY4JwogIH0KCiAgaWYgKCFCdWZmZXIuaXNFbmNvZGluZyhlbmNvZGluZykpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJlbmNvZGluZyIgbXVzdCBiZSBhIHZhbGlkIHN0cmluZyBlbmNvZGluZycpCiAgfQoKICB2YXIgbGVuZ3RoID0gYnl0ZUxlbmd0aChzdHJpbmcsIGVuY29kaW5nKSB8IDAKICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbmd0aCkKCiAgdmFyIGFjdHVhbCA9IHRoYXQud3JpdGUoc3RyaW5nLCBlbmNvZGluZykKCiAgaWYgKGFjdHVhbCAhPT0gbGVuZ3RoKSB7CiAgICAvLyBXcml0aW5nIGEgaGV4IHN0cmluZywgZm9yIGV4YW1wbGUsIHRoYXQgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzIHdpbGwKICAgIC8vIGNhdXNlIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0IGludmFsaWQgY2hhcmFjdGVyIHRvIGJlIGlnbm9yZWQuIChlLmcuCiAgICAvLyAnYWJ4eGNkJyB3aWxsIGJlIHRyZWF0ZWQgYXMgJ2FiJykKICAgIHRoYXQgPSB0aGF0LnNsaWNlKDAsIGFjdHVhbCkKICB9CgogIHJldHVybiB0aGF0Cn0KCmZ1bmN0aW9uIGZyb21BcnJheUxpa2UgKHRoYXQsIGFycmF5KSB7CiAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCA8IDAgPyAwIDogY2hlY2tlZChhcnJheS5sZW5ndGgpIHwgMAogIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgbGVuZ3RoKQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgIHRoYXRbaV0gPSBhcnJheVtpXSAmIDI1NQogIH0KICByZXR1cm4gdGhhdAp9CgpmdW5jdGlvbiBmcm9tQXJyYXlCdWZmZXIgKHRoYXQsIGFycmF5LCBieXRlT2Zmc2V0LCBsZW5ndGgpIHsKICBhcnJheS5ieXRlTGVuZ3RoIC8vIHRoaXMgdGhyb3dzIGlmIGBhcnJheWAgaXMgbm90IGEgdmFsaWQgQXJyYXlCdWZmZXIKCiAgaWYgKGJ5dGVPZmZzZXQgPCAwIHx8IGFycmF5LmJ5dGVMZW5ndGggPCBieXRlT2Zmc2V0KSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXCdvZmZzZXRcJyBpcyBvdXQgb2YgYm91bmRzJykKICB9CgogIGlmIChhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCArIChsZW5ndGggfHwgMCkpIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcJ2xlbmd0aFwnIGlzIG91dCBvZiBib3VuZHMnKQogIH0KCiAgaWYgKGJ5dGVPZmZzZXQgPT09IHVuZGVmaW5lZCAmJiBsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSkKICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICBhcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5LCBieXRlT2Zmc2V0KQogIH0gZWxzZSB7CiAgICBhcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5LCBieXRlT2Zmc2V0LCBsZW5ndGgpCiAgfQoKICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgIC8vIFJldHVybiBhbiBhdWdtZW50ZWQgYFVpbnQ4QXJyYXlgIGluc3RhbmNlLCBmb3IgYmVzdCBwZXJmb3JtYW5jZQogICAgdGhhdCA9IGFycmF5CiAgICB0aGF0Ll9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGUKICB9IGVsc2UgewogICAgLy8gRmFsbGJhY2s6IFJldHVybiBhbiBvYmplY3QgaW5zdGFuY2Ugb2YgdGhlIEJ1ZmZlciBjbGFzcwogICAgdGhhdCA9IGZyb21BcnJheUxpa2UodGhhdCwgYXJyYXkpCiAgfQogIHJldHVybiB0aGF0Cn0KCmZ1bmN0aW9uIGZyb21PYmplY3QgKHRoYXQsIG9iaikgewogIGlmIChCdWZmZXIuaXNCdWZmZXIob2JqKSkgewogICAgdmFyIGxlbiA9IGNoZWNrZWQob2JqLmxlbmd0aCkgfCAwCiAgICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbikKCiAgICBpZiAodGhhdC5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHRoYXQKICAgIH0KCiAgICBvYmouY29weSh0aGF0LCAwLCAwLCBsZW4pCiAgICByZXR1cm4gdGhhdAogIH0KCiAgaWYgKG9iaikgewogICAgaWYgKCh0eXBlb2YgQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICAgb2JqLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB8fCAnbGVuZ3RoJyBpbiBvYmopIHsKICAgICAgaWYgKHR5cGVvZiBvYmoubGVuZ3RoICE9PSAnbnVtYmVyJyB8fCBpc25hbihvYmoubGVuZ3RoKSkgewogICAgICAgIHJldHVybiBjcmVhdGVCdWZmZXIodGhhdCwgMCkKICAgICAgfQogICAgICByZXR1cm4gZnJvbUFycmF5TGlrZSh0aGF0LCBvYmopCiAgICB9CgogICAgaWYgKG9iai50eXBlID09PSAnQnVmZmVyJyAmJiBpc0FycmF5KG9iai5kYXRhKSkgewogICAgICByZXR1cm4gZnJvbUFycmF5TGlrZSh0aGF0LCBvYmouZGF0YSkKICAgIH0KICB9CgogIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4nKQp9CgpmdW5jdGlvbiBjaGVja2VkIChsZW5ndGgpIHsKICAvLyBOb3RlOiBjYW5ub3QgdXNlIGBsZW5ndGggPCBrTWF4TGVuZ3RoKClgIGhlcmUgYmVjYXVzZSB0aGF0IGZhaWxzIHdoZW4KICAvLyBsZW5ndGggaXMgTmFOICh3aGljaCBpcyBvdGhlcndpc2UgY29lcmNlZCB0byB6ZXJvLikKICBpZiAobGVuZ3RoID49IGtNYXhMZW5ndGgoKSkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0F0dGVtcHQgdG8gYWxsb2NhdGUgQnVmZmVyIGxhcmdlciB0aGFuIG1heGltdW0gJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZTogMHgnICsga01heExlbmd0aCgpLnRvU3RyaW5nKDE2KSArICcgYnl0ZXMnKQogIH0KICByZXR1cm4gbGVuZ3RoIHwgMAp9CgpmdW5jdGlvbiBTbG93QnVmZmVyIChsZW5ndGgpIHsKICBpZiAoK2xlbmd0aCAhPSBsZW5ndGgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEKICAgIGxlbmd0aCA9IDAKICB9CiAgcmV0dXJuIEJ1ZmZlci5hbGxvYygrbGVuZ3RoKQp9CgpCdWZmZXIuaXNCdWZmZXIgPSBmdW5jdGlvbiBpc0J1ZmZlciAoYikgewogIHJldHVybiAhIShiICE9IG51bGwgJiYgYi5faXNCdWZmZXIpCn0KCkJ1ZmZlci5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZSAoYSwgYikgewogIGlmICghQnVmZmVyLmlzQnVmZmVyKGEpIHx8ICFCdWZmZXIuaXNCdWZmZXIoYikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50cyBtdXN0IGJlIEJ1ZmZlcnMnKQogIH0KCiAgaWYgKGEgPT09IGIpIHJldHVybiAwCgogIHZhciB4ID0gYS5sZW5ndGgKICB2YXIgeSA9IGIubGVuZ3RoCgogIGZvciAodmFyIGkgPSAwLCBsZW4gPSBNYXRoLm1pbih4LCB5KTsgaSA8IGxlbjsgKytpKSB7CiAgICBpZiAoYVtpXSAhPT0gYltpXSkgewogICAgICB4ID0gYVtpXQogICAgICB5ID0gYltpXQogICAgICBicmVhawogICAgfQogIH0KCiAgaWYgKHggPCB5KSByZXR1cm4gLTEKICBpZiAoeSA8IHgpIHJldHVybiAxCiAgcmV0dXJuIDAKfQoKQnVmZmVyLmlzRW5jb2RpbmcgPSBmdW5jdGlvbiBpc0VuY29kaW5nIChlbmNvZGluZykgewogIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7CiAgICBjYXNlICdoZXgnOgogICAgY2FzZSAndXRmOCc6CiAgICBjYXNlICd1dGYtOCc6CiAgICBjYXNlICdhc2NpaSc6CiAgICBjYXNlICdsYXRpbjEnOgogICAgY2FzZSAnYmluYXJ5JzoKICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICBjYXNlICd1Y3MyJzoKICAgIGNhc2UgJ3Vjcy0yJzoKICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgY2FzZSAndXRmLTE2bGUnOgogICAgICByZXR1cm4gdHJ1ZQogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZhbHNlCiAgfQp9CgpCdWZmZXIuY29uY2F0ID0gZnVuY3Rpb24gY29uY2F0IChsaXN0LCBsZW5ndGgpIHsKICBpZiAoIWlzQXJyYXkobGlzdCkpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKQogIH0KCiAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gQnVmZmVyLmFsbG9jKDApCiAgfQoKICB2YXIgaQogIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgewogICAgbGVuZ3RoID0gMAogICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyArK2kpIHsKICAgICAgbGVuZ3RoICs9IGxpc3RbaV0ubGVuZ3RoCiAgICB9CiAgfQoKICB2YXIgYnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKGxlbmd0aCkKICB2YXIgcG9zID0gMAogIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7CiAgICB2YXIgYnVmID0gbGlzdFtpXQogICAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmKSkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCcibGlzdCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJykKICAgIH0KICAgIGJ1Zi5jb3B5KGJ1ZmZlciwgcG9zKQogICAgcG9zICs9IGJ1Zi5sZW5ndGgKICB9CiAgcmV0dXJuIGJ1ZmZlcgp9CgpmdW5jdGlvbiBieXRlTGVuZ3RoIChzdHJpbmcsIGVuY29kaW5nKSB7CiAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihzdHJpbmcpKSB7CiAgICByZXR1cm4gc3RyaW5nLmxlbmd0aAogIH0KICBpZiAodHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgQXJyYXlCdWZmZXIuaXNWaWV3ID09PSAnZnVuY3Rpb24nICYmCiAgICAgIChBcnJheUJ1ZmZlci5pc1ZpZXcoc3RyaW5nKSB8fCBzdHJpbmcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHsKICAgIHJldHVybiBzdHJpbmcuYnl0ZUxlbmd0aAogIH0KICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpIHsKICAgIHN0cmluZyA9ICcnICsgc3RyaW5nCiAgfQoKICB2YXIgbGVuID0gc3RyaW5nLmxlbmd0aAogIGlmIChsZW4gPT09IDApIHJldHVybiAwCgogIC8vIFVzZSBhIGZvciBsb29wIHRvIGF2b2lkIHJlY3Vyc2lvbgogIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlCiAgZm9yICg7OykgewogICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICBjYXNlICdhc2NpaSc6CiAgICAgIGNhc2UgJ2xhdGluMSc6CiAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgcmV0dXJuIGxlbgogICAgICBjYXNlICd1dGY4JzoKICAgICAgY2FzZSAndXRmLTgnOgogICAgICBjYXNlIHVuZGVmaW5lZDoKICAgICAgICByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGgKICAgICAgY2FzZSAndWNzMic6CiAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICByZXR1cm4gbGVuICogMgogICAgICBjYXNlICdoZXgnOgogICAgICAgIHJldHVybiBsZW4gPj4+IDEKICAgICAgY2FzZSAnYmFzZTY0JzoKICAgICAgICByZXR1cm4gYmFzZTY0VG9CeXRlcyhzdHJpbmcpLmxlbmd0aAogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgcmV0dXJuIHV0ZjhUb0J5dGVzKHN0cmluZykubGVuZ3RoIC8vIGFzc3VtZSB1dGY4CiAgICAgICAgZW5jb2RpbmcgPSAoJycgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKQogICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZQogICAgfQogIH0KfQpCdWZmZXIuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGgKCmZ1bmN0aW9uIHNsb3dUb1N0cmluZyAoZW5jb2RpbmcsIHN0YXJ0LCBlbmQpIHsKICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZQoKICAvLyBObyBuZWVkIHRvIHZlcmlmeSB0aGF0ICJ0aGlzLmxlbmd0aCA8PSBNQVhfVUlOVDMyIiBzaW5jZSBpdCdzIGEgcmVhZC1vbmx5CiAgLy8gcHJvcGVydHkgb2YgYSB0eXBlZCBhcnJheS4KCiAgLy8gVGhpcyBiZWhhdmVzIG5laXRoZXIgbGlrZSBTdHJpbmcgbm9yIFVpbnQ4QXJyYXkgaW4gdGhhdCB3ZSBzZXQgc3RhcnQvZW5kCiAgLy8gdG8gdGhlaXIgdXBwZXIvbG93ZXIgYm91bmRzIGlmIHRoZSB2YWx1ZSBwYXNzZWQgaXMgb3V0IG9mIHJhbmdlLgogIC8vIHVuZGVmaW5lZCBpcyBoYW5kbGVkIHNwZWNpYWxseSBhcyBwZXIgRUNNQS0yNjIgNnRoIEVkaXRpb24sCiAgLy8gU2VjdGlvbiAxMy4zLjMuNyBSdW50aW1lIFNlbWFudGljczogS2V5ZWRCaW5kaW5nSW5pdGlhbGl6YXRpb24uCiAgaWYgKHN0YXJ0ID09PSB1bmRlZmluZWQgfHwgc3RhcnQgPCAwKSB7CiAgICBzdGFydCA9IDAKICB9CiAgLy8gUmV0dXJuIGVhcmx5IGlmIHN0YXJ0ID4gdGhpcy5sZW5ndGguIERvbmUgaGVyZSB0byBwcmV2ZW50IHBvdGVudGlhbCB1aW50MzIKICAvLyBjb2VyY2lvbiBmYWlsIGJlbG93LgogIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7CiAgICByZXR1cm4gJycKICB9CgogIGlmIChlbmQgPT09IHVuZGVmaW5lZCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkgewogICAgZW5kID0gdGhpcy5sZW5ndGgKICB9CgogIGlmIChlbmQgPD0gMCkgewogICAgcmV0dXJuICcnCiAgfQoKICAvLyBGb3JjZSBjb2Vyc2lvbiB0byB1aW50MzIuIFRoaXMgd2lsbCBhbHNvIGNvZXJjZSBmYWxzZXkvTmFOIHZhbHVlcyB0byAwLgogIGVuZCA+Pj49IDAKICBzdGFydCA+Pj49IDAKCiAgaWYgKGVuZCA8PSBzdGFydCkgewogICAgcmV0dXJuICcnCiAgfQoKICBpZiAoIWVuY29kaW5nKSBlbmNvZGluZyA9ICd1dGY4JwoKICB3aGlsZSAodHJ1ZSkgewogICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICBjYXNlICdoZXgnOgogICAgICAgIHJldHVybiBoZXhTbGljZSh0aGlzLCBzdGFydCwgZW5kKQoKICAgICAgY2FzZSAndXRmOCc6CiAgICAgIGNhc2UgJ3V0Zi04JzoKICAgICAgICByZXR1cm4gdXRmOFNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBjYXNlICdhc2NpaSc6CiAgICAgICAgcmV0dXJuIGFzY2lpU2xpY2UodGhpcywgc3RhcnQsIGVuZCkKCiAgICAgIGNhc2UgJ2xhdGluMSc6CiAgICAgIGNhc2UgJ2JpbmFyeSc6CiAgICAgICAgcmV0dXJuIGxhdGluMVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBjYXNlICdiYXNlNjQnOgogICAgICAgIHJldHVybiBiYXNlNjRTbGljZSh0aGlzLCBzdGFydCwgZW5kKQoKICAgICAgY2FzZSAndWNzMic6CiAgICAgIGNhc2UgJ3Vjcy0yJzoKICAgICAgY2FzZSAndXRmMTZsZSc6CiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzoKICAgICAgICByZXR1cm4gdXRmMTZsZVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpCgogICAgICBkZWZhdWx0OgogICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKQogICAgICAgIGVuY29kaW5nID0gKGVuY29kaW5nICsgJycpLnRvTG93ZXJDYXNlKCkKICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWUKICAgIH0KICB9Cn0KCi8vIFRoZSBwcm9wZXJ0eSBpcyB1c2VkIGJ5IGBCdWZmZXIuaXNCdWZmZXJgIGFuZCBgaXMtYnVmZmVyYCAoaW4gU2FmYXJpIDUtNykgdG8gZGV0ZWN0Ci8vIEJ1ZmZlciBpbnN0YW5jZXMuCkJ1ZmZlci5wcm90b3R5cGUuX2lzQnVmZmVyID0gdHJ1ZQoKZnVuY3Rpb24gc3dhcCAoYiwgbiwgbSkgewogIHZhciBpID0gYltuXQogIGJbbl0gPSBiW21dCiAgYlttXSA9IGkKfQoKQnVmZmVyLnByb3RvdHlwZS5zd2FwMTYgPSBmdW5jdGlvbiBzd2FwMTYgKCkgewogIHZhciBsZW4gPSB0aGlzLmxlbmd0aAogIGlmIChsZW4gJSAyICE9PSAwKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMnKQogIH0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICBzd2FwKHRoaXMsIGksIGkgKyAxKQogIH0KICByZXR1cm4gdGhpcwp9CgpCdWZmZXIucHJvdG90eXBlLnN3YXAzMiA9IGZ1bmN0aW9uIHN3YXAzMiAoKSB7CiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoCiAgaWYgKGxlbiAlIDQgIT09IDApIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMzItYml0cycpCiAgfQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDQpIHsKICAgIHN3YXAodGhpcywgaSwgaSArIDMpCiAgICBzd2FwKHRoaXMsIGkgKyAxLCBpICsgMikKICB9CiAgcmV0dXJuIHRoaXMKfQoKQnVmZmVyLnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbiBzd2FwNjQgKCkgewogIHZhciBsZW4gPSB0aGlzLmxlbmd0aAogIGlmIChsZW4gJSA4ICE9PSAwKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDY0LWJpdHMnKQogIH0KICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSA4KSB7CiAgICBzd2FwKHRoaXMsIGksIGkgKyA3KQogICAgc3dhcCh0aGlzLCBpICsgMSwgaSArIDYpCiAgICBzd2FwKHRoaXMsIGkgKyAyLCBpICsgNSkKICAgIHN3YXAodGhpcywgaSArIDMsIGkgKyA0KQogIH0KICByZXR1cm4gdGhpcwp9CgpCdWZmZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcgKCkgewogIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aCB8IDAKICBpZiAobGVuZ3RoID09PSAwKSByZXR1cm4gJycKICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCAwLCBsZW5ndGgpCiAgcmV0dXJuIHNsb3dUb1N0cmluZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpCn0KCkJ1ZmZlci5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gZXF1YWxzIChiKSB7CiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYikpIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXInKQogIGlmICh0aGlzID09PSBiKSByZXR1cm4gdHJ1ZQogIHJldHVybiBCdWZmZXIuY29tcGFyZSh0aGlzLCBiKSA9PT0gMAp9CgpCdWZmZXIucHJvdG90eXBlLmluc3BlY3QgPSBmdW5jdGlvbiBpbnNwZWN0ICgpIHsKICB2YXIgc3RyID0gJycKICB2YXIgbWF4ID0gZXhwb3J0cy5JTlNQRUNUX01BWF9CWVRFUwogIGlmICh0aGlzLmxlbmd0aCA+IDApIHsKICAgIHN0ciA9IHRoaXMudG9TdHJpbmcoJ2hleCcsIDAsIG1heCkubWF0Y2goLy57Mn0vZykuam9pbignICcpCiAgICBpZiAodGhpcy5sZW5ndGggPiBtYXgpIHN0ciArPSAnIC4uLiAnCiAgfQogIHJldHVybiAnPEJ1ZmZlciAnICsgc3RyICsgJz4nCn0KCkJ1ZmZlci5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uIGNvbXBhcmUgKHRhcmdldCwgc3RhcnQsIGVuZCwgdGhpc1N0YXJ0LCB0aGlzRW5kKSB7CiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIodGFyZ2V0KSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlcicpCiAgfQoKICBpZiAoc3RhcnQgPT09IHVuZGVmaW5lZCkgewogICAgc3RhcnQgPSAwCiAgfQogIGlmIChlbmQgPT09IHVuZGVmaW5lZCkgewogICAgZW5kID0gdGFyZ2V0ID8gdGFyZ2V0Lmxlbmd0aCA6IDAKICB9CiAgaWYgKHRoaXNTdGFydCA9PT0gdW5kZWZpbmVkKSB7CiAgICB0aGlzU3RhcnQgPSAwCiAgfQogIGlmICh0aGlzRW5kID09PSB1bmRlZmluZWQpIHsKICAgIHRoaXNFbmQgPSB0aGlzLmxlbmd0aAogIH0KCiAgaWYgKHN0YXJ0IDwgMCB8fCBlbmQgPiB0YXJnZXQubGVuZ3RoIHx8IHRoaXNTdGFydCA8IDAgfHwgdGhpc0VuZCA+IHRoaXMubGVuZ3RoKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignb3V0IG9mIHJhbmdlIGluZGV4JykKICB9CgogIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCAmJiBzdGFydCA+PSBlbmQpIHsKICAgIHJldHVybiAwCiAgfQogIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCkgewogICAgcmV0dXJuIC0xCiAgfQogIGlmIChzdGFydCA+PSBlbmQpIHsKICAgIHJldHVybiAxCiAgfQoKICBzdGFydCA+Pj49IDAKICBlbmQgPj4+PSAwCiAgdGhpc1N0YXJ0ID4+Pj0gMAogIHRoaXNFbmQgPj4+PSAwCgogIGlmICh0aGlzID09PSB0YXJnZXQpIHJldHVybiAwCgogIHZhciB4ID0gdGhpc0VuZCAtIHRoaXNTdGFydAogIHZhciB5ID0gZW5kIC0gc3RhcnQKICB2YXIgbGVuID0gTWF0aC5taW4oeCwgeSkKCiAgdmFyIHRoaXNDb3B5ID0gdGhpcy5zbGljZSh0aGlzU3RhcnQsIHRoaXNFbmQpCiAgdmFyIHRhcmdldENvcHkgPSB0YXJnZXQuc2xpY2Uoc3RhcnQsIGVuZCkKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkgewogICAgaWYgKHRoaXNDb3B5W2ldICE9PSB0YXJnZXRDb3B5W2ldKSB7CiAgICAgIHggPSB0aGlzQ29weVtpXQogICAgICB5ID0gdGFyZ2V0Q29weVtpXQogICAgICBicmVhawogICAgfQogIH0KCiAgaWYgKHggPCB5KSByZXR1cm4gLTEKICBpZiAoeSA8IHgpIHJldHVybiAxCiAgcmV0dXJuIDAKfQoKLy8gRmluZHMgZWl0aGVyIHRoZSBmaXJzdCBpbmRleCBvZiBgdmFsYCBpbiBgYnVmZmVyYCBhdCBvZmZzZXQgPj0gYGJ5dGVPZmZzZXRgLAovLyBPUiB0aGUgbGFzdCBpbmRleCBvZiBgdmFsYCBpbiBgYnVmZmVyYCBhdCBvZmZzZXQgPD0gYGJ5dGVPZmZzZXRgLgovLwovLyBBcmd1bWVudHM6Ci8vIC0gYnVmZmVyIC0gYSBCdWZmZXIgdG8gc2VhcmNoCi8vIC0gdmFsIC0gYSBzdHJpbmcsIEJ1ZmZlciwgb3IgbnVtYmVyCi8vIC0gYnl0ZU9mZnNldCAtIGFuIGluZGV4IGludG8gYGJ1ZmZlcmA7IHdpbGwgYmUgY2xhbXBlZCB0byBhbiBpbnQzMgovLyAtIGVuY29kaW5nIC0gYW4gb3B0aW9uYWwgZW5jb2RpbmcsIHJlbGV2YW50IGlzIHZhbCBpcyBhIHN0cmluZwovLyAtIGRpciAtIHRydWUgZm9yIGluZGV4T2YsIGZhbHNlIGZvciBsYXN0SW5kZXhPZgpmdW5jdGlvbiBiaWRpcmVjdGlvbmFsSW5kZXhPZiAoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHsKICAvLyBFbXB0eSBidWZmZXIgbWVhbnMgbm8gbWF0Y2gKICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkgcmV0dXJuIC0xCgogIC8vIE5vcm1hbGl6ZSBieXRlT2Zmc2V0CiAgaWYgKHR5cGVvZiBieXRlT2Zmc2V0ID09PSAnc3RyaW5nJykgewogICAgZW5jb2RpbmcgPSBieXRlT2Zmc2V0CiAgICBieXRlT2Zmc2V0ID0gMAogIH0gZWxzZSBpZiAoYnl0ZU9mZnNldCA+IDB4N2ZmZmZmZmYpIHsKICAgIGJ5dGVPZmZzZXQgPSAweDdmZmZmZmZmCiAgfSBlbHNlIGlmIChieXRlT2Zmc2V0IDwgLTB4ODAwMDAwMDApIHsKICAgIGJ5dGVPZmZzZXQgPSAtMHg4MDAwMDAwMAogIH0KICBieXRlT2Zmc2V0ID0gK2J5dGVPZmZzZXQgIC8vIENvZXJjZSB0byBOdW1iZXIuCiAgaWYgKGlzTmFOKGJ5dGVPZmZzZXQpKSB7CiAgICAvLyBieXRlT2Zmc2V0OiBpdCBpdCdzIHVuZGVmaW5lZCwgbnVsbCwgTmFOLCAiZm9vIiwgZXRjLCBzZWFyY2ggd2hvbGUgYnVmZmVyCiAgICBieXRlT2Zmc2V0ID0gZGlyID8gMCA6IChidWZmZXIubGVuZ3RoIC0gMSkKICB9CgogIC8vIE5vcm1hbGl6ZSBieXRlT2Zmc2V0OiBuZWdhdGl2ZSBvZmZzZXRzIHN0YXJ0IGZyb20gdGhlIGVuZCBvZiB0aGUgYnVmZmVyCiAgaWYgKGJ5dGVPZmZzZXQgPCAwKSBieXRlT2Zmc2V0ID0gYnVmZmVyLmxlbmd0aCArIGJ5dGVPZmZzZXQKICBpZiAoYnl0ZU9mZnNldCA+PSBidWZmZXIubGVuZ3RoKSB7CiAgICBpZiAoZGlyKSByZXR1cm4gLTEKICAgIGVsc2UgYnl0ZU9mZnNldCA9IGJ1ZmZlci5sZW5ndGggLSAxCiAgfSBlbHNlIGlmIChieXRlT2Zmc2V0IDwgMCkgewogICAgaWYgKGRpcikgYnl0ZU9mZnNldCA9IDAKICAgIGVsc2UgcmV0dXJuIC0xCiAgfQoKICAvLyBOb3JtYWxpemUgdmFsCiAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7CiAgICB2YWwgPSBCdWZmZXIuZnJvbSh2YWwsIGVuY29kaW5nKQogIH0KCiAgLy8gRmluYWxseSwgc2VhcmNoIGVpdGhlciBpbmRleE9mIChpZiBkaXIgaXMgdHJ1ZSkgb3IgbGFzdEluZGV4T2YKICBpZiAoQnVmZmVyLmlzQnVmZmVyKHZhbCkpIHsKICAgIC8vIFNwZWNpYWwgY2FzZTogbG9va2luZyBmb3IgZW1wdHkgc3RyaW5nL2J1ZmZlciBhbHdheXMgZmFpbHMKICAgIGlmICh2YWwubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiAtMQogICAgfQogICAgcmV0dXJuIGFycmF5SW5kZXhPZihidWZmZXIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7CiAgICB2YWwgPSB2YWwgJiAweEZGIC8vIFNlYXJjaCBmb3IgYSBieXRlIHZhbHVlIFswLTI1NV0KICAgIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCAmJgogICAgICAgIHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIGlmIChkaXIpIHsKICAgICAgICByZXR1cm4gVWludDhBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KQogICAgICB9CiAgICB9CiAgICByZXR1cm4gYXJyYXlJbmRleE9mKGJ1ZmZlciwgWyB2YWwgXSwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcikKICB9CgogIHRocm93IG5ldyBUeXBlRXJyb3IoJ3ZhbCBtdXN0IGJlIHN0cmluZywgbnVtYmVyIG9yIEJ1ZmZlcicpCn0KCmZ1bmN0aW9uIGFycmF5SW5kZXhPZiAoYXJyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHsKICB2YXIgaW5kZXhTaXplID0gMQogIHZhciBhcnJMZW5ndGggPSBhcnIubGVuZ3RoCiAgdmFyIHZhbExlbmd0aCA9IHZhbC5sZW5ndGgKCiAgaWYgKGVuY29kaW5nICE9PSB1bmRlZmluZWQpIHsKICAgIGVuY29kaW5nID0gU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpCiAgICBpZiAoZW5jb2RpbmcgPT09ICd1Y3MyJyB8fCBlbmNvZGluZyA9PT0gJ3Vjcy0yJyB8fAogICAgICAgIGVuY29kaW5nID09PSAndXRmMTZsZScgfHwgZW5jb2RpbmcgPT09ICd1dGYtMTZsZScpIHsKICAgICAgaWYgKGFyci5sZW5ndGggPCAyIHx8IHZhbC5sZW5ndGggPCAyKSB7CiAgICAgICAgcmV0dXJuIC0xCiAgICAgIH0KICAgICAgaW5kZXhTaXplID0gMgogICAgICBhcnJMZW5ndGggLz0gMgogICAgICB2YWxMZW5ndGggLz0gMgogICAgICBieXRlT2Zmc2V0IC89IDIKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlYWQgKGJ1ZiwgaSkgewogICAgaWYgKGluZGV4U2l6ZSA9PT0gMSkgewogICAgICByZXR1cm4gYnVmW2ldCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gYnVmLnJlYWRVSW50MTZCRShpICogaW5kZXhTaXplKQogICAgfQogIH0KCiAgdmFyIGkKICBpZiAoZGlyKSB7CiAgICB2YXIgZm91bmRJbmRleCA9IC0xCiAgICBmb3IgKGkgPSBieXRlT2Zmc2V0OyBpIDwgYXJyTGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHJlYWQoYXJyLCBpKSA9PT0gcmVhZCh2YWwsIGZvdW5kSW5kZXggPT09IC0xID8gMCA6IGkgLSBmb3VuZEluZGV4KSkgewogICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkgZm91bmRJbmRleCA9IGkKICAgICAgICBpZiAoaSAtIGZvdW5kSW5kZXggKyAxID09PSB2YWxMZW5ndGgpIHJldHVybiBmb3VuZEluZGV4ICogaW5kZXhTaXplCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGZvdW5kSW5kZXggIT09IC0xKSBpIC09IGkgLSBmb3VuZEluZGV4CiAgICAgICAgZm91bmRJbmRleCA9IC0xCiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgaWYgKGJ5dGVPZmZzZXQgKyB2YWxMZW5ndGggPiBhcnJMZW5ndGgpIGJ5dGVPZmZzZXQgPSBhcnJMZW5ndGggLSB2YWxMZW5ndGgKICAgIGZvciAoaSA9IGJ5dGVPZmZzZXQ7IGkgPj0gMDsgaS0tKSB7CiAgICAgIHZhciBmb3VuZCA9IHRydWUKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWxMZW5ndGg7IGorKykgewogICAgICAgIGlmIChyZWFkKGFyciwgaSArIGopICE9PSByZWFkKHZhbCwgaikpIHsKICAgICAgICAgIGZvdW5kID0gZmFsc2UKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChmb3VuZCkgcmV0dXJuIGkKICAgIH0KICB9CgogIHJldHVybiAtMQp9CgpCdWZmZXIucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24gaW5jbHVkZXMgKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHsKICByZXR1cm4gdGhpcy5pbmRleE9mKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpICE9PSAtMQp9CgpCdWZmZXIucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiBpbmRleE9mICh2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7CiAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIHRydWUpCn0KCkJ1ZmZlci5wcm90b3R5cGUubGFzdEluZGV4T2YgPSBmdW5jdGlvbiBsYXN0SW5kZXhPZiAodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgewogIHJldHVybiBiaWRpcmVjdGlvbmFsSW5kZXhPZih0aGlzLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBmYWxzZSkKfQoKZnVuY3Rpb24gaGV4V3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIG9mZnNldCA9IE51bWJlcihvZmZzZXQpIHx8IDAKICB2YXIgcmVtYWluaW5nID0gYnVmLmxlbmd0aCAtIG9mZnNldAogIGlmICghbGVuZ3RoKSB7CiAgICBsZW5ndGggPSByZW1haW5pbmcKICB9IGVsc2UgewogICAgbGVuZ3RoID0gTnVtYmVyKGxlbmd0aCkKICAgIGlmIChsZW5ndGggPiByZW1haW5pbmcpIHsKICAgICAgbGVuZ3RoID0gcmVtYWluaW5nCiAgICB9CiAgfQoKICAvLyBtdXN0IGJlIGFuIGV2ZW4gbnVtYmVyIG9mIGRpZ2l0cwogIHZhciBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoCiAgaWYgKHN0ckxlbiAlIDIgIT09IDApIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgaGV4IHN0cmluZycpCgogIGlmIChsZW5ndGggPiBzdHJMZW4gLyAyKSB7CiAgICBsZW5ndGggPSBzdHJMZW4gLyAyCiAgfQogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIHZhciBwYXJzZWQgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkgKiAyLCAyKSwgMTYpCiAgICBpZiAoaXNOYU4ocGFyc2VkKSkgcmV0dXJuIGkKICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHBhcnNlZAogIH0KICByZXR1cm4gaQp9CgpmdW5jdGlvbiB1dGY4V3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKHV0ZjhUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpCn0KCmZ1bmN0aW9uIGFzY2lpV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKGFzY2lpVG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiBsYXRpbjFXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGFzY2lpV3JpdGUoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiBiYXNlNjRXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7CiAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKQp9CgpmdW5jdGlvbiB1Y3MyV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogIHJldHVybiBibGl0QnVmZmVyKHV0ZjE2bGVUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZSAoc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCwgZW5jb2RpbmcpIHsKICAvLyBCdWZmZXIjd3JpdGUoc3RyaW5nKQogIGlmIChvZmZzZXQgPT09IHVuZGVmaW5lZCkgewogICAgZW5jb2RpbmcgPSAndXRmOCcKICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoCiAgICBvZmZzZXQgPSAwCiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgZW5jb2RpbmcpCiAgfSBlbHNlIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb2Zmc2V0ID09PSAnc3RyaW5nJykgewogICAgZW5jb2RpbmcgPSBvZmZzZXQKICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoCiAgICBvZmZzZXQgPSAwCiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgb2Zmc2V0WywgbGVuZ3RoXVssIGVuY29kaW5nXSkKICB9IGVsc2UgaWYgKGlzRmluaXRlKG9mZnNldCkpIHsKICAgIG9mZnNldCA9IG9mZnNldCB8IDAKICAgIGlmIChpc0Zpbml0ZShsZW5ndGgpKSB7CiAgICAgIGxlbmd0aCA9IGxlbmd0aCB8IDAKICAgICAgaWYgKGVuY29kaW5nID09PSB1bmRlZmluZWQpIGVuY29kaW5nID0gJ3V0ZjgnCiAgICB9IGVsc2UgewogICAgICBlbmNvZGluZyA9IGxlbmd0aAogICAgICBsZW5ndGggPSB1bmRlZmluZWQKICAgIH0KICAvLyBsZWdhY3kgd3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0LCBsZW5ndGgpIC0gcmVtb3ZlIGluIHYwLjEzCiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgJ0J1ZmZlci53cml0ZShzdHJpbmcsIGVuY29kaW5nLCBvZmZzZXRbLCBsZW5ndGhdKSBpcyBubyBsb25nZXIgc3VwcG9ydGVkJwogICAgKQogIH0KCiAgdmFyIHJlbWFpbmluZyA9IHRoaXMubGVuZ3RoIC0gb2Zmc2V0CiAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGxlbmd0aCA+IHJlbWFpbmluZykgbGVuZ3RoID0gcmVtYWluaW5nCgogIGlmICgoc3RyaW5nLmxlbmd0aCA+IDAgJiYgKGxlbmd0aCA8IDAgfHwgb2Zmc2V0IDwgMCkpIHx8IG9mZnNldCA+IHRoaXMubGVuZ3RoKSB7CiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMnKQogIH0KCiAgaWYgKCFlbmNvZGluZykgZW5jb2RpbmcgPSAndXRmOCcKCiAgdmFyIGxvd2VyZWRDYXNlID0gZmFsc2UKICBmb3IgKDs7KSB7CiAgICBzd2l0Y2ggKGVuY29kaW5nKSB7CiAgICAgIGNhc2UgJ2hleCc6CiAgICAgICAgcmV0dXJuIGhleFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpCgogICAgICBjYXNlICd1dGY4JzoKICAgICAgY2FzZSAndXRmLTgnOgogICAgICAgIHJldHVybiB1dGY4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ2FzY2lpJzoKICAgICAgICByZXR1cm4gYXNjaWlXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQoKICAgICAgY2FzZSAnbGF0aW4xJzoKICAgICAgY2FzZSAnYmluYXJ5JzoKICAgICAgICByZXR1cm4gbGF0aW4xV3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ2Jhc2U2NCc6CiAgICAgICAgLy8gV2FybmluZzogbWF4TGVuZ3RoIG5vdCB0YWtlbiBpbnRvIGFjY291bnQgaW4gYmFzZTY0V3JpdGUKICAgICAgICByZXR1cm4gYmFzZTY0V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkKCiAgICAgIGNhc2UgJ3VjczInOgogICAgICBjYXNlICd1Y3MtMic6CiAgICAgIGNhc2UgJ3V0ZjE2bGUnOgogICAgICBjYXNlICd1dGYtMTZsZSc6CiAgICAgICAgcmV0dXJuIHVjczJXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKQoKICAgICAgZGVmYXVsdDoKICAgICAgICBpZiAobG93ZXJlZENhc2UpIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZW5jb2Rpbmc6ICcgKyBlbmNvZGluZykKICAgICAgICBlbmNvZGluZyA9ICgnJyArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpCiAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlCiAgICB9CiAgfQp9CgpCdWZmZXIucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTiAoKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6ICdCdWZmZXInLAogICAgZGF0YTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5fYXJyIHx8IHRoaXMsIDApCiAgfQp9CgpmdW5jdGlvbiBiYXNlNjRTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkgewogICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1ZikKICB9IGVsc2UgewogICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1Zi5zbGljZShzdGFydCwgZW5kKSkKICB9Cn0KCmZ1bmN0aW9uIHV0ZjhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKQogIHZhciByZXMgPSBbXQoKICB2YXIgaSA9IHN0YXJ0CiAgd2hpbGUgKGkgPCBlbmQpIHsKICAgIHZhciBmaXJzdEJ5dGUgPSBidWZbaV0KICAgIHZhciBjb2RlUG9pbnQgPSBudWxsCiAgICB2YXIgYnl0ZXNQZXJTZXF1ZW5jZSA9IChmaXJzdEJ5dGUgPiAweEVGKSA/IDQKICAgICAgOiAoZmlyc3RCeXRlID4gMHhERikgPyAzCiAgICAgIDogKGZpcnN0Qnl0ZSA+IDB4QkYpID8gMgogICAgICA6IDEKCiAgICBpZiAoaSArIGJ5dGVzUGVyU2VxdWVuY2UgPD0gZW5kKSB7CiAgICAgIHZhciBzZWNvbmRCeXRlLCB0aGlyZEJ5dGUsIGZvdXJ0aEJ5dGUsIHRlbXBDb2RlUG9pbnQKCiAgICAgIHN3aXRjaCAoYnl0ZXNQZXJTZXF1ZW5jZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChmaXJzdEJ5dGUgPCAweDgwKSB7CiAgICAgICAgICAgIGNvZGVQb2ludCA9IGZpcnN0Qnl0ZQogICAgICAgICAgfQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODApIHsKICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweDFGKSA8PCAweDYgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpCiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHg3RikgewogICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXQogICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kgKyAyXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODAgJiYgKHRoaXJkQnl0ZSAmIDB4QzApID09PSAweDgwKSB7CiAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMHhGKSA8PCAweEMgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpIDw8IDB4NiB8ICh0aGlyZEJ5dGUgJiAweDNGKQogICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDB4N0ZGICYmICh0ZW1wQ29kZVBvaW50IDwgMHhEODAwIHx8IHRlbXBDb2RlUG9pbnQgPiAweERGRkYpKSB7CiAgICAgICAgICAgICAgY29kZVBvaW50ID0gdGVtcENvZGVQb2ludAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaSArIDFdCiAgICAgICAgICB0aGlyZEJ5dGUgPSBidWZbaSArIDJdCiAgICAgICAgICBmb3VydGhCeXRlID0gYnVmW2kgKyAzXQogICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMHhDMCkgPT09IDB4ODAgJiYgKHRoaXJkQnl0ZSAmIDB4QzApID09PSAweDgwICYmIChmb3VydGhCeXRlICYgMHhDMCkgPT09IDB4ODApIHsKICAgICAgICAgICAgdGVtcENvZGVQb2ludCA9IChmaXJzdEJ5dGUgJiAweEYpIDw8IDB4MTIgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpIDw8IDB4QyB8ICh0aGlyZEJ5dGUgJiAweDNGKSA8PCAweDYgfCAoZm91cnRoQnl0ZSAmIDB4M0YpCiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHhGRkZGICYmIHRlbXBDb2RlUG9pbnQgPCAweDExMDAwMCkgewogICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGNvZGVQb2ludCA9PT0gbnVsbCkgewogICAgICAvLyB3ZSBkaWQgbm90IGdlbmVyYXRlIGEgdmFsaWQgY29kZVBvaW50IHNvIGluc2VydCBhCiAgICAgIC8vIHJlcGxhY2VtZW50IGNoYXIgKFUrRkZGRCkgYW5kIGFkdmFuY2Ugb25seSAxIGJ5dGUKICAgICAgY29kZVBvaW50ID0gMHhGRkZECiAgICAgIGJ5dGVzUGVyU2VxdWVuY2UgPSAxCiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA+IDB4RkZGRikgewogICAgICAvLyBlbmNvZGUgdG8gdXRmMTYgKHN1cnJvZ2F0ZSBwYWlyIGRhbmNlKQogICAgICBjb2RlUG9pbnQgLT0gMHgxMDAwMAogICAgICByZXMucHVzaChjb2RlUG9pbnQgPj4+IDEwICYgMHgzRkYgfCAweEQ4MDApCiAgICAgIGNvZGVQb2ludCA9IDB4REMwMCB8IGNvZGVQb2ludCAmIDB4M0ZGCiAgICB9CgogICAgcmVzLnB1c2goY29kZVBvaW50KQogICAgaSArPSBieXRlc1BlclNlcXVlbmNlCiAgfQoKICByZXR1cm4gZGVjb2RlQ29kZVBvaW50c0FycmF5KHJlcykKfQoKLy8gQmFzZWQgb24gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjI3NDcyNzIvNjgwNzQyLCB0aGUgYnJvd3NlciB3aXRoCi8vIHRoZSBsb3dlc3QgbGltaXQgaXMgQ2hyb21lLCB3aXRoIDB4MTAwMDAgYXJncy4KLy8gV2UgZ28gMSBtYWduaXR1ZGUgbGVzcywgZm9yIHNhZmV0eQp2YXIgTUFYX0FSR1VNRU5UU19MRU5HVEggPSAweDEwMDAKCmZ1bmN0aW9uIGRlY29kZUNvZGVQb2ludHNBcnJheSAoY29kZVBvaW50cykgewogIHZhciBsZW4gPSBjb2RlUG9pbnRzLmxlbmd0aAogIGlmIChsZW4gPD0gTUFYX0FSR1VNRU5UU19MRU5HVEgpIHsKICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgY29kZVBvaW50cykgLy8gYXZvaWQgZXh0cmEgc2xpY2UoKQogIH0KCiAgLy8gRGVjb2RlIGluIGNodW5rcyB0byBhdm9pZCAiY2FsbCBzdGFjayBzaXplIGV4Y2VlZGVkIi4KICB2YXIgcmVzID0gJycKICB2YXIgaSA9IDAKICB3aGlsZSAoaSA8IGxlbikgewogICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoCiAgICAgIFN0cmluZywKICAgICAgY29kZVBvaW50cy5zbGljZShpLCBpICs9IE1BWF9BUkdVTUVOVFNfTEVOR1RIKQogICAgKQogIH0KICByZXR1cm4gcmVzCn0KCmZ1bmN0aW9uIGFzY2lpU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkgewogIHZhciByZXQgPSAnJwogIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCkKCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSAmIDB4N0YpCiAgfQogIHJldHVybiByZXQKfQoKZnVuY3Rpb24gbGF0aW4xU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkgewogIHZhciByZXQgPSAnJwogIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCkKCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSkKICB9CiAgcmV0dXJuIHJldAp9CgpmdW5jdGlvbiBoZXhTbGljZSAoYnVmLCBzdGFydCwgZW5kKSB7CiAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGgKCiAgaWYgKCFzdGFydCB8fCBzdGFydCA8IDApIHN0YXJ0ID0gMAogIGlmICghZW5kIHx8IGVuZCA8IDAgfHwgZW5kID4gbGVuKSBlbmQgPSBsZW4KCiAgdmFyIG91dCA9ICcnCiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgIG91dCArPSB0b0hleChidWZbaV0pCiAgfQogIHJldHVybiBvdXQKfQoKZnVuY3Rpb24gdXRmMTZsZVNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHsKICB2YXIgYnl0ZXMgPSBidWYuc2xpY2Uoc3RhcnQsIGVuZCkKICB2YXIgcmVzID0gJycKICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAyKSB7CiAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSArIGJ5dGVzW2kgKyAxXSAqIDI1NikKICB9CiAgcmV0dXJuIHJlcwp9CgpCdWZmZXIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gc2xpY2UgKHN0YXJ0LCBlbmQpIHsKICB2YXIgbGVuID0gdGhpcy5sZW5ndGgKICBzdGFydCA9IH5+c3RhcnQKICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbiA6IH5+ZW5kCgogIGlmIChzdGFydCA8IDApIHsKICAgIHN0YXJ0ICs9IGxlbgogICAgaWYgKHN0YXJ0IDwgMCkgc3RhcnQgPSAwCiAgfSBlbHNlIGlmIChzdGFydCA+IGxlbikgewogICAgc3RhcnQgPSBsZW4KICB9CgogIGlmIChlbmQgPCAwKSB7CiAgICBlbmQgKz0gbGVuCiAgICBpZiAoZW5kIDwgMCkgZW5kID0gMAogIH0gZWxzZSBpZiAoZW5kID4gbGVuKSB7CiAgICBlbmQgPSBsZW4KICB9CgogIGlmIChlbmQgPCBzdGFydCkgZW5kID0gc3RhcnQKCiAgdmFyIG5ld0J1ZgogIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgbmV3QnVmID0gdGhpcy5zdWJhcnJheShzdGFydCwgZW5kKQogICAgbmV3QnVmLl9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGUKICB9IGVsc2UgewogICAgdmFyIHNsaWNlTGVuID0gZW5kIC0gc3RhcnQKICAgIG5ld0J1ZiA9IG5ldyBCdWZmZXIoc2xpY2VMZW4sIHVuZGVmaW5lZCkKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2xpY2VMZW47ICsraSkgewogICAgICBuZXdCdWZbaV0gPSB0aGlzW2kgKyBzdGFydF0KICAgIH0KICB9CgogIHJldHVybiBuZXdCdWYKfQoKLyoKICogTmVlZCB0byBtYWtlIHN1cmUgdGhhdCBidWZmZXIgaXNuJ3QgdHJ5aW5nIHRvIHdyaXRlIG91dCBvZiBib3VuZHMuCiAqLwpmdW5jdGlvbiBjaGVja09mZnNldCAob2Zmc2V0LCBleHQsIGxlbmd0aCkgewogIGlmICgob2Zmc2V0ICUgMSkgIT09IDAgfHwgb2Zmc2V0IDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ29mZnNldCBpcyBub3QgdWludCcpCiAgaWYgKG9mZnNldCArIGV4dCA+IGxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RyeWluZyB0byBhY2Nlc3MgYmV5b25kIGJ1ZmZlciBsZW5ndGgnKQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50TEUgPSBmdW5jdGlvbiByZWFkVUludExFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpCgogIHZhciB2YWwgPSB0aGlzW29mZnNldF0KICB2YXIgbXVsID0gMQogIHZhciBpID0gMAogIHdoaWxlICgrK2kgPCBieXRlTGVuZ3RoICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bAogIH0KCiAgcmV0dXJuIHZhbAp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiByZWFkVUludEJFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpCiAgfQoKICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGhdCiAgdmFyIG11bCA9IDEKICB3aGlsZSAoYnl0ZUxlbmd0aCA+IDAgJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0tYnl0ZUxlbmd0aF0gKiBtdWwKICB9CgogIHJldHVybiB2YWwKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiByZWFkVUludDggKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKQogIHJldHVybiB0aGlzW29mZnNldF0KfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDE2TEUgPSBmdW5jdGlvbiByZWFkVUludDE2TEUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKQogIHJldHVybiB0aGlzW29mZnNldF0gfCAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpCiAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgOCkgfCB0aGlzW29mZnNldCArIDFdCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkxFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCkKCiAgcmV0dXJuICgodGhpc1tvZmZzZXRdKSB8CiAgICAgICh0aGlzW29mZnNldCArIDFdIDw8IDgpIHwKICAgICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgMTYpKSArCiAgICAgICh0aGlzW29mZnNldCArIDNdICogMHgxMDAwMDAwKQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCgogIHJldHVybiAodGhpc1tvZmZzZXRdICogMHgxMDAwMDAwKSArCiAgICAoKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYpIHwKICAgICh0aGlzW29mZnNldCArIDJdIDw8IDgpIHwKICAgIHRoaXNbb2Zmc2V0ICsgM10pCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludExFID0gZnVuY3Rpb24gcmVhZEludExFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpCgogIHZhciB2YWwgPSB0aGlzW29mZnNldF0KICB2YXIgbXVsID0gMQogIHZhciBpID0gMAogIHdoaWxlICgrK2kgPCBieXRlTGVuZ3RoICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bAogIH0KICBtdWwgKj0gMHg4MAoKICBpZiAodmFsID49IG11bCkgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKQoKICByZXR1cm4gdmFsCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludEJFID0gZnVuY3Rpb24gcmVhZEludEJFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpCgogIHZhciBpID0gYnl0ZUxlbmd0aAogIHZhciBtdWwgPSAxCiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0ICsgLS1pXQogIHdoaWxlIChpID4gMCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1pXSAqIG11bAogIH0KICBtdWwgKj0gMHg4MAoKICBpZiAodmFsID49IG11bCkgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKQoKICByZXR1cm4gdmFsCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiByZWFkSW50OCAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMSwgdGhpcy5sZW5ndGgpCiAgaWYgKCEodGhpc1tvZmZzZXRdICYgMHg4MCkpIHJldHVybiAodGhpc1tvZmZzZXRdKQogIHJldHVybiAoKDB4ZmYgLSB0aGlzW29mZnNldF0gKyAxKSAqIC0xKQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkxFID0gZnVuY3Rpb24gcmVhZEludDE2TEUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKQogIHZhciB2YWwgPSB0aGlzW29mZnNldF0gfCAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KQogIHJldHVybiAodmFsICYgMHg4MDAwKSA/IHZhbCB8IDB4RkZGRjAwMDAgOiB2YWwKfQoKQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRJbnQxNkJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aCkKICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAxXSB8ICh0aGlzW29mZnNldF0gPDwgOCkKICByZXR1cm4gKHZhbCAmIDB4ODAwMCkgPyB2YWwgfCAweEZGRkYwMDAwIDogdmFsCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiByZWFkSW50MzJMRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCgogIHJldHVybiAodGhpc1tvZmZzZXRdKSB8CiAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KSB8CiAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCAxNikgfAogICAgKHRoaXNbb2Zmc2V0ICsgM10gPDwgMjQpCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyQkUgPSBmdW5jdGlvbiByZWFkSW50MzJCRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCgogIHJldHVybiAodGhpc1tvZmZzZXRdIDw8IDI0KSB8CiAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCAxNikgfAogICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgOCkgfAogICAgKHRoaXNbb2Zmc2V0ICsgM10pCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiByZWFkRmxvYXRMRSAob2Zmc2V0LCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpCiAgcmV0dXJuIGllZWU3NTQucmVhZCh0aGlzLCBvZmZzZXQsIHRydWUsIDIzLCA0KQp9CgpCdWZmZXIucHJvdG90eXBlLnJlYWRGbG9hdEJFID0gZnVuY3Rpb24gcmVhZEZsb2F0QkUgKG9mZnNldCwgbm9Bc3NlcnQpIHsKICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKQogIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgMjMsIDQpCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gcmVhZERvdWJsZUxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aCkKICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgNTIsIDgpCn0KCkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUJFID0gZnVuY3Rpb24gcmVhZERvdWJsZUJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCA4LCB0aGlzLmxlbmd0aCkKICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgZmFsc2UsIDUyLCA4KQp9CgpmdW5jdGlvbiBjaGVja0ludCAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBleHQsIG1heCwgbWluKSB7CiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignImJ1ZmZlciIgYXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciBpbnN0YW5jZScpCiAgaWYgKHZhbHVlID4gbWF4IHx8IHZhbHVlIDwgbWluKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignInZhbHVlIiBhcmd1bWVudCBpcyBvdXQgb2YgYm91bmRzJykKICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50TEUgPSBmdW5jdGlvbiB3cml0ZVVJbnRMRSAodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHsKICB2YWx1ZSA9ICt2YWx1ZQogIG9mZnNldCA9IG9mZnNldCB8IDAKICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDAKICBpZiAoIW5vQXNzZXJ0KSB7CiAgICB2YXIgbWF4Qnl0ZXMgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCkgLSAxCiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMCkKICB9CgogIHZhciBtdWwgPSAxCiAgdmFyIGkgPSAwCiAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAweEZGCiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHsKICAgIHRoaXNbb2Zmc2V0ICsgaV0gPSAodmFsdWUgLyBtdWwpICYgMHhGRgogIH0KCiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnRCRSA9IGZ1bmN0aW9uIHdyaXRlVUludEJFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoIHwgMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIHZhciBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKSAtIDEKICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG1heEJ5dGVzLCAwKQogIH0KCiAgdmFyIGkgPSBieXRlTGVuZ3RoIC0gMQogIHZhciBtdWwgPSAxCiAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMHhGRgogIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgdGhpc1tvZmZzZXQgKyBpXSA9ICh2YWx1ZSAvIG11bCkgJiAweEZGCiAgfQoKICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aAp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDggPSBmdW5jdGlvbiB3cml0ZVVJbnQ4ICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDB4ZmYsIDApCiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlKQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgcmV0dXJuIG9mZnNldCArIDEKfQoKZnVuY3Rpb24gb2JqZWN0V3JpdGVVSW50MTYgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuKSB7CiAgaWYgKHZhbHVlIDwgMCkgdmFsdWUgPSAweGZmZmYgKyB2YWx1ZSArIDEKICBmb3IgKHZhciBpID0gMCwgaiA9IE1hdGgubWluKGJ1Zi5sZW5ndGggLSBvZmZzZXQsIDIpOyBpIDwgajsgKytpKSB7CiAgICBidWZbb2Zmc2V0ICsgaV0gPSAodmFsdWUgJiAoMHhmZiA8PCAoOCAqIChsaXR0bGVFbmRpYW4gPyBpIDogMSAtIGkpKSkpID4+PgogICAgICAobGl0dGxlRW5kaWFuID8gaSA6IDEgLSBpKSAqIDgKICB9Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MTZMRSA9IGZ1bmN0aW9uIHdyaXRlVUludDE2TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKQogIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZikKICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpCiAgfSBlbHNlIHsKICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpCiAgfQogIHJldHVybiBvZmZzZXQgKyAyCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MTZCRSA9IGZ1bmN0aW9uIHdyaXRlVUludDE2QkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHhmZmZmLCAwKQogIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiA4KQogICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSAmIDB4ZmYpCiAgfSBlbHNlIHsKICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlKQogIH0KICByZXR1cm4gb2Zmc2V0ICsgMgp9CgpmdW5jdGlvbiBvYmplY3RXcml0ZVVJbnQzMiAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHsKICBpZiAodmFsdWUgPCAwKSB2YWx1ZSA9IDB4ZmZmZmZmZmYgKyB2YWx1ZSArIDEKICBmb3IgKHZhciBpID0gMCwgaiA9IE1hdGgubWluKGJ1Zi5sZW5ndGggLSBvZmZzZXQsIDQpOyBpIDwgajsgKytpKSB7CiAgICBidWZbb2Zmc2V0ICsgaV0gPSAodmFsdWUgPj4+IChsaXR0bGVFbmRpYW4gPyBpIDogMyAtIGkpICogOCkgJiAweGZmCiAgfQp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlVUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApCiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlID4+PiAyNCkKICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDE2KQogICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCkKICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgfSBlbHNlIHsKICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpCiAgfQogIHJldHVybiBvZmZzZXQgKyA0Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlVUludDMyQkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHhmZmZmZmZmZiwgMCkKICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gMjQpCiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiAxNikKICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDgpCiAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlICYgMHhmZikKICB9IGVsc2UgewogICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UpCiAgfQogIHJldHVybiBvZmZzZXQgKyA0Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlSW50TEUgKHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgewogICAgdmFyIGxpbWl0ID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGggLSAxKQoKICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgsIGxpbWl0IC0gMSwgLWxpbWl0KQogIH0KCiAgdmFyIGkgPSAwCiAgdmFyIG11bCA9IDEKICB2YXIgc3ViID0gMAogIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMHhGRgogIHdoaWxlICgrK2kgPCBieXRlTGVuZ3RoICYmIChtdWwgKj0gMHgxMDApKSB7CiAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgLSAxXSAhPT0gMCkgewogICAgICBzdWIgPSAxCiAgICB9CiAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGCiAgfQoKICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aAp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlSW50QkUgPSBmdW5jdGlvbiB3cml0ZUludEJFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGlmICghbm9Bc3NlcnQpIHsKICAgIHZhciBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoIC0gMSkKCiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBsaW1pdCAtIDEsIC1saW1pdCkKICB9CgogIHZhciBpID0gYnl0ZUxlbmd0aCAtIDEKICB2YXIgbXVsID0gMQogIHZhciBzdWIgPSAwCiAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMHhGRgogIHdoaWxlICgtLWkgPj0gMCAmJiAobXVsICo9IDB4MTAwKSkgewogICAgaWYgKHZhbHVlIDwgMCAmJiBzdWIgPT09IDAgJiYgdGhpc1tvZmZzZXQgKyBpICsgMV0gIT09IDApIHsKICAgICAgc3ViID0gMQogICAgfQogICAgdGhpc1tvZmZzZXQgKyBpXSA9ICgodmFsdWUgLyBtdWwpID4+IDApIC0gc3ViICYgMHhGRgogIH0KCiAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDggPSBmdW5jdGlvbiB3cml0ZUludDggKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMSwgMHg3ZiwgLTB4ODApCiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlKQogIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZiArIHZhbHVlICsgMQogIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpCiAgcmV0dXJuIG9mZnNldCArIDEKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDE2TEUgPSBmdW5jdGlvbiB3cml0ZUludDE2TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHg3ZmZmLCAtMHg4MDAwKQogIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZikKICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpCiAgfSBlbHNlIHsKICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpCiAgfQogIHJldHVybiBvZmZzZXQgKyAyCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4N2ZmZiwgLTB4ODAwMCkKICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOCkKICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgJiAweGZmKQogIH0gZWxzZSB7CiAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSkKICB9CiAgcmV0dXJuIG9mZnNldCArIDIKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZUludDMyTEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgdmFsdWUgPSArdmFsdWUKICBvZmZzZXQgPSBvZmZzZXQgfCAwCiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHg3ZmZmZmZmZiwgLTB4ODAwMDAwMDApCiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7CiAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKQogICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gOCkKICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDE2KQogICAgdGhpc1tvZmZzZXQgKyAzXSA9ICh2YWx1ZSA+Pj4gMjQpCiAgfSBlbHNlIHsKICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpCiAgfQogIHJldHVybiBvZmZzZXQgKyA0Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVJbnQzMkJFID0gZnVuY3Rpb24gd3JpdGVJbnQzMkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHZhbHVlID0gK3ZhbHVlCiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMAogIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4N2ZmZmZmZmYsIC0weDgwMDAwMDAwKQogIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZmZmZmZmZiArIHZhbHVlICsgMQogIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgewogICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlID4+PiAyNCkKICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDE2KQogICAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gOCkKICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgJiAweGZmKQogIH0gZWxzZSB7CiAgICBvYmplY3RXcml0ZVVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSkKICB9CiAgcmV0dXJuIG9mZnNldCArIDQKfQoKZnVuY3Rpb24gY2hlY2tJRUVFNzU0IChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHsKICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpCiAgaWYgKG9mZnNldCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbmRleCBvdXQgb2YgcmFuZ2UnKQp9CgpmdW5jdGlvbiB3cml0ZUZsb2F0IChidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHsKICBpZiAoIW5vQXNzZXJ0KSB7CiAgICBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCA0LCAzLjQwMjgyMzQ2NjM4NTI4ODZlKzM4LCAtMy40MDI4MjM0NjYzODUyODg2ZSszOCkKICB9CiAgaWVlZTc1NC53cml0ZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgMjMsIDQpCiAgcmV0dXJuIG9mZnNldCArIDQKfQoKQnVmZmVyLnByb3RvdHlwZS53cml0ZUZsb2F0TEUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSwgbm9Bc3NlcnQpCn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdEJFID0gZnVuY3Rpb24gd3JpdGVGbG9hdEJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydCkKfQoKZnVuY3Rpb24gd3JpdGVEb3VibGUgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkgewogIGlmICghbm9Bc3NlcnQpIHsKICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDgsIDEuNzk3NjkzMTM0ODYyMzE1N0UrMzA4LCAtMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgpCiAgfQogIGllZWU3NTQud3JpdGUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIDUyLCA4KQogIHJldHVybiBvZmZzZXQgKyA4Cn0KCkJ1ZmZlci5wcm90b3R5cGUud3JpdGVEb3VibGVMRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlTEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KQp9CgpCdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogIHJldHVybiB3cml0ZURvdWJsZSh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSwgbm9Bc3NlcnQpCn0KCi8vIGNvcHkodGFyZ2V0QnVmZmVyLCB0YXJnZXRTdGFydD0wLCBzb3VyY2VTdGFydD0wLCBzb3VyY2VFbmQ9YnVmZmVyLmxlbmd0aCkKQnVmZmVyLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gY29weSAodGFyZ2V0LCB0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCkgewogIGlmICghc3RhcnQpIHN0YXJ0ID0gMAogIGlmICghZW5kICYmIGVuZCAhPT0gMCkgZW5kID0gdGhpcy5sZW5ndGgKICBpZiAodGFyZ2V0U3RhcnQgPj0gdGFyZ2V0Lmxlbmd0aCkgdGFyZ2V0U3RhcnQgPSB0YXJnZXQubGVuZ3RoCiAgaWYgKCF0YXJnZXRTdGFydCkgdGFyZ2V0U3RhcnQgPSAwCiAgaWYgKGVuZCA+IDAgJiYgZW5kIDwgc3RhcnQpIGVuZCA9IHN0YXJ0CgogIC8vIENvcHkgMCBieXRlczsgd2UncmUgZG9uZQogIGlmIChlbmQgPT09IHN0YXJ0KSByZXR1cm4gMAogIGlmICh0YXJnZXQubGVuZ3RoID09PSAwIHx8IHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm4gMAoKICAvLyBGYXRhbCBlcnJvciBjb25kaXRpb25zCiAgaWYgKHRhcmdldFN0YXJ0IDwgMCkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3RhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMnKQogIH0KICBpZiAoc3RhcnQgPCAwIHx8IHN0YXJ0ID49IHRoaXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignc291cmNlU3RhcnQgb3V0IG9mIGJvdW5kcycpCiAgaWYgKGVuZCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCdzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcycpCgogIC8vIEFyZSB3ZSBvb2I/CiAgaWYgKGVuZCA+IHRoaXMubGVuZ3RoKSBlbmQgPSB0aGlzLmxlbmd0aAogIGlmICh0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgPCBlbmQgLSBzdGFydCkgewogICAgZW5kID0gdGFyZ2V0Lmxlbmd0aCAtIHRhcmdldFN0YXJ0ICsgc3RhcnQKICB9CgogIHZhciBsZW4gPSBlbmQgLSBzdGFydAogIHZhciBpCgogIGlmICh0aGlzID09PSB0YXJnZXQgJiYgc3RhcnQgPCB0YXJnZXRTdGFydCAmJiB0YXJnZXRTdGFydCA8IGVuZCkgewogICAgLy8gZGVzY2VuZGluZyBjb3B5IGZyb20gZW5kCiAgICBmb3IgKGkgPSBsZW4gLSAxOyBpID49IDA7IC0taSkgewogICAgICB0YXJnZXRbaSArIHRhcmdldFN0YXJ0XSA9IHRoaXNbaSArIHN0YXJ0XQogICAgfQogIH0gZWxzZSBpZiAobGVuIDwgMTAwMCB8fCAhQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHsKICAgIC8vIGFzY2VuZGluZyBjb3B5IGZyb20gc3RhcnQKICAgIGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkgewogICAgICB0YXJnZXRbaSArIHRhcmdldFN0YXJ0XSA9IHRoaXNbaSArIHN0YXJ0XQogICAgfQogIH0gZWxzZSB7CiAgICBVaW50OEFycmF5LnByb3RvdHlwZS5zZXQuY2FsbCgKICAgICAgdGFyZ2V0LAogICAgICB0aGlzLnN1YmFycmF5KHN0YXJ0LCBzdGFydCArIGxlbiksCiAgICAgIHRhcmdldFN0YXJ0CiAgICApCiAgfQoKICByZXR1cm4gbGVuCn0KCi8vIFVzYWdlOgovLyAgICBidWZmZXIuZmlsbChudW1iZXJbLCBvZmZzZXRbLCBlbmRdXSkKLy8gICAgYnVmZmVyLmZpbGwoYnVmZmVyWywgb2Zmc2V0WywgZW5kXV0pCi8vICAgIGJ1ZmZlci5maWxsKHN0cmluZ1ssIG9mZnNldFssIGVuZF1dWywgZW5jb2RpbmddKQpCdWZmZXIucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiBmaWxsICh2YWwsIHN0YXJ0LCBlbmQsIGVuY29kaW5nKSB7CiAgLy8gSGFuZGxlIHN0cmluZyBjYXNlczoKICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgIGlmICh0eXBlb2Ygc3RhcnQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVuY29kaW5nID0gc3RhcnQKICAgICAgc3RhcnQgPSAwCiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbmQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVuY29kaW5nID0gZW5kCiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoCiAgICB9CiAgICBpZiAodmFsLmxlbmd0aCA9PT0gMSkgewogICAgICB2YXIgY29kZSA9IHZhbC5jaGFyQ29kZUF0KDApCiAgICAgIGlmIChjb2RlIDwgMjU2KSB7CiAgICAgICAgdmFsID0gY29kZQogICAgICB9CiAgICB9CiAgICBpZiAoZW5jb2RpbmcgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgZW5jb2RpbmcgIT09ICdzdHJpbmcnKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2VuY29kaW5nIG11c3QgYmUgYSBzdHJpbmcnKQogICAgfQogICAgaWYgKHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycgJiYgIUJ1ZmZlci5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpCiAgICB9CiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgewogICAgdmFsID0gdmFsICYgMjU1CiAgfQoKICAvLyBJbnZhbGlkIHJhbmdlcyBhcmUgbm90IHNldCB0byBhIGRlZmF1bHQsIHNvIGNhbiByYW5nZSBjaGVjayBlYXJseS4KICBpZiAoc3RhcnQgPCAwIHx8IHRoaXMubGVuZ3RoIDwgc3RhcnQgfHwgdGhpcy5sZW5ndGggPCBlbmQpIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdPdXQgb2YgcmFuZ2UgaW5kZXgnKQogIH0KCiAgaWYgKGVuZCA8PSBzdGFydCkgewogICAgcmV0dXJuIHRoaXMKICB9CgogIHN0YXJ0ID0gc3RhcnQgPj4+IDAKICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IHRoaXMubGVuZ3RoIDogZW5kID4+PiAwCgogIGlmICghdmFsKSB2YWwgPSAwCgogIHZhciBpCiAgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7CiAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgIHRoaXNbaV0gPSB2YWwKICAgIH0KICB9IGVsc2UgewogICAgdmFyIGJ5dGVzID0gQnVmZmVyLmlzQnVmZmVyKHZhbCkKICAgICAgPyB2YWwKICAgICAgOiB1dGY4VG9CeXRlcyhuZXcgQnVmZmVyKHZhbCwgZW5jb2RpbmcpLnRvU3RyaW5nKCkpCiAgICB2YXIgbGVuID0gYnl0ZXMubGVuZ3RoCiAgICBmb3IgKGkgPSAwOyBpIDwgZW5kIC0gc3RhcnQ7ICsraSkgewogICAgICB0aGlzW2kgKyBzdGFydF0gPSBieXRlc1tpICUgbGVuXQogICAgfQogIH0KCiAgcmV0dXJuIHRoaXMKfQoKLy8gSEVMUEVSIEZVTkNUSU9OUwovLyA9PT09PT09PT09PT09PT09Cgp2YXIgSU5WQUxJRF9CQVNFNjRfUkUgPSAvW14rXC8wLTlBLVphLXotX10vZwoKZnVuY3Rpb24gYmFzZTY0Y2xlYW4gKHN0cikgewogIC8vIE5vZGUgc3RyaXBzIG91dCBpbnZhbGlkIGNoYXJhY3RlcnMgbGlrZSBcbiBhbmQgXHQgZnJvbSB0aGUgc3RyaW5nLCBiYXNlNjQtanMgZG9lcyBub3QKICBzdHIgPSBzdHJpbmd0cmltKHN0cikucmVwbGFjZShJTlZBTElEX0JBU0U2NF9SRSwgJycpCiAgLy8gTm9kZSBjb252ZXJ0cyBzdHJpbmdzIHdpdGggbGVuZ3RoIDwgMiB0byAnJwogIGlmIChzdHIubGVuZ3RoIDwgMikgcmV0dXJuICcnCiAgLy8gTm9kZSBhbGxvd3MgZm9yIG5vbi1wYWRkZWQgYmFzZTY0IHN0cmluZ3MgKG1pc3NpbmcgdHJhaWxpbmcgPT09KSwgYmFzZTY0LWpzIGRvZXMgbm90CiAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7CiAgICBzdHIgPSBzdHIgKyAnPScKICB9CiAgcmV0dXJuIHN0cgp9CgpmdW5jdGlvbiBzdHJpbmd0cmltIChzdHIpIHsKICBpZiAoc3RyLnRyaW0pIHJldHVybiBzdHIudHJpbSgpCiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCn0KCmZ1bmN0aW9uIHRvSGV4IChuKSB7CiAgaWYgKG4gPCAxNikgcmV0dXJuICcwJyArIG4udG9TdHJpbmcoMTYpCiAgcmV0dXJuIG4udG9TdHJpbmcoMTYpCn0KCmZ1bmN0aW9uIHV0ZjhUb0J5dGVzIChzdHJpbmcsIHVuaXRzKSB7CiAgdW5pdHMgPSB1bml0cyB8fCBJbmZpbml0eQogIHZhciBjb2RlUG9pbnQKICB2YXIgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aAogIHZhciBsZWFkU3Vycm9nYXRlID0gbnVsbAogIHZhciBieXRlcyA9IFtdCgogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIGNvZGVQb2ludCA9IHN0cmluZy5jaGFyQ29kZUF0KGkpCgogICAgLy8gaXMgc3Vycm9nYXRlIGNvbXBvbmVudAogICAgaWYgKGNvZGVQb2ludCA+IDB4RDdGRiAmJiBjb2RlUG9pbnQgPCAweEUwMDApIHsKICAgICAgLy8gbGFzdCBjaGFyIHdhcyBhIGxlYWQKICAgICAgaWYgKCFsZWFkU3Vycm9nYXRlKSB7CiAgICAgICAgLy8gbm8gbGVhZCB5ZXQKICAgICAgICBpZiAoY29kZVBvaW50ID4gMHhEQkZGKSB7CiAgICAgICAgICAvLyB1bmV4cGVjdGVkIHRyYWlsCiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCkKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfSBlbHNlIGlmIChpICsgMSA9PT0gbGVuZ3RoKSB7CiAgICAgICAgICAvLyB1bnBhaXJlZCBsZWFkCiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCkKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICAvLyB2YWxpZCBsZWFkCiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludAoKICAgICAgICBjb250aW51ZQogICAgICB9CgogICAgICAvLyAyIGxlYWRzIGluIGEgcm93CiAgICAgIGlmIChjb2RlUG9pbnQgPCAweERDMDApIHsKICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRCkKICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50CiAgICAgICAgY29udGludWUKICAgICAgfQoKICAgICAgLy8gdmFsaWQgc3Vycm9nYXRlIHBhaXIKICAgICAgY29kZVBvaW50ID0gKGxlYWRTdXJyb2dhdGUgLSAweEQ4MDAgPDwgMTAgfCBjb2RlUG9pbnQgLSAweERDMDApICsgMHgxMDAwMAogICAgfSBlbHNlIGlmIChsZWFkU3Vycm9nYXRlKSB7CiAgICAgIC8vIHZhbGlkIGJtcCBjaGFyLCBidXQgbGFzdCBjaGFyIHdhcyBhIGxlYWQKICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpCiAgICB9CgogICAgbGVhZFN1cnJvZ2F0ZSA9IG51bGwKCiAgICAvLyBlbmNvZGUgdXRmOAogICAgaWYgKGNvZGVQb2ludCA8IDB4ODApIHsKICAgICAgaWYgKCh1bml0cyAtPSAxKSA8IDApIGJyZWFrCiAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KQogICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDgwMCkgewogICAgICBpZiAoKHVuaXRzIC09IDIpIDwgMCkgYnJlYWsKICAgICAgYnl0ZXMucHVzaCgKICAgICAgICBjb2RlUG9pbnQgPj4gMHg2IHwgMHhDMCwKICAgICAgICBjb2RlUG9pbnQgJiAweDNGIHwgMHg4MAogICAgICApCiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDB4MTAwMDApIHsKICAgICAgaWYgKCh1bml0cyAtPSAzKSA8IDApIGJyZWFrCiAgICAgIGJ5dGVzLnB1c2goCiAgICAgICAgY29kZVBvaW50ID4+IDB4QyB8IDB4RTAsCiAgICAgICAgY29kZVBvaW50ID4+IDB4NiAmIDB4M0YgfCAweDgwLAogICAgICAgIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwCiAgICAgICkKICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMHgxMTAwMDApIHsKICAgICAgaWYgKCh1bml0cyAtPSA0KSA8IDApIGJyZWFrCiAgICAgIGJ5dGVzLnB1c2goCiAgICAgICAgY29kZVBvaW50ID4+IDB4MTIgfCAweEYwLAogICAgICAgIGNvZGVQb2ludCA+PiAweEMgJiAweDNGIHwgMHg4MCwKICAgICAgICBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsCiAgICAgICAgY29kZVBvaW50ICYgMHgzRiB8IDB4ODAKICAgICAgKQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNvZGUgcG9pbnQnKQogICAgfQogIH0KCiAgcmV0dXJuIGJ5dGVzCn0KCmZ1bmN0aW9uIGFzY2lpVG9CeXRlcyAoc3RyKSB7CiAgdmFyIGJ5dGVBcnJheSA9IFtdCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyArK2kpIHsKICAgIC8vIE5vZGUncyBjb2RlIHNlZW1zIHRvIGJlIGRvaW5nIHRoaXMgYW5kIG5vdCAmIDB4N0YuLgogICAgYnl0ZUFycmF5LnB1c2goc3RyLmNoYXJDb2RlQXQoaSkgJiAweEZGKQogIH0KICByZXR1cm4gYnl0ZUFycmF5Cn0KCmZ1bmN0aW9uIHV0ZjE2bGVUb0J5dGVzIChzdHIsIHVuaXRzKSB7CiAgdmFyIGMsIGhpLCBsbwogIHZhciBieXRlQXJyYXkgPSBbXQogIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7CiAgICBpZiAoKHVuaXRzIC09IDIpIDwgMCkgYnJlYWsKCiAgICBjID0gc3RyLmNoYXJDb2RlQXQoaSkKICAgIGhpID0gYyA+PiA4CiAgICBsbyA9IGMgJSAyNTYKICAgIGJ5dGVBcnJheS5wdXNoKGxvKQogICAgYnl0ZUFycmF5LnB1c2goaGkpCiAgfQoKICByZXR1cm4gYnl0ZUFycmF5Cn0KCmZ1bmN0aW9uIGJhc2U2NFRvQnl0ZXMgKHN0cikgewogIHJldHVybiBiYXNlNjQudG9CeXRlQXJyYXkoYmFzZTY0Y2xlYW4oc3RyKSkKfQoKZnVuY3Rpb24gYmxpdEJ1ZmZlciAoc3JjLCBkc3QsIG9mZnNldCwgbGVuZ3RoKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgaWYgKChpICsgb2Zmc2V0ID49IGRzdC5sZW5ndGgpIHx8IChpID49IHNyYy5sZW5ndGgpKSBicmVhawogICAgZHN0W2kgKyBvZmZzZXRdID0gc3JjW2ldCiAgfQogIHJldHVybiBpCn0KCmZ1bmN0aW9uIGlzbmFuICh2YWwpIHsKICByZXR1cm4gdmFsICE9PSB2YWwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmUKfQoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCgp9LHsiYmFzZTY0LWpzIjozLCJpZWVlNzU0IjoxOCwiaXNhcnJheSI6OH1dLDg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKCm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoYXJyKSB7CiAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoYXJyKSA9PSAnW29iamVjdCBBcnJheV0nOwp9OwoKfSx7fV0sOTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8vIFBvbHlmaWxsIGZvciBjcmVhdGluZyBDdXN0b21FdmVudHMgb24gSUU5LzEwLzExCgovLyBjb2RlIHB1bGxlZCBmcm9tOgovLyBodHRwczovL2dpdGh1Yi5jb20vZDR0b2NjaGluaS9jdXN0b21ldmVudC1wb2x5ZmlsbAovLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3VzdG9tRXZlbnQjUG9seWZpbGwKCihmdW5jdGlvbigpIHsKICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybjsKICB9CgogIHRyeSB7CiAgICB2YXIgY2UgPSBuZXcgd2luZG93LkN1c3RvbUV2ZW50KCd0ZXN0JywgeyBjYW5jZWxhYmxlOiB0cnVlIH0pOwogICAgY2UucHJldmVudERlZmF1bHQoKTsKICAgIGlmIChjZS5kZWZhdWx0UHJldmVudGVkICE9PSB0cnVlKSB7CiAgICAgIC8vIElFIGhhcyBwcm9ibGVtcyB3aXRoIC5wcmV2ZW50RGVmYXVsdCgpIG9uIGN1c3RvbSBldmVudHMKICAgICAgLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMzM0OTE5MQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBwcmV2ZW50IGRlZmF1bHQnKTsKICAgIH0KICB9IGNhdGNoIChlKSB7CiAgICB2YXIgQ3VzdG9tRXZlbnQgPSBmdW5jdGlvbihldmVudCwgcGFyYW1zKSB7CiAgICAgIHZhciBldnQsIG9yaWdQcmV2ZW50OwogICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgewogICAgICAgIGJ1YmJsZXM6IGZhbHNlLAogICAgICAgIGNhbmNlbGFibGU6IGZhbHNlLAogICAgICAgIGRldGFpbDogdW5kZWZpbmVkCiAgICAgIH07CgogICAgICBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTsKICAgICAgZXZ0LmluaXRDdXN0b21FdmVudCgKICAgICAgICBldmVudCwKICAgICAgICBwYXJhbXMuYnViYmxlcywKICAgICAgICBwYXJhbXMuY2FuY2VsYWJsZSwKICAgICAgICBwYXJhbXMuZGV0YWlsCiAgICAgICk7CiAgICAgIG9yaWdQcmV2ZW50ID0gZXZ0LnByZXZlbnREZWZhdWx0OwogICAgICBldnQucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHsKICAgICAgICBvcmlnUHJldmVudC5jYWxsKHRoaXMpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2RlZmF1bHRQcmV2ZW50ZWQnLCB7CiAgICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9OwogICAgICByZXR1cm4gZXZ0OwogICAgfTsKCiAgICBDdXN0b21FdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlOwogICAgd2luZG93LkN1c3RvbUV2ZW50ID0gQ3VzdG9tRXZlbnQ7IC8vIGV4cG9zZSBkZWZpbml0aW9uIHRvIHdpbmRvdwogIH0KfSkoKTsKCn0se31dLDEwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKCi8qKgogKiBUaGlzIGlzIHRoZSB3ZWIgYnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBgZGVidWcoKWAuCiAqCiAqIEV4cG9zZSBgZGVidWcoKWAgYXMgdGhlIG1vZHVsZS4KICovCgpleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfZGVyZXFfKCcuL2RlYnVnJyk7CmV4cG9ydHMubG9nID0gbG9nOwpleHBvcnRzLmZvcm1hdEFyZ3MgPSBmb3JtYXRBcmdzOwpleHBvcnRzLnNhdmUgPSBzYXZlOwpleHBvcnRzLmxvYWQgPSBsb2FkOwpleHBvcnRzLnVzZUNvbG9ycyA9IHVzZUNvbG9yczsKZXhwb3J0cy5zdG9yYWdlID0gJ3VuZGVmaW5lZCcgIT0gdHlwZW9mIGNocm9tZQogICAgICAgICAgICAgICAmJiAndW5kZWZpbmVkJyAhPSB0eXBlb2YgY2hyb21lLnN0b3JhZ2UKICAgICAgICAgICAgICAgICAgPyBjaHJvbWUuc3RvcmFnZS5sb2NhbAogICAgICAgICAgICAgICAgICA6IGxvY2Fsc3RvcmFnZSgpOwoKLyoqCiAqIENvbG9ycy4KICovCgpleHBvcnRzLmNvbG9ycyA9IFsKICAnbGlnaHRzZWFncmVlbicsCiAgJ2ZvcmVzdGdyZWVuJywKICAnZ29sZGVucm9kJywKICAnZG9kZ2VyYmx1ZScsCiAgJ2RhcmtvcmNoaWQnLAogICdjcmltc29uJwpdOwoKLyoqCiAqIEN1cnJlbnRseSBvbmx5IFdlYktpdC1iYXNlZCBXZWIgSW5zcGVjdG9ycywgRmlyZWZveCA+PSB2MzEsCiAqIGFuZCB0aGUgRmlyZWJ1ZyBleHRlbnNpb24gKGFueSBGaXJlZm94IHZlcnNpb24pIGFyZSBrbm93bgogKiB0byBzdXBwb3J0ICIlYyIgQ1NTIGN1c3RvbWl6YXRpb25zLgogKgogKiBUT0RPOiBhZGQgYSBgbG9jYWxTdG9yYWdlYCB2YXJpYWJsZSB0byBleHBsaWNpdGx5IGVuYWJsZS9kaXNhYmxlIGNvbG9ycwogKi8KCmZ1bmN0aW9uIHVzZUNvbG9ycygpIHsKICAvLyBpcyB3ZWJraXQ/IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE2NDU5NjA2LzM3Njc3MwogIHJldHVybiAoJ1dlYmtpdEFwcGVhcmFuY2UnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZSkgfHwKICAgIC8vIGlzIGZpcmVidWc/IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM5ODEyMC8zNzY3NzMKICAgICh3aW5kb3cuY29uc29sZSAmJiAoY29uc29sZS5maXJlYnVnIHx8IChjb25zb2xlLmV4Y2VwdGlvbiAmJiBjb25zb2xlLnRhYmxlKSkpIHx8CiAgICAvLyBpcyBmaXJlZm94ID49IHYzMT8KICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvVG9vbHMvV2ViX0NvbnNvbGUjU3R5bGluZ19tZXNzYWdlcwogICAgKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5tYXRjaCgvZmlyZWZveFwvKFxkKykvKSAmJiBwYXJzZUludChSZWdFeHAuJDEsIDEwKSA+PSAzMSk7Cn0KCi8qKgogKiBNYXAgJWogdG8gYEpTT04uc3RyaW5naWZ5KClgLCBzaW5jZSBubyBXZWIgSW5zcGVjdG9ycyBkbyB0aGF0IGJ5IGRlZmF1bHQuCiAqLwoKZXhwb3J0cy5mb3JtYXR0ZXJzLmogPSBmdW5jdGlvbih2KSB7CiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHYpOwp9OwoKCi8qKgogKiBDb2xvcml6ZSBsb2cgYXJndW1lbnRzIGlmIGVuYWJsZWQuCiAqCiAqIEBhcGkgcHVibGljCiAqLwoKZnVuY3Rpb24gZm9ybWF0QXJncygpIHsKICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICB2YXIgdXNlQ29sb3JzID0gdGhpcy51c2VDb2xvcnM7CgogIGFyZ3NbMF0gPSAodXNlQ29sb3JzID8gJyVjJyA6ICcnKQogICAgKyB0aGlzLm5hbWVzcGFjZQogICAgKyAodXNlQ29sb3JzID8gJyAlYycgOiAnICcpCiAgICArIGFyZ3NbMF0KICAgICsgKHVzZUNvbG9ycyA/ICclYyAnIDogJyAnKTsKCiAgaWYgKCF1c2VDb2xvcnMpIHJldHVybiBhcmdzOwoKICB2YXIgYyA9ICdjb2xvcjogJyArIHRoaXMuY29sb3I7CiAgYXJncyA9IFthcmdzWzBdLCBjLCAnY29sb3I6IGluaGVyaXQnXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncywgMSkpOwoKICAvLyB0aGUgZmluYWwgIiVjIiBpcyBzb21ld2hhdCB0cmlja3ksIGJlY2F1c2UgdGhlcmUgY291bGQgYmUgb3RoZXIKICAvLyBhcmd1bWVudHMgcGFzc2VkIGVpdGhlciBiZWZvcmUgb3IgYWZ0ZXIgdGhlICVjLCBzbyB3ZSBuZWVkIHRvCiAgLy8gZmlndXJlIG91dCB0aGUgY29ycmVjdCBpbmRleCB0byBpbnNlcnQgdGhlIENTUyBpbnRvCiAgdmFyIGluZGV4ID0gMDsKICB2YXIgbGFzdEMgPSAwOwogIGFyZ3NbMF0ucmVwbGFjZSgvJVthLXolXS9nLCBmdW5jdGlvbihtYXRjaCkgewogICAgaWYgKCclJScgPT09IG1hdGNoKSByZXR1cm47CiAgICBpbmRleCsrOwogICAgaWYgKCclYycgPT09IG1hdGNoKSB7CiAgICAgIC8vIHdlIG9ubHkgYXJlIGludGVyZXN0ZWQgaW4gdGhlICpsYXN0KiAlYwogICAgICAvLyAodGhlIHVzZXIgbWF5IGhhdmUgcHJvdmlkZWQgdGhlaXIgb3duKQogICAgICBsYXN0QyA9IGluZGV4OwogICAgfQogIH0pOwoKICBhcmdzLnNwbGljZShsYXN0QywgMCwgYyk7CiAgcmV0dXJuIGFyZ3M7Cn0KCi8qKgogKiBJbnZva2VzIGBjb25zb2xlLmxvZygpYCB3aGVuIGF2YWlsYWJsZS4KICogTm8tb3Agd2hlbiBgY29uc29sZS5sb2dgIGlzIG5vdCBhICJmdW5jdGlvbiIuCiAqCiAqIEBhcGkgcHVibGljCiAqLwoKZnVuY3Rpb24gbG9nKCkgewogIC8vIHRoaXMgaGFja2VyeSBpcyByZXF1aXJlZCBmb3IgSUU4LzksIHdoZXJlCiAgLy8gdGhlIGBjb25zb2xlLmxvZ2AgZnVuY3Rpb24gZG9lc24ndCBoYXZlICdhcHBseScKICByZXR1cm4gJ29iamVjdCcgPT09IHR5cGVvZiBjb25zb2xlCiAgICAmJiBjb25zb2xlLmxvZwogICAgJiYgRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LmNhbGwoY29uc29sZS5sb2csIGNvbnNvbGUsIGFyZ3VtZW50cyk7Cn0KCi8qKgogKiBTYXZlIGBuYW1lc3BhY2VzYC4KICoKICogQHBhcmFtIHtTdHJpbmd9IG5hbWVzcGFjZXMKICogQGFwaSBwcml2YXRlCiAqLwoKZnVuY3Rpb24gc2F2ZShuYW1lc3BhY2VzKSB7CiAgdHJ5IHsKICAgIGlmIChudWxsID09IG5hbWVzcGFjZXMpIHsKICAgICAgZXhwb3J0cy5zdG9yYWdlLnJlbW92ZUl0ZW0oJ2RlYnVnJyk7CiAgICB9IGVsc2UgewogICAgICBleHBvcnRzLnN0b3JhZ2UuZGVidWcgPSBuYW1lc3BhY2VzOwogICAgfQogIH0gY2F0Y2goZSkge30KfQoKLyoqCiAqIExvYWQgYG5hbWVzcGFjZXNgLgogKgogKiBAcmV0dXJuIHtTdHJpbmd9IHJldHVybnMgdGhlIHByZXZpb3VzbHkgcGVyc2lzdGVkIGRlYnVnIG1vZGVzCiAqIEBhcGkgcHJpdmF0ZQogKi8KCmZ1bmN0aW9uIGxvYWQoKSB7CiAgdmFyIHI7CiAgdHJ5IHsKICAgIHIgPSBleHBvcnRzLnN0b3JhZ2UuZGVidWc7CiAgfSBjYXRjaChlKSB7fQogIHJldHVybiByOwp9CgovKioKICogRW5hYmxlIG5hbWVzcGFjZXMgbGlzdGVkIGluIGBsb2NhbFN0b3JhZ2UuZGVidWdgIGluaXRpYWxseS4KICovCgpleHBvcnRzLmVuYWJsZShsb2FkKCkpOwoKLyoqCiAqIExvY2Fsc3RvcmFnZSBhdHRlbXB0cyB0byByZXR1cm4gdGhlIGxvY2Fsc3RvcmFnZS4KICoKICogVGhpcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSBzYWZhcmkgdGhyb3dzCiAqIHdoZW4gYSB1c2VyIGRpc2FibGVzIGNvb2tpZXMvbG9jYWxzdG9yYWdlCiAqIGFuZCB5b3UgYXR0ZW1wdCB0byBhY2Nlc3MgaXQuCiAqCiAqIEByZXR1cm4ge0xvY2FsU3RvcmFnZX0KICogQGFwaSBwcml2YXRlCiAqLwoKZnVuY3Rpb24gbG9jYWxzdG9yYWdlKCl7CiAgdHJ5IHsKICAgIHJldHVybiB3aW5kb3cubG9jYWxTdG9yYWdlOwogIH0gY2F0Y2ggKGUpIHt9Cn0KCn0seyIuL2RlYnVnIjoxMX1dLDExOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKCi8qKgogKiBUaGlzIGlzIHRoZSBjb21tb24gbG9naWMgZm9yIGJvdGggdGhlIE5vZGUuanMgYW5kIHdlYiBicm93c2VyCiAqIGltcGxlbWVudGF0aW9ucyBvZiBgZGVidWcoKWAuCiAqCiAqIEV4cG9zZSBgZGVidWcoKWAgYXMgdGhlIG1vZHVsZS4KICovCgpleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBkZWJ1ZzsKZXhwb3J0cy5jb2VyY2UgPSBjb2VyY2U7CmV4cG9ydHMuZGlzYWJsZSA9IGRpc2FibGU7CmV4cG9ydHMuZW5hYmxlID0gZW5hYmxlOwpleHBvcnRzLmVuYWJsZWQgPSBlbmFibGVkOwoKLyoqCiAqIFRoZSBjdXJyZW50bHkgYWN0aXZlIGRlYnVnIG1vZGUgbmFtZXMsIGFuZCBuYW1lcyB0byBza2lwLgogKi8KCmV4cG9ydHMubmFtZXMgPSBbXTsKZXhwb3J0cy5za2lwcyA9IFtdOwoKLyoqCiAqIE1hcCBvZiBzcGVjaWFsICIlbiIgaGFuZGxpbmcgZnVuY3Rpb25zLCBmb3IgdGhlIGRlYnVnICJmb3JtYXQiIGFyZ3VtZW50LgogKgogKiBWYWxpZCBrZXkgbmFtZXMgYXJlIGEgc2luZ2xlLCBsb3dlcmNhc2VkIGxldHRlciwgaS5lLiAibiIuCiAqLwoKZXhwb3J0cy5mb3JtYXR0ZXJzID0ge307CgovKioKICogUHJldmlvdXNseSBhc3NpZ25lZCBjb2xvci4KICovCgp2YXIgcHJldkNvbG9yID0gMDsKCi8qKgogKiBTZWxlY3QgYSBjb2xvci4KICoKICogQHJldHVybiB7TnVtYmVyfQogKiBAYXBpIHByaXZhdGUKICovCgpmdW5jdGlvbiBzZWxlY3RDb2xvcigpIHsKICByZXR1cm4gZXhwb3J0cy5jb2xvcnNbcHJldkNvbG9yKysgJSBleHBvcnRzLmNvbG9ycy5sZW5ndGhdOwp9CgovKioKICogQ3JlYXRlIGEgZGVidWdnZXIgd2l0aCB0aGUgZ2l2ZW4gYG5hbWVzcGFjZWAuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lc3BhY2UKICogQHJldHVybiB7RnVuY3Rpb259CiAqIEBhcGkgcHVibGljCiAqLwoKZnVuY3Rpb24gZGVidWcobmFtZXNwYWNlKSB7CgogIC8vIGRlZmluZSB0aGUgYGRpc2FibGVkYCB2ZXJzaW9uCiAgZnVuY3Rpb24gZGlzYWJsZWQoKSB7CiAgfQogIGRpc2FibGVkLmVuYWJsZWQgPSBmYWxzZTsKCiAgLy8gZGVmaW5lIHRoZSBgZW5hYmxlZGAgdmVyc2lvbgogIGZ1bmN0aW9uIGVuYWJsZWQoKSB7CgogICAgdmFyIHNlbGYgPSBlbmFibGVkOwoKICAgIC8vIGFkZCB0aGUgYGNvbG9yYCBpZiBub3Qgc2V0CiAgICBpZiAobnVsbCA9PSBzZWxmLnVzZUNvbG9ycykgc2VsZi51c2VDb2xvcnMgPSBleHBvcnRzLnVzZUNvbG9ycygpOwogICAgaWYgKG51bGwgPT0gc2VsZi5jb2xvciAmJiBzZWxmLnVzZUNvbG9ycykgc2VsZi5jb2xvciA9IHNlbGVjdENvbG9yKCk7CgogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOwoKICAgIGFyZ3NbMF0gPSBleHBvcnRzLmNvZXJjZShhcmdzWzBdKTsKCiAgICBpZiAoJ3N0cmluZycgIT09IHR5cGVvZiBhcmdzWzBdKSB7CiAgICAgIC8vIGFueXRoaW5nIGVsc2UgbGV0J3MgaW5zcGVjdCB3aXRoICVvCiAgICAgIGFyZ3MgPSBbJyVvJ10uY29uY2F0KGFyZ3MpOwogICAgfQoKICAgIC8vIGFwcGx5IGFueSBgZm9ybWF0dGVyc2AgdHJhbnNmb3JtYXRpb25zCiAgICB2YXIgaW5kZXggPSAwOwogICAgYXJnc1swXSA9IGFyZ3NbMF0ucmVwbGFjZSgvJShbYS16JV0pL2csIGZ1bmN0aW9uKG1hdGNoLCBmb3JtYXQpIHsKICAgICAgLy8gaWYgd2UgZW5jb3VudGVyIGFuIGVzY2FwZWQgJSB0aGVuIGRvbid0IGluY3JlYXNlIHRoZSBhcnJheSBpbmRleAogICAgICBpZiAobWF0Y2ggPT09ICclJScpIHJldHVybiBtYXRjaDsKICAgICAgaW5kZXgrKzsKICAgICAgdmFyIGZvcm1hdHRlciA9IGV4cG9ydHMuZm9ybWF0dGVyc1tmb3JtYXRdOwogICAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIGZvcm1hdHRlcikgewogICAgICAgIHZhciB2YWwgPSBhcmdzW2luZGV4XTsKICAgICAgICBtYXRjaCA9IGZvcm1hdHRlci5jYWxsKHNlbGYsIHZhbCk7CgogICAgICAgIC8vIG5vdyB3ZSBuZWVkIHRvIHJlbW92ZSBgYXJnc1tpbmRleF1gIHNpbmNlIGl0J3MgaW5saW5lZCBpbiB0aGUgYGZvcm1hdGAKICAgICAgICBhcmdzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgaW5kZXgtLTsKICAgICAgfQogICAgICByZXR1cm4gbWF0Y2g7CiAgICB9KTsKCiAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIGV4cG9ydHMuZm9ybWF0QXJncykgewogICAgICBhcmdzID0gZXhwb3J0cy5mb3JtYXRBcmdzLmFwcGx5KHNlbGYsIGFyZ3MpOwogICAgfQogICAgdmFyIGxvZ0ZuID0gZW5hYmxlZC5sb2cgfHwgZXhwb3J0cy5sb2cgfHwgY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsKICAgIGxvZ0ZuLmFwcGx5KHNlbGYsIGFyZ3MpOwogIH0KICBlbmFibGVkLmVuYWJsZWQgPSB0cnVlOwoKICB2YXIgZm4gPSBleHBvcnRzLmVuYWJsZWQobmFtZXNwYWNlKSA/IGVuYWJsZWQgOiBkaXNhYmxlZDsKCiAgZm4ubmFtZXNwYWNlID0gbmFtZXNwYWNlOwoKICByZXR1cm4gZm47Cn0KCi8qKgogKiBFbmFibGVzIGEgZGVidWcgbW9kZSBieSBuYW1lc3BhY2VzLiBUaGlzIGNhbiBpbmNsdWRlIG1vZGVzCiAqIHNlcGFyYXRlZCBieSBhIGNvbG9uIGFuZCB3aWxkY2FyZHMuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lc3BhY2VzCiAqIEBhcGkgcHVibGljCiAqLwoKZnVuY3Rpb24gZW5hYmxlKG5hbWVzcGFjZXMpIHsKICBleHBvcnRzLnNhdmUobmFtZXNwYWNlcyk7CgogIHZhciBzcGxpdCA9IChuYW1lc3BhY2VzIHx8ICcnKS5zcGxpdCgvW1xzLF0rLyk7CiAgdmFyIGxlbiA9IHNwbGl0Lmxlbmd0aDsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgaWYgKCFzcGxpdFtpXSkgY29udGludWU7IC8vIGlnbm9yZSBlbXB0eSBzdHJpbmdzCiAgICBuYW1lc3BhY2VzID0gc3BsaXRbaV0ucmVwbGFjZSgvXCovZywgJy4qPycpOwogICAgaWYgKG5hbWVzcGFjZXNbMF0gPT09ICctJykgewogICAgICBleHBvcnRzLnNraXBzLnB1c2gobmV3IFJlZ0V4cCgnXicgKyBuYW1lc3BhY2VzLnN1YnN0cigxKSArICckJykpOwogICAgfSBlbHNlIHsKICAgICAgZXhwb3J0cy5uYW1lcy5wdXNoKG5ldyBSZWdFeHAoJ14nICsgbmFtZXNwYWNlcyArICckJykpOwogICAgfQogIH0KfQoKLyoqCiAqIERpc2FibGUgZGVidWcgb3V0cHV0LgogKgogKiBAYXBpIHB1YmxpYwogKi8KCmZ1bmN0aW9uIGRpc2FibGUoKSB7CiAgZXhwb3J0cy5lbmFibGUoJycpOwp9CgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBtb2RlIG5hbWUgaXMgZW5hYmxlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogKiBAcmV0dXJuIHtCb29sZWFufQogKiBAYXBpIHB1YmxpYwogKi8KCmZ1bmN0aW9uIGVuYWJsZWQobmFtZSkgewogIHZhciBpLCBsZW47CiAgZm9yIChpID0gMCwgbGVuID0gZXhwb3J0cy5za2lwcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgaWYgKGV4cG9ydHMuc2tpcHNbaV0udGVzdChuYW1lKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIGZvciAoaSA9IDAsIGxlbiA9IGV4cG9ydHMubmFtZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgIGlmIChleHBvcnRzLm5hbWVzW2ldLnRlc3QobmFtZSkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQogIHJldHVybiBmYWxzZTsKfQoKLyoqCiAqIENvZXJjZSBgdmFsYC4KICoKICogQHBhcmFtIHtNaXhlZH0gdmFsCiAqIEByZXR1cm4ge01peGVkfQogKiBAYXBpIHByaXZhdGUKICovCgpmdW5jdGlvbiBjb2VyY2UodmFsKSB7CiAgaWYgKHZhbCBpbnN0YW5jZW9mIEVycm9yKSByZXR1cm4gdmFsLnN0YWNrIHx8IHZhbC5tZXNzYWdlOwogIHJldHVybiB2YWw7Cn0KCn0se31dLDEyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgaXNPYmogPSBfZGVyZXFfKCdpcy1vYmonKTsKdmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIHByb3BJc0VudW1lcmFibGUgPSBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlOwoKZnVuY3Rpb24gdG9PYmplY3QodmFsKSB7CglpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkKSB7CgkJdGhyb3cgbmV3IFR5cGVFcnJvcignU291cmNlcyBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQnKTsKCX0KCglyZXR1cm4gT2JqZWN0KHZhbCk7Cn0KCmZ1bmN0aW9uIGFzc2lnbktleSh0bywgZnJvbSwga2V5KSB7Cgl2YXIgdmFsID0gZnJvbVtrZXldOwoKCWlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwpIHsKCQlyZXR1cm47Cgl9CgoJaWYgKGhhc093blByb3BlcnR5LmNhbGwodG8sIGtleSkpIHsKCQlpZiAodG9ba2V5XSA9PT0gdW5kZWZpbmVkIHx8IHRvW2tleV0gPT09IG51bGwpIHsKCQkJdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0ICgnICsga2V5ICsgJyknKTsKCQl9Cgl9CgoJaWYgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKHRvLCBrZXkpIHx8ICFpc09iaih2YWwpKSB7CgkJdG9ba2V5XSA9IHZhbDsKCX0gZWxzZSB7CgkJdG9ba2V5XSA9IGFzc2lnbihPYmplY3QodG9ba2V5XSksIGZyb21ba2V5XSk7Cgl9Cn0KCmZ1bmN0aW9uIGFzc2lnbih0bywgZnJvbSkgewoJaWYgKHRvID09PSBmcm9tKSB7CgkJcmV0dXJuIHRvOwoJfQoKCWZyb20gPSBPYmplY3QoZnJvbSk7CgoJZm9yICh2YXIga2V5IGluIGZyb20pIHsKCQlpZiAoaGFzT3duUHJvcGVydHkuY2FsbChmcm9tLCBrZXkpKSB7CgkJCWFzc2lnbktleSh0bywgZnJvbSwga2V5KTsKCQl9Cgl9CgoJaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKCQl2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykgewoJCQlpZiAocHJvcElzRW51bWVyYWJsZS5jYWxsKGZyb20sIHN5bWJvbHNbaV0pKSB7CgkJCQlhc3NpZ25LZXkodG8sIGZyb20sIHN5bWJvbHNbaV0pOwoJCQl9CgkJfQoJfQoKCXJldHVybiB0bzsKfQoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkZWVwQXNzaWduKHRhcmdldCkgewoJdGFyZ2V0ID0gdG9PYmplY3QodGFyZ2V0KTsKCglmb3IgKHZhciBzID0gMTsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKykgewoJCWFzc2lnbih0YXJnZXQsIGFyZ3VtZW50c1tzXSk7Cgl9CgoJcmV0dXJuIHRhcmdldDsKfTsKCn0seyJpcy1vYmoiOjIzfV0sMTM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiEgKEMpIFdlYlJlZmxlY3Rpb24gTWl0IFN0eWxlIExpY2Vuc2UgKi8KKGZ1bmN0aW9uKHQsbixyLGkpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBzdChlLHQpe2Zvcih2YXIgbj0wLHI9ZS5sZW5ndGg7bjxyO24rKylndChlW25dLHQpfWZ1bmN0aW9uIG90KGUpe2Zvcih2YXIgdD0wLG49ZS5sZW5ndGgscjt0PG47dCsrKXI9ZVt0XSxpdChyLHdbYXQocildKX1mdW5jdGlvbiB1dChlKXtyZXR1cm4gZnVuY3Rpb24odCl7Rih0KSYmKGd0KHQsZSksc3QodC5xdWVyeVNlbGVjdG9yQWxsKEUpLGUpKX19ZnVuY3Rpb24gYXQoZSl7dmFyIHQ9Ui5jYWxsKGUsImlzIiksbj1lLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkscj14LmNhbGwoYix0P20rdC50b1VwcGVyQ2FzZSgpOnYrbik7cmV0dXJuIHQmJi0xPHImJiFmdChuLHQpPy0xOnJ9ZnVuY3Rpb24gZnQoZSx0KXtyZXR1cm4tMTxFLmluZGV4T2YoZSsnW2lzPSInK3QrJyJdJyl9ZnVuY3Rpb24gbHQoZSl7dmFyIHQ9ZS5jdXJyZW50VGFyZ2V0LG49ZS5hdHRyQ2hhbmdlLHI9ZS5hdHRyTmFtZSxpPWUudGFyZ2V0O1kmJighaXx8aT09PXQpJiZ0LmF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayYmciE9PSJzdHlsZSImJmUucHJldlZhbHVlIT09ZS5uZXdWYWx1ZSYmdC5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2socixuPT09ZVtmXT9udWxsOmUucHJldlZhbHVlLG49PT1lW2NdP251bGw6ZS5uZXdWYWx1ZSl9ZnVuY3Rpb24gY3QoZSl7dmFyIHQ9dXQoZSk7cmV0dXJuIGZ1bmN0aW9uKGUpeyQucHVzaCh0LGUudGFyZ2V0KX19ZnVuY3Rpb24gaHQoZSl7RyYmKEc9ITEsZS5jdXJyZW50VGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIocCxodCkpLHN0KChlLnRhcmdldHx8bikucXVlcnlTZWxlY3RvckFsbChFKSxlLmRldGFpbD09PXU/dTpvKSxqJiZ2dCgpfWZ1bmN0aW9uIHB0KGUsdCl7dmFyIG49dGhpcztVLmNhbGwobixlLHQpLFouY2FsbChuLHt0YXJnZXQ6bn0pfWZ1bmN0aW9uIGR0KGUsdCl7UChlLHQpLG50P250Lm9ic2VydmUoZSxYKTooUSYmKGUuc2V0QXR0cmlidXRlPXB0LGVbc109dHQoZSksZS5hZGRFdmVudExpc3RlbmVyKGQsWikpLGUuYWRkRXZlbnRMaXN0ZW5lcihoLGx0KSksZS5jcmVhdGVkQ2FsbGJhY2smJlkmJihlLmNyZWF0ZWQ9ITAsZS5jcmVhdGVkQ2FsbGJhY2soKSxlLmNyZWF0ZWQ9ITEpfWZ1bmN0aW9uIHZ0KCl7Zm9yKHZhciBlLHQ9MCxuPUkubGVuZ3RoO3Q8bjt0KyspZT1JW3RdLFMuY29udGFpbnMoZSl8fChuLS0sSS5zcGxpY2UodC0tLDEpLGd0KGUsdSkpfWZ1bmN0aW9uIG10KGUpe3Rocm93IG5ldyBFcnJvcigiQSAiK2UrIiB0eXBlIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCIpfWZ1bmN0aW9uIGd0KGUsdCl7dmFyIG4scj1hdChlKTstMTxyJiYocnQoZSx3W3JdKSxyPTAsdD09PW8mJiFlW29dPyhlW3VdPSExLGVbb109ITAscj0xLGomJnguY2FsbChJLGUpPDAmJkkucHVzaChlKSk6dD09PXUmJiFlW3VdJiYoZVtvXT0hMSxlW3VdPSEwLHI9MSksciYmKG49ZVt0KyJDYWxsYmFjayJdKSYmbi5jYWxsKGUpKX1pZihpIGluIG4pcmV0dXJuO3ZhciBzPSJfXyIraSsoTWF0aC5yYW5kb20oKSoxZTU+PjApLG89ImF0dGFjaGVkIix1PSJkZXRhY2hlZCIsYT0iZXh0ZW5kcyIsZj0iQURESVRJT04iLGw9Ik1PRElGSUNBVElPTiIsYz0iUkVNT1ZBTCIsaD0iRE9NQXR0ck1vZGlmaWVkIixwPSJET01Db250ZW50TG9hZGVkIixkPSJET01TdWJ0cmVlTW9kaWZpZWQiLHY9IjwiLG09Ij0iLGc9L15bQS1aXVtBLVowLTldKig/Oi1bQS1aMC05XSspKyQvLHk9WyJBTk5PVEFUSU9OLVhNTCIsIkNPTE9SLVBST0ZJTEUiLCJGT05ULUZBQ0UiLCJGT05ULUZBQ0UtU1JDIiwiRk9OVC1GQUNFLVVSSSIsIkZPTlQtRkFDRS1GT1JNQVQiLCJGT05ULUZBQ0UtTkFNRSIsIk1JU1NJTkctR0xZUEgiXSxiPVtdLHc9W10sRT0iIixTPW4uZG9jdW1lbnRFbGVtZW50LHg9Yi5pbmRleE9mfHxmdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy5sZW5ndGg7dC0tJiZ0aGlzW3RdIT09ZTspO3JldHVybiB0fSxUPXIucHJvdG90eXBlLE49VC5oYXNPd25Qcm9wZXJ0eSxDPVQuaXNQcm90b3R5cGVPZixrPXIuZGVmaW5lUHJvcGVydHksTD1yLmdldE93blByb3BlcnR5RGVzY3JpcHRvcixBPXIuZ2V0T3duUHJvcGVydHlOYW1lcyxPPXIuZ2V0UHJvdG90eXBlT2YsTT1yLnNldFByb3RvdHlwZU9mLF89ISFyLl9fcHJvdG9fXyxEPXIuY3JlYXRlfHxmdW5jdGlvbiB5dChlKXtyZXR1cm4gZT8oeXQucHJvdG90eXBlPWUsbmV3IHl0KTp0aGlzfSxQPU18fChfP2Z1bmN0aW9uKGUsdCl7cmV0dXJuIGUuX19wcm90b19fPXQsZX06QSYmTD9mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXtmb3IodmFyIG4scj1BKHQpLGk9MCxzPXIubGVuZ3RoO2k8cztpKyspbj1yW2ldLE4uY2FsbChlLG4pfHxrKGUsbixMKHQsbikpfXJldHVybiBmdW5jdGlvbih0LG4pe2RvIGUodCxuKTt3aGlsZSgobj1PKG4pKSYmIUMuY2FsbChuLHQpKTtyZXR1cm4gdH19KCk6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG4gaW4gdCllW25dPXRbbl07cmV0dXJuIGV9KSxIPXQuTXV0YXRpb25PYnNlcnZlcnx8dC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLEI9KHQuSFRNTEVsZW1lbnR8fHQuRWxlbWVudHx8dC5Ob2RlKS5wcm90b3R5cGUsaj0hQy5jYWxsKEIsUyksRj1qP2Z1bmN0aW9uKGUpe3JldHVybiBlLm5vZGVUeXBlPT09MX06ZnVuY3Rpb24oZSl7cmV0dXJuIEMuY2FsbChCLGUpfSxJPWomJltdLHE9Qi5jbG9uZU5vZGUsUj1CLmdldEF0dHJpYnV0ZSxVPUIuc2V0QXR0cmlidXRlLHo9Qi5yZW1vdmVBdHRyaWJ1dGUsVz1uLmNyZWF0ZUVsZW1lbnQsWD1IJiZ7YXR0cmlidXRlczohMCxjaGFyYWN0ZXJEYXRhOiEwLGF0dHJpYnV0ZU9sZFZhbHVlOiEwfSxWPUh8fGZ1bmN0aW9uKGUpe1E9ITEsUy5yZW1vdmVFdmVudExpc3RlbmVyKGgsVil9LCQsSj10LnJlcXVlc3RBbmltYXRpb25GcmFtZXx8dC53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWV8fHQubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lfHx0Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lfHxmdW5jdGlvbihlKXtzZXRUaW1lb3V0KGUsMTApfSxLPSExLFE9ITAsRz0hMCxZPSEwLFosZXQsdHQsbnQscnQsaXQ7TXx8Xz8ocnQ9ZnVuY3Rpb24oZSx0KXtDLmNhbGwodCxlKXx8ZHQoZSx0KX0saXQ9ZHQpOihydD1mdW5jdGlvbihlLHQpe2Vbc118fChlW3NdPXIoITApLGR0KGUsdCkpfSxpdD1ydCksaj8oUT0hMSxmdW5jdGlvbigpe3ZhciB0PUwoQiwiYWRkRXZlbnRMaXN0ZW5lciIpLG49dC52YWx1ZSxyPWZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBDdXN0b21FdmVudChoLHtidWJibGVzOiEwfSk7dC5hdHRyTmFtZT1lLHQucHJldlZhbHVlPVIuY2FsbCh0aGlzLGUpLHQubmV3VmFsdWU9bnVsbCx0W2NdPXQuYXR0ckNoYW5nZT0yLHouY2FsbCh0aGlzLGUpLHRoaXMuZGlzcGF0Y2hFdmVudCh0KX0saT1mdW5jdGlvbih0LG4pe3ZhciByPXRoaXMuaGFzQXR0cmlidXRlKHQpLGk9ciYmUi5jYWxsKHRoaXMsdCk7ZT1uZXcgQ3VzdG9tRXZlbnQoaCx7YnViYmxlczohMH0pLFUuY2FsbCh0aGlzLHQsbiksZS5hdHRyTmFtZT10LGUucHJldlZhbHVlPXI/aTpudWxsLGUubmV3VmFsdWU9bixyP2VbbF09ZS5hdHRyQ2hhbmdlPTE6ZVtmXT1lLmF0dHJDaGFuZ2U9MCx0aGlzLmRpc3BhdGNoRXZlbnQoZSl9LG89ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jdXJyZW50VGFyZ2V0LG49dFtzXSxyPWUucHJvcGVydHlOYW1lLGk7bi5oYXNPd25Qcm9wZXJ0eShyKSYmKG49bltyXSxpPW5ldyBDdXN0b21FdmVudChoLHtidWJibGVzOiEwfSksaS5hdHRyTmFtZT1uLm5hbWUsaS5wcmV2VmFsdWU9bi52YWx1ZXx8bnVsbCxpLm5ld1ZhbHVlPW4udmFsdWU9dFtyXXx8bnVsbCxpLnByZXZWYWx1ZT09bnVsbD9pW2ZdPWkuYXR0ckNoYW5nZT0wOmlbbF09aS5hdHRyQ2hhbmdlPTEsdC5kaXNwYXRjaEV2ZW50KGkpKX07dC52YWx1ZT1mdW5jdGlvbihlLHQsdSl7ZT09PWgmJnRoaXMuYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrJiZ0aGlzLnNldEF0dHJpYnV0ZSE9PWkmJih0aGlzW3NdPXtjbGFzc05hbWU6e25hbWU6ImNsYXNzIix2YWx1ZTp0aGlzLmNsYXNzTmFtZX19LHRoaXMuc2V0QXR0cmlidXRlPWksdGhpcy5yZW1vdmVBdHRyaWJ1dGU9cixuLmNhbGwodGhpcywicHJvcGVydHljaGFuZ2UiLG8pKSxuLmNhbGwodGhpcyxlLHQsdSl9LGsoQiwiYWRkRXZlbnRMaXN0ZW5lciIsdCl9KCkpOkh8fChTLmFkZEV2ZW50TGlzdGVuZXIoaCxWKSxTLnNldEF0dHJpYnV0ZShzLDEpLFMucmVtb3ZlQXR0cmlidXRlKHMpLFEmJihaPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbixyLGk7aWYodD09PWUudGFyZ2V0KXtuPXRbc10sdFtzXT1yPXR0KHQpO2ZvcihpIGluIHIpe2lmKCEoaSBpbiBuKSlyZXR1cm4gZXQoMCx0LGksbltpXSxyW2ldLGYpO2lmKHJbaV0hPT1uW2ldKXJldHVybiBldCgxLHQsaSxuW2ldLHJbaV0sbCl9Zm9yKGkgaW4gbilpZighKGkgaW4gcikpcmV0dXJuIGV0KDIsdCxpLG5baV0scltpXSxjKX19LGV0PWZ1bmN0aW9uKGUsdCxuLHIsaSxzKXt2YXIgbz17YXR0ckNoYW5nZTplLGN1cnJlbnRUYXJnZXQ6dCxhdHRyTmFtZTpuLHByZXZWYWx1ZTpyLG5ld1ZhbHVlOml9O29bc109ZSxsdChvKX0sdHQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG4scj17fSxpPWUuYXR0cmlidXRlcyxzPTAsbz1pLmxlbmd0aDtzPG87cysrKXQ9aVtzXSxuPXQubmFtZSxuIT09InNldEF0dHJpYnV0ZSImJihyW25dPXQudmFsdWUpO3JldHVybiByfSkpLG5baV09ZnVuY3Rpb24odCxyKXtjPXQudG9VcHBlckNhc2UoKSxLfHwoSz0hMCxIPyhudD1mdW5jdGlvbihlLHQpe2Z1bmN0aW9uIG4oZSx0KXtmb3IodmFyIG49MCxyPWUubGVuZ3RoO248cjt0KGVbbisrXSkpO31yZXR1cm4gbmV3IEgoZnVuY3Rpb24ocil7Zm9yKHZhciBpLHMsbyx1PTAsYT1yLmxlbmd0aDt1PGE7dSsrKWk9clt1XSxpLnR5cGU9PT0iY2hpbGRMaXN0Ij8obihpLmFkZGVkTm9kZXMsZSksbihpLnJlbW92ZWROb2Rlcyx0KSk6KHM9aS50YXJnZXQsWSYmcy5hdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2smJmkuYXR0cmlidXRlTmFtZSE9PSJzdHlsZSImJihvPVIuY2FsbChzLGkuYXR0cmlidXRlTmFtZSksbyE9PWkub2xkVmFsdWUmJnMuYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKGkuYXR0cmlidXRlTmFtZSxpLm9sZFZhbHVlLG8pKSl9KX0odXQobyksdXQodSkpLG50Lm9ic2VydmUobix7Y2hpbGRMaXN0OiEwLHN1YnRyZWU6ITB9KSk6KCQ9W10sSihmdW5jdGlvbiBkKCl7d2hpbGUoJC5sZW5ndGgpJC5zaGlmdCgpLmNhbGwobnVsbCwkLnNoaWZ0KCkpO0ooZCl9KSxuLmFkZEV2ZW50TGlzdGVuZXIoIkRPTU5vZGVJbnNlcnRlZCIsY3QobykpLG4uYWRkRXZlbnRMaXN0ZW5lcigiRE9NTm9kZVJlbW92ZWQiLGN0KHUpKSksbi5hZGRFdmVudExpc3RlbmVyKHAsaHQpLG4uYWRkRXZlbnRMaXN0ZW5lcigicmVhZHlzdGF0ZWNoYW5nZSIsaHQpLG4uY3JlYXRlRWxlbWVudD1mdW5jdGlvbihlLHQpe3ZhciByPVcuYXBwbHkobixhcmd1bWVudHMpLGk9IiIrZSxzPXguY2FsbChiLCh0P206dikrKHR8fGkpLnRvVXBwZXJDYXNlKCkpLG89LTE8cztyZXR1cm4gdCYmKHIuc2V0QXR0cmlidXRlKCJpcyIsdD10LnRvTG93ZXJDYXNlKCkpLG8mJihvPWZ0KGkudG9VcHBlckNhc2UoKSx0KSkpLFk9IW4uY3JlYXRlRWxlbWVudC5pbm5lckhUTUxIZWxwZXIsbyYmaXQocix3W3NdKSxyfSxCLmNsb25lTm9kZT1mdW5jdGlvbihlKXt2YXIgdD1xLmNhbGwodGhpcywhIWUpLG49YXQodCk7cmV0dXJuLTE8biYmaXQodCx3W25dKSxlJiZvdCh0LnF1ZXJ5U2VsZWN0b3JBbGwoRSkpLHR9KSwtMjx4LmNhbGwoYixtK2MpK3guY2FsbChiLHYrYykmJm10KHQpO2lmKCFnLnRlc3QoYyl8fC0xPHguY2FsbCh5LGMpKXRocm93IG5ldyBFcnJvcigiVGhlIHR5cGUgIit0KyIgaXMgaW52YWxpZCIpO3ZhciBpPWZ1bmN0aW9uKCl7cmV0dXJuIGY/bi5jcmVhdGVFbGVtZW50KGwsYyk6bi5jcmVhdGVFbGVtZW50KGwpfSxzPXJ8fFQsZj1OLmNhbGwocyxhKSxsPWY/clthXS50b1VwcGVyQ2FzZSgpOmMsYyxoO3JldHVybiBmJiYtMTx4LmNhbGwoYix2K2wpJiZtdChsKSxoPWIucHVzaCgoZj9tOnYpK2MpLTEsRT1FLmNvbmNhdChFLmxlbmd0aD8iLCI6IiIsZj9sKydbaXM9IicrdC50b0xvd2VyQ2FzZSgpKyciXSc6bCksaS5wcm90b3R5cGU9d1toXT1OLmNhbGwocywicHJvdG90eXBlIik/cy5wcm90b3R5cGU6RChCKSxzdChuLnF1ZXJ5U2VsZWN0b3JBbGwoRSksbyksaX19KSh3aW5kb3csZG9jdW1lbnQsT2JqZWN0LCJyZWdpc3RlckVsZW1lbnQiKTsKfSx7fV0sMTQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGR0eXBlKSB7CiAgc3dpdGNoIChkdHlwZSkgewogICAgY2FzZSAnaW50OCc6CiAgICAgIHJldHVybiBJbnQ4QXJyYXkKICAgIGNhc2UgJ2ludDE2JzoKICAgICAgcmV0dXJuIEludDE2QXJyYXkKICAgIGNhc2UgJ2ludDMyJzoKICAgICAgcmV0dXJuIEludDMyQXJyYXkKICAgIGNhc2UgJ3VpbnQ4JzoKICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkKICAgIGNhc2UgJ3VpbnQxNic6CiAgICAgIHJldHVybiBVaW50MTZBcnJheQogICAgY2FzZSAndWludDMyJzoKICAgICAgcmV0dXJuIFVpbnQzMkFycmF5CiAgICBjYXNlICdmbG9hdDMyJzoKICAgICAgcmV0dXJuIEZsb2F0MzJBcnJheQogICAgY2FzZSAnZmxvYXQ2NCc6CiAgICAgIHJldHVybiBGbG9hdDY0QXJyYXkKICAgIGNhc2UgJ2FycmF5JzoKICAgICAgcmV0dXJuIEFycmF5CiAgICBjYXNlICd1aW50OF9jbGFtcGVkJzoKICAgICAgcmV0dXJuIFVpbnQ4Q2xhbXBlZEFycmF5CiAgfQp9Cgp9LHt9XSwxNTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qZXNsaW50IG5ldy1jYXA6MCovCnZhciBkdHlwZSA9IF9kZXJlcV8oJ2R0eXBlJykKCm1vZHVsZS5leHBvcnRzID0gZmxhdHRlblZlcnRleERhdGEKCmZ1bmN0aW9uIGZsYXR0ZW5WZXJ0ZXhEYXRhIChkYXRhLCBvdXRwdXQsIG9mZnNldCkgewogIGlmICghZGF0YSkgdGhyb3cgbmV3IFR5cGVFcnJvcignbXVzdCBzcGVjaWZ5IGRhdGEgYXMgZmlyc3QgcGFyYW1ldGVyJykKICBvZmZzZXQgPSArKG9mZnNldCB8fCAwKSB8IDAKCiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkgJiYgKGRhdGFbMF0gJiYgdHlwZW9mIGRhdGFbMF1bMF0gPT09ICdudW1iZXInKSkgewogICAgdmFyIGRpbSA9IGRhdGFbMF0ubGVuZ3RoCiAgICB2YXIgbGVuZ3RoID0gZGF0YS5sZW5ndGggKiBkaW0KICAgIHZhciBpLCBqLCBrLCBsCgogICAgLy8gbm8gb3V0cHV0IHNwZWNpZmllZCwgY3JlYXRlIGEgbmV3IHR5cGVkIGFycmF5CiAgICBpZiAoIW91dHB1dCB8fCB0eXBlb2Ygb3V0cHV0ID09PSAnc3RyaW5nJykgewogICAgICBvdXRwdXQgPSBuZXcgKGR0eXBlKG91dHB1dCB8fCAnZmxvYXQzMicpKShsZW5ndGggKyBvZmZzZXQpCiAgICB9CgogICAgdmFyIGRzdExlbmd0aCA9IG91dHB1dC5sZW5ndGggLSBvZmZzZXQKICAgIGlmIChsZW5ndGggIT09IGRzdExlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ3NvdXJjZSBsZW5ndGggJyArIGxlbmd0aCArICcgKCcgKyBkaW0gKyAneCcgKyBkYXRhLmxlbmd0aCArICcpJyArCiAgICAgICAgJyBkb2VzIG5vdCBtYXRjaCBkZXN0aW5hdGlvbiBsZW5ndGggJyArIGRzdExlbmd0aCkKICAgIH0KCiAgICBmb3IgKGkgPSAwLCBrID0gb2Zmc2V0OyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBmb3IgKGogPSAwOyBqIDwgZGltOyBqKyspIHsKICAgICAgICBvdXRwdXRbaysrXSA9IGRhdGFbaV1bal0gPT09IG51bGwgPyBOYU4gOiBkYXRhW2ldW2pdCiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgaWYgKCFvdXRwdXQgfHwgdHlwZW9mIG91dHB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgLy8gbm8gb3V0cHV0LCBjcmVhdGUgYSBuZXcgb25lCiAgICAgIHZhciBDdG9yID0gZHR5cGUob3V0cHV0IHx8ICdmbG9hdDMyJykKCiAgICAgIC8vIGhhbmRsZSBhcnJheXMgc2VwYXJhdGVseSBkdWUgdG8gcG9zc2libGUgbnVsbHMKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkgfHwgb3V0cHV0ID09PSAnYXJyYXknKSB7CiAgICAgICAgb3V0cHV0ID0gbmV3IEN0b3IoZGF0YS5sZW5ndGggKyBvZmZzZXQpCiAgICAgICAgZm9yIChpID0gMCwgayA9IG9mZnNldCwgbCA9IG91dHB1dC5sZW5ndGg7IGsgPCBsOyBrKyssIGkrKykgewogICAgICAgICAgb3V0cHV0W2tdID0gZGF0YVtpXSA9PT0gbnVsbCA/IE5hTiA6IGRhdGFbaV0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKG9mZnNldCA9PT0gMCkgewogICAgICAgICAgb3V0cHV0ID0gbmV3IEN0b3IoZGF0YSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3V0cHV0ID0gbmV3IEN0b3IoZGF0YS5sZW5ndGggKyBvZmZzZXQpCgogICAgICAgICAgb3V0cHV0LnNldChkYXRhLCBvZmZzZXQpCiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBzdG9yZSBvdXRwdXQgaW4gZXhpc3RpbmcgYXJyYXkKICAgICAgb3V0cHV0LnNldChkYXRhLCBvZmZzZXQpCiAgICB9CiAgfQoKICByZXR1cm4gb3V0cHV0Cn0KCn0seyJkdHlwZSI6MTR9XSwxNjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBpc0NhbGxhYmxlID0gX2RlcmVxXygnaXMtY2FsbGFibGUnKTsKCnZhciB0b1N0ciA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7Cgp2YXIgZm9yRWFjaEFycmF5ID0gZnVuY3Rpb24gZm9yRWFjaEFycmF5KGFycmF5LCBpdGVyYXRvciwgcmVjZWl2ZXIpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGFycmF5LCBpKSkgewogICAgICAgICAgICBpZiAocmVjZWl2ZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaXRlcmF0b3IoYXJyYXlbaV0sIGksIGFycmF5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl0ZXJhdG9yLmNhbGwocmVjZWl2ZXIsIGFycmF5W2ldLCBpLCBhcnJheSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn07Cgp2YXIgZm9yRWFjaFN0cmluZyA9IGZ1bmN0aW9uIGZvckVhY2hTdHJpbmcoc3RyaW5nLCBpdGVyYXRvciwgcmVjZWl2ZXIpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzdHJpbmcubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAvLyBubyBzdWNoIHRoaW5nIGFzIGEgc3BhcnNlIHN0cmluZy4KICAgICAgICBpZiAocmVjZWl2ZXIgPT0gbnVsbCkgewogICAgICAgICAgICBpdGVyYXRvcihzdHJpbmcuY2hhckF0KGkpLCBpLCBzdHJpbmcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGl0ZXJhdG9yLmNhbGwocmVjZWl2ZXIsIHN0cmluZy5jaGFyQXQoaSksIGksIHN0cmluZyk7CiAgICAgICAgfQogICAgfQp9OwoKdmFyIGZvckVhY2hPYmplY3QgPSBmdW5jdGlvbiBmb3JFYWNoT2JqZWN0KG9iamVjdCwgaXRlcmF0b3IsIHJlY2VpdmVyKSB7CiAgICBmb3IgKHZhciBrIGluIG9iamVjdCkgewogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgaykpIHsKICAgICAgICAgICAgaWYgKHJlY2VpdmVyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGl0ZXJhdG9yKG9iamVjdFtrXSwgaywgb2JqZWN0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl0ZXJhdG9yLmNhbGwocmVjZWl2ZXIsIG9iamVjdFtrXSwgaywgb2JqZWN0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKCnZhciBmb3JFYWNoID0gZnVuY3Rpb24gZm9yRWFjaChsaXN0LCBpdGVyYXRvciwgdGhpc0FyZykgewogICAgaWYgKCFpc0NhbGxhYmxlKGl0ZXJhdG9yKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2l0ZXJhdG9yIG11c3QgYmUgYSBmdW5jdGlvbicpOwogICAgfQoKICAgIHZhciByZWNlaXZlcjsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDMpIHsKICAgICAgICByZWNlaXZlciA9IHRoaXNBcmc7CiAgICB9CgogICAgaWYgKHRvU3RyLmNhbGwobGlzdCkgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKICAgICAgICBmb3JFYWNoQXJyYXkobGlzdCwgaXRlcmF0b3IsIHJlY2VpdmVyKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGxpc3QgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgZm9yRWFjaFN0cmluZyhsaXN0LCBpdGVyYXRvciwgcmVjZWl2ZXIpOwogICAgfSBlbHNlIHsKICAgICAgICBmb3JFYWNoT2JqZWN0KGxpc3QsIGl0ZXJhdG9yLCByZWNlaXZlcik7CiAgICB9Cn07Cgptb2R1bGUuZXhwb3J0cyA9IGZvckVhY2g7Cgp9LHsiaXMtY2FsbGFibGUiOjIxfV0sMTc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CnZhciB3aW47CgppZiAodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIpIHsKICAgIHdpbiA9IHdpbmRvdzsKfSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIikgewogICAgd2luID0gZ2xvYmFsOwp9IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIil7CiAgICB3aW4gPSBzZWxmOwp9IGVsc2UgewogICAgd2luID0ge307Cn0KCm1vZHVsZS5leHBvcnRzID0gd2luOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCgp9LHt9XSwxODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CmV4cG9ydHMucmVhZCA9IGZ1bmN0aW9uIChidWZmZXIsIG9mZnNldCwgaXNMRSwgbUxlbiwgbkJ5dGVzKSB7CiAgdmFyIGUsIG0KICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxCiAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDEKICB2YXIgZUJpYXMgPSBlTWF4ID4+IDEKICB2YXIgbkJpdHMgPSAtNwogIHZhciBpID0gaXNMRSA/IChuQnl0ZXMgLSAxKSA6IDAKICB2YXIgZCA9IGlzTEUgPyAtMSA6IDEKICB2YXIgcyA9IGJ1ZmZlcltvZmZzZXQgKyBpXQoKICBpICs9IGQKCiAgZSA9IHMgJiAoKDEgPDwgKC1uQml0cykpIC0gMSkKICBzID4+PSAoLW5CaXRzKQogIG5CaXRzICs9IGVMZW4KICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gKGUgKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9CgogIG0gPSBlICYgKCgxIDw8ICgtbkJpdHMpKSAtIDEpCiAgZSA+Pj0gKC1uQml0cykKICBuQml0cyArPSBtTGVuCiAgZm9yICg7IG5CaXRzID4gMDsgbSA9IChtICogMjU2KSArIGJ1ZmZlcltvZmZzZXQgKyBpXSwgaSArPSBkLCBuQml0cyAtPSA4KSB7fQoKICBpZiAoZSA9PT0gMCkgewogICAgZSA9IDEgLSBlQmlhcwogIH0gZWxzZSBpZiAoZSA9PT0gZU1heCkgewogICAgcmV0dXJuIG0gPyBOYU4gOiAoKHMgPyAtMSA6IDEpICogSW5maW5pdHkpCiAgfSBlbHNlIHsKICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbikKICAgIGUgPSBlIC0gZUJpYXMKICB9CiAgcmV0dXJuIChzID8gLTEgOiAxKSAqIG0gKiBNYXRoLnBvdygyLCBlIC0gbUxlbikKfQoKZXhwb3J0cy53cml0ZSA9IGZ1bmN0aW9uIChidWZmZXIsIHZhbHVlLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykgewogIHZhciBlLCBtLCBjCiAgdmFyIGVMZW4gPSAobkJ5dGVzICogOCkgLSBtTGVuIC0gMQogIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxCiAgdmFyIGVCaWFzID0gZU1heCA+PiAxCiAgdmFyIHJ0ID0gKG1MZW4gPT09IDIzID8gTWF0aC5wb3coMiwgLTI0KSAtIE1hdGgucG93KDIsIC03NykgOiAwKQogIHZhciBpID0gaXNMRSA/IDAgOiAobkJ5dGVzIC0gMSkKICB2YXIgZCA9IGlzTEUgPyAxIDogLTEKICB2YXIgcyA9IHZhbHVlIDwgMCB8fCAodmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCkgPyAxIDogMAoKICB2YWx1ZSA9IE1hdGguYWJzKHZhbHVlKQoKICBpZiAoaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBJbmZpbml0eSkgewogICAgbSA9IGlzTmFOKHZhbHVlKSA/IDEgOiAwCiAgICBlID0gZU1heAogIH0gZWxzZSB7CiAgICBlID0gTWF0aC5mbG9vcihNYXRoLmxvZyh2YWx1ZSkgLyBNYXRoLkxOMikKICAgIGlmICh2YWx1ZSAqIChjID0gTWF0aC5wb3coMiwgLWUpKSA8IDEpIHsKICAgICAgZS0tCiAgICAgIGMgKj0gMgogICAgfQogICAgaWYgKGUgKyBlQmlhcyA+PSAxKSB7CiAgICAgIHZhbHVlICs9IHJ0IC8gYwogICAgfSBlbHNlIHsKICAgICAgdmFsdWUgKz0gcnQgKiBNYXRoLnBvdygyLCAxIC0gZUJpYXMpCiAgICB9CiAgICBpZiAodmFsdWUgKiBjID49IDIpIHsKICAgICAgZSsrCiAgICAgIGMgLz0gMgogICAgfQoKICAgIGlmIChlICsgZUJpYXMgPj0gZU1heCkgewogICAgICBtID0gMAogICAgICBlID0gZU1heAogICAgfSBlbHNlIGlmIChlICsgZUJpYXMgPj0gMSkgewogICAgICBtID0gKCh2YWx1ZSAqIGMpIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKQogICAgICBlID0gZSArIGVCaWFzCiAgICB9IGVsc2UgewogICAgICBtID0gdmFsdWUgKiBNYXRoLnBvdygyLCBlQmlhcyAtIDEpICogTWF0aC5wb3coMiwgbUxlbikKICAgICAgZSA9IDAKICAgIH0KICB9CgogIGZvciAoOyBtTGVuID49IDg7IGJ1ZmZlcltvZmZzZXQgKyBpXSA9IG0gJiAweGZmLCBpICs9IGQsIG0gLz0gMjU2LCBtTGVuIC09IDgpIHt9CgogIGUgPSAoZSA8PCBtTGVuKSB8IG0KICBlTGVuICs9IG1MZW4KICBmb3IgKDsgZUxlbiA+IDA7IGJ1ZmZlcltvZmZzZXQgKyBpXSA9IGUgJiAweGZmLCBpICs9IGQsIGUgLz0gMjU2LCBlTGVuIC09IDgpIHt9CgogIGJ1ZmZlcltvZmZzZXQgKyBpIC0gZF0gfD0gcyAqIDEyOAp9Cgp9LHt9XSwxOTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CmlmICh0eXBlb2YgT2JqZWN0LmNyZWF0ZSA9PT0gJ2Z1bmN0aW9uJykgewogIC8vIGltcGxlbWVudGF0aW9uIGZyb20gc3RhbmRhcmQgbm9kZS5qcyAndXRpbCcgbW9kdWxlCiAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yCiAgICBjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDdG9yLnByb3RvdHlwZSwgewogICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgIHZhbHVlOiBjdG9yLAogICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9CiAgICB9KTsKICB9Owp9IGVsc2UgewogIC8vIG9sZCBzY2hvb2wgc2hpbSBmb3Igb2xkIGJyb3dzZXJzCiAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yCiAgICB2YXIgVGVtcEN0b3IgPSBmdW5jdGlvbiAoKSB7fQogICAgVGVtcEN0b3IucHJvdG90eXBlID0gc3VwZXJDdG9yLnByb3RvdHlwZQogICAgY3Rvci5wcm90b3R5cGUgPSBuZXcgVGVtcEN0b3IoKQogICAgY3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBjdG9yCiAgfQp9Cgp9LHt9XSwyMDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qIQogKiBEZXRlcm1pbmUgaWYgYW4gb2JqZWN0IGlzIGEgQnVmZmVyCiAqCiAqIEBhdXRob3IgICBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmc+CiAqIEBsaWNlbnNlICBNSVQKICovCgovLyBUaGUgX2lzQnVmZmVyIGNoZWNrIGlzIGZvciBTYWZhcmkgNS03IHN1cHBvcnQsIGJlY2F1c2UgaXQncyBtaXNzaW5nCi8vIE9iamVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IuIFJlbW92ZSB0aGlzIGV2ZW50dWFsbHkKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqKSB7CiAgcmV0dXJuIG9iaiAhPSBudWxsICYmIChpc0J1ZmZlcihvYmopIHx8IGlzU2xvd0J1ZmZlcihvYmopIHx8ICEhb2JqLl9pc0J1ZmZlcikKfQoKZnVuY3Rpb24gaXNCdWZmZXIgKG9iaikgewogIHJldHVybiAhIW9iai5jb25zdHJ1Y3RvciAmJiB0eXBlb2Ygb2JqLmNvbnN0cnVjdG9yLmlzQnVmZmVyID09PSAnZnVuY3Rpb24nICYmIG9iai5jb25zdHJ1Y3Rvci5pc0J1ZmZlcihvYmopCn0KCi8vIEZvciBOb2RlIHYwLjEwIHN1cHBvcnQuIFJlbW92ZSB0aGlzIGV2ZW50dWFsbHkuCmZ1bmN0aW9uIGlzU2xvd0J1ZmZlciAob2JqKSB7CiAgcmV0dXJuIHR5cGVvZiBvYmoucmVhZEZsb2F0TEUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIG9iai5zbGljZSA9PT0gJ2Z1bmN0aW9uJyAmJiBpc0J1ZmZlcihvYmouc2xpY2UoMCwgMCkpCn0KCn0se31dLDIxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIGZuVG9TdHIgPSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmc7Cgp2YXIgY29uc3RydWN0b3JSZWdleCA9IC9eXHMqY2xhc3NcYi87CnZhciBpc0VTNkNsYXNzRm4gPSBmdW5jdGlvbiBpc0VTNkNsYXNzRnVuY3Rpb24odmFsdWUpIHsKCXRyeSB7CgkJdmFyIGZuU3RyID0gZm5Ub1N0ci5jYWxsKHZhbHVlKTsKCQlyZXR1cm4gY29uc3RydWN0b3JSZWdleC50ZXN0KGZuU3RyKTsKCX0gY2F0Y2ggKGUpIHsKCQlyZXR1cm4gZmFsc2U7IC8vIG5vdCBhIGZ1bmN0aW9uCgl9Cn07Cgp2YXIgdHJ5RnVuY3Rpb25PYmplY3QgPSBmdW5jdGlvbiB0cnlGdW5jdGlvblRvU3RyKHZhbHVlKSB7Cgl0cnkgewoJCWlmIChpc0VTNkNsYXNzRm4odmFsdWUpKSB7IHJldHVybiBmYWxzZTsgfQoJCWZuVG9TdHIuY2FsbCh2YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQp9Owp2YXIgdG9TdHIgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwp2YXIgZm5DbGFzcyA9ICdbb2JqZWN0IEZ1bmN0aW9uXSc7CnZhciBnZW5DbGFzcyA9ICdbb2JqZWN0IEdlbmVyYXRvckZ1bmN0aW9uXSc7CnZhciBoYXNUb1N0cmluZ1RhZyA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyA9PT0gJ3N5bWJvbCc7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGlzQ2FsbGFibGUodmFsdWUpIHsKCWlmICghdmFsdWUpIHsgcmV0dXJuIGZhbHNlOyB9CglpZiAodHlwZW9mIHZhbHVlICE9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHsgcmV0dXJuIGZhbHNlOyB9CglpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmICF2YWx1ZS5wcm90b3R5cGUpIHsgcmV0dXJuIHRydWU7IH0KCWlmIChoYXNUb1N0cmluZ1RhZykgeyByZXR1cm4gdHJ5RnVuY3Rpb25PYmplY3QodmFsdWUpOyB9CglpZiAoaXNFUzZDbGFzc0ZuKHZhbHVlKSkgeyByZXR1cm4gZmFsc2U7IH0KCXZhciBzdHJDbGFzcyA9IHRvU3RyLmNhbGwodmFsdWUpOwoJcmV0dXJuIHN0ckNsYXNzID09PSBmbkNsYXNzIHx8IHN0ckNsYXNzID09PSBnZW5DbGFzczsKfTsKCn0se31dLDIyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBpc0Z1bmN0aW9uCgp2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nCgpmdW5jdGlvbiBpc0Z1bmN0aW9uIChmbikgewogIHZhciBzdHJpbmcgPSB0b1N0cmluZy5jYWxsKGZuKQogIHJldHVybiBzdHJpbmcgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXScgfHwKICAgICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicgJiYgc3RyaW5nICE9PSAnW29iamVjdCBSZWdFeHBdJykgfHwKICAgICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJgogICAgIC8vIElFOCBhbmQgYmVsb3cKICAgICAoZm4gPT09IHdpbmRvdy5zZXRUaW1lb3V0IHx8CiAgICAgIGZuID09PSB3aW5kb3cuYWxlcnQgfHwKICAgICAgZm4gPT09IHdpbmRvdy5jb25maXJtIHx8CiAgICAgIGZuID09PSB3aW5kb3cucHJvbXB0KSkKfTsKCn0se31dLDIzOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh4KSB7Cgl2YXIgdHlwZSA9IHR5cGVvZiB4OwoJcmV0dXJuIHggIT09IG51bGwgJiYgKHR5cGUgPT09ICdvYmplY3QnIHx8IHR5cGUgPT09ICdmdW5jdGlvbicpOwp9OwoKfSx7fV0sMjQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgd29yZFdyYXAgPSBfZGVyZXFfKCd3b3JkLXdyYXBwZXInKQp2YXIgeHRlbmQgPSBfZGVyZXFfKCd4dGVuZCcpCnZhciBudW1iZXIgPSBfZGVyZXFfKCdhcy1udW1iZXInKQoKdmFyIFhfSEVJR0hUUyA9IFsneCcsICdlJywgJ2EnLCAnbycsICduJywgJ3MnLCAncicsICdjJywgJ3UnLCAnbScsICd2JywgJ3cnLCAneiddCnZhciBNX1dJRFRIUyA9IFsnbScsICd3J10KdmFyIENBUF9IRUlHSFRTID0gWydIJywgJ0knLCAnTicsICdFJywgJ0YnLCAnSycsICdMJywgJ1QnLCAnVScsICdWJywgJ1cnLCAnWCcsICdZJywgJ1onXQoKCnZhciBUQUJfSUQgPSAnXHQnLmNoYXJDb2RlQXQoMCkKdmFyIFNQQUNFX0lEID0gJyAnLmNoYXJDb2RlQXQoMCkKdmFyIEFMSUdOX0xFRlQgPSAwLCAKICAgIEFMSUdOX0NFTlRFUiA9IDEsIAogICAgQUxJR05fUklHSFQgPSAyCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZUxheW91dChvcHQpIHsKICByZXR1cm4gbmV3IFRleHRMYXlvdXQob3B0KQp9CgpmdW5jdGlvbiBUZXh0TGF5b3V0KG9wdCkgewogIHRoaXMuZ2x5cGhzID0gW10KICB0aGlzLl9tZWFzdXJlID0gdGhpcy5jb21wdXRlTWV0cmljcy5iaW5kKHRoaXMpCiAgdGhpcy51cGRhdGUob3B0KQp9CgpUZXh0TGF5b3V0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihvcHQpIHsKICBvcHQgPSB4dGVuZCh7CiAgICBtZWFzdXJlOiB0aGlzLl9tZWFzdXJlCiAgfSwgb3B0KQogIHRoaXMuX29wdCA9IG9wdAogIHRoaXMuX29wdC50YWJTaXplID0gbnVtYmVyKHRoaXMuX29wdC50YWJTaXplLCA0KQoKICBpZiAoIW9wdC5mb250KQogICAgdGhyb3cgbmV3IEVycm9yKCdtdXN0IHByb3ZpZGUgYSB2YWxpZCBiaXRtYXAgZm9udCcpCgogIHZhciBnbHlwaHMgPSB0aGlzLmdseXBocwogIHZhciB0ZXh0ID0gb3B0LnRleHR8fCcnIAogIHZhciBmb250ID0gb3B0LmZvbnQKICB0aGlzLl9zZXR1cFNwYWNlR2x5cGhzKGZvbnQpCiAgCiAgdmFyIGxpbmVzID0gd29yZFdyYXAubGluZXModGV4dCwgb3B0KQogIHZhciBtaW5XaWR0aCA9IG9wdC53aWR0aCB8fCAwCgogIC8vY2xlYXIgZ2x5cGhzCiAgZ2x5cGhzLmxlbmd0aCA9IDAKCiAgLy9nZXQgbWF4IGxpbmUgd2lkdGgKICB2YXIgbWF4TGluZVdpZHRoID0gbGluZXMucmVkdWNlKGZ1bmN0aW9uKHByZXYsIGxpbmUpIHsKICAgIHJldHVybiBNYXRoLm1heChwcmV2LCBsaW5lLndpZHRoLCBtaW5XaWR0aCkKICB9LCAwKQoKICAvL3RoZSBwZW4gcG9zaXRpb24KICB2YXIgeCA9IDAKICB2YXIgeSA9IDAKICB2YXIgbGluZUhlaWdodCA9IG51bWJlcihvcHQubGluZUhlaWdodCwgZm9udC5jb21tb24ubGluZUhlaWdodCkKICB2YXIgYmFzZWxpbmUgPSBmb250LmNvbW1vbi5iYXNlCiAgdmFyIGRlc2NlbmRlciA9IGxpbmVIZWlnaHQtYmFzZWxpbmUKICB2YXIgbGV0dGVyU3BhY2luZyA9IG9wdC5sZXR0ZXJTcGFjaW5nIHx8IDAKICB2YXIgaGVpZ2h0ID0gbGluZUhlaWdodCAqIGxpbmVzLmxlbmd0aCAtIGRlc2NlbmRlcgogIHZhciBhbGlnbiA9IGdldEFsaWduVHlwZSh0aGlzLl9vcHQuYWxpZ24pCgogIC8vZHJhdyB0ZXh0IGFsb25nIGJhc2VsaW5lCiAgeSAtPSBoZWlnaHQKICAKICAvL3RoZSBtZXRyaWNzIGZvciB0aGlzIHRleHQgbGF5b3V0CiAgdGhpcy5fd2lkdGggPSBtYXhMaW5lV2lkdGgKICB0aGlzLl9oZWlnaHQgPSBoZWlnaHQKICB0aGlzLl9kZXNjZW5kZXIgPSBsaW5lSGVpZ2h0IC0gYmFzZWxpbmUKICB0aGlzLl9iYXNlbGluZSA9IGJhc2VsaW5lCiAgdGhpcy5feEhlaWdodCA9IGdldFhIZWlnaHQoZm9udCkKICB0aGlzLl9jYXBIZWlnaHQgPSBnZXRDYXBIZWlnaHQoZm9udCkKICB0aGlzLl9saW5lSGVpZ2h0ID0gbGluZUhlaWdodAogIHRoaXMuX2FzY2VuZGVyID0gbGluZUhlaWdodCAtIGRlc2NlbmRlciAtIHRoaXMuX3hIZWlnaHQKICAgIAogIC8vbGF5b3V0IGVhY2ggZ2x5cGgKICB2YXIgc2VsZiA9IHRoaXMKICBsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUsIGxpbmVJbmRleCkgewogICAgdmFyIHN0YXJ0ID0gbGluZS5zdGFydAogICAgdmFyIGVuZCA9IGxpbmUuZW5kCiAgICB2YXIgbGluZVdpZHRoID0gbGluZS53aWR0aAogICAgdmFyIGxhc3RHbHlwaAogICAgCiAgICAvL2ZvciBlYWNoIGdseXBoIGluIHRoYXQgbGluZS4uLgogICAgZm9yICh2YXIgaT1zdGFydDsgaTxlbmQ7IGkrKykgewogICAgICB2YXIgaWQgPSB0ZXh0LmNoYXJDb2RlQXQoaSkKICAgICAgdmFyIGdseXBoID0gc2VsZi5nZXRHbHlwaChmb250LCBpZCkKICAgICAgaWYgKGdseXBoKSB7CiAgICAgICAgaWYgKGxhc3RHbHlwaCkgCiAgICAgICAgICB4ICs9IGdldEtlcm5pbmcoZm9udCwgbGFzdEdseXBoLmlkLCBnbHlwaC5pZCkKCiAgICAgICAgdmFyIHR4ID0geAogICAgICAgIGlmIChhbGlnbiA9PT0gQUxJR05fQ0VOVEVSKSAKICAgICAgICAgIHR4ICs9IChtYXhMaW5lV2lkdGgtbGluZVdpZHRoKS8yCiAgICAgICAgZWxzZSBpZiAoYWxpZ24gPT09IEFMSUdOX1JJR0hUKQogICAgICAgICAgdHggKz0gKG1heExpbmVXaWR0aC1saW5lV2lkdGgpCgogICAgICAgIGdseXBocy5wdXNoKHsKICAgICAgICAgIHBvc2l0aW9uOiBbdHgsIHldLAogICAgICAgICAgZGF0YTogZ2x5cGgsCiAgICAgICAgICBpbmRleDogaSwKICAgICAgICAgIGxpbmU6IGxpbmVJbmRleAogICAgICAgIH0pICAKCiAgICAgICAgLy9tb3ZlIHBlbiBmb3J3YXJkCiAgICAgICAgeCArPSBnbHlwaC54YWR2YW5jZSArIGxldHRlclNwYWNpbmcKICAgICAgICBsYXN0R2x5cGggPSBnbHlwaAogICAgICB9CiAgICB9CgogICAgLy9uZXh0IGxpbmUgZG93bgogICAgeSArPSBsaW5lSGVpZ2h0CiAgICB4ID0gMAogIH0pCiAgdGhpcy5fbGluZXNUb3RhbCA9IGxpbmVzLmxlbmd0aDsKfQoKVGV4dExheW91dC5wcm90b3R5cGUuX3NldHVwU3BhY2VHbHlwaHMgPSBmdW5jdGlvbihmb250KSB7CiAgLy9UaGVzZSBhcmUgZmFsbGJhY2tzLCB3aGVuIHRoZSBmb250IGRvZXNuJ3QgaW5jbHVkZQogIC8vJyAnIG9yICdcdCcgZ2x5cGhzCiAgdGhpcy5fZmFsbGJhY2tTcGFjZUdseXBoID0gbnVsbAogIHRoaXMuX2ZhbGxiYWNrVGFiR2x5cGggPSBudWxsCgogIGlmICghZm9udC5jaGFycyB8fCBmb250LmNoYXJzLmxlbmd0aCA9PT0gMCkKICAgIHJldHVybgoKICAvL3RyeSB0byBnZXQgc3BhY2UgZ2x5cGgKICAvL3RoZW4gZmFsbCBiYWNrIHRvIHRoZSAnbScgb3IgJ3cnIGdseXBocwogIC8vdGhlbiBmYWxsIGJhY2sgdG8gdGhlIGZpcnN0IGdseXBoIGF2YWlsYWJsZQogIHZhciBzcGFjZSA9IGdldEdseXBoQnlJZChmb250LCBTUEFDRV9JRCkgCiAgICAgICAgICB8fCBnZXRNR2x5cGgoZm9udCkgCiAgICAgICAgICB8fCBmb250LmNoYXJzWzBdCgogIC8vYW5kIGNyZWF0ZSBhIGZhbGxiYWNrIGZvciB0YWIKICB2YXIgdGFiV2lkdGggPSB0aGlzLl9vcHQudGFiU2l6ZSAqIHNwYWNlLnhhZHZhbmNlCiAgdGhpcy5fZmFsbGJhY2tTcGFjZUdseXBoID0gc3BhY2UKICB0aGlzLl9mYWxsYmFja1RhYkdseXBoID0geHRlbmQoc3BhY2UsIHsKICAgIHg6IDAsIHk6IDAsIHhhZHZhbmNlOiB0YWJXaWR0aCwgaWQ6IFRBQl9JRCwgCiAgICB4b2Zmc2V0OiAwLCB5b2Zmc2V0OiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwCiAgfSkKfQoKVGV4dExheW91dC5wcm90b3R5cGUuZ2V0R2x5cGggPSBmdW5jdGlvbihmb250LCBpZCkgewogIHZhciBnbHlwaCA9IGdldEdseXBoQnlJZChmb250LCBpZCkKICBpZiAoZ2x5cGgpCiAgICByZXR1cm4gZ2x5cGgKICBlbHNlIGlmIChpZCA9PT0gVEFCX0lEKSAKICAgIHJldHVybiB0aGlzLl9mYWxsYmFja1RhYkdseXBoCiAgZWxzZSBpZiAoaWQgPT09IFNQQUNFX0lEKSAKICAgIHJldHVybiB0aGlzLl9mYWxsYmFja1NwYWNlR2x5cGgKICByZXR1cm4gbnVsbAp9CgpUZXh0TGF5b3V0LnByb3RvdHlwZS5jb21wdXRlTWV0cmljcyA9IGZ1bmN0aW9uKHRleHQsIHN0YXJ0LCBlbmQsIHdpZHRoKSB7CiAgdmFyIGxldHRlclNwYWNpbmcgPSB0aGlzLl9vcHQubGV0dGVyU3BhY2luZyB8fCAwCiAgdmFyIGZvbnQgPSB0aGlzLl9vcHQuZm9udAogIHZhciBjdXJQZW4gPSAwCiAgdmFyIGN1cldpZHRoID0gMAogIHZhciBjb3VudCA9IDAKICB2YXIgZ2x5cGgKICB2YXIgbGFzdEdseXBoCgogIGlmICghZm9udC5jaGFycyB8fCBmb250LmNoYXJzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIHsKICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICBlbmQ6IHN0YXJ0LAogICAgICB3aWR0aDogMAogICAgfQogIH0KCiAgZW5kID0gTWF0aC5taW4odGV4dC5sZW5ndGgsIGVuZCkKICBmb3IgKHZhciBpPXN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgIHZhciBpZCA9IHRleHQuY2hhckNvZGVBdChpKQogICAgdmFyIGdseXBoID0gdGhpcy5nZXRHbHlwaChmb250LCBpZCkKCiAgICBpZiAoZ2x5cGgpIHsKICAgICAgLy9tb3ZlIHBlbiBmb3J3YXJkCiAgICAgIHZhciB4b2ZmID0gZ2x5cGgueG9mZnNldAogICAgICB2YXIga2VybiA9IGxhc3RHbHlwaCA/IGdldEtlcm5pbmcoZm9udCwgbGFzdEdseXBoLmlkLCBnbHlwaC5pZCkgOiAwCiAgICAgIGN1clBlbiArPSBrZXJuCgogICAgICB2YXIgbmV4dFBlbiA9IGN1clBlbiArIGdseXBoLnhhZHZhbmNlICsgbGV0dGVyU3BhY2luZwogICAgICB2YXIgbmV4dFdpZHRoID0gY3VyUGVuICsgZ2x5cGgud2lkdGgKCiAgICAgIC8vd2UndmUgaGl0IG91ciBsaW1pdDsgd2UgY2FuJ3QgbW92ZSBvbnRvIHRoZSBuZXh0IGdseXBoCiAgICAgIGlmIChuZXh0V2lkdGggPj0gd2lkdGggfHwgbmV4dFBlbiA+PSB3aWR0aCkKICAgICAgICBicmVhawoKICAgICAgLy9vdGhlcndpc2UgY29udGludWUgYWxvbmcgb3VyIGxpbmUKICAgICAgY3VyUGVuID0gbmV4dFBlbgogICAgICBjdXJXaWR0aCA9IG5leHRXaWR0aAogICAgICBsYXN0R2x5cGggPSBnbHlwaAogICAgfQogICAgY291bnQrKwogIH0KICAKICAvL21ha2Ugc3VyZSByaWdodG1vc3QgZWRnZSBsaW5lcyB1cCB3aXRoIHJlbmRlcmVkIGdseXBocwogIGlmIChsYXN0R2x5cGgpCiAgICBjdXJXaWR0aCArPSBsYXN0R2x5cGgueG9mZnNldAoKICByZXR1cm4gewogICAgc3RhcnQ6IHN0YXJ0LAogICAgZW5kOiBzdGFydCArIGNvdW50LAogICAgd2lkdGg6IGN1cldpZHRoCiAgfQp9CgovL2dldHRlcnMgZm9yIHRoZSBwcml2YXRlIHZhcnMKO1snd2lkdGgnLCAnaGVpZ2h0JywgCiAgJ2Rlc2NlbmRlcicsICdhc2NlbmRlcicsCiAgJ3hIZWlnaHQnLCAnYmFzZWxpbmUnLAogICdjYXBIZWlnaHQnLAogICdsaW5lSGVpZ2h0JyBdLmZvckVhY2goYWRkR2V0dGVyKQoKZnVuY3Rpb24gYWRkR2V0dGVyKG5hbWUpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGV4dExheW91dC5wcm90b3R5cGUsIG5hbWUsIHsKICAgIGdldDogd3JhcHBlcihuYW1lKSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0pCn0KCi8vY3JlYXRlIGxvb2t1cHMgZm9yIHByaXZhdGUgdmFycwpmdW5jdGlvbiB3cmFwcGVyKG5hbWUpIHsKICByZXR1cm4gKG5ldyBGdW5jdGlvbihbCiAgICAncmV0dXJuIGZ1bmN0aW9uICcrbmFtZSsnKCkgeycsCiAgICAnICByZXR1cm4gdGhpcy5fJytuYW1lLAogICAgJ30nCiAgXS5qb2luKCdcbicpKSkoKQp9CgpmdW5jdGlvbiBnZXRHbHlwaEJ5SWQoZm9udCwgaWQpIHsKICBpZiAoIWZvbnQuY2hhcnMgfHwgZm9udC5jaGFycy5sZW5ndGggPT09IDApCiAgICByZXR1cm4gbnVsbAoKICB2YXIgZ2x5cGhJZHggPSBmaW5kQ2hhcihmb250LmNoYXJzLCBpZCkKICBpZiAoZ2x5cGhJZHggPj0gMCkKICAgIHJldHVybiBmb250LmNoYXJzW2dseXBoSWR4XQogIHJldHVybiBudWxsCn0KCmZ1bmN0aW9uIGdldFhIZWlnaHQoZm9udCkgewogIGZvciAodmFyIGk9MDsgaTxYX0hFSUdIVFMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBpZCA9IFhfSEVJR0hUU1tpXS5jaGFyQ29kZUF0KDApCiAgICB2YXIgaWR4ID0gZmluZENoYXIoZm9udC5jaGFycywgaWQpCiAgICBpZiAoaWR4ID49IDApIAogICAgICByZXR1cm4gZm9udC5jaGFyc1tpZHhdLmhlaWdodAogIH0KICByZXR1cm4gMAp9CgpmdW5jdGlvbiBnZXRNR2x5cGgoZm9udCkgewogIGZvciAodmFyIGk9MDsgaTxNX1dJRFRIUy5sZW5ndGg7IGkrKykgewogICAgdmFyIGlkID0gTV9XSURUSFNbaV0uY2hhckNvZGVBdCgwKQogICAgdmFyIGlkeCA9IGZpbmRDaGFyKGZvbnQuY2hhcnMsIGlkKQogICAgaWYgKGlkeCA+PSAwKSAKICAgICAgcmV0dXJuIGZvbnQuY2hhcnNbaWR4XQogIH0KICByZXR1cm4gMAp9CgpmdW5jdGlvbiBnZXRDYXBIZWlnaHQoZm9udCkgewogIGZvciAodmFyIGk9MDsgaTxDQVBfSEVJR0hUUy5sZW5ndGg7IGkrKykgewogICAgdmFyIGlkID0gQ0FQX0hFSUdIVFNbaV0uY2hhckNvZGVBdCgwKQogICAgdmFyIGlkeCA9IGZpbmRDaGFyKGZvbnQuY2hhcnMsIGlkKQogICAgaWYgKGlkeCA+PSAwKSAKICAgICAgcmV0dXJuIGZvbnQuY2hhcnNbaWR4XS5oZWlnaHQKICB9CiAgcmV0dXJuIDAKfQoKZnVuY3Rpb24gZ2V0S2VybmluZyhmb250LCBsZWZ0LCByaWdodCkgewogIGlmICghZm9udC5rZXJuaW5ncyB8fCBmb250Lmtlcm5pbmdzLmxlbmd0aCA9PT0gMCkKICAgIHJldHVybiAwCgogIHZhciB0YWJsZSA9IGZvbnQua2VybmluZ3MKICBmb3IgKHZhciBpPTA7IGk8dGFibGUubGVuZ3RoOyBpKyspIHsKICAgIHZhciBrZXJuID0gdGFibGVbaV0KICAgIGlmIChrZXJuLmZpcnN0ID09PSBsZWZ0ICYmIGtlcm4uc2Vjb25kID09PSByaWdodCkKICAgICAgcmV0dXJuIGtlcm4uYW1vdW50CiAgfQogIHJldHVybiAwCn0KCmZ1bmN0aW9uIGdldEFsaWduVHlwZShhbGlnbikgewogIGlmIChhbGlnbiA9PT0gJ2NlbnRlcicpCiAgICByZXR1cm4gQUxJR05fQ0VOVEVSCiAgZWxzZSBpZiAoYWxpZ24gPT09ICdyaWdodCcpCiAgICByZXR1cm4gQUxJR05fUklHSFQKICByZXR1cm4gQUxJR05fTEVGVAp9CgpmdW5jdGlvbiBmaW5kQ2hhciAoYXJyYXksIHZhbHVlLCBzdGFydCkgewogIHN0YXJ0ID0gc3RhcnQgfHwgMAogIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICBpZiAoYXJyYXlbaV0uaWQgPT09IHZhbHVlKSB7CiAgICAgIHJldHVybiBpCiAgICB9CiAgfQogIHJldHVybiAtMQp9Cn0seyJhcy1udW1iZXIiOjIsIndvcmQtd3JhcHBlciI6NTAsInh0ZW5kIjo1M31dLDI1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChCdWZmZXIpewp2YXIgeGhyID0gX2RlcmVxXygneGhyJykKdmFyIG5vb3AgPSBmdW5jdGlvbigpe30KdmFyIHBhcnNlQVNDSUkgPSBfZGVyZXFfKCdwYXJzZS1ibWZvbnQtYXNjaWknKQp2YXIgcGFyc2VYTUwgPSBfZGVyZXFfKCdwYXJzZS1ibWZvbnQteG1sJykKdmFyIHJlYWRCaW5hcnkgPSBfZGVyZXFfKCdwYXJzZS1ibWZvbnQtYmluYXJ5JykKdmFyIGlzQmluYXJ5Rm9ybWF0ID0gX2RlcmVxXygnLi9saWIvaXMtYmluYXJ5JykKdmFyIHh0ZW5kID0gX2RlcmVxXygneHRlbmQnKQoKdmFyIHhtbDIgPSAoZnVuY3Rpb24gaGFzWE1MMigpIHsKICByZXR1cm4gc2VsZi5YTUxIdHRwUmVxdWVzdCAmJiAid2l0aENyZWRlbnRpYWxzIiBpbiBuZXcgWE1MSHR0cFJlcXVlc3QKfSkoKQoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcHQsIGNiKSB7CiAgY2IgPSB0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicgPyBjYiA6IG5vb3AKCiAgaWYgKHR5cGVvZiBvcHQgPT09ICdzdHJpbmcnKQogICAgb3B0ID0geyB1cmk6IG9wdCB9CiAgZWxzZSBpZiAoIW9wdCkKICAgIG9wdCA9IHt9CgogIHZhciBleHBlY3RCaW5hcnkgPSBvcHQuYmluYXJ5CiAgaWYgKGV4cGVjdEJpbmFyeSkKICAgIG9wdCA9IGdldEJpbmFyeU9wdHMob3B0KQoKICB4aHIob3B0LCBmdW5jdGlvbihlcnIsIHJlcywgYm9keSkgewogICAgaWYgKGVycikKICAgICAgcmV0dXJuIGNiKGVycikKICAgIGlmICghL14yLy50ZXN0KHJlcy5zdGF0dXNDb2RlKSkKICAgICAgcmV0dXJuIGNiKG5ldyBFcnJvcignaHR0cCBzdGF0dXMgY29kZTogJytyZXMuc3RhdHVzQ29kZSkpCiAgICBpZiAoIWJvZHkpCiAgICAgIHJldHVybiBjYihuZXcgRXJyb3IoJ25vIGJvZHkgcmVzdWx0JykpCgogICAgdmFyIGJpbmFyeSA9IGZhbHNlIAoKICAgIC8vaWYgdGhlIHJlc3BvbnNlIHR5cGUgaXMgYW4gYXJyYXkgYnVmZmVyLAogICAgLy93ZSBuZWVkIHRvIGNvbnZlcnQgaXQgaW50byBhIHJlZ3VsYXIgQnVmZmVyIG9iamVjdAogICAgaWYgKGlzQXJyYXlCdWZmZXIoYm9keSkpIHsKICAgICAgdmFyIGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYm9keSkKICAgICAgYm9keSA9IG5ldyBCdWZmZXIoYXJyYXksICdiaW5hcnknKQogICAgfQoKICAgIC8vbm93IGNoZWNrIHRoZSBzdHJpbmcvQnVmZmVyIHJlc3BvbnNlCiAgICAvL2FuZCBzZWUgaWYgaXQgaGFzIGEgYmluYXJ5IEJNRiBoZWFkZXIKICAgIGlmIChpc0JpbmFyeUZvcm1hdChib2R5KSkgewogICAgICBiaW5hcnkgPSB0cnVlCiAgICAgIC8vaWYgd2UgaGF2ZSBhIHN0cmluZywgdHVybiBpdCBpbnRvIGEgQnVmZmVyCiAgICAgIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIAogICAgICAgIGJvZHkgPSBuZXcgQnVmZmVyKGJvZHksICdiaW5hcnknKQogICAgfSAKCiAgICAvL3dlIGFyZSBub3QgcGFyc2luZyBhIGJpbmFyeSBmb3JtYXQsIGp1c3QgQVNDSUkvWE1ML2V0YwogICAgaWYgKCFiaW5hcnkpIHsKICAgICAgLy9taWdodCBzdGlsbCBiZSBhIGJ1ZmZlciBpZiByZXNwb25zZVR5cGUgaXMgJ2FycmF5YnVmZmVyJwogICAgICBpZiAoQnVmZmVyLmlzQnVmZmVyKGJvZHkpKQogICAgICAgIGJvZHkgPSBib2R5LnRvU3RyaW5nKG9wdC5lbmNvZGluZykKICAgICAgYm9keSA9IGJvZHkudHJpbSgpCiAgICB9CgogICAgdmFyIHJlc3VsdAogICAgdHJ5IHsKICAgICAgdmFyIHR5cGUgPSByZXMuaGVhZGVyc1snY29udGVudC10eXBlJ10KICAgICAgaWYgKGJpbmFyeSkKICAgICAgICByZXN1bHQgPSByZWFkQmluYXJ5KGJvZHkpCiAgICAgIGVsc2UgaWYgKC9qc29uLy50ZXN0KHR5cGUpIHx8IGJvZHkuY2hhckF0KDApID09PSAneycpCiAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZShib2R5KQogICAgICBlbHNlIGlmICgveG1sLy50ZXN0KHR5cGUpICB8fCBib2R5LmNoYXJBdCgwKSA9PT0gJzwnKQogICAgICAgIHJlc3VsdCA9IHBhcnNlWE1MKGJvZHkpCiAgICAgIGVsc2UKICAgICAgICByZXN1bHQgPSBwYXJzZUFTQ0lJKGJvZHkpCiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNiKG5ldyBFcnJvcignZXJyb3IgcGFyc2luZyBmb250ICcrZS5tZXNzYWdlKSkKICAgICAgY2IgPSBub29wCiAgICB9CiAgICBjYihudWxsLCByZXN1bHQpCiAgfSkKfQoKZnVuY3Rpb24gaXNBcnJheUJ1ZmZlcihhcnIpIHsKICB2YXIgc3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZwogIHJldHVybiBzdHIuY2FsbChhcnIpID09PSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nCn0KCmZ1bmN0aW9uIGdldEJpbmFyeU9wdHMob3B0KSB7CiAgLy9JRTEwKyBhbmQgb3RoZXIgbW9kZXJuIGJyb3dzZXJzIHN1cHBvcnQgYXJyYXkgYnVmZmVycwogIGlmICh4bWwyKQogICAgcmV0dXJuIHh0ZW5kKG9wdCwgeyByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicgfSkKICAKICBpZiAodHlwZW9mIHNlbGYuWE1MSHR0cFJlcXVlc3QgPT09ICd1bmRlZmluZWQnKQogICAgdGhyb3cgbmV3IEVycm9yKCd5b3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBYSFIgbG9hZGluZycpCgogIC8vSUU5IGFuZCBYTUwxIGJyb3dzZXJzIGNvdWxkIHN0aWxsIHVzZSBhbiBvdmVycmlkZQogIHZhciByZXEgPSBuZXcgc2VsZi5YTUxIdHRwUmVxdWVzdCgpCiAgcmVxLm92ZXJyaWRlTWltZVR5cGUoJ3RleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQnKQogIHJldHVybiB4dGVuZCh7CiAgICB4aHI6IHJlcQogIH0sIG9wdCkKfQoKfSkuY2FsbCh0aGlzLF9kZXJlcV8oImJ1ZmZlciIpLkJ1ZmZlcikKCn0seyIuL2xpYi9pcy1iaW5hcnkiOjI2LCJidWZmZXIiOjcsInBhcnNlLWJtZm9udC1hc2NpaSI6MjgsInBhcnNlLWJtZm9udC1iaW5hcnkiOjI5LCJwYXJzZS1ibWZvbnQteG1sIjozMCwieGhyIjo1MSwieHRlbmQiOjUzfV0sMjY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKEJ1ZmZlcil7CnZhciBlcXVhbCA9IF9kZXJlcV8oJ2J1ZmZlci1lcXVhbCcpCnZhciBIRUFERVIgPSBuZXcgQnVmZmVyKFs2NiwgNzcsIDcwLCAzXSkKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYnVmKSB7CiAgaWYgKHR5cGVvZiBidWYgPT09ICdzdHJpbmcnKQogICAgcmV0dXJuIGJ1Zi5zdWJzdHJpbmcoMCwgMykgPT09ICdCTUYnCiAgcmV0dXJuIGJ1Zi5sZW5ndGggPiA0ICYmIGVxdWFsKGJ1Zi5zbGljZSgwLCA0KSwgSEVBREVSKQp9Cn0pLmNhbGwodGhpcyxfZGVyZXFfKCJidWZmZXIiKS5CdWZmZXIpCgp9LHsiYnVmZmVyIjo3LCJidWZmZXItZXF1YWwiOjZ9XSwyNzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qCm9iamVjdC1hc3NpZ24KKGMpIFNpbmRyZSBTb3JodXMKQGxpY2Vuc2UgTUlUCiovCgondXNlIHN0cmljdCc7Ci8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovCnZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwp2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5Owp2YXIgcHJvcElzRW51bWVyYWJsZSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7CgpmdW5jdGlvbiB0b09iamVjdCh2YWwpIHsKCWlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHsKCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3QuYXNzaWduIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBudWxsIG9yIHVuZGVmaW5lZCcpOwoJfQoKCXJldHVybiBPYmplY3QodmFsKTsKfQoKZnVuY3Rpb24gc2hvdWxkVXNlTmF0aXZlKCkgewoJdHJ5IHsKCQlpZiAoIU9iamVjdC5hc3NpZ24pIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gRGV0ZWN0IGJ1Z2d5IHByb3BlcnR5IGVudW1lcmF0aW9uIG9yZGVyIGluIG9sZGVyIFY4IHZlcnNpb25zLgoKCQkvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD00MTE4CgkJdmFyIHRlc3QxID0gbmV3IFN0cmluZygnYWJjJyk7ICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldy13cmFwcGVycwoJCXRlc3QxWzVdID0gJ2RlJzsKCQlpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGVzdDEpWzBdID09PSAnNScpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NgoJCXZhciB0ZXN0MiA9IHt9OwoJCWZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykgewoJCQl0ZXN0MlsnXycgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGk7CgkJfQoJCXZhciBvcmRlcjIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MikubWFwKGZ1bmN0aW9uIChuKSB7CgkJCXJldHVybiB0ZXN0MltuXTsKCQl9KTsKCQlpZiAob3JkZXIyLmpvaW4oJycpICE9PSAnMDEyMzQ1Njc4OScpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzA1NgoJCXZhciB0ZXN0MyA9IHt9OwoJCSdhYmNkZWZnaGlqa2xtbm9wcXJzdCcuc3BsaXQoJycpLmZvckVhY2goZnVuY3Rpb24gKGxldHRlcikgewoJCQl0ZXN0M1tsZXR0ZXJdID0gbGV0dGVyOwoJCX0pOwoJCWlmIChPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCB0ZXN0MykpLmpvaW4oJycpICE9PQoJCQkJJ2FiY2RlZmdoaWprbG1ub3BxcnN0JykgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCX0gY2F0Y2ggKGVycikgewoJCS8vIFdlIGRvbid0IGV4cGVjdCBhbnkgb2YgdGhlIGFib3ZlIHRvIHRocm93LCBidXQgYmV0dGVyIHRvIGJlIHNhZmUuCgkJcmV0dXJuIGZhbHNlOwoJfQp9Cgptb2R1bGUuZXhwb3J0cyA9IHNob3VsZFVzZU5hdGl2ZSgpID8gT2JqZWN0LmFzc2lnbiA6IGZ1bmN0aW9uICh0YXJnZXQsIHNvdXJjZSkgewoJdmFyIGZyb207Cgl2YXIgdG8gPSB0b09iamVjdCh0YXJnZXQpOwoJdmFyIHN5bWJvbHM7CgoJZm9yICh2YXIgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHsKCQlmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7CgoJCWZvciAodmFyIGtleSBpbiBmcm9tKSB7CgkJCWlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKGZyb20sIGtleSkpIHsKCQkJCXRvW2tleV0gPSBmcm9tW2tleV07CgkJCX0KCQl9CgoJCWlmIChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKCQkJc3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9scyhmcm9tKTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzeW1ib2xzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAocHJvcElzRW51bWVyYWJsZS5jYWxsKGZyb20sIHN5bWJvbHNbaV0pKSB7CgkJCQkJdG9bc3ltYm9sc1tpXV0gPSBmcm9tW3N5bWJvbHNbaV1dOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiB0bzsKfTsKCn0se31dLDI4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBwYXJzZUJNRm9udEFzY2lpKGRhdGEpIHsKICBpZiAoIWRhdGEpCiAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIGRhdGEgcHJvdmlkZWQnKQogIGRhdGEgPSBkYXRhLnRvU3RyaW5nKCkudHJpbSgpCgogIHZhciBvdXRwdXQgPSB7CiAgICBwYWdlczogW10sCiAgICBjaGFyczogW10sCiAgICBrZXJuaW5nczogW10KICB9CgogIHZhciBsaW5lcyA9IGRhdGEuc3BsaXQoL1xyXG4/fFxuL2cpCgogIGlmIChsaW5lcy5sZW5ndGggPT09IDApCiAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIGRhdGEgaW4gQk1Gb250IGZpbGUnKQoKICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgbGluZURhdGEgPSBzcGxpdExpbmUobGluZXNbaV0sIGkpCiAgICBpZiAoIWxpbmVEYXRhKSAvL3NraXAgZW1wdHkgbGluZXMKICAgICAgY29udGludWUKCiAgICBpZiAobGluZURhdGEua2V5ID09PSAncGFnZScpIHsKICAgICAgaWYgKHR5cGVvZiBsaW5lRGF0YS5kYXRhLmlkICE9PSAnbnVtYmVyJykKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hbGZvcm1lZCBmaWxlIGF0IGxpbmUgJyArIGkgKyAnIC0tIG5lZWRzIHBhZ2UgaWQ9TicpCiAgICAgIGlmICh0eXBlb2YgbGluZURhdGEuZGF0YS5maWxlICE9PSAnc3RyaW5nJykKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hbGZvcm1lZCBmaWxlIGF0IGxpbmUgJyArIGkgKyAnIC0tIG5lZWRzIHBhZ2UgZmlsZT0icGF0aCInKQogICAgICBvdXRwdXQucGFnZXNbbGluZURhdGEuZGF0YS5pZF0gPSBsaW5lRGF0YS5kYXRhLmZpbGUKICAgIH0gZWxzZSBpZiAobGluZURhdGEua2V5ID09PSAnY2hhcnMnIHx8IGxpbmVEYXRhLmtleSA9PT0gJ2tlcm5pbmdzJykgewogICAgICAvLy4uLiBkbyBub3RoaW5nIGZvciB0aGVzZSB0d28gLi4uCiAgICB9IGVsc2UgaWYgKGxpbmVEYXRhLmtleSA9PT0gJ2NoYXInKSB7CiAgICAgIG91dHB1dC5jaGFycy5wdXNoKGxpbmVEYXRhLmRhdGEpCiAgICB9IGVsc2UgaWYgKGxpbmVEYXRhLmtleSA9PT0gJ2tlcm5pbmcnKSB7CiAgICAgIG91dHB1dC5rZXJuaW5ncy5wdXNoKGxpbmVEYXRhLmRhdGEpCiAgICB9IGVsc2UgewogICAgICBvdXRwdXRbbGluZURhdGEua2V5XSA9IGxpbmVEYXRhLmRhdGEKICAgIH0KICB9CgogIHJldHVybiBvdXRwdXQKfQoKZnVuY3Rpb24gc3BsaXRMaW5lKGxpbmUsIGlkeCkgewogIGxpbmUgPSBsaW5lLnJlcGxhY2UoL1x0Ky9nLCAnICcpLnRyaW0oKQogIGlmICghbGluZSkKICAgIHJldHVybiBudWxsCgogIHZhciBzcGFjZSA9IGxpbmUuaW5kZXhPZignICcpCiAgaWYgKHNwYWNlID09PSAtMSkgCiAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIG5hbWVkIHJvdyBhdCBsaW5lICIgKyBpZHgpCgogIHZhciBrZXkgPSBsaW5lLnN1YnN0cmluZygwLCBzcGFjZSkKCiAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKHNwYWNlICsgMSkKICAvL2NsZWFyICJsZXR0ZXIiIGZpZWxkIGFzIGl0IGlzIG5vbi1zdGFuZGFyZCBhbmQKICAvL3JlcXVpcmVzIGFkZGl0aW9uYWwgY29tcGxleGl0eSB0byBwYXJzZSAiIC8gPSBzeW1ib2xzCiAgbGluZSA9IGxpbmUucmVwbGFjZSgvbGV0dGVyPVtcJ1wiXVxTK1tcJ1wiXS9naSwgJycpICAKICBsaW5lID0gbGluZS5zcGxpdCgiPSIpCiAgbGluZSA9IGxpbmUubWFwKGZ1bmN0aW9uKHN0cikgewogICAgcmV0dXJuIHN0ci50cmltKCkubWF0Y2goKC8oIi4qPyJ8W14iXHNdKykrKD89XHMqfFxzKiQpL2cpKQogIH0pCgogIHZhciBkYXRhID0gW10KICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkdCA9IGxpbmVbaV0KICAgIGlmIChpID09PSAwKSB7CiAgICAgIGRhdGEucHVzaCh7CiAgICAgICAga2V5OiBkdFswXSwKICAgICAgICBkYXRhOiAiIgogICAgICB9KQogICAgfSBlbHNlIGlmIChpID09PSBsaW5lLmxlbmd0aCAtIDEpIHsKICAgICAgZGF0YVtkYXRhLmxlbmd0aCAtIDFdLmRhdGEgPSBwYXJzZURhdGEoZHRbMF0pCiAgICB9IGVsc2UgewogICAgICBkYXRhW2RhdGEubGVuZ3RoIC0gMV0uZGF0YSA9IHBhcnNlRGF0YShkdFswXSkKICAgICAgZGF0YS5wdXNoKHsKICAgICAgICBrZXk6IGR0WzFdLAogICAgICAgIGRhdGE6ICIiCiAgICAgIH0pCiAgICB9CiAgfQoKICB2YXIgb3V0ID0gewogICAga2V5OiBrZXksCiAgICBkYXRhOiB7fQogIH0KCiAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgIG91dC5kYXRhW3Yua2V5XSA9IHYuZGF0YTsKICB9KQoKICByZXR1cm4gb3V0Cn0KCmZ1bmN0aW9uIHBhcnNlRGF0YShkYXRhKSB7CiAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKQogICAgcmV0dXJuICIiCgogIGlmIChkYXRhLmluZGV4T2YoJyInKSA9PT0gMCB8fCBkYXRhLmluZGV4T2YoIiciKSA9PT0gMCkKICAgIHJldHVybiBkYXRhLnN1YnN0cmluZygxLCBkYXRhLmxlbmd0aCAtIDEpCiAgaWYgKGRhdGEuaW5kZXhPZignLCcpICE9PSAtMSkKICAgIHJldHVybiBwYXJzZUludExpc3QoZGF0YSkKICByZXR1cm4gcGFyc2VJbnQoZGF0YSwgMTApCn0KCmZ1bmN0aW9uIHBhcnNlSW50TGlzdChkYXRhKSB7CiAgcmV0dXJuIGRhdGEuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24odmFsKSB7CiAgICByZXR1cm4gcGFyc2VJbnQodmFsLCAxMCkKICB9KQp9Cn0se31dLDI5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIEhFQURFUiA9IFs2NiwgNzcsIDcwXQoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiByZWFkQk1Gb250QmluYXJ5KGJ1ZikgewogIGlmIChidWYubGVuZ3RoIDwgNikKICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBidWZmZXIgbGVuZ3RoIGZvciBCTUZvbnQnKQoKICB2YXIgaGVhZGVyID0gSEVBREVSLmV2ZXJ5KGZ1bmN0aW9uKGJ5dGUsIGkpIHsKICAgIHJldHVybiBidWYucmVhZFVJbnQ4KGkpID09PSBieXRlCiAgfSkKCiAgaWYgKCFoZWFkZXIpCiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JNRm9udCBtaXNzaW5nIEJNRiBieXRlIGhlYWRlcicpCgogIHZhciBpID0gMwogIHZhciB2ZXJzID0gYnVmLnJlYWRVSW50OChpKyspCiAgaWYgKHZlcnMgPiAzKQogICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IHN1cHBvcnRzIEJNRm9udCBCaW5hcnkgdjMgKEJNRm9udCBBcHAgdjEuMTApJykKICAKICB2YXIgdGFyZ2V0ID0geyBrZXJuaW5nczogW10sIGNoYXJzOiBbXSB9CiAgZm9yICh2YXIgYj0wOyBiPDU7IGIrKykKICAgIGkgKz0gcmVhZEJsb2NrKHRhcmdldCwgYnVmLCBpKQogIHJldHVybiB0YXJnZXQKfQoKZnVuY3Rpb24gcmVhZEJsb2NrKHRhcmdldCwgYnVmLCBpKSB7CiAgaWYgKGkgPiBidWYubGVuZ3RoLTEpCiAgICByZXR1cm4gMAoKICB2YXIgYmxvY2tJRCA9IGJ1Zi5yZWFkVUludDgoaSsrKQogIHZhciBibG9ja1NpemUgPSBidWYucmVhZEludDMyTEUoaSkKICBpICs9IDQKCiAgc3dpdGNoKGJsb2NrSUQpIHsKICAgIGNhc2UgMTogCiAgICAgIHRhcmdldC5pbmZvID0gcmVhZEluZm8oYnVmLCBpKQogICAgICBicmVhawogICAgY2FzZSAyOgogICAgICB0YXJnZXQuY29tbW9uID0gcmVhZENvbW1vbihidWYsIGkpCiAgICAgIGJyZWFrCiAgICBjYXNlIDM6CiAgICAgIHRhcmdldC5wYWdlcyA9IHJlYWRQYWdlcyhidWYsIGksIGJsb2NrU2l6ZSkKICAgICAgYnJlYWsKICAgIGNhc2UgNDoKICAgICAgdGFyZ2V0LmNoYXJzID0gcmVhZENoYXJzKGJ1ZiwgaSwgYmxvY2tTaXplKQogICAgICBicmVhawogICAgY2FzZSA1OgogICAgICB0YXJnZXQua2VybmluZ3MgPSByZWFkS2VybmluZ3MoYnVmLCBpLCBibG9ja1NpemUpCiAgICAgIGJyZWFrCiAgfQogIHJldHVybiA1ICsgYmxvY2tTaXplCn0KCmZ1bmN0aW9uIHJlYWRJbmZvKGJ1ZiwgaSkgewogIHZhciBpbmZvID0ge30KICBpbmZvLnNpemUgPSBidWYucmVhZEludDE2TEUoaSkKCiAgdmFyIGJpdEZpZWxkID0gYnVmLnJlYWRVSW50OChpKzIpCiAgaW5mby5zbW9vdGggPSAoYml0RmllbGQgPj4gNykgJiAxCiAgaW5mby51bmljb2RlID0gKGJpdEZpZWxkID4+IDYpICYgMQogIGluZm8uaXRhbGljID0gKGJpdEZpZWxkID4+IDUpICYgMQogIGluZm8uYm9sZCA9IChiaXRGaWVsZCA+PiA0KSAmIDEKICAKICAvL2ZpeGVkSGVpZ2h0IGlzIG9ubHkgbWVudGlvbmVkIGluIGJpbmFyeSBzcGVjIAogIGlmICgoYml0RmllbGQgPj4gMykgJiAxKQogICAgaW5mby5maXhlZEhlaWdodCA9IDEKICAKICBpbmZvLmNoYXJzZXQgPSBidWYucmVhZFVJbnQ4KGkrMykgfHwgJycKICBpbmZvLnN0cmV0Y2hIID0gYnVmLnJlYWRVSW50MTZMRShpKzQpCiAgaW5mby5hYSA9IGJ1Zi5yZWFkVUludDgoaSs2KQogIGluZm8ucGFkZGluZyA9IFsKICAgIGJ1Zi5yZWFkSW50OChpKzcpLAogICAgYnVmLnJlYWRJbnQ4KGkrOCksCiAgICBidWYucmVhZEludDgoaSs5KSwKICAgIGJ1Zi5yZWFkSW50OChpKzEwKQogIF0KICBpbmZvLnNwYWNpbmcgPSBbCiAgICBidWYucmVhZEludDgoaSsxMSksCiAgICBidWYucmVhZEludDgoaSsxMikKICBdCiAgaW5mby5vdXRsaW5lID0gYnVmLnJlYWRVSW50OChpKzEzKQogIGluZm8uZmFjZSA9IHJlYWRTdHJpbmdOVChidWYsIGkrMTQpCiAgcmV0dXJuIGluZm8KfQoKZnVuY3Rpb24gcmVhZENvbW1vbihidWYsIGkpIHsKICB2YXIgY29tbW9uID0ge30KICBjb21tb24ubGluZUhlaWdodCA9IGJ1Zi5yZWFkVUludDE2TEUoaSkKICBjb21tb24uYmFzZSA9IGJ1Zi5yZWFkVUludDE2TEUoaSsyKQogIGNvbW1vbi5zY2FsZVcgPSBidWYucmVhZFVJbnQxNkxFKGkrNCkKICBjb21tb24uc2NhbGVIID0gYnVmLnJlYWRVSW50MTZMRShpKzYpCiAgY29tbW9uLnBhZ2VzID0gYnVmLnJlYWRVSW50MTZMRShpKzgpCiAgdmFyIGJpdEZpZWxkID0gYnVmLnJlYWRVSW50OChpKzEwKQogIGNvbW1vbi5wYWNrZWQgPSAwCiAgY29tbW9uLmFscGhhQ2hubCA9IGJ1Zi5yZWFkVUludDgoaSsxMSkKICBjb21tb24ucmVkQ2hubCA9IGJ1Zi5yZWFkVUludDgoaSsxMikKICBjb21tb24uZ3JlZW5DaG5sID0gYnVmLnJlYWRVSW50OChpKzEzKQogIGNvbW1vbi5ibHVlQ2hubCA9IGJ1Zi5yZWFkVUludDgoaSsxNCkKICByZXR1cm4gY29tbW9uCn0KCmZ1bmN0aW9uIHJlYWRQYWdlcyhidWYsIGksIHNpemUpIHsKICB2YXIgcGFnZXMgPSBbXQogIHZhciB0ZXh0ID0gcmVhZE5hbWVOVChidWYsIGkpCiAgdmFyIGxlbiA9IHRleHQubGVuZ3RoKzEKICB2YXIgY291bnQgPSBzaXplIC8gbGVuCiAgZm9yICh2YXIgYz0wOyBjPGNvdW50OyBjKyspIHsKICAgIHBhZ2VzW2NdID0gYnVmLnNsaWNlKGksIGkrdGV4dC5sZW5ndGgpLnRvU3RyaW5nKCd1dGY4JykKICAgIGkgKz0gbGVuCiAgfQogIHJldHVybiBwYWdlcwp9CgpmdW5jdGlvbiByZWFkQ2hhcnMoYnVmLCBpLCBibG9ja1NpemUpIHsKICB2YXIgY2hhcnMgPSBbXQoKICB2YXIgY291bnQgPSBibG9ja1NpemUgLyAyMAogIGZvciAodmFyIGM9MDsgYzxjb3VudDsgYysrKSB7CiAgICB2YXIgY2hhciA9IHt9CiAgICB2YXIgb2ZmID0gYyoyMAogICAgY2hhci5pZCA9IGJ1Zi5yZWFkVUludDMyTEUoaSArIDAgKyBvZmYpCiAgICBjaGFyLnggPSBidWYucmVhZFVJbnQxNkxFKGkgKyA0ICsgb2ZmKQogICAgY2hhci55ID0gYnVmLnJlYWRVSW50MTZMRShpICsgNiArIG9mZikKICAgIGNoYXIud2lkdGggPSBidWYucmVhZFVJbnQxNkxFKGkgKyA4ICsgb2ZmKQogICAgY2hhci5oZWlnaHQgPSBidWYucmVhZFVJbnQxNkxFKGkgKyAxMCArIG9mZikKICAgIGNoYXIueG9mZnNldCA9IGJ1Zi5yZWFkSW50MTZMRShpICsgMTIgKyBvZmYpCiAgICBjaGFyLnlvZmZzZXQgPSBidWYucmVhZEludDE2TEUoaSArIDE0ICsgb2ZmKQogICAgY2hhci54YWR2YW5jZSA9IGJ1Zi5yZWFkSW50MTZMRShpICsgMTYgKyBvZmYpCiAgICBjaGFyLnBhZ2UgPSBidWYucmVhZFVJbnQ4KGkgKyAxOCArIG9mZikKICAgIGNoYXIuY2hubCA9IGJ1Zi5yZWFkVUludDgoaSArIDE5ICsgb2ZmKQogICAgY2hhcnNbY10gPSBjaGFyCiAgfQogIHJldHVybiBjaGFycwp9CgpmdW5jdGlvbiByZWFkS2VybmluZ3MoYnVmLCBpLCBibG9ja1NpemUpIHsKICB2YXIga2VybmluZ3MgPSBbXQogIHZhciBjb3VudCA9IGJsb2NrU2l6ZSAvIDEwCiAgZm9yICh2YXIgYz0wOyBjPGNvdW50OyBjKyspIHsKICAgIHZhciBrZXJuID0ge30KICAgIHZhciBvZmYgPSBjKjEwCiAgICBrZXJuLmZpcnN0ID0gYnVmLnJlYWRVSW50MzJMRShpICsgMCArIG9mZikKICAgIGtlcm4uc2Vjb25kID0gYnVmLnJlYWRVSW50MzJMRShpICsgNCArIG9mZikKICAgIGtlcm4uYW1vdW50ID0gYnVmLnJlYWRJbnQxNkxFKGkgKyA4ICsgb2ZmKQogICAga2VybmluZ3NbY10gPSBrZXJuCiAgfQogIHJldHVybiBrZXJuaW5ncwp9CgpmdW5jdGlvbiByZWFkTmFtZU5UKGJ1Ziwgb2Zmc2V0KSB7CiAgdmFyIHBvcz1vZmZzZXQKICBmb3IgKDsgcG9zPGJ1Zi5sZW5ndGg7IHBvcysrKSB7CiAgICBpZiAoYnVmW3Bvc10gPT09IDB4MDApIAogICAgICBicmVhawogIH0KICByZXR1cm4gYnVmLnNsaWNlKG9mZnNldCwgcG9zKQp9CgpmdW5jdGlvbiByZWFkU3RyaW5nTlQoYnVmLCBvZmZzZXQpIHsKICByZXR1cm4gcmVhZE5hbWVOVChidWYsIG9mZnNldCkudG9TdHJpbmcoJ3V0ZjgnKQp9Cn0se31dLDMwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHBhcnNlQXR0cmlidXRlcyA9IF9kZXJlcV8oJy4vcGFyc2UtYXR0cmlicycpCnZhciBwYXJzZUZyb21TdHJpbmcgPSBfZGVyZXFfKCd4bWwtcGFyc2UtZnJvbS1zdHJpbmcnKQoKLy9JbiBzb21lIGNhc2VzIGVsZW1lbnQuYXR0cmlidXRlLm5vZGVOYW1lIGNhbiByZXR1cm4KLy9hbGwgbG93ZXJjYXNlIHZhbHVlcy4uIHNvIHdlIG5lZWQgdG8gbWFwIHRoZW0gdG8gdGhlIGNvcnJlY3QgCi8vY2FzZQp2YXIgTkFNRV9NQVAgPSB7CiAgc2NhbGVoOiAnc2NhbGVIJywKICBzY2FsZXc6ICdzY2FsZVcnLAogIHN0cmV0Y2hoOiAnc3RyZXRjaEgnLAogIGxpbmVoZWlnaHQ6ICdsaW5lSGVpZ2h0JywKICBhbHBoYWNobmw6ICdhbHBoYUNobmwnLAogIHJlZGNobmw6ICdyZWRDaG5sJywKICBncmVlbmNobmw6ICdncmVlbkNobmwnLAogIGJsdWVjaG5sOiAnYmx1ZUNobmwnCn0KCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gcGFyc2UoZGF0YSkgewogIGRhdGEgPSBkYXRhLnRvU3RyaW5nKCkKICAKICB2YXIgeG1sUm9vdCA9IHBhcnNlRnJvbVN0cmluZyhkYXRhKQogIHZhciBvdXRwdXQgPSB7CiAgICBwYWdlczogW10sCiAgICBjaGFyczogW10sCiAgICBrZXJuaW5nczogW10KICB9CgogIC8vZ2V0IGNvbmZpZyBzZXR0aW5ncwogIDtbJ2luZm8nLCAnY29tbW9uJ10uZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgIHZhciBlbGVtZW50ID0geG1sUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZShrZXkpWzBdCiAgICBpZiAoZWxlbWVudCkKICAgICAgb3V0cHV0W2tleV0gPSBwYXJzZUF0dHJpYnV0ZXMoZ2V0QXR0cmlicyhlbGVtZW50KSkKICB9KQoKICAvL2dldCBwYWdlIGluZm8KICB2YXIgcGFnZVJvb3QgPSB4bWxSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdwYWdlcycpWzBdCiAgaWYgKCFwYWdlUm9vdCkKICAgIHRocm93IG5ldyBFcnJvcignbWFsZm9ybWVkIGZpbGUgLS0gbm8gPHBhZ2VzPiBlbGVtZW50JykKICB2YXIgcGFnZXMgPSBwYWdlUm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgncGFnZScpCiAgZm9yICh2YXIgaT0wOyBpPHBhZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcCA9IHBhZ2VzW2ldCiAgICB2YXIgaWQgPSBwYXJzZUludChwLmdldEF0dHJpYnV0ZSgnaWQnKSwgMTApCiAgICB2YXIgZmlsZSA9IHAuZ2V0QXR0cmlidXRlKCdmaWxlJykKICAgIGlmIChpc05hTihpZCkpCiAgICAgIHRocm93IG5ldyBFcnJvcignbWFsZm9ybWVkIGZpbGUgLS0gcGFnZSAiaWQiIGF0dHJpYnV0ZSBpcyBOYU4nKQogICAgaWYgKCFmaWxlKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21hbGZvcm1lZCBmaWxlIC0tIG5lZWRzIHBhZ2UgImZpbGUiIGF0dHJpYnV0ZScpCiAgICBvdXRwdXQucGFnZXNbcGFyc2VJbnQoaWQsIDEwKV0gPSBmaWxlCiAgfQoKICAvL2dldCBrZXJuaW5ncyAvIGNoYXJzCiAgO1snY2hhcnMnLCAna2VybmluZ3MnXS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgdmFyIGVsZW1lbnQgPSB4bWxSb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKGtleSlbMF0KICAgIGlmICghZWxlbWVudCkKICAgICAgcmV0dXJuCiAgICB2YXIgY2hpbGRUYWcgPSBrZXkuc3Vic3RyaW5nKDAsIGtleS5sZW5ndGgtMSkKICAgIHZhciBjaGlsZHJlbiA9IGVsZW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoY2hpbGRUYWcpCiAgICBmb3IgKHZhciBpPTA7IGk8Y2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsgICAgICAKICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV0KICAgICAgb3V0cHV0W2tleV0ucHVzaChwYXJzZUF0dHJpYnV0ZXMoZ2V0QXR0cmlicyhjaGlsZCkpKQogICAgfQogIH0pCiAgcmV0dXJuIG91dHB1dAp9CgpmdW5jdGlvbiBnZXRBdHRyaWJzKGVsZW1lbnQpIHsKICB2YXIgYXR0cmlicyA9IGdldEF0dHJpYkxpc3QoZWxlbWVudCkKICByZXR1cm4gYXR0cmlicy5yZWR1Y2UoZnVuY3Rpb24oZGljdCwgYXR0cmliKSB7CiAgICB2YXIga2V5ID0gbWFwTmFtZShhdHRyaWIubm9kZU5hbWUpCiAgICBkaWN0W2tleV0gPSBhdHRyaWIubm9kZVZhbHVlCiAgICByZXR1cm4gZGljdAogIH0sIHt9KQp9CgpmdW5jdGlvbiBnZXRBdHRyaWJMaXN0KGVsZW1lbnQpIHsKICAvL0lFOCsgYW5kIG1vZGVybiBicm93c2VycwogIHZhciBhdHRyaWJzID0gW10KICBmb3IgKHZhciBpPTA7IGk8ZWxlbWVudC5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKQogICAgYXR0cmlicy5wdXNoKGVsZW1lbnQuYXR0cmlidXRlc1tpXSkKICByZXR1cm4gYXR0cmlicwp9CgpmdW5jdGlvbiBtYXBOYW1lKG5vZGVOYW1lKSB7CiAgcmV0dXJuIE5BTUVfTUFQW25vZGVOYW1lLnRvTG93ZXJDYXNlKCldIHx8IG5vZGVOYW1lCn0KfSx7Ii4vcGFyc2UtYXR0cmlicyI6MzEsInhtbC1wYXJzZS1mcm9tLXN0cmluZyI6NTJ9XSwzMTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8vU29tZSB2ZXJzaW9ucyBvZiBHbHlwaERlc2lnbmVyIGhhdmUgYSB0eXBvCi8vdGhhdCBjYXVzZXMgc29tZSBidWdzIHdpdGggcGFyc2luZy4gCi8vTmVlZCB0byBjb25maXJtIHdpdGggcmVjZW50IHZlcnNpb24gb2YgdGhlIHNvZnR3YXJlCi8vdG8gc2VlIHdoZXRoZXIgdGhpcyBpcyBzdGlsbCBhbiBpc3N1ZSBvciBub3QuCnZhciBHTFlQSF9ERVNJR05FUl9FUlJPUiA9ICdjaGFzcnNldCcKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gcGFyc2VBdHRyaWJ1dGVzKG9iaikgewogIGlmIChHTFlQSF9ERVNJR05FUl9FUlJPUiBpbiBvYmopIHsKICAgIG9ialsnY2hhcnNldCddID0gb2JqW0dMWVBIX0RFU0lHTkVSX0VSUk9SXQogICAgZGVsZXRlIG9ialtHTFlQSF9ERVNJR05FUl9FUlJPUl0KICB9CgogIGZvciAodmFyIGsgaW4gb2JqKSB7CiAgICBpZiAoayA9PT0gJ2ZhY2UnIHx8IGsgPT09ICdjaGFyc2V0JykgCiAgICAgIGNvbnRpbnVlCiAgICBlbHNlIGlmIChrID09PSAncGFkZGluZycgfHwgayA9PT0gJ3NwYWNpbmcnKQogICAgICBvYmpba10gPSBwYXJzZUludExpc3Qob2JqW2tdKQogICAgZWxzZQogICAgICBvYmpba10gPSBwYXJzZUludChvYmpba10sIDEwKSAKICB9CiAgcmV0dXJuIG9iagp9CgpmdW5jdGlvbiBwYXJzZUludExpc3QoZGF0YSkgewogIHJldHVybiBkYXRhLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uKHZhbCkgewogICAgcmV0dXJuIHBhcnNlSW50KHZhbCwgMTApCiAgfSkKfQp9LHt9XSwzMjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciB0cmltID0gX2RlcmVxXygndHJpbScpCiAgLCBmb3JFYWNoID0gX2RlcmVxXygnZm9yLWVhY2gnKQogICwgaXNBcnJheSA9IGZ1bmN0aW9uKGFyZykgewogICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZykgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICB9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChoZWFkZXJzKSB7CiAgaWYgKCFoZWFkZXJzKQogICAgcmV0dXJuIHt9CgogIHZhciByZXN1bHQgPSB7fQoKICBmb3JFYWNoKAogICAgICB0cmltKGhlYWRlcnMpLnNwbGl0KCdcbicpCiAgICAsIGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICB2YXIgaW5kZXggPSByb3cuaW5kZXhPZignOicpCiAgICAgICAgICAsIGtleSA9IHRyaW0ocm93LnNsaWNlKDAsIGluZGV4KSkudG9Mb3dlckNhc2UoKQogICAgICAgICAgLCB2YWx1ZSA9IHRyaW0ocm93LnNsaWNlKGluZGV4ICsgMSkpCgogICAgICAgIGlmICh0eXBlb2YocmVzdWx0W2tleV0pID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZQogICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShyZXN1bHRba2V5XSkpIHsKICAgICAgICAgIHJlc3VsdFtrZXldLnB1c2godmFsdWUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdFtrZXldID0gWyByZXN1bHRba2V5XSwgdmFsdWUgXQogICAgICAgIH0KICAgICAgfQogICkKCiAgcmV0dXJuIHJlc3VsdAp9Cn0seyJmb3ItZWFjaCI6MTYsInRyaW0iOjQ4fV0sMzM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7CnZhciBwZXJmb3JtYW5jZSA9IGdsb2JhbC5wZXJmb3JtYW5jZSB8fCB7fTsKCnZhciBwcmVzZW50ID0gKGZ1bmN0aW9uICgpIHsKICB2YXIgbmFtZXMgPSBbJ25vdycsICd3ZWJraXROb3cnLCAnbXNOb3cnLCAnbW96Tm93JywgJ29Ob3cnXTsKICB3aGlsZSAobmFtZXMubGVuZ3RoKSB7CiAgICB2YXIgbmFtZSA9IG5hbWVzLnNoaWZ0KCk7CiAgICBpZiAobmFtZSBpbiBwZXJmb3JtYW5jZSkgewogICAgICByZXR1cm4gcGVyZm9ybWFuY2VbbmFtZV0uYmluZChwZXJmb3JtYW5jZSk7CiAgICB9CiAgfQoKICB2YXIgZGF0ZU5vdyA9IERhdGUubm93IHx8IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9OwogIHZhciBuYXZpZ2F0aW9uU3RhcnQgPSAocGVyZm9ybWFuY2UudGltaW5nIHx8IHt9KS5uYXZpZ2F0aW9uU3RhcnQgfHwgZGF0ZU5vdygpOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZGF0ZU5vdygpIC0gbmF2aWdhdGlvblN0YXJ0OwogIH07Cn0oKSk7CgpwcmVzZW50LnBlcmZvcm1hbmNlTm93ID0gcGVyZm9ybWFuY2Uubm93OwpwcmVzZW50Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgcGVyZm9ybWFuY2Uubm93ID0gcHJlc2VudC5wZXJmb3JtYW5jZU5vdzsKfTsKcHJlc2VudC5jb25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICBwZXJmb3JtYW5jZS5ub3cgPSBwcmVzZW50Owp9OwpwcmVzZW50LmNvbmZsaWN0KCk7Cgptb2R1bGUuZXhwb3J0cyA9IHByZXNlbnQ7Cgp9KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCn0se31dLDM0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChzZXRJbW1lZGlhdGUpewooZnVuY3Rpb24ocm9vdCkgewoKCS8vIFN0b3JlIHNldFRpbWVvdXQgcmVmZXJlbmNlIHNvIHByb21pc2UtcG9seWZpbGwgd2lsbCBiZSB1bmFmZmVjdGVkIGJ5CgkvLyBvdGhlciBjb2RlIG1vZGlmeWluZyBzZXRUaW1lb3V0IChsaWtlIHNpbm9uLnVzZUZha2VUaW1lcnMoKSkKCXZhciBzZXRUaW1lb3V0RnVuYyA9IHNldFRpbWVvdXQ7CgoJLy8gVXNlIHBvbHlmaWxsIGZvciBzZXRJbW1lZGlhdGUgZm9yIHBlcmZvcm1hbmNlIGdhaW5zCgl2YXIgYXNhcCA9ICh0eXBlb2Ygc2V0SW1tZWRpYXRlID09PSAnZnVuY3Rpb24nICYmIHNldEltbWVkaWF0ZSkgfHwKCQlmdW5jdGlvbihmbikgeyBzZXRUaW1lb3V0RnVuYyhmbiwgMSk7IH07CgoJLy8gUG9seWZpbGwgZm9yIEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kCglmdW5jdGlvbiBiaW5kKGZuLCB0aGlzQXJnKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQlmbi5hcHBseSh0aGlzQXJnLCBhcmd1bWVudHMpOwoJCX0KCX0KCgl2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICJbb2JqZWN0IEFycmF5XSIgfTsKCglmdW5jdGlvbiBQcm9taXNlKGZuKSB7CgkJaWYgKHR5cGVvZiB0aGlzICE9PSAnb2JqZWN0JykgdGhyb3cgbmV3IFR5cGVFcnJvcignUHJvbWlzZXMgbXVzdCBiZSBjb25zdHJ1Y3RlZCB2aWEgbmV3Jyk7CgkJaWYgKHR5cGVvZiBmbiAhPT0gJ2Z1bmN0aW9uJykgdGhyb3cgbmV3IFR5cGVFcnJvcignbm90IGEgZnVuY3Rpb24nKTsKCQl0aGlzLl9zdGF0ZSA9IG51bGw7CgkJdGhpcy5fdmFsdWUgPSBudWxsOwoJCXRoaXMuX2RlZmVycmVkcyA9IFtdCgoJCWRvUmVzb2x2ZShmbiwgYmluZChyZXNvbHZlLCB0aGlzKSwgYmluZChyZWplY3QsIHRoaXMpKQoJfQoKCWZ1bmN0aW9uIGhhbmRsZShkZWZlcnJlZCkgewoJCXZhciBtZSA9IHRoaXM7CgkJaWYgKHRoaXMuX3N0YXRlID09PSBudWxsKSB7CgkJCXRoaXMuX2RlZmVycmVkcy5wdXNoKGRlZmVycmVkKTsKCQkJcmV0dXJuCgkJfQoJCWFzYXAoZnVuY3Rpb24oKSB7CgkJCXZhciBjYiA9IG1lLl9zdGF0ZSA/IGRlZmVycmVkLm9uRnVsZmlsbGVkIDogZGVmZXJyZWQub25SZWplY3RlZAoJCQlpZiAoY2IgPT09IG51bGwpIHsKCQkJCShtZS5fc3RhdGUgPyBkZWZlcnJlZC5yZXNvbHZlIDogZGVmZXJyZWQucmVqZWN0KShtZS5fdmFsdWUpOwoJCQkJcmV0dXJuOwoJCQl9CgkJCXZhciByZXQ7CgkJCXRyeSB7CgkJCQlyZXQgPSBjYihtZS5fdmFsdWUpOwoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQlkZWZlcnJlZC5yZWplY3QoZSk7CgkJCQlyZXR1cm47CgkJCX0KCQkJZGVmZXJyZWQucmVzb2x2ZShyZXQpOwoJCX0pCgl9CgoJZnVuY3Rpb24gcmVzb2x2ZShuZXdWYWx1ZSkgewoJCXRyeSB7IC8vUHJvbWlzZSBSZXNvbHV0aW9uIFByb2NlZHVyZTogaHR0cHM6Ly9naXRodWIuY29tL3Byb21pc2VzLWFwbHVzL3Byb21pc2VzLXNwZWMjdGhlLXByb21pc2UtcmVzb2x1dGlvbi1wcm9jZWR1cmUKCQkJaWYgKG5ld1ZhbHVlID09PSB0aGlzKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdBIHByb21pc2UgY2Fubm90IGJlIHJlc29sdmVkIHdpdGggaXRzZWxmLicpOwoJCQlpZiAobmV3VmFsdWUgJiYgKHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKSkgewoJCQkJdmFyIHRoZW4gPSBuZXdWYWx1ZS50aGVuOwoJCQkJaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7CgkJCQkJZG9SZXNvbHZlKGJpbmQodGhlbiwgbmV3VmFsdWUpLCBiaW5kKHJlc29sdmUsIHRoaXMpLCBiaW5kKHJlamVjdCwgdGhpcykpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoJCQl0aGlzLl9zdGF0ZSA9IHRydWU7CgkJCXRoaXMuX3ZhbHVlID0gbmV3VmFsdWU7CgkJCWZpbmFsZS5jYWxsKHRoaXMpOwoJCX0gY2F0Y2ggKGUpIHsgcmVqZWN0LmNhbGwodGhpcywgZSk7IH0KCX0KCglmdW5jdGlvbiByZWplY3QobmV3VmFsdWUpIHsKCQl0aGlzLl9zdGF0ZSA9IGZhbHNlOwoJCXRoaXMuX3ZhbHVlID0gbmV3VmFsdWU7CgkJZmluYWxlLmNhbGwodGhpcyk7Cgl9CgoJZnVuY3Rpb24gZmluYWxlKCkgewoJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9kZWZlcnJlZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCQkJaGFuZGxlLmNhbGwodGhpcywgdGhpcy5fZGVmZXJyZWRzW2ldKTsKCQl9CgkJdGhpcy5fZGVmZXJyZWRzID0gbnVsbDsKCX0KCglmdW5jdGlvbiBIYW5kbGVyKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkLCByZXNvbHZlLCByZWplY3QpewoJCXRoaXMub25GdWxmaWxsZWQgPSB0eXBlb2Ygb25GdWxmaWxsZWQgPT09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IG51bGw7CgkJdGhpcy5vblJlamVjdGVkID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT09ICdmdW5jdGlvbicgPyBvblJlamVjdGVkIDogbnVsbDsKCQl0aGlzLnJlc29sdmUgPSByZXNvbHZlOwoJCXRoaXMucmVqZWN0ID0gcmVqZWN0OwoJfQoKCS8qKgoJICogVGFrZSBhIHBvdGVudGlhbGx5IG1pc2JlaGF2aW5nIHJlc29sdmVyIGZ1bmN0aW9uIGFuZCBtYWtlIHN1cmUKCSAqIG9uRnVsZmlsbGVkIGFuZCBvblJlamVjdGVkIGFyZSBvbmx5IGNhbGxlZCBvbmNlLgoJICoKCSAqIE1ha2VzIG5vIGd1YXJhbnRlZXMgYWJvdXQgYXN5bmNocm9ueS4KCSAqLwoJZnVuY3Rpb24gZG9SZXNvbHZlKGZuLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewoJCXZhciBkb25lID0gZmFsc2U7CgkJdHJ5IHsKCQkJZm4oZnVuY3Rpb24gKHZhbHVlKSB7CgkJCQlpZiAoZG9uZSkgcmV0dXJuOwoJCQkJZG9uZSA9IHRydWU7CgkJCQlvbkZ1bGZpbGxlZCh2YWx1ZSk7CgkJCX0sIGZ1bmN0aW9uIChyZWFzb24pIHsKCQkJCWlmIChkb25lKSByZXR1cm47CgkJCQlkb25lID0gdHJ1ZTsKCQkJCW9uUmVqZWN0ZWQocmVhc29uKTsKCQkJfSkKCQl9IGNhdGNoIChleCkgewoJCQlpZiAoZG9uZSkgcmV0dXJuOwoJCQlkb25lID0gdHJ1ZTsKCQkJb25SZWplY3RlZChleCk7CgkJfQoJfQoKCVByb21pc2UucHJvdG90eXBlWydjYXRjaCddID0gZnVuY3Rpb24gKG9uUmVqZWN0ZWQpIHsKCQlyZXR1cm4gdGhpcy50aGVuKG51bGwsIG9uUmVqZWN0ZWQpOwoJfTsKCglQcm9taXNlLnByb3RvdHlwZS50aGVuID0gZnVuY3Rpb24ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpIHsKCQl2YXIgbWUgPSB0aGlzOwoJCXJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKCQkJaGFuZGxlLmNhbGwobWUsIG5ldyBIYW5kbGVyKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkLCByZXNvbHZlLCByZWplY3QpKTsKCQl9KQoJfTsKCglQcm9taXNlLmFsbCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShhcmd1bWVudHNbMF0pID8gYXJndW1lbnRzWzBdIDogYXJndW1lbnRzKTsKCgkJcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCQkJaWYgKGFyZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gcmVzb2x2ZShbXSk7CgkJCXZhciByZW1haW5pbmcgPSBhcmdzLmxlbmd0aDsKCQkJZnVuY3Rpb24gcmVzKGksIHZhbCkgewoJCQkJdHJ5IHsKCQkJCQlpZiAodmFsICYmICh0eXBlb2YgdmFsID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nKSkgewoJCQkJCQl2YXIgdGhlbiA9IHZhbC50aGVuOwoJCQkJCQlpZiAodHlwZW9mIHRoZW4gPT09ICdmdW5jdGlvbicpIHsKCQkJCQkJCXRoZW4uY2FsbCh2YWwsIGZ1bmN0aW9uICh2YWwpIHsgcmVzKGksIHZhbCkgfSwgcmVqZWN0KTsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCX0KCQkJCQlhcmdzW2ldID0gdmFsOwoJCQkJCWlmICgtLXJlbWFpbmluZyA9PT0gMCkgewoJCQkJCQlyZXNvbHZlKGFyZ3MpOwoJCQkJCX0KCQkJCX0gY2F0Y2ggKGV4KSB7CgkJCQkJcmVqZWN0KGV4KTsKCQkJCX0KCQkJfQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKCQkJCXJlcyhpLCBhcmdzW2ldKTsKCQkJfQoJCX0pOwoJfTsKCglQcm9taXNlLnJlc29sdmUgPSBmdW5jdGlvbiAodmFsdWUpIHsKCQlpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gUHJvbWlzZSkgewoJCQlyZXR1cm4gdmFsdWU7CgkJfQoKCQlyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKCQkJcmVzb2x2ZSh2YWx1ZSk7CgkJfSk7Cgl9OwoKCVByb21pc2UucmVqZWN0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CgkJcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCQkJcmVqZWN0KHZhbHVlKTsKCQl9KTsKCX07CgoJUHJvbWlzZS5yYWNlID0gZnVuY3Rpb24gKHZhbHVlcykgewoJCXJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgkJCWZvcih2YXIgaSA9IDAsIGxlbiA9IHZhbHVlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJCQkJdmFsdWVzW2ldLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKCQkJfQoJCX0pOwoJfTsKCgkvKioKCSAqIFNldCB0aGUgaW1tZWRpYXRlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgY2FsbGJhY2tzCgkgKiBAcGFyYW0gZm4ge2Z1bmN0aW9ufSBGdW5jdGlvbiB0byBleGVjdXRlCgkgKiBAcHJpdmF0ZQoJICovCglQcm9taXNlLl9zZXRJbW1lZGlhdGVGbiA9IGZ1bmN0aW9uIF9zZXRJbW1lZGlhdGVGbihmbikgewoJCWFzYXAgPSBmbjsKCX07CgoJaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CgkJbW9kdWxlLmV4cG9ydHMgPSBQcm9taXNlOwoJfSBlbHNlIGlmICghcm9vdC5Qcm9taXNlKSB7CgkJcm9vdC5Qcm9taXNlID0gUHJvbWlzZTsKCX0KCn0pKHRoaXMpOwoKfSkuY2FsbCh0aGlzLF9kZXJlcV8oInRpbWVycyIpLnNldEltbWVkaWF0ZSkKCn0seyJ0aW1lcnMiOjQ2fV0sMzU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZHR5cGUgPSBfZGVyZXFfKCdkdHlwZScpCnZhciBhbkFycmF5ID0gX2RlcmVxXygnYW4tYXJyYXknKQp2YXIgaXNCdWZmZXIgPSBfZGVyZXFfKCdpcy1idWZmZXInKQoKdmFyIENXID0gWzAsIDIsIDNdCnZhciBDQ1cgPSBbMiwgMSwgM10KCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gY3JlYXRlUXVhZEVsZW1lbnRzKGFycmF5LCBvcHQpIHsKICAgIC8vaWYgdXNlciBkaWRuJ3Qgc3BlY2lmeSBhbiBvdXRwdXQgYXJyYXkKICAgIGlmICghYXJyYXkgfHwgIShhbkFycmF5KGFycmF5KSB8fCBpc0J1ZmZlcihhcnJheSkpKSB7CiAgICAgICAgb3B0ID0gYXJyYXkgfHwge30KICAgICAgICBhcnJheSA9IG51bGwKICAgIH0KCiAgICBpZiAodHlwZW9mIG9wdCA9PT0gJ251bWJlcicpIC8vYmFja3dhcmRzLWNvbXBhdGlibGUKICAgICAgICBvcHQgPSB7IGNvdW50OiBvcHQgfQogICAgZWxzZQogICAgICAgIG9wdCA9IG9wdCB8fCB7fQoKICAgIHZhciB0eXBlID0gdHlwZW9mIG9wdC50eXBlID09PSAnc3RyaW5nJyA/IG9wdC50eXBlIDogJ3VpbnQxNicKICAgIHZhciBjb3VudCA9IHR5cGVvZiBvcHQuY291bnQgPT09ICdudW1iZXInID8gb3B0LmNvdW50IDogMQogICAgdmFyIHN0YXJ0ID0gKG9wdC5zdGFydCB8fCAwKSAKCiAgICB2YXIgZGlyID0gb3B0LmNsb2Nrd2lzZSAhPT0gZmFsc2UgPyBDVyA6IENDVywKICAgICAgICBhID0gZGlyWzBdLCAKICAgICAgICBiID0gZGlyWzFdLAogICAgICAgIGMgPSBkaXJbMl0KCiAgICB2YXIgbnVtSW5kaWNlcyA9IGNvdW50ICogNgoKICAgIHZhciBpbmRpY2VzID0gYXJyYXkgfHwgbmV3IChkdHlwZSh0eXBlKSkobnVtSW5kaWNlcykKICAgIGZvciAodmFyIGkgPSAwLCBqID0gMDsgaSA8IG51bUluZGljZXM7IGkgKz0gNiwgaiArPSA0KSB7CiAgICAgICAgdmFyIHggPSBpICsgc3RhcnQKICAgICAgICBpbmRpY2VzW3ggKyAwXSA9IGogKyAwCiAgICAgICAgaW5kaWNlc1t4ICsgMV0gPSBqICsgMQogICAgICAgIGluZGljZXNbeCArIDJdID0gaiArIDIKICAgICAgICBpbmRpY2VzW3ggKyAzXSA9IGogKyBhCiAgICAgICAgaW5kaWNlc1t4ICsgNF0gPSBqICsgYgogICAgICAgIGluZGljZXNbeCArIDVdID0gaiArIGMKICAgIH0KICAgIHJldHVybiBpbmRpY2VzCn0KfSx7ImFuLWFycmF5IjoxLCJkdHlwZSI6MTQsImlzLWJ1ZmZlciI6MjB9XSwzNjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qCiAqIGFuaW1lLmpzIHYzLjAuMAogKiAoYykgMjAxOSBKdWxpYW4gR2FybmllcgogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogYW5pbWVqcy5jb20KICovCgondXNlIHN0cmljdCc7CgovLyBEZWZhdWx0cwoKdmFyIGRlZmF1bHRJbnN0YW5jZVNldHRpbmdzID0gewogIHVwZGF0ZTogbnVsbCwKICBiZWdpbjogbnVsbCwKICBsb29wQmVnaW46IG51bGwsCiAgY2hhbmdlQmVnaW46IG51bGwsCiAgY2hhbmdlOiBudWxsLAogIGNoYW5nZUNvbXBsZXRlOiBudWxsLAogIGxvb3BDb21wbGV0ZTogbnVsbCwKICBjb21wbGV0ZTogbnVsbCwKICBsb29wOiAxLAogIGRpcmVjdGlvbjogJ25vcm1hbCcsCiAgYXV0b3BsYXk6IHRydWUsCiAgdGltZWxpbmVPZmZzZXQ6IDAKfTsKCnZhciBkZWZhdWx0VHdlZW5TZXR0aW5ncyA9IHsKICBkdXJhdGlvbjogMTAwMCwKICBkZWxheTogMCwKICBlbmREZWxheTogMCwKICBlYXNpbmc6ICdlYXNlT3V0RWxhc3RpYygxLCAuNSknLAogIHJvdW5kOiAwCn07Cgp2YXIgdmFsaWRUcmFuc2Zvcm1zID0gWyd0cmFuc2xhdGVYJywgJ3RyYW5zbGF0ZVknLCAndHJhbnNsYXRlWicsICdyb3RhdGUnLCAncm90YXRlWCcsICdyb3RhdGVZJywgJ3JvdGF0ZVonLCAnc2NhbGUnLCAnc2NhbGVYJywgJ3NjYWxlWScsICdzY2FsZVonLCAnc2tldycsICdza2V3WCcsICdza2V3WScsICdwZXJzcGVjdGl2ZSddOwoKLy8gQ2FjaGluZwoKdmFyIGNhY2hlID0gewogIENTUzoge30sCiAgc3ByaW5nczoge30KfTsKCi8vIFV0aWxzCgpmdW5jdGlvbiBtaW5NYXgodmFsLCBtaW4sIG1heCkgewogIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh2YWwsIG1pbiksIG1heCk7Cn0KCmZ1bmN0aW9uIHN0cmluZ0NvbnRhaW5zKHN0ciwgdGV4dCkgewogIHJldHVybiBzdHIuaW5kZXhPZih0ZXh0KSA+IC0xOwp9CgpmdW5jdGlvbiBhcHBseUFyZ3VtZW50cyhmdW5jLCBhcmdzKSB7CiAgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7Cn0KCnZhciBoZXhSZWdleCA9IC8oXiNbMC05QS1GXXs2fSQpfCheI1swLTlBLUZdezN9JCkvaTsKdmFyIHJnYlByZWZpeFJlZ2V4ID0gL15yZ2IvOwp2YXIgaHNsUmVnZXggPSAvXmhzbC87Cgp2YXIgaXMgPSB7CiAgYXJyOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gQXJyYXkuaXNBcnJheShhKTsgfSwKICBvYmo6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBzdHJpbmdDb250YWlucyhPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSksICdPYmplY3QnKTsgfSwKICBwdGg6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBpcy5vYmooYSkgJiYgYS5oYXNPd25Qcm9wZXJ0eSgndG90YWxMZW5ndGgnKTsgfSwKICBzdmc6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBhIGluc3RhbmNlb2YgU1ZHRWxlbWVudDsgfSwKICBpbnA6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBhIGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudDsgfSwKICBkb206IGZ1bmN0aW9uIChhKSB7IHJldHVybiBhLm5vZGVUeXBlIHx8IGlzLnN2ZyhhKTsgfSwKICBzdHI6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0eXBlb2YgYSA9PT0gJ3N0cmluZyc7IH0sCiAgZm5jOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdHlwZW9mIGEgPT09ICdmdW5jdGlvbic7IH0sCiAgdW5kOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdHlwZW9mIGEgPT09ICd1bmRlZmluZWQnOyB9LAogIGhleDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGhleFJlZ2V4LnRlc3QoYSk7IH0sCiAgcmdiOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gcmdiUHJlZml4UmVnZXgudGVzdChhKTsgfSwKICBoc2w6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBoc2xSZWdleC50ZXN0KGEpOyB9LAogIGNvbDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIChpcy5oZXgoYSkgfHwgaXMucmdiKGEpIHx8IGlzLmhzbChhKSk7IH0sCiAga2V5OiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gIWRlZmF1bHRJbnN0YW5jZVNldHRpbmdzLmhhc093blByb3BlcnR5KGEpICYmICFkZWZhdWx0VHdlZW5TZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eShhKSAmJiBhICE9PSAndGFyZ2V0cycgJiYgYSAhPT0gJ2tleWZyYW1lcyc7IH0KfTsKCi8vIEVhc2luZ3MKCnZhciBlYXNpbmdGdW5jdGlvblJlZ2V4ID0gL1woKFteKV0rKVwpLzsKCmZ1bmN0aW9uIHBhcnNlRWFzaW5nUGFyYW1ldGVycyhzdHJpbmcpIHsKICB2YXIgbWF0Y2ggPSBlYXNpbmdGdW5jdGlvblJlZ2V4LmV4ZWMoc3RyaW5nKTsKICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAocCkgeyByZXR1cm4gcGFyc2VGbG9hdChwKTsgfSkgOiBbXTsKfQoKLy8gU3ByaW5nIHNvbHZlciBpbnNwaXJlZCBieSBXZWJraXQgQ29weXJpZ2h0IMKpIDIwMTYgQXBwbGUgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBodHRwczovL3dlYmtpdC5vcmcvZGVtb3Mvc3ByaW5nL3NwcmluZy5qcwoKZnVuY3Rpb24gc3ByaW5nKHN0cmluZywgZHVyYXRpb24pIHsKCiAgdmFyIHBhcmFtcyA9IHBhcnNlRWFzaW5nUGFyYW1ldGVycyhzdHJpbmcpOwogIHZhciBtYXNzID0gbWluTWF4KGlzLnVuZChwYXJhbXNbMF0pID8gMSA6IHBhcmFtc1swXSwgLjEsIDEwMCk7CiAgdmFyIHN0aWZmbmVzcyA9IG1pbk1heChpcy51bmQocGFyYW1zWzFdKSA/IDEwMCA6IHBhcmFtc1sxXSwgLjEsIDEwMCk7CiAgdmFyIGRhbXBpbmcgPSBtaW5NYXgoaXMudW5kKHBhcmFtc1syXSkgPyAxMCA6IHBhcmFtc1syXSwgLjEsIDEwMCk7CiAgdmFyIHZlbG9jaXR5ID0gIG1pbk1heChpcy51bmQocGFyYW1zWzNdKSA/IDAgOiBwYXJhbXNbM10sIC4xLCAxMDApOwogIHZhciB3MCA9IE1hdGguc3FydChzdGlmZm5lc3MgLyBtYXNzKTsKICB2YXIgemV0YSA9IGRhbXBpbmcgLyAoMiAqIE1hdGguc3FydChzdGlmZm5lc3MgKiBtYXNzKSk7CiAgdmFyIHdkID0gemV0YSA8IDEgPyB3MCAqIE1hdGguc3FydCgxIC0gemV0YSAqIHpldGEpIDogMDsKICB2YXIgYSA9IDE7CiAgdmFyIGIgPSB6ZXRhIDwgMSA/ICh6ZXRhICogdzAgKyAtdmVsb2NpdHkpIC8gd2QgOiAtdmVsb2NpdHkgKyB3MDsKCiAgZnVuY3Rpb24gc29sdmVyKHQpIHsKICAgIHZhciBwcm9ncmVzcyA9IGR1cmF0aW9uID8gKGR1cmF0aW9uICogdCkgLyAxMDAwIDogdDsKICAgIGlmICh6ZXRhIDwgMSkgewogICAgICBwcm9ncmVzcyA9IE1hdGguZXhwKC1wcm9ncmVzcyAqIHpldGEgKiB3MCkgKiAoYSAqIE1hdGguY29zKHdkICogcHJvZ3Jlc3MpICsgYiAqIE1hdGguc2luKHdkICogcHJvZ3Jlc3MpKTsKICAgIH0gZWxzZSB7CiAgICAgIHByb2dyZXNzID0gKGEgKyBiICogcHJvZ3Jlc3MpICogTWF0aC5leHAoLXByb2dyZXNzICogdzApOwogICAgfQogICAgaWYgKHQgPT09IDAgfHwgdCA9PT0gMSkgeyByZXR1cm4gdDsgfQogICAgcmV0dXJuIDEgLSBwcm9ncmVzczsKICB9CgogIGZ1bmN0aW9uIGdldER1cmF0aW9uKCkgewogICAgdmFyIGNhY2hlZCA9IGNhY2hlLnNwcmluZ3Nbc3RyaW5nXTsKICAgIGlmIChjYWNoZWQpIHsgcmV0dXJuIGNhY2hlZDsgfQogICAgdmFyIGZyYW1lID0gMS82OwogICAgdmFyIGVsYXBzZWQgPSAwOwogICAgdmFyIHJlc3QgPSAwOwogICAgd2hpbGUodHJ1ZSkgewogICAgICBlbGFwc2VkICs9IGZyYW1lOwogICAgICBpZiAoc29sdmVyKGVsYXBzZWQpID09PSAxKSB7CiAgICAgICAgcmVzdCsrOwogICAgICAgIGlmIChyZXN0ID49IDE2KSB7IGJyZWFrOyB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdCA9IDA7CiAgICAgIH0KICAgIH0KICAgIHZhciBkdXJhdGlvbiA9IGVsYXBzZWQgKiBmcmFtZSAqIDEwMDA7CiAgICBjYWNoZS5zcHJpbmdzW3N0cmluZ10gPSBkdXJhdGlvbjsKICAgIHJldHVybiBkdXJhdGlvbjsKICB9CgogIHJldHVybiBkdXJhdGlvbiA/IHNvbHZlciA6IGdldER1cmF0aW9uOwoKfQoKLy8gRWxhc3RpYyBlYXNpbmcgYWRhcHRlZCBmcm9tIGpRdWVyeVVJIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2Vhc2luZ3MvCgpmdW5jdGlvbiBlbGFzdGljKGFtcGxpdHVkZSwgcGVyaW9kKSB7CiAgaWYgKCBhbXBsaXR1ZGUgPT09IHZvaWQgMCApIGFtcGxpdHVkZSA9IDE7CiAgaWYgKCBwZXJpb2QgPT09IHZvaWQgMCApIHBlcmlvZCA9IC41OwoKICB2YXIgYSA9IG1pbk1heChhbXBsaXR1ZGUsIDEsIDEwKTsKICB2YXIgcCA9IG1pbk1heChwZXJpb2QsIC4xLCAyKTsKICByZXR1cm4gZnVuY3Rpb24gKHQpIHsKICAgIHJldHVybiAodCA9PT0gMCB8fCB0ID09PSAxKSA/IHQgOgogICAgICAtYSAqIE1hdGgucG93KDIsIDEwICogKHQgLSAxKSkgKiBNYXRoLnNpbigoKCh0IC0gMSkgLSAocCAvIChNYXRoLlBJICogMikgKiBNYXRoLmFzaW4oMSAvIGEpKSkgKiAoTWF0aC5QSSAqIDIpKSAvIHApOwogIH0KfQoKLy8gQmFzaWMgc3RlcHMgZWFzaW5nIGltcGxlbWVudGF0aW9uIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2ZyL2RvY3MvV2ViL0NTUy90cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbgoKZnVuY3Rpb24gc3RlcHMoc3RlcHMpIHsKICBpZiAoIHN0ZXBzID09PSB2b2lkIDAgKSBzdGVwcyA9IDEwOwoKICByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIE1hdGgucm91bmQodCAqIHN0ZXBzKSAqICgxIC8gc3RlcHMpOyB9Owp9CgovLyBCZXppZXJFYXNpbmcgaHR0cHM6Ly9naXRodWIuY29tL2dyZS9iZXppZXItZWFzaW5nCgp2YXIgYmV6aWVyID0gKGZ1bmN0aW9uICgpIHsKCiAgdmFyIGtTcGxpbmVUYWJsZVNpemUgPSAxMTsKICB2YXIga1NhbXBsZVN0ZXBTaXplID0gMS4wIC8gKGtTcGxpbmVUYWJsZVNpemUgLSAxLjApOwoKICBmdW5jdGlvbiBBKGFBMSwgYUEyKSB7IHJldHVybiAxLjAgLSAzLjAgKiBhQTIgKyAzLjAgKiBhQTEgfQogIGZ1bmN0aW9uIEIoYUExLCBhQTIpIHsgcmV0dXJuIDMuMCAqIGFBMiAtIDYuMCAqIGFBMSB9CiAgZnVuY3Rpb24gQyhhQTEpICAgICAgeyByZXR1cm4gMy4wICogYUExIH0KCiAgZnVuY3Rpb24gY2FsY0JlemllcihhVCwgYUExLCBhQTIpIHsgcmV0dXJuICgoQShhQTEsIGFBMikgKiBhVCArIEIoYUExLCBhQTIpKSAqIGFUICsgQyhhQTEpKSAqIGFUIH0KICBmdW5jdGlvbiBnZXRTbG9wZShhVCwgYUExLCBhQTIpIHsgcmV0dXJuIDMuMCAqIEEoYUExLCBhQTIpICogYVQgKiBhVCArIDIuMCAqIEIoYUExLCBhQTIpICogYVQgKyBDKGFBMSkgfQoKICBmdW5jdGlvbiBiaW5hcnlTdWJkaXZpZGUoYVgsIGFBLCBhQiwgbVgxLCBtWDIpIHsKICAgIHZhciBjdXJyZW50WCwgY3VycmVudFQsIGkgPSAwOwogICAgZG8gewogICAgICBjdXJyZW50VCA9IGFBICsgKGFCIC0gYUEpIC8gMi4wOwogICAgICBjdXJyZW50WCA9IGNhbGNCZXppZXIoY3VycmVudFQsIG1YMSwgbVgyKSAtIGFYOwogICAgICBpZiAoY3VycmVudFggPiAwLjApIHsgYUIgPSBjdXJyZW50VDsgfSBlbHNlIHsgYUEgPSBjdXJyZW50VDsgfQogICAgfSB3aGlsZSAoTWF0aC5hYnMoY3VycmVudFgpID4gMC4wMDAwMDAxICYmICsraSA8IDEwKTsKICAgIHJldHVybiBjdXJyZW50VDsKICB9CgogIGZ1bmN0aW9uIG5ld3RvblJhcGhzb25JdGVyYXRlKGFYLCBhR3Vlc3NULCBtWDEsIG1YMikgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyArK2kpIHsKICAgICAgdmFyIGN1cnJlbnRTbG9wZSA9IGdldFNsb3BlKGFHdWVzc1QsIG1YMSwgbVgyKTsKICAgICAgaWYgKGN1cnJlbnRTbG9wZSA9PT0gMC4wKSB7IHJldHVybiBhR3Vlc3NUOyB9CiAgICAgIHZhciBjdXJyZW50WCA9IGNhbGNCZXppZXIoYUd1ZXNzVCwgbVgxLCBtWDIpIC0gYVg7CiAgICAgIGFHdWVzc1QgLT0gY3VycmVudFggLyBjdXJyZW50U2xvcGU7CiAgICB9CiAgICByZXR1cm4gYUd1ZXNzVDsKICB9CgogIGZ1bmN0aW9uIGJlemllcihtWDEsIG1ZMSwgbVgyLCBtWTIpIHsKCiAgICBpZiAoISgwIDw9IG1YMSAmJiBtWDEgPD0gMSAmJiAwIDw9IG1YMiAmJiBtWDIgPD0gMSkpIHsgcmV0dXJuOyB9CiAgICB2YXIgc2FtcGxlVmFsdWVzID0gbmV3IEZsb2F0MzJBcnJheShrU3BsaW5lVGFibGVTaXplKTsKCiAgICBpZiAobVgxICE9PSBtWTEgfHwgbVgyICE9PSBtWTIpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrU3BsaW5lVGFibGVTaXplOyArK2kpIHsKICAgICAgICBzYW1wbGVWYWx1ZXNbaV0gPSBjYWxjQmV6aWVyKGkgKiBrU2FtcGxlU3RlcFNpemUsIG1YMSwgbVgyKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRGb3JYKGFYKSB7CgogICAgICB2YXIgaW50ZXJ2YWxTdGFydCA9IDA7CiAgICAgIHZhciBjdXJyZW50U2FtcGxlID0gMTsKICAgICAgdmFyIGxhc3RTYW1wbGUgPSBrU3BsaW5lVGFibGVTaXplIC0gMTsKCiAgICAgIGZvciAoOyBjdXJyZW50U2FtcGxlICE9PSBsYXN0U2FtcGxlICYmIHNhbXBsZVZhbHVlc1tjdXJyZW50U2FtcGxlXSA8PSBhWDsgKytjdXJyZW50U2FtcGxlKSB7CiAgICAgICAgaW50ZXJ2YWxTdGFydCArPSBrU2FtcGxlU3RlcFNpemU7CiAgICAgIH0KCiAgICAgIC0tY3VycmVudFNhbXBsZTsKCiAgICAgIHZhciBkaXN0ID0gKGFYIC0gc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKSAvIChzYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZSArIDFdIC0gc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKTsKICAgICAgdmFyIGd1ZXNzRm9yVCA9IGludGVydmFsU3RhcnQgKyBkaXN0ICoga1NhbXBsZVN0ZXBTaXplOwogICAgICB2YXIgaW5pdGlhbFNsb3BlID0gZ2V0U2xvcGUoZ3Vlc3NGb3JULCBtWDEsIG1YMik7CgogICAgICBpZiAoaW5pdGlhbFNsb3BlID49IDAuMDAxKSB7CiAgICAgICAgcmV0dXJuIG5ld3RvblJhcGhzb25JdGVyYXRlKGFYLCBndWVzc0ZvclQsIG1YMSwgbVgyKTsKICAgICAgfSBlbHNlIGlmIChpbml0aWFsU2xvcGUgPT09IDAuMCkgewogICAgICAgIHJldHVybiBndWVzc0ZvclQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGJpbmFyeVN1YmRpdmlkZShhWCwgaW50ZXJ2YWxTdGFydCwgaW50ZXJ2YWxTdGFydCArIGtTYW1wbGVTdGVwU2l6ZSwgbVgxLCBtWDIpOwogICAgICB9CgogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbiAoeCkgewogICAgICBpZiAobVgxID09PSBtWTEgJiYgbVgyID09PSBtWTIpIHsgcmV0dXJuIHg7IH0KICAgICAgaWYgKHggPT09IDAgfHwgeCA9PT0gMSkgeyByZXR1cm4geDsgfQogICAgICByZXR1cm4gY2FsY0JlemllcihnZXRURm9yWCh4KSwgbVkxLCBtWTIpOwogICAgfQoKICB9CgogIHJldHVybiBiZXppZXI7Cgp9KSgpOwoKdmFyIHBlbm5lciA9IChmdW5jdGlvbiAoKSB7CgogIHZhciBuYW1lcyA9IFsnUXVhZCcsICdDdWJpYycsICdRdWFydCcsICdRdWludCcsICdTaW5lJywgJ0V4cG8nLCAnQ2lyYycsICdCYWNrJywgJ0VsYXN0aWMnXTsKCiAgLy8gQXBwcm94aW1hdGVkIFBlbm5lciBlcXVhdGlvbnMgaHR0cDovL21hdHRoZXdsZWluLmNvbS9jZWFzZXIvCgogIHZhciBjdXJ2ZXMgPSB7CiAgICBJbjogWwogICAgICBbMC41NTAsIDAuMDg1LCAwLjY4MCwgMC41MzBdLCAvKiBpblF1YWQgKi8KICAgICAgWzAuNTUwLCAwLjA1NSwgMC42NzUsIDAuMTkwXSwgLyogaW5DdWJpYyAqLwogICAgICBbMC44OTUsIDAuMDMwLCAwLjY4NSwgMC4yMjBdLCAvKiBpblF1YXJ0ICovCiAgICAgIFswLjc1NSwgMC4wNTAsIDAuODU1LCAwLjA2MF0sIC8qIGluUXVpbnQgKi8KICAgICAgWzAuNDcwLCAwLjAwMCwgMC43NDUsIDAuNzE1XSwgLyogaW5TaW5lICovCiAgICAgIFswLjk1MCwgMC4wNTAsIDAuNzk1LCAwLjAzNV0sIC8qIGluRXhwbyAqLwogICAgICBbMC42MDAsIDAuMDQwLCAwLjk4MCwgMC4zMzVdLCAvKiBpbkNpcmMgKi8KICAgICAgWzAuNjAwLC0wLjI4MCwgMC43MzUsIDAuMDQ1XSwgLyogaW5CYWNrICovCiAgICAgIGVsYXN0aWMgLyogaW5FbGFzdGljICovCiAgICBdLAogICAgT3V0OiBbCiAgICAgIFswLjI1MCwgMC40NjAsIDAuNDUwLCAwLjk0MF0sIC8qIG91dFF1YWQgKi8KICAgICAgWzAuMjE1LCAwLjYxMCwgMC4zNTUsIDEuMDAwXSwgLyogb3V0Q3ViaWMgKi8KICAgICAgWzAuMTY1LCAwLjg0MCwgMC40NDAsIDEuMDAwXSwgLyogb3V0UXVhcnQgKi8KICAgICAgWzAuMjMwLCAxLjAwMCwgMC4zMjAsIDEuMDAwXSwgLyogb3V0UXVpbnQgKi8KICAgICAgWzAuMzkwLCAwLjU3NSwgMC41NjUsIDEuMDAwXSwgLyogb3V0U2luZSAqLwogICAgICBbMC4xOTAsIDEuMDAwLCAwLjIyMCwgMS4wMDBdLCAvKiBvdXRFeHBvICovCiAgICAgIFswLjA3NSwgMC44MjAsIDAuMTY1LCAxLjAwMF0sIC8qIG91dENpcmMgKi8KICAgICAgWzAuMTc1LCAwLjg4NSwgMC4zMjAsIDEuMjc1XSwgLyogb3V0QmFjayAqLwogICAgICBmdW5jdGlvbiAoYSwgcCkgeyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIDEgLSBlbGFzdGljKGEsIHApKDEgLSB0KTsgfTsgfSAvKiBvdXRFbGFzdGljICovCiAgICBdLAogICAgSW5PdXQ6IFsKICAgICAgWzAuNDU1LCAwLjAzMCwgMC41MTUsIDAuOTU1XSwgLyogaW5PdXRRdWFkICovCiAgICAgIFswLjY0NSwgMC4wNDUsIDAuMzU1LCAxLjAwMF0sIC8qIGluT3V0Q3ViaWMgKi8KICAgICAgWzAuNzcwLCAwLjAwMCwgMC4xNzUsIDEuMDAwXSwgLyogaW5PdXRRdWFydCAqLwogICAgICBbMC44NjAsIDAuMDAwLCAwLjA3MCwgMS4wMDBdLCAvKiBpbk91dFF1aW50ICovCiAgICAgIFswLjQ0NSwgMC4wNTAsIDAuNTUwLCAwLjk1MF0sIC8qIGluT3V0U2luZSAqLwogICAgICBbMS4wMDAsIDAuMDAwLCAwLjAwMCwgMS4wMDBdLCAvKiBpbk91dEV4cG8gKi8KICAgICAgWzAuNzg1LCAwLjEzNSwgMC4xNTAsIDAuODYwXSwgLyogaW5PdXRDaXJjICovCiAgICAgIFswLjY4MCwtMC41NTAsIDAuMjY1LCAxLjU1MF0sIC8qIGluT3V0QmFjayAqLwogICAgICBmdW5jdGlvbiAoYSwgcCkgeyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQgPCAuNSA/IGVsYXN0aWMoYSwgcCkodCAqIDIpIC8gMiA6IDEgLSBlbGFzdGljKGEsIHApKHQgKiAtMiArIDIpIC8gMjsgfTsgfSAvKiBpbk91dEVsYXN0aWMgKi8KICAgIF0KICB9OwoKICB2YXIgZWFzZXMgPSB7CiAgICBsaW5lYXI6IFswLjI1MCwgMC4yNTAsIDAuNzUwLCAwLjc1MF0KICB9OwoKICBmb3IgKHZhciBjb29yZHMgaW4gY3VydmVzKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY3VydmVzW2Nvb3Jkc10ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgZWFzZXNbJ2Vhc2UnK2Nvb3JkcytuYW1lc1tpXV0gPSBjdXJ2ZXNbY29vcmRzXVtpXTsKICAgIH0KICB9CgogIHJldHVybiBlYXNlczsKCn0pKCk7CgpmdW5jdGlvbiBwYXJzZUVhc2luZ3MoZWFzaW5nLCBkdXJhdGlvbikgewogIGlmIChpcy5mbmMoZWFzaW5nKSkgeyByZXR1cm4gZWFzaW5nOyB9CiAgdmFyIG5hbWUgPSBlYXNpbmcuc3BsaXQoJygnKVswXTsKICB2YXIgZWFzZSA9IHBlbm5lcltuYW1lXTsKICB2YXIgYXJncyA9IHBhcnNlRWFzaW5nUGFyYW1ldGVycyhlYXNpbmcpOwogIHN3aXRjaCAobmFtZSkgewogICAgY2FzZSAnc3ByaW5nJyA6IHJldHVybiBzcHJpbmcoZWFzaW5nLCBkdXJhdGlvbik7CiAgICBjYXNlICdjdWJpY0JlemllcicgOiByZXR1cm4gYXBwbHlBcmd1bWVudHMoYmV6aWVyLCBhcmdzKTsKICAgIGNhc2UgJ3N0ZXBzJyA6IHJldHVybiBhcHBseUFyZ3VtZW50cyhzdGVwcywgYXJncyk7CiAgICBkZWZhdWx0IDogcmV0dXJuIGlzLmZuYyhlYXNlKSA/IGFwcGx5QXJndW1lbnRzKGVhc2UsIGFyZ3MpIDogYXBwbHlBcmd1bWVudHMoYmV6aWVyLCBlYXNlKTsKICB9Cn0KCi8vIFN0cmluZ3MKCmZ1bmN0aW9uIHNlbGVjdFN0cmluZyhzdHIpIHsKICB0cnkgewogICAgdmFyIG5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzdHIpOwogICAgcmV0dXJuIG5vZGVzOwogIH0gY2F0Y2goZSkgewogICAgcmV0dXJuOwogIH0KfQoKLy8gQXJyYXlzCgp2YXIgYXV4QXJyYXlGaWx0ZXIgPSBbXTsKCmZ1bmN0aW9uIGZpbHRlckFycmF5KGFyciwgY2FsbGJhY2spIHsKICB2YXIgcmVzdWx0ID0gYXV4QXJyYXlGaWx0ZXI7CgogIHZhciBsZW4gPSBhcnIubGVuZ3RoOwogIHZhciB0aGlzQXJnID0gYXJndW1lbnRzLmxlbmd0aCA+PSAyID8gYXJndW1lbnRzWzFdIDogdm9pZCAwOwogIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgIGlmIChpIGluIGFycikgewogICAgICB2YXIgdmFsID0gYXJyW2ldOwogICAgICBpZiAoY2FsbGJhY2suY2FsbCh0aGlzQXJnLCB2YWwsIGksIGFycikpIHsKICAgICAgICByZXN1bHQucHVzaCh2YWwpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBhcnIgdHVybnMgaW50byB0aGUgYXV4QXJyYXkgYW5kIHdlIHJldHVybiB0aGUgcHJldmlvdXNseSBhdXggYXJyYXkuCiAgYXV4QXJyYXlGaWx0ZXIgPSBhcnI7CiAgYXV4QXJyYXlGaWx0ZXIubGVuZ3RoID0gMDsKICByZXR1cm4gcmVzdWx0Owp9Cgp2YXIgYXV4QXJyYXlGbGF0dGVuID0gW107CgpmdW5jdGlvbiBmbGF0dGVuQXJyYXkoYXJyKSB7CiAgaWYgKCFhcnIubGVuZ3RoKSB7IHJldHVybiBhcnI7IH0KCiAgdmFyIHJlc3VsdCA9IGF1eEFycmF5RmxhdHRlbjsKICB2YXIgbm9kZSA9IGFyci5wb3AoKTsKCiAgZG8gewogICAgaWYgKG5vZGUuY29uc3RydWN0b3IgPT09IEFycmF5KSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5sZW5ndGg7IGkrKykgewogICAgICAgIGFyci5wdXNoKG5vZGVbaV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZXN1bHQucHVzaChub2RlKTsKICAgIH0KICB9IHdoaWxlIChhcnIubGVuZ3RoICYmIChub2RlID0gYXJyLnBvcCgpKSAhPT0gdW5kZWZpbmVkKTsKCiAgcmVzdWx0LnJldmVyc2UoKTsgIC8vIFJldmVyc2UgcmVzdWx0IHRvIHJlc3RvcmUgdGhlIG9yaWdpbmFsIG9yZGVyLgoKICAvLyBhcnIgdHVybnMgaW50byB0aGUgYXV4QXJyYXkgYW5kIHdlIHJldHVybiB0aGUgcHJldmlvdXNseSBhdXggYXJyYXkuCiAgYXV4QXJyYXlGbGF0dGVuID0gYXJyOwogIGF1eEFycmF5RmlsdGVyLmxlbmd0aCA9IDA7CiAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gdG9BcnJheShvKSB7CiAgaWYgKGlzLmFycihvKSkgeyByZXR1cm4gbzsgfQogIGlmIChpcy5zdHIobykpIHsgbyA9IHNlbGVjdFN0cmluZyhvKSB8fCBvOyB9CiAgaWYgKG8gaW5zdGFuY2VvZiBOb2RlTGlzdCB8fCBvIGluc3RhbmNlb2YgSFRNTENvbGxlY3Rpb24pIHsgcmV0dXJuIFtdLnNsaWNlLmNhbGwobyk7IH0KICByZXR1cm4gW29dOwp9CgpmdW5jdGlvbiBhcnJheUNvbnRhaW5zKGFyciwgdmFsKSB7CiAgcmV0dXJuIGFyci5zb21lKGZ1bmN0aW9uIChhKSB7IHJldHVybiBhID09PSB2YWw7IH0pOwp9CgovLyBPYmplY3RzCgpmdW5jdGlvbiBjbG9uZU9iamVjdChvKSB7CiAgdmFyIGNsb25lID0ge307CiAgZm9yICh2YXIgcCBpbiBvKSB7IGNsb25lW3BdID0gb1twXTsgfQogIHJldHVybiBjbG9uZTsKfQoKZnVuY3Rpb24gcmVwbGFjZU9iamVjdFByb3BzKG8xLCBvMikgewogIHZhciBvID0gY2xvbmVPYmplY3QobzEpOwogIGZvciAodmFyIHAgaW4gbzEpIHsgb1twXSA9IG8yLmhhc093blByb3BlcnR5KHApID8gbzJbcF0gOiBvMVtwXTsgfQogIHJldHVybiBvOwp9CgpmdW5jdGlvbiBtZXJnZU9iamVjdHMobzEsIG8yKSB7CiAgdmFyIG8gPSBjbG9uZU9iamVjdChvMSk7CiAgZm9yICh2YXIgcCBpbiBvMikgeyBvW3BdID0gaXMudW5kKG8xW3BdKSA/IG8yW3BdIDogbzFbcF07IH0KICByZXR1cm4gbzsKfQoKLy8gQ29sb3JzCgp2YXIgcmdiUmVnZXggPSAvcmdiXCgoXGQrLFxzKltcZF0rLFxzKltcZF0rKVwpL2c7CgpmdW5jdGlvbiByZ2JUb1JnYmEocmdiVmFsdWUpIHsKICB2YXIgcmdiID0gcmdiUmVnZXguZXhlYyhyZ2JWYWx1ZSk7CiAgcmV0dXJuIHJnYiA/ICgicmdiYSgiICsgKHJnYlsxXSkgKyAiLDEpIikgOiByZ2JWYWx1ZTsKfQoKdmFyIGhleFRvUmdiYUhleFJlZ2V4ID0gL14jPyhbYS1mXGRdKShbYS1mXGRdKShbYS1mXGRdKSQvaTsKdmFyIGhleFRvUmdiYVJnYlJlZ2V4ID0gL14jPyhbYS1mXGRdezJ9KShbYS1mXGRdezJ9KShbYS1mXGRdezJ9KSQvaTsKCmZ1bmN0aW9uIGhleFRvUmdiYShoZXhWYWx1ZSkgewogIHZhciBoZXggPSBoZXhWYWx1ZS5yZXBsYWNlKGhleFRvUmdiYUhleFJlZ2V4LCBmdW5jdGlvbiAobSwgciwgZywgYikgeyByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiOyB9ICk7CiAgdmFyIHJnYiA9IGhleFRvUmdiYVJnYlJlZ2V4LmV4ZWMoaGV4KTsKICB2YXIgciA9IHBhcnNlSW50KHJnYlsxXSwgMTYpOwogIHZhciBnID0gcGFyc2VJbnQocmdiWzJdLCAxNik7CiAgdmFyIGIgPSBwYXJzZUludChyZ2JbM10sIDE2KTsKICByZXR1cm4gKCJyZ2JhKCIgKyByICsgIiwiICsgZyArICIsIiArIGIgKyAiLDEpIik7Cn0KCnZhciBoc2xUb1JnYmFIc2wxUmVnZXggPSAvaHNsXCgoXGQrKSxccyooW1xkLl0rKSUsXHMqKFtcZC5dKyklXCkvZzsKdmFyIGhzbFRvUmdiYUhzbDJSZWdleCA9IC9oc2xhXCgoXGQrKSxccyooW1xkLl0rKSUsXHMqKFtcZC5dKyklLFxzKihbXGQuXSspXCkvZzsKCmZ1bmN0aW9uIGhzbFRvUmdiYShoc2xWYWx1ZSkgewogIHZhciBoc2wgPSBoc2xUb1JnYmFIc2wxUmVnZXguZXhlYyhoc2xWYWx1ZSkgfHwgaHNsVG9SZ2JhSHNsMlJlZ2V4LmV4ZWMoaHNsVmFsdWUpOwogIHZhciBoID0gcGFyc2VJbnQoaHNsWzFdLCAxMCkgLyAzNjA7CiAgdmFyIHMgPSBwYXJzZUludChoc2xbMl0sIDEwKSAvIDEwMDsKICB2YXIgbCA9IHBhcnNlSW50KGhzbFszXSwgMTApIC8gMTAwOwogIHZhciBhID0gaHNsWzRdIHx8IDE7CiAgZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KSB7CiAgICBpZiAodCA8IDApIHsgdCArPSAxOyB9CiAgICBpZiAodCA+IDEpIHsgdCAtPSAxOyB9CiAgICBpZiAodCA8IDEvNikgeyByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdDsgfQogICAgaWYgKHQgPCAxLzIpIHsgcmV0dXJuIHE7IH0KICAgIGlmICh0IDwgMi8zKSB7IHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7IH0KICAgIHJldHVybiBwOwogIH0KICB2YXIgciwgZywgYjsKICBpZiAocyA9PSAwKSB7CiAgICByID0gZyA9IGIgPSBsOwogIH0gZWxzZSB7CiAgICB2YXIgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHM7CiAgICB2YXIgcCA9IDIgKiBsIC0gcTsKICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxLzMpOwogICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7CiAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMS8zKTsKICB9CiAgcmV0dXJuICgicmdiYSgiICsgKHIgKiAyNTUpICsgIiwiICsgKGcgKiAyNTUpICsgIiwiICsgKGIgKiAyNTUpICsgIiwiICsgYSArICIpIik7Cn0KCmZ1bmN0aW9uIGNvbG9yVG9SZ2IodmFsKSB7CiAgaWYgKGlzLnJnYih2YWwpKSB7IHJldHVybiByZ2JUb1JnYmEodmFsKTsgfQogIGlmIChpcy5oZXgodmFsKSkgeyByZXR1cm4gaGV4VG9SZ2JhKHZhbCk7IH0KICBpZiAoaXMuaHNsKHZhbCkpIHsgcmV0dXJuIGhzbFRvUmdiYSh2YWwpOyB9Cn0KCi8vIFVuaXRzCgp2YXIgdW5pdFJlZ2V4ID0gLyhbXCtcLV0/WzAtOSNcLl0rKSglfHB4fHB0fGVtfHJlbXxpbnxjbXxtbXxleHxjaHxwY3x2d3x2aHx2bWlufHZtYXh8ZGVnfHJhZHx0dXJuKT8kLzsKCmZ1bmN0aW9uIGdldFVuaXQodmFsKSB7CiAgdmFyIHNwbGl0ID0gdW5pdFJlZ2V4LmV4ZWModmFsKTsKICBpZiAoc3BsaXQpIHsgcmV0dXJuIHNwbGl0WzJdOyB9Cn0KCmZ1bmN0aW9uIGdldFRyYW5zZm9ybVVuaXQocHJvcE5hbWUpIHsKICBpZiAoc3RyaW5nQ29udGFpbnMocHJvcE5hbWUsICd0cmFuc2xhdGUnKSB8fCBwcm9wTmFtZSA9PT0gJ3BlcnNwZWN0aXZlJykgeyByZXR1cm4gJ3B4JzsgfQogIGlmIChzdHJpbmdDb250YWlucyhwcm9wTmFtZSwgJ3JvdGF0ZScpIHx8IHN0cmluZ0NvbnRhaW5zKHByb3BOYW1lLCAnc2tldycpKSB7IHJldHVybiAnZGVnJzsgfQp9CgovLyBWYWx1ZXMKCmZ1bmN0aW9uIGdldEZ1bmN0aW9uVmFsdWUodmFsLCBhbmltYXRhYmxlKSB7CiAgaWYgKCFpcy5mbmModmFsKSkgeyByZXR1cm4gdmFsOyB9CiAgcmV0dXJuIHZhbChhbmltYXRhYmxlLnRhcmdldCwgYW5pbWF0YWJsZS5pZCwgYW5pbWF0YWJsZS50b3RhbCk7Cn0KCmZ1bmN0aW9uIGdldEF0dHJpYnV0ZShlbCwgcHJvcCkgewogIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUocHJvcCk7Cn0KCmZ1bmN0aW9uIGNvbnZlcnRQeFRvVW5pdChlbCwgdmFsdWUsIHVuaXQpIHsKICB2YXIgdmFsdWVVbml0ID0gZ2V0VW5pdCh2YWx1ZSk7CiAgaWYgKGFycmF5Q29udGFpbnMoW3VuaXQsICdkZWcnLCAncmFkJywgJ3R1cm4nXSwgdmFsdWVVbml0KSkgeyByZXR1cm4gdmFsdWU7IH0KICB2YXIgY2FjaGVkID0gY2FjaGUuQ1NTW3ZhbHVlICsgdW5pdF07CiAgaWYgKCFpcy51bmQoY2FjaGVkKSkgeyByZXR1cm4gY2FjaGVkOyB9CiAgdmFyIGJhc2VsaW5lID0gMTAwOwogIHZhciB0ZW1wRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGVsLnRhZ05hbWUpOwogIHZhciBwYXJlbnRFbCA9IChlbC5wYXJlbnROb2RlICYmIChlbC5wYXJlbnROb2RlICE9PSBkb2N1bWVudCkpID8gZWwucGFyZW50Tm9kZSA6IGRvY3VtZW50LmJvZHk7CiAgcGFyZW50RWwuYXBwZW5kQ2hpbGQodGVtcEVsKTsKICB0ZW1wRWwuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogIHRlbXBFbC5zdHlsZS53aWR0aCA9IGJhc2VsaW5lICsgdW5pdDsKICB2YXIgZmFjdG9yID0gYmFzZWxpbmUgLyB0ZW1wRWwub2Zmc2V0V2lkdGg7CiAgcGFyZW50RWwucmVtb3ZlQ2hpbGQodGVtcEVsKTsKICB2YXIgY29udmVydGVkVW5pdCA9IGZhY3RvciAqIHBhcnNlRmxvYXQodmFsdWUpOwogIGNhY2hlLkNTU1t2YWx1ZSArIHVuaXRdID0gY29udmVydGVkVW5pdDsKICByZXR1cm4gY29udmVydGVkVW5pdDsKfQoKZnVuY3Rpb24gZ2V0Q1NTVmFsdWUoZWwsIHByb3AsIHVuaXQpIHsKICBpZiAocHJvcCBpbiBlbC5zdHlsZSkgewogICAgdmFyIHVwcGVyY2FzZVByb3BOYW1lID0gcHJvcC5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpOwogICAgdmFyIHZhbHVlID0gZWwuc3R5bGVbcHJvcF0gfHwgZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZSh1cHBlcmNhc2VQcm9wTmFtZSkgfHwgJzAnOwogICAgcmV0dXJuIHVuaXQgPyBjb252ZXJ0UHhUb1VuaXQoZWwsIHZhbHVlLCB1bml0KSA6IHZhbHVlOwogIH0KfQoKZnVuY3Rpb24gZ2V0QW5pbWF0aW9uVHlwZShlbCwgcHJvcCkgewogIGlmIChpcy5kb20oZWwpICYmICFpcy5pbnAoZWwpICYmIChnZXRBdHRyaWJ1dGUoZWwsIHByb3ApIHx8IChpcy5zdmcoZWwpICYmIGVsW3Byb3BdKSkpIHsgcmV0dXJuICdhdHRyaWJ1dGUnOyB9CiAgaWYgKGlzLmRvbShlbCkgJiYgYXJyYXlDb250YWlucyh2YWxpZFRyYW5zZm9ybXMsIHByb3ApKSB7IHJldHVybiAndHJhbnNmb3JtJzsgfQogIGlmIChpcy5kb20oZWwpICYmIChwcm9wICE9PSAndHJhbnNmb3JtJyAmJiBnZXRDU1NWYWx1ZShlbCwgcHJvcCkpKSB7IHJldHVybiAnY3NzJzsgfQogIGlmIChlbFtwcm9wXSAhPSBudWxsKSB7IHJldHVybiAnb2JqZWN0JzsgfQp9Cgp2YXIgdHJhbnNmb3JtUmVnZXggPSAvKFx3KylcKChbXildKilcKS9nOwoKZnVuY3Rpb24gZ2V0RWxlbWVudFRyYW5zZm9ybXMoZWwpIHsKICBpZiAoIWlzLmRvbShlbCkpIHsgcmV0dXJuOyB9CiAgdmFyIHN0ciA9IGVsLnN0eWxlLnRyYW5zZm9ybSB8fCAnJzsKICB2YXIgdHJhbnNmb3JtcyA9IG5ldyBNYXAoKTsKICB2YXIgbTsgd2hpbGUgKG0gPSB0cmFuc2Zvcm1SZWdleC5leGVjKHN0cikpIHsgdHJhbnNmb3Jtcy5zZXQobVsxXSwgbVsyXSk7IH0KICByZXR1cm4gdHJhbnNmb3JtczsKfQoKZnVuY3Rpb24gZ2V0VHJhbnNmb3JtVmFsdWUoZWwsIHByb3BOYW1lLCBhbmltYXRhYmxlLCB1bml0KSB7CiAgdmFyIGRlZmF1bHRWYWwgPSBzdHJpbmdDb250YWlucyhwcm9wTmFtZSwgJ3NjYWxlJykgPyAxIDogMCArIGdldFRyYW5zZm9ybVVuaXQocHJvcE5hbWUpOwogIHZhciB2YWx1ZSA9IGdldEVsZW1lbnRUcmFuc2Zvcm1zKGVsKS5nZXQocHJvcE5hbWUpIHx8IGRlZmF1bHRWYWw7CiAgaWYgKGFuaW1hdGFibGUpIHsKICAgIGFuaW1hdGFibGUudHJhbnNmb3Jtcy5saXN0LnNldChwcm9wTmFtZSwgdmFsdWUpOwogICAgYW5pbWF0YWJsZS50cmFuc2Zvcm1zWydsYXN0J10gPSBwcm9wTmFtZTsKICB9CiAgcmV0dXJuIHVuaXQgPyBjb252ZXJ0UHhUb1VuaXQoZWwsIHZhbHVlLCB1bml0KSA6IHZhbHVlOwp9CgpmdW5jdGlvbiBnZXRPcmlnaW5hbFRhcmdldFZhbHVlKHRhcmdldCwgcHJvcE5hbWUsIHVuaXQsIGFuaW1hdGFibGUpIHsKICBzd2l0Y2ggKGdldEFuaW1hdGlvblR5cGUodGFyZ2V0LCBwcm9wTmFtZSkpIHsKICAgIGNhc2UgJ3RyYW5zZm9ybSc6IHJldHVybiBnZXRUcmFuc2Zvcm1WYWx1ZSh0YXJnZXQsIHByb3BOYW1lLCBhbmltYXRhYmxlLCB1bml0KTsKICAgIGNhc2UgJ2Nzcyc6IHJldHVybiBnZXRDU1NWYWx1ZSh0YXJnZXQsIHByb3BOYW1lLCB1bml0KTsKICAgIGNhc2UgJ2F0dHJpYnV0ZSc6IHJldHVybiBnZXRBdHRyaWJ1dGUodGFyZ2V0LCBwcm9wTmFtZSk7CiAgICBkZWZhdWx0OiByZXR1cm4gdGFyZ2V0W3Byb3BOYW1lXSB8fCAwOwogIH0KfQoKdmFyIG9wZXJhdG9yUmVnZXggPSAvXihcKj18XCs9fC09KS87CgpmdW5jdGlvbiBnZXRSZWxhdGl2ZVZhbHVlKHRvLCBmcm9tKSB7CiAgdmFyIG9wZXJhdG9yID0gb3BlcmF0b3JSZWdleC5leGVjKHRvKTsKICBpZiAoIW9wZXJhdG9yKSB7IHJldHVybiB0bzsgfQogIHZhciB1ID0gZ2V0VW5pdCh0bykgfHwgMDsKICB2YXIgeCA9IHBhcnNlRmxvYXQoZnJvbSk7CiAgdmFyIHkgPSBwYXJzZUZsb2F0KHRvLnJlcGxhY2Uob3BlcmF0b3JbMF0sICcnKSk7CiAgc3dpdGNoIChvcGVyYXRvclswXVswXSkgewogICAgY2FzZSAnKyc6IHJldHVybiB4ICsgeSArIHU7CiAgICBjYXNlICctJzogcmV0dXJuIHggLSB5ICsgdTsKICAgIGNhc2UgJyonOiByZXR1cm4geCAqIHkgKyB1OwogIH0KfQoKdmFyIHdoaXRlc3BhY2VSZWdleCA9IC9ccy9nOwoKZnVuY3Rpb24gdmFsaWRhdGVWYWx1ZSh2YWwsIHVuaXQpIHsKICBpZiAoaXMuY29sKHZhbCkpIHsgcmV0dXJuIGNvbG9yVG9SZ2IodmFsKTsgfQogIHZhciBvcmlnaW5hbFVuaXQgPSBnZXRVbml0KHZhbCk7CiAgdmFyIHVuaXRMZXNzID0gb3JpZ2luYWxVbml0ID8gdmFsLnN1YnN0cigwLCB2YWwubGVuZ3RoIC0gb3JpZ2luYWxVbml0Lmxlbmd0aCkgOiB2YWw7CiAgcmV0dXJuIHVuaXQgJiYgIXdoaXRlc3BhY2VSZWdleC50ZXN0KHZhbCkgPyB1bml0TGVzcyArIHVuaXQgOiB1bml0TGVzczsKfQoKLy8gZ2V0VG90YWxMZW5ndGgoKSBlcXVpdmFsZW50IGZvciBjaXJjbGUsIHJlY3QsIHBvbHlsaW5lLCBwb2x5Z29uIGFuZCBsaW5lIHNoYXBlcwovLyBhZGFwdGVkIGZyb20gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vU2ViTGFtYmxhLzNlMDU1MGM0OTZjMjM2NzA5NzQ0CgpmdW5jdGlvbiBnZXREaXN0YW5jZShwMSwgcDIpIHsKICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHAyLnggLSBwMS54LCAyKSArIE1hdGgucG93KHAyLnkgLSBwMS55LCAyKSk7Cn0KCmZ1bmN0aW9uIGdldENpcmNsZUxlbmd0aChlbCkgewogIHJldHVybiBNYXRoLlBJICogMiAqIGdldEF0dHJpYnV0ZShlbCwgJ3InKTsKfQoKZnVuY3Rpb24gZ2V0UmVjdExlbmd0aChlbCkgewogIHJldHVybiAoZ2V0QXR0cmlidXRlKGVsLCAnd2lkdGgnKSAqIDIpICsgKGdldEF0dHJpYnV0ZShlbCwgJ2hlaWdodCcpICogMik7Cn0KCmZ1bmN0aW9uIGdldExpbmVMZW5ndGgoZWwpIHsKICByZXR1cm4gZ2V0RGlzdGFuY2UoCiAgICB7eDogZ2V0QXR0cmlidXRlKGVsLCAneDEnKSwgeTogZ2V0QXR0cmlidXRlKGVsLCAneTEnKX0sCiAgICB7eDogZ2V0QXR0cmlidXRlKGVsLCAneDInKSwgeTogZ2V0QXR0cmlidXRlKGVsLCAneTInKX0KICApOwp9CgpmdW5jdGlvbiBnZXRQb2x5bGluZUxlbmd0aChlbCkgewogIHZhciBwb2ludHMgPSBlbC5wb2ludHM7CiAgdmFyIHRvdGFsTGVuZ3RoID0gMDsKICB2YXIgcHJldmlvdXNQb3M7CiAgZm9yICh2YXIgaSA9IDAgOyBpIDwgcG9pbnRzLm51bWJlck9mSXRlbXM7IGkrKykgewogICAgdmFyIGN1cnJlbnRQb3MgPSBwb2ludHMuZ2V0SXRlbShpKTsKICAgIGlmIChpID4gMCkgeyB0b3RhbExlbmd0aCArPSBnZXREaXN0YW5jZShwcmV2aW91c1BvcywgY3VycmVudFBvcyk7IH0KICAgIHByZXZpb3VzUG9zID0gY3VycmVudFBvczsKICB9CiAgcmV0dXJuIHRvdGFsTGVuZ3RoOwp9CgpmdW5jdGlvbiBnZXRQb2x5Z29uTGVuZ3RoKGVsKSB7CiAgdmFyIHBvaW50cyA9IGVsLnBvaW50czsKICByZXR1cm4gZ2V0UG9seWxpbmVMZW5ndGgoZWwpICsgZ2V0RGlzdGFuY2UocG9pbnRzLmdldEl0ZW0ocG9pbnRzLm51bWJlck9mSXRlbXMgLSAxKSwgcG9pbnRzLmdldEl0ZW0oMCkpOwp9CgovLyBQYXRoIGFuaW1hdGlvbgoKZnVuY3Rpb24gZ2V0VG90YWxMZW5ndGgoZWwpIHsKICBpZiAoZWwuZ2V0VG90YWxMZW5ndGgpIHsgcmV0dXJuIGVsLmdldFRvdGFsTGVuZ3RoKCk7IH0KICBzd2l0Y2goZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSB7CiAgICBjYXNlICdjaXJjbGUnOiByZXR1cm4gZ2V0Q2lyY2xlTGVuZ3RoKGVsKTsKICAgIGNhc2UgJ3JlY3QnOiByZXR1cm4gZ2V0UmVjdExlbmd0aChlbCk7CiAgICBjYXNlICdsaW5lJzogcmV0dXJuIGdldExpbmVMZW5ndGgoZWwpOwogICAgY2FzZSAncG9seWxpbmUnOiByZXR1cm4gZ2V0UG9seWxpbmVMZW5ndGgoZWwpOwogICAgY2FzZSAncG9seWdvbic6IHJldHVybiBnZXRQb2x5Z29uTGVuZ3RoKGVsKTsKICB9Cn0KCmZ1bmN0aW9uIHNldERhc2hvZmZzZXQoZWwpIHsKICB2YXIgcGF0aExlbmd0aCA9IGdldFRvdGFsTGVuZ3RoKGVsKTsKICBlbC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNoYXJyYXknLCBwYXRoTGVuZ3RoKTsKICByZXR1cm4gcGF0aExlbmd0aDsKfQoKLy8gTW90aW9uIHBhdGgKCmZ1bmN0aW9uIGdldFBhcmVudFN2Z0VsKGVsKSB7CiAgdmFyIHBhcmVudEVsID0gZWwucGFyZW50Tm9kZTsKICB3aGlsZSAoaXMuc3ZnKHBhcmVudEVsKSkgewogICAgcGFyZW50RWwgPSBwYXJlbnRFbC5wYXJlbnROb2RlOwogICAgaWYgKCFpcy5zdmcocGFyZW50RWwucGFyZW50Tm9kZSkpIHsgYnJlYWs7IH0KICB9CiAgcmV0dXJuIHBhcmVudEVsOwp9CgpmdW5jdGlvbiBnZXRQYXJlbnRTdmcocGF0aEVsLCBzdmdEYXRhKSB7CiAgdmFyIHN2ZyA9IHN2Z0RhdGEgfHwge307CiAgdmFyIHBhcmVudFN2Z0VsID0gc3ZnLmVsIHx8IGdldFBhcmVudFN2Z0VsKHBhdGhFbCk7CiAgdmFyIHJlY3QgPSBwYXJlbnRTdmdFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICB2YXIgdmlld0JveEF0dHIgPSBnZXRBdHRyaWJ1dGUocGFyZW50U3ZnRWwsICd2aWV3Qm94Jyk7CiAgdmFyIHdpZHRoID0gcmVjdC53aWR0aDsKICB2YXIgaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7CiAgdmFyIHZpZXdCb3ggPSBzdmcudmlld0JveCB8fCAodmlld0JveEF0dHIgPyB2aWV3Qm94QXR0ci5zcGxpdCgnICcpIDogWzAsIDAsIHdpZHRoLCBoZWlnaHRdKTsKICByZXR1cm4gewogICAgZWw6IHBhcmVudFN2Z0VsLAogICAgdmlld0JveDogdmlld0JveCwKICAgIHg6IHZpZXdCb3hbMF0gLyAxLAogICAgeTogdmlld0JveFsxXSAvIDEsCiAgICB3OiB3aWR0aCAvIHZpZXdCb3hbMl0sCiAgICBoOiBoZWlnaHQgLyB2aWV3Qm94WzNdCiAgfQp9CgpmdW5jdGlvbiBnZXRQYXRoKHBhdGgsIHBlcmNlbnQpIHsKICB2YXIgcGF0aEVsID0gaXMuc3RyKHBhdGgpID8gc2VsZWN0U3RyaW5nKHBhdGgpWzBdIDogcGF0aDsKICB2YXIgcCA9IHBlcmNlbnQgfHwgMTAwOwogIHJldHVybiBmdW5jdGlvbihwcm9wZXJ0eSkgewogICAgcmV0dXJuIHsKICAgICAgcHJvcGVydHk6IHByb3BlcnR5LAogICAgICBlbDogcGF0aEVsLAogICAgICBzdmc6IGdldFBhcmVudFN2ZyhwYXRoRWwpLAogICAgICB0b3RhbExlbmd0aDogZ2V0VG90YWxMZW5ndGgocGF0aEVsKSAqIChwIC8gMTAwKQogICAgfQogIH0KfQoKZnVuY3Rpb24gZ2V0UGF0aFByb2dyZXNzKHBhdGgsIHByb2dyZXNzKSB7CiAgZnVuY3Rpb24gcG9pbnQob2Zmc2V0KSB7CiAgICBpZiAoIG9mZnNldCA9PT0gdm9pZCAwICkgb2Zmc2V0ID0gMDsKCiAgICB2YXIgbCA9IHByb2dyZXNzICsgb2Zmc2V0ID49IDEgPyBwcm9ncmVzcyArIG9mZnNldCA6IDA7CiAgICByZXR1cm4gcGF0aC5lbC5nZXRQb2ludEF0TGVuZ3RoKGwpOwogIH0KICB2YXIgc3ZnID0gZ2V0UGFyZW50U3ZnKHBhdGguZWwsIHBhdGguc3ZnKTsKICB2YXIgcCA9IHBvaW50KCk7CiAgdmFyIHAwID0gcG9pbnQoLTEpOwogIHZhciBwMSA9IHBvaW50KCsxKTsKICBzd2l0Y2ggKHBhdGgucHJvcGVydHkpIHsKICAgIGNhc2UgJ3gnOiByZXR1cm4gKHAueCAtIHN2Zy54KSAqIHN2Zy53OwogICAgY2FzZSAneSc6IHJldHVybiAocC55IC0gc3ZnLnkpICogc3ZnLmg7CiAgICBjYXNlICdhbmdsZSc6IHJldHVybiBNYXRoLmF0YW4yKHAxLnkgLSBwMC55LCBwMS54IC0gcDAueCkgKiAxODAgLyBNYXRoLlBJOwogIH0KfQoKLy8gRGVjb21wb3NlIHZhbHVlCgp2YXIgdmFsdWVSZWdleCA9IC8tP1xkKlwuP1xkKy9nOwoKZnVuY3Rpb24gZGVjb21wb3NlVmFsdWUodmFsLCB1bml0KSB7CiAgdmFyIHZhbHVlID0gdmFsaWRhdGVWYWx1ZSgoaXMucHRoKHZhbCkgPyB2YWwudG90YWxMZW5ndGggOiB2YWwpLCB1bml0KSArICcnOwogIHJldHVybiB7CiAgICBvcmlnaW5hbDogdmFsdWUsCiAgICBudW1iZXJzOiB2YWx1ZS5tYXRjaCh2YWx1ZVJlZ2V4KSA/IHZhbHVlLm1hdGNoKHZhbHVlUmVnZXgpLm1hcChOdW1iZXIpIDogWzBdLAogICAgc3RyaW5nczogKGlzLnN0cih2YWwpIHx8IHVuaXQpID8gdmFsdWUuc3BsaXQodmFsdWVSZWdleCkgOiBbXQogIH0KfQoKLy8gQW5pbWF0YWJsZXMKCmZ1bmN0aW9uIHBhcnNlVGFyZ2V0cyh0YXJnZXRzKSB7CiAgdmFyIHRhcmdldHNBcnJheSA9IHRhcmdldHMgPyAoZmxhdHRlbkFycmF5KGlzLmFycih0YXJnZXRzKSA/IHRhcmdldHMubWFwKHRvQXJyYXkpIDogdG9BcnJheSh0YXJnZXRzKSkpIDogW107CiAgcmV0dXJuIGZpbHRlckFycmF5KHRhcmdldHNBcnJheSwgZnVuY3Rpb24gKGl0ZW0sIHBvcywgc2VsZikgeyByZXR1cm4gc2VsZi5pbmRleE9mKGl0ZW0pID09PSBwb3M7IH0pOwp9CgpmdW5jdGlvbiBnZXRBbmltYXRhYmxlcyh0YXJnZXRzKSB7CiAgdmFyIHBhcnNlZCA9IHBhcnNlVGFyZ2V0cyh0YXJnZXRzKTsKICByZXR1cm4gcGFyc2VkLm1hcChmdW5jdGlvbiAodCwgaSkgewogICAgcmV0dXJuIHt0YXJnZXQ6IHQsIGlkOiBpLCB0b3RhbDogcGFyc2VkLmxlbmd0aCwgdHJhbnNmb3JtczogeyBsaXN0OiBnZXRFbGVtZW50VHJhbnNmb3Jtcyh0KSB9IH07CiAgfSk7Cn0KCi8vIFByb3BlcnRpZXMKCnZhciBzcHJpbmdSZWdleCA9IC9ec3ByaW5nLzsKCmZ1bmN0aW9uIG5vcm1hbGl6ZVByb3BlcnR5VHdlZW5zKHByb3AsIHR3ZWVuU2V0dGluZ3MpIHsKICB2YXIgc2V0dGluZ3MgPSBjbG9uZU9iamVjdCh0d2VlblNldHRpbmdzKTsKICAvLyBPdmVycmlkZSBkdXJhdGlvbiBpZiBlYXNpbmcgaXMgYSBzcHJpbmcKICBpZiAoc3ByaW5nUmVnZXgudGVzdChzZXR0aW5ncy5lYXNpbmcpKSB7IHNldHRpbmdzLmR1cmF0aW9uID0gc3ByaW5nKHNldHRpbmdzLmVhc2luZyk7IH0KICBpZiAoaXMuYXJyKHByb3ApKSB7CiAgICB2YXIgbCA9IHByb3AubGVuZ3RoOwogICAgdmFyIGlzRnJvbVRvID0gKGwgPT09IDIgJiYgIWlzLm9iaihwcm9wWzBdKSk7CiAgICBpZiAoIWlzRnJvbVRvKSB7CiAgICAgIC8vIER1cmF0aW9uIGRpdmlkZWQgYnkgdGhlIG51bWJlciBvZiB0d2VlbnMKICAgICAgaWYgKCFpcy5mbmModHdlZW5TZXR0aW5ncy5kdXJhdGlvbikpIHsgc2V0dGluZ3MuZHVyYXRpb24gPSB0d2VlblNldHRpbmdzLmR1cmF0aW9uIC8gbDsgfQogICAgfSBlbHNlIHsKICAgICAgLy8gVHJhbnNmb3JtIFtmcm9tLCB0b10gdmFsdWVzIHNob3J0aGFuZCB0byBhIHZhbGlkIHR3ZWVuIHZhbHVlCiAgICAgIHByb3AgPSB7dmFsdWU6IHByb3B9OwogICAgfQogIH0KICB2YXIgcHJvcEFycmF5ID0gaXMuYXJyKHByb3ApID8gcHJvcCA6IFtwcm9wXTsKICByZXR1cm4gcHJvcEFycmF5Lm1hcChmdW5jdGlvbiAodiwgaSkgewogICAgdmFyIG9iaiA9IChpcy5vYmoodikgJiYgIWlzLnB0aCh2KSkgPyB2IDoge3ZhbHVlOiB2fTsKICAgIC8vIERlZmF1bHQgZGVsYXkgdmFsdWUgc2hvdWxkIG9ubHkgYmUgYXBwbGllZCB0byB0aGUgZmlyc3QgdHdlZW4KICAgIGlmIChpcy51bmQob2JqLmRlbGF5KSkgeyBvYmouZGVsYXkgPSAhaSA/IHR3ZWVuU2V0dGluZ3MuZGVsYXkgOiAwOyB9CiAgICAvLyBEZWZhdWx0IGVuZERlbGF5IHZhbHVlIHNob3VsZCBvbmx5IGJlIGFwcGxpZWQgdG8gdGhlIGxhc3QgdHdlZW4KICAgIGlmIChpcy51bmQob2JqLmVuZERlbGF5KSkgeyBvYmouZW5kRGVsYXkgPSBpID09PSBwcm9wQXJyYXkubGVuZ3RoIC0gMSA/IHR3ZWVuU2V0dGluZ3MuZW5kRGVsYXkgOiAwOyB9CiAgICByZXR1cm4gb2JqOwogIH0pLm1hcChmdW5jdGlvbiAoaykgeyByZXR1cm4gbWVyZ2VPYmplY3RzKGssIHNldHRpbmdzKTsgfSk7Cn0KCgpmdW5jdGlvbiBmbGF0dGVuS2V5ZnJhbWVzKGtleWZyYW1lcykgewogIHZhciBwcm9wZXJ0eU5hbWVzID0gZmlsdGVyQXJyYXkoZmxhdHRlbkFycmF5KGtleWZyYW1lcy5tYXAoZnVuY3Rpb24gKGtleSkgeyByZXR1cm4gT2JqZWN0LmtleXMoa2V5KTsgfSkpLCBmdW5jdGlvbiAocCkgeyByZXR1cm4gaXMua2V5KHApOyB9KQogIC5yZWR1Y2UoZnVuY3Rpb24gKGEsYikgeyBpZiAoYS5pbmRleE9mKGIpIDwgMCkgeyBhLnB1c2goYik7IH0gcmV0dXJuIGE7IH0sIFtdKTsKICB2YXIgcHJvcGVydGllcyA9IHt9OwogIHZhciBsb29wID0gZnVuY3Rpb24gKCBpICkgewogICAgdmFyIHByb3BOYW1lID0gcHJvcGVydHlOYW1lc1tpXTsKICAgIHByb3BlcnRpZXNbcHJvcE5hbWVdID0ga2V5ZnJhbWVzLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHZhciBuZXdLZXkgPSB7fTsKICAgICAgZm9yICh2YXIgcCBpbiBrZXkpIHsKICAgICAgICBpZiAoaXMua2V5KHApKSB7CiAgICAgICAgICBpZiAocCA9PSBwcm9wTmFtZSkgeyBuZXdLZXkudmFsdWUgPSBrZXlbcF07IH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3S2V5W3BdID0ga2V5W3BdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbmV3S2V5OwogICAgfSk7CiAgfTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wZXJ0eU5hbWVzLmxlbmd0aDsgaSsrKSBsb29wKCBpICk7CiAgcmV0dXJuIHByb3BlcnRpZXM7Cn0KCmZ1bmN0aW9uIGdldFByb3BlcnRpZXModHdlZW5TZXR0aW5ncywgcGFyYW1zKSB7CiAgdmFyIHByb3BlcnRpZXMgPSBbXTsKICB2YXIga2V5ZnJhbWVzID0gcGFyYW1zLmtleWZyYW1lczsKICBpZiAoa2V5ZnJhbWVzKSB7IHBhcmFtcyA9IG1lcmdlT2JqZWN0cyhmbGF0dGVuS2V5ZnJhbWVzKGtleWZyYW1lcyksIHBhcmFtcyk7IH0KICBmb3IgKHZhciBwIGluIHBhcmFtcykgewogICAgaWYgKGlzLmtleShwKSkgewogICAgICBwcm9wZXJ0aWVzLnB1c2goewogICAgICAgIG5hbWU6IHAsCiAgICAgICAgdHdlZW5zOiBub3JtYWxpemVQcm9wZXJ0eVR3ZWVucyhwYXJhbXNbcF0sIHR3ZWVuU2V0dGluZ3MpCiAgICAgIH0pOwogICAgfQogIH0KICByZXR1cm4gcHJvcGVydGllczsKfQoKLy8gVHdlZW5zCgpmdW5jdGlvbiBub3JtYWxpemVUd2VlblZhbHVlcyh0d2VlbiwgYW5pbWF0YWJsZSkgewogIHZhciB0ID0ge307CiAgZm9yICh2YXIgcCBpbiB0d2VlbikgewogICAgdmFyIHZhbHVlID0gZ2V0RnVuY3Rpb25WYWx1ZSh0d2VlbltwXSwgYW5pbWF0YWJsZSk7CiAgICBpZiAoaXMuYXJyKHZhbHVlKSkgewogICAgICB2YWx1ZSA9IHZhbHVlLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gZ2V0RnVuY3Rpb25WYWx1ZSh2LCBhbmltYXRhYmxlKTsgfSk7CiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsgdmFsdWUgPSB2YWx1ZVswXTsgfQogICAgfQogICAgdFtwXSA9IHZhbHVlOwogIH0KICB0LmR1cmF0aW9uID0gcGFyc2VGbG9hdCh0LmR1cmF0aW9uKTsKICB0LmRlbGF5ID0gcGFyc2VGbG9hdCh0LmRlbGF5KTsKICByZXR1cm4gdDsKfQoKZnVuY3Rpb24gbm9ybWFsaXplVHdlZW5zKHByb3AsIGFuaW1hdGFibGUpIHsKICB2YXIgcHJldmlvdXNUd2VlbjsKICByZXR1cm4gcHJvcC50d2VlbnMubWFwKGZ1bmN0aW9uICh0KSB7CiAgICB2YXIgdHdlZW4gPSBub3JtYWxpemVUd2VlblZhbHVlcyh0LCBhbmltYXRhYmxlKTsKICAgIHZhciB0d2VlblZhbHVlID0gdHdlZW4udmFsdWU7CiAgICB2YXIgdG8gPSBpcy5hcnIodHdlZW5WYWx1ZSkgPyB0d2VlblZhbHVlWzFdIDogdHdlZW5WYWx1ZTsKICAgIHZhciB0b1VuaXQgPSBnZXRVbml0KHRvKTsKICAgIHZhciBvcmlnaW5hbFZhbHVlID0gZ2V0T3JpZ2luYWxUYXJnZXRWYWx1ZShhbmltYXRhYmxlLnRhcmdldCwgcHJvcC5uYW1lLCB0b1VuaXQsIGFuaW1hdGFibGUpOwogICAgdmFyIHByZXZpb3VzVmFsdWUgPSBwcmV2aW91c1R3ZWVuID8gcHJldmlvdXNUd2Vlbi50by5vcmlnaW5hbCA6IG9yaWdpbmFsVmFsdWU7CiAgICB2YXIgZnJvbSA9IGlzLmFycih0d2VlblZhbHVlKSA/IHR3ZWVuVmFsdWVbMF0gOiBwcmV2aW91c1ZhbHVlOwogICAgdmFyIGZyb21Vbml0ID0gZ2V0VW5pdChmcm9tKSB8fCBnZXRVbml0KG9yaWdpbmFsVmFsdWUpOwogICAgdmFyIHVuaXQgPSB0b1VuaXQgfHwgZnJvbVVuaXQ7CiAgICBpZiAoaXMudW5kKHRvKSkgeyB0byA9IHByZXZpb3VzVmFsdWU7IH0KICAgIHR3ZWVuLmZyb20gPSBkZWNvbXBvc2VWYWx1ZShmcm9tLCB1bml0KTsKICAgIHR3ZWVuLnRvID0gZGVjb21wb3NlVmFsdWUoZ2V0UmVsYXRpdmVWYWx1ZSh0bywgZnJvbSksIHVuaXQpOwogICAgdHdlZW4uc3RhcnQgPSBwcmV2aW91c1R3ZWVuID8gcHJldmlvdXNUd2Vlbi5lbmQgOiAwOwogICAgdHdlZW4uZW5kID0gdHdlZW4uc3RhcnQgKyB0d2Vlbi5kZWxheSArIHR3ZWVuLmR1cmF0aW9uICsgdHdlZW4uZW5kRGVsYXk7CiAgICB0d2Vlbi5lYXNpbmcgPSBwYXJzZUVhc2luZ3ModHdlZW4uZWFzaW5nLCB0d2Vlbi5kdXJhdGlvbik7CiAgICB0d2Vlbi5pc1BhdGggPSBpcy5wdGgodHdlZW5WYWx1ZSk7CiAgICB0d2Vlbi5pc0NvbG9yID0gaXMuY29sKHR3ZWVuLmZyb20ub3JpZ2luYWwpOwogICAgaWYgKHR3ZWVuLmlzQ29sb3IpIHsgdHdlZW4ucm91bmQgPSAxOyB9CiAgICBwcmV2aW91c1R3ZWVuID0gdHdlZW47CiAgICByZXR1cm4gdHdlZW47CiAgfSk7Cn0KCi8vIFR3ZWVuIHByb2dyZXNzCgp2YXIgc2V0UHJvZ3Jlc3NWYWx1ZSA9IHsKICBjc3M6IGZ1bmN0aW9uICh0LCBwLCB2KSB7IHJldHVybiB0LnN0eWxlW3BdID0gdjsgfSwKICBhdHRyaWJ1dGU6IGZ1bmN0aW9uICh0LCBwLCB2KSB7IHJldHVybiB0LnNldEF0dHJpYnV0ZShwLCB2KTsgfSwKICBvYmplY3Q6IGZ1bmN0aW9uICh0LCBwLCB2KSB7IHJldHVybiB0W3BdID0gdjsgfSwKICB0cmFuc2Zvcm06IGZ1bmN0aW9uICh0LCBwLCB2LCB0cmFuc2Zvcm1zLCBtYW51YWwpIHsKICAgIHRyYW5zZm9ybXMubGlzdC5zZXQocCwgdik7CiAgICBpZiAocCA9PT0gdHJhbnNmb3Jtcy5sYXN0IHx8IG1hbnVhbCkgewogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHRyYW5zZm9ybXMubGlzdC5mb3JFYWNoKGZ1bmN0aW9uICh2YWx1ZSwgcHJvcCkgeyBzdHIgKz0gcHJvcCArICIoIiArIHZhbHVlICsgIikgIjsgfSk7CiAgICAgIHQuc3R5bGUudHJhbnNmb3JtID0gc3RyOwogICAgfQogIH0KfTsKCi8vIFNldCBWYWx1ZSBoZWxwZXIKCmZ1bmN0aW9uIHNldFRhcmdldHNWYWx1ZSh0YXJnZXRzLCBwcm9wZXJ0aWVzKSB7CiAgdmFyIGFuaW1hdGFibGVzID0gZ2V0QW5pbWF0YWJsZXModGFyZ2V0cyk7CgogIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhbmltYXRhYmxlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgdmFyIGFuaW1hdGFibGUgPSBhbmltYXRhYmxlc1tpXTsKCiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgIHZhciB2YWx1ZSA9IGdldEZ1bmN0aW9uVmFsdWUocHJvcGVydGllc1twcm9wZXJ0eV0sIGFuaW1hdGFibGUpOwogICAgICB2YXIgdGFyZ2V0ID0gYW5pbWF0YWJsZS50YXJnZXQ7CiAgICAgIHZhciB2YWx1ZVVuaXQgPSBnZXRVbml0KHZhbHVlKTsKICAgICAgdmFyIG9yaWdpbmFsVmFsdWUgPSBnZXRPcmlnaW5hbFRhcmdldFZhbHVlKHRhcmdldCwgcHJvcGVydHksIHZhbHVlVW5pdCwgYW5pbWF0YWJsZSk7CiAgICAgIHZhciB1bml0ID0gdmFsdWVVbml0IHx8IGdldFVuaXQob3JpZ2luYWxWYWx1ZSk7CiAgICAgIHZhciB0byA9IGdldFJlbGF0aXZlVmFsdWUodmFsaWRhdGVWYWx1ZSh2YWx1ZSwgdW5pdCksIG9yaWdpbmFsVmFsdWUpOwogICAgICB2YXIgYW5pbVR5cGUgPSBnZXRBbmltYXRpb25UeXBlKHRhcmdldCwgcHJvcGVydHkpOwogICAgICBzZXRQcm9ncmVzc1ZhbHVlW2FuaW1UeXBlXSh0YXJnZXQsIHByb3BlcnR5LCB0bywgYW5pbWF0YWJsZS50cmFuc2Zvcm1zLCB0cnVlKTsKICAgIH0KICB9Cn0KCi8vIEFuaW1hdGlvbnMKCmZ1bmN0aW9uIGNyZWF0ZUFuaW1hdGlvbihhbmltYXRhYmxlLCBwcm9wKSB7CiAgdmFyIGFuaW1UeXBlID0gZ2V0QW5pbWF0aW9uVHlwZShhbmltYXRhYmxlLnRhcmdldCwgcHJvcC5uYW1lKTsKICBpZiAoYW5pbVR5cGUpIHsKICAgIHZhciB0d2VlbnMgPSBub3JtYWxpemVUd2VlbnMocHJvcCwgYW5pbWF0YWJsZSk7CiAgICB2YXIgbGFzdFR3ZWVuID0gdHdlZW5zW3R3ZWVucy5sZW5ndGggLSAxXTsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IGFuaW1UeXBlLAogICAgICBwcm9wZXJ0eTogcHJvcC5uYW1lLAogICAgICBhbmltYXRhYmxlOiBhbmltYXRhYmxlLAogICAgICB0d2VlbnM6IHR3ZWVucywKICAgICAgZHVyYXRpb246IGxhc3RUd2Vlbi5lbmQsCiAgICAgIGRlbGF5OiB0d2VlbnNbMF0uZGVsYXksCiAgICAgIGVuZERlbGF5OiBsYXN0VHdlZW4uZW5kRGVsYXkKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGdldEFuaW1hdGlvbnMoYW5pbWF0YWJsZXMsIHByb3BlcnRpZXMpIHsKICByZXR1cm4gZmlsdGVyQXJyYXkoZmxhdHRlbkFycmF5KGFuaW1hdGFibGVzLm1hcChmdW5jdGlvbiAoYW5pbWF0YWJsZSkgewogICAgcmV0dXJuIHByb3BlcnRpZXMubWFwKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgIHJldHVybiBjcmVhdGVBbmltYXRpb24oYW5pbWF0YWJsZSwgcHJvcCk7CiAgICB9KTsKICB9KSksIGZ1bmN0aW9uIChhKSB7IHJldHVybiAhaXMudW5kKGEpOyB9KTsKfQoKLy8gQ3JlYXRlIEluc3RhbmNlCgpmdW5jdGlvbiBnZXRJbnN0YW5jZVRpbWluZ3MoYW5pbWF0aW9ucywgdHdlZW5TZXR0aW5ncykgewogIHZhciBhbmltTGVuZ3RoID0gYW5pbWF0aW9ucy5sZW5ndGg7CiAgdmFyIGdldFRsT2Zmc2V0ID0gZnVuY3Rpb24gKGFuaW0pIHsgcmV0dXJuIGFuaW0udGltZWxpbmVPZmZzZXQgPyBhbmltLnRpbWVsaW5lT2Zmc2V0IDogMDsgfTsKICB2YXIgdGltaW5ncyA9IHt9OwogIHRpbWluZ3MuZHVyYXRpb24gPSBhbmltTGVuZ3RoID8gTWF0aC5tYXguYXBwbHkoTWF0aCwgYW5pbWF0aW9ucy5tYXAoZnVuY3Rpb24gKGFuaW0pIHsgcmV0dXJuIGdldFRsT2Zmc2V0KGFuaW0pICsgYW5pbS5kdXJhdGlvbjsgfSkpIDogdHdlZW5TZXR0aW5ncy5kdXJhdGlvbjsKICB0aW1pbmdzLmRlbGF5ID0gYW5pbUxlbmd0aCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIGFuaW1hdGlvbnMubWFwKGZ1bmN0aW9uIChhbmltKSB7IHJldHVybiBnZXRUbE9mZnNldChhbmltKSArIGFuaW0uZGVsYXk7IH0pKSA6IHR3ZWVuU2V0dGluZ3MuZGVsYXk7CiAgdGltaW5ncy5lbmREZWxheSA9IGFuaW1MZW5ndGggPyB0aW1pbmdzLmR1cmF0aW9uIC0gTWF0aC5tYXguYXBwbHkoTWF0aCwgYW5pbWF0aW9ucy5tYXAoZnVuY3Rpb24gKGFuaW0pIHsgcmV0dXJuIGdldFRsT2Zmc2V0KGFuaW0pICsgYW5pbS5kdXJhdGlvbiAtIGFuaW0uZW5kRGVsYXk7IH0pKSA6IHR3ZWVuU2V0dGluZ3MuZW5kRGVsYXk7CiAgcmV0dXJuIHRpbWluZ3M7Cn0KCnZhciBpbnN0YW5jZUlEID0gMDsKCmZ1bmN0aW9uIGNyZWF0ZU5ld0luc3RhbmNlKHBhcmFtcykgewogIHZhciBpbnN0YW5jZVNldHRpbmdzID0gcmVwbGFjZU9iamVjdFByb3BzKGRlZmF1bHRJbnN0YW5jZVNldHRpbmdzLCBwYXJhbXMpOwogIHZhciB0d2VlblNldHRpbmdzID0gcmVwbGFjZU9iamVjdFByb3BzKGRlZmF1bHRUd2VlblNldHRpbmdzLCBwYXJhbXMpOwogIHZhciBwcm9wZXJ0aWVzID0gZ2V0UHJvcGVydGllcyh0d2VlblNldHRpbmdzLCBwYXJhbXMpOwogIHZhciBhbmltYXRhYmxlcyA9IGdldEFuaW1hdGFibGVzKHBhcmFtcy50YXJnZXRzKTsKICB2YXIgYW5pbWF0aW9ucyA9IGdldEFuaW1hdGlvbnMoYW5pbWF0YWJsZXMsIHByb3BlcnRpZXMpOwogIHZhciB0aW1pbmdzID0gZ2V0SW5zdGFuY2VUaW1pbmdzKGFuaW1hdGlvbnMsIHR3ZWVuU2V0dGluZ3MpOwogIHZhciBpZCA9IGluc3RhbmNlSUQ7CiAgaW5zdGFuY2VJRCsrOwogIHJldHVybiBtZXJnZU9iamVjdHMoaW5zdGFuY2VTZXR0aW5ncywgewogICAgaWQ6IGlkLAogICAgY2hpbGRyZW46IFtdLAogICAgYW5pbWF0YWJsZXM6IGFuaW1hdGFibGVzLAogICAgYW5pbWF0aW9uczogYW5pbWF0aW9ucywKICAgIGR1cmF0aW9uOiB0aW1pbmdzLmR1cmF0aW9uLAogICAgZGVsYXk6IHRpbWluZ3MuZGVsYXksCiAgICBlbmREZWxheTogdGltaW5ncy5lbmREZWxheQogIH0pOwp9CgovLyBDb3JlCgp2YXIgYWN0aXZlSW5zdGFuY2VzID0gW107CnZhciBwYXVzZWRJbnN0YW5jZXMgPSBbXTsKdmFyIHJhZjsKCnZhciBlbmdpbmUgPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIHBsYXkoKSB7CiAgICByYWYgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcCk7CiAgfQogIGZ1bmN0aW9uIHN0ZXAodCkgewogICAgdmFyIGFjdGl2ZUluc3RhbmNlc0xlbmd0aCA9IGFjdGl2ZUluc3RhbmNlcy5sZW5ndGg7CiAgICBpZiAoYWN0aXZlSW5zdGFuY2VzTGVuZ3RoKSB7CiAgICAgIHZhciBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBhY3RpdmVJbnN0YW5jZXNMZW5ndGgpIHsKICAgICAgICB2YXIgYWN0aXZlSW5zdGFuY2UgPSBhY3RpdmVJbnN0YW5jZXNbaV07CiAgICAgICAgaWYgKCFhY3RpdmVJbnN0YW5jZS5wYXVzZWQpIHsKICAgICAgICAgIGFjdGl2ZUluc3RhbmNlLnRpY2sodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBpbnN0YW5jZUluZGV4ID0gYWN0aXZlSW5zdGFuY2VzLmluZGV4T2YoYWN0aXZlSW5zdGFuY2UpOwogICAgICAgICAgaWYgKGluc3RhbmNlSW5kZXggPiAtMSkgewogICAgICAgICAgICBhY3RpdmVJbnN0YW5jZXMuc3BsaWNlKGluc3RhbmNlSW5kZXgsIDEpOwogICAgICAgICAgICBhY3RpdmVJbnN0YW5jZXNMZW5ndGggPSBhY3RpdmVJbnN0YW5jZXMubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpKys7CiAgICAgIH0KICAgICAgcGxheSgpOwogICAgfSBlbHNlIHsKICAgICAgcmFmID0gY2FuY2VsQW5pbWF0aW9uRnJhbWUocmFmKTsKICAgIH0KICB9CiAgcmV0dXJuIHBsYXk7Cn0pKCk7CgpmdW5jdGlvbiBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKCkgewogIGlmIChkb2N1bWVudC5oaWRkZW4pIHsKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhY3RpdmVJbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgYWN0aXZlSW5zdGFuY2VbaV0ucGF1c2UoKTsKICAgIH0KICAgIHBhdXNlZEluc3RhbmNlcyA9IGFjdGl2ZUluc3RhbmNlcy5zbGljZSgwKTsKICAgIGFjdGl2ZUluc3RhbmNlcyA9IFtdOwogIH0gZWxzZSB7CiAgICBmb3IgKHZhciBpJDEgPSAwLCBsZW4kMSA9IHBhdXNlZEluc3RhbmNlcy5sZW5ndGg7IGkkMSA8IGxlbiQxOyBpJDErKykgewogICAgICBwYXVzZWRJbnN0YW5jZXNbaSQxXS5wbGF5KCk7CiAgICB9CiAgfQp9Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7CgovLyBQdWJsaWMgSW5zdGFuY2UKCmZ1bmN0aW9uIGFuaW1lKHBhcmFtcykgewogIGlmICggcGFyYW1zID09PSB2b2lkIDAgKSBwYXJhbXMgPSB7fTsKCgogIHZhciBzdGFydFRpbWUgPSAwLCBsYXN0VGltZSA9IDAsIG5vdyA9IDA7CiAgdmFyIGNoaWxkcmVuLCBjaGlsZHJlbkxlbmd0aCA9IDA7CiAgdmFyIHJlc29sdmUgPSBudWxsOwoKICBmdW5jdGlvbiBtYWtlUHJvbWlzZSgpIHsKICAgIHJldHVybiB3aW5kb3cuUHJvbWlzZSAmJiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoX3Jlc29sdmUpIHsgcmV0dXJuIHJlc29sdmUgPSBfcmVzb2x2ZTsgfSk7CiAgfQoKICB2YXIgcHJvbWlzZSA9IG1ha2VQcm9taXNlKCk7CgogIHZhciBpbnN0YW5jZSA9IGNyZWF0ZU5ld0luc3RhbmNlKHBhcmFtcyk7CgogIGZ1bmN0aW9uIHRvZ2dsZUluc3RhbmNlRGlyZWN0aW9uKCkgewogICAgaW5zdGFuY2UucmV2ZXJzZWQgPSAhaW5zdGFuY2UucmV2ZXJzZWQ7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgY2hpbGRyZW5baV0ucmV2ZXJzZWQgPSBpbnN0YW5jZS5yZXZlcnNlZDsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFkanVzdFRpbWUodGltZSkgewogICAgcmV0dXJuIGluc3RhbmNlLnJldmVyc2VkID8gaW5zdGFuY2UuZHVyYXRpb24gLSB0aW1lIDogdGltZTsKICB9CgogIGZ1bmN0aW9uIHJlc2V0VGltZSgpIHsKICAgIHN0YXJ0VGltZSA9IDA7CiAgICBsYXN0VGltZSA9IGFkanVzdFRpbWUoaW5zdGFuY2UuY3VycmVudFRpbWUpICogKDEgLyBhbmltZS5zcGVlZCk7CiAgfQoKICBmdW5jdGlvbiBzZWVrQ2lsZCh0aW1lLCBjaGlsZCkgewogICAgaWYgKGNoaWxkKSB7IGNoaWxkLnNlZWsodGltZSAtIGNoaWxkLnRpbWVsaW5lT2Zmc2V0KTsgfQogIH0KCiAgZnVuY3Rpb24gc3luY0luc3RhbmNlQ2hpbGRyZW4odGltZSkgewogICAgaWYgKCFpbnN0YW5jZS5yZXZlcnNlUGxheWJhY2spIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbkxlbmd0aDsgaSsrKSB7IHNlZWtDaWxkKHRpbWUsIGNoaWxkcmVuW2ldKTsgfQogICAgfSBlbHNlIHsKICAgICAgZm9yICh2YXIgaSQxID0gY2hpbGRyZW5MZW5ndGg7IGkkMS0tOykgeyBzZWVrQ2lsZCh0aW1lLCBjaGlsZHJlbltpJDFdKTsgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0QW5pbWF0aW9uc1Byb2dyZXNzKGluc1RpbWUpIHsKICAgIHZhciBpID0gMDsKICAgIHZhciBhbmltYXRpb25zID0gaW5zdGFuY2UuYW5pbWF0aW9uczsKICAgIHZhciBhbmltYXRpb25zTGVuZ3RoID0gYW5pbWF0aW9ucy5sZW5ndGg7CiAgICB3aGlsZSAoaSA8IGFuaW1hdGlvbnNMZW5ndGgpIHsKICAgICAgdmFyIGFuaW0gPSBhbmltYXRpb25zW2ldOwogICAgICB2YXIgYW5pbWF0YWJsZSA9IGFuaW0uYW5pbWF0YWJsZTsKICAgICAgdmFyIHR3ZWVucyA9IGFuaW0udHdlZW5zOwogICAgICB2YXIgdHdlZW5MZW5ndGggPSB0d2VlbnMubGVuZ3RoIC0gMTsKICAgICAgdmFyIHR3ZWVuID0gdHdlZW5zW3R3ZWVuTGVuZ3RoXTsKICAgICAgLy8gT25seSBjaGVjayBmb3Iga2V5ZnJhbWVzIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgdHdlZW4KICAgICAgaWYgKHR3ZWVuTGVuZ3RoKSB7IHR3ZWVuID0gZmlsdGVyQXJyYXkodHdlZW5zLCBmdW5jdGlvbiAodCkgeyByZXR1cm4gKGluc1RpbWUgPCB0LmVuZCk7IH0pWzBdIHx8IHR3ZWVuOyB9CiAgICAgIHZhciBlbGFwc2VkID0gbWluTWF4KGluc1RpbWUgLSB0d2Vlbi5zdGFydCAtIHR3ZWVuLmRlbGF5LCAwLCB0d2Vlbi5kdXJhdGlvbikgLyB0d2Vlbi5kdXJhdGlvbjsKICAgICAgdmFyIGVhc2VkID0gaXNOYU4oZWxhcHNlZCkgPyAxIDogdHdlZW4uZWFzaW5nKGVsYXBzZWQpOwogICAgICB2YXIgc3RyaW5ncyA9IHR3ZWVuLnRvLnN0cmluZ3M7CiAgICAgIHZhciByb3VuZCA9IHR3ZWVuLnJvdW5kOwogICAgICB2YXIgbnVtYmVycyA9IFtdOwogICAgICB2YXIgdG9OdW1iZXJzTGVuZ3RoID0gdHdlZW4udG8ubnVtYmVycy5sZW5ndGg7CiAgICAgIHZhciBwcm9ncmVzcyA9ICh2b2lkIDApOwogICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHRvTnVtYmVyc0xlbmd0aDsgbisrKSB7CiAgICAgICAgdmFyIHZhbHVlID0gKHZvaWQgMCk7CiAgICAgICAgdmFyIHRvTnVtYmVyID0gdHdlZW4udG8ubnVtYmVyc1tuXTsKICAgICAgICB2YXIgZnJvbU51bWJlciA9IHR3ZWVuLmZyb20ubnVtYmVyc1tuXSB8fCAwOwogICAgICAgIGlmICghdHdlZW4uaXNQYXRoKSB7CiAgICAgICAgICB2YWx1ZSA9IGZyb21OdW1iZXIgKyAoZWFzZWQgKiAodG9OdW1iZXIgLSBmcm9tTnVtYmVyKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbHVlID0gZ2V0UGF0aFByb2dyZXNzKHR3ZWVuLnZhbHVlLCBlYXNlZCAqIHRvTnVtYmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJvdW5kKSB7CiAgICAgICAgICBpZiAoISh0d2Vlbi5pc0NvbG9yICYmIG4gPiAyKSkgewogICAgICAgICAgICB2YWx1ZSA9IE1hdGgucm91bmQodmFsdWUgKiByb3VuZCkgLyByb3VuZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbnVtYmVycy5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgICAvLyBNYW51YWwgQXJyYXkucmVkdWNlIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VzCiAgICAgIHZhciBzdHJpbmdzTGVuZ3RoID0gc3RyaW5ncy5sZW5ndGg7CiAgICAgIGlmICghc3RyaW5nc0xlbmd0aCkgewogICAgICAgIHByb2dyZXNzID0gbnVtYmVyc1swXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9ncmVzcyA9IHN0cmluZ3NbMF07CiAgICAgICAgZm9yICh2YXIgcyA9IDA7IHMgPCBzdHJpbmdzTGVuZ3RoOyBzKyspIHsKICAgICAgICAgIHZhciBhID0gc3RyaW5nc1tzXTsKICAgICAgICAgIHZhciBiID0gc3RyaW5nc1tzICsgMV07CiAgICAgICAgICB2YXIgbiQxID0gbnVtYmVyc1tzXTsKICAgICAgICAgIGlmICghaXNOYU4obiQxKSkgewogICAgICAgICAgICBpZiAoIWIpIHsKICAgICAgICAgICAgICBwcm9ncmVzcyArPSBuJDEgKyAnICc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcHJvZ3Jlc3MgKz0gbiQxICsgYjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBzZXRQcm9ncmVzc1ZhbHVlW2FuaW0udHlwZV0oYW5pbWF0YWJsZS50YXJnZXQsIGFuaW0ucHJvcGVydHksIHByb2dyZXNzLCBhbmltYXRhYmxlLnRyYW5zZm9ybXMpOwogICAgICBhbmltLmN1cnJlbnRWYWx1ZSA9IHByb2dyZXNzOwogICAgICBpKys7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRDYWxsYmFjayhjYikgewogICAgaWYgKGluc3RhbmNlW2NiXSAmJiAhaW5zdGFuY2UucGFzc1Rocm91Z2gpIHsgaW5zdGFuY2VbY2JdKGluc3RhbmNlKTsgfQogIH0KCiAgZnVuY3Rpb24gY291bnRJdGVyYXRpb24oKSB7CiAgICBpZiAoaW5zdGFuY2UucmVtYWluaW5nICYmIGluc3RhbmNlLnJlbWFpbmluZyAhPT0gdHJ1ZSkgewogICAgICBpbnN0YW5jZS5yZW1haW5pbmctLTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNldEluc3RhbmNlUHJvZ3Jlc3MoZW5naW5lVGltZSkgewogICAgdmFyIGluc0R1cmF0aW9uID0gaW5zdGFuY2UuZHVyYXRpb247CiAgICB2YXIgaW5zRGVsYXkgPSBpbnN0YW5jZS5kZWxheTsKICAgIHZhciBpbnNFbmREZWxheSA9IGluc0R1cmF0aW9uIC0gaW5zdGFuY2UuZW5kRGVsYXk7CiAgICB2YXIgaW5zVGltZSA9IGFkanVzdFRpbWUoZW5naW5lVGltZSk7CiAgICBpbnN0YW5jZS5wcm9ncmVzcyA9IG1pbk1heCgoaW5zVGltZSAvIGluc0R1cmF0aW9uKSAqIDEwMCwgMCwgMTAwKTsKICAgIGluc3RhbmNlLnJldmVyc2VQbGF5YmFjayA9IGluc1RpbWUgPCBpbnN0YW5jZS5jdXJyZW50VGltZTsKICAgIGlmIChjaGlsZHJlbikgeyBzeW5jSW5zdGFuY2VDaGlsZHJlbihpbnNUaW1lKTsgfQogICAgaWYgKCFpbnN0YW5jZS5iZWdhbiAmJiBpbnN0YW5jZS5jdXJyZW50VGltZSA+IDApIHsKICAgICAgaW5zdGFuY2UuYmVnYW4gPSB0cnVlOwogICAgICBzZXRDYWxsYmFjaygnYmVnaW4nKTsKICAgICAgc2V0Q2FsbGJhY2soJ2xvb3BCZWdpbicpOwogICAgfQogICAgaWYgKGluc1RpbWUgPD0gaW5zRGVsYXkgJiYgaW5zdGFuY2UuY3VycmVudFRpbWUgIT09IDApIHsKICAgICAgc2V0QW5pbWF0aW9uc1Byb2dyZXNzKDApOwogICAgfQogICAgaWYgKChpbnNUaW1lID49IGluc0VuZERlbGF5ICYmIGluc3RhbmNlLmN1cnJlbnRUaW1lICE9PSBpbnNEdXJhdGlvbikgfHwgIWluc0R1cmF0aW9uKSB7CiAgICAgIHNldEFuaW1hdGlvbnNQcm9ncmVzcyhpbnNEdXJhdGlvbik7CiAgICB9CiAgICBpZiAoaW5zVGltZSA+IGluc0RlbGF5ICYmIGluc1RpbWUgPCBpbnNFbmREZWxheSkgewogICAgICBpZiAoIWluc3RhbmNlLmNoYW5nZUJlZ2FuKSB7CiAgICAgICAgaW5zdGFuY2UuY2hhbmdlQmVnYW4gPSB0cnVlOwogICAgICAgIGluc3RhbmNlLmNoYW5nZUNvbXBsZXRlZCA9IGZhbHNlOwogICAgICAgIHNldENhbGxiYWNrKCdjaGFuZ2VCZWdpbicpOwogICAgICB9CiAgICAgIHNldENhbGxiYWNrKCdjaGFuZ2UnKTsKICAgICAgc2V0QW5pbWF0aW9uc1Byb2dyZXNzKGluc1RpbWUpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGluc3RhbmNlLmNoYW5nZUJlZ2FuKSB7CiAgICAgICAgaW5zdGFuY2UuY2hhbmdlQ29tcGxldGVkID0gdHJ1ZTsKICAgICAgICBpbnN0YW5jZS5jaGFuZ2VCZWdhbiA9IGZhbHNlOwogICAgICAgIHNldENhbGxiYWNrKCdjaGFuZ2VDb21wbGV0ZScpOwogICAgICB9CiAgICB9CiAgICBpbnN0YW5jZS5jdXJyZW50VGltZSA9IG1pbk1heChpbnNUaW1lLCAwLCBpbnNEdXJhdGlvbik7CiAgICBpZiAoaW5zdGFuY2UuYmVnYW4pIHsgc2V0Q2FsbGJhY2soJ3VwZGF0ZScpOyB9CiAgICBpZiAoZW5naW5lVGltZSA+PSBpbnNEdXJhdGlvbikgewogICAgICBsYXN0VGltZSA9IDA7CiAgICAgIGNvdW50SXRlcmF0aW9uKCk7CiAgICAgIGlmIChpbnN0YW5jZS5yZW1haW5pbmcpIHsKICAgICAgICBzdGFydFRpbWUgPSBub3c7CiAgICAgICAgc2V0Q2FsbGJhY2soJ2xvb3BDb21wbGV0ZScpOwogICAgICAgIHNldENhbGxiYWNrKCdsb29wQmVnaW4nKTsKICAgICAgICBpZiAoaW5zdGFuY2UuZGlyZWN0aW9uID09PSAnYWx0ZXJuYXRlJykgeyB0b2dnbGVJbnN0YW5jZURpcmVjdGlvbigpOyB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaW5zdGFuY2UucGF1c2VkID0gdHJ1ZTsKICAgICAgICBpZiAoIWluc3RhbmNlLmNvbXBsZXRlZCkgewogICAgICAgICAgaW5zdGFuY2UuY29tcGxldGVkID0gdHJ1ZTsKICAgICAgICAgIHNldENhbGxiYWNrKCdsb29wQ29tcGxldGUnKTsKICAgICAgICAgIHNldENhbGxiYWNrKCdjb21wbGV0ZScpOwogICAgICAgICAgaWYgKCdQcm9taXNlJyBpbiB3aW5kb3cpIHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICBwcm9taXNlID0gbWFrZVByb21pc2UoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGluc3RhbmNlLnJlc2V0ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZGlyZWN0aW9uID0gaW5zdGFuY2UuZGlyZWN0aW9uOwogICAgaW5zdGFuY2UucGFzc1Rocm91Z2ggPSBmYWxzZTsKICAgIGluc3RhbmNlLmN1cnJlbnRUaW1lID0gMDsKICAgIGluc3RhbmNlLnByb2dyZXNzID0gMDsKICAgIGluc3RhbmNlLnBhdXNlZCA9IHRydWU7CiAgICBpbnN0YW5jZS5iZWdhbiA9IGZhbHNlOwogICAgaW5zdGFuY2UuY2hhbmdlQmVnYW4gPSBmYWxzZTsKICAgIGluc3RhbmNlLmNvbXBsZXRlZCA9IGZhbHNlOwogICAgaW5zdGFuY2UuY2hhbmdlQ29tcGxldGVkID0gZmFsc2U7CiAgICBpbnN0YW5jZS5yZXZlcnNlUGxheWJhY2sgPSBmYWxzZTsKICAgIGluc3RhbmNlLnJldmVyc2VkID0gZGlyZWN0aW9uID09PSAncmV2ZXJzZSc7CiAgICBpbnN0YW5jZS5yZW1haW5pbmcgPSBpbnN0YW5jZS5sb29wOwogICAgY2hpbGRyZW4gPSBpbnN0YW5jZS5jaGlsZHJlbjsKICAgIGNoaWxkcmVuTGVuZ3RoID0gY2hpbGRyZW4ubGVuZ3RoOwogICAgZm9yICh2YXIgaSA9IGNoaWxkcmVuTGVuZ3RoOyBpLS07KSB7IGluc3RhbmNlLmNoaWxkcmVuW2ldLnJlc2V0KCk7IH0KICAgIGlmIChpbnN0YW5jZS5yZXZlcnNlZCAmJiBpbnN0YW5jZS5sb29wICE9PSB0cnVlIHx8IChkaXJlY3Rpb24gPT09ICdhbHRlcm5hdGUnICYmIGluc3RhbmNlLmxvb3AgPT09IDEpKSB7IGluc3RhbmNlLnJlbWFpbmluZysrOyB9CiAgICBzZXRBbmltYXRpb25zUHJvZ3Jlc3MoMCk7CiAgfTsKCiAgLy8gU2V0IFZhbHVlIGhlbHBlcgoKICBpbnN0YW5jZS5zZXQgPSBmdW5jdGlvbih0YXJnZXRzLCBwcm9wZXJ0aWVzKSB7CiAgICBzZXRUYXJnZXRzVmFsdWUodGFyZ2V0cywgcHJvcGVydGllcyk7CiAgICByZXR1cm4gaW5zdGFuY2U7CiAgfTsKCiAgaW5zdGFuY2UudGljayA9IGZ1bmN0aW9uKHQpIHsKICAgIG5vdyA9IHQ7CiAgICBpZiAoIXN0YXJ0VGltZSkgeyBzdGFydFRpbWUgPSBub3c7IH0KICAgIHNldEluc3RhbmNlUHJvZ3Jlc3MoKG5vdyArIChsYXN0VGltZSAtIHN0YXJ0VGltZSkpICogYW5pbWUuc3BlZWQpOwogIH07CgogIGluc3RhbmNlLnNlZWsgPSBmdW5jdGlvbih0aW1lKSB7CiAgICBzZXRJbnN0YW5jZVByb2dyZXNzKGFkanVzdFRpbWUodGltZSkpOwogIH07CgogIGluc3RhbmNlLnBhdXNlID0gZnVuY3Rpb24oKSB7CiAgICBpbnN0YW5jZS5wYXVzZWQgPSB0cnVlOwogICAgcmVzZXRUaW1lKCk7CiAgfTsKCiAgaW5zdGFuY2UucGxheSA9IGZ1bmN0aW9uKCkgewogICAgaWYgKCFpbnN0YW5jZS5wYXVzZWQpIHsgcmV0dXJuOyB9CiAgICBpbnN0YW5jZS5wYXVzZWQgPSBmYWxzZTsKICAgIGFjdGl2ZUluc3RhbmNlcy5wdXNoKGluc3RhbmNlKTsKICAgIHJlc2V0VGltZSgpOwogICAgaWYgKCFyYWYpIHsgZW5naW5lKCk7IH0KICB9OwoKICBpbnN0YW5jZS5yZXZlcnNlID0gZnVuY3Rpb24oKSB7CiAgICB0b2dnbGVJbnN0YW5jZURpcmVjdGlvbigpOwogICAgcmVzZXRUaW1lKCk7CiAgfTsKCiAgaW5zdGFuY2UucmVzdGFydCA9IGZ1bmN0aW9uKCkgewogICAgaW5zdGFuY2UucmVzZXQoKTsKICAgIGluc3RhbmNlLnBsYXkoKTsKICB9OwoKICBpbnN0YW5jZS5maW5pc2hlZCA9IHByb21pc2U7CiAgaW5zdGFuY2UucmVzZXQoKTsKCiAgaWYgKGluc3RhbmNlLmF1dG9wbGF5KSB7IGluc3RhbmNlLnBsYXkoKTsgfQoKICByZXR1cm4gaW5zdGFuY2U7Cgp9CgovLyBSZW1vdmUgdGFyZ2V0cyBmcm9tIGFuaW1hdGlvbgoKZnVuY3Rpb24gcmVtb3ZlVGFyZ2V0c0Zyb21BbmltYXRpb25zKHRhcmdldHNBcnJheSwgYW5pbWF0aW9ucykgewogIGZvciAodmFyIGEgPSBhbmltYXRpb25zLmxlbmd0aDsgYS0tOykgewogICAgaWYgKGFycmF5Q29udGFpbnModGFyZ2V0c0FycmF5LCBhbmltYXRpb25zW2FdLmFuaW1hdGFibGUudGFyZ2V0KSkgewogICAgICBhbmltYXRpb25zLnNwbGljZShhLCAxKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHJlbW92ZVRhcmdldHModGFyZ2V0cykgewogIHZhciB0YXJnZXRzQXJyYXkgPSBwYXJzZVRhcmdldHModGFyZ2V0cyk7CiAgZm9yICh2YXIgaSA9IGFjdGl2ZUluc3RhbmNlcy5sZW5ndGg7IGktLTspIHsKICAgIHZhciBpbnN0YW5jZSA9IGFjdGl2ZUluc3RhbmNlc1tpXTsKICAgIHZhciBhbmltYXRpb25zID0gaW5zdGFuY2UuYW5pbWF0aW9uczsKICAgIHZhciBjaGlsZHJlbiA9IGluc3RhbmNlLmNoaWxkcmVuOwogICAgcmVtb3ZlVGFyZ2V0c0Zyb21BbmltYXRpb25zKHRhcmdldHNBcnJheSwgYW5pbWF0aW9ucyk7CiAgICBmb3IgKHZhciBjID0gY2hpbGRyZW4ubGVuZ3RoOyBjLS07KSB7CiAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2NdOwogICAgICB2YXIgY2hpbGRBbmltYXRpb25zID0gY2hpbGQuYW5pbWF0aW9uczsKICAgICAgcmVtb3ZlVGFyZ2V0c0Zyb21BbmltYXRpb25zKHRhcmdldHNBcnJheSwgY2hpbGRBbmltYXRpb25zKTsKICAgICAgaWYgKCFjaGlsZEFuaW1hdGlvbnMubGVuZ3RoICYmICFjaGlsZC5jaGlsZHJlbi5sZW5ndGgpIHsgY2hpbGRyZW4uc3BsaWNlKGMsIDEpOyB9CiAgICB9CiAgICBpZiAoIWFuaW1hdGlvbnMubGVuZ3RoICYmICFjaGlsZHJlbi5sZW5ndGgpIHsgaW5zdGFuY2UucGF1c2UoKTsgfQogIH0KfQoKLy8gU3RhZ2dlciBoZWxwZXJzCgpmdW5jdGlvbiBzdGFnZ2VyKHZhbCwgcGFyYW1zKSB7CiAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9OwoKICB2YXIgZGlyZWN0aW9uID0gcGFyYW1zLmRpcmVjdGlvbiB8fCAnbm9ybWFsJzsKICB2YXIgZWFzaW5nID0gcGFyYW1zLmVhc2luZyA/IHBhcnNlRWFzaW5ncyhwYXJhbXMuZWFzaW5nKSA6IG51bGw7CiAgdmFyIGdyaWQgPSBwYXJhbXMuZ3JpZDsKICB2YXIgYXhpcyA9IHBhcmFtcy5heGlzOwogIHZhciBmcm9tSW5kZXggPSBwYXJhbXMuZnJvbSB8fCAwOwogIHZhciBmcm9tRmlyc3QgPSBmcm9tSW5kZXggPT09ICdmaXJzdCc7CiAgdmFyIGZyb21DZW50ZXIgPSBmcm9tSW5kZXggPT09ICdjZW50ZXInOwogIHZhciBmcm9tTGFzdCA9IGZyb21JbmRleCA9PT0gJ2xhc3QnOwogIHZhciBpc1JhbmdlID0gaXMuYXJyKHZhbCk7CiAgdmFyIHZhbDEgPSBpc1JhbmdlID8gcGFyc2VGbG9hdCh2YWxbMF0pIDogcGFyc2VGbG9hdCh2YWwpOwogIHZhciB2YWwyID0gaXNSYW5nZSA/IHBhcnNlRmxvYXQodmFsWzFdKSA6IDA7CiAgdmFyIHVuaXQgPSBnZXRVbml0KGlzUmFuZ2UgPyB2YWxbMV0gOiB2YWwpIHx8IDA7CiAgdmFyIHN0YXJ0ID0gcGFyYW1zLnN0YXJ0IHx8IDAgKyAoaXNSYW5nZSA/IHZhbDEgOiAwKTsKICB2YXIgdmFsdWVzID0gW107CiAgdmFyIG1heFZhbHVlID0gMDsKICByZXR1cm4gZnVuY3Rpb24gKGVsLCBpLCB0KSB7CiAgICBpZiAoZnJvbUZpcnN0KSB7IGZyb21JbmRleCA9IDA7IH0KICAgIGlmIChmcm9tQ2VudGVyKSB7IGZyb21JbmRleCA9ICh0IC0gMSkgLyAyOyB9CiAgICBpZiAoZnJvbUxhc3QpIHsgZnJvbUluZGV4ID0gdCAtIDE7IH0KICAgIGlmICghdmFsdWVzLmxlbmd0aCkgewogICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgdDsgaW5kZXgrKykgewogICAgICAgIGlmICghZ3JpZCkgewogICAgICAgICAgdmFsdWVzLnB1c2goTWF0aC5hYnMoZnJvbUluZGV4IC0gaW5kZXgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGZyb21YID0gIWZyb21DZW50ZXIgPyBmcm9tSW5kZXglZ3JpZFswXSA6IChncmlkWzBdLTEpLzI7CiAgICAgICAgICB2YXIgZnJvbVkgPSAhZnJvbUNlbnRlciA/IE1hdGguZmxvb3IoZnJvbUluZGV4L2dyaWRbMF0pIDogKGdyaWRbMV0tMSkvMjsKICAgICAgICAgIHZhciB0b1ggPSBpbmRleCVncmlkWzBdOwogICAgICAgICAgdmFyIHRvWSA9IE1hdGguZmxvb3IoaW5kZXgvZ3JpZFswXSk7CiAgICAgICAgICB2YXIgZGlzdGFuY2VYID0gZnJvbVggLSB0b1g7CiAgICAgICAgICB2YXIgZGlzdGFuY2VZID0gZnJvbVkgLSB0b1k7CiAgICAgICAgICB2YXIgdmFsdWUgPSBNYXRoLnNxcnQoZGlzdGFuY2VYICogZGlzdGFuY2VYICsgZGlzdGFuY2VZICogZGlzdGFuY2VZKTsKICAgICAgICAgIGlmIChheGlzID09PSAneCcpIHsgdmFsdWUgPSAtZGlzdGFuY2VYOyB9CiAgICAgICAgICBpZiAoYXhpcyA9PT0gJ3knKSB7IHZhbHVlID0gLWRpc3RhbmNlWTsgfQogICAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgICBtYXhWYWx1ZSA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHZhbHVlcyk7CiAgICAgIH0KICAgICAgaWYgKGVhc2luZykgeyB2YWx1ZXMgPSB2YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWwpIHsgcmV0dXJuIGVhc2luZyh2YWwgLyBtYXhWYWx1ZSkgKiBtYXhWYWx1ZTsgfSk7IH0KICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3JldmVyc2UnKSB7IHZhbHVlcyA9IHZhbHVlcy5tYXAoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gYXhpcyA/ICh2YWwgPCAwKSA/IHZhbCAqIC0xIDogLXZhbCA6IE1hdGguYWJzKG1heFZhbHVlIC0gdmFsKTsgfSk7IH0KICAgIH0KICAgIHZhciBzcGFjaW5nID0gaXNSYW5nZSA/ICh2YWwyIC0gdmFsMSkgLyBtYXhWYWx1ZSA6IHZhbDE7CiAgICByZXR1cm4gc3RhcnQgKyAoc3BhY2luZyAqIChNYXRoLnJvdW5kKHZhbHVlc1tpXSAqIDEwMCkgLyAxMDApKSArIHVuaXQ7CiAgfQp9CgovLyBUaW1lbGluZQoKZnVuY3Rpb24gdGltZWxpbmUocGFyYW1zKSB7CiAgaWYgKCBwYXJhbXMgPT09IHZvaWQgMCApIHBhcmFtcyA9IHt9OwoKICB2YXIgdGwgPSBhbmltZShwYXJhbXMpOwogIHRsLmR1cmF0aW9uID0gMDsKICB0bC5hZGQgPSBmdW5jdGlvbihpbnN0YW5jZVBhcmFtcywgdGltZWxpbmVPZmZzZXQpIHsKICAgIHZhciB0bEluZGV4ID0gYWN0aXZlSW5zdGFuY2VzLmluZGV4T2YodGwpOwogICAgdmFyIGNoaWxkcmVuID0gdGwuY2hpbGRyZW47CiAgICBpZiAodGxJbmRleCA+IC0xKSB7IGFjdGl2ZUluc3RhbmNlcy5zcGxpY2UodGxJbmRleCwgMSk7IH0KICAgIGZ1bmN0aW9uIHBhc3NUaHJvdWdoKGlucykgeyBpbnMucGFzc1Rocm91Z2ggPSB0cnVlOyB9CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7IHBhc3NUaHJvdWdoKGNoaWxkcmVuW2ldKTsgfQogICAgdmFyIGluc1BhcmFtcyA9IG1lcmdlT2JqZWN0cyhpbnN0YW5jZVBhcmFtcywgcmVwbGFjZU9iamVjdFByb3BzKGRlZmF1bHRUd2VlblNldHRpbmdzLCBwYXJhbXMpKTsKICAgIGluc1BhcmFtcy50YXJnZXRzID0gaW5zUGFyYW1zLnRhcmdldHMgfHwgcGFyYW1zLnRhcmdldHM7CiAgICB2YXIgdGxEdXJhdGlvbiA9IHRsLmR1cmF0aW9uOwogICAgaW5zUGFyYW1zLmF1dG9wbGF5ID0gZmFsc2U7CiAgICBpbnNQYXJhbXMuZGlyZWN0aW9uID0gdGwuZGlyZWN0aW9uOwogICAgaW5zUGFyYW1zLnRpbWVsaW5lT2Zmc2V0ID0gaXMudW5kKHRpbWVsaW5lT2Zmc2V0KSA/IHRsRHVyYXRpb24gOiBnZXRSZWxhdGl2ZVZhbHVlKHRpbWVsaW5lT2Zmc2V0LCB0bER1cmF0aW9uKTsKICAgIHBhc3NUaHJvdWdoKHRsKTsKICAgIHRsLnNlZWsoaW5zUGFyYW1zLnRpbWVsaW5lT2Zmc2V0KTsKICAgIHZhciBpbnMgPSBhbmltZShpbnNQYXJhbXMpOwogICAgcGFzc1Rocm91Z2goaW5zKTsKICAgIGNoaWxkcmVuLnB1c2goaW5zKTsKICAgIHZhciB0aW1pbmdzID0gZ2V0SW5zdGFuY2VUaW1pbmdzKGNoaWxkcmVuLCBwYXJhbXMpOwogICAgdGwuZGVsYXkgPSB0aW1pbmdzLmRlbGF5OwogICAgdGwuZW5kRGVsYXkgPSB0aW1pbmdzLmVuZERlbGF5OwogICAgdGwuZHVyYXRpb24gPSB0aW1pbmdzLmR1cmF0aW9uOwogICAgdGwuc2VlaygwKTsKICAgIHRsLnJlc2V0KCk7CiAgICBpZiAodGwuYXV0b3BsYXkpIHsgdGwucGxheSgpOyB9CiAgICByZXR1cm4gdGw7CiAgfTsKICByZXR1cm4gdGw7Cn0KCmFuaW1lLnZlcnNpb24gPSAnMy4wLjAnOwphbmltZS5zcGVlZCA9IDE7CmFuaW1lLnJ1bm5pbmcgPSBhY3RpdmVJbnN0YW5jZXM7CmFuaW1lLnJlbW92ZSA9IHJlbW92ZVRhcmdldHM7CmFuaW1lLmdldCA9IGdldE9yaWdpbmFsVGFyZ2V0VmFsdWU7CmFuaW1lLnNldCA9IHNldFRhcmdldHNWYWx1ZTsKYW5pbWUuY29udmVydFB4ID0gY29udmVydFB4VG9Vbml0OwphbmltZS5wYXRoID0gZ2V0UGF0aDsKYW5pbWUuc2V0RGFzaG9mZnNldCA9IHNldERhc2hvZmZzZXQ7CmFuaW1lLnN0YWdnZXIgPSBzdGFnZ2VyOwphbmltZS50aW1lbGluZSA9IHRpbWVsaW5lOwphbmltZS5lYXNpbmcgPSBwYXJzZUVhc2luZ3M7CmFuaW1lLnBlbm5lciA9IHBlbm5lcjsKYW5pbWUucmFuZG9tID0gZnVuY3Rpb24gKG1pbiwgbWF4KSB7IHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluOyB9OwoKbW9kdWxlLmV4cG9ydHMgPSBhbmltZTsKCn0se31dLDM3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKCXR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IGZhY3RvcnkoZXhwb3J0cykgOgoJdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsnZXhwb3J0cyddLCBmYWN0b3J5KSA6CgkoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGZhY3RvcnkoZ2xvYmFsLlRIUkVFID0ge30pKTsKfSh0aGlzLCBmdW5jdGlvbiAoZXhwb3J0cykgeyAndXNlIHN0cmljdCc7CgoJLy8gUG9seWZpbGxzCgoJaWYgKCBOdW1iZXIuRVBTSUxPTiA9PT0gdW5kZWZpbmVkICkgewoKCQlOdW1iZXIuRVBTSUxPTiA9IE1hdGgucG93KCAyLCAtIDUyICk7CgoJfQoKCWlmICggTnVtYmVyLmlzSW50ZWdlciA9PT0gdW5kZWZpbmVkICkgewoKCQkvLyBNaXNzaW5nIGluIElFCgkJLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTnVtYmVyL2lzSW50ZWdlcgoKCQlOdW1iZXIuaXNJbnRlZ2VyID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICYmIGlzRmluaXRlKCB2YWx1ZSApICYmIE1hdGguZmxvb3IoIHZhbHVlICkgPT09IHZhbHVlOwoKCQl9OwoKCX0KCgkvLwoKCWlmICggTWF0aC5zaWduID09PSB1bmRlZmluZWQgKSB7CgoJCS8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL01hdGgvc2lnbgoKCQlNYXRoLnNpZ24gPSBmdW5jdGlvbiAoIHggKSB7CgoJCQlyZXR1cm4gKCB4IDwgMCApID8gLSAxIDogKCB4ID4gMCApID8gMSA6ICsgeDsKCgkJfTsKCgl9CgoJaWYgKCAnbmFtZScgaW4gRnVuY3Rpb24ucHJvdG90eXBlID09PSBmYWxzZSApIHsKCgkJLy8gTWlzc2luZyBpbiBJRQoJCS8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Z1bmN0aW9uL25hbWUKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBGdW5jdGlvbi5wcm90b3R5cGUsICduYW1lJywgewoKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHRoaXMudG9TdHJpbmcoKS5tYXRjaCggL15ccypmdW5jdGlvblxzKihbXlwoXHNdKikvIClbIDEgXTsKCgkJCX0KCgkJfSApOwoKCX0KCglpZiAoIE9iamVjdC5hc3NpZ24gPT09IHVuZGVmaW5lZCApIHsKCgkJLy8gTWlzc2luZyBpbiBJRQoJCS8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9hc3NpZ24KCgkJKCBmdW5jdGlvbiAoKSB7CgoJCQlPYmplY3QuYXNzaWduID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCB8fCB0YXJnZXQgPT09IG51bGwgKSB7CgoJCQkJCXRocm93IG5ldyBUeXBlRXJyb3IoICdDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QnICk7CgoJCQkJfQoKCQkJCXZhciBvdXRwdXQgPSBPYmplY3QoIHRhcmdldCApOwoKCQkJCWZvciAoIHZhciBpbmRleCA9IDE7IGluZGV4IDwgYXJndW1lbnRzLmxlbmd0aDsgaW5kZXggKysgKSB7CgoJCQkJCXZhciBzb3VyY2UgPSBhcmd1bWVudHNbIGluZGV4IF07CgoJCQkJCWlmICggc291cmNlICE9PSB1bmRlZmluZWQgJiYgc291cmNlICE9PSBudWxsICkgewoKCQkJCQkJZm9yICggdmFyIG5leHRLZXkgaW4gc291cmNlICkgewoKCQkJCQkJCWlmICggT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKCBzb3VyY2UsIG5leHRLZXkgKSApIHsKCgkJCQkJCQkJb3V0cHV0WyBuZXh0S2V5IF0gPSBzb3VyY2VbIG5leHRLZXkgXTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG91dHB1dDsKCgkJCX07CgoJCX0gKSgpOwoKCX0KCgkvKioKCSAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvZXZlbnRkaXNwYXRjaGVyLmpzLwoJICovCgoJZnVuY3Rpb24gRXZlbnREaXNwYXRjaGVyKCkge30KCglPYmplY3QuYXNzaWduKCBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLCB7CgoJCWFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCQlpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgdGhpcy5fbGlzdGVuZXJzID0ge307CgoJCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKCQkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWxpc3RlbmVyc1sgdHlwZSBdID0gW107CgoJCQl9CgoJCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdLmluZGV4T2YoIGxpc3RlbmVyICkgPT09IC0gMSApIHsKCgkJCQlsaXN0ZW5lcnNbIHR5cGUgXS5wdXNoKCBsaXN0ZW5lciApOwoKCQkJfQoKCQl9LAoKCQloYXNFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoIHR5cGUsIGxpc3RlbmVyICkgewoKCQkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybiBmYWxzZTsKCgkJCXZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgoJCQlyZXR1cm4gbGlzdGVuZXJzWyB0eXBlIF0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApICE9PSAtIDE7CgoJCX0sCgoJCXJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCQlpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJdmFyIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCQkJdmFyIGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbIHR5cGUgXTsKCgkJCWlmICggbGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBpbmRleCA9IGxpc3RlbmVyQXJyYXkuaW5kZXhPZiggbGlzdGVuZXIgKTsKCgkJCQlpZiAoIGluZGV4ICE9PSAtIDEgKSB7CgoJCQkJCWxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gKCBldmVudCApIHsKCgkJCWlmICggdGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoJCQl2YXIgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdOwoKCQkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZXZlbnQudGFyZ2V0ID0gdGhpczsKCgkJCQl2YXIgYXJyYXkgPSBsaXN0ZW5lckFycmF5LnNsaWNlKCAwICk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJYXJyYXlbIGkgXS5jYWxsKCB0aGlzLCBldmVudCApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0gKTsKCgl2YXIgUkVWSVNJT04gPSAnMTAzZGV2JzsKCXZhciBNT1VTRSA9IHsgTEVGVDogMCwgTUlERExFOiAxLCBSSUdIVDogMiB9OwoJdmFyIEN1bGxGYWNlTm9uZSA9IDA7Cgl2YXIgQ3VsbEZhY2VCYWNrID0gMTsKCXZhciBDdWxsRmFjZUZyb250ID0gMjsKCXZhciBDdWxsRmFjZUZyb250QmFjayA9IDM7Cgl2YXIgRnJvbnRGYWNlRGlyZWN0aW9uQ1cgPSAwOwoJdmFyIEZyb250RmFjZURpcmVjdGlvbkNDVyA9IDE7Cgl2YXIgQmFzaWNTaGFkb3dNYXAgPSAwOwoJdmFyIFBDRlNoYWRvd01hcCA9IDE7Cgl2YXIgUENGU29mdFNoYWRvd01hcCA9IDI7Cgl2YXIgRnJvbnRTaWRlID0gMDsKCXZhciBCYWNrU2lkZSA9IDE7Cgl2YXIgRG91YmxlU2lkZSA9IDI7Cgl2YXIgRmxhdFNoYWRpbmcgPSAxOwoJdmFyIFNtb290aFNoYWRpbmcgPSAyOwoJdmFyIE5vQ29sb3JzID0gMDsKCXZhciBGYWNlQ29sb3JzID0gMTsKCXZhciBWZXJ0ZXhDb2xvcnMgPSAyOwoJdmFyIE5vQmxlbmRpbmcgPSAwOwoJdmFyIE5vcm1hbEJsZW5kaW5nID0gMTsKCXZhciBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKCXZhciBTdWJ0cmFjdGl2ZUJsZW5kaW5nID0gMzsKCXZhciBNdWx0aXBseUJsZW5kaW5nID0gNDsKCXZhciBDdXN0b21CbGVuZGluZyA9IDU7Cgl2YXIgQWRkRXF1YXRpb24gPSAxMDA7Cgl2YXIgU3VidHJhY3RFcXVhdGlvbiA9IDEwMTsKCXZhciBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiA9IDEwMjsKCXZhciBNaW5FcXVhdGlvbiA9IDEwMzsKCXZhciBNYXhFcXVhdGlvbiA9IDEwNDsKCXZhciBaZXJvRmFjdG9yID0gMjAwOwoJdmFyIE9uZUZhY3RvciA9IDIwMTsKCXZhciBTcmNDb2xvckZhY3RvciA9IDIwMjsKCXZhciBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwoJdmFyIFNyY0FscGhhRmFjdG9yID0gMjA0OwoJdmFyIE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgPSAyMDU7Cgl2YXIgRHN0QWxwaGFGYWN0b3IgPSAyMDY7Cgl2YXIgT25lTWludXNEc3RBbHBoYUZhY3RvciA9IDIwNzsKCXZhciBEc3RDb2xvckZhY3RvciA9IDIwODsKCXZhciBPbmVNaW51c0RzdENvbG9yRmFjdG9yID0gMjA5OwoJdmFyIFNyY0FscGhhU2F0dXJhdGVGYWN0b3IgPSAyMTA7Cgl2YXIgTmV2ZXJEZXB0aCA9IDA7Cgl2YXIgQWx3YXlzRGVwdGggPSAxOwoJdmFyIExlc3NEZXB0aCA9IDI7Cgl2YXIgTGVzc0VxdWFsRGVwdGggPSAzOwoJdmFyIEVxdWFsRGVwdGggPSA0OwoJdmFyIEdyZWF0ZXJFcXVhbERlcHRoID0gNTsKCXZhciBHcmVhdGVyRGVwdGggPSA2OwoJdmFyIE5vdEVxdWFsRGVwdGggPSA3OwoJdmFyIE11bHRpcGx5T3BlcmF0aW9uID0gMDsKCXZhciBNaXhPcGVyYXRpb24gPSAxOwoJdmFyIEFkZE9wZXJhdGlvbiA9IDI7Cgl2YXIgTm9Ub25lTWFwcGluZyA9IDA7Cgl2YXIgTGluZWFyVG9uZU1hcHBpbmcgPSAxOwoJdmFyIFJlaW5oYXJkVG9uZU1hcHBpbmcgPSAyOwoJdmFyIFVuY2hhcnRlZDJUb25lTWFwcGluZyA9IDM7Cgl2YXIgQ2luZW9uVG9uZU1hcHBpbmcgPSA0OwoJdmFyIEFDRVNGaWxtaWNUb25lTWFwcGluZyA9IDU7CgoJdmFyIFVWTWFwcGluZyA9IDMwMDsKCXZhciBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDE7Cgl2YXIgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nID0gMzAyOwoJdmFyIEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nID0gMzAzOwoJdmFyIEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nID0gMzA0OwoJdmFyIFNwaGVyaWNhbFJlZmxlY3Rpb25NYXBwaW5nID0gMzA1OwoJdmFyIEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nID0gMzA2OwoJdmFyIEN1YmVVVlJlZnJhY3Rpb25NYXBwaW5nID0gMzA3OwoJdmFyIFJlcGVhdFdyYXBwaW5nID0gMTAwMDsKCXZhciBDbGFtcFRvRWRnZVdyYXBwaW5nID0gMTAwMTsKCXZhciBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nID0gMTAwMjsKCXZhciBOZWFyZXN0RmlsdGVyID0gMTAwMzsKCXZhciBOZWFyZXN0TWlwTWFwTmVhcmVzdEZpbHRlciA9IDEwMDQ7Cgl2YXIgTmVhcmVzdE1pcE1hcExpbmVhckZpbHRlciA9IDEwMDU7Cgl2YXIgTGluZWFyRmlsdGVyID0gMTAwNjsKCXZhciBMaW5lYXJNaXBNYXBOZWFyZXN0RmlsdGVyID0gMTAwNzsKCXZhciBMaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXIgPSAxMDA4OwoJdmFyIFVuc2lnbmVkQnl0ZVR5cGUgPSAxMDA5OwoJdmFyIEJ5dGVUeXBlID0gMTAxMDsKCXZhciBTaG9ydFR5cGUgPSAxMDExOwoJdmFyIFVuc2lnbmVkU2hvcnRUeXBlID0gMTAxMjsKCXZhciBJbnRUeXBlID0gMTAxMzsKCXZhciBVbnNpZ25lZEludFR5cGUgPSAxMDE0OwoJdmFyIEZsb2F0VHlwZSA9IDEwMTU7Cgl2YXIgSGFsZkZsb2F0VHlwZSA9IDEwMTY7Cgl2YXIgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKCXZhciBVbnNpZ25lZFNob3J0NTU1MVR5cGUgPSAxMDE4OwoJdmFyIFVuc2lnbmVkU2hvcnQ1NjVUeXBlID0gMTAxOTsKCXZhciBVbnNpZ25lZEludDI0OFR5cGUgPSAxMDIwOwoJdmFyIEFscGhhRm9ybWF0ID0gMTAyMTsKCXZhciBSR0JGb3JtYXQgPSAxMDIyOwoJdmFyIFJHQkFGb3JtYXQgPSAxMDIzOwoJdmFyIEx1bWluYW5jZUZvcm1hdCA9IDEwMjQ7Cgl2YXIgTHVtaW5hbmNlQWxwaGFGb3JtYXQgPSAxMDI1OwoJdmFyIFJHQkVGb3JtYXQgPSBSR0JBRm9ybWF0OwoJdmFyIERlcHRoRm9ybWF0ID0gMTAyNjsKCXZhciBEZXB0aFN0ZW5jaWxGb3JtYXQgPSAxMDI3OwoJdmFyIFJlZEZvcm1hdCA9IDEwMjg7Cgl2YXIgUkdCX1MzVENfRFhUMV9Gb3JtYXQgPSAzMzc3NjsKCXZhciBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgPSAzMzc3NzsKCXZhciBSR0JBX1MzVENfRFhUM19Gb3JtYXQgPSAzMzc3ODsKCXZhciBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgPSAzMzc3OTsKCXZhciBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCA9IDM1ODQwOwoJdmFyIFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gMzU4NDE7Cgl2YXIgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7Cgl2YXIgUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gMzU4NDM7Cgl2YXIgUkdCX0VUQzFfRm9ybWF0ID0gMzYxOTY7Cgl2YXIgUkdCQV9BU1RDXzR4NF9Gb3JtYXQgPSAzNzgwODsKCXZhciBSR0JBX0FTVENfNXg0X0Zvcm1hdCA9IDM3ODA5OwoJdmFyIFJHQkFfQVNUQ181eDVfRm9ybWF0ID0gMzc4MTA7Cgl2YXIgUkdCQV9BU1RDXzZ4NV9Gb3JtYXQgPSAzNzgxMTsKCXZhciBSR0JBX0FTVENfNng2X0Zvcm1hdCA9IDM3ODEyOwoJdmFyIFJHQkFfQVNUQ184eDVfRm9ybWF0ID0gMzc4MTM7Cgl2YXIgUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgPSAzNzgxNDsKCXZhciBSR0JBX0FTVENfOHg4X0Zvcm1hdCA9IDM3ODE1OwoJdmFyIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCA9IDM3ODE2OwoJdmFyIFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCA9IDM3ODE3OwoJdmFyIFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCA9IDM3ODE4OwoJdmFyIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKCXZhciBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0ID0gMzc4MjA7Cgl2YXIgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IDM3ODIxOwoJdmFyIExvb3BPbmNlID0gMjIwMDsKCXZhciBMb29wUmVwZWF0ID0gMjIwMTsKCXZhciBMb29wUGluZ1BvbmcgPSAyMjAyOwoJdmFyIEludGVycG9sYXRlRGlzY3JldGUgPSAyMzAwOwoJdmFyIEludGVycG9sYXRlTGluZWFyID0gMjMwMTsKCXZhciBJbnRlcnBvbGF0ZVNtb290aCA9IDIzMDI7Cgl2YXIgWmVyb0N1cnZhdHVyZUVuZGluZyA9IDI0MDA7Cgl2YXIgWmVyb1Nsb3BlRW5kaW5nID0gMjQwMTsKCXZhciBXcmFwQXJvdW5kRW5kaW5nID0gMjQwMjsKCXZhciBUcmlhbmdsZXNEcmF3TW9kZSA9IDA7Cgl2YXIgVHJpYW5nbGVTdHJpcERyYXdNb2RlID0gMTsKCXZhciBUcmlhbmdsZUZhbkRyYXdNb2RlID0gMjsKCXZhciBMaW5lYXJFbmNvZGluZyA9IDMwMDA7Cgl2YXIgc1JHQkVuY29kaW5nID0gMzAwMTsKCXZhciBHYW1tYUVuY29kaW5nID0gMzAwNzsKCXZhciBSR0JFRW5jb2RpbmcgPSAzMDAyOwoJdmFyIExvZ0x1dkVuY29kaW5nID0gMzAwMzsKCXZhciBSR0JNN0VuY29kaW5nID0gMzAwNDsKCXZhciBSR0JNMTZFbmNvZGluZyA9IDMwMDU7Cgl2YXIgUkdCREVuY29kaW5nID0gMzAwNjsKCXZhciBCYXNpY0RlcHRoUGFja2luZyA9IDMyMDA7Cgl2YXIgUkdCQURlcHRoUGFja2luZyA9IDMyMDE7Cgl2YXIgVGFuZ2VudFNwYWNlTm9ybWFsTWFwID0gMDsKCXZhciBPYmplY3RTcGFjZU5vcm1hbE1hcCA9IDE7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCXZhciBfTWF0aCA9IHsKCgkJREVHMlJBRDogTWF0aC5QSSAvIDE4MCwKCQlSQUQyREVHOiAxODAgLyBNYXRoLlBJLAoKCQlnZW5lcmF0ZVVVSUQ6ICggZnVuY3Rpb24gKCkgewoKCQkJLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDUwMzQvaG93LXRvLWNyZWF0ZS1hLWd1aWQtdXVpZC1pbi1qYXZhc2NyaXB0LzIxOTYzMTM2IzIxOTYzMTM2CgoJCQl2YXIgbHV0ID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCAyNTY7IGkgKysgKSB7CgoJCQkJbHV0WyBpIF0gPSAoIGkgPCAxNiA/ICcwJyA6ICcnICkgKyAoIGkgKS50b1N0cmluZyggMTYgKTsKCgkJCX0KCgkJCXJldHVybiBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CgoJCQkJdmFyIGQwID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJCQkJdmFyIGQxID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJCQkJdmFyIGQyID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJCQkJdmFyIGQzID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJCQkJdmFyIHV1aWQgPSBsdXRbIGQwICYgMHhmZiBdICsgbHV0WyBkMCA+PiA4ICYgMHhmZiBdICsgbHV0WyBkMCA+PiAxNiAmIDB4ZmYgXSArIGx1dFsgZDAgPj4gMjQgJiAweGZmIF0gKyAnLScgKwoJCQkJCWx1dFsgZDEgJiAweGZmIF0gKyBsdXRbIGQxID4+IDggJiAweGZmIF0gKyAnLScgKyBsdXRbIGQxID4+IDE2ICYgMHgwZiB8IDB4NDAgXSArIGx1dFsgZDEgPj4gMjQgJiAweGZmIF0gKyAnLScgKwoJCQkJCWx1dFsgZDIgJiAweDNmIHwgMHg4MCBdICsgbHV0WyBkMiA+PiA4ICYgMHhmZiBdICsgJy0nICsgbHV0WyBkMiA+PiAxNiAmIDB4ZmYgXSArIGx1dFsgZDIgPj4gMjQgJiAweGZmIF0gKwoJCQkJCWx1dFsgZDMgJiAweGZmIF0gKyBsdXRbIGQzID4+IDggJiAweGZmIF0gKyBsdXRbIGQzID4+IDE2ICYgMHhmZiBdICsgbHV0WyBkMyA+PiAyNCAmIDB4ZmYgXTsKCgkJCQkvLyAudG9VcHBlckNhc2UoKSBoZXJlIGZsYXR0ZW5zIGNvbmNhdGVuYXRlZCBzdHJpbmdzIHRvIHNhdmUgaGVhcCBtZW1vcnkgc3BhY2UuCgkJCQlyZXR1cm4gdXVpZC50b1VwcGVyQ2FzZSgpOwoKCQkJfTsKCgkJfSApKCksCgoJCWNsYW1wOiBmdW5jdGlvbiAoIHZhbHVlLCBtaW4sIG1heCApIHsKCgkJCXJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCB2YWx1ZSApICk7CgoJCX0sCgoJCS8vIGNvbXB1dGUgZXVjbGlkaWFuIG1vZHVsbyBvZiBtICUgbgoJCS8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL01vZHVsb19vcGVyYXRpb24KCgkJZXVjbGlkZWFuTW9kdWxvOiBmdW5jdGlvbiAoIG4sIG0gKSB7CgoJCQlyZXR1cm4gKCAoIG4gJSBtICkgKyBtICkgJSBtOwoKCQl9LAoKCQkvLyBMaW5lYXIgbWFwcGluZyBmcm9tIHJhbmdlIDxhMSwgYTI+IHRvIHJhbmdlIDxiMSwgYjI+CgoJCW1hcExpbmVhcjogZnVuY3Rpb24gKCB4LCBhMSwgYTIsIGIxLCBiMiApIHsKCgkJCXJldHVybiBiMSArICggeCAtIGExICkgKiAoIGIyIC0gYjEgKSAvICggYTIgLSBhMSApOwoKCQl9LAoKCQkvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaW5lYXJfaW50ZXJwb2xhdGlvbgoKCQlsZXJwOiBmdW5jdGlvbiAoIHgsIHksIHQgKSB7CgoJCQlyZXR1cm4gKCAxIC0gdCApICogeCArIHQgKiB5OwoKCQl9LAoKCQkvLyBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1Ntb290aHN0ZXAKCgkJc21vb3Roc3RlcDogZnVuY3Rpb24gKCB4LCBtaW4sIG1heCApIHsKCgkJCWlmICggeCA8PSBtaW4gKSByZXR1cm4gMDsKCQkJaWYgKCB4ID49IG1heCApIHJldHVybiAxOwoKCQkJeCA9ICggeCAtIG1pbiApIC8gKCBtYXggLSBtaW4gKTsKCgkJCXJldHVybiB4ICogeCAqICggMyAtIDIgKiB4ICk7CgoJCX0sCgoJCXNtb290aGVyc3RlcDogZnVuY3Rpb24gKCB4LCBtaW4sIG1heCApIHsKCgkJCWlmICggeCA8PSBtaW4gKSByZXR1cm4gMDsKCQkJaWYgKCB4ID49IG1heCApIHJldHVybiAxOwoKCQkJeCA9ICggeCAtIG1pbiApIC8gKCBtYXggLSBtaW4gKTsKCgkJCXJldHVybiB4ICogeCAqIHggKiAoIHggKiAoIHggKiA2IC0gMTUgKSArIDEwICk7CgoJCX0sCgoJCS8vIFJhbmRvbSBpbnRlZ2VyIGZyb20gPGxvdywgaGlnaD4gaW50ZXJ2YWwKCgkJcmFuZEludDogZnVuY3Rpb24gKCBsb3csIGhpZ2ggKSB7CgoJCQlyZXR1cm4gbG93ICsgTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICggaGlnaCAtIGxvdyArIDEgKSApOwoKCQl9LAoKCQkvLyBSYW5kb20gZmxvYXQgZnJvbSA8bG93LCBoaWdoPiBpbnRlcnZhbAoKCQlyYW5kRmxvYXQ6IGZ1bmN0aW9uICggbG93LCBoaWdoICkgewoKCQkJcmV0dXJuIGxvdyArIE1hdGgucmFuZG9tKCkgKiAoIGhpZ2ggLSBsb3cgKTsKCgkJfSwKCgkJLy8gUmFuZG9tIGZsb2F0IGZyb20gPC1yYW5nZS8yLCByYW5nZS8yPiBpbnRlcnZhbAoKCQlyYW5kRmxvYXRTcHJlYWQ6IGZ1bmN0aW9uICggcmFuZ2UgKSB7CgoJCQlyZXR1cm4gcmFuZ2UgKiAoIDAuNSAtIE1hdGgucmFuZG9tKCkgKTsKCgkJfSwKCgkJZGVnVG9SYWQ6IGZ1bmN0aW9uICggZGVncmVlcyApIHsKCgkJCXJldHVybiBkZWdyZWVzICogX01hdGguREVHMlJBRDsKCgkJfSwKCgkJcmFkVG9EZWc6IGZ1bmN0aW9uICggcmFkaWFucyApIHsKCgkJCXJldHVybiByYWRpYW5zICogX01hdGguUkFEMkRFRzsKCgkJfSwKCgkJaXNQb3dlck9mVHdvOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJcmV0dXJuICggdmFsdWUgJiAoIHZhbHVlIC0gMSApICkgPT09IDAgJiYgdmFsdWUgIT09IDA7CgoJCX0sCgoJCWNlaWxQb3dlck9mVHdvOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJcmV0dXJuIE1hdGgucG93KCAyLCBNYXRoLmNlaWwoIE1hdGgubG9nKCB2YWx1ZSApIC8gTWF0aC5MTjIgKSApOwoKCQl9LAoKCQlmbG9vclBvd2VyT2ZUd286IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlyZXR1cm4gTWF0aC5wb3coIDIsIE1hdGguZmxvb3IoIE1hdGgubG9nKCB2YWx1ZSApIC8gTWF0aC5MTjIgKSApOwoKCQl9CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIHBoaWxvZ2IgLyBodHRwOi8vYmxvZy50aGVqaXQub3JnLwoJICogQGF1dGhvciBlZ3JhZXRoZXIgLyBodHRwOi8vZWdyYWV0aGVyLmNvbS8KCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqLwoKCWZ1bmN0aW9uIFZlY3RvcjIoIHgsIHkgKSB7CgoJCXRoaXMueCA9IHggfHwgMDsKCQl0aGlzLnkgPSB5IHx8IDA7CgoJfQoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBWZWN0b3IyLnByb3RvdHlwZSwgewoKCQkid2lkdGgiOiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gdGhpcy54OwoKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQl0aGlzLnggPSB2YWx1ZTsKCgkJCX0KCgkJfSwKCgkJImhlaWdodCI6IHsKCgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLnk7CgoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXRoaXMueSA9IHZhbHVlOwoKCQkJfQoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFZlY3RvcjIucHJvdG90eXBlLCB7CgoJCWlzVmVjdG9yMjogdHJ1ZSwKCgkJc2V0OiBmdW5jdGlvbiAoIHgsIHkgKSB7CgoJCQl0aGlzLnggPSB4OwoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFNjYWxhcjogZnVuY3Rpb24gKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggPSBzY2FsYXI7CgkJCXRoaXMueSA9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRYOiBmdW5jdGlvbiAoIHggKSB7CgoJCQl0aGlzLnggPSB4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFk6IGZ1bmN0aW9uICggeSApIHsKCgkJCXRoaXMueSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0Q29tcG9uZW50OiBmdW5jdGlvbiAoIGluZGV4LCB2YWx1ZSApIHsKCgkJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAxOiB0aGlzLnkgPSB2YWx1ZTsgYnJlYWs7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldENvbXBvbmVudDogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKCQkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCQl9CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55ICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFkZDogZnVuY3Rpb24gKCB2LCB3ICkgewoKCQkJaWYgKCB3ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMjogLmFkZCgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLmFkZFZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLmFkZFZlY3RvcnMoIHYsIHcgKTsKCgkJCX0KCgkJCXRoaXMueCArPSB2Lng7CgkJCXRoaXMueSArPSB2Lnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkU2NhbGFyOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQl0aGlzLnggKz0gczsKCQkJdGhpcy55ICs9IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkVmVjdG9yczogZnVuY3Rpb24gKCBhLCBiICkgewoKCQkJdGhpcy54ID0gYS54ICsgYi54OwoJCQl0aGlzLnkgPSBhLnkgKyBiLnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkU2NhbGVkVmVjdG9yOiBmdW5jdGlvbiAoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc3ViOiBmdW5jdGlvbiAoIHYsIHcgKSB7CgoJCQlpZiAoIHcgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3IyOiAuc3ViKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuc3ViVmVjdG9ycyggYSwgYiApIGluc3RlYWQuJyApOwoJCQkJcmV0dXJuIHRoaXMuc3ViVmVjdG9ycyggdiwgdyApOwoKCQkJfQoKCQkJdGhpcy54IC09IHYueDsKCQkJdGhpcy55IC09IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzdWJTY2FsYXI6IGZ1bmN0aW9uICggcyApIHsKCgkJCXRoaXMueCAtPSBzOwoJCQl0aGlzLnkgLT0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzdWJWZWN0b3JzOiBmdW5jdGlvbiAoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltdWx0aXBseTogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54ICo9IHYueDsKCQkJdGhpcy55ICo9IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltdWx0aXBseVNjYWxhcjogZnVuY3Rpb24gKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggKj0gc2NhbGFyOwoJCQl0aGlzLnkgKj0gc2NhbGFyOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRpdmlkZTogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlkaXZpZGVTY2FsYXI6IGZ1bmN0aW9uICggc2NhbGFyICkgewoKCQkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCgkJfSwKCgkJYXBwbHlNYXRyaXgzOiBmdW5jdGlvbiAoIG0gKSB7CgoJCQl2YXIgeCA9IHRoaXMueCwgeSA9IHRoaXMueTsKCQkJdmFyIGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF07CgkJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgNyBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW1pbjogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW1heDogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5tYXgoIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWF4KCB0aGlzLnksIHYueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsYW1wOiBmdW5jdGlvbiAoIG1pbiwgbWF4ICkgewoKCQkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJCXRoaXMueCA9IE1hdGgubWF4KCBtaW4ueCwgTWF0aC5taW4oIG1heC54LCB0aGlzLnggKSApOwoJCQl0aGlzLnkgPSBNYXRoLm1heCggbWluLnksIE1hdGgubWluKCBtYXgueSwgdGhpcy55ICkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljbGFtcFNjYWxhcjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG1pbiA9IG5ldyBWZWN0b3IyKCk7CgkJCXZhciBtYXggPSBuZXcgVmVjdG9yMigpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCgkJCQltaW4uc2V0KCBtaW5WYWwsIG1pblZhbCApOwoJCQkJbWF4LnNldCggbWF4VmFsLCBtYXhWYWwgKTsKCgkJCQlyZXR1cm4gdGhpcy5jbGFtcCggbWluLCBtYXggKTsKCgkJCX07CgoJCX0oKSwKCgkJY2xhbXBMZW5ndGg6IGZ1bmN0aW9uICggbWluLCBtYXggKSB7CgoJCQl2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG1heCwgbGVuZ3RoICkgKSApOwoKCQl9LAoKCQlmbG9vcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNlaWw6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGguY2VpbCggdGhpcy55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJcm91bmQ6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlyb3VuZFRvWmVybzogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gKCB0aGlzLnggPCAwICkgPyBNYXRoLmNlaWwoIHRoaXMueCApIDogTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9ICggdGhpcy55IDwgMCApID8gTWF0aC5jZWlsKCB0aGlzLnkgKSA6IE1hdGguZmxvb3IoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW5lZ2F0ZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gLSB0aGlzLng7CgkJCXRoaXMueSA9IC0gdGhpcy55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRvdDogZnVuY3Rpb24gKCB2ICkgewoKCQkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueTsKCgkJfSwKCgkJY3Jvc3M6IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2Lng7CgoJCX0sCgoJCWxlbmd0aFNxOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55OwoKCQl9LAoKCQlsZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSApOwoKCQl9LAoKCQltYW5oYXR0YW5MZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICk7CgoJCX0sCgoJCW5vcm1hbGl6ZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgkJfSwKCgkJYW5nbGU6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIGNvbXB1dGVzIHRoZSBhbmdsZSBpbiByYWRpYW5zIHdpdGggcmVzcGVjdCB0byB0aGUgcG9zaXRpdmUgeC1heGlzCgoJCQl2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKCB0aGlzLnksIHRoaXMueCApOwoKCQkJaWYgKCBhbmdsZSA8IDAgKSBhbmdsZSArPSAyICogTWF0aC5QSTsKCgkJCXJldHVybiBhbmdsZTsKCgkJfSwKCgkJZGlzdGFuY2VUbzogZnVuY3Rpb24gKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJCX0sCgoJCWRpc3RhbmNlVG9TcXVhcmVkOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQl2YXIgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55OwoJCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHk7CgoJCX0sCgoJCW1hbmhhdHRhbkRpc3RhbmNlVG86IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54IC0gdi54ICkgKyBNYXRoLmFicyggdGhpcy55IC0gdi55ICk7CgoJCX0sCgoJCXNldExlbmd0aDogZnVuY3Rpb24gKCBsZW5ndGggKSB7CgoJCQlyZXR1cm4gdGhpcy5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhciggbGVuZ3RoICk7CgoJCX0sCgoJCWxlcnA6IGZ1bmN0aW9uICggdiwgYWxwaGEgKSB7CgoJCQl0aGlzLnggKz0gKCB2LnggLSB0aGlzLnggKSAqIGFscGhhOwoJCQl0aGlzLnkgKz0gKCB2LnkgLSB0aGlzLnkgKSAqIGFscGhhOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWxlcnBWZWN0b3JzOiBmdW5jdGlvbiAoIHYxLCB2MiwgYWxwaGEgKSB7CgoJCQlyZXR1cm4gdGhpcy5zdWJWZWN0b3JzKCB2MiwgdjEgKS5tdWx0aXBseVNjYWxhciggYWxwaGEgKS5hZGQoIHYxICk7CgoJCX0sCgoJCWVxdWFsczogZnVuY3Rpb24gKCB2ICkgewoKCQkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSApOwoKCQl9LAoKCQlmcm9tQXJyYXk6IGZ1bmN0aW9uICggYXJyYXksIG9mZnNldCApIHsKCgkJCWlmICggb2Zmc2V0ID09PSB1bmRlZmluZWQgKSBvZmZzZXQgPSAwOwoKCQkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwoJCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvQXJyYXk6IGZ1bmN0aW9uICggYXJyYXksIG9mZnNldCApIHsKCgkJCWlmICggYXJyYXkgPT09IHVuZGVmaW5lZCApIGFycmF5ID0gW107CgkJCWlmICggb2Zmc2V0ID09PSB1bmRlZmluZWQgKSBvZmZzZXQgPSAwOwoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy54OwoJCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy55OwoKCQkJcmV0dXJuIGFycmF5OwoKCQl9LAoKCQlmcm9tQnVmZmVyQXR0cmlidXRlOiBmdW5jdGlvbiAoIGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCApIHsKCgkJCWlmICggb2Zmc2V0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMjogb2Zmc2V0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLicgKTsKCgkJCX0KCgkJCXRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwoJCQl0aGlzLnkgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlyb3RhdGVBcm91bmQ6IGZ1bmN0aW9uICggY2VudGVyLCBhbmdsZSApIHsKCgkJCXZhciBjID0gTWF0aC5jb3MoIGFuZ2xlICksIHMgPSBNYXRoLnNpbiggYW5nbGUgKTsKCgkJCXZhciB4ID0gdGhpcy54IC0gY2VudGVyLng7CgkJCXZhciB5ID0gdGhpcy55IC0gY2VudGVyLnk7CgoJCQl0aGlzLnggPSB4ICogYyAtIHkgKiBzICsgY2VudGVyLng7CgkJCXRoaXMueSA9IHggKiBzICsgeSAqIGMgKyBjZW50ZXIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3Igc3VwZXJlZ2diZXJ0IC8gaHR0cDovL3d3dy5wYXVsYnJ1bnQuY28udWsvCgkgKiBAYXV0aG9yIHBoaWxvZ2IgLyBodHRwOi8vYmxvZy50aGVqaXQub3JnLwoJICogQGF1dGhvciBqb3JkaV9yb3MgLyBodHRwOi8vcGxhdHRzb2Z0LmNvbQoJICogQGF1dGhvciBEMXBsbzFkIC8gaHR0cDovL2dpdGh1Yi5jb20vRDFwbG8xZAoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIHRpbWtuaXAgLyBodHRwOi8vd3d3LmZsb29ycGxhbm5lci5jb20vCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIE1hdHJpeDQoKSB7CgoJCXRoaXMuZWxlbWVudHMgPSBbCgoJCQkxLCAwLCAwLCAwLAoJCQkwLCAxLCAwLCAwLAoJCQkwLCAwLCAxLCAwLAoJCQkwLCAwLCAwLCAxCgoJCV07CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCA+IDAgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTWF0cml4NDogdGhlIGNvbnN0cnVjdG9yIG5vIGxvbmdlciByZWFkcyBhcmd1bWVudHMuIHVzZSAuc2V0KCkgaW5zdGVhZC4nICk7CgoJCX0KCgl9CgoJT2JqZWN0LmFzc2lnbiggTWF0cml4NC5wcm90b3R5cGUsIHsKCgkJaXNNYXRyaXg0OiB0cnVlLAoKCQlzZXQ6IGZ1bmN0aW9uICggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCXRlWyAwIF0gPSBuMTE7IHRlWyA0IF0gPSBuMTI7IHRlWyA4IF0gPSBuMTM7IHRlWyAxMiBdID0gbjE0OwoJCQl0ZVsgMSBdID0gbjIxOyB0ZVsgNSBdID0gbjIyOyB0ZVsgOSBdID0gbjIzOyB0ZVsgMTMgXSA9IG4yNDsKCQkJdGVbIDIgXSA9IG4zMTsgdGVbIDYgXSA9IG4zMjsgdGVbIDEwIF0gPSBuMzM7IHRlWyAxNCBdID0gbjM0OwoJCQl0ZVsgMyBdID0gbjQxOyB0ZVsgNyBdID0gbjQyOyB0ZVsgMTEgXSA9IG40MzsgdGVbIDE1IF0gPSBuNDQ7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJaWRlbnRpdHk6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIDAsIDAsCgkJCQkwLCAxLCAwLCAwLAoJCQkJMCwgMCwgMSwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgTWF0cml4NCgpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKCQl9LAoKCQljb3B5OiBmdW5jdGlvbiAoIG0gKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQl2YXIgbWUgPSBtLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSA9IG1lWyAwIF07IHRlWyAxIF0gPSBtZVsgMSBdOyB0ZVsgMiBdID0gbWVbIDIgXTsgdGVbIDMgXSA9IG1lWyAzIF07CgkJCXRlWyA0IF0gPSBtZVsgNCBdOyB0ZVsgNSBdID0gbWVbIDUgXTsgdGVbIDYgXSA9IG1lWyA2IF07IHRlWyA3IF0gPSBtZVsgNyBdOwoJCQl0ZVsgOCBdID0gbWVbIDggXTsgdGVbIDkgXSA9IG1lWyA5IF07IHRlWyAxMCBdID0gbWVbIDEwIF07IHRlWyAxMSBdID0gbWVbIDExIF07CgkJCXRlWyAxMiBdID0gbWVbIDEyIF07IHRlWyAxMyBdID0gbWVbIDEzIF07IHRlWyAxNCBdID0gbWVbIDE0IF07IHRlWyAxNSBdID0gbWVbIDE1IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29weVBvc2l0aW9uOiBmdW5jdGlvbiAoIG0gKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzLCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOwoJCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwoJCQl0ZVsgMTQgXSA9IG1lWyAxNCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWV4dHJhY3RCYXNpczogZnVuY3Rpb24gKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKCQkJeEF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMCApOwoJCQl5QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAxICk7CgkJCXpBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlQmFzaXM6IGZ1bmN0aW9uICggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJCXRoaXMuc2V0KAoJCQkJeEF4aXMueCwgeUF4aXMueCwgekF4aXMueCwgMCwKCQkJCXhBeGlzLnksIHlBeGlzLnksIHpBeGlzLnksIDAsCgkJCQl4QXhpcy56LCB5QXhpcy56LCB6QXhpcy56LCAwLAoJCQkJMCwgMCwgMCwgMQoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWV4dHJhY3RSb3RhdGlvbjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBleHRyYWN0Um90YXRpb24oIG0gKSB7CgoJCQkJLy8gdGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzCgoJCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCQkJCXZhciBtZSA9IG0uZWxlbWVudHM7CgoJCQkJdmFyIHNjYWxlWCA9IDEgLyB2MS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJCQl2YXIgc2NhbGVZID0gMSAvIHYxLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQkJCXZhciBzY2FsZVogPSAxIC8gdjEuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMiApLmxlbmd0aCgpOwoKCQkJCXRlWyAwIF0gPSBtZVsgMCBdICogc2NhbGVYOwoJCQkJdGVbIDEgXSA9IG1lWyAxIF0gKiBzY2FsZVg7CgkJCQl0ZVsgMiBdID0gbWVbIDIgXSAqIHNjYWxlWDsKCQkJCXRlWyAzIF0gPSAwOwoKCQkJCXRlWyA0IF0gPSBtZVsgNCBdICogc2NhbGVZOwoJCQkJdGVbIDUgXSA9IG1lWyA1IF0gKiBzY2FsZVk7CgkJCQl0ZVsgNiBdID0gbWVbIDYgXSAqIHNjYWxlWTsKCQkJCXRlWyA3IF0gPSAwOwoKCQkJCXRlWyA4IF0gPSBtZVsgOCBdICogc2NhbGVaOwoJCQkJdGVbIDkgXSA9IG1lWyA5IF0gKiBzY2FsZVo7CgkJCQl0ZVsgMTAgXSA9IG1lWyAxMCBdICogc2NhbGVaOwoJCQkJdGVbIDExIF0gPSAwOwoKCQkJCXRlWyAxMiBdID0gMDsKCQkJCXRlWyAxMyBdID0gMDsKCQkJCXRlWyAxNCBdID0gMDsKCQkJCXRlWyAxNSBdID0gMTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJbWFrZVJvdGF0aW9uRnJvbUV1bGVyOiBmdW5jdGlvbiAoIGV1bGVyICkgewoKCQkJaWYgKCAhICggZXVsZXIgJiYgZXVsZXIuaXNFdWxlciApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NYXRyaXg0OiAubWFrZVJvdGF0aW9uRnJvbUV1bGVyKCkgbm93IGV4cGVjdHMgYSBFdWxlciByb3RhdGlvbiByYXRoZXIgdGhhbiBhIFZlY3RvcjMgYW5kIG9yZGVyLicgKTsKCgkJCX0KCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl2YXIgeCA9IGV1bGVyLngsIHkgPSBldWxlci55LCB6ID0gZXVsZXIuejsKCQkJdmFyIGEgPSBNYXRoLmNvcyggeCApLCBiID0gTWF0aC5zaW4oIHggKTsKCQkJdmFyIGMgPSBNYXRoLmNvcyggeSApLCBkID0gTWF0aC5zaW4oIHkgKTsKCQkJdmFyIGUgPSBNYXRoLmNvcyggeiApLCBmID0gTWF0aC5zaW4oIHogKTsKCgkJCWlmICggZXVsZXIub3JkZXIgPT09ICdYWVonICkgewoKCQkJCXZhciBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwoKCQkJCXRlWyAwIF0gPSBjICogZTsKCQkJCXRlWyA0IF0gPSAtIGMgKiBmOwoJCQkJdGVbIDggXSA9IGQ7CgoJCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwoJCQkJdGVbIDUgXSA9IGFlIC0gYmYgKiBkOwoJCQkJdGVbIDkgXSA9IC0gYiAqIGM7CgoJCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwoJCQkJdGVbIDYgXSA9IGJlICsgYWYgKiBkOwoJCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCgkJCQl2YXIgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCgkJCQl0ZVsgMCBdID0gY2UgKyBkZiAqIGI7CgkJCQl0ZVsgNCBdID0gZGUgKiBiIC0gY2Y7CgkJCQl0ZVsgOCBdID0gYSAqIGQ7CgoJCQkJdGVbIDEgXSA9IGEgKiBmOwoJCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQkJdGVbIDkgXSA9IC0gYjsKCgkJCQl0ZVsgMiBdID0gY2YgKiBiIC0gZGU7CgkJCQl0ZVsgNiBdID0gZGYgKyBjZSAqIGI7CgkJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdaWFknICkgewoKCQkJCXZhciBjZSA9IGMgKiBlLCBjZiA9IGMgKiBmLCBkZSA9IGQgKiBlLCBkZiA9IGQgKiBmOwoKCQkJCXRlWyAwIF0gPSBjZSAtIGRmICogYjsKCQkJCXRlWyA0IF0gPSAtIGEgKiBmOwoJCQkJdGVbIDggXSA9IGRlICsgY2YgKiBiOwoKCQkJCXRlWyAxIF0gPSBjZiArIGRlICogYjsKCQkJCXRlWyA1IF0gPSBhICogZTsKCQkJCXRlWyA5IF0gPSBkZiAtIGNlICogYjsKCgkJCQl0ZVsgMiBdID0gLSBhICogZDsKCQkJCXRlWyA2IF0gPSBiOwoJCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWllYJyApIHsKCgkJCQl2YXIgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCgkJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCQl0ZVsgNCBdID0gYmUgKiBkIC0gYWY7CgkJCQl0ZVsgOCBdID0gYWUgKiBkICsgYmY7CgoJCQkJdGVbIDEgXSA9IGMgKiBmOwoJCQkJdGVbIDUgXSA9IGJmICogZCArIGFlOwoJCQkJdGVbIDkgXSA9IGFmICogZCAtIGJlOwoKCQkJCXRlWyAyIF0gPSAtIGQ7CgkJCQl0ZVsgNiBdID0gYiAqIGM7CgkJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKCQkJCXZhciBhYyA9IGEgKiBjLCBhZCA9IGEgKiBkLCBiYyA9IGIgKiBjLCBiZCA9IGIgKiBkOwoKCQkJCXRlWyAwIF0gPSBjICogZTsKCQkJCXRlWyA0IF0gPSBiZCAtIGFjICogZjsKCQkJCXRlWyA4IF0gPSBiYyAqIGYgKyBhZDsKCgkJCQl0ZVsgMSBdID0gZjsKCQkJCXRlWyA1IF0gPSBhICogZTsKCQkJCXRlWyA5IF0gPSAtIGIgKiBlOwoKCQkJCXRlWyAyIF0gPSAtIGQgKiBlOwoJCQkJdGVbIDYgXSA9IGFkICogZiArIGJjOwoJCQkJdGVbIDEwIF0gPSBhYyAtIGJkICogZjsKCgkJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWFpZJyApIHsKCgkJCQl2YXIgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKCgkJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCQl0ZVsgNCBdID0gLSBmOwoJCQkJdGVbIDggXSA9IGQgKiBlOwoKCQkJCXRlWyAxIF0gPSBhYyAqIGYgKyBiZDsKCQkJCXRlWyA1IF0gPSBhICogZTsKCQkJCXRlWyA5IF0gPSBhZCAqIGYgLSBiYzsKCgkJCQl0ZVsgMiBdID0gYmMgKiBmIC0gYWQ7CgkJCQl0ZVsgNiBdID0gYiAqIGU7CgkJCQl0ZVsgMTAgXSA9IGJkICogZiArIGFjOwoKCQkJfQoKCQkJLy8gYm90dG9tIHJvdwoJCQl0ZVsgMyBdID0gMDsKCQkJdGVbIDcgXSA9IDA7CgkJCXRlWyAxMSBdID0gMDsKCgkJCS8vIGxhc3QgY29sdW1uCgkJCXRlWyAxMiBdID0gMDsKCQkJdGVbIDEzIF0gPSAwOwoJCQl0ZVsgMTQgXSA9IDA7CgkJCXRlWyAxNSBdID0gMTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHplcm8gPSBuZXcgVmVjdG9yMyggMCwgMCwgMCApOwoJCQl2YXIgb25lID0gbmV3IFZlY3RvcjMoIDEsIDEsIDEgKTsKCgkJCXJldHVybiBmdW5jdGlvbiBtYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApIHsKCgkJCQlyZXR1cm4gdGhpcy5jb21wb3NlKCB6ZXJvLCBxLCBvbmUgKTsKCgkJCX07CgoJCX0oKSwKCgkJbG9va0F0OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgeCA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB5ID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHogPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGxvb2tBdCggZXllLCB0YXJnZXQsIHVwICkgewoKCQkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQkJei5zdWJWZWN0b3JzKCBleWUsIHRhcmdldCApOwoKCQkJCWlmICggei5sZW5ndGhTcSgpID09PSAwICkgewoKCQkJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCgkJCQkJei56ID0gMTsKCgkJCQl9CgoJCQkJei5ub3JtYWxpemUoKTsKCQkJCXguY3Jvc3NWZWN0b3JzKCB1cCwgeiApOwoKCQkJCWlmICggeC5sZW5ndGhTcSgpID09PSAwICkgewoKCQkJCQkvLyB1cCBhbmQgeiBhcmUgcGFyYWxsZWwKCgkJCQkJaWYgKCBNYXRoLmFicyggdXAueiApID09PSAxICkgewoKCQkJCQkJei54ICs9IDAuMDAwMTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXoueiArPSAwLjAwMDE7CgoJCQkJCX0KCgkJCQkJei5ub3JtYWxpemUoKTsKCQkJCQl4LmNyb3NzVmVjdG9ycyggdXAsIHogKTsKCgkJCQl9CgoJCQkJeC5ub3JtYWxpemUoKTsKCQkJCXkuY3Jvc3NWZWN0b3JzKCB6LCB4ICk7CgoJCQkJdGVbIDAgXSA9IHgueDsgdGVbIDQgXSA9IHkueDsgdGVbIDggXSA9IHoueDsKCQkJCXRlWyAxIF0gPSB4Lnk7IHRlWyA1IF0gPSB5Lnk7IHRlWyA5IF0gPSB6Lnk7CgkJCQl0ZVsgMiBdID0geC56OyB0ZVsgNiBdID0geS56OyB0ZVsgMTAgXSA9IHouejsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJbXVsdGlwbHk6IGZ1bmN0aW9uICggbSwgbiApIHsKCgkJCWlmICggbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIG0sIG4gKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIHRoaXMsIG0gKTsKCgkJfSwKCgkJcHJlbXVsdGlwbHk6IGZ1bmN0aW9uICggbSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIG0sIHRoaXMgKTsKCgkJfSwKCgkJbXVsdGlwbHlNYXRyaWNlczogZnVuY3Rpb24gKCBhLCBiICkgewoKCQkJdmFyIGFlID0gYS5lbGVtZW50czsKCQkJdmFyIGJlID0gYi5lbGVtZW50czsKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCXZhciBhMTEgPSBhZVsgMCBdLCBhMTIgPSBhZVsgNCBdLCBhMTMgPSBhZVsgOCBdLCBhMTQgPSBhZVsgMTIgXTsKCQkJdmFyIGEyMSA9IGFlWyAxIF0sIGEyMiA9IGFlWyA1IF0sIGEyMyA9IGFlWyA5IF0sIGEyNCA9IGFlWyAxMyBdOwoJCQl2YXIgYTMxID0gYWVbIDIgXSwgYTMyID0gYWVbIDYgXSwgYTMzID0gYWVbIDEwIF0sIGEzNCA9IGFlWyAxNCBdOwoJCQl2YXIgYTQxID0gYWVbIDMgXSwgYTQyID0gYWVbIDcgXSwgYTQzID0gYWVbIDExIF0sIGE0NCA9IGFlWyAxNSBdOwoKCQkJdmFyIGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyA0IF0sIGIxMyA9IGJlWyA4IF0sIGIxNCA9IGJlWyAxMiBdOwoJCQl2YXIgYjIxID0gYmVbIDEgXSwgYjIyID0gYmVbIDUgXSwgYjIzID0gYmVbIDkgXSwgYjI0ID0gYmVbIDEzIF07CgkJCXZhciBiMzEgPSBiZVsgMiBdLCBiMzIgPSBiZVsgNiBdLCBiMzMgPSBiZVsgMTAgXSwgYjM0ID0gYmVbIDE0IF07CgkJCXZhciBiNDEgPSBiZVsgMyBdLCBiNDIgPSBiZVsgNyBdLCBiNDMgPSBiZVsgMTEgXSwgYjQ0ID0gYmVbIDE1IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwoJCQl0ZVsgNCBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyICsgYTE0ICogYjQyOwoJCQl0ZVsgOCBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzICsgYTE0ICogYjQzOwoJCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCgkJCXRlWyAxIF0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzEgKyBhMjQgKiBiNDE7CgkJCXRlWyA1IF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzIgKyBhMjQgKiBiNDI7CgkJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CgkJCXRlWyAxMyBdID0gYTIxICogYjE0ICsgYTIyICogYjI0ICsgYTIzICogYjM0ICsgYTI0ICogYjQ0OwoKCQkJdGVbIDIgXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMSArIGEzNCAqIGI0MTsKCQkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKCQkJdGVbIDEwIF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzMgKyBhMzQgKiBiNDM7CgkJCXRlWyAxNCBdID0gYTMxICogYjE0ICsgYTMyICogYjI0ICsgYTMzICogYjM0ICsgYTM0ICogYjQ0OwoKCQkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKCQkJdGVbIDcgXSA9IGE0MSAqIGIxMiArIGE0MiAqIGIyMiArIGE0MyAqIGIzMiArIGE0NCAqIGI0MjsKCQkJdGVbIDExIF0gPSBhNDEgKiBiMTMgKyBhNDIgKiBiMjMgKyBhNDMgKiBiMzMgKyBhNDQgKiBiNDM7CgkJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKCQkJdGVbIDEgXSAqPSBzOyB0ZVsgNSBdICo9IHM7IHRlWyA5IF0gKj0gczsgdGVbIDEzIF0gKj0gczsKCQkJdGVbIDIgXSAqPSBzOyB0ZVsgNiBdICo9IHM7IHRlWyAxMCBdICo9IHM7IHRlWyAxNCBdICo9IHM7CgkJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFwcGx5VG9CdWZmZXJBdHRyaWJ1dGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlICkgewoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGF0dHJpYnV0ZS5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXYxLnggPSBhdHRyaWJ1dGUuZ2V0WCggaSApOwoJCQkJCXYxLnkgPSBhdHRyaWJ1dGUuZ2V0WSggaSApOwoJCQkJCXYxLnogPSBhdHRyaWJ1dGUuZ2V0WiggaSApOwoKCQkJCQl2MS5hcHBseU1hdHJpeDQoIHRoaXMgKTsKCgkJCQkJYXR0cmlidXRlLnNldFhZWiggaSwgdjEueCwgdjEueSwgdjEueiApOwoKCQkJCX0KCgkJCQlyZXR1cm4gYXR0cmlidXRlOwoKCQkJfTsKCgkJfSgpLAoKCQlkZXRlcm1pbmFudDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCXZhciBuMTEgPSB0ZVsgMCBdLCBuMTIgPSB0ZVsgNCBdLCBuMTMgPSB0ZVsgOCBdLCBuMTQgPSB0ZVsgMTIgXTsKCQkJdmFyIG4yMSA9IHRlWyAxIF0sIG4yMiA9IHRlWyA1IF0sIG4yMyA9IHRlWyA5IF0sIG4yNCA9IHRlWyAxMyBdOwoJCQl2YXIgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwoJCQl2YXIgbjQxID0gdGVbIDMgXSwgbjQyID0gdGVbIDcgXSwgbjQzID0gdGVbIDExIF0sIG40NCA9IHRlWyAxNSBdOwoKCQkJLy9UT0RPOiBtYWtlIHRoaXMgbW9yZSBlZmZpY2llbnQKCQkJLy8oIGJhc2VkIG9uIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2FsZ2VicmEvbWF0cml4L2Z1bmN0aW9ucy9pbnZlcnNlL2ZvdXJEL2luZGV4Lmh0bSApCgoJCQlyZXR1cm4gKAoJCQkJbjQxICogKAoJCQkJCSsgbjE0ICogbjIzICogbjMyCgkJCQkJIC0gbjEzICogbjI0ICogbjMyCgkJCQkJIC0gbjE0ICogbjIyICogbjMzCgkJCQkJICsgbjEyICogbjI0ICogbjMzCgkJCQkJICsgbjEzICogbjIyICogbjM0CgkJCQkJIC0gbjEyICogbjIzICogbjM0CgkJCQkpICsKCQkJCW40MiAqICgKCQkJCQkrIG4xMSAqIG4yMyAqIG4zNAoJCQkJCSAtIG4xMSAqIG4yNCAqIG4zMwoJCQkJCSArIG4xNCAqIG4yMSAqIG4zMwoJCQkJCSAtIG4xMyAqIG4yMSAqIG4zNAoJCQkJCSArIG4xMyAqIG4yNCAqIG4zMQoJCQkJCSAtIG4xNCAqIG4yMyAqIG4zMQoJCQkJKSArCgkJCQluNDMgKiAoCgkJCQkJKyBuMTEgKiBuMjQgKiBuMzIKCQkJCQkgLSBuMTEgKiBuMjIgKiBuMzQKCQkJCQkgLSBuMTQgKiBuMjEgKiBuMzIKCQkJCQkgKyBuMTIgKiBuMjEgKiBuMzQKCQkJCQkgKyBuMTQgKiBuMjIgKiBuMzEKCQkJCQkgLSBuMTIgKiBuMjQgKiBuMzEKCQkJCSkgKwoJCQkJbjQ0ICogKAoJCQkJCS0gbjEzICogbjIyICogbjMxCgkJCQkJIC0gbjExICogbjIzICogbjMyCgkJCQkJICsgbjExICogbjIyICogbjMzCgkJCQkJICsgbjEzICogbjIxICogbjMyCgkJCQkJIC0gbjEyICogbjIxICogbjMzCgkJCQkJICsgbjEyICogbjIzICogbjMxCgkJCQkpCgoJCQkpOwoKCQl9LAoKCQl0cmFuc3Bvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCXZhciB0bXA7CgoJCQl0bXAgPSB0ZVsgMSBdOyB0ZVsgMSBdID0gdGVbIDQgXTsgdGVbIDQgXSA9IHRtcDsKCQkJdG1wID0gdGVbIDIgXTsgdGVbIDIgXSA9IHRlWyA4IF07IHRlWyA4IF0gPSB0bXA7CgkJCXRtcCA9IHRlWyA2IF07IHRlWyA2IF0gPSB0ZVsgOSBdOyB0ZVsgOSBdID0gdG1wOwoKCQkJdG1wID0gdGVbIDMgXTsgdGVbIDMgXSA9IHRlWyAxMiBdOyB0ZVsgMTIgXSA9IHRtcDsKCQkJdG1wID0gdGVbIDcgXTsgdGVbIDcgXSA9IHRlWyAxMyBdOyB0ZVsgMTMgXSA9IHRtcDsKCQkJdG1wID0gdGVbIDExIF07IHRlWyAxMSBdID0gdGVbIDE0IF07IHRlWyAxNCBdID0gdG1wOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFBvc2l0aW9uOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDEyIF0gPSB2Lng7CgkJCXRlWyAxMyBdID0gdi55OwoJCQl0ZVsgMTQgXSA9IHYuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlnZXRJbnZlcnNlOiBmdW5jdGlvbiAoIG0sIHRocm93T25EZWdlbmVyYXRlICkgewoKCQkJLy8gYmFzZWQgb24gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHMsCgkJCQltZSA9IG0uZWxlbWVudHMsCgoJCQkJbjExID0gbWVbIDAgXSwgbjIxID0gbWVbIDEgXSwgbjMxID0gbWVbIDIgXSwgbjQxID0gbWVbIDMgXSwKCQkJCW4xMiA9IG1lWyA0IF0sIG4yMiA9IG1lWyA1IF0sIG4zMiA9IG1lWyA2IF0sIG40MiA9IG1lWyA3IF0sCgkJCQluMTMgPSBtZVsgOCBdLCBuMjMgPSBtZVsgOSBdLCBuMzMgPSBtZVsgMTAgXSwgbjQzID0gbWVbIDExIF0sCgkJCQluMTQgPSBtZVsgMTIgXSwgbjI0ID0gbWVbIDEzIF0sIG4zNCA9IG1lWyAxNCBdLCBuNDQgPSBtZVsgMTUgXSwKCgkJCQl0MTEgPSBuMjMgKiBuMzQgKiBuNDIgLSBuMjQgKiBuMzMgKiBuNDIgKyBuMjQgKiBuMzIgKiBuNDMgLSBuMjIgKiBuMzQgKiBuNDMgLSBuMjMgKiBuMzIgKiBuNDQgKyBuMjIgKiBuMzMgKiBuNDQsCgkJCQl0MTIgPSBuMTQgKiBuMzMgKiBuNDIgLSBuMTMgKiBuMzQgKiBuNDIgLSBuMTQgKiBuMzIgKiBuNDMgKyBuMTIgKiBuMzQgKiBuNDMgKyBuMTMgKiBuMzIgKiBuNDQgLSBuMTIgKiBuMzMgKiBuNDQsCgkJCQl0MTMgPSBuMTMgKiBuMjQgKiBuNDIgLSBuMTQgKiBuMjMgKiBuNDIgKyBuMTQgKiBuMjIgKiBuNDMgLSBuMTIgKiBuMjQgKiBuNDMgLSBuMTMgKiBuMjIgKiBuNDQgKyBuMTIgKiBuMjMgKiBuNDQsCgkJCQl0MTQgPSBuMTQgKiBuMjMgKiBuMzIgLSBuMTMgKiBuMjQgKiBuMzIgLSBuMTQgKiBuMjIgKiBuMzMgKyBuMTIgKiBuMjQgKiBuMzMgKyBuMTMgKiBuMjIgKiBuMzQgLSBuMTIgKiBuMjMgKiBuMzQ7CgoJCQl2YXIgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKCQkJaWYgKCBkZXQgPT09IDAgKSB7CgoJCQkJdmFyIG1zZyA9ICJUSFJFRS5NYXRyaXg0OiAuZ2V0SW52ZXJzZSgpIGNhbid0IGludmVydCBtYXRyaXgsIGRldGVybWluYW50IGlzIDAiOwoKCQkJCWlmICggdGhyb3dPbkRlZ2VuZXJhdGUgPT09IHRydWUgKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggbXNnICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS53YXJuKCBtc2cgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHRoaXMuaWRlbnRpdHkoKTsKCgkJCX0KCgkJCXZhciBkZXRJbnYgPSAxIC8gZGV0OwoKCQkJdGVbIDAgXSA9IHQxMSAqIGRldEludjsKCQkJdGVbIDEgXSA9ICggbjI0ICogbjMzICogbjQxIC0gbjIzICogbjM0ICogbjQxIC0gbjI0ICogbjMxICogbjQzICsgbjIxICogbjM0ICogbjQzICsgbjIzICogbjMxICogbjQ0IC0gbjIxICogbjMzICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyAyIF0gPSAoIG4yMiAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMiAqIG40MSArIG4yNCAqIG4zMSAqIG40MiAtIG4yMSAqIG4zNCAqIG40MiAtIG4yMiAqIG4zMSAqIG40NCArIG4yMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgMyBdID0gKCBuMjMgKiBuMzIgKiBuNDEgLSBuMjIgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzEgKiBuNDIgKyBuMjEgKiBuMzMgKiBuNDIgKyBuMjIgKiBuMzEgKiBuNDMgLSBuMjEgKiBuMzIgKiBuNDMgKSAqIGRldEludjsKCgkJCXRlWyA0IF0gPSB0MTIgKiBkZXRJbnY7CgkJCXRlWyA1IF0gPSAoIG4xMyAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMyAqIG40MSArIG4xNCAqIG4zMSAqIG40MyAtIG4xMSAqIG4zNCAqIG40MyAtIG4xMyAqIG4zMSAqIG40NCArIG4xMSAqIG4zMyAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgNiBdID0gKCBuMTQgKiBuMzIgKiBuNDEgLSBuMTIgKiBuMzQgKiBuNDEgLSBuMTQgKiBuMzEgKiBuNDIgKyBuMTEgKiBuMzQgKiBuNDIgKyBuMTIgKiBuMzEgKiBuNDQgLSBuMTEgKiBuMzIgKiBuNDQgKSAqIGRldEludjsKCQkJdGVbIDcgXSA9ICggbjEyICogbjMzICogbjQxIC0gbjEzICogbjMyICogbjQxICsgbjEzICogbjMxICogbjQyIC0gbjExICogbjMzICogbjQyIC0gbjEyICogbjMxICogbjQzICsgbjExICogbjMyICogbjQzICkgKiBkZXRJbnY7CgoJCQl0ZVsgOCBdID0gdDEzICogZGV0SW52OwoJCQl0ZVsgOSBdID0gKCBuMTQgKiBuMjMgKiBuNDEgLSBuMTMgKiBuMjQgKiBuNDEgLSBuMTQgKiBuMjEgKiBuNDMgKyBuMTEgKiBuMjQgKiBuNDMgKyBuMTMgKiBuMjEgKiBuNDQgLSBuMTEgKiBuMjMgKiBuNDQgKSAqIGRldEludjsKCQkJdGVbIDEwIF0gPSAoIG4xMiAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMiAqIG40MSArIG4xNCAqIG4yMSAqIG40MiAtIG4xMSAqIG4yNCAqIG40MiAtIG4xMiAqIG4yMSAqIG40NCArIG4xMSAqIG4yMiAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgMTEgXSA9ICggbjEzICogbjIyICogbjQxIC0gbjEyICogbjIzICogbjQxIC0gbjEzICogbjIxICogbjQyICsgbjExICogbjIzICogbjQyICsgbjEyICogbjIxICogbjQzIC0gbjExICogbjIyICogbjQzICkgKiBkZXRJbnY7CgoJCQl0ZVsgMTIgXSA9IHQxNCAqIGRldEludjsKCQkJdGVbIDEzIF0gPSAoIG4xMyAqIG4yNCAqIG4zMSAtIG4xNCAqIG4yMyAqIG4zMSArIG4xNCAqIG4yMSAqIG4zMyAtIG4xMSAqIG4yNCAqIG4zMyAtIG4xMyAqIG4yMSAqIG4zNCArIG4xMSAqIG4yMyAqIG4zNCApICogZGV0SW52OwoJCQl0ZVsgMTQgXSA9ICggbjE0ICogbjIyICogbjMxIC0gbjEyICogbjI0ICogbjMxIC0gbjE0ICogbjIxICogbjMyICsgbjExICogbjI0ICogbjMyICsgbjEyICogbjIxICogbjM0IC0gbjExICogbjIyICogbjM0ICkgKiBkZXRJbnY7CgkJCXRlWyAxNSBdID0gKCBuMTIgKiBuMjMgKiBuMzEgLSBuMTMgKiBuMjIgKiBuMzEgKyBuMTMgKiBuMjEgKiBuMzIgLSBuMTEgKiBuMjMgKiBuMzIgLSBuMTIgKiBuMjEgKiBuMzMgKyBuMTEgKiBuMjIgKiBuMzMgKSAqIGRldEludjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzY2FsZTogZnVuY3Rpb24gKCB2ICkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCQkJdmFyIHggPSB2LngsIHkgPSB2LnksIHogPSB2Lno7CgoJCQl0ZVsgMCBdICo9IHg7IHRlWyA0IF0gKj0geTsgdGVbIDggXSAqPSB6OwoJCQl0ZVsgMSBdICo9IHg7IHRlWyA1IF0gKj0geTsgdGVbIDkgXSAqPSB6OwoJCQl0ZVsgMiBdICo9IHg7IHRlWyA2IF0gKj0geTsgdGVbIDEwIF0gKj0gejsKCQkJdGVbIDMgXSAqPSB4OyB0ZVsgNyBdICo9IHk7IHRlWyAxMSBdICo9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0TWF4U2NhbGVPbkF4aXM6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl2YXIgc2NhbGVYU3EgPSB0ZVsgMCBdICogdGVbIDAgXSArIHRlWyAxIF0gKiB0ZVsgMSBdICsgdGVbIDIgXSAqIHRlWyAyIF07CgkJCXZhciBzY2FsZVlTcSA9IHRlWyA0IF0gKiB0ZVsgNCBdICsgdGVbIDUgXSAqIHRlWyA1IF0gKyB0ZVsgNiBdICogdGVbIDYgXTsKCQkJdmFyIHNjYWxlWlNxID0gdGVbIDggXSAqIHRlWyA4IF0gKyB0ZVsgOSBdICogdGVbIDkgXSArIHRlWyAxMCBdICogdGVbIDEwIF07CgoJCQlyZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLm1heCggc2NhbGVYU3EsIHNjYWxlWVNxLCBzY2FsZVpTcSApICk7CgoJCX0sCgoJCW1ha2VUcmFuc2xhdGlvbjogZnVuY3Rpb24gKCB4LCB5LCB6ICkgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgMCwgeCwKCQkJCTAsIDEsIDAsIHksCgkJCQkwLCAwLCAxLCB6LAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlUm90YXRpb25YOiBmdW5jdGlvbiAoIHRoZXRhICkgewoKCQkJdmFyIGMgPSBNYXRoLmNvcyggdGhldGEgKSwgcyA9IE1hdGguc2luKCB0aGV0YSApOwoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgMCwgMCwKCQkJCTAsIGMsIC0gcywgMCwKCQkJCTAsIHMsIGMsIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW1ha2VSb3RhdGlvblk6IGZ1bmN0aW9uICggdGhldGEgKSB7CgoJCQl2YXIgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQkgYywgMCwgcywgMCwKCQkJCSAwLCAxLCAwLCAwLAoJCQkJLSBzLCAwLCBjLCAwLAoJCQkJIDAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbWFrZVJvdGF0aW9uWjogZnVuY3Rpb24gKCB0aGV0YSApIHsKCgkJCXZhciBjID0gTWF0aC5jb3MoIHRoZXRhICksIHMgPSBNYXRoLnNpbiggdGhldGEgKTsKCgkJCXRoaXMuc2V0KAoKCQkJCWMsIC0gcywgMCwgMCwKCQkJCXMsIGMsIDAsIDAsCgkJCQkwLCAwLCAxLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlUm90YXRpb25BeGlzOiBmdW5jdGlvbiAoIGF4aXMsIGFuZ2xlICkgewoKCQkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgoJCQl2YXIgYyA9IE1hdGguY29zKCBhbmdsZSApOwoJCQl2YXIgcyA9IE1hdGguc2luKCBhbmdsZSApOwoJCQl2YXIgdCA9IDEgLSBjOwoJCQl2YXIgeCA9IGF4aXMueCwgeSA9IGF4aXMueSwgeiA9IGF4aXMuejsKCQkJdmFyIHR4ID0gdCAqIHgsIHR5ID0gdCAqIHk7CgoJCQl0aGlzLnNldCgKCgkJCQl0eCAqIHggKyBjLCB0eCAqIHkgLSBzICogeiwgdHggKiB6ICsgcyAqIHksIDAsCgkJCQl0eCAqIHkgKyBzICogeiwgdHkgKiB5ICsgYywgdHkgKiB6IC0gcyAqIHgsIDAsCgkJCQl0eCAqIHogLSBzICogeSwgdHkgKiB6ICsgcyAqIHgsIHQgKiB6ICogeiArIGMsIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJIHJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlU2NhbGU6IGZ1bmN0aW9uICggeCwgeSwgeiApIHsKCgkJCXRoaXMuc2V0KAoKCQkJCXgsIDAsIDAsIDAsCgkJCQkwLCB5LCAwLCAwLAoJCQkJMCwgMCwgeiwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbWFrZVNoZWFyOiBmdW5jdGlvbiAoIHgsIHksIHogKSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCB5LCB6LCAwLAoJCQkJeCwgMSwgeiwgMCwKCQkJCXgsIHksIDEsIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvbXBvc2U6IGZ1bmN0aW9uICggcG9zaXRpb24sIHF1YXRlcm5pb24sIHNjYWxlICkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCXZhciB4ID0gcXVhdGVybmlvbi5feCwgeSA9IHF1YXRlcm5pb24uX3ksIHogPSBxdWF0ZXJuaW9uLl96LCB3ID0gcXVhdGVybmlvbi5fdzsKCQkJdmFyIHgyID0geCArIHgsCXkyID0geSArIHksIHoyID0geiArIHo7CgkJCXZhciB4eCA9IHggKiB4MiwgeHkgPSB4ICogeTIsIHh6ID0geCAqIHoyOwoJCQl2YXIgeXkgPSB5ICogeTIsIHl6ID0geSAqIHoyLCB6eiA9IHogKiB6MjsKCQkJdmFyIHd4ID0gdyAqIHgyLCB3eSA9IHcgKiB5Miwgd3ogPSB3ICogejI7CgoJCQl2YXIgc3ggPSBzY2FsZS54LCBzeSA9IHNjYWxlLnksIHN6ID0gc2NhbGUuejsKCgkJICAgICAgICB0ZVsgMCBdID0gKCAxIC0gKCB5eSArIHp6ICkgKSAqIHN4OwoJCSAgICAgICAgdGVbIDEgXSA9ICggeHkgKyB3eiApICogc3g7CgkJICAgICAgICB0ZVsgMiBdID0gKCB4eiAtIHd5ICkgKiBzeDsKCQkgICAgICAgIHRlWyAzIF0gPSAwOwoKCQkgICAgICAgIHRlWyA0IF0gPSAoIHh5IC0gd3ogKSAqIHN5OwoJCSAgICAgICAgdGVbIDUgXSA9ICggMSAtICggeHggKyB6eiApICkgKiBzeTsKCQkgICAgICAgIHRlWyA2IF0gPSAoIHl6ICsgd3ggKSAqIHN5OwoJCSAgICAgICAgdGVbIDcgXSA9IDA7CgoJCSAgICAgICAgdGVbIDggXSA9ICggeHogKyB3eSApICogc3o7CgkJICAgICAgICB0ZVsgOSBdID0gKCB5eiAtIHd4ICkgKiBzejsKCQkgICAgICAgIHRlWyAxMCBdID0gKCAxIC0gKCB4eCArIHl5ICkgKSAqIHN6OwoJCSAgICAgICAgdGVbIDExIF0gPSAwOwoKCQkgICAgICAgIHRlWyAxMiBdID0gcG9zaXRpb24ueDsKCQkgICAgICAgIHRlWyAxMyBdID0gcG9zaXRpb24ueTsKCQkgICAgICAgIHRlWyAxNCBdID0gcG9zaXRpb24uejsKCQkgICAgICAgIHRlWyAxNSBdID0gMTsKCgkJICAgICAgICByZXR1cm4gdGhpczsKCgkJfSwKCgkJZGVjb21wb3NlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gZGVjb21wb3NlKCBwb3NpdGlvbiwgcXVhdGVybmlvbiwgc2NhbGUgKSB7CgoJCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCQl2YXIgc3ggPSB2ZWN0b3Iuc2V0KCB0ZVsgMCBdLCB0ZVsgMSBdLCB0ZVsgMiBdICkubGVuZ3RoKCk7CgkJCQl2YXIgc3kgPSB2ZWN0b3Iuc2V0KCB0ZVsgNCBdLCB0ZVsgNSBdLCB0ZVsgNiBdICkubGVuZ3RoKCk7CgkJCQl2YXIgc3ogPSB2ZWN0b3Iuc2V0KCB0ZVsgOCBdLCB0ZVsgOSBdLCB0ZVsgMTAgXSApLmxlbmd0aCgpOwoKCQkJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCgkJCQl2YXIgZGV0ID0gdGhpcy5kZXRlcm1pbmFudCgpOwoJCQkJaWYgKCBkZXQgPCAwICkgc3ggPSAtIHN4OwoKCQkJCXBvc2l0aW9uLnggPSB0ZVsgMTIgXTsKCQkJCXBvc2l0aW9uLnkgPSB0ZVsgMTMgXTsKCQkJCXBvc2l0aW9uLnogPSB0ZVsgMTQgXTsKCgkJCQkvLyBzY2FsZSB0aGUgcm90YXRpb24gcGFydAoJCQkJbWF0cml4LmNvcHkoIHRoaXMgKTsKCgkJCQl2YXIgaW52U1ggPSAxIC8gc3g7CgkJCQl2YXIgaW52U1kgPSAxIC8gc3k7CgkJCQl2YXIgaW52U1ogPSAxIC8gc3o7CgoJCQkJbWF0cml4LmVsZW1lbnRzWyAwIF0gKj0gaW52U1g7CgkJCQltYXRyaXguZWxlbWVudHNbIDEgXSAqPSBpbnZTWDsKCQkJCW1hdHJpeC5lbGVtZW50c1sgMiBdICo9IGludlNYOwoKCQkJCW1hdHJpeC5lbGVtZW50c1sgNCBdICo9IGludlNZOwoJCQkJbWF0cml4LmVsZW1lbnRzWyA1IF0gKj0gaW52U1k7CgkJCQltYXRyaXguZWxlbWVudHNbIDYgXSAqPSBpbnZTWTsKCgkJCQltYXRyaXguZWxlbWVudHNbIDggXSAqPSBpbnZTWjsKCQkJCW1hdHJpeC5lbGVtZW50c1sgOSBdICo9IGludlNaOwoJCQkJbWF0cml4LmVsZW1lbnRzWyAxMCBdICo9IGludlNaOwoKCQkJCXF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtYXRyaXggKTsKCgkJCQlzY2FsZS54ID0gc3g7CgkJCQlzY2FsZS55ID0gc3k7CgkJCQlzY2FsZS56ID0gc3o7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCW1ha2VQZXJzcGVjdGl2ZTogZnVuY3Rpb24gKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciApIHsKCgkJCWlmICggZmFyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0cml4NDogLm1ha2VQZXJzcGVjdGl2ZSgpIGhhcyBiZWVuIHJlZGVmaW5lZCBhbmQgaGFzIGEgbmV3IHNpZ25hdHVyZS4gUGxlYXNlIGNoZWNrIHRoZSBkb2NzLicgKTsKCgkJCX0KCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCXZhciB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQl2YXIgeSA9IDIgKiBuZWFyIC8gKCB0b3AgLSBib3R0b20gKTsKCgkJCXZhciBhID0gKCByaWdodCArIGxlZnQgKSAvICggcmlnaHQgLSBsZWZ0ICk7CgkJCXZhciBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgkJCXZhciBjID0gLSAoIGZhciArIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoJCQl2YXIgZCA9IC0gMiAqIGZhciAqIG5lYXIgLyAoIGZhciAtIG5lYXIgKTsKCgkJCXRlWyAwIF0gPSB4Owl0ZVsgNCBdID0gMDsJdGVbIDggXSA9IGE7CXRlWyAxMiBdID0gMDsKCQkJdGVbIDEgXSA9IDA7CXRlWyA1IF0gPSB5Owl0ZVsgOSBdID0gYjsJdGVbIDEzIF0gPSAwOwoJCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsJdGVbIDE0IF0gPSBkOwoJCQl0ZVsgMyBdID0gMDsJdGVbIDcgXSA9IDA7CXRlWyAxMSBdID0gLSAxOwl0ZVsgMTUgXSA9IDA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbWFrZU9ydGhvZ3JhcGhpYzogZnVuY3Rpb24gKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciApIHsKCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCXZhciB3ID0gMS4wIC8gKCByaWdodCAtIGxlZnQgKTsKCQkJdmFyIGggPSAxLjAgLyAoIHRvcCAtIGJvdHRvbSApOwoJCQl2YXIgcCA9IDEuMCAvICggZmFyIC0gbmVhciApOwoKCQkJdmFyIHggPSAoIHJpZ2h0ICsgbGVmdCApICogdzsKCQkJdmFyIHkgPSAoIHRvcCArIGJvdHRvbSApICogaDsKCQkJdmFyIHogPSAoIGZhciArIG5lYXIgKSAqIHA7CgoJCQl0ZVsgMCBdID0gMiAqIHc7CXRlWyA0IF0gPSAwOwl0ZVsgOCBdID0gMDsJdGVbIDEyIF0gPSAtIHg7CgkJCXRlWyAxIF0gPSAwOwl0ZVsgNSBdID0gMiAqIGg7CXRlWyA5IF0gPSAwOwl0ZVsgMTMgXSA9IC0geTsKCQkJdGVbIDIgXSA9IDA7CXRlWyA2IF0gPSAwOwl0ZVsgMTAgXSA9IC0gMiAqIHA7CXRlWyAxNCBdID0gLSB6OwoJCQl0ZVsgMyBdID0gMDsJdGVbIDcgXSA9IDA7CXRlWyAxMSBdID0gMDsJdGVbIDE1IF0gPSAxOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWVxdWFsczogZnVuY3Rpb24gKCBtYXRyaXggKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQl2YXIgbWUgPSBtYXRyaXguZWxlbWVudHM7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IDE2OyBpICsrICkgewoKCQkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdG9BcnJheTogZnVuY3Rpb24gKCBhcnJheSwgb2Zmc2V0ICkgewoKCQkJaWYgKCBhcnJheSA9PT0gdW5kZWZpbmVkICkgYXJyYXkgPSBbXTsKCQkJaWYgKCBvZmZzZXQgPT09IHVuZGVmaW5lZCApIG9mZnNldCA9IDA7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGVbIDAgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRlWyAxIF07CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCgkJCWFycmF5WyBvZmZzZXQgKyA0IF0gPSB0ZVsgNCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgkJCWFycmF5WyBvZmZzZXQgKyA5IF0gPSB0ZVsgOSBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTAgXSA9IHRlWyAxMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDEyIF0gPSB0ZVsgMTIgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEzIF0gPSB0ZVsgMTMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE1IF0gPSB0ZVsgMTUgXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKi8KCglmdW5jdGlvbiBRdWF0ZXJuaW9uKCB4LCB5LCB6LCB3ICkgewoKCQl0aGlzLl94ID0geCB8fCAwOwoJCXRoaXMuX3kgPSB5IHx8IDA7CgkJdGhpcy5feiA9IHogfHwgMDsKCQl0aGlzLl93ID0gKCB3ICE9PSB1bmRlZmluZWQgKSA/IHcgOiAxOwoKCX0KCglPYmplY3QuYXNzaWduKCBRdWF0ZXJuaW9uLCB7CgoJCXNsZXJwOiBmdW5jdGlvbiAoIHFhLCBxYiwgcW0sIHQgKSB7CgoJCQlyZXR1cm4gcW0uY29weSggcWEgKS5zbGVycCggcWIsIHQgKTsKCgkJfSwKCgkJc2xlcnBGbGF0OiBmdW5jdGlvbiAoIGRzdCwgZHN0T2Zmc2V0LCBzcmMwLCBzcmNPZmZzZXQwLCBzcmMxLCBzcmNPZmZzZXQxLCB0ICkgewoKCQkJLy8gZnV6ei1mcmVlLCBhcnJheS1iYXNlZCBRdWF0ZXJuaW9uIFNMRVJQIG9wZXJhdGlvbgoKCQkJdmFyIHgwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDAgXSwKCQkJCXkwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDEgXSwKCQkJCXowID0gc3JjMFsgc3JjT2Zmc2V0MCArIDIgXSwKCQkJCXcwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDMgXSwKCgkJCQl4MSA9IHNyYzFbIHNyY09mZnNldDEgKyAwIF0sCgkJCQl5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF0sCgkJCQl6MSA9IHNyYzFbIHNyY09mZnNldDEgKyAyIF0sCgkJCQl3MSA9IHNyYzFbIHNyY09mZnNldDEgKyAzIF07CgoJCQlpZiAoIHcwICE9PSB3MSB8fCB4MCAhPT0geDEgfHwgeTAgIT09IHkxIHx8IHowICE9PSB6MSApIHsKCgkJCQl2YXIgcyA9IDEgLSB0LAoKCQkJCQljb3MgPSB4MCAqIHgxICsgeTAgKiB5MSArIHowICogejEgKyB3MCAqIHcxLAoKCQkJCQlkaXIgPSAoIGNvcyA+PSAwID8gMSA6IC0gMSApLAoJCQkJCXNxclNpbiA9IDEgLSBjb3MgKiBjb3M7CgoJCQkJLy8gU2tpcCB0aGUgU2xlcnAgZm9yIHRpbnkgc3RlcHMgdG8gYXZvaWQgbnVtZXJpYyBwcm9ibGVtczoKCQkJCWlmICggc3FyU2luID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCXZhciBzaW4gPSBNYXRoLnNxcnQoIHNxclNpbiApLAoJCQkJCQlsZW4gPSBNYXRoLmF0YW4yKCBzaW4sIGNvcyAqIGRpciApOwoKCQkJCQlzID0gTWF0aC5zaW4oIHMgKiBsZW4gKSAvIHNpbjsKCQkJCQl0ID0gTWF0aC5zaW4oIHQgKiBsZW4gKSAvIHNpbjsKCgkJCQl9CgoJCQkJdmFyIHREaXIgPSB0ICogZGlyOwoKCQkJCXgwID0geDAgKiBzICsgeDEgKiB0RGlyOwoJCQkJeTAgPSB5MCAqIHMgKyB5MSAqIHREaXI7CgkJCQl6MCA9IHowICogcyArIHoxICogdERpcjsKCQkJCXcwID0gdzAgKiBzICsgdzEgKiB0RGlyOwoKCQkJCS8vIE5vcm1hbGl6ZSBpbiBjYXNlIHdlIGp1c3QgZGlkIGEgbGVycDoKCQkJCWlmICggcyA9PT0gMSAtIHQgKSB7CgoJCQkJCXZhciBmID0gMSAvIE1hdGguc3FydCggeDAgKiB4MCArIHkwICogeTAgKyB6MCAqIHowICsgdzAgKiB3MCApOwoKCQkJCQl4MCAqPSBmOwoJCQkJCXkwICo9IGY7CgkJCQkJejAgKj0gZjsKCQkJCQl3MCAqPSBmOwoKCQkJCX0KCgkJCX0KCgkJCWRzdFsgZHN0T2Zmc2V0IF0gPSB4MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MDsKCgkJfQoKCX0gKTsKCglPYmplY3QuZGVmaW5lUHJvcGVydGllcyggUXVhdGVybmlvbi5wcm90b3R5cGUsIHsKCgkJeDogewoKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHRoaXMuX3g7CgoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXRoaXMuX3ggPSB2YWx1ZTsKCQkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJfQoKCQl9LAoKCQl5OiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gdGhpcy5feTsKCgkJCX0sCgoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJdGhpcy5feSA9IHZhbHVlOwoJCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQl9CgoJCX0sCgoJCXo6IHsKCgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLl96OwoKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQl0aGlzLl96ID0gdmFsdWU7CgkJCQl0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCX0KCgkJfSwKCgkJdzogewoKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHRoaXMuX3c7CgoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXRoaXMuX3cgPSB2YWx1ZTsKCQkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJfQoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFF1YXRlcm5pb24ucHJvdG90eXBlLCB7CgoJCWlzUXVhdGVybmlvbjogdHJ1ZSwKCgkJc2V0OiBmdW5jdGlvbiAoIHgsIHksIHosIHcgKSB7CgoJCQl0aGlzLl94ID0geDsKCQkJdGhpcy5feSA9IHk7CgkJCXRoaXMuX3ogPSB6OwoJCQl0aGlzLl93ID0gdzsKCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX3cgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBxdWF0ZXJuaW9uICkgewoKCQkJdGhpcy5feCA9IHF1YXRlcm5pb24ueDsKCQkJdGhpcy5feSA9IHF1YXRlcm5pb24ueTsKCQkJdGhpcy5feiA9IHF1YXRlcm5pb24uejsKCQkJdGhpcy5fdyA9IHF1YXRlcm5pb24udzsKCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21FdWxlcjogZnVuY3Rpb24gKCBldWxlciwgdXBkYXRlICkgewoKCQkJaWYgKCAhICggZXVsZXIgJiYgZXVsZXIuaXNFdWxlciApICkgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBub3cgZXhwZWN0cyBhbiBFdWxlciByb3RhdGlvbiByYXRoZXIgdGhhbiBhIFZlY3RvcjMgYW5kIG9yZGVyLicgKTsKCgkJCX0KCgkJCXZhciB4ID0gZXVsZXIuX3gsIHkgPSBldWxlci5feSwgeiA9IGV1bGVyLl96LCBvcmRlciA9IGV1bGVyLm9yZGVyOwoKCQkJLy8gaHR0cDovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLwoJCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCgkJCS8vCWNvbnRlbnQvU3BpbkNhbGMubQoKCQkJdmFyIGNvcyA9IE1hdGguY29zOwoJCQl2YXIgc2luID0gTWF0aC5zaW47CgoJCQl2YXIgYzEgPSBjb3MoIHggLyAyICk7CgkJCXZhciBjMiA9IGNvcyggeSAvIDIgKTsKCQkJdmFyIGMzID0gY29zKCB6IC8gMiApOwoKCQkJdmFyIHMxID0gc2luKCB4IC8gMiApOwoJCQl2YXIgczIgPSBzaW4oIHkgLyAyICk7CgkJCXZhciBzMyA9IHNpbiggeiAvIDIgKTsKCgkJCWlmICggb3JkZXIgPT09ICdYWVonICkgewoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgoJCQl9IGVsc2UgaWYgKCBvcmRlciA9PT0gJ1lYWicgKSB7CgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWlhZJyApIHsKCgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwoKCQkJfSBlbHNlIGlmICggb3JkZXIgPT09ICdaWVgnICkgewoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CgoJCQl9IGVsc2UgaWYgKCBvcmRlciA9PT0gJ1laWCcgKSB7CgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWFpZJyApIHsKCgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwoKCQkJfQoKCQkJaWYgKCB1cGRhdGUgIT09IGZhbHNlICkgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbUF4aXNBbmdsZTogZnVuY3Rpb24gKCBheGlzLCBhbmdsZSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9hbmdsZVRvUXVhdGVybmlvbi9pbmRleC5odG0KCgkJCS8vIGFzc3VtZXMgYXhpcyBpcyBub3JtYWxpemVkCgoJCQl2YXIgaGFsZkFuZ2xlID0gYW5nbGUgLyAyLCBzID0gTWF0aC5zaW4oIGhhbGZBbmdsZSApOwoKCQkJdGhpcy5feCA9IGF4aXMueCAqIHM7CgkJCXRoaXMuX3kgPSBheGlzLnkgKiBzOwoJCQl0aGlzLl96ID0gYXhpcy56ICogczsKCQkJdGhpcy5fdyA9IE1hdGguY29zKCBoYWxmQW5nbGUgKTsKCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21Sb3RhdGlvbk1hdHJpeDogZnVuY3Rpb24gKCBtICkgewoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvUXVhdGVybmlvbi9pbmRleC5odG0KCgkJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgoJCQl2YXIgdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF0sCgoJCQkJdHJhY2UgPSBtMTEgKyBtMjIgKyBtMzMsCgkJCQlzOwoKCQkJaWYgKCB0cmFjZSA+IDAgKSB7CgoJCQkJcyA9IDAuNSAvIE1hdGguc3FydCggdHJhY2UgKyAxLjAgKTsKCgkJCQl0aGlzLl93ID0gMC4yNSAvIHM7CgkJCQl0aGlzLl94ID0gKCBtMzIgLSBtMjMgKSAqIHM7CgkJCQl0aGlzLl95ID0gKCBtMTMgLSBtMzEgKSAqIHM7CgkJCQl0aGlzLl96ID0gKCBtMjEgLSBtMTIgKSAqIHM7CgoJCQl9IGVsc2UgaWYgKCBtMTEgPiBtMjIgJiYgbTExID4gbTMzICkgewoKCQkJCXMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0xMSAtIG0yMiAtIG0zMyApOwoKCQkJCXRoaXMuX3cgPSAoIG0zMiAtIG0yMyApIC8gczsKCQkJCXRoaXMuX3ggPSAwLjI1ICogczsKCQkJCXRoaXMuX3kgPSAoIG0xMiArIG0yMSApIC8gczsKCQkJCXRoaXMuX3ogPSAoIG0xMyArIG0zMSApIC8gczsKCgkJCX0gZWxzZSBpZiAoIG0yMiA+IG0zMyApIHsKCgkJCQlzID0gMi4wICogTWF0aC5zcXJ0KCAxLjAgKyBtMjIgLSBtMTEgLSBtMzMgKTsKCgkJCQl0aGlzLl93ID0gKCBtMTMgLSBtMzEgKSAvIHM7CgkJCQl0aGlzLl94ID0gKCBtMTIgKyBtMjEgKSAvIHM7CgkJCQl0aGlzLl95ID0gMC4yNSAqIHM7CgkJCQl0aGlzLl96ID0gKCBtMjMgKyBtMzIgKSAvIHM7CgoJCQl9IGVsc2UgewoKCQkJCXMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0zMyAtIG0xMSAtIG0yMiApOwoKCQkJCXRoaXMuX3cgPSAoIG0yMSAtIG0xMiApIC8gczsKCQkJCXRoaXMuX3ggPSAoIG0xMyArIG0zMSApIC8gczsKCQkJCXRoaXMuX3kgPSAoIG0yMyArIG0zMiApIC8gczsKCQkJCXRoaXMuX3ogPSAwLjI1ICogczsKCgkJCX0KCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21Vbml0VmVjdG9yczogZnVuY3Rpb24gKCkgewoKCQkJLy8gYXNzdW1lcyBkaXJlY3Rpb24gdmVjdG9ycyB2RnJvbSBhbmQgdlRvIGFyZSBub3JtYWxpemVkCgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgcjsKCgkJCXZhciBFUFMgPSAwLjAwMDAwMTsKCgkJCXJldHVybiBmdW5jdGlvbiBzZXRGcm9tVW5pdFZlY3RvcnMoIHZGcm9tLCB2VG8gKSB7CgoJCQkJaWYgKCB2MSA9PT0gdW5kZWZpbmVkICkgdjEgPSBuZXcgVmVjdG9yMygpOwoKCQkJCXIgPSB2RnJvbS5kb3QoIHZUbyApICsgMTsKCgkJCQlpZiAoIHIgPCBFUFMgKSB7CgoJCQkJCXIgPSAwOwoKCQkJCQlpZiAoIE1hdGguYWJzKCB2RnJvbS54ICkgPiBNYXRoLmFicyggdkZyb20ueiApICkgewoKCQkJCQkJdjEuc2V0KCAtIHZGcm9tLnksIHZGcm9tLngsIDAgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXYxLnNldCggMCwgLSB2RnJvbS56LCB2RnJvbS55ICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQl2MS5jcm9zc1ZlY3RvcnMoIHZGcm9tLCB2VG8gKTsKCgkJCQl9CgoJCQkJdGhpcy5feCA9IHYxLng7CgkJCQl0aGlzLl95ID0gdjEueTsKCQkJCXRoaXMuX3ogPSB2MS56OwoJCQkJdGhpcy5fdyA9IHI7CgoJCQkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgoJCQl9OwoKCQl9KCksCgoJCWFuZ2xlVG86IGZ1bmN0aW9uICggcSApIHsKCgkJCXJldHVybiAyICogTWF0aC5hY29zKCBNYXRoLmFicyggX01hdGguY2xhbXAoIHRoaXMuZG90KCBxICksIC0gMSwgMSApICkgKTsKCgkJfSwKCgkJcm90YXRlVG93YXJkczogZnVuY3Rpb24gKCBxLCBzdGVwICkgewoKCQkJdmFyIGFuZ2xlID0gdGhpcy5hbmdsZVRvKCBxICk7CgoJCQlpZiAoIGFuZ2xlID09PSAwICkgcmV0dXJuIHRoaXM7CgoJCQl2YXIgdCA9IE1hdGgubWluKCAxLCBzdGVwIC8gYW5nbGUgKTsKCgkJCXRoaXMuc2xlcnAoIHEsIHQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlpbnZlcnNlOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBxdWF0ZXJuaW9uIGlzIGFzc3VtZWQgdG8gaGF2ZSB1bml0IGxlbmd0aAoKCQkJcmV0dXJuIHRoaXMuY29uanVnYXRlKCk7CgoJCX0sCgoJCWNvbmp1Z2F0ZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5feCAqPSAtIDE7CgkJCXRoaXMuX3kgKj0gLSAxOwoJCQl0aGlzLl96ICo9IC0gMTsKCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRvdDogZnVuY3Rpb24gKCB2ICkgewoKCQkJcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwoKCQl9LAoKCQlsZW5ndGhTcTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93OwoKCQl9LAoKCQlsZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93ICk7CgoJCX0sCgoJCW5vcm1hbGl6ZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGwgPSB0aGlzLmxlbmd0aCgpOwoKCQkJaWYgKCBsID09PSAwICkgewoKCQkJCXRoaXMuX3ggPSAwOwoJCQkJdGhpcy5feSA9IDA7CgkJCQl0aGlzLl96ID0gMDsKCQkJCXRoaXMuX3cgPSAxOwoKCQkJfSBlbHNlIHsKCgkJCQlsID0gMSAvIGw7CgoJCQkJdGhpcy5feCA9IHRoaXMuX3ggKiBsOwoJCQkJdGhpcy5feSA9IHRoaXMuX3kgKiBsOwoJCQkJdGhpcy5feiA9IHRoaXMuX3ogKiBsOwoJCQkJdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwoKCQkJfQoKCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbXVsdGlwbHk6IGZ1bmN0aW9uICggcSwgcCApIHsKCgkJCWlmICggcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5UXVhdGVybmlvbnMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHEsIHAgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHRoaXMsIHEgKTsKCgkJfSwKCgkJcHJlbXVsdGlwbHk6IGZ1bmN0aW9uICggcSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHEsIHRoaXMgKTsKCgkJfSwKCgkJbXVsdGlwbHlRdWF0ZXJuaW9uczogZnVuY3Rpb24gKCBhLCBiICkgewoKCQkJLy8gZnJvbSBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL3JlYWxOb3JtZWRBbGdlYnJhL3F1YXRlcm5pb25zL2NvZGUvaW5kZXguaHRtCgoJCQl2YXIgcWF4ID0gYS5feCwgcWF5ID0gYS5feSwgcWF6ID0gYS5feiwgcWF3ID0gYS5fdzsKCQkJdmFyIHFieCA9IGIuX3gsIHFieSA9IGIuX3ksIHFieiA9IGIuX3osIHFidyA9IGIuX3c7CgoJCQl0aGlzLl94ID0gcWF4ICogcWJ3ICsgcWF3ICogcWJ4ICsgcWF5ICogcWJ6IC0gcWF6ICogcWJ5OwoJCQl0aGlzLl95ID0gcWF5ICogcWJ3ICsgcWF3ICogcWJ5ICsgcWF6ICogcWJ4IC0gcWF4ICogcWJ6OwoJCQl0aGlzLl96ID0gcWF6ICogcWJ3ICsgcWF3ICogcWJ6ICsgcWF4ICogcWJ5IC0gcWF5ICogcWJ4OwoJCQl0aGlzLl93ID0gcWF3ICogcWJ3IC0gcWF4ICogcWJ4IC0gcWF5ICogcWJ5IC0gcWF6ICogcWJ6OwoKCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2xlcnA6IGZ1bmN0aW9uICggcWIsIHQgKSB7CgoJCQlpZiAoIHQgPT09IDAgKSByZXR1cm4gdGhpczsKCQkJaWYgKCB0ID09PSAxICkgcmV0dXJuIHRoaXMuY29weSggcWIgKTsKCgkJCXZhciB4ID0gdGhpcy5feCwgeSA9IHRoaXMuX3ksIHogPSB0aGlzLl96LCB3ID0gdGhpcy5fdzsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2FsZ2VicmEvcmVhbE5vcm1lZEFsZ2VicmEvcXVhdGVybmlvbnMvc2xlcnAvCgoJCQl2YXIgY29zSGFsZlRoZXRhID0gdyAqIHFiLl93ICsgeCAqIHFiLl94ICsgeSAqIHFiLl95ICsgeiAqIHFiLl96OwoKCQkJaWYgKCBjb3NIYWxmVGhldGEgPCAwICkgewoKCQkJCXRoaXMuX3cgPSAtIHFiLl93OwoJCQkJdGhpcy5feCA9IC0gcWIuX3g7CgkJCQl0aGlzLl95ID0gLSBxYi5feTsKCQkJCXRoaXMuX3ogPSAtIHFiLl96OwoKCQkJCWNvc0hhbGZUaGV0YSA9IC0gY29zSGFsZlRoZXRhOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLmNvcHkoIHFiICk7CgoJCQl9CgoJCQlpZiAoIGNvc0hhbGZUaGV0YSA+PSAxLjAgKSB7CgoJCQkJdGhpcy5fdyA9IHc7CgkJCQl0aGlzLl94ID0geDsKCQkJCXRoaXMuX3kgPSB5OwoJCQkJdGhpcy5feiA9IHo7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQl2YXIgc3FyU2luSGFsZlRoZXRhID0gMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhOwoKCQkJaWYgKCBzcXJTaW5IYWxmVGhldGEgPD0gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJdmFyIHMgPSAxIC0gdDsKCQkJCXRoaXMuX3cgPSBzICogdyArIHQgKiB0aGlzLl93OwoJCQkJdGhpcy5feCA9IHMgKiB4ICsgdCAqIHRoaXMuX3g7CgkJCQl0aGlzLl95ID0gcyAqIHkgKyB0ICogdGhpcy5feTsKCQkJCXRoaXMuX3ogPSBzICogeiArIHQgKiB0aGlzLl96OwoKCQkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKCQkJfQoKCQkJdmFyIHNpbkhhbGZUaGV0YSA9IE1hdGguc3FydCggc3FyU2luSGFsZlRoZXRhICk7CgkJCXZhciBoYWxmVGhldGEgPSBNYXRoLmF0YW4yKCBzaW5IYWxmVGhldGEsIGNvc0hhbGZUaGV0YSApOwoJCQl2YXIgcmF0aW9BID0gTWF0aC5zaW4oICggMSAtIHQgKSAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhLAoJCQkJcmF0aW9CID0gTWF0aC5zaW4oIHQgKiBoYWxmVGhldGEgKSAvIHNpbkhhbGZUaGV0YTsKCgkJCXRoaXMuX3cgPSAoIHcgKiByYXRpb0EgKyB0aGlzLl93ICogcmF0aW9CICk7CgkJCXRoaXMuX3ggPSAoIHggKiByYXRpb0EgKyB0aGlzLl94ICogcmF0aW9CICk7CgkJCXRoaXMuX3kgPSAoIHkgKiByYXRpb0EgKyB0aGlzLl95ICogcmF0aW9CICk7CgkJCXRoaXMuX3ogPSAoIHogKiByYXRpb0EgKyB0aGlzLl96ICogcmF0aW9CICk7CgoJCQl0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQllcXVhbHM6IGZ1bmN0aW9uICggcXVhdGVybmlvbiApIHsKCgkJCXJldHVybiAoIHF1YXRlcm5pb24uX3ggPT09IHRoaXMuX3ggKSAmJiAoIHF1YXRlcm5pb24uX3kgPT09IHRoaXMuX3kgKSAmJiAoIHF1YXRlcm5pb24uX3ogPT09IHRoaXMuX3ogKSAmJiAoIHF1YXRlcm5pb24uX3cgPT09IHRoaXMuX3cgKTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCXRoaXMuX3ggPSBhcnJheVsgb2Zmc2V0IF07CgkJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCQl0aGlzLl96ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy5fdyA9IGFycmF5WyBvZmZzZXQgKyAzIF07CgoJCQl0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0FycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIGFycmF5ID09PSB1bmRlZmluZWQgKSBhcnJheSA9IFtdOwoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMuX3g7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwoJCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKCQkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMuX3c7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0sCgoJCW9uQ2hhbmdlOiBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJb25DaGFuZ2VDYWxsYmFjazogZnVuY3Rpb24gKCkge30KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBraWxlIC8gaHR0cDovL2tpbGUuc3RyYXZhZ2FuemEub3JnLwoJICogQGF1dGhvciBwaGlsb2diIC8gaHR0cDovL2Jsb2cudGhlaml0Lm9yZy8KCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIGVncmFldGhlciAvIGh0dHA6Ly9lZ3JhZXRoZXIuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKi8KCglmdW5jdGlvbiBWZWN0b3IzKCB4LCB5LCB6ICkgewoKCQl0aGlzLnggPSB4IHx8IDA7CgkJdGhpcy55ID0geSB8fCAwOwoJCXRoaXMueiA9IHogfHwgMDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggVmVjdG9yMy5wcm90b3R5cGUsIHsKCgkJaXNWZWN0b3IzOiB0cnVlLAoKCQlzZXQ6IGZ1bmN0aW9uICggeCwgeSwgeiApIHsKCgkJCXRoaXMueCA9IHg7CgkJCXRoaXMueSA9IHk7CgkJCXRoaXMueiA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0U2NhbGFyOiBmdW5jdGlvbiAoIHNjYWxhciApIHsKCgkJCXRoaXMueCA9IHNjYWxhcjsKCQkJdGhpcy55ID0gc2NhbGFyOwoJCQl0aGlzLnogPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WDogZnVuY3Rpb24gKCB4ICkgewoKCQkJdGhpcy54ID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRZOiBmdW5jdGlvbiAoIHkgKSB7CgoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFo6IGZ1bmN0aW9uICggeiApIHsKCgkJCXRoaXMueiA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0Q29tcG9uZW50OiBmdW5jdGlvbiAoIGluZGV4LCB2YWx1ZSApIHsKCgkJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAxOiB0aGlzLnkgPSB2YWx1ZTsgYnJlYWs7CgkJCQljYXNlIDI6IHRoaXMueiA9IHZhbHVlOyBicmVhazsKCQkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0Q29tcG9uZW50OiBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwoJCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnksIHRoaXMueiApOwoKCQl9LAoKCQljb3B5OiBmdW5jdGlvbiAoIHYgKSB7CgoJCQl0aGlzLnggPSB2Lng7CgkJCXRoaXMueSA9IHYueTsKCQkJdGhpcy56ID0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFkZDogZnVuY3Rpb24gKCB2LCB3ICkgewoKCQkJaWYgKCB3ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMzogLmFkZCgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLmFkZFZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLmFkZFZlY3RvcnMoIHYsIHcgKTsKCgkJCX0KCgkJCXRoaXMueCArPSB2Lng7CgkJCXRoaXMueSArPSB2Lnk7CgkJCXRoaXMueiArPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkU2NhbGFyOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQl0aGlzLnggKz0gczsKCQkJdGhpcy55ICs9IHM7CgkJCXRoaXMueiArPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFkZFZlY3RvcnM6IGZ1bmN0aW9uICggYSwgYiApIHsKCgkJCXRoaXMueCA9IGEueCArIGIueDsKCQkJdGhpcy55ID0gYS55ICsgYi55OwoJCQl0aGlzLnogPSBhLnogKyBiLno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkU2NhbGVkVmVjdG9yOiBmdW5jdGlvbiAoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgkJCXRoaXMueiArPSB2LnogKiBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXN1YjogZnVuY3Rpb24gKCB2LCB3ICkgewoKCQkJaWYgKCB3ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMzogLnN1YigpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLnN1YlZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLnN1YlZlY3RvcnMoIHYsIHcgKTsKCgkJCX0KCgkJCXRoaXMueCAtPSB2Lng7CgkJCXRoaXMueSAtPSB2Lnk7CgkJCXRoaXMueiAtPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc3ViU2NhbGFyOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgkJCXRoaXMueiAtPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXN1YlZlY3RvcnM6IGZ1bmN0aW9uICggYSwgYiApIHsKCgkJCXRoaXMueCA9IGEueCAtIGIueDsKCQkJdGhpcy55ID0gYS55IC0gYi55OwoJCQl0aGlzLnogPSBhLnogLSBiLno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbXVsdGlwbHk6IGZ1bmN0aW9uICggdiwgdyApIHsKCgkJCWlmICggdyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjM6IC5tdWx0aXBseSgpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLm11bHRpcGx5VmVjdG9ycyggYSwgYiApIGluc3RlYWQuJyApOwoJCQkJcmV0dXJuIHRoaXMubXVsdGlwbHlWZWN0b3JzKCB2LCB3ICk7CgoJCQl9CgoJCQl0aGlzLnggKj0gdi54OwoJCQl0aGlzLnkgKj0gdi55OwoJCQl0aGlzLnogKj0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbiAoIHNjYWxhciApIHsKCgkJCXRoaXMueCAqPSBzY2FsYXI7CgkJCXRoaXMueSAqPSBzY2FsYXI7CgkJCXRoaXMueiAqPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbXVsdGlwbHlWZWN0b3JzOiBmdW5jdGlvbiAoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKiBiLng7CgkJCXRoaXMueSA9IGEueSAqIGIueTsKCQkJdGhpcy56ID0gYS56ICogYi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFwcGx5RXVsZXI6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCgkJCXJldHVybiBmdW5jdGlvbiBhcHBseUV1bGVyKCBldWxlciApIHsKCgkJCQlpZiAoICEgKCBldWxlciAmJiBldWxlci5pc0V1bGVyICkgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5WZWN0b3IzOiAuYXBwbHlFdWxlcigpIG5vdyBleHBlY3RzIGFuIEV1bGVyIHJvdGF0aW9uIHJhdGhlciB0aGFuIGEgVmVjdG9yMyBhbmQgb3JkZXIuJyApOwoKCQkJCX0KCgkJCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIHF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKCBldWxlciApICk7CgoJCQl9OwoKCQl9KCksCgoJCWFwcGx5QXhpc0FuZ2xlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgcXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gYXBwbHlBeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICkgewoKCQkJCXJldHVybiB0aGlzLmFwcGx5UXVhdGVybmlvbiggcXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApICk7CgoJCQl9OwoKCQl9KCksCgoJCWFwcGx5TWF0cml4MzogZnVuY3Rpb24gKCBtICkgewoKCQkJdmFyIHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCXZhciBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyAzIF0gKiB5ICsgZVsgNiBdICogejsKCQkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA3IF0gKiB6OwoJCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNSBdICogeSArIGVbIDggXSAqIHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYXBwbHlNYXRyaXg0OiBmdW5jdGlvbiAoIG0gKSB7CgoJCQl2YXIgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQkJdmFyIGUgPSBtLmVsZW1lbnRzOwoKCQkJdmFyIHcgPSAxIC8gKCBlWyAzIF0gKiB4ICsgZVsgNyBdICogeSArIGVbIDExIF0gKiB6ICsgZVsgMTUgXSApOwoKCQkJdGhpcy54ID0gKCBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHogKyBlWyAxMiBdICkgKiB3OwoJCQl0aGlzLnkgPSAoIGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogeiArIGVbIDEzIF0gKSAqIHc7CgkJCXRoaXMueiA9ICggZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogeiArIGVbIDE0IF0gKSAqIHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYXBwbHlRdWF0ZXJuaW9uOiBmdW5jdGlvbiAoIHEgKSB7CgoJCQl2YXIgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQkJdmFyIHF4ID0gcS54LCBxeSA9IHEueSwgcXogPSBxLnosIHF3ID0gcS53OwoKCQkJLy8gY2FsY3VsYXRlIHF1YXQgKiB2ZWN0b3IKCgkJCXZhciBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKCQkJdmFyIGl5ID0gcXcgKiB5ICsgcXogKiB4IC0gcXggKiB6OwoJCQl2YXIgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CgkJCXZhciBpdyA9IC0gcXggKiB4IC0gcXkgKiB5IC0gcXogKiB6OwoKCQkJLy8gY2FsY3VsYXRlIHJlc3VsdCAqIGludmVyc2UgcXVhdAoKCQkJdGhpcy54ID0gaXggKiBxdyArIGl3ICogLSBxeCArIGl5ICogLSBxeiAtIGl6ICogLSBxeTsKCQkJdGhpcy55ID0gaXkgKiBxdyArIGl3ICogLSBxeSArIGl6ICogLSBxeCAtIGl4ICogLSBxejsKCQkJdGhpcy56ID0gaXogKiBxdyArIGl3ICogLSBxeiArIGl4ICogLSBxeSAtIGl5ICogLSBxeDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlwcm9qZWN0OiBmdW5jdGlvbiAoIGNhbWVyYSApIHsKCgkJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4NCggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApLmFwcGx5TWF0cml4NCggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCgkJfSwKCgkJdW5wcm9qZWN0OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgbWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiB1bnByb2plY3QoIGNhbWVyYSApIHsKCgkJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIG1hdHJpeC5nZXRJbnZlcnNlKCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApICkuYXBwbHlNYXRyaXg0KCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgkJCX07CgoJCX0oKSwKCgkJdHJhbnNmb3JtRGlyZWN0aW9uOiBmdW5jdGlvbiAoIG0gKSB7CgoJCQkvLyBpbnB1dDogVEhSRUUuTWF0cml4NCBhZmZpbmUgbWF0cml4CgkJCS8vIHZlY3RvciBpbnRlcnByZXRlZCBhcyBhIGRpcmVjdGlvbgoKCQkJdmFyIHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCXZhciBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogejsKCQkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6OwoJCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6OwoKCQkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgoJCX0sCgoJCWRpdmlkZTogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCQkJdGhpcy56IC89IHYuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlkaXZpZGVTY2FsYXI6IGZ1bmN0aW9uICggc2NhbGFyICkgewoKCQkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCgkJfSwKCgkJbWluOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW1heDogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5tYXgoIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWF4KCB0aGlzLnksIHYueSApOwoJCQl0aGlzLnogPSBNYXRoLm1heCggdGhpcy56LCB2LnogKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljbGFtcDogZnVuY3Rpb24gKCBtaW4sIG1heCApIHsKCgkJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgoJCQl0aGlzLnggPSBNYXRoLm1heCggbWluLngsIE1hdGgubWluKCBtYXgueCwgdGhpcy54ICkgKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIG1pbi55LCBNYXRoLm1pbiggbWF4LnksIHRoaXMueSApICk7CgkJCXRoaXMueiA9IE1hdGgubWF4KCBtaW4ueiwgTWF0aC5taW4oIG1heC56LCB0aGlzLnogKSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsYW1wU2NhbGFyOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgbWluID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG1heCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKCQkJCW1pbi5zZXQoIG1pblZhbCwgbWluVmFsLCBtaW5WYWwgKTsKCQkJCW1heC5zZXQoIG1heFZhbCwgbWF4VmFsLCBtYXhWYWwgKTsKCgkJCQlyZXR1cm4gdGhpcy5jbGFtcCggbWluLCBtYXggKTsKCgkJCX07CgoJCX0oKSwKCgkJY2xhbXBMZW5ndGg6IGZ1bmN0aW9uICggbWluLCBtYXggKSB7CgoJCQl2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG1heCwgbGVuZ3RoICkgKSApOwoKCQl9LAoKCQlmbG9vcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmZsb29yKCB0aGlzLnogKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljZWlsOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXJvdW5kOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXJvdW5kVG9aZXJvOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSAoIHRoaXMueCA8IDAgKSA/IE1hdGguY2VpbCggdGhpcy54ICkgOiBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gKCB0aGlzLnkgPCAwICkgPyBNYXRoLmNlaWwoIHRoaXMueSApIDogTWF0aC5mbG9vciggdGhpcy55ICk7CgkJCXRoaXMueiA9ICggdGhpcy56IDwgMCApID8gTWF0aC5jZWlsKCB0aGlzLnogKSA6IE1hdGguZmxvb3IoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW5lZ2F0ZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gLSB0aGlzLng7CgkJCXRoaXMueSA9IC0gdGhpcy55OwoJCQl0aGlzLnogPSAtIHRoaXMuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlkb3Q6IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2Lno7CgoJCX0sCgoJCS8vIFRPRE8gbGVuZ3RoU3F1YXJlZD8KCgkJbGVuZ3RoU3E6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgoJCX0sCgoJCWxlbmd0aDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICk7CgoJCX0sCgoJCW1hbmhhdHRhbkxlbmd0aDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKSArIE1hdGguYWJzKCB0aGlzLnogKTsKCgkJfSwKCgkJbm9ybWFsaXplOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIHRoaXMubGVuZ3RoKCkgfHwgMSApOwoKCQl9LAoKCQlzZXRMZW5ndGg6IGZ1bmN0aW9uICggbGVuZ3RoICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCQl9LAoKCQlsZXJwOiBmdW5jdGlvbiAoIHYsIGFscGhhICkgewoKCQkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCQkJdGhpcy56ICs9ICggdi56IC0gdGhpcy56ICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlsZXJwVmVjdG9yczogZnVuY3Rpb24gKCB2MSwgdjIsIGFscGhhICkgewoKCQkJcmV0dXJuIHRoaXMuc3ViVmVjdG9ycyggdjIsIHYxICkubXVsdGlwbHlTY2FsYXIoIGFscGhhICkuYWRkKCB2MSApOwoKCQl9LAoKCQljcm9zczogZnVuY3Rpb24gKCB2LCB3ICkgewoKCQkJaWYgKCB3ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMzogLmNyb3NzKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuY3Jvc3NWZWN0b3JzKCBhLCBiICkgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdGhpcy5jcm9zc1ZlY3RvcnMoIHYsIHcgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLmNyb3NzVmVjdG9ycyggdGhpcywgdiApOwoKCQl9LAoKCQljcm9zc1ZlY3RvcnM6IGZ1bmN0aW9uICggYSwgYiApIHsKCgkJCXZhciBheCA9IGEueCwgYXkgPSBhLnksIGF6ID0gYS56OwoJCQl2YXIgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKCgkJCXRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwoJCQl0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKCQkJdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJcHJvamVjdE9uVmVjdG9yOiBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJCXZhciBzY2FsYXIgPSB2ZWN0b3IuZG90KCB0aGlzICkgLyB2ZWN0b3IubGVuZ3RoU3EoKTsKCgkJCXJldHVybiB0aGlzLmNvcHkoIHZlY3RvciApLm11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKTsKCgkJfSwKCgkJcHJvamVjdE9uUGxhbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcHJvamVjdE9uUGxhbmUoIHBsYW5lTm9ybWFsICkgewoKCQkJCXYxLmNvcHkoIHRoaXMgKS5wcm9qZWN0T25WZWN0b3IoIHBsYW5lTm9ybWFsICk7CgoJCQkJcmV0dXJuIHRoaXMuc3ViKCB2MSApOwoKCQkJfTsKCgkJfSgpLAoKCQlyZWZsZWN0OiBmdW5jdGlvbiAoKSB7CgoJCQkvLyByZWZsZWN0IGluY2lkZW50IHZlY3RvciBvZmYgcGxhbmUgb3J0aG9nb25hbCB0byBub3JtYWwKCQkJLy8gbm9ybWFsIGlzIGFzc3VtZWQgdG8gaGF2ZSB1bml0IGxlbmd0aAoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiByZWZsZWN0KCBub3JtYWwgKSB7CgoJCQkJcmV0dXJuIHRoaXMuc3ViKCB2MS5jb3B5KCBub3JtYWwgKS5tdWx0aXBseVNjYWxhciggMiAqIHRoaXMuZG90KCBub3JtYWwgKSApICk7CgoJCQl9OwoKCQl9KCksCgoJCWFuZ2xlVG86IGZ1bmN0aW9uICggdiApIHsKCgkJCXZhciB0aGV0YSA9IHRoaXMuZG90KCB2ICkgLyAoIE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICkgKTsKCgkJCS8vIGNsYW1wLCB0byBoYW5kbGUgbnVtZXJpY2FsIHByb2JsZW1zCgoJCQlyZXR1cm4gTWF0aC5hY29zKCBfTWF0aC5jbGFtcCggdGhldGEsIC0gMSwgMSApICk7CgoJCX0sCgoJCWRpc3RhbmNlVG86IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSApOwoKCQl9LAoKCQlkaXN0YW5jZVRvU3F1YXJlZDogZnVuY3Rpb24gKCB2ICkgewoKCQkJdmFyIGR4ID0gdGhpcy54IC0gdi54LCBkeSA9IHRoaXMueSAtIHYueSwgZHogPSB0aGlzLnogLSB2Lno7CgoJCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHkgKyBkeiAqIGR6OwoKCQl9LAoKCQltYW5oYXR0YW5EaXN0YW5jZVRvOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCAtIHYueCApICsgTWF0aC5hYnMoIHRoaXMueSAtIHYueSApICsgTWF0aC5hYnMoIHRoaXMueiAtIHYueiApOwoKCQl9LAoKCQlzZXRGcm9tU3BoZXJpY2FsOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tU3BoZXJpY2FsQ29vcmRzKCBzLnJhZGl1cywgcy5waGksIHMudGhldGEgKTsKCgkJfSwKCgkJc2V0RnJvbVNwaGVyaWNhbENvb3JkczogZnVuY3Rpb24gKCByYWRpdXMsIHBoaSwgdGhldGEgKSB7CgoJCQl2YXIgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4oIHBoaSApICogcmFkaXVzOwoKCQkJdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CgkJCXRoaXMueSA9IE1hdGguY29zKCBwaGkgKSAqIHJhZGl1czsKCQkJdGhpcy56ID0gc2luUGhpUmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbUN5bGluZHJpY2FsOiBmdW5jdGlvbiAoIGMgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHMoIGMucmFkaXVzLCBjLnRoZXRhLCBjLnkgKTsKCgkJfSwKCgkJc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzOiBmdW5jdGlvbiAoIHJhZGl1cywgdGhldGEsIHkgKSB7CgoJCQl0aGlzLnggPSByYWRpdXMgKiBNYXRoLnNpbiggdGhldGEgKTsKCQkJdGhpcy55ID0geTsKCQkJdGhpcy56ID0gcmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbU1hdHJpeFBvc2l0aW9uOiBmdW5jdGlvbiAoIG0gKSB7CgoJCQl2YXIgZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnggPSBlWyAxMiBdOwoJCQl0aGlzLnkgPSBlWyAxMyBdOwoJCQl0aGlzLnogPSBlWyAxNCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21NYXRyaXhTY2FsZTogZnVuY3Rpb24gKCBtICkgewoKCQkJdmFyIHN4ID0gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJCXZhciBzeSA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMSApLmxlbmd0aCgpOwoJCQl2YXIgc3ogPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDIgKS5sZW5ndGgoKTsKCgkJCXRoaXMueCA9IHN4OwoJCQl0aGlzLnkgPSBzeTsKCQkJdGhpcy56ID0gc3o7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbU1hdHJpeENvbHVtbjogZnVuY3Rpb24gKCBtLCBpbmRleCApIHsKCgkJCXJldHVybiB0aGlzLmZyb21BcnJheSggbS5lbGVtZW50cywgaW5kZXggKiA0ICk7CgoJCX0sCgoJCWVxdWFsczogZnVuY3Rpb24gKCB2ICkgewoKCQkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSAmJiAoIHYueiA9PT0gdGhpcy56ICkgKTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0FycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIGFycmF5ID09PSB1bmRlZmluZWQgKSBhcnJheSA9IFtdOwoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMueDsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKCgkJCXJldHVybiBhcnJheTsKCgkJfSwKCgkJZnJvbUJ1ZmZlckF0dHJpYnV0ZTogZnVuY3Rpb24gKCBhdHRyaWJ1dGUsIGluZGV4LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjM6IG9mZnNldCBoYXMgYmVlbiByZW1vdmVkIGZyb20gLmZyb21CdWZmZXJBdHRyaWJ1dGUoKS4nICk7CgoJCQl9CgoJCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBNYXRyaXgzKCkgewoKCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJMSwgMCwgMCwKCQkJMCwgMSwgMCwKCQkJMCwgMCwgMQoKCQldOwoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAwICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk1hdHJpeDM6IHRoZSBjb25zdHJ1Y3RvciBubyBsb25nZXIgcmVhZHMgYXJndW1lbnRzLiB1c2UgLnNldCgpIGluc3RlYWQuJyApOwoKCQl9CgoJfQoKCU9iamVjdC5hc3NpZ24oIE1hdHJpeDMucHJvdG90eXBlLCB7CgoJCWlzTWF0cml4MzogdHJ1ZSwKCgkJc2V0OiBmdW5jdGlvbiAoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSA9IG4xMTsgdGVbIDEgXSA9IG4yMTsgdGVbIDIgXSA9IG4zMTsKCQkJdGVbIDMgXSA9IG4xMjsgdGVbIDQgXSA9IG4yMjsgdGVbIDUgXSA9IG4zMjsKCQkJdGVbIDYgXSA9IG4xMzsgdGVbIDcgXSA9IG4yMzsgdGVbIDggXSA9IG4zMzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlpZGVudGl0eTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgMCwKCQkJCTAsIDEsIDAsCgkJCQkwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5mcm9tQXJyYXkoIHRoaXMuZWxlbWVudHMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBtICkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCQkJdmFyIG1lID0gbS5lbGVtZW50czsKCgkJCXRlWyAwIF0gPSBtZVsgMCBdOyB0ZVsgMSBdID0gbWVbIDEgXTsgdGVbIDIgXSA9IG1lWyAyIF07CgkJCXRlWyAzIF0gPSBtZVsgMyBdOyB0ZVsgNCBdID0gbWVbIDQgXTsgdGVbIDUgXSA9IG1lWyA1IF07CgkJCXRlWyA2IF0gPSBtZVsgNiBdOyB0ZVsgNyBdID0gbWVbIDcgXTsgdGVbIDggXSA9IG1lWyA4IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbU1hdHJpeDQ6IGZ1bmN0aW9uICggbSApIHsKCgkJCXZhciBtZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnNldCgKCgkJCQltZVsgMCBdLCBtZVsgNCBdLCBtZVsgOCBdLAoJCQkJbWVbIDEgXSwgbWVbIDUgXSwgbWVbIDkgXSwKCQkJCW1lWyAyIF0sIG1lWyA2IF0sIG1lWyAxMCBdCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFwcGx5VG9CdWZmZXJBdHRyaWJ1dGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlICkgewoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGF0dHJpYnV0ZS5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXYxLnggPSBhdHRyaWJ1dGUuZ2V0WCggaSApOwoJCQkJCXYxLnkgPSBhdHRyaWJ1dGUuZ2V0WSggaSApOwoJCQkJCXYxLnogPSBhdHRyaWJ1dGUuZ2V0WiggaSApOwoKCQkJCQl2MS5hcHBseU1hdHJpeDMoIHRoaXMgKTsKCgkJCQkJYXR0cmlidXRlLnNldFhZWiggaSwgdjEueCwgdjEueSwgdjEueiApOwoKCQkJCX0KCgkJCQlyZXR1cm4gYXR0cmlidXRlOwoKCQkJfTsKCgkJfSgpLAoKCQltdWx0aXBseTogZnVuY3Rpb24gKCBtICkgewoKCQkJcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyggdGhpcywgbSApOwoKCQl9LAoKCQlwcmVtdWx0aXBseTogZnVuY3Rpb24gKCBtICkgewoKCQkJcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyggbSwgdGhpcyApOwoKCQl9LAoKCQltdWx0aXBseU1hdHJpY2VzOiBmdW5jdGlvbiAoIGEsIGIgKSB7CgoJCQl2YXIgYWUgPSBhLmVsZW1lbnRzOwoJCQl2YXIgYmUgPSBiLmVsZW1lbnRzOwoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdmFyIGExMSA9IGFlWyAwIF0sIGExMiA9IGFlWyAzIF0sIGExMyA9IGFlWyA2IF07CgkJCXZhciBhMjEgPSBhZVsgMSBdLCBhMjIgPSBhZVsgNCBdLCBhMjMgPSBhZVsgNyBdOwoJCQl2YXIgYTMxID0gYWVbIDIgXSwgYTMyID0gYWVbIDUgXSwgYTMzID0gYWVbIDggXTsKCgkJCXZhciBiMTEgPSBiZVsgMCBdLCBiMTIgPSBiZVsgMyBdLCBiMTMgPSBiZVsgNiBdOwoJCQl2YXIgYjIxID0gYmVbIDEgXSwgYjIyID0gYmVbIDQgXSwgYjIzID0gYmVbIDcgXTsKCQkJdmFyIGIzMSA9IGJlWyAyIF0sIGIzMiA9IGJlWyA1IF0sIGIzMyA9IGJlWyA4IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxOwoJCQl0ZVsgMyBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwoJCQl0ZVsgNiBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzOwoKCQkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKCQkJdGVbIDQgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKCQkJdGVbIDcgXSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKCgkJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CgkJCXRlWyA1IF0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CgkJCXRlWyA4IF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbXVsdGlwbHlTY2FsYXI6IGZ1bmN0aW9uICggcyApIHsKCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0ZVsgMCBdICo9IHM7IHRlWyAzIF0gKj0gczsgdGVbIDYgXSAqPSBzOwoJCQl0ZVsgMSBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDcgXSAqPSBzOwoJCQl0ZVsgMiBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDggXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRldGVybWluYW50OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdmFyIGEgPSB0ZVsgMCBdLCBiID0gdGVbIDEgXSwgYyA9IHRlWyAyIF0sCgkJCQlkID0gdGVbIDMgXSwgZSA9IHRlWyA0IF0sIGYgPSB0ZVsgNSBdLAoJCQkJZyA9IHRlWyA2IF0sIGggPSB0ZVsgNyBdLCBpID0gdGVbIDggXTsKCgkJCXJldHVybiBhICogZSAqIGkgLSBhICogZiAqIGggLSBiICogZCAqIGkgKyBiICogZiAqIGcgKyBjICogZCAqIGggLSBjICogZSAqIGc7CgoJCX0sCgoJCWdldEludmVyc2U6IGZ1bmN0aW9uICggbWF0cml4LCB0aHJvd09uRGVnZW5lcmF0ZSApIHsKCgkJCWlmICggbWF0cml4ICYmIG1hdHJpeC5pc01hdHJpeDQgKSB7CgoJCQkJY29uc29sZS5lcnJvciggIlRIUkVFLk1hdHJpeDM6IC5nZXRJbnZlcnNlKCkgbm8gbG9uZ2VyIHRha2VzIGEgTWF0cml4NCBhcmd1bWVudC4iICk7CgoJCQl9CgoJCQl2YXIgbWUgPSBtYXRyaXguZWxlbWVudHMsCgkJCQl0ZSA9IHRoaXMuZWxlbWVudHMsCgoJCQkJbjExID0gbWVbIDAgXSwgbjIxID0gbWVbIDEgXSwgbjMxID0gbWVbIDIgXSwKCQkJCW4xMiA9IG1lWyAzIF0sIG4yMiA9IG1lWyA0IF0sIG4zMiA9IG1lWyA1IF0sCgkJCQluMTMgPSBtZVsgNiBdLCBuMjMgPSBtZVsgNyBdLCBuMzMgPSBtZVsgOCBdLAoKCQkJCXQxMSA9IG4zMyAqIG4yMiAtIG4zMiAqIG4yMywKCQkJCXQxMiA9IG4zMiAqIG4xMyAtIG4zMyAqIG4xMiwKCQkJCXQxMyA9IG4yMyAqIG4xMiAtIG4yMiAqIG4xMywKCgkJCQlkZXQgPSBuMTEgKiB0MTEgKyBuMjEgKiB0MTIgKyBuMzEgKiB0MTM7CgoJCQlpZiAoIGRldCA9PT0gMCApIHsKCgkJCQl2YXIgbXNnID0gIlRIUkVFLk1hdHJpeDM6IC5nZXRJbnZlcnNlKCkgY2FuJ3QgaW52ZXJ0IG1hdHJpeCwgZGV0ZXJtaW5hbnQgaXMgMCI7CgoJCQkJaWYgKCB0aHJvd09uRGVnZW5lcmF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJdGhyb3cgbmV3IEVycm9yKCBtc2cgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLndhcm4oIG1zZyApOwoKCQkJCX0KCgkJCQlyZXR1cm4gdGhpcy5pZGVudGl0eSgpOwoKCQkJfQoKCQkJdmFyIGRldEludiA9IDEgLyBkZXQ7CgoJCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCQl0ZVsgMSBdID0gKCBuMzEgKiBuMjMgLSBuMzMgKiBuMjEgKSAqIGRldEludjsKCQkJdGVbIDIgXSA9ICggbjMyICogbjIxIC0gbjMxICogbjIyICkgKiBkZXRJbnY7CgoJCQl0ZVsgMyBdID0gdDEyICogZGV0SW52OwoJCQl0ZVsgNCBdID0gKCBuMzMgKiBuMTEgLSBuMzEgKiBuMTMgKSAqIGRldEludjsKCQkJdGVbIDUgXSA9ICggbjMxICogbjEyIC0gbjMyICogbjExICkgKiBkZXRJbnY7CgoJCQl0ZVsgNiBdID0gdDEzICogZGV0SW52OwoJCQl0ZVsgNyBdID0gKCBuMjEgKiBuMTMgLSBuMjMgKiBuMTEgKSAqIGRldEludjsKCQkJdGVbIDggXSA9ICggbjIyICogbjExIC0gbjIxICogbjEyICkgKiBkZXRJbnY7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdHJhbnNwb3NlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdG1wLCBtID0gdGhpcy5lbGVtZW50czsKCgkJCXRtcCA9IG1bIDEgXTsgbVsgMSBdID0gbVsgMyBdOyBtWyAzIF0gPSB0bXA7CgkJCXRtcCA9IG1bIDIgXTsgbVsgMiBdID0gbVsgNiBdOyBtWyA2IF0gPSB0bXA7CgkJCXRtcCA9IG1bIDUgXTsgbVsgNSBdID0gbVsgNyBdOyBtWyA3IF0gPSB0bXA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0Tm9ybWFsTWF0cml4OiBmdW5jdGlvbiAoIG1hdHJpeDQgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4NCggbWF0cml4NCApLmdldEludmVyc2UoIHRoaXMgKS50cmFuc3Bvc2UoKTsKCgkJfSwKCgkJdHJhbnNwb3NlSW50b0FycmF5OiBmdW5jdGlvbiAoIHIgKSB7CgoJCQl2YXIgbSA9IHRoaXMuZWxlbWVudHM7CgoJCQlyWyAwIF0gPSBtWyAwIF07CgkJCXJbIDEgXSA9IG1bIDMgXTsKCQkJclsgMiBdID0gbVsgNiBdOwoJCQlyWyAzIF0gPSBtWyAxIF07CgkJCXJbIDQgXSA9IG1bIDQgXTsKCQkJclsgNSBdID0gbVsgNyBdOwoJCQlyWyA2IF0gPSBtWyAyIF07CgkJCXJbIDcgXSA9IG1bIDUgXTsKCQkJclsgOCBdID0gbVsgOCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFV2VHJhbnNmb3JtOiBmdW5jdGlvbiAoIHR4LCB0eSwgc3gsIHN5LCByb3RhdGlvbiwgY3gsIGN5ICkgewoKCQkJdmFyIGMgPSBNYXRoLmNvcyggcm90YXRpb24gKTsKCQkJdmFyIHMgPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCgkJCXRoaXMuc2V0KAoJCQkJc3ggKiBjLCBzeCAqIHMsIC0gc3ggKiAoIGMgKiBjeCArIHMgKiBjeSApICsgY3ggKyB0eCwKCQkJCS0gc3kgKiBzLCBzeSAqIGMsIC0gc3kgKiAoIC0gcyAqIGN4ICsgYyAqIGN5ICkgKyBjeSArIHR5LAoJCQkJMCwgMCwgMQoJCQkpOwoKCQl9LAoKCQlzY2FsZTogZnVuY3Rpb24gKCBzeCwgc3kgKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSAqPSBzeDsgdGVbIDMgXSAqPSBzeDsgdGVbIDYgXSAqPSBzeDsKCQkJdGVbIDEgXSAqPSBzeTsgdGVbIDQgXSAqPSBzeTsgdGVbIDcgXSAqPSBzeTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlyb3RhdGU6IGZ1bmN0aW9uICggdGhldGEgKSB7CgoJCQl2YXIgYyA9IE1hdGguY29zKCB0aGV0YSApOwoJCQl2YXIgcyA9IE1hdGguc2luKCB0aGV0YSApOwoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCgkJCXZhciBhMTEgPSB0ZVsgMCBdLCBhMTIgPSB0ZVsgMyBdLCBhMTMgPSB0ZVsgNiBdOwoJCQl2YXIgYTIxID0gdGVbIDEgXSwgYTIyID0gdGVbIDQgXSwgYTIzID0gdGVbIDcgXTsKCgkJCXRlWyAwIF0gPSBjICogYTExICsgcyAqIGEyMTsKCQkJdGVbIDMgXSA9IGMgKiBhMTIgKyBzICogYTIyOwoJCQl0ZVsgNiBdID0gYyAqIGExMyArIHMgKiBhMjM7CgoJCQl0ZVsgMSBdID0gLSBzICogYTExICsgYyAqIGEyMTsKCQkJdGVbIDQgXSA9IC0gcyAqIGExMiArIGMgKiBhMjI7CgkJCXRlWyA3IF0gPSAtIHMgKiBhMTMgKyBjICogYTIzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRyYW5zbGF0ZTogZnVuY3Rpb24gKCB0eCwgdHkgKSB7CgoJCQl2YXIgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSArPSB0eCAqIHRlWyAyIF07IHRlWyAzIF0gKz0gdHggKiB0ZVsgNSBdOyB0ZVsgNiBdICs9IHR4ICogdGVbIDggXTsKCQkJdGVbIDEgXSArPSB0eSAqIHRlWyAyIF07IHRlWyA0IF0gKz0gdHkgKiB0ZVsgNSBdOyB0ZVsgNyBdICs9IHR5ICogdGVbIDggXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQllcXVhbHM6IGZ1bmN0aW9uICggbWF0cml4ICkgewoKCQkJdmFyIHRlID0gdGhpcy5lbGVtZW50czsKCQkJdmFyIG1lID0gbWF0cml4LmVsZW1lbnRzOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQkJdGhpcy5lbGVtZW50c1sgaSBdID0gYXJyYXlbIGkgKyBvZmZzZXQgXTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0FycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIGFycmF5ID09PSB1bmRlZmluZWQgKSBhcnJheSA9IFtdOwoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCXZhciB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRlWyAyIF07CgoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CgkJCWFycmF5WyBvZmZzZXQgKyA1IF0gPSB0ZVsgNSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgOCBdID0gdGVbIDggXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBzemltZWsgLyBodHRwczovL2dpdGh1Yi5jb20vc3ppbWVrLwoJICovCgoJdmFyIF9jYW52YXM7CgoJdmFyIEltYWdlVXRpbHMgPSB7CgoJCWdldERhdGFVUkw6IGZ1bmN0aW9uICggaW1hZ2UgKSB7CgoJCQl2YXIgY2FudmFzOwoKCQkJaWYgKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJcmV0dXJuIGltYWdlLnNyYzsKCgkJCX0gZWxzZSBpZiAoIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB7CgoJCQkJY2FudmFzID0gaW1hZ2U7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyggJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnLCAnY2FudmFzJyApOwoKCQkJCV9jYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKCQkJCV9jYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJCXZhciBjb250ZXh0ID0gX2NhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgoJCQkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEltYWdlRGF0YSApIHsKCgkJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlLCAwLCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCWNhbnZhcyA9IF9jYW52YXM7CgoJCQl9CgoJCQlpZiAoIGNhbnZhcy53aWR0aCA+IDIwNDggfHwgY2FudmFzLmhlaWdodCA+IDIwNDggKSB7CgoJCQkJcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoICdpbWFnZS9qcGVnJywgMC42ICk7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBjYW52YXMudG9EYXRhVVJMKCAnaW1hZ2UvcG5nJyApOwoKCQkJfQoKCQl9CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBzemltZWsgLyBodHRwczovL2dpdGh1Yi5jb20vc3ppbWVrLwoJICovCgoJdmFyIHRleHR1cmVJZCA9IDA7CgoJZnVuY3Rpb24gVGV4dHVyZSggaW1hZ2UsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSwgZW5jb2RpbmcgKSB7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogdGV4dHVyZUlkICsrIH0gKTsKCgkJdGhpcy51dWlkID0gX01hdGguZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmltYWdlID0gaW1hZ2UgIT09IHVuZGVmaW5lZCA/IGltYWdlIDogVGV4dHVyZS5ERUZBVUxUX0lNQUdFOwoJCXRoaXMubWlwbWFwcyA9IFtdOwoKCQl0aGlzLm1hcHBpbmcgPSBtYXBwaW5nICE9PSB1bmRlZmluZWQgPyBtYXBwaW5nIDogVGV4dHVyZS5ERUZBVUxUX01BUFBJTkc7CgoJCXRoaXMud3JhcFMgPSB3cmFwUyAhPT0gdW5kZWZpbmVkID8gd3JhcFMgOiBDbGFtcFRvRWRnZVdyYXBwaW5nOwoJCXRoaXMud3JhcFQgPSB3cmFwVCAhPT0gdW5kZWZpbmVkID8gd3JhcFQgOiBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQl0aGlzLm1hZ0ZpbHRlciA9IG1hZ0ZpbHRlciAhPT0gdW5kZWZpbmVkID8gbWFnRmlsdGVyIDogTGluZWFyRmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtaW5GaWx0ZXIgOiBMaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXI7CgoJCXRoaXMuYW5pc290cm9weSA9IGFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCA/IGFuaXNvdHJvcHkgOiAxOwoKCQl0aGlzLmZvcm1hdCA9IGZvcm1hdCAhPT0gdW5kZWZpbmVkID8gZm9ybWF0IDogUkdCQUZvcm1hdDsKCQl0aGlzLnR5cGUgPSB0eXBlICE9PSB1bmRlZmluZWQgPyB0eXBlIDogVW5zaWduZWRCeXRlVHlwZTsKCgkJdGhpcy5vZmZzZXQgPSBuZXcgVmVjdG9yMiggMCwgMCApOwoJCXRoaXMucmVwZWF0ID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCQl0aGlzLmNlbnRlciA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgkJdGhpcy5yb3RhdGlvbiA9IDA7CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4MygpOwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CgkJdGhpcy5wcmVtdWx0aXBseUFscGhhID0gZmFsc2U7CgkJdGhpcy5mbGlwWSA9IHRydWU7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwkvLyB2YWxpZCB2YWx1ZXM6IDEsIDIsIDQsIDggKHNlZSBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbFBpeGVsU3RvcmVpLnhtbCkKCgkJLy8gVmFsdWVzIG9mIGVuY29kaW5nICE9PSBUSFJFRS5MaW5lYXJFbmNvZGluZyBvbmx5IHN1cHBvcnRlZCBvbiBtYXAsIGVudk1hcCBhbmQgZW1pc3NpdmVNYXAuCgkJLy8KCQkvLyBBbHNvIGNoYW5naW5nIHRoZSBlbmNvZGluZyBhZnRlciBhbHJlYWR5IHVzZWQgYnkgYSBNYXRlcmlhbCB3aWxsIG5vdCBhdXRvbWF0aWNhbGx5IG1ha2UgdGhlIE1hdGVyaWFsCgkJLy8gdXBkYXRlLiAgWW91IG5lZWQgdG8gZXhwbGljaXRseSBjYWxsIE1hdGVyaWFsLm5lZWRzVXBkYXRlIHRvIHRyaWdnZXIgaXQgdG8gcmVjb21waWxlLgoJCXRoaXMuZW5jb2RpbmcgPSBlbmNvZGluZyAhPT0gdW5kZWZpbmVkID8gZW5jb2RpbmcgOiBMaW5lYXJFbmNvZGluZzsKCgkJdGhpcy52ZXJzaW9uID0gMDsKCQl0aGlzLm9uVXBkYXRlID0gbnVsbDsKCgl9CgoJVGV4dHVyZS5ERUZBVUxUX0lNQUdFID0gdW5kZWZpbmVkOwoJVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcgPSBVVk1hcHBpbmc7CgoJVGV4dHVyZS5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFRleHR1cmUsCgoJCWlzVGV4dHVyZTogdHJ1ZSwKCgkJdXBkYXRlTWF0cml4OiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSggdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSwgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSApOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9LAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQkJdGhpcy5pbWFnZSA9IHNvdXJjZS5pbWFnZTsKCQkJdGhpcy5taXBtYXBzID0gc291cmNlLm1pcG1hcHMuc2xpY2UoIDAgKTsKCgkJCXRoaXMubWFwcGluZyA9IHNvdXJjZS5tYXBwaW5nOwoKCQkJdGhpcy53cmFwUyA9IHNvdXJjZS53cmFwUzsKCQkJdGhpcy53cmFwVCA9IHNvdXJjZS53cmFwVDsKCgkJCXRoaXMubWFnRmlsdGVyID0gc291cmNlLm1hZ0ZpbHRlcjsKCQkJdGhpcy5taW5GaWx0ZXIgPSBzb3VyY2UubWluRmlsdGVyOwoKCQkJdGhpcy5hbmlzb3Ryb3B5ID0gc291cmNlLmFuaXNvdHJvcHk7CgoJCQl0aGlzLmZvcm1hdCA9IHNvdXJjZS5mb3JtYXQ7CgkJCXRoaXMudHlwZSA9IHNvdXJjZS50eXBlOwoKCQkJdGhpcy5vZmZzZXQuY29weSggc291cmNlLm9mZnNldCApOwoJCQl0aGlzLnJlcGVhdC5jb3B5KCBzb3VyY2UucmVwZWF0ICk7CgkJCXRoaXMuY2VudGVyLmNvcHkoIHNvdXJjZS5jZW50ZXIgKTsKCQkJdGhpcy5yb3RhdGlvbiA9IHNvdXJjZS5yb3RhdGlvbjsKCgkJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhBdXRvVXBkYXRlOwoJCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgoJCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHNvdXJjZS5nZW5lcmF0ZU1pcG1hcHM7CgkJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBseUFscGhhOwoJCQl0aGlzLmZsaXBZID0gc291cmNlLmZsaXBZOwoJCQl0aGlzLnVucGFja0FsaWdubWVudCA9IHNvdXJjZS51bnBhY2tBbGlnbm1lbnQ7CgkJCXRoaXMuZW5jb2RpbmcgPSBzb3VyY2UuZW5jb2Rpbmc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdG9KU09OOiBmdW5jdGlvbiAoIG1ldGEgKSB7CgoJCQl2YXIgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCQlpZiAoICEgaXNSb290T2JqZWN0ICYmIG1ldGEudGV4dHVyZXNbIHRoaXMudXVpZCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIG1ldGEudGV4dHVyZXNbIHRoaXMudXVpZCBdOwoKCQkJfQoKCQkJdmFyIG91dHB1dCA9IHsKCgkJCQltZXRhZGF0YTogewoJCQkJCXZlcnNpb246IDQuNSwKCQkJCQl0eXBlOiAnVGV4dHVyZScsCgkJCQkJZ2VuZXJhdG9yOiAnVGV4dHVyZS50b0pTT04nCgkJCQl9LAoKCQkJCXV1aWQ6IHRoaXMudXVpZCwKCQkJCW5hbWU6IHRoaXMubmFtZSwKCgkJCQltYXBwaW5nOiB0aGlzLm1hcHBpbmcsCgoJCQkJcmVwZWF0OiBbIHRoaXMucmVwZWF0LngsIHRoaXMucmVwZWF0LnkgXSwKCQkJCW9mZnNldDogWyB0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55IF0sCgkJCQljZW50ZXI6IFsgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSBdLAoJCQkJcm90YXRpb246IHRoaXMucm90YXRpb24sCgoJCQkJd3JhcDogWyB0aGlzLndyYXBTLCB0aGlzLndyYXBUIF0sCgoJCQkJZm9ybWF0OiB0aGlzLmZvcm1hdCwKCQkJCXR5cGU6IHRoaXMudHlwZSwKCQkJCWVuY29kaW5nOiB0aGlzLmVuY29kaW5nLAoKCQkJCW1pbkZpbHRlcjogdGhpcy5taW5GaWx0ZXIsCgkJCQltYWdGaWx0ZXI6IHRoaXMubWFnRmlsdGVyLAoJCQkJYW5pc290cm9weTogdGhpcy5hbmlzb3Ryb3B5LAoKCQkJCWZsaXBZOiB0aGlzLmZsaXBZLAoKCQkJCXByZW11bHRpcGx5QWxwaGE6IHRoaXMucHJlbXVsdGlwbHlBbHBoYSwKCQkJCXVucGFja0FsaWdubWVudDogdGhpcy51bnBhY2tBbGlnbm1lbnQKCgkJCX07CgoJCQlpZiAoIHRoaXMuaW1hZ2UgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBUT0RPOiBNb3ZlIHRvIFRIUkVFLkltYWdlCgoJCQkJdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCgkJCQlpZiAoIGltYWdlLnV1aWQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaW1hZ2UudXVpZCA9IF9NYXRoLmdlbmVyYXRlVVVJRCgpOyAvLyBVR0gKCgkJCQl9CgoJCQkJaWYgKCAhIGlzUm9vdE9iamVjdCAmJiBtZXRhLmltYWdlc1sgaW1hZ2UudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXZhciB1cmw7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggaW1hZ2UgKSApIHsKCgkJCQkJCS8vIHByb2Nlc3MgYXJyYXkgb2YgaW1hZ2VzIGUuZy4gQ3ViZVRleHR1cmUKCgkJCQkJCXVybCA9IFtdOwoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gaW1hZ2UubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCQl1cmwucHVzaCggSW1hZ2VVdGlscy5nZXREYXRhVVJMKCBpbWFnZVsgaSBdICkgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHByb2Nlc3Mgc2luZ2xlIGltYWdlCgoJCQkJCQl1cmwgPSBJbWFnZVV0aWxzLmdldERhdGFVUkwoIGltYWdlICk7CgoJCQkJCX0KCgkJCQkJbWV0YS5pbWFnZXNbIGltYWdlLnV1aWQgXSA9IHsKCQkJCQkJdXVpZDogaW1hZ2UudXVpZCwKCQkJCQkJdXJsOiB1cmwKCQkJCQl9OwoKCQkJCX0KCgkJCQlvdXRwdXQuaW1hZ2UgPSBpbWFnZS51dWlkOwoKCQkJfQoKCQkJaWYgKCAhIGlzUm9vdE9iamVjdCApIHsKCgkJCQltZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXSA9IG91dHB1dDsKCgkJCX0KCgkJCXJldHVybiBvdXRwdXQ7CgoJCX0sCgoJCWRpc3Bvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9LAoKCQl0cmFuc2Zvcm1VdjogZnVuY3Rpb24gKCB1diApIHsKCgkJCWlmICggdGhpcy5tYXBwaW5nICE9PSBVVk1hcHBpbmcgKSByZXR1cm4gdXY7CgoJCQl1di5hcHBseU1hdHJpeDMoIHRoaXMubWF0cml4ICk7CgoJCQlpZiAoIHV2LnggPCAwIHx8IHV2LnggPiAxICkgewoKCQkJCXN3aXRjaCAoIHRoaXMud3JhcFMgKSB7CgoJCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQl1di54ID0gdXYueCAtIE1hdGguZmxvb3IoIHV2LnggKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJCXV2LnggPSB1di54IDwgMCA/IDAgOiAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueCApICUgMiApID09PSAxICkgewoKCQkJCQkJCXV2LnggPSBNYXRoLmNlaWwoIHV2LnggKSAtIHV2Lng7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwoKCQkJCQkJfQoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHV2LnkgPCAwIHx8IHV2LnkgPiAxICkgewoKCQkJCXN3aXRjaCAoIHRoaXMud3JhcFQgKSB7CgoJCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQl1di55ID0gdXYueSAtIE1hdGguZmxvb3IoIHV2LnkgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJCXV2LnkgPSB1di55IDwgMCA/IDAgOiAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueSApICUgMiApID09PSAxICkgewoKCQkJCQkJCXV2LnkgPSBNYXRoLmNlaWwoIHV2LnkgKSAtIHV2Lnk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwoKCQkJCQkJfQoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRoaXMuZmxpcFkgKSB7CgoJCQkJdXYueSA9IDEgLSB1di55OwoKCQkJfQoKCQkJcmV0dXJuIHV2OwoKCQl9CgoJfSApOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggVGV4dHVyZS5wcm90b3R5cGUsICJuZWVkc1VwZGF0ZSIsIHsKCgkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHRoaXMudmVyc2lvbiArKzsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3Igc3VwZXJlZ2diZXJ0IC8gaHR0cDovL3d3dy5wYXVsYnJ1bnQuY28udWsvCgkgKiBAYXV0aG9yIHBoaWxvZ2IgLyBodHRwOi8vYmxvZy50aGVqaXQub3JnLwoJICogQGF1dGhvciBtaWthZWwgZW10aW5nZXIgLyBodHRwOi8vZ29tby5zZS8KCSAqIEBhdXRob3IgZWdyYWV0aGVyIC8gaHR0cDovL2VncmFldGhlci5jb20vCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIFZlY3RvcjQoIHgsIHksIHosIHcgKSB7CgoJCXRoaXMueCA9IHggfHwgMDsKCQl0aGlzLnkgPSB5IHx8IDA7CgkJdGhpcy56ID0geiB8fCAwOwoJCXRoaXMudyA9ICggdyAhPT0gdW5kZWZpbmVkICkgPyB3IDogMTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggVmVjdG9yNC5wcm90b3R5cGUsIHsKCgkJaXNWZWN0b3I0OiB0cnVlLAoKCQlzZXQ6IGZ1bmN0aW9uICggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMueCA9IHg7CgkJCXRoaXMueSA9IHk7CgkJCXRoaXMueiA9IHo7CgkJCXRoaXMudyA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0U2NhbGFyOiBmdW5jdGlvbiAoIHNjYWxhciApIHsKCgkJCXRoaXMueCA9IHNjYWxhcjsKCQkJdGhpcy55ID0gc2NhbGFyOwoJCQl0aGlzLnogPSBzY2FsYXI7CgkJCXRoaXMudyA9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRYOiBmdW5jdGlvbiAoIHggKSB7CgoJCQl0aGlzLnggPSB4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFk6IGZ1bmN0aW9uICggeSApIHsKCgkJCXRoaXMueSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WjogZnVuY3Rpb24gKCB6ICkgewoKCQkJdGhpcy56ID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRXOiBmdW5jdGlvbiAoIHcgKSB7CgoJCQl0aGlzLncgPSB3OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldENvbXBvbmVudDogZnVuY3Rpb24gKCBpbmRleCwgdmFsdWUgKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CgkJCQljYXNlIDM6IHRoaXMudyA9IHZhbHVlOyBicmVhazsKCQkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0Q29tcG9uZW50OiBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwoJCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwoJCQkJY2FzZSAzOiByZXR1cm4gdGhpcy53OwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy53ICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoJCQl0aGlzLnogPSB2Lno7CgkJCXRoaXMudyA9ICggdi53ICE9PSB1bmRlZmluZWQgKSA/IHYudyA6IDE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkOiBmdW5jdGlvbiAoIHYsIHcgKSB7CgoJCQlpZiAoIHcgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3I0OiAuYWRkKCkgbm93IG9ubHkgYWNjZXB0cyBvbmUgYXJndW1lbnQuIFVzZSAuYWRkVmVjdG9ycyggYSwgYiApIGluc3RlYWQuJyApOwoJCQkJcmV0dXJuIHRoaXMuYWRkVmVjdG9ycyggdiwgdyApOwoKCQkJfQoKCQkJdGhpcy54ICs9IHYueDsKCQkJdGhpcy55ICs9IHYueTsKCQkJdGhpcy56ICs9IHYuejsKCQkJdGhpcy53ICs9IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlhZGRTY2FsYXI6IGZ1bmN0aW9uICggcyApIHsKCgkJCXRoaXMueCArPSBzOwoJCQl0aGlzLnkgKz0gczsKCQkJdGhpcy56ICs9IHM7CgkJCXRoaXMudyArPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFkZFZlY3RvcnM6IGZ1bmN0aW9uICggYSwgYiApIHsKCgkJCXRoaXMueCA9IGEueCArIGIueDsKCQkJdGhpcy55ID0gYS55ICsgYi55OwoJCQl0aGlzLnogPSBhLnogKyBiLno7CgkJCXRoaXMudyA9IGEudyArIGIudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlhZGRTY2FsZWRWZWN0b3I6IGZ1bmN0aW9uICggdiwgcyApIHsKCgkJCXRoaXMueCArPSB2LnggKiBzOwoJCQl0aGlzLnkgKz0gdi55ICogczsKCQkJdGhpcy56ICs9IHYueiAqIHM7CgkJCXRoaXMudyArPSB2LncgKiBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXN1YjogZnVuY3Rpb24gKCB2LCB3ICkgewoKCQkJaWYgKCB3ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yNDogLnN1YigpIG5vdyBvbmx5IGFjY2VwdHMgb25lIGFyZ3VtZW50LiBVc2UgLnN1YlZlY3RvcnMoIGEsIGIgKSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB0aGlzLnN1YlZlY3RvcnMoIHYsIHcgKTsKCgkJCX0KCgkJCXRoaXMueCAtPSB2Lng7CgkJCXRoaXMueSAtPSB2Lnk7CgkJCXRoaXMueiAtPSB2Lno7CgkJCXRoaXMudyAtPSB2Lnc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc3ViU2NhbGFyOiBmdW5jdGlvbiAoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgkJCXRoaXMueiAtPSBzOwoJCQl0aGlzLncgLT0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzdWJWZWN0b3JzOiBmdW5jdGlvbiAoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCQkJdGhpcy56ID0gYS56IC0gYi56OwoJCQl0aGlzLncgPSBhLncgLSBiLnc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbXVsdGlwbHlTY2FsYXI6IGZ1bmN0aW9uICggc2NhbGFyICkgewoKCQkJdGhpcy54ICo9IHNjYWxhcjsKCQkJdGhpcy55ICo9IHNjYWxhcjsKCQkJdGhpcy56ICo9IHNjYWxhcjsKCQkJdGhpcy53ICo9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlhcHBseU1hdHJpeDQ6IGZ1bmN0aW9uICggbSApIHsKCgkJCXZhciB4ID0gdGhpcy54LCB5ID0gdGhpcy55LCB6ID0gdGhpcy56LCB3ID0gdGhpcy53OwoJCQl2YXIgZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHogKyBlWyAxMiBdICogdzsKCQkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSAqIHc7CgkJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA2IF0gKiB5ICsgZVsgMTAgXSAqIHogKyBlWyAxNCBdICogdzsKCQkJdGhpcy53ID0gZVsgMyBdICogeCArIGVbIDcgXSAqIHkgKyBlWyAxMSBdICogeiArIGVbIDE1IF0gKiB3OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRpdmlkZVNjYWxhcjogZnVuY3Rpb24gKCBzY2FsYXIgKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhciggMSAvIHNjYWxhciApOwoKCQl9LAoKCQlzZXRBeGlzQW5nbGVGcm9tUXVhdGVybmlvbjogZnVuY3Rpb24gKCBxICkgewoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL3F1YXRlcm5pb25Ub0FuZ2xlL2luZGV4Lmh0bQoKCQkJLy8gcSBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJCXRoaXMudyA9IDIgKiBNYXRoLmFjb3MoIHEudyApOwoKCQkJdmFyIHMgPSBNYXRoLnNxcnQoIDEgLSBxLncgKiBxLncgKTsKCgkJCWlmICggcyA8IDAuMDAwMSApIHsKCgkJCQl0aGlzLnggPSAxOwoJCQkJdGhpcy55ID0gMDsKCQkJCXRoaXMueiA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMueCA9IHEueCAvIHM7CgkJCQl0aGlzLnkgPSBxLnkgLyBzOwoJCQkJdGhpcy56ID0gcS56IC8gczsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRBeGlzQW5nbGVGcm9tUm90YXRpb25NYXRyaXg6IGZ1bmN0aW9uICggbSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9tYXRyaXhUb0FuZ2xlL2luZGV4Lmh0bQoKCQkJLy8gYXNzdW1lcyB0aGUgdXBwZXIgM3gzIG9mIG0gaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLCB1bnNjYWxlZCkKCgkJCXZhciBhbmdsZSwgeCwgeSwgeiwJCS8vIHZhcmlhYmxlcyBmb3IgcmVzdWx0CgkJCQllcHNpbG9uID0gMC4wMSwJCS8vIG1hcmdpbiB0byBhbGxvdyBmb3Igcm91bmRpbmcgZXJyb3JzCgkJCQllcHNpbG9uMiA9IDAuMSwJCS8vIG1hcmdpbiB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIDAgYW5kIDE4MCBkZWdyZWVzCgoJCQkJdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgoJCQlpZiAoICggTWF0aC5hYnMoIG0xMiAtIG0yMSApIDwgZXBzaWxvbiApICYmCgkJCSAgICAgKCBNYXRoLmFicyggbTEzIC0gbTMxICkgPCBlcHNpbG9uICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMjMgLSBtMzIgKSA8IGVwc2lsb24gKSApIHsKCgkJCQkvLyBzaW5ndWxhcml0eSBmb3VuZAoJCQkJLy8gZmlyc3QgY2hlY2sgZm9yIGlkZW50aXR5IG1hdHJpeCB3aGljaCBtdXN0IGhhdmUgKzEgZm9yIGFsbCB0ZXJtcwoJCQkJLy8gaW4gbGVhZGluZyBkaWFnb25hbCBhbmQgemVybyBpbiBvdGhlciB0ZXJtcwoKCQkJCWlmICggKCBNYXRoLmFicyggbTEyICsgbTIxICkgPCBlcHNpbG9uMiApICYmCgkJCQkgICAgICggTWF0aC5hYnMoIG0xMyArIG0zMSApIDwgZXBzaWxvbjIgKSAmJgoJCQkJICAgICAoIE1hdGguYWJzKCBtMjMgKyBtMzIgKSA8IGVwc2lsb24yICkgJiYKCQkJCSAgICAgKCBNYXRoLmFicyggbTExICsgbTIyICsgbTMzIC0gMyApIDwgZXBzaWxvbjIgKSApIHsKCgkJCQkJLy8gdGhpcyBzaW5ndWxhcml0eSBpcyBpZGVudGl0eSBtYXRyaXggc28gYW5nbGUgPSAwCgoJCQkJCXRoaXMuc2V0KCAxLCAwLCAwLCAwICk7CgoJCQkJCXJldHVybiB0aGlzOyAvLyB6ZXJvIGFuZ2xlLCBhcmJpdHJhcnkgYXhpcwoKCQkJCX0KCgkJCQkvLyBvdGhlcndpc2UgdGhpcyBzaW5ndWxhcml0eSBpcyBhbmdsZSA9IDE4MAoKCQkJCWFuZ2xlID0gTWF0aC5QSTsKCgkJCQl2YXIgeHggPSAoIG0xMSArIDEgKSAvIDI7CgkJCQl2YXIgeXkgPSAoIG0yMiArIDEgKSAvIDI7CgkJCQl2YXIgenogPSAoIG0zMyArIDEgKSAvIDI7CgkJCQl2YXIgeHkgPSAoIG0xMiArIG0yMSApIC8gNDsKCQkJCXZhciB4eiA9ICggbTEzICsgbTMxICkgLyA0OwoJCQkJdmFyIHl6ID0gKCBtMjMgKyBtMzIgKSAvIDQ7CgoJCQkJaWYgKCAoIHh4ID4geXkgKSAmJiAoIHh4ID4genogKSApIHsKCgkJCQkJLy8gbTExIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB4eCA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMDsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl4ID0gTWF0aC5zcXJ0KCB4eCApOwoJCQkJCQl5ID0geHkgLyB4OwoJCQkJCQl6ID0geHogLyB4OwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggeXkgPiB6eiApIHsKCgkJCQkJLy8gbTIyIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB5eSA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMC43MDcxMDY3ODE7CgkJCQkJCXkgPSAwOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl5ID0gTWF0aC5zcXJ0KCB5eSApOwoJCQkJCQl4ID0geHkgLyB5OwoJCQkJCQl6ID0geXogLyB5OwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gbTMzIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0gc28gYmFzZSByZXN1bHQgb24gdGhpcwoKCQkJCQlpZiAoIHp6IDwgZXBzaWxvbiApIHsKCgkJCQkJCXggPSAwLjcwNzEwNjc4MTsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXogPSBNYXRoLnNxcnQoIHp6ICk7CgkJCQkJCXggPSB4eiAvIHo7CgkJCQkJCXkgPSB5eiAvIHo7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5zZXQoIHgsIHksIHosIGFuZ2xlICk7CgoJCQkJcmV0dXJuIHRoaXM7IC8vIHJldHVybiAxODAgZGVnIHJvdGF0aW9uCgoJCQl9CgoJCQkvLyBhcyB3ZSBoYXZlIHJlYWNoZWQgaGVyZSB0aGVyZSBhcmUgbm8gc2luZ3VsYXJpdGllcyBzbyB3ZSBjYW4gaGFuZGxlIG5vcm1hbGx5CgoJCQl2YXIgcyA9IE1hdGguc3FydCggKCBtMzIgLSBtMjMgKSAqICggbTMyIC0gbTIzICkgKwoJCQkgICAgICAgICAgICAgICAgICAgKCBtMTMgLSBtMzEgKSAqICggbTEzIC0gbTMxICkgKwoJCQkgICAgICAgICAgICAgICAgICAgKCBtMjEgLSBtMTIgKSAqICggbTIxIC0gbTEyICkgKTsgLy8gdXNlZCB0byBub3JtYWxpemUKCgkJCWlmICggTWF0aC5hYnMoIHMgKSA8IDAuMDAxICkgcyA9IDE7CgoJCQkvLyBwcmV2ZW50IGRpdmlkZSBieSB6ZXJvLCBzaG91bGQgbm90IGhhcHBlbiBpZiBtYXRyaXggaXMgb3J0aG9nb25hbCBhbmQgc2hvdWxkIGJlCgkJCS8vIGNhdWdodCBieSBzaW5ndWxhcml0eSB0ZXN0IGFib3ZlLCBidXQgSSd2ZSBsZWZ0IGl0IGluIGp1c3QgaW4gY2FzZQoKCQkJdGhpcy54ID0gKCBtMzIgLSBtMjMgKSAvIHM7CgkJCXRoaXMueSA9ICggbTEzIC0gbTMxICkgLyBzOwoJCQl0aGlzLnogPSAoIG0yMSAtIG0xMiApIC8gczsKCQkJdGhpcy53ID0gTWF0aC5hY29zKCAoIG0xMSArIG0yMiArIG0zMyAtIDEgKSAvIDIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltaW46IGZ1bmN0aW9uICggdiApIHsKCgkJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKCQkJdGhpcy56ID0gTWF0aC5taW4oIHRoaXMueiwgdi56ICk7CgkJCXRoaXMudyA9IE1hdGgubWluKCB0aGlzLncsIHYudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW1heDogZnVuY3Rpb24gKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5tYXgoIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWF4KCB0aGlzLnksIHYueSApOwoJCQl0aGlzLnogPSBNYXRoLm1heCggdGhpcy56LCB2LnogKTsKCQkJdGhpcy53ID0gTWF0aC5tYXgoIHRoaXMudywgdi53ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xhbXA6IGZ1bmN0aW9uICggbWluLCBtYXggKSB7CgoJCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKCQkJdGhpcy54ID0gTWF0aC5tYXgoIG1pbi54LCBNYXRoLm1pbiggbWF4LngsIHRoaXMueCApICk7CgkJCXRoaXMueSA9IE1hdGgubWF4KCBtaW4ueSwgTWF0aC5taW4oIG1heC55LCB0aGlzLnkgKSApOwoJCQl0aGlzLnogPSBNYXRoLm1heCggbWluLnosIE1hdGgubWluKCBtYXgueiwgdGhpcy56ICkgKTsKCQkJdGhpcy53ID0gTWF0aC5tYXgoIG1pbi53LCBNYXRoLm1pbiggbWF4LncsIHRoaXMudyApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xhbXBTY2FsYXI6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBtaW4sIG1heDsKCgkJCXJldHVybiBmdW5jdGlvbiBjbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCQkJaWYgKCBtaW4gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbWluID0gbmV3IFZlY3RvcjQoKTsKCQkJCQltYXggPSBuZXcgVmVjdG9yNCgpOwoKCQkJCX0KCgkJCQltaW4uc2V0KCBtaW5WYWwsIG1pblZhbCwgbWluVmFsLCBtaW5WYWwgKTsKCQkJCW1heC5zZXQoIG1heFZhbCwgbWF4VmFsLCBtYXhWYWwsIG1heFZhbCApOwoKCQkJCXJldHVybiB0aGlzLmNsYW1wKCBtaW4sIG1heCApOwoKCQkJfTsKCgkJfSgpLAoKCQljbGFtcExlbmd0aDogZnVuY3Rpb24gKCBtaW4sIG1heCApIHsKCgkJCXZhciBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCBsZW5ndGggKSApICk7CgoJCX0sCgoJCWZsb29yOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLmZsb29yKCB0aGlzLncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljZWlsOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLmNlaWwoIHRoaXMudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXJvdW5kOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLnJvdW5kKCB0aGlzLncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlyb3VuZFRvWmVybzogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy54ID0gKCB0aGlzLnggPCAwICkgPyBNYXRoLmNlaWwoIHRoaXMueCApIDogTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9ICggdGhpcy55IDwgMCApID8gTWF0aC5jZWlsKCB0aGlzLnkgKSA6IE1hdGguZmxvb3IoIHRoaXMueSApOwoJCQl0aGlzLnogPSAoIHRoaXMueiA8IDAgKSA/IE1hdGguY2VpbCggdGhpcy56ICkgOiBNYXRoLmZsb29yKCB0aGlzLnogKTsKCQkJdGhpcy53ID0gKCB0aGlzLncgPCAwICkgPyBNYXRoLmNlaWwoIHRoaXMudyApIDogTWF0aC5mbG9vciggdGhpcy53ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbmVnYXRlOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLnggPSAtIHRoaXMueDsKCQkJdGhpcy55ID0gLSB0aGlzLnk7CgkJCXRoaXMueiA9IC0gdGhpcy56OwoJCQl0aGlzLncgPSAtIHRoaXMudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlkb3Q6IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2LnogKyB0aGlzLncgKiB2Lnc7CgoJCX0sCgoJCWxlbmd0aFNxOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53OwoKCQl9LAoKCQlsZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyApOwoKCQl9LAoKCQltYW5oYXR0YW5MZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICkgKyBNYXRoLmFicyggdGhpcy53ICk7CgoJCX0sCgoJCW5vcm1hbGl6ZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgkJfSwKCgkJc2V0TGVuZ3RoOiBmdW5jdGlvbiAoIGxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgkJfSwKCgkJbGVycDogZnVuY3Rpb24gKCB2LCBhbHBoYSApIHsKCgkJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CgkJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgkJCXRoaXMudyArPSAoIHYudyAtIHRoaXMudyApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbGVycFZlY3RvcnM6IGZ1bmN0aW9uICggdjEsIHYyLCBhbHBoYSApIHsKCgkJCXJldHVybiB0aGlzLnN1YlZlY3RvcnMoIHYyLCB2MSApLm11bHRpcGx5U2NhbGFyKCBhbHBoYSApLmFkZCggdjEgKTsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSAmJiAoIHYudyA9PT0gdGhpcy53ICkgKTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy53ID0gYXJyYXlbIG9mZnNldCArIDMgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0FycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIGFycmF5ID09PSB1bmRlZmluZWQgKSBhcnJheSA9IFtdOwoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMueDsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKCQkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMudzsKCgkJCXJldHVybiBhcnJheTsKCgkJfSwKCgkJZnJvbUJ1ZmZlckF0dHJpYnV0ZTogZnVuY3Rpb24gKCBhdHRyaWJ1dGUsIGluZGV4LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjQ6IG9mZnNldCBoYXMgYmVlbiByZW1vdmVkIGZyb20gLmZyb21CdWZmZXJBdHRyaWJ1dGUoKS4nICk7CgoJCQl9CgoJCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCQl0aGlzLncgPSBhdHRyaWJ1dGUuZ2V0VyggaW5kZXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBzemltZWsgLyBodHRwczovL2dpdGh1Yi5jb20vc3ppbWVrLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgTWFyaXVzIEtpbnRlbCAvIGh0dHBzOi8vZ2l0aHViLmNvbS9raW50ZWwKCSAqLwoKCS8qCgkgSW4gb3B0aW9ucywgd2UgY2FuIHNwZWNpZnk6CgkgKiBUZXh0dXJlIHBhcmFtZXRlcnMgZm9yIGFuIGF1dG8tZ2VuZXJhdGVkIHRhcmdldCB0ZXh0dXJlCgkgKiBkZXB0aEJ1ZmZlci9zdGVuY2lsQnVmZmVyOiBCb29sZWFucyB0byBpbmRpY2F0ZSBpZiB3ZSBzaG91bGQgZ2VuZXJhdGUgdGhlc2UgYnVmZmVycwoJKi8KCWZ1bmN0aW9uIFdlYkdMUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICkgewoKCQl0aGlzLndpZHRoID0gd2lkdGg7CgkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgoJCXRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQl0aGlzLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXRoaXMudGV4dHVyZSA9IG5ldyBUZXh0dXJlKCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgb3B0aW9ucy53cmFwUywgb3B0aW9ucy53cmFwVCwgb3B0aW9ucy5tYWdGaWx0ZXIsIG9wdGlvbnMubWluRmlsdGVyLCBvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy50eXBlLCBvcHRpb25zLmFuaXNvdHJvcHksIG9wdGlvbnMuZW5jb2RpbmcgKTsKCgkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmdlbmVyYXRlTWlwbWFwcyA6IGZhbHNlOwoJCXRoaXMudGV4dHVyZS5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5taW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgoJCXRoaXMuZGVwdGhCdWZmZXIgPSBvcHRpb25zLmRlcHRoQnVmZmVyICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmRlcHRoQnVmZmVyIDogdHJ1ZTsKCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnN0ZW5jaWxCdWZmZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc3RlbmNpbEJ1ZmZlciA6IHRydWU7CgkJdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5kZXB0aFRleHR1cmUgOiBudWxsOwoKCX0KCglXZWJHTFJlbmRlclRhcmdldC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFdlYkdMUmVuZGVyVGFyZ2V0LAoKCQlpc1dlYkdMUmVuZGVyVGFyZ2V0OiB0cnVlLAoKCQlzZXRTaXplOiBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHRoaXMud2lkdGggIT09IHdpZHRoIHx8IHRoaXMuaGVpZ2h0ICE9PSBoZWlnaHQgKSB7CgoJCQkJdGhpcy53aWR0aCA9IHdpZHRoOwoJCQkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJdGhpcy5kaXNwb3NlKCk7CgoJCQl9CgoJCQl0aGlzLnZpZXdwb3J0LnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoJCQl0aGlzLnNjaXNzb3Iuc2V0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJdGhpcy53aWR0aCA9IHNvdXJjZS53aWR0aDsKCQkJdGhpcy5oZWlnaHQgPSBzb3VyY2UuaGVpZ2h0OwoKCQkJdGhpcy52aWV3cG9ydC5jb3B5KCBzb3VyY2Uudmlld3BvcnQgKTsKCgkJCXRoaXMudGV4dHVyZSA9IHNvdXJjZS50ZXh0dXJlLmNsb25lKCk7CgoJCQl0aGlzLmRlcHRoQnVmZmVyID0gc291cmNlLmRlcHRoQnVmZmVyOwoJCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBzb3VyY2Uuc3RlbmNpbEJ1ZmZlcjsKCQkJdGhpcy5kZXB0aFRleHR1cmUgPSBzb3VyY2UuZGVwdGhUZXh0dXJlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRpc3Bvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqIEBhdXRob3IgTWF0dCBEZXNMYXVyaWVycyAvIEBtYXR0ZGVzbAoJICovCgoJZnVuY3Rpb24gV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApIHsKCgkJV2ViR0xSZW5kZXJUYXJnZXQuY2FsbCggdGhpcywgd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKCQl0aGlzLnNhbXBsZXMgPSA0OwoKCX0KCglXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0LnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIFdlYkdMUmVuZGVyVGFyZ2V0LnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0LAoKCQlpc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ6IHRydWUsCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJV2ViR0xSZW5kZXJUYXJnZXQucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCQl0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbQoJICovCgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJUYXJnZXRDdWJlKCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICkgewoKCQlXZWJHTFJlbmRlclRhcmdldC5jYWxsKCB0aGlzLCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICk7CgoJfQoKCVdlYkdMUmVuZGVyVGFyZ2V0Q3ViZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBXZWJHTFJlbmRlclRhcmdldC5wcm90b3R5cGUgKTsKCVdlYkdMUmVuZGVyVGFyZ2V0Q3ViZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBXZWJHTFJlbmRlclRhcmdldEN1YmU7CgoJV2ViR0xSZW5kZXJUYXJnZXRDdWJlLnByb3RvdHlwZS5pc1dlYkdMUmVuZGVyVGFyZ2V0Q3ViZSA9IHRydWU7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gRGF0YVRleHR1cmUoIGRhdGEsIHdpZHRoLCBoZWlnaHQsIGZvcm1hdCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgYW5pc290cm9weSwgZW5jb2RpbmcgKSB7CgoJCVRleHR1cmUuY2FsbCggdGhpcywgbnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBlbmNvZGluZyApOwoKCQl0aGlzLmltYWdlID0geyBkYXRhOiBkYXRhLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0IH07CgoJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtYWdGaWx0ZXIgOiBOZWFyZXN0RmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtaW5GaWx0ZXIgOiBOZWFyZXN0RmlsdGVyOwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJfQoKCURhdGFUZXh0dXJlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFRleHR1cmUucHJvdG90eXBlICk7CglEYXRhVGV4dHVyZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBEYXRhVGV4dHVyZTsKCglEYXRhVGV4dHVyZS5wcm90b3R5cGUuaXNEYXRhVGV4dHVyZSA9IHRydWU7CgoJLyoqCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIEJveDMoIG1pbiwgbWF4ICkgewoKCQl0aGlzLm1pbiA9ICggbWluICE9PSB1bmRlZmluZWQgKSA/IG1pbiA6IG5ldyBWZWN0b3IzKCArIEluZmluaXR5LCArIEluZmluaXR5LCArIEluZmluaXR5ICk7CgkJdGhpcy5tYXggPSAoIG1heCAhPT0gdW5kZWZpbmVkICkgPyBtYXggOiBuZXcgVmVjdG9yMyggLSBJbmZpbml0eSwgLSBJbmZpbml0eSwgLSBJbmZpbml0eSApOwoKCX0KCglPYmplY3QuYXNzaWduKCBCb3gzLnByb3RvdHlwZSwgewoKCQlpc0JveDM6IHRydWUsCgoJCXNldDogZnVuY3Rpb24gKCBtaW4sIG1heCApIHsKCgkJCXRoaXMubWluLmNvcHkoIG1pbiApOwoJCQl0aGlzLm1heC5jb3B5KCBtYXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tQXJyYXk6IGZ1bmN0aW9uICggYXJyYXkgKSB7CgoJCQl2YXIgbWluWCA9ICsgSW5maW5pdHk7CgkJCXZhciBtaW5ZID0gKyBJbmZpbml0eTsKCQkJdmFyIG1pblogPSArIEluZmluaXR5OwoKCQkJdmFyIG1heFggPSAtIEluZmluaXR5OwoJCQl2YXIgbWF4WSA9IC0gSW5maW5pdHk7CgkJCXZhciBtYXhaID0gLSBJbmZpbml0eTsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQl2YXIgeCA9IGFycmF5WyBpIF07CgkJCQl2YXIgeSA9IGFycmF5WyBpICsgMSBdOwoJCQkJdmFyIHogPSBhcnJheVsgaSArIDIgXTsKCgkJCQlpZiAoIHggPCBtaW5YICkgbWluWCA9IHg7CgkJCQlpZiAoIHkgPCBtaW5ZICkgbWluWSA9IHk7CgkJCQlpZiAoIHogPCBtaW5aICkgbWluWiA9IHo7CgoJCQkJaWYgKCB4ID4gbWF4WCApIG1heFggPSB4OwoJCQkJaWYgKCB5ID4gbWF4WSApIG1heFkgPSB5OwoJCQkJaWYgKCB6ID4gbWF4WiApIG1heFogPSB6OwoKCQkJfQoKCQkJdGhpcy5taW4uc2V0KCBtaW5YLCBtaW5ZLCBtaW5aICk7CgkJCXRoaXMubWF4LnNldCggbWF4WCwgbWF4WSwgbWF4WiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21CdWZmZXJBdHRyaWJ1dGU6IGZ1bmN0aW9uICggYXR0cmlidXRlICkgewoKCQkJdmFyIG1pblggPSArIEluZmluaXR5OwoJCQl2YXIgbWluWSA9ICsgSW5maW5pdHk7CgkJCXZhciBtaW5aID0gKyBJbmZpbml0eTsKCgkJCXZhciBtYXhYID0gLSBJbmZpbml0eTsKCQkJdmFyIG1heFkgPSAtIEluZmluaXR5OwoJCQl2YXIgbWF4WiA9IC0gSW5maW5pdHk7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBhdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciB4ID0gYXR0cmlidXRlLmdldFgoIGkgKTsKCQkJCXZhciB5ID0gYXR0cmlidXRlLmdldFkoIGkgKTsKCQkJCXZhciB6ID0gYXR0cmlidXRlLmdldFooIGkgKTsKCgkJCQlpZiAoIHggPCBtaW5YICkgbWluWCA9IHg7CgkJCQlpZiAoIHkgPCBtaW5ZICkgbWluWSA9IHk7CgkJCQlpZiAoIHogPCBtaW5aICkgbWluWiA9IHo7CgoJCQkJaWYgKCB4ID4gbWF4WCApIG1heFggPSB4OwoJCQkJaWYgKCB5ID4gbWF4WSApIG1heFkgPSB5OwoJCQkJaWYgKCB6ID4gbWF4WiApIG1heFogPSB6OwoKCQkJfQoKCQkJdGhpcy5taW4uc2V0KCBtaW5YLCBtaW5ZLCBtaW5aICk7CgkJCXRoaXMubWF4LnNldCggbWF4WCwgbWF4WSwgbWF4WiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21Qb2ludHM6IGZ1bmN0aW9uICggcG9pbnRzICkgewoKCQkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBwb2ludHNbIGkgXSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21DZW50ZXJBbmRTaXplOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHNldEZyb21DZW50ZXJBbmRTaXplKCBjZW50ZXIsIHNpemUgKSB7CgoJCQkJdmFyIGhhbGZTaXplID0gdjEuY29weSggc2l6ZSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgkJCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJCQl0aGlzLm1heC5jb3B5KCBjZW50ZXIgKS5hZGQoIGhhbGZTaXplICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXNldEZyb21PYmplY3Q6IGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJCXJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KCBvYmplY3QgKTsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBib3ggKSB7CgoJCQl0aGlzLm1pbi5jb3B5KCBib3gubWluICk7CgkJCXRoaXMubWF4LmNvcHkoIGJveC5tYXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltYWtlRW1wdHk6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMubWluLnggPSB0aGlzLm1pbi55ID0gdGhpcy5taW4ueiA9ICsgSW5maW5pdHk7CgkJCXRoaXMubWF4LnggPSB0aGlzLm1heC55ID0gdGhpcy5tYXgueiA9IC0gSW5maW5pdHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJaXNFbXB0eTogZnVuY3Rpb24gKCkgewoKCQkJLy8gdGhpcyBpcyBhIG1vcmUgcm9idXN0IGNoZWNrIGZvciBlbXB0eSB0aGFuICggdm9sdW1lIDw9IDAgKSBiZWNhdXNlIHZvbHVtZSBjYW4gZ2V0IHBvc2l0aXZlIHdpdGggdHdvIG5lZ2F0aXZlIGF4ZXMKCgkJCXJldHVybiAoIHRoaXMubWF4LnggPCB0aGlzLm1pbi54ICkgfHwgKCB0aGlzLm1heC55IDwgdGhpcy5taW4ueSApIHx8ICggdGhpcy5tYXgueiA8IHRoaXMubWluLnogKTsKCgkJfSwKCgkJZ2V0Q2VudGVyOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94MzogLmdldENlbnRlcigpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCwgMCApIDogdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMubWluLCB0aGlzLm1heCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgkJfSwKCgkJZ2V0U2l6ZTogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDM6IC5nZXRTaXplKCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5tYXgsIHRoaXMubWluICk7CgoJCX0sCgoJCWV4cGFuZEJ5UG9pbnQ6IGZ1bmN0aW9uICggcG9pbnQgKSB7CgoJCQl0aGlzLm1pbi5taW4oIHBvaW50ICk7CgkJCXRoaXMubWF4Lm1heCggcG9pbnQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlleHBhbmRCeVZlY3RvcjogZnVuY3Rpb24gKCB2ZWN0b3IgKSB7CgoJCQl0aGlzLm1pbi5zdWIoIHZlY3RvciApOwoJCQl0aGlzLm1heC5hZGQoIHZlY3RvciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWV4cGFuZEJ5U2NhbGFyOiBmdW5jdGlvbiAoIHNjYWxhciApIHsKCgkJCXRoaXMubWluLmFkZFNjYWxhciggLSBzY2FsYXIgKTsKCQkJdGhpcy5tYXguYWRkU2NhbGFyKCBzY2FsYXIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlleHBhbmRCeU9iamVjdDogZnVuY3Rpb24gKCkgewoKCQkJLy8gQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggb2YgYW4gb2JqZWN0IChpbmNsdWRpbmcgaXRzIGNoaWxkcmVuKSwKCQkJLy8gYWNjb3VudGluZyBmb3IgYm90aCB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZCB0cmFuc2Zvcm1zCgoJCQl2YXIgc2NvcGUsIGksIGw7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoKCQkJZnVuY3Rpb24gdHJhdmVyc2UoIG5vZGUgKSB7CgoJCQkJdmFyIGdlb21ldHJ5ID0gbm9kZS5nZW9tZXRyeTsKCgkJCQlpZiAoIGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWlmICggZ2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCQkJCXZhciB2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzOwoKCQkJCQkJZm9yICggaSA9IDAsIGwgPSB2ZXJ0aWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCXYxLmNvcHkoIHZlcnRpY2VzWyBpIF0gKTsKCQkJCQkJCXYxLmFwcGx5TWF0cml4NCggbm9kZS5tYXRyaXhXb3JsZCApOwoKCQkJCQkJCXNjb3BlLmV4cGFuZEJ5UG9pbnQoIHYxICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJCQl2YXIgYXR0cmlidXRlID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCQkJCWlmICggYXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJZm9yICggaSA9IDAsIGwgPSBhdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCQl2MS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkgKS5hcHBseU1hdHJpeDQoIG5vZGUubWF0cml4V29ybGQgKTsKCgkJCQkJCQkJc2NvcGUuZXhwYW5kQnlQb2ludCggdjEgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZnVuY3Rpb24gZXhwYW5kQnlPYmplY3QoIG9iamVjdCApIHsKCgkJCQlzY29wZSA9IHRoaXM7CgoJCQkJb2JqZWN0LnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQkJb2JqZWN0LnRyYXZlcnNlKCB0cmF2ZXJzZSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQljb250YWluc1BvaW50OiBmdW5jdGlvbiAoIHBvaW50ICkgewoKCQkJcmV0dXJuIHBvaW50LnggPCB0aGlzLm1pbi54IHx8IHBvaW50LnggPiB0aGlzLm1heC54IHx8CgkJCQlwb2ludC55IDwgdGhpcy5taW4ueSB8fCBwb2ludC55ID4gdGhpcy5tYXgueSB8fAoJCQkJcG9pbnQueiA8IHRoaXMubWluLnogfHwgcG9pbnQueiA+IHRoaXMubWF4LnogPyBmYWxzZSA6IHRydWU7CgoJCX0sCgoJCWNvbnRhaW5zQm94OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJgoJCQkJdGhpcy5taW4ueSA8PSBib3gubWluLnkgJiYgYm94Lm1heC55IDw9IHRoaXMubWF4LnkgJiYKCQkJCXRoaXMubWluLnogPD0gYm94Lm1pbi56ICYmIGJveC5tYXgueiA8PSB0aGlzLm1heC56OwoKCQl9LAoKCQlnZXRQYXJhbWV0ZXI6IGZ1bmN0aW9uICggcG9pbnQsIHRhcmdldCApIHsKCgkJCS8vIFRoaXMgY2FuIHBvdGVudGlhbGx5IGhhdmUgYSBkaXZpZGUgYnkgemVybyBpZiB0aGUgYm94CgkJCS8vIGhhcyBhIHNpemUgZGltZW5zaW9uIG9mIDAuCgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDM6IC5nZXRQYXJhbWV0ZXIoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuc2V0KAoJCQkJKCBwb2ludC54IC0gdGhpcy5taW4ueCApIC8gKCB0aGlzLm1heC54IC0gdGhpcy5taW4ueCApLAoJCQkJKCBwb2ludC55IC0gdGhpcy5taW4ueSApIC8gKCB0aGlzLm1heC55IC0gdGhpcy5taW4ueSApLAoJCQkJKCBwb2ludC56IC0gdGhpcy5taW4ueiApIC8gKCB0aGlzLm1heC56IC0gdGhpcy5taW4ueiApCgkJCSk7CgoJCX0sCgoJCWludGVyc2VjdHNCb3g6IGZ1bmN0aW9uICggYm94ICkgewoKCQkJLy8gdXNpbmcgNiBzcGxpdHRpbmcgcGxhbmVzIHRvIHJ1bGUgb3V0IGludGVyc2VjdGlvbnMuCgkJCXJldHVybiBib3gubWF4LnggPCB0aGlzLm1pbi54IHx8IGJveC5taW4ueCA+IHRoaXMubWF4LnggfHwKCQkJCWJveC5tYXgueSA8IHRoaXMubWluLnkgfHwgYm94Lm1pbi55ID4gdGhpcy5tYXgueSB8fAoJCQkJYm94Lm1heC56IDwgdGhpcy5taW4ueiB8fCBib3gubWluLnogPiB0aGlzLm1heC56ID8gZmFsc2UgOiB0cnVlOwoKCQl9LAoKCQlpbnRlcnNlY3RzU3BoZXJlOiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBjbG9zZXN0UG9pbnQgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJCQkvLyBGaW5kIHRoZSBwb2ludCBvbiB0aGUgQUFCQiBjbG9zZXN0IHRvIHRoZSBzcGhlcmUgY2VudGVyLgoJCQkJdGhpcy5jbGFtcFBvaW50KCBzcGhlcmUuY2VudGVyLCBjbG9zZXN0UG9pbnQgKTsKCgkJCQkvLyBJZiB0aGF0IHBvaW50IGlzIGluc2lkZSB0aGUgc3BoZXJlLCB0aGUgQUFCQiBhbmQgc3BoZXJlIGludGVyc2VjdC4KCQkJCXJldHVybiBjbG9zZXN0UG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgoJCQl9OwoKCQl9ICkoKSwKCgkJaW50ZXJzZWN0c1BsYW5lOiBmdW5jdGlvbiAoIHBsYW5lICkgewoKCQkJLy8gV2UgY29tcHV0ZSB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBkb3QgcHJvZHVjdCB2YWx1ZXMuIElmIHRob3NlIHZhbHVlcwoJCQkvLyBhcmUgb24gdGhlIHNhbWUgc2lkZSAoYmFjayBvciBmcm9udCkgb2YgdGhlIHBsYW5lLCB0aGVuIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCgkJCXZhciBtaW4sIG1heDsKCgkJCWlmICggcGxhbmUubm9ybWFsLnggPiAwICkgewoKCQkJCW1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5taW4ueDsKCQkJCW1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKCgkJCX0gZWxzZSB7CgoJCQkJbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoJCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwoKCQkJfQoKCQkJaWYgKCBwbGFuZS5ub3JtYWwueSA+IDAgKSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5taW4ueTsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWF4Lnk7CgoJCQl9IGVsc2UgewoKCQkJCW1pbiArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWF4Lnk7CgkJCQltYXggKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwoKCQkJfQoKCQkJaWYgKCBwbGFuZS5ub3JtYWwueiA+IDAgKSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5taW4uejsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWF4Lno7CgoJCQl9IGVsc2UgewoKCQkJCW1pbiArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWF4Lno7CgkJCQltYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwoKCQkJfQoKCQkJcmV0dXJuICggbWluIDw9IC0gcGxhbmUuY29uc3RhbnQgJiYgbWF4ID49IC0gcGxhbmUuY29uc3RhbnQgKTsKCgkJfSwKCgkJaW50ZXJzZWN0c1RyaWFuZ2xlOiAoIGZ1bmN0aW9uICgpIHsKCgkJCS8vIHRyaWFuZ2xlIGNlbnRlcmVkIHZlcnRpY2VzCgkJCXZhciB2MCA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MiA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvLyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMKCQkJdmFyIGYwID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGYxID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGYyID0gbmV3IFZlY3RvcjMoKTsKCgkJCXZhciB0ZXN0QXhpcyA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgY2VudGVyID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGV4dGVudHMgPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIHRyaWFuZ2xlTm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJCWZ1bmN0aW9uIHNhdEZvckF4ZXMoIGF4ZXMgKSB7CgoJCQkJdmFyIGksIGo7CgoJCQkJZm9yICggaSA9IDAsIGogPSBheGVzLmxlbmd0aCAtIDM7IGkgPD0gajsgaSArPSAzICkgewoKCQkJCQl0ZXN0QXhpcy5mcm9tQXJyYXkoIGF4ZXMsIGkgKTsKCQkJCQkvLyBwcm9qZWN0IHRoZSBhYWJiIG9udG8gdGhlIHNlcGVyYXRpbmcgYXhpcwoJCQkJCXZhciByID0gZXh0ZW50cy54ICogTWF0aC5hYnMoIHRlc3RBeGlzLnggKSArIGV4dGVudHMueSAqIE1hdGguYWJzKCB0ZXN0QXhpcy55ICkgKyBleHRlbnRzLnogKiBNYXRoLmFicyggdGVzdEF4aXMueiApOwoJCQkJCS8vIHByb2plY3QgYWxsIDMgdmVydGljZXMgb2YgdGhlIHRyaWFuZ2xlIG9udG8gdGhlIHNlcGVyYXRpbmcgYXhpcwoJCQkJCXZhciBwMCA9IHYwLmRvdCggdGVzdEF4aXMgKTsKCQkJCQl2YXIgcDEgPSB2MS5kb3QoIHRlc3RBeGlzICk7CgkJCQkJdmFyIHAyID0gdjIuZG90KCB0ZXN0QXhpcyApOwoJCQkJCS8vIGFjdHVhbCB0ZXN0LCBiYXNpY2FsbHkgc2VlIGlmIGVpdGhlciBvZiB0aGUgbW9zdCBleHRyZW1lIG9mIHRoZSB0cmlhbmdsZSBwb2ludHMgaW50ZXJzZWN0cyByCgkJCQkJaWYgKCBNYXRoLm1heCggLSBNYXRoLm1heCggcDAsIHAxLCBwMiApLCBNYXRoLm1pbiggcDAsIHAxLCBwMiApICkgPiByICkgewoKCQkJCQkJLy8gcG9pbnRzIG9mIHRoZSBwcm9qZWN0ZWQgdHJpYW5nbGUgYXJlIG91dHNpZGUgdGhlIHByb2plY3RlZCBoYWxmLWxlbmd0aCBvZiB0aGUgYWFiYgoJCQkJCQkvLyB0aGUgYXhpcyBpcyBzZXBlcmF0aW5nIGFuZCB3ZSBjYW4gZXhpdAoJCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIHRydWU7CgoJCQl9CgoJCQlyZXR1cm4gZnVuY3Rpb24gaW50ZXJzZWN0c1RyaWFuZ2xlKCB0cmlhbmdsZSApIHsKCgkJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJCS8vIGNvbXB1dGUgYm94IGNlbnRlciBhbmQgZXh0ZW50cwoJCQkJdGhpcy5nZXRDZW50ZXIoIGNlbnRlciApOwoJCQkJZXh0ZW50cy5zdWJWZWN0b3JzKCB0aGlzLm1heCwgY2VudGVyICk7CgoJCQkJLy8gdHJhbnNsYXRlIHRyaWFuZ2xlIHRvIGFhYmIgb3JpZ2luCgkJCQl2MC5zdWJWZWN0b3JzKCB0cmlhbmdsZS5hLCBjZW50ZXIgKTsKCQkJCXYxLnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmIsIGNlbnRlciApOwoJCQkJdjIuc3ViVmVjdG9ycyggdHJpYW5nbGUuYywgY2VudGVyICk7CgoJCQkJLy8gY29tcHV0ZSBlZGdlIHZlY3RvcnMgZm9yIHRyaWFuZ2xlCgkJCQlmMC5zdWJWZWN0b3JzKCB2MSwgdjAgKTsKCQkJCWYxLnN1YlZlY3RvcnMoIHYyLCB2MSApOwoJCQkJZjIuc3ViVmVjdG9ycyggdjAsIHYyICk7CgoJCQkJLy8gdGVzdCBhZ2FpbnN0IGF4ZXMgdGhhdCBhcmUgZ2l2ZW4gYnkgY3Jvc3MgcHJvZHVjdCBjb21iaW5hdGlvbnMgb2YgdGhlIGVkZ2VzIG9mIHRoZSB0cmlhbmdsZSBhbmQgdGhlIGVkZ2VzIG9mIHRoZSBhYWJiCgkJCQkvLyBtYWtlIGFuIGF4aXMgdGVzdGluZyBvZiBlYWNoIG9mIHRoZSAzIHNpZGVzIG9mIHRoZSBhYWJiIGFnYWluc3QgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgdHJpYW5nbGUgPSA5IGF4aXMgb2Ygc2VwYXJhdGlvbgoJCQkJLy8gYXhpc19paiA9IHVfaSB4IGZfaiAodTAsIHUxLCB1MiA9IGZhY2Ugbm9ybWFscyBvZiBhYWJiID0geCx5LHogYXhlcyB2ZWN0b3JzIHNpbmNlIGFhYmIgaXMgYXhpcyBhbGlnbmVkKQoJCQkJdmFyIGF4ZXMgPSBbCgkJCQkJMCwgLSBmMC56LCBmMC55LCAwLCAtIGYxLnosIGYxLnksIDAsIC0gZjIueiwgZjIueSwKCQkJCQlmMC56LCAwLCAtIGYwLngsIGYxLnosIDAsIC0gZjEueCwgZjIueiwgMCwgLSBmMi54LAoJCQkJCS0gZjAueSwgZjAueCwgMCwgLSBmMS55LCBmMS54LCAwLCAtIGYyLnksIGYyLngsIDAKCQkJCV07CgkJCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcyApICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJCS8vIHRlc3QgMyBmYWNlIG5vcm1hbHMgZnJvbSB0aGUgYWFiYgoJCQkJYXhlcyA9IFsgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSBdOwoJCQkJaWYgKCAhIHNhdEZvckF4ZXMoIGF4ZXMgKSApIHsKCgkJCQkJcmV0dXJuIGZhbHNlOwoKCQkJCX0KCgkJCQkvLyBmaW5hbGx5IHRlc3RpbmcgdGhlIGZhY2Ugbm9ybWFsIG9mIHRoZSB0cmlhbmdsZQoJCQkJLy8gdXNlIGFscmVhZHkgZXhpc3RpbmcgdHJpYW5nbGUgZWRnZSB2ZWN0b3JzIGhlcmUKCQkJCXRyaWFuZ2xlTm9ybWFsLmNyb3NzVmVjdG9ycyggZjAsIGYxICk7CgkJCQlheGVzID0gWyB0cmlhbmdsZU5vcm1hbC54LCB0cmlhbmdsZU5vcm1hbC55LCB0cmlhbmdsZU5vcm1hbC56IF07CgkJCQlyZXR1cm4gc2F0Rm9yQXhlcyggYXhlcyApOwoKCQkJfTsKCgkJfSApKCksCgoJCWNsYW1wUG9pbnQ6IGZ1bmN0aW9uICggcG9pbnQsIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94MzogLmNsYW1wUG9pbnQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5jbGFtcCggdGhpcy5taW4sIHRoaXMubWF4ICk7CgoJCX0sCgoJCWRpc3RhbmNlVG9Qb2ludDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQkJCXZhciBjbGFtcGVkUG9pbnQgPSB2MS5jb3B5KCBwb2ludCApLmNsYW1wKCB0aGlzLm1pbiwgdGhpcy5tYXggKTsKCQkJCXJldHVybiBjbGFtcGVkUG9pbnQuc3ViKCBwb2ludCApLmxlbmd0aCgpOwoKCQkJfTsKCgkJfSgpLAoKCQlnZXRCb3VuZGluZ1NwaGVyZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBnZXRCb3VuZGluZ1NwaGVyZSggdGFyZ2V0ICkgewoKCQkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDM6IC5nZXRCb3VuZGluZ1NwaGVyZSgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQkJdGFyZ2V0ID0gbmV3IFNwaGVyZSgpOwoKCQkJCX0KCgkJCQl0aGlzLmdldENlbnRlciggdGFyZ2V0LmNlbnRlciApOwoKCQkJCXRhcmdldC5yYWRpdXMgPSB0aGlzLmdldFNpemUoIHYxICkubGVuZ3RoKCkgKiAwLjU7CgoJCQkJcmV0dXJuIHRhcmdldDsKCgkJCX07CgoJCX0oKSwKCgkJaW50ZXJzZWN0OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXRoaXMubWluLm1heCggYm94Lm1pbiApOwoJCQl0aGlzLm1heC5taW4oIGJveC5tYXggKTsKCgkJCS8vIGVuc3VyZSB0aGF0IGlmIHRoZXJlIGlzIG5vIG92ZXJsYXAsIHRoZSByZXN1bHQgaXMgZnVsbHkgZW1wdHksIG5vdCBzbGlnaHRseSBlbXB0eSB3aXRoIG5vbi1pbmYvK2luZiB2YWx1ZXMgdGhhdCB3aWxsIGNhdXNlIHN1YnNlcXVlbmNlIGludGVyc2VjdHMgdG8gZXJyb25lb3VzbHkgcmV0dXJuIHZhbGlkIHZhbHVlcy4KCQkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHRoaXMubWFrZUVtcHR5KCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdW5pb246IGZ1bmN0aW9uICggYm94ICkgewoKCQkJdGhpcy5taW4ubWluKCBib3gubWluICk7CgkJCXRoaXMubWF4Lm1heCggYm94Lm1heCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFwcGx5TWF0cml4NDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHBvaW50cyA9IFsKCQkJCW5ldyBWZWN0b3IzKCksCgkJCQluZXcgVmVjdG9yMygpLAoJCQkJbmV3IFZlY3RvcjMoKSwKCQkJCW5ldyBWZWN0b3IzKCksCgkJCQluZXcgVmVjdG9yMygpLAoJCQkJbmV3IFZlY3RvcjMoKSwKCQkJCW5ldyBWZWN0b3IzKCksCgkJCQluZXcgVmVjdG9yMygpCgkJCV07CgoJCQlyZXR1cm4gZnVuY3Rpb24gYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCQkJLy8gdHJhbnNmb3JtIG9mIGVtcHR5IGJveCBpcyBhbiBlbXB0eSBib3guCgkJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgcmV0dXJuIHRoaXM7CgoJCQkJLy8gTk9URTogSSBhbSB1c2luZyBhIGJpbmFyeSBwYXR0ZXJuIHRvIHNwZWNpZnkgYWxsIDJeMyBjb21iaW5hdGlvbnMgYmVsb3cKCQkJCXBvaW50c1sgMCBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMAoJCQkJcG9pbnRzWyAxIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDAxCgkJCQlwb2ludHNbIDIgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTAKCQkJCXBvaW50c1sgMyBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAxMQoJCQkJcG9pbnRzWyA0IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAwCgkJCQlwb2ludHNbIDUgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWluLnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMDEKCQkJCXBvaW50c1sgNiBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMAoJCQkJcG9pbnRzWyA3IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1heC55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTExCgoJCQkJdGhpcy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJdHJhbnNsYXRlOiBmdW5jdGlvbiAoIG9mZnNldCApIHsKCgkJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJCXRoaXMubWF4LmFkZCggb2Zmc2V0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXJldHVybiBib3gubWluLmVxdWFscyggdGhpcy5taW4gKSAmJiBib3gubWF4LmVxdWFscyggdGhpcy5tYXggKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBTcGhlcmUoIGNlbnRlciwgcmFkaXVzICkgewoKCQl0aGlzLmNlbnRlciA9ICggY2VudGVyICE9PSB1bmRlZmluZWQgKSA/IGNlbnRlciA6IG5ldyBWZWN0b3IzKCk7CgkJdGhpcy5yYWRpdXMgPSAoIHJhZGl1cyAhPT0gdW5kZWZpbmVkICkgPyByYWRpdXMgOiAwOwoKCX0KCglPYmplY3QuYXNzaWduKCBTcGhlcmUucHJvdG90eXBlLCB7CgoJCXNldDogZnVuY3Rpb24gKCBjZW50ZXIsIHJhZGl1cyApIHsKCgkJCXRoaXMuY2VudGVyLmNvcHkoIGNlbnRlciApOwoJCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tUG9pbnRzOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgYm94ID0gbmV3IEJveDMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKCQkJCXZhciBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKCgkJCQlpZiAoIG9wdGlvbmFsQ2VudGVyICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNlbnRlci5jb3B5KCBvcHRpb25hbENlbnRlciApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWJveC5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKS5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJCX0KCgkJCQl2YXIgbWF4UmFkaXVzU3EgPSAwOwoKCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50c1sgaSBdICkgKTsKCgkJCQl9CgoJCQkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc3BoZXJlICkgewoKCQkJdGhpcy5jZW50ZXIuY29weSggc3BoZXJlLmNlbnRlciApOwoJCQl0aGlzLnJhZGl1cyA9IHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZW1wdHk6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiAoIHRoaXMucmFkaXVzIDw9IDAgKTsKCgkJfSwKCgkJY29udGFpbnNQb2ludDogZnVuY3Rpb24gKCBwb2ludCApIHsKCgkJCXJldHVybiAoIHBvaW50LmRpc3RhbmNlVG9TcXVhcmVkKCB0aGlzLmNlbnRlciApIDw9ICggdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyApICk7CgoJCX0sCgoJCWRpc3RhbmNlVG9Qb2ludDogZnVuY3Rpb24gKCBwb2ludCApIHsKCgkJCXJldHVybiAoIHBvaW50LmRpc3RhbmNlVG8oIHRoaXMuY2VudGVyICkgLSB0aGlzLnJhZGl1cyApOwoKCQl9LAoKCQlpbnRlcnNlY3RzU3BoZXJlOiBmdW5jdGlvbiAoIHNwaGVyZSApIHsKCgkJCXZhciByYWRpdXNTdW0gPSB0aGlzLnJhZGl1cyArIHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKCQl9LAoKCQlpbnRlcnNlY3RzQm94OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXJldHVybiBib3guaW50ZXJzZWN0c1NwaGVyZSggdGhpcyApOwoKCQl9LAoKCQlpbnRlcnNlY3RzUGxhbmU6IGZ1bmN0aW9uICggcGxhbmUgKSB7CgoJCQlyZXR1cm4gTWF0aC5hYnMoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5jZW50ZXIgKSApIDw9IHRoaXMucmFkaXVzOwoKCQl9LAoKCQljbGFtcFBvaW50OiBmdW5jdGlvbiAoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQl2YXIgZGVsdGFMZW5ndGhTcSA9IHRoaXMuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBwb2ludCApOwoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5TcGhlcmU6IC5jbGFtcFBvaW50KCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQl0YXJnZXQuY29weSggcG9pbnQgKTsKCgkJCWlmICggZGVsdGFMZW5ndGhTcSA+ICggdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyApICkgewoKCQkJCXRhcmdldC5zdWIoIHRoaXMuY2VudGVyICkubm9ybWFsaXplKCk7CgkJCQl0YXJnZXQubXVsdGlwbHlTY2FsYXIoIHRoaXMucmFkaXVzICkuYWRkKCB0aGlzLmNlbnRlciApOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldDsKCgkJfSwKCgkJZ2V0Qm91bmRpbmdCb3g6IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5TcGhlcmU6IC5nZXRCb3VuZGluZ0JveCgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgQm94MygpOwoKCQkJfQoKCQkJdGFyZ2V0LnNldCggdGhpcy5jZW50ZXIsIHRoaXMuY2VudGVyICk7CgkJCXRhcmdldC5leHBhbmRCeVNjYWxhciggdGhpcy5yYWRpdXMgKTsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0sCgoJCWFwcGx5TWF0cml4NDogZnVuY3Rpb24gKCBtYXRyaXggKSB7CgoJCQl0aGlzLmNlbnRlci5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoJCQl0aGlzLnJhZGl1cyA9IHRoaXMucmFkaXVzICogbWF0cml4LmdldE1heFNjYWxlT25BeGlzKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdHJhbnNsYXRlOiBmdW5jdGlvbiAoIG9mZnNldCApIHsKCgkJCXRoaXMuY2VudGVyLmFkZCggb2Zmc2V0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIHNwaGVyZSApIHsKCgkJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKi8KCglmdW5jdGlvbiBQbGFuZSggbm9ybWFsLCBjb25zdGFudCApIHsKCgkJLy8gbm9ybWFsIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKCQl0aGlzLm5vcm1hbCA9ICggbm9ybWFsICE9PSB1bmRlZmluZWQgKSA/IG5vcm1hbCA6IG5ldyBWZWN0b3IzKCAxLCAwLCAwICk7CgkJdGhpcy5jb25zdGFudCA9ICggY29uc3RhbnQgIT09IHVuZGVmaW5lZCApID8gY29uc3RhbnQgOiAwOwoKCX0KCglPYmplY3QuYXNzaWduKCBQbGFuZS5wcm90b3R5cGUsIHsKCgkJc2V0OiBmdW5jdGlvbiAoIG5vcm1hbCwgY29uc3RhbnQgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldENvbXBvbmVudHM6IGZ1bmN0aW9uICggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMubm9ybWFsLnNldCggeCwgeSwgeiApOwoJCQl0aGlzLmNvbnN0YW50ID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludDogZnVuY3Rpb24gKCBub3JtYWwsIHBvaW50ICkgewoKCQkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJCXRoaXMuY29uc3RhbnQgPSAtIHBvaW50LmRvdCggdGhpcy5ub3JtYWwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tQ29wbGFuYXJQb2ludHM6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gc2V0RnJvbUNvcGxhbmFyUG9pbnRzKCBhLCBiLCBjICkgewoKCQkJCXZhciBub3JtYWwgPSB2MS5zdWJWZWN0b3JzKCBjLCBiICkuY3Jvc3MoIHYyLnN1YlZlY3RvcnMoIGEsIGIgKSApLm5vcm1hbGl6ZSgpOwoKCQkJCS8vIFE6IHNob3VsZCBhbiBlcnJvciBiZSB0aHJvd24gaWYgbm9ybWFsIGlzIHplcm8gKGUuZy4gZGVnZW5lcmF0ZSBwbGFuZSk/CgoJCQkJdGhpcy5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBhICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggcGxhbmUgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IHBsYW5lLmNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW5vcm1hbGl6ZTogZnVuY3Rpb24gKCkgewoKCQkJLy8gTm90ZTogd2lsbCBsZWFkIHRvIGEgZGl2aWRlIGJ5IHplcm8gaWYgdGhlIHBsYW5lIGlzIGludmFsaWQuCgoJCQl2YXIgaW52ZXJzZU5vcm1hbExlbmd0aCA9IDEuMCAvIHRoaXMubm9ybWFsLmxlbmd0aCgpOwoJCQl0aGlzLm5vcm1hbC5tdWx0aXBseVNjYWxhciggaW52ZXJzZU5vcm1hbExlbmd0aCApOwoJCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbmVnYXRlOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmNvbnN0YW50ICo9IC0gMTsKCQkJdGhpcy5ub3JtYWwubmVnYXRlKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZGlzdGFuY2VUb1BvaW50OiBmdW5jdGlvbiAoIHBvaW50ICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgoJCX0sCgoJCWRpc3RhbmNlVG9TcGhlcmU6IGZ1bmN0aW9uICggc3BoZXJlICkgewoKCQkJcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgLSBzcGhlcmUucmFkaXVzOwoKCQl9LAoKCQlwcm9qZWN0UG9pbnQ6IGZ1bmN0aW9uICggcG9pbnQsIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUGxhbmU6IC5wcm9qZWN0UG9pbnQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5ub3JtYWwgKS5tdWx0aXBseVNjYWxhciggLSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSApLmFkZCggcG9pbnQgKTsKCgkJfSwKCgkJaW50ZXJzZWN0TGluZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBpbnRlcnNlY3RMaW5lKCBsaW5lLCB0YXJnZXQgKSB7CgoJCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUGxhbmU6IC5pbnRlcnNlY3RMaW5lKCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJCX0KCgkJCQl2YXIgZGlyZWN0aW9uID0gbGluZS5kZWx0YSggdjEgKTsKCgkJCQl2YXIgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKCQkJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkJCS8vIGxpbmUgaXMgY29wbGFuYXIsIHJldHVybiBvcmlnaW4KCQkJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgoJCQkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGxpbmUuc3RhcnQgKTsKCgkJCQkJfQoKCQkJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KCQkJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQkJCX0KCgkJCQl2YXIgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkJCWlmICggdCA8IDAgfHwgdCA+IDEgKSB7CgoJCQkJCXJldHVybiB1bmRlZmluZWQ7CgoJCQkJfQoKCQkJCXJldHVybiB0YXJnZXQuY29weSggZGlyZWN0aW9uICkubXVsdGlwbHlTY2FsYXIoIHQgKS5hZGQoIGxpbmUuc3RhcnQgKTsKCgkJCX07CgoJCX0oKSwKCgkJaW50ZXJzZWN0c0xpbmU6IGZ1bmN0aW9uICggbGluZSApIHsKCgkJCS8vIE5vdGU6IHRoaXMgdGVzdHMgaWYgYSBsaW5lIGludGVyc2VjdHMgdGhlIHBsYW5lLCBub3Qgd2hldGhlciBpdCAob3IgaXRzIGVuZC1wb2ludHMpIGFyZSBjb3BsYW5hciB3aXRoIGl0LgoKCQkJdmFyIHN0YXJ0U2lnbiA9IHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICk7CgkJCXZhciBlbmRTaWduID0gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIGxpbmUuZW5kICk7CgoJCQlyZXR1cm4gKCBzdGFydFNpZ24gPCAwICYmIGVuZFNpZ24gPiAwICkgfHwgKCBlbmRTaWduIDwgMCAmJiBzdGFydFNpZ24gPiAwICk7CgoJCX0sCgoJCWludGVyc2VjdHNCb3g6IGZ1bmN0aW9uICggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCgkJfSwKCgkJaW50ZXJzZWN0c1NwaGVyZTogZnVuY3Rpb24gKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gc3BoZXJlLmludGVyc2VjdHNQbGFuZSggdGhpcyApOwoKCQl9LAoKCQljb3BsYW5hclBvaW50OiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUGxhbmU6IC5jb3BsYW5hclBvaW50KCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMubm9ybWFsICkubXVsdGlwbHlTY2FsYXIoIC0gdGhpcy5jb25zdGFudCApOwoKCQl9LAoKCQlhcHBseU1hdHJpeDQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciBtMSA9IG5ldyBNYXRyaXgzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gYXBwbHlNYXRyaXg0KCBtYXRyaXgsIG9wdGlvbmFsTm9ybWFsTWF0cml4ICkgewoKCQkJCXZhciBub3JtYWxNYXRyaXggPSBvcHRpb25hbE5vcm1hbE1hdHJpeCB8fCBtMS5nZXROb3JtYWxNYXRyaXgoIG1hdHJpeCApOwoKCQkJCXZhciByZWZlcmVuY2VQb2ludCA9IHRoaXMuY29wbGFuYXJQb2ludCggdjEgKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJCXZhciBub3JtYWwgPSB0aGlzLm5vcm1hbC5hcHBseU1hdHJpeDMoIG5vcm1hbE1hdHJpeCApLm5vcm1hbGl6ZSgpOwoKCQkJCXRoaXMuY29uc3RhbnQgPSAtIHJlZmVyZW5jZVBvaW50LmRvdCggbm9ybWFsICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXRyYW5zbGF0ZTogZnVuY3Rpb24gKCBvZmZzZXQgKSB7CgoJCQl0aGlzLmNvbnN0YW50IC09IG9mZnNldC5kb3QoIHRoaXMubm9ybWFsICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIHBsYW5lICkgewoKCQkJcmV0dXJuIHBsYW5lLm5vcm1hbC5lcXVhbHMoIHRoaXMubm9ybWFsICkgJiYgKCBwbGFuZS5jb25zdGFudCA9PT0gdGhpcy5jb25zdGFudCApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKi8KCglmdW5jdGlvbiBGcnVzdHVtKCBwMCwgcDEsIHAyLCBwMywgcDQsIHA1ICkgewoKCQl0aGlzLnBsYW5lcyA9IFsKCgkJCSggcDAgIT09IHVuZGVmaW5lZCApID8gcDAgOiBuZXcgUGxhbmUoKSwKCQkJKCBwMSAhPT0gdW5kZWZpbmVkICkgPyBwMSA6IG5ldyBQbGFuZSgpLAoJCQkoIHAyICE9PSB1bmRlZmluZWQgKSA/IHAyIDogbmV3IFBsYW5lKCksCgkJCSggcDMgIT09IHVuZGVmaW5lZCApID8gcDMgOiBuZXcgUGxhbmUoKSwKCQkJKCBwNCAhPT0gdW5kZWZpbmVkICkgPyBwNCA6IG5ldyBQbGFuZSgpLAoJCQkoIHA1ICE9PSB1bmRlZmluZWQgKSA/IHA1IDogbmV3IFBsYW5lKCkKCgkJXTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggRnJ1c3R1bS5wcm90b3R5cGUsIHsKCgkJc2V0OiBmdW5jdGlvbiAoIHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUgKSB7CgoJCQl2YXIgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgoJCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwoJCQlwbGFuZXNbIDEgXS5jb3B5KCBwMSApOwoJCQlwbGFuZXNbIDIgXS5jb3B5KCBwMiApOwoJCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwoJCQlwbGFuZXNbIDQgXS5jb3B5KCBwNCApOwoJCQlwbGFuZXNbIDUgXS5jb3B5KCBwNSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggZnJ1c3R1bSApIHsKCgkJCXZhciBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21NYXRyaXg6IGZ1bmN0aW9uICggbSApIHsKCgkJCXZhciBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCQkJdmFyIG1lID0gbS5lbGVtZW50czsKCQkJdmFyIG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CgkJCXZhciBtZTQgPSBtZVsgNCBdLCBtZTUgPSBtZVsgNSBdLCBtZTYgPSBtZVsgNiBdLCBtZTcgPSBtZVsgNyBdOwoJCQl2YXIgbWU4ID0gbWVbIDggXSwgbWU5ID0gbWVbIDkgXSwgbWUxMCA9IG1lWyAxMCBdLCBtZTExID0gbWVbIDExIF07CgkJCXZhciBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgoJCQlwbGFuZXNbIDAgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTIgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyAxIF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUwLCBtZTcgKyBtZTQsIG1lMTEgKyBtZTgsIG1lMTUgKyBtZTEyICkubm9ybWFsaXplKCk7CgkJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwoJCQlwbGFuZXNbIDMgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTMgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyA0IF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUyLCBtZTcgLSBtZTYsIG1lMTEgLSBtZTEwLCBtZTE1IC0gbWUxNCApLm5vcm1hbGl6ZSgpOwoJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTMgKyBtZTIsIG1lNyArIG1lNiwgbWUxMSArIG1lMTAsIG1lMTUgKyBtZTE0ICkubm9ybWFsaXplKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJaW50ZXJzZWN0c09iamVjdDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHNwaGVyZSA9IG5ldyBTcGhlcmUoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBpbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSB7CgoJCQkJdmFyIGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoKCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKQoJCQkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQkJCXNwaGVyZS5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSApCgkJCQkJLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICk7CgoJCQl9OwoKCQl9KCksCgoJCWludGVyc2VjdHNTcHJpdGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBzcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gaW50ZXJzZWN0c1Nwcml0ZSggc3ByaXRlICkgewoKCQkJCXNwaGVyZS5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJCQlzcGhlcmUucmFkaXVzID0gMC43MDcxMDY3ODExODY1NDc2OwoJCQkJc3BoZXJlLmFwcGx5TWF0cml4NCggc3ByaXRlLm1hdHJpeFdvcmxkICk7CgoJCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICk7CgoJCQl9OwoKCQl9KCksCgoJCWludGVyc2VjdHNTcGhlcmU6IGZ1bmN0aW9uICggc3BoZXJlICkgewoKCQkJdmFyIHBsYW5lcyA9IHRoaXMucGxhbmVzOwoJCQl2YXIgY2VudGVyID0gc3BoZXJlLmNlbnRlcjsKCQkJdmFyIG5lZ1JhZGl1cyA9IC0gc3BoZXJlLnJhZGl1czsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJdmFyIGRpc3RhbmNlID0gcGxhbmVzWyBpIF0uZGlzdGFuY2VUb1BvaW50KCBjZW50ZXIgKTsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgbmVnUmFkaXVzICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0sCgoJCWludGVyc2VjdHNCb3g6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBwID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCQkJdmFyIHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCXZhciBwbGFuZSA9IHBsYW5lc1sgaSBdOwoKCQkJCQkvLyBjb3JuZXIgYXQgbWF4IGRpc3RhbmNlCgoJCQkJCXAueCA9IHBsYW5lLm5vcm1hbC54ID4gMCA/IGJveC5tYXgueCA6IGJveC5taW4ueDsKCQkJCQlwLnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CgkJCQkJcC56ID0gcGxhbmUubm9ybWFsLnogPiAwID8gYm94Lm1heC56IDogYm94Lm1pbi56OwoKCQkJCQlpZiAoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggcCApIDwgMCApIHsKCgkJCQkJCXJldHVybiBmYWxzZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX07CgoJCX0oKSwKCgkJY29udGFpbnNQb2ludDogZnVuY3Rpb24gKCBwb2ludCApIHsKCgkJCXZhciBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJaWYgKCBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgPCAwICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgl9ICk7CgoJdmFyIGFscGhhbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdlV2ICkuZztcbiNlbmRpZiI7CgoJdmFyIGFscGhhbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgoJdmFyIGFscGhhdGVzdF9mcmFnbWVudCA9ICIjaWZkZWYgQUxQSEFURVNUXG5cdGlmICggZGlmZnVzZUNvbG9yLmEgPCBBTFBIQVRFU1QgKSBkaXNjYXJkO1xuI2VuZGlmIjsKCgl2YXIgYW9tYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHRmbG9hdCBhbWJpZW50T2NjbHVzaW9uID0gKCB0ZXh0dXJlMkQoIGFvTWFwLCB2VXYyICkuciAtIDEuMCApICogYW9NYXBJbnRlbnNpdHkgKyAxLjA7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFBIWVNJQ0FMIClcblx0XHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZ2VvbWV0cnkudmlld0RpciApICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciAqPSBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGRvdE5WLCBhbWJpZW50T2NjbHVzaW9uLCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7CgoJdmFyIGJlZ2luX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkID0gdmVjMyggcG9zaXRpb24gKTsiOwoKCXZhciBiZWdpbm5vcm1hbF92ZXJ0ZXggPSAidmVjMyBvYmplY3ROb3JtYWwgPSB2ZWMzKCBub3JtYWwgKTtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIG9iamVjdFRhbmdlbnQgPSB2ZWMzKCB0YW5nZW50Lnh5eiApO1xuI2VuZGlmIjsKCgl2YXIgYnNkZnMgPSAidmVjMiBpbnRlZ3JhdGVTcGVjdWxhckJSREYoIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGNvbnN0IHZlYzQgYzAgPSB2ZWM0KCAtIDEsIC0gMC4wMjc1LCAtIDAuNTcyLCAwLjAyMiApO1xuXHRjb25zdCB2ZWM0IGMxID0gdmVjNCggMSwgMC4wNDI1LCAxLjA0LCAtIDAuMDQgKTtcblx0dmVjNCByID0gcm91Z2huZXNzICogYzAgKyBjMTtcblx0ZmxvYXQgYTAwNCA9IG1pbiggci54ICogci54LCBleHAyKCAtIDkuMjggKiBkb3ROViApICkgKiByLnggKyByLnk7XG5cdHJldHVybiB2ZWMyKCAtMS4wNCwgMS4wNCApICogYTAwNCArIHIuenc7XG59XG5mbG9hdCBwdW5jdHVhbExpZ2h0SW50ZW5zaXR5VG9JcnJhZGlhbmNlRmFjdG9yKCBjb25zdCBpbiBmbG9hdCBsaWdodERpc3RhbmNlLCBjb25zdCBpbiBmbG9hdCBjdXRvZmZEaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgZGVjYXlFeHBvbmVudCApIHtcbiNpZiBkZWZpbmVkICggUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUUyApXG5cdGZsb2F0IGRpc3RhbmNlRmFsbG9mZiA9IDEuMCAvIG1heCggcG93KCBsaWdodERpc3RhbmNlLCBkZWNheUV4cG9uZW50ICksIDAuMDEgKTtcblx0aWYoIGN1dG9mZkRpc3RhbmNlID4gMC4wICkge1xuXHRcdGRpc3RhbmNlRmFsbG9mZiAqPSBwb3cyKCBzYXR1cmF0ZSggMS4wIC0gcG93NCggbGlnaHREaXN0YW5jZSAvIGN1dG9mZkRpc3RhbmNlICkgKSApO1xuXHR9XG5cdHJldHVybiBkaXN0YW5jZUZhbGxvZmY7XG4jZWxzZVxuXHRpZiggY3V0b2ZmRGlzdGFuY2UgPiAwLjAgJiYgZGVjYXlFeHBvbmVudCA+IDAuMCApIHtcblx0XHRyZXR1cm4gcG93KCBzYXR1cmF0ZSggLWxpZ2h0RGlzdGFuY2UgLyBjdXRvZmZEaXN0YW5jZSArIDEuMCApLCBkZWNheUV4cG9uZW50ICk7XG5cdH1cblx0cmV0dXJuIDEuMDtcbiNlbmRpZlxufVxudmVjMyBCUkRGX0RpZmZ1c2VfTGFtYmVydCggY29uc3QgaW4gdmVjMyBkaWZmdXNlQ29sb3IgKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogZGlmZnVzZUNvbG9yO1xufVxudmVjMyBGX1NjaGxpY2soIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgZG90TEggKSB7XG5cdGZsb2F0IGZyZXNuZWwgPSBleHAyKCAoIC01LjU1NDczICogZG90TEggLSA2Ljk4MzE2ICkgKiBkb3RMSCApO1xuXHRyZXR1cm4gKCAxLjAgLSBzcGVjdWxhckNvbG9yICkgKiBmcmVzbmVsICsgc3BlY3VsYXJDb2xvcjtcbn1cbmZsb2F0IEdfR0dYX1NtaXRoKCBjb25zdCBpbiBmbG9hdCBhbHBoYSwgY29uc3QgaW4gZmxvYXQgZG90TkwsIGNvbnN0IGluIGZsb2F0IGRvdE5WICkge1xuXHRmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG5cdGZsb2F0IGdsID0gZG90TkwgKyBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5MICkgKTtcblx0ZmxvYXQgZ3YgPSBkb3ROViArIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TlYgKSApO1xuXHRyZXR1cm4gMS4wIC8gKCBnbCAqIGd2ICk7XG59XG5mbG9hdCBHX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROTCwgY29uc3QgaW4gZmxvYXQgZG90TlYgKSB7XG5cdGZsb2F0IGEyID0gcG93MiggYWxwaGEgKTtcblx0ZmxvYXQgZ3YgPSBkb3ROTCAqIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TlYgKSApO1xuXHRmbG9hdCBnbCA9IGRvdE5WICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROTCApICk7XG5cdHJldHVybiAwLjUgLyBtYXgoIGd2ICsgZ2wsIEVQU0lMT04gKTtcbn1cbmZsb2F0IERfR0dYKCBjb25zdCBpbiBmbG9hdCBhbHBoYSwgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdGZsb2F0IGEyID0gcG93MiggYWxwaGEgKTtcblx0ZmxvYXQgZGVub20gPSBwb3cyKCBkb3ROSCApICogKCBhMiAtIDEuMCApICsgMS4wO1xuXHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGEyIC8gcG93MiggZGVub20gKTtcbn1cbnZlYzMgQlJERl9TcGVjdWxhcl9HR1goIGNvbnN0IGluIEluY2lkZW50TGlnaHQgaW5jaWRlbnRMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggaW5jaWRlbnRMaWdodC5kaXJlY3Rpb24gKyBnZW9tZXRyeS52aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBpbmNpZGVudExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBnZW9tZXRyeS52aWV3RGlyICkgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeS5ub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBkb3RMSCA9IHNhdHVyYXRlKCBkb3QoIGluY2lkZW50TGlnaHQuZGlyZWN0aW9uLCBoYWxmRGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBzcGVjdWxhckNvbG9yLCBkb3RMSCApO1xuXHRmbG9hdCBHID0gR19HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG5cdGZsb2F0IEQgPSBEX0dHWCggYWxwaGEsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufVxudmVjMiBMVENfVXYoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGNvbnN0IGZsb2F0IExVVF9TSVpFICA9IDY0LjA7XG5cdGNvbnN0IGZsb2F0IExVVF9TQ0FMRSA9ICggTFVUX1NJWkUgLSAxLjAgKSAvIExVVF9TSVpFO1xuXHRjb25zdCBmbG9hdCBMVVRfQklBUyAgPSAwLjUgLyBMVVRfU0laRTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBOLCBWICkgKTtcblx0dmVjMiB1diA9IHZlYzIoIHJvdWdobmVzcywgc3FydCggMS4wIC0gZG90TlYgKSApO1xuXHR1diA9IHV2ICogTFVUX1NDQUxFICsgTFVUX0JJQVM7XG5cdHJldHVybiB1djtcbn1cbmZsb2F0IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggY29uc3QgaW4gdmVjMyBmICkge1xuXHRmbG9hdCBsID0gbGVuZ3RoKCBmICk7XG5cdHJldHVybiBtYXgoICggbCAqIGwgKyBmLnogKSAvICggbCArIDEuMCApLCAwLjAgKTtcbn1cbnZlYzMgTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIHYxLCBjb25zdCBpbiB2ZWMzIHYyICkge1xuXHRmbG9hdCB4ID0gZG90KCB2MSwgdjIgKTtcblx0ZmxvYXQgeSA9IGFicyggeCApO1xuXHRmbG9hdCBhID0gMC44NTQzOTg1ICsgKCAwLjQ5NjUxNTUgKyAwLjAxNDUyMDYgKiB5ICkgKiB5O1xuXHRmbG9hdCBiID0gMy40MTc1OTQwICsgKCA0LjE2MTY3MjQgKyB5ICkgKiB5O1xuXHRmbG9hdCB2ID0gYSAvIGI7XG5cdGZsb2F0IHRoZXRhX3NpbnRoZXRhID0gKCB4ID4gMC4wICkgPyB2IDogMC41ICogaW52ZXJzZXNxcnQoIG1heCggMS4wIC0geCAqIHgsIDFlLTcgKSApIC0gdjtcblx0cmV0dXJuIGNyb3NzKCB2MSwgdjIgKSAqIHRoZXRhX3NpbnRoZXRhO1xufVxudmVjMyBMVENfRXZhbHVhdGUoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiB2ZWMzIFAsIGNvbnN0IGluIG1hdDMgbUludiwgY29uc3QgaW4gdmVjMyByZWN0Q29vcmRzWyA0IF0gKSB7XG5cdHZlYzMgdjEgPSByZWN0Q29vcmRzWyAxIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgdjIgPSByZWN0Q29vcmRzWyAzIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgbGlnaHROb3JtYWwgPSBjcm9zcyggdjEsIHYyICk7XG5cdGlmKCBkb3QoIGxpZ2h0Tm9ybWFsLCBQIC0gcmVjdENvb3Jkc1sgMCBdICkgPCAwLjAgKSByZXR1cm4gdmVjMyggMC4wICk7XG5cdHZlYzMgVDEsIFQyO1xuXHRUMSA9IG5vcm1hbGl6ZSggViAtIE4gKiBkb3QoIFYsIE4gKSApO1xuXHRUMiA9IC0gY3Jvc3MoIE4sIFQxICk7XG5cdG1hdDMgbWF0ID0gbUludiAqIHRyYW5zcG9zZU1hdDMoIG1hdDMoIFQxLCBUMiwgTiApICk7XG5cdHZlYzMgY29vcmRzWyA0IF07XG5cdGNvb3Jkc1sgMCBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAwIF0gLSBQICk7XG5cdGNvb3Jkc1sgMSBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAxIF0gLSBQICk7XG5cdGNvb3Jkc1sgMiBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAyIF0gLSBQICk7XG5cdGNvb3Jkc1sgMyBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAzIF0gLSBQICk7XG5cdGNvb3Jkc1sgMCBdID0gbm9ybWFsaXplKCBjb29yZHNbIDAgXSApO1xuXHRjb29yZHNbIDEgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAxIF0gKTtcblx0Y29vcmRzWyAyIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMiBdICk7XG5cdGNvb3Jkc1sgMyBdID0gbm9ybWFsaXplKCBjb29yZHNbIDMgXSApO1xuXHR2ZWMzIHZlY3RvckZvcm1GYWN0b3IgPSB2ZWMzKCAwLjAgKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMCBdLCBjb29yZHNbIDEgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAxIF0sIGNvb3Jkc1sgMiBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDIgXSwgY29vcmRzWyAzIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMyBdLCBjb29yZHNbIDAgXSApO1xuXHRmbG9hdCByZXN1bHQgPSBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIHZlY3RvckZvcm1GYWN0b3IgKTtcblx0cmV0dXJuIHZlYzMoIHJlc3VsdCApO1xufVxudmVjMyBCUkRGX1NwZWN1bGFyX0dHWF9FbnZpcm9ubWVudCggY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBnZW9tZXRyeS52aWV3RGlyICkgKTtcblx0dmVjMiBicmRmID0gaW50ZWdyYXRlU3BlY3VsYXJCUkRGKCBkb3ROViwgcm91Z2huZXNzICk7XG5cdHJldHVybiBzcGVjdWxhckNvbG9yICogYnJkZi54ICsgYnJkZi55O1xufVxudm9pZCBCUkRGX1NwZWN1bGFyX011bHRpc2NhdHRlcmluZ19FbnZpcm9ubWVudCggY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGlub3V0IHZlYzMgc2luZ2xlU2NhdHRlciwgaW5vdXQgdmVjMyBtdWx0aVNjYXR0ZXIgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnkubm9ybWFsLCBnZW9tZXRyeS52aWV3RGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBzcGVjdWxhckNvbG9yLCBkb3ROViApO1xuXHR2ZWMyIGJyZGYgPSBpbnRlZ3JhdGVTcGVjdWxhckJSREYoIGRvdE5WLCByb3VnaG5lc3MgKTtcblx0dmVjMyBGc3NFc3MgPSBGICogYnJkZi54ICsgYnJkZi55O1xuXHRmbG9hdCBFc3MgPSBicmRmLnggKyBicmRmLnk7XG5cdGZsb2F0IEVtcyA9IDEuMCAtIEVzcztcblx0dmVjMyBGYXZnID0gc3BlY3VsYXJDb2xvciArICggMS4wIC0gc3BlY3VsYXJDb2xvciApICogMC4wNDc2MTk7XHR2ZWMzIEZtcyA9IEZzc0VzcyAqIEZhdmcgLyAoIDEuMCAtIEVtcyAqIEZhdmcgKTtcblx0c2luZ2xlU2NhdHRlciArPSBGc3NFc3M7XG5cdG11bHRpU2NhdHRlciArPSBGbXMgKiBFbXM7XG59XG5mbG9hdCBHX0JsaW5uUGhvbmdfSW1wbGljaXQoICkge1xuXHRyZXR1cm4gMC4yNTtcbn1cbmZsb2F0IERfQmxpbm5QaG9uZyggY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiAoIHNoaW5pbmVzcyAqIDAuNSArIDEuMCApICogcG93KCBkb3ROSCwgc2hpbmluZXNzICk7XG59XG52ZWMzIEJSREZfU3BlY3VsYXJfQmxpbm5QaG9uZyggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBpbmNpZGVudExpZ2h0LCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5LCBjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcyApIHtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBpbmNpZGVudExpZ2h0LmRpcmVjdGlvbiArIGdlb21ldHJ5LnZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeS5ub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBkb3RMSCA9IHNhdHVyYXRlKCBkb3QoIGluY2lkZW50TGlnaHQuZGlyZWN0aW9uLCBoYWxmRGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBzcGVjdWxhckNvbG9yLCBkb3RMSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufVxuZmxvYXQgR0dYUm91Z2huZXNzVG9CbGlubkV4cG9uZW50KCBjb25zdCBpbiBmbG9hdCBnZ3hSb3VnaG5lc3MgKSB7XG5cdHJldHVybiAoIDIuMCAvIHBvdzIoIGdneFJvdWdobmVzcyArIDAuMDAwMSApIC0gMi4wICk7XG59XG5mbG9hdCBCbGlubkV4cG9uZW50VG9HR1hSb3VnaG5lc3MoIGNvbnN0IGluIGZsb2F0IGJsaW5uRXhwb25lbnQgKSB7XG5cdHJldHVybiBzcXJ0KCAyLjAgLyAoIGJsaW5uRXhwb25lbnQgKyAyLjAgKSApO1xufSI7CgoJdmFyIGJ1bXBtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYnVtcE1hcDtcblx0dW5pZm9ybSBmbG9hdCBidW1wU2NhbGU7XG5cdHZlYzIgZEhkeHlfZndkKCkge1xuXHRcdHZlYzIgZFNUZHggPSBkRmR4KCB2VXYgKTtcblx0XHR2ZWMyIGRTVGR5ID0gZEZkeSggdlV2ICk7XG5cdFx0ZmxvYXQgSGxsID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2VXYgKS54O1xuXHRcdGZsb2F0IGRCeCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdlV2ICsgZFNUZHggKS54IC0gSGxsO1xuXHRcdGZsb2F0IGRCeSA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdlV2ICsgZFNUZHkgKS54IC0gSGxsO1xuXHRcdHJldHVybiB2ZWMyKCBkQngsIGRCeSApO1xuXHR9XG5cdHZlYzMgcGVydHVyYk5vcm1hbEFyYiggdmVjMyBzdXJmX3BvcywgdmVjMyBzdXJmX25vcm0sIHZlYzIgZEhkeHkgKSB7XG5cdFx0dmVjMyB2U2lnbWFYID0gdmVjMyggZEZkeCggc3VyZl9wb3MueCApLCBkRmR4KCBzdXJmX3Bvcy55ICksIGRGZHgoIHN1cmZfcG9zLnogKSApO1xuXHRcdHZlYzMgdlNpZ21hWSA9IHZlYzMoIGRGZHkoIHN1cmZfcG9zLnggKSwgZEZkeSggc3VyZl9wb3MueSApLCBkRmR5KCBzdXJmX3Bvcy56ICkgKTtcblx0XHR2ZWMzIHZOID0gc3VyZl9ub3JtO1xuXHRcdHZlYzMgUjEgPSBjcm9zcyggdlNpZ21hWSwgdk4gKTtcblx0XHR2ZWMzIFIyID0gY3Jvc3MoIHZOLCB2U2lnbWFYICk7XG5cdFx0ZmxvYXQgZkRldCA9IGRvdCggdlNpZ21hWCwgUjEgKTtcblx0XHRmRGV0ICo9ICggZmxvYXQoIGdsX0Zyb250RmFjaW5nICkgKiAyLjAgLSAxLjAgKTtcblx0XHR2ZWMzIHZHcmFkID0gc2lnbiggZkRldCApICogKCBkSGR4eS54ICogUjEgKyBkSGR4eS55ICogUjIgKTtcblx0XHRyZXR1cm4gbm9ybWFsaXplKCBhYnMoIGZEZXQgKSAqIHN1cmZfbm9ybSAtIHZHcmFkICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmVjNCBwbGFuZTtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBVTklPTl9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0cGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuXHRcdGlmICggZG90KCB2Vmlld1Bvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuXHR9XG5cdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0Ym9vbCBjbGlwcGVkID0gdHJ1ZTtcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wXG5cdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0cGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuXHRcdFx0Y2xpcHBlZCA9ICggZG90KCB2Vmlld1Bvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSAmJiBjbGlwcGVkO1xuXHRcdH1cblx0XHRpZiAoIGNsaXBwZWQgKSBkaXNjYXJkO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHQjaWYgISBkZWZpbmVkKCBQSFlTSUNBTCApICYmICEgZGVmaW5lZCggUEhPTkcgKSAmJiAhIGRlZmluZWQoIE1BVENBUCApXG5cdFx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5cdCNlbmRpZlxuXHR1bmlmb3JtIHZlYzQgY2xpcHBpbmdQbGFuZXNbIE5VTV9DTElQUElOR19QTEFORVMgXTtcbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDAgJiYgISBkZWZpbmVkKCBQSFlTSUNBTCApICYmICEgZGVmaW5lZCggUEhPTkcgKSAmJiAhIGRlZmluZWQoIE1BVENBUCApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmIjsKCgl2YXIgY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDAgJiYgISBkZWZpbmVkKCBQSFlTSUNBTCApICYmICEgZGVmaW5lZCggUEhPTkcgKSAmJiAhIGRlZmluZWQoIE1BVENBUCApXG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuI2VuZGlmIjsKCgl2YXIgY29sb3JfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9DT0xPUlxuXHRkaWZmdXNlQ29sb3IucmdiICo9IHZDb2xvcjtcbiNlbmRpZiI7CgoJdmFyIGNvbG9yX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9DT0xPUlxuXHR2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgY29sb3JfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9DT0xPUlxuXHR2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgY29sb3JfdmVydGV4ID0gIiNpZmRlZiBVU0VfQ09MT1Jcblx0dkNvbG9yLnh5eiA9IGNvbG9yLnh5ejtcbiNlbmRpZiI7CgoJdmFyIGNvbW1vbiA9ICIjZGVmaW5lIFBJIDMuMTQxNTkyNjUzNTlcbiNkZWZpbmUgUEkyIDYuMjgzMTg1MzA3MThcbiNkZWZpbmUgUElfSEFMRiAxLjU3MDc5NjMyNjc5NDlcbiNkZWZpbmUgUkVDSVBST0NBTF9QSSAwLjMxODMwOTg4NjE4XG4jZGVmaW5lIFJFQ0lQUk9DQUxfUEkyIDAuMTU5MTU0OTRcbiNkZWZpbmUgTE9HMiAxLjQ0MjY5NVxuI2RlZmluZSBFUFNJTE9OIDFlLTZcbiNkZWZpbmUgc2F0dXJhdGUoYSkgY2xhbXAoIGEsIDAuMCwgMS4wIClcbiNkZWZpbmUgd2hpdGVDb21wbGltZW50KGEpICggMS4wIC0gc2F0dXJhdGUoIGEgKSApXG5mbG9hdCBwb3cyKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4OyB9XG5mbG9hdCBwb3czKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4Kng7IH1cbmZsb2F0IHBvdzQoIGNvbnN0IGluIGZsb2F0IHggKSB7IGZsb2F0IHgyID0geCp4OyByZXR1cm4geDIqeDI7IH1cbmZsb2F0IGF2ZXJhZ2UoIGNvbnN0IGluIHZlYzMgY29sb3IgKSB7IHJldHVybiBkb3QoIGNvbG9yLCB2ZWMzKCAwLjMzMzMgKSApOyB9XG5oaWdocCBmbG9hdCByYW5kKCBjb25zdCBpbiB2ZWMyIHV2ICkge1xuXHRjb25zdCBoaWdocCBmbG9hdCBhID0gMTIuOTg5OCwgYiA9IDc4LjIzMywgYyA9IDQzNzU4LjU0NTM7XG5cdGhpZ2hwIGZsb2F0IGR0ID0gZG90KCB1di54eSwgdmVjMiggYSxiICkgKSwgc24gPSBtb2QoIGR0LCBQSSApO1xuXHRyZXR1cm4gZnJhY3Qoc2luKHNuKSAqIGMpO1xufVxuc3RydWN0IEluY2lkZW50TGlnaHQge1xuXHR2ZWMzIGNvbG9yO1xuXHR2ZWMzIGRpcmVjdGlvbjtcblx0Ym9vbCB2aXNpYmxlO1xufTtcbnN0cnVjdCBSZWZsZWN0ZWRMaWdodCB7XG5cdHZlYzMgZGlyZWN0RGlmZnVzZTtcblx0dmVjMyBkaXJlY3RTcGVjdWxhcjtcblx0dmVjMyBpbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgaW5kaXJlY3RTcGVjdWxhcjtcbn07XG5zdHJ1Y3QgR2VvbWV0cmljQ29udGV4dCB7XG5cdHZlYzMgcG9zaXRpb247XG5cdHZlYzMgbm9ybWFsO1xuXHR2ZWMzIHZpZXdEaXI7XG59O1xudmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7XG59XG52ZWMzIGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCB2ZWM0KCBkaXIsIDAuMCApICogbWF0cml4ICkueHl6ICk7XG59XG52ZWMzIHByb2plY3RPblBsYW5lKGluIHZlYzMgcG9pbnQsIGluIHZlYzMgcG9pbnRPblBsYW5lLCBpbiB2ZWMzIHBsYW5lTm9ybWFsICkge1xuXHRmbG9hdCBkaXN0YW5jZSA9IGRvdCggcGxhbmVOb3JtYWwsIHBvaW50IC0gcG9pbnRPblBsYW5lICk7XG5cdHJldHVybiAtIGRpc3RhbmNlICogcGxhbmVOb3JtYWwgKyBwb2ludDtcbn1cbmZsb2F0IHNpZGVPZlBsYW5lKCBpbiB2ZWMzIHBvaW50LCBpbiB2ZWMzIHBvaW50T25QbGFuZSwgaW4gdmVjMyBwbGFuZU5vcm1hbCApIHtcblx0cmV0dXJuIHNpZ24oIGRvdCggcG9pbnQgLSBwb2ludE9uUGxhbmUsIHBsYW5lTm9ybWFsICkgKTtcbn1cbnZlYzMgbGluZVBsYW5lSW50ZXJzZWN0KCBpbiB2ZWMzIHBvaW50T25MaW5lLCBpbiB2ZWMzIGxpbmVEaXJlY3Rpb24sIGluIHZlYzMgcG9pbnRPblBsYW5lLCBpbiB2ZWMzIHBsYW5lTm9ybWFsICkge1xuXHRyZXR1cm4gbGluZURpcmVjdGlvbiAqICggZG90KCBwbGFuZU5vcm1hbCwgcG9pbnRPblBsYW5lIC0gcG9pbnRPbkxpbmUgKSAvIGRvdCggcGxhbmVOb3JtYWwsIGxpbmVEaXJlY3Rpb24gKSApICsgcG9pbnRPbkxpbmU7XG59XG5tYXQzIHRyYW5zcG9zZU1hdDMoIGNvbnN0IGluIG1hdDMgbSApIHtcblx0bWF0MyB0bXA7XG5cdHRtcFsgMCBdID0gdmVjMyggbVsgMCBdLngsIG1bIDEgXS54LCBtWyAyIF0ueCApO1xuXHR0bXBbIDEgXSA9IHZlYzMoIG1bIDAgXS55LCBtWyAxIF0ueSwgbVsgMiBdLnkgKTtcblx0dG1wWyAyIF0gPSB2ZWMzKCBtWyAwIF0ueiwgbVsgMSBdLnosIG1bIDIgXS56ICk7XG5cdHJldHVybiB0bXA7XG59XG5mbG9hdCBsaW5lYXJUb1JlbGF0aXZlTHVtaW5hbmNlKCBjb25zdCBpbiB2ZWMzIGNvbG9yICkge1xuXHR2ZWMzIHdlaWdodHMgPSB2ZWMzKCAwLjIxMjYsIDAuNzE1MiwgMC4wNzIyICk7XG5cdHJldHVybiBkb3QoIHdlaWdodHMsIGNvbG9yLnJnYiApO1xufSI7CgoJdmFyIGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuI2RlZmluZSBjdWJlVVZfdGV4dHVyZVNpemUgKDEwMjQuMClcbmludCBnZXRGYWNlRnJvbURpcmVjdGlvbih2ZWMzIGRpcmVjdGlvbikge1xuXHR2ZWMzIGFic0RpcmVjdGlvbiA9IGFicyhkaXJlY3Rpb24pO1xuXHRpbnQgZmFjZSA9IC0xO1xuXHRpZiggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueiApIHtcblx0XHRpZihhYnNEaXJlY3Rpb24ueCA+IGFic0RpcmVjdGlvbi55IClcblx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueCA+IDAuMCA/IDAgOiAzO1xuXHRcdGVsc2Vcblx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEgOiA0O1xuXHR9XG5cdGVsc2Uge1xuXHRcdGlmKGFic0RpcmVjdGlvbi56ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi56ID4gMC4wID8gMiA6IDU7XG5cdFx0ZWxzZVxuXHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi55ID4gMC4wID8gMSA6IDQ7XG5cdH1cblx0cmV0dXJuIGZhY2U7XG59XG4jZGVmaW5lIGN1YmVVVl9tYXhMb2RzMSAgKGxvZzIoY3ViZVVWX3RleHR1cmVTaXplKjAuMjUpIC0gMS4wKVxuI2RlZmluZSBjdWJlVVZfcmFuZ2VDbGFtcCAoZXhwMigoNi4wIC0gMS4wKSAqIDIuMCkpXG52ZWMyIE1pcExldmVsSW5mbyggdmVjMyB2ZWMsIGZsb2F0IHJvdWdobmVzc0xldmVsLCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IHNjYWxlID0gZXhwMihjdWJlVVZfbWF4TG9kczEgLSByb3VnaG5lc3NMZXZlbCk7XG5cdGZsb2F0IGR4Um91Z2huZXNzID0gZEZkeChyb3VnaG5lc3MpO1xuXHRmbG9hdCBkeVJvdWdobmVzcyA9IGRGZHkocm91Z2huZXNzKTtcblx0dmVjMyBkeCA9IGRGZHgoIHZlYyAqIHNjYWxlICogZHhSb3VnaG5lc3MgKTtcblx0dmVjMyBkeSA9IGRGZHkoIHZlYyAqIHNjYWxlICogZHlSb3VnaG5lc3MgKTtcblx0ZmxvYXQgZCA9IG1heCggZG90KCBkeCwgZHggKSwgZG90KCBkeSwgZHkgKSApO1xuXHRkID0gY2xhbXAoZCwgMS4wLCBjdWJlVVZfcmFuZ2VDbGFtcCk7XG5cdGZsb2F0IG1pcExldmVsID0gMC41ICogbG9nMihkKTtcblx0cmV0dXJuIHZlYzIoZmxvb3IobWlwTGV2ZWwpLCBmcmFjdChtaXBMZXZlbCkpO1xufVxuI2RlZmluZSBjdWJlVVZfbWF4TG9kczIgKGxvZzIoY3ViZVVWX3RleHR1cmVTaXplKjAuMjUpIC0gMi4wKVxuI2RlZmluZSBjdWJlVVZfcmNwVGV4dHVyZVNpemUgKDEuMCAvIGN1YmVVVl90ZXh0dXJlU2l6ZSlcbnZlYzIgZ2V0Q3ViZVVWKHZlYzMgZGlyZWN0aW9uLCBmbG9hdCByb3VnaG5lc3NMZXZlbCwgZmxvYXQgbWlwTGV2ZWwpIHtcblx0bWlwTGV2ZWwgPSByb3VnaG5lc3NMZXZlbCA+IGN1YmVVVl9tYXhMb2RzMiAtIDMuMCA/IDAuMCA6IG1pcExldmVsO1xuXHRmbG9hdCBhID0gMTYuMCAqIGN1YmVVVl9yY3BUZXh0dXJlU2l6ZTtcblx0dmVjMiBleHAyX3BhY2tlZCA9IGV4cDIoIHZlYzIoIHJvdWdobmVzc0xldmVsLCBtaXBMZXZlbCApICk7XG5cdHZlYzIgcmNwX2V4cDJfcGFja2VkID0gdmVjMiggMS4wICkgLyBleHAyX3BhY2tlZDtcblx0ZmxvYXQgcG93U2NhbGUgPSBleHAyX3BhY2tlZC54ICogZXhwMl9wYWNrZWQueTtcblx0ZmxvYXQgc2NhbGUgPSByY3BfZXhwMl9wYWNrZWQueCAqIHJjcF9leHAyX3BhY2tlZC55ICogMC4yNTtcblx0ZmxvYXQgbWlwT2Zmc2V0ID0gMC43NSooMS4wIC0gcmNwX2V4cDJfcGFja2VkLnkpICogcmNwX2V4cDJfcGFja2VkLng7XG5cdGJvb2wgYlJlcyA9IG1pcExldmVsID09IDAuMDtcblx0c2NhbGUgPSAgYlJlcyAmJiAoc2NhbGUgPCBhKSA/IGEgOiBzY2FsZTtcblx0dmVjMyByO1xuXHR2ZWMyIG9mZnNldDtcblx0aW50IGZhY2UgPSBnZXRGYWNlRnJvbURpcmVjdGlvbihkaXJlY3Rpb24pO1xuXHRmbG9hdCByY3BQb3dTY2FsZSA9IDEuMCAvIHBvd1NjYWxlO1xuXHRpZiggZmFjZSA9PSAwKSB7XG5cdFx0ciA9IHZlYzMoZGlyZWN0aW9uLngsIC1kaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkpO1xuXHRcdG9mZnNldCA9IHZlYzIoMC4wK21pcE9mZnNldCwwLjc1ICogcmNwUG93U2NhbGUpO1xuXHRcdG9mZnNldC55ID0gYlJlcyAmJiAob2Zmc2V0LnkgPCAyLjAqYSkgPyBhIDogb2Zmc2V0Lnk7XG5cdH1cblx0ZWxzZSBpZiggZmFjZSA9PSAxKSB7XG5cdFx0ciA9IHZlYzMoZGlyZWN0aW9uLnksIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueik7XG5cdFx0b2Zmc2V0ID0gdmVjMihzY2FsZSttaXBPZmZzZXQsIDAuNzUgKiByY3BQb3dTY2FsZSk7XG5cdFx0b2Zmc2V0LnkgPSBiUmVzICYmIChvZmZzZXQueSA8IDIuMCphKSA/IGEgOiBvZmZzZXQueTtcblx0fVxuXHRlbHNlIGlmKCBmYWNlID09IDIpIHtcblx0XHRyID0gdmVjMyhkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLngsIGRpcmVjdGlvbi55KTtcblx0XHRvZmZzZXQgPSB2ZWMyKDIuMCpzY2FsZSttaXBPZmZzZXQsIDAuNzUgKiByY3BQb3dTY2FsZSk7XG5cdFx0b2Zmc2V0LnkgPSBiUmVzICYmIChvZmZzZXQueSA8IDIuMCphKSA/IGEgOiBvZmZzZXQueTtcblx0fVxuXHRlbHNlIGlmKCBmYWNlID09IDMpIHtcblx0XHRyID0gdmVjMyhkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55KTtcblx0XHRvZmZzZXQgPSB2ZWMyKDAuMCttaXBPZmZzZXQsMC41ICogcmNwUG93U2NhbGUpO1xuXHRcdG9mZnNldC55ID0gYlJlcyAmJiAob2Zmc2V0LnkgPCAyLjAqYSkgPyAwLjAgOiBvZmZzZXQueTtcblx0fVxuXHRlbHNlIGlmKCBmYWNlID09IDQpIHtcblx0XHRyID0gdmVjMyhkaXJlY3Rpb24ueSwgZGlyZWN0aW9uLngsIC1kaXJlY3Rpb24ueik7XG5cdFx0b2Zmc2V0ID0gdmVjMihzY2FsZSttaXBPZmZzZXQsIDAuNSAqIHJjcFBvd1NjYWxlKTtcblx0XHRvZmZzZXQueSA9IGJSZXMgJiYgKG9mZnNldC55IDwgMi4wKmEpID8gMC4wIDogb2Zmc2V0Lnk7XG5cdH1cblx0ZWxzZSB7XG5cdFx0ciA9IHZlYzMoZGlyZWN0aW9uLnosIC1kaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkpO1xuXHRcdG9mZnNldCA9IHZlYzIoMi4wKnNjYWxlK21pcE9mZnNldCwgMC41ICogcmNwUG93U2NhbGUpO1xuXHRcdG9mZnNldC55ID0gYlJlcyAmJiAob2Zmc2V0LnkgPCAyLjAqYSkgPyAwLjAgOiBvZmZzZXQueTtcblx0fVxuXHRyID0gbm9ybWFsaXplKHIpO1xuXHRmbG9hdCB0ZXhlbE9mZnNldCA9IDAuNSAqIGN1YmVVVl9yY3BUZXh0dXJlU2l6ZTtcblx0dmVjMiBzID0gKCByLnl6IC8gYWJzKCByLnggKSArIHZlYzIoIDEuMCApICkgKiAwLjU7XG5cdHZlYzIgYmFzZSA9IG9mZnNldCArIHZlYzIoIHRleGVsT2Zmc2V0ICk7XG5cdHJldHVybiBiYXNlICsgcyAqICggc2NhbGUgLSAyLjAgKiB0ZXhlbE9mZnNldCApO1xufVxuI2RlZmluZSBjdWJlVVZfbWF4TG9kczMgKGxvZzIoY3ViZVVWX3RleHR1cmVTaXplKjAuMjUpIC0gMy4wKVxudmVjNCB0ZXh0dXJlQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIHJlZmxlY3RlZERpcmVjdGlvbiwgZmxvYXQgcm91Z2huZXNzICkge1xuXHRmbG9hdCByb3VnaG5lc3NWYWwgPSByb3VnaG5lc3MqIGN1YmVVVl9tYXhMb2RzMztcblx0ZmxvYXQgcjEgPSBmbG9vcihyb3VnaG5lc3NWYWwpO1xuXHRmbG9hdCByMiA9IHIxICsgMS4wO1xuXHRmbG9hdCB0ID0gZnJhY3Qocm91Z2huZXNzVmFsKTtcblx0dmVjMiBtaXBJbmZvID0gTWlwTGV2ZWxJbmZvKHJlZmxlY3RlZERpcmVjdGlvbiwgcjEsIHJvdWdobmVzcyk7XG5cdGZsb2F0IHMgPSBtaXBJbmZvLnk7XG5cdGZsb2F0IGxldmVsMCA9IG1pcEluZm8ueDtcblx0ZmxvYXQgbGV2ZWwxID0gbGV2ZWwwICsgMS4wO1xuXHRsZXZlbDEgPSBsZXZlbDEgPiA1LjAgPyA1LjAgOiBsZXZlbDE7XG5cdGxldmVsMCArPSBtaW4oIGZsb29yKCBzICsgMC41ICksIDUuMCApO1xuXHR2ZWMyIHV2XzEwID0gZ2V0Q3ViZVVWKHJlZmxlY3RlZERpcmVjdGlvbiwgcjEsIGxldmVsMCk7XG5cdHZlYzQgY29sb3IxMCA9IGVudk1hcFRleGVsVG9MaW5lYXIodGV4dHVyZTJEKGVudk1hcCwgdXZfMTApKTtcblx0dmVjMiB1dl8yMCA9IGdldEN1YmVVVihyZWZsZWN0ZWREaXJlY3Rpb24sIHIyLCBsZXZlbDApO1xuXHR2ZWM0IGNvbG9yMjAgPSBlbnZNYXBUZXhlbFRvTGluZWFyKHRleHR1cmUyRChlbnZNYXAsIHV2XzIwKSk7XG5cdHZlYzQgcmVzdWx0ID0gbWl4KGNvbG9yMTAsIGNvbG9yMjAsIHQpO1xuXHRyZXR1cm4gdmVjNChyZXN1bHQucmdiLCAxLjApO1xufVxuI2VuZGlmIjsKCgl2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG5vcm1hbE1hdHJpeCAqIG9iamVjdE5vcm1hbDtcbiNpZmRlZiBGTElQX1NJREVEXG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gLSB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHZlYzMgdHJhbnNmb3JtZWRUYW5nZW50ID0gbm9ybWFsTWF0cml4ICogb2JqZWN0VGFuZ2VudDtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZGlzcGxhY2VtZW50TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudEJpYXM7XG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHRyYW5zZm9ybWVkICs9IG5vcm1hbGl6ZSggb2JqZWN0Tm9ybWFsICkgKiAoIHRleHR1cmUyRCggZGlzcGxhY2VtZW50TWFwLCB1diApLnggKiBkaXNwbGFjZW1lbnRTY2FsZSArIGRpc3BsYWNlbWVudEJpYXMgKTtcbiNlbmRpZiI7CgoJdmFyIGVtaXNzaXZlbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmVjNCBlbWlzc2l2ZUNvbG9yID0gdGV4dHVyZTJEKCBlbWlzc2l2ZU1hcCwgdlV2ICk7XG5cdGVtaXNzaXZlQ29sb3IucmdiID0gZW1pc3NpdmVNYXBUZXhlbFRvTGluZWFyKCBlbWlzc2l2ZUNvbG9yICkucmdiO1xuXHR0b3RhbEVtaXNzaXZlUmFkaWFuY2UgKj0gZW1pc3NpdmVDb2xvci5yZ2I7XG4jZW5kaWYiOwoKCXZhciBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZW1pc3NpdmVNYXA7XG4jZW5kaWYiOwoKCXZhciBlbmNvZGluZ3NfZnJhZ21lbnQgPSAiZ2xfRnJhZ0NvbG9yID0gbGluZWFyVG9PdXRwdXRUZXhlbCggZ2xfRnJhZ0NvbG9yICk7IjsKCgl2YXIgZW5jb2RpbmdzX3BhcnNfZnJhZ21lbnQgPSAiXG52ZWM0IExpbmVhclRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmFsdWU7XG59XG52ZWM0IEdhbW1hVG9MaW5lYXIoIGluIHZlYzQgdmFsdWUsIGluIGZsb2F0IGdhbW1hRmFjdG9yICkge1xuXHRyZXR1cm4gdmVjNCggcG93KCB2YWx1ZS5yZ2IsIHZlYzMoIGdhbW1hRmFjdG9yICkgKSwgdmFsdWUuYSApO1xufVxudmVjNCBMaW5lYXJUb0dhbW1hKCBpbiB2ZWM0IHZhbHVlLCBpbiBmbG9hdCBnYW1tYUZhY3RvciApIHtcblx0cmV0dXJuIHZlYzQoIHBvdyggdmFsdWUucmdiLCB2ZWMzKCAxLjAgLyBnYW1tYUZhY3RvciApICksIHZhbHVlLmEgKTtcbn1cbnZlYzQgc1JHQlRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCB2YWx1ZS5yZ2IgKiAwLjA3NzM5OTM4MDgsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhclRvc1JHQiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZlYzQoIG1peCggcG93KCB2YWx1ZS5yZ2IsIHZlYzMoIDAuNDE2NjYgKSApICogMS4wNTUgLSB2ZWMzKCAwLjA1NSApLCB2YWx1ZS5yZ2IgKiAxMi45MiwgdmVjMyggbGVzc1RoYW5FcXVhbCggdmFsdWUucmdiLCB2ZWMzKCAwLjAwMzEzMDggKSApICkgKSwgdmFsdWUuYSApO1xufVxudmVjNCBSR0JFVG9MaW5lYXIoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgKiBleHAyKCB2YWx1ZS5hICogMjU1LjAgLSAxMjguMCApLCAxLjAgKTtcbn1cbnZlYzQgTGluZWFyVG9SR0JFKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRmbG9hdCBtYXhDb21wb25lbnQgPSBtYXgoIG1heCggdmFsdWUuciwgdmFsdWUuZyApLCB2YWx1ZS5iICk7XG5cdGZsb2F0IGZFeHAgPSBjbGFtcCggY2VpbCggbG9nMiggbWF4Q29tcG9uZW50ICkgKSwgLTEyOC4wLCAxMjcuMCApO1xuXHRyZXR1cm4gdmVjNCggdmFsdWUucmdiIC8gZXhwMiggZkV4cCApLCAoIGZFeHAgKyAxMjguMCApIC8gMjU1LjAgKTtcbn1cbnZlYzQgUkdCTVRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlLCBpbiBmbG9hdCBtYXhSYW5nZSApIHtcblx0cmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAqIHZhbHVlLmEgKiBtYXhSYW5nZSwgMS4wICk7XG59XG52ZWM0IExpbmVhclRvUkdCTSggaW4gdmVjNCB2YWx1ZSwgaW4gZmxvYXQgbWF4UmFuZ2UgKSB7XG5cdGZsb2F0IG1heFJHQiA9IG1heCggdmFsdWUuciwgbWF4KCB2YWx1ZS5nLCB2YWx1ZS5iICkgKTtcblx0ZmxvYXQgTSA9IGNsYW1wKCBtYXhSR0IgLyBtYXhSYW5nZSwgMC4wLCAxLjAgKTtcblx0TSA9IGNlaWwoIE0gKiAyNTUuMCApIC8gMjU1LjA7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgLyAoIE0gKiBtYXhSYW5nZSApLCBNICk7XG59XG52ZWM0IFJHQkRUb0xpbmVhciggaW4gdmVjNCB2YWx1ZSwgaW4gZmxvYXQgbWF4UmFuZ2UgKSB7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgKiAoICggbWF4UmFuZ2UgLyAyNTUuMCApIC8gdmFsdWUuYSApLCAxLjAgKTtcbn1cbnZlYzQgTGluZWFyVG9SR0JEKCBpbiB2ZWM0IHZhbHVlLCBpbiBmbG9hdCBtYXhSYW5nZSApIHtcblx0ZmxvYXQgbWF4UkdCID0gbWF4KCB2YWx1ZS5yLCBtYXgoIHZhbHVlLmcsIHZhbHVlLmIgKSApO1xuXHRmbG9hdCBEID0gbWF4KCBtYXhSYW5nZSAvIG1heFJHQiwgMS4wICk7XG5cdEQgPSBtaW4oIGZsb29yKCBEICkgLyAyNTUuMCwgMS4wICk7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgKiAoIEQgKiAoIDI1NS4wIC8gbWF4UmFuZ2UgKSApLCBEICk7XG59XG5jb25zdCBtYXQzIGNMb2dMdXZNID0gbWF0MyggMC4yMjA5LCAwLjMzOTAsIDAuNDE4NCwgMC4xMTM4LCAwLjY3ODAsIDAuNzMxOSwgMC4wMTAyLCAwLjExMzAsIDAuMjk2OSApO1xudmVjNCBMaW5lYXJUb0xvZ0x1diggaW4gdmVjNCB2YWx1ZSApICB7XG5cdHZlYzMgWHBfWV9YWVpwID0gY0xvZ0x1dk0gKiB2YWx1ZS5yZ2I7XG5cdFhwX1lfWFlacCA9IG1heCggWHBfWV9YWVpwLCB2ZWMzKCAxZS02LCAxZS02LCAxZS02ICkgKTtcblx0dmVjNCB2UmVzdWx0O1xuXHR2UmVzdWx0Lnh5ID0gWHBfWV9YWVpwLnh5IC8gWHBfWV9YWVpwLno7XG5cdGZsb2F0IExlID0gMi4wICogbG9nMihYcF9ZX1hZWnAueSkgKyAxMjcuMDtcblx0dlJlc3VsdC53ID0gZnJhY3QoIExlICk7XG5cdHZSZXN1bHQueiA9ICggTGUgLSAoIGZsb29yKCB2UmVzdWx0LncgKiAyNTUuMCApICkgLyAyNTUuMCApIC8gMjU1LjA7XG5cdHJldHVybiB2UmVzdWx0O1xufVxuY29uc3QgbWF0MyBjTG9nTHV2SW52ZXJzZU0gPSBtYXQzKCA2LjAwMTQsIC0yLjcwMDgsIC0xLjc5OTYsIC0xLjMzMjAsIDMuMTAyOSwgLTUuNzcyMSwgMC4zMDA4LCAtMS4wODgyLCA1LjYyNjggKTtcbnZlYzQgTG9nTHV2VG9MaW5lYXIoIGluIHZlYzQgdmFsdWUgKSB7XG5cdGZsb2F0IExlID0gdmFsdWUueiAqIDI1NS4wICsgdmFsdWUudztcblx0dmVjMyBYcF9ZX1hZWnA7XG5cdFhwX1lfWFlacC55ID0gZXhwMiggKCBMZSAtIDEyNy4wICkgLyAyLjAgKTtcblx0WHBfWV9YWVpwLnogPSBYcF9ZX1hZWnAueSAvIHZhbHVlLnk7XG5cdFhwX1lfWFlacC54ID0gdmFsdWUueCAqIFhwX1lfWFlacC56O1xuXHR2ZWMzIHZSR0IgPSBjTG9nTHV2SW52ZXJzZU0gKiBYcF9ZX1hZWnAucmdiO1xuXHRyZXR1cm4gdmVjNCggbWF4KCB2UkdCLCAwLjAgKSwgMS4wICk7XG59IjsKCgl2YXIgZW52bWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApXG5cdFx0dmVjMyBjYW1lcmFUb1ZlcnRleCA9IG5vcm1hbGl6ZSggdldvcmxkUG9zaXRpb24gLSBjYW1lcmFQb3NpdGlvbiApO1xuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0XHQjaWZkZWYgRU5WTUFQX01PREVfUkVGTEVDVElPTlxuXHRcdFx0dmVjMyByZWZsZWN0VmVjID0gcmVmbGVjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG5cdFx0I2VuZGlmXG5cdCNlbHNlXG5cdFx0dmVjMyByZWZsZWN0VmVjID0gdlJlZmxlY3Q7XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHRcdHZlYzQgZW52Q29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfRVFVSVJFQyApXG5cdFx0dmVjMiBzYW1wbGVVVjtcblx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCByZWZsZWN0VmVjICk7XG5cdFx0c2FtcGxlVVYueSA9IGFzaW4oIGNsYW1wKCByZWZsZWN0VmVjLnksIC0gMS4wLCAxLjAgKSApICogUkVDSVBST0NBTF9QSSArIDAuNTtcblx0XHRzYW1wbGVVVi54ID0gYXRhbiggcmVmbGVjdFZlYy56LCByZWZsZWN0VmVjLnggKSAqIFJFQ0lQUk9DQUxfUEkyICsgMC41O1xuXHRcdHZlYzQgZW52Q29sb3IgPSB0ZXh0dXJlMkQoIGVudk1hcCwgc2FtcGxlVVYgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfU1BIRVJFIClcblx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCByZWZsZWN0VmVjICk7XG5cdFx0dmVjMyByZWZsZWN0VmlldyA9IG5vcm1hbGl6ZSggKCB2aWV3TWF0cml4ICogdmVjNCggcmVmbGVjdFZlYywgMC4wICkgKS54eXogKyB2ZWMzKCAwLjAsIDAuMCwgMS4wICkgKTtcblx0XHR2ZWM0IGVudkNvbG9yID0gdGV4dHVyZTJEKCBlbnZNYXAsIHJlZmxlY3RWaWV3Lnh5ICogMC41ICsgMC41ICk7XG5cdCNlbHNlXG5cdFx0dmVjNCBlbnZDb2xvciA9IHZlYzQoIDAuMCApO1xuXHQjZW5kaWZcblx0ZW52Q29sb3IgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCBlbnZDb2xvciApO1xuXHQjaWZkZWYgRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZXG5cdFx0b3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgb3V0Z29pbmdMaWdodCAqIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfTUlYIClcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX0FERCApXG5cdFx0b3V0Z29pbmdMaWdodCArPSBlbnZDb2xvci54eXogKiBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGVudm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgfHwgZGVmaW5lZCggUEhZU0lDQUwgKVxuXHR1bmlmb3JtIGZsb2F0IHJlZmxlY3Rpdml0eTtcblx0dW5pZm9ybSBmbG9hdCBlbnZNYXBJbnRlbnNpdHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiAhIGRlZmluZWQoIFBIWVNJQ0FMICkgJiYgKCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApIClcblx0XHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHRcdHVuaWZvcm0gc2FtcGxlckN1YmUgZW52TWFwO1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDtcblx0I2VuZGlmXG5cdHVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcblx0dW5pZm9ybSBpbnQgbWF4TWlwTGV2ZWw7XG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApIHx8IGRlZmluZWQoIFBIWVNJQ0FMIClcblx0XHR1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApXG5cdFx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuXHQjZWxzZVxuXHRcdHZhcnlpbmcgdmVjMyB2UmVmbGVjdDtcblx0XHR1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBlbnZtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApXG5cdFx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcblx0I2Vsc2Vcblx0XHR2ZWMzIGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB3b3JsZFBvc2l0aW9uLnh5eiAtIGNhbWVyYVBvc2l0aW9uICk7XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0I2lmZGVmIEVOVk1BUF9NT0RFX1JFRkxFQ1RJT05cblx0XHRcdHZSZWZsZWN0ID0gcmVmbGVjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZSZWZsZWN0ID0gcmVmcmFjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsLCByZWZyYWN0aW9uUmF0aW8gKTtcblx0XHQjZW5kaWZcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBmb2dfdmVydGV4ID0gIiNpZmRlZiBVU0VfRk9HXG5cdGZvZ0RlcHRoID0gLW12UG9zaXRpb24uejtcbiNlbmRpZiI7CgoJdmFyIGZvZ19wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2YXJ5aW5nIGZsb2F0IGZvZ0RlcHRoO1xuI2VuZGlmIjsKCgl2YXIgZm9nX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRk9HXG5cdCNpZmRlZiBGT0dfRVhQMlxuXHRcdGZsb2F0IGZvZ0ZhY3RvciA9IHdoaXRlQ29tcGxpbWVudCggZXhwMiggLSBmb2dEZW5zaXR5ICogZm9nRGVuc2l0eSAqIGZvZ0RlcHRoICogZm9nRGVwdGggKiBMT0cyICkgKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSBzbW9vdGhzdGVwKCBmb2dOZWFyLCBmb2dGYXIsIGZvZ0RlcHRoICk7XG5cdCNlbmRpZlxuXHRnbF9GcmFnQ29sb3IucmdiID0gbWl4KCBnbF9GcmFnQ29sb3IucmdiLCBmb2dDb2xvciwgZm9nRmFjdG9yICk7XG4jZW5kaWYiOwoKCXZhciBmb2dfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR1bmlmb3JtIHZlYzMgZm9nQ29sb3I7XG5cdHZhcnlpbmcgZmxvYXQgZm9nRGVwdGg7XG5cdCNpZmRlZiBGT0dfRVhQMlxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nRGVuc2l0eTtcblx0I2Vsc2Vcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ05lYXI7XG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dGYXI7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZ3JhZGllbnRtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVE9PTlxuXHR1bmlmb3JtIHNhbXBsZXIyRCBncmFkaWVudE1hcDtcblx0dmVjMyBnZXRHcmFkaWVudElycmFkaWFuY2UoIHZlYzMgbm9ybWFsLCB2ZWMzIGxpZ2h0RGlyZWN0aW9uICkge1xuXHRcdGZsb2F0IGRvdE5MID0gZG90KCBub3JtYWwsIGxpZ2h0RGlyZWN0aW9uICk7XG5cdFx0dmVjMiBjb29yZCA9IHZlYzIoIGRvdE5MICogMC41ICsgMC41LCAwLjAgKTtcblx0XHQjaWZkZWYgVVNFX0dSQURJRU5UTUFQXG5cdFx0XHRyZXR1cm4gdGV4dHVyZTJEKCBncmFkaWVudE1hcCwgY29vcmQgKS5yZ2I7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiAoIGNvb3JkLnggPCAwLjcgKSA/IHZlYzMoIDAuNyApIDogdmVjMyggMS4wICk7XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZiI7CgoJdmFyIGxpZ2h0bWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTElHSFRNQVBcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IFBJICogdGV4dHVyZTJEKCBsaWdodE1hcCwgdlV2MiApLnh5eiAqIGxpZ2h0TWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGxpZ2h0TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGxpZ2h0TWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX2xhbWJlcnRfdmVydGV4ID0gInZlYzMgZGlmZnVzZSA9IHZlYzMoIDEuMCApO1xuR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeTtcbmdlb21ldHJ5LnBvc2l0aW9uID0gbXZQb3NpdGlvbi54eXo7XG5nZW9tZXRyeS5ub3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5nZW9tZXRyeS52aWV3RGlyID0gbm9ybWFsaXplKCAtbXZQb3NpdGlvbi54eXogKTtcbkdlb21ldHJpY0NvbnRleHQgYmFja0dlb21ldHJ5O1xuYmFja0dlb21ldHJ5LnBvc2l0aW9uID0gZ2VvbWV0cnkucG9zaXRpb247XG5iYWNrR2VvbWV0cnkubm9ybWFsID0gLWdlb21ldHJ5Lm5vcm1hbDtcbmJhY2tHZW9tZXRyeS52aWV3RGlyID0gZ2VvbWV0cnkudmlld0RpcjtcbnZMaWdodEZyb250ID0gdmVjMyggMC4wICk7XG52SW5kaXJlY3RGcm9udCA9IHZlYzMoIDAuMCApO1xuI2lmZGVmIERPVUJMRV9TSURFRFxuXHR2TGlnaHRCYWNrID0gdmVjMyggMC4wICk7XG5cdHZJbmRpcmVjdEJhY2sgPSB2ZWMzKCAwLjAgKTtcbiNlbmRpZlxuSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodDtcbmZsb2F0IGRvdE5MO1xudmVjMyBkaXJlY3RMaWdodENvbG9yX0RpZmZ1c2U7XG4jaWYgTlVNX1BPSU5UX0xJR0hUUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRTOyBpICsrICkge1xuXHRcdGdldFBvaW50RGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBwb2ludExpZ2h0c1sgaSBdLCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcblx0XHRkb3ROTCA9IGRvdCggZ2VvbWV0cnkubm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRkaXJlY3RMaWdodENvbG9yX0RpZmZ1c2UgPSBQSSAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRcdHZMaWdodEZyb250ICs9IHNhdHVyYXRlKCBkb3ROTCApICogZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xuXHRcdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRcdHZMaWdodEJhY2sgKz0gc2F0dXJhdGUoIC1kb3ROTCApICogZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlO1xuXHRcdCNlbmRpZlxuXHR9XG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRTOyBpICsrICkge1xuXHRcdGdldFNwb3REaXJlY3RMaWdodElycmFkaWFuY2UoIHNwb3RMaWdodHNbIGkgXSwgZ2VvbWV0cnksIGRpcmVjdExpZ2h0ICk7XG5cdFx0ZG90TkwgPSBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICk7XG5cdFx0ZGlyZWN0TGlnaHRDb2xvcl9EaWZmdXNlID0gUEkgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0XHR2TGlnaHRGcm9udCArPSBzYXR1cmF0ZSggZG90TkwgKSAqIGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZTtcblx0XHQjaWZkZWYgRE9VQkxFX1NJREVEXG5cdFx0XHR2TGlnaHRCYWNrICs9IHNhdHVyYXRlKCAtZG90TkwgKSAqIGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmXG4jaWYgTlVNX0RJUl9MSUdIVFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0Z2V0RGlyZWN0aW9uYWxEaXJlY3RMaWdodElycmFkaWFuY2UoIGRpcmVjdGlvbmFsTGlnaHRzWyBpIF0sIGdlb21ldHJ5LCBkaXJlY3RMaWdodCApO1xuXHRcdGRvdE5MID0gZG90KCBnZW9tZXRyeS5ub3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGRpcmVjdExpZ2h0Q29sb3JfRGlmZnVzZSA9IFBJICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0dkxpZ2h0RnJvbnQgKz0gc2F0dXJhdGUoIGRvdE5MICkgKiBkaXJlY3RMaWdodENvbG9yX0RpZmZ1c2U7XG5cdFx0I2lmZGVmIERPVUJMRV9TSURFRFxuXHRcdFx0dkxpZ2h0QmFjayArPSBzYXR1cmF0ZSggLWRvdE5MICkgKiBkaXJlY3RMaWdodENvbG9yX0RpZmZ1c2U7XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9IRU1JX0xJR0hUUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fSEVNSV9MSUdIVFM7IGkgKysgKSB7XG5cdFx0dkluZGlyZWN0RnJvbnQgKz0gZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggaGVtaXNwaGVyZUxpZ2h0c1sgaSBdLCBnZW9tZXRyeSApO1xuXHRcdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRcdHZJbmRpcmVjdEJhY2sgKz0gZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggaGVtaXNwaGVyZUxpZ2h0c1sgaSBdLCBiYWNrR2VvbWV0cnkgKTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX3BhcnNfYmVnaW4gPSAidW5pZm9ybSB2ZWMzIGFtYmllbnRMaWdodENvbG9yO1xudmVjMyBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIGFtYmllbnRMaWdodENvbG9yICkge1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBhbWJpZW50TGlnaHRDb2xvcjtcblx0I2lmbmRlZiBQSFlTSUNBTExZX0NPUlJFQ1RfTElHSFRTXG5cdFx0aXJyYWRpYW5jZSAqPSBQSTtcblx0I2VuZGlmXG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxuI2lmIE5VTV9ESVJfTElHSFRTID4gMFxuXHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodCB7XG5cdFx0dmVjMyBkaXJlY3Rpb247XG5cdFx0dmVjMyBjb2xvcjtcblx0XHRpbnQgc2hhZG93O1xuXHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0fTtcblx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHRzWyBOVU1fRElSX0xJR0hUUyBdO1xuXHR2b2lkIGdldERpcmVjdGlvbmFsRGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIG91dCBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0ICkge1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yID0gZGlyZWN0aW9uYWxMaWdodC5jb2xvcjtcblx0XHRkaXJlY3RMaWdodC5kaXJlY3Rpb24gPSBkaXJlY3Rpb25hbExpZ2h0LmRpcmVjdGlvbjtcblx0XHRkaXJlY3RMaWdodC52aXNpYmxlID0gdHJ1ZTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1BPSU5UX0xJR0hUUyA+IDBcblx0c3RydWN0IFBvaW50TGlnaHQge1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBjb2xvcjtcblx0XHRmbG9hdCBkaXN0YW5jZTtcblx0XHRmbG9hdCBkZWNheTtcblx0XHRpbnQgc2hhZG93O1xuXHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdGZsb2F0IHNoYWRvd0NhbWVyYUZhcjtcblx0fTtcblx0dW5pZm9ybSBQb2ludExpZ2h0IHBvaW50TGlnaHRzWyBOVU1fUE9JTlRfTElHSFRTIF07XG5cdHZvaWQgZ2V0UG9pbnREaXJlY3RMaWdodElycmFkaWFuY2UoIGNvbnN0IGluIFBvaW50TGlnaHQgcG9pbnRMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgb3V0IEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gcG9pbnRMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5LnBvc2l0aW9uO1xuXHRcdGRpcmVjdExpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGxpZ2h0RGlzdGFuY2UgPSBsZW5ndGgoIGxWZWN0b3IgKTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciA9IHBvaW50TGlnaHQuY29sb3I7XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gcHVuY3R1YWxMaWdodEludGVuc2l0eVRvSXJyYWRpYW5jZUZhY3RvciggbGlnaHREaXN0YW5jZSwgcG9pbnRMaWdodC5kaXN0YW5jZSwgcG9pbnRMaWdodC5kZWNheSApO1xuXHRcdGRpcmVjdExpZ2h0LnZpc2libGUgPSAoIGRpcmVjdExpZ2h0LmNvbG9yICE9IHZlYzMoIDAuMCApICk7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUUyA+IDBcblx0c3RydWN0IFNwb3RMaWdodCB7XG5cdFx0dmVjMyBwb3NpdGlvbjtcblx0XHR2ZWMzIGRpcmVjdGlvbjtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdGZsb2F0IGRpc3RhbmNlO1xuXHRcdGZsb2F0IGRlY2F5O1xuXHRcdGZsb2F0IGNvbmVDb3M7XG5cdFx0ZmxvYXQgcGVudW1icmFDb3M7XG5cdFx0aW50IHNoYWRvdztcblx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdH07XG5cdHVuaWZvcm0gU3BvdExpZ2h0IHNwb3RMaWdodHNbIE5VTV9TUE9UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFNwb3REaXJlY3RMaWdodElycmFkaWFuY2UoIGNvbnN0IGluIFNwb3RMaWdodCBzcG90TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIG91dCBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0ICApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeS5wb3NpdGlvbjtcblx0XHRkaXJlY3RMaWdodC5kaXJlY3Rpb24gPSBub3JtYWxpemUoIGxWZWN0b3IgKTtcblx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgYW5nbGVDb3MgPSBkb3QoIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgc3BvdExpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGlmICggYW5nbGVDb3MgPiBzcG90TGlnaHQuY29uZUNvcyApIHtcblx0XHRcdGZsb2F0IHNwb3RFZmZlY3QgPSBzbW9vdGhzdGVwKCBzcG90TGlnaHQuY29uZUNvcywgc3BvdExpZ2h0LnBlbnVtYnJhQ29zLCBhbmdsZUNvcyApO1xuXHRcdFx0ZGlyZWN0TGlnaHQuY29sb3IgPSBzcG90TGlnaHQuY29sb3I7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSBzcG90RWZmZWN0ICogcHVuY3R1YWxMaWdodEludGVuc2l0eVRvSXJyYWRpYW5jZUZhY3RvciggbGlnaHREaXN0YW5jZSwgc3BvdExpZ2h0LmRpc3RhbmNlLCBzcG90TGlnaHQuZGVjYXkgKTtcblx0XHRcdGRpcmVjdExpZ2h0LnZpc2libGUgPSB0cnVlO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciA9IHZlYzMoIDAuMCApO1xuXHRcdFx0ZGlyZWN0TGlnaHQudmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuI2VuZGlmXG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBSZWN0QXJlYUxpZ2h0IHtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0O1xuXHR9O1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTtcdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18yO1xuXHR1bmlmb3JtIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodHNbIE5VTV9SRUNUX0FSRUFfTElHSFRTIF07XG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgc2t5Q29sb3I7XG5cdFx0dmVjMyBncm91bmRDb2xvcjtcblx0fTtcblx0dW5pZm9ybSBIZW1pc3BoZXJlTGlnaHQgaGVtaXNwaGVyZUxpZ2h0c1sgTlVNX0hFTUlfTElHSFRTIF07XG5cdHZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSApIHtcblx0XHRmbG9hdCBkb3ROTCA9IGRvdCggZ2VvbWV0cnkubm9ybWFsLCBoZW1pTGlnaHQuZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgaGVtaURpZmZ1c2VXZWlnaHQgPSAwLjUgKiBkb3ROTCArIDAuNTtcblx0XHR2ZWMzIGlycmFkaWFuY2UgPSBtaXgoIGhlbWlMaWdodC5ncm91bmRDb2xvciwgaGVtaUxpZ2h0LnNreUNvbG9yLCBoZW1pRGlmZnVzZVdlaWdodCApO1xuXHRcdCNpZm5kZWYgUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUU1xuXHRcdFx0aXJyYWRpYW5jZSAqPSBQSTtcblx0XHQjZW5kaWZcblx0XHRyZXR1cm4gaXJyYWRpYW5jZTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBQSFlTSUNBTCApXG5cdHZlYzMgZ2V0TGlnaHRQcm9iZUluZGlyZWN0SXJyYWRpYW5jZSggY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gaW50IG1heE1JUExldmVsICkge1xuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBnZW9tZXRyeS5ub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHRcdFx0dmVjMyBxdWVyeVZlYyA9IHZlYzMoIGZsaXBFbnZNYXAgKiB3b3JsZE5vcm1hbC54LCB3b3JsZE5vcm1hbC55eiApO1xuXHRcdFx0I2lmZGVmIFRFWFRVUkVfTE9EX0VYVFxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVMb2RFWFQoIGVudk1hcCwgcXVlcnlWZWMsIGZsb2F0KCBtYXhNSVBMZXZlbCApICk7XG5cdFx0XHQjZWxzZVxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgcXVlcnlWZWMsIGZsb2F0KCBtYXhNSVBMZXZlbCApICk7XG5cdFx0XHQjZW5kaWZcblx0XHRcdGVudk1hcENvbG9yLnJnYiA9IGVudk1hcFRleGVsVG9MaW5lYXIoIGVudk1hcENvbG9yICkucmdiO1xuXHRcdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHRcdFx0dmVjMyBxdWVyeVZlYyA9IHZlYzMoIGZsaXBFbnZNYXAgKiB3b3JsZE5vcm1hbC54LCB3b3JsZE5vcm1hbC55eiApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgcXVlcnlWZWMsIDEuMCApO1xuXHRcdCNlbHNlXG5cdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdmVjNCggMC4wICk7XG5cdFx0I2VuZGlmXG5cdFx0cmV0dXJuIFBJICogZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHR9XG5cdGZsb2F0IGdldFNwZWN1bGFyTUlQTGV2ZWwoIGNvbnN0IGluIGZsb2F0IGJsaW5uU2hpbmluZXNzRXhwb25lbnQsIGNvbnN0IGluIGludCBtYXhNSVBMZXZlbCApIHtcblx0XHRmbG9hdCBtYXhNSVBMZXZlbFNjYWxhciA9IGZsb2F0KCBtYXhNSVBMZXZlbCApO1xuXHRcdGZsb2F0IGRlc2lyZWRNSVBMZXZlbCA9IG1heE1JUExldmVsU2NhbGFyICsgMC43OTI0OCAtIDAuNSAqIGxvZzIoIHBvdzIoIGJsaW5uU2hpbmluZXNzRXhwb25lbnQgKSArIDEuMCApO1xuXHRcdHJldHVybiBjbGFtcCggZGVzaXJlZE1JUExldmVsLCAwLjAsIG1heE1JUExldmVsU2NhbGFyICk7XG5cdH1cblx0dmVjMyBnZXRMaWdodFByb2JlSW5kaXJlY3RSYWRpYW5jZSggY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gZmxvYXQgYmxpbm5TaGluaW5lc3NFeHBvbmVudCwgY29uc3QgaW4gaW50IG1heE1JUExldmVsICkge1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCAtZ2VvbWV0cnkudmlld0RpciwgZ2VvbWV0cnkubm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIC1nZW9tZXRyeS52aWV3RGlyLCBnZW9tZXRyeS5ub3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHRcdHJlZmxlY3RWZWMgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCByZWZsZWN0VmVjLCB2aWV3TWF0cml4ICk7XG5cdFx0ZmxvYXQgc3BlY3VsYXJNSVBMZXZlbCA9IGdldFNwZWN1bGFyTUlQTGV2ZWwoIGJsaW5uU2hpbmluZXNzRXhwb25lbnQsIG1heE1JUExldmVsICk7XG5cdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHRcdHZlYzMgcXVlcnlSZWZsZWN0VmVjID0gdmVjMyggZmxpcEVudk1hcCAqIHJlZmxlY3RWZWMueCwgcmVmbGVjdFZlYy55eiApO1xuXHRcdFx0I2lmZGVmIFRFWFRVUkVfTE9EX0VYVFxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVMb2RFWFQoIGVudk1hcCwgcXVlcnlSZWZsZWN0VmVjLCBzcGVjdWxhck1JUExldmVsICk7XG5cdFx0XHQjZWxzZVxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgcXVlcnlSZWZsZWN0VmVjLCBzcGVjdWxhck1JUExldmVsICk7XG5cdFx0XHQjZW5kaWZcblx0XHRcdGVudk1hcENvbG9yLnJnYiA9IGVudk1hcFRleGVsVG9MaW5lYXIoIGVudk1hcENvbG9yICkucmdiO1xuXHRcdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHRcdFx0dmVjMyBxdWVyeVJlZmxlY3RWZWMgPSB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICk7XG5cdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCBxdWVyeVJlZmxlY3RWZWMsIEJsaW5uRXhwb25lbnRUb0dHWFJvdWdobmVzcyhibGlublNoaW5pbmVzc0V4cG9uZW50ICkpO1xuXHRcdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0VRVUlSRUMgKVxuXHRcdFx0dmVjMiBzYW1wbGVVVjtcblx0XHRcdHNhbXBsZVVWLnkgPSBhc2luKCBjbGFtcCggcmVmbGVjdFZlYy55LCAtIDEuMCwgMS4wICkgKSAqIFJFQ0lQUk9DQUxfUEkgKyAwLjU7XG5cdFx0XHRzYW1wbGVVVi54ID0gYXRhbiggcmVmbGVjdFZlYy56LCByZWZsZWN0VmVjLnggKSAqIFJFQ0lQUk9DQUxfUEkyICsgMC41O1xuXHRcdFx0I2lmZGVmIFRFWFRVUkVfTE9EX0VYVFxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZTJETG9kRVhUKCBlbnZNYXAsIHNhbXBsZVVWLCBzcGVjdWxhck1JUExldmVsICk7XG5cdFx0XHQjZWxzZVxuXHRcdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZTJEKCBlbnZNYXAsIHNhbXBsZVVWLCBzcGVjdWxhck1JUExldmVsICk7XG5cdFx0XHQjZW5kaWZcblx0XHRcdGVudk1hcENvbG9yLnJnYiA9IGVudk1hcFRleGVsVG9MaW5lYXIoIGVudk1hcENvbG9yICkucmdiO1xuXHRcdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX1NQSEVSRSApXG5cdFx0XHR2ZWMzIHJlZmxlY3RWaWV3ID0gbm9ybWFsaXplKCAoIHZpZXdNYXRyaXggKiB2ZWM0KCByZWZsZWN0VmVjLCAwLjAgKSApLnh5eiArIHZlYzMoIDAuMCwwLjAsMS4wICkgKTtcblx0XHRcdCNpZmRlZiBURVhUVVJFX0xPRF9FWFRcblx0XHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmUyRExvZEVYVCggZW52TWFwLCByZWZsZWN0Vmlldy54eSAqIDAuNSArIDAuNSwgc3BlY3VsYXJNSVBMZXZlbCApO1xuXHRcdFx0I2Vsc2Vcblx0XHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmUyRCggZW52TWFwLCByZWZsZWN0Vmlldy54eSAqIDAuNSArIDAuNSwgc3BlY3VsYXJNSVBMZXZlbCApO1xuXHRcdFx0I2VuZGlmXG5cdFx0XHRlbnZNYXBDb2xvci5yZ2IgPSBlbnZNYXBUZXhlbFRvTGluZWFyKCBlbnZNYXBDb2xvciApLnJnYjtcblx0XHQjZW5kaWZcblx0XHRyZXR1cm4gZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHR9XG4jZW5kaWYiOwoKCXZhciBsaWdodHNfcGhvbmdfZnJhZ21lbnQgPSAiQmxpbm5QaG9uZ01hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjtcbm1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgPSBzcGVjdWxhcjtcbm1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzID0gc2hpbmluZXNzO1xubWF0ZXJpYWwuc3BlY3VsYXJTdHJlbmd0aCA9IHNwZWN1bGFyU3RyZW5ndGg7IjsKCgl2YXIgbGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuI2VuZGlmXG5zdHJ1Y3QgQmxpbm5QaG9uZ01hdGVyaWFsIHtcblx0dmVjM1x0ZGlmZnVzZUNvbG9yO1xuXHR2ZWMzXHRzcGVjdWxhckNvbG9yO1xuXHRmbG9hdFx0c3BlY3VsYXJTaGluaW5lc3M7XG5cdGZsb2F0XHRzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0JsaW5uUGhvbmcoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIEJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdCNpZmRlZiBUT09OXG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeS5ub3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeS5ub3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0I2VuZGlmXG5cdCNpZm5kZWYgUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUU1xuXHRcdGlycmFkaWFuY2UgKj0gUEk7XG5cdCNlbmRpZlxuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0RpZmZ1c2VfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX1NwZWN1bGFyX0JsaW5uUGhvbmcoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeSwgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciwgbWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgKSAqIG1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGg7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nKCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIEJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9EaWZmdXNlX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9CbGlublBob25nXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZ1xuI2RlZmluZSBNYXRlcmlhbF9MaWdodFByb2JlTE9EKCBtYXRlcmlhbCApXHQoMCkiOwoKCXZhciBsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQgPSAiUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2IgKiAoIDEuMCAtIG1ldGFsbmVzc0ZhY3RvciApO1xubWF0ZXJpYWwuc3BlY3VsYXJSb3VnaG5lc3MgPSBjbGFtcCggcm91Z2huZXNzRmFjdG9yLCAwLjA0LCAxLjAgKTtcbiNpZmRlZiBTVEFOREFSRFxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCB2ZWMzKCBERUZBVUxUX1NQRUNVTEFSX0NPRUZGSUNJRU5UICksIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuI2Vsc2Vcblx0bWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IG1peCggdmVjMyggTUFYSU1VTV9TUEVDVUxBUl9DT0VGRklDSUVOVCAqIHBvdzIoIHJlZmxlY3Rpdml0eSApICksIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuXHRtYXRlcmlhbC5jbGVhckNvYXQgPSBzYXR1cmF0ZSggY2xlYXJDb2F0ICk7XHRtYXRlcmlhbC5jbGVhckNvYXRSb3VnaG5lc3MgPSBjbGFtcCggY2xlYXJDb2F0Um91Z2huZXNzLCAwLjA0LCAxLjAgKTtcbiNlbmRpZiI7CgoJdmFyIGxpZ2h0c19waHlzaWNhbF9wYXJzX2ZyYWdtZW50ID0gInN0cnVjdCBQaHlzaWNhbE1hdGVyaWFsIHtcblx0dmVjM1x0ZGlmZnVzZUNvbG9yO1xuXHRmbG9hdFx0c3BlY3VsYXJSb3VnaG5lc3M7XG5cdHZlYzNcdHNwZWN1bGFyQ29sb3I7XG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRmbG9hdCBjbGVhckNvYXQ7XG5cdFx0ZmxvYXQgY2xlYXJDb2F0Um91Z2huZXNzO1xuXHQjZW5kaWZcbn07XG4jZGVmaW5lIE1BWElNVU1fU1BFQ1VMQVJfQ09FRkZJQ0lFTlQgMC4xNlxuI2RlZmluZSBERUZBVUxUX1NQRUNVTEFSX0NPRUZGSUNJRU5UIDAuMDRcbmZsb2F0IGNsZWFyQ29hdERIUkFwcHJveCggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBkb3ROTCApIHtcblx0cmV0dXJuIERFRkFVTFRfU1BFQ1VMQVJfQ09FRkZJQ0lFTlQgKyAoIDEuMCAtIERFRkFVTFRfU1BFQ1VMQVJfQ09FRkZJQ0lFTlQgKSAqICggcG93KCAxLjAgLSBkb3ROTCwgNS4wICkgKiBwb3coIDEuMCAtIHJvdWdobmVzcywgMi4wICkgKTtcbn1cbiNpZiBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDBcblx0dm9pZCBSRV9EaXJlY3RfUmVjdEFyZWFfUGh5c2ljYWwoIGNvbnN0IGluIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodCwgY29uc3QgaW4gR2VvbWV0cmljQ29udGV4dCBnZW9tZXRyeSwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdFx0dmVjMyBub3JtYWwgPSBnZW9tZXRyeS5ub3JtYWw7XG5cdFx0dmVjMyB2aWV3RGlyID0gZ2VvbWV0cnkudmlld0Rpcjtcblx0XHR2ZWMzIHBvc2l0aW9uID0gZ2VvbWV0cnkucG9zaXRpb247XG5cdFx0dmVjMyBsaWdodFBvcyA9IHJlY3RBcmVhTGlnaHQucG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGggPSByZWN0QXJlYUxpZ2h0LmhhbGZXaWR0aDtcblx0XHR2ZWMzIGhhbGZIZWlnaHQgPSByZWN0QXJlYUxpZ2h0LmhhbGZIZWlnaHQ7XG5cdFx0dmVjMyBsaWdodENvbG9yID0gcmVjdEFyZWFMaWdodC5jb2xvcjtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcztcblx0XHR2ZWMzIHJlY3RDb29yZHNbIDQgXTtcblx0XHRyZWN0Q29vcmRzWyAwIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCAtIGhhbGZIZWlnaHQ7XHRcdHJlY3RDb29yZHNbIDEgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcblx0XHRyZWN0Q29vcmRzWyAyIF0gPSBsaWdodFBvcyAtIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG5cdFx0cmVjdENvb3Jkc1sgMyBdID0gbGlnaHRQb3MgKyBoYWxmV2lkdGggKyBoYWxmSGVpZ2h0O1xuXHRcdHZlYzIgdXYgPSBMVENfVXYoIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdFx0dmVjNCB0MSA9IHRleHR1cmUyRCggbHRjXzEsIHV2ICk7XG5cdFx0dmVjNCB0MiA9IHRleHR1cmUyRCggbHRjXzIsIHV2ICk7XG5cdFx0bWF0MyBtSW52ID0gbWF0Myhcblx0XHRcdHZlYzMoIHQxLngsIDAsIHQxLnkgKSxcblx0XHRcdHZlYzMoICAgIDAsIDEsICAgIDAgKSxcblx0XHRcdHZlYzMoIHQxLnosIDAsIHQxLncgKVxuXHRcdCk7XG5cdFx0dmVjMyBmcmVzbmVsID0gKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICogdDIueCArICggdmVjMyggMS4wICkgLSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICkgKiB0Mi55ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gbGlnaHRDb2xvciAqIGZyZXNuZWwgKiBMVENfRXZhbHVhdGUoIG5vcm1hbCwgdmlld0RpciwgcG9zaXRpb24sIG1JbnYsIHJlY3RDb29yZHMgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGxpZ2h0Q29sb3IgKiBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKiBMVENfRXZhbHVhdGUoIG5vcm1hbCwgdmlld0RpciwgcG9zaXRpb24sIG1hdDMoIDEuMCApLCByZWN0Q29vcmRzICk7XG5cdH1cbiNlbmRpZlxudm9pZCBSRV9EaXJlY3RfUGh5c2ljYWwoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0I2lmbmRlZiBQSFlTSUNBTExZX0NPUlJFQ1RfTElHSFRTXG5cdFx0aXJyYWRpYW5jZSAqPSBQSTtcblx0I2VuZGlmXG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRmbG9hdCBjbGVhckNvYXRESFIgPSBtYXRlcmlhbC5jbGVhckNvYXQgKiBjbGVhckNvYXRESFJBcHByb3goIG1hdGVyaWFsLmNsZWFyQ29hdFJvdWdobmVzcywgZG90TkwgKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBjbGVhckNvYXRESFIgPSAwLjA7XG5cdCNlbmRpZlxuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSAoIDEuMCAtIGNsZWFyQ29hdERIUiApICogaXJyYWRpYW5jZSAqIEJSREZfU3BlY3VsYXJfR0dYKCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyUm91Z2huZXNzICk7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gKCAxLjAgLSBjbGVhckNvYXRESFIgKSAqIGlycmFkaWFuY2UgKiBCUkRGX0RpZmZ1c2VfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogbWF0ZXJpYWwuY2xlYXJDb2F0ICogQlJERl9TcGVjdWxhcl9HR1goIGRpcmVjdExpZ2h0LCBnZW9tZXRyeSwgdmVjMyggREVGQVVMVF9TUEVDVUxBUl9DT0VGRklDSUVOVCApLCBtYXRlcmlhbC5jbGVhckNvYXRSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiBHZW9tZXRyaWNDb250ZXh0IGdlb21ldHJ5LCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0I2lmbmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0RpZmZ1c2VfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG5cdCNlbmRpZlxufVxudm9pZCBSRV9JbmRpcmVjdFNwZWN1bGFyX1BoeXNpY2FsKCBjb25zdCBpbiB2ZWMzIHJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgY2xlYXJDb2F0UmFkaWFuY2UsIGNvbnN0IGluIEdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnksIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0KSB7XG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Lm5vcm1hbCwgZ2VvbWV0cnkudmlld0RpciApICk7XG5cdFx0ZmxvYXQgZG90TkwgPSBkb3ROVjtcblx0XHRmbG9hdCBjbGVhckNvYXRESFIgPSBtYXRlcmlhbC5jbGVhckNvYXQgKiBjbGVhckNvYXRESFJBcHByb3goIG1hdGVyaWFsLmNsZWFyQ29hdFJvdWdobmVzcywgZG90TkwgKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBjbGVhckNvYXRESFIgPSAwLjA7XG5cdCNlbmRpZlxuXHRmbG9hdCBjbGVhckNvYXRJbnYgPSAxLjAgLSBjbGVhckNvYXRESFI7XG5cdCNpZiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHR2ZWMzIHNpbmdsZVNjYXR0ZXJpbmcgPSB2ZWMzKCAwLjAgKTtcblx0XHR2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHRcdHZlYzMgY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlID0gaXJyYWRpYW5jZSAqIFJFQ0lQUk9DQUxfUEk7XG5cdFx0QlJERl9TcGVjdWxhcl9NdWx0aXNjYXR0ZXJpbmdfRW52aXJvbm1lbnQoIGdlb21ldHJ5LCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcywgc2luZ2xlU2NhdHRlcmluZywgbXVsdGlTY2F0dGVyaW5nICk7XG5cdFx0dmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gY2xlYXJDb2F0SW52ICogcmFkaWFuY2UgKiBzaW5nbGVTY2F0dGVyaW5nO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBtdWx0aVNjYXR0ZXJpbmcgKiBjb3NpbmVXZWlnaHRlZElycmFkaWFuY2U7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGRpZmZ1c2UgKiBjb3NpbmVXZWlnaHRlZElycmFkaWFuY2U7XG5cdCNlbHNlXG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSBjbGVhckNvYXRJbnYgKiByYWRpYW5jZSAqIEJSREZfU3BlY3VsYXJfR0dYX0Vudmlyb25tZW50KCBnZW9tZXRyeSwgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciwgbWF0ZXJpYWwuc3BlY3VsYXJSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICs9IGNsZWFyQ29hdFJhZGlhbmNlICogbWF0ZXJpYWwuY2xlYXJDb2F0ICogQlJERl9TcGVjdWxhcl9HR1hfRW52aXJvbm1lbnQoIGdlb21ldHJ5LCB2ZWMzKCBERUZBVUxUX1NQRUNVTEFSX0NPRUZGSUNJRU5UICksIG1hdGVyaWFsLmNsZWFyQ29hdFJvdWdobmVzcyApO1xuXHQjZW5kaWZcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfUGh5c2ljYWxcbiNkZWZpbmUgUkVfRGlyZWN0X1JlY3RBcmVhXHRcdFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXJcdFx0UkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbFxuI2RlZmluZSBNYXRlcmlhbF9CbGlublNoaW5pbmVzc0V4cG9uZW50KCBtYXRlcmlhbCApICAgR0dYUm91Z2huZXNzVG9CbGlubkV4cG9uZW50KCBtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcyApXG4jZGVmaW5lIE1hdGVyaWFsX0NsZWFyQ29hdF9CbGlublNoaW5pbmVzc0V4cG9uZW50KCBtYXRlcmlhbCApICAgR0dYUm91Z2huZXNzVG9CbGlubkV4cG9uZW50KCBtYXRlcmlhbC5jbGVhckNvYXRSb3VnaG5lc3MgKVxuZmxvYXQgY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgYW1iaWVudE9jY2x1c2lvbiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7CgoJdmFyIGxpZ2h0c19mcmFnbWVudF9iZWdpbiA9ICJcbkdlb21ldHJpY0NvbnRleHQgZ2VvbWV0cnk7XG5nZW9tZXRyeS5wb3NpdGlvbiA9IC0gdlZpZXdQb3NpdGlvbjtcbmdlb21ldHJ5Lm5vcm1hbCA9IG5vcm1hbDtcbmdlb21ldHJ5LnZpZXdEaXIgPSBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcbkluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQ7XG4jaWYgKCBOVU1fUE9JTlRfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFBvaW50TGlnaHQgcG9pbnRMaWdodDtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRTOyBpICsrICkge1xuXHRcdHBvaW50TGlnaHQgPSBwb2ludExpZ2h0c1sgaSBdO1xuXHRcdGdldFBvaW50RGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBwb2ludExpZ2h0LCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWZkZWYgVVNFX1NIQURPV01BUFxuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9IGFsbCggYnZlYzIoIHBvaW50TGlnaHQuc2hhZG93LCBkaXJlY3RMaWdodC52aXNpYmxlICkgKSA/IGdldFBvaW50U2hhZG93KCBwb2ludFNoYWRvd01hcFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd01hcFNpemUsIHBvaW50TGlnaHQuc2hhZG93QmlhcywgcG9pbnRMaWdodC5zaGFkb3dSYWRpdXMsIHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0sIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhTmVhciwgcG9pbnRMaWdodC5zaGFkb3dDYW1lcmFGYXIgKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cbiNlbmRpZlxuI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFNwb3RMaWdodCBzcG90TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRTOyBpICsrICkge1xuXHRcdHNwb3RMaWdodCA9IHNwb3RMaWdodHNbIGkgXTtcblx0XHRnZXRTcG90RGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBzcG90TGlnaHQsIGdlb21ldHJ5LCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gYWxsKCBidmVjMiggc3BvdExpZ2h0LnNoYWRvdywgZGlyZWN0TGlnaHQudmlzaWJsZSApICkgPyBnZXRTaGFkb3coIHNwb3RTaGFkb3dNYXBbIGkgXSwgc3BvdExpZ2h0LnNoYWRvd01hcFNpemUsIHNwb3RMaWdodC5zaGFkb3dCaWFzLCBzcG90TGlnaHQuc2hhZG93UmFkaXVzLCB2U3BvdFNoYWRvd0Nvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cbiNlbmRpZlxuI2lmICggTlVNX0RJUl9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0RGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wXG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9ESVJfTElHSFRTOyBpICsrICkge1xuXHRcdGRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0c1sgaSBdO1xuXHRcdGdldERpcmVjdGlvbmFsRGlyZWN0TGlnaHRJcnJhZGlhbmNlKCBkaXJlY3Rpb25hbExpZ2h0LCBnZW9tZXRyeSwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWZkZWYgVVNFX1NIQURPV01BUFxuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9IGFsbCggYnZlYzIoIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93LCBkaXJlY3RMaWdodC52aXNpYmxlICkgKSA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG4jZW5kaWZcbiNpZiAoIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdF9SZWN0QXJlYSApXG5cdFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodDtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUkVDVF9BUkVBX0xJR0hUUzsgaSArKyApIHtcblx0XHRyZWN0QXJlYUxpZ2h0ID0gcmVjdEFyZWFMaWdodHNbIGkgXTtcblx0XHRSRV9EaXJlY3RfUmVjdEFyZWEoIHJlY3RBcmVhTGlnaHQsIGdlb21ldHJ5LCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcblx0I2lmICggTlVNX0hFTUlfTElHSFRTID4gMCApXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9IRU1JX0xJR0hUUzsgaSArKyApIHtcblx0XHRcdGlycmFkaWFuY2UgKz0gZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggaGVtaXNwaGVyZUxpZ2h0c1sgaSBdLCBnZW9tZXRyeSApO1xuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcblx0dmVjMyByYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNsZWFyQ29hdFJhZGlhbmNlID0gdmVjMyggMC4wICk7XG4jZW5kaWYiOwoKCXZhciBsaWdodHNfZnJhZ21lbnRfbWFwcyA9ICIjaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gdGV4dHVyZTJEKCBsaWdodE1hcCwgdlV2MiApLnh5eiAqIGxpZ2h0TWFwSW50ZW5zaXR5O1xuXHRcdCNpZm5kZWYgUEhZU0lDQUxMWV9DT1JSRUNUX0xJR0hUU1xuXHRcdFx0bGlnaHRNYXBJcnJhZGlhbmNlICo9IFBJO1xuXHRcdCNlbmRpZlxuXHRcdGlycmFkaWFuY2UgKz0gbGlnaHRNYXBJcnJhZGlhbmNlO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBQSFlTSUNBTCApICYmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHRcdGlycmFkaWFuY2UgKz0gZ2V0TGlnaHRQcm9iZUluZGlyZWN0SXJyYWRpYW5jZSggZ2VvbWV0cnksIG1heE1pcExldmVsICk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHRyYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSW5kaXJlY3RSYWRpYW5jZSggZ2VvbWV0cnksIE1hdGVyaWFsX0JsaW5uU2hpbmluZXNzRXhwb25lbnQoIG1hdGVyaWFsICksIG1heE1pcExldmVsICk7XG5cdCNpZm5kZWYgU1RBTkRBUkRcblx0XHRjbGVhckNvYXRSYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSW5kaXJlY3RSYWRpYW5jZSggZ2VvbWV0cnksIE1hdGVyaWFsX0NsZWFyQ29hdF9CbGlublNoaW5pbmVzc0V4cG9uZW50KCBtYXRlcmlhbCApLCBtYXhNaXBMZXZlbCApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGxpZ2h0c19mcmFnbWVudF9lbmQgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdFJFX0luZGlyZWN0RGlmZnVzZSggaXJyYWRpYW5jZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdFJFX0luZGlyZWN0U3BlY3VsYXIoIHJhZGlhbmNlLCBpcnJhZGlhbmNlLCBjbGVhckNvYXRSYWRpYW5jZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRiApICYmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRl9FWFQgKVxuXHRnbF9GcmFnRGVwdGhFWFQgPSBsb2cyKCB2RnJhZ0RlcHRoICkgKiBsb2dEZXB0aEJ1ZkZDICogMC41O1xuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGICkgJiYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGX0VYVCApXG5cdHVuaWZvcm0gZmxvYXQgbG9nRGVwdGhCdWZGQztcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9MT0dERVBUSEJVRlxuXHQjaWZkZWYgVVNFX0xPR0RFUFRIQlVGX0VYVFxuXHRcdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0I2Vsc2Vcblx0XHR1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0I2lmZGVmIFVTRV9MT0dERVBUSEJVRl9FWFRcblx0XHR2RnJhZ0RlcHRoID0gMS4wICsgZ2xfUG9zaXRpb24udztcblx0I2Vsc2Vcblx0XHRnbF9Qb3NpdGlvbi56ID0gbG9nMiggbWF4KCBFUFNJTE9OLCBnbF9Qb3NpdGlvbi53ICsgMS4wICkgKSAqIGxvZ0RlcHRoQnVmRkMgLSAxLjA7XG5cdFx0Z2xfUG9zaXRpb24ueiAqPSBnbF9Qb3NpdGlvbi53O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX01BUFxuXHR2ZWM0IHRleGVsQ29sb3IgPSB0ZXh0dXJlMkQoIG1hcCwgdlV2ICk7XG5cdHRleGVsQ29sb3IgPSBtYXBUZXhlbFRvTGluZWFyKCB0ZXhlbENvbG9yICk7XG5cdGRpZmZ1c2VDb2xvciAqPSB0ZXhlbENvbG9yO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHZlYzIgdXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggZ2xfUG9pbnRDb29yZC54LCAxLjAgLSBnbF9Qb2ludENvb3JkLnksIDEgKSApLnh5O1xuXHR2ZWM0IG1hcFRleGVsID0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG5cdGRpZmZ1c2VDb2xvciAqPSBtYXBUZXhlbFRvTGluZWFyKCBtYXBUZXhlbCApO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBtYXA7XG4jZW5kaWYiOwoKCXZhciBtZXRhbG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgbWV0YWxuZXNzRmFjdG9yID0gbWV0YWxuZXNzO1xuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dmVjNCB0ZXhlbE1ldGFsbmVzcyA9IHRleHR1cmUyRCggbWV0YWxuZXNzTWFwLCB2VXYgKTtcblx0bWV0YWxuZXNzRmFjdG9yICo9IHRleGVsTWV0YWxuZXNzLmI7XG4jZW5kaWYiOwoKCXZhciBtZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBtZXRhbG5lc3NNYXA7XG4jZW5kaWYiOwoKCXZhciBtb3JwaG5vcm1hbF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9NT1JQSE5PUk1BTFNcblx0b2JqZWN0Tm9ybWFsICs9ICggbW9ycGhOb3JtYWwwIC0gbm9ybWFsICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDAgXTtcblx0b2JqZWN0Tm9ybWFsICs9ICggbW9ycGhOb3JtYWwxIC0gbm9ybWFsICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDEgXTtcblx0b2JqZWN0Tm9ybWFsICs9ICggbW9ycGhOb3JtYWwyIC0gbm9ybWFsICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDIgXTtcblx0b2JqZWN0Tm9ybWFsICs9ICggbW9ycGhOb3JtYWwzIC0gbm9ybWFsICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDMgXTtcbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdCNpZm5kZWYgVVNFX01PUlBITk9STUFMU1xuXHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgOCBdO1xuXHQjZWxzZVxuXHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNCBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR0cmFuc2Zvcm1lZCArPSAoIG1vcnBoVGFyZ2V0MCAtIHBvc2l0aW9uICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDAgXTtcblx0dHJhbnNmb3JtZWQgKz0gKCBtb3JwaFRhcmdldDEgLSBwb3NpdGlvbiApICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAxIF07XG5cdHRyYW5zZm9ybWVkICs9ICggbW9ycGhUYXJnZXQyIC0gcG9zaXRpb24gKSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMiBdO1xuXHR0cmFuc2Zvcm1lZCArPSAoIG1vcnBoVGFyZ2V0MyAtIHBvc2l0aW9uICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDMgXTtcblx0I2lmbmRlZiBVU0VfTU9SUEhOT1JNQUxTXG5cdHRyYW5zZm9ybWVkICs9ICggbW9ycGhUYXJnZXQ0IC0gcG9zaXRpb24gKSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNCBdO1xuXHR0cmFuc2Zvcm1lZCArPSAoIG1vcnBoVGFyZ2V0NSAtIHBvc2l0aW9uICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDUgXTtcblx0dHJhbnNmb3JtZWQgKz0gKCBtb3JwaFRhcmdldDYgLSBwb3NpdGlvbiApICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA2IF07XG5cdHRyYW5zZm9ybWVkICs9ICggbW9ycGhUYXJnZXQ3IC0gcG9zaXRpb24gKSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG5vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICIjaWZkZWYgRkxBVF9TSEFERURcblx0dmVjMyBmZHggPSB2ZWMzKCBkRmR4KCB2Vmlld1Bvc2l0aW9uLnggKSwgZEZkeCggdlZpZXdQb3NpdGlvbi55ICksIGRGZHgoIHZWaWV3UG9zaXRpb24ueiApICk7XG5cdHZlYzMgZmR5ID0gdmVjMyggZEZkeSggdlZpZXdQb3NpdGlvbi54ICksIGRGZHkoIHZWaWV3UG9zaXRpb24ueSApLCBkRmR5KCB2Vmlld1Bvc2l0aW9uLnogKSApO1xuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTtcbiNlbHNlXG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgPSBub3JtYWwgKiAoIGZsb2F0KCBnbF9Gcm9udEZhY2luZyApICogMi4wIC0gMS4wICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2ZWMzIHRhbmdlbnQgPSBub3JtYWxpemUoIHZUYW5nZW50ICk7XG5cdFx0dmVjMyBiaXRhbmdlbnQgPSBub3JtYWxpemUoIHZCaXRhbmdlbnQgKTtcblx0XHQjaWZkZWYgRE9VQkxFX1NJREVEXG5cdFx0XHR0YW5nZW50ID0gdGFuZ2VudCAqICggZmxvYXQoIGdsX0Zyb250RmFjaW5nICkgKiAyLjAgLSAxLjAgKTtcblx0XHRcdGJpdGFuZ2VudCA9IGJpdGFuZ2VudCAqICggZmxvYXQoIGdsX0Zyb250RmFjaW5nICkgKiAyLjAgLSAxLjAgKTtcblx0XHQjZW5kaWZcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX05PUk1BTE1BUFxuXHQjaWZkZWYgT0JKRUNUU1BBQ0VfTk9STUFMTUFQXG5cdFx0bm9ybWFsID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0XHQjaWZkZWYgRkxJUF9TSURFRFxuXHRcdFx0bm9ybWFsID0gLSBub3JtYWw7XG5cdFx0I2VuZGlmXG5cdFx0I2lmZGVmIERPVUJMRV9TSURFRFxuXHRcdFx0bm9ybWFsID0gbm9ybWFsICogKCBmbG9hdCggZ2xfRnJvbnRGYWNpbmcgKSAqIDIuMCAtIDEuMCApO1xuXHRcdCNlbmRpZlxuXHRcdG5vcm1hbCA9IG5vcm1hbGl6ZSggbm9ybWFsTWF0cml4ICogbm9ybWFsICk7XG5cdCNlbHNlXG5cdFx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0XHRtYXQzIHZUQk4gPSBtYXQzKCB0YW5nZW50LCBiaXRhbmdlbnQsIG5vcm1hbCApO1xuXHRcdFx0dmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0XHRcdG1hcE4ueHkgPSBub3JtYWxTY2FsZSAqIG1hcE4ueHk7XG5cdFx0XHRub3JtYWwgPSBub3JtYWxpemUoIHZUQk4gKiBtYXBOICk7XG5cdFx0I2Vsc2Vcblx0XHRcdG5vcm1hbCA9IHBlcnR1cmJOb3JtYWwyQXJiKCAtdlZpZXdQb3NpdGlvbiwgbm9ybWFsICk7XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VsaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKVxuXHRub3JtYWwgPSBwZXJ0dXJiTm9ybWFsQXJiKCAtdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSApO1xuI2VuZGlmIjsKCgl2YXIgbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgbm9ybWFsU2NhbGU7XG5cdCNpZmRlZiBPQkpFQ1RTUEFDRV9OT1JNQUxNQVBcblx0XHR1bmlmb3JtIG1hdDMgbm9ybWFsTWF0cml4O1xuXHQjZWxzZVxuXHRcdHZlYzMgcGVydHVyYk5vcm1hbDJBcmIoIHZlYzMgZXllX3BvcywgdmVjMyBzdXJmX25vcm0gKSB7XG5cdFx0XHR2ZWMzIHEwID0gdmVjMyggZEZkeCggZXllX3Bvcy54ICksIGRGZHgoIGV5ZV9wb3MueSApLCBkRmR4KCBleWVfcG9zLnogKSApO1xuXHRcdFx0dmVjMyBxMSA9IHZlYzMoIGRGZHkoIGV5ZV9wb3MueCApLCBkRmR5KCBleWVfcG9zLnkgKSwgZEZkeSggZXllX3Bvcy56ICkgKTtcblx0XHRcdHZlYzIgc3QwID0gZEZkeCggdlV2LnN0ICk7XG5cdFx0XHR2ZWMyIHN0MSA9IGRGZHkoIHZVdi5zdCApO1xuXHRcdFx0ZmxvYXQgc2NhbGUgPSBzaWduKCBzdDEudCAqIHN0MC5zIC0gc3QwLnQgKiBzdDEucyApO1xuXHRcdFx0dmVjMyBTID0gbm9ybWFsaXplKCAoIHEwICogc3QxLnQgLSBxMSAqIHN0MC50ICkgKiBzY2FsZSApO1xuXHRcdFx0dmVjMyBUID0gbm9ybWFsaXplKCAoIC0gcTAgKiBzdDEucyArIHExICogc3QwLnMgKSAqIHNjYWxlICk7XG5cdFx0XHR2ZWMzIE4gPSBub3JtYWxpemUoIHN1cmZfbm9ybSApO1xuXHRcdFx0bWF0MyB0c24gPSBtYXQzKCBTLCBULCBOICk7XG5cdFx0XHR2ZWMzIG1hcE4gPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdlV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHRcdFx0bWFwTi54eSAqPSBub3JtYWxTY2FsZTtcblx0XHRcdG1hcE4ueHkgKj0gKCBmbG9hdCggZ2xfRnJvbnRGYWNpbmcgKSAqIDIuMCAtIDEuMCApO1xuXHRcdFx0cmV0dXJuIG5vcm1hbGl6ZSggdHNuICogbWFwTiApO1xuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBwYWNraW5nID0gInZlYzMgcGFja05vcm1hbFRvUkdCKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggbm9ybWFsICkgKiAwLjUgKyAwLjU7XG59XG52ZWMzIHVucGFja1JHQlRvTm9ybWFsKCBjb25zdCBpbiB2ZWMzIHJnYiApIHtcblx0cmV0dXJuIDIuMCAqIHJnYi54eXogLSAxLjA7XG59XG5jb25zdCBmbG9hdCBQYWNrVXBzY2FsZSA9IDI1Ni4gLyAyNTUuO2NvbnN0IGZsb2F0IFVucGFja0Rvd25zY2FsZSA9IDI1NS4gLyAyNTYuO1xuY29uc3QgdmVjMyBQYWNrRmFjdG9ycyA9IHZlYzMoIDI1Ni4gKiAyNTYuICogMjU2LiwgMjU2LiAqIDI1Ni4sICAyNTYuICk7XG5jb25zdCB2ZWM0IFVucGFja0ZhY3RvcnMgPSBVbnBhY2tEb3duc2NhbGUgLyB2ZWM0KCBQYWNrRmFjdG9ycywgMS4gKTtcbmNvbnN0IGZsb2F0IFNoaWZ0UmlnaHQ4ID0gMS4gLyAyNTYuO1xudmVjNCBwYWNrRGVwdGhUb1JHQkEoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdHZlYzQgciA9IHZlYzQoIGZyYWN0KCB2ICogUGFja0ZhY3RvcnMgKSwgdiApO1xuXHRyLnl6dyAtPSByLnh5eiAqIFNoaWZ0UmlnaHQ4O1x0cmV0dXJuIHIgKiBQYWNrVXBzY2FsZTtcbn1cbmZsb2F0IHVucGFja1JHQkFUb0RlcHRoKCBjb25zdCBpbiB2ZWM0IHYgKSB7XG5cdHJldHVybiBkb3QoIHYsIFVucGFja0ZhY3RvcnMgKTtcbn1cbmZsb2F0IHZpZXdaVG9PcnRob2dyYXBoaWNEZXB0aCggY29uc3QgaW4gZmxvYXQgdmlld1osIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggdmlld1ogKyBuZWFyICkgLyAoIG5lYXIgLSBmYXIgKTtcbn1cbmZsb2F0IG9ydGhvZ3JhcGhpY0RlcHRoVG9WaWV3WiggY29uc3QgaW4gZmxvYXQgbGluZWFyQ2xpcFosIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuIGxpbmVhckNsaXBaICogKCBuZWFyIC0gZmFyICkgLSBuZWFyO1xufVxuZmxvYXQgdmlld1pUb1BlcnNwZWN0aXZlRGVwdGgoIGNvbnN0IGluIGZsb2F0IHZpZXdaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG5cdHJldHVybiAoKCBuZWFyICsgdmlld1ogKSAqIGZhciApIC8gKCggZmFyIC0gbmVhciApICogdmlld1ogKTtcbn1cbmZsb2F0IHBlcnNwZWN0aXZlRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBpbnZDbGlwWiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCBuZWFyICogZmFyICkgLyAoICggZmFyIC0gbmVhciApICogaW52Q2xpcFogLSBmYXIgKTtcbn0iOwoKCXZhciBwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50ID0gIiNpZmRlZiBQUkVNVUxUSVBMSUVEX0FMUEhBXG5cdGdsX0ZyYWdDb2xvci5yZ2IgKj0gZ2xfRnJhZ0NvbG9yLmE7XG4jZW5kaWYiOwoKCXZhciBwcm9qZWN0X3ZlcnRleCA9ICJ2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG5nbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uOyI7CgoJdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggRElUSEVSSU5HIClcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IGRpdGhlcmluZyggZ2xfRnJhZ0NvbG9yLnJnYiApO1xuI2VuZGlmIjsKCgl2YXIgZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIERJVEhFUklORyApXG5cdHZlYzMgZGl0aGVyaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRcdGZsb2F0IGdyaWRfcG9zaXRpb24gPSByYW5kKCBnbF9GcmFnQ29vcmQueHkgKTtcblx0XHR2ZWMzIGRpdGhlcl9zaGlmdF9SR0IgPSB2ZWMzKCAwLjI1IC8gMjU1LjAsIC0wLjI1IC8gMjU1LjAsIDAuMjUgLyAyNTUuMCApO1xuXHRcdGRpdGhlcl9zaGlmdF9SR0IgPSBtaXgoIDIuMCAqIGRpdGhlcl9zaGlmdF9SR0IsIC0yLjAgKiBkaXRoZXJfc2hpZnRfUkdCLCBncmlkX3Bvc2l0aW9uICk7XG5cdFx0cmV0dXJuIGNvbG9yICsgZGl0aGVyX3NoaWZ0X1JHQjtcblx0fVxuI2VuZGlmIjsKCgl2YXIgcm91Z2huZXNzbWFwX2ZyYWdtZW50ID0gImZsb2F0IHJvdWdobmVzc0ZhY3RvciA9IHJvdWdobmVzcztcbiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHZlYzQgdGV4ZWxSb3VnaG5lc3MgPSB0ZXh0dXJlMkQoIHJvdWdobmVzc01hcCwgdlV2ICk7XG5cdHJvdWdobmVzc0ZhY3RvciAqPSB0ZXhlbFJvdWdobmVzcy5nO1xuI2VuZGlmIjsKCgl2YXIgcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgcm91Z2huZXNzTWFwO1xuI2VuZGlmIjsKCgl2YXIgc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9TSEFET1dNQVBcblx0I2lmIE5VTV9ESVJfTElHSFRTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBOVU1fRElSX0xJR0hUUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgTlVNX0RJUl9MSUdIVFMgXTtcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVFMgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdFNoYWRvd01hcFsgTlVNX1NQT1RfTElHSFRTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZTcG90U2hhZG93Q29vcmRbIE5VTV9TUE9UX0xJR0hUUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgcG9pbnRTaGFkb3dNYXBbIE5VTV9QT0lOVF9MSUdIVFMgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVFMgXTtcblx0I2VuZGlmXG5cdGZsb2F0IHRleHR1cmUyRENvbXBhcmUoIHNhbXBsZXIyRCBkZXB0aHMsIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKSB7XG5cdFx0cmV0dXJuIHN0ZXAoIGNvbXBhcmUsIHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIGRlcHRocywgdXYgKSApICk7XG5cdH1cblx0ZmxvYXQgdGV4dHVyZTJEU2hhZG93TGVycCggc2FtcGxlcjJEIGRlcHRocywgdmVjMiBzaXplLCB2ZWMyIHV2LCBmbG9hdCBjb21wYXJlICkge1xuXHRcdGNvbnN0IHZlYzIgb2Zmc2V0ID0gdmVjMiggMC4wLCAxLjAgKTtcblx0XHR2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gc2l6ZTtcblx0XHR2ZWMyIGNlbnRyb2lkVVYgPSBmbG9vciggdXYgKiBzaXplICsgMC41ICkgLyBzaXplO1xuXHRcdGZsb2F0IGxiID0gdGV4dHVyZTJEQ29tcGFyZSggZGVwdGhzLCBjZW50cm9pZFVWICsgdGV4ZWxTaXplICogb2Zmc2V0Lnh4LCBjb21wYXJlICk7XG5cdFx0ZmxvYXQgbHQgPSB0ZXh0dXJlMkRDb21wYXJlKCBkZXB0aHMsIGNlbnRyb2lkVVYgKyB0ZXhlbFNpemUgKiBvZmZzZXQueHksIGNvbXBhcmUgKTtcblx0XHRmbG9hdCByYiA9IHRleHR1cmUyRENvbXBhcmUoIGRlcHRocywgY2VudHJvaWRVViArIHRleGVsU2l6ZSAqIG9mZnNldC55eCwgY29tcGFyZSApO1xuXHRcdGZsb2F0IHJ0ID0gdGV4dHVyZTJEQ29tcGFyZSggZGVwdGhzLCBjZW50cm9pZFVWICsgdGV4ZWxTaXplICogb2Zmc2V0Lnl5LCBjb21wYXJlICk7XG5cdFx0dmVjMiBmID0gZnJhY3QoIHV2ICogc2l6ZSArIDAuNSApO1xuXHRcdGZsb2F0IGEgPSBtaXgoIGxiLCBsdCwgZi55ICk7XG5cdFx0ZmxvYXQgYiA9IG1peCggcmIsIHJ0LCBmLnkgKTtcblx0XHRmbG9hdCBjID0gbWl4KCBhLCBiLCBmLnggKTtcblx0XHRyZXR1cm4gYztcblx0fVxuXHRmbG9hdCBnZXRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93QmlhcywgZmxvYXQgc2hhZG93UmFkaXVzLCB2ZWM0IHNoYWRvd0Nvb3JkICkge1xuXHRcdGZsb2F0IHNoYWRvdyA9IDEuMDtcblx0XHRzaGFkb3dDb29yZC54eXogLz0gc2hhZG93Q29vcmQudztcblx0XHRzaGFkb3dDb29yZC56ICs9IHNoYWRvd0JpYXM7XG5cdFx0YnZlYzQgaW5GcnVzdHVtVmVjID0gYnZlYzQgKCBzaGFkb3dDb29yZC54ID49IDAuMCwgc2hhZG93Q29vcmQueCA8PSAxLjAsIHNoYWRvd0Nvb3JkLnkgPj0gMC4wLCBzaGFkb3dDb29yZC55IDw9IDEuMCApO1xuXHRcdGJvb2wgaW5GcnVzdHVtID0gYWxsKCBpbkZydXN0dW1WZWMgKTtcblx0XHRidmVjMiBmcnVzdHVtVGVzdFZlYyA9IGJ2ZWMyKCBpbkZydXN0dW0sIHNoYWRvd0Nvb3JkLnogPD0gMS4wICk7XG5cdFx0Ym9vbCBmcnVzdHVtVGVzdCA9IGFsbCggZnJ1c3R1bVRlc3RWZWMgKTtcblx0XHRpZiAoIGZydXN0dW1UZXN0ICkge1xuXHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKVxuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBkeDAgPSAtIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkwID0gLSB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MSA9ICsgdGV4ZWxTaXplLnggKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeTEgPSArIHRleGVsU2l6ZS55ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDEsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQgKVxuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBkeDAgPSAtIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkwID0gLSB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MSA9ICsgdGV4ZWxTaXplLnggKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeTEgPSArIHRleGVsU2l6ZS55ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRTaGFkb3dMZXJwKCBzaGFkb3dNYXAsIHNoYWRvd01hcFNpemUsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEU2hhZG93TGVycCggc2hhZG93TWFwLCBzaGFkb3dNYXBTaXplLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRFNoYWRvd0xlcnAoIHNoYWRvd01hcCwgc2hhZG93TWFwU2l6ZSwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDEsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRTaGFkb3dMZXJwKCBzaGFkb3dNYXAsIHNoYWRvd01hcFNpemUsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEU2hhZG93TGVycCggc2hhZG93TWFwLCBzaGFkb3dNYXBTaXplLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEU2hhZG93TGVycCggc2hhZG93TWFwLCBzaGFkb3dNYXBTaXplLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRFNoYWRvd0xlcnAoIHNoYWRvd01hcCwgc2hhZG93TWFwU2l6ZSwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRTaGFkb3dMZXJwKCBzaGFkb3dNYXAsIHNoYWRvd01hcFNpemUsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEU2hhZG93TGVycCggc2hhZG93TWFwLCBzaGFkb3dNYXBTaXplLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHNoYWRvdyA9IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHksIHNoYWRvd0Nvb3JkLnogKTtcblx0XHQjZW5kaWZcblx0XHR9XG5cdFx0cmV0dXJuIHNoYWRvdztcblx0fVxuXHR2ZWMyIGN1YmVUb1VWKCB2ZWMzIHYsIGZsb2F0IHRleGVsU2l6ZVkgKSB7XG5cdFx0dmVjMyBhYnNWID0gYWJzKCB2ICk7XG5cdFx0ZmxvYXQgc2NhbGVUb0N1YmUgPSAxLjAgLyBtYXgoIGFic1YueCwgbWF4KCBhYnNWLnksIGFic1YueiApICk7XG5cdFx0YWJzViAqPSBzY2FsZVRvQ3ViZTtcblx0XHR2ICo9IHNjYWxlVG9DdWJlICogKCAxLjAgLSAyLjAgKiB0ZXhlbFNpemVZICk7XG5cdFx0dmVjMiBwbGFuYXIgPSB2Lnh5O1xuXHRcdGZsb2F0IGFsbW9zdEFUZXhlbCA9IDEuNSAqIHRleGVsU2l6ZVk7XG5cdFx0ZmxvYXQgYWxtb3N0T25lID0gMS4wIC0gYWxtb3N0QVRleGVsO1xuXHRcdGlmICggYWJzVi56ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGlmICggdi56ID4gMC4wIClcblx0XHRcdFx0cGxhbmFyLnggPSA0LjAgLSB2Lng7XG5cdFx0fSBlbHNlIGlmICggYWJzVi54ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25YID0gc2lnbiggdi54ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueiAqIHNpZ25YICsgMi4wICogc2lnblg7XG5cdFx0fSBlbHNlIGlmICggYWJzVi55ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25ZID0gc2lnbiggdi55ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueCArIDIuMCAqIHNpZ25ZICsgMi4wO1xuXHRcdFx0cGxhbmFyLnkgPSB2LnogKiBzaWduWSAtIDIuMDtcblx0XHR9XG5cdFx0cmV0dXJuIHZlYzIoIDAuMTI1LCAwLjI1ICkgKiBwbGFuYXIgKyB2ZWMyKCAwLjM3NSwgMC43NSApO1xuXHR9XG5cdGZsb2F0IGdldFBvaW50U2hhZG93KCBzYW1wbGVyMkQgc2hhZG93TWFwLCB2ZWMyIHNoYWRvd01hcFNpemUsIGZsb2F0IHNoYWRvd0JpYXMsIGZsb2F0IHNoYWRvd1JhZGl1cywgdmVjNCBzaGFkb3dDb29yZCwgZmxvYXQgc2hhZG93Q2FtZXJhTmVhciwgZmxvYXQgc2hhZG93Q2FtZXJhRmFyICkge1xuXHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyAoIHNoYWRvd01hcFNpemUgKiB2ZWMyKCA0LjAsIDIuMCApICk7XG5cdFx0dmVjMyBsaWdodFRvUG9zaXRpb24gPSBzaGFkb3dDb29yZC54eXo7XG5cdFx0ZmxvYXQgZHAgPSAoIGxlbmd0aCggbGlnaHRUb1Bvc2l0aW9uICkgLSBzaGFkb3dDYW1lcmFOZWFyICkgLyAoIHNoYWRvd0NhbWVyYUZhciAtIHNoYWRvd0NhbWVyYU5lYXIgKTtcdFx0ZHAgKz0gc2hhZG93Qmlhcztcblx0XHR2ZWMzIGJkM0QgPSBub3JtYWxpemUoIGxpZ2h0VG9Qb3NpdGlvbiApO1xuXHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApXG5cdFx0XHR2ZWMyIG9mZnNldCA9IHZlYzIoIC0gMSwgMSApICogc2hhZG93UmFkaXVzICogdGV4ZWxTaXplLnk7XG5cdFx0XHRyZXR1cm4gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eCwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXh5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eHgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eCwgdGV4ZWxTaXplLnkgKSwgZHAgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApO1xuXHRcdCNlbmRpZlxuXHR9XG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TSEFET1dNQVBcblx0I2lmIE5VTV9ESVJfTElHSFRTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVFMgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIE5VTV9ESVJfTElHSFRTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBzcG90U2hhZG93TWF0cml4WyBOVU1fU1BPVF9MSUdIVFMgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlNwb3RTaGFkb3dDb29yZFsgTlVNX1NQT1RfTElHSFRTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUUyA+IDBcblx0XHR1bmlmb3JtIG1hdDQgcG9pbnRTaGFkb3dNYXRyaXhbIE5VTV9QT0lOVF9MSUdIVFMgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVFMgXTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUUzsgaSArKyApIHtcblx0XHR2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdID0gZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXhbIGkgXSAqIHdvcmxkUG9zaXRpb247XG5cdH1cblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRTOyBpICsrICkge1xuXHRcdHZTcG90U2hhZG93Q29vcmRbIGkgXSA9IHNwb3RTaGFkb3dNYXRyaXhbIGkgXSAqIHdvcmxkUG9zaXRpb247XG5cdH1cblx0I2VuZGlmXG5cdCNpZiBOVU1fUE9JTlRfTElHSFRTID4gMFxuXHQjcHJhZ21hIHVucm9sbF9sb29wXG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVFM7IGkgKysgKSB7XG5cdFx0dlBvaW50U2hhZG93Q29vcmRbIGkgXSA9IHBvaW50U2hhZG93TWF0cml4WyBpIF0gKiB3b3JsZFBvc2l0aW9uO1xuXHR9XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgc2hhZG93bWFza19wYXJzX2ZyYWdtZW50ID0gImZsb2F0IGdldFNoYWRvd01hc2soKSB7XG5cdGZsb2F0IHNoYWRvdyA9IDEuMDtcblx0I2lmZGVmIFVTRV9TSEFET1dNQVBcblx0I2lmIE5VTV9ESVJfTElHSFRTID4gMFxuXHREaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRzWyBpIF07XG5cdFx0c2hhZG93ICo9IGJvb2woIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93ICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dCaWFzLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd1JhZGl1cywgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuXHR9XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRTcG90TGlnaHQgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wXG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRzWyBpIF07XG5cdFx0c2hhZG93ICo9IGJvb2woIHNwb3RMaWdodC5zaGFkb3cgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHQuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0LnNoYWRvd0JpYXMsIHNwb3RMaWdodC5zaGFkb3dSYWRpdXMsIHZTcG90U2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuXHR9XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUUyA+IDBcblx0UG9pbnRMaWdodCBwb2ludExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wXG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVFM7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRzWyBpIF07XG5cdFx0c2hhZG93ICo9IGJvb2woIHBvaW50TGlnaHQuc2hhZG93ICkgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYU5lYXIsIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhRmFyICkgOiAxLjA7XG5cdH1cblx0I2VuZGlmXG5cdCNlbmRpZlxuXHRyZXR1cm4gc2hhZG93O1xufSI7CgoJdmFyIHNraW5iYXNlX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgYm9uZU1hdFggPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueCApO1xuXHRtYXQ0IGJvbmVNYXRZID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnkgKTtcblx0bWF0NCBib25lTWF0WiA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC56ICk7XG5cdG1hdDQgYm9uZU1hdFcgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgudyApO1xuI2VuZGlmIjsKCgl2YXIgc2tpbm5pbmdfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR1bmlmb3JtIG1hdDQgYmluZE1hdHJpeDtcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXhJbnZlcnNlO1xuXHQjaWZkZWYgQk9ORV9URVhUVVJFXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdFx0dW5pZm9ybSBpbnQgYm9uZVRleHR1cmVTaXplO1xuXHRcdG1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcblx0XHRcdGZsb2F0IGogPSBpICogNC4wO1xuXHRcdFx0ZmxvYXQgeCA9IG1vZCggaiwgZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApICk7XG5cdFx0XHRmbG9hdCB5ID0gZmxvb3IoIGogLyBmbG9hdCggYm9uZVRleHR1cmVTaXplICkgKTtcblx0XHRcdGZsb2F0IGR4ID0gMS4wIC8gZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApO1xuXHRcdFx0ZmxvYXQgZHkgPSAxLjAgLyBmbG9hdCggYm9uZVRleHR1cmVTaXplICk7XG5cdFx0XHR5ID0gZHkgKiAoIHkgKyAwLjUgKTtcblx0XHRcdHZlYzQgdjEgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDAuNSApLCB5ICkgKTtcblx0XHRcdHZlYzQgdjIgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDEuNSApLCB5ICkgKTtcblx0XHRcdHZlYzQgdjMgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDIuNSApLCB5ICkgKTtcblx0XHRcdHZlYzQgdjQgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDMuNSApLCB5ICkgKTtcblx0XHRcdG1hdDQgYm9uZSA9IG1hdDQoIHYxLCB2MiwgdjMsIHY0ICk7XG5cdFx0XHRyZXR1cm4gYm9uZTtcblx0XHR9XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBtYXQ0IGJvbmVNYXRyaWNlc1sgTUFYX0JPTkVTIF07XG5cdFx0bWF0NCBnZXRCb25lTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdFx0bWF0NCBib25lID0gYm9uZU1hdHJpY2VzWyBpbnQoaSkgXTtcblx0XHRcdHJldHVybiBib25lO1xuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBza2lubmluZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR2ZWM0IHNraW5WZXJ0ZXggPSBiaW5kTWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuXHR2ZWM0IHNraW5uZWQgPSB2ZWM0KCAwLjAgKTtcblx0c2tpbm5lZCArPSBib25lTWF0WCAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lng7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFkgKiBza2luVmVydGV4ICogc2tpbldlaWdodC55O1xuXHRza2lubmVkICs9IGJvbmVNYXRaICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQuejtcblx0c2tpbm5lZCArPSBib25lTWF0VyAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnc7XG5cdHRyYW5zZm9ybWVkID0gKCBiaW5kTWF0cml4SW52ZXJzZSAqIHNraW5uZWQgKS54eXo7XG4jZW5kaWYiOwoKCXZhciBza2lubm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgc2tpbk1hdHJpeCA9IG1hdDQoIDAuMCApO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueCAqIGJvbmVNYXRYO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueSAqIGJvbmVNYXRZO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueiAqIGJvbmVNYXRaO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQudyAqIGJvbmVNYXRXO1xuXHRza2luTWF0cml4ICA9IGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbk1hdHJpeCAqIGJpbmRNYXRyaXg7XG5cdG9iamVjdE5vcm1hbCA9IHZlYzQoIHNraW5NYXRyaXggKiB2ZWM0KCBvYmplY3ROb3JtYWwsIDAuMCApICkueHl6O1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRvYmplY3RUYW5nZW50ID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdFRhbmdlbnQsIDAuMCApICkueHl6O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIHNwZWN1bGFybWFwX2ZyYWdtZW50ID0gImZsb2F0IHNwZWN1bGFyU3RyZW5ndGg7XG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZlYzQgdGV4ZWxTcGVjdWxhciA9IHRleHR1cmUyRCggc3BlY3VsYXJNYXAsIHZVdiApO1xuXHRzcGVjdWxhclN0cmVuZ3RoID0gdGV4ZWxTcGVjdWxhci5yO1xuI2Vsc2Vcblx0c3BlY3VsYXJTdHJlbmd0aCA9IDEuMDtcbiNlbmRpZiI7CgoJdmFyIHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDtcbiNlbmRpZiI7CgoJdmFyIHRvbmVtYXBwaW5nX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBUT05FX01BUFBJTkcgKVxuXHRnbF9GcmFnQ29sb3IucmdiID0gdG9uZU1hcHBpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7CgoJdmFyIHRvbmVtYXBwaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmbmRlZiBzYXR1cmF0ZVxuXHQjZGVmaW5lIHNhdHVyYXRlKGEpIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgdG9uZU1hcHBpbmdFeHBvc3VyZTtcbnVuaWZvcm0gZmxvYXQgdG9uZU1hcHBpbmdXaGl0ZVBvaW50O1xudmVjMyBMaW5lYXJUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0cmV0dXJuIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvcjtcbn1cbnZlYzMgUmVpbmhhcmRUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciAvICggdmVjMyggMS4wICkgKyBjb2xvciApICk7XG59XG4jZGVmaW5lIFVuY2hhcnRlZDJIZWxwZXIoIHggKSBtYXgoICggKCB4ICogKCAwLjE1ICogeCArIDAuMTAgKiAwLjUwICkgKyAwLjIwICogMC4wMiApIC8gKCB4ICogKCAwLjE1ICogeCArIDAuNTAgKSArIDAuMjAgKiAwLjMwICkgKSAtIDAuMDIgLyAwLjMwLCB2ZWMzKCAwLjAgKSApXG52ZWMzIFVuY2hhcnRlZDJUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0cmV0dXJuIHNhdHVyYXRlKCBVbmNoYXJ0ZWQySGVscGVyKCBjb2xvciApIC8gVW5jaGFydGVkMkhlbHBlciggdmVjMyggdG9uZU1hcHBpbmdXaGl0ZVBvaW50ICkgKSApO1xufVxudmVjMyBPcHRpbWl6ZWRDaW5lb25Ub25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0Y29sb3IgPSBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciAtIDAuMDA0ICk7XG5cdHJldHVybiBwb3coICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMC41ICkgKSAvICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMS43ICkgKyAwLjA2ICksIHZlYzMoIDIuMiApICk7XG59XG52ZWMzIEFDRVNGaWxtaWNUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0cmV0dXJuIHNhdHVyYXRlKCAoIGNvbG9yICogKCAyLjUxICogY29sb3IgKyAwLjAzICkgKSAvICggY29sb3IgKiAoIDIuNDMgKiBjb2xvciArIDAuNTkgKSArIDAuMTQgKSApO1xufSI7CgoJdmFyIHV2X3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBVU0VfU1BFQ1VMQVJNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKSB8fCBkZWZpbmVkKCBVU0VfRU1JU1NJVkVNQVAgKSB8fCBkZWZpbmVkKCBVU0VfUk9VR0hORVNTTUFQICkgfHwgZGVmaW5lZCggVVNFX01FVEFMTkVTU01BUCApXG5cdHZhcnlpbmcgdmVjMiB2VXY7XG4jZW5kaWYiOwoKCXZhciB1dl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX01BUCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9TUEVDVUxBUk1BUCApIHx8IGRlZmluZWQoIFVTRV9BTFBIQU1BUCApIHx8IGRlZmluZWQoIFVTRV9FTUlTU0lWRU1BUCApIHx8IGRlZmluZWQoIFVTRV9ST1VHSE5FU1NNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTUVUQUxORVNTTUFQIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcblx0dW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuI2VuZGlmIjsKCgl2YXIgdXZfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX1NQRUNVTEFSTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQICkgfHwgZGVmaW5lZCggVVNFX0VNSVNTSVZFTUFQICkgfHwgZGVmaW5lZCggVVNFX1JPVUdITkVTU01BUCApIHx8IGRlZmluZWQoIFVTRV9NRVRBTE5FU1NNQVAgKVxuXHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuI2VuZGlmIjsKCgl2YXIgdXYyX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MSUdIVE1BUCApIHx8IGRlZmluZWQoIFVTRV9BT01BUCApXG5cdHZhcnlpbmcgdmVjMiB2VXYyO1xuI2VuZGlmIjsKCgl2YXIgdXYyX3BhcnNfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfTElHSFRNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQU9NQVAgKVxuXHRhdHRyaWJ1dGUgdmVjMiB1djI7XG5cdHZhcnlpbmcgdmVjMiB2VXYyO1xuI2VuZGlmIjsKCgl2YXIgdXYyX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0xJR0hUTUFQICkgfHwgZGVmaW5lZCggVVNFX0FPTUFQIClcblx0dlV2MiA9IHV2MjtcbiNlbmRpZiI7CgoJdmFyIHdvcmxkcG9zX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApIHx8IGRlZmluZWQoIERJU1RBTkNFICkgfHwgZGVmaW5lZCAoIFVTRV9TSEFET1dNQVAgKVxuXHR2ZWM0IHdvcmxkUG9zaXRpb24gPSBtb2RlbE1hdHJpeCAqIHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcbiNlbmRpZiI7CgoJdmFyIGJhY2tncm91bmRfZnJhZyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0MkQ7XG52YXJ5aW5nIHZlYzIgdlV2O1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZTJEKCB0MkQsIHZVdiApO1xuXHRnbF9GcmFnQ29sb3IgPSBtYXBUZXhlbFRvTGluZWFyKCB0ZXhDb2xvciApO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG59IjsKCgl2YXIgYmFja2dyb3VuZF92ZXJ0ID0gInZhcnlpbmcgdmVjMiB2VXY7XG51bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG52b2lkIG1haW4oKSB7XG5cdHZVdiA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCB1diwgMSApICkueHk7XG5cdGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24ueHksIDEuMCwgMS4wICk7XG59IjsKCgl2YXIgY3ViZV9mcmFnID0gInVuaWZvcm0gc2FtcGxlckN1YmUgdEN1YmU7XG51bmlmb3JtIGZsb2F0IHRGbGlwO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbnZvaWQgbWFpbigpIHtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlKCB0Q3ViZSwgdmVjMyggdEZsaXAgKiB2V29ybGREaXJlY3Rpb24ueCwgdldvcmxkRGlyZWN0aW9uLnl6ICkgKTtcblx0Z2xfRnJhZ0NvbG9yID0gbWFwVGV4ZWxUb0xpbmVhciggdGV4Q29sb3IgKTtcblx0Z2xfRnJhZ0NvbG9yLmEgKj0gb3BhY2l0eTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxufSI7CgoJdmFyIGN1YmVfdmVydCA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwoKCXZhciBkZXB0aF9mcmFnID0gIiNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcblx0dW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcblx0XHRkaWZmdXNlQ29sb3IuYSA9IG9wYWNpdHk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHZlYzMoIDEuMCAtIGdsX0ZyYWdDb29yZC56ICksIG9wYWNpdHkgKTtcblx0I2VsaWYgREVQVEhfUEFDS0lORyA9PSAzMjAxXG5cdFx0Z2xfRnJhZ0NvbG9yID0gcGFja0RlcHRoVG9SR0JBKCBnbF9GcmFnQ29vcmQueiApO1xuXHQjZW5kaWZcbn0iOwoKCXZhciBkZXB0aF92ZXJ0ID0gIiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG59IjsKCgl2YXIgZGlzdGFuY2VSR0JBX2ZyYWcgPSAiI2RlZmluZSBESVNUQU5DRVxudW5pZm9ybSB2ZWMzIHJlZmVyZW5jZVBvc2l0aW9uO1xudW5pZm9ybSBmbG9hdCBuZWFyRGlzdGFuY2U7XG51bmlmb3JtIGZsb2F0IGZhckRpc3RhbmNlO1xudmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbiAoKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0ZmxvYXQgZGlzdCA9IGxlbmd0aCggdldvcmxkUG9zaXRpb24gLSByZWZlcmVuY2VQb3NpdGlvbiApO1xuXHRkaXN0ID0gKCBkaXN0IC0gbmVhckRpc3RhbmNlICkgLyAoIGZhckRpc3RhbmNlIC0gbmVhckRpc3RhbmNlICk7XG5cdGRpc3QgPSBzYXR1cmF0ZSggZGlzdCApO1xuXHRnbF9GcmFnQ29sb3IgPSBwYWNrRGVwdGhUb1JHQkEoIGRpc3QgKTtcbn0iOwoKCXZhciBkaXN0YW5jZVJHQkFfdmVydCA9ICIjZGVmaW5lIERJU1RBTkNFXG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdFx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24ueHl6O1xufSI7CgoJdmFyIGVxdWlyZWN0X2ZyYWcgPSAidW5pZm9ybSBzYW1wbGVyMkQgdEVxdWlyZWN0O1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG52b2lkIG1haW4oKSB7XG5cdHZlYzMgZGlyZWN0aW9uID0gbm9ybWFsaXplKCB2V29ybGREaXJlY3Rpb24gKTtcblx0dmVjMiBzYW1wbGVVVjtcblx0c2FtcGxlVVYueSA9IGFzaW4oIGNsYW1wKCBkaXJlY3Rpb24ueSwgLSAxLjAsIDEuMCApICkgKiBSRUNJUFJPQ0FMX1BJICsgMC41O1xuXHRzYW1wbGVVVi54ID0gYXRhbiggZGlyZWN0aW9uLnosIGRpcmVjdGlvbi54ICkgKiBSRUNJUFJPQ0FMX1BJMiArIDAuNTtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmUyRCggdEVxdWlyZWN0LCBzYW1wbGVVViApO1xuXHRnbF9GcmFnQ29sb3IgPSBtYXBUZXhlbFRvTGluZWFyKCB0ZXhDb2xvciApO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG59IjsKCgl2YXIgZXF1aXJlY3RfdmVydCA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7CgoJdmFyIGxpbmVkYXNoZWRfZnJhZyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gZmxvYXQgZGFzaFNpemU7XG51bmlmb3JtIGZsb2F0IHRvdGFsU2l6ZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCBvdXRnb2luZ0xpZ2h0LCBkaWZmdXNlQ29sb3IuYSApO1xuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxufSI7CgoJdmFyIGxpbmVkYXNoZWRfdmVydCA9ICJ1bmlmb3JtIGZsb2F0IHNjYWxlO1xuYXR0cmlidXRlIGZsb2F0IGxpbmVEaXN0YW5jZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0dkxpbmVEaXN0YW5jZSA9IHNjYWxlICogbGluZURpc3RhbmNlO1xuXHR2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKCXZhciBtZXNoYmFzaWNfZnJhZyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2VXYyICkueHl6ICogbGlnaHRNYXBJbnRlbnNpdHk7XG5cdCNlbHNlXG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IHZlYzMoIDEuMCApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKj0gZGlmZnVzZUNvbG9yLnJnYjtcblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCBvdXRnb2luZ0xpZ2h0LCBkaWZmdXNlQ29sb3IuYSApO1xuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxufSI7CgoJdmFyIG1lc2hiYXNpY192ZXJ0ID0gIiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXYyX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8dXYyX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9FTlZNQVBcblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgl2YXIgbWVzaGxhbWJlcnRfZnJhZyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2TGlnaHRGcm9udDtcbnZhcnlpbmcgdmVjMyB2SW5kaXJlY3RGcm9udDtcbiNpZmRlZiBET1VCTEVfU0lERURcblx0dmFyeWluZyB2ZWMzIHZMaWdodEJhY2s7XG5cdHZhcnlpbmcgdmVjMyB2SW5kaXJlY3RCYWNrO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFza19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgPSBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBhbWJpZW50TGlnaHRDb2xvciApO1xuXHQjaWZkZWYgRE9VQkxFX1NJREVEXG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9ICggZ2xfRnJvbnRGYWNpbmcgKSA/IHZJbmRpcmVjdEZyb250IDogdkluZGlyZWN0QmFjaztcblx0I2Vsc2Vcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gdkluZGlyZWN0RnJvbnQ7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bGlnaHRtYXBfZnJhZ21lbnQ+XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSAqPSBCUkRGX0RpZmZ1c2VfTGFtYmVydCggZGlmZnVzZUNvbG9yLnJnYiApO1xuXHQjaWZkZWYgRE9VQkxFX1NJREVEXG5cdFx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSA9ICggZ2xfRnJvbnRGYWNpbmcgKSA/IHZMaWdodEZyb250IDogdkxpZ2h0QmFjaztcblx0I2Vsc2Vcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlID0gdkxpZ2h0RnJvbnQ7XG5cdCNlbmRpZlxuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICo9IEJSREZfRGlmZnVzZV9MYW1iZXJ0KCBkaWZmdXNlQ29sb3IucmdiICkgKiBnZXRTaGFkb3dNYXNrKCk7XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCXZhciBtZXNobGFtYmVydF92ZXJ0ID0gIiNkZWZpbmUgTEFNQkVSVFxudmFyeWluZyB2ZWMzIHZMaWdodEZyb250O1xudmFyeWluZyB2ZWMzIHZJbmRpcmVjdEZyb250O1xuI2lmZGVmIERPVUJMRV9TSURFRFxuXHR2YXJ5aW5nIHZlYzMgdkxpZ2h0QmFjaztcblx0dmFyeWluZyB2ZWMzIHZJbmRpcmVjdEJhY2s7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXYyX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPHV2Ml92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGxpZ2h0c19sYW1iZXJ0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJdmFyIG1lc2htYXRjYXBfZnJhZyA9ICIjZGVmaW5lIE1BVENBUFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG51bmlmb3JtIHNhbXBsZXIyRCBtYXRjYXA7XG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0dmVjMyB2aWV3RGlyID0gbm9ybWFsaXplKCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgeCA9IG5vcm1hbGl6ZSggdmVjMyggdmlld0Rpci56LCAwLjAsIC0gdmlld0Rpci54ICkgKTtcblx0dmVjMyB5ID0gY3Jvc3MoIHZpZXdEaXIsIHggKTtcblx0dmVjMiB1diA9IHZlYzIoIGRvdCggeCwgbm9ybWFsICksIGRvdCggeSwgbm9ybWFsICkgKSAqIDAuNDk1ICsgMC41O1xuXHQjaWZkZWYgVVNFX01BVENBUFxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB0ZXh0dXJlMkQoIG1hdGNhcCwgdXYgKTtcblx0XHRtYXRjYXBDb2xvciA9IG1hdGNhcFRleGVsVG9MaW5lYXIoIG1hdGNhcENvbG9yICk7XG5cdCNlbHNlXG5cdFx0dmVjNCBtYXRjYXBDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjZW5kaWZcblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYiAqIG1hdGNhcENvbG9yLnJnYjtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwoKCXZhciBtZXNobWF0Y2FwX3ZlcnQgPSAiI2RlZmluZSBNQVRDQVBcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpZm5kZWYgRkxBVF9TSEFERURcblx0XHR2Tm9ybWFsID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZE5vcm1hbCApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbn0iOwoKCXZhciBtZXNocGhvbmdfZnJhZyA9ICIjZGVmaW5lIFBIT05HXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gdmVjMyBzcGVjdWxhcjtcbnVuaWZvcm0gZmxvYXQgc2hpbmluZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1djJfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCXZhciBtZXNocGhvbmdfdmVydCA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXYyX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx1djJfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcbiNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgl2YXIgbWVzaHBoeXNpY2FsX2ZyYWcgPSAiI2RlZmluZSBQSFlTSUNBTFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IHJvdWdobmVzcztcbnVuaWZvcm0gZmxvYXQgbWV0YWxuZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBTVEFOREFSRFxuXHR1bmlmb3JtIGZsb2F0IGNsZWFyQ29hdDtcblx0dW5pZm9ybSBmbG9hdCBjbGVhckNvYXRSb3VnaG5lc3M7XG4jZW5kaWZcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1djJfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8cm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKyB0b3RhbEVtaXNzaXZlUmFkaWFuY2U7XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGVuY29kaW5nc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgl2YXIgbWVzaHBoeXNpY2FsX3ZlcnQgPSAiI2RlZmluZSBQSFlTSUNBTFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2Ml9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx1djJfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dlRhbmdlbnQgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkVGFuZ2VudCApO1xuXHRcdHZCaXRhbmdlbnQgPSBub3JtYWxpemUoIGNyb3NzKCB2Tm9ybWFsLCB2VGFuZ2VudCApICogdGFuZ2VudC53ICk7XG5cdCNlbmRpZlxuI2VuZGlmXG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJdmFyIG5vcm1hbF9mcmFnID0gIiNkZWZpbmUgTk9STUFMXG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8ICggZGVmaW5lZCggVVNFX05PUk1BTE1BUCApICYmICEgZGVmaW5lZCggT0JKRUNUU1BBQ0VfTk9STUFMTUFQICkgKVxuXHR2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNlbmRpZlxuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tOb3JtYWxUb1JHQiggbm9ybWFsICksIG9wYWNpdHkgKTtcbn0iOwoKCXZhciBub3JtYWxfdmVydCA9ICIjZGVmaW5lIE5PUk1BTFxuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCAoIGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSAmJiAhIGRlZmluZWQoIE9CSkVDVFNQQUNFX05PUk1BTE1BUCApIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZhcnlpbmcgdmVjMyB2VGFuZ2VudDtcblx0XHR2YXJ5aW5nIHZlYzMgdkJpdGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2Tm9ybWFsID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZE5vcm1hbCApO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2VGFuZ2VudCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWRUYW5nZW50ICk7XG5cdFx0dkJpdGFuZ2VudCA9IG5vcm1hbGl6ZSggY3Jvc3MoIHZOb3JtYWwsIHZUYW5nZW50ICkgKiB0YW5nZW50LncgKTtcblx0I2VuZGlmXG4jZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgKCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgJiYgISBkZWZpbmVkKCBPQkpFQ1RTUEFDRV9OT1JNQUxNQVAgKSApXG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuI2VuZGlmXG59IjsKCgl2YXIgcG9pbnRzX2ZyYWcgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfcGFydGljbGVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgl2YXIgcG9pbnRzX3ZlcnQgPSAidW5pZm9ybSBmbG9hdCBzaXplO1xudW5pZm9ybSBmbG9hdCBzY2FsZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb2ludFNpemUgPSBzaXplO1xuXHQjaWZkZWYgVVNFX1NJWkVBVFRFTlVBVElPTlxuXHRcdGJvb2wgaXNQZXJzcGVjdGl2ZSA9ICggcHJvamVjdGlvbk1hdHJpeFsgMiBdWyAzIF0gPT0gLSAxLjAgKTtcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmUgKSBnbF9Qb2ludFNpemUgKj0gKCBzY2FsZSAvIC0gbXZQb3NpdGlvbi56ICk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgl2YXIgc2hhZG93X2ZyYWcgPSAidW5pZm9ybSB2ZWMzIGNvbG9yO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hc2tfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgl2YXIgc2hhZG93X3ZlcnQgPSAiI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJdmFyIHNwcml0ZV9mcmFnID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZW5jb2RpbmdzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxufSI7CgoJdmFyIHNwcml0ZV92ZXJ0ID0gInVuaWZvcm0gZmxvYXQgcm90YXRpb247XG51bmlmb3JtIHZlYzIgY2VudGVyO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHR2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTtcblx0dmVjMiBzY2FsZTtcblx0c2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54LCBtb2RlbE1hdHJpeFsgMCBdLnksIG1vZGVsTWF0cml4WyAwIF0ueiApICk7XG5cdHNjYWxlLnkgPSBsZW5ndGgoIHZlYzMoIG1vZGVsTWF0cml4WyAxIF0ueCwgbW9kZWxNYXRyaXhbIDEgXS55LCBtb2RlbE1hdHJpeFsgMSBdLnogKSApO1xuXHQjaWZuZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSAoIHByb2plY3Rpb25NYXRyaXhbIDIgXVsgMyBdID09IC0gMS4wICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG5cdCNlbmRpZlxuXHR2ZWMyIGFsaWduZWRQb3NpdGlvbiA9ICggcG9zaXRpb24ueHkgLSAoIGNlbnRlciAtIHZlYzIoIDAuNSApICkgKSAqIHNjYWxlO1xuXHR2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcblx0cm90YXRlZFBvc2l0aW9uLnggPSBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCAtIHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuXHRyb3RhdGVkUG9zaXRpb24ueSA9IHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54ICsgY29zKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdG12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgl2YXIgU2hhZGVyQ2h1bmsgPSB7CgkJYWxwaGFtYXBfZnJhZ21lbnQ6IGFscGhhbWFwX2ZyYWdtZW50LAoJCWFscGhhbWFwX3BhcnNfZnJhZ21lbnQ6IGFscGhhbWFwX3BhcnNfZnJhZ21lbnQsCgkJYWxwaGF0ZXN0X2ZyYWdtZW50OiBhbHBoYXRlc3RfZnJhZ21lbnQsCgkJYW9tYXBfZnJhZ21lbnQ6IGFvbWFwX2ZyYWdtZW50LAoJCWFvbWFwX3BhcnNfZnJhZ21lbnQ6IGFvbWFwX3BhcnNfZnJhZ21lbnQsCgkJYmVnaW5fdmVydGV4OiBiZWdpbl92ZXJ0ZXgsCgkJYmVnaW5ub3JtYWxfdmVydGV4OiBiZWdpbm5vcm1hbF92ZXJ0ZXgsCgkJYnNkZnM6IGJzZGZzLAoJCWJ1bXBtYXBfcGFyc19mcmFnbWVudDogYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19mcmFnbWVudDogY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCwKCQljbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCwKCQljbGlwcGluZ19wbGFuZXNfdmVydGV4OiBjbGlwcGluZ19wbGFuZXNfdmVydGV4LAoJCWNvbG9yX2ZyYWdtZW50OiBjb2xvcl9mcmFnbWVudCwKCQljb2xvcl9wYXJzX2ZyYWdtZW50OiBjb2xvcl9wYXJzX2ZyYWdtZW50LAoJCWNvbG9yX3BhcnNfdmVydGV4OiBjb2xvcl9wYXJzX3ZlcnRleCwKCQljb2xvcl92ZXJ0ZXg6IGNvbG9yX3ZlcnRleCwKCQljb21tb246IGNvbW1vbiwKCQljdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ6IGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCwKCQlkZWZhdWx0bm9ybWFsX3ZlcnRleDogZGVmYXVsdG5vcm1hbF92ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3ZlcnRleDogZGlzcGxhY2VtZW50bWFwX3ZlcnRleCwKCQllbWlzc2l2ZW1hcF9mcmFnbWVudDogZW1pc3NpdmVtYXBfZnJhZ21lbnQsCgkJZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudDogZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCwKCQllbmNvZGluZ3NfZnJhZ21lbnQ6IGVuY29kaW5nc19mcmFnbWVudCwKCQllbmNvZGluZ3NfcGFyc19mcmFnbWVudDogZW5jb2RpbmdzX3BhcnNfZnJhZ21lbnQsCgkJZW52bWFwX2ZyYWdtZW50OiBlbnZtYXBfZnJhZ21lbnQsCgkJZW52bWFwX3BhcnNfZnJhZ21lbnQ6IGVudm1hcF9wYXJzX2ZyYWdtZW50LAoJCWVudm1hcF9wYXJzX3ZlcnRleDogZW52bWFwX3BhcnNfdmVydGV4LAoJCWVudm1hcF9waHlzaWNhbF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCwKCQllbnZtYXBfdmVydGV4OiBlbnZtYXBfdmVydGV4LAoJCWZvZ192ZXJ0ZXg6IGZvZ192ZXJ0ZXgsCgkJZm9nX3BhcnNfdmVydGV4OiBmb2dfcGFyc192ZXJ0ZXgsCgkJZm9nX2ZyYWdtZW50OiBmb2dfZnJhZ21lbnQsCgkJZm9nX3BhcnNfZnJhZ21lbnQ6IGZvZ19wYXJzX2ZyYWdtZW50LAoJCWdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQ6IGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRtYXBfZnJhZ21lbnQ6IGxpZ2h0bWFwX2ZyYWdtZW50LAoJCWxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2xhbWJlcnRfdmVydGV4OiBsaWdodHNfbGFtYmVydF92ZXJ0ZXgsCgkJbGlnaHRzX3BhcnNfYmVnaW46IGxpZ2h0c19wYXJzX2JlZ2luLAoJCWxpZ2h0c19waG9uZ19mcmFnbWVudDogbGlnaHRzX3Bob25nX2ZyYWdtZW50LAoJCWxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQ6IGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2ZyYWdtZW50X2JlZ2luOiBsaWdodHNfZnJhZ21lbnRfYmVnaW4sCgkJbGlnaHRzX2ZyYWdtZW50X21hcHM6IGxpZ2h0c19mcmFnbWVudF9tYXBzLAoJCWxpZ2h0c19mcmFnbWVudF9lbmQ6IGxpZ2h0c19mcmFnbWVudF9lbmQsCgkJbG9nZGVwdGhidWZfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAoJCWxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQsCgkJbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg6IGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAoJCWxvZ2RlcHRoYnVmX3ZlcnRleDogbG9nZGVwdGhidWZfdmVydGV4LAoJCW1hcF9mcmFnbWVudDogbWFwX2ZyYWdtZW50LAoJCW1hcF9wYXJzX2ZyYWdtZW50OiBtYXBfcGFyc19mcmFnbWVudCwKCQltYXBfcGFydGljbGVfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9mcmFnbWVudCwKCQltYXBfcGFydGljbGVfcGFyc19mcmFnbWVudDogbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX2ZyYWdtZW50OiBtZXRhbG5lc3NtYXBfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAoJCW1vcnBobm9ybWFsX3ZlcnRleDogbW9ycGhub3JtYWxfdmVydGV4LAoJCW1vcnBodGFyZ2V0X3BhcnNfdmVydGV4OiBtb3JwaHRhcmdldF9wYXJzX3ZlcnRleCwKCQltb3JwaHRhcmdldF92ZXJ0ZXg6IG1vcnBodGFyZ2V0X3ZlcnRleCwKCQlub3JtYWxfZnJhZ21lbnRfYmVnaW46IG5vcm1hbF9mcmFnbWVudF9iZWdpbiwKCQlub3JtYWxfZnJhZ21lbnRfbWFwczogbm9ybWFsX2ZyYWdtZW50X21hcHMsCgkJbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ6IG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50LAoJCXBhY2tpbmc6IHBhY2tpbmcsCgkJcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudDogcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCwKCQlwcm9qZWN0X3ZlcnRleDogcHJvamVjdF92ZXJ0ZXgsCgkJZGl0aGVyaW5nX2ZyYWdtZW50OiBkaXRoZXJpbmdfZnJhZ21lbnQsCgkJZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ6IGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50LAoJCXJvdWdobmVzc21hcF9mcmFnbWVudDogcm91Z2huZXNzbWFwX2ZyYWdtZW50LAoJCXJvdWdobmVzc21hcF9wYXJzX2ZyYWdtZW50OiByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCwKCQlzaGFkb3dtYXBfcGFyc19mcmFnbWVudDogc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQsCgkJc2hhZG93bWFwX3BhcnNfdmVydGV4OiBzaGFkb3dtYXBfcGFyc192ZXJ0ZXgsCgkJc2hhZG93bWFwX3ZlcnRleDogc2hhZG93bWFwX3ZlcnRleCwKCQlzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hc2tfcGFyc19mcmFnbWVudCwKCQlza2luYmFzZV92ZXJ0ZXg6IHNraW5iYXNlX3ZlcnRleCwKCQlza2lubmluZ19wYXJzX3ZlcnRleDogc2tpbm5pbmdfcGFyc192ZXJ0ZXgsCgkJc2tpbm5pbmdfdmVydGV4OiBza2lubmluZ192ZXJ0ZXgsCgkJc2tpbm5vcm1hbF92ZXJ0ZXg6IHNraW5ub3JtYWxfdmVydGV4LAoJCXNwZWN1bGFybWFwX2ZyYWdtZW50OiBzcGVjdWxhcm1hcF9mcmFnbWVudCwKCQlzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50OiBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50LAoJCXRvbmVtYXBwaW5nX2ZyYWdtZW50OiB0b25lbWFwcGluZ19mcmFnbWVudCwKCQl0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50OiB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50LAoJCXV2X3BhcnNfZnJhZ21lbnQ6IHV2X3BhcnNfZnJhZ21lbnQsCgkJdXZfcGFyc192ZXJ0ZXg6IHV2X3BhcnNfdmVydGV4LAoJCXV2X3ZlcnRleDogdXZfdmVydGV4LAoJCXV2Ml9wYXJzX2ZyYWdtZW50OiB1djJfcGFyc19mcmFnbWVudCwKCQl1djJfcGFyc192ZXJ0ZXg6IHV2Ml9wYXJzX3ZlcnRleCwKCQl1djJfdmVydGV4OiB1djJfdmVydGV4LAoJCXdvcmxkcG9zX3ZlcnRleDogd29ybGRwb3NfdmVydGV4LAoKCQliYWNrZ3JvdW5kX2ZyYWc6IGJhY2tncm91bmRfZnJhZywKCQliYWNrZ3JvdW5kX3ZlcnQ6IGJhY2tncm91bmRfdmVydCwKCQljdWJlX2ZyYWc6IGN1YmVfZnJhZywKCQljdWJlX3ZlcnQ6IGN1YmVfdmVydCwKCQlkZXB0aF9mcmFnOiBkZXB0aF9mcmFnLAoJCWRlcHRoX3ZlcnQ6IGRlcHRoX3ZlcnQsCgkJZGlzdGFuY2VSR0JBX2ZyYWc6IGRpc3RhbmNlUkdCQV9mcmFnLAoJCWRpc3RhbmNlUkdCQV92ZXJ0OiBkaXN0YW5jZVJHQkFfdmVydCwKCQllcXVpcmVjdF9mcmFnOiBlcXVpcmVjdF9mcmFnLAoJCWVxdWlyZWN0X3ZlcnQ6IGVxdWlyZWN0X3ZlcnQsCgkJbGluZWRhc2hlZF9mcmFnOiBsaW5lZGFzaGVkX2ZyYWcsCgkJbGluZWRhc2hlZF92ZXJ0OiBsaW5lZGFzaGVkX3ZlcnQsCgkJbWVzaGJhc2ljX2ZyYWc6IG1lc2hiYXNpY19mcmFnLAoJCW1lc2hiYXNpY192ZXJ0OiBtZXNoYmFzaWNfdmVydCwKCQltZXNobGFtYmVydF9mcmFnOiBtZXNobGFtYmVydF9mcmFnLAoJCW1lc2hsYW1iZXJ0X3ZlcnQ6IG1lc2hsYW1iZXJ0X3ZlcnQsCgkJbWVzaG1hdGNhcF9mcmFnOiBtZXNobWF0Y2FwX2ZyYWcsCgkJbWVzaG1hdGNhcF92ZXJ0OiBtZXNobWF0Y2FwX3ZlcnQsCgkJbWVzaHBob25nX2ZyYWc6IG1lc2hwaG9uZ19mcmFnLAoJCW1lc2hwaG9uZ192ZXJ0OiBtZXNocGhvbmdfdmVydCwKCQltZXNocGh5c2ljYWxfZnJhZzogbWVzaHBoeXNpY2FsX2ZyYWcsCgkJbWVzaHBoeXNpY2FsX3ZlcnQ6IG1lc2hwaHlzaWNhbF92ZXJ0LAoJCW5vcm1hbF9mcmFnOiBub3JtYWxfZnJhZywKCQlub3JtYWxfdmVydDogbm9ybWFsX3ZlcnQsCgkJcG9pbnRzX2ZyYWc6IHBvaW50c19mcmFnLAoJCXBvaW50c192ZXJ0OiBwb2ludHNfdmVydCwKCQlzaGFkb3dfZnJhZzogc2hhZG93X2ZyYWcsCgkJc2hhZG93X3ZlcnQ6IHNoYWRvd192ZXJ0LAoJCXNwcml0ZV9mcmFnOiBzcHJpdGVfZnJhZywKCQlzcHJpdGVfdmVydDogc3ByaXRlX3ZlcnQKCX07CgoJLyoqCgkgKiBVbmlmb3JtIFV0aWxpdGllcwoJICovCgoJZnVuY3Rpb24gY2xvbmVVbmlmb3Jtcyggc3JjICkgewoKCQl2YXIgZHN0ID0ge307CgoJCWZvciAoIHZhciB1IGluIHNyYyApIHsKCgkJCWRzdFsgdSBdID0ge307CgoJCQlmb3IgKCB2YXIgcCBpbiBzcmNbIHUgXSApIHsKCgkJCQl2YXIgcHJvcGVydHkgPSBzcmNbIHUgXVsgcCBdOwoKCQkJCWlmICggcHJvcGVydHkgJiYgKCBwcm9wZXJ0eS5pc0NvbG9yIHx8CgkJCQkJcHJvcGVydHkuaXNNYXRyaXgzIHx8IHByb3BlcnR5LmlzTWF0cml4NCB8fAoJCQkJCXByb3BlcnR5LmlzVmVjdG9yMiB8fCBwcm9wZXJ0eS5pc1ZlY3RvcjMgfHwgcHJvcGVydHkuaXNWZWN0b3I0IHx8CgkJCQkJcHJvcGVydHkuaXNUZXh0dXJlICkgKSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5jbG9uZSgpOwoKCQkJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIHByb3BlcnR5ICkgKSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5zbGljZSgpOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGRzdDsKCgl9CgoJZnVuY3Rpb24gbWVyZ2VVbmlmb3JtcyggdW5pZm9ybXMgKSB7CgoJCXZhciBtZXJnZWQgPSB7fTsKCgkJZm9yICggdmFyIHUgPSAwOyB1IDwgdW5pZm9ybXMubGVuZ3RoOyB1ICsrICkgewoKCQkJdmFyIHRtcCA9IGNsb25lVW5pZm9ybXMoIHVuaWZvcm1zWyB1IF0gKTsKCgkJCWZvciAoIHZhciBwIGluIHRtcCApIHsKCgkJCQltZXJnZWRbIHAgXSA9IHRtcFsgcCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBtZXJnZWQ7CgoJfQoKCS8vIExlZ2FjeQoKCXZhciBVbmlmb3Jtc1V0aWxzID0geyBjbG9uZTogY2xvbmVVbmlmb3JtcywgbWVyZ2U6IG1lcmdlVW5pZm9ybXMgfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCgl2YXIgQ29sb3JLZXl3b3JkcyA9IHsgJ2FsaWNlYmx1ZSc6IDB4RjBGOEZGLCAnYW50aXF1ZXdoaXRlJzogMHhGQUVCRDcsICdhcXVhJzogMHgwMEZGRkYsICdhcXVhbWFyaW5lJzogMHg3RkZGRDQsICdhenVyZSc6IDB4RjBGRkZGLAoJCSdiZWlnZSc6IDB4RjVGNURDLCAnYmlzcXVlJzogMHhGRkU0QzQsICdibGFjayc6IDB4MDAwMDAwLCAnYmxhbmNoZWRhbG1vbmQnOiAweEZGRUJDRCwgJ2JsdWUnOiAweDAwMDBGRiwgJ2JsdWV2aW9sZXQnOiAweDhBMkJFMiwKCQknYnJvd24nOiAweEE1MkEyQSwgJ2J1cmx5d29vZCc6IDB4REVCODg3LCAnY2FkZXRibHVlJzogMHg1RjlFQTAsICdjaGFydHJldXNlJzogMHg3RkZGMDAsICdjaG9jb2xhdGUnOiAweEQyNjkxRSwgJ2NvcmFsJzogMHhGRjdGNTAsCgkJJ2Nvcm5mbG93ZXJibHVlJzogMHg2NDk1RUQsICdjb3Juc2lsayc6IDB4RkZGOERDLCAnY3JpbXNvbic6IDB4REMxNDNDLCAnY3lhbic6IDB4MDBGRkZGLCAnZGFya2JsdWUnOiAweDAwMDA4QiwgJ2RhcmtjeWFuJzogMHgwMDhCOEIsCgkJJ2Rhcmtnb2xkZW5yb2QnOiAweEI4ODYwQiwgJ2RhcmtncmF5JzogMHhBOUE5QTksICdkYXJrZ3JlZW4nOiAweDAwNjQwMCwgJ2RhcmtncmV5JzogMHhBOUE5QTksICdkYXJra2hha2knOiAweEJEQjc2QiwgJ2RhcmttYWdlbnRhJzogMHg4QjAwOEIsCgkJJ2RhcmtvbGl2ZWdyZWVuJzogMHg1NTZCMkYsICdkYXJrb3JhbmdlJzogMHhGRjhDMDAsICdkYXJrb3JjaGlkJzogMHg5OTMyQ0MsICdkYXJrcmVkJzogMHg4QjAwMDAsICdkYXJrc2FsbW9uJzogMHhFOTk2N0EsICdkYXJrc2VhZ3JlZW4nOiAweDhGQkM4RiwKCQknZGFya3NsYXRlYmx1ZSc6IDB4NDgzRDhCLCAnZGFya3NsYXRlZ3JheSc6IDB4MkY0RjRGLCAnZGFya3NsYXRlZ3JleSc6IDB4MkY0RjRGLCAnZGFya3R1cnF1b2lzZSc6IDB4MDBDRUQxLCAnZGFya3Zpb2xldCc6IDB4OTQwMEQzLAoJCSdkZWVwcGluayc6IDB4RkYxNDkzLCAnZGVlcHNreWJsdWUnOiAweDAwQkZGRiwgJ2RpbWdyYXknOiAweDY5Njk2OSwgJ2RpbWdyZXknOiAweDY5Njk2OSwgJ2RvZGdlcmJsdWUnOiAweDFFOTBGRiwgJ2ZpcmVicmljayc6IDB4QjIyMjIyLAoJCSdmbG9yYWx3aGl0ZSc6IDB4RkZGQUYwLCAnZm9yZXN0Z3JlZW4nOiAweDIyOEIyMiwgJ2Z1Y2hzaWEnOiAweEZGMDBGRiwgJ2dhaW5zYm9ybyc6IDB4RENEQ0RDLCAnZ2hvc3R3aGl0ZSc6IDB4RjhGOEZGLCAnZ29sZCc6IDB4RkZENzAwLAoJCSdnb2xkZW5yb2QnOiAweERBQTUyMCwgJ2dyYXknOiAweDgwODA4MCwgJ2dyZWVuJzogMHgwMDgwMDAsICdncmVlbnllbGxvdyc6IDB4QURGRjJGLCAnZ3JleSc6IDB4ODA4MDgwLCAnaG9uZXlkZXcnOiAweEYwRkZGMCwgJ2hvdHBpbmsnOiAweEZGNjlCNCwKCQknaW5kaWFucmVkJzogMHhDRDVDNUMsICdpbmRpZ28nOiAweDRCMDA4MiwgJ2l2b3J5JzogMHhGRkZGRjAsICdraGFraSc6IDB4RjBFNjhDLCAnbGF2ZW5kZXInOiAweEU2RTZGQSwgJ2xhdmVuZGVyYmx1c2gnOiAweEZGRjBGNSwgJ2xhd25ncmVlbic6IDB4N0NGQzAwLAoJCSdsZW1vbmNoaWZmb24nOiAweEZGRkFDRCwgJ2xpZ2h0Ymx1ZSc6IDB4QUREOEU2LCAnbGlnaHRjb3JhbCc6IDB4RjA4MDgwLCAnbGlnaHRjeWFuJzogMHhFMEZGRkYsICdsaWdodGdvbGRlbnJvZHllbGxvdyc6IDB4RkFGQUQyLCAnbGlnaHRncmF5JzogMHhEM0QzRDMsCgkJJ2xpZ2h0Z3JlZW4nOiAweDkwRUU5MCwgJ2xpZ2h0Z3JleSc6IDB4RDNEM0QzLCAnbGlnaHRwaW5rJzogMHhGRkI2QzEsICdsaWdodHNhbG1vbic6IDB4RkZBMDdBLCAnbGlnaHRzZWFncmVlbic6IDB4MjBCMkFBLCAnbGlnaHRza3libHVlJzogMHg4N0NFRkEsCgkJJ2xpZ2h0c2xhdGVncmF5JzogMHg3Nzg4OTksICdsaWdodHNsYXRlZ3JleSc6IDB4Nzc4ODk5LCAnbGlnaHRzdGVlbGJsdWUnOiAweEIwQzRERSwgJ2xpZ2h0eWVsbG93JzogMHhGRkZGRTAsICdsaW1lJzogMHgwMEZGMDAsICdsaW1lZ3JlZW4nOiAweDMyQ0QzMiwKCQknbGluZW4nOiAweEZBRjBFNiwgJ21hZ2VudGEnOiAweEZGMDBGRiwgJ21hcm9vbic6IDB4ODAwMDAwLCAnbWVkaXVtYXF1YW1hcmluZSc6IDB4NjZDREFBLCAnbWVkaXVtYmx1ZSc6IDB4MDAwMENELCAnbWVkaXVtb3JjaGlkJzogMHhCQTU1RDMsCgkJJ21lZGl1bXB1cnBsZSc6IDB4OTM3MERCLCAnbWVkaXVtc2VhZ3JlZW4nOiAweDNDQjM3MSwgJ21lZGl1bXNsYXRlYmx1ZSc6IDB4N0I2OEVFLCAnbWVkaXVtc3ByaW5nZ3JlZW4nOiAweDAwRkE5QSwgJ21lZGl1bXR1cnF1b2lzZSc6IDB4NDhEMUNDLAoJCSdtZWRpdW12aW9sZXRyZWQnOiAweEM3MTU4NSwgJ21pZG5pZ2h0Ymx1ZSc6IDB4MTkxOTcwLCAnbWludGNyZWFtJzogMHhGNUZGRkEsICdtaXN0eXJvc2UnOiAweEZGRTRFMSwgJ21vY2Nhc2luJzogMHhGRkU0QjUsICduYXZham93aGl0ZSc6IDB4RkZERUFELAoJCSduYXZ5JzogMHgwMDAwODAsICdvbGRsYWNlJzogMHhGREY1RTYsICdvbGl2ZSc6IDB4ODA4MDAwLCAnb2xpdmVkcmFiJzogMHg2QjhFMjMsICdvcmFuZ2UnOiAweEZGQTUwMCwgJ29yYW5nZXJlZCc6IDB4RkY0NTAwLCAnb3JjaGlkJzogMHhEQTcwRDYsCgkJJ3BhbGVnb2xkZW5yb2QnOiAweEVFRThBQSwgJ3BhbGVncmVlbic6IDB4OThGQjk4LCAncGFsZXR1cnF1b2lzZSc6IDB4QUZFRUVFLCAncGFsZXZpb2xldHJlZCc6IDB4REI3MDkzLCAncGFwYXlhd2hpcCc6IDB4RkZFRkQ1LCAncGVhY2hwdWZmJzogMHhGRkRBQjksCgkJJ3BlcnUnOiAweENEODUzRiwgJ3BpbmsnOiAweEZGQzBDQiwgJ3BsdW0nOiAweEREQTBERCwgJ3Bvd2RlcmJsdWUnOiAweEIwRTBFNiwgJ3B1cnBsZSc6IDB4ODAwMDgwLCAncmViZWNjYXB1cnBsZSc6IDB4NjYzMzk5LCAncmVkJzogMHhGRjAwMDAsICdyb3N5YnJvd24nOiAweEJDOEY4RiwKCQkncm95YWxibHVlJzogMHg0MTY5RTEsICdzYWRkbGVicm93bic6IDB4OEI0NTEzLCAnc2FsbW9uJzogMHhGQTgwNzIsICdzYW5keWJyb3duJzogMHhGNEE0NjAsICdzZWFncmVlbic6IDB4MkU4QjU3LCAnc2Vhc2hlbGwnOiAweEZGRjVFRSwKCQknc2llbm5hJzogMHhBMDUyMkQsICdzaWx2ZXInOiAweEMwQzBDMCwgJ3NreWJsdWUnOiAweDg3Q0VFQiwgJ3NsYXRlYmx1ZSc6IDB4NkE1QUNELCAnc2xhdGVncmF5JzogMHg3MDgwOTAsICdzbGF0ZWdyZXknOiAweDcwODA5MCwgJ3Nub3cnOiAweEZGRkFGQSwKCQknc3ByaW5nZ3JlZW4nOiAweDAwRkY3RiwgJ3N0ZWVsYmx1ZSc6IDB4NDY4MkI0LCAndGFuJzogMHhEMkI0OEMsICd0ZWFsJzogMHgwMDgwODAsICd0aGlzdGxlJzogMHhEOEJGRDgsICd0b21hdG8nOiAweEZGNjM0NywgJ3R1cnF1b2lzZSc6IDB4NDBFMEQwLAoJCSd2aW9sZXQnOiAweEVFODJFRSwgJ3doZWF0JzogMHhGNURFQjMsICd3aGl0ZSc6IDB4RkZGRkZGLCAnd2hpdGVzbW9rZSc6IDB4RjVGNUY1LCAneWVsbG93JzogMHhGRkZGMDAsICd5ZWxsb3dncmVlbic6IDB4OUFDRDMyIH07CgoJZnVuY3Rpb24gQ29sb3IoIHIsIGcsIGIgKSB7CgoJCWlmICggZyA9PT0gdW5kZWZpbmVkICYmIGIgPT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIHIgaXMgVEhSRUUuQ29sb3IsIGhleCBvciBzdHJpbmcKCQkJcmV0dXJuIHRoaXMuc2V0KCByICk7CgoJCX0KCgkJcmV0dXJuIHRoaXMuc2V0UkdCKCByLCBnLCBiICk7CgoJfQoKCU9iamVjdC5hc3NpZ24oIENvbG9yLnByb3RvdHlwZSwgewoKCQlpc0NvbG9yOiB0cnVlLAoKCQlyOiAxLCBnOiAxLCBiOiAxLAoKCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJdGhpcy5jb3B5KCB2YWx1ZSApOwoKCQkJfSBlbHNlIGlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHsKCgkJCQl0aGlzLnNldEhleCggdmFsdWUgKTsKCgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgKSB7CgoJCQkJdGhpcy5zZXRTdHlsZSggdmFsdWUgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRTY2FsYXI6IGZ1bmN0aW9uICggc2NhbGFyICkgewoKCQkJdGhpcy5yID0gc2NhbGFyOwoJCQl0aGlzLmcgPSBzY2FsYXI7CgkJCXRoaXMuYiA9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRIZXg6IGZ1bmN0aW9uICggaGV4ICkgewoKCQkJaGV4ID0gTWF0aC5mbG9vciggaGV4ICk7CgoJCQl0aGlzLnIgPSAoIGhleCA+PiAxNiAmIDI1NSApIC8gMjU1OwoJCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CgkJCXRoaXMuYiA9ICggaGV4ICYgMjU1ICkgLyAyNTU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0UkdCOiBmdW5jdGlvbiAoIHIsIGcsIGIgKSB7CgoJCQl0aGlzLnIgPSByOwoJCQl0aGlzLmcgPSBnOwoJCQl0aGlzLmIgPSBiOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEhTTDogZnVuY3Rpb24gKCkgewoKCQkJZnVuY3Rpb24gaHVlMnJnYiggcCwgcSwgdCApIHsKCgkJCQlpZiAoIHQgPCAwICkgdCArPSAxOwoJCQkJaWYgKCB0ID4gMSApIHQgLT0gMTsKCQkJCWlmICggdCA8IDEgLyA2ICkgcmV0dXJuIHAgKyAoIHEgLSBwICkgKiA2ICogdDsKCQkJCWlmICggdCA8IDEgLyAyICkgcmV0dXJuIHE7CgkJCQlpZiAoIHQgPCAyIC8gMyApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqICggMiAvIDMgLSB0ICk7CgkJCQlyZXR1cm4gcDsKCgkJCX0KCgkJCXJldHVybiBmdW5jdGlvbiBzZXRIU0woIGgsIHMsIGwgKSB7CgoJCQkJLy8gaCxzLGwgcmFuZ2VzIGFyZSBpbiAwLjAgLSAxLjAKCQkJCWggPSBfTWF0aC5ldWNsaWRlYW5Nb2R1bG8oIGgsIDEgKTsKCQkJCXMgPSBfTWF0aC5jbGFtcCggcywgMCwgMSApOwoJCQkJbCA9IF9NYXRoLmNsYW1wKCBsLCAwLCAxICk7CgoJCQkJaWYgKCBzID09PSAwICkgewoKCQkJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXZhciBwID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSAoIGwgKiBzICk7CgkJCQkJdmFyIHEgPSAoIDIgKiBsICkgLSBwOwoKCQkJCQl0aGlzLnIgPSBodWUycmdiKCBxLCBwLCBoICsgMSAvIDMgKTsKCQkJCQl0aGlzLmcgPSBodWUycmdiKCBxLCBwLCBoICk7CgkJCQkJdGhpcy5iID0gaHVlMnJnYiggcSwgcCwgaCAtIDEgLyAzICk7CgoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQlzZXRTdHlsZTogZnVuY3Rpb24gKCBzdHlsZSApIHsKCgkJCWZ1bmN0aW9uIGhhbmRsZUFscGhhKCBzdHJpbmcgKSB7CgoJCQkJaWYgKCBzdHJpbmcgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCQlpZiAoIHBhcnNlRmxvYXQoIHN0cmluZyApIDwgMSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IEFscGhhIGNvbXBvbmVudCBvZiAnICsgc3R5bGUgKyAnIHdpbGwgYmUgaWdub3JlZC4nICk7CgoJCQkJfQoKCQkJfQoKCgkJCXZhciBtOwoKCQkJaWYgKCBtID0gL14oKD86cmdifGhzbClhPylcKFxzKihbXlwpXSopXCkvLmV4ZWMoIHN0eWxlICkgKSB7CgoJCQkJLy8gcmdiIC8gaHNsCgoJCQkJdmFyIGNvbG9yOwoJCQkJdmFyIG5hbWUgPSBtWyAxIF07CgkJCQl2YXIgY29tcG9uZW50cyA9IG1bIDIgXTsKCgkJCQlzd2l0Y2ggKCBuYW1lICkgewoKCQkJCQljYXNlICdyZ2InOgoJCQkJCWNhc2UgJ3JnYmEnOgoKCQkJCQkJaWYgKCBjb2xvciA9IC9eKFxkKylccyosXHMqKFxkKylccyosXHMqKFxkKylccyooLFxzKihbMC05XSpcLj9bMC05XSspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgoJCQkJCQkJLy8gcmdiKDI1NSwwLDApIHJnYmEoMjU1LDAsMCwwLjUpCgkJCQkJCQl0aGlzLnIgPSBNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDEgXSwgMTAgKSApIC8gMjU1OwoJCQkJCQkJdGhpcy5nID0gTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDI1NTsKCQkJCQkJCXRoaXMuYiA9IE1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMyBdLCAxMCApICkgLyAyNTU7CgoJCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA1IF0gKTsKCgkJCQkJCQlyZXR1cm4gdGhpczsKCgkJCQkJCX0KCgkJCQkJCWlmICggY29sb3IgPSAvXihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKCxccyooWzAtOV0qXC4/WzAtOV0rKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIHJnYigxMDAlLDAlLDAlKSByZ2JhKDEwMCUsMCUsMCUsMC41KQoJCQkJCQkJdGhpcy5yID0gTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAxIF0sIDEwICkgKSAvIDEwMDsKCQkJCQkJCXRoaXMuZyA9IE1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMiBdLCAxMCApICkgLyAxMDA7CgkJCQkJCQl0aGlzLmIgPSBNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMTAwOwoKCQkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNSBdICk7CgoJCQkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnaHNsJzoKCQkJCQljYXNlICdoc2xhJzoKCgkJCQkJCWlmICggY29sb3IgPSAvXihbMC05XSpcLj9bMC05XSspXHMqLFxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKigsXHMqKFswLTldKlwuP1swLTldKylccyopPyQvLmV4ZWMoIGNvbXBvbmVudHMgKSApIHsKCgkJCQkJCQkvLyBoc2woMTIwLDUwJSw1MCUpIGhzbGEoMTIwLDUwJSw1MCUsMC41KQoJCQkJCQkJdmFyIGggPSBwYXJzZUZsb2F0KCBjb2xvclsgMSBdICkgLyAzNjA7CgkJCQkJCQl2YXIgcyA9IHBhcnNlSW50KCBjb2xvclsgMiBdLCAxMCApIC8gMTAwOwoJCQkJCQkJdmFyIGwgPSBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSAvIDEwMDsKCgkJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDUgXSApOwoKCQkJCQkJCXJldHVybiB0aGlzLnNldEhTTCggaCwgcywgbCApOwoKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggbSA9IC9eXCMoW0EtRmEtZjAtOV0rKSQvLmV4ZWMoIHN0eWxlICkgKSB7CgoJCQkJLy8gaGV4IGNvbG9yCgoJCQkJdmFyIGhleCA9IG1bIDEgXTsKCQkJCXZhciBzaXplID0gaGV4Lmxlbmd0aDsKCgkJCQlpZiAoIHNpemUgPT09IDMgKSB7CgoJCQkJCS8vICNmZjAKCQkJCQl0aGlzLnIgPSBwYXJzZUludCggaGV4LmNoYXJBdCggMCApICsgaGV4LmNoYXJBdCggMCApLCAxNiApIC8gMjU1OwoJCQkJCXRoaXMuZyA9IHBhcnNlSW50KCBoZXguY2hhckF0KCAxICkgKyBoZXguY2hhckF0KCAxICksIDE2ICkgLyAyNTU7CgkJCQkJdGhpcy5iID0gcGFyc2VJbnQoIGhleC5jaGFyQXQoIDIgKSArIGhleC5jaGFyQXQoIDIgKSwgMTYgKSAvIDI1NTsKCgkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJfSBlbHNlIGlmICggc2l6ZSA9PT0gNiApIHsKCgkJCQkJLy8gI2ZmMDAwMAoJCQkJCXRoaXMuciA9IHBhcnNlSW50KCBoZXguY2hhckF0KCAwICkgKyBoZXguY2hhckF0KCAxICksIDE2ICkgLyAyNTU7CgkJCQkJdGhpcy5nID0gcGFyc2VJbnQoIGhleC5jaGFyQXQoIDIgKSArIGhleC5jaGFyQXQoIDMgKSwgMTYgKSAvIDI1NTsKCQkJCQl0aGlzLmIgPSBwYXJzZUludCggaGV4LmNoYXJBdCggNCApICsgaGV4LmNoYXJBdCggNSApLCAxNiApIC8gMjU1OwoKCQkJCQlyZXR1cm4gdGhpczsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHN0eWxlICYmIHN0eWxlLmxlbmd0aCA+IDAgKSB7CgoJCQkJLy8gY29sb3Iga2V5d29yZHMKCQkJCXZhciBoZXggPSBDb2xvcktleXdvcmRzWyBzdHlsZSBdOwoKCQkJCWlmICggaGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCS8vIHJlZAoJCQkJCXRoaXMuc2V0SGV4KCBoZXggKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyB1bmtub3duIGNvbG9yCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgJyArIHN0eWxlICk7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuciwgdGhpcy5nLCB0aGlzLmIgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBjb2xvciApIHsKCgkJCXRoaXMuciA9IGNvbG9yLnI7CgkJCXRoaXMuZyA9IGNvbG9yLmc7CgkJCXRoaXMuYiA9IGNvbG9yLmI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29weUdhbW1hVG9MaW5lYXI6IGZ1bmN0aW9uICggY29sb3IsIGdhbW1hRmFjdG9yICkgewoKCQkJaWYgKCBnYW1tYUZhY3RvciA9PT0gdW5kZWZpbmVkICkgZ2FtbWFGYWN0b3IgPSAyLjA7CgoJCQl0aGlzLnIgPSBNYXRoLnBvdyggY29sb3IuciwgZ2FtbWFGYWN0b3IgKTsKCQkJdGhpcy5nID0gTWF0aC5wb3coIGNvbG9yLmcsIGdhbW1hRmFjdG9yICk7CgkJCXRoaXMuYiA9IE1hdGgucG93KCBjb2xvci5iLCBnYW1tYUZhY3RvciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvcHlMaW5lYXJUb0dhbW1hOiBmdW5jdGlvbiAoIGNvbG9yLCBnYW1tYUZhY3RvciApIHsKCgkJCWlmICggZ2FtbWFGYWN0b3IgPT09IHVuZGVmaW5lZCApIGdhbW1hRmFjdG9yID0gMi4wOwoKCQkJdmFyIHNhZmVJbnZlcnNlID0gKCBnYW1tYUZhY3RvciA+IDAgKSA/ICggMS4wIC8gZ2FtbWFGYWN0b3IgKSA6IDEuMDsKCgkJCXRoaXMuciA9IE1hdGgucG93KCBjb2xvci5yLCBzYWZlSW52ZXJzZSApOwoJCQl0aGlzLmcgPSBNYXRoLnBvdyggY29sb3IuZywgc2FmZUludmVyc2UgKTsKCQkJdGhpcy5iID0gTWF0aC5wb3coIGNvbG9yLmIsIHNhZmVJbnZlcnNlICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29udmVydEdhbW1hVG9MaW5lYXI6IGZ1bmN0aW9uICggZ2FtbWFGYWN0b3IgKSB7CgoJCQl0aGlzLmNvcHlHYW1tYVRvTGluZWFyKCB0aGlzLCBnYW1tYUZhY3RvciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvbnZlcnRMaW5lYXJUb0dhbW1hOiBmdW5jdGlvbiAoIGdhbW1hRmFjdG9yICkgewoKCQkJdGhpcy5jb3B5TGluZWFyVG9HYW1tYSggdGhpcywgZ2FtbWFGYWN0b3IgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljb3B5U1JHQlRvTGluZWFyOiBmdW5jdGlvbiAoKSB7CgoJCQlmdW5jdGlvbiBTUkdCVG9MaW5lYXIoIGMgKSB7CgoJCQkJcmV0dXJuICggYyA8IDAuMDQwNDUgKSA/IGMgKiAwLjA3NzM5OTM4MDggOiBNYXRoLnBvdyggYyAqIDAuOTQ3ODY3Mjk4NiArIDAuMDUyMTMyNzAxNCwgMi40ICk7CgoJCQl9CgoJCQlyZXR1cm4gZnVuY3Rpb24gY29weVNSR0JUb0xpbmVhciggY29sb3IgKSB7CgoJCQkJdGhpcy5yID0gU1JHQlRvTGluZWFyKCBjb2xvci5yICk7CgkJCQl0aGlzLmcgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmcgKTsKCQkJCXRoaXMuYiA9IFNSR0JUb0xpbmVhciggY29sb3IuYiApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQljb3B5TGluZWFyVG9TUkdCOiBmdW5jdGlvbiAoKSB7CgoJCQlmdW5jdGlvbiBMaW5lYXJUb1NSR0IoIGMgKSB7CgoJCQkJcmV0dXJuICggYyA8IDAuMDAzMTMwOCApID8gYyAqIDEyLjkyIDogMS4wNTUgKiAoIE1hdGgucG93KCBjLCAwLjQxNjY2ICkgKSAtIDAuMDU1OwoKCQkJfQoKCQkJcmV0dXJuIGZ1bmN0aW9uIGNvcHlMaW5lYXJUb1NSR0IoIGNvbG9yICkgewoKCQkJCXRoaXMuciA9IExpbmVhclRvU1JHQiggY29sb3IuciApOwoJCQkJdGhpcy5nID0gTGluZWFyVG9TUkdCKCBjb2xvci5nICk7CgkJCQl0aGlzLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJY29udmVydFNSR0JUb0xpbmVhcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5jb3B5U1JHQlRvTGluZWFyKCB0aGlzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29udmVydExpbmVhclRvU1JHQjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5jb3B5TGluZWFyVG9TUkdCKCB0aGlzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0SGV4OiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gKCB0aGlzLnIgKiAyNTUgKSA8PCAxNiBeICggdGhpcy5nICogMjU1ICkgPDwgOCBeICggdGhpcy5iICogMjU1ICkgPDwgMDsKCgkJfSwKCgkJZ2V0SGV4U3RyaW5nOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gKCAnMDAwMDAwJyArIHRoaXMuZ2V0SGV4KCkudG9TdHJpbmcoIDE2ICkgKS5zbGljZSggLSA2ICk7CgoJCX0sCgoJCWdldEhTTDogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogLmdldEhTTCgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSB7IGg6IDAsIHM6IDAsIGw6IDAgfTsKCgkJCX0KCgkJCXZhciByID0gdGhpcy5yLCBnID0gdGhpcy5nLCBiID0gdGhpcy5iOwoKCQkJdmFyIG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CgkJCXZhciBtaW4gPSBNYXRoLm1pbiggciwgZywgYiApOwoKCQkJdmFyIGh1ZSwgc2F0dXJhdGlvbjsKCQkJdmFyIGxpZ2h0bmVzcyA9ICggbWluICsgbWF4ICkgLyAyLjA7CgoJCQlpZiAoIG1pbiA9PT0gbWF4ICkgewoKCQkJCWh1ZSA9IDA7CgkJCQlzYXR1cmF0aW9uID0gMDsKCgkJCX0gZWxzZSB7CgoJCQkJdmFyIGRlbHRhID0gbWF4IC0gbWluOwoKCQkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCgkJCQlzd2l0Y2ggKCBtYXggKSB7CgoJCQkJCWNhc2UgcjogaHVlID0gKCBnIC0gYiApIC8gZGVsdGEgKyAoIGcgPCBiID8gNiA6IDAgKTsgYnJlYWs7CgkJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwoJCQkJCWNhc2UgYjogaHVlID0gKCByIC0gZyApIC8gZGVsdGEgKyA0OyBicmVhazsKCgkJCQl9CgoJCQkJaHVlIC89IDY7CgoJCQl9CgoJCQl0YXJnZXQuaCA9IGh1ZTsKCQkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwoJCQl0YXJnZXQubCA9IGxpZ2h0bmVzczsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0sCgoJCWdldFN0eWxlOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gJ3JnYignICsgKCAoIHRoaXMuciAqIDI1NSApIHwgMCApICsgJywnICsgKCAoIHRoaXMuZyAqIDI1NSApIHwgMCApICsgJywnICsgKCAoIHRoaXMuYiAqIDI1NSApIHwgMCApICsgJyknOwoKCQl9LAoKCQlvZmZzZXRIU0w6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBoc2wgPSB7fTsKCgkJCXJldHVybiBmdW5jdGlvbiAoIGgsIHMsIGwgKSB7CgoJCQkJdGhpcy5nZXRIU0woIGhzbCApOwoKCQkJCWhzbC5oICs9IGg7IGhzbC5zICs9IHM7IGhzbC5sICs9IGw7CgoJCQkJdGhpcy5zZXRIU0woIGhzbC5oLCBoc2wucywgaHNsLmwgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJYWRkOiBmdW5jdGlvbiAoIGNvbG9yICkgewoKCQkJdGhpcy5yICs9IGNvbG9yLnI7CgkJCXRoaXMuZyArPSBjb2xvci5nOwoJCQl0aGlzLmIgKz0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlhZGRDb2xvcnM6IGZ1bmN0aW9uICggY29sb3IxLCBjb2xvcjIgKSB7CgoJCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwoJCQl0aGlzLmcgPSBjb2xvcjEuZyArIGNvbG9yMi5nOwoJCQl0aGlzLmIgPSBjb2xvcjEuYiArIGNvbG9yMi5iOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWFkZFNjYWxhcjogZnVuY3Rpb24gKCBzICkgewoKCQkJdGhpcy5yICs9IHM7CgkJCXRoaXMuZyArPSBzOwoJCQl0aGlzLmIgKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzdWI6IGZ1bmN0aW9uICggY29sb3IgKSB7CgoJCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwoJCQl0aGlzLmcgPSBNYXRoLm1heCggMCwgdGhpcy5nIC0gY29sb3IuZyApOwoJCQl0aGlzLmIgPSBNYXRoLm1heCggMCwgdGhpcy5iIC0gY29sb3IuYiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCW11bHRpcGx5OiBmdW5jdGlvbiAoIGNvbG9yICkgewoKCQkJdGhpcy5yICo9IGNvbG9yLnI7CgkJCXRoaXMuZyAqPSBjb2xvci5nOwoJCQl0aGlzLmIgKj0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQltdWx0aXBseVNjYWxhcjogZnVuY3Rpb24gKCBzICkgewoKCQkJdGhpcy5yICo9IHM7CgkJCXRoaXMuZyAqPSBzOwoJCQl0aGlzLmIgKj0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlsZXJwOiBmdW5jdGlvbiAoIGNvbG9yLCBhbHBoYSApIHsKCgkJCXRoaXMuciArPSAoIGNvbG9yLnIgLSB0aGlzLnIgKSAqIGFscGhhOwoJCQl0aGlzLmcgKz0gKCBjb2xvci5nIC0gdGhpcy5nICkgKiBhbHBoYTsKCQkJdGhpcy5iICs9ICggY29sb3IuYiAtIHRoaXMuYiApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbGVycEhTTDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGhzbEEgPSB7IGg6IDAsIHM6IDAsIGw6IDAgfTsKCQkJdmFyIGhzbEIgPSB7IGg6IDAsIHM6IDAsIGw6IDAgfTsKCgkJCXJldHVybiBmdW5jdGlvbiBsZXJwSFNMKCBjb2xvciwgYWxwaGEgKSB7CgoJCQkJdGhpcy5nZXRIU0woIGhzbEEgKTsKCQkJCWNvbG9yLmdldEhTTCggaHNsQiApOwoKCQkJCXZhciBoID0gX01hdGgubGVycCggaHNsQS5oLCBoc2xCLmgsIGFscGhhICk7CgkJCQl2YXIgcyA9IF9NYXRoLmxlcnAoIGhzbEEucywgaHNsQi5zLCBhbHBoYSApOwoJCQkJdmFyIGwgPSBfTWF0aC5sZXJwKCBoc2xBLmwsIGhzbEIubCwgYWxwaGEgKTsKCgkJCQl0aGlzLnNldEhTTCggaCwgcywgbCApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQllcXVhbHM6IGZ1bmN0aW9uICggYyApIHsKCgkJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCgkJfSwKCgkJZnJvbUFycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCXRoaXMuciA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy5nID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy5iID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0FycmF5OiBmdW5jdGlvbiAoIGFycmF5LCBvZmZzZXQgKSB7CgoJCQlpZiAoIGFycmF5ID09PSB1bmRlZmluZWQgKSBhcnJheSA9IFtdOwoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgb2Zmc2V0ID0gMDsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMucjsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuZzsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuYjsKCgkJCXJldHVybiBhcnJheTsKCgkJfSwKCgkJdG9KU09OOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRIZXgoKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIFVuaWZvcm1zIGxpYnJhcnkgZm9yIHNoYXJlZCB3ZWJnbCBzaGFkZXJzCgkgKi8KCgl2YXIgVW5pZm9ybXNMaWIgPSB7CgoJCWNvbW1vbjogewoKCQkJZGlmZnVzZTogeyB2YWx1ZTogbmV3IENvbG9yKCAweGVlZWVlZSApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiBuZXcgTWF0cml4MygpIH0sCgoJCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoKCQl9LAoKCQlzcGVjdWxhcm1hcDogewoKCQkJc3BlY3VsYXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKCgkJfSwKCgkJZW52bWFwOiB7CgoJCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJZmxpcEVudk1hcDogeyB2YWx1ZTogLSAxIH0sCgkJCXJlZmxlY3Rpdml0eTogeyB2YWx1ZTogMS4wIH0sCgkJCXJlZnJhY3Rpb25SYXRpbzogeyB2YWx1ZTogMC45OCB9LAoJCQltYXhNaXBMZXZlbDogeyB2YWx1ZTogMCB9CgoJCX0sCgoJCWFvbWFwOiB7CgoJCQlhb01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlhb01hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9CgoJCX0sCgoJCWxpZ2h0bWFwOiB7CgoJCQlsaWdodE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlsaWdodE1hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9CgoJCX0sCgoJCWVtaXNzaXZlbWFwOiB7CgoJCQllbWlzc2l2ZU1hcDogeyB2YWx1ZTogbnVsbCB9CgoJCX0sCgoJCWJ1bXBtYXA6IHsKCgkJCWJ1bXBNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJYnVtcFNjYWxlOiB7IHZhbHVlOiAxIH0KCgkJfSwKCgkJbm9ybWFsbWFwOiB7CgoJCQlub3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJbm9ybWFsU2NhbGU6IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCAxLCAxICkgfQoKCQl9LAoKCQlkaXNwbGFjZW1lbnRtYXA6IHsKCgkJCWRpc3BsYWNlbWVudE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlkaXNwbGFjZW1lbnRTY2FsZTogeyB2YWx1ZTogMSB9LAoJCQlkaXNwbGFjZW1lbnRCaWFzOiB7IHZhbHVlOiAwIH0KCgkJfSwKCgkJcm91Z2huZXNzbWFwOiB7CgoJCQlyb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfQoKCQl9LAoKCQltZXRhbG5lc3NtYXA6IHsKCgkJCW1ldGFsbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9CgoJCX0sCgoJCWdyYWRpZW50bWFwOiB7CgoJCQlncmFkaWVudE1hcDogeyB2YWx1ZTogbnVsbCB9CgoJCX0sCgoJCWZvZzogewoKCQkJZm9nRGVuc2l0eTogeyB2YWx1ZTogMC4wMDAyNSB9LAoJCQlmb2dOZWFyOiB7IHZhbHVlOiAxIH0sCgkJCWZvZ0ZhcjogeyB2YWx1ZTogMjAwMCB9LAoJCQlmb2dDb2xvcjogeyB2YWx1ZTogbmV3IENvbG9yKCAweGZmZmZmZiApIH0KCgkJfSwKCgkJbGlnaHRzOiB7CgoJCQlhbWJpZW50TGlnaHRDb2xvcjogeyB2YWx1ZTogW10gfSwKCgkJCWRpcmVjdGlvbmFsTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJZGlyZWN0aW9uOiB7fSwKCQkJCWNvbG9yOiB7fSwKCgkJCQlzaGFkb3c6IHt9LAoJCQkJc2hhZG93Qmlhczoge30sCgkJCQlzaGFkb3dSYWRpdXM6IHt9LAoJCQkJc2hhZG93TWFwU2l6ZToge30KCQkJfSB9LAoKCQkJZGlyZWN0aW9uYWxTaGFkb3dNYXA6IHsgdmFsdWU6IFtdIH0sCgkJCWRpcmVjdGlvbmFsU2hhZG93TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQkJc3BvdExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJCWNvbG9yOiB7fSwKCQkJCXBvc2l0aW9uOiB7fSwKCQkJCWRpcmVjdGlvbjoge30sCgkJCQlkaXN0YW5jZToge30sCgkJCQljb25lQ29zOiB7fSwKCQkJCXBlbnVtYnJhQ29zOiB7fSwKCQkJCWRlY2F5OiB7fSwKCgkJCQlzaGFkb3c6IHt9LAoJCQkJc2hhZG93Qmlhczoge30sCgkJCQlzaGFkb3dSYWRpdXM6IHt9LAoJCQkJc2hhZG93TWFwU2l6ZToge30KCQkJfSB9LAoKCQkJc3BvdFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJc3BvdFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCgkJCXBvaW50TGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJY29sb3I6IHt9LAoJCQkJcG9zaXRpb246IHt9LAoJCQkJZGVjYXk6IHt9LAoJCQkJZGlzdGFuY2U6IHt9LAoKCQkJCXNoYWRvdzoge30sCgkJCQlzaGFkb3dCaWFzOiB7fSwKCQkJCXNoYWRvd1JhZGl1czoge30sCgkJCQlzaGFkb3dNYXBTaXplOiB7fSwKCQkJCXNoYWRvd0NhbWVyYU5lYXI6IHt9LAoJCQkJc2hhZG93Q2FtZXJhRmFyOiB7fQoJCQl9IH0sCgoJCQlwb2ludFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJcG9pbnRTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgoJCQloZW1pc3BoZXJlTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJZGlyZWN0aW9uOiB7fSwKCQkJCXNreUNvbG9yOiB7fSwKCQkJCWdyb3VuZENvbG9yOiB7fQoJCQl9IH0sCgoJCQkvLyBUT0RPIChhYmVsbmF0aW9uKTogUmVjdEFyZWFMaWdodCBCUkRGIGRhdGEgbmVlZHMgdG8gYmUgbW92ZWQgZnJvbSBleGFtcGxlIHRvIG1haW4gc3JjCgkJCXJlY3RBcmVhTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJY29sb3I6IHt9LAoJCQkJcG9zaXRpb246IHt9LAoJCQkJd2lkdGg6IHt9LAoJCQkJaGVpZ2h0OiB7fQoJCQl9IH0KCgkJfSwKCgkJcG9pbnRzOiB7CgoJCQlkaWZmdXNlOiB7IHZhbHVlOiBuZXcgQ29sb3IoIDB4ZWVlZWVlICkgfSwKCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0sCgkJCXNpemU6IHsgdmFsdWU6IDEuMCB9LAoJCQlzY2FsZTogeyB2YWx1ZTogMS4wIH0sCgkJCW1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCXNwcml0ZTogewoKCQkJZGlmZnVzZTogeyB2YWx1ZTogbmV3IENvbG9yKCAweGVlZWVlZSApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoJCQljZW50ZXI6IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCAwLjUsIDAuNSApIH0sCgkJCXJvdGF0aW9uOiB7IHZhbHVlOiAwLjAgfSwKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiBuZXcgTWF0cml4MygpIH0KCgkJfQoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKi8KCgl2YXIgU2hhZGVyTGliID0gewoKCQliYXNpYzogewoKCQkJdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZwoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY192ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGJhc2ljX2ZyYWcKCgkJfSwKCgkJbGFtYmVydDogewoKCQkJdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRzLAoJCQkJewoJCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobGFtYmVydF9mcmFnCgoJCX0sCgoJCXBob25nOiB7CgoJCQl1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuc3BlY3VsYXJtYXAsCgkJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCgkJCQlVbmlmb3Jtc0xpYi5hb21hcCwKCQkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAoJCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCgkJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAoJCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQkJVW5pZm9ybXNMaWIuZ3JhZGllbnRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCQl7CgkJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IG5ldyBDb2xvciggMHgwMDAwMDAgKSB9LAoJCQkJCXNwZWN1bGFyOiB7IHZhbHVlOiBuZXcgQ29sb3IoIDB4MTExMTExICkgfSwKCQkJCQlzaGluaW5lc3M6IHsgdmFsdWU6IDMwIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaG9uZ19mcmFnCgoJCX0sCgoJCXN0YW5kYXJkOiB7CgoJCQl1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLnJvdWdobmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQkJcm91Z2huZXNzOiB7IHZhbHVlOiAwLjUgfSwKCQkJCQltZXRhbG5lc3M6IHsgdmFsdWU6IDAuNSB9LAoJCQkJCWVudk1hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9IC8vIHRlbXBvcmFyeQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCgkJfSwKCgkJbWF0Y2FwOiB7CgoJCQl1bmlmb3JtczogbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQltYXRjYXA6IHsgdmFsdWU6IG51bGwgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfZnJhZwoKCQl9LAoKCQlwb2ludHM6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5wb2ludHMsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5wb2ludHNfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c19mcmFnCgoJCX0sCgoJCWRhc2hlZDogewoKCQkJdW5pZm9ybXM6IG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQlzY2FsZTogeyB2YWx1ZTogMSB9LAoJCQkJCWRhc2hTaXplOiB7IHZhbHVlOiAxIH0sCgkJCQkJdG90YWxTaXplOiB7IHZhbHVlOiAyIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX2ZyYWcKCgkJfSwKCgkJZGVwdGg6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfZnJhZwoKCQl9LAoKCQlub3JtYWw6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAoJCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQkJewoJCQkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubm9ybWFsX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5ub3JtYWxfZnJhZwoKCQl9LAoKCQlzcHJpdGU6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5zcHJpdGUsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zcHJpdGVfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV9mcmFnCgoJCX0sCgoJCWJhY2tncm91bmQ6IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogbmV3IE1hdHJpeDMoKSB9LAoJCQkJdDJEOiB7IHZhbHVlOiBudWxsIH0sCgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfZnJhZwoKCQl9LAoJCS8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCQkvLwlDdWJlIG1hcCBzaGFkZXIKCQkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCQljdWJlOiB7CgoJCQl1bmlmb3JtczogewoJCQkJdEN1YmU6IHsgdmFsdWU6IG51bGwgfSwKCQkJCXRGbGlwOiB7IHZhbHVlOiAtIDEgfSwKCQkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9CgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmN1YmVfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmN1YmVfZnJhZwoKCQl9LAoKCQllcXVpcmVjdDogewoKCQkJdW5pZm9ybXM6IHsKCQkJCXRFcXVpcmVjdDogeyB2YWx1ZTogbnVsbCB9LAoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5lcXVpcmVjdF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZXF1aXJlY3RfZnJhZwoKCQl9LAoKCQlkaXN0YW5jZVJHQkE6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQl7CgkJCQkJcmVmZXJlbmNlUG9zaXRpb246IHsgdmFsdWU6IG5ldyBWZWN0b3IzKCkgfSwKCQkJCQluZWFyRGlzdGFuY2U6IHsgdmFsdWU6IDEgfSwKCQkJCQlmYXJEaXN0YW5jZTogeyB2YWx1ZTogMTAwMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfZnJhZwoKCQl9LAoKCQlzaGFkb3c6IHsKCgkJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQl7CgkJCQkJY29sb3I6IHsgdmFsdWU6IG5ldyBDb2xvciggMHgwMDAwMCApIH0sCgkJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJCX0sCgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5zaGFkb3dfZnJhZwoKCQl9CgoJfTsKCglTaGFkZXJMaWIucGh5c2ljYWwgPSB7CgoJCXVuaWZvcm1zOiBtZXJnZVVuaWZvcm1zKCBbCgkJCVNoYWRlckxpYi5zdGFuZGFyZC51bmlmb3JtcywKCQkJewoJCQkJY2xlYXJDb2F0OiB7IHZhbHVlOiAwIH0sCgkJCQljbGVhckNvYXRSb3VnaG5lc3M6IHsgdmFsdWU6IDAgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfZnJhZwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViR0xBbmltYXRpb24oKSB7CgoJCXZhciBjb250ZXh0ID0gbnVsbDsKCQl2YXIgaXNBbmltYXRpbmcgPSBmYWxzZTsKCQl2YXIgYW5pbWF0aW9uTG9vcCA9IG51bGw7CgoJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKCQkJaWYgKCBpc0FuaW1hdGluZyA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQlhbmltYXRpb25Mb29wKCB0aW1lLCBmcmFtZSApOwoKCQkJY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJc3RhcnQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlpZiAoIGlzQW5pbWF0aW5nID09PSB0cnVlICkgcmV0dXJuOwoJCQkJaWYgKCBhbmltYXRpb25Mb29wID09PSBudWxsICkgcmV0dXJuOwoKCQkJCWNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBvbkFuaW1hdGlvbkZyYW1lICk7CgoJCQkJaXNBbmltYXRpbmcgPSB0cnVlOwoKCQkJfSwKCgkJCXN0b3A6IGZ1bmN0aW9uICgpIHsKCgkJCQlpc0FuaW1hdGluZyA9IGZhbHNlOwoKCQkJfSwKCgkJCXNldEFuaW1hdGlvbkxvb3A6IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQkJYW5pbWF0aW9uTG9vcCA9IGNhbGxiYWNrOwoKCQkJfSwKCgkJCXNldENvbnRleHQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29udGV4dCA9IHZhbHVlOwoKCQkJfQoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTEF0dHJpYnV0ZXMoIGdsICkgewoKCQl2YXIgYnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgoJCWZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlciggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQkJdmFyIGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQl2YXIgdXNhZ2UgPSBhdHRyaWJ1dGUuZHluYW1pYyA/IDM1MDQ4IDogMzUwNDQ7CgoJCQl2YXIgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgoJCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCQkJZ2wuYnVmZmVyRGF0YSggYnVmZmVyVHlwZSwgYXJyYXksIHVzYWdlICk7CgoJCQlhdHRyaWJ1dGUub25VcGxvYWRDYWxsYmFjaygpOwoKCQkJdmFyIHR5cGUgPSA1MTI2OwoKCQkJaWYgKCBhcnJheSBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSApIHsKCgkJCQl0eXBlID0gNTEyNjsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5ICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVW5zdXBwb3J0ZWQgZGF0YSBidWZmZXIgZm9ybWF0OiBGbG9hdDY0QXJyYXkuJyApOwoKCQkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50MTZBcnJheSApIHsKCgkJCQl0eXBlID0gNTEyMzsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSApIHsKCgkJCQl0eXBlID0gNTEyMjsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IDUxMjU7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IDUxMjQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDhBcnJheSApIHsKCgkJCQl0eXBlID0gNTEyMDsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDhBcnJheSApIHsKCgkJCQl0eXBlID0gNTEyMTsKCgkJCX0KCgkJCXJldHVybiB7CgkJCQlidWZmZXI6IGJ1ZmZlciwKCQkJCXR5cGU6IHR5cGUsCgkJCQlieXRlc1BlckVsZW1lbnQ6IGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVCdWZmZXIoIGJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQkJdmFyIGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQl2YXIgdXBkYXRlUmFuZ2UgPSBhdHRyaWJ1dGUudXBkYXRlUmFuZ2U7CgoJCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCgkJCWlmICggYXR0cmlidXRlLmR5bmFtaWMgPT09IGZhbHNlICkgewoKCQkJCWdsLmJ1ZmZlckRhdGEoIGJ1ZmZlclR5cGUsIGFycmF5LCAzNTA0NCApOwoKCQkJfSBlbHNlIGlmICggdXBkYXRlUmFuZ2UuY291bnQgPT09IC0gMSApIHsKCgkJCQkvLyBOb3QgdXNpbmcgdXBkYXRlIHJhbmdlcwoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIDAsIGFycmF5ICk7CgoJCQl9IGVsc2UgaWYgKCB1cGRhdGVSYW5nZS5jb3VudCA9PT0gMCApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xPYmplY3RzLnVwZGF0ZUJ1ZmZlcjogZHluYW1pYyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUgbWFya2VkIGFzIG5lZWRzVXBkYXRlIGJ1dCB1cGRhdGVSYW5nZS5jb3VudCBpcyAwLCBlbnN1cmUgeW91IGFyZSB1c2luZyBzZXQgbWV0aG9kcyBvciB1cGRhdGluZyBtYW51YWxseS4nICk7CgoJCQl9IGVsc2UgewoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCWFycmF5LnN1YmFycmF5KCB1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLm9mZnNldCArIHVwZGF0ZVJhbmdlLmNvdW50ICkgKTsKCgkJCQl1cGRhdGVSYW5nZS5jb3VudCA9IC0gMTsgLy8gcmVzZXQgcmFuZ2UKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiBnZXQoIGF0dHJpYnV0ZSApIHsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCXJldHVybiBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVtb3ZlKCBhdHRyaWJ1dGUgKSB7CgoJCQlpZiAoIGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgYXR0cmlidXRlID0gYXR0cmlidXRlLmRhdGE7CgoJCQl2YXIgZGF0YSA9IGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgkJCWlmICggZGF0YSApIHsKCgkJCQlnbC5kZWxldGVCdWZmZXIoIGRhdGEuYnVmZmVyICk7CgoJCQkJYnVmZmVycy5kZWxldGUoIGF0dHJpYnV0ZSApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZSggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKCQkJdmFyIGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlidWZmZXJzLnNldCggYXR0cmlidXRlLCBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApICk7CgoJCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCQl1cGRhdGVCdWZmZXIoIGRhdGEuYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKTsKCgkJCQlkYXRhLnZlcnNpb24gPSBhdHRyaWJ1dGUudmVyc2lvbjsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gewoKCQkJZ2V0OiBnZXQsCgkJCXJlbW92ZTogcmVtb3ZlLAoJCQl1cGRhdGU6IHVwZGF0ZQoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gRmFjZTMoIGEsIGIsIGMsIG5vcm1hbCwgY29sb3IsIG1hdGVyaWFsSW5kZXggKSB7CgoJCXRoaXMuYSA9IGE7CgkJdGhpcy5iID0gYjsKCQl0aGlzLmMgPSBjOwoKCQl0aGlzLm5vcm1hbCA9ICggbm9ybWFsICYmIG5vcm1hbC5pc1ZlY3RvcjMgKSA/IG5vcm1hbCA6IG5ldyBWZWN0b3IzKCk7CgkJdGhpcy52ZXJ0ZXhOb3JtYWxzID0gQXJyYXkuaXNBcnJheSggbm9ybWFsICkgPyBub3JtYWwgOiBbXTsKCgkJdGhpcy5jb2xvciA9ICggY29sb3IgJiYgY29sb3IuaXNDb2xvciApID8gY29sb3IgOiBuZXcgQ29sb3IoKTsKCQl0aGlzLnZlcnRleENvbG9ycyA9IEFycmF5LmlzQXJyYXkoIGNvbG9yICkgPyBjb2xvciA6IFtdOwoKCQl0aGlzLm1hdGVyaWFsSW5kZXggPSBtYXRlcmlhbEluZGV4ICE9PSB1bmRlZmluZWQgPyBtYXRlcmlhbEluZGV4IDogMDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggRmFjZTMucHJvdG90eXBlLCB7CgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJdGhpcy5hID0gc291cmNlLmE7CgkJCXRoaXMuYiA9IHNvdXJjZS5iOwoJCQl0aGlzLmMgPSBzb3VyY2UuYzsKCgkJCXRoaXMubm9ybWFsLmNvcHkoIHNvdXJjZS5ub3JtYWwgKTsKCQkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJCXRoaXMubWF0ZXJpYWxJbmRleCA9IHNvdXJjZS5tYXRlcmlhbEluZGV4OwoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHNvdXJjZS52ZXJ0ZXhOb3JtYWxzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRoaXMudmVydGV4Tm9ybWFsc1sgaSBdID0gc291cmNlLnZlcnRleE5vcm1hbHNbIGkgXS5jbG9uZSgpOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHNvdXJjZS52ZXJ0ZXhDb2xvcnMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy52ZXJ0ZXhDb2xvcnNbIGkgXSA9IHNvdXJjZS52ZXJ0ZXhDb2xvcnNbIGkgXS5jbG9uZSgpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKi8KCglmdW5jdGlvbiBFdWxlciggeCwgeSwgeiwgb3JkZXIgKSB7CgoJCXRoaXMuX3ggPSB4IHx8IDA7CgkJdGhpcy5feSA9IHkgfHwgMDsKCQl0aGlzLl96ID0geiB8fCAwOwoJCXRoaXMuX29yZGVyID0gb3JkZXIgfHwgRXVsZXIuRGVmYXVsdE9yZGVyOwoKCX0KCglFdWxlci5Sb3RhdGlvbk9yZGVycyA9IFsgJ1hZWicsICdZWlgnLCAnWlhZJywgJ1haWScsICdZWFonLCAnWllYJyBdOwoKCUV1bGVyLkRlZmF1bHRPcmRlciA9ICdYWVonOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBFdWxlci5wcm90b3R5cGUsIHsKCgkJeDogewoKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHRoaXMuX3g7CgoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXRoaXMuX3ggPSB2YWx1ZTsKCQkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJfQoKCQl9LAoKCQl5OiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gdGhpcy5feTsKCgkJCX0sCgoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJdGhpcy5feSA9IHZhbHVlOwoJCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQl9CgoJCX0sCgoJCXo6IHsKCgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLl96OwoKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQl0aGlzLl96ID0gdmFsdWU7CgkJCQl0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCX0KCgkJfSwKCgkJb3JkZXI6IHsKCgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLl9vcmRlcjsKCgkJCX0sCgoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJdGhpcy5fb3JkZXIgPSB2YWx1ZTsKCQkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJfQoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIEV1bGVyLnByb3RvdHlwZSwgewoKCQlpc0V1bGVyOiB0cnVlLAoKCQlzZXQ6IGZ1bmN0aW9uICggeCwgeSwgeiwgb3JkZXIgKSB7CgoJCQl0aGlzLl94ID0geDsKCQkJdGhpcy5feSA9IHk7CgkJCXRoaXMuX3ogPSB6OwoJCQl0aGlzLl9vcmRlciA9IG9yZGVyIHx8IHRoaXMuX29yZGVyOwoKCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fb3JkZXIgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBldWxlciApIHsKCgkJCXRoaXMuX3ggPSBldWxlci5feDsKCQkJdGhpcy5feSA9IGV1bGVyLl95OwoJCQl0aGlzLl96ID0gZXVsZXIuX3o7CgkJCXRoaXMuX29yZGVyID0gZXVsZXIuX29yZGVyOwoKCQkJdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbVJvdGF0aW9uTWF0cml4OiBmdW5jdGlvbiAoIG0sIG9yZGVyLCB1cGRhdGUgKSB7CgoJCQl2YXIgY2xhbXAgPSBfTWF0aC5jbGFtcDsKCgkJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgoJCQl2YXIgdGUgPSBtLmVsZW1lbnRzOwoJCQl2YXIgbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXTsKCQkJdmFyIG0yMSA9IHRlWyAxIF0sIG0yMiA9IHRlWyA1IF0sIG0yMyA9IHRlWyA5IF07CgkJCXZhciBtMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCgkJCW9yZGVyID0gb3JkZXIgfHwgdGhpcy5fb3JkZXI7CgoJCQlpZiAoIG9yZGVyID09PSAnWFlaJyApIHsKCgkJCQl0aGlzLl95ID0gTWF0aC5hc2luKCBjbGFtcCggbTEzLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0xMyApIDwgMC45OTk5OSApIHsKCgkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIC0gbTIzLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwoJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWVhaJyApIHsKCgkJCQl0aGlzLl94ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMjMsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTIzICkgPCAwLjk5OTk5ICkgewoKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMjIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWlhZJyApIHsKCgkJCQl0aGlzLl94ID0gTWF0aC5hc2luKCBjbGFtcCggbTMyLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0zMiApIDwgMC45OTk5OSApIHsKCgkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIC0gbTMxLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3kgPSAwOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWllYJyApIHsKCgkJCQl0aGlzLl95ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMzEsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTMxICkgPCAwLjk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggbTMyLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMTEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl94ID0gMDsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWVpYJyApIHsKCgkJCQl0aGlzLl96ID0gTWF0aC5hc2luKCBjbGFtcCggbTIxLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0yMSApIDwgMC45OTk5OSApIHsKCgkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIC0gbTIzLCBtMjIgKTsKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSAwOwoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9yZGVyID09PSAnWFpZJyApIHsKCgkJCQl0aGlzLl96ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMTIsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTEyICkgPCAwLjk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggbTMyLCBtMjIgKTsKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMTEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwoJCQkJCXRoaXMuX3kgPSAwOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRXVsZXI6IC5zZXRGcm9tUm90YXRpb25NYXRyaXgoKSBnaXZlbiB1bnN1cHBvcnRlZCBvcmRlcjogJyArIG9yZGVyICk7CgoJCQl9CgoJCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKCQkJaWYgKCB1cGRhdGUgIT09IGZhbHNlICkgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbVF1YXRlcm5pb246IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBtYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHNldEZyb21RdWF0ZXJuaW9uKCBxLCBvcmRlciwgdXBkYXRlICkgewoKCQkJCW1hdHJpeC5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApOwoKCQkJCXJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbWF0cml4LCBvcmRlciwgdXBkYXRlICk7CgoJCQl9OwoKCQl9KCksCgoJCXNldEZyb21WZWN0b3IzOiBmdW5jdGlvbiAoIHYsIG9yZGVyICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciB8fCB0aGlzLl9vcmRlciApOwoKCQl9LAoKCQlyZW9yZGVyOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBXQVJOSU5HOiB0aGlzIGRpc2NhcmRzIHJldm9sdXRpb24gaW5mb3JtYXRpb24gLWJob3VzdG9uCgoJCQl2YXIgcSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcmVvcmRlciggbmV3T3JkZXIgKSB7CgoJCQkJcS5zZXRGcm9tRXVsZXIoIHRoaXMgKTsKCgkJCQlyZXR1cm4gdGhpcy5zZXRGcm9tUXVhdGVybmlvbiggcSwgbmV3T3JkZXIgKTsKCgkJCX07CgoJCX0oKSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIGV1bGVyICkgewoKCQkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKCQl9LAoKCQlmcm9tQXJyYXk6IGZ1bmN0aW9uICggYXJyYXkgKSB7CgoJCQl0aGlzLl94ID0gYXJyYXlbIDAgXTsKCQkJdGhpcy5feSA9IGFycmF5WyAxIF07CgkJCXRoaXMuX3ogPSBhcnJheVsgMiBdOwoJCQlpZiAoIGFycmF5WyAzIF0gIT09IHVuZGVmaW5lZCApIHRoaXMuX29yZGVyID0gYXJyYXlbIDMgXTsKCgkJCXRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvQXJyYXk6IGZ1bmN0aW9uICggYXJyYXksIG9mZnNldCApIHsKCgkJCWlmICggYXJyYXkgPT09IHVuZGVmaW5lZCApIGFycmF5ID0gW107CgkJCWlmICggb2Zmc2V0ID09PSB1bmRlZmluZWQgKSBvZmZzZXQgPSAwOwoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuX3k7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fb3JkZXI7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0sCgoJCXRvVmVjdG9yMzogZnVuY3Rpb24gKCBvcHRpb25hbFJlc3VsdCApIHsKCgkJCWlmICggb3B0aW9uYWxSZXN1bHQgKSB7CgoJCQkJcmV0dXJuIG9wdGlvbmFsUmVzdWx0LnNldCggdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbmV3IFZlY3RvcjMoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3ogKTsKCgkJCX0KCgkJfSwKCgkJb25DaGFuZ2U6IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlvbkNoYW5nZUNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7fQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBMYXllcnMoKSB7CgoJCXRoaXMubWFzayA9IDEgfCAwOwoKCX0KCglPYmplY3QuYXNzaWduKCBMYXllcnMucHJvdG90eXBlLCB7CgoJCXNldDogZnVuY3Rpb24gKCBjaGFubmVsICkgewoKCQkJdGhpcy5tYXNrID0gMSA8PCBjaGFubmVsIHwgMDsKCgkJfSwKCgkJZW5hYmxlOiBmdW5jdGlvbiAoIGNoYW5uZWwgKSB7CgoJCQl0aGlzLm1hc2sgfD0gMSA8PCBjaGFubmVsIHwgMDsKCgkJfSwKCgkJdG9nZ2xlOiBmdW5jdGlvbiAoIGNoYW5uZWwgKSB7CgoJCQl0aGlzLm1hc2sgXj0gMSA8PCBjaGFubmVsIHwgMDsKCgkJfSwKCgkJZGlzYWJsZTogZnVuY3Rpb24gKCBjaGFubmVsICkgewoKCQkJdGhpcy5tYXNrICY9IH4gKCAxIDw8IGNoYW5uZWwgfCAwICk7CgoJCX0sCgoJCXRlc3Q6IGZ1bmN0aW9uICggbGF5ZXJzICkgewoKCQkJcmV0dXJuICggdGhpcy5tYXNrICYgbGF5ZXJzLm1hc2sgKSAhPT0gMDsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIG1pa2FlbCBlbXRpbmdlciAvIGh0dHA6Ly9nb21vLnNlLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgV2VzdExhbmdsZXkgLyBodHRwOi8vZ2l0aHViLmNvbS9XZXN0TGFuZ2xleQoJICogQGF1dGhvciBlbGVwaGFudGF0d29yayAvIHd3dy5lbGVwaGFudGF0d29yay5jaAoJICovCgoJdmFyIG9iamVjdDNESWQgPSAwOwoKCWZ1bmN0aW9uIE9iamVjdDNEKCkgewoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IG9iamVjdDNESWQgKysgfSApOwoKCQl0aGlzLnV1aWQgPSBfTWF0aC5nZW5lcmF0ZVVVSUQoKTsKCgkJdGhpcy5uYW1lID0gJyc7CgkJdGhpcy50eXBlID0gJ09iamVjdDNEJzsKCgkJdGhpcy5wYXJlbnQgPSBudWxsOwoJCXRoaXMuY2hpbGRyZW4gPSBbXTsKCgkJdGhpcy51cCA9IE9iamVjdDNELkRlZmF1bHRVcC5jbG9uZSgpOwoKCQl2YXIgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCXZhciByb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoJCXZhciBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCQl2YXIgc2NhbGUgPSBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoKCQlmdW5jdGlvbiBvblJvdGF0aW9uQ2hhbmdlKCkgewoKCQkJcXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoIHJvdGF0aW9uLCBmYWxzZSApOwoKCQl9CgoJCWZ1bmN0aW9uIG9uUXVhdGVybmlvbkNoYW5nZSgpIHsKCgkJCXJvdGF0aW9uLnNldEZyb21RdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uLCB1bmRlZmluZWQsIGZhbHNlICk7CgoJCX0KCgkJcm90YXRpb24ub25DaGFuZ2UoIG9uUm90YXRpb25DaGFuZ2UgKTsKCQlxdWF0ZXJuaW9uLm9uQ2hhbmdlKCBvblF1YXRlcm5pb25DaGFuZ2UgKTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIHRoaXMsIHsKCQkJcG9zaXRpb246IHsKCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQl2YWx1ZTogcG9zaXRpb24KCQkJfSwKCQkJcm90YXRpb246IHsKCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQl2YWx1ZTogcm90YXRpb24KCQkJfSwKCQkJcXVhdGVybmlvbjogewoJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCXZhbHVlOiBxdWF0ZXJuaW9uCgkJCX0sCgkJCXNjYWxlOiB7CgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IHNjYWxlCgkJCX0sCgkJCW1vZGVsVmlld01hdHJpeDogewoJCQkJdmFsdWU6IG5ldyBNYXRyaXg0KCkKCQkJfSwKCQkJbm9ybWFsTWF0cml4OiB7CgkJCQl2YWx1ZTogbmV3IE1hdHJpeDMoKQoJCQl9CgkJfSApOwoKCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJdGhpcy5tYXRyaXhXb3JsZCA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IE9iamVjdDNELkRlZmF1bHRNYXRyaXhBdXRvVXBkYXRlOwoJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmxheWVycyA9IG5ldyBMYXllcnMoKTsKCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKCQl0aGlzLmNhc3RTaGFkb3cgPSBmYWxzZTsKCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBmYWxzZTsKCgkJdGhpcy5mcnVzdHVtQ3VsbGVkID0gdHJ1ZTsKCQl0aGlzLnJlbmRlck9yZGVyID0gMDsKCgkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCX0KCglPYmplY3QzRC5EZWZhdWx0VXAgPSBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoJT2JqZWN0M0QuRGVmYXVsdE1hdHJpeEF1dG9VcGRhdGUgPSB0cnVlOwoKCU9iamVjdDNELnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogT2JqZWN0M0QsCgoJCWlzT2JqZWN0M0Q6IHRydWUsCgoJCW9uQmVmb3JlUmVuZGVyOiBmdW5jdGlvbiAoKSB7fSwKCQlvbkFmdGVyUmVuZGVyOiBmdW5jdGlvbiAoKSB7fSwKCgkJYXBwbHlNYXRyaXg6IGZ1bmN0aW9uICggbWF0cml4ICkgewoKCQkJdGhpcy5tYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggbWF0cml4LCB0aGlzLm1hdHJpeCApOwoKCQkJdGhpcy5tYXRyaXguZGVjb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgkJfSwKCgkJYXBwbHlRdWF0ZXJuaW9uOiBmdW5jdGlvbiAoIHEgKSB7CgoJCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIHEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRSb3RhdGlvbkZyb21BeGlzQW5nbGU6IGZ1bmN0aW9uICggYXhpcywgYW5nbGUgKSB7CgoJCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCX0sCgoJCXNldFJvdGF0aW9uRnJvbUV1bGVyOiBmdW5jdGlvbiAoIGV1bGVyICkgewoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciggZXVsZXIsIHRydWUgKTsKCgkJfSwKCgkJc2V0Um90YXRpb25Gcm9tTWF0cml4OiBmdW5jdGlvbiAoIG0gKSB7CgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApOwoKCQl9LAoKCQlzZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uOiBmdW5jdGlvbiAoIHEgKSB7CgoJCQkvLyBhc3N1bWVzIHEgaXMgbm9ybWFsaXplZAoKCQkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHEgKTsKCgkJfSwKCgkJcm90YXRlT25BeGlzOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gb2JqZWN0IHNwYWNlCgkJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCQl2YXIgcTEgPSBuZXcgUXVhdGVybmlvbigpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJvdGF0ZU9uQXhpcyggYXhpcywgYW5nbGUgKSB7CgoJCQkJcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgkJCQl0aGlzLnF1YXRlcm5pb24ubXVsdGlwbHkoIHExICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXJvdGF0ZU9uV29ybGRBeGlzOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gd29ybGQgc3BhY2UKCQkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCQkJLy8gbWV0aG9kIGFzc3VtZXMgbm8gcm90YXRlZCBwYXJlbnQKCgkJCXZhciBxMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcm90YXRlT25Xb3JsZEF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkJCXExLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCQkJdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KCBxMSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQlyb3RhdGVYOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMyggMSwgMCwgMCApOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJvdGF0ZVgoIGFuZ2xlICkgewoKCQkJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggdjEsIGFuZ2xlICk7CgoJCQl9OwoKCQl9KCksCgoJCXJvdGF0ZVk6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCAwLCAxLCAwICk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcm90YXRlWSggYW5nbGUgKSB7CgoJCQkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCB2MSwgYW5nbGUgKTsKCgkJCX07CgoJCX0oKSwKCgkJcm90YXRlWjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoIDAsIDAsIDEgKTsKCgkJCXJldHVybiBmdW5jdGlvbiByb3RhdGVaKCBhbmdsZSApIHsKCgkJCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIHYxLCBhbmdsZSApOwoKCQkJfTsKCgkJfSgpLAoKCQl0cmFuc2xhdGVPbkF4aXM6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIHRyYW5zbGF0ZSBvYmplY3QgYnkgZGlzdGFuY2UgYWxvbmcgYXhpcyBpbiBvYmplY3Qgc3BhY2UKCQkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gdHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIHsKCgkJCQl2MS5jb3B5KCBheGlzICkuYXBwbHlRdWF0ZXJuaW9uKCB0aGlzLnF1YXRlcm5pb24gKTsKCgkJCQl0aGlzLnBvc2l0aW9uLmFkZCggdjEubXVsdGlwbHlTY2FsYXIoIGRpc3RhbmNlICkgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJdHJhbnNsYXRlWDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoIDEsIDAsIDAgKTsKCgkJCXJldHVybiBmdW5jdGlvbiB0cmFuc2xhdGVYKCBkaXN0YW5jZSApIHsKCgkJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIHYxLCBkaXN0YW5jZSApOwoKCQkJfTsKCgkJfSgpLAoKCQl0cmFuc2xhdGVZOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHRyYW5zbGF0ZVkoIGRpc3RhbmNlICkgewoKCQkJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggdjEsIGRpc3RhbmNlICk7CgoJCQl9OwoKCQl9KCksCgoJCXRyYW5zbGF0ZVo6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCAwLCAwLCAxICk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gdHJhbnNsYXRlWiggZGlzdGFuY2UgKSB7CgoJCQkJcmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKCB2MSwgZGlzdGFuY2UgKTsKCgkJCX07CgoJCX0oKSwKCgkJbG9jYWxUb1dvcmxkOiBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCX0sCgoJCXdvcmxkVG9Mb2NhbDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG0xID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiB3b3JsZFRvTG9jYWwoIHZlY3RvciApIHsKCgkJCQlyZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCggbTEuZ2V0SW52ZXJzZSggdGhpcy5tYXRyaXhXb3JsZCApICk7CgoJCQl9OwoKCQl9KCksCgoJCWxvb2tBdDogZnVuY3Rpb24gKCkgewoKCQkJLy8gVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCBvYmplY3RzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBwYXJlbnQocykKCgkJCXZhciBxMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCXZhciBtMSA9IG5ldyBNYXRyaXg0KCk7CgkJCXZhciB0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGxvb2tBdCggeCwgeSwgeiApIHsKCgkJCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJCQl0YXJnZXQuY29weSggeCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRhcmdldC5zZXQoIHgsIHksIHogKTsKCgkJCQl9CgoJCQkJdmFyIHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQkJcG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCQkJaWYgKCB0aGlzLmlzQ2FtZXJhIHx8IHRoaXMuaXNMaWdodCApIHsKCgkJCQkJbTEubG9va0F0KCBwb3NpdGlvbiwgdGFyZ2V0LCB0aGlzLnVwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJbTEubG9va0F0KCB0YXJnZXQsIHBvc2l0aW9uLCB0aGlzLnVwICk7CgoJCQkJfQoKCQkJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIG0xICk7CgoJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCW0xLmV4dHJhY3RSb3RhdGlvbiggcGFyZW50Lm1hdHJpeFdvcmxkICk7CgkJCQkJcTEuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtMSApOwoJCQkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggcTEuaW52ZXJzZSgpICk7CgoJCQkJfQoKCQkJfTsKCgkJfSgpLAoKCQlhZGQ6IGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMSApIHsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpICsrICkgewoKCQkJCQl0aGlzLmFkZCggYXJndW1lbnRzWyBpIF0gKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQlpZiAoIG9iamVjdCA9PT0gdGhpcyApIHsKCgkJCQljb25zb2xlLmVycm9yKCAiVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3QgY2FuJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuIiwgb2JqZWN0ICk7CgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggKCBvYmplY3QgJiYgb2JqZWN0LmlzT2JqZWN0M0QgKSApIHsKCgkJCQlpZiAoIG9iamVjdC5wYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJCW9iamVjdC5wYXJlbnQucmVtb3ZlKCBvYmplY3QgKTsKCgkJCQl9CgoJCQkJb2JqZWN0LnBhcmVudCA9IHRoaXM7CgkJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnYWRkZWQnIH0gKTsKCgkJCQl0aGlzLmNoaWxkcmVuLnB1c2goIG9iamVjdCApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zb2xlLmVycm9yKCAiVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3Qgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLk9iamVjdDNELiIsIG9iamVjdCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXJlbW92ZTogZnVuY3Rpb24gKCBvYmplY3QgKSB7CgoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXRoaXMucmVtb3ZlKCBhcmd1bWVudHNbIGkgXSApOwoKCQkJCX0KCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCXZhciBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZiggb2JqZWN0ICk7CgoJCQlpZiAoIGluZGV4ICE9PSAtIDEgKSB7CgoJCQkJb2JqZWN0LnBhcmVudCA9IG51bGw7CgoJCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ3JlbW92ZWQnIH0gKTsKCgkJCQl0aGlzLmNoaWxkcmVuLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlnZXRPYmplY3RCeUlkOiBmdW5jdGlvbiAoIGlkICkgewoKCQkJcmV0dXJuIHRoaXMuZ2V0T2JqZWN0QnlQcm9wZXJ0eSggJ2lkJywgaWQgKTsKCgkJfSwKCgkJZ2V0T2JqZWN0QnlOYW1lOiBmdW5jdGlvbiAoIG5hbWUgKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnbmFtZScsIG5hbWUgKTsKCgkJfSwKCgkJZ2V0T2JqZWN0QnlQcm9wZXJ0eTogZnVuY3Rpb24gKCBuYW1lLCB2YWx1ZSApIHsKCgkJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJldHVybiB0aGlzOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBjaGlsZCA9IHRoaXMuY2hpbGRyZW5bIGkgXTsKCQkJCXZhciBvYmplY3QgPSBjaGlsZC5nZXRPYmplY3RCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSApOwoKCQkJCWlmICggb2JqZWN0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiBvYmplY3Q7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHVuZGVmaW5lZDsKCgkJfSwKCgkJZ2V0V29ybGRQb3NpdGlvbjogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdDNEOiAuZ2V0V29ybGRQb3NpdGlvbigpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJdGhpcy51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJcmV0dXJuIHRhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCgkJfSwKCgkJZ2V0V29ybGRRdWF0ZXJuaW9uOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgc2NhbGUgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGdldFdvcmxkUXVhdGVybmlvbiggdGFyZ2V0ICkgewoKCQkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdDNEOiAuZ2V0V29ybGRRdWF0ZXJuaW9uKCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCQl0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwoKCQkJCX0KCgkJCQl0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIHBvc2l0aW9uLCB0YXJnZXQsIHNjYWxlICk7CgoJCQkJcmV0dXJuIHRhcmdldDsKCgkJCX07CgoJCX0oKSwKCgkJZ2V0V29ybGRTY2FsZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGdldFdvcmxkU2NhbGUoIHRhcmdldCApIHsKCgkJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3QzRDogLmdldFdvcmxkU2NhbGUoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkJfQoKCQkJCXRoaXMudXBkYXRlTWF0cml4V29ybGQoIHRydWUgKTsKCgkJCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggcG9zaXRpb24sIHF1YXRlcm5pb24sIHRhcmdldCApOwoKCQkJCXJldHVybiB0YXJnZXQ7CgoJCQl9OwoKCQl9KCksCgoJCWdldFdvcmxkRGlyZWN0aW9uOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0M0Q6IC5nZXRXb3JsZERpcmVjdGlvbigpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJdGhpcy51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJdmFyIGUgPSB0aGlzLm1hdHJpeFdvcmxkLmVsZW1lbnRzOwoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIGVbIDggXSwgZVsgOSBdLCBlWyAxMCBdICkubm9ybWFsaXplKCk7CgoJCX0sCgoJCXJheWNhc3Q6IGZ1bmN0aW9uICgpIHt9LAoKCQl0cmF2ZXJzZTogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCWNhbGxiYWNrKCB0aGlzICk7CgoJCQl2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljaGlsZHJlblsgaSBdLnRyYXZlcnNlKCBjYWxsYmFjayApOwoKCQkJfQoKCQl9LAoKCQl0cmF2ZXJzZVZpc2libGU6IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQljYWxsYmFjayggdGhpcyApOwoKCQkJdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY2hpbGRyZW5bIGkgXS50cmF2ZXJzZVZpc2libGUoIGNhbGxiYWNrICk7CgoJCQl9CgoJCX0sCgoJCXRyYXZlcnNlQW5jZXN0b3JzOiBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKCQkJdmFyIHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJY2FsbGJhY2soIHBhcmVudCApOwoKCQkJCXBhcmVudC50cmF2ZXJzZUFuY2VzdG9ycyggY2FsbGJhY2sgKTsKCgkJCX0KCgkJfSwKCgkJdXBkYXRlTWF0cml4OiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLm1hdHJpeC5jb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgkJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0sCgoJCXVwZGF0ZU1hdHJpeFdvcmxkOiBmdW5jdGlvbiAoIGZvcmNlICkgewoKCQkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgKSB0aGlzLnVwZGF0ZU1hdHJpeCgpOwoKCQkJaWYgKCB0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgfHwgZm9yY2UgKSB7CgoJCQkJaWYgKCB0aGlzLnBhcmVudCA9PT0gbnVsbCApIHsKCgkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyggdGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4ICk7CgoJCQkJfQoKCQkJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCWZvcmNlID0gdHJ1ZTsKCgkJCX0KCgkJCS8vIHVwZGF0ZSBjaGlsZHJlbgoKCQkJdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY2hpbGRyZW5bIGkgXS51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgkJCX0KCgkJfSwKCgkJdXBkYXRlV29ybGRNYXRyaXg6IGZ1bmN0aW9uICggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKSB7CgoJCQl2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCQlpZiAoIHVwZGF0ZVBhcmVudHMgPT09IHRydWUgJiYgcGFyZW50ICE9PSBudWxsICkgewoKCQkJCXBhcmVudC51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCX0KCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKCQkJfQoKCQkJLy8gdXBkYXRlIGNoaWxkcmVuCgoJCQlpZiAoIHVwZGF0ZUNoaWxkcmVuID09PSB0cnVlICkgewoKCQkJCXZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY2hpbGRyZW5bIGkgXS51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIHRydWUgKTsKCgkJCQl9CgoJCQl9CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCBtZXRhICkgewoKCQkJLy8gbWV0YSBpcyBhIHN0cmluZyB3aGVuIGNhbGxlZCBmcm9tIEpTT04uc3RyaW5naWZ5CgkJCXZhciBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCXZhciBvdXRwdXQgPSB7fTsKCgkJCS8vIG1ldGEgaXMgYSBoYXNoIHVzZWQgdG8gY29sbGVjdCBnZW9tZXRyaWVzLCBtYXRlcmlhbHMuCgkJCS8vIG5vdCBwcm92aWRpbmcgaXQgaW1wbGllcyB0aGF0IHRoaXMgaXMgdGhlIHJvb3Qgb2JqZWN0CgkJCS8vIGJlaW5nIHNlcmlhbGl6ZWQuCgkJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJCS8vIGluaXRpYWxpemUgbWV0YSBvYmoKCQkJCW1ldGEgPSB7CgkJCQkJZ2VvbWV0cmllczoge30sCgkJCQkJbWF0ZXJpYWxzOiB7fSwKCQkJCQl0ZXh0dXJlczoge30sCgkJCQkJaW1hZ2VzOiB7fSwKCQkJCQlzaGFwZXM6IHt9CgkJCQl9OwoKCQkJCW91dHB1dC5tZXRhZGF0YSA9IHsKCQkJCQl2ZXJzaW9uOiA0LjUsCgkJCQkJdHlwZTogJ09iamVjdCcsCgkJCQkJZ2VuZXJhdG9yOiAnT2JqZWN0M0QudG9KU09OJwoJCQkJfTsKCgkJCX0KCgkJCS8vIHN0YW5kYXJkIE9iamVjdDNEIHNlcmlhbGl6YXRpb24KCgkJCXZhciBvYmplY3QgPSB7fTsKCgkJCW9iamVjdC51dWlkID0gdGhpcy51dWlkOwoJCQlvYmplY3QudHlwZSA9IHRoaXMudHlwZTsKCgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwoJCQlpZiAoIHRoaXMuY2FzdFNoYWRvdyA9PT0gdHJ1ZSApIG9iamVjdC5jYXN0U2hhZG93ID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLnJlY2VpdmVTaGFkb3cgPT09IHRydWUgKSBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CgkJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CgkJCWlmICggdGhpcy5mcnVzdHVtQ3VsbGVkID09PSBmYWxzZSApIG9iamVjdC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CgkJCWlmICggdGhpcy5yZW5kZXJPcmRlciAhPT0gMCApIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CgkJCWlmICggSlNPTi5zdHJpbmdpZnkoIHRoaXMudXNlckRhdGEgKSAhPT0gJ3t9JyApIG9iamVjdC51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CgoJCQlvYmplY3QubGF5ZXJzID0gdGhpcy5sYXllcnMubWFzazsKCQkJb2JqZWN0Lm1hdHJpeCA9IHRoaXMubWF0cml4LnRvQXJyYXkoKTsKCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlID09PSBmYWxzZSApIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCQkvLyBvYmplY3Qgc3BlY2lmaWMgcHJvcGVydGllcwoKCQkJaWYgKCB0aGlzLmlzTWVzaCAmJiB0aGlzLmRyYXdNb2RlICE9PSBUcmlhbmdsZXNEcmF3TW9kZSApIG9iamVjdC5kcmF3TW9kZSA9IHRoaXMuZHJhd01vZGU7CgoJCQkvLwoKCQkJZnVuY3Rpb24gc2VyaWFsaXplKCBsaWJyYXJ5LCBlbGVtZW50ICkgewoKCQkJCWlmICggbGlicmFyeVsgZWxlbWVudC51dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbGlicmFyeVsgZWxlbWVudC51dWlkIF0gPSBlbGVtZW50LnRvSlNPTiggbWV0YSApOwoKCQkJCX0KCgkJCQlyZXR1cm4gZWxlbWVudC51dWlkOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmlzTWVzaCB8fCB0aGlzLmlzTGluZSB8fCB0aGlzLmlzUG9pbnRzICkgewoKCQkJCW9iamVjdC5nZW9tZXRyeSA9IHNlcmlhbGl6ZSggbWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5ICk7CgoJCQkJdmFyIHBhcmFtZXRlcnMgPSB0aGlzLmdlb21ldHJ5LnBhcmFtZXRlcnM7CgoJCQkJaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgJiYgcGFyYW1ldGVycy5zaGFwZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdmFyIHNoYXBlcyA9IHBhcmFtZXRlcnMuc2hhcGVzOwoKCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApICkgewoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQkJdmFyIHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGUgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXNlcmlhbGl6ZSggbWV0YS5zaGFwZXMsIHNoYXBlcyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLm1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCB0aGlzLm1hdGVyaWFsICkgKSB7CgoJCQkJCXZhciB1dWlkcyA9IFtdOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLm1hdGVyaWFsLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQl1dWlkcy5wdXNoKCBzZXJpYWxpemUoIG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsWyBpIF0gKSApOwoKCQkJCQl9CgoJCQkJCW9iamVjdC5tYXRlcmlhbCA9IHV1aWRzOwoKCQkJCX0gZWxzZSB7CgoJCQkJCW9iamVjdC5tYXRlcmlhbCA9IHNlcmlhbGl6ZSggbWV0YS5tYXRlcmlhbHMsIHRoaXMubWF0ZXJpYWwgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCB0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDAgKSB7CgoJCQkJb2JqZWN0LmNoaWxkcmVuID0gW107CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCW9iamVjdC5jaGlsZHJlbi5wdXNoKCB0aGlzLmNoaWxkcmVuWyBpIF0udG9KU09OKCBtZXRhICkub2JqZWN0ICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBpc1Jvb3RPYmplY3QgKSB7CgoJCQkJdmFyIGdlb21ldHJpZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmdlb21ldHJpZXMgKTsKCQkJCXZhciBtYXRlcmlhbHMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm1hdGVyaWFscyApOwoJCQkJdmFyIHRleHR1cmVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS50ZXh0dXJlcyApOwoJCQkJdmFyIGltYWdlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuaW1hZ2VzICk7CgkJCQl2YXIgc2hhcGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5zaGFwZXMgKTsKCgkJCQlpZiAoIGdlb21ldHJpZXMubGVuZ3RoID4gMCApIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKCQkJCWlmICggbWF0ZXJpYWxzLmxlbmd0aCA+IDAgKSBvdXRwdXQubWF0ZXJpYWxzID0gbWF0ZXJpYWxzOwoJCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKCQkJCWlmICggc2hhcGVzLmxlbmd0aCA+IDAgKSBvdXRwdXQuc2hhcGVzID0gc2hhcGVzOwoKCQkJfQoKCQkJb3V0cHV0Lm9iamVjdCA9IG9iamVjdDsKCgkJCXJldHVybiBvdXRwdXQ7CgoJCQkvLyBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgaGFzaAoJCQkvLyByZW1vdmUgbWV0YWRhdGEgb24gZWFjaCBpdGVtCgkJCS8vIGFuZCByZXR1cm4gYXMgYXJyYXkKCQkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgoJCQkJdmFyIHZhbHVlcyA9IFtdOwoJCQkJZm9yICggdmFyIGtleSBpbiBjYWNoZSApIHsKCgkJCQkJdmFyIGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgkJCQlyZXR1cm4gdmFsdWVzOwoKCQkJfQoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCByZWN1cnNpdmUgKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzLCByZWN1cnNpdmUgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCWlmICggcmVjdXJzaXZlID09PSB1bmRlZmluZWQgKSByZWN1cnNpdmUgPSB0cnVlOwoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCQl0aGlzLnVwLmNvcHkoIHNvdXJjZS51cCApOwoKCQkJdGhpcy5wb3NpdGlvbi5jb3B5KCBzb3VyY2UucG9zaXRpb24gKTsKCQkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHNvdXJjZS5xdWF0ZXJuaW9uICk7CgkJCXRoaXMuc2NhbGUuY29weSggc291cmNlLnNjYWxlICk7CgoJCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgkJCXRoaXMubWF0cml4V29ybGQuY29weSggc291cmNlLm1hdHJpeFdvcmxkICk7CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCQkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CgoJCQl0aGlzLmxheWVycy5tYXNrID0gc291cmNlLmxheWVycy5tYXNrOwoJCQl0aGlzLnZpc2libGUgPSBzb3VyY2UudmlzaWJsZTsKCgkJCXRoaXMuY2FzdFNoYWRvdyA9IHNvdXJjZS5jYXN0U2hhZG93OwoJCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBzb3VyY2UucmVjZWl2ZVNoYWRvdzsKCgkJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5mcnVzdHVtQ3VsbGVkOwoJCQl0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwoKCQkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQkJaWYgKCByZWN1cnNpdmUgPT09IHRydWUgKSB7CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgc291cmNlLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJdmFyIGNoaWxkID0gc291cmNlLmNoaWxkcmVuWyBpIF07CgkJCQkJdGhpcy5hZGQoIGNoaWxkLmNsb25lKCkgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGtpbGUgLyBodHRwOi8va2lsZS5zdHJhdmFnYW56YS5vcmcvCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBtaWthZWwgZW10aW5nZXIgLyBodHRwOi8vZ29tby5zZS8KCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8KCSAqLwoKCXZhciBnZW9tZXRyeUlkID0gMDsgLy8gR2VvbWV0cnkgdXNlcyBldmVuIG51bWJlcnMgYXMgSWQKCglmdW5jdGlvbiBHZW9tZXRyeSgpIHsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBnZW9tZXRyeUlkICs9IDIgfSApOwoKCQl0aGlzLnV1aWQgPSBfTWF0aC5nZW5lcmF0ZVVVSUQoKTsKCgkJdGhpcy5uYW1lID0gJyc7CgkJdGhpcy50eXBlID0gJ0dlb21ldHJ5JzsKCgkJdGhpcy52ZXJ0aWNlcyA9IFtdOwoJCXRoaXMuY29sb3JzID0gW107CgkJdGhpcy5mYWNlcyA9IFtdOwoJCXRoaXMuZmFjZVZlcnRleFV2cyA9IFtbXV07CgoJCXRoaXMubW9ycGhUYXJnZXRzID0gW107CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBbXTsKCgkJdGhpcy5za2luV2VpZ2h0cyA9IFtdOwoJCXRoaXMuc2tpbkluZGljZXMgPSBbXTsKCgkJdGhpcy5saW5lRGlzdGFuY2VzID0gW107CgoJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKCQkvLyB1cGRhdGUgZmxhZ3MKCgkJdGhpcy5lbGVtZW50c05lZWRVcGRhdGUgPSBmYWxzZTsKCQl0aGlzLnZlcnRpY2VzTmVlZFVwZGF0ZSA9IGZhbHNlOwoJCXRoaXMudXZzTmVlZFVwZGF0ZSA9IGZhbHNlOwoJCXRoaXMubm9ybWFsc05lZWRVcGRhdGUgPSBmYWxzZTsKCQl0aGlzLmNvbG9yc05lZWRVcGRhdGUgPSBmYWxzZTsKCQl0aGlzLmxpbmVEaXN0YW5jZXNOZWVkVXBkYXRlID0gZmFsc2U7CgkJdGhpcy5ncm91cHNOZWVkVXBkYXRlID0gZmFsc2U7CgoJfQoKCUdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogR2VvbWV0cnksCgoJCWlzR2VvbWV0cnk6IHRydWUsCgoJCWFwcGx5TWF0cml4OiBmdW5jdGlvbiAoIG1hdHJpeCApIHsKCgkJCXZhciBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgdmVydGV4ID0gdGhpcy52ZXJ0aWNlc1sgaSBdOwoJCQkJdmVydGV4LmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJCQl9CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gdGhpcy5mYWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgZmFjZSA9IHRoaXMuZmFjZXNbIGkgXTsKCQkJCWZhY2Uubm9ybWFsLmFwcGx5TWF0cml4Myggbm9ybWFsTWF0cml4ICkubm9ybWFsaXplKCk7CgoJCQkJZm9yICggdmFyIGogPSAwLCBqbCA9IGZhY2UudmVydGV4Tm9ybWFscy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJZmFjZS52ZXJ0ZXhOb3JtYWxzWyBqIF0uYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCX0KCgkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQkJfQoKCQkJdGhpcy52ZXJ0aWNlc05lZWRVcGRhdGUgPSB0cnVlOwoJCQl0aGlzLm5vcm1hbHNOZWVkVXBkYXRlID0gdHJ1ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlyb3RhdGVYOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHgtYXhpcwoKCQkJdmFyIG0xID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiByb3RhdGVYKCBhbmdsZSApIHsKCgkJCQltMS5tYWtlUm90YXRpb25YKCBhbmdsZSApOwoKCQkJCXRoaXMuYXBwbHlNYXRyaXgoIG0xICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXJvdGF0ZVk6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeS1heGlzCgoJCQl2YXIgbTEgPSBuZXcgTWF0cml4NCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJvdGF0ZVkoIGFuZ2xlICkgewoKCQkJCW0xLm1ha2VSb3RhdGlvblkoIGFuZ2xlICk7CgoJCQkJdGhpcy5hcHBseU1hdHJpeCggbTEgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJcm90YXRlWjogZnVuY3Rpb24gKCkgewoKCQkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB6LWF4aXMKCgkJCXZhciBtMSA9IG5ldyBNYXRyaXg0KCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcm90YXRlWiggYW5nbGUgKSB7CgoJCQkJbTEubWFrZVJvdGF0aW9uWiggYW5nbGUgKTsKCgkJCQl0aGlzLmFwcGx5TWF0cml4KCBtMSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQl0cmFuc2xhdGU6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIHRyYW5zbGF0ZSBnZW9tZXRyeQoKCQkJdmFyIG0xID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiB0cmFuc2xhdGUoIHgsIHksIHogKSB7CgoJCQkJbTEubWFrZVRyYW5zbGF0aW9uKCB4LCB5LCB6ICk7CgoJCQkJdGhpcy5hcHBseU1hdHJpeCggbTEgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJc2NhbGU6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIHNjYWxlIGdlb21ldHJ5CgoJCQl2YXIgbTEgPSBuZXcgTWF0cml4NCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHNjYWxlKCB4LCB5LCB6ICkgewoKCQkJCW0xLm1ha2VTY2FsZSggeCwgeSwgeiApOwoKCQkJCXRoaXMuYXBwbHlNYXRyaXgoIG0xICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCWxvb2tBdDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG9iaiA9IG5ldyBPYmplY3QzRCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGxvb2tBdCggdmVjdG9yICkgewoKCQkJCW9iai5sb29rQXQoIHZlY3RvciApOwoKCQkJCW9iai51cGRhdGVNYXRyaXgoKTsKCgkJCQl0aGlzLmFwcGx5TWF0cml4KCBvYmoubWF0cml4ICk7CgoJCQl9OwoKCQl9KCksCgoJCWZyb21CdWZmZXJHZW9tZXRyeTogZnVuY3Rpb24gKCBnZW9tZXRyeSApIHsKCgkJCXZhciBzY29wZSA9IHRoaXM7CgoJCQl2YXIgaW5kaWNlcyA9IGdlb21ldHJ5LmluZGV4ICE9PSBudWxsID8gZ2VvbWV0cnkuaW5kZXguYXJyYXkgOiB1bmRlZmluZWQ7CgkJCXZhciBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCgkJCXZhciBwb3NpdGlvbnMgPSBhdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwoJCQl2YXIgbm9ybWFscyA9IGF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQgPyBhdHRyaWJ1dGVzLm5vcm1hbC5hcnJheSA6IHVuZGVmaW5lZDsKCQkJdmFyIGNvbG9ycyA9IGF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCA/IGF0dHJpYnV0ZXMuY29sb3IuYXJyYXkgOiB1bmRlZmluZWQ7CgkJCXZhciB1dnMgPSBhdHRyaWJ1dGVzLnV2ICE9PSB1bmRlZmluZWQgPyBhdHRyaWJ1dGVzLnV2LmFycmF5IDogdW5kZWZpbmVkOwoJCQl2YXIgdXZzMiA9IGF0dHJpYnV0ZXMudXYyICE9PSB1bmRlZmluZWQgPyBhdHRyaWJ1dGVzLnV2Mi5hcnJheSA6IHVuZGVmaW5lZDsKCgkJCWlmICggdXZzMiAhPT0gdW5kZWZpbmVkICkgdGhpcy5mYWNlVmVydGV4VXZzWyAxIF0gPSBbXTsKCgkJCWZvciAoIHZhciBpID0gMCwgaiA9IDA7IGkgPCBwb3NpdGlvbnMubGVuZ3RoOyBpICs9IDMsIGogKz0gMiApIHsKCgkJCQlzY29wZS52ZXJ0aWNlcy5wdXNoKCBuZXcgVmVjdG9yMygpLmZyb21BcnJheSggcG9zaXRpb25zLCBpICkgKTsKCgkJCQlpZiAoIGNvbG9ycyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5jb2xvcnMucHVzaCggbmV3IENvbG9yKCkuZnJvbUFycmF5KCBjb2xvcnMsIGkgKSApOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIGFkZEZhY2UoIGEsIGIsIGMsIG1hdGVyaWFsSW5kZXggKSB7CgoJCQkJdmFyIHZlcnRleENvbG9ycyA9ICggY29sb3JzID09PSB1bmRlZmluZWQgKSA/IFtdIDogWwoJCQkJCXNjb3BlLmNvbG9yc1sgYSBdLmNsb25lKCksCgkJCQkJc2NvcGUuY29sb3JzWyBiIF0uY2xvbmUoKSwKCQkJCQlzY29wZS5jb2xvcnNbIGMgXS5jbG9uZSgpIF07CgoJCQkJdmFyIHZlcnRleE5vcm1hbHMgPSAoIG5vcm1hbHMgPT09IHVuZGVmaW5lZCApID8gW10gOiBbCgkJCQkJbmV3IFZlY3RvcjMoKS5mcm9tQXJyYXkoIG5vcm1hbHMsIGEgKiAzICksCgkJCQkJbmV3IFZlY3RvcjMoKS5mcm9tQXJyYXkoIG5vcm1hbHMsIGIgKiAzICksCgkJCQkJbmV3IFZlY3RvcjMoKS5mcm9tQXJyYXkoIG5vcm1hbHMsIGMgKiAzICkKCQkJCV07CgoJCQkJdmFyIGZhY2UgPSBuZXcgRmFjZTMoIGEsIGIsIGMsIHZlcnRleE5vcm1hbHMsIHZlcnRleENvbG9ycywgbWF0ZXJpYWxJbmRleCApOwoKCQkJCXNjb3BlLmZhY2VzLnB1c2goIGZhY2UgKTsKCgkJCQlpZiAoIHV2cyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5mYWNlVmVydGV4VXZzWyAwIF0ucHVzaCggWwoJCQkJCQluZXcgVmVjdG9yMigpLmZyb21BcnJheSggdXZzLCBhICogMiApLAoJCQkJCQluZXcgVmVjdG9yMigpLmZyb21BcnJheSggdXZzLCBiICogMiApLAoJCQkJCQluZXcgVmVjdG9yMigpLmZyb21BcnJheSggdXZzLCBjICogMiApCgkJCQkJXSApOwoKCQkJCX0KCgkJCQlpZiAoIHV2czIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2NvcGUuZmFjZVZlcnRleFV2c1sgMSBdLnB1c2goIFsKCQkJCQkJbmV3IFZlY3RvcjIoKS5mcm9tQXJyYXkoIHV2czIsIGEgKiAyICksCgkJCQkJCW5ldyBWZWN0b3IyKCkuZnJvbUFycmF5KCB1dnMyLCBiICogMiApLAoJCQkJCQluZXcgVmVjdG9yMigpLmZyb21BcnJheSggdXZzMiwgYyAqIDIgKQoJCQkJCV0gKTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJaWYgKCBncm91cHMubGVuZ3RoID4gMCApIHsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpICsrICkgewoKCQkJCQl2YXIgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQkJdmFyIHN0YXJ0ID0gZ3JvdXAuc3RhcnQ7CgkJCQkJdmFyIGNvdW50ID0gZ3JvdXAuY291bnQ7CgoJCQkJCWZvciAoIHZhciBqID0gc3RhcnQsIGpsID0gc3RhcnQgKyBjb3VudDsgaiA8IGpsOyBqICs9IDMgKSB7CgoJCQkJCQlpZiAoIGluZGljZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQlhZGRGYWNlKCBpbmRpY2VzWyBqIF0sIGluZGljZXNbIGogKyAxIF0sIGluZGljZXNbIGogKyAyIF0sIGdyb3VwLm1hdGVyaWFsSW5kZXggKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJYWRkRmFjZSggaiwgaiArIDEsIGogKyAyLCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggaW5kaWNlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBpbmRpY2VzLmxlbmd0aDsgaSArPSAzICkgewoKCQkJCQkJYWRkRmFjZSggaW5kaWNlc1sgaSBdLCBpbmRpY2VzWyBpICsgMSBdLCBpbmRpY2VzWyBpICsgMiBdICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBwb3NpdGlvbnMubGVuZ3RoIC8gMzsgaSArPSAzICkgewoKCQkJCQkJYWRkRmFjZSggaSwgaSArIDEsIGkgKyAyICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQl0aGlzLmNvbXB1dGVGYWNlTm9ybWFscygpOwoKCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nQm94ID0gZ2VvbWV0cnkuYm91bmRpbmdCb3guY2xvbmUoKTsKCgkJCX0KCgkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2VudGVyOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgb2Zmc2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjZW50ZXIoKSB7CgoJCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCQl0aGlzLmJvdW5kaW5nQm94LmdldENlbnRlciggb2Zmc2V0ICkubmVnYXRlKCk7CgoJCQkJdGhpcy50cmFuc2xhdGUoIG9mZnNldC54LCBvZmZzZXQueSwgb2Zmc2V0LnogKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJbm9ybWFsaXplOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQkJdmFyIGNlbnRlciA9IHRoaXMuYm91bmRpbmdTcGhlcmUuY2VudGVyOwoJCQl2YXIgcmFkaXVzID0gdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXM7CgoJCQl2YXIgcyA9IHJhZGl1cyA9PT0gMCA/IDEgOiAxLjAgLyByYWRpdXM7CgoJCQl2YXIgbWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQkJbWF0cml4LnNldCgKCQkJCXMsIDAsIDAsIC0gcyAqIGNlbnRlci54LAoJCQkJMCwgcywgMCwgLSBzICogY2VudGVyLnksCgkJCQkwLCAwLCBzLCAtIHMgKiBjZW50ZXIueiwKCQkJCTAsIDAsIDAsIDEKCQkJKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXgoIG1hdHJpeCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvbXB1dGVGYWNlTm9ybWFsczogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGNiID0gbmV3IFZlY3RvcjMoKSwgYWIgPSBuZXcgVmVjdG9yMygpOwoKCQkJZm9yICggdmFyIGYgPSAwLCBmbCA9IHRoaXMuZmFjZXMubGVuZ3RoOyBmIDwgZmw7IGYgKysgKSB7CgoJCQkJdmFyIGZhY2UgPSB0aGlzLmZhY2VzWyBmIF07CgoJCQkJdmFyIHZBID0gdGhpcy52ZXJ0aWNlc1sgZmFjZS5hIF07CgkJCQl2YXIgdkIgPSB0aGlzLnZlcnRpY2VzWyBmYWNlLmIgXTsKCQkJCXZhciB2QyA9IHRoaXMudmVydGljZXNbIGZhY2UuYyBdOwoKCQkJCWNiLnN1YlZlY3RvcnMoIHZDLCB2QiApOwoJCQkJYWIuc3ViVmVjdG9ycyggdkEsIHZCICk7CgkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQljYi5ub3JtYWxpemUoKTsKCgkJCQlmYWNlLm5vcm1hbC5jb3B5KCBjYiApOwoKCQkJfQoKCQl9LAoKCQljb21wdXRlVmVydGV4Tm9ybWFsczogZnVuY3Rpb24gKCBhcmVhV2VpZ2h0ZWQgKSB7CgoJCQlpZiAoIGFyZWFXZWlnaHRlZCA9PT0gdW5kZWZpbmVkICkgYXJlYVdlaWdodGVkID0gdHJ1ZTsKCgkJCXZhciB2LCB2bCwgZiwgZmwsIGZhY2UsIHZlcnRpY2VzOwoKCQkJdmVydGljZXMgPSBuZXcgQXJyYXkoIHRoaXMudmVydGljZXMubGVuZ3RoICk7CgoJCQlmb3IgKCB2ID0gMCwgdmwgPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgdiA8IHZsOyB2ICsrICkgewoKCQkJCXZlcnRpY2VzWyB2IF0gPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJaWYgKCBhcmVhV2VpZ2h0ZWQgKSB7CgoJCQkJLy8gdmVydGV4IG5vcm1hbHMgd2VpZ2h0ZWQgYnkgdHJpYW5nbGUgYXJlYXMKCQkJCS8vIGh0dHA6Ly93d3cuaXF1aWxlemxlcy5vcmcvd3d3L2FydGljbGVzL25vcm1hbHMvbm9ybWFscy5odG0KCgkJCQl2YXIgdkEsIHZCLCB2QzsKCQkJCXZhciBjYiA9IG5ldyBWZWN0b3IzKCksIGFiID0gbmV3IFZlY3RvcjMoKTsKCgkJCQlmb3IgKCBmID0gMCwgZmwgPSB0aGlzLmZhY2VzLmxlbmd0aDsgZiA8IGZsOyBmICsrICkgewoKCQkJCQlmYWNlID0gdGhpcy5mYWNlc1sgZiBdOwoKCQkJCQl2QSA9IHRoaXMudmVydGljZXNbIGZhY2UuYSBdOwoJCQkJCXZCID0gdGhpcy52ZXJ0aWNlc1sgZmFjZS5iIF07CgkJCQkJdkMgPSB0aGlzLnZlcnRpY2VzWyBmYWNlLmMgXTsKCgkJCQkJY2Iuc3ViVmVjdG9ycyggdkMsIHZCICk7CgkJCQkJYWIuc3ViVmVjdG9ycyggdkEsIHZCICk7CgkJCQkJY2IuY3Jvc3MoIGFiICk7CgoJCQkJCXZlcnRpY2VzWyBmYWNlLmEgXS5hZGQoIGNiICk7CgkJCQkJdmVydGljZXNbIGZhY2UuYiBdLmFkZCggY2IgKTsKCQkJCQl2ZXJ0aWNlc1sgZmFjZS5jIF0uYWRkKCBjYiApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5jb21wdXRlRmFjZU5vcm1hbHMoKTsKCgkJCQlmb3IgKCBmID0gMCwgZmwgPSB0aGlzLmZhY2VzLmxlbmd0aDsgZiA8IGZsOyBmICsrICkgewoKCQkJCQlmYWNlID0gdGhpcy5mYWNlc1sgZiBdOwoKCQkJCQl2ZXJ0aWNlc1sgZmFjZS5hIF0uYWRkKCBmYWNlLm5vcm1hbCApOwoJCQkJCXZlcnRpY2VzWyBmYWNlLmIgXS5hZGQoIGZhY2Uubm9ybWFsICk7CgkJCQkJdmVydGljZXNbIGZhY2UuYyBdLmFkZCggZmFjZS5ub3JtYWwgKTsKCgkJCQl9CgoJCQl9CgoJCQlmb3IgKCB2ID0gMCwgdmwgPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgdiA8IHZsOyB2ICsrICkgewoKCQkJCXZlcnRpY2VzWyB2IF0ubm9ybWFsaXplKCk7CgoJCQl9CgoJCQlmb3IgKCBmID0gMCwgZmwgPSB0aGlzLmZhY2VzLmxlbmd0aDsgZiA8IGZsOyBmICsrICkgewoKCQkJCWZhY2UgPSB0aGlzLmZhY2VzWyBmIF07CgoJCQkJdmFyIHZlcnRleE5vcm1hbHMgPSBmYWNlLnZlcnRleE5vcm1hbHM7CgoJCQkJaWYgKCB2ZXJ0ZXhOb3JtYWxzLmxlbmd0aCA9PT0gMyApIHsKCgkJCQkJdmVydGV4Tm9ybWFsc1sgMCBdLmNvcHkoIHZlcnRpY2VzWyBmYWNlLmEgXSApOwoJCQkJCXZlcnRleE5vcm1hbHNbIDEgXS5jb3B5KCB2ZXJ0aWNlc1sgZmFjZS5iIF0gKTsKCQkJCQl2ZXJ0ZXhOb3JtYWxzWyAyIF0uY29weSggdmVydGljZXNbIGZhY2UuYyBdICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdmVydGV4Tm9ybWFsc1sgMCBdID0gdmVydGljZXNbIGZhY2UuYSBdLmNsb25lKCk7CgkJCQkJdmVydGV4Tm9ybWFsc1sgMSBdID0gdmVydGljZXNbIGZhY2UuYiBdLmNsb25lKCk7CgkJCQkJdmVydGV4Tm9ybWFsc1sgMiBdID0gdmVydGljZXNbIGZhY2UuYyBdLmNsb25lKCk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmZhY2VzLmxlbmd0aCA+IDAgKSB7CgoJCQkJdGhpcy5ub3JtYWxzTmVlZFVwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0sCgoJCWNvbXB1dGVGbGF0VmVydGV4Tm9ybWFsczogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGYsIGZsLCBmYWNlOwoKCQkJdGhpcy5jb21wdXRlRmFjZU5vcm1hbHMoKTsKCgkJCWZvciAoIGYgPSAwLCBmbCA9IHRoaXMuZmFjZXMubGVuZ3RoOyBmIDwgZmw7IGYgKysgKSB7CgoJCQkJZmFjZSA9IHRoaXMuZmFjZXNbIGYgXTsKCgkJCQl2YXIgdmVydGV4Tm9ybWFscyA9IGZhY2UudmVydGV4Tm9ybWFsczsKCgkJCQlpZiAoIHZlcnRleE5vcm1hbHMubGVuZ3RoID09PSAzICkgewoKCQkJCQl2ZXJ0ZXhOb3JtYWxzWyAwIF0uY29weSggZmFjZS5ub3JtYWwgKTsKCQkJCQl2ZXJ0ZXhOb3JtYWxzWyAxIF0uY29weSggZmFjZS5ub3JtYWwgKTsKCQkJCQl2ZXJ0ZXhOb3JtYWxzWyAyIF0uY29weSggZmFjZS5ub3JtYWwgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl2ZXJ0ZXhOb3JtYWxzWyAwIF0gPSBmYWNlLm5vcm1hbC5jbG9uZSgpOwoJCQkJCXZlcnRleE5vcm1hbHNbIDEgXSA9IGZhY2Uubm9ybWFsLmNsb25lKCk7CgkJCQkJdmVydGV4Tm9ybWFsc1sgMiBdID0gZmFjZS5ub3JtYWwuY2xvbmUoKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRoaXMuZmFjZXMubGVuZ3RoID4gMCApIHsKCgkJCQl0aGlzLm5vcm1hbHNOZWVkVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJfSwKCgkJY29tcHV0ZU1vcnBoTm9ybWFsczogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGksIGlsLCBmLCBmbCwgZmFjZTsKCgkJCS8vIHNhdmUgb3JpZ2luYWwgbm9ybWFscwoJCQkvLyAtIGNyZWF0ZSB0ZW1wIHZhcmlhYmxlcyBvbiBmaXJzdCBhY2Nlc3MKCQkJLy8gICBvdGhlcndpc2UganVzdCBjb3B5IChmb3IgZmFzdGVyIHJlcGVhdGVkIGNhbGxzKQoKCQkJZm9yICggZiA9IDAsIGZsID0gdGhpcy5mYWNlcy5sZW5ndGg7IGYgPCBmbDsgZiArKyApIHsKCgkJCQlmYWNlID0gdGhpcy5mYWNlc1sgZiBdOwoKCQkJCWlmICggISBmYWNlLl9fb3JpZ2luYWxGYWNlTm9ybWFsICkgewoKCQkJCQlmYWNlLl9fb3JpZ2luYWxGYWNlTm9ybWFsID0gZmFjZS5ub3JtYWwuY2xvbmUoKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlmYWNlLl9fb3JpZ2luYWxGYWNlTm9ybWFsLmNvcHkoIGZhY2Uubm9ybWFsICk7CgoJCQkJfQoKCQkJCWlmICggISBmYWNlLl9fb3JpZ2luYWxWZXJ0ZXhOb3JtYWxzICkgZmFjZS5fX29yaWdpbmFsVmVydGV4Tm9ybWFscyA9IFtdOwoKCQkJCWZvciAoIGkgPSAwLCBpbCA9IGZhY2UudmVydGV4Tm9ybWFscy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJaWYgKCAhIGZhY2UuX19vcmlnaW5hbFZlcnRleE5vcm1hbHNbIGkgXSApIHsKCgkJCQkJCWZhY2UuX19vcmlnaW5hbFZlcnRleE5vcm1hbHNbIGkgXSA9IGZhY2UudmVydGV4Tm9ybWFsc1sgaSBdLmNsb25lKCk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlmYWNlLl9fb3JpZ2luYWxWZXJ0ZXhOb3JtYWxzWyBpIF0uY29weSggZmFjZS52ZXJ0ZXhOb3JtYWxzWyBpIF0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vIHVzZSB0ZW1wIGdlb21ldHJ5IHRvIGNvbXB1dGUgZmFjZSBhbmQgdmVydGV4IG5vcm1hbHMgZm9yIGVhY2ggbW9ycGgKCgkJCXZhciB0bXBHZW8gPSBuZXcgR2VvbWV0cnkoKTsKCQkJdG1wR2VvLmZhY2VzID0gdGhpcy5mYWNlczsKCgkJCWZvciAoIGkgPSAwLCBpbCA9IHRoaXMubW9ycGhUYXJnZXRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCS8vIGNyZWF0ZSBvbiBmaXJzdCBhY2Nlc3MKCgkJCQlpZiAoICEgdGhpcy5tb3JwaE5vcm1hbHNbIGkgXSApIHsKCgkJCQkJdGhpcy5tb3JwaE5vcm1hbHNbIGkgXSA9IHt9OwoJCQkJCXRoaXMubW9ycGhOb3JtYWxzWyBpIF0uZmFjZU5vcm1hbHMgPSBbXTsKCQkJCQl0aGlzLm1vcnBoTm9ybWFsc1sgaSBdLnZlcnRleE5vcm1hbHMgPSBbXTsKCgkJCQkJdmFyIGRzdE5vcm1hbHNGYWNlID0gdGhpcy5tb3JwaE5vcm1hbHNbIGkgXS5mYWNlTm9ybWFsczsKCQkJCQl2YXIgZHN0Tm9ybWFsc1ZlcnRleCA9IHRoaXMubW9ycGhOb3JtYWxzWyBpIF0udmVydGV4Tm9ybWFsczsKCgkJCQkJdmFyIGZhY2VOb3JtYWwsIHZlcnRleE5vcm1hbHM7CgoJCQkJCWZvciAoIGYgPSAwLCBmbCA9IHRoaXMuZmFjZXMubGVuZ3RoOyBmIDwgZmw7IGYgKysgKSB7CgoJCQkJCQlmYWNlTm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCQkJCQkJdmVydGV4Tm9ybWFscyA9IHsgYTogbmV3IFZlY3RvcjMoKSwgYjogbmV3IFZlY3RvcjMoKSwgYzogbmV3IFZlY3RvcjMoKSB9OwoKCQkJCQkJZHN0Tm9ybWFsc0ZhY2UucHVzaCggZmFjZU5vcm1hbCApOwoJCQkJCQlkc3ROb3JtYWxzVmVydGV4LnB1c2goIHZlcnRleE5vcm1hbHMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQl2YXIgbW9ycGhOb3JtYWxzID0gdGhpcy5tb3JwaE5vcm1hbHNbIGkgXTsKCgkJCQkvLyBzZXQgdmVydGljZXMgdG8gbW9ycGggdGFyZ2V0CgoJCQkJdG1wR2VvLnZlcnRpY2VzID0gdGhpcy5tb3JwaFRhcmdldHNbIGkgXS52ZXJ0aWNlczsKCgkJCQkvLyBjb21wdXRlIG1vcnBoIG5vcm1hbHMKCgkJCQl0bXBHZW8uY29tcHV0ZUZhY2VOb3JtYWxzKCk7CgkJCQl0bXBHZW8uY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKCgkJCQkvLyBzdG9yZSBtb3JwaCBub3JtYWxzCgoJCQkJdmFyIGZhY2VOb3JtYWwsIHZlcnRleE5vcm1hbHM7CgoJCQkJZm9yICggZiA9IDAsIGZsID0gdGhpcy5mYWNlcy5sZW5ndGg7IGYgPCBmbDsgZiArKyApIHsKCgkJCQkJZmFjZSA9IHRoaXMuZmFjZXNbIGYgXTsKCgkJCQkJZmFjZU5vcm1hbCA9IG1vcnBoTm9ybWFscy5mYWNlTm9ybWFsc1sgZiBdOwoJCQkJCXZlcnRleE5vcm1hbHMgPSBtb3JwaE5vcm1hbHMudmVydGV4Tm9ybWFsc1sgZiBdOwoKCQkJCQlmYWNlTm9ybWFsLmNvcHkoIGZhY2Uubm9ybWFsICk7CgoJCQkJCXZlcnRleE5vcm1hbHMuYS5jb3B5KCBmYWNlLnZlcnRleE5vcm1hbHNbIDAgXSApOwoJCQkJCXZlcnRleE5vcm1hbHMuYi5jb3B5KCBmYWNlLnZlcnRleE5vcm1hbHNbIDEgXSApOwoJCQkJCXZlcnRleE5vcm1hbHMuYy5jb3B5KCBmYWNlLnZlcnRleE5vcm1hbHNbIDIgXSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIHJlc3RvcmUgb3JpZ2luYWwgbm9ybWFscwoKCQkJZm9yICggZiA9IDAsIGZsID0gdGhpcy5mYWNlcy5sZW5ndGg7IGYgPCBmbDsgZiArKyApIHsKCgkJCQlmYWNlID0gdGhpcy5mYWNlc1sgZiBdOwoKCQkJCWZhY2Uubm9ybWFsID0gZmFjZS5fX29yaWdpbmFsRmFjZU5vcm1hbDsKCQkJCWZhY2UudmVydGV4Tm9ybWFscyA9IGZhY2UuX19vcmlnaW5hbFZlcnRleE5vcm1hbHM7CgoJCQl9CgoJCX0sCgoJCWNvbXB1dGVCb3VuZGluZ0JveDogZnVuY3Rpb24gKCkgewoKCQkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdCb3ggPSBuZXcgQm94MygpOwoKCQkJfQoKCQkJdGhpcy5ib3VuZGluZ0JveC5zZXRGcm9tUG9pbnRzKCB0aGlzLnZlcnRpY2VzICk7CgoJCX0sCgoJCWNvbXB1dGVCb3VuZGluZ1NwaGVyZTogZnVuY3Rpb24gKCkgewoKCQkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQl9CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlLnNldEZyb21Qb2ludHMoIHRoaXMudmVydGljZXMgKTsKCgkJfSwKCgkJbWVyZ2U6IGZ1bmN0aW9uICggZ2VvbWV0cnksIG1hdHJpeCwgbWF0ZXJpYWxJbmRleE9mZnNldCApIHsKCgkJCWlmICggISAoIGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuR2VvbWV0cnkubWVyZ2UoKTogZ2VvbWV0cnkgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkdlb21ldHJ5LicsIGdlb21ldHJ5ICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQl2YXIgbm9ybWFsTWF0cml4LAoJCQkJdmVydGV4T2Zmc2V0ID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGgsCgkJCQl2ZXJ0aWNlczEgPSB0aGlzLnZlcnRpY2VzLAoJCQkJdmVydGljZXMyID0gZ2VvbWV0cnkudmVydGljZXMsCgkJCQlmYWNlczEgPSB0aGlzLmZhY2VzLAoJCQkJZmFjZXMyID0gZ2VvbWV0cnkuZmFjZXMsCgkJCQl1dnMxID0gdGhpcy5mYWNlVmVydGV4VXZzWyAwIF0sCgkJCQl1dnMyID0gZ2VvbWV0cnkuZmFjZVZlcnRleFV2c1sgMCBdLAoJCQkJY29sb3JzMSA9IHRoaXMuY29sb3JzLAoJCQkJY29sb3JzMiA9IGdlb21ldHJ5LmNvbG9yczsKCgkJCWlmICggbWF0ZXJpYWxJbmRleE9mZnNldCA9PT0gdW5kZWZpbmVkICkgbWF0ZXJpYWxJbmRleE9mZnNldCA9IDA7CgoJCQlpZiAoIG1hdHJpeCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJCX0KCgkJCS8vIHZlcnRpY2VzCgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gdmVydGljZXMyLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXZhciB2ZXJ0ZXggPSB2ZXJ0aWNlczJbIGkgXTsKCgkJCQl2YXIgdmVydGV4Q29weSA9IHZlcnRleC5jbG9uZSgpOwoKCQkJCWlmICggbWF0cml4ICE9PSB1bmRlZmluZWQgKSB2ZXJ0ZXhDb3B5LmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJCQkJdmVydGljZXMxLnB1c2goIHZlcnRleENvcHkgKTsKCgkJCX0KCgkJCS8vIGNvbG9ycwoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IGNvbG9yczIubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29sb3JzMS5wdXNoKCBjb2xvcnMyWyBpIF0uY2xvbmUoKSApOwoKCQkJfQoKCQkJLy8gZmFjZXMKCgkJCWZvciAoIGkgPSAwLCBpbCA9IGZhY2VzMi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgZmFjZSA9IGZhY2VzMlsgaSBdLCBmYWNlQ29weSwgbm9ybWFsLCBjb2xvciwKCQkJCQlmYWNlVmVydGV4Tm9ybWFscyA9IGZhY2UudmVydGV4Tm9ybWFscywKCQkJCQlmYWNlVmVydGV4Q29sb3JzID0gZmFjZS52ZXJ0ZXhDb2xvcnM7CgoJCQkJZmFjZUNvcHkgPSBuZXcgRmFjZTMoIGZhY2UuYSArIHZlcnRleE9mZnNldCwgZmFjZS5iICsgdmVydGV4T2Zmc2V0LCBmYWNlLmMgKyB2ZXJ0ZXhPZmZzZXQgKTsKCQkJCWZhY2VDb3B5Lm5vcm1hbC5jb3B5KCBmYWNlLm5vcm1hbCApOwoKCQkJCWlmICggbm9ybWFsTWF0cml4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWZhY2VDb3B5Lm5vcm1hbC5hcHBseU1hdHJpeDMoIG5vcm1hbE1hdHJpeCApLm5vcm1hbGl6ZSgpOwoKCQkJCX0KCgkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gZmFjZVZlcnRleE5vcm1hbHMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCW5vcm1hbCA9IGZhY2VWZXJ0ZXhOb3JtYWxzWyBqIF0uY2xvbmUoKTsKCgkJCQkJaWYgKCBub3JtYWxNYXRyaXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCW5vcm1hbC5hcHBseU1hdHJpeDMoIG5vcm1hbE1hdHJpeCApLm5vcm1hbGl6ZSgpOwoKCQkJCQl9CgoJCQkJCWZhY2VDb3B5LnZlcnRleE5vcm1hbHMucHVzaCggbm9ybWFsICk7CgoJCQkJfQoKCQkJCWZhY2VDb3B5LmNvbG9yLmNvcHkoIGZhY2UuY29sb3IgKTsKCgkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gZmFjZVZlcnRleENvbG9ycy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJY29sb3IgPSBmYWNlVmVydGV4Q29sb3JzWyBqIF07CgkJCQkJZmFjZUNvcHkudmVydGV4Q29sb3JzLnB1c2goIGNvbG9yLmNsb25lKCkgKTsKCgkJCQl9CgoJCQkJZmFjZUNvcHkubWF0ZXJpYWxJbmRleCA9IGZhY2UubWF0ZXJpYWxJbmRleCArIG1hdGVyaWFsSW5kZXhPZmZzZXQ7CgoJCQkJZmFjZXMxLnB1c2goIGZhY2VDb3B5ICk7CgoJCQl9CgoJCQkvLyB1dnMKCgkJCWZvciAoIGkgPSAwLCBpbCA9IHV2czIubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdmFyIHV2ID0gdXZzMlsgaSBdLCB1dkNvcHkgPSBbXTsKCgkJCQlpZiAoIHV2ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnRpbnVlOwoKCQkJCX0KCgkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gdXYubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCXV2Q29weS5wdXNoKCB1dlsgaiBdLmNsb25lKCkgKTsKCgkJCQl9CgoJCQkJdXZzMS5wdXNoKCB1dkNvcHkgKTsKCgkJCX0KCgkJfSwKCgkJbWVyZ2VNZXNoOiBmdW5jdGlvbiAoIG1lc2ggKSB7CgoJCQlpZiAoICEgKCBtZXNoICYmIG1lc2guaXNNZXNoICkgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkdlb21ldHJ5Lm1lcmdlTWVzaCgpOiBtZXNoIG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5NZXNoLicsIG1lc2ggKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggbWVzaC5tYXRyaXhBdXRvVXBkYXRlICkgbWVzaC51cGRhdGVNYXRyaXgoKTsKCgkJCXRoaXMubWVyZ2UoIG1lc2guZ2VvbWV0cnksIG1lc2gubWF0cml4ICk7CgoJCX0sCgoJCS8qCgkJICogQ2hlY2tzIGZvciBkdXBsaWNhdGUgdmVydGljZXMgd2l0aCBoYXNobWFwLgoJCSAqIER1cGxpY2F0ZWQgdmVydGljZXMgYXJlIHJlbW92ZWQKCQkgKiBhbmQgZmFjZXMnIHZlcnRpY2VzIGFyZSB1cGRhdGVkLgoJCSAqLwoKCQltZXJnZVZlcnRpY2VzOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmVydGljZXNNYXAgPSB7fTsgLy8gSGFzaG1hcCBmb3IgbG9va2luZyB1cCB2ZXJ0aWNlcyBieSBwb3NpdGlvbiBjb29yZGluYXRlcyAoYW5kIG1ha2luZyBzdXJlIHRoZXkgYXJlIHVuaXF1ZSkKCQkJdmFyIHVuaXF1ZSA9IFtdLCBjaGFuZ2VzID0gW107CgoJCQl2YXIgdiwga2V5OwoJCQl2YXIgcHJlY2lzaW9uUG9pbnRzID0gNDsgLy8gbnVtYmVyIG9mIGRlY2ltYWwgcG9pbnRzLCBlLmcuIDQgZm9yIGVwc2lsb24gb2YgMC4wMDAxCgkJCXZhciBwcmVjaXNpb24gPSBNYXRoLnBvdyggMTAsIHByZWNpc2lvblBvaW50cyApOwoJCQl2YXIgaSwgaWwsIGZhY2U7CgkJCXZhciBpbmRpY2VzLCBqLCBqbDsKCgkJCWZvciAoIGkgPSAwLCBpbCA9IHRoaXMudmVydGljZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdiA9IHRoaXMudmVydGljZXNbIGkgXTsKCQkJCWtleSA9IE1hdGgucm91bmQoIHYueCAqIHByZWNpc2lvbiApICsgJ18nICsgTWF0aC5yb3VuZCggdi55ICogcHJlY2lzaW9uICkgKyAnXycgKyBNYXRoLnJvdW5kKCB2LnogKiBwcmVjaXNpb24gKTsKCgkJCQlpZiAoIHZlcnRpY2VzTWFwWyBrZXkgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQl2ZXJ0aWNlc01hcFsga2V5IF0gPSBpOwoJCQkJCXVuaXF1ZS5wdXNoKCB0aGlzLnZlcnRpY2VzWyBpIF0gKTsKCQkJCQljaGFuZ2VzWyBpIF0gPSB1bmlxdWUubGVuZ3RoIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvL2NvbnNvbGUubG9nKCdEdXBsaWNhdGUgdmVydGV4IGZvdW5kLiAnLCBpLCAnIGNvdWxkIGJlIHVzaW5nICcsIHZlcnRpY2VzTWFwW2tleV0pOwoJCQkJCWNoYW5nZXNbIGkgXSA9IGNoYW5nZXNbIHZlcnRpY2VzTWFwWyBrZXkgXSBdOwoKCQkJCX0KCgkJCX0KCgoJCQkvLyBpZiBmYWNlcyBhcmUgY29tcGxldGVseSBkZWdlbmVyYXRlIGFmdGVyIG1lcmdpbmcgdmVydGljZXMsIHdlCgkJCS8vIGhhdmUgdG8gcmVtb3ZlIHRoZW0gZnJvbSB0aGUgZ2VvbWV0cnkuCgkJCXZhciBmYWNlSW5kaWNlc1RvUmVtb3ZlID0gW107CgoJCQlmb3IgKCBpID0gMCwgaWwgPSB0aGlzLmZhY2VzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWZhY2UgPSB0aGlzLmZhY2VzWyBpIF07CgoJCQkJZmFjZS5hID0gY2hhbmdlc1sgZmFjZS5hIF07CgkJCQlmYWNlLmIgPSBjaGFuZ2VzWyBmYWNlLmIgXTsKCQkJCWZhY2UuYyA9IGNoYW5nZXNbIGZhY2UuYyBdOwoKCQkJCWluZGljZXMgPSBbIGZhY2UuYSwgZmFjZS5iLCBmYWNlLmMgXTsKCgkJCQkvLyBpZiBhbnkgZHVwbGljYXRlIHZlcnRpY2VzIGFyZSBmb3VuZCBpbiBhIEZhY2UzCgkJCQkvLyB3ZSBoYXZlIHRvIHJlbW92ZSB0aGUgZmFjZSBhcyBub3RoaW5nIGNhbiBiZSBzYXZlZAoJCQkJZm9yICggdmFyIG4gPSAwOyBuIDwgMzsgbiArKyApIHsKCgkJCQkJaWYgKCBpbmRpY2VzWyBuIF0gPT09IGluZGljZXNbICggbiArIDEgKSAlIDMgXSApIHsKCgkJCQkJCWZhY2VJbmRpY2VzVG9SZW1vdmUucHVzaCggaSApOwoJCQkJCQlicmVhazsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWZvciAoIGkgPSBmYWNlSW5kaWNlc1RvUmVtb3ZlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaSAtLSApIHsKCgkJCQl2YXIgaWR4ID0gZmFjZUluZGljZXNUb1JlbW92ZVsgaSBdOwoKCQkJCXRoaXMuZmFjZXMuc3BsaWNlKCBpZHgsIDEgKTsKCgkJCQlmb3IgKCBqID0gMCwgamwgPSB0aGlzLmZhY2VWZXJ0ZXhVdnMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCXRoaXMuZmFjZVZlcnRleFV2c1sgaiBdLnNwbGljZSggaWR4LCAxICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gVXNlIHVuaXF1ZSBzZXQgb2YgdmVydGljZXMKCgkJCXZhciBkaWZmID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGggLSB1bmlxdWUubGVuZ3RoOwoJCQl0aGlzLnZlcnRpY2VzID0gdW5pcXVlOwoJCQlyZXR1cm4gZGlmZjsKCgkJfSwKCgkJc2V0RnJvbVBvaW50czogZnVuY3Rpb24gKCBwb2ludHMgKSB7CgoJCQl0aGlzLnZlcnRpY2VzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBwb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgcG9pbnQgPSBwb2ludHNbIGkgXTsKCQkJCXRoaXMudmVydGljZXMucHVzaCggbmV3IFZlY3RvcjMoIHBvaW50LngsIHBvaW50LnksIHBvaW50LnogfHwgMCApICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc29ydEZhY2VzQnlNYXRlcmlhbEluZGV4OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgZmFjZXMgPSB0aGlzLmZhY2VzOwoJCQl2YXIgbGVuZ3RoID0gZmFjZXMubGVuZ3RoOwoKCQkJLy8gdGFnIGZhY2VzCgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKysgKSB7CgoJCQkJZmFjZXNbIGkgXS5faWQgPSBpOwoKCQkJfQoKCQkJLy8gc29ydCBmYWNlcwoKCQkJZnVuY3Rpb24gbWF0ZXJpYWxJbmRleFNvcnQoIGEsIGIgKSB7CgoJCQkJcmV0dXJuIGEubWF0ZXJpYWxJbmRleCAtIGIubWF0ZXJpYWxJbmRleDsKCgkJCX0KCgkJCWZhY2VzLnNvcnQoIG1hdGVyaWFsSW5kZXhTb3J0ICk7CgoJCQkvLyBzb3J0IHV2cwoKCQkJdmFyIHV2czEgPSB0aGlzLmZhY2VWZXJ0ZXhVdnNbIDAgXTsKCQkJdmFyIHV2czIgPSB0aGlzLmZhY2VWZXJ0ZXhVdnNbIDEgXTsKCgkJCXZhciBuZXdVdnMxLCBuZXdVdnMyOwoKCQkJaWYgKCB1dnMxICYmIHV2czEubGVuZ3RoID09PSBsZW5ndGggKSBuZXdVdnMxID0gW107CgkJCWlmICggdXZzMiAmJiB1dnMyLmxlbmd0aCA9PT0gbGVuZ3RoICkgbmV3VXZzMiA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJCXZhciBpZCA9IGZhY2VzWyBpIF0uX2lkOwoKCQkJCWlmICggbmV3VXZzMSApIG5ld1V2czEucHVzaCggdXZzMVsgaWQgXSApOwoJCQkJaWYgKCBuZXdVdnMyICkgbmV3VXZzMi5wdXNoKCB1dnMyWyBpZCBdICk7CgoJCQl9CgoJCQlpZiAoIG5ld1V2czEgKSB0aGlzLmZhY2VWZXJ0ZXhVdnNbIDAgXSA9IG5ld1V2czE7CgkJCWlmICggbmV3VXZzMiApIHRoaXMuZmFjZVZlcnRleFV2c1sgMSBdID0gbmV3VXZzMjsKCgkJfSwKCgkJdG9KU09OOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgZGF0YSA9IHsKCQkJCW1ldGFkYXRhOiB7CgkJCQkJdmVyc2lvbjogNC41LAoJCQkJCXR5cGU6ICdHZW9tZXRyeScsCgkJCQkJZ2VuZXJhdG9yOiAnR2VvbWV0cnkudG9KU09OJwoJCQkJfQoJCQl9OwoKCQkJLy8gc3RhbmRhcmQgR2VvbWV0cnkgc2VyaWFsaXphdGlvbgoKCQkJZGF0YS51dWlkID0gdGhpcy51dWlkOwoJCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKCgkJCWlmICggdGhpcy5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdmFyIHBhcmFtZXRlcnMgPSB0aGlzLnBhcmFtZXRlcnM7CgoJCQkJZm9yICggdmFyIGtleSBpbiBwYXJhbWV0ZXJzICkgewoKCQkJCQlpZiAoIHBhcmFtZXRlcnNbIGtleSBdICE9PSB1bmRlZmluZWQgKSBkYXRhWyBrZXkgXSA9IHBhcmFtZXRlcnNbIGtleSBdOwoKCQkJCX0KCgkJCQlyZXR1cm4gZGF0YTsKCgkJCX0KCgkJCXZhciB2ZXJ0aWNlcyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgdGhpcy52ZXJ0aWNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIHZlcnRleCA9IHRoaXMudmVydGljZXNbIGkgXTsKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCX0KCgkJCXZhciBmYWNlcyA9IFtdOwoJCQl2YXIgbm9ybWFscyA9IFtdOwoJCQl2YXIgbm9ybWFsc0hhc2ggPSB7fTsKCQkJdmFyIGNvbG9ycyA9IFtdOwoJCQl2YXIgY29sb3JzSGFzaCA9IHt9OwoJCQl2YXIgdXZzID0gW107CgkJCXZhciB1dnNIYXNoID0ge307CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl2YXIgZmFjZSA9IHRoaXMuZmFjZXNbIGkgXTsKCgkJCQl2YXIgaGFzTWF0ZXJpYWwgPSB0cnVlOwoJCQkJdmFyIGhhc0ZhY2VVdiA9IGZhbHNlOyAvLyBkZXByZWNhdGVkCgkJCQl2YXIgaGFzRmFjZVZlcnRleFV2ID0gdGhpcy5mYWNlVmVydGV4VXZzWyAwIF1bIGkgXSAhPT0gdW5kZWZpbmVkOwoJCQkJdmFyIGhhc0ZhY2VOb3JtYWwgPSBmYWNlLm5vcm1hbC5sZW5ndGgoKSA+IDA7CgkJCQl2YXIgaGFzRmFjZVZlcnRleE5vcm1hbCA9IGZhY2UudmVydGV4Tm9ybWFscy5sZW5ndGggPiAwOwoJCQkJdmFyIGhhc0ZhY2VDb2xvciA9IGZhY2UuY29sb3IuciAhPT0gMSB8fCBmYWNlLmNvbG9yLmcgIT09IDEgfHwgZmFjZS5jb2xvci5iICE9PSAxOwoJCQkJdmFyIGhhc0ZhY2VWZXJ0ZXhDb2xvciA9IGZhY2UudmVydGV4Q29sb3JzLmxlbmd0aCA+IDA7CgoJCQkJdmFyIGZhY2VUeXBlID0gMDsKCgkJCQlmYWNlVHlwZSA9IHNldEJpdCggZmFjZVR5cGUsIDAsIDAgKTsgLy8gaXNRdWFkCgkJCQlmYWNlVHlwZSA9IHNldEJpdCggZmFjZVR5cGUsIDEsIGhhc01hdGVyaWFsICk7CgkJCQlmYWNlVHlwZSA9IHNldEJpdCggZmFjZVR5cGUsIDIsIGhhc0ZhY2VVdiApOwoJCQkJZmFjZVR5cGUgPSBzZXRCaXQoIGZhY2VUeXBlLCAzLCBoYXNGYWNlVmVydGV4VXYgKTsKCQkJCWZhY2VUeXBlID0gc2V0Qml0KCBmYWNlVHlwZSwgNCwgaGFzRmFjZU5vcm1hbCApOwoJCQkJZmFjZVR5cGUgPSBzZXRCaXQoIGZhY2VUeXBlLCA1LCBoYXNGYWNlVmVydGV4Tm9ybWFsICk7CgkJCQlmYWNlVHlwZSA9IHNldEJpdCggZmFjZVR5cGUsIDYsIGhhc0ZhY2VDb2xvciApOwoJCQkJZmFjZVR5cGUgPSBzZXRCaXQoIGZhY2VUeXBlLCA3LCBoYXNGYWNlVmVydGV4Q29sb3IgKTsKCgkJCQlmYWNlcy5wdXNoKCBmYWNlVHlwZSApOwoJCQkJZmFjZXMucHVzaCggZmFjZS5hLCBmYWNlLmIsIGZhY2UuYyApOwoJCQkJZmFjZXMucHVzaCggZmFjZS5tYXRlcmlhbEluZGV4ICk7CgoJCQkJaWYgKCBoYXNGYWNlVmVydGV4VXYgKSB7CgoJCQkJCXZhciBmYWNlVmVydGV4VXZzID0gdGhpcy5mYWNlVmVydGV4VXZzWyAwIF1bIGkgXTsKCgkJCQkJZmFjZXMucHVzaCgKCQkJCQkJZ2V0VXZJbmRleCggZmFjZVZlcnRleFV2c1sgMCBdICksCgkJCQkJCWdldFV2SW5kZXgoIGZhY2VWZXJ0ZXhVdnNbIDEgXSApLAoJCQkJCQlnZXRVdkluZGV4KCBmYWNlVmVydGV4VXZzWyAyIF0gKQoJCQkJCSk7CgoJCQkJfQoKCQkJCWlmICggaGFzRmFjZU5vcm1hbCApIHsKCgkJCQkJZmFjZXMucHVzaCggZ2V0Tm9ybWFsSW5kZXgoIGZhY2Uubm9ybWFsICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBoYXNGYWNlVmVydGV4Tm9ybWFsICkgewoKCQkJCQl2YXIgdmVydGV4Tm9ybWFscyA9IGZhY2UudmVydGV4Tm9ybWFsczsKCgkJCQkJZmFjZXMucHVzaCgKCQkJCQkJZ2V0Tm9ybWFsSW5kZXgoIHZlcnRleE5vcm1hbHNbIDAgXSApLAoJCQkJCQlnZXROb3JtYWxJbmRleCggdmVydGV4Tm9ybWFsc1sgMSBdICksCgkJCQkJCWdldE5vcm1hbEluZGV4KCB2ZXJ0ZXhOb3JtYWxzWyAyIF0gKQoJCQkJCSk7CgoJCQkJfQoKCQkJCWlmICggaGFzRmFjZUNvbG9yICkgewoKCQkJCQlmYWNlcy5wdXNoKCBnZXRDb2xvckluZGV4KCBmYWNlLmNvbG9yICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBoYXNGYWNlVmVydGV4Q29sb3IgKSB7CgoJCQkJCXZhciB2ZXJ0ZXhDb2xvcnMgPSBmYWNlLnZlcnRleENvbG9yczsKCgkJCQkJZmFjZXMucHVzaCgKCQkJCQkJZ2V0Q29sb3JJbmRleCggdmVydGV4Q29sb3JzWyAwIF0gKSwKCQkJCQkJZ2V0Q29sb3JJbmRleCggdmVydGV4Q29sb3JzWyAxIF0gKSwKCQkJCQkJZ2V0Q29sb3JJbmRleCggdmVydGV4Q29sb3JzWyAyIF0gKQoJCQkJCSk7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gc2V0Qml0KCB2YWx1ZSwgcG9zaXRpb24sIGVuYWJsZWQgKSB7CgoJCQkJcmV0dXJuIGVuYWJsZWQgPyB2YWx1ZSB8ICggMSA8PCBwb3NpdGlvbiApIDogdmFsdWUgJiAoIH4gKCAxIDw8IHBvc2l0aW9uICkgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGdldE5vcm1hbEluZGV4KCBub3JtYWwgKSB7CgoJCQkJdmFyIGhhc2ggPSBub3JtYWwueC50b1N0cmluZygpICsgbm9ybWFsLnkudG9TdHJpbmcoKSArIG5vcm1hbC56LnRvU3RyaW5nKCk7CgoJCQkJaWYgKCBub3JtYWxzSGFzaFsgaGFzaCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiBub3JtYWxzSGFzaFsgaGFzaCBdOwoKCQkJCX0KCgkJCQlub3JtYWxzSGFzaFsgaGFzaCBdID0gbm9ybWFscy5sZW5ndGggLyAzOwoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJcmV0dXJuIG5vcm1hbHNIYXNoWyBoYXNoIF07CgoJCQl9CgoJCQlmdW5jdGlvbiBnZXRDb2xvckluZGV4KCBjb2xvciApIHsKCgkJCQl2YXIgaGFzaCA9IGNvbG9yLnIudG9TdHJpbmcoKSArIGNvbG9yLmcudG9TdHJpbmcoKSArIGNvbG9yLmIudG9TdHJpbmcoKTsKCgkJCQlpZiAoIGNvbG9yc0hhc2hbIGhhc2ggXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlyZXR1cm4gY29sb3JzSGFzaFsgaGFzaCBdOwoKCQkJCX0KCgkJCQljb2xvcnNIYXNoWyBoYXNoIF0gPSBjb2xvcnMubGVuZ3RoOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yLmdldEhleCgpICk7CgoJCQkJcmV0dXJuIGNvbG9yc0hhc2hbIGhhc2ggXTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGdldFV2SW5kZXgoIHV2ICkgewoKCQkJCXZhciBoYXNoID0gdXYueC50b1N0cmluZygpICsgdXYueS50b1N0cmluZygpOwoKCQkJCWlmICggdXZzSGFzaFsgaGFzaCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiB1dnNIYXNoWyBoYXNoIF07CgoJCQkJfQoKCQkJCXV2c0hhc2hbIGhhc2ggXSA9IHV2cy5sZW5ndGggLyAyOwoJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQlyZXR1cm4gdXZzSGFzaFsgaGFzaCBdOwoKCQkJfQoKCQkJZGF0YS5kYXRhID0ge307CgoJCQlkYXRhLmRhdGEudmVydGljZXMgPSB2ZXJ0aWNlczsKCQkJZGF0YS5kYXRhLm5vcm1hbHMgPSBub3JtYWxzOwoJCQlpZiAoIGNvbG9ycy5sZW5ndGggPiAwICkgZGF0YS5kYXRhLmNvbG9ycyA9IGNvbG9yczsKCQkJaWYgKCB1dnMubGVuZ3RoID4gMCApIGRhdGEuZGF0YS51dnMgPSBbIHV2cyBdOyAvLyB0ZW1wb3JhbCBiYWNrd2FyZCBjb21wYXRpYmlsaXR5CgkJCWRhdGEuZGF0YS5mYWNlcyA9IGZhY2VzOwoKCQkJcmV0dXJuIGRhdGE7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQkvKgoJCQkgLy8gSGFuZGxlIHByaW1pdGl2ZXMKCgkJCSB2YXIgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCgkJCSBpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCSB2YXIgdmFsdWVzID0gW107CgoJCQkgZm9yICggdmFyIGtleSBpbiBwYXJhbWV0ZXJzICkgewoKCQkJIHZhbHVlcy5wdXNoKCBwYXJhbWV0ZXJzWyBrZXkgXSApOwoKCQkJIH0KCgkJCSB2YXIgZ2VvbWV0cnkgPSBPYmplY3QuY3JlYXRlKCB0aGlzLmNvbnN0cnVjdG9yLnByb3RvdHlwZSApOwoJCQkgdGhpcy5jb25zdHJ1Y3Rvci5hcHBseSggZ2VvbWV0cnksIHZhbHVlcyApOwoJCQkgcmV0dXJuIGdlb21ldHJ5OwoKCQkJIH0KCgkJCSByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgkJCSAqLwoKCQkJcmV0dXJuIG5ldyBHZW9tZXRyeSgpLmNvcHkoIHRoaXMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQl2YXIgaSwgaWwsIGosIGpsLCBrLCBrbDsKCgkJCS8vIHJlc2V0CgoJCQl0aGlzLnZlcnRpY2VzID0gW107CgkJCXRoaXMuY29sb3JzID0gW107CgkJCXRoaXMuZmFjZXMgPSBbXTsKCQkJdGhpcy5mYWNlVmVydGV4VXZzID0gW1tdXTsKCQkJdGhpcy5tb3JwaFRhcmdldHMgPSBbXTsKCQkJdGhpcy5tb3JwaE5vcm1hbHMgPSBbXTsKCQkJdGhpcy5za2luV2VpZ2h0cyA9IFtdOwoJCQl0aGlzLnNraW5JbmRpY2VzID0gW107CgkJCXRoaXMubGluZURpc3RhbmNlcyA9IFtdOwoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvLyBuYW1lCgoJCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJCS8vIHZlcnRpY2VzCgoJCQl2YXIgdmVydGljZXMgPSBzb3VyY2UudmVydGljZXM7CgoJCQlmb3IgKCBpID0gMCwgaWwgPSB2ZXJ0aWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLnZlcnRpY2VzLnB1c2goIHZlcnRpY2VzWyBpIF0uY2xvbmUoKSApOwoKCQkJfQoKCQkJLy8gY29sb3JzCgoJCQl2YXIgY29sb3JzID0gc291cmNlLmNvbG9yczsKCgkJCWZvciAoIGkgPSAwLCBpbCA9IGNvbG9ycy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLmNvbG9ycy5wdXNoKCBjb2xvcnNbIGkgXS5jbG9uZSgpICk7CgoJCQl9CgoJCQkvLyBmYWNlcwoKCQkJdmFyIGZhY2VzID0gc291cmNlLmZhY2VzOwoKCQkJZm9yICggaSA9IDAsIGlsID0gZmFjZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy5mYWNlcy5wdXNoKCBmYWNlc1sgaSBdLmNsb25lKCkgKTsKCgkJCX0KCgkJCS8vIGZhY2UgdmVydGV4IHV2cwoKCQkJZm9yICggaSA9IDAsIGlsID0gc291cmNlLmZhY2VWZXJ0ZXhVdnMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdmFyIGZhY2VWZXJ0ZXhVdnMgPSBzb3VyY2UuZmFjZVZlcnRleFV2c1sgaSBdOwoKCQkJCWlmICggdGhpcy5mYWNlVmVydGV4VXZzWyBpIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGhpcy5mYWNlVmVydGV4VXZzWyBpIF0gPSBbXTsKCgkJCQl9CgoJCQkJZm9yICggaiA9IDAsIGpsID0gZmFjZVZlcnRleFV2cy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJdmFyIHV2cyA9IGZhY2VWZXJ0ZXhVdnNbIGogXSwgdXZzQ29weSA9IFtdOwoKCQkJCQlmb3IgKCBrID0gMCwga2wgPSB1dnMubGVuZ3RoOyBrIDwga2w7IGsgKysgKSB7CgoJCQkJCQl2YXIgdXYgPSB1dnNbIGsgXTsKCgkJCQkJCXV2c0NvcHkucHVzaCggdXYuY2xvbmUoKSApOwoKCQkJCQl9CgoJCQkJCXRoaXMuZmFjZVZlcnRleFV2c1sgaSBdLnB1c2goIHV2c0NvcHkgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBtb3JwaCB0YXJnZXRzCgoJCQl2YXIgbW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKCgkJCWZvciAoIGkgPSAwLCBpbCA9IG1vcnBoVGFyZ2V0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgbW9ycGhUYXJnZXQgPSB7fTsKCQkJCW1vcnBoVGFyZ2V0Lm5hbWUgPSBtb3JwaFRhcmdldHNbIGkgXS5uYW1lOwoKCQkJCS8vIHZlcnRpY2VzCgoJCQkJaWYgKCBtb3JwaFRhcmdldHNbIGkgXS52ZXJ0aWNlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQltb3JwaFRhcmdldC52ZXJ0aWNlcyA9IFtdOwoKCQkJCQlmb3IgKCBqID0gMCwgamwgPSBtb3JwaFRhcmdldHNbIGkgXS52ZXJ0aWNlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCW1vcnBoVGFyZ2V0LnZlcnRpY2VzLnB1c2goIG1vcnBoVGFyZ2V0c1sgaSBdLnZlcnRpY2VzWyBqIF0uY2xvbmUoKSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIG5vcm1hbHMKCgkJCQlpZiAoIG1vcnBoVGFyZ2V0c1sgaSBdLm5vcm1hbHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbW9ycGhUYXJnZXQubm9ybWFscyA9IFtdOwoKCQkJCQlmb3IgKCBqID0gMCwgamwgPSBtb3JwaFRhcmdldHNbIGkgXS5ub3JtYWxzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJbW9ycGhUYXJnZXQubm9ybWFscy5wdXNoKCBtb3JwaFRhcmdldHNbIGkgXS5ub3JtYWxzWyBqIF0uY2xvbmUoKSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRoaXMubW9ycGhUYXJnZXRzLnB1c2goIG1vcnBoVGFyZ2V0ICk7CgoJCQl9CgoJCQkvLyBtb3JwaCBub3JtYWxzCgoJCQl2YXIgbW9ycGhOb3JtYWxzID0gc291cmNlLm1vcnBoTm9ybWFsczsKCgkJCWZvciAoIGkgPSAwLCBpbCA9IG1vcnBoTm9ybWFscy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgbW9ycGhOb3JtYWwgPSB7fTsKCgkJCQkvLyB2ZXJ0ZXggbm9ybWFscwoKCQkJCWlmICggbW9ycGhOb3JtYWxzWyBpIF0udmVydGV4Tm9ybWFscyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQltb3JwaE5vcm1hbC52ZXJ0ZXhOb3JtYWxzID0gW107CgoJCQkJCWZvciAoIGogPSAwLCBqbCA9IG1vcnBoTm9ybWFsc1sgaSBdLnZlcnRleE5vcm1hbHMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCQl2YXIgc3JjVmVydGV4Tm9ybWFsID0gbW9ycGhOb3JtYWxzWyBpIF0udmVydGV4Tm9ybWFsc1sgaiBdOwoJCQkJCQl2YXIgZGVzdFZlcnRleE5vcm1hbCA9IHt9OwoKCQkJCQkJZGVzdFZlcnRleE5vcm1hbC5hID0gc3JjVmVydGV4Tm9ybWFsLmEuY2xvbmUoKTsKCQkJCQkJZGVzdFZlcnRleE5vcm1hbC5iID0gc3JjVmVydGV4Tm9ybWFsLmIuY2xvbmUoKTsKCQkJCQkJZGVzdFZlcnRleE5vcm1hbC5jID0gc3JjVmVydGV4Tm9ybWFsLmMuY2xvbmUoKTsKCgkJCQkJCW1vcnBoTm9ybWFsLnZlcnRleE5vcm1hbHMucHVzaCggZGVzdFZlcnRleE5vcm1hbCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGZhY2Ugbm9ybWFscwoKCQkJCWlmICggbW9ycGhOb3JtYWxzWyBpIF0uZmFjZU5vcm1hbHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbW9ycGhOb3JtYWwuZmFjZU5vcm1hbHMgPSBbXTsKCgkJCQkJZm9yICggaiA9IDAsIGpsID0gbW9ycGhOb3JtYWxzWyBpIF0uZmFjZU5vcm1hbHMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCQltb3JwaE5vcm1hbC5mYWNlTm9ybWFscy5wdXNoKCBtb3JwaE5vcm1hbHNbIGkgXS5mYWNlTm9ybWFsc1sgaiBdLmNsb25lKCkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoTm9ybWFscy5wdXNoKCBtb3JwaE5vcm1hbCApOwoKCQkJfQoKCQkJLy8gc2tpbiB3ZWlnaHRzCgoJCQl2YXIgc2tpbldlaWdodHMgPSBzb3VyY2Uuc2tpbldlaWdodHM7CgoJCQlmb3IgKCBpID0gMCwgaWwgPSBza2luV2VpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLnNraW5XZWlnaHRzLnB1c2goIHNraW5XZWlnaHRzWyBpIF0uY2xvbmUoKSApOwoKCQkJfQoKCQkJLy8gc2tpbiBpbmRpY2VzCgoJCQl2YXIgc2tpbkluZGljZXMgPSBzb3VyY2Uuc2tpbkluZGljZXM7CgoJCQlmb3IgKCBpID0gMCwgaWwgPSBza2luSW5kaWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLnNraW5JbmRpY2VzLnB1c2goIHNraW5JbmRpY2VzWyBpIF0uY2xvbmUoKSApOwoKCQkJfQoKCQkJLy8gbGluZSBkaXN0YW5jZXMKCgkJCXZhciBsaW5lRGlzdGFuY2VzID0gc291cmNlLmxpbmVEaXN0YW5jZXM7CgoJCQlmb3IgKCBpID0gMCwgaWwgPSBsaW5lRGlzdGFuY2VzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRoaXMubGluZURpc3RhbmNlcy5wdXNoKCBsaW5lRGlzdGFuY2VzWyBpIF0gKTsKCgkJCX0KCgkJCS8vIGJvdW5kaW5nIGJveAoKCQkJdmFyIGJvdW5kaW5nQm94ID0gc291cmNlLmJvdW5kaW5nQm94OwoKCQkJaWYgKCBib3VuZGluZ0JveCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nQm94ID0gYm91bmRpbmdCb3guY2xvbmUoKTsKCgkJCX0KCgkJCS8vIGJvdW5kaW5nIHNwaGVyZQoKCQkJdmFyIGJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJCX0KCgkJCS8vIHVwZGF0ZSBmbGFncwoKCQkJdGhpcy5lbGVtZW50c05lZWRVcGRhdGUgPSBzb3VyY2UuZWxlbWVudHNOZWVkVXBkYXRlOwoJCQl0aGlzLnZlcnRpY2VzTmVlZFVwZGF0ZSA9IHNvdXJjZS52ZXJ0aWNlc05lZWRVcGRhdGU7CgkJCXRoaXMudXZzTmVlZFVwZGF0ZSA9IHNvdXJjZS51dnNOZWVkVXBkYXRlOwoJCQl0aGlzLm5vcm1hbHNOZWVkVXBkYXRlID0gc291cmNlLm5vcm1hbHNOZWVkVXBkYXRlOwoJCQl0aGlzLmNvbG9yc05lZWRVcGRhdGUgPSBzb3VyY2UuY29sb3JzTmVlZFVwZGF0ZTsKCQkJdGhpcy5saW5lRGlzdGFuY2VzTmVlZFVwZGF0ZSA9IHNvdXJjZS5saW5lRGlzdGFuY2VzTmVlZFVwZGF0ZTsKCQkJdGhpcy5ncm91cHNOZWVkVXBkYXRlID0gc291cmNlLmdyb3Vwc05lZWRVcGRhdGU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZGlzcG9zZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gQnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCWlmICggQXJyYXkuaXNBcnJheSggYXJyYXkgKSApIHsKCgkJCXRocm93IG5ldyBUeXBlRXJyb3IoICdUSFJFRS5CdWZmZXJBdHRyaWJ1dGU6IGFycmF5IHNob3VsZCBiZSBhIFR5cGVkIEFycmF5LicgKTsKCgkJfQoKCQl0aGlzLm5hbWUgPSAnJzsKCgkJdGhpcy5hcnJheSA9IGFycmF5OwoJCXRoaXMuaXRlbVNpemUgPSBpdGVtU2l6ZTsKCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIGl0ZW1TaXplIDogMDsKCQl0aGlzLm5vcm1hbGl6ZWQgPSBub3JtYWxpemVkID09PSB0cnVlOwoKCQl0aGlzLmR5bmFtaWMgPSBmYWxzZTsKCQl0aGlzLnVwZGF0ZVJhbmdlID0geyBvZmZzZXQ6IDAsIGNvdW50OiAtIDEgfTsKCgkJdGhpcy52ZXJzaW9uID0gMDsKCgl9CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlLCAnbmVlZHNVcGRhdGUnLCB7CgoJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSwgewoKCQlpc0J1ZmZlckF0dHJpYnV0ZTogdHJ1ZSwKCgkJb25VcGxvYWRDYWxsYmFjazogZnVuY3Rpb24gKCkge30sCgoJCXNldEFycmF5OiBmdW5jdGlvbiAoIGFycmF5ICkgewoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBhcnJheSApICkgewoKCQkJCXRocm93IG5ldyBUeXBlRXJyb3IoICdUSFJFRS5CdWZmZXJBdHRyaWJ1dGU6IGFycmF5IHNob3VsZCBiZSBhIFR5cGVkIEFycmF5LicgKTsKCgkJCX0KCgkJCXRoaXMuY291bnQgPSBhcnJheSAhPT0gdW5kZWZpbmVkID8gYXJyYXkubGVuZ3RoIC8gdGhpcy5pdGVtU2l6ZSA6IDA7CgkJCXRoaXMuYXJyYXkgPSBhcnJheTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXREeW5hbWljOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5keW5hbWljID0gdmFsdWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCQkJdGhpcy5hcnJheSA9IG5ldyBzb3VyY2UuYXJyYXkuY29uc3RydWN0b3IoIHNvdXJjZS5hcnJheSApOwoJCQl0aGlzLml0ZW1TaXplID0gc291cmNlLml0ZW1TaXplOwoJCQl0aGlzLmNvdW50ID0gc291cmNlLmNvdW50OwoJCQl0aGlzLm5vcm1hbGl6ZWQgPSBzb3VyY2Uubm9ybWFsaXplZDsKCgkJCXRoaXMuZHluYW1pYyA9IHNvdXJjZS5keW5hbWljOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvcHlBdDogZnVuY3Rpb24gKCBpbmRleDEsIGF0dHJpYnV0ZSwgaW5kZXgyICkgewoKCQkJaW5kZXgxICo9IHRoaXMuaXRlbVNpemU7CgkJCWluZGV4MiAqPSBhdHRyaWJ1dGUuaXRlbVNpemU7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLml0ZW1TaXplOyBpIDwgbDsgaSArKyApIHsKCgkJCQl0aGlzLmFycmF5WyBpbmRleDEgKyBpIF0gPSBhdHRyaWJ1dGUuYXJyYXlbIGluZGV4MiArIGkgXTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljb3B5QXJyYXk6IGZ1bmN0aW9uICggYXJyYXkgKSB7CgoJCQl0aGlzLmFycmF5LnNldCggYXJyYXkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljb3B5Q29sb3JzQXJyYXk6IGZ1bmN0aW9uICggY29sb3JzICkgewoKCQkJdmFyIGFycmF5ID0gdGhpcy5hcnJheSwgb2Zmc2V0ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNvbG9ycy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBjb2xvciA9IGNvbG9yc1sgaSBdOwoKCQkJCWlmICggY29sb3IgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlLmNvcHlDb2xvcnNBcnJheSgpOiBjb2xvciBpcyB1bmRlZmluZWQnLCBpICk7CgkJCQkJY29sb3IgPSBuZXcgQ29sb3IoKTsKCgkJCQl9CgoJCQkJYXJyYXlbIG9mZnNldCArKyBdID0gY29sb3IucjsKCQkJCWFycmF5WyBvZmZzZXQgKysgXSA9IGNvbG9yLmc7CgkJCQlhcnJheVsgb2Zmc2V0ICsrIF0gPSBjb2xvci5iOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvcHlWZWN0b3Iyc0FycmF5OiBmdW5jdGlvbiAoIHZlY3RvcnMgKSB7CgoJCQl2YXIgYXJyYXkgPSB0aGlzLmFycmF5LCBvZmZzZXQgPSAwOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gdmVjdG9ycy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciB2ZWN0b3IgPSB2ZWN0b3JzWyBpIF07CgoJCQkJaWYgKCB2ZWN0b3IgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlLmNvcHlWZWN0b3Iyc0FycmF5KCk6IHZlY3RvciBpcyB1bmRlZmluZWQnLCBpICk7CgkJCQkJdmVjdG9yID0gbmV3IFZlY3RvcjIoKTsKCgkJCQl9CgoJCQkJYXJyYXlbIG9mZnNldCArKyBdID0gdmVjdG9yLng7CgkJCQlhcnJheVsgb2Zmc2V0ICsrIF0gPSB2ZWN0b3IueTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljb3B5VmVjdG9yM3NBcnJheTogZnVuY3Rpb24gKCB2ZWN0b3JzICkgewoKCQkJdmFyIGFycmF5ID0gdGhpcy5hcnJheSwgb2Zmc2V0ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IHZlY3RvcnMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgdmVjdG9yID0gdmVjdG9yc1sgaSBdOwoKCQkJCWlmICggdmVjdG9yID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckF0dHJpYnV0ZS5jb3B5VmVjdG9yM3NBcnJheSgpOiB2ZWN0b3IgaXMgdW5kZWZpbmVkJywgaSApOwoJCQkJCXZlY3RvciA9IG5ldyBWZWN0b3IzKCk7CgoJCQkJfQoKCQkJCWFycmF5WyBvZmZzZXQgKysgXSA9IHZlY3Rvci54OwoJCQkJYXJyYXlbIG9mZnNldCArKyBdID0gdmVjdG9yLnk7CgkJCQlhcnJheVsgb2Zmc2V0ICsrIF0gPSB2ZWN0b3IuejsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljb3B5VmVjdG9yNHNBcnJheTogZnVuY3Rpb24gKCB2ZWN0b3JzICkgewoKCQkJdmFyIGFycmF5ID0gdGhpcy5hcnJheSwgb2Zmc2V0ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IHZlY3RvcnMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgdmVjdG9yID0gdmVjdG9yc1sgaSBdOwoKCQkJCWlmICggdmVjdG9yID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckF0dHJpYnV0ZS5jb3B5VmVjdG9yNHNBcnJheSgpOiB2ZWN0b3IgaXMgdW5kZWZpbmVkJywgaSApOwoJCQkJCXZlY3RvciA9IG5ldyBWZWN0b3I0KCk7CgoJCQkJfQoKCQkJCWFycmF5WyBvZmZzZXQgKysgXSA9IHZlY3Rvci54OwoJCQkJYXJyYXlbIG9mZnNldCArKyBdID0gdmVjdG9yLnk7CgkJCQlhcnJheVsgb2Zmc2V0ICsrIF0gPSB2ZWN0b3IuejsKCQkJCWFycmF5WyBvZmZzZXQgKysgXSA9IHZlY3Rvci53OwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSwgb2Zmc2V0ICkgewoKCQkJaWYgKCBvZmZzZXQgPT09IHVuZGVmaW5lZCApIG9mZnNldCA9IDA7CgoJCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldFg6IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF07CgoJCX0sCgoJCXNldFg6IGZ1bmN0aW9uICggaW5kZXgsIHggKSB7CgoJCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXSA9IHg7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0WTogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCXJldHVybiB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF07CgoJCX0sCgoJCXNldFk6IGZ1bmN0aW9uICggaW5kZXgsIHkgKSB7CgoJCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF0gPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldFo6IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdOwoKCQl9LAoKCQlzZXRaOiBmdW5jdGlvbiAoIGluZGV4LCB6ICkgewoKCQkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlnZXRXOiBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJcmV0dXJuIHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDMgXTsKCgkJfSwKCgkJc2V0VzogZnVuY3Rpb24gKCBpbmRleCwgdyApIHsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDMgXSA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WFk6IGZ1bmN0aW9uICggaW5kZXgsIHgsIHkgKSB7CgoJCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WFlaOiBmdW5jdGlvbiAoIGluZGV4LCB4LCB5LCB6ICkgewoKCQkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WFlaVzogZnVuY3Rpb24gKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCgkJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgoJCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDMgXSA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJb25VcGxvYWQ6IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLm9uVXBsb2FkQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLmFycmF5LCB0aGlzLml0ZW1TaXplICkuY29weSggdGhpcyApOwoKCQl9CgoJfSApOwoKCS8vCgoJZnVuY3Rpb24gSW50OEJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlCdWZmZXJBdHRyaWJ1dGUuY2FsbCggdGhpcywgbmV3IEludDhBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9CgoJSW50OEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlICk7CglJbnQ4QnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEludDhCdWZmZXJBdHRyaWJ1dGU7CgoKCWZ1bmN0aW9uIFVpbnQ4QnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCUJ1ZmZlckF0dHJpYnV0ZS5jYWxsKCB0aGlzLCBuZXcgVWludDhBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9CgoJVWludDhCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSApOwoJVWludDhCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVWludDhCdWZmZXJBdHRyaWJ1dGU7CgoKCWZ1bmN0aW9uIFVpbnQ4Q2xhbXBlZEJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlCdWZmZXJBdHRyaWJ1dGUuY2FsbCggdGhpcywgbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCglVaW50OENsYW1wZWRCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSApOwoJVWludDhDbGFtcGVkQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFVpbnQ4Q2xhbXBlZEJ1ZmZlckF0dHJpYnV0ZTsKCgoJZnVuY3Rpb24gSW50MTZCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJQnVmZmVyQXR0cmlidXRlLmNhbGwoIHRoaXMsIG5ldyBJbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCglJbnQxNkJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlICk7CglJbnQxNkJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBJbnQxNkJ1ZmZlckF0dHJpYnV0ZTsKCgoJZnVuY3Rpb24gVWludDE2QnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCUJ1ZmZlckF0dHJpYnV0ZS5jYWxsKCB0aGlzLCBuZXcgVWludDE2QXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKCVVpbnQxNkJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlICk7CglVaW50MTZCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVWludDE2QnVmZmVyQXR0cmlidXRlOwoKCglmdW5jdGlvbiBJbnQzMkJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlCdWZmZXJBdHRyaWJ1dGUuY2FsbCggdGhpcywgbmV3IEludDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKCUludDMyQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgKTsKCUludDMyQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEludDMyQnVmZmVyQXR0cmlidXRlOwoKCglmdW5jdGlvbiBVaW50MzJCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJQnVmZmVyQXR0cmlidXRlLmNhbGwoIHRoaXMsIG5ldyBVaW50MzJBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9CgoJVWludDMyQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgKTsKCVVpbnQzMkJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBVaW50MzJCdWZmZXJBdHRyaWJ1dGU7CgoKCWZ1bmN0aW9uIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJQnVmZmVyQXR0cmlidXRlLmNhbGwoIHRoaXMsIG5ldyBGbG9hdDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKCUZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSApOwoJRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBGbG9hdDMyQnVmZmVyQXR0cmlidXRlOwoKCglmdW5jdGlvbiBGbG9hdDY0QnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCUJ1ZmZlckF0dHJpYnV0ZS5jYWxsKCB0aGlzLCBuZXcgRmxvYXQ2NEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCglGbG9hdDY0QnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgKTsKCUZsb2F0NjRCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRmxvYXQ2NEJ1ZmZlckF0dHJpYnV0ZTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBEaXJlY3RHZW9tZXRyeSgpIHsKCgkJdGhpcy52ZXJ0aWNlcyA9IFtdOwoJCXRoaXMubm9ybWFscyA9IFtdOwoJCXRoaXMuY29sb3JzID0gW107CgkJdGhpcy51dnMgPSBbXTsKCQl0aGlzLnV2czIgPSBbXTsKCgkJdGhpcy5ncm91cHMgPSBbXTsKCgkJdGhpcy5tb3JwaFRhcmdldHMgPSB7fTsKCgkJdGhpcy5za2luV2VpZ2h0cyA9IFtdOwoJCXRoaXMuc2tpbkluZGljZXMgPSBbXTsKCgkJLy8gdGhpcy5saW5lRGlzdGFuY2VzID0gW107CgoJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKCQkvLyB1cGRhdGUgZmxhZ3MKCgkJdGhpcy52ZXJ0aWNlc05lZWRVcGRhdGUgPSBmYWxzZTsKCQl0aGlzLm5vcm1hbHNOZWVkVXBkYXRlID0gZmFsc2U7CgkJdGhpcy5jb2xvcnNOZWVkVXBkYXRlID0gZmFsc2U7CgkJdGhpcy51dnNOZWVkVXBkYXRlID0gZmFsc2U7CgkJdGhpcy5ncm91cHNOZWVkVXBkYXRlID0gZmFsc2U7CgoJfQoKCU9iamVjdC5hc3NpZ24oIERpcmVjdEdlb21ldHJ5LnByb3RvdHlwZSwgewoKCQljb21wdXRlR3JvdXBzOiBmdW5jdGlvbiAoIGdlb21ldHJ5ICkgewoKCQkJdmFyIGdyb3VwOwoJCQl2YXIgZ3JvdXBzID0gW107CgkJCXZhciBtYXRlcmlhbEluZGV4ID0gdW5kZWZpbmVkOwoKCQkJdmFyIGZhY2VzID0gZ2VvbWV0cnkuZmFjZXM7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBmYWNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJCS8vIG1hdGVyaWFscwoKCQkJCWlmICggZmFjZS5tYXRlcmlhbEluZGV4ICE9PSBtYXRlcmlhbEluZGV4ICkgewoKCQkJCQltYXRlcmlhbEluZGV4ID0gZmFjZS5tYXRlcmlhbEluZGV4OwoKCQkJCQlpZiAoIGdyb3VwICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlncm91cC5jb3VudCA9ICggaSAqIDMgKSAtIGdyb3VwLnN0YXJ0OwoJCQkJCQlncm91cHMucHVzaCggZ3JvdXAgKTsKCgkJCQkJfQoKCQkJCQlncm91cCA9IHsKCQkJCQkJc3RhcnQ6IGkgKiAzLAoJCQkJCQltYXRlcmlhbEluZGV4OiBtYXRlcmlhbEluZGV4CgkJCQkJfTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIGdyb3VwICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZ3JvdXAuY291bnQgPSAoIGkgKiAzICkgLSBncm91cC5zdGFydDsKCQkJCWdyb3Vwcy5wdXNoKCBncm91cCApOwoKCQkJfQoKCQkJdGhpcy5ncm91cHMgPSBncm91cHM7CgoJCX0sCgoJCWZyb21HZW9tZXRyeTogZnVuY3Rpb24gKCBnZW9tZXRyeSApIHsKCgkJCXZhciBmYWNlcyA9IGdlb21ldHJ5LmZhY2VzOwoJCQl2YXIgdmVydGljZXMgPSBnZW9tZXRyeS52ZXJ0aWNlczsKCQkJdmFyIGZhY2VWZXJ0ZXhVdnMgPSBnZW9tZXRyeS5mYWNlVmVydGV4VXZzOwoKCQkJdmFyIGhhc0ZhY2VWZXJ0ZXhVdiA9IGZhY2VWZXJ0ZXhVdnNbIDAgXSAmJiBmYWNlVmVydGV4VXZzWyAwIF0ubGVuZ3RoID4gMDsKCQkJdmFyIGhhc0ZhY2VWZXJ0ZXhVdjIgPSBmYWNlVmVydGV4VXZzWyAxIF0gJiYgZmFjZVZlcnRleFV2c1sgMSBdLmxlbmd0aCA+IDA7CgoJCQkvLyBtb3JwaHMKCgkJCXZhciBtb3JwaFRhcmdldHMgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHM7CgkJCXZhciBtb3JwaFRhcmdldHNMZW5ndGggPSBtb3JwaFRhcmdldHMubGVuZ3RoOwoKCQkJdmFyIG1vcnBoVGFyZ2V0c1Bvc2l0aW9uOwoKCQkJaWYgKCBtb3JwaFRhcmdldHNMZW5ndGggPiAwICkgewoKCQkJCW1vcnBoVGFyZ2V0c1Bvc2l0aW9uID0gW107CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgbW9ycGhUYXJnZXRzTGVuZ3RoOyBpICsrICkgewoKCQkJCQltb3JwaFRhcmdldHNQb3NpdGlvblsgaSBdID0gewoJCQkJCQluYW1lOiBtb3JwaFRhcmdldHNbIGkgXS5uYW1lLAoJCQkJCSAJZGF0YTogW10KCQkJCQl9OwoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoVGFyZ2V0cy5wb3NpdGlvbiA9IG1vcnBoVGFyZ2V0c1Bvc2l0aW9uOwoKCQkJfQoKCQkJdmFyIG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoTm9ybWFsczsKCQkJdmFyIG1vcnBoTm9ybWFsc0xlbmd0aCA9IG1vcnBoTm9ybWFscy5sZW5ndGg7CgoJCQl2YXIgbW9ycGhUYXJnZXRzTm9ybWFsOwoKCQkJaWYgKCBtb3JwaE5vcm1hbHNMZW5ndGggPiAwICkgewoKCQkJCW1vcnBoVGFyZ2V0c05vcm1hbCA9IFtdOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IG1vcnBoTm9ybWFsc0xlbmd0aDsgaSArKyApIHsKCgkJCQkJbW9ycGhUYXJnZXRzTm9ybWFsWyBpIF0gPSB7CgkJCQkJCW5hbWU6IG1vcnBoTm9ybWFsc1sgaSBdLm5hbWUsCgkJCQkJIAlkYXRhOiBbXQoJCQkJCX07CgoJCQkJfQoKCQkJCXRoaXMubW9ycGhUYXJnZXRzLm5vcm1hbCA9IG1vcnBoVGFyZ2V0c05vcm1hbDsKCgkJCX0KCgkJCS8vIHNraW5zCgoJCQl2YXIgc2tpbkluZGljZXMgPSBnZW9tZXRyeS5za2luSW5kaWNlczsKCQkJdmFyIHNraW5XZWlnaHRzID0gZ2VvbWV0cnkuc2tpbldlaWdodHM7CgoJCQl2YXIgaGFzU2tpbkluZGljZXMgPSBza2luSW5kaWNlcy5sZW5ndGggPT09IHZlcnRpY2VzLmxlbmd0aDsKCQkJdmFyIGhhc1NraW5XZWlnaHRzID0gc2tpbldlaWdodHMubGVuZ3RoID09PSB2ZXJ0aWNlcy5sZW5ndGg7CgoJCQkvLwoKCQkJaWYgKCB2ZXJ0aWNlcy5sZW5ndGggPiAwICYmIGZhY2VzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuRGlyZWN0R2VvbWV0cnk6IEZhY2VsZXNzIGdlb21ldHJpZXMgYXJlIG5vdCBzdXBwb3J0ZWQuJyApOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgZmFjZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCXZhciBmYWNlID0gZmFjZXNbIGkgXTsKCgkJCQl0aGlzLnZlcnRpY2VzLnB1c2goIHZlcnRpY2VzWyBmYWNlLmEgXSwgdmVydGljZXNbIGZhY2UuYiBdLCB2ZXJ0aWNlc1sgZmFjZS5jIF0gKTsKCgkJCQl2YXIgdmVydGV4Tm9ybWFscyA9IGZhY2UudmVydGV4Tm9ybWFsczsKCgkJCQlpZiAoIHZlcnRleE5vcm1hbHMubGVuZ3RoID09PSAzICkgewoKCQkJCQl0aGlzLm5vcm1hbHMucHVzaCggdmVydGV4Tm9ybWFsc1sgMCBdLCB2ZXJ0ZXhOb3JtYWxzWyAxIF0sIHZlcnRleE5vcm1hbHNbIDIgXSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXZhciBub3JtYWwgPSBmYWNlLm5vcm1hbDsKCgkJCQkJdGhpcy5ub3JtYWxzLnB1c2goIG5vcm1hbCwgbm9ybWFsLCBub3JtYWwgKTsKCgkJCQl9CgoJCQkJdmFyIHZlcnRleENvbG9ycyA9IGZhY2UudmVydGV4Q29sb3JzOwoKCQkJCWlmICggdmVydGV4Q29sb3JzLmxlbmd0aCA9PT0gMyApIHsKCgkJCQkJdGhpcy5jb2xvcnMucHVzaCggdmVydGV4Q29sb3JzWyAwIF0sIHZlcnRleENvbG9yc1sgMSBdLCB2ZXJ0ZXhDb2xvcnNbIDIgXSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXZhciBjb2xvciA9IGZhY2UuY29sb3I7CgoJCQkJCXRoaXMuY29sb3JzLnB1c2goIGNvbG9yLCBjb2xvciwgY29sb3IgKTsKCgkJCQl9CgoJCQkJaWYgKCBoYXNGYWNlVmVydGV4VXYgPT09IHRydWUgKSB7CgoJCQkJCXZhciB2ZXJ0ZXhVdnMgPSBmYWNlVmVydGV4VXZzWyAwIF1bIGkgXTsKCgkJCQkJaWYgKCB2ZXJ0ZXhVdnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXRoaXMudXZzLnB1c2goIHZlcnRleFV2c1sgMCBdLCB2ZXJ0ZXhVdnNbIDEgXSwgdmVydGV4VXZzWyAyIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkRpcmVjdEdlb21ldHJ5LmZyb21HZW9tZXRyeSgpOiBVbmRlZmluZWQgdmVydGV4VXYgJywgaSApOwoKCQkJCQkJdGhpcy51dnMucHVzaCggbmV3IFZlY3RvcjIoKSwgbmV3IFZlY3RvcjIoKSwgbmV3IFZlY3RvcjIoKSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggaGFzRmFjZVZlcnRleFV2MiA9PT0gdHJ1ZSApIHsKCgkJCQkJdmFyIHZlcnRleFV2cyA9IGZhY2VWZXJ0ZXhVdnNbIDEgXVsgaSBdOwoKCQkJCQlpZiAoIHZlcnRleFV2cyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJdGhpcy51dnMyLnB1c2goIHZlcnRleFV2c1sgMCBdLCB2ZXJ0ZXhVdnNbIDEgXSwgdmVydGV4VXZzWyAyIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkRpcmVjdEdlb21ldHJ5LmZyb21HZW9tZXRyeSgpOiBVbmRlZmluZWQgdmVydGV4VXYyICcsIGkgKTsKCgkJCQkJCXRoaXMudXZzMi5wdXNoKCBuZXcgVmVjdG9yMigpLCBuZXcgVmVjdG9yMigpLCBuZXcgVmVjdG9yMigpICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gbW9ycGhzCgoJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgbW9ycGhUYXJnZXRzTGVuZ3RoOyBqICsrICkgewoKCQkJCQl2YXIgbW9ycGhUYXJnZXQgPSBtb3JwaFRhcmdldHNbIGogXS52ZXJ0aWNlczsKCgkJCQkJbW9ycGhUYXJnZXRzUG9zaXRpb25bIGogXS5kYXRhLnB1c2goIG1vcnBoVGFyZ2V0WyBmYWNlLmEgXSwgbW9ycGhUYXJnZXRbIGZhY2UuYiBdLCBtb3JwaFRhcmdldFsgZmFjZS5jIF0gKTsKCgkJCQl9CgoJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgbW9ycGhOb3JtYWxzTGVuZ3RoOyBqICsrICkgewoKCQkJCQl2YXIgbW9ycGhOb3JtYWwgPSBtb3JwaE5vcm1hbHNbIGogXS52ZXJ0ZXhOb3JtYWxzWyBpIF07CgoJCQkJCW1vcnBoVGFyZ2V0c05vcm1hbFsgaiBdLmRhdGEucHVzaCggbW9ycGhOb3JtYWwuYSwgbW9ycGhOb3JtYWwuYiwgbW9ycGhOb3JtYWwuYyApOwoKCQkJCX0KCgkJCQkvLyBza2lucwoKCQkJCWlmICggaGFzU2tpbkluZGljZXMgKSB7CgoJCQkJCXRoaXMuc2tpbkluZGljZXMucHVzaCggc2tpbkluZGljZXNbIGZhY2UuYSBdLCBza2luSW5kaWNlc1sgZmFjZS5iIF0sIHNraW5JbmRpY2VzWyBmYWNlLmMgXSApOwoKCQkJCX0KCgkJCQlpZiAoIGhhc1NraW5XZWlnaHRzICkgewoKCQkJCQl0aGlzLnNraW5XZWlnaHRzLnB1c2goIHNraW5XZWlnaHRzWyBmYWNlLmEgXSwgc2tpbldlaWdodHNbIGZhY2UuYiBdLCBza2luV2VpZ2h0c1sgZmFjZS5jIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLmNvbXB1dGVHcm91cHMoIGdlb21ldHJ5ICk7CgoJCQl0aGlzLnZlcnRpY2VzTmVlZFVwZGF0ZSA9IGdlb21ldHJ5LnZlcnRpY2VzTmVlZFVwZGF0ZTsKCQkJdGhpcy5ub3JtYWxzTmVlZFVwZGF0ZSA9IGdlb21ldHJ5Lm5vcm1hbHNOZWVkVXBkYXRlOwoJCQl0aGlzLmNvbG9yc05lZWRVcGRhdGUgPSBnZW9tZXRyeS5jb2xvcnNOZWVkVXBkYXRlOwoJCQl0aGlzLnV2c05lZWRVcGRhdGUgPSBnZW9tZXRyeS51dnNOZWVkVXBkYXRlOwoJCQl0aGlzLmdyb3Vwc05lZWRVcGRhdGUgPSBnZW9tZXRyeS5ncm91cHNOZWVkVXBkYXRlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gYXJyYXlNYXgoIGFycmF5ICkgewoKCQlpZiAoIGFycmF5Lmxlbmd0aCA9PT0gMCApIHJldHVybiAtIEluZmluaXR5OwoKCQl2YXIgbWF4ID0gYXJyYXlbIDAgXTsKCgkJZm9yICggdmFyIGkgPSAxLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgKysgaSApIHsKCgkJCWlmICggYXJyYXlbIGkgXSA+IG1heCApIG1heCA9IGFycmF5WyBpIF07CgoJCX0KCgkJcmV0dXJuIG1heDsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCXZhciBidWZmZXJHZW9tZXRyeUlkID0gMTsgLy8gQnVmZmVyR2VvbWV0cnkgdXNlcyBvZGQgbnVtYmVycyBhcyBJZAoKCWZ1bmN0aW9uIEJ1ZmZlckdlb21ldHJ5KCkgewoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IGJ1ZmZlckdlb21ldHJ5SWQgKz0gMiB9ICk7CgoJCXRoaXMudXVpZCA9IF9NYXRoLmdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCQl0aGlzLnR5cGUgPSAnQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLmluZGV4ID0gbnVsbDsKCQl0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKCgkJdGhpcy5tb3JwaEF0dHJpYnV0ZXMgPSB7fTsKCgkJdGhpcy5ncm91cHMgPSBbXTsKCgkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CgkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCXRoaXMuZHJhd1JhbmdlID0geyBzdGFydDogMCwgY291bnQ6IEluZmluaXR5IH07CgoJCXRoaXMudXNlckRhdGEgPSB7fTsKCgl9CgoJQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBCdWZmZXJHZW9tZXRyeSwKCgkJaXNCdWZmZXJHZW9tZXRyeTogdHJ1ZSwKCgkJZ2V0SW5kZXg6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLmluZGV4OwoKCQl9LAoKCQlzZXRJbmRleDogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggaW5kZXggKSApIHsKCgkJCQl0aGlzLmluZGV4ID0gbmV3ICggYXJyYXlNYXgoIGluZGV4ICkgPiA2NTUzNSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRleCwgMSApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLmluZGV4ID0gaW5kZXg7CgoJCQl9CgoJCX0sCgoJCWFkZEF0dHJpYnV0ZTogZnVuY3Rpb24gKCBuYW1lLCBhdHRyaWJ1dGUgKSB7CgoJCQlpZiAoICEgKCBhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmlzQnVmZmVyQXR0cmlidXRlICkgJiYgISAoIGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuYWRkQXR0cmlidXRlKCkgbm93IGV4cGVjdHMgKCBuYW1lLCBhdHRyaWJ1dGUgKS4nICk7CgoJCQkJcmV0dXJuIHRoaXMuYWRkQXR0cmlidXRlKCBuYW1lLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBhcmd1bWVudHNbIDEgXSwgYXJndW1lbnRzWyAyIF0gKSApOwoKCQkJfQoKCQkJaWYgKCBuYW1lID09PSAnaW5kZXgnICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmFkZEF0dHJpYnV0ZTogVXNlIC5zZXRJbmRleCgpIGZvciBpbmRleCBhdHRyaWJ1dGUuJyApOwoJCQkJdGhpcy5zZXRJbmRleCggYXR0cmlidXRlICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQl0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXSA9IGF0dHJpYnV0ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uICggbmFtZSApIHsKCgkJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJfSwKCgkJcmVtb3ZlQXR0cmlidXRlOiBmdW5jdGlvbiAoIG5hbWUgKSB7CgoJCQlkZWxldGUgdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkR3JvdXA6IGZ1bmN0aW9uICggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ICkgewoKCQkJdGhpcy5ncm91cHMucHVzaCggewoKCQkJCXN0YXJ0OiBzdGFydCwKCQkJCWNvdW50OiBjb3VudCwKCQkJCW1hdGVyaWFsSW5kZXg6IG1hdGVyaWFsSW5kZXggIT09IHVuZGVmaW5lZCA/IG1hdGVyaWFsSW5kZXggOiAwCgoJCQl9ICk7CgoJCX0sCgoJCWNsZWFyR3JvdXBzOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmdyb3VwcyA9IFtdOwoKCQl9LAoKCQlzZXREcmF3UmFuZ2U6IGZ1bmN0aW9uICggc3RhcnQsIGNvdW50ICkgewoKCQkJdGhpcy5kcmF3UmFuZ2Uuc3RhcnQgPSBzdGFydDsKCQkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBjb3VudDsKCgkJfSwKCgkJYXBwbHlNYXRyaXg6IGZ1bmN0aW9uICggbWF0cml4ICkgewoKCQkJdmFyIHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW1hdHJpeC5hcHBseVRvQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiApOwoJCQkJcG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJfQoKCQkJdmFyIG5vcm1hbCA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgoJCQlpZiAoIG5vcm1hbCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgoJCQkJbm9ybWFsTWF0cml4LmFwcGx5VG9CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbCApOwoJCQkJbm9ybWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXZhciB0YW5nZW50ID0gdGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7CgoJCQlpZiAoIHRhbmdlbnQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgbm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKS5nZXROb3JtYWxNYXRyaXgoIG1hdHJpeCApOwoKCQkJCS8vIFRhbmdlbnQgaXMgdmVjNCwgYnV0IHRoZSAnLncnIGNvbXBvbmVudCBpcyBhIHNpZ24gdmFsdWUgKCsxLy0xKS4KCQkJCW5vcm1hbE1hdHJpeC5hcHBseVRvQnVmZmVyQXR0cmlidXRlKCB0YW5nZW50ICk7CgkJCQl0YW5nZW50Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggdGhpcy5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJCXRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJcm90YXRlWDogZnVuY3Rpb24gKCkgewoKCQkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB4LWF4aXMKCgkJCXZhciBtMSA9IG5ldyBNYXRyaXg0KCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcm90YXRlWCggYW5nbGUgKSB7CgoJCQkJbTEubWFrZVJvdGF0aW9uWCggYW5nbGUgKTsKCgkJCQl0aGlzLmFwcGx5TWF0cml4KCBtMSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQlyb3RhdGVZOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHktYXhpcwoKCQkJdmFyIG0xID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiByb3RhdGVZKCBhbmdsZSApIHsKCgkJCQltMS5tYWtlUm90YXRpb25ZKCBhbmdsZSApOwoKCQkJCXRoaXMuYXBwbHlNYXRyaXgoIG0xICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXJvdGF0ZVo6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgei1heGlzCgoJCQl2YXIgbTEgPSBuZXcgTWF0cml4NCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJvdGF0ZVooIGFuZ2xlICkgewoKCQkJCW0xLm1ha2VSb3RhdGlvblooIGFuZ2xlICk7CgoJCQkJdGhpcy5hcHBseU1hdHJpeCggbTEgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCX0oKSwKCgkJdHJhbnNsYXRlOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyB0cmFuc2xhdGUgZ2VvbWV0cnkKCgkJCXZhciBtMSA9IG5ldyBNYXRyaXg0KCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gdHJhbnNsYXRlKCB4LCB5LCB6ICkgewoKCQkJCW0xLm1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApOwoKCQkJCXRoaXMuYXBwbHlNYXRyaXgoIG0xICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCXNjYWxlOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBzY2FsZSBnZW9tZXRyeQoKCQkJdmFyIG0xID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBzY2FsZSggeCwgeSwgeiApIHsKCgkJCQltMS5tYWtlU2NhbGUoIHgsIHksIHogKTsKCgkJCQl0aGlzLmFwcGx5TWF0cml4KCBtMSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQlsb29rQXQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBvYmogPSBuZXcgT2JqZWN0M0QoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBsb29rQXQoIHZlY3RvciApIHsKCgkJCQlvYmoubG9va0F0KCB2ZWN0b3IgKTsKCgkJCQlvYmoudXBkYXRlTWF0cml4KCk7CgoJCQkJdGhpcy5hcHBseU1hdHJpeCggb2JqLm1hdHJpeCApOwoKCQkJfTsKCgkJfSgpLAoKCQljZW50ZXI6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBvZmZzZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGNlbnRlcigpIHsKCgkJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJCXRoaXMuYm91bmRpbmdCb3guZ2V0Q2VudGVyKCBvZmZzZXQgKS5uZWdhdGUoKTsKCgkJCQl0aGlzLnRyYW5zbGF0ZSggb2Zmc2V0LngsIG9mZnNldC55LCBvZmZzZXQueiApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQlzZXRGcm9tT2JqZWN0OiBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuc2V0RnJvbU9iamVjdCgpLiBDb252ZXJ0aW5nJywgb2JqZWN0LCB0aGlzICk7CgoJCQl2YXIgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIG9iamVjdC5pc1BvaW50cyB8fCBvYmplY3QuaXNMaW5lICkgewoKCQkJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoICogMywgMyApOwoJCQkJdmFyIGNvbG9ycyA9IG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5jb2xvcnMubGVuZ3RoICogMywgMyApOwoKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBwb3NpdGlvbnMuY29weVZlY3RvcjNzQXJyYXkoIGdlb21ldHJ5LnZlcnRpY2VzICkgKTsKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCAnY29sb3InLCBjb2xvcnMuY29weUNvbG9yc0FycmF5KCBnZW9tZXRyeS5jb2xvcnMgKSApOwoKCQkJCWlmICggZ2VvbWV0cnkubGluZURpc3RhbmNlcyAmJiBnZW9tZXRyeS5saW5lRGlzdGFuY2VzLmxlbmd0aCA9PT0gZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoICkgewoKCQkJCQl2YXIgbGluZURpc3RhbmNlcyA9IG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5saW5lRGlzdGFuY2VzLmxlbmd0aCwgMSApOwoKCQkJCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ2xpbmVEaXN0YW5jZScsIGxpbmVEaXN0YW5jZXMuY29weUFycmF5KCBnZW9tZXRyeS5saW5lRGlzdGFuY2VzICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgoJCQkJfQoKCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJCXRoaXMuYm91bmRpbmdCb3ggPSBnZW9tZXRyeS5ib3VuZGluZ0JveC5jbG9uZSgpOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc01lc2ggKSB7CgoJCQkJaWYgKCBnZW9tZXRyeSAmJiBnZW9tZXRyeS5pc0dlb21ldHJ5ICkgewoKCQkJCQl0aGlzLmZyb21HZW9tZXRyeSggZ2VvbWV0cnkgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbVBvaW50czogZnVuY3Rpb24gKCBwb2ludHMgKSB7CgoJCQl2YXIgcG9zaXRpb24gPSBbXTsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBwb2ludCA9IHBvaW50c1sgaSBdOwoJCQkJcG9zaXRpb24ucHVzaCggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCQl9CgoJCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCAzICkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl1cGRhdGVGcm9tT2JqZWN0OiBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCXZhciBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKCgkJCWlmICggb2JqZWN0LmlzTWVzaCApIHsKCgkJCQl2YXIgZGlyZWN0ID0gZ2VvbWV0cnkuX19kaXJlY3RHZW9tZXRyeTsKCgkJCQlpZiAoIGdlb21ldHJ5LmVsZW1lbnRzTmVlZFVwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJZGlyZWN0ID0gdW5kZWZpbmVkOwoJCQkJCWdlb21ldHJ5LmVsZW1lbnRzTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJCX0KCgkJCQlpZiAoIGRpcmVjdCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlyZXR1cm4gdGhpcy5mcm9tR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCQkJfQoKCQkJCWRpcmVjdC52ZXJ0aWNlc05lZWRVcGRhdGUgPSBnZW9tZXRyeS52ZXJ0aWNlc05lZWRVcGRhdGU7CgkJCQlkaXJlY3Qubm9ybWFsc05lZWRVcGRhdGUgPSBnZW9tZXRyeS5ub3JtYWxzTmVlZFVwZGF0ZTsKCQkJCWRpcmVjdC5jb2xvcnNOZWVkVXBkYXRlID0gZ2VvbWV0cnkuY29sb3JzTmVlZFVwZGF0ZTsKCQkJCWRpcmVjdC51dnNOZWVkVXBkYXRlID0gZ2VvbWV0cnkudXZzTmVlZFVwZGF0ZTsKCQkJCWRpcmVjdC5ncm91cHNOZWVkVXBkYXRlID0gZ2VvbWV0cnkuZ3JvdXBzTmVlZFVwZGF0ZTsKCgkJCQlnZW9tZXRyeS52ZXJ0aWNlc05lZWRVcGRhdGUgPSBmYWxzZTsKCQkJCWdlb21ldHJ5Lm5vcm1hbHNOZWVkVXBkYXRlID0gZmFsc2U7CgkJCQlnZW9tZXRyeS5jb2xvcnNOZWVkVXBkYXRlID0gZmFsc2U7CgkJCQlnZW9tZXRyeS51dnNOZWVkVXBkYXRlID0gZmFsc2U7CgkJCQlnZW9tZXRyeS5ncm91cHNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCQkJZ2VvbWV0cnkgPSBkaXJlY3Q7CgoJCQl9CgoJCQl2YXIgYXR0cmlidXRlOwoKCQkJaWYgKCBnZW9tZXRyeS52ZXJ0aWNlc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJCWlmICggYXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWF0dHJpYnV0ZS5jb3B5VmVjdG9yM3NBcnJheSggZ2VvbWV0cnkudmVydGljZXMgKTsKCQkJCQlhdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS52ZXJ0aWNlc05lZWRVcGRhdGUgPSBmYWxzZTsKCgkJCX0KCgkJCWlmICggZ2VvbWV0cnkubm9ybWFsc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKCgkJCQlpZiAoIGF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlhdHRyaWJ1dGUuY29weVZlY3RvcjNzQXJyYXkoIGdlb21ldHJ5Lm5vcm1hbHMgKTsKCQkJCQlhdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5ub3JtYWxzTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBnZW9tZXRyeS5jb2xvcnNOZWVkVXBkYXRlID09PSB0cnVlICkgewoKCQkJCWF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlcy5jb2xvcjsKCgkJCQlpZiAoIGF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlhdHRyaWJ1dGUuY29weUNvbG9yc0FycmF5KCBnZW9tZXRyeS5jb2xvcnMgKTsKCQkJCQlhdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5jb2xvcnNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIGdlb21ldHJ5LnV2c05lZWRVcGRhdGUgKSB7CgoJCQkJYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGVzLnV2OwoKCQkJCWlmICggYXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWF0dHJpYnV0ZS5jb3B5VmVjdG9yMnNBcnJheSggZ2VvbWV0cnkudXZzICk7CgkJCQkJYXR0cmlidXRlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQkJZ2VvbWV0cnkudXZzTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBnZW9tZXRyeS5saW5lRGlzdGFuY2VzTmVlZFVwZGF0ZSApIHsKCgkJCQlhdHRyaWJ1dGUgPSB0aGlzLmF0dHJpYnV0ZXMubGluZURpc3RhbmNlOwoKCQkJCWlmICggYXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWF0dHJpYnV0ZS5jb3B5QXJyYXkoIGdlb21ldHJ5LmxpbmVEaXN0YW5jZXMgKTsKCQkJCQlhdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5saW5lRGlzdGFuY2VzTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBnZW9tZXRyeS5ncm91cHNOZWVkVXBkYXRlICkgewoKCQkJCWdlb21ldHJ5LmNvbXB1dGVHcm91cHMoIG9iamVjdC5nZW9tZXRyeSApOwoJCQkJdGhpcy5ncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJZ2VvbWV0cnkuZ3JvdXBzTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWZyb21HZW9tZXRyeTogZnVuY3Rpb24gKCBnZW9tZXRyeSApIHsKCgkJCWdlb21ldHJ5Ll9fZGlyZWN0R2VvbWV0cnkgPSBuZXcgRGlyZWN0R2VvbWV0cnkoKS5mcm9tR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCQlyZXR1cm4gdGhpcy5mcm9tRGlyZWN0R2VvbWV0cnkoIGdlb21ldHJ5Ll9fZGlyZWN0R2VvbWV0cnkgKTsKCgkJfSwKCgkJZnJvbURpcmVjdEdlb21ldHJ5OiBmdW5jdGlvbiAoIGdlb21ldHJ5ICkgewoKCQkJdmFyIHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoIGdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aCAqIDMgKTsKCQkJdGhpcy5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApLmNvcHlWZWN0b3Izc0FycmF5KCBnZW9tZXRyeS52ZXJ0aWNlcyApICk7CgoJCQlpZiAoIGdlb21ldHJ5Lm5vcm1hbHMubGVuZ3RoID4gMCApIHsKCgkJCQl2YXIgbm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoIGdlb21ldHJ5Lm5vcm1hbHMubGVuZ3RoICogMyApOwoJCQkJdGhpcy5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkuY29weVZlY3RvcjNzQXJyYXkoIGdlb21ldHJ5Lm5vcm1hbHMgKSApOwoKCQkJfQoKCQkJaWYgKCBnZW9tZXRyeS5jb2xvcnMubGVuZ3RoID4gMCApIHsKCgkJCQl2YXIgY29sb3JzID0gbmV3IEZsb2F0MzJBcnJheSggZ2VvbWV0cnkuY29sb3JzLmxlbmd0aCAqIDMgKTsKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCAnY29sb3InLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKS5jb3B5Q29sb3JzQXJyYXkoIGdlb21ldHJ5LmNvbG9ycyApICk7CgoJCQl9CgoJCQlpZiAoIGdlb21ldHJ5LnV2cy5sZW5ndGggPiAwICkgewoKCQkJCXZhciB1dnMgPSBuZXcgRmxvYXQzMkFycmF5KCBnZW9tZXRyeS51dnMubGVuZ3RoICogMiApOwoJCQkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApLmNvcHlWZWN0b3Iyc0FycmF5KCBnZW9tZXRyeS51dnMgKSApOwoKCQkJfQoKCQkJaWYgKCBnZW9tZXRyeS51dnMyLmxlbmd0aCA+IDAgKSB7CgoJCQkJdmFyIHV2czIgPSBuZXcgRmxvYXQzMkFycmF5KCBnZW9tZXRyeS51dnMyLmxlbmd0aCAqIDIgKTsKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCAndXYyJywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdXZzMiwgMiApLmNvcHlWZWN0b3Iyc0FycmF5KCBnZW9tZXRyeS51dnMyICkgKTsKCgkJCX0KCgkJCS8vIGdyb3VwcwoKCQkJdGhpcy5ncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkvLyBtb3JwaHMKCgkJCWZvciAoIHZhciBuYW1lIGluIGdlb21ldHJ5Lm1vcnBoVGFyZ2V0cyApIHsKCgkJCQl2YXIgYXJyYXkgPSBbXTsKCQkJCXZhciBtb3JwaFRhcmdldHMgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHNbIG5hbWUgXTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBtb3JwaFRhcmdldHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdmFyIG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzWyBpIF07CgoJCQkJCXZhciBhdHRyaWJ1dGUgPSBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhUYXJnZXQuZGF0YS5sZW5ndGggKiAzLCAzICk7CgkJCQkJYXR0cmlidXRlLm5hbWUgPSBtb3JwaFRhcmdldC5uYW1lOwoKCQkJCQlhcnJheS5wdXNoKCBhdHRyaWJ1dGUuY29weVZlY3RvcjNzQXJyYXkoIG1vcnBoVGFyZ2V0LmRhdGEgKSApOwoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgoJCQl9CgoJCQkvLyBza2lubmluZwoKCQkJaWYgKCBnZW9tZXRyeS5za2luSW5kaWNlcy5sZW5ndGggPiAwICkgewoKCQkJCXZhciBza2luSW5kaWNlcyA9IG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5za2luSW5kaWNlcy5sZW5ndGggKiA0LCA0ICk7CgkJCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3NraW5JbmRleCcsIHNraW5JbmRpY2VzLmNvcHlWZWN0b3I0c0FycmF5KCBnZW9tZXRyeS5za2luSW5kaWNlcyApICk7CgoJCQl9CgoJCQlpZiAoIGdlb21ldHJ5LnNraW5XZWlnaHRzLmxlbmd0aCA+IDAgKSB7CgoJCQkJdmFyIHNraW5XZWlnaHRzID0gbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGdlb21ldHJ5LnNraW5XZWlnaHRzLmxlbmd0aCAqIDQsIDQgKTsKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCAnc2tpbldlaWdodCcsIHNraW5XZWlnaHRzLmNvcHlWZWN0b3I0c0FycmF5KCBnZW9tZXRyeS5za2luV2VpZ2h0cyApICk7CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJCX0KCgkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ0JveCA9IGdlb21ldHJ5LmJvdW5kaW5nQm94LmNsb25lKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29tcHV0ZUJvdW5kaW5nQm94OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgYm94ID0gbmV3IEJveDMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjb21wdXRlQm91bmRpbmdCb3goKSB7CgoJCQkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJCQl0aGlzLmJvdW5kaW5nQm94ID0gbmV3IEJveDMoKTsKCgkJCQl9CgoJCQkJdmFyIHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQkJdmFyIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgoJCQkJaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQl0aGlzLmJvdW5kaW5nQm94LnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgoJCQkJCS8vIHByb2Nlc3MgbW9ycGggYXR0cmlidXRlcyBpZiBwcmVzZW50CgoJCQkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgoJCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQkJdmFyIG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQkJCWJveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKCQkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggYm94Lm1pbiApOwoJCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBib3gubWF4ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLmJvdW5kaW5nQm94Lm1ha2VFbXB0eSgpOwoKCQkJCX0KCgkJCQlpZiAoIGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi54ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnkgKSB8fCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueiApICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94OiBDb21wdXRlZCBtaW4vbWF4IGhhdmUgTmFOIHZhbHVlcy4gVGhlICJwb3NpdGlvbiIgYXR0cmlidXRlIGlzIGxpa2VseSB0byBoYXZlIE5hTiB2YWx1ZXMuJywgdGhpcyApOwoKCQkJCX0KCgkJCX07CgoJCX0oKSwKCgkJY29tcHV0ZUJvdW5kaW5nU3BoZXJlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgYm94ID0gbmV3IEJveDMoKTsKCQkJdmFyIGJveE1vcnBoVGFyZ2V0cyA9IG5ldyBCb3gzKCk7CgkJCXZhciB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpIHsKCgkJCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSB7CgoJCQkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQkJfQoKCQkJCXZhciBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJCXZhciBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJCWlmICggcG9zaXRpb24gKSB7CgoJCQkJCS8vIGZpcnN0LCBmaW5kIHRoZSBjZW50ZXIgb2YgdGhlIGJvdW5kaW5nIHNwaGVyZQoKCQkJCQl2YXIgY2VudGVyID0gdGhpcy5ib3VuZGluZ1NwaGVyZS5jZW50ZXI7CgoJCQkJCWJveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiApOwoKCQkJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCXZhciBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJCQlib3hNb3JwaFRhcmdldHMuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUgKTsKCgkJCQkJCQlib3guZXhwYW5kQnlQb2ludCggYm94TW9ycGhUYXJnZXRzLm1pbiApOwoJCQkJCQkJYm94LmV4cGFuZEJ5UG9pbnQoIGJveE1vcnBoVGFyZ2V0cy5tYXggKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlib3guZ2V0Q2VudGVyKCBjZW50ZXIgKTsKCgkJCQkJLy8gc2Vjb25kLCB0cnkgdG8gZmluZCBhIGJvdW5kaW5nU3BoZXJlIHdpdGggYSByYWRpdXMgc21hbGxlciB0aGFuIHRoZQoJCQkJCS8vIGJvdW5kaW5nU3BoZXJlIG9mIHRoZSBib3VuZGluZ0JveDogc3FydCgzKSBzbWFsbGVyIGluIHRoZSBiZXN0IGNhc2UKCgkJCQkJdmFyIG1heFJhZGl1c1NxID0gMDsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHBvc2l0aW9uLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQl2ZWN0b3IuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKTsKCgkJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIHZlY3RvciApICk7CgoJCQkJCX0KCgkJCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCgkJCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQl2YXIgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvblsgaSBdOwoKCQkJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBtb3JwaEF0dHJpYnV0ZS5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJCQl2ZWN0b3IuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUsIGkgKTsKCgkJCQkJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdmVjdG9yICkgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQkJCWlmICggaXNOYU4oIHRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzICkgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IENvbXB1dGVkIHJhZGl1cyBpcyBOYU4uIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCX0oKSwKCgkJY29tcHV0ZUZhY2VOb3JtYWxzOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoKCQl9LAoKCQljb21wdXRlVmVydGV4Tm9ybWFsczogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGluZGV4ID0gdGhpcy5pbmRleDsKCQkJdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgoJCQlpZiAoIGF0dHJpYnV0ZXMucG9zaXRpb24gKSB7CgoJCQkJdmFyIHBvc2l0aW9ucyA9IGF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXk7CgoJCQkJaWYgKCBhdHRyaWJ1dGVzLm5vcm1hbCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIHBvc2l0aW9ucy5sZW5ndGggKSwgMyApICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcmVzZXQgZXhpc3Rpbmcgbm9ybWFscyB0byB6ZXJvCgoJCQkJCXZhciBhcnJheSA9IGF0dHJpYnV0ZXMubm9ybWFsLmFycmF5OwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQlhcnJheVsgaSBdID0gMDsKCgkJCQkJfQoKCQkJCX0KCgkJCQl2YXIgbm9ybWFscyA9IGF0dHJpYnV0ZXMubm9ybWFsLmFycmF5OwoKCQkJCXZhciB2QSwgdkIsIHZDOwoJCQkJdmFyIHBBID0gbmV3IFZlY3RvcjMoKSwgcEIgPSBuZXcgVmVjdG9yMygpLCBwQyA9IG5ldyBWZWN0b3IzKCk7CgkJCQl2YXIgY2IgPSBuZXcgVmVjdG9yMygpLCBhYiA9IG5ldyBWZWN0b3IzKCk7CgoJCQkJLy8gaW5kZXhlZCBlbGVtZW50cwoKCQkJCWlmICggaW5kZXggKSB7CgoJCQkJCXZhciBpbmRpY2VzID0gaW5kZXguYXJyYXk7CgoJCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBpbmRleC5jb3VudDsgaSA8IGlsOyBpICs9IDMgKSB7CgoJCQkJCQl2QSA9IGluZGljZXNbIGkgKyAwIF0gKiAzOwoJCQkJCQl2QiA9IGluZGljZXNbIGkgKyAxIF0gKiAzOwoJCQkJCQl2QyA9IGluZGljZXNbIGkgKyAyIF0gKiAzOwoKCQkJCQkJcEEuZnJvbUFycmF5KCBwb3NpdGlvbnMsIHZBICk7CgkJCQkJCXBCLmZyb21BcnJheSggcG9zaXRpb25zLCB2QiApOwoJCQkJCQlwQy5mcm9tQXJyYXkoIHBvc2l0aW9ucywgdkMgKTsKCgkJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwoJCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKCQkJCQkJY2IuY3Jvc3MoIGFiICk7CgoJCQkJCQlub3JtYWxzWyB2QSBdICs9IGNiLng7CgkJCQkJCW5vcm1hbHNbIHZBICsgMSBdICs9IGNiLnk7CgkJCQkJCW5vcm1hbHNbIHZBICsgMiBdICs9IGNiLno7CgoJCQkJCQlub3JtYWxzWyB2QiBdICs9IGNiLng7CgkJCQkJCW5vcm1hbHNbIHZCICsgMSBdICs9IGNiLnk7CgkJCQkJCW5vcm1hbHNbIHZCICsgMiBdICs9IGNiLno7CgoJCQkJCQlub3JtYWxzWyB2QyBdICs9IGNiLng7CgkJCQkJCW5vcm1hbHNbIHZDICsgMSBdICs9IGNiLnk7CgkJCQkJCW5vcm1hbHNbIHZDICsgMiBdICs9IGNiLno7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBub24taW5kZXhlZCBlbGVtZW50cyAodW5jb25uZWN0ZWQgdHJpYW5nbGUgc291cCkKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHBvc2l0aW9ucy5sZW5ndGg7IGkgPCBpbDsgaSArPSA5ICkgewoKCQkJCQkJcEEuZnJvbUFycmF5KCBwb3NpdGlvbnMsIGkgKTsKCQkJCQkJcEIuZnJvbUFycmF5KCBwb3NpdGlvbnMsIGkgKyAzICk7CgkJCQkJCXBDLmZyb21BcnJheSggcG9zaXRpb25zLCBpICsgNiApOwoKCQkJCQkJY2Iuc3ViVmVjdG9ycyggcEMsIHBCICk7CgkJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwoJCQkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQkJCW5vcm1hbHNbIGkgXSA9IGNiLng7CgkJCQkJCW5vcm1hbHNbIGkgKyAxIF0gPSBjYi55OwoJCQkJCQlub3JtYWxzWyBpICsgMiBdID0gY2IuejsKCgkJCQkJCW5vcm1hbHNbIGkgKyAzIF0gPSBjYi54OwoJCQkJCQlub3JtYWxzWyBpICsgNCBdID0gY2IueTsKCQkJCQkJbm9ybWFsc1sgaSArIDUgXSA9IGNiLno7CgoJCQkJCQlub3JtYWxzWyBpICsgNiBdID0gY2IueDsKCQkJCQkJbm9ybWFsc1sgaSArIDcgXSA9IGNiLnk7CgkJCQkJCW5vcm1hbHNbIGkgKyA4IF0gPSBjYi56OwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOwoKCQkJCWF0dHJpYnV0ZXMubm9ybWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJfSwKCgkJbWVyZ2U6IGZ1bmN0aW9uICggZ2VvbWV0cnksIG9mZnNldCApIHsKCgkJCWlmICggISAoIGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkubWVyZ2UoKTogZ2VvbWV0cnkgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkJ1ZmZlckdlb21ldHJ5LicsIGdlb21ldHJ5ICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlpZiAoIG9mZnNldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW9mZnNldCA9IDA7CgoJCQkJY29uc29sZS53YXJuKAoJCQkJCSdUSFJFRS5CdWZmZXJHZW9tZXRyeS5tZXJnZSgpOiBPdmVyd3JpdGluZyBvcmlnaW5hbCBnZW9tZXRyeSwgc3RhcnRpbmcgYXQgb2Zmc2V0PTAuICcKCQkJCQkrICdVc2UgQnVmZmVyR2VvbWV0cnlVdGlscy5tZXJnZUJ1ZmZlckdlb21ldHJpZXMoKSBmb3IgbG9zc2xlc3MgbWVyZ2UuJwoJCQkJKTsKCgkJCX0KCgkJCXZhciBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKCQkJZm9yICggdmFyIGtleSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJCWlmICggZ2VvbWV0cnkuYXR0cmlidXRlc1sga2V5IF0gPT09IHVuZGVmaW5lZCApIGNvbnRpbnVlOwoKCQkJCXZhciBhdHRyaWJ1dGUxID0gYXR0cmlidXRlc1sga2V5IF07CgkJCQl2YXIgYXR0cmlidXRlQXJyYXkxID0gYXR0cmlidXRlMS5hcnJheTsKCgkJCQl2YXIgYXR0cmlidXRlMiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXNbIGtleSBdOwoJCQkJdmFyIGF0dHJpYnV0ZUFycmF5MiA9IGF0dHJpYnV0ZTIuYXJyYXk7CgoJCQkJdmFyIGF0dHJpYnV0ZVNpemUgPSBhdHRyaWJ1dGUyLml0ZW1TaXplOwoKCQkJCWZvciAoIHZhciBpID0gMCwgaiA9IGF0dHJpYnV0ZVNpemUgKiBvZmZzZXQ7IGkgPCBhdHRyaWJ1dGVBcnJheTIubGVuZ3RoOyBpICsrLCBqICsrICkgewoKCQkJCQlhdHRyaWJ1dGVBcnJheTFbIGogXSA9IGF0dHJpYnV0ZUFycmF5MlsgaSBdOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlub3JtYWxpemVOb3JtYWxzOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBub3JtYWxpemVOb3JtYWxzKCkgewoKCQkJCXZhciBub3JtYWxzID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbm9ybWFscy5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl2ZWN0b3IueCA9IG5vcm1hbHMuZ2V0WCggaSApOwoJCQkJCXZlY3Rvci55ID0gbm9ybWFscy5nZXRZKCBpICk7CgkJCQkJdmVjdG9yLnogPSBub3JtYWxzLmdldFooIGkgKTsKCgkJCQkJdmVjdG9yLm5vcm1hbGl6ZSgpOwoKCQkJCQlub3JtYWxzLnNldFhZWiggaSwgdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCX0KCgkJCX07CgoJCX0oKSwKCgkJdG9Ob25JbmRleGVkOiBmdW5jdGlvbiAoKSB7CgoJCQlmdW5jdGlvbiBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKSB7CgoJCQkJdmFyIGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQkJdmFyIGl0ZW1TaXplID0gYXR0cmlidXRlLml0ZW1TaXplOwoKCQkJCXZhciBhcnJheTIgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IoIGluZGljZXMubGVuZ3RoICogaXRlbVNpemUgKTsKCgkJCQl2YXIgaW5kZXggPSAwLCBpbmRleDIgPSAwOwoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGluZGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJaW5kZXggPSBpbmRpY2VzWyBpIF0gKiBpdGVtU2l6ZTsKCgkJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgaXRlbVNpemU7IGogKysgKSB7CgoJCQkJCQlhcnJheTJbIGluZGV4MiArKyBdID0gYXJyYXlbIGluZGV4ICsrIF07CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGFycmF5MiwgaXRlbVNpemUgKTsKCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHRoaXMuaW5kZXggPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuJyApOwoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQl2YXIgZ2VvbWV0cnkyID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCQl2YXIgaW5kaWNlcyA9IHRoaXMuaW5kZXguYXJyYXk7CgkJCXZhciBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKCQkJLy8gYXR0cmlidXRlcwoKCQkJZm9yICggdmFyIG5hbWUgaW4gYXR0cmlidXRlcyApIHsKCgkJCQl2YXIgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCXZhciBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQlnZW9tZXRyeTIuYWRkQXR0cmlidXRlKCBuYW1lLCBuZXdBdHRyaWJ1dGUgKTsKCgkJCX0KCgkJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCgkJCXZhciBtb3JwaEF0dHJpYnV0ZXMgPSB0aGlzLm1vcnBoQXR0cmlidXRlczsKCgkJCWZvciAoIG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJCXZhciBtb3JwaEFycmF5ID0gW107CgkJCQl2YXIgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsgLy8gbW9ycGhBdHRyaWJ1dGU6IGFycmF5IG9mIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGVzCgoJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl2YXIgYXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVbIGkgXTsKCgkJCQkJdmFyIG5ld0F0dHJpYnV0ZSA9IGNvbnZlcnRCdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kaWNlcyApOwoKCQkJCQltb3JwaEFycmF5LnB1c2goIG5ld0F0dHJpYnV0ZSApOwoKCQkJCX0KCgkJCQlnZW9tZXRyeTIubW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF0gPSBtb3JwaEFycmF5OwoKCQkJfQoKCQkJLy8gZ3JvdXBzCgoJCQl2YXIgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBncm91cHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCWdlb21ldHJ5Mi5hZGRHcm91cCggZ3JvdXAuc3RhcnQsIGdyb3VwLmNvdW50LCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgoJCQl9CgoJCQlyZXR1cm4gZ2VvbWV0cnkyOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBkYXRhID0gewoJCQkJbWV0YWRhdGE6IHsKCQkJCQl2ZXJzaW9uOiA0LjUsCgkJCQkJdHlwZTogJ0J1ZmZlckdlb21ldHJ5JywKCQkJCQlnZW5lcmF0b3I6ICdCdWZmZXJHZW9tZXRyeS50b0pTT04nCgkJCQl9CgkJCX07CgoJCQkvLyBzdGFuZGFyZCBCdWZmZXJHZW9tZXRyeSBzZXJpYWxpemF0aW9uCgoJCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJCWRhdGEudHlwZSA9IHRoaXMudHlwZTsKCQkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoJCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQkJaWYgKCB0aGlzLnBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCgkJCQlmb3IgKCB2YXIga2V5IGluIHBhcmFtZXRlcnMgKSB7CgoJCQkJCWlmICggcGFyYW1ldGVyc1sga2V5IF0gIT09IHVuZGVmaW5lZCApIGRhdGFbIGtleSBdID0gcGFyYW1ldGVyc1sga2V5IF07CgoJCQkJfQoKCQkJCXJldHVybiBkYXRhOwoKCQkJfQoKCQkJZGF0YS5kYXRhID0geyBhdHRyaWJ1dGVzOiB7fSB9OwoKCQkJdmFyIGluZGV4ID0gdGhpcy5pbmRleDsKCgkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJZGF0YS5kYXRhLmluZGV4ID0gewoJCQkJCXR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBpbmRleC5hcnJheSApCgkJCQl9OwoKCQkJfQoKCQkJdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgoJCQlmb3IgKCB2YXIga2V5IGluIGF0dHJpYnV0ZXMgKSB7CgoJCQkJdmFyIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJCXZhciBhdHRyaWJ1dGVEYXRhID0gewoJCQkJCWl0ZW1TaXplOiBhdHRyaWJ1dGUuaXRlbVNpemUsCgkJCQkJdHlwZTogYXR0cmlidXRlLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhdHRyaWJ1dGUuYXJyYXkgKSwKCQkJCQlub3JtYWxpemVkOiBhdHRyaWJ1dGUubm9ybWFsaXplZAoJCQkJfTsKCgkJCQlpZiAoIGF0dHJpYnV0ZS5uYW1lICE9PSAnJyApIGF0dHJpYnV0ZURhdGEubmFtZSA9IGF0dHJpYnV0ZS5uYW1lOwoKCQkJCWRhdGEuZGF0YS5hdHRyaWJ1dGVzWyBrZXkgXSA9IGF0dHJpYnV0ZURhdGE7CgoJCQl9CgoJCQl2YXIgbW9ycGhBdHRyaWJ1dGVzID0ge307CgkJCXZhciBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKCgkJCWZvciAoIHZhciBrZXkgaW4gdGhpcy5tb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJdmFyIGF0dHJpYnV0ZUFycmF5ID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJCXZhciBhcnJheSA9IFtdOwoKCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBhdHRyaWJ1dGVBcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdmFyIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUFycmF5WyBpIF07CgoJCQkJCXZhciBhdHRyaWJ1dGVEYXRhID0gewoJCQkJCQlpdGVtU2l6ZTogYXR0cmlidXRlLml0ZW1TaXplLAoJCQkJCQl0eXBlOiBhdHRyaWJ1dGUuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKCQkJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhdHRyaWJ1dGUuYXJyYXkgKSwKCQkJCQkJbm9ybWFsaXplZDogYXR0cmlidXRlLm5vcm1hbGl6ZWQKCQkJCQl9OwoKCQkJCQlpZiAoIGF0dHJpYnV0ZS5uYW1lICE9PSAnJyApIGF0dHJpYnV0ZURhdGEubmFtZSA9IGF0dHJpYnV0ZS5uYW1lOwoKCQkJCQlhcnJheS5wdXNoKCBhdHRyaWJ1dGVEYXRhICk7CgoJCQkJfQoKCQkJCWlmICggYXJyYXkubGVuZ3RoID4gMCApIHsKCgkJCQkJbW9ycGhBdHRyaWJ1dGVzWyBrZXkgXSA9IGFycmF5OwoKCQkJCQloYXNNb3JwaEF0dHJpYnV0ZXMgPSB0cnVlOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggaGFzTW9ycGhBdHRyaWJ1dGVzICkgZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKCgkJCXZhciBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJCWlmICggZ3JvdXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJZGF0YS5kYXRhLmdyb3VwcyA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBncm91cHMgKSApOwoKCQkJfQoKCQkJdmFyIGJvdW5kaW5nU3BoZXJlID0gdGhpcy5ib3VuZGluZ1NwaGVyZTsKCgkJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgoJCQkJZGF0YS5kYXRhLmJvdW5kaW5nU3BoZXJlID0gewoJCQkJCWNlbnRlcjogYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSwKCQkJCQlyYWRpdXM6IGJvdW5kaW5nU3BoZXJlLnJhZGl1cwoJCQkJfTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJLyoKCQkJIC8vIEhhbmRsZSBwcmltaXRpdmVzCgoJCQkgdmFyIHBhcmFtZXRlcnMgPSB0aGlzLnBhcmFtZXRlcnM7CgoJCQkgaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkgdmFyIHZhbHVlcyA9IFtdOwoKCQkJIGZvciAoIHZhciBrZXkgaW4gcGFyYW1ldGVycyApIHsKCgkJCSB2YWx1ZXMucHVzaCggcGFyYW1ldGVyc1sga2V5IF0gKTsKCgkJCSB9CgoJCQkgdmFyIGdlb21ldHJ5ID0gT2JqZWN0LmNyZWF0ZSggdGhpcy5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgKTsKCQkJIHRoaXMuY29uc3RydWN0b3IuYXBwbHkoIGdlb21ldHJ5LCB2YWx1ZXMgKTsKCQkJIHJldHVybiBnZW9tZXRyeTsKCgkJCSB9CgoJCQkgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoJCQkgKi8KCgkJCXJldHVybiBuZXcgQnVmZmVyR2VvbWV0cnkoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJdmFyIG5hbWUsIGksIGw7CgoJCQkvLyByZXNldAoKCQkJdGhpcy5pbmRleCA9IG51bGw7CgkJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLmdyb3VwcyA9IFtdOwoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvLyBuYW1lCgoJCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJCS8vIGluZGV4CgoJCQl2YXIgaW5kZXggPSBzb3VyY2UuaW5kZXg7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCXRoaXMuc2V0SW5kZXgoIGluZGV4LmNsb25lKCkgKTsKCgkJCX0KCgkJCS8vIGF0dHJpYnV0ZXMKCgkJCXZhciBhdHRyaWJ1dGVzID0gc291cmNlLmF0dHJpYnV0ZXM7CgoJCQlmb3IgKCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgoJCQkJdmFyIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCQkJCXRoaXMuYWRkQXR0cmlidXRlKCBuYW1lLCBhdHRyaWJ1dGUuY2xvbmUoKSApOwoKCQkJfQoKCQkJLy8gbW9ycGggYXR0cmlidXRlcwoKCQkJdmFyIG1vcnBoQXR0cmlidXRlcyA9IHNvdXJjZS5tb3JwaEF0dHJpYnV0ZXM7CgoJCQlmb3IgKCBuYW1lIGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQl2YXIgYXJyYXkgPSBbXTsKCQkJCXZhciBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sgbmFtZSBdOyAvLyBtb3JwaEF0dHJpYnV0ZTogYXJyYXkgb2YgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZXMKCgkJCQlmb3IgKCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWFycmF5LnB1c2goIG1vcnBoQXR0cmlidXRlWyBpIF0uY2xvbmUoKSApOwoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgoJCQl9CgoJCQkvLyBncm91cHMKCgkJCXZhciBncm91cHMgPSBzb3VyY2UuZ3JvdXBzOwoKCQkJZm9yICggaSA9IDAsIGwgPSBncm91cHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCXRoaXMuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQkJfQoKCQkJLy8gYm91bmRpbmcgYm94CgoJCQl2YXIgYm91bmRpbmdCb3ggPSBzb3VyY2UuYm91bmRpbmdCb3g7CgoJCQlpZiAoIGJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdCb3ggPSBib3VuZGluZ0JveC5jbG9uZSgpOwoKCQkJfQoKCQkJLy8gYm91bmRpbmcgc3BoZXJlCgoJCQl2YXIgYm91bmRpbmdTcGhlcmUgPSBzb3VyY2UuYm91bmRpbmdTcGhlcmU7CgoJCQlpZiAoIGJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBib3VuZGluZ1NwaGVyZS5jbG9uZSgpOwoKCQkJfQoKCQkJLy8gZHJhdyByYW5nZQoKCQkJdGhpcy5kcmF3UmFuZ2Uuc3RhcnQgPSBzb3VyY2UuZHJhd1JhbmdlLnN0YXJ0OwoJCQl0aGlzLmRyYXdSYW5nZS5jb3VudCA9IHNvdXJjZS5kcmF3UmFuZ2UuY291bnQ7CgoJCQkvLyB1c2VyIGRhdGEKCgkJCXRoaXMudXNlckRhdGEgPSBzb3VyY2UudXNlckRhdGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZGlzcG9zZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCS8vIEJveEdlb21ldHJ5CgoJZnVuY3Rpb24gQm94R2VvbWV0cnkoIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgZGVwdGhTZWdtZW50cyApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnQm94R2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXdpZHRoOiB3aWR0aCwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCWRlcHRoOiBkZXB0aCwKCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAoJCQlkZXB0aFNlZ21lbnRzOiBkZXB0aFNlZ21lbnRzCgkJfTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBCb3hCdWZmZXJHZW9tZXRyeSggd2lkdGgsIGhlaWdodCwgZGVwdGgsIHdpZHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJQm94R2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggR2VvbWV0cnkucHJvdG90eXBlICk7CglCb3hHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBCb3hHZW9tZXRyeTsKCgkvLyBCb3hCdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIEJveEJ1ZmZlckdlb21ldHJ5KCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIGRlcHRoU2VnbWVudHMgKSB7CgoJCUJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0JveEJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQl3aWR0aDogd2lkdGgsCgkJCWhlaWdodDogaGVpZ2h0LAoJCQlkZXB0aDogZGVwdGgsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJZGVwdGhTZWdtZW50czogZGVwdGhTZWdtZW50cwoJCX07CgoJCXZhciBzY29wZSA9IHRoaXM7CgoJCXdpZHRoID0gd2lkdGggfHwgMTsKCQloZWlnaHQgPSBoZWlnaHQgfHwgMTsKCQlkZXB0aCA9IGRlcHRoIHx8IDE7CgoJCS8vIHNlZ21lbnRzCgoJCXdpZHRoU2VnbWVudHMgPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICkgfHwgMTsKCQloZWlnaHRTZWdtZW50cyA9IE1hdGguZmxvb3IoIGhlaWdodFNlZ21lbnRzICkgfHwgMTsKCQlkZXB0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggZGVwdGhTZWdtZW50cyApIHx8IDE7CgoJCS8vIGJ1ZmZlcnMKCgkJdmFyIGluZGljZXMgPSBbXTsKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgbnVtYmVyT2ZWZXJ0aWNlcyA9IDA7CgkJdmFyIGdyb3VwU3RhcnQgPSAwOwoKCQkvLyBidWlsZCBlYWNoIHNpZGUgb2YgdGhlIGJveCBnZW9tZXRyeQoKCQlidWlsZFBsYW5lKCAneicsICd5JywgJ3gnLCAtIDEsIC0gMSwgZGVwdGgsIGhlaWdodCwgd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAwICk7IC8vIHB4CgkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgMSwgLSAxLCBkZXB0aCwgaGVpZ2h0LCAtIHdpZHRoLCBkZXB0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgMSApOyAvLyBueAoJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIDEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAyICk7IC8vIHB5CgkJYnVpbGRQbGFuZSggJ3gnLCAneicsICd5JywgMSwgLSAxLCB3aWR0aCwgZGVwdGgsIC0gaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAzICk7IC8vIG55CgkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgMSwgLSAxLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDQgKTsgLy8gcHoKCQlidWlsZFBsYW5lKCAneCcsICd5JywgJ3onLCAtIDEsIC0gMSwgd2lkdGgsIGhlaWdodCwgLSBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDUgKTsgLy8gbnoKCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJZnVuY3Rpb24gYnVpbGRQbGFuZSggdSwgdiwgdywgdWRpciwgdmRpciwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdyaWRYLCBncmlkWSwgbWF0ZXJpYWxJbmRleCApIHsKCgkJCXZhciBzZWdtZW50V2lkdGggPSB3aWR0aCAvIGdyaWRYOwoJCQl2YXIgc2VnbWVudEhlaWdodCA9IGhlaWdodCAvIGdyaWRZOwoKCQkJdmFyIHdpZHRoSGFsZiA9IHdpZHRoIC8gMjsKCQkJdmFyIGhlaWdodEhhbGYgPSBoZWlnaHQgLyAyOwoJCQl2YXIgZGVwdGhIYWxmID0gZGVwdGggLyAyOwoKCQkJdmFyIGdyaWRYMSA9IGdyaWRYICsgMTsKCQkJdmFyIGdyaWRZMSA9IGdyaWRZICsgMTsKCgkJCXZhciB2ZXJ0ZXhDb3VudGVyID0gMDsKCQkJdmFyIGdyb3VwQ291bnQgPSAwOwoKCQkJdmFyIGl4LCBpeTsKCgkJCXZhciB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQkJZm9yICggaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgoJCQkJdmFyIHkgPSBpeSAqIHNlZ21lbnRIZWlnaHQgLSBoZWlnaHRIYWxmOwoKCQkJCWZvciAoIGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKCQkJCQl2YXIgeCA9IGl4ICogc2VnbWVudFdpZHRoIC0gd2lkdGhIYWxmOwoKCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKCQkJCQl2ZWN0b3JbIHUgXSA9IHggKiB1ZGlyOwoJCQkJCXZlY3RvclsgdiBdID0geSAqIHZkaXI7CgkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aEhhbGY7CgoJCQkJCS8vIG5vdyBhcHBseSB2ZWN0b3IgdG8gdmVydGV4IGJ1ZmZlcgoKCQkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgoJCQkJCS8vIHNldCB2YWx1ZXMgdG8gY29ycmVjdCB2ZWN0b3IgY29tcG9uZW50CgoJCQkJCXZlY3RvclsgdSBdID0gMDsKCQkJCQl2ZWN0b3JbIHYgXSA9IDA7CgkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aCA+IDAgPyAxIDogLSAxOwoKCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIG5vcm1hbCBidWZmZXIKCgkJCQkJbm9ybWFscy5wdXNoKCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgoJCQkJCS8vIHV2cwoKCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCXV2cy5wdXNoKCAxIC0gKCBpeSAvIGdyaWRZICkgKTsKCgkJCQkJLy8gY291bnRlcnMKCgkJCQkJdmVydGV4Q291bnRlciArPSAxOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGluZGljZXMKCgkJCS8vIDEuIHlvdSBuZWVkIHRocmVlIGluZGljZXMgdG8gZHJhdyBhIHNpbmdsZSBmYWNlCgkJCS8vIDIuIGEgc2luZ2xlIHNlZ21lbnQgY29uc2lzdHMgb2YgdHdvIGZhY2VzCgkJCS8vIDMuIHNvIHdlIG5lZWQgdG8gZ2VuZXJhdGUgc2l4ICgyKjMpIGluZGljZXMgcGVyIHNlZ21lbnQKCgkJCWZvciAoIGl5ID0gMDsgaXkgPCBncmlkWTsgaXkgKysgKSB7CgoJCQkJZm9yICggaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCgkJCQkJdmFyIGEgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiBpeTsKCQkJCQl2YXIgYiA9IG51bWJlck9mVmVydGljZXMgKyBpeCArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJdmFyIGMgPSBudW1iZXJPZlZlcnRpY2VzICsgKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJdmFyIGQgPSBudW1iZXJPZlZlcnRpY2VzICsgKCBpeCArIDEgKSArIGdyaWRYMSAqIGl5OwoKCQkJCQkvLyBmYWNlcwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCQkJLy8gaW5jcmVhc2UgY291bnRlcgoKCQkJCQlncm91cENvdW50ICs9IDY7CgoJCQkJfQoKCQkJfQoKCQkJLy8gYWRkIGEgZ3JvdXAgdG8gdGhlIGdlb21ldHJ5LiB0aGlzIHdpbGwgZW5zdXJlIG11bHRpIG1hdGVyaWFsIHN1cHBvcnQKCgkJCXNjb3BlLmFkZEdyb3VwKCBncm91cFN0YXJ0LCBncm91cENvdW50LCBtYXRlcmlhbEluZGV4ICk7CgoJCQkvLyBjYWxjdWxhdGUgbmV3IHN0YXJ0IHZhbHVlIGZvciBncm91cHMKCgkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCgkJCS8vIHVwZGF0ZSB0b3RhbCBudW1iZXIgb2YgdmVydGljZXMKCgkJCW51bWJlck9mVmVydGljZXMgKz0gdmVydGV4Q291bnRlcjsKCgkJfQoKCX0KCglCb3hCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCUJveEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEJveEJ1ZmZlckdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBQbGFuZUdlb21ldHJ5CgoJZnVuY3Rpb24gUGxhbmVHZW9tZXRyeSggd2lkdGgsIGhlaWdodCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1BsYW5lR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXdpZHRoOiB3aWR0aCwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cwoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgUGxhbmVCdWZmZXJHZW9tZXRyeSggd2lkdGgsIGhlaWdodCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMgKSApOwoJCXRoaXMubWVyZ2VWZXJ0aWNlcygpOwoKCX0KCglQbGFuZUdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJUGxhbmVHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQbGFuZUdlb21ldHJ5OwoKCS8vIFBsYW5lQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBQbGFuZUJ1ZmZlckdlb21ldHJ5KCB3aWR0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cyApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnUGxhbmVCdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJd2lkdGg6IHdpZHRoLAoJCQloZWlnaHQ6IGhlaWdodCwKCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzCgkJfTsKCgkJd2lkdGggPSB3aWR0aCB8fCAxOwoJCWhlaWdodCA9IGhlaWdodCB8fCAxOwoKCQl2YXIgd2lkdGhfaGFsZiA9IHdpZHRoIC8gMjsKCQl2YXIgaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyOwoKCQl2YXIgZ3JpZFggPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICkgfHwgMTsKCQl2YXIgZ3JpZFkgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApIHx8IDE7CgoJCXZhciBncmlkWDEgPSBncmlkWCArIDE7CgkJdmFyIGdyaWRZMSA9IGdyaWRZICsgMTsKCgkJdmFyIHNlZ21lbnRfd2lkdGggPSB3aWR0aCAvIGdyaWRYOwoJCXZhciBzZWdtZW50X2hlaWdodCA9IGhlaWdodCAvIGdyaWRZOwoKCQl2YXIgaXgsIGl5OwoKCQkvLyBidWZmZXJzCgoJCXZhciBpbmRpY2VzID0gW107CgkJdmFyIHZlcnRpY2VzID0gW107CgkJdmFyIG5vcm1hbHMgPSBbXTsKCQl2YXIgdXZzID0gW107CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJZm9yICggaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgoJCQl2YXIgeSA9IGl5ICogc2VnbWVudF9oZWlnaHQgLSBoZWlnaHRfaGFsZjsKCgkJCWZvciAoIGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKCQkJCXZhciB4ID0gaXggKiBzZWdtZW50X3dpZHRoIC0gd2lkdGhfaGFsZjsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAtIHksIDAgKTsKCgkJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCgkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJdXZzLnB1c2goIDEgLSAoIGl5IC8gZ3JpZFkgKSApOwoKCQkJfQoKCQl9CgoJCS8vIGluZGljZXMKCgkJZm9yICggaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCWZvciAoIGl4ID0gMDsgaXggPCBncmlkWDsgaXggKysgKSB7CgoJCQkJdmFyIGEgPSBpeCArIGdyaWRYMSAqIGl5OwoJCQkJdmFyIGIgPSBpeCArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQl2YXIgYyA9ICggaXggKyAxICkgKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJdmFyIGQgPSAoIGl4ICsgMSApICsgZ3JpZFgxICogaXk7CgoJCQkJLy8gZmFjZXMKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCVBsYW5lQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglQbGFuZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBsYW5lQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqLwoKCXZhciBtYXRlcmlhbElkID0gMDsKCglmdW5jdGlvbiBNYXRlcmlhbCgpIHsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBtYXRlcmlhbElkICsrIH0gKTsKCgkJdGhpcy51dWlkID0gX01hdGguZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMubmFtZSA9ICcnOwoJCXRoaXMudHlwZSA9ICdNYXRlcmlhbCc7CgoJCXRoaXMuZm9nID0gdHJ1ZTsKCQl0aGlzLmxpZ2h0cyA9IHRydWU7CgoJCXRoaXMuYmxlbmRpbmcgPSBOb3JtYWxCbGVuZGluZzsKCQl0aGlzLnNpZGUgPSBGcm9udFNpZGU7CgkJdGhpcy5mbGF0U2hhZGluZyA9IGZhbHNlOwoJCXRoaXMudmVydGV4VGFuZ2VudHMgPSBmYWxzZTsKCQl0aGlzLnZlcnRleENvbG9ycyA9IE5vQ29sb3JzOyAvLyBUSFJFRS5Ob0NvbG9ycywgVEhSRUUuVmVydGV4Q29sb3JzLCBUSFJFRS5GYWNlQ29sb3JzCgoJCXRoaXMub3BhY2l0eSA9IDE7CgkJdGhpcy50cmFuc3BhcmVudCA9IGZhbHNlOwoKCQl0aGlzLmJsZW5kU3JjID0gU3JjQWxwaGFGYWN0b3I7CgkJdGhpcy5ibGVuZERzdCA9IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3I7CgkJdGhpcy5ibGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgkJdGhpcy5ibGVuZFNyY0FscGhhID0gbnVsbDsKCQl0aGlzLmJsZW5kRHN0QWxwaGEgPSBudWxsOwoJCXRoaXMuYmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCgkJdGhpcy5kZXB0aEZ1bmMgPSBMZXNzRXF1YWxEZXB0aDsKCQl0aGlzLmRlcHRoVGVzdCA9IHRydWU7CgkJdGhpcy5kZXB0aFdyaXRlID0gdHJ1ZTsKCgkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IG51bGw7CgkJdGhpcy5jbGlwSW50ZXJzZWN0aW9uID0gZmFsc2U7CgkJdGhpcy5jbGlwU2hhZG93cyA9IGZhbHNlOwoKCQl0aGlzLnNoYWRvd1NpZGUgPSBudWxsOwoKCQl0aGlzLmNvbG9yV3JpdGUgPSB0cnVlOwoKCQl0aGlzLnByZWNpc2lvbiA9IG51bGw7IC8vIG92ZXJyaWRlIHRoZSByZW5kZXJlcidzIGRlZmF1bHQgcHJlY2lzaW9uIGZvciB0aGlzIG1hdGVyaWFsCgoJCXRoaXMucG9seWdvbk9mZnNldCA9IGZhbHNlOwoJCXRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IDA7CgkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSAwOwoKCQl0aGlzLmRpdGhlcmluZyA9IGZhbHNlOwoKCQl0aGlzLmFscGhhVGVzdCA9IDA7CgkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBmYWxzZTsKCgkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCgkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBNYXRlcmlhbCwKCgkJaXNNYXRlcmlhbDogdHJ1ZSwKCgkJb25CZWZvcmVDb21waWxlOiBmdW5jdGlvbiAoKSB7fSwKCgkJc2V0VmFsdWVzOiBmdW5jdGlvbiAoIHZhbHVlcyApIHsKCgkJCWlmICggdmFsdWVzID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQlmb3IgKCB2YXIga2V5IGluIHZhbHVlcyApIHsKCgkJCQl2YXIgbmV3VmFsdWUgPSB2YWx1ZXNbIGtleSBdOwoKCQkJCWlmICggbmV3VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAiVEhSRUUuTWF0ZXJpYWw6ICciICsga2V5ICsgIicgcGFyYW1ldGVyIGlzIHVuZGVmaW5lZC4iICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCS8vIGZvciBiYWNrd2FyZCBjb21wYXRhYmlsaXR5IGlmIHNoYWRpbmcgaXMgc2V0IGluIHRoZSBjb25zdHJ1Y3RvcgoJCQkJaWYgKCBrZXkgPT09ICdzaGFkaW5nJyApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuJyArIHRoaXMudHlwZSArICc6IC5zaGFkaW5nIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSB0aGUgYm9vbGVhbiAuZmxhdFNoYWRpbmcgaW5zdGVhZC4nICk7CgkJCQkJdGhpcy5mbGF0U2hhZGluZyA9ICggbmV3VmFsdWUgPT09IEZsYXRTaGFkaW5nICkgPyB0cnVlIDogZmFsc2U7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCXZhciBjdXJyZW50VmFsdWUgPSB0aGlzWyBrZXkgXTsKCgkJCQlpZiAoIGN1cnJlbnRWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICJUSFJFRS4iICsgdGhpcy50eXBlICsgIjogJyIgKyBrZXkgKyAiJyBpcyBub3QgYSBwcm9wZXJ0eSBvZiB0aGlzIG1hdGVyaWFsLiIgKTsKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJaWYgKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5zZXQoIG5ld1ZhbHVlICk7CgoJCQkJfSBlbHNlIGlmICggKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzVmVjdG9yMyApICYmICggbmV3VmFsdWUgJiYgbmV3VmFsdWUuaXNWZWN0b3IzICkgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXNbIGtleSBdID0gbmV3VmFsdWU7CgoJCQkJfQoKCQkJfQoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggbWV0YSApIHsKCgkJCXZhciBpc1Jvb3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCWlmICggaXNSb290ICkgewoKCQkJCW1ldGEgPSB7CgkJCQkJdGV4dHVyZXM6IHt9LAoJCQkJCWltYWdlczoge30KCQkJCX07CgoJCQl9CgoJCQl2YXIgZGF0YSA9IHsKCQkJCW1ldGFkYXRhOiB7CgkJCQkJdmVyc2lvbjogNC41LAoJCQkJCXR5cGU6ICdNYXRlcmlhbCcsCgkJCQkJZ2VuZXJhdG9yOiAnTWF0ZXJpYWwudG9KU09OJwoJCQkJfQoJCQl9OwoKCQkJLy8gc3RhbmRhcmQgTWF0ZXJpYWwgc2VyaWFsaXphdGlvbgoJCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJCWRhdGEudHlwZSA9IHRoaXMudHlwZTsKCgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKCgkJCWlmICggdGhpcy5jb2xvciAmJiB0aGlzLmNvbG9yLmlzQ29sb3IgKSBkYXRhLmNvbG9yID0gdGhpcy5jb2xvci5nZXRIZXgoKTsKCgkJCWlmICggdGhpcy5yb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEucm91Z2huZXNzID0gdGhpcy5yb3VnaG5lc3M7CgkJCWlmICggdGhpcy5tZXRhbG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEubWV0YWxuZXNzID0gdGhpcy5tZXRhbG5lc3M7CgoJCQlpZiAoIHRoaXMuZW1pc3NpdmUgJiYgdGhpcy5lbWlzc2l2ZS5pc0NvbG9yICkgZGF0YS5lbWlzc2l2ZSA9IHRoaXMuZW1pc3NpdmUuZ2V0SGV4KCk7CgkJCWlmICggdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gMSApIGRhdGEuZW1pc3NpdmVJbnRlbnNpdHkgPSB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQkJaWYgKCB0aGlzLnNwZWN1bGFyICYmIHRoaXMuc3BlY3VsYXIuaXNDb2xvciApIGRhdGEuc3BlY3VsYXIgPSB0aGlzLnNwZWN1bGFyLmdldEhleCgpOwoJCQlpZiAoIHRoaXMuc2hpbmluZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnNoaW5pbmVzcyA9IHRoaXMuc2hpbmluZXNzOwoJCQlpZiAoIHRoaXMuY2xlYXJDb2F0ICE9PSB1bmRlZmluZWQgKSBkYXRhLmNsZWFyQ29hdCA9IHRoaXMuY2xlYXJDb2F0OwoJCQlpZiAoIHRoaXMuY2xlYXJDb2F0Um91Z2huZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLmNsZWFyQ29hdFJvdWdobmVzcyA9IHRoaXMuY2xlYXJDb2F0Um91Z2huZXNzOwoKCQkJaWYgKCB0aGlzLm1hcCAmJiB0aGlzLm1hcC5pc1RleHR1cmUgKSBkYXRhLm1hcCA9IHRoaXMubWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5hbHBoYU1hcCAmJiB0aGlzLmFscGhhTWFwLmlzVGV4dHVyZSApIGRhdGEuYWxwaGFNYXAgPSB0aGlzLmFscGhhTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5saWdodE1hcCAmJiB0aGlzLmxpZ2h0TWFwLmlzVGV4dHVyZSApIGRhdGEubGlnaHRNYXAgPSB0aGlzLmxpZ2h0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQlpZiAoIHRoaXMuYW9NYXAgJiYgdGhpcy5hb01hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5hb01hcCA9IHRoaXMuYW9NYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwoKCQkJfQoKCQkJaWYgKCB0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmJ1bXBNYXAgPSB0aGlzLmJ1bXBNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYnVtcFNjYWxlID0gdGhpcy5idW1wU2NhbGU7CgoJCQl9CgoJCQlpZiAoIHRoaXMubm9ybWFsTWFwICYmIHRoaXMubm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLm5vcm1hbE1hcCA9IHRoaXMubm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLm5vcm1hbE1hcFR5cGUgPSB0aGlzLm5vcm1hbE1hcFR5cGU7CgkJCQlkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmRpc3BsYWNlbWVudE1hcCA9IHRoaXMuZGlzcGxhY2VtZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLmRpc3BsYWNlbWVudFNjYWxlID0gdGhpcy5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJCWRhdGEuZGlzcGxhY2VtZW50QmlhcyA9IHRoaXMuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJCWlmICggdGhpcy5yb3VnaG5lc3NNYXAgJiYgdGhpcy5yb3VnaG5lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS5yb3VnaG5lc3NNYXAgPSB0aGlzLnJvdWdobmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEubWV0YWxuZXNzTWFwID0gdGhpcy5tZXRhbG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSApIGRhdGEuZW1pc3NpdmVNYXAgPSB0aGlzLmVtaXNzaXZlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhck1hcCAmJiB0aGlzLnNwZWN1bGFyTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJNYXAgPSB0aGlzLnNwZWN1bGFyTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQlpZiAoIHRoaXMuZW52TWFwICYmIHRoaXMuZW52TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmVudk1hcCA9IHRoaXMuZW52TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLnJlZmxlY3Rpdml0eSA9IHRoaXMucmVmbGVjdGl2aXR5OyAvLyBTY2FsZSBiZWhpbmQgZW52TWFwCgoJCQkJaWYgKCB0aGlzLmNvbWJpbmUgIT09IHVuZGVmaW5lZCApIGRhdGEuY29tYmluZSA9IHRoaXMuY29tYmluZTsKCQkJCWlmICggdGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwSW50ZW5zaXR5ID0gdGhpcy5lbnZNYXBJbnRlbnNpdHk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZ3JhZGllbnRNYXAgJiYgdGhpcy5ncmFkaWVudE1hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5ncmFkaWVudE1hcCA9IHRoaXMuZ3JhZGllbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJCWlmICggdGhpcy5zaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLnNpemUgPSB0aGlzLnNpemU7CgkJCWlmICggdGhpcy5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZUF0dGVudWF0aW9uID0gdGhpcy5zaXplQXR0ZW51YXRpb247CgoJCQlpZiAoIHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nICkgZGF0YS5ibGVuZGluZyA9IHRoaXMuYmxlbmRpbmc7CgkJCWlmICggdGhpcy5mbGF0U2hhZGluZyA9PT0gdHJ1ZSApIGRhdGEuZmxhdFNoYWRpbmcgPSB0aGlzLmZsYXRTaGFkaW5nOwoJCQlpZiAoIHRoaXMuc2lkZSAhPT0gRnJvbnRTaWRlICkgZGF0YS5zaWRlID0gdGhpcy5zaWRlOwoJCQlpZiAoIHRoaXMudmVydGV4Q29sb3JzICE9PSBOb0NvbG9ycyApIGRhdGEudmVydGV4Q29sb3JzID0gdGhpcy52ZXJ0ZXhDb2xvcnM7CgoJCQlpZiAoIHRoaXMub3BhY2l0eSA8IDEgKSBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CgkJCWlmICggdGhpcy50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIGRhdGEudHJhbnNwYXJlbnQgPSB0aGlzLnRyYW5zcGFyZW50OwoKCQkJZGF0YS5kZXB0aEZ1bmMgPSB0aGlzLmRlcHRoRnVuYzsKCQkJZGF0YS5kZXB0aFRlc3QgPSB0aGlzLmRlcHRoVGVzdDsKCQkJZGF0YS5kZXB0aFdyaXRlID0gdGhpcy5kZXB0aFdyaXRlOwoKCQkJLy8gcm90YXRpb24gKFNwcml0ZU1hdGVyaWFsKQoJCQlpZiAoIHRoaXMucm90YXRpb24gIT09IDAgKSBkYXRhLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKCgkJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0ID09PSB0cnVlICkgZGF0YS5wb2x5Z29uT2Zmc2V0ID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRGYWN0b3IgPSB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3I7CgkJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRVbml0cyA9IHRoaXMucG9seWdvbk9mZnNldFVuaXRzOwoKCQkJaWYgKCB0aGlzLmxpbmV3aWR0aCAhPT0gMSApIGRhdGEubGluZXdpZHRoID0gdGhpcy5saW5ld2lkdGg7CgkJCWlmICggdGhpcy5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5kYXNoU2l6ZSA9IHRoaXMuZGFzaFNpemU7CgkJCWlmICggdGhpcy5nYXBTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmdhcFNpemUgPSB0aGlzLmdhcFNpemU7CgkJCWlmICggdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zY2FsZSA9IHRoaXMuc2NhbGU7CgoJCQlpZiAoIHRoaXMuZGl0aGVyaW5nID09PSB0cnVlICkgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLmFscGhhVGVzdCA+IDAgKSBkYXRhLmFscGhhVGVzdCA9IHRoaXMuYWxwaGFUZXN0OwoJCQlpZiAoIHRoaXMucHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgZGF0YS5wcmVtdWx0aXBsaWVkQWxwaGEgPSB0aGlzLnByZW11bHRpcGxpZWRBbHBoYTsKCgkJCWlmICggdGhpcy53aXJlZnJhbWUgPT09IHRydWUgKSBkYXRhLndpcmVmcmFtZSA9IHRoaXMud2lyZWZyYW1lOwoJCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID4gMSApIGRhdGEud2lyZWZyYW1lTGluZXdpZHRoID0gdGhpcy53aXJlZnJhbWVMaW5ld2lkdGg7CgkJCWlmICggdGhpcy53aXJlZnJhbWVMaW5lY2FwICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lY2FwID0gdGhpcy53aXJlZnJhbWVMaW5lY2FwOwoJCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gIT09ICdyb3VuZCcgKSBkYXRhLndpcmVmcmFtZUxpbmVqb2luID0gdGhpcy53aXJlZnJhbWVMaW5lam9pbjsKCgkJCWlmICggdGhpcy5tb3JwaFRhcmdldHMgPT09IHRydWUgKSBkYXRhLm1vcnBoVGFyZ2V0cyA9IHRydWU7CgkJCWlmICggdGhpcy5za2lubmluZyA9PT0gdHJ1ZSApIGRhdGEuc2tpbm5pbmcgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLnZpc2libGUgPT09IGZhbHNlICkgZGF0YS52aXNpYmxlID0gZmFsc2U7CgkJCWlmICggSlNPTi5zdHJpbmdpZnkoIHRoaXMudXNlckRhdGEgKSAhPT0gJ3t9JyApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQkJLy8gVE9ETzogQ29waWVkIGZyb20gT2JqZWN0M0QudG9KU09OCgoJCQlmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKCBjYWNoZSApIHsKCgkJCQl2YXIgdmFsdWVzID0gW107CgoJCQkJZm9yICggdmFyIGtleSBpbiBjYWNoZSApIHsKCgkJCQkJdmFyIGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCgkJCX0KCgkJCWlmICggaXNSb290ICkgewoKCQkJCXZhciB0ZXh0dXJlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEudGV4dHVyZXMgKTsKCQkJCXZhciBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwoKCQkJCWlmICggdGV4dHVyZXMubGVuZ3RoID4gMCApIGRhdGEudGV4dHVyZXMgPSB0ZXh0dXJlczsKCQkJCWlmICggaW1hZ2VzLmxlbmd0aCA+IDAgKSBkYXRhLmltYWdlcyA9IGltYWdlczsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9LAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQkJdGhpcy5mb2cgPSBzb3VyY2UuZm9nOwoJCQl0aGlzLmxpZ2h0cyA9IHNvdXJjZS5saWdodHM7CgoJCQl0aGlzLmJsZW5kaW5nID0gc291cmNlLmJsZW5kaW5nOwoJCQl0aGlzLnNpZGUgPSBzb3VyY2Uuc2lkZTsKCQkJdGhpcy5mbGF0U2hhZGluZyA9IHNvdXJjZS5mbGF0U2hhZGluZzsKCQkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBzb3VyY2UudmVydGV4Q29sb3JzOwoKCQkJdGhpcy5vcGFjaXR5ID0gc291cmNlLm9wYWNpdHk7CgkJCXRoaXMudHJhbnNwYXJlbnQgPSBzb3VyY2UudHJhbnNwYXJlbnQ7CgoJCQl0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwoJCQl0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwoJCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBzb3VyY2UuYmxlbmRFcXVhdGlvbjsKCQkJdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CgkJCXRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwoJCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uQWxwaGE7CgoJCQl0aGlzLmRlcHRoRnVuYyA9IHNvdXJjZS5kZXB0aEZ1bmM7CgkJCXRoaXMuZGVwdGhUZXN0ID0gc291cmNlLmRlcHRoVGVzdDsKCQkJdGhpcy5kZXB0aFdyaXRlID0gc291cmNlLmRlcHRoV3JpdGU7CgoJCQl0aGlzLmNvbG9yV3JpdGUgPSBzb3VyY2UuY29sb3JXcml0ZTsKCgkJCXRoaXMucHJlY2lzaW9uID0gc291cmNlLnByZWNpc2lvbjsKCgkJCXRoaXMucG9seWdvbk9mZnNldCA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0OwoJCQl0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgPSBzb3VyY2UucG9seWdvbk9mZnNldEZhY3RvcjsKCQkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSBzb3VyY2UucG9seWdvbk9mZnNldFVuaXRzOwoKCQkJdGhpcy5kaXRoZXJpbmcgPSBzb3VyY2UuZGl0aGVyaW5nOwoKCQkJdGhpcy5hbHBoYVRlc3QgPSBzb3VyY2UuYWxwaGFUZXN0OwoJCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBsaWVkQWxwaGE7CgoJCQl0aGlzLnZpc2libGUgPSBzb3VyY2UudmlzaWJsZTsKCQkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQkJdGhpcy5jbGlwU2hhZG93cyA9IHNvdXJjZS5jbGlwU2hhZG93czsKCQkJdGhpcy5jbGlwSW50ZXJzZWN0aW9uID0gc291cmNlLmNsaXBJbnRlcnNlY3Rpb247CgoJCQl2YXIgc3JjUGxhbmVzID0gc291cmNlLmNsaXBwaW5nUGxhbmVzLAoJCQkJZHN0UGxhbmVzID0gbnVsbDsKCgkJCWlmICggc3JjUGxhbmVzICE9PSBudWxsICkgewoKCQkJCXZhciBuID0gc3JjUGxhbmVzLmxlbmd0aDsKCQkJCWRzdFBsYW5lcyA9IG5ldyBBcnJheSggbiApOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gbjsgKysgaSApCgkJCQkJZHN0UGxhbmVzWyBpIF0gPSBzcmNQbGFuZXNbIGkgXS5jbG9uZSgpOwoKCQkJfQoKCQkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IGRzdFBsYW5lczsKCgkJCXRoaXMuc2hhZG93U2lkZSA9IHNvdXJjZS5zaGFkb3dTaWRlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWRpc3Bvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJfSApOwoKCXZhciBkZWZhdWx0X3ZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKCXZhciBkZWZhdWx0X2ZyYWdtZW50ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggMS4wLCAwLjAsIDAuMCwgMS4wICk7XG59IjsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqICBkZWZpbmVzOiB7ICJsYWJlbCIgOiAidmFsdWUiIH0sCgkgKiAgdW5pZm9ybXM6IHsgInBhcmFtZXRlcjEiOiB7IHZhbHVlOiAxLjAgfSwgInBhcmFtZXRlcjIiOiB7IHZhbHVlMjogMiB9IH0sCgkgKgoJICogIGZyYWdtZW50U2hhZGVyOiA8c3RyaW5nPiwKCSAqICB2ZXJ0ZXhTaGFkZXI6IDxzdHJpbmc+LAoJICoKCSAqICB3aXJlZnJhbWU6IDxib29sZWFuPiwKCSAqICB3aXJlZnJhbWVMaW5ld2lkdGg6IDxmbG9hdD4sCgkgKgoJICogIGxpZ2h0czogPGJvb2w+LAoJICoKCSAqICBza2lubmluZzogPGJvb2w+LAoJICogIG1vcnBoVGFyZ2V0czogPGJvb2w+LAoJICogIG1vcnBoTm9ybWFsczogPGJvb2w+CgkgKiB9CgkgKi8KCglmdW5jdGlvbiBTaGFkZXJNYXRlcmlhbCggcGFyYW1ldGVycyApIHsKCgkJTWF0ZXJpYWwuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnU2hhZGVyTWF0ZXJpYWwnOwoKCQl0aGlzLmRlZmluZXMgPSB7fTsKCQl0aGlzLnVuaWZvcm1zID0ge307CgoJCXRoaXMudmVydGV4U2hhZGVyID0gZGVmYXVsdF92ZXJ0ZXg7CgkJdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CgoJCXRoaXMubGluZXdpZHRoID0gMTsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCXRoaXMuZm9nID0gZmFsc2U7IC8vIHNldCB0byB1c2Ugc2NlbmUgZm9nCgkJdGhpcy5saWdodHMgPSBmYWxzZTsgLy8gc2V0IHRvIHVzZSBzY2VuZSBsaWdodHMKCQl0aGlzLmNsaXBwaW5nID0gZmFsc2U7IC8vIHNldCB0byB1c2UgdXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcwoKCQl0aGlzLnNraW5uaW5nID0gZmFsc2U7IC8vIHNldCB0byB1c2Ugc2tpbm5pbmcgYXR0cmlidXRlIHN0cmVhbXMKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOyAvLyBzZXQgdG8gdXNlIG1vcnBoIHRhcmdldHMKCQl0aGlzLm1vcnBoTm9ybWFscyA9IGZhbHNlOyAvLyBzZXQgdG8gdXNlIG1vcnBoIG5vcm1hbHMKCgkJdGhpcy5leHRlbnNpb25zID0gewoJCQlkZXJpdmF0aXZlczogZmFsc2UsIC8vIHNldCB0byB1c2UgZGVyaXZhdGl2ZXMKCQkJZnJhZ0RlcHRoOiBmYWxzZSwgLy8gc2V0IHRvIHVzZSBmcmFnbWVudCBkZXB0aCB2YWx1ZXMKCQkJZHJhd0J1ZmZlcnM6IGZhbHNlLCAvLyBzZXQgdG8gdXNlIGRyYXcgYnVmZmVycwoJCQlzaGFkZXJUZXh0dXJlTE9EOiBmYWxzZSAvLyBzZXQgdG8gdXNlIHNoYWRlciB0ZXh0dXJlIExPRAoJCX07CgoJCS8vIFdoZW4gcmVuZGVyZWQgZ2VvbWV0cnkgZG9lc24ndCBpbmNsdWRlIHRoZXNlIGF0dHJpYnV0ZXMgYnV0IHRoZSBtYXRlcmlhbCBkb2VzLAoJCS8vIHVzZSB0aGVzZSBkZWZhdWx0IHZhbHVlcyBpbiBXZWJHTC4gVGhpcyBhdm9pZHMgZXJyb3JzIHdoZW4gYnVmZmVyIGRhdGEgaXMgbWlzc2luZy4KCQl0aGlzLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgPSB7CgkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAoJCQkndXYnOiBbIDAsIDAgXSwKCQkJJ3V2Mic6IFsgMCwgMCBdCgkJfTsKCgkJdGhpcy5pbmRleDBBdHRyaWJ1dGVOYW1lID0gdW5kZWZpbmVkOwoJCXRoaXMudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCWlmICggcGFyYW1ldGVycyAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBwYXJhbWV0ZXJzLmF0dHJpYnV0ZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuU2hhZGVyTWF0ZXJpYWw6IGF0dHJpYnV0ZXMgc2hvdWxkIG5vdyBiZSBkZWZpbmVkIGluIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuJyApOwoKCQkJfQoKCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJfQoKCX0KCglTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNYXRlcmlhbC5wcm90b3R5cGUgKTsKCVNoYWRlck1hdGVyaWFsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNoYWRlck1hdGVyaWFsOwoKCVNoYWRlck1hdGVyaWFsLnByb3RvdHlwZS5pc1NoYWRlck1hdGVyaWFsID0gdHJ1ZTsKCglTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlNYXRlcmlhbC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5mcmFnbWVudFNoYWRlciA9IHNvdXJjZS5mcmFnbWVudFNoYWRlcjsKCQl0aGlzLnZlcnRleFNoYWRlciA9IHNvdXJjZS52ZXJ0ZXhTaGFkZXI7CgoJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKCgkJdGhpcy5kZWZpbmVzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5kZWZpbmVzICk7CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgoJCXRoaXMubGlnaHRzID0gc291cmNlLmxpZ2h0czsKCQl0aGlzLmNsaXBwaW5nID0gc291cmNlLmNsaXBwaW5nOwoKCQl0aGlzLnNraW5uaW5nID0gc291cmNlLnNraW5uaW5nOwoKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwoKCQl0aGlzLmV4dGVuc2lvbnMgPSBzb3VyY2UuZXh0ZW5zaW9uczsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCglTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCBtZXRhICkgewoKCQl2YXIgZGF0YSA9IE1hdGVyaWFsLnByb3RvdHlwZS50b0pTT04uY2FsbCggdGhpcywgbWV0YSApOwoKCQlkYXRhLnVuaWZvcm1zID0ge307CgoJCWZvciAoIHZhciBuYW1lIGluIHRoaXMudW5pZm9ybXMgKSB7CgoJCQl2YXIgdW5pZm9ybSA9IHRoaXMudW5pZm9ybXNbIG5hbWUgXTsKCQkJdmFyIHZhbHVlID0gdW5pZm9ybS52YWx1ZTsKCgkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAndCcsCgkJCQkJdmFsdWU6IHZhbHVlLnRvSlNPTiggbWV0YSApLnV1aWQKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAnYycsCgkJCQkJdmFsdWU6IHZhbHVlLmdldEhleCgpCgkJCQl9OwoKCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3IyICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAndjInLAoJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjMgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICd2MycsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yNCApIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdHlwZTogJ3Y0JywKCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQl9OwoKCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNNYXRyaXgzICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAnbTMnLAoJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDQgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICdtNCcsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXZhbHVlOiB2YWx1ZQoJCQkJfTsKCgkJCQkvLyBub3RlOiB0aGUgYXJyYXkgdmFyaWFudHMgdjJ2LCB2M3YsIHY0diwgbTR2IGFuZCB0diBhcmUgbm90IHN1cHBvcnRlZCBzbyBmYXIKCgkJCX0KCgkJfQoKCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLmRlZmluZXMgKS5sZW5ndGggPiAwICkgZGF0YS5kZWZpbmVzID0gdGhpcy5kZWZpbmVzOwoKCQlkYXRhLnZlcnRleFNoYWRlciA9IHRoaXMudmVydGV4U2hhZGVyOwoJCWRhdGEuZnJhZ21lbnRTaGFkZXIgPSB0aGlzLmZyYWdtZW50U2hhZGVyOwoKCQl2YXIgZXh0ZW5zaW9ucyA9IHt9OwoKCQlmb3IgKCB2YXIga2V5IGluIHRoaXMuZXh0ZW5zaW9ucyApIHsKCgkJCWlmICggdGhpcy5leHRlbnNpb25zWyBrZXkgXSA9PT0gdHJ1ZSApIGV4dGVuc2lvbnNbIGtleSBdID0gdHJ1ZTsKCgkJfQoKCQlpZiAoIE9iamVjdC5rZXlzKCBleHRlbnNpb25zICkubGVuZ3RoID4gMCApIGRhdGEuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnM7CgoJCXJldHVybiBkYXRhOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKi8KCglmdW5jdGlvbiBSYXkoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQl0aGlzLm9yaWdpbiA9ICggb3JpZ2luICE9PSB1bmRlZmluZWQgKSA/IG9yaWdpbiA6IG5ldyBWZWN0b3IzKCk7CgkJdGhpcy5kaXJlY3Rpb24gPSAoIGRpcmVjdGlvbiAhPT0gdW5kZWZpbmVkICkgPyBkaXJlY3Rpb24gOiBuZXcgVmVjdG9yMygpOwoKCX0KCglPYmplY3QuYXNzaWduKCBSYXkucHJvdG90eXBlLCB7CgoJCXNldDogZnVuY3Rpb24gKCBvcmlnaW4sIGRpcmVjdGlvbiApIHsKCgkJCXRoaXMub3JpZ2luLmNvcHkoIG9yaWdpbiApOwoJCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCBkaXJlY3Rpb24gKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9LAoKCQljb3B5OiBmdW5jdGlvbiAoIHJheSApIHsKCgkJCXRoaXMub3JpZ2luLmNvcHkoIHJheS5vcmlnaW4gKTsKCQkJdGhpcy5kaXJlY3Rpb24uY29weSggcmF5LmRpcmVjdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWF0OiBmdW5jdGlvbiAoIHQsIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUmF5OiAuYXQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5kaXJlY3Rpb24gKS5tdWx0aXBseVNjYWxhciggdCApLmFkZCggdGhpcy5vcmlnaW4gKTsKCgkJfSwKCgkJbG9va0F0OiBmdW5jdGlvbiAoIHYgKSB7CgoJCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCB2ICkuc3ViKCB0aGlzLm9yaWdpbiApLm5vcm1hbGl6ZSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXJlY2FzdDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiByZWNhc3QoIHQgKSB7CgoJCQkJdGhpcy5vcmlnaW4uY29weSggdGhpcy5hdCggdCwgdjEgKSApOwoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpLAoKCQljbG9zZXN0UG9pbnRUb1BvaW50OiBmdW5jdGlvbiAoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlJheTogLmNsb3Nlc3RQb2ludFRvUG9pbnQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCgkJCXZhciBkaXJlY3Rpb25EaXN0YW5jZSA9IHRhcmdldC5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgoJCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMub3JpZ2luICk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMuZGlyZWN0aW9uICkubXVsdGlwbHlTY2FsYXIoIGRpcmVjdGlvbkRpc3RhbmNlICkuYWRkKCB0aGlzLm9yaWdpbiApOwoKCQl9LAoKCQlkaXN0YW5jZVRvUG9pbnQ6IGZ1bmN0aW9uICggcG9pbnQgKSB7CgoJCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApICk7CgoJCX0sCgoJCWRpc3RhbmNlU3FUb1BvaW50OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApIHsKCgkJCQl2YXIgZGlyZWN0aW9uRGlzdGFuY2UgPSB2MS5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKS5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgoJCQkJLy8gcG9pbnQgYmVoaW5kIHRoZSByYXkKCgkJCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCQkJcmV0dXJuIHRoaXMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKCBwb2ludCApOwoKCQkJCX0KCgkJCQl2MS5jb3B5KCB0aGlzLmRpcmVjdGlvbiApLm11bHRpcGx5U2NhbGFyKCBkaXJlY3Rpb25EaXN0YW5jZSApLmFkZCggdGhpcy5vcmlnaW4gKTsKCgkJCQlyZXR1cm4gdjEuZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCQl9OwoKCQl9KCksCgoJCWRpc3RhbmNlU3FUb1NlZ21lbnQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBzZWdDZW50ZXIgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgc2VnRGlyID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGRpZmYgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGRpc3RhbmNlU3FUb1NlZ21lbnQoIHYwLCB2MSwgb3B0aW9uYWxQb2ludE9uUmF5LCBvcHRpb25hbFBvaW50T25TZWdtZW50ICkgewoKCQkJCS8vIGZyb20gaHR0cDovL3d3dy5nZW9tZXRyaWN0b29scy5jb20vR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVEaXN0UmF5U2VnbWVudC5oCgkJCQkvLyBJdCByZXR1cm5zIHRoZSBtaW4gZGlzdGFuY2UgYmV0d2VlbiB0aGUgcmF5IGFuZCB0aGUgc2VnbWVudAoJCQkJLy8gZGVmaW5lZCBieSB2MCBhbmQgdjEKCQkJCS8vIEl0IGNhbiBhbHNvIHNldCB0d28gb3B0aW9uYWwgdGFyZ2V0cyA6CgkJCQkvLyAtIFRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSByYXkKCQkJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNlZ21lbnQKCgkJCQlzZWdDZW50ZXIuY29weSggdjAgKS5hZGQoIHYxICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoJCQkJc2VnRGlyLmNvcHkoIHYxICkuc3ViKCB2MCApLm5vcm1hbGl6ZSgpOwoJCQkJZGlmZi5jb3B5KCB0aGlzLm9yaWdpbiApLnN1Yiggc2VnQ2VudGVyICk7CgoJCQkJdmFyIHNlZ0V4dGVudCA9IHYwLmRpc3RhbmNlVG8oIHYxICkgKiAwLjU7CgkJCQl2YXIgYTAxID0gLSB0aGlzLmRpcmVjdGlvbi5kb3QoIHNlZ0RpciApOwoJCQkJdmFyIGIwID0gZGlmZi5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJCQl2YXIgYjEgPSAtIGRpZmYuZG90KCBzZWdEaXIgKTsKCQkJCXZhciBjID0gZGlmZi5sZW5ndGhTcSgpOwoJCQkJdmFyIGRldCA9IE1hdGguYWJzKCAxIC0gYTAxICogYTAxICk7CgkJCQl2YXIgczAsIHMxLCBzcXJEaXN0LCBleHREZXQ7CgoJCQkJaWYgKCBkZXQgPiAwICkgewoKCQkJCQkvLyBUaGUgcmF5IGFuZCBzZWdtZW50IGFyZSBub3QgcGFyYWxsZWwuCgoJCQkJCXMwID0gYTAxICogYjEgLSBiMDsKCQkJCQlzMSA9IGEwMSAqIGIwIC0gYjE7CgkJCQkJZXh0RGV0ID0gc2VnRXh0ZW50ICogZGV0OwoKCQkJCQlpZiAoIHMwID49IDAgKSB7CgoJCQkJCQlpZiAoIHMxID49IC0gZXh0RGV0ICkgewoKCQkJCQkJCWlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkJCQkvLyByZWdpb24gMAoJCQkJCQkJCS8vIE1pbmltdW0gYXQgaW50ZXJpb3IgcG9pbnRzIG9mIHJheSBhbmQgc2VnbWVudC4KCgkJCQkJCQkJdmFyIGludkRldCA9IDEgLyBkZXQ7CgkJCQkJCQkJczAgKj0gaW52RGV0OwoJCQkJCQkJCXMxICo9IGludkRldDsKCQkJCQkJCQlzcXJEaXN0ID0gczAgKiAoIHMwICsgYTAxICogczEgKyAyICogYjAgKSArIHMxICogKCBhMDEgKiBzMCArIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCS8vIHJlZ2lvbiAxCgoJCQkJCQkJCXMxID0gc2VnRXh0ZW50OwoJCQkJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCBhMDEgKiBzMSArIGIwICkgKTsKCQkJCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJLy8gcmVnaW9uIDUKCgkJCQkJCQlzMSA9IC0gc2VnRXh0ZW50OwoJCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggczEgPD0gLSBleHREZXQgKSB7CgoJCQkJCQkJLy8gcmVnaW9uIDQKCgkJCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggLSBhMDEgKiBzZWdFeHRlbnQgKyBiMCApICk7CgkJCQkJCQlzMSA9ICggczAgPiAwICkgPyAtIHNlZ0V4dGVudCA6IE1hdGgubWluKCBNYXRoLm1heCggLSBzZWdFeHRlbnQsIC0gYjEgKSwgc2VnRXh0ZW50ICk7CgkJCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQkJfSBlbHNlIGlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkJCS8vIHJlZ2lvbiAzCgoJCQkJCQkJczAgPSAwOwoJCQkJCQkJczEgPSBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCQkJc3FyRGlzdCA9IHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJLy8gcmVnaW9uIDIKCgkJCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogc2VnRXh0ZW50ICsgYjAgKSApOwoJCQkJCQkJczEgPSAoIHMwID4gMCApID8gc2VnRXh0ZW50IDogTWF0aC5taW4oIE1hdGgubWF4KCAtIHNlZ0V4dGVudCwgLSBiMSApLCBzZWdFeHRlbnQgKTsKCQkJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBSYXkgYW5kIHNlZ21lbnQgYXJlIHBhcmFsbGVsLgoKCQkJCQlzMSA9ICggYTAxID4gMCApID8gLSBzZWdFeHRlbnQgOiBzZWdFeHRlbnQ7CgkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfQoKCQkJCWlmICggb3B0aW9uYWxQb2ludE9uUmF5ICkgewoKCQkJCQlvcHRpb25hbFBvaW50T25SYXkuY29weSggdGhpcy5kaXJlY3Rpb24gKS5tdWx0aXBseVNjYWxhciggczAgKS5hZGQoIHRoaXMub3JpZ2luICk7CgoJCQkJfQoKCQkJCWlmICggb3B0aW9uYWxQb2ludE9uU2VnbWVudCApIHsKCgkJCQkJb3B0aW9uYWxQb2ludE9uU2VnbWVudC5jb3B5KCBzZWdEaXIgKS5tdWx0aXBseVNjYWxhciggczEgKS5hZGQoIHNlZ0NlbnRlciApOwoKCQkJCX0KCgkJCQlyZXR1cm4gc3FyRGlzdDsKCgkJCX07CgoJCX0oKSwKCgkJaW50ZXJzZWN0U3BoZXJlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGludGVyc2VjdFNwaGVyZSggc3BoZXJlLCB0YXJnZXQgKSB7CgoJCQkJdjEuc3ViVmVjdG9ycyggc3BoZXJlLmNlbnRlciwgdGhpcy5vcmlnaW4gKTsKCQkJCXZhciB0Y2EgPSB2MS5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJCQl2YXIgZDIgPSB2MS5kb3QoIHYxICkgLSB0Y2EgKiB0Y2E7CgkJCQl2YXIgcmFkaXVzMiA9IHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzOwoKCQkJCWlmICggZDIgPiByYWRpdXMyICkgcmV0dXJuIG51bGw7CgoJCQkJdmFyIHRoYyA9IE1hdGguc3FydCggcmFkaXVzMiAtIGQyICk7CgoJCQkJLy8gdDAgPSBmaXJzdCBpbnRlcnNlY3QgcG9pbnQgLSBlbnRyYW5jZSBvbiBmcm9udCBvZiBzcGhlcmUKCQkJCXZhciB0MCA9IHRjYSAtIHRoYzsKCgkJCQkvLyB0MSA9IHNlY29uZCBpbnRlcnNlY3QgcG9pbnQgLSBleGl0IHBvaW50IG9uIGJhY2sgb2Ygc3BoZXJlCgkJCQl2YXIgdDEgPSB0Y2EgKyB0aGM7CgoJCQkJLy8gdGVzdCB0byBzZWUgaWYgYm90aCB0MCBhbmQgdDEgYXJlIGJlaGluZCB0aGUgcmF5IC0gaWYgc28sIHJldHVybiBudWxsCgkJCQlpZiAoIHQwIDwgMCAmJiB0MSA8IDAgKSByZXR1cm4gbnVsbDsKCgkJCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKCQkJCS8vIGlmIGl0IGlzLCB0aGUgcmF5IGlzIGluc2lkZSB0aGUgc3BoZXJlLCBzbyByZXR1cm4gdGhlIHNlY29uZCBleGl0IHBvaW50IHNjYWxlZCBieSB0MSwKCQkJCS8vIGluIG9yZGVyIHRvIGFsd2F5cyByZXR1cm4gYW4gaW50ZXJzZWN0IHBvaW50IHRoYXQgaXMgaW4gZnJvbnQgb2YgdGhlIHJheS4KCQkJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCgkJCQkvLyBlbHNlIHQwIGlzIGluIGZyb250IG9mIHRoZSByYXksIHNvIHJldHVybiB0aGUgZmlyc3QgY29sbGlzaW9uIHBvaW50IHNjYWxlZCBieSB0MAoJCQkJcmV0dXJuIHRoaXMuYXQoIHQwLCB0YXJnZXQgKTsKCgkJCX07CgoJCX0oKSwKCgkJaW50ZXJzZWN0c1NwaGVyZTogZnVuY3Rpb24gKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gdGhpcy5kaXN0YW5jZVNxVG9Qb2ludCggc3BoZXJlLmNlbnRlciApIDw9ICggc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXMgKTsKCgkJfSwKCgkJZGlzdGFuY2VUb1BsYW5lOiBmdW5jdGlvbiAoIHBsYW5lICkgewoKCQkJdmFyIGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgoJCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICkgPT09IDAgKSB7CgoJCQkJCXJldHVybiAwOwoKCQkJCX0KCgkJCQkvLyBOdWxsIGlzIHByZWZlcmFibGUgdG8gdW5kZWZpbmVkIHNpbmNlIHVuZGVmaW5lZCBtZWFucy4uLi4gaXQgaXMgdW5kZWZpbmVkCgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQl2YXIgdCA9IC0gKCB0aGlzLm9yaWdpbi5kb3QoIHBsYW5lLm5vcm1hbCApICsgcGxhbmUuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkJLy8gUmV0dXJuIGlmIHRoZSByYXkgbmV2ZXIgaW50ZXJzZWN0cyB0aGUgcGxhbmUKCgkJCXJldHVybiB0ID49IDAgPyB0IDogbnVsbDsKCgkJfSwKCgkJaW50ZXJzZWN0UGxhbmU6IGZ1bmN0aW9uICggcGxhbmUsIHRhcmdldCApIHsKCgkJCXZhciB0ID0gdGhpcy5kaXN0YW5jZVRvUGxhbmUoIHBsYW5lICk7CgoJCQlpZiAoIHQgPT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQlyZXR1cm4gdGhpcy5hdCggdCwgdGFyZ2V0ICk7CgoJCX0sCgoJCWludGVyc2VjdHNQbGFuZTogZnVuY3Rpb24gKCBwbGFuZSApIHsKCgkJCS8vIGNoZWNrIGlmIHRoZSByYXkgbGllcyBvbiB0aGUgcGxhbmUgZmlyc3QKCgkJCXZhciBkaXN0VG9Qb2ludCA9IHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5vcmlnaW4gKTsKCgkJCWlmICggZGlzdFRvUG9pbnQgPT09IDAgKSB7CgoJCQkJcmV0dXJuIHRydWU7CgoJCQl9CgoJCQl2YXIgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKCQkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCgkJCXJldHVybiBmYWxzZTsKCgkJfSwKCgkJaW50ZXJzZWN0Qm94OiBmdW5jdGlvbiAoIGJveCwgdGFyZ2V0ICkgewoKCQkJdmFyIHRtaW4sIHRtYXgsIHR5bWluLCB0eW1heCwgdHptaW4sIHR6bWF4OwoKCQkJdmFyIGludmRpcnggPSAxIC8gdGhpcy5kaXJlY3Rpb24ueCwKCQkJCWludmRpcnkgPSAxIC8gdGhpcy5kaXJlY3Rpb24ueSwKCQkJCWludmRpcnogPSAxIC8gdGhpcy5kaXJlY3Rpb24uejsKCgkJCXZhciBvcmlnaW4gPSB0aGlzLm9yaWdpbjsKCgkJCWlmICggaW52ZGlyeCA+PSAwICkgewoKCQkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1heC54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9IGVsc2UgewoKCQkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1pbi54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9CgoJCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCgkJCQl0eW1pbiA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgkJCQl0eW1heCA9ICggYm94Lm1heC55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgoJCQl9IGVsc2UgewoKCQkJCXR5bWluID0gKCBib3gubWF4LnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCQkJCXR5bWF4ID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCgkJCX0KCgkJCWlmICggKCB0bWluID4gdHltYXggKSB8fCAoIHR5bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgoJCQkvLyBUaGVzZSBsaW5lcyBhbHNvIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0bWluIG9yIHRtYXggaXMgTmFOCgkJCS8vIChyZXN1bHQgb2YgMCAqIEluZmluaXR5KS4geCAhPT0geCByZXR1cm5zIHRydWUgaWYgeCBpcyBOYU4KCgkJCWlmICggdHltaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHltaW47CgoJCQlpZiAoIHR5bWF4IDwgdG1heCB8fCB0bWF4ICE9PSB0bWF4ICkgdG1heCA9IHR5bWF4OwoKCQkJaWYgKCBpbnZkaXJ6ID49IDAgKSB7CgoJCQkJdHptaW4gPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoJCQkJdHptYXggPSAoIGJveC5tYXgueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKCQkJfSBlbHNlIHsKCgkJCQl0em1pbiA9ICggYm94Lm1heC56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CgkJCQl0em1heCA9ICggYm94Lm1pbi56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CgoJCQl9CgoJCQlpZiAoICggdG1pbiA+IHR6bWF4ICkgfHwgKCB0em1pbiA+IHRtYXggKSApIHJldHVybiBudWxsOwoKCQkJaWYgKCB0em1pbiA+IHRtaW4gfHwgdG1pbiAhPT0gdG1pbiApIHRtaW4gPSB0em1pbjsKCgkJCWlmICggdHptYXggPCB0bWF4IHx8IHRtYXggIT09IHRtYXggKSB0bWF4ID0gdHptYXg7CgoJCQkvL3JldHVybiBwb2ludCBjbG9zZXN0IHRvIHRoZSByYXkgKHBvc2l0aXZlIHNpZGUpCgoJCQlpZiAoIHRtYXggPCAwICkgcmV0dXJuIG51bGw7CgoJCQlyZXR1cm4gdGhpcy5hdCggdG1pbiA+PSAwID8gdG1pbiA6IHRtYXgsIHRhcmdldCApOwoKCQl9LAoKCQlpbnRlcnNlY3RzQm94OiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2ID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0Qm94KCBib3gsIHYgKSAhPT0gbnVsbDsKCgkJCX07CgoJCX0gKSgpLAoKCQlpbnRlcnNlY3RUcmlhbmdsZTogZnVuY3Rpb24gKCkgewoKCQkJLy8gQ29tcHV0ZSB0aGUgb2Zmc2V0IG9yaWdpbiwgZWRnZXMsIGFuZCBub3JtYWwuCgkJCXZhciBkaWZmID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGVkZ2UxID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGVkZ2UyID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKCQkJCS8vIGZyb20gaHR0cDovL3d3dy5nZW9tZXRyaWN0b29scy5jb20vR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVJbnRyUmF5M1RyaWFuZ2xlMy5oCgoJCQkJZWRnZTEuc3ViVmVjdG9ycyggYiwgYSApOwoJCQkJZWRnZTIuc3ViVmVjdG9ycyggYywgYSApOwoJCQkJbm9ybWFsLmNyb3NzVmVjdG9ycyggZWRnZTEsIGVkZ2UyICk7CgoJCQkJLy8gU29sdmUgUSArIHQqRCA9IGIxKkUxICsgYjIqRTIgKFEgPSBrRGlmZiwgRCA9IHJheSBkaXJlY3Rpb24sCgkJCQkvLyBFMSA9IGtFZGdlMSwgRTIgPSBrRWRnZTIsIE4gPSBDcm9zcyhFMSxFMikpIGJ5CgkJCQkvLyAgIHxEb3QoRCxOKXwqYjEgPSBzaWduKERvdChELE4pKSpEb3QoRCxDcm9zcyhRLEUyKSkKCQkJCS8vICAgfERvdChELE4pfCpiMiA9IHNpZ24oRG90KEQsTikpKkRvdChELENyb3NzKEUxLFEpKQoJCQkJLy8gICB8RG90KEQsTil8KnQgPSAtc2lnbihEb3QoRCxOKSkqRG90KFEsTikKCQkJCXZhciBEZE4gPSB0aGlzLmRpcmVjdGlvbi5kb3QoIG5vcm1hbCApOwoJCQkJdmFyIHNpZ247CgoJCQkJaWYgKCBEZE4gPiAwICkgewoKCQkJCQlpZiAoIGJhY2tmYWNlQ3VsbGluZyApIHJldHVybiBudWxsOwoJCQkJCXNpZ24gPSAxOwoKCQkJCX0gZWxzZSBpZiAoIERkTiA8IDAgKSB7CgoJCQkJCXNpZ24gPSAtIDE7CgkJCQkJRGROID0gLSBEZE47CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJCWRpZmYuc3ViVmVjdG9ycyggdGhpcy5vcmlnaW4sIGEgKTsKCQkJCXZhciBEZFF4RTIgPSBzaWduICogdGhpcy5kaXJlY3Rpb24uZG90KCBlZGdlMi5jcm9zc1ZlY3RvcnMoIGRpZmYsIGVkZ2UyICkgKTsKCgkJCQkvLyBiMSA8IDAsIG5vIGludGVyc2VjdGlvbgoJCQkJaWYgKCBEZFF4RTIgPCAwICkgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQkJdmFyIERkRTF4USA9IHNpZ24gKiB0aGlzLmRpcmVjdGlvbi5kb3QoIGVkZ2UxLmNyb3NzKCBkaWZmICkgKTsKCgkJCQkvLyBiMiA8IDAsIG5vIGludGVyc2VjdGlvbgoJCQkJaWYgKCBEZEUxeFEgPCAwICkgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQkJLy8gYjErYjIgPiAxLCBubyBpbnRlcnNlY3Rpb24KCQkJCWlmICggRGRReEUyICsgRGRFMXhRID4gRGROICkgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQkJLy8gTGluZSBpbnRlcnNlY3RzIHRyaWFuZ2xlLCBjaGVjayBpZiByYXkgZG9lcy4KCQkJCXZhciBRZE4gPSAtIHNpZ24gKiBkaWZmLmRvdCggbm9ybWFsICk7CgoJCQkJLy8gdCA8IDAsIG5vIGludGVyc2VjdGlvbgoJCQkJaWYgKCBRZE4gPCAwICkgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQkJLy8gUmF5IGludGVyc2VjdHMgdHJpYW5nbGUuCgkJCQlyZXR1cm4gdGhpcy5hdCggUWROIC8gRGROLCB0YXJnZXQgKTsKCgkJCX07CgoJCX0oKSwKCgkJYXBwbHlNYXRyaXg0OiBmdW5jdGlvbiAoIG1hdHJpeDQgKSB7CgoJCQl0aGlzLm9yaWdpbi5hcHBseU1hdHJpeDQoIG1hdHJpeDQgKTsKCQkJdGhpcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCBtYXRyaXg0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIHJheSApIHsKCgkJCXJldHVybiByYXkub3JpZ2luLmVxdWFscyggdGhpcy5vcmlnaW4gKSAmJiByYXkuZGlyZWN0aW9uLmVxdWFscyggdGhpcy5kaXJlY3Rpb24gKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBUcmlhbmdsZSggYSwgYiwgYyApIHsKCgkJdGhpcy5hID0gKCBhICE9PSB1bmRlZmluZWQgKSA/IGEgOiBuZXcgVmVjdG9yMygpOwoJCXRoaXMuYiA9ICggYiAhPT0gdW5kZWZpbmVkICkgPyBiIDogbmV3IFZlY3RvcjMoKTsKCQl0aGlzLmMgPSAoIGMgIT09IHVuZGVmaW5lZCApID8gYyA6IG5ldyBWZWN0b3IzKCk7CgoJfQoKCU9iamVjdC5hc3NpZ24oIFRyaWFuZ2xlLCB7CgoJCWdldE5vcm1hbDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYwID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBnZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApIHsKCgkJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmdldE5vcm1hbCgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCQl9CgoJCQkJdGFyZ2V0LnN1YlZlY3RvcnMoIGMsIGIgKTsKCQkJCXYwLnN1YlZlY3RvcnMoIGEsIGIgKTsKCQkJCXRhcmdldC5jcm9zcyggdjAgKTsKCgkJCQl2YXIgdGFyZ2V0TGVuZ3RoU3EgPSB0YXJnZXQubGVuZ3RoU3EoKTsKCQkJCWlmICggdGFyZ2V0TGVuZ3RoU3EgPiAwICkgewoKCQkJCQlyZXR1cm4gdGFyZ2V0Lm11bHRpcGx5U2NhbGFyKCAxIC8gTWF0aC5zcXJ0KCB0YXJnZXRMZW5ndGhTcSApICk7CgoJCQkJfQoKCQkJCXJldHVybiB0YXJnZXQuc2V0KCAwLCAwLCAwICk7CgoJCQl9OwoKCQl9KCksCgoJCS8vIHN0YXRpYy9pbnN0YW5jZSBtZXRob2QgdG8gY2FsY3VsYXRlIGJhcnljZW50cmljIGNvb3JkaW5hdGVzCgkJLy8gYmFzZWQgb246IGh0dHA6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9kZWZhdWx0Lmh0bWwKCQlnZXRCYXJ5Y29vcmQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MCA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gZ2V0QmFyeWNvb3JkKCBwb2ludCwgYSwgYiwgYywgdGFyZ2V0ICkgewoKCQkJCXYwLnN1YlZlY3RvcnMoIGMsIGEgKTsKCQkJCXYxLnN1YlZlY3RvcnMoIGIsIGEgKTsKCQkJCXYyLnN1YlZlY3RvcnMoIHBvaW50LCBhICk7CgoJCQkJdmFyIGRvdDAwID0gdjAuZG90KCB2MCApOwoJCQkJdmFyIGRvdDAxID0gdjAuZG90KCB2MSApOwoJCQkJdmFyIGRvdDAyID0gdjAuZG90KCB2MiApOwoJCQkJdmFyIGRvdDExID0gdjEuZG90KCB2MSApOwoJCQkJdmFyIGRvdDEyID0gdjEuZG90KCB2MiApOwoKCQkJCXZhciBkZW5vbSA9ICggZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEgKTsKCgkJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmdldEJhcnljb29yZCgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCQl9CgoJCQkJLy8gY29sbGluZWFyIG9yIHNpbmd1bGFyIHRyaWFuZ2xlCgkJCQlpZiAoIGRlbm9tID09PSAwICkgewoKCQkJCQkvLyBhcmJpdHJhcnkgbG9jYXRpb24gb3V0c2lkZSBvZiB0cmlhbmdsZT8KCQkJCQkvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIHRoZSBiZXN0IGlkZWEsIG1heWJlIHNob3VsZCBiZSByZXR1cm5pbmcgdW5kZWZpbmVkCgkJCQkJcmV0dXJuIHRhcmdldC5zZXQoIC0gMiwgLSAxLCAtIDEgKTsKCgkJCQl9CgoJCQkJdmFyIGludkRlbm9tID0gMSAvIGRlbm9tOwoJCQkJdmFyIHUgPSAoIGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyICkgKiBpbnZEZW5vbTsKCQkJCXZhciB2ID0gKCBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMiApICogaW52RGVub207CgoJCQkJLy8gYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgbXVzdCBhbHdheXMgc3VtIHRvIDEKCQkJCXJldHVybiB0YXJnZXQuc2V0KCAxIC0gdSAtIHYsIHYsIHUgKTsKCgkJCX07CgoJCX0oKSwKCgkJY29udGFpbnNQb2ludDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjb250YWluc1BvaW50KCBwb2ludCwgYSwgYiwgYyApIHsKCgkJCQlUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCB2MSApOwoKCQkJCXJldHVybiAoIHYxLnggPj0gMCApICYmICggdjEueSA+PSAwICkgJiYgKCAoIHYxLnggKyB2MS55ICkgPD0gMSApOwoKCQkJfTsKCgkJfSgpLAoKCQlnZXRVVjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGJhcnljb29yZCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gZ2V0VVYoIHBvaW50LCBwMSwgcDIsIHAzLCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKSB7CgoJCQkJdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBwMSwgcDIsIHAzLCBiYXJ5Y29vcmQgKTsKCgkJCQl0YXJnZXQuc2V0KCAwLCAwICk7CgkJCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB1djEsIGJhcnljb29yZC54ICk7CgkJCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB1djIsIGJhcnljb29yZC55ICk7CgkJCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB1djMsIGJhcnljb29yZC56ICk7CgoJCQkJcmV0dXJuIHRhcmdldDsKCgkJCX07CgoJCX0oKQoKCX0gKTsKCglPYmplY3QuYXNzaWduKCBUcmlhbmdsZS5wcm90b3R5cGUsIHsKCgkJc2V0OiBmdW5jdGlvbiAoIGEsIGIsIGMgKSB7CgoJCQl0aGlzLmEuY29weSggYSApOwoJCQl0aGlzLmIuY29weSggYiApOwoJCQl0aGlzLmMuY29weSggYyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldEZyb21Qb2ludHNBbmRJbmRpY2VzOiBmdW5jdGlvbiAoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCgkJCXRoaXMuYS5jb3B5KCBwb2ludHNbIGkwIF0gKTsKCQkJdGhpcy5iLmNvcHkoIHBvaW50c1sgaTEgXSApOwoJCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCB0cmlhbmdsZSApIHsKCgkJCXRoaXMuYS5jb3B5KCB0cmlhbmdsZS5hICk7CgkJCXRoaXMuYi5jb3B5KCB0cmlhbmdsZS5iICk7CgkJCXRoaXMuYy5jb3B5KCB0cmlhbmdsZS5jICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0QXJlYTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYwID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBnZXRBcmVhKCkgewoKCQkJCXYwLnN1YlZlY3RvcnMoIHRoaXMuYywgdGhpcy5iICk7CgkJCQl2MS5zdWJWZWN0b3JzKCB0aGlzLmEsIHRoaXMuYiApOwoKCQkJCXJldHVybiB2MC5jcm9zcyggdjEgKS5sZW5ndGgoKSAqIDAuNTsKCgkJCX07CgoJCX0oKSwKCgkJZ2V0TWlkcG9pbnQ6IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmdldE1pZHBvaW50KCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCgkJfSwKCgkJZ2V0Tm9ybWFsOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiBUcmlhbmdsZS5nZXROb3JtYWwoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCQl9LAoKCQlnZXRQbGFuZTogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlRyaWFuZ2xlOiAuZ2V0UGxhbmUoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuc2V0RnJvbUNvcGxhbmFyUG9pbnRzKCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jICk7CgoJCX0sCgoJCWdldEJhcnljb29yZDogZnVuY3Rpb24gKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldEJhcnljb29yZCggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCQl9LAoKCQljb250YWluc1BvaW50OiBmdW5jdGlvbiAoIHBvaW50ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmNvbnRhaW5zUG9pbnQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jICk7CgoJCX0sCgoJCWdldFVWOiBmdW5jdGlvbiAoIHBvaW50LCB1djEsIHV2MiwgdXYzLCByZXN1bHQgKSB7CgoJCQlyZXR1cm4gVHJpYW5nbGUuZ2V0VVYoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB1djEsIHV2MiwgdXYzLCByZXN1bHQgKTsKCgkJfSwKCgkJaW50ZXJzZWN0c0JveDogZnVuY3Rpb24gKCBib3ggKSB7CgoJCQlyZXR1cm4gYm94LmludGVyc2VjdHNUcmlhbmdsZSggdGhpcyApOwoKCQl9LAoKCQljbG9zZXN0UG9pbnRUb1BvaW50OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmFiID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHZhYyA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2YmMgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgdmFwID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHZicCA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2Y3AgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGNsb3Nlc3RQb2ludFRvUG9pbnQoIHAsIHRhcmdldCApIHsKCgkJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmNsb3Nlc3RQb2ludFRvUG9pbnQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkJfQoKCQkJCXZhciBhID0gdGhpcy5hLCBiID0gdGhpcy5iLCBjID0gdGhpcy5jOwoJCQkJdmFyIHYsIHc7CgoJCQkJLy8gYWxnb3JpdGhtIHRoYW5rcyB0byBSZWFsLVRpbWUgQ29sbGlzaW9uIERldGVjdGlvbiBieSBDaHJpc3RlciBFcmljc29uLAoJCQkJLy8gcHVibGlzaGVkIGJ5IE1vcmdhbiBLYXVmbWFubiBQdWJsaXNoZXJzLCAoYykgMjAwNSBFbHNldmllciBJbmMuLAoJCQkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCgkJCQkvLyBiYXNpY2FsbHksIHdlJ3JlIGRpc3Rpbmd1aXNoaW5nIHdoaWNoIG9mIHRoZSB2b3Jvbm9pIHJlZ2lvbnMgb2YgdGhlIHRyaWFuZ2xlCgkJCQkvLyB0aGUgcG9pbnQgbGllcyBpbiB3aXRoIHRoZSBtaW5pbXVtIGFtb3VudCBvZiByZWR1bmRhbnQgY29tcHV0YXRpb24uCgoJCQkJdmFiLnN1YlZlY3RvcnMoIGIsIGEgKTsKCQkJCXZhYy5zdWJWZWN0b3JzKCBjLCBhICk7CgkJCQl2YXAuc3ViVmVjdG9ycyggcCwgYSApOwoJCQkJdmFyIGQxID0gdmFiLmRvdCggdmFwICk7CgkJCQl2YXIgZDIgPSB2YWMuZG90KCB2YXAgKTsKCQkJCWlmICggZDEgPD0gMCAmJiBkMiA8PSAwICkgewoKCQkJCQkvLyB2ZXJ0ZXggcmVnaW9uIG9mIEE7IGJhcnljZW50cmljIGNvb3JkcyAoMSwgMCwgMCkKCQkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKTsKCgkJCQl9CgoJCQkJdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKCQkJCXZhciBkMyA9IHZhYi5kb3QoIHZicCApOwoJCQkJdmFyIGQ0ID0gdmFjLmRvdCggdmJwICk7CgkJCQlpZiAoIGQzID49IDAgJiYgZDQgPD0gZDMgKSB7CgoJCQkJCS8vIHZlcnRleCByZWdpb24gb2YgQjsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAxLCAwKQoJCQkJCXJldHVybiB0YXJnZXQuY29weSggYiApOwoKCQkJCX0KCgkJCQl2YXIgdmMgPSBkMSAqIGQ0IC0gZDMgKiBkMjsKCQkJCWlmICggdmMgPD0gMCAmJiBkMSA+PSAwICYmIGQzIDw9IDAgKSB7CgoJCQkJCXYgPSBkMSAvICggZDEgLSBkMyApOwoJCQkJCS8vIGVkZ2UgcmVnaW9uIG9mIEFCOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEtdiwgdiwgMCkKCQkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIHZhYiwgdiApOwoKCQkJCX0KCgkJCQl2Y3Auc3ViVmVjdG9ycyggcCwgYyApOwoJCQkJdmFyIGQ1ID0gdmFiLmRvdCggdmNwICk7CgkJCQl2YXIgZDYgPSB2YWMuZG90KCB2Y3AgKTsKCQkJCWlmICggZDYgPj0gMCAmJiBkNSA8PSBkNiApIHsKCgkJCQkJLy8gdmVydGV4IHJlZ2lvbiBvZiBDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDAsIDEpCgkJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBjICk7CgoJCQkJfQoKCQkJCXZhciB2YiA9IGQ1ICogZDIgLSBkMSAqIGQ2OwoJCQkJaWYgKCB2YiA8PSAwICYmIGQyID49IDAgJiYgZDYgPD0gMCApIHsKCgkJCQkJdyA9IGQyIC8gKCBkMiAtIGQ2ICk7CgkJCQkJLy8gZWRnZSByZWdpb24gb2YgQUM7IGJhcnljZW50cmljIGNvb3JkcyAoMS13LCAwLCB3KQoJCQkJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggdmFjLCB3ICk7CgoJCQkJfQoKCQkJCXZhciB2YSA9IGQzICogZDYgLSBkNSAqIGQ0OwoJCQkJaWYgKCB2YSA8PSAwICYmICggZDQgLSBkMyApID49IDAgJiYgKCBkNSAtIGQ2ICkgPj0gMCApIHsKCgkJCQkJdmJjLnN1YlZlY3RvcnMoIGMsIGIgKTsKCQkJCQl3ID0gKCBkNCAtIGQzICkgLyAoICggZDQgLSBkMyApICsgKCBkNSAtIGQ2ICkgKTsKCQkJCQkvLyBlZGdlIHJlZ2lvbiBvZiBCQzsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAxLXcsIHcpCgkJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiICkuYWRkU2NhbGVkVmVjdG9yKCB2YmMsIHcgKTsgLy8gZWRnZSByZWdpb24gb2YgQkMKCgkJCQl9CgoJCQkJLy8gZmFjZSByZWdpb24KCQkJCXZhciBkZW5vbSA9IDEgLyAoIHZhICsgdmIgKyB2YyApOwoJCQkJLy8gdSA9IHZhICogZGVub20KCQkJCXYgPSB2YiAqIGRlbm9tOwoJCQkJdyA9IHZjICogZGVub207CgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIHZhYiwgdiApLmFkZFNjYWxlZFZlY3RvciggdmFjLCB3ICk7CgoJCQl9OwoKCQl9KCksCgoJCWVxdWFsczogZnVuY3Rpb24gKCB0cmlhbmdsZSApIHsKCgkJCXJldHVybiB0cmlhbmdsZS5hLmVxdWFscyggdGhpcy5hICkgJiYgdHJpYW5nbGUuYi5lcXVhbHMoIHRoaXMuYiApICYmIHRyaWFuZ2xlLmMuZXF1YWxzKCB0aGlzLmMgKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICoKCSAqIHBhcmFtZXRlcnMgPSB7CgkgKiAgY29sb3I6IDxoZXg+LAoJICogIG9wYWNpdHk6IDxmbG9hdD4sCgkgKiAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBsaWdodE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBsaWdodE1hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBhb01hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBhb01hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBzcGVjdWxhck1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYWxwaGFNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGVudk1hcDogbmV3IFRIUkVFLkN1YmVUZXh0dXJlKCBbcG9zeCwgbmVneCwgcG9zeSwgbmVneSwgcG9zeiwgbmVnel0gKSwKCSAqICBjb21iaW5lOiBUSFJFRS5NdWx0aXBseSwKCSAqICByZWZsZWN0aXZpdHk6IDxmbG9hdD4sCgkgKiAgcmVmcmFjdGlvblJhdGlvOiA8ZmxvYXQ+LAoJICoKCSAqICBkZXB0aFRlc3Q6IDxib29sPiwKCSAqICBkZXB0aFdyaXRlOiA8Ym9vbD4sCgkgKgoJICogIHdpcmVmcmFtZTogPGJvb2xlYW4+LAoJICogIHdpcmVmcmFtZUxpbmV3aWR0aDogPGZsb2F0PiwKCSAqCgkgKiAgc2tpbm5pbmc6IDxib29sPiwKCSAqICBtb3JwaFRhcmdldHM6IDxib29sPgoJICogfQoJICovCgoJZnVuY3Rpb24gTWVzaEJhc2ljTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLnNwZWN1bGFyTWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZW52TWFwID0gbnVsbDsKCQl0aGlzLmNvbWJpbmUgPSBNdWx0aXBseU9wZXJhdGlvbjsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IDE7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLnNraW5uaW5nID0gZmFsc2U7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBmYWxzZTsKCgkJdGhpcy5saWdodHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJTWVzaEJhc2ljTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglNZXNoQmFzaWNNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoQmFzaWNNYXRlcmlhbDsKCglNZXNoQmFzaWNNYXRlcmlhbC5wcm90b3R5cGUuaXNNZXNoQmFzaWNNYXRlcmlhbCA9IHRydWU7CgoJTWVzaEJhc2ljTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuc2tpbm5pbmcgPSBzb3VyY2Uuc2tpbm5pbmc7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIG1pa2FlbCBlbXRpbmdlciAvIGh0dHA6Ly9nb21vLnNlLwoJICogQGF1dGhvciBqb25vYnIxIC8gaHR0cDovL2pvbm9icjEuY29tLwoJICovCgoJZnVuY3Rpb24gTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlPYmplY3QzRC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdNZXNoJzsKCgkJdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgPyBnZW9tZXRyeSA6IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCXRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbCAhPT0gdW5kZWZpbmVkID8gbWF0ZXJpYWwgOiBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZiB9ICk7CgoJCXRoaXMuZHJhd01vZGUgPSBUcmlhbmdsZXNEcmF3TW9kZTsKCgkJdGhpcy51cGRhdGVNb3JwaFRhcmdldHMoKTsKCgl9CgoJTWVzaC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogTWVzaCwKCgkJaXNNZXNoOiB0cnVlLAoKCQlzZXREcmF3TW9kZTogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMuZHJhd01vZGUgPSB2YWx1ZTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQlPYmplY3QzRC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJCXRoaXMuZHJhd01vZGUgPSBzb3VyY2UuZHJhd01vZGU7CgoJCQlpZiAoIHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMuc2xpY2UoKTsKCgkJCX0KCgkJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5tb3JwaFRhcmdldERpY3Rpb25hcnkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl1cGRhdGVNb3JwaFRhcmdldHM6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCXZhciBtLCBtbCwgbmFtZTsKCgkJCWlmICggZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCQl2YXIgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoJCQkJdmFyIGtleXMgPSBPYmplY3Qua2V5cyggbW9ycGhBdHRyaWJ1dGVzICk7CgoJCQkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCXZhciBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sga2V5c1sgMCBdIF07CgoJCQkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gW107CgkJCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0ge307CgoJCQkJCQlmb3IgKCBtID0gMCwgbWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IG0gPCBtbDsgbSArKyApIHsKCgkJCQkJCQluYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKCQkJCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzLnB1c2goIDAgKTsKCQkJCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5WyBuYW1lIF0gPSBtOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQl2YXIgbW9ycGhUYXJnZXRzID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzOwoKCQkJCWlmICggbW9ycGhUYXJnZXRzICE9PSB1bmRlZmluZWQgJiYgbW9ycGhUYXJnZXRzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NZXNoLnVwZGF0ZU1vcnBoVGFyZ2V0cygpIG5vIGxvbmdlciBzdXBwb3J0cyBUSFJFRS5HZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuJyApOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJcmF5Y2FzdDogKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgaW52ZXJzZU1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJCXZhciByYXkgPSBuZXcgUmF5KCk7CgkJCXZhciBzcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQl2YXIgdkEgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgdkIgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgdkMgPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIHRlbXBBID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHRlbXBCID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHRlbXBDID0gbmV3IFZlY3RvcjMoKTsKCgkJCXZhciBtb3JwaEEgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgbW9ycGhCID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG1vcnBoQyA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgdXZBID0gbmV3IFZlY3RvcjIoKTsKCQkJdmFyIHV2QiA9IG5ldyBWZWN0b3IyKCk7CgkJCXZhciB1dkMgPSBuZXcgVmVjdG9yMigpOwoKCQkJdmFyIGludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGludGVyc2VjdGlvblBvaW50V29ybGQgPSBuZXcgVmVjdG9yMygpOwoKCQkJZnVuY3Rpb24gY2hlY2tJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwQSwgcEIsIHBDLCBwb2ludCApIHsKCgkJCQl2YXIgaW50ZXJzZWN0OwoKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgoJCQkJCWludGVyc2VjdCA9IHJheS5pbnRlcnNlY3RUcmlhbmdsZSggcEMsIHBCLCBwQSwgdHJ1ZSwgcG9pbnQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpbnRlcnNlY3QgPSByYXkuaW50ZXJzZWN0VHJpYW5nbGUoIHBBLCBwQiwgcEMsIG1hdGVyaWFsLnNpZGUgIT09IERvdWJsZVNpZGUsIHBvaW50ICk7CgoJCQkJfQoKCQkJCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJCQkJaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jb3B5KCBwb2ludCApOwoJCQkJaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCXZhciBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIGludGVyc2VjdGlvblBvaW50V29ybGQgKTsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuIG51bGw7CgoJCQkJcmV0dXJuIHsKCQkJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCQkJcG9pbnQ6IGludGVyc2VjdGlvblBvaW50V29ybGQuY2xvbmUoKSwKCQkJCQlvYmplY3Q6IG9iamVjdAoJCQkJfTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGNoZWNrQnVmZmVyR2VvbWV0cnlJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwb3NpdGlvbiwgbW9ycGhQb3NpdGlvbiwgdXYsIGEsIGIsIGMgKSB7CgoJCQkJdkEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGEgKTsKCQkJCXZCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBiICk7CgkJCQl2Qy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgYyApOwoKCQkJCXZhciBtb3JwaEluZmx1ZW5jZXMgPSBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQkJCWlmICggbWF0ZXJpYWwubW9ycGhUYXJnZXRzICYmIG1vcnBoUG9zaXRpb24gJiYgbW9ycGhJbmZsdWVuY2VzICkgewoKCQkJCQltb3JwaEEuc2V0KCAwLCAwLCAwICk7CgkJCQkJbW9ycGhCLnNldCggMCwgMCwgMCApOwoJCQkJCW1vcnBoQy5zZXQoIDAsIDAsIDAgKTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1vcnBoUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQl2YXIgaW5mbHVlbmNlID0gbW9ycGhJbmZsdWVuY2VzWyBpIF07CgkJCQkJCXZhciBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoUG9zaXRpb25bIGkgXTsKCgkJCQkJCWlmICggaW5mbHVlbmNlID09PSAwICkgY29udGludWU7CgoJCQkJCQl0ZW1wQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgYSApOwoJCQkJCQl0ZW1wQi5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgYiApOwoJCQkJCQl0ZW1wQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgYyApOwoKCQkJCQkJbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggdGVtcEEuc3ViKCB2QSApLCBpbmZsdWVuY2UgKTsKCQkJCQkJbW9ycGhCLmFkZFNjYWxlZFZlY3RvciggdGVtcEIuc3ViKCB2QiApLCBpbmZsdWVuY2UgKTsKCQkJCQkJbW9ycGhDLmFkZFNjYWxlZFZlY3RvciggdGVtcEMuc3ViKCB2QyApLCBpbmZsdWVuY2UgKTsKCgkJCQkJfQoKCQkJCQl2QS5hZGQoIG1vcnBoQSApOwoJCQkJCXZCLmFkZCggbW9ycGhCICk7CgkJCQkJdkMuYWRkKCBtb3JwaEMgKTsKCgkJCQl9CgoJCQkJdmFyIGludGVyc2VjdGlvbiA9IGNoZWNrSW50ZXJzZWN0aW9uKCBvYmplY3QsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheSwgdkEsIHZCLCB2QywgaW50ZXJzZWN0aW9uUG9pbnQgKTsKCgkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJaWYgKCB1diApIHsKCgkJCQkJCXV2QS5mcm9tQnVmZmVyQXR0cmlidXRlKCB1diwgYSApOwoJCQkJCQl1dkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXYsIGIgKTsKCQkJCQkJdXZDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2LCBjICk7CgoJCQkJCQlpbnRlcnNlY3Rpb24udXYgPSBUcmlhbmdsZS5nZXRVViggaW50ZXJzZWN0aW9uUG9pbnQsIHZBLCB2QiwgdkMsIHV2QSwgdXZCLCB1dkMsIG5ldyBWZWN0b3IyKCkgKTsKCgkJCQkJfQoKCQkJCQl2YXIgZmFjZSA9IG5ldyBGYWNlMyggYSwgYiwgYyApOwoJCQkJCVRyaWFuZ2xlLmdldE5vcm1hbCggdkEsIHZCLCB2QywgZmFjZS5ub3JtYWwgKTsKCgkJCQkJaW50ZXJzZWN0aW9uLmZhY2UgPSBmYWNlOwoKCQkJCX0KCgkJCQlyZXR1cm4gaW50ZXJzZWN0aW9uOwoKCQkJfQoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJCQl2YXIgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCQkJdmFyIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCQkJCXZhciBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgoJCQkJaWYgKCBtYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJCS8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlIGRpc3RhbmNlIHRvIHJheQoKCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJCQlzcGhlcmUuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKCQkJCXNwaGVyZS5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgoJCQkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkvLwoKCQkJCWludmVyc2VNYXRyaXguZ2V0SW52ZXJzZSggbWF0cml4V29ybGQgKTsKCQkJCXJheS5jb3B5KCByYXljYXN0ZXIucmF5ICkuYXBwbHlNYXRyaXg0KCBpbnZlcnNlTWF0cml4ICk7CgoJCQkJLy8gQ2hlY2sgYm91bmRpbmdCb3ggYmVmb3JlIGNvbnRpbnVpbmcKCgkJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHJheS5pbnRlcnNlY3RzQm94KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApID09PSBmYWxzZSApIHJldHVybjsKCgkJCQl9CgoJCQkJdmFyIGludGVyc2VjdGlvbjsKCgkJCQlpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJCXZhciBhLCBiLCBjOwoJCQkJCXZhciBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQkJCXZhciBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJCQkJdmFyIG1vcnBoUG9zaXRpb24gPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgkJCQkJdmFyIHV2ID0gZ2VvbWV0cnkuYXR0cmlidXRlcy51djsKCQkJCQl2YXIgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoJCQkJCXZhciBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgkJCQkJdmFyIGksIGosIGlsLCBqbDsKCQkJCQl2YXIgZ3JvdXAsIGdyb3VwTWF0ZXJpYWw7CgkJCQkJdmFyIHN0YXJ0LCBlbmQ7CgoJCQkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJCQkvLyBpbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJCWZvciAoIGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQkJZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQlncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJCQkJc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCQkJCWVuZCA9IE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJCQkJCQlmb3IgKCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCQkJCWEgPSBpbmRleC5nZXRYKCBqICk7CgkJCQkJCQkJCWIgPSBpbmRleC5nZXRYKCBqICsgMSApOwoJCQkJCQkJCQljID0gaW5kZXguZ2V0WCggaiArIDIgKTsKCgkJCQkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrQnVmZmVyR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwb3NpdGlvbiwgbW9ycGhQb3NpdGlvbiwgdXYsIGEsIGIsIGMgKTsKCgkJCQkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBqIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gaW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCgkJCQkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZS5tYXRlcmlhbEluZGV4ID0gZ3JvdXAubWF0ZXJpYWxJbmRleDsKCQkJCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCQkJZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQkJCQkJZm9yICggaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICs9IDMgKSB7CgoJCQkJCQkJCWEgPSBpbmRleC5nZXRYKCBpICk7CgkJCQkJCQkJYiA9IGluZGV4LmdldFgoIGkgKyAxICk7CgkJCQkJCQkJYyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgoJCQkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrQnVmZmVyR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheSwgcG9zaXRpb24sIG1vcnBoUG9zaXRpb24sIHV2LCBhLCBiLCBjICk7CgoJCQkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCS8vIG5vbi1pbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJCWZvciAoIGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQkJZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQlncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJCQkJc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCQkJCWVuZCA9IE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJCQkJCQlmb3IgKCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCQkJCWEgPSBqOwoJCQkJCQkJCQliID0gaiArIDE7CgkJCQkJCQkJCWMgPSBqICsgMjsKCgkJCQkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrQnVmZmVyR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwb3NpdGlvbiwgbW9ycGhQb3NpdGlvbiwgdXYsIGEsIGIsIGMgKTsKCgkJCQkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBqIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gbm9uLWluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CgkJCQkJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCQkJCWVuZCA9IE1hdGgubWluKCBwb3NpdGlvbi5jb3VudCwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJCQkJCWZvciAoIGkgPSBzdGFydCwgaWwgPSBlbmQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQkJCQlhID0gaTsKCQkJCQkJCQliID0gaSArIDE7CgkJCQkJCQkJYyA9IGkgKyAyOwoKCQkJCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0J1ZmZlckdlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBvc2l0aW9uLCBtb3JwaFBvc2l0aW9uLCB1diwgYSwgYiwgYyApOwoKCQkJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBpIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gbm9uLWluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCQkJdmFyIGZ2QSwgZnZCLCBmdkM7CgkJCQkJdmFyIGlzTXVsdGlNYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICk7CgoJCQkJCXZhciB2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzOwoJCQkJCXZhciBmYWNlcyA9IGdlb21ldHJ5LmZhY2VzOwoJCQkJCXZhciB1dnM7CgoJCQkJCXZhciBmYWNlVmVydGV4VXZzID0gZ2VvbWV0cnkuZmFjZVZlcnRleFV2c1sgMCBdOwoJCQkJCWlmICggZmFjZVZlcnRleFV2cy5sZW5ndGggPiAwICkgdXZzID0gZmFjZVZlcnRleFV2czsKCgkJCQkJZm9yICggdmFyIGYgPSAwLCBmbCA9IGZhY2VzLmxlbmd0aDsgZiA8IGZsOyBmICsrICkgewoKCQkJCQkJdmFyIGZhY2UgPSBmYWNlc1sgZiBdOwoJCQkJCQl2YXIgZmFjZU1hdGVyaWFsID0gaXNNdWx0aU1hdGVyaWFsID8gbWF0ZXJpYWxbIGZhY2UubWF0ZXJpYWxJbmRleCBdIDogbWF0ZXJpYWw7CgoJCQkJCQlpZiAoIGZhY2VNYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgoJCQkJCQlmdkEgPSB2ZXJ0aWNlc1sgZmFjZS5hIF07CgkJCQkJCWZ2QiA9IHZlcnRpY2VzWyBmYWNlLmIgXTsKCQkJCQkJZnZDID0gdmVydGljZXNbIGZhY2UuYyBdOwoKCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tJbnRlcnNlY3Rpb24oIHRoaXMsIGZhY2VNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIGZ2QSwgZnZCLCBmdkMsIGludGVyc2VjdGlvblBvaW50ICk7CgoJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQlpZiAoIHV2cyAmJiB1dnNbIGYgXSApIHsKCgkJCQkJCQkJdmFyIHV2c19mID0gdXZzWyBmIF07CgkJCQkJCQkJdXZBLmNvcHkoIHV2c19mWyAwIF0gKTsKCQkJCQkJCQl1dkIuY29weSggdXZzX2ZbIDEgXSApOwoJCQkJCQkJCXV2Qy5jb3B5KCB1dnNfZlsgMiBdICk7CgoJCQkJCQkJCWludGVyc2VjdGlvbi51diA9IFRyaWFuZ2xlLmdldFVWKCBpbnRlcnNlY3Rpb25Qb2ludCwgZnZBLCBmdkIsIGZ2QywgdXZBLCB1dkIsIHV2QywgbmV3IFZlY3RvcjIoKSApOwoKCQkJCQkJCX0KCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZSA9IGZhY2U7CgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gZjsKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9OwoKCQl9KCkgKSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5nZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCApLmNvcHkoIHRoaXMgKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTEJhY2tncm91bmQoIHJlbmRlcmVyLCBzdGF0ZSwgb2JqZWN0cywgcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQl2YXIgY2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl2YXIgY2xlYXJBbHBoYSA9IDA7CgoJCXZhciBwbGFuZU1lc2g7CgkJdmFyIGJveE1lc2g7CgkJLy8gU3RvcmUgdGhlIGN1cnJlbnQgYmFja2dyb3VuZCB0ZXh0dXJlIGFuZCBpdHMgYHZlcnNpb25gCgkJLy8gc28gd2UgY2FuIHJlY29tcGlsZSB0aGUgbWF0ZXJpYWwgYWNjb3JkaW5nbHkuCgkJdmFyIGN1cnJlbnRCYWNrZ3JvdW5kID0gbnVsbDsKCQl2YXIgY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gMDsKCgkJZnVuY3Rpb24gcmVuZGVyKCByZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhLCBmb3JjZUNsZWFyICkgewoKCQkJdmFyIGJhY2tncm91bmQgPSBzY2VuZS5iYWNrZ3JvdW5kOwoKCQkJLy8gSWdub3JlIGJhY2tncm91bmQgaW4gQVIKCQkJLy8gVE9ETzogUmVjb25zaWRlciB0aGlzLgoKCQkJdmFyIHZyID0gcmVuZGVyZXIudnI7CgkJCXZhciBzZXNzaW9uID0gdnIuZ2V0U2Vzc2lvbiAmJiB2ci5nZXRTZXNzaW9uKCk7CgoJCQlpZiAoIHNlc3Npb24gJiYgc2Vzc2lvbi5lbnZpcm9ubWVudEJsZW5kTW9kZSA9PT0gJ2FkZGl0aXZlJyApIHsKCgkJCQliYWNrZ3JvdW5kID0gbnVsbDsKCgkJCX0KCgkJCWlmICggYmFja2dyb3VuZCA9PT0gbnVsbCApIHsKCgkJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoJCQkJY3VycmVudEJhY2tncm91bmQgPSBudWxsOwoJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gMDsKCgkJCX0gZWxzZSBpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc0NvbG9yICkgewoKCQkJCXNldENsZWFyKCBiYWNrZ3JvdW5kLCAxICk7CgkJCQlmb3JjZUNsZWFyID0gdHJ1ZTsKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kID0gbnVsbDsKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IDA7CgoJCQl9CgoJCQlpZiAoIHJlbmRlcmVyLmF1dG9DbGVhciB8fCBmb3JjZUNsZWFyICkgewoKCQkJCXJlbmRlcmVyLmNsZWFyKCByZW5kZXJlci5hdXRvQ2xlYXJDb2xvciwgcmVuZGVyZXIuYXV0b0NsZWFyRGVwdGgsIHJlbmRlcmVyLmF1dG9DbGVhclN0ZW5jaWwgKTsKCgkJCX0KCgkJCWlmICggYmFja2dyb3VuZCAmJiAoIGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSB8fCBiYWNrZ3JvdW5kLmlzV2ViR0xSZW5kZXJUYXJnZXRDdWJlICkgKSB7CgoJCQkJaWYgKCBib3hNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWJveE1lc2ggPSBuZXcgTWVzaCgKCQkJCQkJbmV3IEJveEJ1ZmZlckdlb21ldHJ5KCAxLCAxLCAxICksCgkJCQkJCW5ldyBTaGFkZXJNYXRlcmlhbCggewoJCQkJCQkJdHlwZTogJ0JhY2tncm91bmRDdWJlTWF0ZXJpYWwnLAoJCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5jdWJlLnVuaWZvcm1zICksCgkJCQkJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckxpYi5jdWJlLnZlcnRleFNoYWRlciwKCQkJCQkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJMaWIuY3ViZS5mcmFnbWVudFNoYWRlciwKCQkJCQkJCXNpZGU6IEJhY2tTaWRlLAoJCQkJCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQkJCQkJZm9nOiBmYWxzZQoJCQkJCQl9ICkKCQkJCQkpOwoKCQkJCQlib3hNZXNoLmdlb21ldHJ5LnJlbW92ZUF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCQkJCQlib3hNZXNoLmdlb21ldHJ5LnJlbW92ZUF0dHJpYnV0ZSggJ3V2JyApOwoKCQkJCQlib3hNZXNoLm9uQmVmb3JlUmVuZGVyID0gZnVuY3Rpb24gKCByZW5kZXJlciwgc2NlbmUsIGNhbWVyYSApIHsKCgkJCQkJCXRoaXMubWF0cml4V29ybGQuY29weVBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgkJCQkJfTsKCgkJCQkJLy8gZW5hYmxlIGNvZGUgaW5qZWN0aW9uIGZvciBub24tYnVpbHQtaW4gbWF0ZXJpYWwKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIGJveE1lc2gubWF0ZXJpYWwsICdtYXAnLCB7CgoJCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy50Q3ViZS52YWx1ZTsKCgkJCQkJCX0KCgkJCQkJfSApOwoKCQkJCQlvYmplY3RzLnVwZGF0ZSggYm94TWVzaCApOwoKCQkJCX0KCgkJCQl2YXIgdGV4dHVyZSA9IGJhY2tncm91bmQuaXNXZWJHTFJlbmRlclRhcmdldEN1YmUgPyBiYWNrZ3JvdW5kLnRleHR1cmUgOiBiYWNrZ3JvdW5kOwoJCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy50Q3ViZS52YWx1ZSA9IHRleHR1cmU7CgkJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLnRGbGlwLnZhbHVlID0gKCBiYWNrZ3JvdW5kLmlzV2ViR0xSZW5kZXJUYXJnZXRDdWJlICkgPyAxIDogLSAxOwoKCQkJCWlmICggY3VycmVudEJhY2tncm91bmQgIT09IGJhY2tncm91bmQgfHwKCQkJCSAgICAgY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgoJCQkJCWJveE1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQkJCX0KCgkJCQkvLyBwdXNoIHRvIHRoZSBwcmUtc29ydGVkIG9wYXF1ZSByZW5kZXIgbGlzdAoJCQkJcmVuZGVyTGlzdC51bnNoaWZ0KCBib3hNZXNoLCBib3hNZXNoLmdlb21ldHJ5LCBib3hNZXNoLm1hdGVyaWFsLCAwLCAwLCBudWxsICk7CgoJCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNUZXh0dXJlICkgewoKCQkJCWlmICggcGxhbmVNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXBsYW5lTWVzaCA9IG5ldyBNZXNoKAoJCQkJCQluZXcgUGxhbmVCdWZmZXJHZW9tZXRyeSggMiwgMiApLAoJCQkJCQluZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCQkJCQkJCXR5cGU6ICdCYWNrZ3JvdW5kTWF0ZXJpYWwnLAoJCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5iYWNrZ3JvdW5kLnVuaWZvcm1zICksCgkJCQkJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kLnZlcnRleFNoYWRlciwKCQkJCQkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC5mcmFnbWVudFNoYWRlciwKCQkJCQkJCXNpZGU6IEZyb250U2lkZSwKCQkJCQkJCWRlcHRoVGVzdDogZmFsc2UsCgkJCQkJCQlkZXB0aFdyaXRlOiBmYWxzZSwKCQkJCQkJCWZvZzogZmFsc2UKCQkJCQkJfSApCgkJCQkJKTsKCgkJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LnJlbW92ZUF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCgkJCQkJLy8gZW5hYmxlIGNvZGUgaW5qZWN0aW9uIGZvciBub24tYnVpbHQtaW4gbWF0ZXJpYWwKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHBsYW5lTWVzaC5tYXRlcmlhbCwgJ21hcCcsIHsKCgkJCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLnQyRC52YWx1ZTsKCgkJCQkJCX0KCgkJCQkJfSApOwoKCQkJCQlvYmplY3RzLnVwZGF0ZSggcGxhbmVNZXNoICk7CgoJCQkJfQoKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy50MkQudmFsdWUgPSBiYWNrZ3JvdW5kOwoKCQkJCWlmICggYmFja2dyb3VuZC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQliYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weSggYmFja2dyb3VuZC5tYXRyaXggKTsKCgkJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQkJICAgY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gKSB7CgoJCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCWN1cnJlbnRCYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCQkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSBiYWNrZ3JvdW5kLnZlcnNpb247CgoJCQkJfQoKCgkJCQkvLyBwdXNoIHRvIHRoZSBwcmUtc29ydGVkIG9wYXF1ZSByZW5kZXIgbGlzdAoJCQkJcmVuZGVyTGlzdC51bnNoaWZ0KCBwbGFuZU1lc2gsIHBsYW5lTWVzaC5nZW9tZXRyeSwgcGxhbmVNZXNoLm1hdGVyaWFsLCAwLCAwLCBudWxsICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0Q2xlYXIoIGNvbG9yLCBhbHBoYSApIHsKCgkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIsIGFscGhhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJZ2V0Q2xlYXJDb2xvcjogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBjbGVhckNvbG9yOwoKCQkJfSwKCQkJc2V0Q2xlYXJDb2xvcjogZnVuY3Rpb24gKCBjb2xvciwgYWxwaGEgKSB7CgoJCQkJY2xlYXJDb2xvci5zZXQoIGNvbG9yICk7CgkJCQljbGVhckFscGhhID0gYWxwaGEgIT09IHVuZGVmaW5lZCA/IGFscGhhIDogMTsKCQkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCQl9LAoJCQlnZXRDbGVhckFscGhhOiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGNsZWFyQWxwaGE7CgoJCQl9LAoJCQlzZXRDbGVhckFscGhhOiBmdW5jdGlvbiAoIGFscGhhICkgewoKCQkJCWNsZWFyQWxwaGEgPSBhbHBoYTsKCQkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCQl9LAoJCQlyZW5kZXI6IHJlbmRlcgoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTEJ1ZmZlclJlbmRlcmVyKCBnbCwgZXh0ZW5zaW9ucywgaW5mbywgY2FwYWJpbGl0aWVzICkgewoKCQl2YXIgbW9kZTsKCgkJZnVuY3Rpb24gc2V0TW9kZSggdmFsdWUgKSB7CgoJCQltb2RlID0gdmFsdWU7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyKCBzdGFydCwgY291bnQgKSB7CgoJCQlnbC5kcmF3QXJyYXlzKCBtb2RlLCBzdGFydCwgY291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggZ2VvbWV0cnksIHN0YXJ0LCBjb3VudCApIHsKCgkJCXZhciBleHRlbnNpb247CgoJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQlleHRlbnNpb24gPSBnbDsKCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xCdWZmZXJSZW5kZXJlcjogdXNpbmcgVEhSRUUuSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgYnV0IGhhcmR3YXJlIGRvZXMgbm90IHN1cHBvcnQgZXh0ZW5zaW9uIEFOR0xFX2luc3RhbmNlZF9hcnJheXMuJyApOwoJCQkJCXJldHVybjsKCgkJCQl9CgoJCQl9CgoJCQlleHRlbnNpb25bIGNhcGFiaWxpdGllcy5pc1dlYkdMMiA/ICdkcmF3QXJyYXlzSW5zdGFuY2VkJyA6ICdkcmF3QXJyYXlzSW5zdGFuY2VkQU5HTEUnIF0oIG1vZGUsIHN0YXJ0LCBjb3VudCwgZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgKTsKCgkJfQoKCQkvLwoKCQl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwoJCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTENhcGFiaWxpdGllcyggZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMgKSB7CgoJCXZhciBtYXhBbmlzb3Ryb3B5OwoKCQlmdW5jdGlvbiBnZXRNYXhBbmlzb3Ryb3B5KCkgewoKCQkJaWYgKCBtYXhBbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSByZXR1cm4gbWF4QW5pc290cm9weTsKCgkJCXZhciBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKCgkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCW1heEFuaXNvdHJvcHkgPSBnbC5nZXRQYXJhbWV0ZXIoIGV4dGVuc2lvbi5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJbWF4QW5pc290cm9weSA9IDA7CgoJCQl9CgoJCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRNYXhQcmVjaXNpb24oIHByZWNpc2lvbiApIHsKCgkJCWlmICggcHJlY2lzaW9uID09PSAnaGlnaHAnICkgewoKCQkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCAzNTYzMywgMzYzMzggKS5wcmVjaXNpb24gPiAwICYmCgkJCQkgICAgIGdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCggMzU2MzIsIDM2MzM4ICkucHJlY2lzaW9uID4gMCApIHsKCgkJCQkJcmV0dXJuICdoaWdocCc7CgoJCQkJfQoKCQkJCXByZWNpc2lvbiA9ICdtZWRpdW1wJzsKCgkJCX0KCgkJCWlmICggcHJlY2lzaW9uID09PSAnbWVkaXVtcCcgKSB7CgoJCQkJaWYgKCBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIDM1NjMzLCAzNjMzNyApLnByZWNpc2lvbiA+IDAgJiYKCQkJCSAgICAgZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCAzNTYzMiwgMzYzMzcgKS5wcmVjaXNpb24gPiAwICkgewoKCQkJCQlyZXR1cm4gJ21lZGl1bXAnOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiAnbG93cCc7CgoJCX0KCgkJdmFyIGlzV2ViR0wyID0gdHlwZW9mIFdlYkdMMlJlbmRlcmluZ0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIGdsIGluc3RhbmNlb2YgV2ViR0wyUmVuZGVyaW5nQ29udGV4dDsKCgkJdmFyIHByZWNpc2lvbiA9IHBhcmFtZXRlcnMucHJlY2lzaW9uICE9PSB1bmRlZmluZWQgPyBwYXJhbWV0ZXJzLnByZWNpc2lvbiA6ICdoaWdocCc7CgkJdmFyIG1heFByZWNpc2lvbiA9IGdldE1heFByZWNpc2lvbiggcHJlY2lzaW9uICk7CgoJCWlmICggbWF4UHJlY2lzaW9uICE9PSBwcmVjaXNpb24gKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOicsIHByZWNpc2lvbiwgJ25vdCBzdXBwb3J0ZWQsIHVzaW5nJywgbWF4UHJlY2lzaW9uLCAnaW5zdGVhZC4nICk7CgkJCXByZWNpc2lvbiA9IG1heFByZWNpc2lvbjsKCgkJfQoKCQl2YXIgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9PT0gdHJ1ZTsKCgkJdmFyIG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCAzNDkzMCApOwoJCXZhciBtYXhWZXJ0ZXhUZXh0dXJlcyA9IGdsLmdldFBhcmFtZXRlciggMzU2NjAgKTsKCQl2YXIgbWF4VGV4dHVyZVNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoIDMzNzkgKTsKCQl2YXIgbWF4Q3ViZW1hcFNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoIDM0MDc2ICk7CgoJCXZhciBtYXhBdHRyaWJ1dGVzID0gZ2wuZ2V0UGFyYW1ldGVyKCAzNDkyMSApOwoJCXZhciBtYXhWZXJ0ZXhVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggMzYzNDcgKTsKCQl2YXIgbWF4VmFyeWluZ3MgPSBnbC5nZXRQYXJhbWV0ZXIoIDM2MzQ4ICk7CgkJdmFyIG1heEZyYWdtZW50VW5pZm9ybXMgPSBnbC5nZXRQYXJhbWV0ZXIoIDM2MzQ5ICk7CgoJCXZhciB2ZXJ0ZXhUZXh0dXJlcyA9IG1heFZlcnRleFRleHR1cmVzID4gMDsKCQl2YXIgZmxvYXRGcmFnbWVudFRleHR1cmVzID0gaXNXZWJHTDIgfHwgISEgZXh0ZW5zaW9ucy5nZXQoICdPRVNfdGV4dHVyZV9mbG9hdCcgKTsKCQl2YXIgZmxvYXRWZXJ0ZXhUZXh0dXJlcyA9IHZlcnRleFRleHR1cmVzICYmIGZsb2F0RnJhZ21lbnRUZXh0dXJlczsKCgkJdmFyIG1heFNhbXBsZXMgPSBpc1dlYkdMMiA/IGdsLmdldFBhcmFtZXRlciggMzYxODMgKSA6IDA7CgoJCXJldHVybiB7CgoJCQlpc1dlYkdMMjogaXNXZWJHTDIsCgoJCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAoJCQlnZXRNYXhQcmVjaXNpb246IGdldE1heFByZWNpc2lvbiwKCgkJCXByZWNpc2lvbjogcHJlY2lzaW9uLAoJCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoKCQkJbWF4VGV4dHVyZXM6IG1heFRleHR1cmVzLAoJCQltYXhWZXJ0ZXhUZXh0dXJlczogbWF4VmVydGV4VGV4dHVyZXMsCgkJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKCQkJbWF4Q3ViZW1hcFNpemU6IG1heEN1YmVtYXBTaXplLAoKCQkJbWF4QXR0cmlidXRlczogbWF4QXR0cmlidXRlcywKCQkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAoJCQltYXhWYXJ5aW5nczogbWF4VmFyeWluZ3MsCgkJCW1heEZyYWdtZW50VW5pZm9ybXM6IG1heEZyYWdtZW50VW5pZm9ybXMsCgoJCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgkJCWZsb2F0RnJhZ21lbnRUZXh0dXJlczogZmxvYXRGcmFnbWVudFRleHR1cmVzLAoJCQlmbG9hdFZlcnRleFRleHR1cmVzOiBmbG9hdFZlcnRleFRleHR1cmVzLAoKCQkJbWF4U2FtcGxlczogbWF4U2FtcGxlcwoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIFdlYkdMQ2xpcHBpbmcoKSB7CgoJCXZhciBzY29wZSA9IHRoaXMsCgoJCQlnbG9iYWxTdGF0ZSA9IG51bGwsCgkJCW51bUdsb2JhbFBsYW5lcyA9IDAsCgkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2UsCgkJCXJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZSwKCgkJCXBsYW5lID0gbmV3IFBsYW5lKCksCgkJCXZpZXdOb3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLAoKCQkJdW5pZm9ybSA9IHsgdmFsdWU6IG51bGwsIG5lZWRzVXBkYXRlOiBmYWxzZSB9OwoKCQl0aGlzLnVuaWZvcm0gPSB1bmlmb3JtOwoJCXRoaXMubnVtUGxhbmVzID0gMDsKCQl0aGlzLm51bUludGVyc2VjdGlvbiA9IDA7CgoJCXRoaXMuaW5pdCA9IGZ1bmN0aW9uICggcGxhbmVzLCBlbmFibGVMb2NhbENsaXBwaW5nLCBjYW1lcmEgKSB7CgoJCQl2YXIgZW5hYmxlZCA9CgkJCQlwbGFuZXMubGVuZ3RoICE9PSAwIHx8CgkJCQllbmFibGVMb2NhbENsaXBwaW5nIHx8CgkJCQkvLyBlbmFibGUgc3RhdGUgb2YgcHJldmlvdXMgZnJhbWUgLSB0aGUgY2xpcHBpbmcgY29kZSBoYXMgdG8KCQkJCS8vIHJ1biBhbm90aGVyIGZyYW1lIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBzdGF0ZToKCQkJCW51bUdsb2JhbFBsYW5lcyAhPT0gMCB8fAoJCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQ7CgoJCQlsb2NhbENsaXBwaW5nRW5hYmxlZCA9IGVuYWJsZUxvY2FsQ2xpcHBpbmc7CgoJCQlnbG9iYWxTdGF0ZSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCAwICk7CgkJCW51bUdsb2JhbFBsYW5lcyA9IHBsYW5lcy5sZW5ndGg7CgoJCQlyZXR1cm4gZW5hYmxlZDsKCgkJfTsKCgkJdGhpcy5iZWdpblNoYWRvd3MgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZW5kZXJpbmdTaGFkb3dzID0gdHJ1ZTsKCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKCQl9OwoKCQl0aGlzLmVuZFNoYWRvd3MgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZW5kZXJpbmdTaGFkb3dzID0gZmFsc2U7CgkJCXJlc2V0R2xvYmFsU3RhdGUoKTsKCgkJfTsKCgkJdGhpcy5zZXRTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjbGlwSW50ZXJzZWN0aW9uLCBjbGlwU2hhZG93cywgY2FtZXJhLCBjYWNoZSwgZnJvbUNhY2hlICkgewoKCQkJaWYgKCAhIGxvY2FsQ2xpcHBpbmdFbmFibGVkIHx8IHBsYW5lcyA9PT0gbnVsbCB8fCBwbGFuZXMubGVuZ3RoID09PSAwIHx8IHJlbmRlcmluZ1NoYWRvd3MgJiYgISBjbGlwU2hhZG93cyApIHsKCgkJCQkvLyB0aGVyZSdzIG5vIGxvY2FsIGNsaXBwaW5nCgoJCQkJaWYgKCByZW5kZXJpbmdTaGFkb3dzICkgewoKCQkJCQkvLyB0aGVyZSdzIG5vIGdsb2JhbCBjbGlwcGluZwoKCQkJCQlwcm9qZWN0UGxhbmVzKCBudWxsICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVzZXRHbG9iYWxTdGF0ZSgpOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdmFyIG5HbG9iYWwgPSByZW5kZXJpbmdTaGFkb3dzID8gMCA6IG51bUdsb2JhbFBsYW5lcywKCQkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQsCgoJCQkJCWRzdEFycmF5ID0gY2FjaGUuY2xpcHBpbmdTdGF0ZSB8fCBudWxsOwoKCQkJCXVuaWZvcm0udmFsdWUgPSBkc3RBcnJheTsgLy8gZW5zdXJlIHVuaXF1ZSBzdGF0ZQoKCQkJCWRzdEFycmF5ID0gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIGxHbG9iYWwsIGZyb21DYWNoZSApOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gbEdsb2JhbDsgKysgaSApIHsKCgkJCQkJZHN0QXJyYXlbIGkgXSA9IGdsb2JhbFN0YXRlWyBpIF07CgoJCQkJfQoKCQkJCWNhY2hlLmNsaXBwaW5nU3RhdGUgPSBkc3RBcnJheTsKCQkJCXRoaXMubnVtSW50ZXJzZWN0aW9uID0gY2xpcEludGVyc2VjdGlvbiA/IHRoaXMubnVtUGxhbmVzIDogMDsKCQkJCXRoaXMubnVtUGxhbmVzICs9IG5HbG9iYWw7CgoJCQl9CgoKCQl9OwoKCQlmdW5jdGlvbiByZXNldEdsb2JhbFN0YXRlKCkgewoKCQkJaWYgKCB1bmlmb3JtLnZhbHVlICE9PSBnbG9iYWxTdGF0ZSApIHsKCgkJCQl1bmlmb3JtLnZhbHVlID0gZ2xvYmFsU3RhdGU7CgkJCQl1bmlmb3JtLm5lZWRzVXBkYXRlID0gbnVtR2xvYmFsUGxhbmVzID4gMDsKCgkJCX0KCgkJCXNjb3BlLm51bVBsYW5lcyA9IG51bUdsb2JhbFBsYW5lczsKCQkJc2NvcGUubnVtSW50ZXJzZWN0aW9uID0gMDsKCgkJfQoKCQlmdW5jdGlvbiBwcm9qZWN0UGxhbmVzKCBwbGFuZXMsIGNhbWVyYSwgZHN0T2Zmc2V0LCBza2lwVHJhbnNmb3JtICkgewoKCQkJdmFyIG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMCwKCQkJCWRzdEFycmF5ID0gbnVsbDsKCgkJCWlmICggblBsYW5lcyAhPT0gMCApIHsKCgkJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgoJCQkJaWYgKCBza2lwVHJhbnNmb3JtICE9PSB0cnVlIHx8IGRzdEFycmF5ID09PSBudWxsICkgewoKCQkJCQl2YXIgZmxhdFNpemUgPSBkc3RPZmZzZXQgKyBuUGxhbmVzICogNCwKCQkJCQkJdmlld01hdHJpeCA9IGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2U7CgoJCQkJCXZpZXdOb3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCB2aWV3TWF0cml4ICk7CgoJCQkJCWlmICggZHN0QXJyYXkgPT09IG51bGwgfHwgZHN0QXJyYXkubGVuZ3RoIDwgZmxhdFNpemUgKSB7CgoJCQkJCQlkc3RBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIGZsYXRTaXplICk7CgoJCQkJCX0KCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpNCA9IGRzdE9mZnNldDsgaSAhPT0gblBsYW5lczsgKysgaSwgaTQgKz0gNCApIHsKCgkJCQkJCXBsYW5lLmNvcHkoIHBsYW5lc1sgaSBdICkuYXBwbHlNYXRyaXg0KCB2aWV3TWF0cml4LCB2aWV3Tm9ybWFsTWF0cml4ICk7CgoJCQkJCQlwbGFuZS5ub3JtYWwudG9BcnJheSggZHN0QXJyYXksIGk0ICk7CgkJCQkJCWRzdEFycmF5WyBpNCArIDMgXSA9IHBsYW5lLmNvbnN0YW50OwoKCQkJCQl9CgoJCQkJfQoKCQkJCXVuaWZvcm0udmFsdWUgPSBkc3RBcnJheTsKCQkJCXVuaWZvcm0ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJfQoKCQkJc2NvcGUubnVtUGxhbmVzID0gblBsYW5lczsKCgkJCXJldHVybiBkc3RBcnJheTsKCgkJfQoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTEV4dGVuc2lvbnMoIGdsICkgewoKCQl2YXIgZXh0ZW5zaW9ucyA9IHt9OwoKCQlyZXR1cm4gewoKCQkJZ2V0OiBmdW5jdGlvbiAoIG5hbWUgKSB7CgoJCQkJaWYgKCBleHRlbnNpb25zWyBuYW1lIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcmV0dXJuIGV4dGVuc2lvbnNbIG5hbWUgXTsKCgkJCQl9CgoJCQkJdmFyIGV4dGVuc2lvbjsKCgkJCQlzd2l0Y2ggKCBuYW1lICkgewoKCQkJCQljYXNlICdXRUJHTF9kZXB0aF90ZXh0dXJlJzoKCQkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfZGVwdGhfdGV4dHVyZScgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfV0VCR0xfZGVwdGhfdGV4dHVyZScgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfZGVwdGhfdGV4dHVyZScgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyc6CgkJCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Yyc6CgkJCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnOgoJCQkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWRlZmF1bHQ6CgkJCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggbmFtZSApOwoKCQkJCX0KCgkJCQlpZiAoIGV4dGVuc2lvbiA9PT0gbnVsbCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogJyArIG5hbWUgKyAnIGV4dGVuc2lvbiBub3Qgc3VwcG9ydGVkLicgKTsKCgkJCQl9CgoJCQkJZXh0ZW5zaW9uc1sgbmFtZSBdID0gZXh0ZW5zaW9uOwoKCQkJCXJldHVybiBleHRlbnNpb247CgoJCQl9CgoJCX07CgoJfQoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFdlYkdMR2VvbWV0cmllcyggZ2wsIGF0dHJpYnV0ZXMsIGluZm8gKSB7CgoJCXZhciBnZW9tZXRyaWVzID0ge307CgkJdmFyIHdpcmVmcmFtZUF0dHJpYnV0ZXMgPSB7fTsKCgkJZnVuY3Rpb24gb25HZW9tZXRyeURpc3Bvc2UoIGV2ZW50ICkgewoKCQkJdmFyIGdlb21ldHJ5ID0gZXZlbnQudGFyZ2V0OwoJCQl2YXIgYnVmZmVyZ2VvbWV0cnkgPSBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdOwoKCQkJaWYgKCBidWZmZXJnZW9tZXRyeS5pbmRleCAhPT0gbnVsbCApIHsKCgkJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYnVmZmVyZ2VvbWV0cnkuaW5kZXggKTsKCgkJCX0KCgkJCWZvciAoIHZhciBuYW1lIGluIGJ1ZmZlcmdlb21ldHJ5LmF0dHJpYnV0ZXMgKSB7CgoJCQkJYXR0cmlidXRlcy5yZW1vdmUoIGJ1ZmZlcmdlb21ldHJ5LmF0dHJpYnV0ZXNbIG5hbWUgXSApOwoKCQkJfQoKCQkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKCQkJZGVsZXRlIGdlb21ldHJpZXNbIGdlb21ldHJ5LmlkIF07CgoJCQl2YXIgYXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlc1sgYnVmZmVyZ2VvbWV0cnkuaWQgXTsKCgkJCWlmICggYXR0cmlidXRlICkgewoKCQkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBhdHRyaWJ1dGUgKTsKCQkJCWRlbGV0ZSB3aXJlZnJhbWVBdHRyaWJ1dGVzWyBidWZmZXJnZW9tZXRyeS5pZCBdOwoKCQkJfQoKCQkJLy8KCgkJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgLS07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICkgewoKCQkJdmFyIGJ1ZmZlcmdlb21ldHJ5ID0gZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXTsKCgkJCWlmICggYnVmZmVyZ2VvbWV0cnkgKSByZXR1cm4gYnVmZmVyZ2VvbWV0cnk7CgoJCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uR2VvbWV0cnlEaXNwb3NlICk7CgoJCQlpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJYnVmZmVyZ2VvbWV0cnkgPSBnZW9tZXRyeTsKCgkJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQkJaWYgKCBnZW9tZXRyeS5fYnVmZmVyR2VvbWV0cnkgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZ2VvbWV0cnkuX2J1ZmZlckdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCkuc2V0RnJvbU9iamVjdCggb2JqZWN0ICk7CgoJCQkJfQoKCQkJCWJ1ZmZlcmdlb21ldHJ5ID0gZ2VvbWV0cnkuX2J1ZmZlckdlb21ldHJ5OwoKCQkJfQoKCQkJZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXSA9IGJ1ZmZlcmdlb21ldHJ5OwoKCQkJaW5mby5tZW1vcnkuZ2VvbWV0cmllcyArKzsKCgkJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGUoIGdlb21ldHJ5ICkgewoKCQkJdmFyIGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCXZhciBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggaW5kZXgsIDM0OTYzICk7CgoJCQl9CgoJCQlmb3IgKCB2YXIgbmFtZSBpbiBnZW9tZXRyeUF0dHJpYnV0ZXMgKSB7CgoJCQkJYXR0cmlidXRlcy51cGRhdGUoIGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdLCAzNDk2MiApOwoKCQkJfQoKCQkJLy8gbW9ycGggdGFyZ2V0cwoKCQkJdmFyIG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCgkJCWZvciAoIHZhciBuYW1lIGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQl2YXIgYXJyYXkgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggYXJyYXlbIGkgXSwgMzQ5NjIgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2V0V2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApIHsKCgkJCXZhciBhdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzWyBnZW9tZXRyeS5pZCBdOwoKCQkJaWYgKCBhdHRyaWJ1dGUgKSByZXR1cm4gYXR0cmlidXRlOwoKCQkJdmFyIGluZGljZXMgPSBbXTsKCgkJCXZhciBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCXZhciBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJLy8gY29uc29sZS50aW1lKCAnd2lyZWZyYW1lJyApOwoKCQkJaWYgKCBnZW9tZXRyeUluZGV4ICE9PSBudWxsICkgewoKCQkJCXZhciBhcnJheSA9IGdlb21ldHJ5SW5kZXguYXJyYXk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArPSAzICkgewoKCQkJCQl2YXIgYSA9IGFycmF5WyBpICsgMCBdOwoJCQkJCXZhciBiID0gYXJyYXlbIGkgKyAxIF07CgkJCQkJdmFyIGMgPSBhcnJheVsgaSArIDIgXTsKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBiLCBjLCBjLCBhICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQl2YXIgYXJyYXkgPSBnZW9tZXRyeUF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gKCBhcnJheS5sZW5ndGggLyAzICkgLSAxOyBpIDwgbDsgaSArPSAzICkgewoKCQkJCQl2YXIgYSA9IGkgKyAwOwoJCQkJCXZhciBiID0gaSArIDE7CgkJCQkJdmFyIGMgPSBpICsgMjsKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBiLCBjLCBjLCBhICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gY29uc29sZS50aW1lRW5kKCAnd2lyZWZyYW1lJyApOwoKCQkJYXR0cmlidXRlID0gbmV3ICggYXJyYXlNYXgoIGluZGljZXMgKSA+IDY1NTM1ID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGljZXMsIDEgKTsKCgkJCWF0dHJpYnV0ZXMudXBkYXRlKCBhdHRyaWJ1dGUsIDM0OTYzICk7CgoJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzWyBnZW9tZXRyeS5pZCBdID0gYXR0cmlidXRlOwoKCQkJcmV0dXJuIGF0dHJpYnV0ZTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJZ2V0OiBnZXQsCgkJCXVwZGF0ZTogdXBkYXRlLAoKCQkJZ2V0V2lyZWZyYW1lQXR0cmlidXRlOiBnZXRXaXJlZnJhbWVBdHRyaWJ1dGUKCgkJfTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViR0xJbmRleGVkQnVmZmVyUmVuZGVyZXIoIGdsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMgKSB7CgoJCXZhciBtb2RlOwoKCQlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCgkJCW1vZGUgPSB2YWx1ZTsKCgkJfQoKCQl2YXIgdHlwZSwgYnl0ZXNQZXJFbGVtZW50OwoKCQlmdW5jdGlvbiBzZXRJbmRleCggdmFsdWUgKSB7CgoJCQl0eXBlID0gdmFsdWUudHlwZTsKCQkJYnl0ZXNQZXJFbGVtZW50ID0gdmFsdWUuYnl0ZXNQZXJFbGVtZW50OwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKCQkJZ2wuZHJhd0VsZW1lbnRzKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggZ2VvbWV0cnksIHN0YXJ0LCBjb3VudCApIHsKCgkJCXZhciBleHRlbnNpb247CgoJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQlleHRlbnNpb24gPSBnbDsKCgkJCX0gZWxzZSB7CgoJCQkJdmFyIGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiA9PT0gbnVsbCApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyOiB1c2luZyBUSFJFRS5JbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSBidXQgaGFyZHdhcmUgZG9lcyBub3Qgc3VwcG9ydCBleHRlbnNpb24gQU5HTEVfaW5zdGFuY2VkX2FycmF5cy4nICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCX0KCgkJCWV4dGVuc2lvblsgY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gJ2RyYXdFbGVtZW50c0luc3RhbmNlZCcgOiAnZHJhd0VsZW1lbnRzSW5zdGFuY2VkQU5HTEUnIF0oIG1vZGUsIGNvdW50LCB0eXBlLCBzdGFydCAqIGJ5dGVzUGVyRWxlbWVudCwgZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgKTsKCgkJfQoKCQkvLwoKCQl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwoJCXRoaXMuc2V0SW5kZXggPSBzZXRJbmRleDsKCQl0aGlzLnJlbmRlciA9IHJlbmRlcjsKCQl0aGlzLnJlbmRlckluc3RhbmNlcyA9IHJlbmRlckluc3RhbmNlczsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJZnVuY3Rpb24gV2ViR0xJbmZvKCBnbCApIHsKCgkJdmFyIG1lbW9yeSA9IHsKCQkJZ2VvbWV0cmllczogMCwKCQkJdGV4dHVyZXM6IDAKCQl9OwoKCQl2YXIgcmVuZGVyID0gewoJCQlmcmFtZTogMCwKCQkJY2FsbHM6IDAsCgkJCXRyaWFuZ2xlczogMCwKCQkJcG9pbnRzOiAwLAoJCQlsaW5lczogMAoJCX07CgoJCWZ1bmN0aW9uIHVwZGF0ZSggY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQgKSB7CgoJCQlpbnN0YW5jZUNvdW50ID0gaW5zdGFuY2VDb3VudCB8fCAxOwoKCQkJcmVuZGVyLmNhbGxzICsrOwoKCQkJc3dpdGNoICggbW9kZSApIHsKCgkJCQljYXNlIDQ6CgkJCQkJcmVuZGVyLnRyaWFuZ2xlcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAvIDMgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDU6CgkJCQljYXNlIDY6CgkJCQkJcmVuZGVyLnRyaWFuZ2xlcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAtIDIgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDE6CgkJCQkJcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiAoIGNvdW50IC8gMiApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMzoKCQkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLSAxICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAyOgoJCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAwOgoJCQkJCXJlbmRlci5wb2ludHMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5mbzogVW5rbm93biBkcmF3IG1vZGU6JywgbW9kZSApOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQkJcmVuZGVyLmZyYW1lICsrOwoJCQlyZW5kZXIuY2FsbHMgPSAwOwoJCQlyZW5kZXIudHJpYW5nbGVzID0gMDsKCQkJcmVuZGVyLnBvaW50cyA9IDA7CgkJCXJlbmRlci5saW5lcyA9IDA7CgoJCX0KCgkJcmV0dXJuIHsKCQkJbWVtb3J5OiBtZW1vcnksCgkJCXJlbmRlcjogcmVuZGVyLAoJCQlwcm9ncmFtczogbnVsbCwKCQkJYXV0b1Jlc2V0OiB0cnVlLAoJCQlyZXNldDogcmVzZXQsCgkJCXVwZGF0ZTogdXBkYXRlCgkJfTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gYWJzTnVtZXJpY2FsU29ydCggYSwgYiApIHsKCgkJcmV0dXJuIE1hdGguYWJzKCBiWyAxIF0gKSAtIE1hdGguYWJzKCBhWyAxIF0gKTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xNb3JwaHRhcmdldHMoIGdsICkgewoKCQl2YXIgaW5mbHVlbmNlc0xpc3QgPSB7fTsKCQl2YXIgbW9ycGhJbmZsdWVuY2VzID0gbmV3IEZsb2F0MzJBcnJheSggOCApOwoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBwcm9ncmFtICkgewoKCQkJdmFyIG9iamVjdEluZmx1ZW5jZXMgPSBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQkJdmFyIGxlbmd0aCA9IG9iamVjdEluZmx1ZW5jZXMubGVuZ3RoOwoKCQkJdmFyIGluZmx1ZW5jZXMgPSBpbmZsdWVuY2VzTGlzdFsgZ2VvbWV0cnkuaWQgXTsKCgkJCWlmICggaW5mbHVlbmNlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIGluaXRpYWxpc2UgbGlzdAoKCQkJCWluZmx1ZW5jZXMgPSBbXTsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKysgKSB7CgoJCQkJCWluZmx1ZW5jZXNbIGkgXSA9IFsgaSwgMCBdOwoKCQkJCX0KCgkJCQlpbmZsdWVuY2VzTGlzdFsgZ2VvbWV0cnkuaWQgXSA9IGluZmx1ZW5jZXM7CgoJCQl9CgoJCQl2YXIgbW9ycGhUYXJnZXRzID0gbWF0ZXJpYWwubW9ycGhUYXJnZXRzICYmIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJdmFyIG1vcnBoTm9ybWFscyA9IG1hdGVyaWFsLm1vcnBoTm9ybWFscyAmJiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsOwoKCQkJLy8gUmVtb3ZlIGN1cnJlbnQgbW9ycGhBdHRyaWJ1dGVzCgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGluZmx1ZW5jZSA9IGluZmx1ZW5jZXNbIGkgXTsKCgkJCQlpZiAoIGluZmx1ZW5jZVsgMSBdICE9PSAwICkgewoKCQkJCQlpZiAoIG1vcnBoVGFyZ2V0cyApIGdlb21ldHJ5LnJlbW92ZUF0dHJpYnV0ZSggJ21vcnBoVGFyZ2V0JyArIGkgKTsKCQkJCQlpZiAoIG1vcnBoTm9ybWFscyApIGdlb21ldHJ5LnJlbW92ZUF0dHJpYnV0ZSggJ21vcnBoTm9ybWFsJyArIGkgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBDb2xsZWN0IGluZmx1ZW5jZXMKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArKyApIHsKCgkJCQl2YXIgaW5mbHVlbmNlID0gaW5mbHVlbmNlc1sgaSBdOwoKCQkJCWluZmx1ZW5jZVsgMCBdID0gaTsKCQkJCWluZmx1ZW5jZVsgMSBdID0gb2JqZWN0SW5mbHVlbmNlc1sgaSBdOwoKCQkJfQoKCQkJaW5mbHVlbmNlcy5zb3J0KCBhYnNOdW1lcmljYWxTb3J0ICk7CgoJCQkvLyBBZGQgbW9ycGhBdHRyaWJ1dGVzCgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCA4OyBpICsrICkgewoKCQkJCXZhciBpbmZsdWVuY2UgPSBpbmZsdWVuY2VzWyBpIF07CgoJCQkJaWYgKCBpbmZsdWVuY2UgKSB7CgoJCQkJCXZhciBpbmRleCA9IGluZmx1ZW5jZVsgMCBdOwoJCQkJCXZhciB2YWx1ZSA9IGluZmx1ZW5jZVsgMSBdOwoKCQkJCQlpZiAoIHZhbHVlICkgewoKCQkJCQkJaWYgKCBtb3JwaFRhcmdldHMgKSBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdtb3JwaFRhcmdldCcgKyBpLCBtb3JwaFRhcmdldHNbIGluZGV4IF0gKTsKCQkJCQkJaWYgKCBtb3JwaE5vcm1hbHMgKSBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdtb3JwaE5vcm1hbCcgKyBpLCBtb3JwaE5vcm1hbHNbIGluZGV4IF0gKTsKCgkJCQkJCW1vcnBoSW5mbHVlbmNlc1sgaSBdID0gdmFsdWU7CgkJCQkJCWNvbnRpbnVlOwoKCQkJCQl9CgoJCQkJfQoKCQkJCW1vcnBoSW5mbHVlbmNlc1sgaSBdID0gMDsKCgkJCX0KCgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBtb3JwaEluZmx1ZW5jZXMgKTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJdXBkYXRlOiB1cGRhdGUKCgkJfTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViR0xPYmplY3RzKCBnZW9tZXRyaWVzLCBpbmZvICkgewoKCQl2YXIgdXBkYXRlTGlzdCA9IHt9OwoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCApIHsKCgkJCXZhciBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKCQkJdmFyIGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoJCQl2YXIgYnVmZmVyZ2VvbWV0cnkgPSBnZW9tZXRyaWVzLmdldCggb2JqZWN0LCBnZW9tZXRyeSApOwoKCQkJLy8gVXBkYXRlIG9uY2UgcGVyIGZyYW1lCgoJCQlpZiAoIHVwZGF0ZUxpc3RbIGJ1ZmZlcmdlb21ldHJ5LmlkIF0gIT09IGZyYW1lICkgewoKCQkJCWlmICggZ2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCQkJYnVmZmVyZ2VvbWV0cnkudXBkYXRlRnJvbU9iamVjdCggb2JqZWN0ICk7CgoJCQkJfQoKCQkJCWdlb21ldHJpZXMudXBkYXRlKCBidWZmZXJnZW9tZXRyeSApOwoKCQkJCXVwZGF0ZUxpc3RbIGJ1ZmZlcmdlb21ldHJ5LmlkIF0gPSBmcmFtZTsKCgkJCX0KCgkJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJdXBkYXRlTGlzdCA9IHt9OwoKCQl9CgoJCXJldHVybiB7CgoJCQl1cGRhdGU6IHVwZGF0ZSwKCQkJZGlzcG9zZTogZGlzcG9zZQoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBDdWJlVGV4dHVyZSggaW1hZ2VzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHksIGVuY29kaW5nICkgewoKCQlpbWFnZXMgPSBpbWFnZXMgIT09IHVuZGVmaW5lZCA/IGltYWdlcyA6IFtdOwoJCW1hcHBpbmcgPSBtYXBwaW5nICE9PSB1bmRlZmluZWQgPyBtYXBwaW5nIDogQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoJCWZvcm1hdCA9IGZvcm1hdCAhPT0gdW5kZWZpbmVkID8gZm9ybWF0IDogUkdCRm9ybWF0OwoKCQlUZXh0dXJlLmNhbGwoIHRoaXMsIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBlbmNvZGluZyApOwoKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgoJfQoKCUN1YmVUZXh0dXJlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFRleHR1cmUucHJvdG90eXBlICk7CglDdWJlVGV4dHVyZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDdWJlVGV4dHVyZTsKCglDdWJlVGV4dHVyZS5wcm90b3R5cGUuaXNDdWJlVGV4dHVyZSA9IHRydWU7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBDdWJlVGV4dHVyZS5wcm90b3R5cGUsICdpbWFnZXMnLCB7CgoJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuaW1hZ2U7CgoJCX0sCgoJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMuaW1hZ2UgPSB2YWx1ZTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgVGFrYWhpcm8gaHR0cHM6Ly9naXRodWIuY29tL3Rha2FoaXJveAoJICovCgoJZnVuY3Rpb24gRGF0YVRleHR1cmUyREFycmF5KCBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApIHsKCgkJVGV4dHVyZS5jYWxsKCB0aGlzLCBudWxsICk7CgoJCXRoaXMuaW1hZ2UgPSB7IGRhdGE6IGRhdGEsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIGRlcHRoOiBkZXB0aCB9OwoKCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwoKCQl0aGlzLndyYXBSID0gQ2xhbXBUb0VkZ2VXcmFwcGluZzsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgoJfQoKCURhdGFUZXh0dXJlMkRBcnJheS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBUZXh0dXJlLnByb3RvdHlwZSApOwoJRGF0YVRleHR1cmUyREFycmF5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERhdGFUZXh0dXJlMkRBcnJheTsKCURhdGFUZXh0dXJlMkRBcnJheS5wcm90b3R5cGUuaXNEYXRhVGV4dHVyZTJEQXJyYXkgPSB0cnVlOwoKCS8qKgoJICogQGF1dGhvciBBcnR1ciBUcnplc2lvawoJICovCgoJZnVuY3Rpb24gRGF0YVRleHR1cmUzRCggZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggKSB7CgoJCS8vIFdlJ3JlIGdvaW5nIHRvIGFkZCAuc2V0WFhYKCkgbWV0aG9kcyBmb3Igc2V0dGluZyBwcm9wZXJ0aWVzIGxhdGVyLgoJCS8vIFVzZXJzIGNhbiBzdGlsbCBzZXQgaW4gRGF0YVRleHR1cmUzRCBkaXJlY3RseS4KCQkvLwoJCS8vCXZhciB0ZXh0dXJlID0gbmV3IFRIUkVFLkRhdGFUZXh0dXJlM0QoIGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoICk7CgkJLy8gCXRleHR1cmUuYW5pc290cm9weSA9IDE2OwoJCS8vCgkJLy8gU2VlICMxNDgzOQoKCQlUZXh0dXJlLmNhbGwoIHRoaXMsIG51bGwgKTsKCgkJdGhpcy5pbWFnZSA9IHsgZGF0YTogZGF0YSwgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IGRlcHRoIH07CgoJCXRoaXMubWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgl9CgoJRGF0YVRleHR1cmUzRC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBUZXh0dXJlLnByb3RvdHlwZSApOwoJRGF0YVRleHR1cmUzRC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBEYXRhVGV4dHVyZTNEOwoJRGF0YVRleHR1cmUzRC5wcm90b3R5cGUuaXNEYXRhVGV4dHVyZTNEID0gdHJ1ZTsKCgkvKioKCSAqIEBhdXRob3IgdHNjaHcKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICoKCSAqIFVuaWZvcm1zIG9mIGEgcHJvZ3JhbS4KCSAqIFRob3NlIGZvcm0gYSB0cmVlIHN0cnVjdHVyZSB3aXRoIGEgc3BlY2lhbCB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgcm9vdCwKCSAqIHdoaWNoIHlvdSBnZXQgYnkgY2FsbGluZyAnbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtLCByZW5kZXJlciApJy4KCSAqCgkgKgoJICogUHJvcGVydGllcyBvZiBpbm5lciBub2RlcyBpbmNsdWRpbmcgdGhlIHRvcC1sZXZlbCBjb250YWluZXI6CgkgKgoJICogLnNlcSAtIGFycmF5IG9mIG5lc3RlZCB1bmlmb3JtcwoJICogLm1hcCAtIG5lc3RlZCB1bmlmb3JtcyBieSBuYW1lCgkgKgoJICoKCSAqIE1ldGhvZHMgb2YgYWxsIG5vZGVzIGV4Y2VwdCB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcjoKCSAqCgkgKiAuc2V0VmFsdWUoIGdsLCB2YWx1ZSwgW3JlbmRlcmVyXSApCgkgKgoJICogCQl1cGxvYWRzIGEgdW5pZm9ybSB2YWx1ZShzKQoJICogIAl0aGUgJ3JlbmRlcmVyJyBwYXJhbWV0ZXIgaXMgbmVlZGVkIGZvciBzYW1wbGVyIHVuaWZvcm1zCgkgKgoJICoKCSAqIFN0YXRpYyBtZXRob2RzIG9mIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIChyZW5kZXJlciBmYWN0b3JpemF0aW9ucyk6CgkgKgoJICogLnVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCByZW5kZXJlciApCgkgKgoJICogCQlzZXRzIHVuaWZvcm1zIGluICdzZXEnIHRvICd2YWx1ZXNbaWRdLnZhbHVlJwoJICoKCSAqIC5zZXFXaXRoVmFsdWUoIHNlcSwgdmFsdWVzICkgOiBmaWx0ZXJlZFNlcQoJICoKCSAqIAkJZmlsdGVycyAnc2VxJyBlbnRyaWVzIHdpdGggY29ycmVzcG9uZGluZyBlbnRyeSBpbiB2YWx1ZXMKCSAqCgkgKgoJICogTWV0aG9kcyBvZiB0aGUgdG9wLWxldmVsIGNvbnRhaW5lciAocmVuZGVyZXIgZmFjdG9yaXphdGlvbnMpOgoJICoKCSAqIC5zZXRWYWx1ZSggZ2wsIG5hbWUsIHZhbHVlICkKCSAqCgkgKiAJCXNldHMgdW5pZm9ybSB3aXRoICBuYW1lICduYW1lJyB0byAndmFsdWUnCgkgKgoJICogLnNldCggZ2wsIG9iaiwgcHJvcCApCgkgKgoJICogCQlzZXRzIHVuaWZvcm0gZnJvbSBvYmplY3QgYW5kIHByb3BlcnR5IHdpdGggc2FtZSBuYW1lIHRoYW4gdW5pZm9ybQoJICoKCSAqIC5zZXRPcHRpb25hbCggZ2wsIG9iaiwgcHJvcCApCgkgKgoJICogCQlsaWtlIC5zZXQgZm9yIGFuIG9wdGlvbmFsIHByb3BlcnR5IG9mIHRoZSBvYmplY3QKCSAqCgkgKi8KCgl2YXIgZW1wdHlUZXh0dXJlID0gbmV3IFRleHR1cmUoKTsKCXZhciBlbXB0eVRleHR1cmUyZEFycmF5ID0gbmV3IERhdGFUZXh0dXJlMkRBcnJheSgpOwoJdmFyIGVtcHR5VGV4dHVyZTNkID0gbmV3IERhdGFUZXh0dXJlM0QoKTsKCXZhciBlbXB0eUN1YmVUZXh0dXJlID0gbmV3IEN1YmVUZXh0dXJlKCk7CgoJLy8gLS0tIEJhc2UgZm9yIGlubmVyIG5vZGVzIChpbmNsdWRpbmcgdGhlIHJvb3QpIC0tLQoKCWZ1bmN0aW9uIFVuaWZvcm1Db250YWluZXIoKSB7CgoJCXRoaXMuc2VxID0gW107CgkJdGhpcy5tYXAgPSB7fTsKCgl9CgoJLy8gLS0tIFV0aWxpdGllcyAtLS0KCgkvLyBBcnJheSBDYWNoZXMgKHByb3ZpZGUgdHlwZWQgYXJyYXlzIGZvciB0ZW1wb3JhcnkgYnkgc2l6ZSkKCgl2YXIgYXJyYXlDYWNoZUYzMiA9IFtdOwoJdmFyIGFycmF5Q2FjaGVJMzIgPSBbXTsKCgkvLyBGbG9hdDMyQXJyYXkgY2FjaGVzIHVzZWQgZm9yIHVwbG9hZGluZyBNYXRyaXggdW5pZm9ybXMKCgl2YXIgbWF0NGFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggMTYgKTsKCXZhciBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7Cgl2YXIgbWF0MmFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggNCApOwoKCS8vIEZsYXR0ZW5pbmcgZm9yIGFycmF5cyBvZiB2ZWN0b3JzIGFuZCBtYXRyaWNlcwoKCWZ1bmN0aW9uIGZsYXR0ZW4oIGFycmF5LCBuQmxvY2tzLCBibG9ja1NpemUgKSB7CgoJCXZhciBmaXJzdEVsZW0gPSBhcnJheVsgMCBdOwoKCQlpZiAoIGZpcnN0RWxlbSA8PSAwIHx8IGZpcnN0RWxlbSA+IDAgKSByZXR1cm4gYXJyYXk7CgkJLy8gdW5vcHRpbWl6ZWQ6ICEgaXNOYU4oIGZpcnN0RWxlbSApCgkJLy8gc2VlIGh0dHA6Ly9qYWNrc29uZHVuc3Rhbi5jb20vYXJ0aWNsZXMvOTgzCgoJCXZhciBuID0gbkJsb2NrcyAqIGJsb2NrU2l6ZSwKCQkJciA9IGFycmF5Q2FjaGVGMzJbIG4gXTsKCgkJaWYgKCByID09PSB1bmRlZmluZWQgKSB7CgoJCQlyID0gbmV3IEZsb2F0MzJBcnJheSggbiApOwoJCQlhcnJheUNhY2hlRjMyWyBuIF0gPSByOwoKCQl9CgoJCWlmICggbkJsb2NrcyAhPT0gMCApIHsKCgkJCWZpcnN0RWxlbS50b0FycmF5KCByLCAwICk7CgoJCQlmb3IgKCB2YXIgaSA9IDEsIG9mZnNldCA9IDA7IGkgIT09IG5CbG9ja3M7ICsrIGkgKSB7CgoJCQkJb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKCQkJCWFycmF5WyBpIF0udG9BcnJheSggciwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHI7CgoJfQoKCWZ1bmN0aW9uIGFycmF5c0VxdWFsKCBhLCBiICkgewoKCQlpZiAoIGEubGVuZ3RoICE9PSBiLmxlbmd0aCApIHJldHVybiBmYWxzZTsKCgkJZm9yICggdmFyIGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJaWYgKCBhWyBpIF0gIT09IGJbIGkgXSApIHJldHVybiBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJZnVuY3Rpb24gY29weUFycmF5KCBhLCBiICkgewoKCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBiLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlhWyBpIF0gPSBiWyBpIF07CgoJCX0KCgl9CgoJLy8gVGV4dHVyZSB1bml0IGFsbG9jYXRpb24KCglmdW5jdGlvbiBhbGxvY1RleFVuaXRzKCByZW5kZXJlciwgbiApIHsKCgkJdmFyIHIgPSBhcnJheUNhY2hlSTMyWyBuIF07CgoJCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKCQkJciA9IG5ldyBJbnQzMkFycmF5KCBuICk7CgkJCWFycmF5Q2FjaGVJMzJbIG4gXSA9IHI7CgoJCX0KCgkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuOyArKyBpICkKCQkJclsgaSBdID0gcmVuZGVyZXIuYWxsb2NUZXh0dXJlVW5pdCgpOwoKCQlyZXR1cm4gcjsKCgl9CgoJLy8gLS0tIFNldHRlcnMgLS0tCgoJLy8gTm90ZTogRGVmaW5pbmcgdGhlc2UgbWV0aG9kcyBleHRlcm5hbGx5LCBiZWNhdXNlIHRoZXkgY29tZSBpbiBhIGJ1bmNoCgkvLyBhbmQgdGhpcyB3YXkgdGhlaXIgbmFtZXMgbWluaWZ5LgoKCS8vIFNpbmdsZSBzY2FsYXIKCglmdW5jdGlvbiBzZXRWYWx1ZTFmKCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMWYoIHRoaXMuYWRkciwgdiApOwoKCQljYWNoZVsgMCBdID0gdjsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWUxaSggZ2wsIHYgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJCWlmICggY2FjaGVbIDAgXSA9PT0gdiApIHJldHVybjsKCgkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHYgKTsKCgkJY2FjaGVbIDAgXSA9IHY7CgoJfQoKCS8vIFNpbmdsZSBmbG9hdCB2ZWN0b3IgKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5WZWN0b3JOKQoKCWZ1bmN0aW9uIHNldFZhbHVlMmZ2KCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCQlnbC51bmlmb3JtMmYoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZTNmdiggZ2wsIHYgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56ICkgewoKCQkJCWdsLnVuaWZvcm0zZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56ICk7CgoJCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCQljYWNoZVsgMiBdID0gdi56OwoKCQkJfQoKCQl9IGVsc2UgaWYgKCB2LnIgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi5yIHx8IGNhY2hlWyAxIF0gIT09IHYuZyB8fCBjYWNoZVsgMiBdICE9PSB2LmIgKSB7CgoJCQkJZ2wudW5pZm9ybTNmKCB0aGlzLmFkZHIsIHYuciwgdi5nLCB2LmIgKTsKCgkJCQljYWNoZVsgMCBdID0gdi5yOwoJCQkJY2FjaGVbIDEgXSA9IHYuZzsKCQkJCWNhY2hlWyAyIF0gPSB2LmI7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTNmdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWU0ZnYoIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgoJCQkJZ2wudW5pZm9ybTRmKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnosIHYudyApOwoKCQkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCQljYWNoZVsgMSBdID0gdi55OwoJCQkJY2FjaGVbIDIgXSA9IHYuejsKCQkJCWNhY2hlWyAzIF0gPSB2Lnc7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJLy8gU2luZ2xlIG1hdHJpeCAoZnJvbSBmbGF0IGFycmF5IG9yIE1hdHJpeE4pCgoJZnVuY3Rpb24gc2V0VmFsdWUyZm0oIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCXZhciBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgoJCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCgkJCW1hdDJhcnJheS5zZXQoIGVsZW1lbnRzICk7CgoJCQlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQyYXJyYXkgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWUzZm0oIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCXZhciBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgoJCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCgkJCW1hdDNhcnJheS5zZXQoIGVsZW1lbnRzICk7CgoJCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQzYXJyYXkgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWU0Zm0oIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCXZhciBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgoJCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCgkJCW1hdDRhcnJheS5zZXQoIGVsZW1lbnRzICk7CgoJCQlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQ0YXJyYXkgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgoJCX0KCgl9CgoJLy8gU2luZ2xlIHRleHR1cmUgKDJEIC8gQ3ViZSkKCglmdW5jdGlvbiBzZXRWYWx1ZVQxKCBnbCwgdiwgcmVuZGVyZXIgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJdmFyIHVuaXQgPSByZW5kZXJlci5hbGxvY1RleHR1cmVVbml0KCk7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJCWNhY2hlWyAwIF0gPSB1bml0OwoKCQl9CgoJCXJlbmRlcmVyLnNldFRleHR1cmUyRCggdiB8fCBlbXB0eVRleHR1cmUsIHVuaXQgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheTEoIGdsLCB2LCByZW5kZXJlciApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgdW5pdCA9IHJlbmRlcmVyLmFsbG9jVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJcmVuZGVyZXIuc2V0VGV4dHVyZTJEQXJyYXkoIHYgfHwgZW1wdHlUZXh0dXJlMmRBcnJheSwgdW5pdCApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVQzRDEoIGdsLCB2LCByZW5kZXJlciApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgdW5pdCA9IHJlbmRlcmVyLmFsbG9jVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJcmVuZGVyZXIuc2V0VGV4dHVyZTNEKCB2IHx8IGVtcHR5VGV4dHVyZTNkLCB1bml0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDYoIGdsLCB2LCByZW5kZXJlciApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgdW5pdCA9IHJlbmRlcmVyLmFsbG9jVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJcmVuZGVyZXIuc2V0VGV4dHVyZUN1YmUoIHYgfHwgZW1wdHlDdWJlVGV4dHVyZSwgdW5pdCApOwoKCX0KCgkvLyBJbnRlZ2VyIC8gQm9vbGVhbiB2ZWN0b3JzIG9yIGFycmF5cyB0aGVyZW9mIChhbHdheXMgZmxhdCBhcnJheXMpCgoJZnVuY3Rpb24gc2V0VmFsdWUyaXYoIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZTNpdiggZ2wsIHYgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0zaXYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlNGl2KCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTRpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9CgoJLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgdGhlIHNpbmd1bGFyIGNhc2UKCglmdW5jdGlvbiBnZXRTaW5ndWxhclNldHRlciggdHlwZSApIHsKCgkJc3dpdGNoICggdHlwZSApIHsKCgkJCWNhc2UgMHgxNDA2OiByZXR1cm4gc2V0VmFsdWUxZjsgLy8gRkxPQVQKCQkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZTJmdjsgLy8gX1ZFQzIKCQkJY2FzZSAweDhiNTE6IHJldHVybiBzZXRWYWx1ZTNmdjsgLy8gX1ZFQzMKCQkJY2FzZSAweDhiNTI6IHJldHVybiBzZXRWYWx1ZTRmdjsgLy8gX1ZFQzQKCgkJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWUyZm07IC8vIF9NQVQyCgkJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWUzZm07IC8vIF9NQVQzCgkJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWU0Zm07IC8vIF9NQVQ0CgoJCQljYXNlIDB4OGI1ZTogY2FzZSAweDhkNjY6IHJldHVybiBzZXRWYWx1ZVQxOyAvLyBTQU1QTEVSXzJELCBTQU1QTEVSX0VYVEVSTkFMX09FUwoJCQljYXNlIDB4OGI1ZjogcmV0dXJuIHNldFZhbHVlVDNEMTsgLy8gU0FNUExFUl8zRAoJCQljYXNlIDB4OGI2MDogcmV0dXJuIHNldFZhbHVlVDY7IC8vIFNBTVBMRVJfQ1VCRQoJCQljYXNlIDB4OERDMTogcmV0dXJuIHNldFZhbHVlVDJEQXJyYXkxOyAvLyBTQU1QTEVSXzJEX0FSUkFZCgoJCQljYXNlIDB4MTQwNDogY2FzZSAweDhiNTY6IHJldHVybiBzZXRWYWx1ZTFpOyAvLyBJTlQsIEJPT0wKCQkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWUyaXY7IC8vIF9WRUMyCgkJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlM2l2OyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZTRpdjsgLy8gX1ZFQzQKCgkJfQoKCX0KCgkvLyBBcnJheSBvZiBzY2FsYXJzCgoJZnVuY3Rpb24gc2V0VmFsdWUxZnYoIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMWZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCWZ1bmN0aW9uIHNldFZhbHVlMWl2KCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTFpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgdmVjdG9ycyAoZmxhdCBvciBmcm9tIFRIUkVFIGNsYXNzZXMpCgoJZnVuY3Rpb24gc2V0VmFsdWVWMmEoIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCXZhciBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAyICk7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCBkYXRhICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0yZnYoIHRoaXMuYWRkciwgZGF0YSApOwoKCQl0aGlzLnVwZGF0ZUNhY2hlKCBkYXRhICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjNhKCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMyApOwoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZGF0YSApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtM2Z2KCB0aGlzLmFkZHIsIGRhdGEgKTsKCgkJdGhpcy51cGRhdGVDYWNoZSggZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0YSggZ2wsIHYgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJdmFyIGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGRhdGEgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCBkYXRhICk7CgoJCXRoaXMudXBkYXRlQ2FjaGUoIGRhdGEgKTsKCgl9CgoJLy8gQXJyYXkgb2YgbWF0cmljZXMgKGZsYXQgb3IgZnJvbSBUSFJFRSBjbGFzZXMpCgoJZnVuY3Rpb24gc2V0VmFsdWVNMmEoIGdsLCB2ICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCXZhciBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA0ICk7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCBkYXRhICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm1NYXRyaXgyZnYoIHRoaXMuYWRkciwgZmFsc2UsIGRhdGEgKTsKCgkJdGhpcy51cGRhdGVDYWNoZSggZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZU0zYSggZ2wsIHYgKSB7CgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJdmFyIGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDkgKTsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGRhdGEgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCQl0aGlzLnVwZGF0ZUNhY2hlKCBkYXRhICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlTTRhKCBnbCwgdiApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMTYgKTsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGRhdGEgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCQl0aGlzLnVwZGF0ZUNhY2hlKCBkYXRhICk7CgoJfQoKCS8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIEN1YmUpCgoJZnVuY3Rpb24gc2V0VmFsdWVUMWEoIGdsLCB2LCByZW5kZXJlciApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgbiA9IHYubGVuZ3RoOwoKCQl2YXIgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCByZW5kZXJlciwgbiApOwoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSA9PT0gZmFsc2UgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJcmVuZGVyZXIuc2V0VGV4dHVyZTJEKCB2WyBpIF0gfHwgZW1wdHlUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUNmEoIGdsLCB2LCByZW5kZXJlciApIHsKCgkJdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKCQl2YXIgbiA9IHYubGVuZ3RoOwoKCQl2YXIgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCByZW5kZXJlciwgbiApOwoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSA9PT0gZmFsc2UgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJcmVuZGVyZXIuc2V0VGV4dHVyZUN1YmUoIHZbIGkgXSB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJCX0KCgl9CgoJLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgYSBwdXJlIChib3R0b20tbGV2ZWwpIGFycmF5CgoJZnVuY3Rpb24gZ2V0UHVyZUFycmF5U2V0dGVyKCB0eXBlICkgewoKCQlzd2l0Y2ggKCB0eXBlICkgewoKCQkJY2FzZSAweDE0MDY6IHJldHVybiBzZXRWYWx1ZTFmdjsgLy8gRkxPQVQKCQkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZVYyYTsgLy8gX1ZFQzIKCQkJY2FzZSAweDhiNTE6IHJldHVybiBzZXRWYWx1ZVYzYTsgLy8gX1ZFQzMKCQkJY2FzZSAweDhiNTI6IHJldHVybiBzZXRWYWx1ZVY0YTsgLy8gX1ZFQzQKCgkJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWVNMmE7IC8vIF9NQVQyCgkJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM2E7IC8vIF9NQVQzCgkJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNGE7IC8vIF9NQVQ0CgoJCQljYXNlIDB4OGI1ZTogcmV0dXJuIHNldFZhbHVlVDFhOyAvLyBTQU1QTEVSXzJECgkJCWNhc2UgMHg4YjYwOiByZXR1cm4gc2V0VmFsdWVUNmE7IC8vIFNBTVBMRVJfQ1VCRQoKCQkJY2FzZSAweDE0MDQ6IGNhc2UgMHg4YjU2OiByZXR1cm4gc2V0VmFsdWUxaXY7IC8vIElOVCwgQk9PTAoJCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZTJpdjsgLy8gX1ZFQzIKCQkJY2FzZSAweDhiNTQ6IGNhc2UgMHg4YjU4OiByZXR1cm4gc2V0VmFsdWUzaXY7IC8vIF9WRUMzCgkJCWNhc2UgMHg4YjU1OiBjYXNlIDB4OGI1OTogcmV0dXJuIHNldFZhbHVlNGl2OyAvLyBfVkVDNAoKCQl9CgoJfQoKCS8vIC0tLSBVbmlmb3JtIENsYXNzZXMgLS0tCgoJZnVuY3Rpb24gU2luZ2xlVW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSB7CgoJCXRoaXMuaWQgPSBpZDsKCQl0aGlzLmFkZHIgPSBhZGRyOwoJCXRoaXMuY2FjaGUgPSBbXTsKCQl0aGlzLnNldFZhbHVlID0gZ2V0U2luZ3VsYXJTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKCQkvLyB0aGlzLnBhdGggPSBhY3RpdmVJbmZvLm5hbWU7IC8vIERFQlVHCgoJfQoKCWZ1bmN0aW9uIFB1cmVBcnJheVVuaWZvcm0oIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQl0aGlzLmlkID0gaWQ7CgkJdGhpcy5hZGRyID0gYWRkcjsKCQl0aGlzLmNhY2hlID0gW107CgkJdGhpcy5zaXplID0gYWN0aXZlSW5mby5zaXplOwoJCXRoaXMuc2V0VmFsdWUgPSBnZXRQdXJlQXJyYXlTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKCQkvLyB0aGlzLnBhdGggPSBhY3RpdmVJbmZvLm5hbWU7IC8vIERFQlVHCgoJfQoKCVB1cmVBcnJheVVuaWZvcm0ucHJvdG90eXBlLnVwZGF0ZUNhY2hlID0gZnVuY3Rpb24gKCBkYXRhICkgewoKCQl2YXIgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGRhdGEgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgJiYgY2FjaGUubGVuZ3RoICE9PSBkYXRhLmxlbmd0aCApIHsKCgkJCXRoaXMuY2FjaGUgPSBuZXcgRmxvYXQzMkFycmF5KCBkYXRhLmxlbmd0aCApOwoKCQl9CgoJCWNvcHlBcnJheSggY2FjaGUsIGRhdGEgKTsKCgl9OwoKCWZ1bmN0aW9uIFN0cnVjdHVyZWRVbmlmb3JtKCBpZCApIHsKCgkJdGhpcy5pZCA9IGlkOwoKCQlVbmlmb3JtQ29udGFpbmVyLmNhbGwoIHRoaXMgKTsgLy8gbWl4LWluCgoJfQoKCVN0cnVjdHVyZWRVbmlmb3JtLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uICggZ2wsIHZhbHVlLCByZW5kZXJlciApIHsKCgkJdmFyIHNlcSA9IHRoaXMuc2VxOwoKCQlmb3IgKCB2YXIgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJdmFyIHUgPSBzZXFbIGkgXTsKCQkJdS5zZXRWYWx1ZSggZ2wsIHZhbHVlWyB1LmlkIF0sIHJlbmRlcmVyICk7CgoJCX0KCgl9OwoKCS8vIC0tLSBUb3AtbGV2ZWwgLS0tCgoJLy8gUGFyc2VyIC0gYnVpbGRzIHVwIHRoZSBwcm9wZXJ0eSB0cmVlIGZyb20gdGhlIHBhdGggc3RyaW5ncwoKCXZhciBSZVBhdGhQYXJ0ID0gLyhbXHdcZF9dKykoXF0pPyhcW3xcLik/L2c7CgoJLy8gZXh0cmFjdHMKCS8vIAktIHRoZSBpZGVudGlmaWVyIChtZW1iZXIgbmFtZSBvciBhcnJheSBpbmRleCkKCS8vICAtIGZvbGxvd2VkIGJ5IGFuIG9wdGlvbmFsIHJpZ2h0IGJyYWNrZXQgKGZvdW5kIHdoZW4gYXJyYXkgaW5kZXgpCgkvLyAgLSBmb2xsb3dlZCBieSBhbiBvcHRpb25hbCBsZWZ0IGJyYWNrZXQgb3IgZG90ICh0eXBlIG9mIHN1YnNjcmlwdCkKCS8vCgkvLyBOb3RlOiBUaGVzZSBwb3J0aW9ucyBjYW4gYmUgcmVhZCBpbiBhIG5vbi1vdmVybGFwcGluZyBmYXNoaW9uIGFuZAoJLy8gYWxsb3cgc3RyYWlnaHRmb3J3YXJkIHBhcnNpbmcgb2YgdGhlIGhpZXJhcmNoeSB0aGF0IFdlYkdMIGVuY29kZXMKCS8vIGluIHRoZSB1bmlmb3JtIG5hbWVzLgoKCWZ1bmN0aW9uIGFkZFVuaWZvcm0oIGNvbnRhaW5lciwgdW5pZm9ybU9iamVjdCApIHsKCgkJY29udGFpbmVyLnNlcS5wdXNoKCB1bmlmb3JtT2JqZWN0ICk7CgkJY29udGFpbmVyLm1hcFsgdW5pZm9ybU9iamVjdC5pZCBdID0gdW5pZm9ybU9iamVjdDsKCgl9CgoJZnVuY3Rpb24gcGFyc2VVbmlmb3JtKCBhY3RpdmVJbmZvLCBhZGRyLCBjb250YWluZXIgKSB7CgoJCXZhciBwYXRoID0gYWN0aXZlSW5mby5uYW1lLAoJCQlwYXRoTGVuZ3RoID0gcGF0aC5sZW5ndGg7CgoJCS8vIHJlc2V0IFJlZ0V4cCBvYmplY3QsIGJlY2F1c2Ugb2YgdGhlIGVhcmx5IGV4aXQgb2YgYSBwcmV2aW91cyBydW4KCQlSZVBhdGhQYXJ0Lmxhc3RJbmRleCA9IDA7CgoJCXdoaWxlICggdHJ1ZSApIHsKCgkJCXZhciBtYXRjaCA9IFJlUGF0aFBhcnQuZXhlYyggcGF0aCApLAoJCQkJbWF0Y2hFbmQgPSBSZVBhdGhQYXJ0Lmxhc3RJbmRleCwKCgkJCQlpZCA9IG1hdGNoWyAxIF0sCgkJCQlpZElzSW5kZXggPSBtYXRjaFsgMiBdID09PSAnXScsCgkJCQlzdWJzY3JpcHQgPSBtYXRjaFsgMyBdOwoKCQkJaWYgKCBpZElzSW5kZXggKSBpZCA9IGlkIHwgMDsgLy8gY29udmVydCB0byBpbnRlZ2VyCgoJCQlpZiAoIHN1YnNjcmlwdCA9PT0gdW5kZWZpbmVkIHx8IHN1YnNjcmlwdCA9PT0gJ1snICYmIG1hdGNoRW5kICsgMiA9PT0gcGF0aExlbmd0aCApIHsKCgkJCQkvLyBiYXJlIG5hbWUgb3IgInB1cmUiIGJvdHRvbS1sZXZlbCBhcnJheSAiWzBdIiBzdWZmaXgKCgkJCQlhZGRVbmlmb3JtKCBjb250YWluZXIsIHN1YnNjcmlwdCA9PT0gdW5kZWZpbmVkID8KCQkJCQluZXcgU2luZ2xlVW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSA6CgkJCQkJbmV3IFB1cmVBcnJheVVuaWZvcm0oIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgKTsKCgkJCQlicmVhazsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gc3RlcCBpbnRvIGlubmVyIG5vZGUgLyBjcmVhdGUgaXQgaW4gY2FzZSBpdCBkb2Vzbid0IGV4aXN0CgoJCQkJdmFyIG1hcCA9IGNvbnRhaW5lci5tYXAsIG5leHQgPSBtYXBbIGlkIF07CgoJCQkJaWYgKCBuZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCW5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oIGlkICk7CgkJCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBuZXh0ICk7CgoJCQkJfQoKCQkJCWNvbnRhaW5lciA9IG5leHQ7CgoJCQl9CgoJCX0KCgl9CgoJLy8gUm9vdCBDb250YWluZXIKCglmdW5jdGlvbiBXZWJHTFVuaWZvcm1zKCBnbCwgcHJvZ3JhbSwgcmVuZGVyZXIgKSB7CgoJCVVuaWZvcm1Db250YWluZXIuY2FsbCggdGhpcyApOwoKCQl0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7CgoJCXZhciBuID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgMzU3MTggKTsKCgkJZm9yICggdmFyIGkgPSAwOyBpIDwgbjsgKysgaSApIHsKCgkJCXZhciBpbmZvID0gZ2wuZ2V0QWN0aXZlVW5pZm9ybSggcHJvZ3JhbSwgaSApLAoJCQkJYWRkciA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbiggcHJvZ3JhbSwgaW5mby5uYW1lICk7CgoJCQlwYXJzZVVuaWZvcm0oIGluZm8sIGFkZHIsIHRoaXMgKTsKCgkJfQoKCX0KCglXZWJHTFVuaWZvcm1zLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uICggZ2wsIG5hbWUsIHZhbHVlICkgewoKCQl2YXIgdSA9IHRoaXMubWFwWyBuYW1lIF07CgoJCWlmICggdSAhPT0gdW5kZWZpbmVkICkgdS5zZXRWYWx1ZSggZ2wsIHZhbHVlLCB0aGlzLnJlbmRlcmVyICk7CgoJfTsKCglXZWJHTFVuaWZvcm1zLnByb3RvdHlwZS5zZXRPcHRpb25hbCA9IGZ1bmN0aW9uICggZ2wsIG9iamVjdCwgbmFtZSApIHsKCgkJdmFyIHYgPSBvYmplY3RbIG5hbWUgXTsKCgkJaWYgKCB2ICE9PSB1bmRlZmluZWQgKSB0aGlzLnNldFZhbHVlKCBnbCwgbmFtZSwgdiApOwoKCX07CgoKCS8vIFN0YXRpYyBpbnRlcmZhY2UKCglXZWJHTFVuaWZvcm1zLnVwbG9hZCA9IGZ1bmN0aW9uICggZ2wsIHNlcSwgdmFsdWVzLCByZW5kZXJlciApIHsKCgkJZm9yICggdmFyIGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCXZhciB1ID0gc2VxWyBpIF0sCgkJCQl2ID0gdmFsdWVzWyB1LmlkIF07CgoJCQlpZiAoIHYubmVlZHNVcGRhdGUgIT09IGZhbHNlICkgewoKCQkJCS8vIG5vdGU6IGFsd2F5cyB1cGRhdGluZyB3aGVuIC5uZWVkc1VwZGF0ZSBpcyB1bmRlZmluZWQKCQkJCXUuc2V0VmFsdWUoIGdsLCB2LnZhbHVlLCByZW5kZXJlciApOwoKCQkJfQoKCQl9CgoJfTsKCglXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZSA9IGZ1bmN0aW9uICggc2VxLCB2YWx1ZXMgKSB7CgoJCXZhciByID0gW107CgoJCWZvciAoIHZhciBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQl2YXIgdSA9IHNlcVsgaSBdOwoJCQlpZiAoIHUuaWQgaW4gdmFsdWVzICkgci5wdXNoKCB1ICk7CgoJCX0KCgkJcmV0dXJuIHI7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBhZGRMaW5lTnVtYmVycyggc3RyaW5nICkgewoKCQl2YXIgbGluZXMgPSBzdHJpbmcuc3BsaXQoICdcbicgKTsKCgkJZm9yICggdmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpICsrICkgewoKCQkJbGluZXNbIGkgXSA9ICggaSArIDEgKSArICc6ICcgKyBsaW5lc1sgaSBdOwoKCQl9CgoJCXJldHVybiBsaW5lcy5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIFdlYkdMU2hhZGVyKCBnbCwgdHlwZSwgc3RyaW5nICkgewoKCQl2YXIgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKCB0eXBlICk7CgoJCWdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzdHJpbmcgKTsKCQlnbC5jb21waWxlU2hhZGVyKCBzaGFkZXIgKTsKCgkJaWYgKCBnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoIHNoYWRlciwgMzU3MTMgKSA9PT0gZmFsc2UgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTaGFkZXI6IFNoYWRlciBjb3VsZG5cJ3QgY29tcGlsZS4nICk7CgoJCX0KCgkJaWYgKCBnbC5nZXRTaGFkZXJJbmZvTG9nKCBzaGFkZXIgKSAhPT0gJycgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFNoYWRlcjogZ2wuZ2V0U2hhZGVySW5mb0xvZygpJywgdHlwZSA9PT0gMzU2MzMgPyAndmVydGV4JyA6ICdmcmFnbWVudCcsIGdsLmdldFNoYWRlckluZm9Mb2coIHNoYWRlciApLCBhZGRMaW5lTnVtYmVycyggc3RyaW5nICkgKTsKCgkJfQoKCQkvLyAtLWVuYWJsZS1wcml2aWxlZ2VkLXdlYmdsLWV4dGVuc2lvbgoJCS8vIGNvbnNvbGUubG9nKCB0eXBlLCBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9kZWJ1Z19zaGFkZXJzJyApLmdldFRyYW5zbGF0ZWRTaGFkZXJTb3VyY2UoIHNoYWRlciApICk7CgoJCXJldHVybiBzaGFkZXI7CgoJfQoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCXZhciBwcm9ncmFtSWRDb3VudCA9IDA7CgoJZnVuY3Rpb24gZ2V0RW5jb2RpbmdDb21wb25lbnRzKCBlbmNvZGluZyApIHsKCgkJc3dpdGNoICggZW5jb2RpbmcgKSB7CgoJCQljYXNlIExpbmVhckVuY29kaW5nOgoJCQkJcmV0dXJuIFsgJ0xpbmVhcicsICcoIHZhbHVlICknIF07CgkJCWNhc2Ugc1JHQkVuY29kaW5nOgoJCQkJcmV0dXJuIFsgJ3NSR0InLCAnKCB2YWx1ZSApJyBdOwoJCQljYXNlIFJHQkVFbmNvZGluZzoKCQkJCXJldHVybiBbICdSR0JFJywgJyggdmFsdWUgKScgXTsKCQkJY2FzZSBSR0JNN0VuY29kaW5nOgoJCQkJcmV0dXJuIFsgJ1JHQk0nLCAnKCB2YWx1ZSwgNy4wICknIF07CgkJCWNhc2UgUkdCTTE2RW5jb2Rpbmc6CgkJCQlyZXR1cm4gWyAnUkdCTScsICcoIHZhbHVlLCAxNi4wICknIF07CgkJCWNhc2UgUkdCREVuY29kaW5nOgoJCQkJcmV0dXJuIFsgJ1JHQkQnLCAnKCB2YWx1ZSwgMjU2LjAgKScgXTsKCQkJY2FzZSBHYW1tYUVuY29kaW5nOgoJCQkJcmV0dXJuIFsgJ0dhbW1hJywgJyggdmFsdWUsIGZsb2F0KCBHQU1NQV9GQUNUT1IgKSApJyBdOwoJCQlkZWZhdWx0OgoJCQkJdGhyb3cgbmV3IEVycm9yKCAndW5zdXBwb3J0ZWQgZW5jb2Rpbmc6ICcgKyBlbmNvZGluZyApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGdldFRleGVsRGVjb2RpbmdGdW5jdGlvbiggZnVuY3Rpb25OYW1lLCBlbmNvZGluZyApIHsKCgkJdmFyIGNvbXBvbmVudHMgPSBnZXRFbmNvZGluZ0NvbXBvbmVudHMoIGVuY29kaW5nICk7CgkJcmV0dXJuICd2ZWM0ICcgKyBmdW5jdGlvbk5hbWUgKyAnKCB2ZWM0IHZhbHVlICkgeyByZXR1cm4gJyArIGNvbXBvbmVudHNbIDAgXSArICdUb0xpbmVhcicgKyBjb21wb25lbnRzWyAxIF0gKyAnOyB9JzsKCgl9CgoJZnVuY3Rpb24gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGVuY29kaW5nICkgewoKCQl2YXIgY29tcG9uZW50cyA9IGdldEVuY29kaW5nQ29tcG9uZW50cyggZW5jb2RpbmcgKTsKCQlyZXR1cm4gJ3ZlYzQgJyArIGZ1bmN0aW9uTmFtZSArICcoIHZlYzQgdmFsdWUgKSB7IHJldHVybiBMaW5lYXJUbycgKyBjb21wb25lbnRzWyAwIF0gKyBjb21wb25lbnRzWyAxIF0gKyAnOyB9JzsKCgl9CgoJZnVuY3Rpb24gZ2V0VG9uZU1hcHBpbmdGdW5jdGlvbiggZnVuY3Rpb25OYW1lLCB0b25lTWFwcGluZyApIHsKCgkJdmFyIHRvbmVNYXBwaW5nTmFtZTsKCgkJc3dpdGNoICggdG9uZU1hcHBpbmcgKSB7CgoJCQljYXNlIExpbmVhclRvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0xpbmVhcic7CgkJCQlicmVhazsKCgkJCWNhc2UgUmVpbmhhcmRUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdSZWluaGFyZCc7CgkJCQlicmVhazsKCgkJCWNhc2UgVW5jaGFydGVkMlRvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ1VuY2hhcnRlZDInOwoJCQkJYnJlYWs7CgoJCQljYXNlIENpbmVvblRvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ09wdGltaXplZENpbmVvbic7CgkJCQlicmVhazsKCgkJCWNhc2UgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0FDRVNGaWxtaWMnOwoJCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoJCQkJdGhyb3cgbmV3IEVycm9yKCAndW5zdXBwb3J0ZWQgdG9uZU1hcHBpbmc6ICcgKyB0b25lTWFwcGluZyApOwoKCQl9CgoJCXJldHVybiAndmVjMyAnICsgZnVuY3Rpb25OYW1lICsgJyggdmVjMyBjb2xvciApIHsgcmV0dXJuICcgKyB0b25lTWFwcGluZ05hbWUgKyAnVG9uZU1hcHBpbmcoIGNvbG9yICk7IH0nOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZUV4dGVuc2lvbnMoIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHJlbmRlcmVyRXh0ZW5zaW9ucyApIHsKCgkJZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnMgfHwge307CgoJCXZhciBjaHVua3MgPSBbCgkJCSggZXh0ZW5zaW9ucy5kZXJpdmF0aXZlcyB8fCBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVViB8fCBwYXJhbWV0ZXJzLmJ1bXBNYXAgfHwgKCBwYXJhbWV0ZXJzLm5vcm1hbE1hcCAmJiAhIHBhcmFtZXRlcnMub2JqZWN0U3BhY2VOb3JtYWxNYXAgKSB8fCBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nICkgPyAnI2V4dGVuc2lvbiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMgOiBlbmFibGUnIDogJycsCgkJCSggZXh0ZW5zaW9ucy5mcmFnRGVwdGggfHwgcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkgJiYgcmVuZGVyZXJFeHRlbnNpb25zLmdldCggJ0VYVF9mcmFnX2RlcHRoJyApID8gJyNleHRlbnNpb24gR0xfRVhUX2ZyYWdfZGVwdGggOiBlbmFibGUnIDogJycsCgkJCSggZXh0ZW5zaW9ucy5kcmF3QnVmZmVycyApICYmIHJlbmRlcmVyRXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9kcmF3X2J1ZmZlcnMnICkgPyAnI2V4dGVuc2lvbiBHTF9FWFRfZHJhd19idWZmZXJzIDogcmVxdWlyZScgOiAnJywKCQkJKCBleHRlbnNpb25zLnNoYWRlclRleHR1cmVMT0QgfHwgcGFyYW1ldGVycy5lbnZNYXAgKSAmJiByZW5kZXJlckV4dGVuc2lvbnMuZ2V0KCAnRVhUX3NoYWRlcl90ZXh0dXJlX2xvZCcgKSA/ICcjZXh0ZW5zaW9uIEdMX0VYVF9zaGFkZXJfdGV4dHVyZV9sb2QgOiBlbmFibGUnIDogJycKCQldOwoKCQlyZXR1cm4gY2h1bmtzLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZURlZmluZXMoIGRlZmluZXMgKSB7CgoJCXZhciBjaHVua3MgPSBbXTsKCgkJZm9yICggdmFyIG5hbWUgaW4gZGVmaW5lcyApIHsKCgkJCXZhciB2YWx1ZSA9IGRlZmluZXNbIG5hbWUgXTsKCgkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgY29udGludWU7CgoJCQljaHVua3MucHVzaCggJyNkZWZpbmUgJyArIG5hbWUgKyAnICcgKyB2YWx1ZSApOwoKCQl9CgoJCXJldHVybiBjaHVua3Muam9pbiggJ1xuJyApOwoKCX0KCglmdW5jdGlvbiBmZXRjaEF0dHJpYnV0ZUxvY2F0aW9ucyggZ2wsIHByb2dyYW0gKSB7CgoJCXZhciBhdHRyaWJ1dGVzID0ge307CgoJCXZhciBuID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgMzU3MjEgKTsKCgkJZm9yICggdmFyIGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCgkJCXZhciBpbmZvID0gZ2wuZ2V0QWN0aXZlQXR0cmliKCBwcm9ncmFtLCBpICk7CgkJCXZhciBuYW1lID0gaW5mby5uYW1lOwoKCQkJLy8gY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFByb2dyYW06IEFDVElWRSBWRVJURVggQVRUUklCVVRFOicsIG5hbWUsIGkgKTsKCgkJCWF0dHJpYnV0ZXNbIG5hbWUgXSA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKCBwcm9ncmFtLCBuYW1lICk7CgoJCX0KCgkJcmV0dXJuIGF0dHJpYnV0ZXM7CgoJfQoKCWZ1bmN0aW9uIGZpbHRlckVtcHR5TGluZSggc3RyaW5nICkgewoKCQlyZXR1cm4gc3RyaW5nICE9PSAnJzsKCgl9CgoJZnVuY3Rpb24gcmVwbGFjZUxpZ2h0TnVtcyggc3RyaW5nLCBwYXJhbWV0ZXJzICkgewoKCQlyZXR1cm4gc3RyaW5nCgkJCS5yZXBsYWNlKCAvTlVNX0RJUl9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9SRUNUX0FSRUFfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9QT0lOVF9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0cyApCgkJCS5yZXBsYWNlKCAvTlVNX0hFTUlfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtSGVtaUxpZ2h0cyApOwoKCX0KCglmdW5jdGlvbiByZXBsYWNlQ2xpcHBpbmdQbGFuZU51bXMoIHN0cmluZywgcGFyYW1ldGVycyApIHsKCgkJcmV0dXJuIHN0cmluZwoJCQkucmVwbGFjZSggL05VTV9DTElQUElOR19QTEFORVMvZywgcGFyYW1ldGVycy5udW1DbGlwcGluZ1BsYW5lcyApCgkJCS5yZXBsYWNlKCAvVU5JT05fQ0xJUFBJTkdfUExBTkVTL2csICggcGFyYW1ldGVycy5udW1DbGlwcGluZ1BsYW5lcyAtIHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbiApICk7CgoJfQoKCWZ1bmN0aW9uIHBhcnNlSW5jbHVkZXMoIHN0cmluZyApIHsKCgkJdmFyIHBhdHRlcm4gPSAvXlsgXHRdKiNpbmNsdWRlICs8KFtcd1xkLi9dKyk+L2dtOwoKCQlmdW5jdGlvbiByZXBsYWNlKCBtYXRjaCwgaW5jbHVkZSApIHsKCgkJCXZhciByZXBsYWNlID0gU2hhZGVyQ2h1bmtbIGluY2x1ZGUgXTsKCgkJCWlmICggcmVwbGFjZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ0NhbiBub3QgcmVzb2x2ZSAjaW5jbHVkZSA8JyArIGluY2x1ZGUgKyAnPicgKTsKCgkJCX0KCgkJCXJldHVybiBwYXJzZUluY2x1ZGVzKCByZXBsYWNlICk7CgoJCX0KCgkJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBwYXR0ZXJuLCByZXBsYWNlICk7CgoJfQoKCWZ1bmN0aW9uIHVucm9sbExvb3BzKCBzdHJpbmcgKSB7CgoJCXZhciBwYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3BbXHNdKz9mb3IgXCggaW50IGkgXD0gKFxkKylcOyBpIDwgKFxkKylcOyBpIFwrXCsgXCkgXHsoW1xzXFNdKz8pKD89XH0pXH0vZzsKCgkJZnVuY3Rpb24gcmVwbGFjZSggbWF0Y2gsIHN0YXJ0LCBlbmQsIHNuaXBwZXQgKSB7CgoJCQl2YXIgdW5yb2xsID0gJyc7CgoJCQlmb3IgKCB2YXIgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKCQkJCXVucm9sbCArPSBzbmlwcGV0LnJlcGxhY2UoIC9cWyBpIFxdL2csICdbICcgKyBpICsgJyBdJyApOwoKCQkJfQoKCQkJcmV0dXJuIHVucm9sbDsKCgkJfQoKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHBhdHRlcm4sIHJlcGxhY2UgKTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xQcm9ncmFtKCByZW5kZXJlciwgZXh0ZW5zaW9ucywgY29kZSwgbWF0ZXJpYWwsIHNoYWRlciwgcGFyYW1ldGVycywgY2FwYWJpbGl0aWVzICkgewoKCQl2YXIgZ2wgPSByZW5kZXJlci5jb250ZXh0OwoKCQl2YXIgZGVmaW5lcyA9IG1hdGVyaWFsLmRlZmluZXM7CgoJCXZhciB2ZXJ0ZXhTaGFkZXIgPSBzaGFkZXIudmVydGV4U2hhZGVyOwoJCXZhciBmcmFnbWVudFNoYWRlciA9IHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCgkJdmFyIHNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfQkFTSUMnOwoKCQlpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU2hhZG93TWFwICkgewoKCQkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0YnOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFBDRlNvZnRTaGFkb3dNYXAgKSB7CgoJCQlzaGFkb3dNYXBUeXBlRGVmaW5lID0gJ1NIQURPV01BUF9UWVBFX1BDRl9TT0ZUJzsKCgkJfQoKCQl2YXIgZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCQl2YXIgZW52TWFwTW9kZURlZmluZSA9ICdFTlZNQVBfTU9ERV9SRUZMRUNUSU9OJzsKCQl2YXIgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZJzsKCgkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJCXN3aXRjaCAoIG1hdGVyaWFsLmVudk1hcC5tYXBwaW5nICkgewoKCQkJCWNhc2UgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOgoJCQkJY2FzZSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc6CgkJCQkJZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCQkJCQlicmVhazsKCgkJCQljYXNlIEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOgoJCQkJY2FzZSBDdWJlVVZSZWZyYWN0aW9uTWFwcGluZzoKCQkJCQllbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX0NVQkVfVVYnOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmc6CgkJCQljYXNlIEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nOgoJCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfRVFVSVJFQyc7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBTcGhlcmljYWxSZWZsZWN0aW9uTWFwcGluZzoKCQkJCQllbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX1NQSEVSRSc7CgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlzd2l0Y2ggKCBtYXRlcmlhbC5lbnZNYXAubWFwcGluZyApIHsKCgkJCQljYXNlIEN1YmVSZWZyYWN0aW9uTWFwcGluZzoKCQkJCWNhc2UgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmc6CgkJCQkJZW52TWFwTW9kZURlZmluZSA9ICdFTlZNQVBfTU9ERV9SRUZSQUNUSU9OJzsKCQkJCQlicmVhazsKCgkJCX0KCgkJCXN3aXRjaCAoIG1hdGVyaWFsLmNvbWJpbmUgKSB7CgoJCQkJY2FzZSBNdWx0aXBseU9wZXJhdGlvbjoKCQkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTVVMVElQTFknOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgTWl4T3BlcmF0aW9uOgoJCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19NSVgnOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgQWRkT3BlcmF0aW9uOgoJCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19BREQnOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXZhciBnYW1tYUZhY3RvckRlZmluZSA9ICggcmVuZGVyZXIuZ2FtbWFGYWN0b3IgPiAwICkgPyByZW5kZXJlci5nYW1tYUZhY3RvciA6IDEuMDsKCgkJLy8gY29uc29sZS5sb2coICdidWlsZGluZyBuZXcgcHJvZ3JhbSAnICk7CgoJCS8vCgoJCXZhciBjdXN0b21FeHRlbnNpb25zID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gJycgOiBnZW5lcmF0ZUV4dGVuc2lvbnMoIG1hdGVyaWFsLmV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIGV4dGVuc2lvbnMgKTsKCgkJdmFyIGN1c3RvbURlZmluZXMgPSBnZW5lcmF0ZURlZmluZXMoIGRlZmluZXMgKTsKCgkJLy8KCgkJdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CgoJCXZhciBwcmVmaXhWZXJ0ZXgsIHByZWZpeEZyYWdtZW50OwoKCQlpZiAoIG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQlwcmVmaXhWZXJ0ZXggPSBbCgoJCQkJY3VzdG9tRGVmaW5lcwoKCQkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJCWlmICggcHJlZml4VmVydGV4Lmxlbmd0aCA+IDAgKSB7CgoJCQkJcHJlZml4VmVydGV4ICs9ICdcbic7CgoJCQl9CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCQljdXN0b21FeHRlbnNpb25zLAoJCQkJY3VzdG9tRGVmaW5lcwoKCQkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJCWlmICggcHJlZml4RnJhZ21lbnQubGVuZ3RoID4gMCApIHsKCgkJCQlwcmVmaXhGcmFnbWVudCArPSAnXG4nOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJcHJlZml4VmVydGV4ID0gWwoKCQkJCSdwcmVjaXNpb24gJyArIHBhcmFtZXRlcnMucHJlY2lzaW9uICsgJyBmbG9hdDsnLAoJCQkJJ3ByZWNpc2lvbiAnICsgcGFyYW1ldGVycy5wcmVjaXNpb24gKyAnIGludDsnLAoKCQkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBzaGFkZXIubmFtZSwKCgkJCQljdXN0b21EZWZpbmVzLAoKCQkJCXBhcmFtZXRlcnMuc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlcyA/ICcjZGVmaW5lIFZFUlRFWF9URVhUVVJFUycgOiAnJywKCgkJCQknI2RlZmluZSBHQU1NQV9GQUNUT1IgJyArIGdhbW1hRmFjdG9yRGVmaW5lLAoKCQkJCScjZGVmaW5lIE1BWF9CT05FUyAnICsgcGFyYW1ldGVycy5tYXhCb25lcywKCQkJCSggcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgKSA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCgkJCQkoIHBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nRXhwICkgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm1hcCA/ICcjZGVmaW5lIFVTRV9NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lIFVTRV9FTlZNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKCQkJCSggcGFyYW1ldGVycy5ub3JtYWxNYXAgJiYgcGFyYW1ldGVycy5vYmplY3RTcGFjZU5vcm1hbE1hcCApID8gJyNkZWZpbmUgT0JKRUNUU1BBQ0VfTk9STUFMTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgJiYgcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzID8gJyNkZWZpbmUgVVNFX0RJU1BMQUNFTUVOVE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmFscGhhTWFwID8gJyNkZWZpbmUgVVNFX0FMUEhBTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNraW5uaW5nID8gJyNkZWZpbmUgVVNFX1NLSU5OSU5HJyA6ICcnLAoJCQkJcGFyYW1ldGVycy51c2VWZXJ0ZXhUZXh0dXJlID8gJyNkZWZpbmUgQk9ORV9URVhUVVJFJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID8gJyNkZWZpbmUgVVNFX01PUlBIVEFSR0VUUycgOiAnJywKCQkJCXBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX01PUlBITk9STUFMUycgOiAnJywKCQkJCXBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAnI2RlZmluZSBET1VCTEVfU0lERUQnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmZsaXBTaWRlZCA/ICcjZGVmaW5lIEZMSVBfU0lERUQnIDogJycsCgoJCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgVVNFX1NIQURPV01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lICcgKyBzaGFkb3dNYXBUeXBlRGVmaW5lIDogJycsCgoJCQkJcGFyYW1ldGVycy5zaXplQXR0ZW51YXRpb24gPyAnI2RlZmluZSBVU0VfU0laRUFUVEVOVUFUSU9OJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9MT0dERVBUSEJVRicgOiAnJywKCQkJCXBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciAmJiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiB8fCBleHRlbnNpb25zLmdldCggJ0VYVF9mcmFnX2RlcHRoJyApICkgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUZfRVhUJyA6ICcnLAoKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgdmlld01hdHJpeDsnLAoJCQkJJ3VuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKCgkJCQknYXR0cmlidXRlIHZlYzMgcG9zaXRpb247JywKCQkJCSdhdHRyaWJ1dGUgdmVjMyBub3JtYWw7JywKCQkJCSdhdHRyaWJ1dGUgdmVjMiB1djsnLAoKCQkJCScjaWZkZWYgVVNFX1RBTkdFTlQnLAoKCQkJCScJYXR0cmlidXRlIHZlYzQgdGFuZ2VudDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCScjaWZkZWYgVVNFX0NPTE9SJywKCgkJCQknCWF0dHJpYnV0ZSB2ZWMzIGNvbG9yOycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTJywKCgkJCQknCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0MDsnLAoJCQkJJwlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDE7JywKCQkJCScJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQyOycsCgkJCQknCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0MzsnLAoKCQkJCScJI2lmZGVmIFVTRV9NT1JQSE5PUk1BTFMnLAoKCQkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMDsnLAoJCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhOb3JtYWwxOycsCgkJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaE5vcm1hbDI7JywKCQkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMzsnLAoKCQkJCScJI2Vsc2UnLAoKCQkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NDsnLAoJCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQ1OycsCgkJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDY7JywKCQkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NzsnLAoKCQkJCScJI2VuZGlmJywKCgkJCQknI2VuZGlmJywKCgkJCQknI2lmZGVmIFVTRV9TS0lOTklORycsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7JywKCQkJCScJYXR0cmlidXRlIHZlYzQgc2tpbldlaWdodDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCSdcbicKCgkJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCQljdXN0b21FeHRlbnNpb25zLAoKCQkJCSdwcmVjaXNpb24gJyArIHBhcmFtZXRlcnMucHJlY2lzaW9uICsgJyBmbG9hdDsnLAoJCQkJJ3ByZWNpc2lvbiAnICsgcGFyYW1ldGVycy5wcmVjaXNpb24gKyAnIGludDsnLAoKCQkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBzaGFkZXIubmFtZSwKCgkJCQljdXN0b21EZWZpbmVzLAoKCQkJCXBhcmFtZXRlcnMuYWxwaGFUZXN0ID8gJyNkZWZpbmUgQUxQSEFURVNUICcgKyBwYXJhbWV0ZXJzLmFscGhhVGVzdCArICggcGFyYW1ldGVycy5hbHBoYVRlc3QgJSAxID8gJycgOiAnLjAnICkgOiAnJywgLy8gYWRkICcuMCcgaWYgaW50ZWdlcgoKCQkJCScjZGVmaW5lIEdBTU1BX0ZBQ1RPUiAnICsgZ2FtbWFGYWN0b3JEZWZpbmUsCgoJCQkJKCBwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyApID8gJyNkZWZpbmUgVVNFX0ZPRycgOiAnJywKCQkJCSggcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAgKSA/ICcjZGVmaW5lIEZPR19FWFAyJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubWF0Y2FwID8gJyNkZWZpbmUgVVNFX01BVENBUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcFR5cGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcE1vZGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKCQkJCSggcGFyYW1ldGVycy5ub3JtYWxNYXAgJiYgcGFyYW1ldGVycy5vYmplY3RTcGFjZU5vcm1hbE1hcCApID8gJyNkZWZpbmUgT0JKRUNUU1BBQ0VfTk9STUFMTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zcGVjdWxhck1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUk1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMucm91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX1JPVUdITkVTU01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubWV0YWxuZXNzTWFwID8gJyNkZWZpbmUgVVNFX01FVEFMTkVTU01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFNYXAgPyAnI2RlZmluZSBVU0VfQUxQSEFNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyA/ICcjZGVmaW5lIFVTRV9UQU5HRU5UJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgPyAnI2RlZmluZSBVU0VfQ09MT1InIDogJycsCgoJCQkJcGFyYW1ldGVycy5ncmFkaWVudE1hcCA/ICcjZGVmaW5lIFVTRV9HUkFESUVOVE1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID8gJyNkZWZpbmUgRkxBVF9TSEFERUQnIDogJycsCgoJCQkJcGFyYW1ldGVycy5kb3VibGVTaWRlZCA/ICcjZGVmaW5lIERPVUJMRV9TSURFRCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZmxpcFNpZGVkID8gJyNkZWZpbmUgRkxJUF9TSURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSBVU0VfU0hBRE9XTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgJyArIHNoYWRvd01hcFR5cGVEZWZpbmUgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSA/ICcjZGVmaW5lIFBSRU1VTFRJUExJRURfQUxQSEEnIDogJycsCgoJCQkJcGFyYW1ldGVycy5waHlzaWNhbGx5Q29ycmVjdExpZ2h0cyA/ICcjZGVmaW5lIFBIWVNJQ0FMTFlfQ09SUkVDVF9MSUdIVFMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICYmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX2ZyYWdfZGVwdGgnICkgKSA/ICcjZGVmaW5lIFVTRV9MT0dERVBUSEJVRl9FWFQnIDogJycsCgoJCQkJcGFyYW1ldGVycy5lbnZNYXAgJiYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgfHwgZXh0ZW5zaW9ucy5nZXQoICdFWFRfc2hhZGVyX3RleHR1cmVfbG9kJyApICkgPyAnI2RlZmluZSBURVhUVVJFX0xPRF9FWFQnIDogJycsCgoJCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSB2ZWMzIGNhbWVyYVBvc2l0aW9uOycsCgoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyAnI2RlZmluZSBUT05FX01BUFBJTkcnIDogJycsCgkJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/IFNoYWRlckNodW5rWyAndG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCcgXSA6ICcnLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHRvbmVNYXBwaW5nKCkgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCAndG9uZU1hcHBpbmcnLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICkgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRpdGhlcmluZyA/ICcjZGVmaW5lIERJVEhFUklORycgOiAnJywKCgkJCQkoIHBhcmFtZXRlcnMub3V0cHV0RW5jb2RpbmcgfHwgcGFyYW1ldGVycy5tYXBFbmNvZGluZyB8fCBwYXJhbWV0ZXJzLm1hdGNhcEVuY29kaW5nIHx8IHBhcmFtZXRlcnMuZW52TWFwRW5jb2RpbmcgfHwgcGFyYW1ldGVycy5lbWlzc2l2ZU1hcEVuY29kaW5nICkgPwoJCQkJCVNoYWRlckNodW5rWyAnZW5jb2RpbmdzX3BhcnNfZnJhZ21lbnQnIF0gOiAnJywgLy8gdGhpcyBjb2RlIGlzIHJlcXVpcmVkIGhlcmUgYmVjYXVzZSBpdCBpcyB1c2VkIGJ5IHRoZSB2YXJpb3VzIGVuY29kaW5nL2RlY29kaW5nIGZ1bmN0aW9uIGRlZmluZWQgYmVsb3cKCQkJCXBhcmFtZXRlcnMubWFwRW5jb2RpbmcgPyBnZXRUZXhlbERlY29kaW5nRnVuY3Rpb24oICdtYXBUZXhlbFRvTGluZWFyJywgcGFyYW1ldGVycy5tYXBFbmNvZGluZyApIDogJycsCgkJCQlwYXJhbWV0ZXJzLm1hdGNhcEVuY29kaW5nID8gZ2V0VGV4ZWxEZWNvZGluZ0Z1bmN0aW9uKCAnbWF0Y2FwVGV4ZWxUb0xpbmVhcicsIHBhcmFtZXRlcnMubWF0Y2FwRW5jb2RpbmcgKSA6ICcnLAoJCQkJcGFyYW1ldGVycy5lbnZNYXBFbmNvZGluZyA/IGdldFRleGVsRGVjb2RpbmdGdW5jdGlvbiggJ2Vudk1hcFRleGVsVG9MaW5lYXInLCBwYXJhbWV0ZXJzLmVudk1hcEVuY29kaW5nICkgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXBFbmNvZGluZyA/IGdldFRleGVsRGVjb2RpbmdGdW5jdGlvbiggJ2VtaXNzaXZlTWFwVGV4ZWxUb0xpbmVhcicsIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBFbmNvZGluZyApIDogJycsCgkJCQlwYXJhbWV0ZXJzLm91dHB1dEVuY29kaW5nID8gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCAnbGluZWFyVG9PdXRwdXRUZXhlbCcsIHBhcmFtZXRlcnMub3V0cHV0RW5jb2RpbmcgKSA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZGVwdGhQYWNraW5nID8gJyNkZWZpbmUgREVQVEhfUEFDS0lORyAnICsgbWF0ZXJpYWwuZGVwdGhQYWNraW5nIDogJycsCgoJCQkJJ1xuJwoKCQkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJfQoKCQl2ZXJ0ZXhTaGFkZXIgPSBwYXJzZUluY2x1ZGVzKCB2ZXJ0ZXhTaGFkZXIgKTsKCQl2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKCB2ZXJ0ZXhTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCQl2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlQ2xpcHBpbmdQbGFuZU51bXMoIHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyApOwoKCQlmcmFnbWVudFNoYWRlciA9IHBhcnNlSW5jbHVkZXMoIGZyYWdtZW50U2hhZGVyICk7CgkJZnJhZ21lbnRTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKCBmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyApOwoJCWZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCBmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyApOwoKCQl2ZXJ0ZXhTaGFkZXIgPSB1bnJvbGxMb29wcyggdmVydGV4U2hhZGVyICk7CgkJZnJhZ21lbnRTaGFkZXIgPSB1bnJvbGxMb29wcyggZnJhZ21lbnRTaGFkZXIgKTsKCgkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgJiYgISBtYXRlcmlhbC5pc1Jhd1NoYWRlck1hdGVyaWFsICkgewoKCQkJdmFyIGlzR0xTTDNTaGFkZXJNYXRlcmlhbCA9IGZhbHNlOwoKCQkJdmFyIHZlcnNpb25SZWdleCA9IC9eXHMqI3ZlcnNpb25ccyszMDBccytlc1xzKlxuLzsKCgkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJgoJCQkJdmVydGV4U2hhZGVyLm1hdGNoKCB2ZXJzaW9uUmVnZXggKSAhPT0gbnVsbCAmJgoJCQkJZnJhZ21lbnRTaGFkZXIubWF0Y2goIHZlcnNpb25SZWdleCApICE9PSBudWxsICkgewoKCQkJCWlzR0xTTDNTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgoJCQkJdmVydGV4U2hhZGVyID0gdmVydGV4U2hhZGVyLnJlcGxhY2UoIHZlcnNpb25SZWdleCwgJycgKTsKCQkJCWZyYWdtZW50U2hhZGVyID0gZnJhZ21lbnRTaGFkZXIucmVwbGFjZSggdmVyc2lvblJlZ2V4LCAnJyApOwoKCQkJfQoKCQkJLy8gR0xTTCAzLjAgY29udmVyc2lvbgoJCQlwcmVmaXhWZXJ0ZXggPSBbCgkJCQknI3ZlcnNpb24gMzAwIGVzXG4nLAoJCQkJJyNkZWZpbmUgYXR0cmlidXRlIGluJywKCQkJCScjZGVmaW5lIHZhcnlpbmcgb3V0JywKCQkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJwoJCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhWZXJ0ZXg7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCQkJCScjdmVyc2lvbiAzMDAgZXNcbicsCgkJCQknI2RlZmluZSB2YXJ5aW5nIGluJywKCQkJCWlzR0xTTDNTaGFkZXJNYXRlcmlhbCA/ICcnIDogJ291dCBoaWdocCB2ZWM0IHBjX2ZyYWdDb2xvcjsnLAoJCQkJaXNHTFNMM1NoYWRlck1hdGVyaWFsID8gJycgOiAnI2RlZmluZSBnbF9GcmFnQ29sb3IgcGNfZnJhZ0NvbG9yJywKCQkJCScjZGVmaW5lIGdsX0ZyYWdEZXB0aEVYVCBnbF9GcmFnRGVwdGgnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJEIHRleHR1cmUnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZUN1YmUgdGV4dHVyZScsCgkJCQknI2RlZmluZSB0ZXh0dXJlMkRQcm9qIHRleHR1cmVQcm9qJywKCQkJCScjZGVmaW5lIHRleHR1cmUyRExvZEVYVCB0ZXh0dXJlTG9kJywKCQkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pMb2RFWFQgdGV4dHVyZVByb2pMb2QnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZUN1YmVMb2RFWFQgdGV4dHVyZUxvZCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlMkRHcmFkRVhUIHRleHR1cmVHcmFkJywKCQkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pHcmFkRVhUIHRleHR1cmVQcm9qR3JhZCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUdyYWRFWFQgdGV4dHVyZUdyYWQnCgkJCV0uam9pbiggJ1xuJyApICsgJ1xuJyArIHByZWZpeEZyYWdtZW50OwoKCQl9CgoJCXZhciB2ZXJ0ZXhHbHNsID0gcHJlZml4VmVydGV4ICsgdmVydGV4U2hhZGVyOwoJCXZhciBmcmFnbWVudEdsc2wgPSBwcmVmaXhGcmFnbWVudCArIGZyYWdtZW50U2hhZGVyOwoKCQkvLyBjb25zb2xlLmxvZyggJypWRVJURVgqJywgdmVydGV4R2xzbCApOwoJCS8vIGNvbnNvbGUubG9nKCAnKkZSQUdNRU5UKicsIGZyYWdtZW50R2xzbCApOwoKCQl2YXIgZ2xWZXJ0ZXhTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIDM1NjMzLCB2ZXJ0ZXhHbHNsICk7CgkJdmFyIGdsRnJhZ21lbnRTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIDM1NjMyLCBmcmFnbWVudEdsc2wgKTsKCgkJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCWdsLmF0dGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKCQkvLyBGb3JjZSBhIHBhcnRpY3VsYXIgYXR0cmlidXRlIHRvIGluZGV4IDAuCgoJCWlmICggbWF0ZXJpYWwuaW5kZXgwQXR0cmlidXRlTmFtZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJZ2wuYmluZEF0dHJpYkxvY2F0aW9uKCBwcm9ncmFtLCAwLCBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lICk7CgoJCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID09PSB0cnVlICkgewoKCQkJLy8gcHJvZ3JhbXMgd2l0aCBtb3JwaFRhcmdldHMgZGlzcGxhY2UgcG9zaXRpb24gb3V0IG9mIGF0dHJpYnV0ZSAwCgkJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgJ3Bvc2l0aW9uJyApOwoKCQl9CgoJCWdsLmxpbmtQcm9ncmFtKCBwcm9ncmFtICk7CgoJCXZhciBwcm9ncmFtTG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coIHByb2dyYW0gKS50cmltKCk7CgkJdmFyIHZlcnRleExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsVmVydGV4U2hhZGVyICkudHJpbSgpOwoJCXZhciBmcmFnbWVudExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsRnJhZ21lbnRTaGFkZXIgKS50cmltKCk7CgoJCXZhciBydW5uYWJsZSA9IHRydWU7CgkJdmFyIGhhdmVEaWFnbm9zdGljcyA9IHRydWU7CgoJCS8vIGNvbnNvbGUubG9nKCAnKipWRVJURVgqKicsIGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlYnVnX3NoYWRlcnMnICkuZ2V0VHJhbnNsYXRlZFNoYWRlclNvdXJjZSggZ2xWZXJ0ZXhTaGFkZXIgKSApOwoJCS8vIGNvbnNvbGUubG9nKCAnKipGUkFHTUVOVCoqJywgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfZGVidWdfc2hhZGVycycgKS5nZXRUcmFuc2xhdGVkU2hhZGVyU291cmNlKCBnbEZyYWdtZW50U2hhZGVyICkgKTsKCgkJaWYgKCBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCAzNTcxNCApID09PSBmYWxzZSApIHsKCgkJCXJ1bm5hYmxlID0gZmFsc2U7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBzaGFkZXIgZXJyb3I6ICcsIGdsLmdldEVycm9yKCksICczNTcxNScsIGdsLmdldFByb2dyYW1QYXJhbWV0ZXIoIHByb2dyYW0sIDM1NzE1ICksICdnbC5nZXRQcm9ncmFtSW5mb0xvZycsIHByb2dyYW1Mb2csIHZlcnRleExvZywgZnJhZ21lbnRMb2cgKTsKCgkJfSBlbHNlIGlmICggcHJvZ3JhbUxvZyAhPT0gJycgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IGdsLmdldFByb2dyYW1JbmZvTG9nKCknLCBwcm9ncmFtTG9nICk7CgoJCX0gZWxzZSBpZiAoIHZlcnRleExvZyA9PT0gJycgfHwgZnJhZ21lbnRMb2cgPT09ICcnICkgewoKCQkJaGF2ZURpYWdub3N0aWNzID0gZmFsc2U7CgoJCX0KCgkJaWYgKCBoYXZlRGlhZ25vc3RpY3MgKSB7CgoJCQl0aGlzLmRpYWdub3N0aWNzID0gewoKCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCQkJCW1hdGVyaWFsOiBtYXRlcmlhbCwKCgkJCQlwcm9ncmFtTG9nOiBwcm9ncmFtTG9nLAoKCQkJCXZlcnRleFNoYWRlcjogewoKCQkJCQlsb2c6IHZlcnRleExvZywKCQkJCQlwcmVmaXg6IHByZWZpeFZlcnRleAoKCQkJCX0sCgoJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCgkJCQkJbG9nOiBmcmFnbWVudExvZywKCQkJCQlwcmVmaXg6IHByZWZpeEZyYWdtZW50CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQkvLyBjbGVhbiB1cAoKCQlnbC5kZWxldGVTaGFkZXIoIGdsVmVydGV4U2hhZGVyICk7CgkJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgoJCS8vIHNldCB1cCBjYWNoaW5nIGZvciB1bmlmb3JtIGxvY2F0aW9ucwoKCQl2YXIgY2FjaGVkVW5pZm9ybXM7CgoJCXRoaXMuZ2V0VW5pZm9ybXMgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIGNhY2hlZFVuaWZvcm1zID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY2FjaGVkVW5pZm9ybXMgPSBuZXcgV2ViR0xVbmlmb3JtcyggZ2wsIHByb2dyYW0sIHJlbmRlcmVyICk7CgoJCQl9CgoJCQlyZXR1cm4gY2FjaGVkVW5pZm9ybXM7CgoJCX07CgoJCS8vIHNldCB1cCBjYWNoaW5nIGZvciBhdHRyaWJ1dGUgbG9jYXRpb25zCgoJCXZhciBjYWNoZWRBdHRyaWJ1dGVzOwoKCQl0aGlzLmdldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIGNhY2hlZEF0dHJpYnV0ZXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljYWNoZWRBdHRyaWJ1dGVzID0gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoIGdsLCBwcm9ncmFtICk7CgoJCQl9CgoJCQlyZXR1cm4gY2FjaGVkQXR0cmlidXRlczsKCgkJfTsKCgkJLy8gZnJlZSByZXNvdXJjZQoKCQl0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CgoJCQlnbC5kZWxldGVQcm9ncmFtKCBwcm9ncmFtICk7CgkJCXRoaXMucHJvZ3JhbSA9IHVuZGVmaW5lZDsKCgkJfTsKCgkJLy8gREVQUkVDQVRFRAoKCQlPYmplY3QuZGVmaW5lUHJvcGVydGllcyggdGhpcywgewoKCQkJdW5pZm9ybXM6IHsKCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IC51bmlmb3JtcyBpcyBub3cgLmdldFVuaWZvcm1zKCkuJyApOwoJCQkJCXJldHVybiB0aGlzLmdldFVuaWZvcm1zKCk7CgoJCQkJfQoJCQl9LAoKCQkJYXR0cmlidXRlczogewoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogLmF0dHJpYnV0ZXMgaXMgbm93IC5nZXRBdHRyaWJ1dGVzKCkuJyApOwoJCQkJCXJldHVybiB0aGlzLmdldEF0dHJpYnV0ZXMoKTsKCgkJCQl9CgkJCX0KCgkJfSApOwoKCgkJLy8KCgkJdGhpcy5uYW1lID0gc2hhZGVyLm5hbWU7CgkJdGhpcy5pZCA9IHByb2dyYW1JZENvdW50ICsrOwoJCXRoaXMuY29kZSA9IGNvZGU7CgkJdGhpcy51c2VkVGltZXMgPSAxOwoJCXRoaXMucHJvZ3JhbSA9IHByb2dyYW07CgkJdGhpcy52ZXJ0ZXhTaGFkZXIgPSBnbFZlcnRleFNoYWRlcjsKCQl0aGlzLmZyYWdtZW50U2hhZGVyID0gZ2xGcmFnbWVudFNoYWRlcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFdlYkdMUHJvZ3JhbXMoIHJlbmRlcmVyLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKSB7CgoJCXZhciBwcm9ncmFtcyA9IFtdOwoKCQl2YXIgc2hhZGVySURzID0gewoJCQlNZXNoRGVwdGhNYXRlcmlhbDogJ2RlcHRoJywKCQkJTWVzaERpc3RhbmNlTWF0ZXJpYWw6ICdkaXN0YW5jZVJHQkEnLAoJCQlNZXNoTm9ybWFsTWF0ZXJpYWw6ICdub3JtYWwnLAoJCQlNZXNoQmFzaWNNYXRlcmlhbDogJ2Jhc2ljJywKCQkJTWVzaExhbWJlcnRNYXRlcmlhbDogJ2xhbWJlcnQnLAoJCQlNZXNoUGhvbmdNYXRlcmlhbDogJ3Bob25nJywKCQkJTWVzaFRvb25NYXRlcmlhbDogJ3Bob25nJywKCQkJTWVzaFN0YW5kYXJkTWF0ZXJpYWw6ICdwaHlzaWNhbCcsCgkJCU1lc2hQaHlzaWNhbE1hdGVyaWFsOiAncGh5c2ljYWwnLAoJCQlNZXNoTWF0Y2FwTWF0ZXJpYWw6ICdtYXRjYXAnLAoJCQlMaW5lQmFzaWNNYXRlcmlhbDogJ2Jhc2ljJywKCQkJTGluZURhc2hlZE1hdGVyaWFsOiAnZGFzaGVkJywKCQkJUG9pbnRzTWF0ZXJpYWw6ICdwb2ludHMnLAoJCQlTaGFkb3dNYXRlcmlhbDogJ3NoYWRvdycsCgkJCVNwcml0ZU1hdGVyaWFsOiAnc3ByaXRlJwoJCX07CgoJCXZhciBwYXJhbWV0ZXJOYW1lcyA9IFsKCQkJInByZWNpc2lvbiIsICJzdXBwb3J0c1ZlcnRleFRleHR1cmVzIiwgIm1hcCIsICJtYXBFbmNvZGluZyIsICJtYXRjYXAiLCAibWF0Y2FwRW5jb2RpbmciLCAiZW52TWFwIiwgImVudk1hcE1vZGUiLCAiZW52TWFwRW5jb2RpbmciLAoJCQkibGlnaHRNYXAiLCAiYW9NYXAiLCAiZW1pc3NpdmVNYXAiLCAiZW1pc3NpdmVNYXBFbmNvZGluZyIsICJidW1wTWFwIiwgIm5vcm1hbE1hcCIsICJvYmplY3RTcGFjZU5vcm1hbE1hcCIsICJkaXNwbGFjZW1lbnRNYXAiLCAic3BlY3VsYXJNYXAiLAoJCQkicm91Z2huZXNzTWFwIiwgIm1ldGFsbmVzc01hcCIsICJncmFkaWVudE1hcCIsCgkJCSJhbHBoYU1hcCIsICJjb21iaW5lIiwgInZlcnRleENvbG9ycyIsICJ2ZXJ0ZXhUYW5nZW50cyIsICJmb2ciLCAidXNlRm9nIiwgImZvZ0V4cCIsCgkJCSJmbGF0U2hhZGluZyIsICJzaXplQXR0ZW51YXRpb24iLCAibG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciIsICJza2lubmluZyIsCgkJCSJtYXhCb25lcyIsICJ1c2VWZXJ0ZXhUZXh0dXJlIiwgIm1vcnBoVGFyZ2V0cyIsICJtb3JwaE5vcm1hbHMiLAoJCQkibWF4TW9ycGhUYXJnZXRzIiwgIm1heE1vcnBoTm9ybWFscyIsICJwcmVtdWx0aXBsaWVkQWxwaGEiLAoJCQkibnVtRGlyTGlnaHRzIiwgIm51bVBvaW50TGlnaHRzIiwgIm51bVNwb3RMaWdodHMiLCAibnVtSGVtaUxpZ2h0cyIsICJudW1SZWN0QXJlYUxpZ2h0cyIsCgkJCSJzaGFkb3dNYXBFbmFibGVkIiwgInNoYWRvd01hcFR5cGUiLCAidG9uZU1hcHBpbmciLCAncGh5c2ljYWxseUNvcnJlY3RMaWdodHMnLAoJCQkiYWxwaGFUZXN0IiwgImRvdWJsZVNpZGVkIiwgImZsaXBTaWRlZCIsICJudW1DbGlwcGluZ1BsYW5lcyIsICJudW1DbGlwSW50ZXJzZWN0aW9uIiwgImRlcHRoUGFja2luZyIsICJkaXRoZXJpbmciCgkJXTsKCgoJCWZ1bmN0aW9uIGFsbG9jYXRlQm9uZXMoIG9iamVjdCApIHsKCgkJCXZhciBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCQkJdmFyIGJvbmVzID0gc2tlbGV0b24uYm9uZXM7CgoJCQlpZiAoIGNhcGFiaWxpdGllcy5mbG9hdFZlcnRleFRleHR1cmVzICkgewoKCQkJCXJldHVybiAxMDI0OwoKCQkJfSBlbHNlIHsKCgkJCQkvLyBkZWZhdWx0IGZvciB3aGVuIG9iamVjdCBpcyBub3Qgc3BlY2lmaWVkCgkJCQkvLyAoIGZvciBleGFtcGxlIHdoZW4gcHJlYnVpbGRpbmcgc2hhZGVyIHRvIGJlIHVzZWQgd2l0aCBtdWx0aXBsZSBvYmplY3RzICkKCQkJCS8vCgkJCQkvLyAgLSBsZWF2ZSBzb21lIGV4dHJhIHNwYWNlIGZvciBvdGhlciB1bmlmb3JtcwoJCQkJLy8gIC0gbGltaXQgaGVyZSBpcyBBTkdMRSdzIDI1NCBtYXggdW5pZm9ybSB2ZWN0b3JzCgkJCQkvLyAgICAodXAgdG8gNTQgc2hvdWxkIGJlIHNhZmUpCgoJCQkJdmFyIG5WZXJ0ZXhVbmlmb3JtcyA9IGNhcGFiaWxpdGllcy5tYXhWZXJ0ZXhVbmlmb3JtczsKCQkJCXZhciBuVmVydGV4TWF0cmljZXMgPSBNYXRoLmZsb29yKCAoIG5WZXJ0ZXhVbmlmb3JtcyAtIDIwICkgLyA0ICk7CgoJCQkJdmFyIG1heEJvbmVzID0gTWF0aC5taW4oIG5WZXJ0ZXhNYXRyaWNlcywgYm9uZXMubGVuZ3RoICk7CgoJCQkJaWYgKCBtYXhCb25lcyA8IGJvbmVzLmxlbmd0aCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogU2tlbGV0b24gaGFzICcgKyBib25lcy5sZW5ndGggKyAnIGJvbmVzLiBUaGlzIEdQVSBzdXBwb3J0cyAnICsgbWF4Qm9uZXMgKyAnLicgKTsKCQkJCQlyZXR1cm4gMDsKCgkJCQl9CgoJCQkJcmV0dXJuIG1heEJvbmVzOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAoIG1hcCwgZ2FtbWFPdmVycmlkZUxpbmVhciApIHsKCgkJCXZhciBlbmNvZGluZzsKCgkJCWlmICggISBtYXAgKSB7CgoJCQkJZW5jb2RpbmcgPSBMaW5lYXJFbmNvZGluZzsKCgkJCX0gZWxzZSBpZiAoIG1hcC5pc1RleHR1cmUgKSB7CgoJCQkJZW5jb2RpbmcgPSBtYXAuZW5jb2Rpbmc7CgoJCQl9IGVsc2UgaWYgKCBtYXAuaXNXZWJHTFJlbmRlclRhcmdldCApIHsKCgkJCQljb25zb2xlLndhcm4oICJUSFJFRS5XZWJHTFByb2dyYW1zLmdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXA6IGRvbid0IHVzZSByZW5kZXIgdGFyZ2V0cyBhcyB0ZXh0dXJlcy4gVXNlIHRoZWlyIC50ZXh0dXJlIHByb3BlcnR5IGluc3RlYWQuIiApOwoJCQkJZW5jb2RpbmcgPSBtYXAudGV4dHVyZS5lbmNvZGluZzsKCgkJCX0KCgkJCS8vIGFkZCBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgV2ViR0xSZW5kZXJlci5nYW1tYUlucHV0L2dhbW1hT3V0cHV0IHBhcmFtZXRlciwgc2hvdWxkIHByb2JhYmx5IGJlIHJlbW92ZWQgYXQgc29tZSBwb2ludC4KCQkJaWYgKCBlbmNvZGluZyA9PT0gTGluZWFyRW5jb2RpbmcgJiYgZ2FtbWFPdmVycmlkZUxpbmVhciApIHsKCgkJCQllbmNvZGluZyA9IEdhbW1hRW5jb2Rpbmc7CgoJCQl9CgoJCQlyZXR1cm4gZW5jb2Rpbmc7CgoJCX0KCgkJdGhpcy5nZXRQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKCBtYXRlcmlhbCwgbGlnaHRzLCBzaGFkb3dzLCBmb2csIG5DbGlwUGxhbmVzLCBuQ2xpcEludGVyc2VjdGlvbiwgb2JqZWN0ICkgewoKCQkJdmFyIHNoYWRlcklEID0gc2hhZGVySURzWyBtYXRlcmlhbC50eXBlIF07CgoJCQkvLyBoZXVyaXN0aWNzIHRvIGNyZWF0ZSBzaGFkZXIgcGFyYW1ldGVycyBhY2NvcmRpbmcgdG8gbGlnaHRzIGluIHRoZSBzY2VuZQoJCQkvLyAobm90IHRvIGJsb3cgb3ZlciBtYXhMaWdodHMgYnVkZ2V0KQoKCQkJdmFyIG1heEJvbmVzID0gb2JqZWN0LmlzU2tpbm5lZE1lc2ggPyBhbGxvY2F0ZUJvbmVzKCBvYmplY3QgKSA6IDA7CgkJCXZhciBwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMucHJlY2lzaW9uOwoKCQkJaWYgKCBtYXRlcmlhbC5wcmVjaXNpb24gIT09IG51bGwgKSB7CgoJCQkJcHJlY2lzaW9uID0gY2FwYWJpbGl0aWVzLmdldE1heFByZWNpc2lvbiggbWF0ZXJpYWwucHJlY2lzaW9uICk7CgoJCQkJaWYgKCBwcmVjaXNpb24gIT09IG1hdGVyaWFsLnByZWNpc2lvbiApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtLmdldFBhcmFtZXRlcnM6JywgbWF0ZXJpYWwucHJlY2lzaW9uLCAnbm90IHN1cHBvcnRlZCwgdXNpbmcnLCBwcmVjaXNpb24sICdpbnN0ZWFkLicgKTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKCQkJdmFyIHBhcmFtZXRlcnMgPSB7CgoJCQkJc2hhZGVySUQ6IHNoYWRlcklELAoKCQkJCXByZWNpc2lvbjogcHJlY2lzaW9uLAoJCQkJc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlczogY2FwYWJpbGl0aWVzLnZlcnRleFRleHR1cmVzLAoJCQkJb3V0cHV0RW5jb2Rpbmc6IGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAoICggISBjdXJyZW50UmVuZGVyVGFyZ2V0ICkgPyBudWxsIDogY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLCByZW5kZXJlci5nYW1tYU91dHB1dCApLAoJCQkJbWFwOiAhISBtYXRlcmlhbC5tYXAsCgkJCQltYXBFbmNvZGluZzogZ2V0VGV4dHVyZUVuY29kaW5nRnJvbU1hcCggbWF0ZXJpYWwubWFwLCByZW5kZXJlci5nYW1tYUlucHV0ICksCgkJCQltYXRjYXA6ICEhIG1hdGVyaWFsLm1hdGNhcCwKCQkJCW1hdGNhcEVuY29kaW5nOiBnZXRUZXh0dXJlRW5jb2RpbmdGcm9tTWFwKCBtYXRlcmlhbC5tYXRjYXAsIHJlbmRlcmVyLmdhbW1hSW5wdXQgKSwKCQkJCWVudk1hcDogISEgbWF0ZXJpYWwuZW52TWFwLAoJCQkJZW52TWFwTW9kZTogbWF0ZXJpYWwuZW52TWFwICYmIG1hdGVyaWFsLmVudk1hcC5tYXBwaW5nLAoJCQkJZW52TWFwRW5jb2Rpbmc6IGdldFRleHR1cmVFbmNvZGluZ0Zyb21NYXAoIG1hdGVyaWFsLmVudk1hcCwgcmVuZGVyZXIuZ2FtbWFJbnB1dCApLAoJCQkJZW52TWFwQ3ViZVVWOiAoICEhIG1hdGVyaWFsLmVudk1hcCApICYmICggKCBtYXRlcmlhbC5lbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSB8fCAoIG1hdGVyaWFsLmVudk1hcC5tYXBwaW5nID09PSBDdWJlVVZSZWZyYWN0aW9uTWFwcGluZyApICksCgkJCQlsaWdodE1hcDogISEgbWF0ZXJpYWwubGlnaHRNYXAsCgkJCQlhb01hcDogISEgbWF0ZXJpYWwuYW9NYXAsCgkJCQllbWlzc2l2ZU1hcDogISEgbWF0ZXJpYWwuZW1pc3NpdmVNYXAsCgkJCQllbWlzc2l2ZU1hcEVuY29kaW5nOiBnZXRUZXh0dXJlRW5jb2RpbmdGcm9tTWFwKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCwgcmVuZGVyZXIuZ2FtbWFJbnB1dCApLAoJCQkJYnVtcE1hcDogISEgbWF0ZXJpYWwuYnVtcE1hcCwKCQkJCW5vcm1hbE1hcDogISEgbWF0ZXJpYWwubm9ybWFsTWFwLAoJCQkJb2JqZWN0U3BhY2VOb3JtYWxNYXA6IG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IE9iamVjdFNwYWNlTm9ybWFsTWFwLAoJCQkJZGlzcGxhY2VtZW50TWFwOiAhISBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAsCgkJCQlyb3VnaG5lc3NNYXA6ICEhIG1hdGVyaWFsLnJvdWdobmVzc01hcCwKCQkJCW1ldGFsbmVzc01hcDogISEgbWF0ZXJpYWwubWV0YWxuZXNzTWFwLAoJCQkJc3BlY3VsYXJNYXA6ICEhIG1hdGVyaWFsLnNwZWN1bGFyTWFwLAoJCQkJYWxwaGFNYXA6ICEhIG1hdGVyaWFsLmFscGhhTWFwLAoKCQkJCWdyYWRpZW50TWFwOiAhISBtYXRlcmlhbC5ncmFkaWVudE1hcCwKCgkJCQljb21iaW5lOiBtYXRlcmlhbC5jb21iaW5lLAoKCQkJCXZlcnRleFRhbmdlbnRzOiAoIG1hdGVyaWFsLm5vcm1hbE1hcCAmJiBtYXRlcmlhbC52ZXJ0ZXhUYW5nZW50cyApLAoJCQkJdmVydGV4Q29sb3JzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMsCgoJCQkJZm9nOiAhISBmb2csCgkJCQl1c2VGb2c6IG1hdGVyaWFsLmZvZywKCQkJCWZvZ0V4cDogKCBmb2cgJiYgZm9nLmlzRm9nRXhwMiApLAoKCQkJCWZsYXRTaGFkaW5nOiBtYXRlcmlhbC5mbGF0U2hhZGluZywKCgkJCQlzaXplQXR0ZW51YXRpb246IG1hdGVyaWFsLnNpemVBdHRlbnVhdGlvbiwKCQkJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGNhcGFiaWxpdGllcy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoKCQkJCXNraW5uaW5nOiBtYXRlcmlhbC5za2lubmluZyAmJiBtYXhCb25lcyA+IDAsCgkJCQltYXhCb25lczogbWF4Qm9uZXMsCgkJCQl1c2VWZXJ0ZXhUZXh0dXJlOiBjYXBhYmlsaXRpZXMuZmxvYXRWZXJ0ZXhUZXh0dXJlcywKCgkJCQltb3JwaFRhcmdldHM6IG1hdGVyaWFsLm1vcnBoVGFyZ2V0cywKCQkJCW1vcnBoTm9ybWFsczogbWF0ZXJpYWwubW9ycGhOb3JtYWxzLAoJCQkJbWF4TW9ycGhUYXJnZXRzOiByZW5kZXJlci5tYXhNb3JwaFRhcmdldHMsCgkJCQltYXhNb3JwaE5vcm1hbHM6IHJlbmRlcmVyLm1heE1vcnBoTm9ybWFscywKCgkJCQludW1EaXJMaWdodHM6IGxpZ2h0cy5kaXJlY3Rpb25hbC5sZW5ndGgsCgkJCQludW1Qb2ludExpZ2h0czogbGlnaHRzLnBvaW50Lmxlbmd0aCwKCQkJCW51bVNwb3RMaWdodHM6IGxpZ2h0cy5zcG90Lmxlbmd0aCwKCQkJCW51bVJlY3RBcmVhTGlnaHRzOiBsaWdodHMucmVjdEFyZWEubGVuZ3RoLAoJCQkJbnVtSGVtaUxpZ2h0czogbGlnaHRzLmhlbWkubGVuZ3RoLAoKCQkJCW51bUNsaXBwaW5nUGxhbmVzOiBuQ2xpcFBsYW5lcywKCQkJCW51bUNsaXBJbnRlcnNlY3Rpb246IG5DbGlwSW50ZXJzZWN0aW9uLAoKCQkJCWRpdGhlcmluZzogbWF0ZXJpYWwuZGl0aGVyaW5nLAoKCQkJCXNoYWRvd01hcEVuYWJsZWQ6IHJlbmRlcmVyLnNoYWRvd01hcC5lbmFibGVkICYmIG9iamVjdC5yZWNlaXZlU2hhZG93ICYmIHNoYWRvd3MubGVuZ3RoID4gMCwKCQkJCXNoYWRvd01hcFR5cGU6IHJlbmRlcmVyLnNoYWRvd01hcC50eXBlLAoKCQkJCXRvbmVNYXBwaW5nOiByZW5kZXJlci50b25lTWFwcGluZywKCQkJCXBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzOiByZW5kZXJlci5waHlzaWNhbGx5Q29ycmVjdExpZ2h0cywKCgkJCQlwcmVtdWx0aXBsaWVkQWxwaGE6IG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSwKCgkJCQlhbHBoYVRlc3Q6IG1hdGVyaWFsLmFscGhhVGVzdCwKCQkJCWRvdWJsZVNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlLAoJCQkJZmxpcFNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSwKCgkJCQlkZXB0aFBhY2tpbmc6ICggbWF0ZXJpYWwuZGVwdGhQYWNraW5nICE9PSB1bmRlZmluZWQgKSA/IG1hdGVyaWFsLmRlcHRoUGFja2luZyA6IGZhbHNlCgoJCQl9OwoKCQkJcmV0dXJuIHBhcmFtZXRlcnM7CgoJCX07CgoJCXRoaXMuZ2V0UHJvZ3JhbUNvZGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKCQkJdmFyIGFycmF5ID0gW107CgoJCQlpZiAoIHBhcmFtZXRlcnMuc2hhZGVySUQgKSB7CgoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGFkZXJJRCApOwoKCQkJfSBlbHNlIHsKCgkJCQlhcnJheS5wdXNoKCBtYXRlcmlhbC5mcmFnbWVudFNoYWRlciApOwoJCQkJYXJyYXkucHVzaCggbWF0ZXJpYWwudmVydGV4U2hhZGVyICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmRlZmluZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlmb3IgKCB2YXIgbmFtZSBpbiBtYXRlcmlhbC5kZWZpbmVzICkgewoKCQkJCQlhcnJheS5wdXNoKCBuYW1lICk7CgkJCQkJYXJyYXkucHVzaCggbWF0ZXJpYWwuZGVmaW5lc1sgbmFtZSBdICk7CgoJCQkJfQoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgcGFyYW1ldGVyTmFtZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnNbIHBhcmFtZXRlck5hbWVzWyBpIF0gXSApOwoKCQkJfQoKCQkJYXJyYXkucHVzaCggbWF0ZXJpYWwub25CZWZvcmVDb21waWxlLnRvU3RyaW5nKCkgKTsKCgkJCWFycmF5LnB1c2goIHJlbmRlcmVyLmdhbW1hT3V0cHV0ICk7CgoJCQlhcnJheS5wdXNoKCByZW5kZXJlci5nYW1tYUZhY3RvciApOwoKCQkJcmV0dXJuIGFycmF5LmpvaW4oKTsKCgkJfTsKCgkJdGhpcy5hY3F1aXJlUHJvZ3JhbSA9IGZ1bmN0aW9uICggbWF0ZXJpYWwsIHNoYWRlciwgcGFyYW1ldGVycywgY29kZSApIHsKCgkJCXZhciBwcm9ncmFtOwoKCQkJLy8gQ2hlY2sgaWYgY29kZSBoYXMgYmVlbiBhbHJlYWR5IGNvbXBpbGVkCgkJCWZvciAoIHZhciBwID0gMCwgcGwgPSBwcm9ncmFtcy5sZW5ndGg7IHAgPCBwbDsgcCArKyApIHsKCgkJCQl2YXIgcHJvZ3JhbUluZm8gPSBwcm9ncmFtc1sgcCBdOwoKCQkJCWlmICggcHJvZ3JhbUluZm8uY29kZSA9PT0gY29kZSApIHsKCgkJCQkJcHJvZ3JhbSA9IHByb2dyYW1JbmZvOwoJCQkJCSsrIHByb2dyYW0udXNlZFRpbWVzOwoKCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHByb2dyYW0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwcm9ncmFtID0gbmV3IFdlYkdMUHJvZ3JhbSggcmVuZGVyZXIsIGV4dGVuc2lvbnMsIGNvZGUsIG1hdGVyaWFsLCBzaGFkZXIsIHBhcmFtZXRlcnMsIGNhcGFiaWxpdGllcyApOwoJCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKCQkJfQoKCQkJcmV0dXJuIHByb2dyYW07CgoJCX07CgoJCXRoaXMucmVsZWFzZVByb2dyYW0gPSBmdW5jdGlvbiAoIHByb2dyYW0gKSB7CgoJCQlpZiAoIC0tIHByb2dyYW0udXNlZFRpbWVzID09PSAwICkgewoKCQkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKCQkJCXZhciBpID0gcHJvZ3JhbXMuaW5kZXhPZiggcHJvZ3JhbSApOwoJCQkJcHJvZ3JhbXNbIGkgXSA9IHByb2dyYW1zWyBwcm9ncmFtcy5sZW5ndGggLSAxIF07CgkJCQlwcm9ncmFtcy5wb3AoKTsKCgkJCQkvLyBGcmVlIFdlYkdMIHJlc291cmNlcwoJCQkJcHJvZ3JhbS5kZXN0cm95KCk7CgoJCQl9CgoJCX07CgoJCS8vIEV4cG9zZWQgZm9yIHJlc291cmNlIG1vbml0b3JpbmcgJiBlcnJvciBmZWVkYmFjayB2aWEgcmVuZGVyZXIuaW5mbzoKCQl0aGlzLnByb2dyYW1zID0gcHJvZ3JhbXM7CgoJfQoKCS8qKgoJICogQGF1dGhvciBmb3JkYWNpb3VzIC8gZm9yZGFjaW91cy5naXRodWIuaW8KCSAqLwoKCWZ1bmN0aW9uIFdlYkdMUHJvcGVydGllcygpIHsKCgkJdmFyIHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBnZXQoIG9iamVjdCApIHsKCgkJCXZhciBtYXAgPSBwcm9wZXJ0aWVzLmdldCggb2JqZWN0ICk7CgoJCQlpZiAoIG1hcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW1hcCA9IHt9OwoJCQkJcHJvcGVydGllcy5zZXQoIG9iamVjdCwgbWFwICk7CgoJCQl9CgoJCQlyZXR1cm4gbWFwOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbW92ZSggb2JqZWN0ICkgewoKCQkJcHJvcGVydGllcy5kZWxldGUoIG9iamVjdCApOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBrZXksIHZhbHVlICkgewoKCQkJcHJvcGVydGllcy5nZXQoIG9iamVjdCApWyBrZXkgXSA9IHZhbHVlOwoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYWtNYXAoKTsKCgkJfQoKCQlyZXR1cm4gewoJCQlnZXQ6IGdldCwKCQkJcmVtb3ZlOiByZW1vdmUsCgkJCXVwZGF0ZTogdXBkYXRlLAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gcGFpbnRlclNvcnRTdGFibGUoIGEsIGIgKSB7CgoJCWlmICggYS5ncm91cE9yZGVyICE9PSBiLmdyb3VwT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnJlbmRlck9yZGVyICE9PSBiLnJlbmRlck9yZGVyICkgewoKCQkJcmV0dXJuIGEucmVuZGVyT3JkZXIgLSBiLnJlbmRlck9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnByb2dyYW0gJiYgYi5wcm9ncmFtICYmIGEucHJvZ3JhbSAhPT0gYi5wcm9ncmFtICkgewoKCQkJcmV0dXJuIGEucHJvZ3JhbS5pZCAtIGIucHJvZ3JhbS5pZDsKCgkJfSBlbHNlIGlmICggYS5tYXRlcmlhbC5pZCAhPT0gYi5tYXRlcmlhbC5pZCApIHsKCgkJCXJldHVybiBhLm1hdGVyaWFsLmlkIC0gYi5tYXRlcmlhbC5pZDsKCgkJfSBlbHNlIGlmICggYS56ICE9PSBiLnogKSB7CgoJCQlyZXR1cm4gYS56IC0gYi56OwoKCQl9IGVsc2UgewoKCQkJcmV0dXJuIGEuaWQgLSBiLmlkOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJldmVyc2VQYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCgkJaWYgKCBhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlciApIHsKCgkJCXJldHVybiBhLmdyb3VwT3JkZXIgLSBiLmdyb3VwT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEueiAhPT0gYi56ICkgewoKCQkJcmV0dXJuIGIueiAtIGEuejsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBhLmlkIC0gYi5pZDsKCgkJfQoKCX0KCgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0KCkgewoKCQl2YXIgcmVuZGVySXRlbXMgPSBbXTsKCQl2YXIgcmVuZGVySXRlbXNJbmRleCA9IDA7CgoJCXZhciBvcGFxdWUgPSBbXTsKCQl2YXIgdHJhbnNwYXJlbnQgPSBbXTsKCgkJZnVuY3Rpb24gaW5pdCgpIHsKCgkJCXJlbmRlckl0ZW1zSW5kZXggPSAwOwoKCQkJb3BhcXVlLmxlbmd0aCA9IDA7CgkJCXRyYW5zcGFyZW50Lmxlbmd0aCA9IDA7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApIHsKCgkJCXZhciByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbIHJlbmRlckl0ZW1zSW5kZXggXTsKCgkJCWlmICggcmVuZGVySXRlbSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXJlbmRlckl0ZW0gPSB7CgkJCQkJaWQ6IG9iamVjdC5pZCwKCQkJCQlvYmplY3Q6IG9iamVjdCwKCQkJCQlnZW9tZXRyeTogZ2VvbWV0cnksCgkJCQkJbWF0ZXJpYWw6IG1hdGVyaWFsLAoJCQkJCXByb2dyYW06IG1hdGVyaWFsLnByb2dyYW0sCgkJCQkJZ3JvdXBPcmRlcjogZ3JvdXBPcmRlciwKCQkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAoJCQkJCXo6IHosCgkJCQkJZ3JvdXA6IGdyb3VwCgkJCQl9OwoKCQkJCXJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF0gPSByZW5kZXJJdGVtOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwoJCQkJcmVuZGVySXRlbS5vYmplY3QgPSBvYmplY3Q7CgkJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJCQlyZW5kZXJJdGVtLnByb2dyYW0gPSBtYXRlcmlhbC5wcm9ncmFtOwoJCQkJcmVuZGVySXRlbS5ncm91cE9yZGVyID0gZ3JvdXBPcmRlcjsKCQkJCXJlbmRlckl0ZW0ucmVuZGVyT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgkJCQlyZW5kZXJJdGVtLnogPSB6OwoJCQkJcmVuZGVySXRlbS5ncm91cCA9IGdyb3VwOwoKCQkJfQoKCQkJcmVuZGVySXRlbXNJbmRleCArKzsKCgkJCXJldHVybiByZW5kZXJJdGVtOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2goIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApIHsKCgkJCXZhciByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKCQkJKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSA/IHRyYW5zcGFyZW50IDogb3BhcXVlICkucHVzaCggcmVuZGVySXRlbSApOwoKCQl9CgoJCWZ1bmN0aW9uIHVuc2hpZnQoIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApIHsKCgkJCXZhciByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKCQkJKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSA/IHRyYW5zcGFyZW50IDogb3BhcXVlICkudW5zaGlmdCggcmVuZGVySXRlbSApOwoKCQl9CgoJCWZ1bmN0aW9uIHNvcnQoKSB7CgoJCQlpZiAoIG9wYXF1ZS5sZW5ndGggPiAxICkgb3BhcXVlLnNvcnQoIHBhaW50ZXJTb3J0U3RhYmxlICk7CgkJCWlmICggdHJhbnNwYXJlbnQubGVuZ3RoID4gMSApIHRyYW5zcGFyZW50LnNvcnQoIHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwoKCQl9CgoJCXJldHVybiB7CgkJCW9wYXF1ZTogb3BhcXVlLAoJCQl0cmFuc3BhcmVudDogdHJhbnNwYXJlbnQsCgoJCQlpbml0OiBpbml0LAoJCQlwdXNoOiBwdXNoLAoJCQl1bnNoaWZ0OiB1bnNoaWZ0LAoKCQkJc29ydDogc29ydAoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdHMoKSB7CgoJCXZhciBsaXN0cyA9IHt9OwoKCQlmdW5jdGlvbiBvblNjZW5lRGlzcG9zZSggZXZlbnQgKSB7CgoJCQl2YXIgc2NlbmUgPSBldmVudC50YXJnZXQ7CgoJCQlzY2VuZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uU2NlbmVEaXNwb3NlICk7CgoJCQlkZWxldGUgbGlzdHNbIHNjZW5lLmlkIF07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgY2FtZXJhICkgewoKCQkJdmFyIGNhbWVyYXMgPSBsaXN0c1sgc2NlbmUuaWQgXTsKCQkJdmFyIGxpc3Q7CgkJCWlmICggY2FtZXJhcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWxpc3QgPSBuZXcgV2ViR0xSZW5kZXJMaXN0KCk7CgkJCQlsaXN0c1sgc2NlbmUuaWQgXSA9IHt9OwoJCQkJbGlzdHNbIHNjZW5lLmlkIF1bIGNhbWVyYS5pZCBdID0gbGlzdDsKCgkJCQlzY2VuZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uU2NlbmVEaXNwb3NlICk7CgoJCQl9IGVsc2UgewoKCQkJCWxpc3QgPSBjYW1lcmFzWyBjYW1lcmEuaWQgXTsKCQkJCWlmICggbGlzdCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlsaXN0ID0gbmV3IFdlYkdMUmVuZGVyTGlzdCgpOwoJCQkJCWNhbWVyYXNbIGNhbWVyYS5pZCBdID0gbGlzdDsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbGlzdDsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJbGlzdHMgPSB7fTsKCgkJfQoKCQlyZXR1cm4gewoJCQlnZXQ6IGdldCwKCQkJZGlzcG9zZTogZGlzcG9zZQoJCX07CgoJfQoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFVuaWZvcm1zQ2FjaGUoKSB7CgoJCXZhciBsaWdodHMgPSB7fTsKCgkJcmV0dXJuIHsKCgkJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCgkJCQlpZiAoIGxpZ2h0c1sgbGlnaHQuaWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKCQkJCX0KCgkJCQl2YXIgdW5pZm9ybXM7CgoJCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCgkJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgkJCQkJCXVuaWZvcm1zID0gewoJCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAoKCQkJCQkJCXNoYWRvdzogZmFsc2UsCgkJCQkJCQlzaGFkb3dCaWFzOiAwLAoJCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnU3BvdExpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQkJY29uZUNvczogMCwKCQkJCQkJCXBlbnVtYnJhQ29zOiAwLAoJCQkJCQkJZGVjYXk6IDAsCgoJCQkJCQkJc2hhZG93OiBmYWxzZSwKCQkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCgkJCQkJCX07CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdQb2ludExpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQkJZGVjYXk6IDAsCgoJCQkJCQkJc2hhZG93OiBmYWxzZSwKCQkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAoJCQkJCQkJc2hhZG93Q2FtZXJhTmVhcjogMSwKCQkJCQkJCXNoYWRvd0NhbWVyYUZhcjogMTAwMAoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCQlncm91bmRDb2xvcjogbmV3IENvbG9yKCkKCQkJCQkJfTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ1JlY3RBcmVhTGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZldpZHRoOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQoJCQkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IHNldCBSZWN0QXJlYUxpZ2h0IHNoYWRvdyB1bmlmb3JtcwoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQkJbGlnaHRzWyBsaWdodC5pZCBdID0gdW5pZm9ybXM7CgoJCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQkJfQoKCQl9OwoKCX0KCgl2YXIgY291bnQgPSAwOwoKCWZ1bmN0aW9uIFdlYkdMTGlnaHRzKCkgewoKCQl2YXIgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKCQl2YXIgc3RhdGUgPSB7CgoJCQlpZDogY291bnQgKyssCgoJCQloYXNoOiB7CgkJCQlzdGF0ZUlEOiAtIDEsCgkJCQlkaXJlY3Rpb25hbExlbmd0aDogLSAxLAoJCQkJcG9pbnRMZW5ndGg6IC0gMSwKCQkJCXNwb3RMZW5ndGg6IC0gMSwKCQkJCXJlY3RBcmVhTGVuZ3RoOiAtIDEsCgkJCQloZW1pTGVuZ3RoOiAtIDEsCgkJCQlzaGFkb3dzTGVuZ3RoOiAtIDEKCQkJfSwKCgkJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAoJCQlkaXJlY3Rpb25hbDogW10sCgkJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiBbXSwKCQkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IFtdLAoJCQlzcG90OiBbXSwKCQkJc3BvdFNoYWRvd01hcDogW10sCgkJCXNwb3RTaGFkb3dNYXRyaXg6IFtdLAoJCQlyZWN0QXJlYTogW10sCgkJCXBvaW50OiBbXSwKCQkJcG9pbnRTaGFkb3dNYXA6IFtdLAoJCQlwb2ludFNoYWRvd01hdHJpeDogW10sCgkJCWhlbWk6IFtdCgoJCX07CgoJCXZhciB2ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgbWF0cml4NCA9IG5ldyBNYXRyaXg0KCk7CgkJdmFyIG1hdHJpeDQyID0gbmV3IE1hdHJpeDQoKTsKCgkJZnVuY3Rpb24gc2V0dXAoIGxpZ2h0cywgc2hhZG93cywgY2FtZXJhICkgewoKCQkJdmFyIHIgPSAwLCBnID0gMCwgYiA9IDA7CgoJCQl2YXIgZGlyZWN0aW9uYWxMZW5ndGggPSAwOwoJCQl2YXIgcG9pbnRMZW5ndGggPSAwOwoJCQl2YXIgc3BvdExlbmd0aCA9IDA7CgkJCXZhciByZWN0QXJlYUxlbmd0aCA9IDA7CgkJCXZhciBoZW1pTGVuZ3RoID0gMDsKCgkJCXZhciB2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBsaWdodCA9IGxpZ2h0c1sgaSBdOwoKCQkJCXZhciBjb2xvciA9IGxpZ2h0LmNvbG9yOwoJCQkJdmFyIGludGVuc2l0eSA9IGxpZ2h0LmludGVuc2l0eTsKCQkJCXZhciBkaXN0YW5jZSA9IGxpZ2h0LmRpc3RhbmNlOwoKCQkJCXZhciBzaGFkb3dNYXAgPSAoIGxpZ2h0LnNoYWRvdyAmJiBsaWdodC5zaGFkb3cubWFwICkgPyBsaWdodC5zaGFkb3cubWFwLnRleHR1cmUgOiBudWxsOwoKCQkJCWlmICggbGlnaHQuaXNBbWJpZW50TGlnaHQgKSB7CgoJCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eTsKCQkJCQlnICs9IGNvbG9yLmcgKiBpbnRlbnNpdHk7CgkJCQkJYiArPSBjb2xvci5iICogaW50ZW5zaXR5OwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCgkJCQkJdmFyIHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CgkJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKCQkJCQl1bmlmb3Jtcy5zaGFkb3cgPSBsaWdodC5jYXN0U2hhZG93OwoKCQkJCQlpZiAoIGxpZ2h0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQl2YXIgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQkJdW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQl1bmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCQl1bmlmb3Jtcy5zaGFkb3dNYXBTaXplID0gc2hhZG93Lm1hcFNpemU7CgoJCQkJCX0KCgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXhbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoJCQkJCXN0YXRlLmRpcmVjdGlvbmFsWyBkaXJlY3Rpb25hbExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJCWRpcmVjdGlvbmFsTGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKCQkJCQl2YXIgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkJdW5pZm9ybXMuY29sb3IuY29weSggY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgkJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCgkJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl2ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgkJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnN1YiggdmVjdG9yMyApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCgkJCQkJdW5pZm9ybXMuY29uZUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSApOwoJCQkJCXVuaWZvcm1zLnBlbnVtYnJhQ29zID0gTWF0aC5jb3MoIGxpZ2h0LmFuZ2xlICogKCAxIC0gbGlnaHQucGVudW1icmEgKSApOwoJCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJCXVuaWZvcm1zLnNoYWRvdyA9IGxpZ2h0LmNhc3RTaGFkb3c7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCXZhciBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgoJCQkJCQl1bmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CgkJCQkJCXVuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXVuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJfQoKCQkJCQlzdGF0ZS5zcG90U2hhZG93TWFwWyBzcG90TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgkJCQkJc3RhdGUuc3BvdFNoYWRvd01hdHJpeFsgc3BvdExlbmd0aCBdID0gbGlnaHQuc2hhZG93Lm1hdHJpeDsKCQkJCQlzdGF0ZS5zcG90WyBzcG90TGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJc3BvdExlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1JlY3RBcmVhTGlnaHQgKSB7CgoJCQkJCXZhciB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJLy8gKGEpIGludGVuc2l0eSBpcyB0aGUgdG90YWwgdmlzaWJsZSBsaWdodCBlbWl0dGVkCgkJCQkJLy91bmlmb3Jtcy5jb2xvci5jb3B5KCBjb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgLyAoIGxpZ2h0LndpZHRoICogbGlnaHQuaGVpZ2h0ICogTWF0aC5QSSApICk7CgoJCQkJCS8vIChiKSBpbnRlbnNpdHkgaXMgdGhlIGJyaWdodG5lc3Mgb2YgdGhlIGxpZ2h0CgkJCQkJdW5pZm9ybXMuY29sb3IuY29weSggY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkJLy8gZXh0cmFjdCBsb2NhbCByb3RhdGlvbiBvZiBsaWdodCB0byBkZXJpdmUgd2lkdGgvaGVpZ2h0IGhhbGYgdmVjdG9ycwoJCQkJCW1hdHJpeDQyLmlkZW50aXR5KCk7CgkJCQkJbWF0cml4NC5jb3B5KCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCW1hdHJpeDQucHJlbXVsdGlwbHkoIHZpZXdNYXRyaXggKTsKCQkJCQltYXRyaXg0Mi5leHRyYWN0Um90YXRpb24oIG1hdHJpeDQgKTsKCgkJCQkJdW5pZm9ybXMuaGFsZldpZHRoLnNldCggbGlnaHQud2lkdGggKiAwLjUsIDAuMCwgMC4wICk7CgkJCQkJdW5pZm9ybXMuaGFsZkhlaWdodC5zZXQoIDAuMCwgbGlnaHQuaGVpZ2h0ICogMC41LCAwLjAgKTsKCgkJCQkJdW5pZm9ybXMuaGFsZldpZHRoLmFwcGx5TWF0cml4NCggbWF0cml4NDIgKTsKCQkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LmFwcGx5TWF0cml4NCggbWF0cml4NDIgKTsKCgkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IFJlY3RBcmVhTGlnaHQgZGlzdGFuY2U/CgkJCQkJLy8gdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCgkJCQkJc3RhdGUucmVjdEFyZWFbIHJlY3RBcmVhTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJcmVjdEFyZWFMZW5ndGggKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNQb2ludExpZ2h0ICkgewoKCQkJCQl2YXIgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkJdW5pZm9ybXMuY29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggbGlnaHQuaW50ZW5zaXR5ICk7CgkJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCQkJCQl1bmlmb3Jtcy5kZWNheSA9IGxpZ2h0LmRlY2F5OwoKCQkJCQl1bmlmb3Jtcy5zaGFkb3cgPSBsaWdodC5jYXN0U2hhZG93OwoKCQkJCQlpZiAoIGxpZ2h0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQl2YXIgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQkJdW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQl1bmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCQl1bmlmb3Jtcy5zaGFkb3dNYXBTaXplID0gc2hhZG93Lm1hcFNpemU7CgkJCQkJCXVuaWZvcm1zLnNoYWRvd0NhbWVyYU5lYXIgPSBzaGFkb3cuY2FtZXJhLm5lYXI7CgkJCQkJCXVuaWZvcm1zLnNoYWRvd0NhbWVyYUZhciA9IHNoYWRvdy5jYW1lcmEuZmFyOwoKCQkJCQl9CgoJCQkJCXN0YXRlLnBvaW50U2hhZG93TWFwWyBwb2ludExlbmd0aCBdID0gc2hhZG93TWFwOwoJCQkJCXN0YXRlLnBvaW50U2hhZG93TWF0cml4WyBwb2ludExlbmd0aCBdID0gbGlnaHQuc2hhZG93Lm1hdHJpeDsKCQkJCQlzdGF0ZS5wb2ludFsgcG9pbnRMZW5ndGggXSA9IHVuaWZvcm1zOwoKCQkJCQlwb2ludExlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc0hlbWlzcGhlcmVMaWdodCApIHsKCgkJCQkJdmFyIHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CgoJCQkJCXVuaWZvcm1zLnNreUNvbG9yLmNvcHkoIGxpZ2h0LmNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoJCQkJCXVuaWZvcm1zLmdyb3VuZENvbG9yLmNvcHkoIGxpZ2h0Lmdyb3VuZENvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoKCQkJCQlzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJaGVtaUxlbmd0aCArKzsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5hbWJpZW50WyAwIF0gPSByOwoJCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwoJCQlzdGF0ZS5hbWJpZW50WyAyIF0gPSBiOwoKCQkJc3RhdGUuZGlyZWN0aW9uYWwubGVuZ3RoID0gZGlyZWN0aW9uYWxMZW5ndGg7CgkJCXN0YXRlLnNwb3QubGVuZ3RoID0gc3BvdExlbmd0aDsKCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCXN0YXRlLnBvaW50Lmxlbmd0aCA9IHBvaW50TGVuZ3RoOwoJCQlzdGF0ZS5oZW1pLmxlbmd0aCA9IGhlbWlMZW5ndGg7CgoJCQlzdGF0ZS5oYXNoLnN0YXRlSUQgPSBzdGF0ZS5pZDsKCQkJc3RhdGUuaGFzaC5kaXJlY3Rpb25hbExlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwoJCQlzdGF0ZS5oYXNoLnBvaW50TGVuZ3RoID0gcG9pbnRMZW5ndGg7CgkJCXN0YXRlLmhhc2guc3BvdExlbmd0aCA9IHNwb3RMZW5ndGg7CgkJCXN0YXRlLmhhc2gucmVjdEFyZWFMZW5ndGggPSByZWN0QXJlYUxlbmd0aDsKCQkJc3RhdGUuaGFzaC5oZW1pTGVuZ3RoID0gaGVtaUxlbmd0aDsKCQkJc3RhdGUuaGFzaC5zaGFkb3dzTGVuZ3RoID0gc2hhZG93cy5sZW5ndGg7CgoJCX0KCgkJcmV0dXJuIHsKCQkJc2V0dXA6IHNldHVwLAoJCQlzdGF0ZTogc3RhdGUKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCglmdW5jdGlvbiBXZWJHTFJlbmRlclN0YXRlKCkgewoKCQl2YXIgbGlnaHRzID0gbmV3IFdlYkdMTGlnaHRzKCk7CgoJCXZhciBsaWdodHNBcnJheSA9IFtdOwoJCXZhciBzaGFkb3dzQXJyYXkgPSBbXTsKCgkJZnVuY3Rpb24gaW5pdCgpIHsKCgkJCWxpZ2h0c0FycmF5Lmxlbmd0aCA9IDA7CgkJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hMaWdodCggbGlnaHQgKSB7CgoJCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hTaGFkb3coIHNoYWRvd0xpZ2h0ICkgewoKCQkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBMaWdodHMoIGNhbWVyYSApIHsKCgkJCWxpZ2h0cy5zZXR1cCggbGlnaHRzQXJyYXksIHNoYWRvd3NBcnJheSwgY2FtZXJhICk7CgoJCX0KCgkJdmFyIHN0YXRlID0gewoJCQlsaWdodHNBcnJheTogbGlnaHRzQXJyYXksCgkJCXNoYWRvd3NBcnJheTogc2hhZG93c0FycmF5LAoKCQkJbGlnaHRzOiBsaWdodHMKCQl9OwoKCQlyZXR1cm4gewoJCQlpbml0OiBpbml0LAoJCQlzdGF0ZTogc3RhdGUsCgkJCXNldHVwTGlnaHRzOiBzZXR1cExpZ2h0cywKCgkJCXB1c2hMaWdodDogcHVzaExpZ2h0LAoJCQlwdXNoU2hhZG93OiBwdXNoU2hhZG93CgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZXMoKSB7CgoJCXZhciByZW5kZXJTdGF0ZXMgPSB7fTsKCgkJZnVuY3Rpb24gb25TY2VuZURpc3Bvc2UoIGV2ZW50ICkgewoKCQkJdmFyIHNjZW5lID0gZXZlbnQudGFyZ2V0OwoKCQkJc2NlbmUucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblNjZW5lRGlzcG9zZSApOwoKCQkJZGVsZXRlIHJlbmRlclN0YXRlc1sgc2NlbmUuaWQgXTsKCgkJfQoKCQlmdW5jdGlvbiBnZXQoIHNjZW5lLCBjYW1lcmEgKSB7CgoJCQl2YXIgcmVuZGVyU3RhdGU7CgoJCQlpZiAoIHJlbmRlclN0YXRlc1sgc2NlbmUuaWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoKTsKCQkJCXJlbmRlclN0YXRlc1sgc2NlbmUuaWQgXSA9IHt9OwoJCQkJcmVuZGVyU3RhdGVzWyBzY2VuZS5pZCBdWyBjYW1lcmEuaWQgXSA9IHJlbmRlclN0YXRlOwoKCQkJCXNjZW5lLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25TY2VuZURpc3Bvc2UgKTsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCByZW5kZXJTdGF0ZXNbIHNjZW5lLmlkIF1bIGNhbWVyYS5pZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoKTsKCQkJCQlyZW5kZXJTdGF0ZXNbIHNjZW5lLmlkIF1bIGNhbWVyYS5pZCBdID0gcmVuZGVyU3RhdGU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXNbIHNjZW5lLmlkIF1bIGNhbWVyYS5pZCBdOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiByZW5kZXJTdGF0ZTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJcmVuZGVyU3RhdGVzID0ge307CgoJCX0KCgkJcmV0dXJuIHsKCQkJZ2V0OiBnZXQsCgkJCWRpc3Bvc2U6IGRpc3Bvc2UKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBiaG91c3RvbiAvIGh0dHBzOi8vY2xhcmEuaW8KCSAqIEBhdXRob3IgV2VzdExhbmdsZXkgLyBodHRwOi8vZ2l0aHViLmNvbS9XZXN0TGFuZ2xleQoJICoKCSAqIHBhcmFtZXRlcnMgPSB7CgkgKgoJICogIG9wYWNpdHk6IDxmbG9hdD4sCgkgKgoJICogIG1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYWxwaGFNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGRpc3BsYWNlbWVudE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBkaXNwbGFjZW1lbnRTY2FsZTogPGZsb2F0PiwKCSAqICBkaXNwbGFjZW1lbnRCaWFzOiA8ZmxvYXQ+LAoJICoKCSAqICB3aXJlZnJhbWU6IDxib29sZWFuPiwKCSAqICB3aXJlZnJhbWVMaW5ld2lkdGg6IDxmbG9hdD4KCSAqIH0KCSAqLwoKCWZ1bmN0aW9uIE1lc2hEZXB0aE1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQlNYXRlcmlhbC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdNZXNoRGVwdGhNYXRlcmlhbCc7CgoJCXRoaXMuZGVwdGhQYWNraW5nID0gQmFzaWNEZXB0aFBhY2tpbmc7CgoJCXRoaXMuc2tpbm5pbmcgPSBmYWxzZTsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCXRoaXMuZm9nID0gZmFsc2U7CgkJdGhpcy5saWdodHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJTWVzaERlcHRoTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglNZXNoRGVwdGhNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoRGVwdGhNYXRlcmlhbDsKCglNZXNoRGVwdGhNYXRlcmlhbC5wcm90b3R5cGUuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgoJTWVzaERlcHRoTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuZGVwdGhQYWNraW5nID0gc291cmNlLmRlcHRoUGFja2luZzsKCgkJdGhpcy5za2lubmluZyA9IHNvdXJjZS5za2lubmluZzsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICoKCSAqICByZWZlcmVuY2VQb3NpdGlvbjogPGZsb2F0PiwKCSAqICBuZWFyRGlzdGFuY2U6IDxmbG9hdD4sCgkgKiAgZmFyRGlzdGFuY2U6IDxmbG9hdD4sCgkgKgoJICogIHNraW5uaW5nOiA8Ym9vbD4sCgkgKiAgbW9ycGhUYXJnZXRzOiA8Ym9vbD4sCgkgKgoJICogIG1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYWxwaGFNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGRpc3BsYWNlbWVudE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBkaXNwbGFjZW1lbnRTY2FsZTogPGZsb2F0PiwKCSAqICBkaXNwbGFjZW1lbnRCaWFzOiA8ZmxvYXQ+CgkgKgoJICogfQoJICovCgoJZnVuY3Rpb24gTWVzaERpc3RhbmNlTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ01lc2hEaXN0YW5jZU1hdGVyaWFsJzsKCgkJdGhpcy5yZWZlcmVuY2VQb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgkJdGhpcy5uZWFyRGlzdGFuY2UgPSAxOwoJCXRoaXMuZmFyRGlzdGFuY2UgPSAxMDAwOwoKCQl0aGlzLnNraW5uaW5nID0gZmFsc2U7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBmYWxzZTsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuZm9nID0gZmFsc2U7CgkJdGhpcy5saWdodHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJTWVzaERpc3RhbmNlTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglNZXNoRGlzdGFuY2VNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoRGlzdGFuY2VNYXRlcmlhbDsKCglNZXNoRGlzdGFuY2VNYXRlcmlhbC5wcm90b3R5cGUuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCA9IHRydWU7CgoJTWVzaERpc3RhbmNlTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMucmVmZXJlbmNlUG9zaXRpb24uY29weSggc291cmNlLnJlZmVyZW5jZVBvc2l0aW9uICk7CgkJdGhpcy5uZWFyRGlzdGFuY2UgPSBzb3VyY2UubmVhckRpc3RhbmNlOwoJCXRoaXMuZmFyRGlzdGFuY2UgPSBzb3VyY2UuZmFyRGlzdGFuY2U7CgoJCXRoaXMuc2tpbm5pbmcgPSBzb3VyY2Uuc2tpbm5pbmc7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJHTFNoYWRvd01hcCggX3JlbmRlcmVyLCBfb2JqZWN0cywgbWF4VGV4dHVyZVNpemUgKSB7CgoJCXZhciBfZnJ1c3R1bSA9IG5ldyBGcnVzdHVtKCksCgkJCV9wcm9qU2NyZWVuTWF0cml4ID0gbmV3IE1hdHJpeDQoKSwKCgkJCV9zaGFkb3dNYXBTaXplID0gbmV3IFZlY3RvcjIoKSwKCQkJX21heFNoYWRvd01hcFNpemUgPSBuZXcgVmVjdG9yMiggbWF4VGV4dHVyZVNpemUsIG1heFRleHR1cmVTaXplICksCgoJCQlfbG9va1RhcmdldCA9IG5ldyBWZWN0b3IzKCksCgkJCV9saWdodFBvc2l0aW9uV29ybGQgPSBuZXcgVmVjdG9yMygpLAoKCQkJX01vcnBoaW5nRmxhZyA9IDEsCgkJCV9Ta2lubmluZ0ZsYWcgPSAyLAoKCQkJX051bWJlck9mTWF0ZXJpYWxWYXJpYW50cyA9ICggX01vcnBoaW5nRmxhZyB8IF9Ta2lubmluZ0ZsYWcgKSArIDEsCgoJCQlfZGVwdGhNYXRlcmlhbHMgPSBuZXcgQXJyYXkoIF9OdW1iZXJPZk1hdGVyaWFsVmFyaWFudHMgKSwKCQkJX2Rpc3RhbmNlTWF0ZXJpYWxzID0gbmV3IEFycmF5KCBfTnVtYmVyT2ZNYXRlcmlhbFZhcmlhbnRzICksCgoJCQlfbWF0ZXJpYWxDYWNoZSA9IHt9OwoKCQl2YXIgc2hhZG93U2lkZSA9IHsgMDogQmFja1NpZGUsIDE6IEZyb250U2lkZSwgMjogRG91YmxlU2lkZSB9OwoKCQl2YXIgY3ViZURpcmVjdGlvbnMgPSBbCgkJCW5ldyBWZWN0b3IzKCAxLCAwLCAwICksIG5ldyBWZWN0b3IzKCAtIDEsIDAsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSwKCQkJbmV3IFZlY3RvcjMoIDAsIDAsIC0gMSApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgLSAxLCAwICkKCQldOwoKCQl2YXIgY3ViZVVwcyA9IFsKCQkJbmV3IFZlY3RvcjMoIDAsIDEsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDEsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDEsIDAgKSwKCQkJbmV3IFZlY3RvcjMoIDAsIDEsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSwJbmV3IFZlY3RvcjMoIDAsIDAsIC0gMSApCgkJXTsKCgkJdmFyIGN1YmUyRFZpZXdQb3J0cyA9IFsKCQkJbmV3IFZlY3RvcjQoKSwgbmV3IFZlY3RvcjQoKSwgbmV3IFZlY3RvcjQoKSwKCQkJbmV3IFZlY3RvcjQoKSwgbmV3IFZlY3RvcjQoKSwgbmV3IFZlY3RvcjQoKQoJCV07CgoJCS8vIGluaXQKCgkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBfTnVtYmVyT2ZNYXRlcmlhbFZhcmlhbnRzOyArKyBpICkgewoKCQkJdmFyIHVzZU1vcnBoaW5nID0gKCBpICYgX01vcnBoaW5nRmxhZyApICE9PSAwOwoJCQl2YXIgdXNlU2tpbm5pbmcgPSAoIGkgJiBfU2tpbm5pbmdGbGFnICkgIT09IDA7CgoJCQl2YXIgZGVwdGhNYXRlcmlhbCA9IG5ldyBNZXNoRGVwdGhNYXRlcmlhbCggewoKCQkJCWRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZywKCgkJCQltb3JwaFRhcmdldHM6IHVzZU1vcnBoaW5nLAoJCQkJc2tpbm5pbmc6IHVzZVNraW5uaW5nCgoJCQl9ICk7CgoJCQlfZGVwdGhNYXRlcmlhbHNbIGkgXSA9IGRlcHRoTWF0ZXJpYWw7CgoJCQkvLwoKCQkJdmFyIGRpc3RhbmNlTWF0ZXJpYWwgPSBuZXcgTWVzaERpc3RhbmNlTWF0ZXJpYWwoIHsKCgkJCQltb3JwaFRhcmdldHM6IHVzZU1vcnBoaW5nLAoJCQkJc2tpbm5pbmc6IHVzZVNraW5uaW5nCgoJCQl9ICk7CgoJCQlfZGlzdGFuY2VNYXRlcmlhbHNbIGkgXSA9IGRpc3RhbmNlTWF0ZXJpYWw7CgoJCX0KCgkJLy8KCgkJdmFyIHNjb3BlID0gdGhpczsKCgkJdGhpcy5lbmFibGVkID0gZmFsc2U7CgoJCXRoaXMuYXV0b1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5uZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLnR5cGUgPSBQQ0ZTaGFkb3dNYXA7CgoJCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBsaWdodHMsIHNjZW5lLCBjYW1lcmEgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoJCQlpZiAoIHNjb3BlLmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNjb3BlLm5lZWRzVXBkYXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJCWlmICggbGlnaHRzLmxlbmd0aCA9PT0gMCApIHJldHVybjsKCgkJCXZhciBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gX3JlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKCQkJdmFyIF9zdGF0ZSA9IF9yZW5kZXJlci5zdGF0ZTsKCgkJCS8vIFNldCBHTCBzdGF0ZSBmb3IgZGVwdGggbWFwLgoJCQlfc3RhdGUuc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKTsKCQkJX3N0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDEsIDEsIDEsIDEgKTsKCQkJX3N0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0VGVzdCggdHJ1ZSApOwoJCQlfc3RhdGUuc2V0U2Npc3NvclRlc3QoIGZhbHNlICk7CgoJCQkvLyByZW5kZXIgZGVwdGggbWFwCgoJCQl2YXIgZmFjZUNvdW50OwoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgbGlnaHQgPSBsaWdodHNbIGkgXTsKCQkJCXZhciBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgkJCQl2YXIgaXNQb2ludExpZ2h0ID0gbGlnaHQgJiYgbGlnaHQuaXNQb2ludExpZ2h0OwoKCQkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMU2hhZG93TWFwOicsIGxpZ2h0LCAnaGFzIG5vIHNoYWRvdy4nICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCXZhciBzaGFkb3dDYW1lcmEgPSBzaGFkb3cuY2FtZXJhOwoKCQkJCV9zaGFkb3dNYXBTaXplLmNvcHkoIHNoYWRvdy5tYXBTaXplICk7CgkJCQlfc2hhZG93TWFwU2l6ZS5taW4oIF9tYXhTaGFkb3dNYXBTaXplICk7CgoJCQkJaWYgKCBpc1BvaW50TGlnaHQgKSB7CgoJCQkJCXZhciB2cFdpZHRoID0gX3NoYWRvd01hcFNpemUueDsKCQkJCQl2YXIgdnBIZWlnaHQgPSBfc2hhZG93TWFwU2l6ZS55OwoKCQkJCQkvLyBUaGVzZSB2aWV3cG9ydHMgbWFwIGEgY3ViZS1tYXAgb250byBhIDJEIHRleHR1cmUgd2l0aCB0aGUKCQkJCQkvLyBmb2xsb3dpbmcgb3JpZW50YXRpb246CgkJCQkJLy8KCQkJCQkvLyAgeHpYWgoJCQkJCS8vICAgeSBZCgkJCQkJLy8KCQkJCQkvLyBYIC0gUG9zaXRpdmUgeCBkaXJlY3Rpb24KCQkJCQkvLyB4IC0gTmVnYXRpdmUgeCBkaXJlY3Rpb24KCQkJCQkvLyBZIC0gUG9zaXRpdmUgeSBkaXJlY3Rpb24KCQkJCQkvLyB5IC0gTmVnYXRpdmUgeSBkaXJlY3Rpb24KCQkJCQkvLyBaIC0gUG9zaXRpdmUgeiBkaXJlY3Rpb24KCQkJCQkvLyB6IC0gTmVnYXRpdmUgeiBkaXJlY3Rpb24KCgkJCQkJLy8gcG9zaXRpdmUgWAoJCQkJCWN1YmUyRFZpZXdQb3J0c1sgMCBdLnNldCggdnBXaWR0aCAqIDIsIHZwSGVpZ2h0LCB2cFdpZHRoLCB2cEhlaWdodCApOwoJCQkJCS8vIG5lZ2F0aXZlIFgKCQkJCQljdWJlMkRWaWV3UG9ydHNbIDEgXS5zZXQoIDAsIHZwSGVpZ2h0LCB2cFdpZHRoLCB2cEhlaWdodCApOwoJCQkJCS8vIHBvc2l0aXZlIFoKCQkJCQljdWJlMkRWaWV3UG9ydHNbIDIgXS5zZXQoIHZwV2lkdGggKiAzLCB2cEhlaWdodCwgdnBXaWR0aCwgdnBIZWlnaHQgKTsKCQkJCQkvLyBuZWdhdGl2ZSBaCgkJCQkJY3ViZTJEVmlld1BvcnRzWyAzIF0uc2V0KCB2cFdpZHRoLCB2cEhlaWdodCwgdnBXaWR0aCwgdnBIZWlnaHQgKTsKCQkJCQkvLyBwb3NpdGl2ZSBZCgkJCQkJY3ViZTJEVmlld1BvcnRzWyA0IF0uc2V0KCB2cFdpZHRoICogMywgMCwgdnBXaWR0aCwgdnBIZWlnaHQgKTsKCQkJCQkvLyBuZWdhdGl2ZSBZCgkJCQkJY3ViZTJEVmlld1BvcnRzWyA1IF0uc2V0KCB2cFdpZHRoLCAwLCB2cFdpZHRoLCB2cEhlaWdodCApOwoKCQkJCQlfc2hhZG93TWFwU2l6ZS54ICo9IDQuMDsKCQkJCQlfc2hhZG93TWFwU2l6ZS55ICo9IDIuMDsKCgkJCQl9CgoJCQkJaWYgKCBzaGFkb3cubWFwID09PSBudWxsICkgewoKCQkJCQl2YXIgcGFycyA9IHsgbWluRmlsdGVyOiBOZWFyZXN0RmlsdGVyLCBtYWdGaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsIGZvcm1hdDogUkdCQUZvcm1hdCB9OwoKCQkJCQlzaGFkb3cubWFwID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55LCBwYXJzICk7CgkJCQkJc2hhZG93Lm1hcC50ZXh0dXJlLm5hbWUgPSBsaWdodC5uYW1lICsgIi5zaGFkb3dNYXAiOwoKCQkJCQlzaGFkb3dDYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQkJCX0KCgkJCQlpZiAoIHNoYWRvdy5pc1Nwb3RMaWdodFNoYWRvdyApIHsKCgkJCQkJc2hhZG93LnVwZGF0ZSggbGlnaHQgKTsKCgkJCQl9CgoJCQkJdmFyIHNoYWRvd01hcCA9IHNoYWRvdy5tYXA7CgkJCQl2YXIgc2hhZG93TWF0cml4ID0gc2hhZG93Lm1hdHJpeDsKCgkJCQlfbGlnaHRQb3NpdGlvbldvcmxkLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCXNoYWRvd0NhbWVyYS5wb3NpdGlvbi5jb3B5KCBfbGlnaHRQb3NpdGlvbldvcmxkICk7CgoJCQkJaWYgKCBpc1BvaW50TGlnaHQgKSB7CgoJCQkJCWZhY2VDb3VudCA9IDY7CgoJCQkJCS8vIGZvciBwb2ludCBsaWdodHMgd2Ugc2V0IHRoZSBzaGFkb3cgbWF0cml4IHRvIGJlIGEgdHJhbnNsYXRpb24tb25seSBtYXRyaXgKCQkJCQkvLyBlcXVhbCB0byBpbnZlcnNlIG9mIHRoZSBsaWdodCdzIHBvc2l0aW9uCgoJCQkJCXNoYWRvd01hdHJpeC5tYWtlVHJhbnNsYXRpb24oIC0gX2xpZ2h0UG9zaXRpb25Xb3JsZC54LCAtIF9saWdodFBvc2l0aW9uV29ybGQueSwgLSBfbGlnaHRQb3NpdGlvbldvcmxkLnogKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlmYWNlQ291bnQgPSAxOwoKCQkJCQlfbG9va1RhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCQkJCXNoYWRvd0NhbWVyYS5sb29rQXQoIF9sb29rVGFyZ2V0ICk7CgkJCQkJc2hhZG93Q2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQkJCS8vIGNvbXB1dGUgc2hhZG93IG1hdHJpeAoKCQkJCQlzaGFkb3dNYXRyaXguc2V0KAoJCQkJCQkwLjUsIDAuMCwgMC4wLCAwLjUsCgkJCQkJCTAuMCwgMC41LCAwLjAsIDAuNSwKCQkJCQkJMC4wLCAwLjAsIDAuNSwgMC41LAoJCQkJCQkwLjAsIDAuMCwgMC4wLCAxLjAKCQkJCQkpOwoKCQkJCQlzaGFkb3dNYXRyaXgubXVsdGlwbHkoIHNoYWRvd0NhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCQkJc2hhZG93TWF0cml4Lm11bHRpcGx5KCBzaGFkb3dDYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgoJCQkJfQoKCQkJCV9yZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvd01hcCApOwoJCQkJX3JlbmRlcmVyLmNsZWFyKCk7CgoJCQkJLy8gcmVuZGVyIHNoYWRvdyBtYXAgZm9yIGVhY2ggY3ViZSBmYWNlIChpZiBvbW5pLWRpcmVjdGlvbmFsKSBvcgoJCQkJLy8gcnVuIGEgc2luZ2xlIHBhc3MgaWYgbm90CgoJCQkJZm9yICggdmFyIGZhY2UgPSAwOyBmYWNlIDwgZmFjZUNvdW50OyBmYWNlICsrICkgewoKCQkJCQlpZiAoIGlzUG9pbnRMaWdodCApIHsKCgkJCQkJCV9sb29rVGFyZ2V0LmNvcHkoIHNoYWRvd0NhbWVyYS5wb3NpdGlvbiApOwoJCQkJCQlfbG9va1RhcmdldC5hZGQoIGN1YmVEaXJlY3Rpb25zWyBmYWNlIF0gKTsKCQkJCQkJc2hhZG93Q2FtZXJhLnVwLmNvcHkoIGN1YmVVcHNbIGZhY2UgXSApOwoJCQkJCQlzaGFkb3dDYW1lcmEubG9va0F0KCBfbG9va1RhcmdldCApOwoJCQkJCQlzaGFkb3dDYW1lcmEudXBkYXRlTWF0cml4V29ybGQoKTsKCgkJCQkJCXZhciB2cERpbWVuc2lvbnMgPSBjdWJlMkRWaWV3UG9ydHNbIGZhY2UgXTsKCQkJCQkJX3N0YXRlLnZpZXdwb3J0KCB2cERpbWVuc2lvbnMgKTsKCgkJCQkJfQoKCQkJCQkvLyB1cGRhdGUgY2FtZXJhIG1hdHJpY2VzIGFuZCBmcnVzdHVtCgoJCQkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIHNoYWRvd0NhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBzaGFkb3dDYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJCQkJX2ZydXN0dW0uc2V0RnJvbU1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQkJLy8gc2V0IG9iamVjdCBtYXRyaWNlcyAmIGZydXN0dW0gY3VsbGluZwoKCQkJCQlyZW5kZXJPYmplY3QoIHNjZW5lLCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgaXNQb2ludExpZ2h0ICk7CgoJCQkJfQoKCQkJfQoKCQkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCV9yZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJfTsKCgkJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgaXNQb2ludExpZ2h0LCBsaWdodFBvc2l0aW9uV29ybGQsIHNoYWRvd0NhbWVyYU5lYXIsIHNoYWRvd0NhbWVyYUZhciApIHsKCgkJCXZhciBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKCgkJCXZhciByZXN1bHQgPSBudWxsOwoKCQkJdmFyIG1hdGVyaWFsVmFyaWFudHMgPSBfZGVwdGhNYXRlcmlhbHM7CgkJCXZhciBjdXN0b21NYXRlcmlhbCA9IG9iamVjdC5jdXN0b21EZXB0aE1hdGVyaWFsOwoKCQkJaWYgKCBpc1BvaW50TGlnaHQgKSB7CgoJCQkJbWF0ZXJpYWxWYXJpYW50cyA9IF9kaXN0YW5jZU1hdGVyaWFsczsKCQkJCWN1c3RvbU1hdGVyaWFsID0gb2JqZWN0LmN1c3RvbURpc3RhbmNlTWF0ZXJpYWw7CgoJCQl9CgoJCQlpZiAoICEgY3VzdG9tTWF0ZXJpYWwgKSB7CgoJCQkJdmFyIHVzZU1vcnBoaW5nID0gZmFsc2U7CgoJCQkJaWYgKCBtYXRlcmlhbC5tb3JwaFRhcmdldHMgKSB7CgoJCQkJCWlmICggZ2VvbWV0cnkgJiYgZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCQkJCXVzZU1vcnBoaW5nID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzICYmIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAmJiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24ubGVuZ3RoID4gMDsKCgkJCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkgJiYgZ2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCQkJCXVzZU1vcnBoaW5nID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzICYmIGdlb21ldHJ5Lm1vcnBoVGFyZ2V0cy5sZW5ndGggPiAwOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggJiYgbWF0ZXJpYWwuc2tpbm5pbmcgPT09IGZhbHNlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFNoYWRvd01hcDogVEhSRUUuU2tpbm5lZE1lc2ggd2l0aCBtYXRlcmlhbC5za2lubmluZyBzZXQgdG8gZmFsc2U6Jywgb2JqZWN0ICk7CgoJCQkJfQoKCQkJCXZhciB1c2VTa2lubmluZyA9IG9iamVjdC5pc1NraW5uZWRNZXNoICYmIG1hdGVyaWFsLnNraW5uaW5nOwoKCQkJCXZhciB2YXJpYW50SW5kZXggPSAwOwoKCQkJCWlmICggdXNlTW9ycGhpbmcgKSB2YXJpYW50SW5kZXggfD0gX01vcnBoaW5nRmxhZzsKCQkJCWlmICggdXNlU2tpbm5pbmcgKSB2YXJpYW50SW5kZXggfD0gX1NraW5uaW5nRmxhZzsKCgkJCQlyZXN1bHQgPSBtYXRlcmlhbFZhcmlhbnRzWyB2YXJpYW50SW5kZXggXTsKCgkJCX0gZWxzZSB7CgoJCQkJcmVzdWx0ID0gY3VzdG9tTWF0ZXJpYWw7CgoJCQl9CgoJCQlpZiAoIF9yZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJgoJCQkJCW1hdGVyaWFsLmNsaXBTaGFkb3dzID09PSB0cnVlICYmCgkJCQkJbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXMubGVuZ3RoICE9PSAwICkgewoKCQkJCS8vIGluIHRoaXMgY2FzZSB3ZSBuZWVkIGEgdW5pcXVlIG1hdGVyaWFsIGluc3RhbmNlIHJlZmxlY3RpbmcgdGhlCgkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKCQkJCXZhciBrZXlBID0gcmVzdWx0LnV1aWQsIGtleUIgPSBtYXRlcmlhbC51dWlkOwoKCQkJCXZhciBtYXRlcmlhbHNGb3JWYXJpYW50ID0gX21hdGVyaWFsQ2FjaGVbIGtleUEgXTsKCgkJCQlpZiAoIG1hdGVyaWFsc0ZvclZhcmlhbnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudCA9IHt9OwoJCQkJCV9tYXRlcmlhbENhY2hlWyBrZXlBIF0gPSBtYXRlcmlhbHNGb3JWYXJpYW50OwoKCQkJCX0KCgkJCQl2YXIgY2FjaGVkTWF0ZXJpYWwgPSBtYXRlcmlhbHNGb3JWYXJpYW50WyBrZXlCIF07CgoJCQkJaWYgKCBjYWNoZWRNYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljYWNoZWRNYXRlcmlhbCA9IHJlc3VsdC5jbG9uZSgpOwoJCQkJCW1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXSA9IGNhY2hlZE1hdGVyaWFsOwoKCQkJCX0KCgkJCQlyZXN1bHQgPSBjYWNoZWRNYXRlcmlhbDsKCgkJCX0KCgkJCXJlc3VsdC52aXNpYmxlID0gbWF0ZXJpYWwudmlzaWJsZTsKCQkJcmVzdWx0LndpcmVmcmFtZSA9IG1hdGVyaWFsLndpcmVmcmFtZTsKCgkJCXJlc3VsdC5zaWRlID0gKCBtYXRlcmlhbC5zaGFkb3dTaWRlICE9IG51bGwgKSA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBzaGFkb3dTaWRlWyBtYXRlcmlhbC5zaWRlIF07CgoJCQlyZXN1bHQuY2xpcFNoYWRvd3MgPSBtYXRlcmlhbC5jbGlwU2hhZG93czsKCQkJcmVzdWx0LmNsaXBwaW5nUGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXM7CgkJCXJlc3VsdC5jbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbjsKCgkJCXJlc3VsdC53aXJlZnJhbWVMaW5ld2lkdGggPSBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGg7CgkJCXJlc3VsdC5saW5ld2lkdGggPSBtYXRlcmlhbC5saW5ld2lkdGg7CgoJCQlpZiAoIGlzUG9pbnRMaWdodCAmJiByZXN1bHQuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCApIHsKCgkJCQlyZXN1bHQucmVmZXJlbmNlUG9zaXRpb24uY29weSggbGlnaHRQb3NpdGlvbldvcmxkICk7CgkJCQlyZXN1bHQubmVhckRpc3RhbmNlID0gc2hhZG93Q2FtZXJhTmVhcjsKCQkJCXJlc3VsdC5mYXJEaXN0YW5jZSA9IHNoYWRvd0NhbWVyYUZhcjsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBpc1BvaW50TGlnaHQgKSB7CgoJCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJCXZhciB2aXNpYmxlID0gb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICk7CgoJCQlpZiAoIHZpc2libGUgJiYgKCBvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc0xpbmUgfHwgb2JqZWN0LmlzUG9pbnRzICkgKSB7CgoJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyAmJiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c09iamVjdCggb2JqZWN0ICkgKSApIHsKCgkJCQkJb2JqZWN0Lm1vZGVsVmlld01hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBzaGFkb3dDYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJCQkJdmFyIGdlb21ldHJ5ID0gX29iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQl2YXIgbWF0ZXJpYWwgPSBvYmplY3QubWF0ZXJpYWw7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJCXZhciBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJCQlmb3IgKCB2YXIgayA9IDAsIGtsID0gZ3JvdXBzLmxlbmd0aDsgayA8IGtsOyBrICsrICkgewoKCQkJCQkJCXZhciBncm91cCA9IGdyb3Vwc1sgayBdOwoJCQkJCQkJdmFyIGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKCQkJCQkJCWlmICggZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCQkJCXZhciBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBncm91cE1hdGVyaWFsLCBpc1BvaW50TGlnaHQsIF9saWdodFBvc2l0aW9uV29ybGQsIHNoYWRvd0NhbWVyYS5uZWFyLCBzaGFkb3dDYW1lcmEuZmFyICk7CgkJCQkJCQkJX3JlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCXZhciBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgaXNQb2ludExpZ2h0LCBfbGlnaHRQb3NpdGlvbldvcmxkLCBzaGFkb3dDYW1lcmEubmVhciwgc2hhZG93Q2FtZXJhLmZhciApOwoJCQkJCQlfcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIG51bGwgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXZhciBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJcmVuZGVyT2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgaXNQb2ludExpZ2h0ICk7CgoJCQl9CgoJCX0KCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViR0xTdGF0ZSggZ2wsIGV4dGVuc2lvbnMsIHV0aWxzLCBjYXBhYmlsaXRpZXMgKSB7CgoJCWZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewoKCQkJdmFyIGxvY2tlZCA9IGZhbHNlOwoKCQkJdmFyIGNvbG9yID0gbmV3IFZlY3RvcjQoKTsKCQkJdmFyIGN1cnJlbnRDb2xvck1hc2sgPSBudWxsOwoJCQl2YXIgY3VycmVudENvbG9yQ2xlYXIgPSBuZXcgVmVjdG9yNCggMCwgMCwgMCwgMCApOwoKCQkJcmV0dXJuIHsKCgkJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGNvbG9yTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50Q29sb3JNYXNrICE9PSBjb2xvck1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCQlnbC5jb2xvck1hc2soIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2ssIGNvbG9yTWFzayApOwoJCQkJCQljdXJyZW50Q29sb3JNYXNrID0gY29sb3JNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRMb2NrZWQ6IGZ1bmN0aW9uICggbG9jayApIHsKCgkJCQkJbG9ja2VkID0gbG9jazsKCgkJCQl9LAoKCQkJCXNldENsZWFyOiBmdW5jdGlvbiAoIHIsIGcsIGIsIGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJCQkJaWYgKCBwcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUgKSB7CgoJCQkJCQlyICo9IGE7IGcgKj0gYTsgYiAqPSBhOwoKCQkJCQl9CgoJCQkJCWNvbG9yLnNldCggciwgZywgYiwgYSApOwoKCQkJCQlpZiAoIGN1cnJlbnRDb2xvckNsZWFyLmVxdWFscyggY29sb3IgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQlnbC5jbGVhckNvbG9yKCByLCBnLCBiLCBhICk7CgkJCQkJCWN1cnJlbnRDb2xvckNsZWFyLmNvcHkoIGNvbG9yICk7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50Q29sb3JNYXNrID0gbnVsbDsKCQkJCQljdXJyZW50Q29sb3JDbGVhci5zZXQoIC0gMSwgMCwgMCwgMCApOyAvLyBzZXQgdG8gaW52YWxpZCBzdGF0ZQoKCQkJCX0KCgkJCX07CgoJCX0KCgkJZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CgoJCQl2YXIgbG9ja2VkID0gZmFsc2U7CgoJCQl2YXIgY3VycmVudERlcHRoTWFzayA9IG51bGw7CgkJCXZhciBjdXJyZW50RGVwdGhGdW5jID0gbnVsbDsKCQkJdmFyIGN1cnJlbnREZXB0aENsZWFyID0gbnVsbDsKCgkJCXJldHVybiB7CgoJCQkJc2V0VGVzdDogZnVuY3Rpb24gKCBkZXB0aFRlc3QgKSB7CgoJCQkJCWlmICggZGVwdGhUZXN0ICkgewoKCQkJCQkJZW5hYmxlKCAyOTI5ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlkaXNhYmxlKCAyOTI5ICk7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXNldE1hc2s6IGZ1bmN0aW9uICggZGVwdGhNYXNrICkgewoKCQkJCQlpZiAoIGN1cnJlbnREZXB0aE1hc2sgIT09IGRlcHRoTWFzayAmJiAhIGxvY2tlZCApIHsKCgkJCQkJCWdsLmRlcHRoTWFzayggZGVwdGhNYXNrICk7CgkJCQkJCWN1cnJlbnREZXB0aE1hc2sgPSBkZXB0aE1hc2s7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXNldEZ1bmM6IGZ1bmN0aW9uICggZGVwdGhGdW5jICkgewoKCQkJCQlpZiAoIGN1cnJlbnREZXB0aEZ1bmMgIT09IGRlcHRoRnVuYyApIHsKCgkJCQkJCWlmICggZGVwdGhGdW5jICkgewoKCQkJCQkJCXN3aXRjaCAoIGRlcHRoRnVuYyApIHsKCgkJCQkJCQkJY2FzZSBOZXZlckRlcHRoOgoKCQkJCQkJCQkJZ2wuZGVwdGhGdW5jKCA1MTIgKTsKCQkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJCWNhc2UgQWx3YXlzRGVwdGg6CgoJCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIDUxOSApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJY2FzZSBMZXNzRGVwdGg6CgoJCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIDUxMyApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJY2FzZSBMZXNzRXF1YWxEZXB0aDoKCgkJCQkJCQkJCWdsLmRlcHRoRnVuYyggNTE1ICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIEVxdWFsRGVwdGg6CgoJCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIDUxNCApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJY2FzZSBHcmVhdGVyRXF1YWxEZXB0aDoKCgkJCQkJCQkJCWdsLmRlcHRoRnVuYyggNTE4ICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIEdyZWF0ZXJEZXB0aDoKCgkJCQkJCQkJCWdsLmRlcHRoRnVuYyggNTE2ICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIE5vdEVxdWFsRGVwdGg6CgoJCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIDUxNyApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJZGVmYXVsdDoKCgkJCQkJCQkJCWdsLmRlcHRoRnVuYyggNTE1ICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIDUxNSApOwoKCQkJCQkJfQoKCQkJCQkJY3VycmVudERlcHRoRnVuYyA9IGRlcHRoRnVuYzsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBkZXB0aCApIHsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGggKSB7CgoJCQkJCQlnbC5jbGVhckRlcHRoKCBkZXB0aCApOwoJCQkJCQljdXJyZW50RGVwdGhDbGVhciA9IGRlcHRoOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCQlsb2NrZWQgPSBmYWxzZTsKCgkJCQkJY3VycmVudERlcHRoTWFzayA9IG51bGw7CgkJCQkJY3VycmVudERlcHRoRnVuYyA9IG51bGw7CgkJCQkJY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKCQkJCX0KCgkJCX07CgoJCX0KCgkJZnVuY3Rpb24gU3RlbmNpbEJ1ZmZlcigpIHsKCgkJCXZhciBsb2NrZWQgPSBmYWxzZTsKCgkJCXZhciBjdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCQl2YXIgY3VycmVudFN0ZW5jaWxGdW5jID0gbnVsbDsKCQkJdmFyIGN1cnJlbnRTdGVuY2lsUmVmID0gbnVsbDsKCQkJdmFyIGN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCQl2YXIgY3VycmVudFN0ZW5jaWxGYWlsID0gbnVsbDsKCQkJdmFyIGN1cnJlbnRTdGVuY2lsWkZhaWwgPSBudWxsOwoJCQl2YXIgY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJCXZhciBjdXJyZW50U3RlbmNpbENsZWFyID0gbnVsbDsKCgkJCXJldHVybiB7CgoJCQkJc2V0VGVzdDogZnVuY3Rpb24gKCBzdGVuY2lsVGVzdCApIHsKCgkJCQkJaWYgKCBzdGVuY2lsVGVzdCApIHsKCgkJCQkJCWVuYWJsZSggMjk2MCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGlzYWJsZSggMjk2MCApOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIHN0ZW5jaWxNYXNrICkgewoKCQkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsTWFzayAhPT0gc3RlbmNpbE1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCQlnbC5zdGVuY2lsTWFzayggc3RlbmNpbE1hc2sgKTsKCQkJCQkJY3VycmVudFN0ZW5jaWxNYXNrID0gc3RlbmNpbE1hc2s7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXNldEZ1bmM6IGZ1bmN0aW9uICggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICkgewoKCQkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsRnVuYyAhPT0gc3RlbmNpbEZ1bmMgfHwKCQkJCQkgICAgIGN1cnJlbnRTdGVuY2lsUmVmIAkhPT0gc3RlbmNpbFJlZiAJfHwKCQkJCQkgICAgIGN1cnJlbnRTdGVuY2lsRnVuY01hc2sgIT09IHN0ZW5jaWxNYXNrICkgewoKCQkJCQkJZ2wuc3RlbmNpbEZ1bmMoIHN0ZW5jaWxGdW5jLCBzdGVuY2lsUmVmLCBzdGVuY2lsTWFzayApOwoKCQkJCQkJY3VycmVudFN0ZW5jaWxGdW5jID0gc3RlbmNpbEZ1bmM7CgkJCQkJCWN1cnJlbnRTdGVuY2lsUmVmID0gc3RlbmNpbFJlZjsKCQkJCQkJY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IHN0ZW5jaWxNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRPcDogZnVuY3Rpb24gKCBzdGVuY2lsRmFpbCwgc3RlbmNpbFpGYWlsLCBzdGVuY2lsWlBhc3MgKSB7CgoJCQkJCWlmICggY3VycmVudFN0ZW5jaWxGYWlsCSAhPT0gc3RlbmNpbEZhaWwgCXx8CgkJCQkJICAgICBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwKCQkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWlBhc3MgIT09IHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJCWdsLnN0ZW5jaWxPcCggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICk7CgoJCQkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IHN0ZW5jaWxaUGFzczsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBzdGVuY2lsICkgewoKCQkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsQ2xlYXIgIT09IHN0ZW5jaWwgKSB7CgoJCQkJCQlnbC5jbGVhclN0ZW5jaWwoIHN0ZW5jaWwgKTsKCQkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IHN0ZW5jaWw7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQkvLwoKCQl2YXIgY29sb3JCdWZmZXIgPSBuZXcgQ29sb3JCdWZmZXIoKTsKCQl2YXIgZGVwdGhCdWZmZXIgPSBuZXcgRGVwdGhCdWZmZXIoKTsKCQl2YXIgc3RlbmNpbEJ1ZmZlciA9IG5ldyBTdGVuY2lsQnVmZmVyKCk7CgoJCXZhciBtYXhWZXJ0ZXhBdHRyaWJ1dGVzID0gZ2wuZ2V0UGFyYW1ldGVyKCAzNDkyMSApOwoJCXZhciBuZXdBdHRyaWJ1dGVzID0gbmV3IFVpbnQ4QXJyYXkoIG1heFZlcnRleEF0dHJpYnV0ZXMgKTsKCQl2YXIgZW5hYmxlZEF0dHJpYnV0ZXMgPSBuZXcgVWludDhBcnJheSggbWF4VmVydGV4QXR0cmlidXRlcyApOwoJCXZhciBhdHRyaWJ1dGVEaXZpc29ycyA9IG5ldyBVaW50OEFycmF5KCBtYXhWZXJ0ZXhBdHRyaWJ1dGVzICk7CgoJCXZhciBlbmFibGVkQ2FwYWJpbGl0aWVzID0ge307CgoJCXZhciBjb21wcmVzc2VkVGV4dHVyZUZvcm1hdHMgPSBudWxsOwoKCQl2YXIgY3VycmVudFByb2dyYW0gPSBudWxsOwoKCQl2YXIgY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IG51bGw7CgkJdmFyIGN1cnJlbnRCbGVuZGluZyA9IG51bGw7CgkJdmFyIGN1cnJlbnRCbGVuZEVxdWF0aW9uID0gbnVsbDsKCQl2YXIgY3VycmVudEJsZW5kU3JjID0gbnVsbDsKCQl2YXIgY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKCQl2YXIgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgkJdmFyIGN1cnJlbnRCbGVuZFNyY0FscGhhID0gbnVsbDsKCQl2YXIgY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwoJCXZhciBjdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJdmFyIGN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwoJCXZhciBjdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKCQl2YXIgY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgoJCXZhciBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CgkJdmFyIGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKCQl2YXIgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIDM1NjYxICk7CgoJCXZhciBsaW5lV2lkdGhBdmFpbGFibGUgPSBmYWxzZTsKCQl2YXIgdmVyc2lvbiA9IDA7CgkJdmFyIGdsVmVyc2lvbiA9IGdsLmdldFBhcmFtZXRlciggNzkzOCApOwoKCQlpZiAoIGdsVmVyc2lvbi5pbmRleE9mKCAnV2ViR0wnICkgIT09IC0gMSApIHsKCgkJCXZlcnNpb24gPSBwYXJzZUZsb2F0KCAvXldlYkdMXCAoWzAtOV0pLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CgkJCWxpbmVXaWR0aEF2YWlsYWJsZSA9ICggdmVyc2lvbiA+PSAxLjAgKTsKCgkJfSBlbHNlIGlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdPcGVuR0wgRVMnICkgIT09IC0gMSApIHsKCgkJCXZlcnNpb24gPSBwYXJzZUZsb2F0KCAvXk9wZW5HTFwgRVNcIChbMC05XSkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKCQkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDIuMCApOwoKCQl9CgoJCXZhciBjdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCXZhciBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQl2YXIgY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpOwoJCXZhciBjdXJyZW50Vmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKCQlmdW5jdGlvbiBjcmVhdGVUZXh0dXJlKCB0eXBlLCB0YXJnZXQsIGNvdW50ICkgewoKCQkJdmFyIGRhdGEgPSBuZXcgVWludDhBcnJheSggNCApOyAvLyA0IGlzIHJlcXVpcmVkIHRvIG1hdGNoIGRlZmF1bHQgdW5wYWNrIGFsaWdubWVudCBvZiA0LgoJCQl2YXIgdGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCWdsLmJpbmRUZXh0dXJlKCB0eXBlLCB0ZXh0dXJlICk7CgkJCWdsLnRleFBhcmFtZXRlcmkoIHR5cGUsIDEwMjQxLCA5NzI4ICk7CgkJCWdsLnRleFBhcmFtZXRlcmkoIHR5cGUsIDEwMjQwLCA5NzI4ICk7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSArKyApIHsKCgkJCQlnbC50ZXhJbWFnZTJEKCB0YXJnZXQgKyBpLCAwLCA2NDA4LCAxLCAxLCAwLCA2NDA4LCA1MTIxLCBkYXRhICk7CgoJCQl9CgoJCQlyZXR1cm4gdGV4dHVyZTsKCgkJfQoKCQl2YXIgZW1wdHlUZXh0dXJlcyA9IHt9OwoJCWVtcHR5VGV4dHVyZXNbIDM1NTMgXSA9IGNyZWF0ZVRleHR1cmUoIDM1NTMsIDM1NTMsIDEgKTsKCQllbXB0eVRleHR1cmVzWyAzNDA2NyBdID0gY3JlYXRlVGV4dHVyZSggMzQwNjcsIDM0MDY5LCA2ICk7CgoJCS8vIGluaXQKCgkJY29sb3JCdWZmZXIuc2V0Q2xlYXIoIDAsIDAsIDAsIDEgKTsKCQlkZXB0aEJ1ZmZlci5zZXRDbGVhciggMSApOwoJCXN0ZW5jaWxCdWZmZXIuc2V0Q2xlYXIoIDAgKTsKCgkJZW5hYmxlKCAyOTI5ICk7CgkJZGVwdGhCdWZmZXIuc2V0RnVuYyggTGVzc0VxdWFsRGVwdGggKTsKCgkJc2V0RmxpcFNpZGVkKCBmYWxzZSApOwoJCXNldEN1bGxGYWNlKCBDdWxsRmFjZUJhY2sgKTsKCQllbmFibGUoIDI4ODQgKTsKCgkJc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKTsKCgkJLy8KCgkJZnVuY3Rpb24gaW5pdEF0dHJpYnV0ZXMoKSB7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBuZXdBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJbmV3QXR0cmlidXRlc1sgaSBdID0gMDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCgkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIGF0dHJpYnV0ZSwgMCApOwoKCQl9CgoJCWZ1bmN0aW9uIGVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIGF0dHJpYnV0ZSwgbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJCW5ld0F0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCgkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID09PSAwICkgewoKCQkJCWdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KCBhdHRyaWJ1dGUgKTsKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9IDE7CgoJCQl9CgoJCQlpZiAoIGF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJCQl2YXIgZXh0ZW5zaW9uID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gZ2wgOiBleHRlbnNpb25zLmdldCggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICk7CgoJCQkJZXh0ZW5zaW9uWyBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPyAndmVydGV4QXR0cmliRGl2aXNvcicgOiAndmVydGV4QXR0cmliRGl2aXNvckFOR0xFJyBdKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKTsKCQkJCWF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBlbmFibGVkQXR0cmlidXRlcy5sZW5ndGg7IGkgIT09IGw7ICsrIGkgKSB7CgoJCQkJaWYgKCBlbmFibGVkQXR0cmlidXRlc1sgaSBdICE9PSBuZXdBdHRyaWJ1dGVzWyBpIF0gKSB7CgoJCQkJCWdsLmRpc2FibGVWZXJ0ZXhBdHRyaWJBcnJheSggaSApOwoJCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBpIF0gPSAwOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBlbmFibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSB0cnVlICkgewoKCQkJCWdsLmVuYWJsZSggaWQgKTsKCQkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGRpc2FibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSBmYWxzZSApIHsKCgkJCQlnbC5kaXNhYmxlKCBpZCApOwoJCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IGZhbHNlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGdldENvbXByZXNzZWRUZXh0dXJlRm9ybWF0cygpIHsKCgkJCWlmICggY29tcHJlc3NlZFRleHR1cmVGb3JtYXRzID09PSBudWxsICkgewoKCQkJCWNvbXByZXNzZWRUZXh0dXJlRm9ybWF0cyA9IFtdOwoKCQkJCWlmICggZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICkgfHwKCQkJCSAgICAgZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKSB8fAoJCQkJICAgICBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMxJyApIHx8CgkJCQkgICAgIGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGMnICkgKSB7CgoJCQkJCXZhciBmb3JtYXRzID0gZ2wuZ2V0UGFyYW1ldGVyKCAzNDQ2NyApOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBmb3JtYXRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCWNvbXByZXNzZWRUZXh0dXJlRm9ybWF0cy5wdXNoKCBmb3JtYXRzWyBpIF0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBjb21wcmVzc2VkVGV4dHVyZUZvcm1hdHM7CgoJCX0KCgkJZnVuY3Rpb24gdXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJCWlmICggY3VycmVudFByb2dyYW0gIT09IHByb2dyYW0gKSB7CgoJCQkJZ2wudXNlUHJvZ3JhbSggcHJvZ3JhbSApOwoKCQkJCWN1cnJlbnRQcm9ncmFtID0gcHJvZ3JhbTsKCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRCbGVuZGluZyggYmxlbmRpbmcsIGJsZW5kRXF1YXRpb24sIGJsZW5kU3JjLCBibGVuZERzdCwgYmxlbmRFcXVhdGlvbkFscGhhLCBibGVuZFNyY0FscGhhLCBibGVuZERzdEFscGhhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgoJCQlpZiAoIGJsZW5kaW5nID09PSBOb0JsZW5kaW5nICkgewoKCQkJCWlmICggY3VycmVudEJsZW5kaW5nRW5hYmxlZCApIHsKCgkJCQkJZGlzYWJsZSggMzA0MiApOwoJCQkJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCAhIGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgKSB7CgoJCQkJZW5hYmxlKCAzMDQyICk7CgkJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggYmxlbmRpbmcgIT09IEN1c3RvbUJsZW5kaW5nICkgewoKCQkJCWlmICggYmxlbmRpbmcgIT09IGN1cnJlbnRCbGVuZGluZyB8fCBwcmVtdWx0aXBsaWVkQWxwaGEgIT09IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSApIHsKCgkJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgoJCQkJCQlnbC5ibGVuZEVxdWF0aW9uKCAzMjc3NCApOwoKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKCQkJCQl9CgoJCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQkJY2FzZSBOb3JtYWxCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggMSwgNzcxLCAxLCA3NzEgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEFkZGl0aXZlQmxlbmRpbmc6CgkJCQkJCQkJZ2wuYmxlbmRGdW5jKCAxLCAxICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgoJCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCAwLCAwLCA3NjksIDc3MSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgTXVsdGlwbHlCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggMCwgNzY4LCAwLCA3NzAgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQlkZWZhdWx0OgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBJbnZhbGlkIGJsZW5kaW5nOiAnLCBibGVuZGluZyApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQkJY2FzZSBOb3JtYWxCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggNzcwLCA3NzEsIDEsIDc3MSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmMoIDc3MCwgMSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgU3VidHJhY3RpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmMoIDAsIDc2OSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgTXVsdGlwbHlCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmMoIDAsIDc2OCApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWRlZmF1bHQ6CgkJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICcsIGJsZW5kaW5nICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJY3VycmVudEJsZW5kU3JjID0gbnVsbDsKCQkJCQljdXJyZW50QmxlbmREc3QgPSBudWxsOwoJCQkJCWN1cnJlbnRCbGVuZFNyY0FscGhhID0gbnVsbDsKCQkJCQljdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CgoJCQkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQkJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IHByZW11bHRpcGxpZWRBbHBoYTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJLy8gY3VzdG9tIGJsZW5kaW5nCgoJCQlibGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGEgfHwgYmxlbmRFcXVhdGlvbjsKCQkJYmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGEgfHwgYmxlbmRTcmM7CgkJCWJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhIHx8IGJsZW5kRHN0OwoKCQkJaWYgKCBibGVuZEVxdWF0aW9uICE9PSBjdXJyZW50QmxlbmRFcXVhdGlvbiB8fCBibGVuZEVxdWF0aW9uQWxwaGEgIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgKSB7CgoJCQkJZ2wuYmxlbmRFcXVhdGlvblNlcGFyYXRlKCB1dGlscy5jb252ZXJ0KCBibGVuZEVxdWF0aW9uICksIHV0aWxzLmNvbnZlcnQoIGJsZW5kRXF1YXRpb25BbHBoYSApICk7CgoJCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBibGVuZEVxdWF0aW9uOwoJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYTsKCgkJCX0KCgkJCWlmICggYmxlbmRTcmMgIT09IGN1cnJlbnRCbGVuZFNyYyB8fCBibGVuZERzdCAhPT0gY3VycmVudEJsZW5kRHN0IHx8IGJsZW5kU3JjQWxwaGEgIT09IGN1cnJlbnRCbGVuZFNyY0FscGhhIHx8IGJsZW5kRHN0QWxwaGEgIT09IGN1cnJlbnRCbGVuZERzdEFscGhhICkgewoKCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCB1dGlscy5jb252ZXJ0KCBibGVuZFNyYyApLCB1dGlscy5jb252ZXJ0KCBibGVuZERzdCApLCB1dGlscy5jb252ZXJ0KCBibGVuZFNyY0FscGhhICksIHV0aWxzLmNvbnZlcnQoIGJsZW5kRHN0QWxwaGEgKSApOwoKCQkJCWN1cnJlbnRCbGVuZFNyYyA9IGJsZW5kU3JjOwoJCQkJY3VycmVudEJsZW5kRHN0ID0gYmxlbmREc3Q7CgkJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGE7CgkJCQljdXJyZW50QmxlbmREc3RBbHBoYSA9IGJsZW5kRHN0QWxwaGE7CgoJCQl9CgoJCQljdXJyZW50QmxlbmRpbmcgPSBibGVuZGluZzsKCQkJY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gbnVsbDsKCgkJfQoKCQlmdW5jdGlvbiBzZXRNYXRlcmlhbCggbWF0ZXJpYWwsIGZyb250RmFjZUNXICkgewoKCQkJbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZQoJCQkJPyBkaXNhYmxlKCAyODg0ICkKCQkJCTogZW5hYmxlKCAyODg0ICk7CgoJCQl2YXIgZmxpcFNpZGVkID0gKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApOwoJCQlpZiAoIGZyb250RmFjZUNXICkgZmxpcFNpZGVkID0gISBmbGlwU2lkZWQ7CgoJCQlzZXRGbGlwU2lkZWQoIGZsaXBTaWRlZCApOwoKCQkJKCBtYXRlcmlhbC5ibGVuZGluZyA9PT0gTm9ybWFsQmxlbmRpbmcgJiYgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IGZhbHNlICkKCQkJCT8gc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKQoJCQkJOiBzZXRCbGVuZGluZyggbWF0ZXJpYWwuYmxlbmRpbmcsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb24sIG1hdGVyaWFsLmJsZW5kU3JjLCBtYXRlcmlhbC5ibGVuZERzdCwgbWF0ZXJpYWwuYmxlbmRFcXVhdGlvbkFscGhhLCBtYXRlcmlhbC5ibGVuZFNyY0FscGhhLCBtYXRlcmlhbC5ibGVuZERzdEFscGhhLCBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEgKTsKCgkJCWRlcHRoQnVmZmVyLnNldEZ1bmMoIG1hdGVyaWFsLmRlcHRoRnVuYyApOwoJCQlkZXB0aEJ1ZmZlci5zZXRUZXN0KCBtYXRlcmlhbC5kZXB0aFRlc3QgKTsKCQkJZGVwdGhCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuZGVwdGhXcml0ZSApOwoJCQljb2xvckJ1ZmZlci5zZXRNYXNrKCBtYXRlcmlhbC5jb2xvcldyaXRlICk7CgoJCQlzZXRQb2x5Z29uT2Zmc2V0KCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0LCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0RmFjdG9yLCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgKTsKCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiBzZXRGbGlwU2lkZWQoIGZsaXBTaWRlZCApIHsKCgkJCWlmICggY3VycmVudEZsaXBTaWRlZCAhPT0gZmxpcFNpZGVkICkgewoKCQkJCWlmICggZmxpcFNpZGVkICkgewoKCQkJCQlnbC5mcm9udEZhY2UoIDIzMDQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlnbC5mcm9udEZhY2UoIDIzMDUgKTsKCgkJCQl9CgoJCQkJY3VycmVudEZsaXBTaWRlZCA9IGZsaXBTaWRlZDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXRDdWxsRmFjZSggY3VsbEZhY2UgKSB7CgoJCQlpZiAoIGN1bGxGYWNlICE9PSBDdWxsRmFjZU5vbmUgKSB7CgoJCQkJZW5hYmxlKCAyODg0ICk7CgoJCQkJaWYgKCBjdWxsRmFjZSAhPT0gY3VycmVudEN1bGxGYWNlICkgewoKCQkJCQlpZiAoIGN1bGxGYWNlID09PSBDdWxsRmFjZUJhY2sgKSB7CgoJCQkJCQlnbC5jdWxsRmFjZSggMTAyOSApOwoKCQkJCQl9IGVsc2UgaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VGcm9udCApIHsKCgkJCQkJCWdsLmN1bGxGYWNlKCAxMDI4ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlnbC5jdWxsRmFjZSggMTAzMiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCAyODg0ICk7CgoJCQl9CgoJCQljdXJyZW50Q3VsbEZhY2UgPSBjdWxsRmFjZTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRMaW5lV2lkdGgoIHdpZHRoICkgewoKCQkJaWYgKCB3aWR0aCAhPT0gY3VycmVudExpbmVXaWR0aCApIHsKCgkJCQlpZiAoIGxpbmVXaWR0aEF2YWlsYWJsZSApIGdsLmxpbmVXaWR0aCggd2lkdGggKTsKCgkJCQljdXJyZW50TGluZVdpZHRoID0gd2lkdGg7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0UG9seWdvbk9mZnNldCggcG9seWdvbk9mZnNldCwgZmFjdG9yLCB1bml0cyApIHsKCgkJCWlmICggcG9seWdvbk9mZnNldCApIHsKCgkJCQllbmFibGUoIDMyODIzICk7CgoJCQkJaWYgKCBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciAhPT0gZmFjdG9yIHx8IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgIT09IHVuaXRzICkgewoKCQkJCQlnbC5wb2x5Z29uT2Zmc2V0KCBmYWN0b3IsIHVuaXRzICk7CgoJCQkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yID0gZmFjdG9yOwoJCQkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSB1bml0czsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWRpc2FibGUoIDMyODIzICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0U2Npc3NvclRlc3QoIHNjaXNzb3JUZXN0ICkgewoKCQkJaWYgKCBzY2lzc29yVGVzdCApIHsKCgkJCQllbmFibGUoIDMwODkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZGlzYWJsZSggMzA4OSApOwoKCQkJfQoKCQl9CgoJCS8vIHRleHR1cmUKCgkJZnVuY3Rpb24gYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICkgewoKCQkJaWYgKCB3ZWJnbFNsb3QgPT09IHVuZGVmaW5lZCApIHdlYmdsU2xvdCA9IDMzOTg0ICsgbWF4VGV4dHVyZXMgLSAxOwoKCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCgkJCQlnbC5hY3RpdmVUZXh0dXJlKCB3ZWJnbFNsb3QgKTsKCQkJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IHdlYmdsU2xvdDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBiaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgKSB7CgoJCQlpZiAoIGN1cnJlbnRUZXh0dXJlU2xvdCA9PT0gbnVsbCApIHsKCgkJCQlhY3RpdmVUZXh0dXJlKCk7CgoJCQl9CgoJCQl2YXIgYm91bmRUZXh0dXJlID0gY3VycmVudEJvdW5kVGV4dHVyZXNbIGN1cnJlbnRUZXh0dXJlU2xvdCBdOwoKCQkJaWYgKCBib3VuZFRleHR1cmUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlib3VuZFRleHR1cmUgPSB7IHR5cGU6IHVuZGVmaW5lZCwgdGV4dHVyZTogdW5kZWZpbmVkIH07CgkJCQljdXJyZW50Qm91bmRUZXh0dXJlc1sgY3VycmVudFRleHR1cmVTbG90IF0gPSBib3VuZFRleHR1cmU7CgoJCQl9CgoJCQlpZiAoIGJvdW5kVGV4dHVyZS50eXBlICE9PSB3ZWJnbFR5cGUgfHwgYm91bmRUZXh0dXJlLnRleHR1cmUgIT09IHdlYmdsVGV4dHVyZSApIHsKCgkJCQlnbC5iaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgfHwgZW1wdHlUZXh0dXJlc1sgd2ViZ2xUeXBlIF0gKTsKCgkJCQlib3VuZFRleHR1cmUudHlwZSA9IHdlYmdsVHlwZTsKCQkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhJbWFnZTJEKCkgewoKCQkJdHJ5IHsKCgkJCQlnbC5jb21wcmVzc2VkVGV4SW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4SW1hZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4SW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4SW1hZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4SW1hZ2UzRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJLy8KCgkJZnVuY3Rpb24gc2Npc3Nvciggc2Npc3NvciApIHsKCgkJCWlmICggY3VycmVudFNjaXNzb3IuZXF1YWxzKCBzY2lzc29yICkgPT09IGZhbHNlICkgewoKCQkJCWdsLnNjaXNzb3IoIHNjaXNzb3IueCwgc2Npc3Nvci55LCBzY2lzc29yLnosIHNjaXNzb3IudyApOwoJCQkJY3VycmVudFNjaXNzb3IuY29weSggc2Npc3NvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHZpZXdwb3J0KCB2aWV3cG9ydCApIHsKCgkJCWlmICggY3VycmVudFZpZXdwb3J0LmVxdWFscyggdmlld3BvcnQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJZ2wudmlld3BvcnQoIHZpZXdwb3J0LngsIHZpZXdwb3J0LnksIHZpZXdwb3J0LnosIHZpZXdwb3J0LncgKTsKCQkJCWN1cnJlbnRWaWV3cG9ydC5jb3B5KCB2aWV3cG9ydCApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgZW5hYmxlZEF0dHJpYnV0ZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9PT0gMSApIHsKCgkJCQkJZ2wuZGlzYWJsZVZlcnRleEF0dHJpYkFycmF5KCBpICk7CgkJCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9IDA7CgoJCQkJfQoKCQkJfQoKCQkJZW5hYmxlZENhcGFiaWxpdGllcyA9IHt9OwoKCQkJY29tcHJlc3NlZFRleHR1cmVGb3JtYXRzID0gbnVsbDsKCgkJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IG51bGw7CgkJCWN1cnJlbnRCb3VuZFRleHR1cmVzID0ge307CgoJCQljdXJyZW50UHJvZ3JhbSA9IG51bGw7CgoJCQljdXJyZW50QmxlbmRpbmcgPSBudWxsOwoKCQkJY3VycmVudEZsaXBTaWRlZCA9IG51bGw7CgkJCWN1cnJlbnRDdWxsRmFjZSA9IG51bGw7CgoJCQljb2xvckJ1ZmZlci5yZXNldCgpOwoJCQlkZXB0aEJ1ZmZlci5yZXNldCgpOwoJCQlzdGVuY2lsQnVmZmVyLnJlc2V0KCk7CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWJ1ZmZlcnM6IHsKCQkJCWNvbG9yOiBjb2xvckJ1ZmZlciwKCQkJCWRlcHRoOiBkZXB0aEJ1ZmZlciwKCQkJCXN0ZW5jaWw6IHN0ZW5jaWxCdWZmZXIKCQkJfSwKCgkJCWluaXRBdHRyaWJ1dGVzOiBpbml0QXR0cmlidXRlcywKCQkJZW5hYmxlQXR0cmlidXRlOiBlbmFibGVBdHRyaWJ1dGUsCgkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3I6IGVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IsCgkJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzOiBkaXNhYmxlVW51c2VkQXR0cmlidXRlcywKCQkJZW5hYmxlOiBlbmFibGUsCgkJCWRpc2FibGU6IGRpc2FibGUsCgkJCWdldENvbXByZXNzZWRUZXh0dXJlRm9ybWF0czogZ2V0Q29tcHJlc3NlZFRleHR1cmVGb3JtYXRzLAoKCQkJdXNlUHJvZ3JhbTogdXNlUHJvZ3JhbSwKCgkJCXNldEJsZW5kaW5nOiBzZXRCbGVuZGluZywKCQkJc2V0TWF0ZXJpYWw6IHNldE1hdGVyaWFsLAoKCQkJc2V0RmxpcFNpZGVkOiBzZXRGbGlwU2lkZWQsCgkJCXNldEN1bGxGYWNlOiBzZXRDdWxsRmFjZSwKCgkJCXNldExpbmVXaWR0aDogc2V0TGluZVdpZHRoLAoJCQlzZXRQb2x5Z29uT2Zmc2V0OiBzZXRQb2x5Z29uT2Zmc2V0LAoKCQkJc2V0U2Npc3NvclRlc3Q6IHNldFNjaXNzb3JUZXN0LAoKCQkJYWN0aXZlVGV4dHVyZTogYWN0aXZlVGV4dHVyZSwKCQkJYmluZFRleHR1cmU6IGJpbmRUZXh0dXJlLAoJCQljb21wcmVzc2VkVGV4SW1hZ2UyRDogY29tcHJlc3NlZFRleEltYWdlMkQsCgkJCXRleEltYWdlMkQ6IHRleEltYWdlMkQsCgkJCXRleEltYWdlM0Q6IHRleEltYWdlM0QsCgoJCQlzY2lzc29yOiBzY2lzc29yLAoJCQl2aWV3cG9ydDogdmlld3BvcnQsCgoJCQlyZXNldDogcmVzZXQKCgkJfTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViR0xUZXh0dXJlcyggX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyApIHsKCgkJdmFyIF92aWRlb1RleHR1cmVzID0ge307CgkJdmFyIF9jYW52YXM7CgoJCS8vCgoJCXZhciB1c2VPZmZzY3JlZW5DYW52YXMgPSB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzICE9PSAndW5kZWZpbmVkJzsKCgkJZnVuY3Rpb24gY3JlYXRlQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICkgewoKCQkJLy8gVXNlIE9mZnNjcmVlbkNhbnZhcyB3aGVuIGF2YWlsYWJsZS4gU3BlY2lhbGx5IG5lZWRlZCBpbiB3ZWIgd29ya2VycwoKCQkJcmV0dXJuIHVzZU9mZnNjcmVlbkNhbnZhcyA/CgkJCQluZXcgT2Zmc2NyZWVuQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICkgOgoJCQkJZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCcsICdjYW52YXMnICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVzaXplSW1hZ2UoIGltYWdlLCBuZWVkc1Bvd2VyT2ZUd28sIG5lZWRzTmV3Q2FudmFzLCBtYXhTaXplICkgewoKCQkJdmFyIHNjYWxlID0gMTsKCgkJCS8vIGhhbmRsZSBjYXNlIGlmIHRleHR1cmUgZXhjZWVkcyBtYXggc2l6ZQoKCQkJaWYgKCBpbWFnZS53aWR0aCA+IG1heFNpemUgfHwgaW1hZ2UuaGVpZ2h0ID4gbWF4U2l6ZSApIHsKCgkJCQlzY2FsZSA9IG1heFNpemUgLyBNYXRoLm1heCggaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJfQoKCQkJLy8gb25seSBwZXJmb3JtIHJlc2l6ZSBpZiBuZWNlc3NhcnkKCgkJCWlmICggc2NhbGUgPCAxIHx8IG5lZWRzUG93ZXJPZlR3byA9PT0gdHJ1ZSApIHsKCgkJCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGZvciBjZXJ0YWluIGltYWdlIHR5cGVzCgoJCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKCQkJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkJCQl2YXIgZmxvb3IgPSBuZWVkc1Bvd2VyT2ZUd28gPyBfTWF0aC5mbG9vclBvd2VyT2ZUd28gOiBNYXRoLmZsb29yOwoKCQkJCQl2YXIgd2lkdGggPSBmbG9vciggc2NhbGUgKiBpbWFnZS53aWR0aCApOwoJCQkJCXZhciBoZWlnaHQgPSBmbG9vciggc2NhbGUgKiBpbWFnZS5oZWlnaHQgKTsKCgkJCQkJaWYgKCBfY2FudmFzID09PSB1bmRlZmluZWQgKSBfY2FudmFzID0gY3JlYXRlQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkJCS8vIGN1YmUgdGV4dHVyZXMgY2FuJ3QgcmV1c2UgdGhlIHNhbWUgY2FudmFzCgoJCQkJCXZhciBjYW52YXMgPSBuZWVkc05ld0NhbnZhcyA/IGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIDogX2NhbnZhczsKCgkJCQkJY2FudmFzLndpZHRoID0gd2lkdGg7CgkJCQkJY2FudmFzLmhlaWdodCA9IGhlaWdodDsKCgkJCQkJdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoJCQkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoJyArIGltYWdlLndpZHRoICsgJ3gnICsgaW1hZ2UuaGVpZ2h0ICsgJykgdG8gKCcgKyB3aWR0aCArICd4JyArIGhlaWdodCArICcpLicgKTsKCgkJCQkJcmV0dXJuIGNhbnZhczsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoICdkYXRhJyBpbiBpbWFnZSApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEltYWdlIGluIERhdGFUZXh0dXJlIGlzIHRvbyBiaWcgKCcgKyBpbWFnZS53aWR0aCArICd4JyArIGltYWdlLmhlaWdodCArICcpLicgKTsKCgkJCQkJfQoKCQkJCQlyZXR1cm4gaW1hZ2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIGltYWdlOwoKCQl9CgoJCWZ1bmN0aW9uIGlzUG93ZXJPZlR3byggaW1hZ2UgKSB7CgoJCQlyZXR1cm4gX01hdGguaXNQb3dlck9mVHdvKCBpbWFnZS53aWR0aCApICYmIF9NYXRoLmlzUG93ZXJPZlR3byggaW1hZ2UuaGVpZ2h0ICk7CgoJCX0KCgkJZnVuY3Rpb24gdGV4dHVyZU5lZWRzUG93ZXJPZlR3byggdGV4dHVyZSApIHsKCgkJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgcmV0dXJuIGZhbHNlOwoKCQkJcmV0dXJuICggdGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nICkgfHwKCQkJCSggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlciApOwoKCQl9CgoJCWZ1bmN0aW9uIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgewoKCQkJcmV0dXJuIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICYmIHN1cHBvcnRzTWlwcyAmJgoJCQkJdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlcjsKCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZU1pcG1hcCggdGFyZ2V0LCB0ZXh0dXJlLCB3aWR0aCwgaGVpZ2h0ICkgewoKCQkJX2dsLmdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKTsKCgkJCXZhciB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQkvLyBOb3RlOiBNYXRoLmxvZyggeCApICogTWF0aC5MT0cyRSB1c2VkIGluc3RlYWQgb2YgTWF0aC5sb2cyKCB4ICkgd2hpY2ggaXMgbm90IHN1cHBvcnRlZCBieSBJRTExCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fbWF4TWlwTGV2ZWwgPSBNYXRoLmxvZyggTWF0aC5tYXgoIHdpZHRoLCBoZWlnaHQgKSApICogTWF0aC5MT0cyRTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRJbnRlcm5hbEZvcm1hdCggZ2xGb3JtYXQsIGdsVHlwZSApIHsKCgkJCWlmICggISBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSByZXR1cm4gZ2xGb3JtYXQ7CgoJCQl2YXIgaW50ZXJuYWxGb3JtYXQgPSBnbEZvcm1hdDsKCgkJCWlmICggZ2xGb3JtYXQgPT09IDY0MDMgKSB7CgoJCQkJaWYgKCBnbFR5cGUgPT09IDUxMjYgKSBpbnRlcm5hbEZvcm1hdCA9IDMzMzI2OwoJCQkJaWYgKCBnbFR5cGUgPT09IDUxMzEgKSBpbnRlcm5hbEZvcm1hdCA9IDMzMzI1OwoJCQkJaWYgKCBnbFR5cGUgPT09IDUxMjEgKSBpbnRlcm5hbEZvcm1hdCA9IDMzMzIxOwoKCQkJfQoKCQkJaWYgKCBnbEZvcm1hdCA9PT0gNjQwNyApIHsKCgkJCQlpZiAoIGdsVHlwZSA9PT0gNTEyNiApIGludGVybmFsRm9ybWF0ID0gMzQ4Mzc7CgkJCQlpZiAoIGdsVHlwZSA9PT0gNTEzMSApIGludGVybmFsRm9ybWF0ID0gMzQ4NDM7CgkJCQlpZiAoIGdsVHlwZSA9PT0gNTEyMSApIGludGVybmFsRm9ybWF0ID0gMzI4NDk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSA2NDA4ICkgewoKCQkJCWlmICggZ2xUeXBlID09PSA1MTI2ICkgaW50ZXJuYWxGb3JtYXQgPSAzNDgzNjsKCQkJCWlmICggZ2xUeXBlID09PSA1MTMxICkgaW50ZXJuYWxGb3JtYXQgPSAzNDg0MjsKCQkJCWlmICggZ2xUeXBlID09PSA1MTIxICkgaW50ZXJuYWxGb3JtYXQgPSAzMjg1NjsKCgkJCX0KCgkJCWlmICggaW50ZXJuYWxGb3JtYXQgPT09IDMzMzI1IHx8IGludGVybmFsRm9ybWF0ID09PSAzMzMyNiB8fAoJCQkJaW50ZXJuYWxGb3JtYXQgPT09IDM0ODQyIHx8IGludGVybmFsRm9ybWF0ID09PSAzNDgzNiApIHsKCgkJCQlleHRlbnNpb25zLmdldCggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgoJCQl9IGVsc2UgaWYgKCBpbnRlcm5hbEZvcm1hdCA9PT0gMzQ4NDMgfHwgaW50ZXJuYWxGb3JtYXQgPT09IDM0ODM3ICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEZsb2F0aW5nIHBvaW50IHRleHR1cmVzIHdpdGggUkdCIGZvcm1hdCBub3Qgc3VwcG9ydGVkLiBQbGVhc2UgdXNlIFJHQkEgaW5zdGVhZC4nICk7CgoJCQl9CgoJCQlyZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CgoJCX0KCgkJLy8gRmFsbGJhY2sgZmlsdGVycyBmb3Igbm9uLXBvd2VyLW9mLTIgdGV4dHVyZXMKCgkJZnVuY3Rpb24gZmlsdGVyRmFsbGJhY2soIGYgKSB7CgoJCQlpZiAoIGYgPT09IE5lYXJlc3RGaWx0ZXIgfHwgZiA9PT0gTmVhcmVzdE1pcE1hcE5lYXJlc3RGaWx0ZXIgfHwgZiA9PT0gTmVhcmVzdE1pcE1hcExpbmVhckZpbHRlciApIHsKCgkJCQlyZXR1cm4gOTcyODsKCgkJCX0KCgkJCXJldHVybiA5NzI5OwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIG9uVGV4dHVyZURpc3Bvc2UoIGV2ZW50ICkgewoKCQkJdmFyIHRleHR1cmUgPSBldmVudC50YXJnZXQ7CgoJCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQkJZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHsKCgkJCQlkZWxldGUgX3ZpZGVvVGV4dHVyZXNbIHRleHR1cmUuaWQgXTsKCgkJCX0KCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQl9CgoJCWZ1bmN0aW9uIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSggZXZlbnQgKSB7CgoJCQl2YXIgcmVuZGVyVGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKCQkJcmVuZGVyVGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25SZW5kZXJUYXJnZXREaXNwb3NlICk7CgoJCQlkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIGRlYWxsb2NhdGVUZXh0dXJlKCB0ZXh0dXJlICkgewoKCQkJdmFyIHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCV9nbC5kZWxldGVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCgkJfQoKCQlmdW5jdGlvbiBkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQl2YXIgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQkJdmFyIHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgoJCQlpZiAoICEgcmVuZGVyVGFyZ2V0ICkgcmV0dXJuOwoKCQkJaWYgKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCV9nbC5kZWxldGVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQkJfQoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkgewoKCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZGlzcG9zZSgpOwoKCQkJfQoKCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTFJlbmRlclRhcmdldEN1YmUgKSB7CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdICk7CgkJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApOwoKCQkJfQoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCXByb3BlcnRpZXMucmVtb3ZlKCByZW5kZXJUYXJnZXQgKTsKCgkJfQoKCQkvLwoKCgoJCWZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCXZhciB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB1cGRhdGVWaWRlb1RleHR1cmUoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQl2YXIgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKCQkJCWlmICggaW1hZ2UgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgaW1hZ2UgaXMgdW5kZWZpbmVkJyApOwoKCQkJCX0gZWxzZSBpZiAoIGltYWdlLmNvbXBsZXRlID09PSBmYWxzZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgaW1hZ2UgaXMgaW5jb21wbGV0ZScgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJCXJldHVybjsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCAzMzk4NCArIHNsb3QgKTsKCQkJc3RhdGUuYmluZFRleHR1cmUoIDM1NTMsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0VGV4dHVyZTJEQXJyYXkoIHRleHR1cmUsIHNsb3QgKSB7CgoJCQl2YXIgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKCQkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCAzMzk4NCArIHNsb3QgKTsKCQkJc3RhdGUuYmluZFRleHR1cmUoIDM1ODY2LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCXZhciB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgoJCQkJdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCXN0YXRlLmFjdGl2ZVRleHR1cmUoIDMzOTg0ICsgc2xvdCApOwoJCQlzdGF0ZS5iaW5kVGV4dHVyZSggMzI4NzksIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIHNsb3QgKSB7CgoJCQl2YXIgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLmltYWdlLmxlbmd0aCA9PT0gNiApIHsKCgkJCQlpZiAoIHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgoJCQkJCWluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoKCQkJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCAzMzk4NCArIHNsb3QgKTsKCQkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggMzQwNjcsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCQkJCV9nbC5waXhlbFN0b3JlaSggMzc0NDAsIHRleHR1cmUuZmxpcFkgKTsKCgkJCQkJdmFyIGlzQ29tcHJlc3NlZCA9ICggdGV4dHVyZSAmJiB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgKTsKCQkJCQl2YXIgaXNEYXRhVGV4dHVyZSA9ICggdGV4dHVyZS5pbWFnZVsgMCBdICYmIHRleHR1cmUuaW1hZ2VbIDAgXS5pc0RhdGFUZXh0dXJlICk7CgoJCQkJCXZhciBjdWJlSW1hZ2UgPSBbXTsKCgkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJCWN1YmVJbWFnZVsgaSBdID0gcmVzaXplSW1hZ2UoIHRleHR1cmUuaW1hZ2VbIGkgXSwgZmFsc2UsIHRydWUsIGNhcGFiaWxpdGllcy5tYXhDdWJlbWFwU2l6ZSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQljdWJlSW1hZ2VbIGkgXSA9IGlzRGF0YVRleHR1cmUgPyB0ZXh0dXJlLmltYWdlWyBpIF0uaW1hZ2UgOiB0ZXh0dXJlLmltYWdlWyBpIF07CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJdmFyIGltYWdlID0gY3ViZUltYWdlWyAwIF0sCgkJCQkJCXN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byggaW1hZ2UgKSB8fCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIsCgkJCQkJCWdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQgKSwKCQkJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggZ2xGb3JtYXQsIGdsVHlwZSApOwoKCQkJCQlzZXRUZXh0dXJlUGFyYW1ldGVycyggMzQwNjcsIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQkJaWYgKCAhIGlzQ29tcHJlc3NlZCApIHsKCgkJCQkJCQlpZiAoIGlzRGF0YVRleHR1cmUgKSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIDM0MDY5ICsgaSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgY3ViZUltYWdlWyBpIF0ud2lkdGgsIGN1YmVJbWFnZVsgaSBdLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlWyBpIF0uZGF0YSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIDM0MDY5ICsgaSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlWyBpIF0gKTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXZhciBtaXBtYXAsIG1pcG1hcHMgPSBjdWJlSW1hZ2VbIGkgXS5taXBtYXBzOwoKCQkJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBtaXBtYXBzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdGV4dHVyZS5mb3JtYXQgIT09IFJHQkZvcm1hdCApIHsKCgkJCQkJCQkJCWlmICggc3RhdGUuZ2V0Q29tcHJlc3NlZFRleHR1cmVGb3JtYXRzKCkuaW5kZXhPZiggZ2xGb3JtYXQgKSA+IC0gMSApIHsKCgkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UyRCggMzQwNjkgKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC5zZXRUZXh0dXJlQ3ViZSgpJyApOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggMzQwNjkgKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCAhIGlzQ29tcHJlc3NlZCApIHsKCgkJCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fbWF4TWlwTGV2ZWwgPSAwOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IG1pcG1hcHMubGVuZ3RoIC0gMTsKCgkJCQkJfQoKCQkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJCQkvLyBXZSBhc3N1bWUgaW1hZ2VzIGZvciBjdWJlIG1hcCBoYXZlIHRoZSBzYW1lIHNpemUuCgkJCQkJCWdlbmVyYXRlTWlwbWFwKCAzNDA2NywgdGV4dHVyZSwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCQl9CgoJCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHRleHR1cmUudmVyc2lvbjsKCgkJCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXN0YXRlLmFjdGl2ZVRleHR1cmUoIDMzOTg0ICsgc2xvdCApOwoJCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCAzNDA2NywgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0VGV4dHVyZUN1YmVEeW5hbWljKCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJc3RhdGUuYWN0aXZlVGV4dHVyZSggMzM5ODQgKyBzbG90ICk7CgkJCXN0YXRlLmJpbmRUZXh0dXJlKCAzNDA2NywgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgewoKCQkJdmFyIGV4dGVuc2lvbjsKCgkJCWlmICggc3VwcG9ydHNNaXBzICkgewoKCQkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgMTAyNDIsIHV0aWxzLmNvbnZlcnQoIHRleHR1cmUud3JhcFMgKSApOwoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCAxMDI0MywgdXRpbHMuY29udmVydCggdGV4dHVyZS53cmFwVCApICk7CgoJCQkJaWYgKCB0ZXh0dXJlVHlwZSA9PT0gMzI4NzkgfHwgdGV4dHVyZVR5cGUgPT09IDM1ODY2ICkgewoKCQkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIDMyODgyLCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLndyYXBSICkgKTsKCgkJCQl9CgoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCAxMDI0MCwgdXRpbHMuY29udmVydCggdGV4dHVyZS5tYWdGaWx0ZXIgKSApOwoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCAxMDI0MSwgdXRpbHMuY29udmVydCggdGV4dHVyZS5taW5GaWx0ZXIgKSApOwoKCQkJfSBlbHNlIHsKCgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIDEwMjQyLCAzMzA3MSApOwoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCAxMDI0MywgMzMwNzEgKTsKCgkJCQlpZiAoIHRleHR1cmVUeXBlID09PSAzMjg3OSB8fCB0ZXh0dXJlVHlwZSA9PT0gMzU4NjYgKSB7CgoJCQkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgMzI4ODIsIDMzMDcxICk7CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGlzIG5vdCBwb3dlciBvZiB0d28uIFRleHR1cmUud3JhcFMgYW5kIFRleHR1cmUud3JhcFQgc2hvdWxkIGJlIHNldCB0byBUSFJFRS5DbGFtcFRvRWRnZVdyYXBwaW5nLicgKTsKCgkJCQl9CgoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCAxMDI0MCwgZmlsdGVyRmFsbGJhY2soIHRleHR1cmUubWFnRmlsdGVyICkgKTsKCQkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgMTAyNDEsIGZpbHRlckZhbGxiYWNrKCB0ZXh0dXJlLm1pbkZpbHRlciApICk7CgoJCQkJaWYgKCB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdEZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyRmlsdGVyICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGlzIG5vdCBwb3dlciBvZiB0d28uIFRleHR1cmUubWluRmlsdGVyIHNob3VsZCBiZSBzZXQgdG8gVEhSRUUuTmVhcmVzdEZpbHRlciBvciBUSFJFRS5MaW5lYXJGaWx0ZXIuJyApOwoKCQkJCX0KCgkJCX0KCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoKCQkJaWYgKCBleHRlbnNpb24gKSB7CgoJCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmdldCggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKSA9PT0gbnVsbCApIHJldHVybjsKCQkJCWlmICggdGV4dHVyZS50eXBlID09PSBIYWxmRmxvYXRUeXBlICYmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdF9saW5lYXInICkgKSA9PT0gbnVsbCApIHJldHVybjsKCgkJCQlpZiAoIHRleHR1cmUuYW5pc290cm9weSA+IDEgfHwgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ICkgewoKCQkJCQlfZ2wudGV4UGFyYW1ldGVyZiggdGV4dHVyZVR5cGUsIGV4dGVuc2lvbi5URVhUVVJFX01BWF9BTklTT1RST1BZX0VYVCwgTWF0aC5taW4oIHRleHR1cmUuYW5pc290cm9weSwgY2FwYWJpbGl0aWVzLmdldE1heEFuaXNvdHJvcHkoKSApICk7CgkJCQkJcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ID0gdGV4dHVyZS5hbmlzb3Ryb3B5OwoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBpbml0VGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUgKSB7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPSB0cnVlOwoKCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJdmFyIHRleHR1cmVUeXBlID0gMzU1MzsKCgkJCWlmICggdGV4dHVyZS5pc0RhdGFUZXh0dXJlMkRBcnJheSApIHRleHR1cmVUeXBlID0gMzU4NjY7CgkJCWlmICggdGV4dHVyZS5pc0RhdGFUZXh0dXJlM0QgKSB0ZXh0dXJlVHlwZSA9IDMyODc5OwoKCQkJaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICk7CgoJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCAzMzk4NCArIHNsb3QgKTsKCQkJc3RhdGUuYmluZFRleHR1cmUoIHRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQkJX2dsLnBpeGVsU3RvcmVpKCAzNzQ0MCwgdGV4dHVyZS5mbGlwWSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIDM3NDQxLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCAzMzE3LCB0ZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoKCQkJdmFyIG5lZWRzUG93ZXJPZlR3byA9IHRleHR1cmVOZWVkc1Bvd2VyT2ZUd28oIHRleHR1cmUgKSAmJiBpc1Bvd2VyT2ZUd28oIHRleHR1cmUuaW1hZ2UgKSA9PT0gZmFsc2U7CgkJCXZhciBpbWFnZSA9IHJlc2l6ZUltYWdlKCB0ZXh0dXJlLmltYWdlLCBuZWVkc1Bvd2VyT2ZUd28sIGZhbHNlLCBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCgkJCXZhciBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28oIGltYWdlICkgfHwgY2FwYWJpbGl0aWVzLmlzV2ViR0wyLAoJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCApLAoJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQlnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIGdsRm9ybWF0LCBnbFR5cGUgKTsKCgkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzICk7CgoJCQl2YXIgbWlwbWFwLCBtaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKCQkJaWYgKCB0ZXh0dXJlLmlzRGVwdGhUZXh0dXJlICkgewoKCQkJCS8vIHBvcHVsYXRlIGRlcHRoIHRleHR1cmUgd2l0aCBkdW1teSBkYXRhCgoJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IDY0MDI7CgoJCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHRocm93IG5ldyBFcnJvciggJ0Zsb2F0IERlcHRoIFRleHR1cmUgb25seSBzdXBwb3J0ZWQgaW4gV2ViR0wyLjAnICk7CgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IDM2MDEyOwoKCQkJCX0gZWxzZSBpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQkJLy8gV2ViR0wgMi4wIHJlcXVpcmVzIHNpZ25lZCBpbnRlcm5hbGZvcm1hdCBmb3IgZ2xUZXhJbWFnZTJECgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IDMzMTg5OwoKCQkJCX0KCgkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ID09PSBEZXB0aEZvcm1hdCAmJiBnbEludGVybmFsRm9ybWF0ID09PSA2NDAyICkgewoKCQkJCQkvLyBUaGUgZXJyb3IgSU5WQUxJRF9PUEVSQVRJT04gaXMgZ2VuZXJhdGVkIGJ5IHRleEltYWdlMkQgaWYgZm9ybWF0IGFuZCBpbnRlcm5hbGZvcm1hdCBhcmUKCQkJCQkvLyBERVBUSF9DT01QT05FTlQgYW5kIHR5cGUgaXMgbm90IFVOU0lHTkVEX1NIT1JUIG9yIFVOU0lHTkVEX0lOVAoJCQkJCS8vIChodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2RlcHRoX3RleHR1cmUvKQoJCQkJCWlmICggdGV4dHVyZS50eXBlICE9PSBVbnNpZ25lZFNob3J0VHlwZSAmJiB0ZXh0dXJlLnR5cGUgIT09IFVuc2lnbmVkSW50VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVzZSBVbnNpZ25lZFNob3J0VHlwZSBvciBVbnNpZ25lZEludFR5cGUgZm9yIERlcHRoRm9ybWF0IERlcHRoVGV4dHVyZS4nICk7CgoJCQkJCQl0ZXh0dXJlLnR5cGUgPSBVbnNpZ25lZFNob3J0VHlwZTsKCQkJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gRGVwdGggc3RlbmNpbCB0ZXh0dXJlcyBuZWVkIHRoZSBERVBUSF9TVEVOQ0lMIGludGVybmFsIGZvcm1hdAoJCQkJLy8gKGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfZGVwdGhfdGV4dHVyZS8pCgkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgoJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSAzNDA0MTsKCgkJCQkJLy8gVGhlIGVycm9yIElOVkFMSURfT1BFUkFUSU9OIGlzIGdlbmVyYXRlZCBieSB0ZXhJbWFnZTJEIGlmIGZvcm1hdCBhbmQgaW50ZXJuYWxmb3JtYXQgYXJlCgkJCQkJLy8gREVQVEhfU1RFTkNJTCBhbmQgdHlwZSBpcyBub3QgVU5TSUdORURfSU5UXzI0XzhfV0VCR0wuCgkJCQkJLy8gKGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfZGVwdGhfdGV4dHVyZS8pCgkJCQkJaWYgKCB0ZXh0dXJlLnR5cGUgIT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVzZSBVbnNpZ25lZEludDI0OFR5cGUgZm9yIERlcHRoU3RlbmNpbEZvcm1hdCBEZXB0aFRleHR1cmUuJyApOwoKCQkJCQkJdGV4dHVyZS50eXBlID0gVW5zaWduZWRJbnQyNDhUeXBlOwoJCQkJCQlnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlzdGF0ZS50ZXhJbWFnZTJEKCAzNTUzLCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgoJCQkJLy8gdXNlIG1hbnVhbGx5IGNyZWF0ZWQgbWlwbWFwcyBpZiBhdmFpbGFibGUKCQkJCS8vIGlmIHRoZXJlIGFyZSBubyBtYW51YWwgbWlwbWFwcwoJCQkJLy8gc2V0IDAgbGV2ZWwgbWlwbWFwIGFuZCB0aGVuIHVzZSBHTCB0byBnZW5lcmF0ZSBvdGhlciBtaXBtYXAgbGV2ZWxzCgoJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgJiYgc3VwcG9ydHNNaXBzICkgewoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggMzU1MywgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQl9CgoJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgkJCQkJdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IG1pcG1hcHMubGVuZ3RoIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCAzNTUzLCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgkJCQkJdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IDA7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICkgewoKCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdGV4dHVyZS5mb3JtYXQgIT09IFJHQkZvcm1hdCApIHsKCgkJCQkJCWlmICggc3RhdGUuZ2V0Q29tcHJlc3NlZFRleHR1cmVGb3JtYXRzKCkuaW5kZXhPZiggZ2xGb3JtYXQgKSA+IC0gMSApIHsKCgkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UyRCggMzU1MywgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAudXBsb2FkVGV4dHVyZSgpJyApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggMzU1MywgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fbWF4TWlwTGV2ZWwgPSBtaXBtYXBzLmxlbmd0aCAtIDE7CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUyREFycmF5ICkgewoKCQkJCXN0YXRlLnRleEltYWdlM0QoIDM1ODY2LCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IDA7CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUzRCApIHsKCgkJCQlzdGF0ZS50ZXhJbWFnZTNEKCAzMjg3OSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fbWF4TWlwTGV2ZWwgPSAwOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyByZWd1bGFyIFRleHR1cmUgKGltYWdlLCB2aWRlbywgY2FudmFzKQoKCQkJCS8vIHVzZSBtYW51YWxseSBjcmVhdGVkIG1pcG1hcHMgaWYgYXZhaWxhYmxlCgkJCQkvLyBpZiB0aGVyZSBhcmUgbm8gbWFudWFsIG1pcG1hcHMKCQkJCS8vIHNldCAwIGxldmVsIG1pcG1hcCBhbmQgdGhlbiB1c2UgR0wgdG8gZ2VuZXJhdGUgb3RoZXIgbWlwbWFwIGxldmVscwoKCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICYmIHN1cHBvcnRzTWlwcyApIHsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgkJCQkJCXN0YXRlLnRleEltYWdlMkQoIDM1NTMsIGksIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQl9CgoJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgkJCQkJdGV4dHVyZVByb3BlcnRpZXMuX19tYXhNaXBMZXZlbCA9IG1pcG1hcHMubGVuZ3RoIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCAzNTUzLCAwLCBnbEludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoJCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fbWF4TWlwTGV2ZWwgPSAwOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQlnZW5lcmF0ZU1pcG1hcCggMzU1MywgdGV4dHVyZSwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQl9CgoJCS8vIFJlbmRlciB0YXJnZXRzCgoJCS8vIFNldHVwIHN0b3JhZ2UgZm9yIHRhcmdldCB0ZXh0dXJlIGFuZCBiaW5kIGl0IHRvIGNvcnJlY3QgZnJhbWVidWZmZXIKCQlmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCApIHsKCgkJCXZhciBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHJlbmRlclRhcmdldC50ZXh0dXJlLmZvcm1hdCApOwoJCQl2YXIgZ2xUeXBlID0gdXRpbHMuY29udmVydCggcmVuZGVyVGFyZ2V0LnRleHR1cmUudHlwZSApOwoJCQl2YXIgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCBnbEZvcm1hdCwgZ2xUeXBlICk7CgkJCXN0YXRlLnRleEltYWdlMkQoIHRleHR1cmVUYXJnZXQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCApOwoJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgZnJhbWVidWZmZXIgKTsKCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCAzNjE2MCwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIDAgKTsKCQkJX2dsLmJpbmRGcmFtZWJ1ZmZlciggMzYxNjAsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXR1cCBzdG9yYWdlIGZvciBpbnRlcm5hbCBkZXB0aC9zdGVuY2lsIGJ1ZmZlcnMgYW5kIGJpbmQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIGlzTXVsdGlzYW1wbGUgKSB7CgoJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggMzYxNjEsIHJlbmRlcmJ1ZmZlciApOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgISByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciApIHsKCgkJCQlpZiAoIGlzTXVsdGlzYW1wbGUgKSB7CgoJCQkJCXZhciBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIDM2MTYxLCBzYW1wbGVzLCAzMzE4OSwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIDM2MTYxLCAzMzE4OSwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggMzYxNjAsIDM2MDk2LCAzNjE2MSwgcmVuZGVyYnVmZmVyICk7CgoJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgKSB7CgoJCQkJaWYgKCBpc011bHRpc2FtcGxlICkgewoKCQkJCQl2YXIgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCAzNjE2MSwgc2FtcGxlcywgMzQwNDEsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlKCAzNjE2MSwgMzQwNDEsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0KCgoJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCAzNjE2MCwgMzMzMDYsIDM2MTYxLCByZW5kZXJidWZmZXIgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdmFyIGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggcmVuZGVyVGFyZ2V0LnRleHR1cmUuZm9ybWF0ICk7CgkJCQl2YXIgZ2xUeXBlID0gdXRpbHMuY29udmVydCggcmVuZGVyVGFyZ2V0LnRleHR1cmUudHlwZSApOwoJCQkJdmFyIGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggZ2xGb3JtYXQsIGdsVHlwZSApOwoKCQkJCWlmICggaXNNdWx0aXNhbXBsZSApIHsKCgkJCQkJdmFyIHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSggMzYxNjEsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlKCAzNjE2MSwgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJfQoKCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIDM2MTYxLCBudWxsICk7CgoJCX0KCgkJLy8gU2V0dXAgcmVzb3VyY2VzIGZvciBhIERlcHRoIFRleHR1cmUgZm9yIGEgRkJPIChuZWVkcyBhbiBleHRlbnNpb24pCgkJZnVuY3Rpb24gc2V0dXBEZXB0aFRleHR1cmUoIGZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKSB7CgoJCQl2YXIgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXRDdWJlICk7CgkJCWlmICggaXNDdWJlICkgdGhyb3cgbmV3IEVycm9yKCAnRGVwdGggVGV4dHVyZSB3aXRoIGN1YmUgcmVuZGVyIHRhcmdldHMgaXMgbm90IHN1cHBvcnRlZCcgKTsKCgkJCV9nbC5iaW5kRnJhbWVidWZmZXIoIDM2MTYwLCBmcmFtZWJ1ZmZlciApOwoKCQkJaWYgKCAhICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmlzRGVwdGhUZXh0dXJlICkgKSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAncmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIFRIUkVFLkRlcHRoVGV4dHVyZScgKTsKCgkJCX0KCgkJCS8vIHVwbG9hZCBhbiBlbXB0eSBkZXB0aCB0ZXh0dXJlIHdpdGggZnJhbWVidWZmZXIgc2l6ZQoJCQlpZiAoICEgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggIT09IHJlbmRlclRhcmdldC53aWR0aCB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0ICkgewoKCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXNldFRleHR1cmUyRCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSwgMCApOwoKCQkJdmFyIHdlYmdsRGVwdGhUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZTsKCgkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5mb3JtYXQgPT09IERlcHRoRm9ybWF0ICkgewoKCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggMzYxNjAsIDM2MDk2LCAzNTUzLCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5mb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHsKCgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIDM2MTYwLCAzMzMwNiwgMzU1Mywgd2ViZ2xEZXB0aFRleHR1cmUsIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVW5rbm93biBkZXB0aFRleHR1cmUgZm9ybWF0JyApOwoKCQkJfQoKCQl9CgoJCS8vIFNldHVwIEdMIHJlc291cmNlcyBmb3IgYSBub24tdGV4dHVyZSBkZXB0aCBidWZmZXIKCQlmdW5jdGlvbiBzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKSB7CgoJCQl2YXIgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCXZhciBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0Q3ViZSA9PT0gdHJ1ZSApOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkgewoKCQkJCWlmICggaXNDdWJlICkgdGhyb3cgbmV3IEVycm9yKCAndGFyZ2V0LmRlcHRoVGV4dHVyZSBub3Qgc3VwcG9ydGVkIGluIEN1YmUgcmVuZGVyIHRhcmdldHMnICk7CgoJCQkJc2V0dXBEZXB0aFRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID0gW107CgoJCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoJCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkJCQlzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLmJpbmRGcmFtZWJ1ZmZlciggMzYxNjAsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciwgcmVuZGVyVGFyZ2V0ICk7CgoJCQkJfQoKCQkJfQoKCQkJX2dsLmJpbmRGcmFtZWJ1ZmZlciggMzYxNjAsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXQgdXAgR0wgcmVzb3VyY2VzIGZvciB0aGUgcmVuZGVyIHRhcmdldAoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQl2YXIgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQkJdmFyIHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgoJCQlyZW5kZXJUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblJlbmRlclRhcmdldERpc3Bvc2UgKTsKCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKCQkJdmFyIGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXRDdWJlID09PSB0cnVlICk7CgkJCXZhciBpc011bHRpc2FtcGxlID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID09PSB0cnVlICk7CgkJCXZhciBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28oIHJlbmRlclRhcmdldCApIHx8IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKCgkJCS8vIFNldHVwIGZyYW1lYnVmZmVyCgoJCQlpZiAoIGlzQ3ViZSApIHsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IFtdOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgoJCQkJaWYgKCBpc011bHRpc2FtcGxlICkgewoKCQkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoKCQkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIDM2MTYxLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciApOwoJCQkJCQl2YXIgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCByZW5kZXJUYXJnZXQudGV4dHVyZS5mb3JtYXQgKTsKCQkJCQkJdmFyIGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHJlbmRlclRhcmdldC50ZXh0dXJlLnR5cGUgKTsKCQkJCQkJdmFyIGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggZ2xGb3JtYXQsIGdsVHlwZSApOwoJCQkJCQl2YXIgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoJCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCAzNjE2MSwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCAzNjE2MCwgMzYwNjQsIDM2MTYxLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciApOwoJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggMzYxNjEsIG51bGwgKTsKCgkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0cnVlICk7CgoJCQkJCQl9CgoJCQkJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgbnVsbCApOwoKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFdlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIFdlYkdMMi4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvLyBTZXR1cCBjb2xvciBidWZmZXIKCgkJCWlmICggaXNDdWJlICkgewoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCAzNDA2NywgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCAzNDA2NywgcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHN1cHBvcnRzTWlwcyApOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdLCByZW5kZXJUYXJnZXQsIDM2MDY0LCAzNDA2OSArIGkgKTsKCgkJCQl9CgoJCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHJlbmRlclRhcmdldC50ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIDM0MDY3LCByZW5kZXJUYXJnZXQudGV4dHVyZSwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCAzNDA2NywgbnVsbCApOwoKCQkJfSBlbHNlIHsKCgkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggMzU1MywgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCAzNTUzLCByZW5kZXJUYXJnZXQudGV4dHVyZSwgc3VwcG9ydHNNaXBzICk7CgkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgMzYwNjQsIDM1NTMgKTsKCgkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHN1cHBvcnRzTWlwcyApICkgewoKCQkJCQlnZW5lcmF0ZU1pcG1hcCggMzU1MywgcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0KCgkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggMzU1MywgbnVsbCApOwoKCQkJfQoKCQkJLy8gU2V0dXAgZGVwdGggYW5kIHN0ZW5jaWwgYnVmZmVycwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgoJCQkJc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCByZW5kZXJUYXJnZXQgKSB7CgoJCQl2YXIgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoJCQl2YXIgc3VwcG9ydHNNaXBzID0gaXNQb3dlck9mVHdvKCByZW5kZXJUYXJnZXQgKSB8fCBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJdmFyIHRhcmdldCA9IHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0Q3ViZSA/IDM0MDY3IDogMzU1MzsKCQkJCXZhciB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlOwoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0YXJnZXQsIHdlYmdsVGV4dHVyZSApOwoJCQkJZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCwgdGV4dHVyZSwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggdGFyZ2V0LCBudWxsICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCgkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCApIHsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQkJdmFyIHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCV9nbC5iaW5kRnJhbWVidWZmZXIoIDM2MDA4LCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQkJCV9nbC5iaW5kRnJhbWVidWZmZXIoIDM2MDA5LCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoKCQkJCQl2YXIgd2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CgkJCQkJdmFyIGhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CgkJCQkJdmFyIG1hc2sgPSAxNjM4NDsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSBtYXNrIHw9IDI1NjsKCQkJCQlpZiAoIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICkgbWFzayB8PSAxMDI0OwoKCQkJCQlfZ2wuYmxpdEZyYW1lYnVmZmVyKCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCBtYXNrLCA5NzI4ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCBjYW4gb25seSBiZSB1c2VkIHdpdGggV2ViR0wyLicgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICkgewoKCQkJcmV0dXJuICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICYmIHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgKSA/CgkJCQlNYXRoLm1pbiggY2FwYWJpbGl0aWVzLm1heFNhbXBsZXMsIHJlbmRlclRhcmdldC5zYW1wbGVzICkgOiAwOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVZpZGVvVGV4dHVyZSggdGV4dHVyZSApIHsKCgkJCXZhciBpZCA9IHRleHR1cmUuaWQ7CgkJCXZhciBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKCQkJLy8gQ2hlY2sgdGhlIGxhc3QgZnJhbWUgd2UgdXBkYXRlZCB0aGUgVmlkZW9UZXh0dXJlCgoJCQlpZiAoIF92aWRlb1RleHR1cmVzWyBpZCBdICE9PSBmcmFtZSApIHsKCgkJCQlfdmlkZW9UZXh0dXJlc1sgaWQgXSA9IGZyYW1lOwoJCQkJdGV4dHVyZS51cGRhdGUoKTsKCgkJCX0KCgkJfQoKCQl0aGlzLnNldFRleHR1cmUyRCA9IHNldFRleHR1cmUyRDsKCQl0aGlzLnNldFRleHR1cmUyREFycmF5ID0gc2V0VGV4dHVyZTJEQXJyYXk7CgkJdGhpcy5zZXRUZXh0dXJlM0QgPSBzZXRUZXh0dXJlM0Q7CgkJdGhpcy5zZXRUZXh0dXJlQ3ViZSA9IHNldFRleHR1cmVDdWJlOwoJCXRoaXMuc2V0VGV4dHVyZUN1YmVEeW5hbWljID0gc2V0VGV4dHVyZUN1YmVEeW5hbWljOwoJCXRoaXMuc2V0dXBSZW5kZXJUYXJnZXQgPSBzZXR1cFJlbmRlclRhcmdldDsKCQl0aGlzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCA9IHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcDsKCQl0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7CgoJfQoKCS8qKgoJICogQGF1dGhvciB0aGVzcGl0ZSAvIGh0dHA6Ly93d3cudHdpdHRlci5jb20vdGhlc3BpdGUKCSAqLwoKCWZ1bmN0aW9uIFdlYkdMVXRpbHMoIGdsLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKSB7CgoJCWZ1bmN0aW9uIGNvbnZlcnQoIHAgKSB7CgoJCQl2YXIgZXh0ZW5zaW9uOwoKCQkJaWYgKCBwID09PSBSZXBlYXRXcmFwcGluZyApIHJldHVybiAxMDQ5NzsKCQkJaWYgKCBwID09PSBDbGFtcFRvRWRnZVdyYXBwaW5nICkgcmV0dXJuIDMzMDcxOwoJCQlpZiAoIHAgPT09IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcgKSByZXR1cm4gMzM2NDg7CgoJCQlpZiAoIHAgPT09IE5lYXJlc3RGaWx0ZXIgKSByZXR1cm4gOTcyODsKCQkJaWYgKCBwID09PSBOZWFyZXN0TWlwTWFwTmVhcmVzdEZpbHRlciApIHJldHVybiA5OTg0OwoJCQlpZiAoIHAgPT09IE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIgKSByZXR1cm4gOTk4NjsKCgkJCWlmICggcCA9PT0gTGluZWFyRmlsdGVyICkgcmV0dXJuIDk3Mjk7CgkJCWlmICggcCA9PT0gTGluZWFyTWlwTWFwTmVhcmVzdEZpbHRlciApIHJldHVybiA5OTg1OwoJCQlpZiAoIHAgPT09IExpbmVhck1pcE1hcExpbmVhckZpbHRlciApIHJldHVybiA5OTg3OwoKCQkJaWYgKCBwID09PSBVbnNpZ25lZEJ5dGVUeXBlICkgcmV0dXJuIDUxMjE7CgkJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlICkgcmV0dXJuIDMyODE5OwoJCQlpZiAoIHAgPT09IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSApIHJldHVybiAzMjgyMDsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NTY1VHlwZSApIHJldHVybiAzMzYzNTsKCgkJCWlmICggcCA9PT0gQnl0ZVR5cGUgKSByZXR1cm4gNTEyMDsKCQkJaWYgKCBwID09PSBTaG9ydFR5cGUgKSByZXR1cm4gNTEyMjsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHJldHVybiA1MTIzOwoJCQlpZiAoIHAgPT09IEludFR5cGUgKSByZXR1cm4gNTEyNDsKCQkJaWYgKCBwID09PSBVbnNpZ25lZEludFR5cGUgKSByZXR1cm4gNTEyNTsKCQkJaWYgKCBwID09PSBGbG9hdFR5cGUgKSByZXR1cm4gNTEyNjsKCgkJCWlmICggcCA9PT0gSGFsZkZsb2F0VHlwZSApIHsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHJldHVybiA1MTMxOwoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdCcgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHJldHVybiBleHRlbnNpb24uSEFMRl9GTE9BVF9PRVM7CgoJCQl9CgoJCQlpZiAoIHAgPT09IEFscGhhRm9ybWF0ICkgcmV0dXJuIDY0MDY7CgkJCWlmICggcCA9PT0gUkdCRm9ybWF0ICkgcmV0dXJuIDY0MDc7CgkJCWlmICggcCA9PT0gUkdCQUZvcm1hdCApIHJldHVybiA2NDA4OwoJCQlpZiAoIHAgPT09IEx1bWluYW5jZUZvcm1hdCApIHJldHVybiA2NDA5OwoJCQlpZiAoIHAgPT09IEx1bWluYW5jZUFscGhhRm9ybWF0ICkgcmV0dXJuIDY0MTA7CgkJCWlmICggcCA9PT0gRGVwdGhGb3JtYXQgKSByZXR1cm4gNjQwMjsKCQkJaWYgKCBwID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSByZXR1cm4gMzQwNDE7CgkJCWlmICggcCA9PT0gUmVkRm9ybWF0ICkgcmV0dXJuIDY0MDM7CgoJCQlpZiAoIHAgPT09IEFkZEVxdWF0aW9uICkgcmV0dXJuIDMyNzc0OwoJCQlpZiAoIHAgPT09IFN1YnRyYWN0RXF1YXRpb24gKSByZXR1cm4gMzI3Nzg7CgkJCWlmICggcCA9PT0gUmV2ZXJzZVN1YnRyYWN0RXF1YXRpb24gKSByZXR1cm4gMzI3Nzk7CgoJCQlpZiAoIHAgPT09IFplcm9GYWN0b3IgKSByZXR1cm4gMDsKCQkJaWYgKCBwID09PSBPbmVGYWN0b3IgKSByZXR1cm4gMTsKCQkJaWYgKCBwID09PSBTcmNDb2xvckZhY3RvciApIHJldHVybiA3Njg7CgkJCWlmICggcCA9PT0gT25lTWludXNTcmNDb2xvckZhY3RvciApIHJldHVybiA3Njk7CgkJCWlmICggcCA9PT0gU3JjQWxwaGFGYWN0b3IgKSByZXR1cm4gNzcwOwoJCQlpZiAoIHAgPT09IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgKSByZXR1cm4gNzcxOwoJCQlpZiAoIHAgPT09IERzdEFscGhhRmFjdG9yICkgcmV0dXJuIDc3MjsKCQkJaWYgKCBwID09PSBPbmVNaW51c0RzdEFscGhhRmFjdG9yICkgcmV0dXJuIDc3MzsKCgkJCWlmICggcCA9PT0gRHN0Q29sb3JGYWN0b3IgKSByZXR1cm4gNzc0OwoJCQlpZiAoIHAgPT09IE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgKSByZXR1cm4gNzc1OwoJCQlpZiAoIHAgPT09IFNyY0FscGhhU2F0dXJhdGVGYWN0b3IgKSByZXR1cm4gNzc2OwoKCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgfHwKCQkJCXAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDNfRVhUOwoJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0IHx8IHAgPT09IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ180QlBQVjFfSU1HOwoJCQkJCWlmICggcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX1BWUlRDXzJCUFBWMV9JTUc7CgkJCQkJaWYgKCBwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9QVlJUQ180QlBQVjFfSU1HOwoJCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfMkJQUFYxX0lNRzsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMxJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9FVEMxX1dFQkdMOwoKCQkJfQoKCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNHg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCB8fAoJCQkJcCA9PT0gUkdCQV9BU1RDXzZ4NV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4NV9Gb3JtYXQgfHwKCQkJCXAgPT09IFJHQkFfQVNUQ184eDZfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ184eDhfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCB8fAoJCQkJcCA9PT0gUkdCQV9BU1RDXzEweDZfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQgKSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfYXN0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJcmV0dXJuIHA7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBwID09PSBNaW5FcXVhdGlvbiB8fCBwID09PSBNYXhFcXVhdGlvbiApIHsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQkJaWYgKCBwID09PSBNaW5FcXVhdGlvbiApIHJldHVybiAzMjc3NTsKCQkJCQlpZiAoIHAgPT09IE1heEVxdWF0aW9uICkgcmV0dXJuIDMyNzc2OwoKCQkJCX0KCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF9ibGVuZF9taW5tYXgnICk7CgoJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJCWlmICggcCA9PT0gTWluRXF1YXRpb24gKSByZXR1cm4gZXh0ZW5zaW9uLk1JTl9FWFQ7CgkJCQkJaWYgKCBwID09PSBNYXhFcXVhdGlvbiApIHJldHVybiBleHRlbnNpb24uTUFYX0VYVDsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHJldHVybiAzNDA0MjsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2RlcHRoX3RleHR1cmUnICk7CgoJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSByZXR1cm4gZXh0ZW5zaW9uLlVOU0lHTkVEX0lOVF8yNF84X1dFQkdMOwoKCQkJfQoKCQkJcmV0dXJuIDA7CgoJCX0KCgkJcmV0dXJuIHsgY29udmVydDogY29udmVydCB9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBHcm91cCgpIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnR3JvdXAnOwoKCX0KCglHcm91cC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogR3JvdXAsCgoJCWlzR3JvdXA6IHRydWUKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBtaWthZWwgZW10aW5nZXIgLyBodHRwOi8vZ29tby5zZS8KCSAqIEBhdXRob3IgV2VzdExhbmdsZXkgLyBodHRwOi8vZ2l0aHViLmNvbS9XZXN0TGFuZ2xleQoJKi8KCglmdW5jdGlvbiBDYW1lcmEoKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0NhbWVyYSc7CgoJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgl9CgoJQ2FtZXJhLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIE9iamVjdDNELnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBDYW1lcmEsCgoJCWlzQ2FtZXJhOiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJT2JqZWN0M0QucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlLCByZWN1cnNpdmUgKTsKCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHNvdXJjZS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCXRoaXMucHJvamVjdGlvbk1hdHJpeC5jb3B5KCBzb3VyY2UucHJvamVjdGlvbk1hdHJpeCApOwoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldFdvcmxkRGlyZWN0aW9uOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ2FtZXJhOiAuZ2V0V29ybGREaXJlY3Rpb24oKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXRoaXMudXBkYXRlTWF0cml4V29ybGQoIHRydWUgKTsKCgkJCXZhciBlID0gdGhpcy5tYXRyaXhXb3JsZC5lbGVtZW50czsKCgkJCXJldHVybiB0YXJnZXQuc2V0KCAtIGVbIDggXSwgLSBlWyA5IF0sIC0gZVsgMTAgXSApLm5vcm1hbGl6ZSgpOwoKCQl9LAoKCQl1cGRhdGVNYXRyaXhXb3JsZDogZnVuY3Rpb24gKCBmb3JjZSApIHsKCgkJCU9iamVjdDNELnByb3RvdHlwZS51cGRhdGVNYXRyaXhXb3JsZC5jYWxsKCB0aGlzLCBmb3JjZSApOwoKCQkJdGhpcy5tYXRyaXhXb3JsZEludmVyc2UuZ2V0SW52ZXJzZSggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgZ3JlZ2dtYW4gLyBodHRwOi8vZ2FtZXMuZ3JlZ2dtYW4uY29tLwoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL3d3dy5sYWI0Z2FtZXMubmV0L3p6ODUvYmxvZwoJICogQGF1dGhvciB0c2NodwoJICovCgoJZnVuY3Rpb24gUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKSB7CgoJCUNhbWVyYS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdQZXJzcGVjdGl2ZUNhbWVyYSc7CgoJCXRoaXMuZm92ID0gZm92ICE9PSB1bmRlZmluZWQgPyBmb3YgOiA1MDsKCQl0aGlzLnpvb20gPSAxOwoKCQl0aGlzLm5lYXIgPSBuZWFyICE9PSB1bmRlZmluZWQgPyBuZWFyIDogMC4xOwoJCXRoaXMuZmFyID0gZmFyICE9PSB1bmRlZmluZWQgPyBmYXIgOiAyMDAwOwoJCXRoaXMuZm9jdXMgPSAxMDsKCgkJdGhpcy5hc3BlY3QgPSBhc3BlY3QgIT09IHVuZGVmaW5lZCA/IGFzcGVjdCA6IDE7CgkJdGhpcy52aWV3ID0gbnVsbDsKCgkJdGhpcy5maWxtR2F1Z2UgPSAzNTsJLy8gd2lkdGggb2YgdGhlIGZpbG0gKGRlZmF1bHQgaW4gbWlsbGltZXRlcnMpCgkJdGhpcy5maWxtT2Zmc2V0ID0gMDsJLy8gaG9yaXpvbnRhbCBmaWxtIG9mZnNldCAoc2FtZSB1bml0IGFzIGdhdWdlKQoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJUGVyc3BlY3RpdmVDYW1lcmEucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggQ2FtZXJhLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBQZXJzcGVjdGl2ZUNhbWVyYSwKCgkJaXNQZXJzcGVjdGl2ZUNhbWVyYTogdHJ1ZSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCUNhbWVyYS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQkJdGhpcy5mb3YgPSBzb3VyY2UuZm92OwoJCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCgkJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwoJCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgkJCXRoaXMuZm9jdXMgPSBzb3VyY2UuZm9jdXM7CgoJCQl0aGlzLmFzcGVjdCA9IHNvdXJjZS5hc3BlY3Q7CgkJCXRoaXMudmlldyA9IHNvdXJjZS52aWV3ID09PSBudWxsID8gbnVsbCA6IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UudmlldyApOwoKCQkJdGhpcy5maWxtR2F1Z2UgPSBzb3VyY2UuZmlsbUdhdWdlOwoJCQl0aGlzLmZpbG1PZmZzZXQgPSBzb3VyY2UuZmlsbU9mZnNldDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQkvKioKCQkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQgLmZpbG1HYXVnZS4KCQkgKgoJCSAqIFRoZSBkZWZhdWx0IGZpbG0gZ2F1Z2UgaXMgMzUsIHNvIHRoYXQgdGhlIGZvY2FsIGxlbmd0aCBjYW4gYmUgc3BlY2lmaWVkIGZvcgoJCSAqIGEgMzVtbSAoZnVsbCBmcmFtZSkgY2FtZXJhLgoJCSAqCgkJICogVmFsdWVzIGZvciBmb2NhbCBsZW5ndGggYW5kIGZpbG0gZ2F1Z2UgbXVzdCBoYXZlIHRoZSBzYW1lIHVuaXQuCgkJICovCgkJc2V0Rm9jYWxMZW5ndGg6IGZ1bmN0aW9uICggZm9jYWxMZW5ndGggKSB7CgoJCQkvLyBzZWUgaHR0cDovL3d3dy5ib2JhdGtpbnMuY29tL3Bob3RvZ3JhcGh5L3RlY2huaWNhbC9maWVsZF9vZl92aWV3Lmh0bWwKCQkJdmFyIHZFeHRlbnRTbG9wZSA9IDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gZm9jYWxMZW5ndGg7CgoJCQl0aGlzLmZvdiA9IF9NYXRoLlJBRDJERUcgKiAyICogTWF0aC5hdGFuKCB2RXh0ZW50U2xvcGUgKTsKCQkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCX0sCgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IC5mb3YgYW5kIC5maWxtR2F1Z2UuCgkJICovCgkJZ2V0Rm9jYWxMZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2RXh0ZW50U2xvcGUgPSBNYXRoLnRhbiggX01hdGguREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICk7CgoJCQlyZXR1cm4gMC41ICogdGhpcy5nZXRGaWxtSGVpZ2h0KCkgLyB2RXh0ZW50U2xvcGU7CgoJCX0sCgoJCWdldEVmZmVjdGl2ZUZPVjogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9NYXRoLlJBRDJERUcgKiAyICogTWF0aC5hdGFuKAoJCQkJTWF0aC50YW4oIF9NYXRoLkRFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tICk7CgoJCX0sCgoJCWdldEZpbG1XaWR0aDogZnVuY3Rpb24gKCkgewoKCQkJLy8gZmlsbSBub3QgY29tcGxldGVseSBjb3ZlcmVkIGluIHBvcnRyYWl0IGZvcm1hdCAoYXNwZWN0IDwgMSkKCQkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgoJCX0sCgoJCWdldEZpbG1IZWlnaHQ6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBsYW5kc2NhcGUgZm9ybWF0IChhc3BlY3QgPiAxKQoJCQlyZXR1cm4gdGhpcy5maWxtR2F1Z2UgLyBNYXRoLm1heCggdGhpcy5hc3BlY3QsIDEgKTsKCgkJfSwKCgkJLyoqCgkJICogU2V0cyBhbiBvZmZzZXQgaW4gYSBsYXJnZXIgZnJ1c3R1bS4gVGhpcyBpcyB1c2VmdWwgZm9yIG11bHRpLXdpbmRvdyBvcgoJCSAqIG11bHRpLW1vbml0b3IvbXVsdGktbWFjaGluZSBzZXR1cHMuCgkJICoKCQkgKiBGb3IgZXhhbXBsZSwgaWYgeW91IGhhdmUgM3gyIG1vbml0b3JzIGFuZCBlYWNoIG1vbml0b3IgaXMgMTkyMHgxMDgwIGFuZAoJCSAqIHRoZSBtb25pdG9ycyBhcmUgaW4gZ3JpZCBsaWtlIHRoaXMKCQkgKgoJCSAqICAgKy0tLSstLS0rLS0tKwoJCSAqICAgfCBBIHwgQiB8IEMgfAoJCSAqICAgKy0tLSstLS0rLS0tKwoJCSAqICAgfCBEIHwgRSB8IEYgfAoJCSAqICAgKy0tLSstLS0rLS0tKwoJCSAqCgkJICogdGhlbiBmb3IgZWFjaCBtb25pdG9yIHlvdSB3b3VsZCBjYWxsIGl0IGxpa2UgdGhpcwoJCSAqCgkJICogICB2YXIgdyA9IDE5MjA7CgkJICogICB2YXIgaCA9IDEwODA7CgkJICogICB2YXIgZnVsbFdpZHRoID0gdyAqIDM7CgkJICogICB2YXIgZnVsbEhlaWdodCA9IGggKiAyOwoJCSAqCgkJICogICAtLUEtLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAwLCB3LCBoICk7CgkJICogICAtLUItLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDEsIGggKiAwLCB3LCBoICk7CgkJICogICAtLUMtLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAwLCB3LCBoICk7CgkJICogICAtLUQtLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAxLCB3LCBoICk7CgkJICogICAtLUUtLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDEsIGggKiAxLCB3LCBoICk7CgkJICogICAtLUYtLQoJCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAxLCB3LCBoICk7CgkJICoKCQkgKiAgIE5vdGUgdGhlcmUgaXMgbm8gcmVhc29uIG1vbml0b3JzIGhhdmUgdG8gYmUgdGhlIHNhbWUgc2l6ZSBvciBpbiBhIGdyaWQuCgkJICovCgkJc2V0Vmlld09mZnNldDogZnVuY3Rpb24gKCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQl0aGlzLmFzcGVjdCA9IGZ1bGxXaWR0aCAvIGZ1bGxIZWlnaHQ7CgoJCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcgPSB7CgkJCQkJZW5hYmxlZDogdHJ1ZSwKCQkJCQlmdWxsV2lkdGg6IDEsCgkJCQkJZnVsbEhlaWdodDogMSwKCQkJCQlvZmZzZXRYOiAwLAoJCQkJCW9mZnNldFk6IDAsCgkJCQkJd2lkdGg6IDEsCgkJCQkJaGVpZ2h0OiAxCgkJCQl9OwoKCQkJfQoKCQkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwoJCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwoJCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJCXRoaXMudmlldy5vZmZzZXRYID0geDsKCQkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwoJCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9LAoKCQljbGVhclZpZXdPZmZzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKCQkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfSwKCgkJdXBkYXRlUHJvamVjdGlvbk1hdHJpeDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG5lYXIgPSB0aGlzLm5lYXIsCgkJCQl0b3AgPSBuZWFyICogTWF0aC50YW4oIF9NYXRoLkRFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tLAoJCQkJaGVpZ2h0ID0gMiAqIHRvcCwKCQkJCXdpZHRoID0gdGhpcy5hc3BlY3QgKiBoZWlnaHQsCgkJCQlsZWZ0ID0gLSAwLjUgKiB3aWR0aCwKCQkJCXZpZXcgPSB0aGlzLnZpZXc7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCgkJCQl2YXIgZnVsbFdpZHRoID0gdmlldy5mdWxsV2lkdGgsCgkJCQkJZnVsbEhlaWdodCA9IHZpZXcuZnVsbEhlaWdodDsKCgkJCQlsZWZ0ICs9IHZpZXcub2Zmc2V0WCAqIHdpZHRoIC8gZnVsbFdpZHRoOwoJCQkJdG9wIC09IHZpZXcub2Zmc2V0WSAqIGhlaWdodCAvIGZ1bGxIZWlnaHQ7CgkJCQl3aWR0aCAqPSB2aWV3LndpZHRoIC8gZnVsbFdpZHRoOwoJCQkJaGVpZ2h0ICo9IHZpZXcuaGVpZ2h0IC8gZnVsbEhlaWdodDsKCgkJCX0KCgkJCXZhciBza2V3ID0gdGhpcy5maWxtT2Zmc2V0OwoJCQlpZiAoIHNrZXcgIT09IDAgKSBsZWZ0ICs9IG5lYXIgKiBza2V3IC8gdGhpcy5nZXRGaWxtV2lkdGgoKTsKCgkJCXRoaXMucHJvamVjdGlvbk1hdHJpeC5tYWtlUGVyc3BlY3RpdmUoIGxlZnQsIGxlZnQgKyB3aWR0aCwgdG9wLCB0b3AgLSBoZWlnaHQsIG5lYXIsIHRoaXMuZmFyICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmdldEludmVyc2UoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggbWV0YSApIHsKCgkJCXZhciBkYXRhID0gT2JqZWN0M0QucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzLCBtZXRhICk7CgoJCQlkYXRhLm9iamVjdC5mb3YgPSB0aGlzLmZvdjsKCQkJZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKCgkJCWRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CgkJCWRhdGEub2JqZWN0LmZhciA9IHRoaXMuZmFyOwoJCQlkYXRhLm9iamVjdC5mb2N1cyA9IHRoaXMuZm9jdXM7CgoJCQlkYXRhLm9iamVjdC5hc3BlY3QgPSB0aGlzLmFzcGVjdDsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCgkJCWRhdGEub2JqZWN0LmZpbG1HYXVnZSA9IHRoaXMuZmlsbUdhdWdlOwoJCQlkYXRhLm9iamVjdC5maWxtT2Zmc2V0ID0gdGhpcy5maWxtT2Zmc2V0OwoKCQkJcmV0dXJuIGRhdGE7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gQXJyYXlDYW1lcmEoIGFycmF5ICkgewoKCQlQZXJzcGVjdGl2ZUNhbWVyYS5jYWxsKCB0aGlzICk7CgoJCXRoaXMuY2FtZXJhcyA9IGFycmF5IHx8IFtdOwoKCX0KCglBcnJheUNhbWVyYS5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBQZXJzcGVjdGl2ZUNhbWVyYS5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogQXJyYXlDYW1lcmEsCgoJCWlzQXJyYXlDYW1lcmE6IHRydWUKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGpzYW50ZWxsIC8gaHR0cHM6Ly93d3cuanNhbnRlbGwuY29tLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCXZhciBjYW1lcmFMUG9zID0gbmV3IFZlY3RvcjMoKTsKCXZhciBjYW1lcmFSUG9zID0gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIEFzc3VtZXMgMiBjYW1lcmFzIHRoYXQgYXJlIHBhcmFsbGVsIGFuZCBzaGFyZSBhbiBYLWF4aXMsIGFuZCB0aGF0CgkgKiB0aGUgY2FtZXJhcycgcHJvamVjdGlvbiBhbmQgd29ybGQgbWF0cmljZXMgaGF2ZSBhbHJlYWR5IGJlZW4gc2V0LgoJICogQW5kIHRoYXQgbmVhciBhbmQgZmFyIHBsYW5lcyBhcmUgaWRlbnRpY2FsIGZvciBib3RoIGNhbWVyYXMuCgkgKiBWaXN1YWxpemF0aW9uIG9mIHRoaXMgdGVjaG5pcXVlOiBodHRwczovL2NvbXB1dGVyZ3JhcGhpY3Muc3RhY2tleGNoYW5nZS5jb20vYS80NzY1CgkgKi8KCWZ1bmN0aW9uIHNldFByb2plY3Rpb25Gcm9tVW5pb24oIGNhbWVyYSwgY2FtZXJhTCwgY2FtZXJhUiApIHsKCgkJY2FtZXJhTFBvcy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGNhbWVyYUwubWF0cml4V29ybGQgKTsKCQljYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhUi5tYXRyaXhXb3JsZCApOwoKCQl2YXIgaXBkID0gY2FtZXJhTFBvcy5kaXN0YW5jZVRvKCBjYW1lcmFSUG9zICk7CgoJCXZhciBwcm9qTCA9IGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKCQl2YXIgcHJvalIgPSBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgoJCS8vIFZSIHN5c3RlbXMgd2lsbCBoYXZlIGlkZW50aWNhbCBmYXIgYW5kIG5lYXIgcGxhbmVzLCBhbmQKCQkvLyBtb3N0IGxpa2VseSBpZGVudGljYWwgdG9wIGFuZCBib3R0b20gZnJ1c3R1bSBleHRlbnRzLgoJCS8vIFVzZSB0aGUgbGVmdCBjYW1lcmEgZm9yIHRoZXNlIHZhbHVlcy4KCQl2YXIgbmVhciA9IHByb2pMWyAxNCBdIC8gKCBwcm9qTFsgMTAgXSAtIDEgKTsKCQl2YXIgZmFyID0gcHJvakxbIDE0IF0gLyAoIHByb2pMWyAxMCBdICsgMSApOwoJCXZhciB0b3BGb3YgPSAoIHByb2pMWyA5IF0gKyAxICkgLyBwcm9qTFsgNSBdOwoJCXZhciBib3R0b21Gb3YgPSAoIHByb2pMWyA5IF0gLSAxICkgLyBwcm9qTFsgNSBdOwoKCQl2YXIgbGVmdEZvdiA9ICggcHJvakxbIDggXSAtIDEgKSAvIHByb2pMWyAwIF07CgkJdmFyIHJpZ2h0Rm92ID0gKCBwcm9qUlsgOCBdICsgMSApIC8gcHJvalJbIDAgXTsKCQl2YXIgbGVmdCA9IG5lYXIgKiBsZWZ0Rm92OwoJCXZhciByaWdodCA9IG5lYXIgKiByaWdodEZvdjsKCgkJLy8gQ2FsY3VsYXRlIHRoZSBuZXcgY2FtZXJhJ3MgcG9zaXRpb24gb2Zmc2V0IGZyb20gdGhlCgkJLy8gbGVmdCBjYW1lcmEuIHhPZmZzZXQgc2hvdWxkIGJlIHJvdWdobHkgaGFsZiBgaXBkYC4KCQl2YXIgek9mZnNldCA9IGlwZCAvICggLSBsZWZ0Rm92ICsgcmlnaHRGb3YgKTsKCQl2YXIgeE9mZnNldCA9IHpPZmZzZXQgKiAtIGxlZnRGb3Y7CgoJCS8vIFRPRE86IEJldHRlciB3YXkgdG8gYXBwbHkgdGhpcyBvZmZzZXQ/CgkJY2FtZXJhTC5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCWNhbWVyYS50cmFuc2xhdGVYKCB4T2Zmc2V0ICk7CgkJY2FtZXJhLnRyYW5zbGF0ZVooIHpPZmZzZXQgKTsKCQljYW1lcmEubWF0cml4V29ybGQuY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CgkJY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZS5nZXRJbnZlcnNlKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgkJLy8gRmluZCB0aGUgdW5pb24gb2YgdGhlIGZydXN0dW0gdmFsdWVzIG9mIHRoZSBjYW1lcmFzIGFuZCBzY2FsZQoJCS8vIHRoZSB2YWx1ZXMgc28gdGhhdCB0aGUgbmVhciBwbGFuZSdzIHBvc2l0aW9uIGRvZXMgbm90IGNoYW5nZSBpbiB3b3JsZCBzcGFjZSwKCQkvLyBhbHRob3VnaCBtdXN0IG5vdyBiZSByZWxhdGl2ZSB0byB0aGUgbmV3IHVuaW9uIGNhbWVyYS4KCQl2YXIgbmVhcjIgPSBuZWFyICsgek9mZnNldDsKCQl2YXIgZmFyMiA9IGZhciArIHpPZmZzZXQ7CgkJdmFyIGxlZnQyID0gbGVmdCAtIHhPZmZzZXQ7CgkJdmFyIHJpZ2h0MiA9IHJpZ2h0ICsgKCBpcGQgLSB4T2Zmc2V0ICk7CgkJdmFyIHRvcDIgPSB0b3BGb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CgkJdmFyIGJvdHRvbTIgPSBib3R0b21Gb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CgoJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZSggbGVmdDIsIHJpZ2h0MiwgdG9wMiwgYm90dG9tMiwgbmVhcjIsIGZhcjIgKTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gV2ViVlJNYW5hZ2VyKCByZW5kZXJlciApIHsKCgkJdmFyIHNjb3BlID0gdGhpczsKCgkJdmFyIGRldmljZSA9IG51bGw7CgkJdmFyIGZyYW1lRGF0YSA9IG51bGw7CgoJCXZhciBwb3NlVGFyZ2V0ID0gbnVsbDsKCgkJdmFyIGNvbnRyb2xsZXJzID0gW107CgkJdmFyIHN0YW5kaW5nTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQl2YXIgc3RhbmRpbmdNYXRyaXhJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgkJdmFyIGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSAxLjA7CgoJCXZhciBmcmFtZU9mUmVmZXJlbmNlVHlwZSA9ICdzdGFnZSc7CgoJCWlmICggdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgJ1ZSRnJhbWVEYXRhJyBpbiB3aW5kb3cgKSB7CgoJCQlmcmFtZURhdGEgPSBuZXcgd2luZG93LlZSRnJhbWVEYXRhKCk7CgkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSwgZmFsc2UgKTsKCgkJfQoKCQl2YXIgbWF0cml4V29ybGRJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCQl2YXIgdGVtcFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoJCXZhciB0ZW1wUG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoKCQl2YXIgY2FtZXJhTCA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCWNhbWVyYUwuYm91bmRzID0gbmV3IFZlY3RvcjQoIDAuMCwgMC4wLCAwLjUsIDEuMCApOwoJCWNhbWVyYUwubGF5ZXJzLmVuYWJsZSggMSApOwoKCQl2YXIgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCWNhbWVyYVIuYm91bmRzID0gbmV3IFZlY3RvcjQoIDAuNSwgMC4wLCAwLjUsIDEuMCApOwoJCWNhbWVyYVIubGF5ZXJzLmVuYWJsZSggMiApOwoKCQl2YXIgY2FtZXJhVlIgPSBuZXcgQXJyYXlDYW1lcmEoIFsgY2FtZXJhTCwgY2FtZXJhUiBdICk7CgkJY2FtZXJhVlIubGF5ZXJzLmVuYWJsZSggMSApOwoJCWNhbWVyYVZSLmxheWVycy5lbmFibGUoIDIgKTsKCgkJLy8KCgkJZnVuY3Rpb24gaXNQcmVzZW50aW5nKCkgewoKCQkJcmV0dXJuIGRldmljZSAhPT0gbnVsbCAmJiBkZXZpY2UuaXNQcmVzZW50aW5nID09PSB0cnVlOwoKCQl9CgoJCXZhciBjdXJyZW50U2l6ZSA9IG5ldyBWZWN0b3IyKCksIGN1cnJlbnRQaXhlbFJhdGlvOwoKCQlmdW5jdGlvbiBvblZSRGlzcGxheVByZXNlbnRDaGFuZ2UoKSB7CgoJCQl1cGRhdGVEcmF3aW5nQnVmZmVyU2l6ZSgpOwoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIHsKCgkJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJCX0gZWxzZSB7CgoJCQkJYW5pbWF0aW9uLnN0b3AoKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQl2YXIgdHJpZ2dlcnMgPSBbXTsKCgkJZnVuY3Rpb24gZmluZEdhbWVwYWQoIGlkICkgewoKCQkJdmFyIGdhbWVwYWRzID0gbmF2aWdhdG9yLmdldEdhbWVwYWRzICYmIG5hdmlnYXRvci5nZXRHYW1lcGFkcygpOwoKCQkJZm9yICggdmFyIGkgPSAwLCBqID0gMCwgbCA9IGdhbWVwYWRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGdhbWVwYWQgPSBnYW1lcGFkc1sgaSBdOwoKCQkJCWlmICggZ2FtZXBhZCAmJiAoIGdhbWVwYWQuaWQgPT09ICdEYXlkcmVhbSBDb250cm9sbGVyJyB8fAoJCQkJCWdhbWVwYWQuaWQgPT09ICdHZWFyIFZSIENvbnRyb2xsZXInIHx8IGdhbWVwYWQuaWQgPT09ICdPY3VsdXMgR28gQ29udHJvbGxlcicgfHwKCQkJCQlnYW1lcGFkLmlkID09PSAnT3BlblZSIEdhbWVwYWQnIHx8IGdhbWVwYWQuaWQuc3RhcnRzV2l0aCggJ09jdWx1cyBUb3VjaCcgKSB8fAoJCQkJCWdhbWVwYWQuaWQuc3RhcnRzV2l0aCggJ1NwYXRpYWwgQ29udHJvbGxlcicgKSApICkgewoKCQkJCQlpZiAoIGogPT09IGlkICkgcmV0dXJuIGdhbWVwYWQ7CgoJCQkJCWogKys7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZURyYXdpbmdCdWZmZXJTaXplKCkgewoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIHsKCgkJCQl2YXIgZXllUGFyYW1ldGVycyA9IGRldmljZS5nZXRFeWVQYXJhbWV0ZXJzKCAnbGVmdCcgKTsKCQkJCXZhciByZW5kZXJXaWR0aCA9IGV5ZVBhcmFtZXRlcnMucmVuZGVyV2lkdGggKiBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yOwoJCQkJdmFyIHJlbmRlckhlaWdodCA9IGV5ZVBhcmFtZXRlcnMucmVuZGVySGVpZ2h0ICogZnJhbWVidWZmZXJTY2FsZUZhY3RvcjsKCgkJCQlyZW5kZXJlci5zZXREcmF3aW5nQnVmZmVyU2l6ZSggcmVuZGVyV2lkdGggKiAyLCByZW5kZXJIZWlnaHQsIDEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBzY29wZS5lbmFibGVkICkgewoKCQkJCQljdXJyZW50UGl4ZWxSYXRpbyA9IHJlbmRlcmVyLmdldFBpeGVsUmF0aW8oKTsKCQkJCQlyZW5kZXJlci5nZXRTaXplKCBjdXJyZW50U2l6ZSApOwoKCQkJCQlyZW5kZXJlci5zZXREcmF3aW5nQnVmZmVyU2l6ZSggY3VycmVudFNpemUud2lkdGgsIGN1cnJlbnRTaXplLmhlaWdodCwgY3VycmVudFBpeGVsUmF0aW8gKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlQ29udHJvbGxlcnMoKSB7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKCQkJCXZhciBnYW1lcGFkID0gZmluZEdhbWVwYWQoIGkgKTsKCgkJCQlpZiAoIGdhbWVwYWQgIT09IHVuZGVmaW5lZCAmJiBnYW1lcGFkLnBvc2UgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaWYgKCBnYW1lcGFkLnBvc2UgPT09IG51bGwgKSByZXR1cm47CgoJCQkJCS8vICBQb3NlCgoJCQkJCXZhciBwb3NlID0gZ2FtZXBhZC5wb3NlOwoKCQkJCQlpZiAoIHBvc2UuaGFzUG9zaXRpb24gPT09IGZhbHNlICkgY29udHJvbGxlci5wb3NpdGlvbi5zZXQoIDAuMiwgLSAwLjYsIC0gMC4wNSApOwoKCQkJCQlpZiAoIHBvc2UucG9zaXRpb24gIT09IG51bGwgKSBjb250cm9sbGVyLnBvc2l0aW9uLmZyb21BcnJheSggcG9zZS5wb3NpdGlvbiApOwoJCQkJCWlmICggcG9zZS5vcmllbnRhdGlvbiAhPT0gbnVsbCApIGNvbnRyb2xsZXIucXVhdGVybmlvbi5mcm9tQXJyYXkoIHBvc2Uub3JpZW50YXRpb24gKTsKCQkJCQljb250cm9sbGVyLm1hdHJpeC5jb21wb3NlKCBjb250cm9sbGVyLnBvc2l0aW9uLCBjb250cm9sbGVyLnF1YXRlcm5pb24sIGNvbnRyb2xsZXIuc2NhbGUgKTsKCQkJCQljb250cm9sbGVyLm1hdHJpeC5wcmVtdWx0aXBseSggc3RhbmRpbmdNYXRyaXggKTsKCQkJCQljb250cm9sbGVyLm1hdHJpeC5kZWNvbXBvc2UoIGNvbnRyb2xsZXIucG9zaXRpb24sIGNvbnRyb2xsZXIucXVhdGVybmlvbiwgY29udHJvbGxlci5zY2FsZSApOwoJCQkJCWNvbnRyb2xsZXIubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJY29udHJvbGxlci52aXNpYmxlID0gdHJ1ZTsKCgkJCQkJLy8gIFRyaWdnZXIKCgkJCQkJdmFyIGJ1dHRvbklkID0gZ2FtZXBhZC5pZCA9PT0gJ0RheWRyZWFtIENvbnRyb2xsZXInID8gMCA6IDE7CgoJCQkJCWlmICggdHJpZ2dlcnNbIGkgXSAhPT0gZ2FtZXBhZC5idXR0b25zWyBidXR0b25JZCBdLnByZXNzZWQgKSB7CgoJCQkJCQl0cmlnZ2Vyc1sgaSBdID0gZ2FtZXBhZC5idXR0b25zWyBidXR0b25JZCBdLnByZXNzZWQ7CgoJCQkJCQlpZiAoIHRyaWdnZXJzWyBpIF0gPT09IHRydWUgKSB7CgoJCQkJCQkJY29udHJvbGxlci5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZWxlY3RzdGFydCcgfSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQljb250cm9sbGVyLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ3NlbGVjdGVuZCcgfSApOwoJCQkJCQkJY29udHJvbGxlci5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZWxlY3QnIH0gKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWNvbnRyb2xsZXIudmlzaWJsZSA9IGZhbHNlOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvLwoKCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJdGhpcy5nZXRDb250cm9sbGVyID0gZnVuY3Rpb24gKCBpZCApIHsKCgkJCXZhciBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGlkIF07CgoJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb250cm9sbGVyID0gbmV3IEdyb3VwKCk7CgkJCQljb250cm9sbGVyLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCWNvbnRyb2xsZXIudmlzaWJsZSA9IGZhbHNlOwoKCQkJCWNvbnRyb2xsZXJzWyBpZCBdID0gY29udHJvbGxlcjsKCgkJCX0KCgkJCXJldHVybiBjb250cm9sbGVyOwoKCQl9OwoKCQl0aGlzLmdldERldmljZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBkZXZpY2U7CgoJCX07CgoJCXRoaXMuc2V0RGV2aWNlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIGRldmljZSA9IHZhbHVlOwoKCQkJYW5pbWF0aW9uLnNldENvbnRleHQoIHZhbHVlICk7CgoJCQl1cGRhdGVEcmF3aW5nQnVmZmVyU2l6ZSgpOwoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIGFuaW1hdGlvbi5zdGFydCgpOwoKCQl9OwoKCQl0aGlzLnNldEZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJZnJhbWVidWZmZXJTY2FsZUZhY3RvciA9IHZhbHVlOwoKCQl9OwoKCQl0aGlzLnNldEZyYW1lT2ZSZWZlcmVuY2VUeXBlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWZyYW1lT2ZSZWZlcmVuY2VUeXBlID0gdmFsdWU7CgoJCX07CgoJCXRoaXMuc2V0UG9zZVRhcmdldCA9IGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHBvc2VUYXJnZXQgPSBvYmplY3Q7CgoJCX07CgoJCXRoaXMuZ2V0Q2FtZXJhID0gZnVuY3Rpb24gKCBjYW1lcmEgKSB7CgoJCQl2YXIgdXNlckhlaWdodCA9IGZyYW1lT2ZSZWZlcmVuY2VUeXBlID09PSAnc3RhZ2UnID8gMS42IDogMDsKCgkJCWlmICggaXNQcmVzZW50aW5nKCkgPT09IGZhbHNlICkgewoKCQkJCWNhbWVyYS5wb3NpdGlvbi5zZXQoIDAsIHVzZXJIZWlnaHQsIDAgKTsKCQkJCWNhbWVyYS5yb3RhdGlvbi5zZXQoIDAsIDAsIDAgKTsKCgkJCQlyZXR1cm4gY2FtZXJhOwoKCQkJfQoKCQkJZGV2aWNlLmRlcHRoTmVhciA9IGNhbWVyYS5uZWFyOwoJCQlkZXZpY2UuZGVwdGhGYXIgPSBjYW1lcmEuZmFyOwoKCQkJZGV2aWNlLmdldEZyYW1lRGF0YSggZnJhbWVEYXRhICk7CgoJCQkvLwoKCQkJaWYgKCBmcmFtZU9mUmVmZXJlbmNlVHlwZSA9PT0gJ3N0YWdlJyApIHsKCgkJCQl2YXIgc3RhZ2VQYXJhbWV0ZXJzID0gZGV2aWNlLnN0YWdlUGFyYW1ldGVyczsKCgkJCQlpZiAoIHN0YWdlUGFyYW1ldGVycyApIHsKCgkJCQkJc3RhbmRpbmdNYXRyaXguZnJvbUFycmF5KCBzdGFnZVBhcmFtZXRlcnMuc2l0dGluZ1RvU3RhbmRpbmdUcmFuc2Zvcm0gKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzdGFuZGluZ01hdHJpeC5tYWtlVHJhbnNsYXRpb24oIDAsIHVzZXJIZWlnaHQsIDAgKTsKCgkJCQl9CgoJCQl9CgoKCQkJdmFyIHBvc2UgPSBmcmFtZURhdGEucG9zZTsKCQkJdmFyIHBvc2VPYmplY3QgPSBwb3NlVGFyZ2V0ICE9PSBudWxsID8gcG9zZVRhcmdldCA6IGNhbWVyYTsKCgkJCS8vIFdlIHdhbnQgdG8gbWFuaXB1bGF0ZSBwb3NlT2JqZWN0IGJ5IGl0cyBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbiBjb21wb25lbnRzIHNpbmNlIHVzZXJzIG1heSByZWx5IG9uIHRoZW0uCgkJCXBvc2VPYmplY3QubWF0cml4LmNvcHkoIHN0YW5kaW5nTWF0cml4ICk7CgkJCXBvc2VPYmplY3QubWF0cml4LmRlY29tcG9zZSggcG9zZU9iamVjdC5wb3NpdGlvbiwgcG9zZU9iamVjdC5xdWF0ZXJuaW9uLCBwb3NlT2JqZWN0LnNjYWxlICk7CgoJCQlpZiAoIHBvc2Uub3JpZW50YXRpb24gIT09IG51bGwgKSB7CgoJCQkJdGVtcFF1YXRlcm5pb24uZnJvbUFycmF5KCBwb3NlLm9yaWVudGF0aW9uICk7CgkJCQlwb3NlT2JqZWN0LnF1YXRlcm5pb24ubXVsdGlwbHkoIHRlbXBRdWF0ZXJuaW9uICk7CgoJCQl9CgoJCQlpZiAoIHBvc2UucG9zaXRpb24gIT09IG51bGwgKSB7CgoJCQkJdGVtcFF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBzdGFuZGluZ01hdHJpeCApOwoJCQkJdGVtcFBvc2l0aW9uLmZyb21BcnJheSggcG9zZS5wb3NpdGlvbiApOwoJCQkJdGVtcFBvc2l0aW9uLmFwcGx5UXVhdGVybmlvbiggdGVtcFF1YXRlcm5pb24gKTsKCQkJCXBvc2VPYmplY3QucG9zaXRpb24uYWRkKCB0ZW1wUG9zaXRpb24gKTsKCgkJCX0KCgkJCXBvc2VPYmplY3QudXBkYXRlTWF0cml4V29ybGQoKTsKCgkJCS8vCgoJCQljYW1lcmFMLm5lYXIgPSBjYW1lcmEubmVhcjsKCQkJY2FtZXJhUi5uZWFyID0gY2FtZXJhLm5lYXI7CgoJCQljYW1lcmFMLmZhciA9IGNhbWVyYS5mYXI7CgkJCWNhbWVyYVIuZmFyID0gY2FtZXJhLmZhcjsKCgkJCWNhbWVyYUwubWF0cml4V29ybGRJbnZlcnNlLmZyb21BcnJheSggZnJhbWVEYXRhLmxlZnRWaWV3TWF0cml4ICk7CgkJCWNhbWVyYVIubWF0cml4V29ybGRJbnZlcnNlLmZyb21BcnJheSggZnJhbWVEYXRhLnJpZ2h0Vmlld01hdHJpeCApOwoKCQkJLy8gVE9ETyAobXJkb29iKSBEb3VibGUgY2hlY2sgdGhpcyBjb2RlCgoJCQlzdGFuZGluZ01hdHJpeEludmVyc2UuZ2V0SW52ZXJzZSggc3RhbmRpbmdNYXRyaXggKTsKCgkJCWlmICggZnJhbWVPZlJlZmVyZW5jZVR5cGUgPT09ICdzdGFnZScgKSB7CgoJCQkJY2FtZXJhTC5tYXRyaXhXb3JsZEludmVyc2UubXVsdGlwbHkoIHN0YW5kaW5nTWF0cml4SW52ZXJzZSApOwoJCQkJY2FtZXJhUi5tYXRyaXhXb3JsZEludmVyc2UubXVsdGlwbHkoIHN0YW5kaW5nTWF0cml4SW52ZXJzZSApOwoKCQkJfQoKCQkJdmFyIHBhcmVudCA9IHBvc2VPYmplY3QucGFyZW50OwoKCQkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJbWF0cml4V29ybGRJbnZlcnNlLmdldEludmVyc2UoIHBhcmVudC5tYXRyaXhXb3JsZCApOwoKCQkJCWNhbWVyYUwubWF0cml4V29ybGRJbnZlcnNlLm11bHRpcGx5KCBtYXRyaXhXb3JsZEludmVyc2UgKTsKCQkJCWNhbWVyYVIubWF0cml4V29ybGRJbnZlcnNlLm11bHRpcGx5KCBtYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCX0KCgkJCS8vIGVudk1hcCBhbmQgTWlycm9yIG5lZWRzIGNhbWVyYS5tYXRyaXhXb3JsZAoKCQkJY2FtZXJhTC5tYXRyaXhXb3JsZC5nZXRJbnZlcnNlKCBjYW1lcmFMLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoJCQljYW1lcmFSLm1hdHJpeFdvcmxkLmdldEludmVyc2UoIGNhbWVyYVIubWF0cml4V29ybGRJbnZlcnNlICk7CgoJCQljYW1lcmFMLnByb2plY3Rpb25NYXRyaXguZnJvbUFycmF5KCBmcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXggKTsKCQkJY2FtZXJhUi5wcm9qZWN0aW9uTWF0cml4LmZyb21BcnJheSggZnJhbWVEYXRhLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCApOwoKCQkJc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhVlIsIGNhbWVyYUwsIGNhbWVyYVIgKTsKCgkJCS8vCgoJCQl2YXIgbGF5ZXJzID0gZGV2aWNlLmdldExheWVycygpOwoKCQkJaWYgKCBsYXllcnMubGVuZ3RoICkgewoKCQkJCXZhciBsYXllciA9IGxheWVyc1sgMCBdOwoKCQkJCWlmICggbGF5ZXIubGVmdEJvdW5kcyAhPT0gbnVsbCAmJiBsYXllci5sZWZ0Qm91bmRzLmxlbmd0aCA9PT0gNCApIHsKCgkJCQkJY2FtZXJhTC5ib3VuZHMuZnJvbUFycmF5KCBsYXllci5sZWZ0Qm91bmRzICk7CgoJCQkJfQoKCQkJCWlmICggbGF5ZXIucmlnaHRCb3VuZHMgIT09IG51bGwgJiYgbGF5ZXIucmlnaHRCb3VuZHMubGVuZ3RoID09PSA0ICkgewoKCQkJCQljYW1lcmFSLmJvdW5kcy5mcm9tQXJyYXkoIGxheWVyLnJpZ2h0Qm91bmRzICk7CgoJCQkJfQoKCQkJfQoKCQkJdXBkYXRlQ29udHJvbGxlcnMoKTsKCgkJCXJldHVybiBjYW1lcmFWUjsKCgkJfTsKCgkJdGhpcy5nZXRTdGFuZGluZ01hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBzdGFuZGluZ01hdHJpeDsKCgkJfTsKCgkJdGhpcy5pc1ByZXNlbnRpbmcgPSBpc1ByZXNlbnRpbmc7CgoJCS8vIEFuaW1hdGlvbiBMb29wCgoJCXZhciBhbmltYXRpb24gPSBuZXcgV2ViR0xBbmltYXRpb24oKTsKCgkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCWFuaW1hdGlvbi5zZXRBbmltYXRpb25Mb29wKCBjYWxsYmFjayApOwoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIGFuaW1hdGlvbi5zdGFydCgpOwoKCQl9OwoKCQl0aGlzLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKCkgewoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIGRldmljZS5zdWJtaXRGcmFtZSgpOwoKCQl9OwoKCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICkgewoKCQkJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSApOwoKCQkJfQoKCQl9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBXZWJYUk1hbmFnZXIoIHJlbmRlcmVyICkgewoKCQl2YXIgZ2wgPSByZW5kZXJlci5jb250ZXh0OwoKCQl2YXIgZGV2aWNlID0gbnVsbDsKCQl2YXIgc2Vzc2lvbiA9IG51bGw7CgoJCXZhciBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKCQl2YXIgZnJhbWVPZlJlZmVyZW5jZSA9IG51bGw7CgkJdmFyIGZyYW1lT2ZSZWZlcmVuY2VUeXBlID0gJ3N0YWdlJzsKCgkJdmFyIHBvc2UgPSBudWxsOwoJCXZhciBwb3NlVGFyZ2V0ID0gbnVsbDsKCgkJdmFyIGNvbnRyb2xsZXJzID0gW107CgkJdmFyIGlucHV0U291cmNlcyA9IFtdOwoKCQlmdW5jdGlvbiBpc1ByZXNlbnRpbmcoKSB7CgoJCQlyZXR1cm4gc2Vzc2lvbiAhPT0gbnVsbCAmJiBmcmFtZU9mUmVmZXJlbmNlICE9PSBudWxsOwoKCQl9CgoJCS8vCgoJCXZhciBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJY2FtZXJhTC5sYXllcnMuZW5hYmxlKCAxICk7CgkJY2FtZXJhTC52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgoJCXZhciBjYW1lcmFSID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJY2FtZXJhUi5sYXllcnMuZW5hYmxlKCAyICk7CgkJY2FtZXJhUi52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgoJCXZhciBjYW1lcmFWUiA9IG5ldyBBcnJheUNhbWVyYSggWyBjYW1lcmFMLCBjYW1lcmFSIF0gKTsKCQljYW1lcmFWUi5sYXllcnMuZW5hYmxlKCAxICk7CgkJY2FtZXJhVlIubGF5ZXJzLmVuYWJsZSggMiApOwoKCQkvLwoKCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJdGhpcy5nZXRDb250cm9sbGVyID0gZnVuY3Rpb24gKCBpZCApIHsKCgkJCXZhciBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGlkIF07CgoJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb250cm9sbGVyID0gbmV3IEdyb3VwKCk7CgkJCQljb250cm9sbGVyLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCWNvbnRyb2xsZXIudmlzaWJsZSA9IGZhbHNlOwoKCQkJCWNvbnRyb2xsZXJzWyBpZCBdID0gY29udHJvbGxlcjsKCgkJCX0KCgkJCXJldHVybiBjb250cm9sbGVyOwoKCQl9OwoKCQl0aGlzLmdldERldmljZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBkZXZpY2U7CgoJCX07CgoJCXRoaXMuc2V0RGV2aWNlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIGRldmljZSA9IHZhbHVlOwoJCQlpZiAoIHZhbHVlIGluc3RhbmNlb2YgWFJEZXZpY2UgKSBnbC5zZXRDb21wYXRpYmxlWFJEZXZpY2UoIHZhbHVlICk7CgoJCX07CgoJCS8vCgoJCWZ1bmN0aW9uIG9uU2Vzc2lvbkV2ZW50KCBldmVudCApIHsKCgkJCXZhciBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGlucHV0U291cmNlcy5pbmRleE9mKCBldmVudC5pbnB1dFNvdXJjZSApIF07CgkJCWlmICggY29udHJvbGxlciApIGNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiBldmVudC50eXBlIH0gKTsKCgkJfQoKCQlmdW5jdGlvbiBvblNlc3Npb25FbmQoKSB7CgoJCQlyZW5kZXJlci5zZXRGcmFtZWJ1ZmZlciggbnVsbCApOwoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpICk7IC8vIEhhY2sgIzE1ODMwCgkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCX0KCgkJdGhpcy5zZXRGcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSB2YWx1ZTsKCgkJfTsKCgkJdGhpcy5zZXRGcmFtZU9mUmVmZXJlbmNlVHlwZSA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlmcmFtZU9mUmVmZXJlbmNlVHlwZSA9IHZhbHVlOwoKCQl9OwoKCQl0aGlzLnNldFNlc3Npb24gPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJc2Vzc2lvbiA9IHZhbHVlOwoKCQkJaWYgKCBzZXNzaW9uICE9PSBudWxsICkgewoKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NlbGVjdCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnZW5kJywgb25TZXNzaW9uRW5kICk7CgoJCQkJc2Vzc2lvbi5iYXNlTGF5ZXIgPSBuZXcgWFJXZWJHTExheWVyKCBzZXNzaW9uLCBnbCwgeyBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yOiBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yIH0gKTsKCQkJCXNlc3Npb24ucmVxdWVzdEZyYW1lT2ZSZWZlcmVuY2UoIGZyYW1lT2ZSZWZlcmVuY2VUeXBlICkudGhlbiggZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQkJZnJhbWVPZlJlZmVyZW5jZSA9IHZhbHVlOwoKCQkJCQlyZW5kZXJlci5zZXRGcmFtZWJ1ZmZlciggc2Vzc2lvbi5iYXNlTGF5ZXIuZnJhbWVidWZmZXIgKTsKCgkJCQkJYW5pbWF0aW9uLnNldENvbnRleHQoIHNlc3Npb24gKTsKCQkJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJCQl9ICk7CgoJCQkJLy8KCgkJCQlpbnB1dFNvdXJjZXMgPSBzZXNzaW9uLmdldElucHV0U291cmNlcygpOwoKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKCgkJCQkJaW5wdXRTb3VyY2VzID0gc2Vzc2lvbi5nZXRJbnB1dFNvdXJjZXMoKTsKCQkJCQljb25zb2xlLmxvZyggaW5wdXRTb3VyY2VzICk7CgoJCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCXZhciBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGkgXTsKCQkJCQkJY29udHJvbGxlci51c2VyRGF0YS5pbnB1dFNvdXJjZSA9IGlucHV0U291cmNlc1sgaSBdOwoKCQkJCQl9CgoJCQkJfSApOwoKCQkJfQoKCQl9OwoKCQlmdW5jdGlvbiB1cGRhdGVDYW1lcmEoIGNhbWVyYSwgcGFyZW50ICkgewoKCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKCgkJCX0gZWxzZSB7CgoJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHBhcmVudC5tYXRyaXhXb3JsZCwgY2FtZXJhLm1hdHJpeCApOwoKCQkJfQoKCQkJY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZS5nZXRJbnZlcnNlKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgkJfQoKCQl0aGlzLnNldFBvc2VUYXJnZXQgPSBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCWlmICggb2JqZWN0ICE9PSB1bmRlZmluZWQgKSBwb3NlVGFyZ2V0ID0gb2JqZWN0OwoKCQl9OwoKCQl0aGlzLmdldENhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhICkgewoKCQkJaWYgKCBpc1ByZXNlbnRpbmcoKSApIHsKCgkJCQl2YXIgcGFyZW50ID0gY2FtZXJhLnBhcmVudDsKCQkJCXZhciBjYW1lcmFzID0gY2FtZXJhVlIuY2FtZXJhczsKCQkJCXZhciBvYmplY3QgPSBwb3NlVGFyZ2V0IHx8IGNhbWVyYTsKCgkJCQl1cGRhdGVDYW1lcmEoIGNhbWVyYVZSLCBwYXJlbnQgKTsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjYW1lcmFzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJdXBkYXRlQ2FtZXJhKCBjYW1lcmFzWyBpIF0sIHBhcmVudCApOwoKCQkJCX0KCgkJCQkvLyB1cGRhdGUgY2FtZXJhIGFuZCBpdHMgY2hpbGRyZW4KCQkJCW9iamVjdC5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmFWUi5tYXRyaXhXb3JsZCApOwoKCQkJCXZhciBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQljaGlsZHJlblsgaSBdLnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQkJfQoKCQkJCXNldFByb2plY3Rpb25Gcm9tVW5pb24oIGNhbWVyYVZSLCBjYW1lcmFMLCBjYW1lcmFSICk7CgoJCQkJcmV0dXJuIGNhbWVyYVZSOwoKCQkJfQoKCQkJcmV0dXJuIGNhbWVyYTsKCgkJfTsKCgkJdGhpcy5nZXRDYW1lcmFQb3NlID0gZnVuY3Rpb24gKCApIHsKCgkJCXJldHVybiBwb3NlOwoKCQl9OwoKCQl0aGlzLmlzUHJlc2VudGluZyA9IGlzUHJlc2VudGluZzsKCgkJLy8gQW5pbWF0aW9uIExvb3AKCgkJdmFyIG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CgoJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKCQkJcG9zZSA9IGZyYW1lLmdldERldmljZVBvc2UoIGZyYW1lT2ZSZWZlcmVuY2UgKTsKCgkJCWlmICggcG9zZSAhPT0gbnVsbCApIHsKCgkJCQl2YXIgbGF5ZXIgPSBzZXNzaW9uLmJhc2VMYXllcjsKCQkJCXZhciB2aWV3cyA9IGZyYW1lLnZpZXdzOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IHZpZXdzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJdmFyIHZpZXcgPSB2aWV3c1sgaSBdOwoJCQkJCXZhciB2aWV3cG9ydCA9IGxheWVyLmdldFZpZXdwb3J0KCB2aWV3ICk7CgkJCQkJdmFyIHZpZXdNYXRyaXggPSBwb3NlLmdldFZpZXdNYXRyaXgoIHZpZXcgKTsKCgkJCQkJdmFyIGNhbWVyYSA9IGNhbWVyYVZSLmNhbWVyYXNbIGkgXTsKCQkJCQljYW1lcmEubWF0cml4LmZyb21BcnJheSggdmlld01hdHJpeCApLmdldEludmVyc2UoIGNhbWVyYS5tYXRyaXggKTsKCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5mcm9tQXJyYXkoIHZpZXcucHJvamVjdGlvbk1hdHJpeCApOwoJCQkJCWNhbWVyYS52aWV3cG9ydC5zZXQoIHZpZXdwb3J0LngsIHZpZXdwb3J0LnksIHZpZXdwb3J0LndpZHRoLCB2aWV3cG9ydC5oZWlnaHQgKTsKCgkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJY2FtZXJhVlIubWF0cml4LmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKCQkJCXZhciBpbnB1dFNvdXJjZSA9IGlucHV0U291cmNlc1sgaSBdOwoKCQkJCWlmICggaW5wdXRTb3VyY2UgKSB7CgoJCQkJCXZhciBpbnB1dFBvc2UgPSBmcmFtZS5nZXRJbnB1dFBvc2UoIGlucHV0U291cmNlLCBmcmFtZU9mUmVmZXJlbmNlICk7CgoJCQkJCWlmICggaW5wdXRQb3NlICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCAndGFyZ2V0UmF5JyBpbiBpbnB1dFBvc2UgKSB7CgoJCQkJCQkJY29udHJvbGxlci5tYXRyaXguZWxlbWVudHMgPSBpbnB1dFBvc2UudGFyZ2V0UmF5LnRyYW5zZm9ybU1hdHJpeDsKCgkJCQkJCX0gZWxzZSBpZiAoICdwb2ludGVyTWF0cml4JyBpbiBpbnB1dFBvc2UgKSB7CgoJCQkJCQkJLy8gREVQUkVDQVRFRAoKCQkJCQkJCWNvbnRyb2xsZXIubWF0cml4LmVsZW1lbnRzID0gaW5wdXRQb3NlLnBvaW50ZXJNYXRyaXg7CgoJCQkJCQl9CgoJCQkJCQljb250cm9sbGVyLm1hdHJpeC5kZWNvbXBvc2UoIGNvbnRyb2xsZXIucG9zaXRpb24sIGNvbnRyb2xsZXIucm90YXRpb24sIGNvbnRyb2xsZXIuc2NhbGUgKTsKCQkJCQkJY29udHJvbGxlci52aXNpYmxlID0gdHJ1ZTsKCgkJCQkJCWNvbnRpbnVlOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnRyb2xsZXIudmlzaWJsZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUsIGZyYW1lICk7CgoJCX0KCgkJdmFyIGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwoJCWFuaW1hdGlvbi5zZXRBbmltYXRpb25Mb29wKCBvbkFuaW1hdGlvbkZyYW1lICk7CgoJCXRoaXMuc2V0QW5pbWF0aW9uTG9vcCA9IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJfTsKCgkJdGhpcy5kaXNwb3NlID0gZnVuY3Rpb24gKCkge307CgoJCS8vIERFUFJFQ0FURUQKCgkJdGhpcy5nZXRTdGFuZGluZ01hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYlhSTWFuYWdlcjogZ2V0U3RhbmRpbmdNYXRyaXgoKSBpcyBubyBsb25nZXIgbmVlZGVkLicgKTsKCQkJcmV0dXJuIG5ldyBNYXRyaXg0KCk7CgoJCX07CgoJCXRoaXMuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAoKSB7fTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIHN1cGVyZWdnYmVydCAvIGh0dHA6Ly93d3cucGF1bGJydW50LmNvLnVrLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIHN6aW1layAvIGh0dHBzOi8vZ2l0aHViLmNvbS9zemltZWsvCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBXZWJHTFJlbmRlcmVyKCBwYXJhbWV0ZXJzICkgewoKCQljb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUmVuZGVyZXInLCBSRVZJU0lPTiApOwoKCQlwYXJhbWV0ZXJzID0gcGFyYW1ldGVycyB8fCB7fTsKCgkJdmFyIF9jYW52YXMgPSBwYXJhbWV0ZXJzLmNhbnZhcyAhPT0gdW5kZWZpbmVkID8gcGFyYW1ldGVycy5jYW52YXMgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJywgJ2NhbnZhcycgKSwKCQkJX2NvbnRleHQgPSBwYXJhbWV0ZXJzLmNvbnRleHQgIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMuY29udGV4dCA6IG51bGwsCgoJCQlfYWxwaGEgPSBwYXJhbWV0ZXJzLmFscGhhICE9PSB1bmRlZmluZWQgPyBwYXJhbWV0ZXJzLmFscGhhIDogZmFsc2UsCgkJCV9kZXB0aCA9IHBhcmFtZXRlcnMuZGVwdGggIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMuZGVwdGggOiB0cnVlLAoJCQlfc3RlbmNpbCA9IHBhcmFtZXRlcnMuc3RlbmNpbCAhPT0gdW5kZWZpbmVkID8gcGFyYW1ldGVycy5zdGVuY2lsIDogdHJ1ZSwKCQkJX2FudGlhbGlhcyA9IHBhcmFtZXRlcnMuYW50aWFsaWFzICE9PSB1bmRlZmluZWQgPyBwYXJhbWV0ZXJzLmFudGlhbGlhcyA6IGZhbHNlLAoJCQlfcHJlbXVsdGlwbGllZEFscGhhID0gcGFyYW1ldGVycy5wcmVtdWx0aXBsaWVkQWxwaGEgIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhIDogdHJ1ZSwKCQkJX3ByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IHBhcmFtZXRlcnMucHJlc2VydmVEcmF3aW5nQnVmZmVyICE9PSB1bmRlZmluZWQgPyBwYXJhbWV0ZXJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlciA6IGZhbHNlLAoJCQlfcG93ZXJQcmVmZXJlbmNlID0gcGFyYW1ldGVycy5wb3dlclByZWZlcmVuY2UgIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucG93ZXJQcmVmZXJlbmNlIDogJ2RlZmF1bHQnOwoKCQl2YXIgY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoJCXZhciBjdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkvLyBwdWJsaWMgcHJvcGVydGllcwoKCQl0aGlzLmRvbUVsZW1lbnQgPSBfY2FudmFzOwoJCXRoaXMuY29udGV4dCA9IG51bGw7CgoJCS8vIGNsZWFyaW5nCgoJCXRoaXMuYXV0b0NsZWFyID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhckNvbG9yID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhckRlcHRoID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhclN0ZW5jaWwgPSB0cnVlOwoKCQkvLyBzY2VuZSBncmFwaAoKCQl0aGlzLnNvcnRPYmplY3RzID0gdHJ1ZTsKCgkJLy8gdXNlci1kZWZpbmVkIGNsaXBwaW5nCgoJCXRoaXMuY2xpcHBpbmdQbGFuZXMgPSBbXTsKCQl0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgoJCS8vIHBoeXNpY2FsbHkgYmFzZWQgc2hhZGluZwoKCQl0aGlzLmdhbW1hRmFjdG9yID0gMi4wOwkvLyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQl0aGlzLmdhbW1hSW5wdXQgPSBmYWxzZTsKCQl0aGlzLmdhbW1hT3V0cHV0ID0gZmFsc2U7CgoJCS8vIHBoeXNpY2FsIGxpZ2h0cwoKCQl0aGlzLnBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzID0gZmFsc2U7CgoJCS8vIHRvbmUgbWFwcGluZwoKCQl0aGlzLnRvbmVNYXBwaW5nID0gTGluZWFyVG9uZU1hcHBpbmc7CgkJdGhpcy50b25lTWFwcGluZ0V4cG9zdXJlID0gMS4wOwoJCXRoaXMudG9uZU1hcHBpbmdXaGl0ZVBvaW50ID0gMS4wOwoKCQkvLyBtb3JwaHMKCgkJdGhpcy5tYXhNb3JwaFRhcmdldHMgPSA4OwoJCXRoaXMubWF4TW9ycGhOb3JtYWxzID0gNDsKCgkJLy8gaW50ZXJuYWwgcHJvcGVydGllcwoKCQl2YXIgX3RoaXMgPSB0aGlzLAoKCQkJX2lzQ29udGV4dExvc3QgPSBmYWxzZSwKCgkJCS8vIGludGVybmFsIHN0YXRlIGNhY2hlCgoJCQlfZnJhbWVidWZmZXIgPSBudWxsLAoKCQkJX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsLAoJCQlfY3VycmVudEZyYW1lYnVmZmVyID0gbnVsbCwKCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gLSAxLAoKCQkJLy8gZ2VvbWV0cnkgYW5kIHByb2dyYW0gY2FjaGluZwoKCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0gPSB7CgkJCQlnZW9tZXRyeTogbnVsbCwKCQkJCXByb2dyYW06IG51bGwsCgkJCQl3aXJlZnJhbWU6IGZhbHNlCgkJCX0sCgoJCQlfY3VycmVudENhbWVyYSA9IG51bGwsCgkJCV9jdXJyZW50QXJyYXlDYW1lcmEgPSBudWxsLAoKCQkJX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCksCgkJCV9jdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCksCgkJCV9jdXJyZW50U2Npc3NvclRlc3QgPSBudWxsLAoKCQkJLy8KCgkJCV91c2VkVGV4dHVyZVVuaXRzID0gMCwKCgkJCS8vCgoJCQlfd2lkdGggPSBfY2FudmFzLndpZHRoLAoJCQlfaGVpZ2h0ID0gX2NhbnZhcy5oZWlnaHQsCgoJCQlfcGl4ZWxSYXRpbyA9IDEsCgoJCQlfdmlld3BvcnQgPSBuZXcgVmVjdG9yNCggMCwgMCwgX3dpZHRoLCBfaGVpZ2h0ICksCgkJCV9zY2lzc29yID0gbmV3IFZlY3RvcjQoIDAsIDAsIF93aWR0aCwgX2hlaWdodCApLAoJCQlfc2Npc3NvclRlc3QgPSBmYWxzZSwKCgkJCS8vIGZydXN0dW0KCgkJCV9mcnVzdHVtID0gbmV3IEZydXN0dW0oKSwKCgkJCS8vIGNsaXBwaW5nCgoJCQlfY2xpcHBpbmcgPSBuZXcgV2ViR0xDbGlwcGluZygpLAoJCQlfY2xpcHBpbmdFbmFibGVkID0gZmFsc2UsCgkJCV9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlLAoKCQkJLy8gY2FtZXJhIG1hdHJpY2VzIGNhY2hlCgoJCQlfcHJvalNjcmVlbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCksCgoJCQlfdmVjdG9yMyA9IG5ldyBWZWN0b3IzKCk7CgoJCWZ1bmN0aW9uIGdldFRhcmdldFBpeGVsUmF0aW8oKSB7CgoJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CgoJCX0KCgkJLy8gaW5pdGlhbGl6ZQoKCQl2YXIgX2dsOwoKCQl0cnkgewoKCQkJdmFyIGNvbnRleHRBdHRyaWJ1dGVzID0gewoJCQkJYWxwaGE6IF9hbHBoYSwKCQkJCWRlcHRoOiBfZGVwdGgsCgkJCQlzdGVuY2lsOiBfc3RlbmNpbCwKCQkJCWFudGlhbGlhczogX2FudGlhbGlhcywKCQkJCXByZW11bHRpcGxpZWRBbHBoYTogX3ByZW11bHRpcGxpZWRBbHBoYSwKCQkJCXByZXNlcnZlRHJhd2luZ0J1ZmZlcjogX3ByZXNlcnZlRHJhd2luZ0J1ZmZlciwKCQkJCXBvd2VyUHJlZmVyZW5jZTogX3Bvd2VyUHJlZmVyZW5jZQoJCQl9OwoKCQkJLy8gZXZlbnQgbGlzdGVuZXJzIG11c3QgYmUgcmVnaXN0ZXJlZCBiZWZvcmUgV2ViR0wgY29udGV4dCBpcyBjcmVhdGVkLCBzZWUgIzEyNzUzCgoJCQlfY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRsb3N0Jywgb25Db250ZXh0TG9zdCwgZmFsc2UgKTsKCQkJX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0cmVzdG9yZWQnLCBvbkNvbnRleHRSZXN0b3JlLCBmYWxzZSApOwoKCQkJX2dsID0gX2NvbnRleHQgfHwgX2NhbnZhcy5nZXRDb250ZXh0KCAnd2ViZ2wnLCBjb250ZXh0QXR0cmlidXRlcyApIHx8IF9jYW52YXMuZ2V0Q29udGV4dCggJ2V4cGVyaW1lbnRhbC13ZWJnbCcsIGNvbnRleHRBdHRyaWJ1dGVzICk7CgoJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCgkJCQlpZiAoIF9jYW52YXMuZ2V0Q29udGV4dCggJ3dlYmdsJyApICE9PSBudWxsICkgewoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0IHdpdGggeW91ciBzZWxlY3RlZCBhdHRyaWJ1dGVzLicgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0LicgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBTb21lIGV4cGVyaW1lbnRhbC13ZWJnbCBpbXBsZW1lbnRhdGlvbnMgZG8gbm90IGhhdmUgZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0CgoJCQlpZiAoIF9nbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlfZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoKCQkJCQlyZXR1cm4geyAncmFuZ2VNaW4nOiAxLCAncmFuZ2VNYXgnOiAxLCAncHJlY2lzaW9uJzogMSB9OwoKCQkJCX07CgoJCQl9CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAnICsgZXJyb3IubWVzc2FnZSApOwoJCQl0aHJvdyBlcnJvcjsKCgkJfQoKCQl2YXIgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzLCBzdGF0ZSwgaW5mbzsKCQl2YXIgcHJvcGVydGllcywgdGV4dHVyZXMsIGF0dHJpYnV0ZXMsIGdlb21ldHJpZXMsIG9iamVjdHM7CgkJdmFyIHByb2dyYW1DYWNoZSwgcmVuZGVyTGlzdHMsIHJlbmRlclN0YXRlczsKCgkJdmFyIGJhY2tncm91bmQsIG1vcnBodGFyZ2V0cywgYnVmZmVyUmVuZGVyZXIsIGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKCgkJdmFyIHV0aWxzOwoKCQlmdW5jdGlvbiBpbml0R0xDb250ZXh0KCkgewoKCQkJZXh0ZW5zaW9ucyA9IG5ldyBXZWJHTEV4dGVuc2lvbnMoIF9nbCApOwoKCQkJY2FwYWJpbGl0aWVzID0gbmV3IFdlYkdMQ2FwYWJpbGl0aWVzKCBfZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMgKTsKCgkJCWlmICggISBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSB7CgoJCQkJZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9kZXB0aF90ZXh0dXJlJyApOwoJCQkJZXh0ZW5zaW9ucy5nZXQoICdPRVNfdGV4dHVyZV9mbG9hdCcgKTsKCQkJCWV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdCcgKTsKCQkJCWV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdF9saW5lYXInICk7CgkJCQlleHRlbnNpb25zLmdldCggJ09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcycgKTsKCQkJCWV4dGVuc2lvbnMuZ2V0KCAnT0VTX2VsZW1lbnRfaW5kZXhfdWludCcgKTsKCQkJCWV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCgkJCX0KCgkJCWV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyJyApOwoKCQkJdXRpbHMgPSBuZXcgV2ViR0xVdGlscyggX2dsLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKTsKCgkJCXN0YXRlID0gbmV3IFdlYkdMU3RhdGUoIF9nbCwgZXh0ZW5zaW9ucywgdXRpbHMsIGNhcGFiaWxpdGllcyApOwoJCQlzdGF0ZS5zY2lzc29yKCBfY3VycmVudFNjaXNzb3IuY29weSggX3NjaXNzb3IgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKSApOwoJCQlzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydC5jb3B5KCBfdmlld3BvcnQgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKSApOwoKCQkJaW5mbyA9IG5ldyBXZWJHTEluZm8oIF9nbCApOwoJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYkdMUHJvcGVydGllcygpOwoJCQl0ZXh0dXJlcyA9IG5ldyBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICk7CgkJCWF0dHJpYnV0ZXMgPSBuZXcgV2ViR0xBdHRyaWJ1dGVzKCBfZ2wgKTsKCQkJZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoIF9nbCwgYXR0cmlidXRlcywgaW5mbyApOwoJCQlvYmplY3RzID0gbmV3IFdlYkdMT2JqZWN0cyggZ2VvbWV0cmllcywgaW5mbyApOwoJCQltb3JwaHRhcmdldHMgPSBuZXcgV2ViR0xNb3JwaHRhcmdldHMoIF9nbCApOwoJCQlwcm9ncmFtQ2FjaGUgPSBuZXcgV2ViR0xQcm9ncmFtcyggX3RoaXMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoJCQlyZW5kZXJMaXN0cyA9IG5ldyBXZWJHTFJlbmRlckxpc3RzKCk7CgkJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWJHTFJlbmRlclN0YXRlcygpOwoKCQkJYmFja2dyb3VuZCA9IG5ldyBXZWJHTEJhY2tncm91bmQoIF90aGlzLCBzdGF0ZSwgb2JqZWN0cywgX3ByZW11bHRpcGxpZWRBbHBoYSApOwoKCQkJYnVmZmVyUmVuZGVyZXIgPSBuZXcgV2ViR0xCdWZmZXJSZW5kZXJlciggX2dsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMgKTsKCQkJaW5kZXhlZEJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBfZ2wsIGV4dGVuc2lvbnMsIGluZm8sIGNhcGFiaWxpdGllcyApOwoKCQkJaW5mby5wcm9ncmFtcyA9IHByb2dyYW1DYWNoZS5wcm9ncmFtczsKCgkJCV90aGlzLmNvbnRleHQgPSBfZ2w7CgkJCV90aGlzLmNhcGFiaWxpdGllcyA9IGNhcGFiaWxpdGllczsKCQkJX3RoaXMuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnM7CgkJCV90aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzOwoJCQlfdGhpcy5yZW5kZXJMaXN0cyA9IHJlbmRlckxpc3RzOwoJCQlfdGhpcy5zdGF0ZSA9IHN0YXRlOwoJCQlfdGhpcy5pbmZvID0gaW5mbzsKCgkJfQoKCQlpbml0R0xDb250ZXh0KCk7CgoJCS8vIHZyCgoJCXZhciB2ciA9IG51bGw7CgoJCWlmICggdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQl2ciA9ICggJ3hyJyBpbiBuYXZpZ2F0b3IgKSA/IG5ldyBXZWJYUk1hbmFnZXIoIF90aGlzICkgOiBuZXcgV2ViVlJNYW5hZ2VyKCBfdGhpcyApOwoKCQl9CgoJCXRoaXMudnIgPSB2cjsKCgkJLy8gc2hhZG93IG1hcAoKCQl2YXIgc2hhZG93TWFwID0gbmV3IFdlYkdMU2hhZG93TWFwKCBfdGhpcywgb2JqZWN0cywgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplICk7CgoJCXRoaXMuc2hhZG93TWFwID0gc2hhZG93TWFwOwoKCQkvLyBBUEkKCgkJdGhpcy5nZXRDb250ZXh0ID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9nbDsKCgkJfTsKCgkJdGhpcy5nZXRDb250ZXh0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBfZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKCgkJfTsKCgkJdGhpcy5mb3JjZUNvbnRleHRMb3NzID0gZnVuY3Rpb24gKCkgewoKCQkJdmFyIGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbG9zZV9jb250ZXh0JyApOwoJCQlpZiAoIGV4dGVuc2lvbiApIGV4dGVuc2lvbi5sb3NlQ29udGV4dCgpOwoKCQl9OwoKCQl0aGlzLmZvcmNlQ29udGV4dFJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9sb3NlX2NvbnRleHQnICk7CgkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCk7CgoJCX07CgoJCXRoaXMuZ2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBfcGl4ZWxSYXRpbzsKCgkJfTsKCgkJdGhpcy5zZXRQaXhlbFJhdGlvID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCV9waXhlbFJhdGlvID0gdmFsdWU7CgoJCQl0aGlzLnNldFNpemUoIF93aWR0aCwgX2hlaWdodCwgZmFsc2UgKTsKCgkJfTsKCgkJdGhpcy5nZXRTaXplID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1dlYkdMUmVuZGVyZXI6IC5nZXRzaXplKCkgbm93IHJlcXVpcmVzIGEgVmVjdG9yMiBhcyBhbiBhcmd1bWVudCcgKTsKCgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMigpOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIF93aWR0aCwgX2hlaWdodCApOwoKCQl9OwoKCQl0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlICkgewoKCQkJaWYgKCB2ci5pc1ByZXNlbnRpbmcoKSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDYW5cJ3QgY2hhbmdlIHNpemUgd2hpbGUgVlIgZGV2aWNlIGlzIHByZXNlbnRpbmcuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJX3dpZHRoID0gd2lkdGg7CgkJCV9oZWlnaHQgPSBoZWlnaHQ7CgoJCQlfY2FudmFzLndpZHRoID0gd2lkdGggKiBfcGl4ZWxSYXRpbzsKCQkJX2NhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKiBfcGl4ZWxSYXRpbzsKCgkJCWlmICggdXBkYXRlU3R5bGUgIT09IGZhbHNlICkgewoKCQkJCV9jYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7CgkJCQlfY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgoJCQl9CgoJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCX07CgoJCXRoaXMuZ2V0RHJhd2luZ0J1ZmZlclNpemUgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnV2ViR0xSZW5kZXJlcjogLmdldGRyYXdpbmdCdWZmZXJTaXplKCkgbm93IHJlcXVpcmVzIGEgVmVjdG9yMiBhcyBhbiBhcmd1bWVudCcgKTsKCgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMigpOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIF93aWR0aCAqIF9waXhlbFJhdGlvLCBfaGVpZ2h0ICogX3BpeGVsUmF0aW8gKTsKCgkJfTsKCgkJdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgcGl4ZWxSYXRpbyApIHsKCgkJCV93aWR0aCA9IHdpZHRoOwoJCQlfaGVpZ2h0ID0gaGVpZ2h0OwoKCQkJX3BpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwoKCQkJX2NhbnZhcy53aWR0aCA9IHdpZHRoICogcGl4ZWxSYXRpbzsKCQkJX2NhbnZhcy5oZWlnaHQgPSBoZWlnaHQgKiBwaXhlbFJhdGlvOwoKCQkJdGhpcy5zZXRWaWV3cG9ydCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQl9OwoKCQl0aGlzLmdldEN1cnJlbnRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdXZWJHTFJlbmRlcmVyOiAuZ2V0Q3VycmVudFZpZXdwb3J0KCkgbm93IHJlcXVpcmVzIGEgVmVjdG9yNCBhcyBhbiBhcmd1bWVudCcgKTsKCgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yNCgpOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfY3VycmVudFZpZXdwb3J0ICk7CgoJCX07CgoJCXRoaXMuZ2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggX3ZpZXdwb3J0ICk7CgoJCX07CgoJCXRoaXMuc2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKCQkJCV92aWV3cG9ydC5zZXQoIHgueCwgeC55LCB4LnosIHgudyApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQl9CgoJCQlzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydC5jb3B5KCBfdmlld3BvcnQgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKSApOwoKCQl9OwoKCQl0aGlzLmdldFNjaXNzb3IgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggX3NjaXNzb3IgKTsKCgkJfTsKCgkJdGhpcy5zZXRTY2lzc29yID0gZnVuY3Rpb24gKCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQkJaWYgKCB4LmlzVmVjdG9yNCApIHsKCgkJCQlfc2Npc3Nvci5zZXQoIHgueCwgeC55LCB4LnosIHgudyApOwoKCQkJfSBlbHNlIHsKCgkJCQlfc2Npc3Nvci5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCX0KCgkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3Nvci5jb3B5KCBfc2Npc3NvciApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApICk7CgoJCX07CgoJCXRoaXMuZ2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX3NjaXNzb3JUZXN0OwoKCQl9OwoKCQl0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCBib29sZWFuICkgewoKCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9zY2lzc29yVGVzdCA9IGJvb2xlYW4gKTsKCgkJfTsKCgkJLy8gQ2xlYXJpbmcKCgkJdGhpcy5nZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGJhY2tncm91bmQuZ2V0Q2xlYXJDb2xvcigpOwoKCQl9OwoKCQl0aGlzLnNldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoKSB7CgoJCQliYWNrZ3JvdW5kLnNldENsZWFyQ29sb3IuYXBwbHkoIGJhY2tncm91bmQsIGFyZ3VtZW50cyApOwoKCQl9OwoKCQl0aGlzLmdldENsZWFyQWxwaGEgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gYmFja2dyb3VuZC5nZXRDbGVhckFscGhhKCk7CgoJCX07CgoJCXRoaXMuc2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uICgpIHsKCgkJCWJhY2tncm91bmQuc2V0Q2xlYXJBbHBoYS5hcHBseSggYmFja2dyb3VuZCwgYXJndW1lbnRzICk7CgoJCX07CgoJCXRoaXMuY2xlYXIgPSBmdW5jdGlvbiAoIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApIHsKCgkJCXZhciBiaXRzID0gMDsKCgkJCWlmICggY29sb3IgPT09IHVuZGVmaW5lZCB8fCBjb2xvciApIGJpdHMgfD0gMTYzODQ7CgkJCWlmICggZGVwdGggPT09IHVuZGVmaW5lZCB8fCBkZXB0aCApIGJpdHMgfD0gMjU2OwoJCQlpZiAoIHN0ZW5jaWwgPT09IHVuZGVmaW5lZCB8fCBzdGVuY2lsICkgYml0cyB8PSAxMDI0OwoKCQkJX2dsLmNsZWFyKCBiaXRzICk7CgoJCX07CgoJCXRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuY2xlYXIoIHRydWUsIGZhbHNlLCBmYWxzZSApOwoKCQl9OwoKCQl0aGlzLmNsZWFyRGVwdGggPSBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmNsZWFyKCBmYWxzZSwgdHJ1ZSwgZmFsc2UgKTsKCgkJfTsKCgkJdGhpcy5jbGVhclN0ZW5jaWwgPSBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmNsZWFyKCBmYWxzZSwgZmFsc2UsIHRydWUgKTsKCgkJfTsKCgkJLy8KCgkJdGhpcy5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewoKCQkJX2NhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0bG9zdCcsIG9uQ29udGV4dExvc3QsIGZhbHNlICk7CgkJCV9jYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCgkJCXJlbmRlckxpc3RzLmRpc3Bvc2UoKTsKCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKCQkJcHJvcGVydGllcy5kaXNwb3NlKCk7CgkJCW9iamVjdHMuZGlzcG9zZSgpOwoKCQkJdnIuZGlzcG9zZSgpOwoKCQkJYW5pbWF0aW9uLnN0b3AoKTsKCgkJfTsKCgkJLy8gRXZlbnRzCgoJCWZ1bmN0aW9uIG9uQ29udGV4dExvc3QoIGV2ZW50ICkgewoKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCWNvbnNvbGUubG9nKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ29udGV4dCBMb3N0LicgKTsKCgkJCV9pc0NvbnRleHRMb3N0ID0gdHJ1ZTsKCgkJfQoKCQlmdW5jdGlvbiBvbkNvbnRleHRSZXN0b3JlKCAvKiBldmVudCAqLyApIHsKCgkJCWNvbnNvbGUubG9nKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ29udGV4dCBSZXN0b3JlZC4nICk7CgoJCQlfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkJaW5pdEdMQ29udGV4dCgpOwoKCQl9CgoJCWZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKCBldmVudCApIHsKCgkJCXZhciBtYXRlcmlhbCA9IGV2ZW50LnRhcmdldDsKCgkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCWRlYWxsb2NhdGVNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCgkJfQoKCQkvLyBCdWZmZXIgZGVhbGxvY2F0aW9uCgoJCWZ1bmN0aW9uIGRlYWxsb2NhdGVNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgoJCQlyZWxlYXNlTWF0ZXJpYWxQcm9ncmFtUmVmZXJlbmNlKCBtYXRlcmlhbCApOwoKCQkJcHJvcGVydGllcy5yZW1vdmUoIG1hdGVyaWFsICk7CgoJCX0KCgoJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2UoIG1hdGVyaWFsICkgewoKCQkJdmFyIHByb2dyYW1JbmZvID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkucHJvZ3JhbTsKCgkJCW1hdGVyaWFsLnByb2dyYW0gPSB1bmRlZmluZWQ7CgoJCQlpZiAoIHByb2dyYW1JbmZvICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VQcm9ncmFtKCBwcm9ncmFtSW5mbyApOwoKCQkJfQoKCQl9CgoJCS8vIEJ1ZmZlciByZW5kZXJpbmcKCgkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0SW1tZWRpYXRlKCBvYmplY3QsIHByb2dyYW0gKSB7CgoJCQlvYmplY3QucmVuZGVyKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQlfdGhpcy5yZW5kZXJCdWZmZXJJbW1lZGlhdGUoIG9iamVjdCwgcHJvZ3JhbSApOwoKCQkJfSApOwoKCQl9CgoJCXRoaXMucmVuZGVyQnVmZmVySW1tZWRpYXRlID0gZnVuY3Rpb24gKCBvYmplY3QsIHByb2dyYW0gKSB7CgoJCQlzdGF0ZS5pbml0QXR0cmlidXRlcygpOwoKCQkJdmFyIGJ1ZmZlcnMgPSBwcm9wZXJ0aWVzLmdldCggb2JqZWN0ICk7CgoJCQlpZiAoIG9iamVjdC5oYXNQb3NpdGlvbnMgJiYgISBidWZmZXJzLnBvc2l0aW9uICkgYnVmZmVycy5wb3NpdGlvbiA9IF9nbC5jcmVhdGVCdWZmZXIoKTsKCQkJaWYgKCBvYmplY3QuaGFzTm9ybWFscyAmJiAhIGJ1ZmZlcnMubm9ybWFsICkgYnVmZmVycy5ub3JtYWwgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCWlmICggb2JqZWN0Lmhhc1V2cyAmJiAhIGJ1ZmZlcnMudXYgKSBidWZmZXJzLnV2ID0gX2dsLmNyZWF0ZUJ1ZmZlcigpOwoJCQlpZiAoIG9iamVjdC5oYXNDb2xvcnMgJiYgISBidWZmZXJzLmNvbG9yICkgYnVmZmVycy5jb2xvciA9IF9nbC5jcmVhdGVCdWZmZXIoKTsKCgkJCXZhciBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKCQkJaWYgKCBvYmplY3QuaGFzUG9zaXRpb25zICkgewoKCQkJCV9nbC5iaW5kQnVmZmVyKCAzNDk2MiwgYnVmZmVycy5wb3NpdGlvbiApOwoJCQkJX2dsLmJ1ZmZlckRhdGEoIDM0OTYyLCBvYmplY3QucG9zaXRpb25BcnJheSwgMzUwNDggKTsKCgkJCQlzdGF0ZS5lbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGVzLnBvc2l0aW9uICk7CgkJCQlfZ2wudmVydGV4QXR0cmliUG9pbnRlciggcHJvZ3JhbUF0dHJpYnV0ZXMucG9zaXRpb24sIDMsIDUxMjYsIGZhbHNlLCAwLCAwICk7CgoJCQl9CgoJCQlpZiAoIG9iamVjdC5oYXNOb3JtYWxzICkgewoKCQkJCV9nbC5iaW5kQnVmZmVyKCAzNDk2MiwgYnVmZmVycy5ub3JtYWwgKTsKCQkJCV9nbC5idWZmZXJEYXRhKCAzNDk2Miwgb2JqZWN0Lm5vcm1hbEFycmF5LCAzNTA0OCApOwoKCQkJCXN0YXRlLmVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZXMubm9ybWFsICk7CgkJCQlfZ2wudmVydGV4QXR0cmliUG9pbnRlciggcHJvZ3JhbUF0dHJpYnV0ZXMubm9ybWFsLCAzLCA1MTI2LCBmYWxzZSwgMCwgMCApOwoKCQkJfQoKCQkJaWYgKCBvYmplY3QuaGFzVXZzICkgewoKCQkJCV9nbC5iaW5kQnVmZmVyKCAzNDk2MiwgYnVmZmVycy51diApOwoJCQkJX2dsLmJ1ZmZlckRhdGEoIDM0OTYyLCBvYmplY3QudXZBcnJheSwgMzUwNDggKTsKCgkJCQlzdGF0ZS5lbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGVzLnV2ICk7CgkJCQlfZ2wudmVydGV4QXR0cmliUG9pbnRlciggcHJvZ3JhbUF0dHJpYnV0ZXMudXYsIDIsIDUxMjYsIGZhbHNlLCAwLCAwICk7CgoJCQl9CgoJCQlpZiAoIG9iamVjdC5oYXNDb2xvcnMgKSB7CgoJCQkJX2dsLmJpbmRCdWZmZXIoIDM0OTYyLCBidWZmZXJzLmNvbG9yICk7CgkJCQlfZ2wuYnVmZmVyRGF0YSggMzQ5NjIsIG9iamVjdC5jb2xvckFycmF5LCAzNTA0OCApOwoKCQkJCXN0YXRlLmVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZXMuY29sb3IgKTsKCQkJCV9nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKCBwcm9ncmFtQXR0cmlidXRlcy5jb2xvciwgMywgNTEyNiwgZmFsc2UsIDAsIDAgKTsKCgkJCX0KCgkJCXN0YXRlLmRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgoJCQlfZ2wuZHJhd0FycmF5cyggNCwgMCwgb2JqZWN0LmNvdW50ICk7CgoJCQlvYmplY3QuY291bnQgPSAwOwoKCQl9OwoKCQl0aGlzLnJlbmRlckJ1ZmZlckRpcmVjdCA9IGZ1bmN0aW9uICggY2FtZXJhLCBmb2csIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApIHsKCgkJCXZhciBmcm9udEZhY2VDVyA9ICggb2JqZWN0LmlzTWVzaCAmJiBvYmplY3QubWF0cml4V29ybGQuZGV0ZXJtaW5hbnQoKSA8IDAgKTsKCgkJCXN0YXRlLnNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKTsKCgkJCXZhciBwcm9ncmFtID0gc2V0UHJvZ3JhbSggY2FtZXJhLCBmb2csIG1hdGVyaWFsLCBvYmplY3QgKTsKCgkJCXZhciB1cGRhdGVCdWZmZXJzID0gZmFsc2U7CgoJCQlpZiAoIF9jdXJyZW50R2VvbWV0cnlQcm9ncmFtLmdlb21ldHJ5ICE9PSBnZW9tZXRyeS5pZCB8fAoJCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0ucHJvZ3JhbSAhPT0gcHJvZ3JhbS5pZCB8fAoJCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0ud2lyZWZyYW1lICE9PSAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApICkgewoKCQkJCV9jdXJyZW50R2VvbWV0cnlQcm9ncmFtLmdlb21ldHJ5ID0gZ2VvbWV0cnkuaWQ7CgkJCQlfY3VycmVudEdlb21ldHJ5UHJvZ3JhbS5wcm9ncmFtID0gcHJvZ3JhbS5pZDsKCQkJCV9jdXJyZW50R2VvbWV0cnlQcm9ncmFtLndpcmVmcmFtZSA9IG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZTsKCQkJCXVwZGF0ZUJ1ZmZlcnMgPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzICkgewoKCQkJCW1vcnBodGFyZ2V0cy51cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBwcm9ncmFtICk7CgoJCQkJdXBkYXRlQnVmZmVycyA9IHRydWU7CgoJCQl9CgoJCQkvLwoKCQkJdmFyIGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCXZhciBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJCXZhciByYW5nZUZhY3RvciA9IDE7CgoJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQlpbmRleCA9IGdlb21ldHJpZXMuZ2V0V2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoJCQkJcmFuZ2VGYWN0b3IgPSAyOwoKCQkJfQoKCQkJdmFyIGF0dHJpYnV0ZTsKCQkJdmFyIHJlbmRlcmVyID0gYnVmZmVyUmVuZGVyZXI7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKCQkJCXJlbmRlcmVyID0gaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoJCQkJcmVuZGVyZXIuc2V0SW5kZXgoIGF0dHJpYnV0ZSApOwoKCQkJfQoKCQkJaWYgKCB1cGRhdGVCdWZmZXJzICkgewoKCQkJCXNldHVwVmVydGV4QXR0cmlidXRlcyggbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5ICk7CgoJCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJX2dsLmJpbmRCdWZmZXIoIDM0OTYzLCBhdHRyaWJ1dGUuYnVmZmVyICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8KCgkJCXZhciBkYXRhQ291bnQgPSBJbmZpbml0eTsKCgkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJZGF0YUNvdW50ID0gaW5kZXguY291bnQ7CgoJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWRhdGFDb3VudCA9IHBvc2l0aW9uLmNvdW50OwoKCQkJfQoKCQkJdmFyIHJhbmdlU3RhcnQgPSBnZW9tZXRyeS5kcmF3UmFuZ2Uuc3RhcnQgKiByYW5nZUZhY3RvcjsKCQkJdmFyIHJhbmdlQ291bnQgPSBnZW9tZXRyeS5kcmF3UmFuZ2UuY291bnQgKiByYW5nZUZhY3RvcjsKCgkJCXZhciBncm91cFN0YXJ0ID0gZ3JvdXAgIT09IG51bGwgPyBncm91cC5zdGFydCAqIHJhbmdlRmFjdG9yIDogMDsKCQkJdmFyIGdyb3VwQ291bnQgPSBncm91cCAhPT0gbnVsbCA/IGdyb3VwLmNvdW50ICogcmFuZ2VGYWN0b3IgOiBJbmZpbml0eTsKCgkJCXZhciBkcmF3U3RhcnQgPSBNYXRoLm1heCggcmFuZ2VTdGFydCwgZ3JvdXBTdGFydCApOwoJCQl2YXIgZHJhd0VuZCA9IE1hdGgubWluKCBkYXRhQ291bnQsIHJhbmdlU3RhcnQgKyByYW5nZUNvdW50LCBncm91cFN0YXJ0ICsgZ3JvdXBDb3VudCApIC0gMTsKCgkJCXZhciBkcmF3Q291bnQgPSBNYXRoLm1heCggMCwgZHJhd0VuZCAtIGRyYXdTdGFydCArIDEgKTsKCgkJCWlmICggZHJhd0NvdW50ID09PSAwICkgcmV0dXJuOwoKCQkJLy8KCgkJCWlmICggb2JqZWN0LmlzTWVzaCApIHsKCgkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJc3RhdGUuc2V0TGluZVdpZHRoKCBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggKiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgKTsKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCAxICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3dpdGNoICggb2JqZWN0LmRyYXdNb2RlICkgewoKCQkJCQkJY2FzZSBUcmlhbmdsZXNEcmF3TW9kZToKCQkJCQkJCXJlbmRlcmVyLnNldE1vZGUoIDQgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBUcmlhbmdsZVN0cmlwRHJhd01vZGU6CgkJCQkJCQlyZW5kZXJlci5zZXRNb2RlKCA1ICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgVHJpYW5nbGVGYW5EcmF3TW9kZToKCQkJCQkJCXJlbmRlcmVyLnNldE1vZGUoIDYgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJfQoKCgkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmUgKSB7CgoJCQkJdmFyIGxpbmVXaWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aDsKCgkJCQlpZiAoIGxpbmVXaWR0aCA9PT0gdW5kZWZpbmVkICkgbGluZVdpZHRoID0gMTsgLy8gTm90IHVzaW5nIExpbmUqTWF0ZXJpYWwKCgkJCQlzdGF0ZS5zZXRMaW5lV2lkdGgoIGxpbmVXaWR0aCAqIGdldFRhcmdldFBpeGVsUmF0aW8oKSApOwoKCQkJCWlmICggb2JqZWN0LmlzTGluZVNlZ21lbnRzICkgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCAxICk7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZUxvb3AgKSB7CgoJCQkJCXJlbmRlcmVyLnNldE1vZGUoIDIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCAzICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzUG9pbnRzICkgewoKCQkJCXJlbmRlcmVyLnNldE1vZGUoIDAgKTsKCgkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCgkJCQlyZW5kZXJlci5zZXRNb2RlKCA0ICk7CgoJCQl9CgoJCQlpZiAoIGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJaWYgKCBnZW9tZXRyeS5tYXhJbnN0YW5jZWRDb3VudCA+IDAgKSB7CgoJCQkJCXJlbmRlcmVyLnJlbmRlckluc3RhbmNlcyggZ2VvbWV0cnksIGRyYXdTdGFydCwgZHJhd0NvdW50ICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJlci5yZW5kZXIoIGRyYXdTdGFydCwgZHJhd0NvdW50ICk7CgoJCQl9CgoJCX07CgoJCWZ1bmN0aW9uIHNldHVwVmVydGV4QXR0cmlidXRlcyggbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5ICkgewoKCQkJaWYgKCBnZW9tZXRyeSAmJiBnZW9tZXRyeS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ICYmICEgY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgewoKCQkJCWlmICggZXh0ZW5zaW9ucy5nZXQoICdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzJyApID09PSBudWxsICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5zZXR1cFZlcnRleEF0dHJpYnV0ZXM6IHVzaW5nIFRIUkVFLkluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5IGJ1dCBoYXJkd2FyZSBkb2VzIG5vdCBzdXBwb3J0IGV4dGVuc2lvbiBBTkdMRV9pbnN0YW5jZWRfYXJyYXlzLicgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUuaW5pdEF0dHJpYnV0ZXMoKTsKCgkJCXZhciBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJdmFyIHByb2dyYW1BdHRyaWJ1dGVzID0gcHJvZ3JhbS5nZXRBdHRyaWJ1dGVzKCk7CgoJCQl2YXIgbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzID0gbWF0ZXJpYWwuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlczsKCgkJCWZvciAoIHZhciBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKCQkJCXZhciBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUgPj0gMCApIHsKCgkJCQkJdmFyIGdlb21ldHJ5QXR0cmlidXRlID0gZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXZhciBub3JtYWxpemVkID0gZ2VvbWV0cnlBdHRyaWJ1dGUubm9ybWFsaXplZDsKCQkJCQkJdmFyIHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJCQkJCXZhciBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnlBdHRyaWJ1dGUgKTsKCgkJCQkJCS8vIFRPRE8gQXR0cmlidXRlIG1heSBub3QgYmUgYXZhaWxhYmxlIG9uIGNvbnRleHQgcmVzdG9yZQoKCQkJCQkJaWYgKCBhdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIGNvbnRpbnVlOwoKCQkJCQkJdmFyIGJ1ZmZlciA9IGF0dHJpYnV0ZS5idWZmZXI7CgkJCQkJCXZhciB0eXBlID0gYXR0cmlidXRlLnR5cGU7CgkJCQkJCXZhciBieXRlc1BlckVsZW1lbnQgPSBhdHRyaWJ1dGUuYnl0ZXNQZXJFbGVtZW50OwoKCQkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgewoKCQkJCQkJCXZhciBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKCQkJCQkJCXZhciBzdHJpZGUgPSBkYXRhLnN0cmlkZTsKCQkJCQkJCXZhciBvZmZzZXQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5vZmZzZXQ7CgoJCQkJCQkJaWYgKCBkYXRhICYmIGRhdGEuaXNJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciApIHsKCgkJCQkJCQkJc3RhdGUuZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZSwgZGF0YS5tZXNoUGVyQXR0cmlidXRlICk7CgoJCQkJCQkJCWlmICggZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJCWdlb21ldHJ5Lm1heEluc3RhbmNlZENvdW50ID0gZGF0YS5tZXNoUGVyQXR0cmlidXRlICogZGF0YS5jb3VudDsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLmVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZSApOwoKCQkJCQkJCX0KCgkJCQkJCQlfZ2wuYmluZEJ1ZmZlciggMzQ5NjIsIGJ1ZmZlciApOwoJCQkJCQkJX2dsLnZlcnRleEF0dHJpYlBvaW50ZXIoIHByb2dyYW1BdHRyaWJ1dGUsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwgb2Zmc2V0ICogYnl0ZXNQZXJFbGVtZW50ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQkJCXN0YXRlLmVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIHByb2dyYW1BdHRyaWJ1dGUsIGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQkJaWYgKCBnZW9tZXRyeS5tYXhJbnN0YW5jZWRDb3VudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQkJZ2VvbWV0cnkubWF4SW5zdGFuY2VkQ291bnQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5tZXNoUGVyQXR0cmlidXRlICogZ2VvbWV0cnlBdHRyaWJ1dGUuY291bnQ7CgoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS5lbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUgKTsKCgkJCQkJCQl9CgoJCQkJCQkJX2dsLmJpbmRCdWZmZXIoIDM0OTYyLCBidWZmZXIgKTsKCQkJCQkJCV9nbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKCBwcm9ncmFtQXR0cmlidXRlLCBzaXplLCB0eXBlLCBub3JtYWxpemVkLCAwLCAwICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJdmFyIHZhbHVlID0gbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzWyBuYW1lIF07CgoJCQkJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJc3dpdGNoICggdmFsdWUubGVuZ3RoICkgewoKCQkJCQkJCQljYXNlIDI6CgkJCQkJCQkJCV9nbC52ZXJ0ZXhBdHRyaWIyZnYoIHByb2dyYW1BdHRyaWJ1dGUsIHZhbHVlICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIDM6CgkJCQkJCQkJCV9nbC52ZXJ0ZXhBdHRyaWIzZnYoIHByb2dyYW1BdHRyaWJ1dGUsIHZhbHVlICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIDQ6CgkJCQkJCQkJCV9nbC52ZXJ0ZXhBdHRyaWI0ZnYoIHByb2dyYW1BdHRyaWJ1dGUsIHZhbHVlICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQlkZWZhdWx0OgoJCQkJCQkJCQlfZ2wudmVydGV4QXR0cmliMWZ2KCBwcm9ncmFtQXR0cmlidXRlLCB2YWx1ZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgoJCX0KCgkJLy8gQ29tcGlsZQoKCQl0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbiAoIHNjZW5lLCBjYW1lcmEgKSB7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgY2FtZXJhICk7CgkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5pbml0KCk7CgoJCQlzY2VuZS50cmF2ZXJzZSggZnVuY3Rpb24gKCBvYmplY3QgKSB7CgoJCQkJaWYgKCBvYmplY3QuaXNMaWdodCApIHsKCgkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyggb2JqZWN0ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9ICk7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoIGNhbWVyYSApOwoKCQkJc2NlbmUudHJhdmVyc2UoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJCWlmICggb2JqZWN0Lm1hdGVyaWFsICkgewoKCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG9iamVjdC5tYXRlcmlhbCApICkgewoKCQkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgb2JqZWN0Lm1hdGVyaWFsLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCQlpbml0TWF0ZXJpYWwoIG9iamVjdC5tYXRlcmlhbFsgaSBdLCBzY2VuZS5mb2csIG9iamVjdCApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaW5pdE1hdGVyaWFsKCBvYmplY3QubWF0ZXJpYWwsIHNjZW5lLmZvZywgb2JqZWN0ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9ICk7CgoJCX07CgoJCS8vIEFuaW1hdGlvbiBMb29wCgoJCXZhciBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBudWxsOwoKCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lICkgewoKCQkJaWYgKCB2ci5pc1ByZXNlbnRpbmcoKSApIHJldHVybjsKCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUgKTsKCgkJfQoKCQl2YXIgYW5pbWF0aW9uID0gbmV3IFdlYkdMQW5pbWF0aW9uKCk7CgkJYW5pbWF0aW9uLnNldEFuaW1hdGlvbkxvb3AoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgkJaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyApIGFuaW1hdGlvbi5zZXRDb250ZXh0KCB3aW5kb3cgKTsKCgkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCW9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IGNhbGxiYWNrOwoJCQl2ci5zZXRBbmltYXRpb25Mb29wKCBjYWxsYmFjayApOwoKCQkJYW5pbWF0aW9uLnN0YXJ0KCk7CgoJCX07CgoJCS8vIFJlbmRlcmluZwoKCQl0aGlzLnJlbmRlciA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSApIHsKCgkJCXZhciByZW5kZXJUYXJnZXQsIGZvcmNlQ2xlYXI7CgoJCQlpZiAoIGFyZ3VtZW50c1sgMiBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXIoKTogdGhlIHJlbmRlclRhcmdldCBhcmd1bWVudCBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLnNldFJlbmRlclRhcmdldCgpIGluc3RlYWQuJyApOwoJCQkJcmVuZGVyVGFyZ2V0ID0gYXJndW1lbnRzWyAyIF07CgoJCQl9CgoJCQlpZiAoIGFyZ3VtZW50c1sgMyBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXIoKTogdGhlIGZvcmNlQ2xlYXIgYXJndW1lbnQgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIC5jbGVhcigpIGluc3RlYWQuJyApOwoJCQkJZm9yY2VDbGVhciA9IGFyZ3VtZW50c1sgMyBdOwoKCQkJfQoKCQkJaWYgKCAhICggY2FtZXJhICYmIGNhbWVyYS5pc0NhbWVyYSApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlbmRlcjogY2FtZXJhIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5DYW1lcmEuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBfaXNDb250ZXh0TG9zdCApIHJldHVybjsKCgkJCS8vIHJlc2V0IGNhY2hpbmcgZm9yIHRoaXMgZnJhbWUKCgkJCV9jdXJyZW50R2VvbWV0cnlQcm9ncmFtLmdlb21ldHJ5ID0gbnVsbDsKCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0ucHJvZ3JhbSA9IG51bGw7CgkJCV9jdXJyZW50R2VvbWV0cnlQcm9ncmFtLndpcmVmcmFtZSA9IGZhbHNlOwoJCQlfY3VycmVudE1hdGVyaWFsSWQgPSAtIDE7CgkJCV9jdXJyZW50Q2FtZXJhID0gbnVsbDsKCgkJCS8vIHVwZGF0ZSBzY2VuZSBncmFwaAoKCQkJaWYgKCBzY2VuZS5hdXRvVXBkYXRlID09PSB0cnVlICkgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTsKCgkJCS8vIHVwZGF0ZSBjYW1lcmEgbWF0cmljZXMgYW5kIGZydXN0dW0KCgkJCWlmICggY2FtZXJhLnBhcmVudCA9PT0gbnVsbCApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJaWYgKCB2ci5lbmFibGVkICkgewoKCQkJCWNhbWVyYSA9IHZyLmdldENhbWVyYSggY2FtZXJhICk7CgoJCQl9CgoJCQkvLwoKCQkJY3VycmVudFJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVzLmdldCggc2NlbmUsIGNhbWVyYSApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUuaW5pdCgpOwoKCQkJc2NlbmUub25CZWZvcmVSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCByZW5kZXJUYXJnZXQgfHwgX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJCV9mcnVzdHVtLnNldEZyb21NYXRyaXgoIF9wcm9qU2NyZWVuTWF0cml4ICk7CgoJCQlfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSB0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkOwoJCQlfY2xpcHBpbmdFbmFibGVkID0gX2NsaXBwaW5nLmluaXQoIHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCwgY2FtZXJhICk7CgoJCQljdXJyZW50UmVuZGVyTGlzdCA9IHJlbmRlckxpc3RzLmdldCggc2NlbmUsIGNhbWVyYSApOwoJCQljdXJyZW50UmVuZGVyTGlzdC5pbml0KCk7CgoJCQlwcm9qZWN0T2JqZWN0KCBzY2VuZSwgY2FtZXJhLCAwLCBfdGhpcy5zb3J0T2JqZWN0cyApOwoKCQkJaWYgKCBfdGhpcy5zb3J0T2JqZWN0cyA9PT0gdHJ1ZSApIHsKCgkJCQljdXJyZW50UmVuZGVyTGlzdC5zb3J0KCk7CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkICkgX2NsaXBwaW5nLmJlZ2luU2hhZG93cygpOwoKCQkJdmFyIHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgoJCQlzaGFkb3dNYXAucmVuZGVyKCBzaGFkb3dzQXJyYXksIHNjZW5lLCBjYW1lcmEgKTsKCgkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cyggY2FtZXJhICk7CgoJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgKSBfY2xpcHBpbmcuZW5kU2hhZG93cygpOwoKCQkJLy8KCgkJCWlmICggdGhpcy5pbmZvLmF1dG9SZXNldCApIHRoaXMuaW5mby5yZXNldCgpOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCQkvLwoKCQkJYmFja2dyb3VuZC5yZW5kZXIoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhLCBmb3JjZUNsZWFyICk7CgoJCQkvLyByZW5kZXIgc2NlbmUKCgkJCXZhciBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwoJCQl2YXIgdHJhbnNwYXJlbnRPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNwYXJlbnQ7CgoJCQlpZiAoIHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgKSB7CgoJCQkJdmFyIG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5vdmVycmlkZU1hdGVyaWFsOwoKCQkJCWlmICggb3BhcXVlT2JqZWN0cy5sZW5ndGggKSByZW5kZXJPYmplY3RzKCBvcGFxdWVPYmplY3RzLCBzY2VuZSwgY2FtZXJhLCBvdmVycmlkZU1hdGVyaWFsICk7CgkJCQlpZiAoIHRyYW5zcGFyZW50T2JqZWN0cy5sZW5ndGggKSByZW5kZXJPYmplY3RzKCB0cmFuc3BhcmVudE9iamVjdHMsIHNjZW5lLCBjYW1lcmEsIG92ZXJyaWRlTWF0ZXJpYWwgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gb3BhcXVlIHBhc3MgKGZyb250LXRvLWJhY2sgb3JkZXIpCgoJCQkJaWYgKCBvcGFxdWVPYmplY3RzLmxlbmd0aCApIHJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCQkvLyB0cmFuc3BhcmVudCBwYXNzIChiYWNrLXRvLWZyb250IG9yZGVyKQoKCQkJCWlmICggdHJhbnNwYXJlbnRPYmplY3RzLmxlbmd0aCApIHJlbmRlck9iamVjdHMoIHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJfQoKCQkJLy8KCgkJCXNjZW5lLm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhICk7CgoJCQkvLwoKCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCgkJCQkvLyBHZW5lcmF0ZSBtaXBtYXAgaWYgd2UncmUgdXNpbmcgYW55IGtpbmQgb2YgbWlwbWFwIGZpbHRlcmluZwoKCQkJCXRleHR1cmVzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCQkvLyByZXNvbHZlIG11bHRpc2FtcGxlIHJlbmRlcmJ1ZmZlcnMgdG8gYSBzaW5nbGUtc2FtcGxlIHRleHR1cmUgaWYgbmVjZXNzYXJ5CgoJCQkJdGV4dHVyZXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCQkvLyBFbnN1cmUgZGVwdGggYnVmZmVyIHdyaXRpbmcgaXMgZW5hYmxlZCBzbyBpdCBjYW4gYmUgY2xlYXJlZCBvbiBuZXh0IHJlbmRlcgoKCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRUZXN0KCB0cnVlICk7CgkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayggdHJ1ZSApOwoJCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldE1hc2soIHRydWUgKTsKCgkJCXN0YXRlLnNldFBvbHlnb25PZmZzZXQoIGZhbHNlICk7CgoJCQlpZiAoIHZyLmVuYWJsZWQgKSB7CgoJCQkJdnIuc3VibWl0RnJhbWUoKTsKCgkJCX0KCgkJCS8vIF9nbC5maW5pc2goKTsKCgkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gbnVsbDsKCQkJY3VycmVudFJlbmRlclN0YXRlID0gbnVsbDsKCgkJfTsKCgkJZnVuY3Rpb24gcHJvamVjdE9iamVjdCggb2JqZWN0LCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzICkgewoKCQkJaWYgKCBvYmplY3QudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQl2YXIgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKCQkJaWYgKCB2aXNpYmxlICkgewoKCQkJCWlmICggb2JqZWN0LmlzR3JvdXAgKSB7CgoJCQkJCWdyb3VwT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGlnaHQgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQoIG9iamVjdCApOwoKCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzU3ByaXRlICkgewoKCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c1Nwcml0ZSggb2JqZWN0ICkgKSB7CgoJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKCQkJCQkJCV92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJCQkJfQoKCQkJCQkJdmFyIGdlb21ldHJ5ID0gb2JqZWN0cy51cGRhdGUoIG9iamVjdCApOwoJCQkJCQl2YXIgbWF0ZXJpYWwgPSBvYmplY3QubWF0ZXJpYWw7CgoJCQkJCQlpZiAoIG1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3IzLnosIG51bGwgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0ltbWVkaWF0ZVJlbmRlck9iamVjdCApIHsKCgkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCgkJCQkJCV92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCS5hcHBseU1hdHJpeDQoIF9wcm9qU2NyZWVuTWF0cml4ICk7CgoJCQkJCX0KCgkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBudWxsLCBvYmplY3QubWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3IzLnosIG51bGwgKTsKCgkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc0xpbmUgfHwgb2JqZWN0LmlzUG9pbnRzICkgewoKCQkJCQlpZiAoIG9iamVjdC5pc1NraW5uZWRNZXNoICkgewoKCQkJCQkJb2JqZWN0LnNrZWxldG9uLnVwZGF0ZSgpOwoKCQkJCQl9CgoJCQkJCWlmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApIHsKCgkJCQkJCWlmICggc29ydE9iamVjdHMgKSB7CgoJCQkJCQkJX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBvYmplY3QubWF0cml4V29ybGQgKQoJCQkJCQkJCS5hcHBseU1hdHJpeDQoIF9wcm9qU2NyZWVuTWF0cml4ICk7CgoJCQkJCQl9CgoJCQkJCQl2YXIgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQkJCXZhciBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJCQl2YXIgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCQl2YXIgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQl2YXIgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJCWlmICggZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBncm91cE1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBncm91cCApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjMueiwgbnVsbCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdmFyIGNoaWxkcmVuID0gb2JqZWN0LmNoaWxkcmVuOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlwcm9qZWN0T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyggcmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSwgb3ZlcnJpZGVNYXRlcmlhbCApIHsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IHJlbmRlckxpc3QubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgcmVuZGVySXRlbSA9IHJlbmRlckxpc3RbIGkgXTsKCgkJCQl2YXIgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQl2YXIgZ2VvbWV0cnkgPSByZW5kZXJJdGVtLmdlb21ldHJ5OwoJCQkJdmFyIG1hdGVyaWFsID0gb3ZlcnJpZGVNYXRlcmlhbCA9PT0gdW5kZWZpbmVkID8gcmVuZGVySXRlbS5tYXRlcmlhbCA6IG92ZXJyaWRlTWF0ZXJpYWw7CgkJCQl2YXIgZ3JvdXAgPSByZW5kZXJJdGVtLmdyb3VwOwoKCQkJCWlmICggY2FtZXJhLmlzQXJyYXlDYW1lcmEgKSB7CgoJCQkJCV9jdXJyZW50QXJyYXlDYW1lcmEgPSBjYW1lcmE7CgoJCQkJCXZhciBjYW1lcmFzID0gY2FtZXJhLmNhbWVyYXM7CgoJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBjYW1lcmFzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJdmFyIGNhbWVyYTIgPSBjYW1lcmFzWyBqIF07CgoJCQkJCQlpZiAoIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhMi5sYXllcnMgKSApIHsKCgkJCQkJCQlpZiAoICd2aWV3cG9ydCcgaW4gY2FtZXJhMiApIHsgLy8gWFIKCgkJCQkJCQkJc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQuY29weSggY2FtZXJhMi52aWV3cG9ydCApICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJdmFyIGJvdW5kcyA9IGNhbWVyYTIuYm91bmRzOwoKCQkJCQkJCQl2YXIgeCA9IGJvdW5kcy54ICogX3dpZHRoOwoJCQkJCQkJCXZhciB5ID0gYm91bmRzLnkgKiBfaGVpZ2h0OwoJCQkJCQkJCXZhciB3aWR0aCA9IGJvdW5kcy56ICogX3dpZHRoOwoJCQkJCQkJCXZhciBoZWlnaHQgPSBib3VuZHMudyAqIF9oZWlnaHQ7CgoJCQkJCQkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LnNldCggeCwgeSwgd2lkdGgsIGhlaWdodCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApICk7CgoJCQkJCQkJfQoKCQkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cyggY2FtZXJhMiApOwoKCQkJCQkJCXJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhMiwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2N1cnJlbnRBcnJheUNhbWVyYSA9IG51bGw7CgoJCQkJCXJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICkgewoKCQkJb2JqZWN0Lm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgX2N1cnJlbnRBcnJheUNhbWVyYSB8fCBjYW1lcmEgKTsKCgkJCW9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgkJCW9iamVjdC5ub3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CgoJCQlpZiAoIG9iamVjdC5pc0ltbWVkaWF0ZVJlbmRlck9iamVjdCApIHsKCgkJCQlzdGF0ZS5zZXRNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCgkJCQl2YXIgcHJvZ3JhbSA9IHNldFByb2dyYW0oIGNhbWVyYSwgc2NlbmUuZm9nLCBtYXRlcmlhbCwgb2JqZWN0ICk7CgoJCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0uZ2VvbWV0cnkgPSBudWxsOwoJCQkJX2N1cnJlbnRHZW9tZXRyeVByb2dyYW0ucHJvZ3JhbSA9IG51bGw7CgkJCQlfY3VycmVudEdlb21ldHJ5UHJvZ3JhbS53aXJlZnJhbWUgPSBmYWxzZTsKCgkJCQlyZW5kZXJPYmplY3RJbW1lZGlhdGUoIG9iamVjdCwgcHJvZ3JhbSApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUuZm9nLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCX0KCgkJCW9iamVjdC5vbkFmdGVyUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgX2N1cnJlbnRBcnJheUNhbWVyYSB8fCBjYW1lcmEgKTsKCgkJfQoKCQlmdW5jdGlvbiBpbml0TWF0ZXJpYWwoIG1hdGVyaWFsLCBmb2csIG9iamVjdCApIHsKCgkJCXZhciBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCXZhciBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwoJCQl2YXIgc2hhZG93c0FycmF5ID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnNoYWRvd3NBcnJheTsKCgkJCXZhciBsaWdodHNIYXNoID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c0hhc2g7CgkJCXZhciBsaWdodHNTdGF0ZUhhc2ggPSBsaWdodHMuc3RhdGUuaGFzaDsKCgkJCXZhciBwYXJhbWV0ZXJzID0gcHJvZ3JhbUNhY2hlLmdldFBhcmFtZXRlcnMoCgkJCQltYXRlcmlhbCwgbGlnaHRzLnN0YXRlLCBzaGFkb3dzQXJyYXksIGZvZywgX2NsaXBwaW5nLm51bVBsYW5lcywgX2NsaXBwaW5nLm51bUludGVyc2VjdGlvbiwgb2JqZWN0ICk7CgoJCQl2YXIgY29kZSA9IHByb2dyYW1DYWNoZS5nZXRQcm9ncmFtQ29kZSggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKTsKCgkJCXZhciBwcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW07CgkJCXZhciBwcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCWlmICggcHJvZ3JhbSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIG5ldyBtYXRlcmlhbAoJCQkJbWF0ZXJpYWwuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKCQkJfSBlbHNlIGlmICggcHJvZ3JhbS5jb2RlICE9PSBjb2RlICkgewoKCQkJCS8vIGNoYW5nZWQgZ2xzbCBvciBwYXJhbWV0ZXJzCgkJCQlyZWxlYXNlTWF0ZXJpYWxQcm9ncmFtUmVmZXJlbmNlKCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbGlnaHRzSGFzaC5zdGF0ZUlEICE9PSBsaWdodHNTdGF0ZUhhc2guc3RhdGVJRCB8fAoJCQkJbGlnaHRzSGFzaC5kaXJlY3Rpb25hbExlbmd0aCAhPT0gbGlnaHRzU3RhdGVIYXNoLmRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCQlsaWdodHNIYXNoLnBvaW50TGVuZ3RoICE9PSBsaWdodHNTdGF0ZUhhc2gucG9pbnRMZW5ndGggfHwKCQkJCWxpZ2h0c0hhc2guc3BvdExlbmd0aCAhPT0gbGlnaHRzU3RhdGVIYXNoLnNwb3RMZW5ndGggfHwKCQkJCWxpZ2h0c0hhc2gucmVjdEFyZWFMZW5ndGggIT09IGxpZ2h0c1N0YXRlSGFzaC5yZWN0QXJlYUxlbmd0aCB8fAoJCQkJbGlnaHRzSGFzaC5oZW1pTGVuZ3RoICE9PSBsaWdodHNTdGF0ZUhhc2guaGVtaUxlbmd0aCB8fAoJCQkJbGlnaHRzSGFzaC5zaGFkb3dzTGVuZ3RoICE9PSBsaWdodHNTdGF0ZUhhc2guc2hhZG93c0xlbmd0aCApIHsKCgkJCQlsaWdodHNIYXNoLnN0YXRlSUQgPSBsaWdodHNTdGF0ZUhhc2guc3RhdGVJRDsKCQkJCWxpZ2h0c0hhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBsaWdodHNTdGF0ZUhhc2guZGlyZWN0aW9uYWxMZW5ndGg7CgkJCQlsaWdodHNIYXNoLnBvaW50TGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLnBvaW50TGVuZ3RoOwoJCQkJbGlnaHRzSGFzaC5zcG90TGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLnNwb3RMZW5ndGg7CgkJCQlsaWdodHNIYXNoLnJlY3RBcmVhTGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLnJlY3RBcmVhTGVuZ3RoOwoJCQkJbGlnaHRzSGFzaC5oZW1pTGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLmhlbWlMZW5ndGg7CgkJCQlsaWdodHNIYXNoLnNoYWRvd3NMZW5ndGggPSBsaWdodHNTdGF0ZUhhc2guc2hhZG93c0xlbmd0aDsKCgkJCQlwcm9ncmFtQ2hhbmdlID0gZmFsc2U7CgoJCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJLy8gc2FtZSBnbHNsIGFuZCB1bmlmb3JtIGxpc3QKCQkJCXJldHVybjsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gb25seSByZWJ1aWxkIHVuaWZvcm0gbGlzdAoJCQkJcHJvZ3JhbUNoYW5nZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBwcm9ncmFtQ2hhbmdlICkgewoKCQkJCWlmICggcGFyYW1ldGVycy5zaGFkZXJJRCApIHsKCgkJCQkJdmFyIHNoYWRlciA9IFNoYWRlckxpYlsgcGFyYW1ldGVycy5zaGFkZXJJRCBdOwoKCQkJCQltYXRlcmlhbFByb3BlcnRpZXMuc2hhZGVyID0gewoJCQkJCQluYW1lOiBtYXRlcmlhbC50eXBlLAoJCQkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3Jtcyggc2hhZGVyLnVuaWZvcm1zICksCgkJCQkJCXZlcnRleFNoYWRlcjogc2hhZGVyLnZlcnRleFNoYWRlciwKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IHNoYWRlci5mcmFnbWVudFNoYWRlcgoJCQkJCX07CgoJCQkJfSBlbHNlIHsKCgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnNoYWRlciA9IHsKCQkJCQkJbmFtZTogbWF0ZXJpYWwudHlwZSwKCQkJCQkJdW5pZm9ybXM6IG1hdGVyaWFsLnVuaWZvcm1zLAoJCQkJCQl2ZXJ0ZXhTaGFkZXI6IG1hdGVyaWFsLnZlcnRleFNoYWRlciwKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IG1hdGVyaWFsLmZyYWdtZW50U2hhZGVyCgkJCQkJfTsKCgkJCQl9CgoJCQkJbWF0ZXJpYWwub25CZWZvcmVDb21waWxlKCBtYXRlcmlhbFByb3BlcnRpZXMuc2hhZGVyLCBfdGhpcyApOwoKCQkJCS8vIENvbXB1dGluZyBjb2RlIGFnYWluIGFzIG9uQmVmb3JlQ29tcGlsZSBtYXkgaGF2ZSBjaGFuZ2VkIHRoZSBzaGFkZXJzCgkJCQljb2RlID0gcHJvZ3JhbUNhY2hlLmdldFByb2dyYW1Db2RlKCBtYXRlcmlhbCwgcGFyYW1ldGVycyApOwoKCQkJCXByb2dyYW0gPSBwcm9ncmFtQ2FjaGUuYWNxdWlyZVByb2dyYW0oIG1hdGVyaWFsLCBtYXRlcmlhbFByb3BlcnRpZXMuc2hhZGVyLCBwYXJhbWV0ZXJzLCBjb2RlICk7CgoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW0gPSBwcm9ncmFtOwoJCQkJbWF0ZXJpYWwucHJvZ3JhbSA9IHByb2dyYW07CgoJCQl9CgoJCQl2YXIgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJCWlmICggbWF0ZXJpYWwubW9ycGhUYXJnZXRzICkgewoKCQkJCW1hdGVyaWFsLm51bVN1cHBvcnRlZE1vcnBoVGFyZ2V0cyA9IDA7CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgX3RoaXMubWF4TW9ycGhUYXJnZXRzOyBpICsrICkgewoKCQkJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGVzWyAnbW9ycGhUYXJnZXQnICsgaSBdID49IDAgKSB7CgoJCQkJCQltYXRlcmlhbC5udW1TdXBwb3J0ZWRNb3JwaFRhcmdldHMgKys7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLm1vcnBoTm9ybWFscyApIHsKCgkJCQltYXRlcmlhbC5udW1TdXBwb3J0ZWRNb3JwaE5vcm1hbHMgPSAwOwoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IF90aGlzLm1heE1vcnBoTm9ybWFsczsgaSArKyApIHsKCgkJCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlc1sgJ21vcnBoTm9ybWFsJyArIGkgXSA+PSAwICkgewoKCQkJCQkJbWF0ZXJpYWwubnVtU3VwcG9ydGVkTW9ycGhOb3JtYWxzICsrOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdmFyIHVuaWZvcm1zID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLnNoYWRlci51bmlmb3JtczsKCgkJCWlmICggISBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICYmCgkJCQkhIG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgfHwKCQkJCW1hdGVyaWFsLmNsaXBwaW5nID09PSB0cnVlICkgewoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyA9IF9jbGlwcGluZy5udW1QbGFuZXM7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uID0gX2NsaXBwaW5nLm51bUludGVyc2VjdGlvbjsKCQkJCXVuaWZvcm1zLmNsaXBwaW5nUGxhbmVzID0gX2NsaXBwaW5nLnVuaWZvcm07CgoJCQl9CgoJCQltYXRlcmlhbFByb3BlcnRpZXMuZm9nID0gZm9nOwoKCQkJLy8gc3RvcmUgdGhlIGxpZ2h0IHNldHVwIGl0IHdhcyBjcmVhdGVkIGZvcgoJCQlpZiAoIGxpZ2h0c0hhc2ggPT09IHVuZGVmaW5lZCApIHsKCgkJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzSGFzaCA9IGxpZ2h0c0hhc2ggPSB7fTsKCgkJCX0KCgkJCWxpZ2h0c0hhc2guc3RhdGVJRCA9IGxpZ2h0c1N0YXRlSGFzaC5zdGF0ZUlEOwoJCQlsaWdodHNIYXNoLmRpcmVjdGlvbmFsTGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLmRpcmVjdGlvbmFsTGVuZ3RoOwoJCQlsaWdodHNIYXNoLnBvaW50TGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLnBvaW50TGVuZ3RoOwoJCQlsaWdodHNIYXNoLnNwb3RMZW5ndGggPSBsaWdodHNTdGF0ZUhhc2guc3BvdExlbmd0aDsKCQkJbGlnaHRzSGFzaC5yZWN0QXJlYUxlbmd0aCA9IGxpZ2h0c1N0YXRlSGFzaC5yZWN0QXJlYUxlbmd0aDsKCQkJbGlnaHRzSGFzaC5oZW1pTGVuZ3RoID0gbGlnaHRzU3RhdGVIYXNoLmhlbWlMZW5ndGg7CgkJCWxpZ2h0c0hhc2guc2hhZG93c0xlbmd0aCA9IGxpZ2h0c1N0YXRlSGFzaC5zaGFkb3dzTGVuZ3RoOwoKCQkJaWYgKCBtYXRlcmlhbC5saWdodHMgKSB7CgoJCQkJLy8gd2lyZSB1cCB0aGUgbWF0ZXJpYWwgdG8gdGhpcyByZW5kZXJlcidzIGxpZ2h0aW5nIHN0YXRlCgoJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IudmFsdWUgPSBsaWdodHMuc3RhdGUuYW1iaWVudDsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90OwoJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWE7CgkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludDsKCQkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuaGVtaTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcDsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwoJCQkJdW5pZm9ybXMuc3BvdFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90U2hhZG93TWFwOwoJCQkJdW5pZm9ybXMuc3BvdFNoYWRvd01hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90U2hhZG93TWF0cml4OwoJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CgkJCQl1bmlmb3Jtcy5wb2ludFNoYWRvd01hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvd01hdHJpeDsKCQkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBhZGQgYXJlYSBsaWdodHMgc2hhZG93IGluZm8gdG8gdW5pZm9ybXMKCgkJCX0KCgkJCXZhciBwcm9nVW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbS5nZXRVbmlmb3JtcygpLAoJCQkJdW5pZm9ybXNMaXN0ID0KCQkJCQlXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZSggcHJvZ1VuaWZvcm1zLnNlcSwgdW5pZm9ybXMgKTsKCgkJCW1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QgPSB1bmlmb3Jtc0xpc3Q7CgoJCX0KCgkJZnVuY3Rpb24gc2V0UHJvZ3JhbSggY2FtZXJhLCBmb2csIG1hdGVyaWFsLCBvYmplY3QgKSB7CgoJCQlfdXNlZFRleHR1cmVVbml0cyA9IDA7CgoJCQl2YXIgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgkJCXZhciBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwoKCQkJdmFyIGxpZ2h0c0hhc2ggPSBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzSGFzaDsKCQkJdmFyIGxpZ2h0c1N0YXRlSGFzaCA9IGxpZ2h0cy5zdGF0ZS5oYXNoOwoKCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkICkgewoKCQkJCWlmICggX2xvY2FsQ2xpcHBpbmdFbmFibGVkIHx8IGNhbWVyYSAhPT0gX2N1cnJlbnRDYW1lcmEgKSB7CgoJCQkJCXZhciB1c2VDYWNoZSA9CgkJCQkJCWNhbWVyYSA9PT0gX2N1cnJlbnRDYW1lcmEgJiYKCQkJCQkJbWF0ZXJpYWwuaWQgPT09IF9jdXJyZW50TWF0ZXJpYWxJZDsKCgkJCQkJLy8gd2UgbWlnaHQgd2FudCB0byBjYWxsIHRoaXMgZnVuY3Rpb24gd2l0aCBzb21lIENsaXBwaW5nR3JvdXAKCQkJCQkvLyBvYmplY3QgaW5zdGVhZCBvZiB0aGUgbWF0ZXJpYWwsIG9uY2UgaXQgYmVjb21lcyBmZWFzaWJsZQoJCQkJCS8vICgjODQ2NSwgIzgzNzkpCgkJCQkJX2NsaXBwaW5nLnNldFN0YXRlKAoJCQkJCQltYXRlcmlhbC5jbGlwcGluZ1BsYW5lcywgbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbiwgbWF0ZXJpYWwuY2xpcFNoYWRvd3MsCgkJCQkJCWNhbWVyYSwgbWF0ZXJpYWxQcm9wZXJ0aWVzLCB1c2VDYWNoZSApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubmVlZHNVcGRhdGUgPT09IGZhbHNlICkgewoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmZvZyAmJiBtYXRlcmlhbFByb3BlcnRpZXMuZm9nICE9PSBmb2cgKSB7CgoJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5saWdodHMgJiYgKCBsaWdodHNIYXNoLnN0YXRlSUQgIT09IGxpZ2h0c1N0YXRlSGFzaC5zdGF0ZUlEIHx8CgkJCQkJbGlnaHRzSGFzaC5kaXJlY3Rpb25hbExlbmd0aCAhPT0gbGlnaHRzU3RhdGVIYXNoLmRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCQkJbGlnaHRzSGFzaC5wb2ludExlbmd0aCAhPT0gbGlnaHRzU3RhdGVIYXNoLnBvaW50TGVuZ3RoIHx8CgkJCQkJbGlnaHRzSGFzaC5zcG90TGVuZ3RoICE9PSBsaWdodHNTdGF0ZUhhc2guc3BvdExlbmd0aCB8fAoJCQkJCWxpZ2h0c0hhc2gucmVjdEFyZWFMZW5ndGggIT09IGxpZ2h0c1N0YXRlSGFzaC5yZWN0QXJlYUxlbmd0aCB8fAoJCQkJCWxpZ2h0c0hhc2guaGVtaUxlbmd0aCAhPT0gbGlnaHRzU3RhdGVIYXNoLmhlbWlMZW5ndGggfHwKCQkJCQlsaWdodHNIYXNoLnNoYWRvd3NMZW5ndGggIT09IGxpZ2h0c1N0YXRlSGFzaC5zaGFkb3dzTGVuZ3RoICkgKSB7CgoJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IHVuZGVmaW5lZCAmJgoJCQkJCSggbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUNsaXBwaW5nUGxhbmVzICE9PSBfY2xpcHBpbmcubnVtUGxhbmVzIHx8CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiAhPT0gX2NsaXBwaW5nLm51bUludGVyc2VjdGlvbiApICkgewoKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5uZWVkc1VwZGF0ZSApIHsKCgkJCQlpbml0TWF0ZXJpYWwoIG1hdGVyaWFsLCBmb2csIG9iamVjdCApOwoJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCX0KCgkJCXZhciByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwoJCQl2YXIgcmVmcmVzaE1hdGVyaWFsID0gZmFsc2U7CgkJCXZhciByZWZyZXNoTGlnaHRzID0gZmFsc2U7CgoJCQl2YXIgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5wcm9ncmFtLAoJCQkJcF91bmlmb3JtcyA9IHByb2dyYW0uZ2V0VW5pZm9ybXMoKSwKCQkJCW1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMuc2hhZGVyLnVuaWZvcm1zOwoKCQkJaWYgKCBzdGF0ZS51c2VQcm9ncmFtKCBwcm9ncmFtLnByb2dyYW0gKSApIHsKCgkJCQlyZWZyZXNoUHJvZ3JhbSA9IHRydWU7CgkJCQlyZWZyZXNoTWF0ZXJpYWwgPSB0cnVlOwoJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmlkICE9PSBfY3VycmVudE1hdGVyaWFsSWQgKSB7CgoJCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gbWF0ZXJpYWwuaWQ7CgoJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggcmVmcmVzaFByb2dyYW0gfHwgX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdwcm9qZWN0aW9uTWF0cml4JywgY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkgewoKCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdsb2dEZXB0aEJ1ZkZDJywKCQkJCQkJMi4wIC8gKCBNYXRoLmxvZyggY2FtZXJhLmZhciArIDEuMCApIC8gTWF0aC5MTjIgKSApOwoKCQkJCX0KCgkJCQlpZiAoIF9jdXJyZW50Q2FtZXJhICE9PSBjYW1lcmEgKSB7CgoJCQkJCV9jdXJyZW50Q2FtZXJhID0gY2FtZXJhOwoKCQkJCQkvLyBsaWdodGluZyB1bmlmb3JtcyBkZXBlbmQgb24gdGhlIGNhbWVyYSBzbyBlbmZvcmNlIGFuIHVwZGF0ZQoJCQkJCS8vIG5vdywgaW4gY2FzZSB0aGlzIG1hdGVyaWFsIHN1cHBvcnRzIGxpZ2h0cyAtIG9yIGxhdGVyLCB3aGVuCgkJCQkJLy8gdGhlIG5leHQgbWF0ZXJpYWwgdGhhdCBkb2VzIGdldHMgYWN0aXZhdGVkOgoKCQkJCQlyZWZyZXNoTWF0ZXJpYWwgPSB0cnVlOwkJLy8gc2V0IHRvIHRydWUgb24gbWF0ZXJpYWwgY2hhbmdlCgkJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CQkvLyByZW1haW5zIHNldCB1bnRpbCB1cGRhdGUgZG9uZQoKCQkJCX0KCgkJCQkvLyBsb2FkIG1hdGVyaWFsIHNwZWNpZmljIHVuaWZvcm1zCgkJCQkvLyAoc2hhZGVyIG1hdGVyaWFsIGFsc28gZ2V0cyB0aGVtIGZvciB0aGUgc2FrZSBvZiBnZW5lcmljaXR5KQoKCQkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCB8fAoJCQkJCW1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuZW52TWFwICkgewoKCQkJCQl2YXIgdUNhbVBvcyA9IHBfdW5pZm9ybXMubWFwLmNhbWVyYVBvc2l0aW9uOwoKCQkJCQlpZiAoIHVDYW1Qb3MgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXVDYW1Qb3Muc2V0VmFsdWUoIF9nbCwKCQkJCQkJCV92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCB8fAoJCQkJCW1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5za2lubmluZyApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAndmlld01hdHJpeCcsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBza2lubmluZyB1bmlmb3JtcyBtdXN0IGJlIHNldCBldmVuIGlmIG1hdGVyaWFsIGRpZG4ndCBjaGFuZ2UKCQkJLy8gYXV0by1zZXR0aW5nIG9mIHRleHR1cmUgdW5pdCBmb3IgYm9uZSB0ZXh0dXJlIG11c3QgZ28gYmVmb3JlIG90aGVyIHRleHR1cmVzCgkJCS8vIG5vdCBzdXJlIHdoeSwgYnV0IG90aGVyd2lzZSB3ZWlyZCB0aGluZ3MgaGFwcGVuCgoJCQlpZiAoIG1hdGVyaWFsLnNraW5uaW5nICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeCcgKTsKCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeEludmVyc2UnICk7CgoJCQkJdmFyIHNrZWxldG9uID0gb2JqZWN0LnNrZWxldG9uOwoKCQkJCWlmICggc2tlbGV0b24gKSB7CgoJCQkJCXZhciBib25lcyA9IHNrZWxldG9uLmJvbmVzOwoKCQkJCQlpZiAoIGNhcGFiaWxpdGllcy5mbG9hdFZlcnRleFRleHR1cmVzICkgewoKCQkJCQkJaWYgKCBza2VsZXRvbi5ib25lVGV4dHVyZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCS8vIGxheW91dCAoMSBtYXRyaXggPSA0IHBpeGVscykKCQkJCQkJCS8vICAgICAgUkdCQSBSR0JBIFJHQkEgUkdCQSAoPT4gY29sdW1uMSwgY29sdW1uMiwgY29sdW1uMywgY29sdW1uNCkKCQkJCQkJCS8vICB3aXRoICA4eDggIHBpeGVsIHRleHR1cmUgbWF4ICAgMTYgYm9uZXMgKiA0IHBpeGVscyA9ICAoOCAqIDgpCgkJCQkJCQkvLyAgICAgICAxNngxNiBwaXhlbCB0ZXh0dXJlIG1heCAgIDY0IGJvbmVzICogNCBwaXhlbHMgPSAoMTYgKiAxNikKCQkJCQkJCS8vICAgICAgIDMyeDMyIHBpeGVsIHRleHR1cmUgbWF4ICAyNTYgYm9uZXMgKiA0IHBpeGVscyA9ICgzMiAqIDMyKQoJCQkJCQkJLy8gICAgICAgNjR4NjQgcGl4ZWwgdGV4dHVyZSBtYXggMTAyNCBib25lcyAqIDQgcGl4ZWxzID0gKDY0ICogNjQpCgoKCQkJCQkJCXZhciBzaXplID0gTWF0aC5zcXJ0KCBib25lcy5sZW5ndGggKiA0ICk7IC8vIDQgcGl4ZWxzIG5lZWRlZCBmb3IgMSBtYXRyaXgKCQkJCQkJCXNpemUgPSBfTWF0aC5jZWlsUG93ZXJPZlR3byggc2l6ZSApOwoJCQkJCQkJc2l6ZSA9IE1hdGgubWF4KCBzaXplLCA0ICk7CgoJCQkJCQkJdmFyIGJvbmVNYXRyaWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoIHNpemUgKiBzaXplICogNCApOyAvLyA0IGZsb2F0cyBwZXIgUkdCQSBwaXhlbAoJCQkJCQkJYm9uZU1hdHJpY2VzLnNldCggc2tlbGV0b24uYm9uZU1hdHJpY2VzICk7IC8vIGNvcHkgY3VycmVudCB2YWx1ZXMKCgkJCQkJCQl2YXIgYm9uZVRleHR1cmUgPSBuZXcgRGF0YVRleHR1cmUoIGJvbmVNYXRyaWNlcywgc2l6ZSwgc2l6ZSwgUkdCQUZvcm1hdCwgRmxvYXRUeXBlICk7CgkJCQkJCQlib25lVGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQkJc2tlbGV0b24uYm9uZU1hdHJpY2VzID0gYm9uZU1hdHJpY2VzOwoJCQkJCQkJc2tlbGV0b24uYm9uZVRleHR1cmUgPSBib25lVGV4dHVyZTsKCQkJCQkJCXNrZWxldG9uLmJvbmVUZXh0dXJlU2l6ZSA9IHNpemU7CgoJCQkJCQl9CgoJCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdib25lVGV4dHVyZScsIHNrZWxldG9uLmJvbmVUZXh0dXJlICk7CgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlU2l6ZScsIHNrZWxldG9uLmJvbmVUZXh0dXJlU2l6ZSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBza2VsZXRvbiwgJ2JvbmVNYXRyaWNlcycgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWlmICggcmVmcmVzaE1hdGVyaWFsICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3RvbmVNYXBwaW5nRXhwb3N1cmUnLCBfdGhpcy50b25lTWFwcGluZ0V4cG9zdXJlICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd0b25lTWFwcGluZ1doaXRlUG9pbnQnLCBfdGhpcy50b25lTWFwcGluZ1doaXRlUG9pbnQgKTsKCgkJCQlpZiAoIG1hdGVyaWFsLmxpZ2h0cyApIHsKCgkJCQkJLy8gdGhlIGN1cnJlbnQgbWF0ZXJpYWwgcmVxdWlyZXMgbGlnaHRpbmcgaW5mbwoKCQkJCQkvLyBub3RlOiBhbGwgbGlnaHRpbmcgdW5pZm9ybXMgYXJlIGFsd2F5cyBzZXQgY29ycmVjdGx5CgkJCQkJLy8gdGhleSBzaW1wbHkgcmVmZXJlbmNlIHRoZSByZW5kZXJlcidzIHN0YXRlIGZvciB0aGVpcgoJCQkJCS8vIHZhbHVlcwoJCQkJCS8vCgkJCQkJLy8gdXNlIHRoZSBjdXJyZW50IG1hdGVyaWFsJ3MgLm5lZWRzVXBkYXRlIGZsYWdzIHRvIHNldAoJCQkJCS8vIHRoZSBHTCBzdGF0ZSB3aGVuIHJlcXVpcmVkCgoJCQkJCW1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCBtX3VuaWZvcm1zLCByZWZyZXNoTGlnaHRzICk7CgoJCQkJfQoKCQkJCS8vIHJlZnJlc2ggdW5pZm9ybXMgY29tbW9uIHRvIHNldmVyYWwgbWF0ZXJpYWxzCgoJCQkJaWYgKCBmb2cgJiYgbWF0ZXJpYWwuZm9nICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNGb2coIG1fdW5pZm9ybXMsIGZvZyApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEJhc2ljTWF0ZXJpYWwgKSB7CgoJCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgKSB7CgoJCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCQlyZWZyZXNoVW5pZm9ybXNMYW1iZXJ0KCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgKSB7CgoJCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgKSB7CgoJCQkJCQlyZWZyZXNoVW5pZm9ybXNUb29uKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVmcmVzaFVuaWZvcm1zUGhvbmcoIG1fdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIG1fdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQkJCWlmICggbWF0ZXJpYWwuaXNNZXNoUGh5c2ljYWxNYXRlcmlhbCApIHsKCgkJCQkJCXJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQoIG1fdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hNYXRjYXBNYXRlcmlhbCApIHsKCgkJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCQlyZWZyZXNoVW5pZm9ybXNNYXRjYXAoIG1fdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoRGVwdGhNYXRlcmlhbCApIHsKCgkJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJCXJlZnJlc2hVbmlmb3Jtc0RlcHRoKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgKSB7CgoJCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCQlyZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hOb3JtYWxNYXRlcmlhbCApIHsKCgkJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJCXJlZnJlc2hVbmlmb3Jtc05vcm1hbCggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc0xpbmVCYXNpY01hdGVyaWFsICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNMaW5lKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCQlpZiAoIG1hdGVyaWFsLmlzTGluZURhc2hlZE1hdGVyaWFsICkgewoKCQkJCQkJcmVmcmVzaFVuaWZvcm1zRGFzaCggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzUG9pbnRzTWF0ZXJpYWwgKSB7CgoJCQkJCXJlZnJlc2hVbmlmb3Jtc1BvaW50cyggbV91bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNTcHJpdGVzKCBtX3VuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgKSB7CgoJCQkJCW1fdW5pZm9ybXMuY29sb3IudmFsdWUgPSBtYXRlcmlhbC5jb2xvcjsKCQkJCQltX3VuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKCQkJCX0KCgkJCQkvLyBSZWN0QXJlYUxpZ2h0IFRleHR1cmUKCQkJCS8vIFRPRE8gKG1yZG9vYik6IEZpbmQgYSBuaWNlciBpbXBsZW1lbnRhdGlvbgoKCQkJCWlmICggbV91bmlmb3Jtcy5sdGNfMSAhPT0gdW5kZWZpbmVkICkgbV91bmlmb3Jtcy5sdGNfMS52YWx1ZSA9IFVuaWZvcm1zTGliLkxUQ18xOwoJCQkJaWYgKCBtX3VuaWZvcm1zLmx0Y18yICE9PSB1bmRlZmluZWQgKSBtX3VuaWZvcm1zLmx0Y18yLnZhbHVlID0gVW5pZm9ybXNMaWIuTFRDXzI7CgoJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCwgbV91bmlmb3JtcywgX3RoaXMgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCwgbV91bmlmb3JtcywgX3RoaXMgKTsKCQkJCW1hdGVyaWFsLnVuaWZvcm1zTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2NlbnRlcicsIG9iamVjdC5jZW50ZXIgKTsKCgkJCX0KCgkJCS8vIGNvbW1vbiBtYXRyaWNlcwoKCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnbW9kZWxWaWV3TWF0cml4Jywgb2JqZWN0Lm1vZGVsVmlld01hdHJpeCApOwoJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdub3JtYWxNYXRyaXgnLCBvYmplY3Qubm9ybWFsTWF0cml4ICk7CgkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ21vZGVsTWF0cml4Jywgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJfQoKCQkvLyBVbmlmb3JtcyAocmVmcmVzaCB1bmlmb3JtcyBvYmplY3RzKQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKCQkJaWYgKCBtYXRlcmlhbC5jb2xvciApIHsKCgkJCQl1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlID0gbWF0ZXJpYWwuY29sb3I7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlICkgewoKCQkJCXVuaWZvcm1zLmVtaXNzaXZlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmVtaXNzaXZlICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLmVtaXNzaXZlSW50ZW5zaXR5ICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyTWFwICkgewoKCQkJCXVuaWZvcm1zLnNwZWN1bGFyTWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmVudk1hcCApIHsKCgkJCQl1bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXA7CgoJCQkJLy8gZG9uJ3QgZmxpcCBDdWJlVGV4dHVyZSBlbnZNYXBzLCBmbGlwIGV2ZXJ5dGhpbmcgZWxzZToKCQkJCS8vICBXZWJHTFJlbmRlclRhcmdldEN1YmUgd2lsbCBiZSBmbGlwcGVkIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoJCQkJLy8gIFdlYkdMUmVuZGVyVGFyZ2V0Q3ViZS50ZXh0dXJlIHdpbGwgYmUgZmxpcHBlZCBiZWNhdXNlIGl0J3MgYSBUZXh0dXJlIGFuZCBOT1QgYSBDdWJlVGV4dHVyZQoJCQkJLy8gdGhpcyBjaGVjayBtdXN0IGJlIGhhbmRsZWQgZGlmZmVyZW50bHksIG9yIHJlbW92ZWQgZW50aXJlbHksIGlmIFdlYkdMUmVuZGVyVGFyZ2V0Q3ViZSB1c2VzIGEgQ3ViZVRleHR1cmUgaW4gdGhlIGZ1dHVyZQoJCQkJdW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcC5pc0N1YmVUZXh0dXJlID8gLSAxIDogMTsKCgkJCQl1bmlmb3Jtcy5yZWZsZWN0aXZpdHkudmFsdWUgPSBtYXRlcmlhbC5yZWZsZWN0aXZpdHk7CgkJCQl1bmlmb3Jtcy5yZWZyYWN0aW9uUmF0aW8udmFsdWUgPSBtYXRlcmlhbC5yZWZyYWN0aW9uUmF0aW87CgoJCQkJdW5pZm9ybXMubWF4TWlwTGV2ZWwudmFsdWUgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwuZW52TWFwICkuX19tYXhNaXBMZXZlbDsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubGlnaHRNYXAgKSB7CgoJCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKCQkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFvTWFwICkgewoKCQkJCXVuaWZvcm1zLmFvTWFwLnZhbHVlID0gbWF0ZXJpYWwuYW9NYXA7CgkJCQl1bmlmb3Jtcy5hb01hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwSW50ZW5zaXR5OwoKCQkJfQoKCQkJLy8gdXYgcmVwZWF0IGFuZCBvZmZzZXQgc2V0dGluZyBwcmlvcml0aWVzCgkJCS8vIDEuIGNvbG9yIG1hcAoJCQkvLyAyLiBzcGVjdWxhciBtYXAKCQkJLy8gMy4gbm9ybWFsIG1hcAoJCQkvLyA0LiBidW1wIG1hcAoJCQkvLyA1LiBhbHBoYSBtYXAKCQkJLy8gNi4gZW1pc3NpdmUgbWFwCgoJCQl2YXIgdXZTY2FsZU1hcDsKCgkJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5tYXA7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5zcGVjdWxhck1hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgKSB7CgoJCQkJdXZTY2FsZU1hcCA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLm5vcm1hbE1hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuYnVtcE1hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwuYnVtcE1hcDsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnJvdWdobmVzc01hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwubWV0YWxuZXNzTWFwICkgewoKCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5tZXRhbG5lc3NNYXA7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5hbHBoYU1hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCApIHsKCgkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQl9CgoJCQlpZiAoIHV2U2NhbGVNYXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQoJCQkJaWYgKCB1dlNjYWxlTWFwLmlzV2ViR0xSZW5kZXJUYXJnZXQgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSB1dlNjYWxlTWFwLnRleHR1cmU7CgoJCQkJfQoKCQkJCWlmICggdXZTY2FsZU1hcC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQl1dlNjYWxlTWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQl1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCB1dlNjYWxlTWFwLm1hdHJpeCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0xpbmUoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUgPSBtYXRlcmlhbC5jb2xvcjsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zRGFzaCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuZGFzaFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZTsKCQkJdW5pZm9ybXMudG90YWxTaXplLnZhbHVlID0gbWF0ZXJpYWwuZGFzaFNpemUgKyBtYXRlcmlhbC5nYXBTaXplOwoJCQl1bmlmb3Jtcy5zY2FsZS52YWx1ZSA9IG1hdGVyaWFsLnNjYWxlOwoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZSA9IG1hdGVyaWFsLmNvbG9yOwoJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCQkJdW5pZm9ybXMuc2l6ZS52YWx1ZSA9IG1hdGVyaWFsLnNpemUgKiBfcGl4ZWxSYXRpbzsKCQkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBfaGVpZ2h0ICogMC41OwoKCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKCQkJaWYgKCBtYXRlcmlhbC5tYXAgIT09IG51bGwgKSB7CgoJCQkJaWYgKCBtYXRlcmlhbC5tYXAubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJbWF0ZXJpYWwubWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQl1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5tYXAubWF0cml4ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZSA9IG1hdGVyaWFsLmNvbG9yOwoJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCQkJdW5pZm9ybXMucm90YXRpb24udmFsdWUgPSBtYXRlcmlhbC5yb3RhdGlvbjsKCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKCQkJaWYgKCBtYXRlcmlhbC5tYXAgIT09IG51bGwgKSB7CgoJCQkJaWYgKCBtYXRlcmlhbC5tYXAubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJbWF0ZXJpYWwubWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQl1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5tYXAubWF0cml4ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zRm9nKCB1bmlmb3JtcywgZm9nICkgewoKCQkJdW5pZm9ybXMuZm9nQ29sb3IudmFsdWUgPSBmb2cuY29sb3I7CgoJCQlpZiAoIGZvZy5pc0ZvZyApIHsKCgkJCQl1bmlmb3Jtcy5mb2dOZWFyLnZhbHVlID0gZm9nLm5lYXI7CgkJCQl1bmlmb3Jtcy5mb2dGYXIudmFsdWUgPSBmb2cuZmFyOwoKCQkJfSBlbHNlIGlmICggZm9nLmlzRm9nRXhwMiApIHsKCgkJCQl1bmlmb3Jtcy5mb2dEZW5zaXR5LnZhbHVlID0gZm9nLmRlbnNpdHk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTGFtYmVydCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCApIHsKCgkJCQl1bmlmb3Jtcy5lbWlzc2l2ZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmVtaXNzaXZlTWFwOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Bob25nKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQl1bmlmb3Jtcy5zcGVjdWxhci52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyOwoJCQl1bmlmb3Jtcy5zaGluaW5lc3MudmFsdWUgPSBNYXRoLm1heCggbWF0ZXJpYWwuc2hpbmluZXNzLCAxZS00ICk7IC8vIHRvIHByZXZlbnQgcG93KCAwLjAsIDAuMCApCgoJCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwICkgewoKCQkJCXVuaWZvcm1zLmVtaXNzaXZlTWFwLnZhbHVlID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgkJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CgkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlICo9IC0gMTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKCQkJCXVuaWZvcm1zLm5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKCQkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLm5vcm1hbFNjYWxlICk7CgkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zVG9vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zUGhvbmcoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJaWYgKCBtYXRlcmlhbC5ncmFkaWVudE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5ncmFkaWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmdyYWRpZW50TWFwOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1N0YW5kYXJkKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQl1bmlmb3Jtcy5yb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5yb3VnaG5lc3M7CgkJCXVuaWZvcm1zLm1ldGFsbmVzcy52YWx1ZSA9IG1hdGVyaWFsLm1ldGFsbmVzczsKCgkJCWlmICggbWF0ZXJpYWwucm91Z2huZXNzTWFwICkgewoKCQkJCXVuaWZvcm1zLnJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnJvdWdobmVzc01hcDsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubWV0YWxuZXNzTWFwICkgewoKCQkJCXVuaWZvcm1zLm1ldGFsbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLm1ldGFsbmVzc01hcDsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmVNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZW1pc3NpdmVNYXAudmFsdWUgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYnVtcE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5idW1wTWFwLnZhbHVlID0gbWF0ZXJpYWwuYnVtcE1hcDsKCQkJCXVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBTY2FsZTsKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgKj0gLSAxOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5ub3JtYWxNYXAgKSB7CgoJCQkJdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoJCQkJdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUuY29weSggbWF0ZXJpYWwubm9ybWFsU2NhbGUgKTsKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5uZWdhdGUoKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZW52TWFwICkgewoKCQkJCS8vdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwOyAvLyBwYXJ0IG9mIHVuaWZvcm1zIGNvbW1vbgoJCQkJdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl1bmlmb3Jtcy5yZWZsZWN0aXZpdHkudmFsdWUgPSBtYXRlcmlhbC5yZWZsZWN0aXZpdHk7IC8vIGFsc28gcGFydCBvZiB1bmlmb3JtcyBjb21tb24KCgkJCXVuaWZvcm1zLmNsZWFyQ29hdC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyQ29hdDsKCQkJdW5pZm9ybXMuY2xlYXJDb2F0Um91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJDb2F0Um91Z2huZXNzOwoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJaWYgKCBtYXRlcmlhbC5tYXRjYXAgKSB7CgoJCQkJdW5pZm9ybXMubWF0Y2FwLnZhbHVlID0gbWF0ZXJpYWwubWF0Y2FwOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5idW1wTWFwICkgewoKCQkJCXVuaWZvcm1zLmJ1bXBNYXAudmFsdWUgPSBtYXRlcmlhbC5idW1wTWFwOwoJCQkJdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuYnVtcFNjYWxlOwoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSAqPSAtIDE7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLm5vcm1hbE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5ub3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5ub3JtYWxNYXA7CgkJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5ub3JtYWxTY2FsZSApOwoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudEJpYXMudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0RlcHRoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQlpZiAoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zRGlzdGFuY2UoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJCXVuaWZvcm1zLnJlZmVyZW5jZVBvc2l0aW9uLnZhbHVlLmNvcHkoIG1hdGVyaWFsLnJlZmVyZW5jZVBvc2l0aW9uICk7CgkJCXVuaWZvcm1zLm5lYXJEaXN0YW5jZS52YWx1ZSA9IG1hdGVyaWFsLm5lYXJEaXN0YW5jZTsKCQkJdW5pZm9ybXMuZmFyRGlzdGFuY2UudmFsdWUgPSBtYXRlcmlhbC5mYXJEaXN0YW5jZTsKCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNOb3JtYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCWlmICggbWF0ZXJpYWwuYnVtcE1hcCApIHsKCgkJCQl1bmlmb3Jtcy5idW1wTWFwLnZhbHVlID0gbWF0ZXJpYWwuYnVtcE1hcDsKCQkJCXVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBTY2FsZTsKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgKj0gLSAxOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5ub3JtYWxNYXAgKSB7CgoJCQkJdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoJCQkJdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUuY29weSggbWF0ZXJpYWwubm9ybWFsU2NhbGUgKTsKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5uZWdhdGUoKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJfQoKCQkvLyBJZiB1bmlmb3JtcyBhcmUgbWFya2VkIGFzIGNsZWFuLCB0aGV5IGRvbid0IG5lZWQgdG8gYmUgbG9hZGVkIHRvIHRoZSBHUFUuCgoJCWZ1bmN0aW9uIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCB1bmlmb3JtcywgdmFsdWUgKSB7CgoJCQl1bmlmb3Jtcy5hbWJpZW50TGlnaHRDb2xvci5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoKCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJdW5pZm9ybXMucG9pbnRMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5yZWN0QXJlYUxpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgoJCX0KCgkJLy8gVGV4dHVyZXMKCgkJZnVuY3Rpb24gYWxsb2NUZXh0dXJlVW5pdCgpIHsKCgkJCXZhciB0ZXh0dXJlVW5pdCA9IF91c2VkVGV4dHVyZVVuaXRzOwoKCQkJaWYgKCB0ZXh0dXJlVW5pdCA+PSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXMgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICk7CgoJCQl9CgoJCQlfdXNlZFRleHR1cmVVbml0cyArPSAxOwoKCQkJcmV0dXJuIHRleHR1cmVVbml0OwoKCQl9CgoJCXRoaXMuYWxsb2NUZXh0dXJlVW5pdCA9IGFsbG9jVGV4dHVyZVVuaXQ7CgoJCS8vIHRoaXMuc2V0VGV4dHVyZTJEID0gc2V0VGV4dHVyZTJEOwoJCXRoaXMuc2V0VGV4dHVyZTJEID0gKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgd2FybmVkID0gZmFsc2U7CgoJCQkvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eTogcGVlbCB0ZXh0dXJlLnRleHR1cmUKCQkJcmV0dXJuIGZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCQlpZiAoIHRleHR1cmUgJiYgdGV4dHVyZS5pc1dlYkdMUmVuZGVyVGFyZ2V0ICkgewoKCQkJCQlpZiAoICEgd2FybmVkICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAiVEhSRUUuV2ViR0xSZW5kZXJlci5zZXRUZXh0dXJlMkQ6IGRvbid0IHVzZSByZW5kZXIgdGFyZ2V0cyBhcyB0ZXh0dXJlcy4gVXNlIHRoZWlyIC50ZXh0dXJlIHByb3BlcnR5IGluc3RlYWQuIiApOwoJCQkJCQl3YXJuZWQgPSB0cnVlOwoKCQkJCQl9CgoJCQkJCXRleHR1cmUgPSB0ZXh0dXJlLnRleHR1cmU7CgoJCQkJfQoKCQkJCXRleHR1cmVzLnNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApOwoKCQkJfTsKCgkJfSgpICk7CgoJCXRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBmdW5jdGlvbiAoIHRleHR1cmUsIHNsb3QgKSB7CgoJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheSggdGV4dHVyZSwgc2xvdCApOwoKCQl9OwoKCQl0aGlzLnNldFRleHR1cmUzRCA9IGZ1bmN0aW9uICggdGV4dHVyZSwgc2xvdCApIHsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApOwoKCQl9OwoKCQl0aGlzLnNldFRleHR1cmUgPSAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciB3YXJuZWQgPSBmYWxzZTsKCgkJCXJldHVybiBmdW5jdGlvbiBzZXRUZXh0dXJlKCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJCWlmICggISB3YXJuZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggIlRIUkVFLldlYkdMUmVuZGVyZXI6IC5zZXRUZXh0dXJlIGlzIGRlcHJlY2F0ZWQsIHVzZSBzZXRUZXh0dXJlMkQgaW5zdGVhZC4iICk7CgkJCQkJd2FybmVkID0gdHJ1ZTsKCgkJCQl9CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCBzbG90ICk7CgoJCQl9OwoKCQl9KCkgKTsKCgkJdGhpcy5zZXRUZXh0dXJlQ3ViZSA9ICggZnVuY3Rpb24gKCkgewoKCQkJdmFyIHdhcm5lZCA9IGZhbHNlOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJCS8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5OiBwZWVsIHRleHR1cmUudGV4dHVyZQoJCQkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNXZWJHTFJlbmRlclRhcmdldEN1YmUgKSB7CgoJCQkJCWlmICggISB3YXJuZWQgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICJUSFJFRS5XZWJHTFJlbmRlcmVyLnNldFRleHR1cmVDdWJlOiBkb24ndCB1c2UgY3ViZSByZW5kZXIgdGFyZ2V0cyBhcyB0ZXh0dXJlcy4gVXNlIHRoZWlyIC50ZXh0dXJlIHByb3BlcnR5IGluc3RlYWQuIiApOwoJCQkJCQl3YXJuZWQgPSB0cnVlOwoKCQkJCQl9CgoJCQkJCXRleHR1cmUgPSB0ZXh0dXJlLnRleHR1cmU7CgoJCQkJfQoKCQkJCS8vIGN1cnJlbnRseSByZWx5aW5nIG9uIHRoZSBmYWN0IHRoYXQgV2ViR0xSZW5kZXJUYXJnZXRDdWJlLnRleHR1cmUgaXMgYSBUZXh0dXJlIGFuZCBOT1QgYSBDdWJlVGV4dHVyZQoJCQkJLy8gVE9ETzogdW5pZnkgdGhlc2UgY29kZSBwYXRocwoJCQkJaWYgKCAoIHRleHR1cmUgJiYgdGV4dHVyZS5pc0N1YmVUZXh0dXJlICkgfHwKCQkJCQkoIEFycmF5LmlzQXJyYXkoIHRleHR1cmUuaW1hZ2UgKSAmJiB0ZXh0dXJlLmltYWdlLmxlbmd0aCA9PT0gNiApICkgewoKCQkJCQkvLyBDb21wcmVzc2VkVGV4dHVyZSBjYW4gaGF2ZSBBcnJheSBpbiBpbWFnZSA6LwoKCQkJCQkvLyB0aGlzIGZ1bmN0aW9uIGFsb25lIHNob3VsZCB0YWtlIGNhcmUgb2YgY3ViZSB0ZXh0dXJlcwoJCQkJCXRleHR1cmVzLnNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gYXNzdW1lZDogdGV4dHVyZSBwcm9wZXJ0eSBvZiBUSFJFRS5XZWJHTFJlbmRlclRhcmdldEN1YmUKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmVEeW5hbWljKCB0ZXh0dXJlLCBzbG90ICk7CgoJCQkJfQoKCQkJfTsKCgkJfSgpICk7CgoJCS8vCgoJCXRoaXMuc2V0RnJhbWVidWZmZXIgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJX2ZyYW1lYnVmZmVyID0gdmFsdWU7CgoJCX07CgoJCXRoaXMuZ2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9jdXJyZW50UmVuZGVyVGFyZ2V0OwoKCQl9OwoKCQl0aGlzLnNldFJlbmRlclRhcmdldCA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBhY3RpdmVDdWJlRmFjZSwgYWN0aXZlTWlwTWFwTGV2ZWwgKSB7CgoJCQlfY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKCgkJCWlmICggcmVuZGVyVGFyZ2V0ICYmIHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQl0ZXh0dXJlcy5zZXR1cFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCQl2YXIgZnJhbWVidWZmZXIgPSBfZnJhbWVidWZmZXI7CgkJCXZhciBpc0N1YmUgPSBmYWxzZTsKCgkJCWlmICggcmVuZGVyVGFyZ2V0ICkgewoKCQkJCXZhciBfX3dlYmdsRnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXRDdWJlICkgewoKCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2UgfHwgMCBdOwoJCQkJCWlzQ3ViZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldCApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCX0KCgkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIHJlbmRlclRhcmdldC52aWV3cG9ydCApOwoJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIHJlbmRlclRhcmdldC5zY2lzc29yICk7CgkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gcmVuZGVyVGFyZ2V0LnNjaXNzb3JUZXN0OwoKCQkJfSBlbHNlIHsKCgkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApOwoJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICk7CgkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gX3NjaXNzb3JUZXN0OwoKCQkJfQoKCQkJaWYgKCBfY3VycmVudEZyYW1lYnVmZmVyICE9PSBmcmFtZWJ1ZmZlciApIHsKCgkJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgZnJhbWVidWZmZXIgKTsKCQkJCV9jdXJyZW50RnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlcjsKCgkJCX0KCgkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0ICk7CgkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3NvciApOwoJCQlzdGF0ZS5zZXRTY2lzc29yVGVzdCggX2N1cnJlbnRTY2lzc29yVGVzdCApOwoKCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJdmFyIHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIDM2MTYwLCAzNjA2NCwgMzQwNjkgKyAoIGFjdGl2ZUN1YmVGYWNlIHx8IDAgKSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcE1hcExldmVsIHx8IDAgKTsKCgkJCX0KCgkJfTsKCgkJdGhpcy5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGJ1ZmZlciApIHsKCgkJCWlmICggISAoIHJlbmRlclRhcmdldCAmJiByZW5kZXJUYXJnZXQuaXNXZWJHTFJlbmRlclRhcmdldCApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdmFyIGZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xGcmFtZWJ1ZmZlcjsKCgkJCWlmICggZnJhbWVidWZmZXIgKSB7CgoJCQkJdmFyIHJlc3RvcmUgPSBmYWxzZTsKCgkJCQlpZiAoIGZyYW1lYnVmZmVyICE9PSBfY3VycmVudEZyYW1lYnVmZmVyICkgewoKCQkJCQlfZ2wuYmluZEZyYW1lYnVmZmVyKCAzNjE2MCwgZnJhbWVidWZmZXIgKTsKCgkJCQkJcmVzdG9yZSA9IHRydWU7CgoJCQkJfQoKCQkJCXRyeSB7CgoJCQkJCXZhciB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgkJCQkJdmFyIHRleHR1cmVGb3JtYXQgPSB0ZXh0dXJlLmZvcm1hdDsKCQkJCQl2YXIgdGV4dHVyZVR5cGUgPSB0ZXh0dXJlLnR5cGU7CgoJCQkJCWlmICggdGV4dHVyZUZvcm1hdCAhPT0gUkdCQUZvcm1hdCAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICkgIT09IF9nbC5nZXRQYXJhbWV0ZXIoIDM1NzM5ICkgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFJHQkEgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCBmb3JtYXQuJyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJaWYgKCB0ZXh0dXJlVHlwZSAhPT0gVW5zaWduZWRCeXRlVHlwZSAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApICE9PSBfZ2wuZ2V0UGFyYW1ldGVyKCAzNTczOCApICYmIC8vIElFMTEsIEVkZ2UgYW5kIENocm9tZSBNYWMgPCA1MiAoIzk1MTMpCgkJCQkJCSEgKCB0ZXh0dXJlVHlwZSA9PT0gRmxvYXRUeXBlICYmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfZmxvYXQnICkgfHwgZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb2xvcl9idWZmZXJfZmxvYXQnICkgKSApICYmIC8vIENocm9tZSBNYWMgPj0gNTIgYW5kIEZpcmVmb3gKCQkJCQkJISAoIHRleHR1cmVUeXBlID09PSBIYWxmRmxvYXRUeXBlICYmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gZXh0ZW5zaW9ucy5nZXQoICdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0JyApIDogZXh0ZW5zaW9ucy5nZXQoICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICkgKSApICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBpbiBVbnNpZ25lZEJ5dGVUeXBlIG9yIGltcGxlbWVudGF0aW9uIGRlZmluZWQgdHlwZS4nICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQlpZiAoIF9nbC5jaGVja0ZyYW1lYnVmZmVyU3RhdHVzKCAzNjE2MCApID09PSAzNjA1MyApIHsKCgkJCQkJCS8vIHRoZSBmb2xsb3dpbmcgaWYgc3RhdGVtZW50IGVuc3VyZXMgdmFsaWQgcmVhZCByZXF1ZXN0cyAobm8gb3V0LW9mLWJvdW5kcyBwaXhlbHMsIHNlZSAjODYwNCkKCgkJCQkJCWlmICggKCB4ID49IDAgJiYgeCA8PSAoIHJlbmRlclRhcmdldC53aWR0aCAtIHdpZHRoICkgKSAmJiAoIHkgPj0gMCAmJiB5IDw9ICggcmVuZGVyVGFyZ2V0LmhlaWdodCAtIGhlaWdodCApICkgKSB7CgoJCQkJCQkJX2dsLnJlYWRQaXhlbHMoIHgsIHksIHdpZHRoLCBoZWlnaHQsIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVGb3JtYXQgKSwgdXRpbHMuY29udmVydCggdGV4dHVyZVR5cGUgKSwgYnVmZmVyICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZWFkUGl4ZWxzIGZyb20gcmVuZGVyVGFyZ2V0IGZhaWxlZC4gRnJhbWVidWZmZXIgbm90IGNvbXBsZXRlLicgKTsKCgkJCQkJfQoKCQkJCX0gZmluYWxseSB7CgoJCQkJCWlmICggcmVzdG9yZSApIHsKCgkJCQkJCV9nbC5iaW5kRnJhbWVidWZmZXIoIDM2MTYwLCBfY3VycmVudEZyYW1lYnVmZmVyICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX07CgoJCXRoaXMuY29weUZyYW1lYnVmZmVyVG9UZXh0dXJlID0gZnVuY3Rpb24gKCBwb3NpdGlvbiwgdGV4dHVyZSwgbGV2ZWwgKSB7CgoJCQl2YXIgd2lkdGggPSB0ZXh0dXJlLmltYWdlLndpZHRoOwoJCQl2YXIgaGVpZ2h0ID0gdGV4dHVyZS5pbWFnZS5oZWlnaHQ7CgkJCXZhciBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0ICk7CgoJCQl0aGlzLnNldFRleHR1cmUyRCggdGV4dHVyZSwgMCApOwoKCQkJX2dsLmNvcHlUZXhJbWFnZTJEKCAzNTUzLCBsZXZlbCB8fCAwLCBnbEZvcm1hdCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgd2lkdGgsIGhlaWdodCwgMCApOwoKCQl9OwoKCQl0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlID0gZnVuY3Rpb24gKCBwb3NpdGlvbiwgc3JjVGV4dHVyZSwgZHN0VGV4dHVyZSwgbGV2ZWwgKSB7CgoJCQl2YXIgd2lkdGggPSBzcmNUZXh0dXJlLmltYWdlLndpZHRoOwoJCQl2YXIgaGVpZ2h0ID0gc3JjVGV4dHVyZS5pbWFnZS5oZWlnaHQ7CgkJCXZhciBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUuZm9ybWF0ICk7CgkJCXZhciBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCBkc3RUZXh0dXJlLnR5cGUgKTsKCgkJCXRoaXMuc2V0VGV4dHVyZTJEKCBkc3RUZXh0dXJlLCAwICk7CgoJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhVGV4dHVyZSApIHsKCgkJCQlfZ2wudGV4U3ViSW1hZ2UyRCggMzU1MywgbGV2ZWwgfHwgMCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgc3JjVGV4dHVyZS5pbWFnZS5kYXRhICk7CgoJCQl9IGVsc2UgewoKCQkJCV9nbC50ZXhTdWJJbWFnZTJEKCAzNTUzLCBsZXZlbCB8fCAwLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBnbEZvcm1hdCwgZ2xUeXBlLCBzcmNUZXh0dXJlLmltYWdlICk7CgoJCQl9CgoJCX07CgoJfQoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKi8KCglmdW5jdGlvbiBGb2dFeHAyKCBjb2xvciwgZGVuc2l0eSApIHsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIGNvbG9yICk7CgkJdGhpcy5kZW5zaXR5ID0gKCBkZW5zaXR5ICE9PSB1bmRlZmluZWQgKSA/IGRlbnNpdHkgOiAwLjAwMDI1OwoKCX0KCglPYmplY3QuYXNzaWduKCBGb2dFeHAyLnByb3RvdHlwZSwgewoKCQlpc0ZvZ0V4cDI6IHRydWUsCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IEZvZ0V4cDIoIHRoaXMuY29sb3IsIHRoaXMuZGVuc2l0eSApOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggLyogbWV0YSAqLyApIHsKCgkJCXJldHVybiB7CgkJCQl0eXBlOiAnRm9nRXhwMicsCgkJCQljb2xvcjogdGhpcy5jb2xvci5nZXRIZXgoKSwKCQkJCWRlbnNpdHk6IHRoaXMuZGVuc2l0eQoJCQl9OwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKi8KCglmdW5jdGlvbiBGb2coIGNvbG9yLCBuZWFyLCBmYXIgKSB7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCBjb2xvciApOwoKCQl0aGlzLm5lYXIgPSAoIG5lYXIgIT09IHVuZGVmaW5lZCApID8gbmVhciA6IDE7CgkJdGhpcy5mYXIgPSAoIGZhciAhPT0gdW5kZWZpbmVkICkgPyBmYXIgOiAxMDAwOwoKCX0KCglPYmplY3QuYXNzaWduKCBGb2cucHJvdG90eXBlLCB7CgoJCWlzRm9nOiB0cnVlLAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyBGb2coIHRoaXMuY29sb3IsIHRoaXMubmVhciwgdGhpcy5mYXIgKTsKCgkJfSwKCgkJdG9KU09OOiBmdW5jdGlvbiAoIC8qIG1ldGEgKi8gKSB7CgoJCQlyZXR1cm4gewoJCQkJdHlwZTogJ0ZvZycsCgkJCQljb2xvcjogdGhpcy5jb2xvci5nZXRIZXgoKSwKCQkJCW5lYXI6IHRoaXMubmVhciwKCQkJCWZhcjogdGhpcy5mYXIKCQkJfTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBTY2VuZSgpIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnU2NlbmUnOwoKCQl0aGlzLmJhY2tncm91bmQgPSBudWxsOwoJCXRoaXMuZm9nID0gbnVsbDsKCQl0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBudWxsOwoKCQl0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOyAvLyBjaGVja2VkIGJ5IHRoZSByZW5kZXJlcgoKCX0KCglTY2VuZS5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogU2NlbmUsCgoJCWlzU2NlbmU6IHRydWUsCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCQlPYmplY3QzRC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQkJaWYgKCBzb3VyY2UuYmFja2dyb3VuZCAhPT0gbnVsbCApIHRoaXMuYmFja2dyb3VuZCA9IHNvdXJjZS5iYWNrZ3JvdW5kLmNsb25lKCk7CgkJCWlmICggc291cmNlLmZvZyAhPT0gbnVsbCApIHRoaXMuZm9nID0gc291cmNlLmZvZy5jbG9uZSgpOwoJCQlpZiAoIHNvdXJjZS5vdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gc291cmNlLm92ZXJyaWRlTWF0ZXJpYWwuY2xvbmUoKTsKCgkJCXRoaXMuYXV0b1VwZGF0ZSA9IHNvdXJjZS5hdXRvVXBkYXRlOwoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggbWV0YSApIHsKCgkJCXZhciBkYXRhID0gT2JqZWN0M0QucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzLCBtZXRhICk7CgoJCQlpZiAoIHRoaXMuYmFja2dyb3VuZCAhPT0gbnVsbCApIGRhdGEub2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCBtZXRhICk7CgkJCWlmICggdGhpcy5mb2cgIT09IG51bGwgKSBkYXRhLm9iamVjdC5mb2cgPSB0aGlzLmZvZy50b0pTT04oKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQlkaXNwb3NlOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmVuYWFkYW1zIC8gaHR0cHM6Ly90d2l0dGVyLmNvbS9iZW5fYV9hZGFtcwoJICovCgoJZnVuY3Rpb24gSW50ZXJsZWF2ZWRCdWZmZXIoIGFycmF5LCBzdHJpZGUgKSB7CgoJCXRoaXMuYXJyYXkgPSBhcnJheTsKCQl0aGlzLnN0cmlkZSA9IHN0cmlkZTsKCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIHN0cmlkZSA6IDA7CgoJCXRoaXMuZHluYW1pYyA9IGZhbHNlOwoJCXRoaXMudXBkYXRlUmFuZ2UgPSB7IG9mZnNldDogMCwgY291bnQ6IC0gMSB9OwoKCQl0aGlzLnZlcnNpb24gPSAwOwoKCX0KCglPYmplY3QuZGVmaW5lUHJvcGVydHkoIEludGVybGVhdmVkQnVmZmVyLnByb3RvdHlwZSwgJ25lZWRzVXBkYXRlJywgewoKCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIEludGVybGVhdmVkQnVmZmVyLnByb3RvdHlwZSwgewoKCQlpc0ludGVybGVhdmVkQnVmZmVyOiB0cnVlLAoKCQlvblVwbG9hZENhbGxiYWNrOiBmdW5jdGlvbiAoKSB7fSwKCgkJc2V0QXJyYXk6IGZ1bmN0aW9uICggYXJyYXkgKSB7CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIGFycmF5ICkgKSB7CgoJCQkJdGhyb3cgbmV3IFR5cGVFcnJvciggJ1RIUkVFLkJ1ZmZlckF0dHJpYnV0ZTogYXJyYXkgc2hvdWxkIGJlIGEgVHlwZWQgQXJyYXkuJyApOwoKCQkJfQoKCQkJdGhpcy5jb3VudCA9IGFycmF5ICE9PSB1bmRlZmluZWQgPyBhcnJheS5sZW5ndGggLyB0aGlzLnN0cmlkZSA6IDA7CgkJCXRoaXMuYXJyYXkgPSBhcnJheTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXREeW5hbWljOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5keW5hbWljID0gdmFsdWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQl0aGlzLmFycmF5ID0gbmV3IHNvdXJjZS5hcnJheS5jb25zdHJ1Y3Rvciggc291cmNlLmFycmF5ICk7CgkJCXRoaXMuY291bnQgPSBzb3VyY2UuY291bnQ7CgkJCXRoaXMuc3RyaWRlID0gc291cmNlLnN0cmlkZTsKCQkJdGhpcy5keW5hbWljID0gc291cmNlLmR5bmFtaWM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29weUF0OiBmdW5jdGlvbiAoIGluZGV4MSwgYXR0cmlidXRlLCBpbmRleDIgKSB7CgoJCQlpbmRleDEgKj0gdGhpcy5zdHJpZGU7CgkJCWluZGV4MiAqPSBhdHRyaWJ1dGUuc3RyaWRlOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gdGhpcy5zdHJpZGU7IGkgPCBsOyBpICsrICkgewoKCQkJCXRoaXMuYXJyYXlbIGluZGV4MSArIGkgXSA9IGF0dHJpYnV0ZS5hcnJheVsgaW5kZXgyICsgaSBdOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSwgb2Zmc2V0ICkgewoKCQkJaWYgKCBvZmZzZXQgPT09IHVuZGVmaW5lZCApIG9mZnNldCA9IDA7CgoJCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCW9uVXBsb2FkOiBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKCQkJdGhpcy5vblVwbG9hZENhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmVuYWFkYW1zIC8gaHR0cHM6Ly90d2l0dGVyLmNvbS9iZW5fYV9hZGFtcwoJICovCgoJZnVuY3Rpb24gSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoIGludGVybGVhdmVkQnVmZmVyLCBpdGVtU2l6ZSwgb2Zmc2V0LCBub3JtYWxpemVkICkgewoKCQl0aGlzLmRhdGEgPSBpbnRlcmxlYXZlZEJ1ZmZlcjsKCQl0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CgkJdGhpcy5vZmZzZXQgPSBvZmZzZXQ7CgoJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQgPT09IHRydWU7CgoJfQoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUsIHsKCgkJY291bnQ6IHsKCgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLmRhdGEuY291bnQ7CgoJCQl9CgoJCX0sCgoJCWFycmF5OiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gdGhpcy5kYXRhLmFycmF5OwoKCQkJfQoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSwgewoKCQlpc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlOiB0cnVlLAoKCQlzZXRYOiBmdW5jdGlvbiAoIGluZGV4LCB4ICkgewoKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCBdID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRZOiBmdW5jdGlvbiAoIGluZGV4LCB5ICkgewoKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDEgXSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0WjogZnVuY3Rpb24gKCBpbmRleCwgeiApIHsKCgkJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAyIF0gPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFc6IGZ1bmN0aW9uICggaW5kZXgsIHcgKSB7CgoJCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMyBdID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlnZXRYOiBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJcmV0dXJuIHRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgXTsKCgkJfSwKCgkJZ2V0WTogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCXJldHVybiB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMSBdOwoKCQl9LAoKCQlnZXRaOiBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJcmV0dXJuIHRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAyIF07CgoJCX0sCgoJCWdldFc6IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDMgXTsKCgkJfSwKCgkJc2V0WFk6IGZ1bmN0aW9uICggaW5kZXgsIHgsIHkgKSB7CgoJCQlpbmRleCA9IGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwoKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFhZWjogZnVuY3Rpb24gKCBpbmRleCwgeCwgeSwgeiApIHsKCgkJCWluZGV4ID0gaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CgoJCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgkJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFhZWlc6IGZ1bmN0aW9uICggaW5kZXgsIHgsIHksIHosIHcgKSB7CgoJCQlpbmRleCA9IGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwoKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICsgMiBdID0gejsKCQkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDMgXSA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqICBjb2xvcjogPGhleD4sCgkgKiAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICogIHJvdGF0aW9uOiA8ZmxvYXQ+LAoJICogIHNpemVBdHRlbnVhdGlvbjogPGJvb2w+CgkgKiB9CgkgKi8KCglmdW5jdGlvbiBTcHJpdGVNYXRlcmlhbCggcGFyYW1ldGVycyApIHsKCgkJTWF0ZXJpYWwuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnU3ByaXRlTWF0ZXJpYWwnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOwoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5yb3RhdGlvbiA9IDA7CgoJCXRoaXMuc2l6ZUF0dGVudWF0aW9uID0gdHJ1ZTsKCgkJdGhpcy5saWdodHMgPSBmYWxzZTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJU3ByaXRlTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglTcHJpdGVNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTcHJpdGVNYXRlcmlhbDsKCVNwcml0ZU1hdGVyaWFsLnByb3RvdHlwZS5pc1Nwcml0ZU1hdGVyaWFsID0gdHJ1ZTsKCglTcHJpdGVNYXRlcmlhbC5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlNYXRlcmlhbC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgoJCXRoaXMuc2l6ZUF0dGVudWF0aW9uID0gc291cmNlLnNpemVBdHRlbnVhdGlvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJdmFyIGdlb21ldHJ5OwoKCWZ1bmN0aW9uIFNwcml0ZSggbWF0ZXJpYWwgKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1Nwcml0ZSc7CgoJCWlmICggZ2VvbWV0cnkgPT09IHVuZGVmaW5lZCApIHsKCgkJCWdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCQl2YXIgZmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggWwoJCQkJLSAwLjUsIC0gMC41LCAwLCAwLCAwLAoJCQkJMC41LCAtIDAuNSwgMCwgMSwgMCwKCQkJCTAuNSwgMC41LCAwLCAxLCAxLAoJCQkJLSAwLjUsIDAuNSwgMCwgMCwgMQoJCQldICk7CgoJCQl2YXIgaW50ZXJsZWF2ZWRCdWZmZXIgPSBuZXcgSW50ZXJsZWF2ZWRCdWZmZXIoIGZsb2F0MzJBcnJheSwgNSApOwoKCQkJZ2VvbWV0cnkuc2V0SW5kZXgoIFsgMCwgMSwgMiwJMCwgMiwgMyBdICk7CgkJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBpbnRlcmxlYXZlZEJ1ZmZlciwgMywgMCwgZmFsc2UgKSApOwoJCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW50ZXJsZWF2ZWRCdWZmZXIsIDIsIDMsIGZhbHNlICkgKTsKCgkJfQoKCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJdGhpcy5tYXRlcmlhbCA9ICggbWF0ZXJpYWwgIT09IHVuZGVmaW5lZCApID8gbWF0ZXJpYWwgOiBuZXcgU3ByaXRlTWF0ZXJpYWwoKTsKCgkJdGhpcy5jZW50ZXIgPSBuZXcgVmVjdG9yMiggMC41LCAwLjUgKTsKCgl9CgoJU3ByaXRlLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIE9iamVjdDNELnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBTcHJpdGUsCgoJCWlzU3ByaXRlOiB0cnVlLAoKCQlyYXljYXN0OiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB3b3JsZFNjYWxlID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG12UG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIGFsaWduZWRQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7CgkJCXZhciByb3RhdGVkUG9zaXRpb24gPSBuZXcgVmVjdG9yMigpOwoJCQl2YXIgdmlld1dvcmxkTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJCXZhciB2QSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2QiA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2QyA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgdXZBID0gbmV3IFZlY3RvcjIoKTsKCQkJdmFyIHV2QiA9IG5ldyBWZWN0b3IyKCk7CgkJCXZhciB1dkMgPSBuZXcgVmVjdG9yMigpOwoKCQkJZnVuY3Rpb24gdHJhbnNmb3JtVmVydGV4KCB2ZXJ0ZXhQb3NpdGlvbiwgbXZQb3NpdGlvbiwgY2VudGVyLCBzY2FsZSwgc2luLCBjb3MgKSB7CgoJCQkJLy8gY29tcHV0ZSBwb3NpdGlvbiBpbiBjYW1lcmEgc3BhY2UKCQkJCWFsaWduZWRQb3NpdGlvbi5zdWJWZWN0b3JzKCB2ZXJ0ZXhQb3NpdGlvbiwgY2VudGVyICkuYWRkU2NhbGFyKCAwLjUgKS5tdWx0aXBseSggc2NhbGUgKTsKCgkJCQkvLyB0byBjaGVjayBpZiByb3RhdGlvbiBpcyBub3QgemVybwoJCQkJaWYgKCBzaW4gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcm90YXRlZFBvc2l0aW9uLnggPSAoIGNvcyAqIGFsaWduZWRQb3NpdGlvbi54ICkgLSAoIHNpbiAqIGFsaWduZWRQb3NpdGlvbi55ICk7CgkJCQkJcm90YXRlZFBvc2l0aW9uLnkgPSAoIHNpbiAqIGFsaWduZWRQb3NpdGlvbi54ICkgKyAoIGNvcyAqIGFsaWduZWRQb3NpdGlvbi55ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcm90YXRlZFBvc2l0aW9uLmNvcHkoIGFsaWduZWRQb3NpdGlvbiApOwoKCQkJCX0KCgoJCQkJdmVydGV4UG9zaXRpb24uY29weSggbXZQb3NpdGlvbiApOwoJCQkJdmVydGV4UG9zaXRpb24ueCArPSByb3RhdGVkUG9zaXRpb24ueDsKCQkJCXZlcnRleFBvc2l0aW9uLnkgKz0gcm90YXRlZFBvc2l0aW9uLnk7CgoJCQkJLy8gdHJhbnNmb3JtIHRvIHdvcmxkIHNwYWNlCgkJCQl2ZXJ0ZXhQb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdXb3JsZE1hdHJpeCApOwoKCQkJfQoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJCQl3b3JsZFNjYWxlLnNldEZyb21NYXRyaXhTY2FsZSggdGhpcy5tYXRyaXhXb3JsZCApOwoJCQkJdmlld1dvcmxkTWF0cml4LmdldEludmVyc2UoIHRoaXMubW9kZWxWaWV3TWF0cml4ICkucHJlbXVsdGlwbHkoIHRoaXMubWF0cml4V29ybGQgKTsKCQkJCW12UG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1vZGVsVmlld01hdHJpeCApOwoKCQkJCXZhciByb3RhdGlvbiA9IHRoaXMubWF0ZXJpYWwucm90YXRpb247CgkJCQl2YXIgc2luLCBjb3M7CgkJCQlpZiAoIHJvdGF0aW9uICE9PSAwICkgewoKCQkJCQljb3MgPSBNYXRoLmNvcyggcm90YXRpb24gKTsKCQkJCQlzaW4gPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCgkJCQl9CgoJCQkJdmFyIGNlbnRlciA9IHRoaXMuY2VudGVyOwoKCQkJCXRyYW5zZm9ybVZlcnRleCggdkEuc2V0KCAtIDAuNSwgLSAwLjUsIDAgKSwgbXZQb3NpdGlvbiwgY2VudGVyLCB3b3JsZFNjYWxlLCBzaW4sIGNvcyApOwoJCQkJdHJhbnNmb3JtVmVydGV4KCB2Qi5zZXQoIDAuNSwgLSAwLjUsIDAgKSwgbXZQb3NpdGlvbiwgY2VudGVyLCB3b3JsZFNjYWxlLCBzaW4sIGNvcyApOwoJCQkJdHJhbnNmb3JtVmVydGV4KCB2Qy5zZXQoIDAuNSwgMC41LCAwICksIG12UG9zaXRpb24sIGNlbnRlciwgd29ybGRTY2FsZSwgc2luLCBjb3MgKTsKCgkJCQl1dkEuc2V0KCAwLCAwICk7CgkJCQl1dkIuc2V0KCAxLCAwICk7CgkJCQl1dkMuc2V0KCAxLCAxICk7CgoJCQkJLy8gY2hlY2sgZmlyc3QgdHJpYW5nbGUKCQkJCXZhciBpbnRlcnNlY3QgPSByYXljYXN0ZXIucmF5LmludGVyc2VjdFRyaWFuZ2xlKCB2QSwgdkIsIHZDLCBmYWxzZSwgaW50ZXJzZWN0UG9pbnQgKTsKCgkJCQlpZiAoIGludGVyc2VjdCA9PT0gbnVsbCApIHsKCgkJCQkJLy8gY2hlY2sgc2Vjb25kIHRyaWFuZ2xlCgkJCQkJdHJhbnNmb3JtVmVydGV4KCB2Qi5zZXQoIC0gMC41LCAwLjUsIDAgKSwgbXZQb3NpdGlvbiwgY2VudGVyLCB3b3JsZFNjYWxlLCBzaW4sIGNvcyApOwoJCQkJCXV2Qi5zZXQoIDAsIDEgKTsKCgkJCQkJaW50ZXJzZWN0ID0gcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RUcmlhbmdsZSggdkEsIHZDLCB2QiwgZmFsc2UsIGludGVyc2VjdFBvaW50ICk7CgkJCQkJaWYgKCBpbnRlcnNlY3QgPT09IG51bGwgKSB7CgoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQl9CgoJCQkJdmFyIGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJzZWN0UG9pbnQgKTsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuOwoKCQkJCWludGVyc2VjdHMucHVzaCggewoKCQkJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCQkJcG9pbnQ6IGludGVyc2VjdFBvaW50LmNsb25lKCksCgkJCQkJdXY6IFRyaWFuZ2xlLmdldFVWKCBpbnRlcnNlY3RQb2ludCwgdkEsIHZCLCB2QywgdXZBLCB1dkIsIHV2QywgbmV3IFZlY3RvcjIoKSApLAoJCQkJCWZhY2U6IG51bGwsCgkJCQkJb2JqZWN0OiB0aGlzCgoJCQkJfSApOwoKCQkJfTsKCgkJfSgpICksCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMubWF0ZXJpYWwgKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJT2JqZWN0M0QucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCQlpZiAoIHNvdXJjZS5jZW50ZXIgIT09IHVuZGVmaW5lZCApIHRoaXMuY2VudGVyLmNvcHkoIHNvdXJjZS5jZW50ZXIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIExPRCgpIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnTE9EJzsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIHRoaXMsIHsKCQkJbGV2ZWxzOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IFtdCgkJCX0KCQl9ICk7CgoJfQoKCUxPRC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogTE9ELAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCU9iamVjdDNELnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSwgZmFsc2UgKTsKCgkJCXZhciBsZXZlbHMgPSBzb3VyY2UubGV2ZWxzOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGxldmVsID0gbGV2ZWxzWyBpIF07CgoJCQkJdGhpcy5hZGRMZXZlbCggbGV2ZWwub2JqZWN0LmNsb25lKCksIGxldmVsLmRpc3RhbmNlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJYWRkTGV2ZWw6IGZ1bmN0aW9uICggb2JqZWN0LCBkaXN0YW5jZSApIHsKCgkJCWlmICggZGlzdGFuY2UgPT09IHVuZGVmaW5lZCApIGRpc3RhbmNlID0gMDsKCgkJCWRpc3RhbmNlID0gTWF0aC5hYnMoIGRpc3RhbmNlICk7CgoJCQl2YXIgbGV2ZWxzID0gdGhpcy5sZXZlbHM7CgoJCQlmb3IgKCB2YXIgbCA9IDA7IGwgPCBsZXZlbHMubGVuZ3RoOyBsICsrICkgewoKCQkJCWlmICggZGlzdGFuY2UgPCBsZXZlbHNbIGwgXS5kaXN0YW5jZSApIHsKCgkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJbGV2ZWxzLnNwbGljZSggbCwgMCwgeyBkaXN0YW5jZTogZGlzdGFuY2UsIG9iamVjdDogb2JqZWN0IH0gKTsKCgkJCXRoaXMuYWRkKCBvYmplY3QgKTsKCgkJfSwKCgkJZ2V0T2JqZWN0Rm9yRGlzdGFuY2U6IGZ1bmN0aW9uICggZGlzdGFuY2UgKSB7CgoJCQl2YXIgbGV2ZWxzID0gdGhpcy5sZXZlbHM7CgoJCQlmb3IgKCB2YXIgaSA9IDEsIGwgPSBsZXZlbHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgbGV2ZWxzWyBpIF0uZGlzdGFuY2UgKSB7CgoJCQkJCWJyZWFrOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBsZXZlbHNbIGkgLSAxIF0ub2JqZWN0OwoKCQl9LAoKCQlyYXljYXN0OiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBtYXRyaXhQb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQkJCW1hdHJpeFBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQkJCXZhciBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIG1hdHJpeFBvc2l0aW9uICk7CgoJCQkJdGhpcy5nZXRPYmplY3RGb3JEaXN0YW5jZSggZGlzdGFuY2UgKS5yYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKTsKCgkJCX07CgoJCX0oKSApLAoKCQl1cGRhdGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciB2MiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gdXBkYXRlKCBjYW1lcmEgKSB7CgoJCQkJdmFyIGxldmVscyA9IHRoaXMubGV2ZWxzOwoKCQkJCWlmICggbGV2ZWxzLmxlbmd0aCA+IDEgKSB7CgoJCQkJCXYxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJCQkJdjIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCQkJCXZhciBkaXN0YW5jZSA9IHYxLmRpc3RhbmNlVG8oIHYyICk7CgoJCQkJCWxldmVsc1sgMCBdLm9iamVjdC52aXNpYmxlID0gdHJ1ZTsKCgkJCQkJZm9yICggdmFyIGkgPSAxLCBsID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQlpZiAoIGRpc3RhbmNlID49IGxldmVsc1sgaSBdLmRpc3RhbmNlICkgewoKCQkJCQkJCWxldmVsc1sgaSAtIDEgXS5vYmplY3QudmlzaWJsZSA9IGZhbHNlOwoJCQkJCQkJbGV2ZWxzWyBpIF0ub2JqZWN0LnZpc2libGUgPSB0cnVlOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlicmVhazsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlmb3IgKCA7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJbGV2ZWxzWyBpIF0ub2JqZWN0LnZpc2libGUgPSBmYWxzZTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCX0oKSwKCgkJdG9KU09OOiBmdW5jdGlvbiAoIG1ldGEgKSB7CgoJCQl2YXIgZGF0YSA9IE9iamVjdDNELnByb3RvdHlwZS50b0pTT04uY2FsbCggdGhpcywgbWV0YSApOwoKCQkJZGF0YS5vYmplY3QubGV2ZWxzID0gW107CgoJCQl2YXIgbGV2ZWxzID0gdGhpcy5sZXZlbHM7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBsZXZlbHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgbGV2ZWwgPSBsZXZlbHNbIGkgXTsKCgkJCQlkYXRhLm9iamVjdC5sZXZlbHMucHVzaCggewoJCQkJCW9iamVjdDogbGV2ZWwub2JqZWN0LnV1aWQsCgkJCQkJZGlzdGFuY2U6IGxldmVsLmRpc3RhbmNlCgkJCQl9ICk7CgoJCQl9CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbWlrYWVsIGVtdGluZ2VyIC8gaHR0cDovL2dvbW8uc2UvCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBpa2VyciAvIGh0dHA6Ly92ZXJvbGQuY29tCgkgKi8KCglmdW5jdGlvbiBTa2lubmVkTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlpZiAoIGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuU2tpbm5lZE1lc2ggbm8gbG9uZ2VyIHN1cHBvcnRzIFRIUkVFLkdlb21ldHJ5LiBVc2UgVEhSRUUuQnVmZmVyR2VvbWV0cnkgaW5zdGVhZC4nICk7CgoJCX0KCgkJTWVzaC5jYWxsKCB0aGlzLCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy50eXBlID0gJ1NraW5uZWRNZXNoJzsKCgkJdGhpcy5iaW5kTW9kZSA9ICdhdHRhY2hlZCc7CgkJdGhpcy5iaW5kTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgl9CgoJU2tpbm5lZE1lc2gucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggTWVzaC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogU2tpbm5lZE1lc2gsCgoJCWlzU2tpbm5lZE1lc2g6IHRydWUsCgoJCWJpbmQ6IGZ1bmN0aW9uICggc2tlbGV0b24sIGJpbmRNYXRyaXggKSB7CgoJCQl0aGlzLnNrZWxldG9uID0gc2tlbGV0b247CgoJCQlpZiAoIGJpbmRNYXRyaXggPT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQkJdGhpcy5za2VsZXRvbi5jYWxjdWxhdGVJbnZlcnNlcygpOwoKCQkJCWJpbmRNYXRyaXggPSB0aGlzLm1hdHJpeFdvcmxkOwoKCQkJfQoKCQkJdGhpcy5iaW5kTWF0cml4LmNvcHkoIGJpbmRNYXRyaXggKTsKCQkJdGhpcy5iaW5kTWF0cml4SW52ZXJzZS5nZXRJbnZlcnNlKCBiaW5kTWF0cml4ICk7CgoJCX0sCgoJCXBvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuc2tlbGV0b24ucG9zZSgpOwoKCQl9LAoKCQlub3JtYWxpemVTa2luV2VpZ2h0czogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHZlY3RvciA9IG5ldyBWZWN0b3I0KCk7CgoJCQl2YXIgc2tpbldlaWdodCA9IHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5za2luV2VpZ2h0OwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc2tpbldlaWdodC5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmVjdG9yLnggPSBza2luV2VpZ2h0LmdldFgoIGkgKTsKCQkJCXZlY3Rvci55ID0gc2tpbldlaWdodC5nZXRZKCBpICk7CgkJCQl2ZWN0b3IueiA9IHNraW5XZWlnaHQuZ2V0WiggaSApOwoJCQkJdmVjdG9yLncgPSBza2luV2VpZ2h0LmdldFcoIGkgKTsKCgkJCQl2YXIgc2NhbGUgPSAxLjAgLyB2ZWN0b3IubWFuaGF0dGFuTGVuZ3RoKCk7CgoJCQkJaWYgKCBzY2FsZSAhPT0gSW5maW5pdHkgKSB7CgoJCQkJCXZlY3Rvci5tdWx0aXBseVNjYWxhciggc2NhbGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl2ZWN0b3Iuc2V0KCAxLCAwLCAwLCAwICk7IC8vIGRvIHNvbWV0aGluZyByZWFzb25hYmxlCgoJCQkJfQoKCQkJCXNraW5XZWlnaHQuc2V0WFlaVyggaSwgdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiwgdmVjdG9yLncgKTsKCgkJCX0KCgkJfSwKCgkJdXBkYXRlTWF0cml4V29ybGQ6IGZ1bmN0aW9uICggZm9yY2UgKSB7CgoJCQlNZXNoLnByb3RvdHlwZS51cGRhdGVNYXRyaXhXb3JsZC5jYWxsKCB0aGlzLCBmb3JjZSApOwoKCQkJaWYgKCB0aGlzLmJpbmRNb2RlID09PSAnYXR0YWNoZWQnICkgewoKCQkJCXRoaXMuYmluZE1hdHJpeEludmVyc2UuZ2V0SW52ZXJzZSggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQkJfSBlbHNlIGlmICggdGhpcy5iaW5kTW9kZSA9PT0gJ2RldGFjaGVkJyApIHsKCgkJCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmdldEludmVyc2UoIHRoaXMuYmluZE1hdHJpeCApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Ta2lubmVkTWVzaDogVW5yZWNvZ25pemVkIGJpbmRNb2RlOiAnICsgdGhpcy5iaW5kTW9kZSApOwoKCQkJfQoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLmdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsICkuY29weSggdGhpcyApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtaWthZWwgZW10aW5nZXIgLyBodHRwOi8vZ29tby5zZS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIG1pY2hhZWwgZ3VlcnJlcm8gLyBodHRwOi8vcmVhbGl0eW1lbHRkb3duLmNvbQoJICogQGF1dGhvciBpa2VyciAvIGh0dHA6Ly92ZXJvbGQuY29tCgkgKi8KCglmdW5jdGlvbiBTa2VsZXRvbiggYm9uZXMsIGJvbmVJbnZlcnNlcyApIHsKCgkJLy8gY29weSB0aGUgYm9uZSBhcnJheQoKCQlib25lcyA9IGJvbmVzIHx8IFtdOwoKCQl0aGlzLmJvbmVzID0gYm9uZXMuc2xpY2UoIDAgKTsKCQl0aGlzLmJvbmVNYXRyaWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoIHRoaXMuYm9uZXMubGVuZ3RoICogMTYgKTsKCgkJLy8gdXNlIHRoZSBzdXBwbGllZCBib25lIGludmVyc2VzIG9yIGNhbGN1bGF0ZSB0aGUgaW52ZXJzZXMKCgkJaWYgKCBib25lSW52ZXJzZXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuY2FsY3VsYXRlSW52ZXJzZXMoKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggdGhpcy5ib25lcy5sZW5ndGggPT09IGJvbmVJbnZlcnNlcy5sZW5ndGggKSB7CgoJCQkJdGhpcy5ib25lSW52ZXJzZXMgPSBib25lSW52ZXJzZXMuc2xpY2UoIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuU2tlbGV0b24gYm9uZUludmVyc2VzIGlzIHRoZSB3cm9uZyBsZW5ndGguJyApOwoKCQkJCXRoaXMuYm9uZUludmVyc2VzID0gW107CgoJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCXRoaXMuYm9uZUludmVyc2VzLnB1c2goIG5ldyBNYXRyaXg0KCkgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJT2JqZWN0LmFzc2lnbiggU2tlbGV0b24ucHJvdG90eXBlLCB7CgoJCWNhbGN1bGF0ZUludmVyc2VzOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmJvbmVJbnZlcnNlcyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdmFyIGludmVyc2UgPSBuZXcgTWF0cml4NCgpOwoKCQkJCWlmICggdGhpcy5ib25lc1sgaSBdICkgewoKCQkJCQlpbnZlcnNlLmdldEludmVyc2UoIHRoaXMuYm9uZXNbIGkgXS5tYXRyaXhXb3JsZCApOwoKCQkJCX0KCgkJCQl0aGlzLmJvbmVJbnZlcnNlcy5wdXNoKCBpbnZlcnNlICk7CgoJCQl9CgoJCX0sCgoJCXBvc2U6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBib25lLCBpLCBpbDsKCgkJCS8vIHJlY292ZXIgdGhlIGJpbmQtdGltZSB3b3JsZCBtYXRyaWNlcwoKCQkJZm9yICggaSA9IDAsIGlsID0gdGhpcy5ib25lcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQlib25lID0gdGhpcy5ib25lc1sgaSBdOwoKCQkJCWlmICggYm9uZSApIHsKCgkJCQkJYm9uZS5tYXRyaXhXb3JsZC5nZXRJbnZlcnNlKCB0aGlzLmJvbmVJbnZlcnNlc1sgaSBdICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gY29tcHV0ZSB0aGUgbG9jYWwgbWF0cmljZXMsIHBvc2l0aW9ucywgcm90YXRpb25zIGFuZCBzY2FsZXMKCgkJCWZvciAoIGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJYm9uZSA9IHRoaXMuYm9uZXNbIGkgXTsKCgkJCQlpZiAoIGJvbmUgKSB7CgoJCQkJCWlmICggYm9uZS5wYXJlbnQgJiYgYm9uZS5wYXJlbnQuaXNCb25lICkgewoKCQkJCQkJYm9uZS5tYXRyaXguZ2V0SW52ZXJzZSggYm9uZS5wYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCQkJYm9uZS5tYXRyaXgubXVsdGlwbHkoIGJvbmUubWF0cml4V29ybGQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWJvbmUubWF0cml4LmNvcHkoIGJvbmUubWF0cml4V29ybGQgKTsKCgkJCQkJfQoKCQkJCQlib25lLm1hdHJpeC5kZWNvbXBvc2UoIGJvbmUucG9zaXRpb24sIGJvbmUucXVhdGVybmlvbiwgYm9uZS5zY2FsZSApOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJdXBkYXRlOiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBvZmZzZXRNYXRyaXggPSBuZXcgTWF0cml4NCgpOwoJCQl2YXIgaWRlbnRpdHlNYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZSgpIHsKCgkJCQl2YXIgYm9uZXMgPSB0aGlzLmJvbmVzOwoJCQkJdmFyIGJvbmVJbnZlcnNlcyA9IHRoaXMuYm9uZUludmVyc2VzOwoJCQkJdmFyIGJvbmVNYXRyaWNlcyA9IHRoaXMuYm9uZU1hdHJpY2VzOwoJCQkJdmFyIGJvbmVUZXh0dXJlID0gdGhpcy5ib25lVGV4dHVyZTsKCgkJCQkvLyBmbGF0dGVuIGJvbmUgbWF0cmljZXMgdG8gYXJyYXkKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCS8vIGNvbXB1dGUgdGhlIG9mZnNldCBiZXR3ZWVuIHRoZSBjdXJyZW50IGFuZCB0aGUgb3JpZ2luYWwgdHJhbnNmb3JtCgoJCQkJCXZhciBtYXRyaXggPSBib25lc1sgaSBdID8gYm9uZXNbIGkgXS5tYXRyaXhXb3JsZCA6IGlkZW50aXR5TWF0cml4OwoKCQkJCQlvZmZzZXRNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggbWF0cml4LCBib25lSW52ZXJzZXNbIGkgXSApOwoJCQkJCW9mZnNldE1hdHJpeC50b0FycmF5KCBib25lTWF0cmljZXMsIGkgKiAxNiApOwoKCQkJCX0KCgkJCQlpZiAoIGJvbmVUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWJvbmVUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9OwoKCQl9ICkoKSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgU2tlbGV0b24oIHRoaXMuYm9uZXMsIHRoaXMuYm9uZUludmVyc2VzICk7CgoJCX0sCgoJCWdldEJvbmVCeU5hbWU6IGZ1bmN0aW9uICggbmFtZSApIHsKCgkJCWZvciAoIHZhciBpID0gMCwgaWwgPSB0aGlzLmJvbmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXZhciBib25lID0gdGhpcy5ib25lc1sgaSBdOwoKCQkJCWlmICggYm9uZS5uYW1lID09PSBuYW1lICkgewoKCQkJCQlyZXR1cm4gYm9uZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtaWthZWwgZW10aW5nZXIgLyBodHRwOi8vZ29tby5zZS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIGlrZXJyIC8gaHR0cDovL3Zlcm9sZC5jb20KCSAqLwoKCWZ1bmN0aW9uIEJvbmUoKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0JvbmUnOwoKCX0KCglCb25lLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIE9iamVjdDNELnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBCb25lLAoKCQlpc0JvbmU6IHRydWUKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGNvbG9yOiA8aGV4PiwKCSAqICBvcGFjaXR5OiA8ZmxvYXQ+LAoJICoKCSAqICBsaW5ld2lkdGg6IDxmbG9hdD4sCgkgKiAgbGluZWNhcDogInJvdW5kIiwKCSAqICBsaW5lam9pbjogInJvdW5kIgoJICogfQoJICovCgoJZnVuY3Rpb24gTGluZUJhc2ljTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0xpbmVCYXNpY01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCgkJdGhpcy5saW5ld2lkdGggPSAxOwoJCXRoaXMubGluZWNhcCA9ICdyb3VuZCc7CgkJdGhpcy5saW5lam9pbiA9ICdyb3VuZCc7CgoJCXRoaXMubGlnaHRzID0gZmFsc2U7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCUxpbmVCYXNpY01hdGVyaWFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE1hdGVyaWFsLnByb3RvdHlwZSApOwoJTGluZUJhc2ljTWF0ZXJpYWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTGluZUJhc2ljTWF0ZXJpYWw7CgoJTGluZUJhc2ljTWF0ZXJpYWwucHJvdG90eXBlLmlzTGluZUJhc2ljTWF0ZXJpYWwgPSB0cnVlOwoKCUxpbmVCYXNpY01hdGVyaWFsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCU1hdGVyaWFsLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLmxpbmV3aWR0aCA9IHNvdXJjZS5saW5ld2lkdGg7CgkJdGhpcy5saW5lY2FwID0gc291cmNlLmxpbmVjYXA7CgkJdGhpcy5saW5lam9pbiA9IHNvdXJjZS5saW5lam9pbjsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBMaW5lKCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG1vZGUgKSB7CgoJCWlmICggbW9kZSA9PT0gMSApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5MaW5lOiBwYXJhbWV0ZXIgVEhSRUUuTGluZVBpZWNlcyBubyBsb25nZXIgc3VwcG9ydGVkLiBVc2UgVEhSRUUuTGluZVNlZ21lbnRzIGluc3RlYWQuJyApOwoKCQl9CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0xpbmUnOwoKCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnkgIT09IHVuZGVmaW5lZCA/IGdlb21ldHJ5IDogbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsICE9PSB1bmRlZmluZWQgPyBtYXRlcmlhbCA6IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmIH0gKTsKCgl9CgoJTGluZS5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogTGluZSwKCgkJaXNMaW5lOiB0cnVlLAoKCQljb21wdXRlTGluZURpc3RhbmNlczogKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgc3RhcnQgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgZW5kID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjb21wdXRlTGluZURpc3RhbmNlcygpIHsKCgkJCQl2YXIgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQkJCWlmICggZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCQkJLy8gd2UgYXNzdW1lIG5vbi1pbmRleGVkIGdlb21ldHJ5CgoJCQkJCWlmICggZ2VvbWV0cnkuaW5kZXggPT09IG51bGwgKSB7CgoJCQkJCQl2YXIgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQkJCQl2YXIgbGluZURpc3RhbmNlcyA9IFsgMCBdOwoKCQkJCQkJZm9yICggdmFyIGkgPSAxLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCXN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpIC0gMSApOwoJCQkJCQkJZW5kLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgoJCQkJCQkJbGluZURpc3RhbmNlc1sgaSBdID0gbGluZURpc3RhbmNlc1sgaSAtIDEgXTsKCQkJCQkJCWxpbmVEaXN0YW5jZXNbIGkgXSArPSBzdGFydC5kaXN0YW5jZVRvKCBlbmQgKTsKCgkJCQkJCX0KCgkJCQkJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ2xpbmVEaXN0YW5jZScsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBsaW5lRGlzdGFuY2VzLCAxICkgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKTogQ29tcHV0YXRpb24gb25seSBwb3NzaWJsZSB3aXRoIG5vbi1pbmRleGVkIEJ1ZmZlckdlb21ldHJ5LicgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQkJCXZhciB2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzOwoJCQkJCXZhciBsaW5lRGlzdGFuY2VzID0gZ2VvbWV0cnkubGluZURpc3RhbmNlczsKCgkJCQkJbGluZURpc3RhbmNlc1sgMCBdID0gMDsKCgkJCQkJZm9yICggdmFyIGkgPSAxLCBsID0gdmVydGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCWxpbmVEaXN0YW5jZXNbIGkgXSA9IGxpbmVEaXN0YW5jZXNbIGkgLSAxIF07CgkJCQkJCWxpbmVEaXN0YW5jZXNbIGkgXSArPSB2ZXJ0aWNlc1sgaSAtIDEgXS5kaXN0YW5jZVRvKCB2ZXJ0aWNlc1sgaSBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCkgKSwKCgkJcmF5Y2FzdDogKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgaW52ZXJzZU1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJCXZhciByYXkgPSBuZXcgUmF5KCk7CgkJCXZhciBzcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQkJCXZhciBwcmVjaXNpb24gPSByYXljYXN0ZXIubGluZVByZWNpc2lvbjsKCgkJCQl2YXIgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCQkJdmFyIG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCgkJCQkvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZSBkaXN0YW5jZSB0byByYXkKCgkJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQkJc3BoZXJlLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CgkJCQlzcGhlcmUuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoJCQkJc3BoZXJlLnJhZGl1cyArPSBwcmVjaXNpb247CgoJCQkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkvLwoKCQkJCWludmVyc2VNYXRyaXguZ2V0SW52ZXJzZSggbWF0cml4V29ybGQgKTsKCQkJCXJheS5jb3B5KCByYXljYXN0ZXIucmF5ICkuYXBwbHlNYXRyaXg0KCBpbnZlcnNlTWF0cml4ICk7CgoJCQkJdmFyIGxvY2FsUHJlY2lzaW9uID0gcHJlY2lzaW9uIC8gKCAoIHRoaXMuc2NhbGUueCArIHRoaXMuc2NhbGUueSArIHRoaXMuc2NhbGUueiApIC8gMyApOwoJCQkJdmFyIGxvY2FsUHJlY2lzaW9uU3EgPSBsb2NhbFByZWNpc2lvbiAqIGxvY2FsUHJlY2lzaW9uOwoKCQkJCXZhciB2U3RhcnQgPSBuZXcgVmVjdG9yMygpOwoJCQkJdmFyIHZFbmQgPSBuZXcgVmVjdG9yMygpOwoJCQkJdmFyIGludGVyU2VnbWVudCA9IG5ldyBWZWN0b3IzKCk7CgkJCQl2YXIgaW50ZXJSYXkgPSBuZXcgVmVjdG9yMygpOwoJCQkJdmFyIHN0ZXAgPSAoIHRoaXMgJiYgdGhpcy5pc0xpbmVTZWdtZW50cyApID8gMiA6IDE7CgoJCQkJaWYgKCBnZW9tZXRyeS5pc0J1ZmZlckdlb21ldHJ5ICkgewoKCQkJCQl2YXIgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQkJCQl2YXIgYXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgkJCQkJdmFyIHBvc2l0aW9ucyA9IGF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXk7CgoJCQkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJCQl2YXIgaW5kaWNlcyA9IGluZGV4LmFycmF5OwoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gaW5kaWNlcy5sZW5ndGggLSAxOyBpIDwgbDsgaSArPSBzdGVwICkgewoKCQkJCQkJCXZhciBhID0gaW5kaWNlc1sgaSBdOwoJCQkJCQkJdmFyIGIgPSBpbmRpY2VzWyBpICsgMSBdOwoKCQkJCQkJCXZTdGFydC5mcm9tQXJyYXkoIHBvc2l0aW9ucywgYSAqIDMgKTsKCQkJCQkJCXZFbmQuZnJvbUFycmF5KCBwb3NpdGlvbnMsIGIgKiAzICk7CgoJCQkJCQkJdmFyIGRpc3RTcSA9IHJheS5kaXN0YW5jZVNxVG9TZWdtZW50KCB2U3RhcnQsIHZFbmQsIGludGVyUmF5LCBpbnRlclNlZ21lbnQgKTsKCgkJCQkJCQlpZiAoIGRpc3RTcSA+IGxvY2FsUHJlY2lzaW9uU3EgKSBjb250aW51ZTsKCgkJCQkJCQlpbnRlclJheS5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKTsgLy9Nb3ZlIGJhY2sgdG8gd29ybGQgc3BhY2UgZm9yIGRpc3RhbmNlIGNhbGN1bGF0aW9uCgoJCQkJCQkJdmFyIGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJSYXkgKTsKCgkJCQkJCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgY29udGludWU7CgoJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQkJCQkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJCQkJCQkvLyBXaGF0IGRvIHdlIHdhbnQ/IGludGVyc2VjdGlvbiBwb2ludCBvbiB0aGUgcmF5IG9yIG9uIHRoZSBzZWdtZW50Pz8KCQkJCQkJCQkvLyBwb2ludDogcmF5Y2FzdGVyLnJheS5hdCggZGlzdGFuY2UgKSwKCQkJCQkJCQlwb2ludDogaW50ZXJTZWdtZW50LmNsb25lKCkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICksCgkJCQkJCQkJaW5kZXg6IGksCgkJCQkJCQkJZmFjZTogbnVsbCwKCQkJCQkJCQlmYWNlSW5kZXg6IG51bGwsCgkJCQkJCQkJb2JqZWN0OiB0aGlzCgoJCQkJCQkJfSApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gcG9zaXRpb25zLmxlbmd0aCAvIDMgLSAxOyBpIDwgbDsgaSArPSBzdGVwICkgewoKCQkJCQkJCXZTdGFydC5mcm9tQXJyYXkoIHBvc2l0aW9ucywgMyAqIGkgKTsKCQkJCQkJCXZFbmQuZnJvbUFycmF5KCBwb3NpdGlvbnMsIDMgKiBpICsgMyApOwoKCQkJCQkJCXZhciBkaXN0U3EgPSByYXkuZGlzdGFuY2VTcVRvU2VnbWVudCggdlN0YXJ0LCB2RW5kLCBpbnRlclJheSwgaW50ZXJTZWdtZW50ICk7CgoJCQkJCQkJaWYgKCBkaXN0U3EgPiBsb2NhbFByZWNpc2lvblNxICkgY29udGludWU7CgoJCQkJCQkJaW50ZXJSYXkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7IC8vTW92ZSBiYWNrIHRvIHdvcmxkIHNwYWNlIGZvciBkaXN0YW5jZSBjYWxjdWxhdGlvbgoKCQkJCQkJCXZhciBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIGludGVyUmF5ICk7CgoJCQkJCQkJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIGNvbnRpbnVlOwoKCQkJCQkJCWludGVyc2VjdHMucHVzaCggewoKCQkJCQkJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCQkJCQkJLy8gV2hhdCBkbyB3ZSB3YW50PyBpbnRlcnNlY3Rpb24gcG9pbnQgb24gdGhlIHJheSBvciBvbiB0aGUgc2VnbWVudD8/CgkJCQkJCQkJLy8gcG9pbnQ6IHJheWNhc3Rlci5yYXkuYXQoIGRpc3RhbmNlICksCgkJCQkJCQkJcG9pbnQ6IGludGVyU2VnbWVudC5jbG9uZSgpLmFwcGx5TWF0cml4NCggdGhpcy5tYXRyaXhXb3JsZCApLAoJCQkJCQkJCWluZGV4OiBpLAoJCQkJCQkJCWZhY2U6IG51bGwsCgkJCQkJCQkJZmFjZUluZGV4OiBudWxsLAoJCQkJCQkJCW9iamVjdDogdGhpcwoKCQkJCQkJCX0gKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQkJCXZhciB2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzOwoJCQkJCXZhciBuYlZlcnRpY2VzID0gdmVydGljZXMubGVuZ3RoOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBuYlZlcnRpY2VzIC0gMTsgaSArPSBzdGVwICkgewoKCQkJCQkJdmFyIGRpc3RTcSA9IHJheS5kaXN0YW5jZVNxVG9TZWdtZW50KCB2ZXJ0aWNlc1sgaSBdLCB2ZXJ0aWNlc1sgaSArIDEgXSwgaW50ZXJSYXksIGludGVyU2VnbWVudCApOwoKCQkJCQkJaWYgKCBkaXN0U3EgPiBsb2NhbFByZWNpc2lvblNxICkgY29udGludWU7CgoJCQkJCQlpbnRlclJheS5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKTsgLy9Nb3ZlIGJhY2sgdG8gd29ybGQgc3BhY2UgZm9yIGRpc3RhbmNlIGNhbGN1bGF0aW9uCgoJCQkJCQl2YXIgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBpbnRlclJheSApOwoKCQkJCQkJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIGNvbnRpbnVlOwoKCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQkJCQkJZGlzdGFuY2U6IGRpc3RhbmNlLAoJCQkJCQkJLy8gV2hhdCBkbyB3ZSB3YW50PyBpbnRlcnNlY3Rpb24gcG9pbnQgb24gdGhlIHJheSBvciBvbiB0aGUgc2VnbWVudD8/CgkJCQkJCQkvLyBwb2ludDogcmF5Y2FzdGVyLnJheS5hdCggZGlzdGFuY2UgKSwKCQkJCQkJCXBvaW50OiBpbnRlclNlZ21lbnQuY2xvbmUoKS5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKSwKCQkJCQkJCWluZGV4OiBpLAoJCQkJCQkJZmFjZTogbnVsbCwKCQkJCQkJCWZhY2VJbmRleDogbnVsbCwKCQkJCQkJCW9iamVjdDogdGhpcwoKCQkJCQkJfSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfTsKCgkJfSgpICksCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwgKS5jb3B5KCB0aGlzICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gTGluZVNlZ21lbnRzKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKSB7CgoJCUxpbmUuY2FsbCggdGhpcywgZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMudHlwZSA9ICdMaW5lU2VnbWVudHMnOwoKCX0KCglMaW5lU2VnbWVudHMucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggTGluZS5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogTGluZVNlZ21lbnRzLAoKCQlpc0xpbmVTZWdtZW50czogdHJ1ZSwKCgkJY29tcHV0ZUxpbmVEaXN0YW5jZXM6ICggZnVuY3Rpb24gKCkgewoKCQkJdmFyIHN0YXJ0ID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGVuZCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gY29tcHV0ZUxpbmVEaXN0YW5jZXMoKSB7CgoJCQkJdmFyIGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJCQlpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJCS8vIHdlIGFzc3VtZSBub24taW5kZXhlZCBnZW9tZXRyeQoKCQkJCQlpZiAoIGdlb21ldHJ5LmluZGV4ID09PSBudWxsICkgewoKCQkJCQkJdmFyIHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJCQkJdmFyIGxpbmVEaXN0YW5jZXMgPSBbXTsKCgkJCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpIDwgbDsgaSArPSAyICkgewoKCQkJCQkJCXN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgkJCQkJCQllbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAxICk7CgoJCQkJCQkJbGluZURpc3RhbmNlc1sgaSBdID0gKCBpID09PSAwICkgPyAwIDogbGluZURpc3RhbmNlc1sgaSAtIDEgXTsKCQkJCQkJCWxpbmVEaXN0YW5jZXNbIGkgKyAxIF0gPSBsaW5lRGlzdGFuY2VzWyBpIF0gKyBzdGFydC5kaXN0YW5jZVRvKCBlbmQgKTsKCgkJCQkJCX0KCgkJCQkJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ2xpbmVEaXN0YW5jZScsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBsaW5lRGlzdGFuY2VzLCAxICkgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmVTZWdtZW50cy5jb21wdXRlTGluZURpc3RhbmNlcygpOiBDb21wdXRhdGlvbiBvbmx5IHBvc3NpYmxlIHdpdGggbm9uLWluZGV4ZWQgQnVmZmVyR2VvbWV0cnkuJyApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCQkJdmFyIHZlcnRpY2VzID0gZ2VvbWV0cnkudmVydGljZXM7CgkJCQkJdmFyIGxpbmVEaXN0YW5jZXMgPSBnZW9tZXRyeS5saW5lRGlzdGFuY2VzOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB2ZXJ0aWNlcy5sZW5ndGg7IGkgPCBsOyBpICs9IDIgKSB7CgoJCQkJCQlzdGFydC5jb3B5KCB2ZXJ0aWNlc1sgaSBdICk7CgkJCQkJCWVuZC5jb3B5KCB2ZXJ0aWNlc1sgaSArIDEgXSApOwoKCQkJCQkJbGluZURpc3RhbmNlc1sgaSBdID0gKCBpID09PSAwICkgPyAwIDogbGluZURpc3RhbmNlc1sgaSAtIDEgXTsKCQkJCQkJbGluZURpc3RhbmNlc1sgaSArIDEgXSA9IGxpbmVEaXN0YW5jZXNbIGkgXSArIHN0YXJ0LmRpc3RhbmNlVG8oIGVuZCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoKCQkJfTsKCgkJfSgpICkKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1ncmV0ZXIgLyBodHRwOi8vZ2l0aHViLmNvbS9tZ3JldGVyCgkgKi8KCglmdW5jdGlvbiBMaW5lTG9vcCggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlMaW5lLmNhbGwoIHRoaXMsIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnTGluZUxvb3AnOwoKCX0KCglMaW5lTG9vcC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBMaW5lLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBMaW5lTG9vcCwKCgkJaXNMaW5lTG9vcDogdHJ1ZSwKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGNvbG9yOiA8aGV4PiwKCSAqICBvcGFjaXR5OiA8ZmxvYXQ+LAoJICogIG1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgc2l6ZTogPGZsb2F0PiwKCSAqICBzaXplQXR0ZW51YXRpb246IDxib29sPgoJICoKCSAqICBtb3JwaFRhcmdldHM6IDxib29sPgoJICogfQoJICovCgoJZnVuY3Rpb24gUG9pbnRzTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1BvaW50c01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLnNpemUgPSAxOwoJCXRoaXMuc2l6ZUF0dGVudWF0aW9uID0gdHJ1ZTsKCgkJdGhpcy5tb3JwaFRhcmdldHMgPSBmYWxzZTsKCgkJdGhpcy5saWdodHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJUG9pbnRzTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglQb2ludHNNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQb2ludHNNYXRlcmlhbDsKCglQb2ludHNNYXRlcmlhbC5wcm90b3R5cGUuaXNQb2ludHNNYXRlcmlhbCA9IHRydWU7CgoJUG9pbnRzTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5zaXplID0gc291cmNlLnNpemU7CgkJdGhpcy5zaXplQXR0ZW51YXRpb24gPSBzb3VyY2Uuc2l6ZUF0dGVudWF0aW9uOwoKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gUG9pbnRzKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1BvaW50cyc7CgoJCXRoaXMuZ2VvbWV0cnkgPSBnZW9tZXRyeSAhPT0gdW5kZWZpbmVkID8gZ2VvbWV0cnkgOiBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWwgIT09IHVuZGVmaW5lZCA/IG1hdGVyaWFsIDogbmV3IFBvaW50c01hdGVyaWFsKCB7IGNvbG9yOiBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmYgfSApOwoKCX0KCglQb2ludHMucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFBvaW50cywKCgkJaXNQb2ludHM6IHRydWUsCgoJCXJheWNhc3Q6ICggZnVuY3Rpb24gKCkgewoKCQkJdmFyIGludmVyc2VNYXRyaXggPSBuZXcgTWF0cml4NCgpOwoJCQl2YXIgcmF5ID0gbmV3IFJheSgpOwoJCQl2YXIgc3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJCQl2YXIgb2JqZWN0ID0gdGhpczsKCQkJCXZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCQl2YXIgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwoJCQkJdmFyIHRocmVzaG9sZCA9IHJheWNhc3Rlci5wYXJhbXMuUG9pbnRzLnRocmVzaG9sZDsKCgkJCQkvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZSBkaXN0YW5jZSB0byByYXkKCgkJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQkJc3BoZXJlLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CgkJCQlzcGhlcmUuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoJCQkJc3BoZXJlLnJhZGl1cyArPSB0aHJlc2hvbGQ7CgoJCQkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkvLwoKCQkJCWludmVyc2VNYXRyaXguZ2V0SW52ZXJzZSggbWF0cml4V29ybGQgKTsKCQkJCXJheS5jb3B5KCByYXljYXN0ZXIucmF5ICkuYXBwbHlNYXRyaXg0KCBpbnZlcnNlTWF0cml4ICk7CgoJCQkJdmFyIGxvY2FsVGhyZXNob2xkID0gdGhyZXNob2xkIC8gKCAoIHRoaXMuc2NhbGUueCArIHRoaXMuc2NhbGUueSArIHRoaXMuc2NhbGUueiApIC8gMyApOwoJCQkJdmFyIGxvY2FsVGhyZXNob2xkU3EgPSBsb2NhbFRocmVzaG9sZCAqIGxvY2FsVGhyZXNob2xkOwoJCQkJdmFyIHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKCQkJCXZhciBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkJZnVuY3Rpb24gdGVzdFBvaW50KCBwb2ludCwgaW5kZXggKSB7CgoJCQkJCXZhciByYXlQb2ludERpc3RhbmNlU3EgPSByYXkuZGlzdGFuY2VTcVRvUG9pbnQoIHBvaW50ICk7CgoJCQkJCWlmICggcmF5UG9pbnREaXN0YW5jZVNxIDwgbG9jYWxUaHJlc2hvbGRTcSApIHsKCgkJCQkJCXJheS5jbG9zZXN0UG9pbnRUb1BvaW50KCBwb2ludCwgaW50ZXJzZWN0UG9pbnQgKTsKCQkJCQkJaW50ZXJzZWN0UG9pbnQuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQkJCQkJdmFyIGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJzZWN0UG9pbnQgKTsKCgkJCQkJCWlmICggZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIgKSByZXR1cm47CgoJCQkJCQlpbnRlcnNlY3RzLnB1c2goIHsKCgkJCQkJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCQkJCQlkaXN0YW5jZVRvUmF5OiBNYXRoLnNxcnQoIHJheVBvaW50RGlzdGFuY2VTcSApLAoJCQkJCQkJcG9pbnQ6IGludGVyc2VjdFBvaW50LmNsb25lKCksCgkJCQkJCQlpbmRleDogaW5kZXgsCgkJCQkJCQlmYWNlOiBudWxsLAoJCQkJCQkJb2JqZWN0OiBvYmplY3QKCgkJCQkJCX0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJCXZhciBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQkJCXZhciBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQkJCQl2YXIgcG9zaXRpb25zID0gYXR0cmlidXRlcy5wb3NpdGlvbi5hcnJheTsKCgkJCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJCXZhciBpbmRpY2VzID0gaW5kZXguYXJyYXk7CgoJCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gaW5kaWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQl2YXIgYSA9IGluZGljZXNbIGkgXTsKCgkJCQkJCQlwb3NpdGlvbi5mcm9tQXJyYXkoIHBvc2l0aW9ucywgYSAqIDMgKTsKCgkJCQkJCQl0ZXN0UG9pbnQoIHBvc2l0aW9uLCBhICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBwb3NpdGlvbnMubGVuZ3RoIC8gMzsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQkJcG9zaXRpb24uZnJvbUFycmF5KCBwb3NpdGlvbnMsIGkgKiAzICk7CgoJCQkJCQkJdGVzdFBvaW50KCBwb3NpdGlvbiwgaSApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJdmFyIHZlcnRpY2VzID0gZ2VvbWV0cnkudmVydGljZXM7CgoJCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IHZlcnRpY2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQl0ZXN0UG9pbnQoIHZlcnRpY2VzWyBpIF0sIGkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCX0oKSApLAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLmdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsICkuY29weSggdGhpcyApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFZpZGVvVGV4dHVyZSggdmlkZW8sIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCgkJVGV4dHVyZS5jYWxsKCB0aGlzLCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgoJCXRoaXMuZm9ybWF0ID0gZm9ybWF0ICE9PSB1bmRlZmluZWQgPyBmb3JtYXQgOiBSR0JGb3JtYXQ7CgoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtaW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgkJdGhpcy5tYWdGaWx0ZXIgPSBtYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1hZ0ZpbHRlciA6IExpbmVhckZpbHRlcjsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgl9CgoJVmlkZW9UZXh0dXJlLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIFRleHR1cmUucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFZpZGVvVGV4dHVyZSwKCgkJaXNWaWRlb1RleHR1cmU6IHRydWUsCgoJCXVwZGF0ZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHZpZGVvID0gdGhpcy5pbWFnZTsKCgkJCWlmICggdmlkZW8ucmVhZHlTdGF0ZSA+PSB2aWRlby5IQVZFX0NVUlJFTlRfREFUQSApIHsKCgkJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKi8KCglmdW5jdGlvbiBDb21wcmVzc2VkVGV4dHVyZSggbWlwbWFwcywgd2lkdGgsIGhlaWdodCwgZm9ybWF0LCB0eXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBhbmlzb3Ryb3B5LCBlbmNvZGluZyApIHsKCgkJVGV4dHVyZS5jYWxsKCB0aGlzLCBudWxsLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHksIGVuY29kaW5nICk7CgoJCXRoaXMuaW1hZ2UgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCQl0aGlzLm1pcG1hcHMgPSBtaXBtYXBzOwoKCQkvLyBubyBmbGlwcGluZyBmb3IgY3ViZSB0ZXh0dXJlcwoJCS8vIChhbHNvIGZsaXBwaW5nIGRvZXNuJ3Qgd29yayBmb3IgY29tcHJlc3NlZCB0ZXh0dXJlcyApCgoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJLy8gY2FuJ3QgZ2VuZXJhdGUgbWlwbWFwcyBmb3IgY29tcHJlc3NlZCB0ZXh0dXJlcwoJCS8vIG1pcHMgbXVzdCBiZSBlbWJlZGRlZCBpbiBERFMgZmlsZXMKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgl9CgoJQ29tcHJlc3NlZFRleHR1cmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggVGV4dHVyZS5wcm90b3R5cGUgKTsKCUNvbXByZXNzZWRUZXh0dXJlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENvbXByZXNzZWRUZXh0dXJlOwoKCUNvbXByZXNzZWRUZXh0dXJlLnByb3RvdHlwZS5pc0NvbXByZXNzZWRUZXh0dXJlID0gdHJ1ZTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBDYW52YXNUZXh0dXJlKCBjYW52YXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCgkJVGV4dHVyZS5jYWxsKCB0aGlzLCBjYW52YXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApOwoKCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJQ2FudmFzVGV4dHVyZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBUZXh0dXJlLnByb3RvdHlwZSApOwoJQ2FudmFzVGV4dHVyZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDYW52YXNUZXh0dXJlOwoJQ2FudmFzVGV4dHVyZS5wcm90b3R5cGUuaXNDYW52YXNUZXh0dXJlID0gdHJ1ZTsKCgkvKioKCSAqIEBhdXRob3IgTWF0dCBEZXNMYXVyaWVycyAvIEBtYXR0ZGVzbAoJICogQGF1dGhvciBhdGl4IC8gYXJ0aHVyc2lsYmVyLmRlCgkgKi8KCglmdW5jdGlvbiBEZXB0aFRleHR1cmUoIHdpZHRoLCBoZWlnaHQsIHR5cGUsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGFuaXNvdHJvcHksIGZvcm1hdCApIHsKCgkJZm9ybWF0ID0gZm9ybWF0ICE9PSB1bmRlZmluZWQgPyBmb3JtYXQgOiBEZXB0aEZvcm1hdDsKCgkJaWYgKCBmb3JtYXQgIT09IERlcHRoRm9ybWF0ICYmIGZvcm1hdCAhPT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnRGVwdGhUZXh0dXJlIGZvcm1hdCBtdXN0IGJlIGVpdGhlciBUSFJFRS5EZXB0aEZvcm1hdCBvciBUSFJFRS5EZXB0aFN0ZW5jaWxGb3JtYXQnICk7CgoJCX0KCgkJaWYgKCB0eXBlID09PSB1bmRlZmluZWQgJiYgZm9ybWF0ID09PSBEZXB0aEZvcm1hdCApIHR5cGUgPSBVbnNpZ25lZFNob3J0VHlwZTsKCQlpZiAoIHR5cGUgPT09IHVuZGVmaW5lZCAmJiBmb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHR5cGUgPSBVbnNpZ25lZEludDI0OFR5cGU7CgoJCVRleHR1cmUuY2FsbCggdGhpcywgbnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgoJCXRoaXMuaW1hZ2UgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCgkJdGhpcy5tYWdGaWx0ZXIgPSBtYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1hZ0ZpbHRlciA6IE5lYXJlc3RGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBtaW5GaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1pbkZpbHRlciA6IE5lYXJlc3RGaWx0ZXI7CgoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcwk9IGZhbHNlOwoKCX0KCglEZXB0aFRleHR1cmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggVGV4dHVyZS5wcm90b3R5cGUgKTsKCURlcHRoVGV4dHVyZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBEZXB0aFRleHR1cmU7CglEZXB0aFRleHR1cmUucHJvdG90eXBlLmlzRGVwdGhUZXh0dXJlID0gdHJ1ZTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJZnVuY3Rpb24gV2lyZWZyYW1lR2VvbWV0cnkoIGdlb21ldHJ5ICkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdXaXJlZnJhbWVHZW9tZXRyeSc7CgoJCS8vIGJ1ZmZlcgoKCQl2YXIgdmVydGljZXMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgaSwgaiwgbCwgbywgb2w7CgkJdmFyIGVkZ2UgPSBbIDAsIDAgXSwgZWRnZXMgPSB7fSwgZSwgZWRnZTEsIGVkZ2UyOwoJCXZhciBrZXksIGtleXMgPSBbICdhJywgJ2InLCAnYycgXTsKCQl2YXIgdmVydGV4OwoKCQkvLyBkaWZmZXJlbnQgbG9naWMgZm9yIEdlb21ldHJ5IGFuZCBCdWZmZXJHZW9tZXRyeQoKCQlpZiAoIGdlb21ldHJ5ICYmIGdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQkvLyBjcmVhdGUgYSBkYXRhIHN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIGFsbCBlZGdlcyB3aXRob3V0IGR1cGxpY2F0ZXMKCgkJCXZhciBmYWNlcyA9IGdlb21ldHJ5LmZhY2VzOwoKCQkJZm9yICggaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBmYWNlID0gZmFjZXNbIGkgXTsKCgkJCQlmb3IgKCBqID0gMDsgaiA8IDM7IGogKysgKSB7CgoJCQkJCWVkZ2UxID0gZmFjZVsga2V5c1sgaiBdIF07CgkJCQkJZWRnZTIgPSBmYWNlWyBrZXlzWyAoIGogKyAxICkgJSAzIF0gXTsKCQkJCQllZGdlWyAwIF0gPSBNYXRoLm1pbiggZWRnZTEsIGVkZ2UyICk7IC8vIHNvcnRpbmcgcHJldmVudHMgZHVwbGljYXRlcwoJCQkJCWVkZ2VbIDEgXSA9IE1hdGgubWF4KCBlZGdlMSwgZWRnZTIgKTsKCgkJCQkJa2V5ID0gZWRnZVsgMCBdICsgJywnICsgZWRnZVsgMSBdOwoKCQkJCQlpZiAoIGVkZ2VzWyBrZXkgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJZWRnZXNbIGtleSBdID0geyBpbmRleDE6IGVkZ2VbIDAgXSwgaW5kZXgyOiBlZGdlWyAxIF0gfTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vIGdlbmVyYXRlIHZlcnRpY2VzCgoJCQlmb3IgKCBrZXkgaW4gZWRnZXMgKSB7CgoJCQkJZSA9IGVkZ2VzWyBrZXkgXTsKCgkJCQl2ZXJ0ZXggPSBnZW9tZXRyeS52ZXJ0aWNlc1sgZS5pbmRleDEgXTsKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQl2ZXJ0ZXggPSBnZW9tZXRyeS52ZXJ0aWNlc1sgZS5pbmRleDIgXTsKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCX0KCgkJfSBlbHNlIGlmICggZ2VvbWV0cnkgJiYgZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCXZhciBwb3NpdGlvbiwgaW5kaWNlcywgZ3JvdXBzOwoJCQl2YXIgZ3JvdXAsIHN0YXJ0LCBjb3VudDsKCQkJdmFyIGluZGV4MSwgaW5kZXgyOwoKCQkJdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCgkJCWlmICggZ2VvbWV0cnkuaW5kZXggIT09IG51bGwgKSB7CgoJCQkJLy8gaW5kZXhlZCBCdWZmZXJHZW9tZXRyeQoKCQkJCXBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJCWluZGljZXMgPSBnZW9tZXRyeS5pbmRleDsKCQkJCWdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKCgkJCQlpZiAoIGdyb3Vwcy5sZW5ndGggPT09IDAgKSB7CgoJCQkJCWdyb3VwcyA9IFsgeyBzdGFydDogMCwgY291bnQ6IGluZGljZXMuY291bnQsIG1hdGVyaWFsSW5kZXg6IDAgfSBdOwoKCQkJCX0KCgkJCQkvLyBjcmVhdGUgYSBkYXRhIHN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIGFsbCBlZ2VzIHdpdGhvdXQgZHVwbGljYXRlcwoKCQkJCWZvciAoIG8gPSAwLCBvbCA9IGdyb3Vwcy5sZW5ndGg7IG8gPCBvbDsgKysgbyApIHsKCgkJCQkJZ3JvdXAgPSBncm91cHNbIG8gXTsKCgkJCQkJc3RhcnQgPSBncm91cC5zdGFydDsKCQkJCQljb3VudCA9IGdyb3VwLmNvdW50OwoKCQkJCQlmb3IgKCBpID0gc3RhcnQsIGwgPSAoIHN0YXJ0ICsgY291bnQgKTsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQkJCWZvciAoIGogPSAwOyBqIDwgMzsgaiArKyApIHsKCgkJCQkJCQllZGdlMSA9IGluZGljZXMuZ2V0WCggaSArIGogKTsKCQkJCQkJCWVkZ2UyID0gaW5kaWNlcy5nZXRYKCBpICsgKCBqICsgMSApICUgMyApOwoJCQkJCQkJZWRnZVsgMCBdID0gTWF0aC5taW4oIGVkZ2UxLCBlZGdlMiApOyAvLyBzb3J0aW5nIHByZXZlbnRzIGR1cGxpY2F0ZXMKCQkJCQkJCWVkZ2VbIDEgXSA9IE1hdGgubWF4KCBlZGdlMSwgZWRnZTIgKTsKCgkJCQkJCQlrZXkgPSBlZGdlWyAwIF0gKyAnLCcgKyBlZGdlWyAxIF07CgoJCQkJCQkJaWYgKCBlZGdlc1sga2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJZWRnZXNbIGtleSBdID0geyBpbmRleDE6IGVkZ2VbIDAgXSwgaW5kZXgyOiBlZGdlWyAxIF0gfTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gZ2VuZXJhdGUgdmVydGljZXMKCgkJCQlmb3IgKCBrZXkgaW4gZWRnZXMgKSB7CgoJCQkJCWUgPSBlZGdlc1sga2V5IF07CgoJCQkJCXZlcnRleC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgZS5pbmRleDEgKTsKCQkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJCXZlcnRleC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgZS5pbmRleDIgKTsKCQkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQkvLyBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeQoKCQkJCXBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCQlmb3IgKCBpID0gMCwgbCA9ICggcG9zaXRpb24uY291bnQgLyAzICk7IGkgPCBsOyBpICsrICkgewoKCQkJCQlmb3IgKCBqID0gMDsgaiA8IDM7IGogKysgKSB7CgoJCQkJCQkvLyB0aHJlZSBlZGdlcyBwZXIgdHJpYW5nbGUsIGFuIGVkZ2UgaXMgcmVwcmVzZW50ZWQgYXMgKGluZGV4MSwgaW5kZXgyKQoJCQkJCQkvLyBlLmcuIHRoZSBmaXJzdCB0cmlhbmdsZSBoYXMgdGhlIGZvbGxvd2luZyBlZGdlczogKDAsMSksKDEsMiksKDIsMCkKCgkJCQkJCWluZGV4MSA9IDMgKiBpICsgajsKCQkJCQkJdmVydGV4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBpbmRleDEgKTsKCQkJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCQkJaW5kZXgyID0gMyAqIGkgKyAoICggaiArIDEgKSAlIDMgKTsKCQkJCQkJdmVydGV4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBpbmRleDIgKTsKCQkJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoKCX0KCglXaXJlZnJhbWVHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVdpcmVmcmFtZUdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFdpcmVmcmFtZUdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cHM6Ly9naXRodWIuY29tL3p6ODUKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKgoJICogUGFyYW1ldHJpYyBTdXJmYWNlcyBHZW9tZXRyeQoJICogYmFzZWQgb24gdGhlIGJyaWxsaWFudCBhcnRpY2xlIGJ5IEBwcmlkZW91dCBodHRwOi8vcHJpZGVvdXQubmV0L2Jsb2cvP3A9NDQKCSAqLwoKCS8vIFBhcmFtZXRyaWNHZW9tZXRyeQoKCWZ1bmN0aW9uIFBhcmFtZXRyaWNHZW9tZXRyeSggZnVuYywgc2xpY2VzLCBzdGFja3MgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1BhcmFtZXRyaWNHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJZnVuYzogZnVuYywKCQkJc2xpY2VzOiBzbGljZXMsCgkJCXN0YWNrczogc3RhY2tzCgkJfTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnkoIGZ1bmMsIHNsaWNlcywgc3RhY2tzICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJUGFyYW1ldHJpY0dlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJUGFyYW1ldHJpY0dlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBhcmFtZXRyaWNHZW9tZXRyeTsKCgkvLyBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnkoIGZ1bmMsIHNsaWNlcywgc3RhY2tzICkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCWZ1bmM6IGZ1bmMsCgkJCXNsaWNlczogc2xpY2VzLAoJCQlzdGFja3M6IHN0YWNrcwoJCX07CgoJCS8vIGJ1ZmZlcnMKCgkJdmFyIGluZGljZXMgPSBbXTsKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJdmFyIEVQUyA9IDAuMDAwMDE7CgoJCXZhciBub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoKCQl2YXIgcDAgPSBuZXcgVmVjdG9yMygpLCBwMSA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIHB1ID0gbmV3IFZlY3RvcjMoKSwgcHYgPSBuZXcgVmVjdG9yMygpOwoKCQl2YXIgaSwgajsKCgkJaWYgKCBmdW5jLmxlbmd0aCA8IDMgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUGFyYW1ldHJpY0dlb21ldHJ5OiBGdW5jdGlvbiBtdXN0IG5vdyBtb2RpZnkgYSBWZWN0b3IzIGFzIHRoaXJkIHBhcmFtZXRlci4nICk7CgoJCX0KCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQl2YXIgc2xpY2VDb3VudCA9IHNsaWNlcyArIDE7CgoJCWZvciAoIGkgPSAwOyBpIDw9IHN0YWNrczsgaSArKyApIHsKCgkJCXZhciB2ID0gaSAvIHN0YWNrczsKCgkJCWZvciAoIGogPSAwOyBqIDw9IHNsaWNlczsgaiArKyApIHsKCgkJCQl2YXIgdSA9IGogLyBzbGljZXM7CgoJCQkJLy8gdmVydGV4CgoJCQkJZnVuYyggdSwgdiwgcDAgKTsKCQkJCXZlcnRpY2VzLnB1c2goIHAwLngsIHAwLnksIHAwLnogKTsKCgkJCQkvLyBub3JtYWwKCgkJCQkvLyBhcHByb3hpbWF0ZSB0YW5nZW50IHZlY3RvcnMgdmlhIGZpbml0ZSBkaWZmZXJlbmNlcwoKCQkJCWlmICggdSAtIEVQUyA+PSAwICkgewoKCQkJCQlmdW5jKCB1IC0gRVBTLCB2LCBwMSApOwoJCQkJCXB1LnN1YlZlY3RvcnMoIHAwLCBwMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWZ1bmMoIHUgKyBFUFMsIHYsIHAxICk7CgkJCQkJcHUuc3ViVmVjdG9ycyggcDEsIHAwICk7CgoJCQkJfQoKCQkJCWlmICggdiAtIEVQUyA+PSAwICkgewoKCQkJCQlmdW5jKCB1LCB2IC0gRVBTLCBwMSApOwoJCQkJCXB2LnN1YlZlY3RvcnMoIHAwLCBwMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWZ1bmMoIHUsIHYgKyBFUFMsIHAxICk7CgkJCQkJcHYuc3ViVmVjdG9ycyggcDEsIHAwICk7CgoJCQkJfQoKCQkJCS8vIGNyb3NzIHByb2R1Y3Qgb2YgdGFuZ2VudCB2ZWN0b3JzIHJldHVybnMgc3VyZmFjZSBub3JtYWwKCgkJCQlub3JtYWwuY3Jvc3NWZWN0b3JzKCBwdSwgcHYgKS5ub3JtYWxpemUoKTsKCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCS8vIHV2CgoJCQkJdXZzLnB1c2goIHUsIHYgKTsKCgkJCX0KCgkJfQoKCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCWZvciAoIGkgPSAwOyBpIDwgc3RhY2tzOyBpICsrICkgewoKCQkJZm9yICggaiA9IDA7IGogPCBzbGljZXM7IGogKysgKSB7CgoJCQkJdmFyIGEgPSBpICogc2xpY2VDb3VudCArIGo7CgkJCQl2YXIgYiA9IGkgKiBzbGljZUNvdW50ICsgaiArIDE7CgkJCQl2YXIgYyA9ICggaSArIDEgKSAqIHNsaWNlQ291bnQgKyBqICsgMTsKCQkJCXZhciBkID0gKCBpICsgMSApICogc2xpY2VDb3VudCArIGo7CgoJCQkJLy8gZmFjZXMgb25lIGFuZCB0d28KCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCVBhcmFtZXRyaWNCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVBhcmFtZXRyaWNCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIGNsb2Nrd29ya2dlZWsgLyBodHRwczovL2dpdGh1Yi5jb20vY2xvY2t3b3JrZ2VlawoJICogQGF1dGhvciB0aW1vdGh5cHJhdGxleSAvIGh0dHBzOi8vZ2l0aHViLmNvbS90aW1vdGh5cHJhdGxleQoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJLy8gUG9seWhlZHJvbkdlb21ldHJ5CgoJZnVuY3Rpb24gUG9seWhlZHJvbkdlb21ldHJ5KCB2ZXJ0aWNlcywgaW5kaWNlcywgcmFkaXVzLCBkZXRhaWwgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1BvbHloZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJdmVydGljZXM6IHZlcnRpY2VzLAoJCQlpbmRpY2VzOiBpbmRpY2VzLAoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCQl0aGlzLmZyb21CdWZmZXJHZW9tZXRyeSggbmV3IFBvbHloZWRyb25CdWZmZXJHZW9tZXRyeSggdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJUG9seWhlZHJvbkdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJUG9seWhlZHJvbkdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBvbHloZWRyb25HZW9tZXRyeTsKCgkvLyBQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkoIHZlcnRpY2VzLCBpbmRpY2VzLCByYWRpdXMsIGRldGFpbCApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQl2ZXJ0aWNlczogdmVydGljZXMsCgkJCWluZGljZXM6IGluZGljZXMsCgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJCXJhZGl1cyA9IHJhZGl1cyB8fCAxOwoJCWRldGFpbCA9IGRldGFpbCB8fCAwOwoKCQkvLyBkZWZhdWx0IGJ1ZmZlciBkYXRhCgoJCXZhciB2ZXJ0ZXhCdWZmZXIgPSBbXTsKCQl2YXIgdXZCdWZmZXIgPSBbXTsKCgkJLy8gdGhlIHN1YmRpdmlzaW9uIGNyZWF0ZXMgdGhlIHZlcnRleCBidWZmZXIgZGF0YQoKCQlzdWJkaXZpZGUoIGRldGFpbCApOwoKCQkvLyBhbGwgdmVydGljZXMgc2hvdWxkIGxpZSBvbiBhIGNvbmNlcHR1YWwgc3BoZXJlIHdpdGggYSBnaXZlbiByYWRpdXMKCgkJYXBwcGx5UmFkaXVzKCByYWRpdXMgKTsKCgkJLy8gZmluYWxseSwgY3JlYXRlIHRoZSB1diBkYXRhCgoJCWdlbmVyYXRlVVZzKCk7CgoJCS8vIGJ1aWxkIG5vbi1pbmRleGVkIGdlb21ldHJ5CgoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGV4QnVmZmVyLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0ZXhCdWZmZXIuc2xpY2UoKSwgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dkJ1ZmZlciwgMiApICk7CgoJCWlmICggZGV0YWlsID09PSAwICkgewoKCQkJdGhpcy5jb21wdXRlVmVydGV4Tm9ybWFscygpOyAvLyBmbGF0IG5vcm1hbHMKCgkJfSBlbHNlIHsKCgkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOyAvLyBzbW9vdGggbm9ybWFscwoKCQl9CgoJCS8vIGhlbHBlciBmdW5jdGlvbnMKCgkJZnVuY3Rpb24gc3ViZGl2aWRlKCBkZXRhaWwgKSB7CgoJCQl2YXIgYSA9IG5ldyBWZWN0b3IzKCk7CgkJCXZhciBiID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGMgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gaXRlcmF0ZSBvdmVyIGFsbCBmYWNlcyBhbmQgYXBwbHkgYSBzdWJkaXZpc29uIHdpdGggdGhlIGdpdmVuIGRldGFpbCB2YWx1ZQoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkgKz0gMyApIHsKCgkJCQkvLyBnZXQgdGhlIHZlcnRpY2VzIG9mIHRoZSBmYWNlCgoJCQkJZ2V0VmVydGV4QnlJbmRleCggaW5kaWNlc1sgaSArIDAgXSwgYSApOwoJCQkJZ2V0VmVydGV4QnlJbmRleCggaW5kaWNlc1sgaSArIDEgXSwgYiApOwoJCQkJZ2V0VmVydGV4QnlJbmRleCggaW5kaWNlc1sgaSArIDIgXSwgYyApOwoKCQkJCS8vIHBlcmZvcm0gc3ViZGl2aXNpb24KCgkJCQlzdWJkaXZpZGVGYWNlKCBhLCBiLCBjLCBkZXRhaWwgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzdWJkaXZpZGVGYWNlKCBhLCBiLCBjLCBkZXRhaWwgKSB7CgoJCQl2YXIgY29scyA9IE1hdGgucG93KCAyLCBkZXRhaWwgKTsKCgkJCS8vIHdlIHVzZSB0aGlzIG11bHRpZGltZW5zaW9uYWwgYXJyYXkgYXMgYSBkYXRhIHN0cnVjdHVyZSBmb3IgY3JlYXRpbmcgdGhlIHN1YmRpdmlzaW9uCgoJCQl2YXIgdiA9IFtdOwoKCQkJdmFyIGksIGo7CgoJCQkvLyBjb25zdHJ1Y3QgYWxsIG9mIHRoZSB2ZXJ0aWNlcyBmb3IgdGhpcyBzdWJkaXZpc2lvbgoKCQkJZm9yICggaSA9IDA7IGkgPD0gY29sczsgaSArKyApIHsKCgkJCQl2WyBpIF0gPSBbXTsKCgkJCQl2YXIgYWogPSBhLmNsb25lKCkubGVycCggYywgaSAvIGNvbHMgKTsKCQkJCXZhciBiaiA9IGIuY2xvbmUoKS5sZXJwKCBjLCBpIC8gY29scyApOwoKCQkJCXZhciByb3dzID0gY29scyAtIGk7CgoJCQkJZm9yICggaiA9IDA7IGogPD0gcm93czsgaiArKyApIHsKCgkJCQkJaWYgKCBqID09PSAwICYmIGkgPT09IGNvbHMgKSB7CgoJCQkJCQl2WyBpIF1bIGogXSA9IGFqOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdlsgaSBdWyBqIF0gPSBhai5jbG9uZSgpLmxlcnAoIGJqLCBqIC8gcm93cyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gY29uc3RydWN0IGFsbCBvZiB0aGUgZmFjZXMKCgkJCWZvciAoIGkgPSAwOyBpIDwgY29sczsgaSArKyApIHsKCgkJCQlmb3IgKCBqID0gMDsgaiA8IDIgKiAoIGNvbHMgLSBpICkgLSAxOyBqICsrICkgewoKCQkJCQl2YXIgayA9IE1hdGguZmxvb3IoIGogLyAyICk7CgoJCQkJCWlmICggaiAlIDIgPT09IDAgKSB7CgoJCQkJCQlwdXNoVmVydGV4KCB2WyBpIF1bIGsgKyAxIF0gKTsKCQkJCQkJcHVzaFZlcnRleCggdlsgaSArIDEgXVsgayBdICk7CgkJCQkJCXB1c2hWZXJ0ZXgoIHZbIGkgXVsgayBdICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlwdXNoVmVydGV4KCB2WyBpIF1bIGsgKyAxIF0gKTsKCQkJCQkJcHVzaFZlcnRleCggdlsgaSArIDEgXVsgayArIDEgXSApOwoJCQkJCQlwdXNoVmVydGV4KCB2WyBpICsgMSBdWyBrIF0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBhcHBwbHlSYWRpdXMoIHJhZGl1cyApIHsKCgkJCXZhciB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gaXRlcmF0ZSBvdmVyIHRoZSBlbnRpcmUgYnVmZmVyIGFuZCBhcHBseSB0aGUgcmFkaXVzIHRvIGVhY2ggdmVydGV4CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB2ZXJ0ZXhCdWZmZXIubGVuZ3RoOyBpICs9IDMgKSB7CgoJCQkJdmVydGV4LnggPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAwIF07CgkJCQl2ZXJ0ZXgueSA9IHZlcnRleEJ1ZmZlclsgaSArIDEgXTsKCQkJCXZlcnRleC56ID0gdmVydGV4QnVmZmVyWyBpICsgMiBdOwoKCQkJCXZlcnRleC5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhciggcmFkaXVzICk7CgoJCQkJdmVydGV4QnVmZmVyWyBpICsgMCBdID0gdmVydGV4Lng7CgkJCQl2ZXJ0ZXhCdWZmZXJbIGkgKyAxIF0gPSB2ZXJ0ZXgueTsKCQkJCXZlcnRleEJ1ZmZlclsgaSArIDIgXSA9IHZlcnRleC56OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlVVZzKCkgewoKCQkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB2ZXJ0ZXhCdWZmZXIubGVuZ3RoOyBpICs9IDMgKSB7CgoJCQkJdmVydGV4LnggPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAwIF07CgkJCQl2ZXJ0ZXgueSA9IHZlcnRleEJ1ZmZlclsgaSArIDEgXTsKCQkJCXZlcnRleC56ID0gdmVydGV4QnVmZmVyWyBpICsgMiBdOwoKCQkJCXZhciB1ID0gYXppbXV0aCggdmVydGV4ICkgLyAyIC8gTWF0aC5QSSArIDAuNTsKCQkJCXZhciB2ID0gaW5jbGluYXRpb24oIHZlcnRleCApIC8gTWF0aC5QSSArIDAuNTsKCQkJCXV2QnVmZmVyLnB1c2goIHUsIDEgLSB2ICk7CgoJCQl9CgoJCQljb3JyZWN0VVZzKCk7CgoJCQljb3JyZWN0U2VhbSgpOwoKCQl9CgoJCWZ1bmN0aW9uIGNvcnJlY3RTZWFtKCkgewoKCQkJLy8gaGFuZGxlIGNhc2Ugd2hlbiBmYWNlIHN0cmFkZGxlcyB0aGUgc2VhbSwgc2VlICMzMjY5CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB1dkJ1ZmZlci5sZW5ndGg7IGkgKz0gNiApIHsKCgkJCQkvLyB1diBkYXRhIG9mIGEgc2luZ2xlIGZhY2UKCgkJCQl2YXIgeDAgPSB1dkJ1ZmZlclsgaSArIDAgXTsKCQkJCXZhciB4MSA9IHV2QnVmZmVyWyBpICsgMiBdOwoJCQkJdmFyIHgyID0gdXZCdWZmZXJbIGkgKyA0IF07CgoJCQkJdmFyIG1heCA9IE1hdGgubWF4KCB4MCwgeDEsIHgyICk7CgkJCQl2YXIgbWluID0gTWF0aC5taW4oIHgwLCB4MSwgeDIgKTsKCgkJCQkvLyAwLjkgaXMgc29tZXdoYXQgYXJiaXRyYXJ5CgoJCQkJaWYgKCBtYXggPiAwLjkgJiYgbWluIDwgMC4xICkgewoKCQkJCQlpZiAoIHgwIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAwIF0gKz0gMTsKCQkJCQlpZiAoIHgxIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAyIF0gKz0gMTsKCQkJCQlpZiAoIHgyIDwgMC4yICkgdXZCdWZmZXJbIGkgKyA0IF0gKz0gMTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcHVzaFZlcnRleCggdmVydGV4ICkgewoKCQkJdmVydGV4QnVmZmVyLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRWZXJ0ZXhCeUluZGV4KCBpbmRleCwgdmVydGV4ICkgewoKCQkJdmFyIHN0cmlkZSA9IGluZGV4ICogMzsKCgkJCXZlcnRleC54ID0gdmVydGljZXNbIHN0cmlkZSArIDAgXTsKCQkJdmVydGV4LnkgPSB2ZXJ0aWNlc1sgc3RyaWRlICsgMSBdOwoJCQl2ZXJ0ZXgueiA9IHZlcnRpY2VzWyBzdHJpZGUgKyAyIF07CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFVWcygpIHsKCgkJCXZhciBhID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIGIgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgYyA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgY2VudHJvaWQgPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIHV2QSA9IG5ldyBWZWN0b3IyKCk7CgkJCXZhciB1dkIgPSBuZXcgVmVjdG9yMigpOwoJCQl2YXIgdXZDID0gbmV3IFZlY3RvcjIoKTsKCgkJCWZvciAoIHZhciBpID0gMCwgaiA9IDA7IGkgPCB2ZXJ0ZXhCdWZmZXIubGVuZ3RoOyBpICs9IDksIGogKz0gNiApIHsKCgkJCQlhLnNldCggdmVydGV4QnVmZmVyWyBpICsgMCBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyAxIF0sIHZlcnRleEJ1ZmZlclsgaSArIDIgXSApOwoJCQkJYi5zZXQoIHZlcnRleEJ1ZmZlclsgaSArIDMgXSwgdmVydGV4QnVmZmVyWyBpICsgNCBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyA1IF0gKTsKCQkJCWMuc2V0KCB2ZXJ0ZXhCdWZmZXJbIGkgKyA2IF0sIHZlcnRleEJ1ZmZlclsgaSArIDcgXSwgdmVydGV4QnVmZmVyWyBpICsgOCBdICk7CgoJCQkJdXZBLnNldCggdXZCdWZmZXJbIGogKyAwIF0sIHV2QnVmZmVyWyBqICsgMSBdICk7CgkJCQl1dkIuc2V0KCB1dkJ1ZmZlclsgaiArIDIgXSwgdXZCdWZmZXJbIGogKyAzIF0gKTsKCQkJCXV2Qy5zZXQoIHV2QnVmZmVyWyBqICsgNCBdLCB1dkJ1ZmZlclsgaiArIDUgXSApOwoKCQkJCWNlbnRyb2lkLmNvcHkoIGEgKS5hZGQoIGIgKS5hZGQoIGMgKS5kaXZpZGVTY2FsYXIoIDMgKTsKCgkJCQl2YXIgYXppID0gYXppbXV0aCggY2VudHJvaWQgKTsKCgkJCQljb3JyZWN0VVYoIHV2QSwgaiArIDAsIGEsIGF6aSApOwoJCQkJY29ycmVjdFVWKCB1dkIsIGogKyAyLCBiLCBhemkgKTsKCQkJCWNvcnJlY3RVViggdXZDLCBqICsgNCwgYywgYXppICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFVWKCB1diwgc3RyaWRlLCB2ZWN0b3IsIGF6aW11dGggKSB7CgoJCQlpZiAoICggYXppbXV0aCA8IDAgKSAmJiAoIHV2LnggPT09IDEgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSB1di54IC0gMTsKCgkJCX0KCgkJCWlmICggKCB2ZWN0b3IueCA9PT0gMCApICYmICggdmVjdG9yLnogPT09IDAgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSBhemltdXRoIC8gMiAvIE1hdGguUEkgKyAwLjU7CgoJCQl9CgoJCX0KCgkJLy8gQW5nbGUgYXJvdW5kIHRoZSBZIGF4aXMsIGNvdW50ZXItY2xvY2t3aXNlIHdoZW4gbG9va2luZyBmcm9tIGFib3ZlLgoKCQlmdW5jdGlvbiBhemltdXRoKCB2ZWN0b3IgKSB7CgoJCQlyZXR1cm4gTWF0aC5hdGFuMiggdmVjdG9yLnosIC0gdmVjdG9yLnggKTsKCgkJfQoKCgkJLy8gQW5nbGUgYWJvdmUgdGhlIFhaIHBsYW5lLgoKCQlmdW5jdGlvbiBpbmNsaW5hdGlvbiggdmVjdG9yICkgewoKCQkJcmV0dXJuIE1hdGguYXRhbjIoIC0gdmVjdG9yLnksIE1hdGguc3FydCggKCB2ZWN0b3IueCAqIHZlY3Rvci54ICkgKyAoIHZlY3Rvci56ICogdmVjdG9yLnogKSApICk7CgoJCX0KCgl9CgoJUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSApOwoJUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBvbHloZWRyb25CdWZmZXJHZW9tZXRyeTsKCgkvKioKCSAqIEBhdXRob3IgdGltb3RoeXByYXRsZXkgLyBodHRwczovL2dpdGh1Yi5jb20vdGltb3RoeXByYXRsZXkKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBUZXRyYWhlZHJvbkdlb21ldHJ5CgoJZnVuY3Rpb24gVGV0cmFoZWRyb25HZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1RldHJhaGVkcm9uR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgVGV0cmFoZWRyb25CdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSApOwoJCXRoaXMubWVyZ2VWZXJ0aWNlcygpOwoKCX0KCglUZXRyYWhlZHJvbkdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJVGV0cmFoZWRyb25HZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUZXRyYWhlZHJvbkdlb21ldHJ5OwoKCS8vIFRldHJhaGVkcm9uQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBUZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5KCByYWRpdXMsIGRldGFpbCApIHsKCgkJdmFyIHZlcnRpY2VzID0gWwoJCQkxLCAxLCAxLCAJLSAxLCAtIDEsIDEsIAktIDEsIDEsIC0gMSwgCTEsIC0gMSwgLSAxCgkJXTsKCgkJdmFyIGluZGljZXMgPSBbCgkJCTIsIDEsIDAsIAkwLCAzLCAyLAkxLCAzLCAwLAkyLCAzLCAxCgkJXTsKCgkJUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMsIHZlcnRpY2VzLCBpbmRpY2VzLCByYWRpdXMsIGRldGFpbCApOwoKCQl0aGlzLnR5cGUgPSAnVGV0cmFoZWRyb25CdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgl9CgoJVGV0cmFoZWRyb25CdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglUZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFRldHJhaGVkcm9uQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIHRpbW90aHlwcmF0bGV5IC8gaHR0cHM6Ly9naXRodWIuY29tL3RpbW90aHlwcmF0bGV5CgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJLy8gT2N0YWhlZHJvbkdlb21ldHJ5CgoJZnVuY3Rpb24gT2N0YWhlZHJvbkdlb21ldHJ5KCByYWRpdXMsIGRldGFpbCApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnT2N0YWhlZHJvbkdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCQl0aGlzLmZyb21CdWZmZXJHZW9tZXRyeSggbmV3IE9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSApOwoJCXRoaXMubWVyZ2VWZXJ0aWNlcygpOwoKCX0KCglPY3RhaGVkcm9uR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggR2VvbWV0cnkucHJvdG90eXBlICk7CglPY3RhaGVkcm9uR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gT2N0YWhlZHJvbkdlb21ldHJ5OwoKCS8vIE9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIE9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSB7CgoJCXZhciB2ZXJ0aWNlcyA9IFsKCQkJMSwgMCwgMCwgCS0gMSwgMCwgMCwJMCwgMSwgMCwKCQkJMCwgLSAxLCAwLCAJMCwgMCwgMSwJMCwgMCwgLSAxCgkJXTsKCgkJdmFyIGluZGljZXMgPSBbCgkJCTAsIDIsIDQsCTAsIDQsIDMsCTAsIDMsIDUsCgkJCTAsIDUsIDIsCTEsIDIsIDUsCTEsIDUsIDMsCgkJCTEsIDMsIDQsCTEsIDQsIDIKCQldOwoKCQlQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcywgdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdPY3RhaGVkcm9uQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJfQoKCU9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglPY3RhaGVkcm9uQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gT2N0YWhlZHJvbkJ1ZmZlckdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciB0aW1vdGh5cHJhdGxleSAvIGh0dHBzOi8vZ2l0aHViLmNvbS90aW1vdGh5cHJhdGxleQoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCS8vIEljb3NhaGVkcm9uR2VvbWV0cnkKCglmdW5jdGlvbiBJY29zYWhlZHJvbkdlb21ldHJ5KCByYWRpdXMsIGRldGFpbCApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnSWNvc2FoZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBJY29zYWhlZHJvbkJ1ZmZlckdlb21ldHJ5KCByYWRpdXMsIGRldGFpbCApICk7CgkJdGhpcy5tZXJnZVZlcnRpY2VzKCk7CgoJfQoKCUljb3NhaGVkcm9uR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggR2VvbWV0cnkucHJvdG90eXBlICk7CglJY29zYWhlZHJvbkdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEljb3NhaGVkcm9uR2VvbWV0cnk7CgoJLy8gSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIEljb3NhaGVkcm9uQnVmZmVyR2VvbWV0cnkoIHJhZGl1cywgZGV0YWlsICkgewoKCQl2YXIgdCA9ICggMSArIE1hdGguc3FydCggNSApICkgLyAyOwoKCQl2YXIgdmVydGljZXMgPSBbCgkJCS0gMSwgdCwgMCwgCTEsIHQsIDAsIAktIDEsIC0gdCwgMCwgCTEsIC0gdCwgMCwKCQkJIDAsIC0gMSwgdCwgCTAsIDEsIHQsCTAsIC0gMSwgLSB0LCAJMCwgMSwgLSB0LAoJCQkgdCwgMCwgLSAxLCAJdCwgMCwgMSwgCS0gdCwgMCwgLSAxLCAJLSB0LCAwLCAxCgkJXTsKCgkJdmFyIGluZGljZXMgPSBbCgkJCSAwLCAxMSwgNSwgCTAsIDUsIDEsIAkwLCAxLCA3LCAJMCwgNywgMTAsIAkwLCAxMCwgMTEsCgkJCSAxLCA1LCA5LCAJNSwgMTEsIDQsCTExLCAxMCwgMiwJMTAsIDcsIDYsCTcsIDEsIDgsCgkJCSAzLCA5LCA0LCAJMywgNCwgMiwJMywgMiwgNiwJMywgNiwgOCwJMywgOCwgOSwKCQkJIDQsIDksIDUsIAkyLCA0LCAxMSwJNiwgMiwgMTAsCTgsIDYsIDcsCTksIDgsIDEKCQldOwoKCQlQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcywgdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdJY29zYWhlZHJvbkJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCX0KCglJY29zYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFBvbHloZWRyb25CdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCUljb3NhaGVkcm9uQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeTsKCgkvKioKCSAqIEBhdXRob3IgQWJlIFBhem9zIC8gaHR0cHM6Ly9oYW1vaWQuY29tCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJLy8gRG9kZWNhaGVkcm9uR2VvbWV0cnkKCglmdW5jdGlvbiBEb2RlY2FoZWRyb25HZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0RvZGVjYWhlZHJvbkdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCQl0aGlzLmZyb21CdWZmZXJHZW9tZXRyeSggbmV3IERvZGVjYWhlZHJvbkJ1ZmZlckdlb21ldHJ5KCByYWRpdXMsIGRldGFpbCApICk7CgkJdGhpcy5tZXJnZVZlcnRpY2VzKCk7CgoJfQoKCURvZGVjYWhlZHJvbkdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJRG9kZWNhaGVkcm9uR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRG9kZWNhaGVkcm9uR2VvbWV0cnk7CgoJLy8gRG9kZWNhaGVkcm9uQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBEb2RlY2FoZWRyb25CdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBkZXRhaWwgKSB7CgoJCXZhciB0ID0gKCAxICsgTWF0aC5zcXJ0KCA1ICkgKSAvIDI7CgkJdmFyIHIgPSAxIC8gdDsKCgkJdmFyIHZlcnRpY2VzID0gWwoKCQkJLy8gKMKxMSwgwrExLCDCsTEpCgkJCS0gMSwgLSAxLCAtIDEsCS0gMSwgLSAxLCAxLAoJCQktIDEsIDEsIC0gMSwgLSAxLCAxLCAxLAoJCQkxLCAtIDEsIC0gMSwgMSwgLSAxLCAxLAoJCQkxLCAxLCAtIDEsIDEsIDEsIDEsCgoJCQkvLyAoMCwgwrExL8+GLCDCsc+GKQoJCQkgMCwgLSByLCAtIHQsIDAsIC0gciwgdCwKCQkJIDAsIHIsIC0gdCwgMCwgciwgdCwKCgkJCS8vICjCsTEvz4YsIMKxz4YsIDApCgkJCS0gciwgLSB0LCAwLCAtIHIsIHQsIDAsCgkJCSByLCAtIHQsIDAsIHIsIHQsIDAsCgoJCQkvLyAowrHPhiwgMCwgwrExL8+GKQoJCQktIHQsIDAsIC0gciwgdCwgMCwgLSByLAoJCQktIHQsIDAsIHIsIHQsIDAsIHIKCQldOwoKCQl2YXIgaW5kaWNlcyA9IFsKCQkJMywgMTEsIDcsIAkzLCA3LCAxNSwgCTMsIDE1LCAxMywKCQkJNywgMTksIDE3LCAJNywgMTcsIDYsIAk3LCA2LCAxNSwKCQkJMTcsIDQsIDgsIAkxNywgOCwgMTAsIAkxNywgMTAsIDYsCgkJCTgsIDAsIDE2LCAJOCwgMTYsIDIsIAk4LCAyLCAxMCwKCQkJMCwgMTIsIDEsIAkwLCAxLCAxOCwgCTAsIDE4LCAxNiwKCQkJNiwgMTAsIDIsIAk2LCAyLCAxMywgCTYsIDEzLCAxNSwKCQkJMiwgMTYsIDE4LCAJMiwgMTgsIDMsIAkyLCAzLCAxMywKCQkJMTgsIDEsIDksIAkxOCwgOSwgMTEsIAkxOCwgMTEsIDMsCgkJCTQsIDE0LCAxMiwgCTQsIDEyLCAwLCAJNCwgMCwgOCwKCQkJMTEsIDksIDUsIAkxMSwgNSwgMTksIAkxMSwgMTksIDcsCgkJCTE5LCA1LCAxNCwgCTE5LCAxNCwgNCwgCTE5LCA0LCAxNywKCQkJMSwgMTIsIDE0LCAJMSwgMTQsIDUsIAkxLCA1LCA5CgkJXTsKCgkJUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMsIHZlcnRpY2VzLCBpbmRpY2VzLCByYWRpdXMsIGRldGFpbCApOwoKCQl0aGlzLnR5cGUgPSAnRG9kZWNhaGVkcm9uQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJfQoKCURvZGVjYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFBvbHloZWRyb25CdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCURvZGVjYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERvZGVjYWhlZHJvbkJ1ZmZlckdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciBvb3Ntb3hpZWNvZGUgLyBodHRwczovL2dpdGh1Yi5jb20vb29zbW94aWVjb2RlCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cHM6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKiBAYXV0aG9yIHp6ODUgLyBodHRwczovL2dpdGh1Yi5jb20veno4NQoJICogQGF1dGhvciBtaW5pbmdvbGQgLyBodHRwczovL2dpdGh1Yi5jb20vbWluaW5nb2xkCgkgKiBAYXV0aG9yIGpvbm9icjEgLyBodHRwczovL2dpdGh1Yi5jb20vam9ub2JyMQoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqCgkgKi8KCgkvLyBUdWJlR2VvbWV0cnkKCglmdW5jdGlvbiBUdWJlR2VvbWV0cnkoIHBhdGgsIHR1YnVsYXJTZWdtZW50cywgcmFkaXVzLCByYWRpYWxTZWdtZW50cywgY2xvc2VkLCB0YXBlciApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnVHViZUdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlwYXRoOiBwYXRoLAoJCQl0dWJ1bGFyU2VnbWVudHM6IHR1YnVsYXJTZWdtZW50cywKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJY2xvc2VkOiBjbG9zZWQKCQl9OwoKCQlpZiAoIHRhcGVyICE9PSB1bmRlZmluZWQgKSBjb25zb2xlLndhcm4oICdUSFJFRS5UdWJlR2VvbWV0cnk6IHRhcGVyIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl2YXIgYnVmZmVyR2VvbWV0cnkgPSBuZXcgVHViZUJ1ZmZlckdlb21ldHJ5KCBwYXRoLCB0dWJ1bGFyU2VnbWVudHMsIHJhZGl1cywgcmFkaWFsU2VnbWVudHMsIGNsb3NlZCApOwoKCQkvLyBleHBvc2UgaW50ZXJuYWxzCgoJCXRoaXMudGFuZ2VudHMgPSBidWZmZXJHZW9tZXRyeS50YW5nZW50czsKCQl0aGlzLm5vcm1hbHMgPSBidWZmZXJHZW9tZXRyeS5ub3JtYWxzOwoJCXRoaXMuYmlub3JtYWxzID0gYnVmZmVyR2VvbWV0cnkuYmlub3JtYWxzOwoKCQkvLyBjcmVhdGUgZ2VvbWV0cnkKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIGJ1ZmZlckdlb21ldHJ5ICk7CgkJdGhpcy5tZXJnZVZlcnRpY2VzKCk7CgoJfQoKCVR1YmVHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVR1YmVHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUdWJlR2VvbWV0cnk7CgoJLy8gVHViZUJ1ZmZlckdlb21ldHJ5CgoJZnVuY3Rpb24gVHViZUJ1ZmZlckdlb21ldHJ5KCBwYXRoLCB0dWJ1bGFyU2VnbWVudHMsIHJhZGl1cywgcmFkaWFsU2VnbWVudHMsIGNsb3NlZCApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnVHViZUJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlwYXRoOiBwYXRoLAoJCQl0dWJ1bGFyU2VnbWVudHM6IHR1YnVsYXJTZWdtZW50cywKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJY2xvc2VkOiBjbG9zZWQKCQl9OwoKCQl0dWJ1bGFyU2VnbWVudHMgPSB0dWJ1bGFyU2VnbWVudHMgfHwgNjQ7CgkJcmFkaXVzID0gcmFkaXVzIHx8IDE7CgkJcmFkaWFsU2VnbWVudHMgPSByYWRpYWxTZWdtZW50cyB8fCA4OwoJCWNsb3NlZCA9IGNsb3NlZCB8fCBmYWxzZTsKCgkJdmFyIGZyYW1lcyA9IHBhdGguY29tcHV0ZUZyZW5ldEZyYW1lcyggdHVidWxhclNlZ21lbnRzLCBjbG9zZWQgKTsKCgkJLy8gZXhwb3NlIGludGVybmFscwoKCQl0aGlzLnRhbmdlbnRzID0gZnJhbWVzLnRhbmdlbnRzOwoJCXRoaXMubm9ybWFscyA9IGZyYW1lcy5ub3JtYWxzOwoJCXRoaXMuYmlub3JtYWxzID0gZnJhbWVzLmJpbm9ybWFsczsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgdXYgPSBuZXcgVmVjdG9yMigpOwoJCXZhciBQID0gbmV3IFZlY3RvcjMoKTsKCgkJdmFyIGksIGo7CgoJCS8vIGJ1ZmZlcgoKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCQl2YXIgaW5kaWNlcyA9IFtdOwoKCQkvLyBjcmVhdGUgYnVmZmVyIGRhdGEKCgkJZ2VuZXJhdGVCdWZmZXJEYXRhKCk7CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJCS8vIGZ1bmN0aW9ucwoKCQlmdW5jdGlvbiBnZW5lcmF0ZUJ1ZmZlckRhdGEoKSB7CgoJCQlmb3IgKCBpID0gMDsgaSA8IHR1YnVsYXJTZWdtZW50czsgaSArKyApIHsKCgkJCQlnZW5lcmF0ZVNlZ21lbnQoIGkgKTsKCgkJCX0KCgkJCS8vIGlmIHRoZSBnZW9tZXRyeSBpcyBub3QgY2xvc2VkLCBnZW5lcmF0ZSB0aGUgbGFzdCByb3cgb2YgdmVydGljZXMgYW5kIG5vcm1hbHMKCQkJLy8gYXQgdGhlIHJlZ3VsYXIgcG9zaXRpb24gb24gdGhlIGdpdmVuIHBhdGgKCQkJLy8KCQkJLy8gaWYgdGhlIGdlb21ldHJ5IGlzIGNsb3NlZCwgZHVwbGljYXRlIHRoZSBmaXJzdCByb3cgb2YgdmVydGljZXMgYW5kIG5vcm1hbHMgKHV2cyB3aWxsIGRpZmZlcikKCgkJCWdlbmVyYXRlU2VnbWVudCggKCBjbG9zZWQgPT09IGZhbHNlICkgPyB0dWJ1bGFyU2VnbWVudHMgOiAwICk7CgoJCQkvLyB1dnMgYXJlIGdlbmVyYXRlZCBpbiBhIHNlcGFyYXRlIGZ1bmN0aW9uLgoJCQkvLyB0aGlzIG1ha2VzIGl0IGVhc3kgY29tcHV0ZSBjb3JyZWN0IHZhbHVlcyBmb3IgY2xvc2VkIGdlb21ldHJpZXMKCgkJCWdlbmVyYXRlVVZzKCk7CgoJCQkvLyBmaW5hbGx5IGNyZWF0ZSBmYWNlcwoKCQkJZ2VuZXJhdGVJbmRpY2VzKCk7CgoJCX0KCgkJZnVuY3Rpb24gZ2VuZXJhdGVTZWdtZW50KCBpICkgewoKCQkJLy8gd2UgdXNlIGdldFBvaW50QXQgdG8gc2FtcGxlIGV2ZW5seSBkaXN0cmlidXRlZCBwb2ludHMgZnJvbSB0aGUgZ2l2ZW4gcGF0aAoKCQkJUCA9IHBhdGguZ2V0UG9pbnRBdCggaSAvIHR1YnVsYXJTZWdtZW50cywgUCApOwoKCQkJLy8gcmV0cmlldmUgY29ycmVzcG9uZGluZyBub3JtYWwgYW5kIGJpbm9ybWFsCgoJCQl2YXIgTiA9IGZyYW1lcy5ub3JtYWxzWyBpIF07CgkJCXZhciBCID0gZnJhbWVzLmJpbm9ybWFsc1sgaSBdOwoKCQkJLy8gZ2VuZXJhdGUgbm9ybWFscyBhbmQgdmVydGljZXMgZm9yIHRoZSBjdXJyZW50IHNlZ21lbnQKCgkJCWZvciAoIGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqICsrICkgewoKCQkJCXZhciB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CgoJCQkJdmFyIHNpbiA9IE1hdGguc2luKCB2ICk7CgkJCQl2YXIgY29zID0gLSBNYXRoLmNvcyggdiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCW5vcm1hbC54ID0gKCBjb3MgKiBOLnggKyBzaW4gKiBCLnggKTsKCQkJCW5vcm1hbC55ID0gKCBjb3MgKiBOLnkgKyBzaW4gKiBCLnkgKTsKCQkJCW5vcm1hbC56ID0gKCBjb3MgKiBOLnogKyBzaW4gKiBCLnogKTsKCQkJCW5vcm1hbC5ub3JtYWxpemUoKTsKCgkJCQlub3JtYWxzLnB1c2goIG5vcm1hbC54LCBub3JtYWwueSwgbm9ybWFsLnogKTsKCgkJCQkvLyB2ZXJ0ZXgKCgkJCQl2ZXJ0ZXgueCA9IFAueCArIHJhZGl1cyAqIG5vcm1hbC54OwoJCQkJdmVydGV4LnkgPSBQLnkgKyByYWRpdXMgKiBub3JtYWwueTsKCQkJCXZlcnRleC56ID0gUC56ICsgcmFkaXVzICogbm9ybWFsLno7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlSW5kaWNlcygpIHsKCgkJCWZvciAoIGogPSAxOyBqIDw9IHR1YnVsYXJTZWdtZW50czsgaiArKyApIHsKCgkJCQlmb3IgKCBpID0gMTsgaSA8PSByYWRpYWxTZWdtZW50czsgaSArKyApIHsKCgkJCQkJdmFyIGEgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgKCBpIC0gMSApOwoJCQkJCXZhciBiID0gKCByYWRpYWxTZWdtZW50cyArIDEgKSAqIGogKyAoIGkgLSAxICk7CgkJCQkJdmFyIGMgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogaiArIGk7CgkJCQkJdmFyIGQgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCgkJCQkJLy8gZmFjZXMKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlVVZzKCkgewoKCQkJZm9yICggaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWZvciAoIGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqICsrICkgewoKCQkJCQl1di54ID0gaSAvIHR1YnVsYXJTZWdtZW50czsKCQkJCQl1di55ID0gaiAvIHJhZGlhbFNlZ21lbnRzOwoKCQkJCQl1dnMucHVzaCggdXYueCwgdXYueSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0KCglUdWJlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglUdWJlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVHViZUJ1ZmZlckdlb21ldHJ5OwoKCVR1YmVCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgZGF0YSA9IEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS50b0pTT04uY2FsbCggdGhpcyApOwoKCQlkYXRhLnBhdGggPSB0aGlzLnBhcmFtZXRlcnMucGF0aC50b0pTT04oKTsKCgkJcmV0dXJuIGRhdGE7CgoJfTsKCgkvKioKCSAqIEBhdXRob3Igb29zbW94aWVjb2RlCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICoKCSAqIGJhc2VkIG9uIGh0dHA6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wcXRvcnVzLwoJICovCgoJLy8gVG9ydXNLbm90R2VvbWV0cnkKCglmdW5jdGlvbiBUb3J1c0tub3RHZW9tZXRyeSggcmFkaXVzLCB0dWJlLCB0dWJ1bGFyU2VnbWVudHMsIHJhZGlhbFNlZ21lbnRzLCBwLCBxLCBoZWlnaHRTY2FsZSApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNLbm90R2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl0dWJlOiB0dWJlLAoJCQl0dWJ1bGFyU2VnbWVudHM6IHR1YnVsYXJTZWdtZW50cywKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQlwOiBwLAoJCQlxOiBxCgkJfTsKCgkJaWYgKCBoZWlnaHRTY2FsZSAhPT0gdW5kZWZpbmVkICkgY29uc29sZS53YXJuKCAnVEhSRUUuVG9ydXNLbm90R2VvbWV0cnk6IGhlaWdodFNjYWxlIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAuc2NhbGUoIHgsIHksIHogKSBpbnN0ZWFkLicgKTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBUb3J1c0tub3RCdWZmZXJHZW9tZXRyeSggcmFkaXVzLCB0dWJlLCB0dWJ1bGFyU2VnbWVudHMsIHJhZGlhbFNlZ21lbnRzLCBwLCBxICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJVG9ydXNLbm90R2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggR2VvbWV0cnkucHJvdG90eXBlICk7CglUb3J1c0tub3RHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUb3J1c0tub3RHZW9tZXRyeTsKCgkvLyBUb3J1c0tub3RCdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIFRvcnVzS25vdEJ1ZmZlckdlb21ldHJ5KCByYWRpdXMsIHR1YmUsIHR1YnVsYXJTZWdtZW50cywgcmFkaWFsU2VnbWVudHMsIHAsIHEgKSB7CgoJCUJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1RvcnVzS25vdEJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJdHViZTogdHViZSwKCQkJdHVidWxhclNlZ21lbnRzOiB0dWJ1bGFyU2VnbWVudHMsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJcDogcCwKCQkJcTogcQoJCX07CgoJCXJhZGl1cyA9IHJhZGl1cyB8fCAxOwoJCXR1YmUgPSB0dWJlIHx8IDAuNDsKCQl0dWJ1bGFyU2VnbWVudHMgPSBNYXRoLmZsb29yKCB0dWJ1bGFyU2VnbWVudHMgKSB8fCA2NDsKCQlyYWRpYWxTZWdtZW50cyA9IE1hdGguZmxvb3IoIHJhZGlhbFNlZ21lbnRzICkgfHwgODsKCQlwID0gcCB8fCAyOwoJCXEgPSBxIHx8IDM7CgoJCS8vIGJ1ZmZlcnMKCgkJdmFyIGluZGljZXMgPSBbXTsKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgaSwgajsKCgkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCXZhciBQMSA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIFAyID0gbmV3IFZlY3RvcjMoKTsKCgkJdmFyIEIgPSBuZXcgVmVjdG9yMygpOwoJCXZhciBUID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgTiA9IG5ldyBWZWN0b3IzKCk7CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJZm9yICggaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyArKyBpICkgewoKCQkJLy8gdGhlIHJhZGlhbiAidSIgaXMgdXNlZCB0byBjYWxjdWxhdGUgdGhlIHBvc2l0aW9uIG9uIHRoZSB0b3J1cyBjdXJ2ZSBvZiB0aGUgY3VycmVudCB0dWJ1bGFyIHNlZ2VtZW50CgoJCQl2YXIgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBwICogTWF0aC5QSSAqIDI7CgoJCQkvLyBub3cgd2UgY2FsY3VsYXRlIHR3byBwb2ludHMuIFAxIGlzIG91ciBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSBjdXJ2ZSwgUDIgaXMgYSBsaXR0bGUgZmFydGhlciBhaGVhZC4KCQkJLy8gdGhlc2UgcG9pbnRzIGFyZSB1c2VkIHRvIGNyZWF0ZSBhIHNwZWNpYWwgImNvb3JkaW5hdGUgc3BhY2UiLCB3aGljaCBpcyBuZWNlc3NhcnkgdG8gY2FsY3VsYXRlIHRoZSBjb3JyZWN0IHZlcnRleCBwb3NpdGlvbnMKCgkJCWNhbGN1bGF0ZVBvc2l0aW9uT25DdXJ2ZSggdSwgcCwgcSwgcmFkaXVzLCBQMSApOwoJCQljYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUgKyAwLjAxLCBwLCBxLCByYWRpdXMsIFAyICk7CgoJCQkvLyBjYWxjdWxhdGUgb3J0aG9ub3JtYWwgYmFzaXMKCgkJCVQuc3ViVmVjdG9ycyggUDIsIFAxICk7CgkJCU4uYWRkVmVjdG9ycyggUDIsIFAxICk7CgkJCUIuY3Jvc3NWZWN0b3JzKCBULCBOICk7CgkJCU4uY3Jvc3NWZWN0b3JzKCBCLCBUICk7CgoJCQkvLyBub3JtYWxpemUgQiwgTi4gVCBjYW4gYmUgaWdub3JlZCwgd2UgZG9uJ3QgdXNlIGl0CgoJCQlCLm5vcm1hbGl6ZSgpOwoJCQlOLm5vcm1hbGl6ZSgpOwoKCQkJZm9yICggaiA9IDA7IGogPD0gcmFkaWFsU2VnbWVudHM7ICsrIGogKSB7CgoJCQkJLy8gbm93IGNhbGN1bGF0ZSB0aGUgdmVydGljZXMuIHRoZXkgYXJlIG5vdGhpbmcgbW9yZSB0aGFuIGFuIGV4dHJ1c2lvbiBvZiB0aGUgdG9ydXMgY3VydmUuCgkJCQkvLyBiZWNhdXNlIHdlIGV4dHJ1ZGUgYSBzaGFwZSBpbiB0aGUgeHktcGxhbmUsIHRoZXJlIGlzIG5vIG5lZWQgdG8gY2FsY3VsYXRlIGEgei12YWx1ZS4KCgkJCQl2YXIgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwoJCQkJdmFyIGN4ID0gLSB0dWJlICogTWF0aC5jb3MoIHYgKTsKCQkJCXZhciBjeSA9IHR1YmUgKiBNYXRoLnNpbiggdiApOwoKCQkJCS8vIG5vdyBjYWxjdWxhdGUgdGhlIGZpbmFsIHZlcnRleCBwb3NpdGlvbi4KCQkJCS8vIGZpcnN0IHdlIG9yaWVudCB0aGUgZXh0cnVzaW9uIHdpdGggb3VyIGJhc2lzIHZlY3RvcywgdGhlbiB3ZSBhZGQgaXQgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24gb24gdGhlIGN1cnZlCgoJCQkJdmVydGV4LnggPSBQMS54ICsgKCBjeCAqIE4ueCArIGN5ICogQi54ICk7CgkJCQl2ZXJ0ZXgueSA9IFAxLnkgKyAoIGN4ICogTi55ICsgY3kgKiBCLnkgKTsKCQkJCXZlcnRleC56ID0gUDEueiArICggY3ggKiBOLnogKyBjeSAqIEIueiApOwoKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkvLyBub3JtYWwgKFAxIGlzIGFsd2F5cyB0aGUgY2VudGVyL29yaWdpbiBvZiB0aGUgZXh0cnVzaW9uLCB0aHVzIHdlIGNhbiB1c2UgaXQgdG8gY2FsY3VsYXRlIHRoZSBub3JtYWwpCgoJCQkJbm9ybWFsLnN1YlZlY3RvcnMoIHZlcnRleCwgUDEgKS5ub3JtYWxpemUoKTsKCgkJCQlub3JtYWxzLnB1c2goIG5vcm1hbC54LCBub3JtYWwueSwgbm9ybWFsLnogKTsKCgkJCQkvLyB1dgoKCQkJCXV2cy5wdXNoKCBpIC8gdHVidWxhclNlZ21lbnRzICk7CgkJCQl1dnMucHVzaCggaiAvIHJhZGlhbFNlZ21lbnRzICk7CgoJCQl9CgoJCX0KCgkJLy8gZ2VuZXJhdGUgaW5kaWNlcwoKCQlmb3IgKCBqID0gMTsgaiA8PSB0dWJ1bGFyU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBpID0gMTsgaSA8PSByYWRpYWxTZWdtZW50czsgaSArKyApIHsKCgkJCQkvLyBpbmRpY2VzCgoJCQkJdmFyIGEgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgKCBpIC0gMSApOwoJCQkJdmFyIGIgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogaiArICggaSAtIDEgKTsKCQkJCXZhciBjID0gKCByYWRpYWxTZWdtZW50cyArIDEgKSAqIGogKyBpOwoJCQkJdmFyIGQgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSB0b3J1cyBjdXJ2ZQoKCQlmdW5jdGlvbiBjYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUsIHAsIHEsIHJhZGl1cywgcG9zaXRpb24gKSB7CgoJCQl2YXIgY3UgPSBNYXRoLmNvcyggdSApOwoJCQl2YXIgc3UgPSBNYXRoLnNpbiggdSApOwoJCQl2YXIgcXVPdmVyUCA9IHEgLyBwICogdTsKCQkJdmFyIGNzID0gTWF0aC5jb3MoIHF1T3ZlclAgKTsKCgkJCXBvc2l0aW9uLnggPSByYWRpdXMgKiAoIDIgKyBjcyApICogMC41ICogY3U7CgkJCXBvc2l0aW9uLnkgPSByYWRpdXMgKiAoIDIgKyBjcyApICogc3UgKiAwLjU7CgkJCXBvc2l0aW9uLnogPSByYWRpdXMgKiBNYXRoLnNpbiggcXVPdmVyUCApICogMC41OwoKCQl9CgoJfQoKCVRvcnVzS25vdEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSApOwoJVG9ydXNLbm90QnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVG9ydXNLbm90QnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIG9vc21veGllY29kZQoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBUb3J1c0dlb21ldHJ5CgoJZnVuY3Rpb24gVG9ydXNHZW9tZXRyeSggcmFkaXVzLCB0dWJlLCByYWRpYWxTZWdtZW50cywgdHVidWxhclNlZ21lbnRzLCBhcmMgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1RvcnVzR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl0dWJlOiB0dWJlLAoJCQlyYWRpYWxTZWdtZW50czogcmFkaWFsU2VnbWVudHMsCgkJCXR1YnVsYXJTZWdtZW50czogdHVidWxhclNlZ21lbnRzLAoJCQlhcmM6IGFyYwoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgVG9ydXNCdWZmZXJHZW9tZXRyeSggcmFkaXVzLCB0dWJlLCByYWRpYWxTZWdtZW50cywgdHVidWxhclNlZ21lbnRzLCBhcmMgKSApOwoJCXRoaXMubWVyZ2VWZXJ0aWNlcygpOwoKCX0KCglUb3J1c0dlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJVG9ydXNHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUb3J1c0dlb21ldHJ5OwoKCS8vIFRvcnVzQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBUb3J1c0J1ZmZlckdlb21ldHJ5KCByYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYyApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNCdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXR1YmU6IHR1YmUsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJdHVidWxhclNlZ21lbnRzOiB0dWJ1bGFyU2VnbWVudHMsCgkJCWFyYzogYXJjCgkJfTsKCgkJcmFkaXVzID0gcmFkaXVzIHx8IDE7CgkJdHViZSA9IHR1YmUgfHwgMC40OwoJCXJhZGlhbFNlZ21lbnRzID0gTWF0aC5mbG9vciggcmFkaWFsU2VnbWVudHMgKSB8fCA4OwoJCXR1YnVsYXJTZWdtZW50cyA9IE1hdGguZmxvb3IoIHR1YnVsYXJTZWdtZW50cyApIHx8IDY7CgkJYXJjID0gYXJjIHx8IE1hdGguUEkgKiAyOwoKCQkvLyBidWZmZXJzCgoJCXZhciBpbmRpY2VzID0gW107CgkJdmFyIHZlcnRpY2VzID0gW107CgkJdmFyIG5vcm1hbHMgPSBbXTsKCQl2YXIgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJdmFyIGNlbnRlciA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCXZhciBqLCBpOwoKCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCWZvciAoIGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqICsrICkgewoKCQkJZm9yICggaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCXZhciB1ID0gaSAvIHR1YnVsYXJTZWdtZW50cyAqIGFyYzsKCQkJCXZhciB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGV4LnggPSAoIHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyggdiApICkgKiBNYXRoLmNvcyggdSApOwoJCQkJdmVydGV4LnkgPSAoIHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyggdiApICkgKiBNYXRoLnNpbiggdSApOwoJCQkJdmVydGV4LnogPSB0dWJlICogTWF0aC5zaW4oIHYgKTsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gbm9ybWFsCgoJCQkJY2VudGVyLnggPSByYWRpdXMgKiBNYXRoLmNvcyggdSApOwoJCQkJY2VudGVyLnkgPSByYWRpdXMgKiBNYXRoLnNpbiggdSApOwoJCQkJbm9ybWFsLnN1YlZlY3RvcnMoIHZlcnRleCwgY2VudGVyICkubm9ybWFsaXplKCk7CgoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1dnMucHVzaCggaSAvIHR1YnVsYXJTZWdtZW50cyApOwoJCQkJdXZzLnB1c2goIGogLyByYWRpYWxTZWdtZW50cyApOwoKCQkJfQoKCQl9CgoJCS8vIGdlbmVyYXRlIGluZGljZXMKCgkJZm9yICggaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBpID0gMTsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkgKysgKSB7CgoJCQkJLy8gaW5kaWNlcwoKCQkJCXZhciBhID0gKCB0dWJ1bGFyU2VnbWVudHMgKyAxICkgKiBqICsgaSAtIDE7CgkJCQl2YXIgYiA9ICggdHVidWxhclNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaSAtIDE7CgkJCQl2YXIgYyA9ICggdHVidWxhclNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCQkJCXZhciBkID0gKCB0dWJ1bGFyU2VnbWVudHMgKyAxICkgKiBqICsgaTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJVG9ydXNCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVRvcnVzQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVG9ydXNCdWZmZXJHZW9tZXRyeTsKCgkvKioKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKiBQb3J0IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL21hcGJveC9lYXJjdXQgKHYyLjEuMikKCSAqLwoKCXZhciBFYXJjdXQgPSB7CgoJCXRyaWFuZ3VsYXRlOiBmdW5jdGlvbiAoIGRhdGEsIGhvbGVJbmRpY2VzLCBkaW0gKSB7CgoJCQlkaW0gPSBkaW0gfHwgMjsKCgkJCXZhciBoYXNIb2xlcyA9IGhvbGVJbmRpY2VzICYmIGhvbGVJbmRpY2VzLmxlbmd0aCwKCQkJCW91dGVyTGVuID0gaGFzSG9sZXMgPyBob2xlSW5kaWNlc1sgMCBdICogZGltIDogZGF0YS5sZW5ndGgsCgkJCQlvdXRlck5vZGUgPSBsaW5rZWRMaXN0KCBkYXRhLCAwLCBvdXRlckxlbiwgZGltLCB0cnVlICksCgkJCQl0cmlhbmdsZXMgPSBbXTsKCgkJCWlmICggISBvdXRlck5vZGUgKSByZXR1cm4gdHJpYW5nbGVzOwoKCQkJdmFyIG1pblgsIG1pblksIG1heFgsIG1heFksIHgsIHksIGludlNpemU7CgoJCQlpZiAoIGhhc0hvbGVzICkgb3V0ZXJOb2RlID0gZWxpbWluYXRlSG9sZXMoIGRhdGEsIGhvbGVJbmRpY2VzLCBvdXRlck5vZGUsIGRpbSApOwoKCQkJLy8gaWYgdGhlIHNoYXBlIGlzIG5vdCB0b28gc2ltcGxlLCB3ZSdsbCB1c2Ugei1vcmRlciBjdXJ2ZSBoYXNoIGxhdGVyOyBjYWxjdWxhdGUgcG9seWdvbiBiYm94CgoJCQlpZiAoIGRhdGEubGVuZ3RoID4gODAgKiBkaW0gKSB7CgoJCQkJbWluWCA9IG1heFggPSBkYXRhWyAwIF07CgkJCQltaW5ZID0gbWF4WSA9IGRhdGFbIDEgXTsKCgkJCQlmb3IgKCB2YXIgaSA9IGRpbTsgaSA8IG91dGVyTGVuOyBpICs9IGRpbSApIHsKCgkJCQkJeCA9IGRhdGFbIGkgXTsKCQkJCQl5ID0gZGF0YVsgaSArIDEgXTsKCQkJCQlpZiAoIHggPCBtaW5YICkgbWluWCA9IHg7CgkJCQkJaWYgKCB5IDwgbWluWSApIG1pblkgPSB5OwoJCQkJCWlmICggeCA+IG1heFggKSBtYXhYID0geDsKCQkJCQlpZiAoIHkgPiBtYXhZICkgbWF4WSA9IHk7CgoJCQkJfQoKCQkJCS8vIG1pblgsIG1pblkgYW5kIGludlNpemUgYXJlIGxhdGVyIHVzZWQgdG8gdHJhbnNmb3JtIGNvb3JkcyBpbnRvIGludGVnZXJzIGZvciB6LW9yZGVyIGNhbGN1bGF0aW9uCgoJCQkJaW52U2l6ZSA9IE1hdGgubWF4KCBtYXhYIC0gbWluWCwgbWF4WSAtIG1pblkgKTsKCQkJCWludlNpemUgPSBpbnZTaXplICE9PSAwID8gMSAvIGludlNpemUgOiAwOwoKCQkJfQoKCQkJZWFyY3V0TGlua2VkKCBvdXRlck5vZGUsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJCQlyZXR1cm4gdHJpYW5nbGVzOwoKCQl9CgoJfTsKCgkvLyBjcmVhdGUgYSBjaXJjdWxhciBkb3VibHkgbGlua2VkIGxpc3QgZnJvbSBwb2x5Z29uIHBvaW50cyBpbiB0aGUgc3BlY2lmaWVkIHdpbmRpbmcgb3JkZXIKCglmdW5jdGlvbiBsaW5rZWRMaXN0KCBkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGNsb2Nrd2lzZSApIHsKCgkJdmFyIGksIGxhc3Q7CgoJCWlmICggY2xvY2t3aXNlID09PSAoIHNpZ25lZEFyZWEoIGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSApID4gMCApICkgewoKCQkJZm9yICggaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IGRpbSApIGxhc3QgPSBpbnNlcnROb2RlKCBpLCBkYXRhWyBpIF0sIGRhdGFbIGkgKyAxIF0sIGxhc3QgKTsKCgkJfSBlbHNlIHsKCgkJCWZvciAoIGkgPSBlbmQgLSBkaW07IGkgPj0gc3RhcnQ7IGkgLT0gZGltICkgbGFzdCA9IGluc2VydE5vZGUoIGksIGRhdGFbIGkgXSwgZGF0YVsgaSArIDEgXSwgbGFzdCApOwoKCQl9CgoJCWlmICggbGFzdCAmJiBlcXVhbHMoIGxhc3QsIGxhc3QubmV4dCApICkgewoKCQkJcmVtb3ZlTm9kZSggbGFzdCApOwoJCQlsYXN0ID0gbGFzdC5uZXh0OwoKCQl9CgoJCXJldHVybiBsYXN0OwoKCX0KCgkvLyBlbGltaW5hdGUgY29saW5lYXIgb3IgZHVwbGljYXRlIHBvaW50cwoKCWZ1bmN0aW9uIGZpbHRlclBvaW50cyggc3RhcnQsIGVuZCApIHsKCgkJaWYgKCAhIHN0YXJ0ICkgcmV0dXJuIHN0YXJ0OwoJCWlmICggISBlbmQgKSBlbmQgPSBzdGFydDsKCgkJdmFyIHAgPSBzdGFydCwgYWdhaW47CgoJCWRvIHsKCgkJCWFnYWluID0gZmFsc2U7CgoJCQlpZiAoICEgcC5zdGVpbmVyICYmICggZXF1YWxzKCBwLCBwLm5leHQgKSB8fCBhcmVhKCBwLnByZXYsIHAsIHAubmV4dCApID09PSAwICkgKSB7CgoJCQkJcmVtb3ZlTm9kZSggcCApOwoJCQkJcCA9IGVuZCA9IHAucHJldjsKCQkJCWlmICggcCA9PT0gcC5uZXh0ICkgYnJlYWs7CgkJCQlhZ2FpbiA9IHRydWU7CgoJCQl9IGVsc2UgewoKCQkJCXAgPSBwLm5leHQ7CgoJCQl9CgoJCX0gd2hpbGUgKCBhZ2FpbiB8fCBwICE9PSBlbmQgKTsKCgkJcmV0dXJuIGVuZDsKCgl9CgoJLy8gbWFpbiBlYXIgc2xpY2luZyBsb29wIHdoaWNoIHRyaWFuZ3VsYXRlcyBhIHBvbHlnb24gKGdpdmVuIGFzIGEgbGlua2VkIGxpc3QpCgoJZnVuY3Rpb24gZWFyY3V0TGlua2VkKCBlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCBwYXNzICkgewoKCQlpZiAoICEgZWFyICkgcmV0dXJuOwoKCQkvLyBpbnRlcmxpbmsgcG9seWdvbiBub2RlcyBpbiB6LW9yZGVyCgoJCWlmICggISBwYXNzICYmIGludlNpemUgKSBpbmRleEN1cnZlKCBlYXIsIG1pblgsIG1pblksIGludlNpemUgKTsKCgkJdmFyIHN0b3AgPSBlYXIsIHByZXYsIG5leHQ7CgoJCS8vIGl0ZXJhdGUgdGhyb3VnaCBlYXJzLCBzbGljaW5nIHRoZW0gb25lIGJ5IG9uZQoKCQl3aGlsZSAoIGVhci5wcmV2ICE9PSBlYXIubmV4dCApIHsKCgkJCXByZXYgPSBlYXIucHJldjsKCQkJbmV4dCA9IGVhci5uZXh0OwoKCQkJaWYgKCBpbnZTaXplID8gaXNFYXJIYXNoZWQoIGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSApIDogaXNFYXIoIGVhciApICkgewoKCQkJCS8vIGN1dCBvZmYgdGhlIHRyaWFuZ2xlCgkJCQl0cmlhbmdsZXMucHVzaCggcHJldi5pIC8gZGltICk7CgkJCQl0cmlhbmdsZXMucHVzaCggZWFyLmkgLyBkaW0gKTsKCQkJCXRyaWFuZ2xlcy5wdXNoKCBuZXh0LmkgLyBkaW0gKTsKCgkJCQlyZW1vdmVOb2RlKCBlYXIgKTsKCgkJCQkvLyBza2lwcGluZyB0aGUgbmV4dCB2ZXJ0aWNlIGxlYWRzIHRvIGxlc3Mgc2xpdmVyIHRyaWFuZ2xlcwoJCQkJZWFyID0gbmV4dC5uZXh0OwoJCQkJc3RvcCA9IG5leHQubmV4dDsKCgkJCQljb250aW51ZTsKCgkJCX0KCgkJCWVhciA9IG5leHQ7CgoJCQkvLyBpZiB3ZSBsb29wZWQgdGhyb3VnaCB0aGUgd2hvbGUgcmVtYWluaW5nIHBvbHlnb24gYW5kIGNhbid0IGZpbmQgYW55IG1vcmUgZWFycwoKCQkJaWYgKCBlYXIgPT09IHN0b3AgKSB7CgoJCQkJLy8gdHJ5IGZpbHRlcmluZyBwb2ludHMgYW5kIHNsaWNpbmcgYWdhaW4KCgkJCQlpZiAoICEgcGFzcyApIHsKCgkJCQkJZWFyY3V0TGlua2VkKCBmaWx0ZXJQb2ludHMoIGVhciApLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMSApOwoKCQkJCQkvLyBpZiB0aGlzIGRpZG4ndCB3b3JrLCB0cnkgY3VyaW5nIGFsbCBzbWFsbCBzZWxmLWludGVyc2VjdGlvbnMgbG9jYWxseQoKCQkJCX0gZWxzZSBpZiAoIHBhc3MgPT09IDEgKSB7CgoJCQkJCWVhciA9IGN1cmVMb2NhbEludGVyc2VjdGlvbnMoIGVhciwgdHJpYW5nbGVzLCBkaW0gKTsKCQkJCQllYXJjdXRMaW5rZWQoIGVhciwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUsIDIgKTsKCgkJCQkJLy8gYXMgYSBsYXN0IHJlc29ydCwgdHJ5IHNwbGl0dGluZyB0aGUgcmVtYWluaW5nIHBvbHlnb24gaW50byB0d28KCgkJCQl9IGVsc2UgaWYgKCBwYXNzID09PSAyICkgewoKCQkJCQlzcGxpdEVhcmN1dCggZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSApOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCX0KCgkJfQoKCX0KCgkvLyBjaGVjayB3aGV0aGVyIGEgcG9seWdvbiBub2RlIGZvcm1zIGEgdmFsaWQgZWFyIHdpdGggYWRqYWNlbnQgbm9kZXMKCglmdW5jdGlvbiBpc0VhciggZWFyICkgewoKCQl2YXIgYSA9IGVhci5wcmV2LAoJCQliID0gZWFyLAoJCQljID0gZWFyLm5leHQ7CgoJCWlmICggYXJlYSggYSwgYiwgYyApID49IDAgKSByZXR1cm4gZmFsc2U7IC8vIHJlZmxleCwgY2FuJ3QgYmUgYW4gZWFyCgoJCS8vIG5vdyBtYWtlIHN1cmUgd2UgZG9uJ3QgaGF2ZSBvdGhlciBwb2ludHMgaW5zaWRlIHRoZSBwb3RlbnRpYWwgZWFyCgkJdmFyIHAgPSBlYXIubmV4dC5uZXh0OwoKCQl3aGlsZSAoIHAgIT09IGVhci5wcmV2ICkgewoKCQkJaWYgKCBwb2ludEluVHJpYW5nbGUoIGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIHAueCwgcC55ICkgJiYgYXJlYSggcC5wcmV2LCBwLCBwLm5leHQgKSA+PSAwICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJCXAgPSBwLm5leHQ7CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWZ1bmN0aW9uIGlzRWFySGFzaGVkKCBlYXIsIG1pblgsIG1pblksIGludlNpemUgKSB7CgoJCXZhciBhID0gZWFyLnByZXYsCgkJCWIgPSBlYXIsCgkJCWMgPSBlYXIubmV4dDsKCgkJaWYgKCBhcmVhKCBhLCBiLCBjICkgPj0gMCApIHJldHVybiBmYWxzZTsgLy8gcmVmbGV4LCBjYW4ndCBiZSBhbiBlYXIKCgkJLy8gdHJpYW5nbGUgYmJveDsgbWluICYgbWF4IGFyZSBjYWxjdWxhdGVkIGxpa2UgdGhpcyBmb3Igc3BlZWQKCgkJdmFyIG1pblRYID0gYS54IDwgYi54ID8gKCBhLnggPCBjLnggPyBhLnggOiBjLnggKSA6ICggYi54IDwgYy54ID8gYi54IDogYy54ICksCgkJCW1pblRZID0gYS55IDwgYi55ID8gKCBhLnkgPCBjLnkgPyBhLnkgOiBjLnkgKSA6ICggYi55IDwgYy55ID8gYi55IDogYy55ICksCgkJCW1heFRYID0gYS54ID4gYi54ID8gKCBhLnggPiBjLnggPyBhLnggOiBjLnggKSA6ICggYi54ID4gYy54ID8gYi54IDogYy54ICksCgkJCW1heFRZID0gYS55ID4gYi55ID8gKCBhLnkgPiBjLnkgPyBhLnkgOiBjLnkgKSA6ICggYi55ID4gYy55ID8gYi55IDogYy55ICk7CgoJCS8vIHotb3JkZXIgcmFuZ2UgZm9yIHRoZSBjdXJyZW50IHRyaWFuZ2xlIGJib3g7CgoJCXZhciBtaW5aID0gek9yZGVyKCBtaW5UWCwgbWluVFksIG1pblgsIG1pblksIGludlNpemUgKSwKCQkJbWF4WiA9IHpPcmRlciggbWF4VFgsIG1heFRZLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJCS8vIGZpcnN0IGxvb2sgZm9yIHBvaW50cyBpbnNpZGUgdGhlIHRyaWFuZ2xlIGluIGluY3JlYXNpbmcgei1vcmRlcgoKCQl2YXIgcCA9IGVhci5uZXh0WjsKCgkJd2hpbGUgKCBwICYmIHAueiA8PSBtYXhaICkgewoKCQkJaWYgKCBwICE9PSBlYXIucHJldiAmJiBwICE9PSBlYXIubmV4dCAmJgoJCQkJCXBvaW50SW5UcmlhbmdsZSggYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgcC54LCBwLnkgKSAmJgoJCQkJCWFyZWEoIHAucHJldiwgcCwgcC5uZXh0ICkgPj0gMCApIHJldHVybiBmYWxzZTsKCQkJcCA9IHAubmV4dFo7CgoJCX0KCgkJLy8gdGhlbiBsb29rIGZvciBwb2ludHMgaW4gZGVjcmVhc2luZyB6LW9yZGVyCgoJCXAgPSBlYXIucHJldlo7CgoJCXdoaWxlICggcCAmJiBwLnogPj0gbWluWiApIHsKCgkJCWlmICggcCAhPT0gZWFyLnByZXYgJiYgcCAhPT0gZWFyLm5leHQgJiYKCQkJCQlwb2ludEluVHJpYW5nbGUoIGEueCwgYS55LCBiLngsIGIueSwgYy54LCBjLnksIHAueCwgcC55ICkgJiYKCQkJCQlhcmVhKCBwLnByZXYsIHAsIHAubmV4dCApID49IDAgKSByZXR1cm4gZmFsc2U7CgoJCQlwID0gcC5wcmV2WjsKCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJLy8gZ28gdGhyb3VnaCBhbGwgcG9seWdvbiBub2RlcyBhbmQgY3VyZSBzbWFsbCBsb2NhbCBzZWxmLWludGVyc2VjdGlvbnMKCglmdW5jdGlvbiBjdXJlTG9jYWxJbnRlcnNlY3Rpb25zKCBzdGFydCwgdHJpYW5nbGVzLCBkaW0gKSB7CgoJCXZhciBwID0gc3RhcnQ7CgoJCWRvIHsKCgkJCXZhciBhID0gcC5wcmV2LCBiID0gcC5uZXh0Lm5leHQ7CgoJCQlpZiAoICEgZXF1YWxzKCBhLCBiICkgJiYgaW50ZXJzZWN0cyggYSwgcCwgcC5uZXh0LCBiICkgJiYgbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSApIHsKCgkJCQl0cmlhbmdsZXMucHVzaCggYS5pIC8gZGltICk7CgkJCQl0cmlhbmdsZXMucHVzaCggcC5pIC8gZGltICk7CgkJCQl0cmlhbmdsZXMucHVzaCggYi5pIC8gZGltICk7CgoJCQkJLy8gcmVtb3ZlIHR3byBub2RlcyBpbnZvbHZlZAoKCQkJCXJlbW92ZU5vZGUoIHAgKTsKCQkJCXJlbW92ZU5vZGUoIHAubmV4dCApOwoKCQkJCXAgPSBzdGFydCA9IGI7CgoJCQl9CgoJCQlwID0gcC5uZXh0OwoKCQl9IHdoaWxlICggcCAhPT0gc3RhcnQgKTsKCgkJcmV0dXJuIHA7CgoJfQoKCS8vIHRyeSBzcGxpdHRpbmcgcG9seWdvbiBpbnRvIHR3byBhbmQgdHJpYW5ndWxhdGUgdGhlbSBpbmRlcGVuZGVudGx5CgoJZnVuY3Rpb24gc3BsaXRFYXJjdXQoIHN0YXJ0LCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSApIHsKCgkJLy8gbG9vayBmb3IgYSB2YWxpZCBkaWFnb25hbCB0aGF0IGRpdmlkZXMgdGhlIHBvbHlnb24gaW50byB0d28KCgkJdmFyIGEgPSBzdGFydDsKCgkJZG8gewoKCQkJdmFyIGIgPSBhLm5leHQubmV4dDsKCgkJCXdoaWxlICggYiAhPT0gYS5wcmV2ICkgewoKCQkJCWlmICggYS5pICE9PSBiLmkgJiYgaXNWYWxpZERpYWdvbmFsKCBhLCBiICkgKSB7CgoJCQkJCS8vIHNwbGl0IHRoZSBwb2x5Z29uIGluIHR3byBieSB0aGUgZGlhZ29uYWwKCgkJCQkJdmFyIGMgPSBzcGxpdFBvbHlnb24oIGEsIGIgKTsKCgkJCQkJLy8gZmlsdGVyIGNvbGluZWFyIHBvaW50cyBhcm91bmQgdGhlIGN1dHMKCgkJCQkJYSA9IGZpbHRlclBvaW50cyggYSwgYS5uZXh0ICk7CgkJCQkJYyA9IGZpbHRlclBvaW50cyggYywgYy5uZXh0ICk7CgoJCQkJCS8vIHJ1biBlYXJjdXQgb24gZWFjaCBoYWxmCgoJCQkJCWVhcmN1dExpbmtlZCggYSwgdHJpYW5nbGVzLCBkaW0sIG1pblgsIG1pblksIGludlNpemUgKTsKCQkJCQllYXJjdXRMaW5rZWQoIGMsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQliID0gYi5uZXh0OwoKCQkJfQoKCQkJYSA9IGEubmV4dDsKCgkJfSB3aGlsZSAoIGEgIT09IHN0YXJ0ICk7CgoJfQoKCS8vIGxpbmsgZXZlcnkgaG9sZSBpbnRvIHRoZSBvdXRlciBsb29wLCBwcm9kdWNpbmcgYSBzaW5nbGUtcmluZyBwb2x5Z29uIHdpdGhvdXQgaG9sZXMKCglmdW5jdGlvbiBlbGltaW5hdGVIb2xlcyggZGF0YSwgaG9sZUluZGljZXMsIG91dGVyTm9kZSwgZGltICkgewoKCQl2YXIgcXVldWUgPSBbXSwgaSwgbGVuLCBzdGFydCwgZW5kLCBsaXN0OwoKCQlmb3IgKCBpID0gMCwgbGVuID0gaG9sZUluZGljZXMubGVuZ3RoOyBpIDwgbGVuOyBpICsrICkgewoKCQkJc3RhcnQgPSBob2xlSW5kaWNlc1sgaSBdICogZGltOwoJCQllbmQgPSBpIDwgbGVuIC0gMSA/IGhvbGVJbmRpY2VzWyBpICsgMSBdICogZGltIDogZGF0YS5sZW5ndGg7CgkJCWxpc3QgPSBsaW5rZWRMaXN0KCBkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGZhbHNlICk7CgkJCWlmICggbGlzdCA9PT0gbGlzdC5uZXh0ICkgbGlzdC5zdGVpbmVyID0gdHJ1ZTsKCQkJcXVldWUucHVzaCggZ2V0TGVmdG1vc3QoIGxpc3QgKSApOwoKCQl9CgoJCXF1ZXVlLnNvcnQoIGNvbXBhcmVYICk7CgoJCS8vIHByb2Nlc3MgaG9sZXMgZnJvbSBsZWZ0IHRvIHJpZ2h0CgoJCWZvciAoIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpICsrICkgewoKCQkJZWxpbWluYXRlSG9sZSggcXVldWVbIGkgXSwgb3V0ZXJOb2RlICk7CgkJCW91dGVyTm9kZSA9IGZpbHRlclBvaW50cyggb3V0ZXJOb2RlLCBvdXRlck5vZGUubmV4dCApOwoKCQl9CgoJCXJldHVybiBvdXRlck5vZGU7CgoJfQoKCWZ1bmN0aW9uIGNvbXBhcmVYKCBhLCBiICkgewoKCQlyZXR1cm4gYS54IC0gYi54OwoKCX0KCgkvLyBmaW5kIGEgYnJpZGdlIGJldHdlZW4gdmVydGljZXMgdGhhdCBjb25uZWN0cyBob2xlIHdpdGggYW4gb3V0ZXIgcmluZyBhbmQgYW5kIGxpbmsgaXQKCglmdW5jdGlvbiBlbGltaW5hdGVIb2xlKCBob2xlLCBvdXRlck5vZGUgKSB7CgoJCW91dGVyTm9kZSA9IGZpbmRIb2xlQnJpZGdlKCBob2xlLCBvdXRlck5vZGUgKTsKCgkJaWYgKCBvdXRlck5vZGUgKSB7CgoJCQl2YXIgYiA9IHNwbGl0UG9seWdvbiggb3V0ZXJOb2RlLCBob2xlICk7CgoJCQlmaWx0ZXJQb2ludHMoIGIsIGIubmV4dCApOwoKCQl9CgoJfQoKCS8vIERhdmlkIEViZXJseSdzIGFsZ29yaXRobSBmb3IgZmluZGluZyBhIGJyaWRnZSBiZXR3ZWVuIGhvbGUgYW5kIG91dGVyIHBvbHlnb24KCglmdW5jdGlvbiBmaW5kSG9sZUJyaWRnZSggaG9sZSwgb3V0ZXJOb2RlICkgewoKCQl2YXIgcCA9IG91dGVyTm9kZSwKCQkJaHggPSBob2xlLngsCgkJCWh5ID0gaG9sZS55LAoJCQlxeCA9IC0gSW5maW5pdHksCgkJCW07CgoJCS8vIGZpbmQgYSBzZWdtZW50IGludGVyc2VjdGVkIGJ5IGEgcmF5IGZyb20gdGhlIGhvbGUncyBsZWZ0bW9zdCBwb2ludCB0byB0aGUgbGVmdDsKCQkvLyBzZWdtZW50J3MgZW5kcG9pbnQgd2l0aCBsZXNzZXIgeCB3aWxsIGJlIHBvdGVudGlhbCBjb25uZWN0aW9uIHBvaW50CgoJCWRvIHsKCgkJCWlmICggaHkgPD0gcC55ICYmIGh5ID49IHAubmV4dC55ICYmIHAubmV4dC55ICE9PSBwLnkgKSB7CgoJCQkJdmFyIHggPSBwLnggKyAoIGh5IC0gcC55ICkgKiAoIHAubmV4dC54IC0gcC54ICkgLyAoIHAubmV4dC55IC0gcC55ICk7CgoJCQkJaWYgKCB4IDw9IGh4ICYmIHggPiBxeCApIHsKCgkJCQkJcXggPSB4OwoKCQkJCQlpZiAoIHggPT09IGh4ICkgewoKCQkJCQkJaWYgKCBoeSA9PT0gcC55ICkgcmV0dXJuIHA7CgkJCQkJCWlmICggaHkgPT09IHAubmV4dC55ICkgcmV0dXJuIHAubmV4dDsKCgkJCQkJfQoKCQkJCQltID0gcC54IDwgcC5uZXh0LnggPyBwIDogcC5uZXh0OwoKCQkJCX0KCgkJCX0KCgkJCXAgPSBwLm5leHQ7CgoJCX0gd2hpbGUgKCBwICE9PSBvdXRlck5vZGUgKTsKCgkJaWYgKCAhIG0gKSByZXR1cm4gbnVsbDsKCgkJaWYgKCBoeCA9PT0gcXggKSByZXR1cm4gbS5wcmV2OyAvLyBob2xlIHRvdWNoZXMgb3V0ZXIgc2VnbWVudDsgcGljayBsb3dlciBlbmRwb2ludAoKCQkvLyBsb29rIGZvciBwb2ludHMgaW5zaWRlIHRoZSB0cmlhbmdsZSBvZiBob2xlIHBvaW50LCBzZWdtZW50IGludGVyc2VjdGlvbiBhbmQgZW5kcG9pbnQ7CgkJLy8gaWYgdGhlcmUgYXJlIG5vIHBvaW50cyBmb3VuZCwgd2UgaGF2ZSBhIHZhbGlkIGNvbm5lY3Rpb247CgkJLy8gb3RoZXJ3aXNlIGNob29zZSB0aGUgcG9pbnQgb2YgdGhlIG1pbmltdW0gYW5nbGUgd2l0aCB0aGUgcmF5IGFzIGNvbm5lY3Rpb24gcG9pbnQKCgkJdmFyIHN0b3AgPSBtLAoJCQlteCA9IG0ueCwKCQkJbXkgPSBtLnksCgkJCXRhbk1pbiA9IEluZmluaXR5LAoJCQl0YW47CgoJCXAgPSBtLm5leHQ7CgoJCXdoaWxlICggcCAhPT0gc3RvcCApIHsKCgkJCWlmICggaHggPj0gcC54ICYmIHAueCA+PSBteCAmJiBoeCAhPT0gcC54ICYmCgkJCQkJCQlwb2ludEluVHJpYW5nbGUoIGh5IDwgbXkgPyBoeCA6IHF4LCBoeSwgbXgsIG15LCBoeSA8IG15ID8gcXggOiBoeCwgaHksIHAueCwgcC55ICkgKSB7CgoJCQkJdGFuID0gTWF0aC5hYnMoIGh5IC0gcC55ICkgLyAoIGh4IC0gcC54ICk7IC8vIHRhbmdlbnRpYWwKCgkJCQlpZiAoICggdGFuIDwgdGFuTWluIHx8ICggdGFuID09PSB0YW5NaW4gJiYgcC54ID4gbS54ICkgKSAmJiBsb2NhbGx5SW5zaWRlKCBwLCBob2xlICkgKSB7CgoJCQkJCW0gPSBwOwoJCQkJCXRhbk1pbiA9IHRhbjsKCgkJCQl9CgoJCQl9CgoJCQlwID0gcC5uZXh0OwoKCQl9CgoJCXJldHVybiBtOwoKCX0KCgkvLyBpbnRlcmxpbmsgcG9seWdvbiBub2RlcyBpbiB6LW9yZGVyCgoJZnVuY3Rpb24gaW5kZXhDdXJ2ZSggc3RhcnQsIG1pblgsIG1pblksIGludlNpemUgKSB7CgoJCXZhciBwID0gc3RhcnQ7CgoJCWRvIHsKCgkJCWlmICggcC56ID09PSBudWxsICkgcC56ID0gek9yZGVyKCBwLngsIHAueSwgbWluWCwgbWluWSwgaW52U2l6ZSApOwoJCQlwLnByZXZaID0gcC5wcmV2OwoJCQlwLm5leHRaID0gcC5uZXh0OwoJCQlwID0gcC5uZXh0OwoKCQl9IHdoaWxlICggcCAhPT0gc3RhcnQgKTsKCgkJcC5wcmV2Wi5uZXh0WiA9IG51bGw7CgkJcC5wcmV2WiA9IG51bGw7CgoJCXNvcnRMaW5rZWQoIHAgKTsKCgl9CgoJLy8gU2ltb24gVGF0aGFtJ3MgbGlua2VkIGxpc3QgbWVyZ2Ugc29ydCBhbGdvcml0aG0KCS8vIGh0dHA6Ly93d3cuY2hpYXJrLmdyZWVuZW5kLm9yZy51ay9+c2d0YXRoYW0vYWxnb3JpdGhtcy9saXN0c29ydC5odG1sCgoJZnVuY3Rpb24gc29ydExpbmtlZCggbGlzdCApIHsKCgkJdmFyIGksIHAsIHEsIGUsIHRhaWwsIG51bU1lcmdlcywgcFNpemUsIHFTaXplLCBpblNpemUgPSAxOwoKCQlkbyB7CgoJCQlwID0gbGlzdDsKCQkJbGlzdCA9IG51bGw7CgkJCXRhaWwgPSBudWxsOwoJCQludW1NZXJnZXMgPSAwOwoKCQkJd2hpbGUgKCBwICkgewoKCQkJCW51bU1lcmdlcyArKzsKCQkJCXEgPSBwOwoJCQkJcFNpemUgPSAwOwoKCQkJCWZvciAoIGkgPSAwOyBpIDwgaW5TaXplOyBpICsrICkgewoKCQkJCQlwU2l6ZSArKzsKCQkJCQlxID0gcS5uZXh0WjsKCQkJCQlpZiAoICEgcSApIGJyZWFrOwoKCQkJCX0KCgkJCQlxU2l6ZSA9IGluU2l6ZTsKCgkJCQl3aGlsZSAoIHBTaXplID4gMCB8fCAoIHFTaXplID4gMCAmJiBxICkgKSB7CgoJCQkJCWlmICggcFNpemUgIT09IDAgJiYgKCBxU2l6ZSA9PT0gMCB8fCAhIHEgfHwgcC56IDw9IHEueiApICkgewoKCQkJCQkJZSA9IHA7CgkJCQkJCXAgPSBwLm5leHRaOwoJCQkJCQlwU2l6ZSAtLTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWUgPSBxOwoJCQkJCQlxID0gcS5uZXh0WjsKCQkJCQkJcVNpemUgLS07CgoJCQkJCX0KCgkJCQkJaWYgKCB0YWlsICkgdGFpbC5uZXh0WiA9IGU7CgkJCQkJZWxzZSBsaXN0ID0gZTsKCgkJCQkJZS5wcmV2WiA9IHRhaWw7CgkJCQkJdGFpbCA9IGU7CgoJCQkJfQoKCQkJCXAgPSBxOwoKCQkJfQoKCQkJdGFpbC5uZXh0WiA9IG51bGw7CgkJCWluU2l6ZSAqPSAyOwoKCQl9IHdoaWxlICggbnVtTWVyZ2VzID4gMSApOwoKCQlyZXR1cm4gbGlzdDsKCgl9CgoJLy8gei1vcmRlciBvZiBhIHBvaW50IGdpdmVuIGNvb3JkcyBhbmQgaW52ZXJzZSBvZiB0aGUgbG9uZ2VyIHNpZGUgb2YgZGF0YSBiYm94CgoJZnVuY3Rpb24gek9yZGVyKCB4LCB5LCBtaW5YLCBtaW5ZLCBpbnZTaXplICkgewoKCQkvLyBjb29yZHMgYXJlIHRyYW5zZm9ybWVkIGludG8gbm9uLW5lZ2F0aXZlIDE1LWJpdCBpbnRlZ2VyIHJhbmdlCgoJCXggPSAzMjc2NyAqICggeCAtIG1pblggKSAqIGludlNpemU7CgkJeSA9IDMyNzY3ICogKCB5IC0gbWluWSApICogaW52U2l6ZTsKCgkJeCA9ICggeCB8ICggeCA8PCA4ICkgKSAmIDB4MDBGRjAwRkY7CgkJeCA9ICggeCB8ICggeCA8PCA0ICkgKSAmIDB4MEYwRjBGMEY7CgkJeCA9ICggeCB8ICggeCA8PCAyICkgKSAmIDB4MzMzMzMzMzM7CgkJeCA9ICggeCB8ICggeCA8PCAxICkgKSAmIDB4NTU1NTU1NTU7CgoJCXkgPSAoIHkgfCAoIHkgPDwgOCApICkgJiAweDAwRkYwMEZGOwoJCXkgPSAoIHkgfCAoIHkgPDwgNCApICkgJiAweDBGMEYwRjBGOwoJCXkgPSAoIHkgfCAoIHkgPDwgMiApICkgJiAweDMzMzMzMzMzOwoJCXkgPSAoIHkgfCAoIHkgPDwgMSApICkgJiAweDU1NTU1NTU1OwoKCQlyZXR1cm4geCB8ICggeSA8PCAxICk7CgoJfQoKCS8vIGZpbmQgdGhlIGxlZnRtb3N0IG5vZGUgb2YgYSBwb2x5Z29uIHJpbmcKCglmdW5jdGlvbiBnZXRMZWZ0bW9zdCggc3RhcnQgKSB7CgoJCXZhciBwID0gc3RhcnQsIGxlZnRtb3N0ID0gc3RhcnQ7CgoJCWRvIHsKCgkJCWlmICggcC54IDwgbGVmdG1vc3QueCApIGxlZnRtb3N0ID0gcDsKCQkJcCA9IHAubmV4dDsKCgkJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJCXJldHVybiBsZWZ0bW9zdDsKCgl9CgoJLy8gY2hlY2sgaWYgYSBwb2ludCBsaWVzIHdpdGhpbiBhIGNvbnZleCB0cmlhbmdsZQoKCWZ1bmN0aW9uIHBvaW50SW5UcmlhbmdsZSggYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcHgsIHB5ICkgewoKCQlyZXR1cm4gKCBjeCAtIHB4ICkgKiAoIGF5IC0gcHkgKSAtICggYXggLSBweCApICogKCBjeSAtIHB5ICkgPj0gMCAmJgoJCSAoIGF4IC0gcHggKSAqICggYnkgLSBweSApIC0gKCBieCAtIHB4ICkgKiAoIGF5IC0gcHkgKSA+PSAwICYmCgkJICggYnggLSBweCApICogKCBjeSAtIHB5ICkgLSAoIGN4IC0gcHggKSAqICggYnkgLSBweSApID49IDA7CgoJfQoKCS8vIGNoZWNrIGlmIGEgZGlhZ29uYWwgYmV0d2VlbiB0d28gcG9seWdvbiBub2RlcyBpcyB2YWxpZCAobGllcyBpbiBwb2x5Z29uIGludGVyaW9yKQoKCWZ1bmN0aW9uIGlzVmFsaWREaWFnb25hbCggYSwgYiApIHsKCgkJcmV0dXJuIGEubmV4dC5pICE9PSBiLmkgJiYgYS5wcmV2LmkgIT09IGIuaSAmJiAhIGludGVyc2VjdHNQb2x5Z29uKCBhLCBiICkgJiYKCQkJbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSAmJiBtaWRkbGVJbnNpZGUoIGEsIGIgKTsKCgl9CgoJLy8gc2lnbmVkIGFyZWEgb2YgYSB0cmlhbmdsZQoKCWZ1bmN0aW9uIGFyZWEoIHAsIHEsIHIgKSB7CgoJCXJldHVybiAoIHEueSAtIHAueSApICogKCByLnggLSBxLnggKSAtICggcS54IC0gcC54ICkgKiAoIHIueSAtIHEueSApOwoKCX0KCgkvLyBjaGVjayBpZiB0d28gcG9pbnRzIGFyZSBlcXVhbAoKCWZ1bmN0aW9uIGVxdWFscyggcDEsIHAyICkgewoKCQlyZXR1cm4gcDEueCA9PT0gcDIueCAmJiBwMS55ID09PSBwMi55OwoKCX0KCgkvLyBjaGVjayBpZiB0d28gc2VnbWVudHMgaW50ZXJzZWN0CgoJZnVuY3Rpb24gaW50ZXJzZWN0cyggcDEsIHExLCBwMiwgcTIgKSB7CgoJCWlmICggKCBlcXVhbHMoIHAxLCBxMSApICYmIGVxdWFscyggcDIsIHEyICkgKSB8fAoJCQkJKCBlcXVhbHMoIHAxLCBxMiApICYmIGVxdWFscyggcDIsIHExICkgKSApIHJldHVybiB0cnVlOwoKCQlyZXR1cm4gYXJlYSggcDEsIHExLCBwMiApID4gMCAhPT0gYXJlYSggcDEsIHExLCBxMiApID4gMCAmJgoJCQkJCSBhcmVhKCBwMiwgcTIsIHAxICkgPiAwICE9PSBhcmVhKCBwMiwgcTIsIHExICkgPiAwOwoKCX0KCgkvLyBjaGVjayBpZiBhIHBvbHlnb24gZGlhZ29uYWwgaW50ZXJzZWN0cyBhbnkgcG9seWdvbiBzZWdtZW50cwoKCWZ1bmN0aW9uIGludGVyc2VjdHNQb2x5Z29uKCBhLCBiICkgewoKCQl2YXIgcCA9IGE7CgoJCWRvIHsKCgkJCWlmICggcC5pICE9PSBhLmkgJiYgcC5uZXh0LmkgIT09IGEuaSAmJiBwLmkgIT09IGIuaSAmJiBwLm5leHQuaSAhPT0gYi5pICYmCgkJCQkJCQlpbnRlcnNlY3RzKCBwLCBwLm5leHQsIGEsIGIgKSApIHsKCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCXAgPSBwLm5leHQ7CgoJCX0gd2hpbGUgKCBwICE9PSBhICk7CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJLy8gY2hlY2sgaWYgYSBwb2x5Z29uIGRpYWdvbmFsIGlzIGxvY2FsbHkgaW5zaWRlIHRoZSBwb2x5Z29uCgoJZnVuY3Rpb24gbG9jYWxseUluc2lkZSggYSwgYiApIHsKCgkJcmV0dXJuIGFyZWEoIGEucHJldiwgYSwgYS5uZXh0ICkgPCAwID8KCQkJYXJlYSggYSwgYiwgYS5uZXh0ICkgPj0gMCAmJiBhcmVhKCBhLCBhLnByZXYsIGIgKSA+PSAwIDoKCQkJYXJlYSggYSwgYiwgYS5wcmV2ICkgPCAwIHx8IGFyZWEoIGEsIGEubmV4dCwgYiApIDwgMDsKCgl9CgoJLy8gY2hlY2sgaWYgdGhlIG1pZGRsZSBwb2ludCBvZiBhIHBvbHlnb24gZGlhZ29uYWwgaXMgaW5zaWRlIHRoZSBwb2x5Z29uCgoJZnVuY3Rpb24gbWlkZGxlSW5zaWRlKCBhLCBiICkgewoKCQl2YXIgcCA9IGEsCgkJCWluc2lkZSA9IGZhbHNlLAoJCQlweCA9ICggYS54ICsgYi54ICkgLyAyLAoJCQlweSA9ICggYS55ICsgYi55ICkgLyAyOwoKCQlkbyB7CgoJCQlpZiAoICggKCBwLnkgPiBweSApICE9PSAoIHAubmV4dC55ID4gcHkgKSApICYmIHAubmV4dC55ICE9PSBwLnkgJiYKCQkJCQkJCSggcHggPCAoIHAubmV4dC54IC0gcC54ICkgKiAoIHB5IC0gcC55ICkgLyAoIHAubmV4dC55IC0gcC55ICkgKyBwLnggKSApIHsKCgkJCQlpbnNpZGUgPSAhIGluc2lkZTsKCgkJCX0KCgkJCXAgPSBwLm5leHQ7CgoJCX0gd2hpbGUgKCBwICE9PSBhICk7CgoJCXJldHVybiBpbnNpZGU7CgoJfQoKCS8vIGxpbmsgdHdvIHBvbHlnb24gdmVydGljZXMgd2l0aCBhIGJyaWRnZTsgaWYgdGhlIHZlcnRpY2VzIGJlbG9uZyB0byB0aGUgc2FtZSByaW5nLCBpdCBzcGxpdHMgcG9seWdvbiBpbnRvIHR3bzsKCS8vIGlmIG9uZSBiZWxvbmdzIHRvIHRoZSBvdXRlciByaW5nIGFuZCBhbm90aGVyIHRvIGEgaG9sZSwgaXQgbWVyZ2VzIGl0IGludG8gYSBzaW5nbGUgcmluZwoKCWZ1bmN0aW9uIHNwbGl0UG9seWdvbiggYSwgYiApIHsKCgkJdmFyIGEyID0gbmV3IE5vZGUoIGEuaSwgYS54LCBhLnkgKSwKCQkJYjIgPSBuZXcgTm9kZSggYi5pLCBiLngsIGIueSApLAoJCQlhbiA9IGEubmV4dCwKCQkJYnAgPSBiLnByZXY7CgoJCWEubmV4dCA9IGI7CgkJYi5wcmV2ID0gYTsKCgkJYTIubmV4dCA9IGFuOwoJCWFuLnByZXYgPSBhMjsKCgkJYjIubmV4dCA9IGEyOwoJCWEyLnByZXYgPSBiMjsKCgkJYnAubmV4dCA9IGIyOwoJCWIyLnByZXYgPSBicDsKCgkJcmV0dXJuIGIyOwoKCX0KCgkvLyBjcmVhdGUgYSBub2RlIGFuZCBvcHRpb25hbGx5IGxpbmsgaXQgd2l0aCBwcmV2aW91cyBvbmUgKGluIGEgY2lyY3VsYXIgZG91Ymx5IGxpbmtlZCBsaXN0KQoKCWZ1bmN0aW9uIGluc2VydE5vZGUoIGksIHgsIHksIGxhc3QgKSB7CgoJCXZhciBwID0gbmV3IE5vZGUoIGksIHgsIHkgKTsKCgkJaWYgKCAhIGxhc3QgKSB7CgoJCQlwLnByZXYgPSBwOwoJCQlwLm5leHQgPSBwOwoKCQl9IGVsc2UgewoKCQkJcC5uZXh0ID0gbGFzdC5uZXh0OwoJCQlwLnByZXYgPSBsYXN0OwoJCQlsYXN0Lm5leHQucHJldiA9IHA7CgkJCWxhc3QubmV4dCA9IHA7CgoJCX0KCgkJcmV0dXJuIHA7CgoJfQoKCWZ1bmN0aW9uIHJlbW92ZU5vZGUoIHAgKSB7CgoJCXAubmV4dC5wcmV2ID0gcC5wcmV2OwoJCXAucHJldi5uZXh0ID0gcC5uZXh0OwoKCQlpZiAoIHAucHJldlogKSBwLnByZXZaLm5leHRaID0gcC5uZXh0WjsKCQlpZiAoIHAubmV4dFogKSBwLm5leHRaLnByZXZaID0gcC5wcmV2WjsKCgl9CgoJZnVuY3Rpb24gTm9kZSggaSwgeCwgeSApIHsKCgkJLy8gdmVydGljZSBpbmRleCBpbiBjb29yZGluYXRlcyBhcnJheQoJCXRoaXMuaSA9IGk7CgoJCS8vIHZlcnRleCBjb29yZGluYXRlcwoJCXRoaXMueCA9IHg7CgkJdGhpcy55ID0geTsKCgkJLy8gcHJldmlvdXMgYW5kIG5leHQgdmVydGljZSBub2RlcyBpbiBhIHBvbHlnb24gcmluZwoJCXRoaXMucHJldiA9IG51bGw7CgkJdGhpcy5uZXh0ID0gbnVsbDsKCgkJLy8gei1vcmRlciBjdXJ2ZSB2YWx1ZQoJCXRoaXMueiA9IG51bGw7CgoJCS8vIHByZXZpb3VzIGFuZCBuZXh0IG5vZGVzIGluIHotb3JkZXIKCQl0aGlzLnByZXZaID0gbnVsbDsKCQl0aGlzLm5leHRaID0gbnVsbDsKCgkJLy8gaW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBpcyBhIHN0ZWluZXIgcG9pbnQKCQl0aGlzLnN0ZWluZXIgPSBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gc2lnbmVkQXJlYSggZGF0YSwgc3RhcnQsIGVuZCwgZGltICkgewoKCQl2YXIgc3VtID0gMDsKCgkJZm9yICggdmFyIGkgPSBzdGFydCwgaiA9IGVuZCAtIGRpbTsgaSA8IGVuZDsgaSArPSBkaW0gKSB7CgoJCQlzdW0gKz0gKCBkYXRhWyBqIF0gLSBkYXRhWyBpIF0gKSAqICggZGF0YVsgaSArIDEgXSArIGRhdGFbIGogKyAxIF0gKTsKCQkJaiA9IGk7CgoJCX0KCgkJcmV0dXJuIHN1bTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIHp6ODUgLyBodHRwOi8vd3d3LmxhYjRnYW1lcy5uZXQveno4NS9ibG9nCgkgKi8KCgl2YXIgU2hhcGVVdGlscyA9IHsKCgkJLy8gY2FsY3VsYXRlIGFyZWEgb2YgdGhlIGNvbnRvdXIgcG9seWdvbgoKCQlhcmVhOiBmdW5jdGlvbiAoIGNvbnRvdXIgKSB7CgoJCQl2YXIgbiA9IGNvbnRvdXIubGVuZ3RoOwoJCQl2YXIgYSA9IDAuMDsKCgkJCWZvciAoIHZhciBwID0gbiAtIDEsIHEgPSAwOyBxIDwgbjsgcCA9IHEgKysgKSB7CgoJCQkJYSArPSBjb250b3VyWyBwIF0ueCAqIGNvbnRvdXJbIHEgXS55IC0gY29udG91clsgcSBdLnggKiBjb250b3VyWyBwIF0ueTsKCgkJCX0KCgkJCXJldHVybiBhICogMC41OwoKCQl9LAoKCQlpc0Nsb2NrV2lzZTogZnVuY3Rpb24gKCBwdHMgKSB7CgoJCQlyZXR1cm4gU2hhcGVVdGlscy5hcmVhKCBwdHMgKSA8IDA7CgoJCX0sCgoJCXRyaWFuZ3VsYXRlU2hhcGU6IGZ1bmN0aW9uICggY29udG91ciwgaG9sZXMgKSB7CgoJCQl2YXIgdmVydGljZXMgPSBbXTsgLy8gZmxhdCBhcnJheSBvZiB2ZXJ0aWNlcyBsaWtlIFsgeDAseTAsIHgxLHkxLCB4Mix5MiwgLi4uIF0KCQkJdmFyIGhvbGVJbmRpY2VzID0gW107IC8vIGFycmF5IG9mIGhvbGUgaW5kaWNlcwoJCQl2YXIgZmFjZXMgPSBbXTsgLy8gZmluYWwgYXJyYXkgb2YgdmVydGV4IGluZGljZXMgbGlrZSBbIFsgYSxiLGQgXSwgWyBiLGMsZCBdIF0KCgkJCXJlbW92ZUR1cEVuZFB0cyggY29udG91ciApOwoJCQlhZGRDb250b3VyKCB2ZXJ0aWNlcywgY29udG91ciApOwoKCQkJLy8KCgkJCXZhciBob2xlSW5kZXggPSBjb250b3VyLmxlbmd0aDsKCgkJCWhvbGVzLmZvckVhY2goIHJlbW92ZUR1cEVuZFB0cyApOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgaG9sZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCWhvbGVJbmRpY2VzLnB1c2goIGhvbGVJbmRleCApOwoJCQkJaG9sZUluZGV4ICs9IGhvbGVzWyBpIF0ubGVuZ3RoOwoJCQkJYWRkQ29udG91ciggdmVydGljZXMsIGhvbGVzWyBpIF0gKTsKCgkJCX0KCgkJCS8vCgoJCQl2YXIgdHJpYW5nbGVzID0gRWFyY3V0LnRyaWFuZ3VsYXRlKCB2ZXJ0aWNlcywgaG9sZUluZGljZXMgKTsKCgkJCS8vCgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpICs9IDMgKSB7CgoJCQkJZmFjZXMucHVzaCggdHJpYW5nbGVzLnNsaWNlKCBpLCBpICsgMyApICk7CgoJCQl9CgoJCQlyZXR1cm4gZmFjZXM7CgoJCX0KCgl9OwoKCWZ1bmN0aW9uIHJlbW92ZUR1cEVuZFB0cyggcG9pbnRzICkgewoKCQl2YXIgbCA9IHBvaW50cy5sZW5ndGg7CgoJCWlmICggbCA+IDIgJiYgcG9pbnRzWyBsIC0gMSBdLmVxdWFscyggcG9pbnRzWyAwIF0gKSApIHsKCgkJCXBvaW50cy5wb3AoKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBhZGRDb250b3VyKCB2ZXJ0aWNlcywgY29udG91ciApIHsKCgkJZm9yICggdmFyIGkgPSAwOyBpIDwgY29udG91ci5sZW5ndGg7IGkgKysgKSB7CgoJCQl2ZXJ0aWNlcy5wdXNoKCBjb250b3VyWyBpIF0ueCApOwoJCQl2ZXJ0aWNlcy5wdXNoKCBjb250b3VyWyBpIF0ueSApOwoKCQl9CgoJfQoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL3d3dy5sYWI0Z2FtZXMubmV0L3p6ODUvYmxvZwoJICoKCSAqIENyZWF0ZXMgZXh0cnVkZWQgZ2VvbWV0cnkgZnJvbSBhIHBhdGggc2hhcGUuCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqCgkgKiAgY3VydmVTZWdtZW50czogPGludD4sIC8vIG51bWJlciBvZiBwb2ludHMgb24gdGhlIGN1cnZlcwoJICogIHN0ZXBzOiA8aW50PiwgLy8gbnVtYmVyIG9mIHBvaW50cyBmb3Igei1zaWRlIGV4dHJ1c2lvbnMgLyB1c2VkIGZvciBzdWJkaXZpZGluZyBzZWdtZW50cyBvZiBleHRydWRlIHNwbGluZSB0b28KCSAqICBkZXB0aDogPGZsb2F0PiwgLy8gRGVwdGggdG8gZXh0cnVkZSB0aGUgc2hhcGUKCSAqCgkgKiAgYmV2ZWxFbmFibGVkOiA8Ym9vbD4sIC8vIHR1cm4gb24gYmV2ZWwKCSAqICBiZXZlbFRoaWNrbmVzczogPGZsb2F0PiwgLy8gaG93IGRlZXAgaW50byB0aGUgb3JpZ2luYWwgc2hhcGUgYmV2ZWwgZ29lcwoJICogIGJldmVsU2l6ZTogPGZsb2F0PiwgLy8gaG93IGZhciBmcm9tIHNoYXBlIG91dGxpbmUgaXMgYmV2ZWwKCSAqICBiZXZlbFNlZ21lbnRzOiA8aW50PiwgLy8gbnVtYmVyIG9mIGJldmVsIGxheWVycwoJICoKCSAqICBleHRydWRlUGF0aDogPFRIUkVFLkN1cnZlPiAvLyBjdXJ2ZSB0byBleHRydWRlIHNoYXBlIGFsb25nCgkgKgoJICogIFVWR2VuZXJhdG9yOiA8T2JqZWN0PiAvLyBvYmplY3QgdGhhdCBwcm92aWRlcyBVViBnZW5lcmF0b3IgZnVuY3Rpb25zCgkgKgoJICogfQoJICovCgoJLy8gRXh0cnVkZUdlb21ldHJ5CgoJZnVuY3Rpb24gRXh0cnVkZUdlb21ldHJ5KCBzaGFwZXMsIG9wdGlvbnMgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0V4dHJ1ZGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJc2hhcGVzOiBzaGFwZXMsCgkJCW9wdGlvbnM6IG9wdGlvbnMKCQl9OwoKCQl0aGlzLmZyb21CdWZmZXJHZW9tZXRyeSggbmV3IEV4dHJ1ZGVCdWZmZXJHZW9tZXRyeSggc2hhcGVzLCBvcHRpb25zICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJRXh0cnVkZUdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJRXh0cnVkZUdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEV4dHJ1ZGVHZW9tZXRyeTsKCglFeHRydWRlR2VvbWV0cnkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBHZW9tZXRyeS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJdmFyIHNoYXBlcyA9IHRoaXMucGFyYW1ldGVycy5zaGFwZXM7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLnBhcmFtZXRlcnMub3B0aW9uczsKCgkJcmV0dXJuIHRvSlNPTiggc2hhcGVzLCBvcHRpb25zLCBkYXRhICk7CgoJfTsKCgkvLyBFeHRydWRlQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBFeHRydWRlQnVmZmVyR2VvbWV0cnkoIHNoYXBlcywgb3B0aW9ucyApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnRXh0cnVkZUJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlzaGFwZXM6IHNoYXBlcywKCQkJb3B0aW9uczogb3B0aW9ucwoJCX07CgoJCXNoYXBlcyA9IEFycmF5LmlzQXJyYXkoIHNoYXBlcyApID8gc2hhcGVzIDogWyBzaGFwZXMgXTsKCgkJdmFyIHNjb3BlID0gdGhpczsKCgkJdmFyIHZlcnRpY2VzQXJyYXkgPSBbXTsKCQl2YXIgdXZBcnJheSA9IFtdOwoKCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBzaGFwZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXZhciBzaGFwZSA9IHNoYXBlc1sgaSBdOwoJCQlhZGRTaGFwZSggc2hhcGUgKTsKCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzQXJyYXksIDMgKSApOwoJCXRoaXMuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZBcnJheSwgMiApICk7CgoJCXRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKCgkJLy8gZnVuY3Rpb25zCgoJCWZ1bmN0aW9uIGFkZFNoYXBlKCBzaGFwZSApIHsKCgkJCXZhciBwbGFjZWhvbGRlciA9IFtdOwoKCQkJLy8gb3B0aW9ucwoKCQkJdmFyIGN1cnZlU2VnbWVudHMgPSBvcHRpb25zLmN1cnZlU2VnbWVudHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY3VydmVTZWdtZW50cyA6IDEyOwoJCQl2YXIgc3RlcHMgPSBvcHRpb25zLnN0ZXBzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnN0ZXBzIDogMTsKCQkJdmFyIGRlcHRoID0gb3B0aW9ucy5kZXB0aCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5kZXB0aCA6IDEwMDsKCgkJCXZhciBiZXZlbEVuYWJsZWQgPSBvcHRpb25zLmJldmVsRW5hYmxlZCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5iZXZlbEVuYWJsZWQgOiB0cnVlOwoJCQl2YXIgYmV2ZWxUaGlja25lc3MgPSBvcHRpb25zLmJldmVsVGhpY2tuZXNzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsVGhpY2tuZXNzIDogNjsKCQkJdmFyIGJldmVsU2l6ZSA9IG9wdGlvbnMuYmV2ZWxTaXplICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsU2l6ZSA6IGJldmVsVGhpY2tuZXNzIC0gMjsKCQkJdmFyIGJldmVsU2VnbWVudHMgPSBvcHRpb25zLmJldmVsU2VnbWVudHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYmV2ZWxTZWdtZW50cyA6IDM7CgoJCQl2YXIgZXh0cnVkZVBhdGggPSBvcHRpb25zLmV4dHJ1ZGVQYXRoOwoKCQkJdmFyIHV2Z2VuID0gb3B0aW9ucy5VVkdlbmVyYXRvciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5VVkdlbmVyYXRvciA6IFdvcmxkVVZHZW5lcmF0b3I7CgoJCQkvLyBkZXByZWNhdGVkIG9wdGlvbnMKCgkJCWlmICggb3B0aW9ucy5hbW91bnQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5FeHRydWRlQnVmZmVyR2VvbWV0cnk6IGFtb3VudCBoYXMgYmVlbiByZW5hbWVkIHRvIGRlcHRoLicgKTsKCQkJCWRlcHRoID0gb3B0aW9ucy5hbW91bnQ7CgoJCQl9CgoJCQkvLwoKCQkJdmFyIGV4dHJ1ZGVQdHMsIGV4dHJ1ZGVCeVBhdGggPSBmYWxzZTsKCQkJdmFyIHNwbGluZVR1YmUsIGJpbm9ybWFsLCBub3JtYWwsIHBvc2l0aW9uMjsKCgkJCWlmICggZXh0cnVkZVBhdGggKSB7CgoJCQkJZXh0cnVkZVB0cyA9IGV4dHJ1ZGVQYXRoLmdldFNwYWNlZFBvaW50cyggc3RlcHMgKTsKCgkJCQlleHRydWRlQnlQYXRoID0gdHJ1ZTsKCQkJCWJldmVsRW5hYmxlZCA9IGZhbHNlOyAvLyBiZXZlbHMgbm90IHN1cHBvcnRlZCBmb3IgcGF0aCBleHRydXNpb24KCgkJCQkvLyBTRVRVUCBUTkIgdmFyaWFibGVzCgoJCQkJLy8gVE9ETzEgLSBoYXZlIGEgLmlzQ2xvc2VkIGluIHNwbGluZT8KCgkJCQlzcGxpbmVUdWJlID0gZXh0cnVkZVBhdGguY29tcHV0ZUZyZW5ldEZyYW1lcyggc3RlcHMsIGZhbHNlICk7CgoJCQkJLy8gY29uc29sZS5sb2coc3BsaW5lVHViZSwgJ3NwbGluZVR1YmUnLCBzcGxpbmVUdWJlLm5vcm1hbHMubGVuZ3RoLCAnc3RlcHMnLCBzdGVwcywgJ2V4dHJ1ZGVQdHMnLCBleHRydWRlUHRzLmxlbmd0aCk7CgoJCQkJYmlub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoJCQkJbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCQkJCXBvc2l0aW9uMiA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQkvLyBTYWZlZ3VhcmRzIGlmIGJldmVscyBhcmUgbm90IGVuYWJsZWQKCgkJCWlmICggISBiZXZlbEVuYWJsZWQgKSB7CgoJCQkJYmV2ZWxTZWdtZW50cyA9IDA7CgkJCQliZXZlbFRoaWNrbmVzcyA9IDA7CgkJCQliZXZlbFNpemUgPSAwOwoKCQkJfQoKCQkJLy8gVmFyaWFibGVzIGluaXRpYWxpemF0aW9uCgoJCQl2YXIgYWhvbGUsIGgsIGhsOyAvLyBsb29waW5nIG9mIGhvbGVzCgoJCQl2YXIgc2hhcGVQb2ludHMgPSBzaGFwZS5leHRyYWN0UG9pbnRzKCBjdXJ2ZVNlZ21lbnRzICk7CgoJCQl2YXIgdmVydGljZXMgPSBzaGFwZVBvaW50cy5zaGFwZTsKCQkJdmFyIGhvbGVzID0gc2hhcGVQb2ludHMuaG9sZXM7CgoJCQl2YXIgcmV2ZXJzZSA9ICEgU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggdmVydGljZXMgKTsKCgkJCWlmICggcmV2ZXJzZSApIHsKCgkJCQl2ZXJ0aWNlcyA9IHZlcnRpY2VzLnJldmVyc2UoKTsKCgkJCQkvLyBNYXliZSB3ZSBzaG91bGQgYWxzbyBjaGVjayBpZiBob2xlcyBhcmUgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiwganVzdCB0byBiZSBzYWZlIC4uLgoKCQkJCWZvciAoIGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCQlhaG9sZSA9IGhvbGVzWyBoIF07CgoJCQkJCWlmICggU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggYWhvbGUgKSApIHsKCgkJCQkJCWhvbGVzWyBoIF0gPSBhaG9sZS5yZXZlcnNlKCk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoKCQkJdmFyIGZhY2VzID0gU2hhcGVVdGlscy50cmlhbmd1bGF0ZVNoYXBlKCB2ZXJ0aWNlcywgaG9sZXMgKTsKCgkJCS8qIFZlcnRpY2VzICovCgoJCQl2YXIgY29udG91ciA9IHZlcnRpY2VzOyAvLyB2ZXJ0aWNlcyBoYXMgYWxsIHBvaW50cyBidXQgY29udG91ciBoYXMgb25seSBwb2ludHMgb2YgY2lyY3VtZmVyZW5jZQoKCQkJZm9yICggaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJYWhvbGUgPSBob2xlc1sgaCBdOwoKCQkJCXZlcnRpY2VzID0gdmVydGljZXMuY29uY2F0KCBhaG9sZSApOwoKCQkJfQoKCgkJCWZ1bmN0aW9uIHNjYWxlUHQyKCBwdCwgdmVjLCBzaXplICkgewoKCQkJCWlmICggISB2ZWMgKSBjb25zb2xlLmVycm9yKCAiVEhSRUUuRXh0cnVkZUdlb21ldHJ5OiB2ZWMgZG9lcyBub3QgZXhpc3QiICk7CgoJCQkJcmV0dXJuIHZlYy5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKCBzaXplICkuYWRkKCBwdCApOwoKCQkJfQoKCQkJdmFyIGIsIGJzLCB0LCB6LAoJCQkJdmVydCwgdmxlbiA9IHZlcnRpY2VzLmxlbmd0aCwKCQkJCWZhY2UsIGZsZW4gPSBmYWNlcy5sZW5ndGg7CgoKCQkJLy8gRmluZCBkaXJlY3Rpb25zIGZvciBwb2ludCBtb3ZlbWVudAoKCgkJCWZ1bmN0aW9uIGdldEJldmVsVmVjKCBpblB0LCBpblByZXYsIGluTmV4dCApIHsKCgkJCQkvLyBjb21wdXRlcyBmb3IgaW5QdCB0aGUgY29ycmVzcG9uZGluZyBwb2ludCBpblB0JyBvbiBhIG5ldyBjb250b3VyCgkJCQkvLyAgIHNoaWZ0ZWQgYnkgMSB1bml0IChsZW5ndGggb2Ygbm9ybWFsaXplZCB2ZWN0b3IpIHRvIHRoZSBsZWZ0CgkJCQkvLyBpZiB3ZSB3YWxrIGFsb25nIGNvbnRvdXIgY2xvY2t3aXNlLCB0aGlzIG5ldyBjb250b3VyIGlzIG91dHNpZGUgdGhlIG9sZCBvbmUKCQkJCS8vCgkJCQkvLyBpblB0JyBpcyB0aGUgaW50ZXJzZWN0aW9uIG9mIHRoZSB0d28gbGluZXMgcGFyYWxsZWwgdG8gdGhlIHR3bwoJCQkJLy8gIGFkamFjZW50IGVkZ2VzIG9mIGluUHQgYXQgYSBkaXN0YW5jZSBvZiAxIHVuaXQgb24gdGhlIGxlZnQgc2lkZS4KCgkJCQl2YXIgdl90cmFuc194LCB2X3RyYW5zX3ksIHNocmlua19ieTsgLy8gcmVzdWx0aW5nIHRyYW5zbGF0aW9uIHZlY3RvciBmb3IgaW5QdAoKCQkJCS8vIGdvb2QgcmVhZGluZyBmb3IgZ2VvbWV0cnkgYWxnb3JpdGhtcyAoaGVyZTogbGluZS1saW5lIGludGVyc2VjdGlvbikKCQkJCS8vIGh0dHA6Ly9nZW9tYWxnb3JpdGhtcy5jb20vYTA1LV9pbnRlcnNlY3QtMS5odG1sCgoJCQkJdmFyIHZfcHJldl94ID0gaW5QdC54IC0gaW5QcmV2LngsCgkJCQkJdl9wcmV2X3kgPSBpblB0LnkgLSBpblByZXYueTsKCQkJCXZhciB2X25leHRfeCA9IGluTmV4dC54IC0gaW5QdC54LAoJCQkJCXZfbmV4dF95ID0gaW5OZXh0LnkgLSBpblB0Lnk7CgoJCQkJdmFyIHZfcHJldl9sZW5zcSA9ICggdl9wcmV2X3ggKiB2X3ByZXZfeCArIHZfcHJldl95ICogdl9wcmV2X3kgKTsKCgkJCQkvLyBjaGVjayBmb3IgY29sbGluZWFyIGVkZ2VzCgkJCQl2YXIgY29sbGluZWFyMCA9ICggdl9wcmV2X3ggKiB2X25leHRfeSAtIHZfcHJldl95ICogdl9uZXh0X3ggKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBjb2xsaW5lYXIwICkgPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJLy8gbm90IGNvbGxpbmVhcgoKCQkJCQkvLyBsZW5ndGggb2YgdmVjdG9ycyBmb3Igbm9ybWFsaXppbmcKCgkJCQkJdmFyIHZfcHJldl9sZW4gPSBNYXRoLnNxcnQoIHZfcHJldl9sZW5zcSApOwoJCQkJCXZhciB2X25leHRfbGVuID0gTWF0aC5zcXJ0KCB2X25leHRfeCAqIHZfbmV4dF94ICsgdl9uZXh0X3kgKiB2X25leHRfeSApOwoKCQkJCQkvLyBzaGlmdCBhZGphY2VudCBwb2ludHMgYnkgdW5pdCB2ZWN0b3JzIHRvIHRoZSBsZWZ0CgoJCQkJCXZhciBwdFByZXZTaGlmdF94ID0gKCBpblByZXYueCAtIHZfcHJldl95IC8gdl9wcmV2X2xlbiApOwoJCQkJCXZhciBwdFByZXZTaGlmdF95ID0gKCBpblByZXYueSArIHZfcHJldl94IC8gdl9wcmV2X2xlbiApOwoKCQkJCQl2YXIgcHROZXh0U2hpZnRfeCA9ICggaW5OZXh0LnggLSB2X25leHRfeSAvIHZfbmV4dF9sZW4gKTsKCQkJCQl2YXIgcHROZXh0U2hpZnRfeSA9ICggaW5OZXh0LnkgKyB2X25leHRfeCAvIHZfbmV4dF9sZW4gKTsKCgkJCQkJLy8gc2NhbGluZyBmYWN0b3IgZm9yIHZfcHJldiB0byBpbnRlcnNlY3Rpb24gcG9pbnQKCgkJCQkJdmFyIHNmID0gKCAoIHB0TmV4dFNoaWZ0X3ggLSBwdFByZXZTaGlmdF94ICkgKiB2X25leHRfeSAtCgkJCQkJCQkoIHB0TmV4dFNoaWZ0X3kgLSBwdFByZXZTaGlmdF95ICkgKiB2X25leHRfeCApIC8KCQkJCQkJKCB2X3ByZXZfeCAqIHZfbmV4dF95IC0gdl9wcmV2X3kgKiB2X25leHRfeCApOwoKCQkJCQkvLyB2ZWN0b3IgZnJvbSBpblB0IHRvIGludGVyc2VjdGlvbiBwb2ludAoKCQkJCQl2X3RyYW5zX3ggPSAoIHB0UHJldlNoaWZ0X3ggKyB2X3ByZXZfeCAqIHNmIC0gaW5QdC54ICk7CgkJCQkJdl90cmFuc195ID0gKCBwdFByZXZTaGlmdF95ICsgdl9wcmV2X3kgKiBzZiAtIGluUHQueSApOwoKCQkJCQkvLyBEb24ndCBub3JtYWxpemUhLCBvdGhlcndpc2Ugc2hhcnAgY29ybmVycyBiZWNvbWUgdWdseQoJCQkJCS8vICBidXQgcHJldmVudCBjcmF6eSBzcGlrZXMKCQkJCQl2YXIgdl90cmFuc19sZW5zcSA9ICggdl90cmFuc194ICogdl90cmFuc194ICsgdl90cmFuc195ICogdl90cmFuc195ICk7CgkJCQkJaWYgKCB2X3RyYW5zX2xlbnNxIDw9IDIgKSB7CgoJCQkJCQlyZXR1cm4gbmV3IFZlY3RvcjIoIHZfdHJhbnNfeCwgdl90cmFuc195ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzaHJpbmtfYnkgPSBNYXRoLnNxcnQoIHZfdHJhbnNfbGVuc3EgLyAyICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBoYW5kbGUgc3BlY2lhbCBjYXNlIG9mIGNvbGxpbmVhciBlZGdlcwoKCQkJCQl2YXIgZGlyZWN0aW9uX2VxID0gZmFsc2U7IC8vIGFzc3VtZXM6IG9wcG9zaXRlCgkJCQkJaWYgKCB2X3ByZXZfeCA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJaWYgKCB2X25leHRfeCA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJCWRpcmVjdGlvbl9lcSA9IHRydWU7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHZfcHJldl94IDwgLSBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJCQlpZiAoIHZfbmV4dF94IDwgLSBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJCQkJZGlyZWN0aW9uX2VxID0gdHJ1ZTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggTWF0aC5zaWduKCB2X3ByZXZfeSApID09PSBNYXRoLnNpZ24oIHZfbmV4dF95ICkgKSB7CgoJCQkJCQkJCWRpcmVjdGlvbl9lcSA9IHRydWU7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWlmICggZGlyZWN0aW9uX2VxICkgewoKCQkJCQkJLy8gY29uc29sZS5sb2coIldhcm5pbmc6IGxpbmVzIGFyZSBhIHN0cmFpZ2h0IHNlcXVlbmNlIik7CgkJCQkJCXZfdHJhbnNfeCA9IC0gdl9wcmV2X3k7CgkJCQkJCXZfdHJhbnNfeSA9IHZfcHJldl94OwoJCQkJCQlzaHJpbmtfYnkgPSBNYXRoLnNxcnQoIHZfcHJldl9sZW5zcSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gY29uc29sZS5sb2coIldhcm5pbmc6IGxpbmVzIGFyZSBhIHN0cmFpZ2h0IHNwaWtlIik7CgkJCQkJCXZfdHJhbnNfeCA9IHZfcHJldl94OwoJCQkJCQl2X3RyYW5zX3kgPSB2X3ByZXZfeTsKCQkJCQkJc2hyaW5rX2J5ID0gTWF0aC5zcXJ0KCB2X3ByZXZfbGVuc3EgLyAyICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG5ldyBWZWN0b3IyKCB2X3RyYW5zX3ggLyBzaHJpbmtfYnksIHZfdHJhbnNfeSAvIHNocmlua19ieSApOwoKCQkJfQoKCgkJCXZhciBjb250b3VyTW92ZW1lbnRzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gY29udG91ci5sZW5ndGgsIGogPSBpbCAtIDEsIGsgPSBpICsgMTsgaSA8IGlsOyBpICsrLCBqICsrLCBrICsrICkgewoKCQkJCWlmICggaiA9PT0gaWwgKSBqID0gMDsKCQkJCWlmICggayA9PT0gaWwgKSBrID0gMDsKCgkJCQkvLyAgKGopLS0tKGkpLS0tKGspCgkJCQkvLyBjb25zb2xlLmxvZygnaSxqLGsnLCBpLCBqICwgaykKCgkJCQljb250b3VyTW92ZW1lbnRzWyBpIF0gPSBnZXRCZXZlbFZlYyggY29udG91clsgaSBdLCBjb250b3VyWyBqIF0sIGNvbnRvdXJbIGsgXSApOwoKCQkJfQoKCQkJdmFyIGhvbGVzTW92ZW1lbnRzID0gW10sCgkJCQlvbmVIb2xlTW92ZW1lbnRzLCB2ZXJ0aWNlc01vdmVtZW50cyA9IGNvbnRvdXJNb3ZlbWVudHMuY29uY2F0KCk7CgoJCQlmb3IgKCBoID0gMCwgaGwgPSBob2xlcy5sZW5ndGg7IGggPCBobDsgaCArKyApIHsKCgkJCQlhaG9sZSA9IGhvbGVzWyBoIF07CgoJCQkJb25lSG9sZU1vdmVtZW50cyA9IFtdOwoKCQkJCWZvciAoIGkgPSAwLCBpbCA9IGFob2xlLmxlbmd0aCwgaiA9IGlsIC0gMSwgayA9IGkgKyAxOyBpIDwgaWw7IGkgKyssIGogKyssIGsgKysgKSB7CgoJCQkJCWlmICggaiA9PT0gaWwgKSBqID0gMDsKCQkJCQlpZiAoIGsgPT09IGlsICkgayA9IDA7CgoJCQkJCS8vICAoaiktLS0oaSktLS0oaykKCQkJCQlvbmVIb2xlTW92ZW1lbnRzWyBpIF0gPSBnZXRCZXZlbFZlYyggYWhvbGVbIGkgXSwgYWhvbGVbIGogXSwgYWhvbGVbIGsgXSApOwoKCQkJCX0KCgkJCQlob2xlc01vdmVtZW50cy5wdXNoKCBvbmVIb2xlTW92ZW1lbnRzICk7CgkJCQl2ZXJ0aWNlc01vdmVtZW50cyA9IHZlcnRpY2VzTW92ZW1lbnRzLmNvbmNhdCggb25lSG9sZU1vdmVtZW50cyApOwoKCQkJfQoKCgkJCS8vIExvb3AgYmV2ZWxTZWdtZW50cywgMSBmb3IgdGhlIGZyb250LCAxIGZvciB0aGUgYmFjawoKCQkJZm9yICggYiA9IDA7IGIgPCBiZXZlbFNlZ21lbnRzOyBiICsrICkgewoKCQkJCS8vZm9yICggYiA9IGJldmVsU2VnbWVudHM7IGIgPiAwOyBiIC0tICkgewoKCQkJCXQgPSBiIC8gYmV2ZWxTZWdtZW50czsKCQkJCXogPSBiZXZlbFRoaWNrbmVzcyAqIE1hdGguY29zKCB0ICogTWF0aC5QSSAvIDIgKTsKCQkJCWJzID0gYmV2ZWxTaXplICogTWF0aC5zaW4oIHQgKiBNYXRoLlBJIC8gMiApOwoKCQkJCS8vIGNvbnRyYWN0IHNoYXBlCgoJCQkJZm9yICggaSA9IDAsIGlsID0gY29udG91ci5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdmVydCA9IHNjYWxlUHQyKCBjb250b3VyWyBpIF0sIGNvbnRvdXJNb3ZlbWVudHNbIGkgXSwgYnMgKTsKCgkJCQkJdiggdmVydC54LCB2ZXJ0LnksIC0geiApOwoKCQkJCX0KCgkJCQkvLyBleHBhbmQgaG9sZXMKCgkJCQlmb3IgKCBoID0gMCwgaGwgPSBob2xlcy5sZW5ndGg7IGggPCBobDsgaCArKyApIHsKCgkJCQkJYWhvbGUgPSBob2xlc1sgaCBdOwoJCQkJCW9uZUhvbGVNb3ZlbWVudHMgPSBob2xlc01vdmVtZW50c1sgaCBdOwoKCQkJCQlmb3IgKCBpID0gMCwgaWwgPSBhaG9sZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCXZlcnQgPSBzY2FsZVB0MiggYWhvbGVbIGkgXSwgb25lSG9sZU1vdmVtZW50c1sgaSBdLCBicyApOwoKCQkJCQkJdiggdmVydC54LCB2ZXJ0LnksIC0geiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJYnMgPSBiZXZlbFNpemU7CgoJCQkvLyBCYWNrIGZhY2luZyB2ZXJ0aWNlcwoKCQkJZm9yICggaSA9IDA7IGkgPCB2bGVuOyBpICsrICkgewoKCQkJCXZlcnQgPSBiZXZlbEVuYWJsZWQgPyBzY2FsZVB0MiggdmVydGljZXNbIGkgXSwgdmVydGljZXNNb3ZlbWVudHNbIGkgXSwgYnMgKSA6IHZlcnRpY2VzWyBpIF07CgoJCQkJaWYgKCAhIGV4dHJ1ZGVCeVBhdGggKSB7CgoJCQkJCXYoIHZlcnQueCwgdmVydC55LCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gdiggdmVydC54LCB2ZXJ0LnkgKyBleHRydWRlUHRzWyAwIF0ueSwgZXh0cnVkZVB0c1sgMCBdLnggKTsKCgkJCQkJbm9ybWFsLmNvcHkoIHNwbGluZVR1YmUubm9ybWFsc1sgMCBdICkubXVsdGlwbHlTY2FsYXIoIHZlcnQueCApOwoJCQkJCWJpbm9ybWFsLmNvcHkoIHNwbGluZVR1YmUuYmlub3JtYWxzWyAwIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC55ICk7CgoJCQkJCXBvc2l0aW9uMi5jb3B5KCBleHRydWRlUHRzWyAwIF0gKS5hZGQoIG5vcm1hbCApLmFkZCggYmlub3JtYWwgKTsKCgkJCQkJdiggcG9zaXRpb24yLngsIHBvc2l0aW9uMi55LCBwb3NpdGlvbjIueiApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIEFkZCBzdGVwcGVkIHZlcnRpY2VzLi4uCgkJCS8vIEluY2x1ZGluZyBmcm9udCBmYWNpbmcgdmVydGljZXMKCgkJCXZhciBzOwoKCQkJZm9yICggcyA9IDE7IHMgPD0gc3RlcHM7IHMgKysgKSB7CgoJCQkJZm9yICggaSA9IDA7IGkgPCB2bGVuOyBpICsrICkgewoKCQkJCQl2ZXJ0ID0gYmV2ZWxFbmFibGVkID8gc2NhbGVQdDIoIHZlcnRpY2VzWyBpIF0sIHZlcnRpY2VzTW92ZW1lbnRzWyBpIF0sIGJzICkgOiB2ZXJ0aWNlc1sgaSBdOwoKCQkJCQlpZiAoICEgZXh0cnVkZUJ5UGF0aCApIHsKCgkJCQkJCXYoIHZlcnQueCwgdmVydC55LCBkZXB0aCAvIHN0ZXBzICogcyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gdiggdmVydC54LCB2ZXJ0LnkgKyBleHRydWRlUHRzWyBzIC0gMSBdLnksIGV4dHJ1ZGVQdHNbIHMgLSAxIF0ueCApOwoKCQkJCQkJbm9ybWFsLmNvcHkoIHNwbGluZVR1YmUubm9ybWFsc1sgcyBdICkubXVsdGlwbHlTY2FsYXIoIHZlcnQueCApOwoJCQkJCQliaW5vcm1hbC5jb3B5KCBzcGxpbmVUdWJlLmJpbm9ybWFsc1sgcyBdICkubXVsdGlwbHlTY2FsYXIoIHZlcnQueSApOwoKCQkJCQkJcG9zaXRpb24yLmNvcHkoIGV4dHJ1ZGVQdHNbIHMgXSApLmFkZCggbm9ybWFsICkuYWRkKCBiaW5vcm1hbCApOwoKCQkJCQkJdiggcG9zaXRpb24yLngsIHBvc2l0aW9uMi55LCBwb3NpdGlvbjIueiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCgkJCS8vIEFkZCBiZXZlbCBzZWdtZW50cyBwbGFuZXMKCgkJCS8vZm9yICggYiA9IDE7IGIgPD0gYmV2ZWxTZWdtZW50czsgYiArKyApIHsKCQkJZm9yICggYiA9IGJldmVsU2VnbWVudHMgLSAxOyBiID49IDA7IGIgLS0gKSB7CgoJCQkJdCA9IGIgLyBiZXZlbFNlZ21lbnRzOwoJCQkJeiA9IGJldmVsVGhpY2tuZXNzICogTWF0aC5jb3MoIHQgKiBNYXRoLlBJIC8gMiApOwoJCQkJYnMgPSBiZXZlbFNpemUgKiBNYXRoLnNpbiggdCAqIE1hdGguUEkgLyAyICk7CgoJCQkJLy8gY29udHJhY3Qgc2hhcGUKCgkJCQlmb3IgKCBpID0gMCwgaWwgPSBjb250b3VyLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl2ZXJ0ID0gc2NhbGVQdDIoIGNvbnRvdXJbIGkgXSwgY29udG91ck1vdmVtZW50c1sgaSBdLCBicyApOwoJCQkJCXYoIHZlcnQueCwgdmVydC55LCBkZXB0aCArIHogKTsKCgkJCQl9CgoJCQkJLy8gZXhwYW5kIGhvbGVzCgoJCQkJZm9yICggaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJCWFob2xlID0gaG9sZXNbIGggXTsKCQkJCQlvbmVIb2xlTW92ZW1lbnRzID0gaG9sZXNNb3ZlbWVudHNbIGggXTsKCgkJCQkJZm9yICggaSA9IDAsIGlsID0gYWhvbGUubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQl2ZXJ0ID0gc2NhbGVQdDIoIGFob2xlWyBpIF0sIG9uZUhvbGVNb3ZlbWVudHNbIGkgXSwgYnMgKTsKCgkJCQkJCWlmICggISBleHRydWRlQnlQYXRoICkgewoKCQkJCQkJCXYoIHZlcnQueCwgdmVydC55LCBkZXB0aCArIHogKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdiggdmVydC54LCB2ZXJ0LnkgKyBleHRydWRlUHRzWyBzdGVwcyAtIDEgXS55LCBleHRydWRlUHRzWyBzdGVwcyAtIDEgXS54ICsgeiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLyogRmFjZXMgKi8KCgkJCS8vIFRvcCBhbmQgYm90dG9tIGZhY2VzCgoJCQlidWlsZExpZEZhY2VzKCk7CgoJCQkvLyBTaWRlcyBmYWNlcwoKCQkJYnVpbGRTaWRlRmFjZXMoKTsKCgoJCQkvLy8vLyAgSW50ZXJuYWwgZnVuY3Rpb25zCgoJCQlmdW5jdGlvbiBidWlsZExpZEZhY2VzKCkgewoKCQkJCXZhciBzdGFydCA9IHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMzsKCgkJCQlpZiAoIGJldmVsRW5hYmxlZCApIHsKCgkJCQkJdmFyIGxheWVyID0gMDsgLy8gc3RlcHMgKyAxCgkJCQkJdmFyIG9mZnNldCA9IHZsZW4gKiBsYXllcjsKCgkJCQkJLy8gQm90dG9tIGZhY2VzCgoJCQkJCWZvciAoIGkgPSAwOyBpIDwgZmxlbjsgaSArKyApIHsKCgkJCQkJCWZhY2UgPSBmYWNlc1sgaSBdOwoJCQkJCQlmMyggZmFjZVsgMiBdICsgb2Zmc2V0LCBmYWNlWyAxIF0gKyBvZmZzZXQsIGZhY2VbIDAgXSArIG9mZnNldCApOwoKCQkJCQl9CgoJCQkJCWxheWVyID0gc3RlcHMgKyBiZXZlbFNlZ21lbnRzICogMjsKCQkJCQlvZmZzZXQgPSB2bGVuICogbGF5ZXI7CgoJCQkJCS8vIFRvcCBmYWNlcwoKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQlmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDAgXSArIG9mZnNldCwgZmFjZVsgMSBdICsgb2Zmc2V0LCBmYWNlWyAyIF0gKyBvZmZzZXQgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIEJvdHRvbSBmYWNlcwoKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQlmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDIgXSwgZmFjZVsgMSBdLCBmYWNlWyAwIF0gKTsKCgkJCQkJfQoKCQkJCQkvLyBUb3AgZmFjZXMKCgkJCQkJZm9yICggaSA9IDA7IGkgPCBmbGVuOyBpICsrICkgewoKCQkJCQkJZmFjZSA9IGZhY2VzWyBpIF07CgkJCQkJCWYzKCBmYWNlWyAwIF0gKyB2bGVuICogc3RlcHMsIGZhY2VbIDEgXSArIHZsZW4gKiBzdGVwcywgZmFjZVsgMiBdICsgdmxlbiAqIHN0ZXBzICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJc2NvcGUuYWRkR3JvdXAoIHN0YXJ0LCB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDMgLSBzdGFydCwgMCApOwoKCQkJfQoKCQkJLy8gQ3JlYXRlIGZhY2VzIGZvciB0aGUgei1zaWRlcyBvZiB0aGUgc2hhcGUKCgkJCWZ1bmN0aW9uIGJ1aWxkU2lkZUZhY2VzKCkgewoKCQkJCXZhciBzdGFydCA9IHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMzsKCQkJCXZhciBsYXllcm9mZnNldCA9IDA7CgkJCQlzaWRld2FsbHMoIGNvbnRvdXIsIGxheWVyb2Zmc2V0ICk7CgkJCQlsYXllcm9mZnNldCArPSBjb250b3VyLmxlbmd0aDsKCgkJCQlmb3IgKCBoID0gMCwgaGwgPSBob2xlcy5sZW5ndGg7IGggPCBobDsgaCArKyApIHsKCgkJCQkJYWhvbGUgPSBob2xlc1sgaCBdOwoJCQkJCXNpZGV3YWxscyggYWhvbGUsIGxheWVyb2Zmc2V0ICk7CgoJCQkJCS8vLCB0cnVlCgkJCQkJbGF5ZXJvZmZzZXQgKz0gYWhvbGUubGVuZ3RoOwoKCQkJCX0KCgoJCQkJc2NvcGUuYWRkR3JvdXAoIHN0YXJ0LCB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDMgLSBzdGFydCwgMSApOwoKCgkJCX0KCgkJCWZ1bmN0aW9uIHNpZGV3YWxscyggY29udG91ciwgbGF5ZXJvZmZzZXQgKSB7CgoJCQkJdmFyIGosIGs7CgkJCQlpID0gY29udG91ci5sZW5ndGg7CgoJCQkJd2hpbGUgKCAtLSBpID49IDAgKSB7CgoJCQkJCWogPSBpOwoJCQkJCWsgPSBpIC0gMTsKCQkJCQlpZiAoIGsgPCAwICkgayA9IGNvbnRvdXIubGVuZ3RoIC0gMTsKCgkJCQkJLy9jb25zb2xlLmxvZygnYicsIGksaiwgaS0xLCBrLHZlcnRpY2VzLmxlbmd0aCk7CgoJCQkJCXZhciBzID0gMCwKCQkJCQkJc2wgPSBzdGVwcyArIGJldmVsU2VnbWVudHMgKiAyOwoKCQkJCQlmb3IgKCBzID0gMDsgcyA8IHNsOyBzICsrICkgewoKCQkJCQkJdmFyIHNsZW4xID0gdmxlbiAqIHM7CgkJCQkJCXZhciBzbGVuMiA9IHZsZW4gKiAoIHMgKyAxICk7CgoJCQkJCQl2YXIgYSA9IGxheWVyb2Zmc2V0ICsgaiArIHNsZW4xLAoJCQkJCQkJYiA9IGxheWVyb2Zmc2V0ICsgayArIHNsZW4xLAoJCQkJCQkJYyA9IGxheWVyb2Zmc2V0ICsgayArIHNsZW4yLAoJCQkJCQkJZCA9IGxheWVyb2Zmc2V0ICsgaiArIHNsZW4yOwoKCQkJCQkJZjQoIGEsIGIsIGMsIGQgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHYoIHgsIHksIHogKSB7CgoJCQkJcGxhY2Vob2xkZXIucHVzaCggeCApOwoJCQkJcGxhY2Vob2xkZXIucHVzaCggeSApOwoJCQkJcGxhY2Vob2xkZXIucHVzaCggeiApOwoKCQkJfQoKCgkJCWZ1bmN0aW9uIGYzKCBhLCBiLCBjICkgewoKCQkJCWFkZFZlcnRleCggYSApOwoJCQkJYWRkVmVydGV4KCBiICk7CgkJCQlhZGRWZXJ0ZXgoIGMgKTsKCgkJCQl2YXIgbmV4dEluZGV4ID0gdmVydGljZXNBcnJheS5sZW5ndGggLyAzOwoJCQkJdmFyIHV2cyA9IHV2Z2VuLmdlbmVyYXRlVG9wVVYoIHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxICk7CgoJCQkJYWRkVVYoIHV2c1sgMCBdICk7CgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDIgXSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gZjQoIGEsIGIsIGMsIGQgKSB7CgoJCQkJYWRkVmVydGV4KCBhICk7CgkJCQlhZGRWZXJ0ZXgoIGIgKTsKCQkJCWFkZFZlcnRleCggZCApOwoKCQkJCWFkZFZlcnRleCggYiApOwoJCQkJYWRkVmVydGV4KCBjICk7CgkJCQlhZGRWZXJ0ZXgoIGQgKTsKCgoJCQkJdmFyIG5leHRJbmRleCA9IHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMzsKCQkJCXZhciB1dnMgPSB1dmdlbi5nZW5lcmF0ZVNpZGVXYWxsVVYoIHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSA2LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxICk7CgoJCQkJYWRkVVYoIHV2c1sgMCBdICk7CgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDMgXSApOwoKCQkJCWFkZFVWKCB1dnNbIDEgXSApOwoJCQkJYWRkVVYoIHV2c1sgMiBdICk7CgkJCQlhZGRVViggdXZzWyAzIF0gKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGFkZFZlcnRleCggaW5kZXggKSB7CgoJCQkJdmVydGljZXNBcnJheS5wdXNoKCBwbGFjZWhvbGRlclsgaW5kZXggKiAzICsgMCBdICk7CgkJCQl2ZXJ0aWNlc0FycmF5LnB1c2goIHBsYWNlaG9sZGVyWyBpbmRleCAqIDMgKyAxIF0gKTsKCQkJCXZlcnRpY2VzQXJyYXkucHVzaCggcGxhY2Vob2xkZXJbIGluZGV4ICogMyArIDIgXSApOwoKCQkJfQoKCgkJCWZ1bmN0aW9uIGFkZFVWKCB2ZWN0b3IyICkgewoKCQkJCXV2QXJyYXkucHVzaCggdmVjdG9yMi54ICk7CgkJCQl1dkFycmF5LnB1c2goIHZlY3RvcjIueSApOwoKCQkJfQoKCQl9CgoJfQoKCUV4dHJ1ZGVCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCUV4dHJ1ZGVCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFeHRydWRlQnVmZmVyR2VvbWV0cnk7CgoJRXh0cnVkZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CgoJCXZhciBkYXRhID0gQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCXZhciBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoJCXZhciBvcHRpb25zID0gdGhpcy5wYXJhbWV0ZXJzLm9wdGlvbnM7CgoJCXJldHVybiB0b0pTT04oIHNoYXBlcywgb3B0aW9ucywgZGF0YSApOwoKCX07CgoJLy8KCgl2YXIgV29ybGRVVkdlbmVyYXRvciA9IHsKCgkJZ2VuZXJhdGVUb3BVVjogZnVuY3Rpb24gKCBnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMgKSB7CgoJCQl2YXIgYV94ID0gdmVydGljZXNbIGluZGV4QSAqIDMgXTsKCQkJdmFyIGFfeSA9IHZlcnRpY2VzWyBpbmRleEEgKiAzICsgMSBdOwoJCQl2YXIgYl94ID0gdmVydGljZXNbIGluZGV4QiAqIDMgXTsKCQkJdmFyIGJfeSA9IHZlcnRpY2VzWyBpbmRleEIgKiAzICsgMSBdOwoJCQl2YXIgY194ID0gdmVydGljZXNbIGluZGV4QyAqIDMgXTsKCQkJdmFyIGNfeSA9IHZlcnRpY2VzWyBpbmRleEMgKiAzICsgMSBdOwoKCQkJcmV0dXJuIFsKCQkJCW5ldyBWZWN0b3IyKCBhX3gsIGFfeSApLAoJCQkJbmV3IFZlY3RvcjIoIGJfeCwgYl95ICksCgkJCQluZXcgVmVjdG9yMiggY194LCBjX3kgKQoJCQldOwoKCQl9LAoKCQlnZW5lcmF0ZVNpZGVXYWxsVVY6IGZ1bmN0aW9uICggZ2VvbWV0cnksIHZlcnRpY2VzLCBpbmRleEEsIGluZGV4QiwgaW5kZXhDLCBpbmRleEQgKSB7CgoJCQl2YXIgYV94ID0gdmVydGljZXNbIGluZGV4QSAqIDMgXTsKCQkJdmFyIGFfeSA9IHZlcnRpY2VzWyBpbmRleEEgKiAzICsgMSBdOwoJCQl2YXIgYV96ID0gdmVydGljZXNbIGluZGV4QSAqIDMgKyAyIF07CgkJCXZhciBiX3ggPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyBdOwoJCQl2YXIgYl95ID0gdmVydGljZXNbIGluZGV4QiAqIDMgKyAxIF07CgkJCXZhciBiX3ogPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyArIDIgXTsKCQkJdmFyIGNfeCA9IHZlcnRpY2VzWyBpbmRleEMgKiAzIF07CgkJCXZhciBjX3kgPSB2ZXJ0aWNlc1sgaW5kZXhDICogMyArIDEgXTsKCQkJdmFyIGNfeiA9IHZlcnRpY2VzWyBpbmRleEMgKiAzICsgMiBdOwoJCQl2YXIgZF94ID0gdmVydGljZXNbIGluZGV4RCAqIDMgXTsKCQkJdmFyIGRfeSA9IHZlcnRpY2VzWyBpbmRleEQgKiAzICsgMSBdOwoJCQl2YXIgZF96ID0gdmVydGljZXNbIGluZGV4RCAqIDMgKyAyIF07CgoJCQlpZiAoIE1hdGguYWJzKCBhX3kgLSBiX3kgKSA8IDAuMDEgKSB7CgoJCQkJcmV0dXJuIFsKCQkJCQluZXcgVmVjdG9yMiggYV94LCAxIC0gYV96ICksCgkJCQkJbmV3IFZlY3RvcjIoIGJfeCwgMSAtIGJfeiApLAoJCQkJCW5ldyBWZWN0b3IyKCBjX3gsIDEgLSBjX3ogKSwKCQkJCQluZXcgVmVjdG9yMiggZF94LCAxIC0gZF96ICkKCQkJCV07CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBbCgkJCQkJbmV3IFZlY3RvcjIoIGFfeSwgMSAtIGFfeiApLAoJCQkJCW5ldyBWZWN0b3IyKCBiX3ksIDEgLSBiX3ogKSwKCQkJCQluZXcgVmVjdG9yMiggY195LCAxIC0gY196ICksCgkJCQkJbmV3IFZlY3RvcjIoIGRfeSwgMSAtIGRfeiApCgkJCQldOwoKCQkJfQoKCQl9Cgl9OwoKCWZ1bmN0aW9uIHRvSlNPTiggc2hhcGVzLCBvcHRpb25zLCBkYXRhICkgewoKCQkvLwoKCQlkYXRhLnNoYXBlcyA9IFtdOwoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApICkgewoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGUudXVpZCApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGVzLnV1aWQgKTsKCgkJfQoKCQkvLwoKCQlpZiAoIG9wdGlvbnMuZXh0cnVkZVBhdGggIT09IHVuZGVmaW5lZCApIGRhdGEub3B0aW9ucy5leHRydWRlUGF0aCA9IG9wdGlvbnMuZXh0cnVkZVBhdGgudG9KU09OKCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCgkvKioKCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKgoJICogVGV4dCA9IDNEIFRleHQKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGZvbnQ6IDxUSFJFRS5Gb250PiwgLy8gZm9udAoJICoKCSAqICBzaXplOiA8ZmxvYXQ+LCAvLyBzaXplIG9mIHRoZSB0ZXh0CgkgKiAgaGVpZ2h0OiA8ZmxvYXQ+LCAvLyB0aGlja25lc3MgdG8gZXh0cnVkZSB0ZXh0CgkgKiAgY3VydmVTZWdtZW50czogPGludD4sIC8vIG51bWJlciBvZiBwb2ludHMgb24gdGhlIGN1cnZlcwoJICoKCSAqICBiZXZlbEVuYWJsZWQ6IDxib29sPiwgLy8gdHVybiBvbiBiZXZlbAoJICogIGJldmVsVGhpY2tuZXNzOiA8ZmxvYXQ+LCAvLyBob3cgZGVlcCBpbnRvIHRleHQgYmV2ZWwgZ29lcwoJICogIGJldmVsU2l6ZTogPGZsb2F0PiAvLyBob3cgZmFyIGZyb20gdGV4dCBvdXRsaW5lIGlzIGJldmVsCgkgKiB9CgkgKi8KCgkvLyBUZXh0R2VvbWV0cnkKCglmdW5jdGlvbiBUZXh0R2VvbWV0cnkoIHRleHQsIHBhcmFtZXRlcnMgKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1RleHRHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJdGV4dDogdGV4dCwKCQkJcGFyYW1ldGVyczogcGFyYW1ldGVycwoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgVGV4dEJ1ZmZlckdlb21ldHJ5KCB0ZXh0LCBwYXJhbWV0ZXJzICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJVGV4dEdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJVGV4dEdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFRleHRHZW9tZXRyeTsKCgkvLyBUZXh0QnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBUZXh0QnVmZmVyR2VvbWV0cnkoIHRleHQsIHBhcmFtZXRlcnMgKSB7CgoJCXBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9OwoKCQl2YXIgZm9udCA9IHBhcmFtZXRlcnMuZm9udDsKCgkJaWYgKCAhICggZm9udCAmJiBmb250LmlzRm9udCApICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlRleHRHZW9tZXRyeTogZm9udCBwYXJhbWV0ZXIgaXMgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkZvbnQuJyApOwoJCQlyZXR1cm4gbmV3IEdlb21ldHJ5KCk7CgoJCX0KCgkJdmFyIHNoYXBlcyA9IGZvbnQuZ2VuZXJhdGVTaGFwZXMoIHRleHQsIHBhcmFtZXRlcnMuc2l6ZSApOwoKCQkvLyB0cmFuc2xhdGUgcGFyYW1ldGVycyB0byBFeHRydWRlR2VvbWV0cnkgQVBJCgoJCXBhcmFtZXRlcnMuZGVwdGggPSBwYXJhbWV0ZXJzLmhlaWdodCAhPT0gdW5kZWZpbmVkID8gcGFyYW1ldGVycy5oZWlnaHQgOiA1MDsKCgkJLy8gZGVmYXVsdHMKCgkJaWYgKCBwYXJhbWV0ZXJzLmJldmVsVGhpY2tuZXNzID09PSB1bmRlZmluZWQgKSBwYXJhbWV0ZXJzLmJldmVsVGhpY2tuZXNzID0gMTA7CgkJaWYgKCBwYXJhbWV0ZXJzLmJldmVsU2l6ZSA9PT0gdW5kZWZpbmVkICkgcGFyYW1ldGVycy5iZXZlbFNpemUgPSA4OwoJCWlmICggcGFyYW1ldGVycy5iZXZlbEVuYWJsZWQgPT09IHVuZGVmaW5lZCApIHBhcmFtZXRlcnMuYmV2ZWxFbmFibGVkID0gZmFsc2U7CgoJCUV4dHJ1ZGVCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzLCBzaGFwZXMsIHBhcmFtZXRlcnMgKTsKCgkJdGhpcy50eXBlID0gJ1RleHRCdWZmZXJHZW9tZXRyeSc7CgoJfQoKCVRleHRCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBFeHRydWRlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglUZXh0QnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVGV4dEJ1ZmZlckdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYmVuYWFkYW1zIC8gaHR0cHM6Ly90d2l0dGVyLmNvbS9iZW5fYV9hZGFtcwoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCS8vIFNwaGVyZUdlb21ldHJ5CgoJZnVuY3Rpb24gU3BoZXJlR2VvbWV0cnkoIHJhZGl1cywgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIHBoaVN0YXJ0LCBwaGlMZW5ndGgsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgewoKCQlHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdTcGhlcmVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJcGhpU3RhcnQ6IHBoaVN0YXJ0LAoJCQlwaGlMZW5ndGg6IHBoaUxlbmd0aCwKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBTcGhlcmVCdWZmZXJHZW9tZXRyeSggcmFkaXVzLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgcGhpU3RhcnQsIHBoaUxlbmd0aCwgdGhldGFTdGFydCwgdGhldGFMZW5ndGggKSApOwoJCXRoaXMubWVyZ2VWZXJ0aWNlcygpOwoKCX0KCglTcGhlcmVHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVNwaGVyZUdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNwaGVyZUdlb21ldHJ5OwoKCS8vIFNwaGVyZUJ1ZmZlckdlb21ldHJ5CgoJZnVuY3Rpb24gU3BoZXJlQnVmZmVyR2VvbWV0cnkoIHJhZGl1cywgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIHBoaVN0YXJ0LCBwaGlMZW5ndGgsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdTcGhlcmVCdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJcGhpU3RhcnQ6IHBoaVN0YXJ0LAoJCQlwaGlMZW5ndGg6IHBoaUxlbmd0aCwKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJcmFkaXVzID0gcmFkaXVzIHx8IDE7CgoJCXdpZHRoU2VnbWVudHMgPSBNYXRoLm1heCggMywgTWF0aC5mbG9vciggd2lkdGhTZWdtZW50cyApIHx8IDggKTsKCQloZWlnaHRTZWdtZW50cyA9IE1hdGgubWF4KCAyLCBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApIHx8IDYgKTsKCgkJcGhpU3RhcnQgPSBwaGlTdGFydCAhPT0gdW5kZWZpbmVkID8gcGhpU3RhcnQgOiAwOwoJCXBoaUxlbmd0aCA9IHBoaUxlbmd0aCAhPT0gdW5kZWZpbmVkID8gcGhpTGVuZ3RoIDogTWF0aC5QSSAqIDI7CgoJCXRoZXRhU3RhcnQgPSB0aGV0YVN0YXJ0ICE9PSB1bmRlZmluZWQgPyB0aGV0YVN0YXJ0IDogMDsKCQl0aGV0YUxlbmd0aCA9IHRoZXRhTGVuZ3RoICE9PSB1bmRlZmluZWQgPyB0aGV0YUxlbmd0aCA6IE1hdGguUEk7CgoJCXZhciB0aGV0YUVuZCA9IHRoZXRhU3RhcnQgKyB0aGV0YUxlbmd0aDsKCgkJdmFyIGl4LCBpeTsKCgkJdmFyIGluZGV4ID0gMDsKCQl2YXIgZ3JpZCA9IFtdOwoKCQl2YXIgdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gYnVmZmVycwoKCQl2YXIgaW5kaWNlcyA9IFtdOwoJCXZhciB2ZXJ0aWNlcyA9IFtdOwoJCXZhciBub3JtYWxzID0gW107CgkJdmFyIHV2cyA9IFtdOwoKCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCWZvciAoIGl5ID0gMDsgaXkgPD0gaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJdmFyIHZlcnRpY2VzUm93ID0gW107CgoJCQl2YXIgdiA9IGl5IC8gaGVpZ2h0U2VnbWVudHM7CgoJCQlmb3IgKCBpeCA9IDA7IGl4IDw9IHdpZHRoU2VnbWVudHM7IGl4ICsrICkgewoKCQkJCXZhciB1ID0gaXggLyB3aWR0aFNlZ21lbnRzOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gLSByYWRpdXMgKiBNYXRoLmNvcyggcGhpU3RhcnQgKyB1ICogcGhpTGVuZ3RoICkgKiBNYXRoLnNpbiggdGhldGFTdGFydCArIHYgKiB0aGV0YUxlbmd0aCApOwoJCQkJdmVydGV4LnkgPSByYWRpdXMgKiBNYXRoLmNvcyggdGhldGFTdGFydCArIHYgKiB0aGV0YUxlbmd0aCApOwoJCQkJdmVydGV4LnogPSByYWRpdXMgKiBNYXRoLnNpbiggcGhpU3RhcnQgKyB1ICogcGhpTGVuZ3RoICkgKiBNYXRoLnNpbiggdGhldGFTdGFydCArIHYgKiB0aGV0YUxlbmd0aCApOwoKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWwuc2V0KCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICkubm9ybWFsaXplKCk7CgkJCQlub3JtYWxzLnB1c2goIG5vcm1hbC54LCBub3JtYWwueSwgbm9ybWFsLnogKTsKCgkJCQkvLyB1dgoKCQkJCXV2cy5wdXNoKCB1LCAxIC0gdiApOwoKCQkJCXZlcnRpY2VzUm93LnB1c2goIGluZGV4ICsrICk7CgoJCQl9CgoJCQlncmlkLnB1c2goIHZlcnRpY2VzUm93ICk7CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBpeSA9IDA7IGl5IDwgaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJZm9yICggaXggPSAwOyBpeCA8IHdpZHRoU2VnbWVudHM7IGl4ICsrICkgewoKCQkJCXZhciBhID0gZ3JpZFsgaXkgXVsgaXggKyAxIF07CgkJCQl2YXIgYiA9IGdyaWRbIGl5IF1bIGl4IF07CgkJCQl2YXIgYyA9IGdyaWRbIGl5ICsgMSBdWyBpeCBdOwoJCQkJdmFyIGQgPSBncmlkWyBpeSArIDEgXVsgaXggKyAxIF07CgoJCQkJaWYgKCBpeSAhPT0gMCB8fCB0aGV0YVN0YXJ0ID4gMCApIGluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaWYgKCBpeSAhPT0gaGVpZ2h0U2VnbWVudHMgLSAxIHx8IHRoZXRhRW5kIDwgTWF0aC5QSSApIGluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCVNwaGVyZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSApOwoJU3BoZXJlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3BoZXJlQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIEthbGViIE11cnBoeQoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCS8vIFJpbmdHZW9tZXRyeQoKCWZ1bmN0aW9uIFJpbmdHZW9tZXRyeSggaW5uZXJSYWRpdXMsIG91dGVyUmFkaXVzLCB0aGV0YVNlZ21lbnRzLCBwaGlTZWdtZW50cywgdGhldGFTdGFydCwgdGhldGFMZW5ndGggKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1JpbmdHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJaW5uZXJSYWRpdXM6IGlubmVyUmFkaXVzLAoJCQlvdXRlclJhZGl1czogb3V0ZXJSYWRpdXMsCgkJCXRoZXRhU2VnbWVudHM6IHRoZXRhU2VnbWVudHMsCgkJCXBoaVNlZ21lbnRzOiBwaGlTZWdtZW50cywKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJdGhpcy5mcm9tQnVmZmVyR2VvbWV0cnkoIG5ldyBSaW5nQnVmZmVyR2VvbWV0cnkoIGlubmVyUmFkaXVzLCBvdXRlclJhZGl1cywgdGhldGFTZWdtZW50cywgcGhpU2VnbWVudHMsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJUmluZ0dlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJUmluZ0dlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFJpbmdHZW9tZXRyeTsKCgkvLyBSaW5nQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBSaW5nQnVmZmVyR2VvbWV0cnkoIGlubmVyUmFkaXVzLCBvdXRlclJhZGl1cywgdGhldGFTZWdtZW50cywgcGhpU2VnbWVudHMsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdSaW5nQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCWlubmVyUmFkaXVzOiBpbm5lclJhZGl1cywKCQkJb3V0ZXJSYWRpdXM6IG91dGVyUmFkaXVzLAoJCQl0aGV0YVNlZ21lbnRzOiB0aGV0YVNlZ21lbnRzLAoJCQlwaGlTZWdtZW50czogcGhpU2VnbWVudHMsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCWlubmVyUmFkaXVzID0gaW5uZXJSYWRpdXMgfHwgMC41OwoJCW91dGVyUmFkaXVzID0gb3V0ZXJSYWRpdXMgfHwgMTsKCgkJdGhldGFTdGFydCA9IHRoZXRhU3RhcnQgIT09IHVuZGVmaW5lZCA/IHRoZXRhU3RhcnQgOiAwOwoJCXRoZXRhTGVuZ3RoID0gdGhldGFMZW5ndGggIT09IHVuZGVmaW5lZCA/IHRoZXRhTGVuZ3RoIDogTWF0aC5QSSAqIDI7CgoJCXRoZXRhU2VnbWVudHMgPSB0aGV0YVNlZ21lbnRzICE9PSB1bmRlZmluZWQgPyBNYXRoLm1heCggMywgdGhldGFTZWdtZW50cyApIDogODsKCQlwaGlTZWdtZW50cyA9IHBoaVNlZ21lbnRzICE9PSB1bmRlZmluZWQgPyBNYXRoLm1heCggMSwgcGhpU2VnbWVudHMgKSA6IDE7CgoJCS8vIGJ1ZmZlcnMKCgkJdmFyIGluZGljZXMgPSBbXTsKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJLy8gc29tZSBoZWxwZXIgdmFyaWFibGVzCgoJCXZhciBzZWdtZW50OwoJCXZhciByYWRpdXMgPSBpbm5lclJhZGl1czsKCQl2YXIgcmFkaXVzU3RlcCA9ICggKCBvdXRlclJhZGl1cyAtIGlubmVyUmFkaXVzICkgLyBwaGlTZWdtZW50cyApOwoJCXZhciB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCXZhciB1diA9IG5ldyBWZWN0b3IyKCk7CgkJdmFyIGosIGk7CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJZm9yICggaiA9IDA7IGogPD0gcGhpU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBpID0gMDsgaSA8PSB0aGV0YVNlZ21lbnRzOyBpICsrICkgewoKCQkJCS8vIHZhbHVlcyBhcmUgZ2VuZXJhdGUgZnJvbSB0aGUgaW5zaWRlIG9mIHRoZSByaW5nIHRvIHRoZSBvdXRzaWRlCgoJCQkJc2VnbWVudCA9IHRoZXRhU3RhcnQgKyBpIC8gdGhldGFTZWdtZW50cyAqIHRoZXRhTGVuZ3RoOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcmFkaXVzICogTWF0aC5jb3MoIHNlZ21lbnQgKTsKCQkJCXZlcnRleC55ID0gcmFkaXVzICogTWF0aC5zaW4oIHNlZ21lbnQgKTsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gbm9ybWFsCgoJCQkJbm9ybWFscy5wdXNoKCAwLCAwLCAxICk7CgoJCQkJLy8gdXYKCgkJCQl1di54ID0gKCB2ZXJ0ZXgueCAvIG91dGVyUmFkaXVzICsgMSApIC8gMjsKCQkJCXV2LnkgPSAoIHZlcnRleC55IC8gb3V0ZXJSYWRpdXMgKyAxICkgLyAyOwoKCQkJCXV2cy5wdXNoKCB1di54LCB1di55ICk7CgoJCQl9CgoJCQkvLyBpbmNyZWFzZSB0aGUgcmFkaXVzIGZvciBuZXh0IHJvdyBvZiB2ZXJ0aWNlcwoKCQkJcmFkaXVzICs9IHJhZGl1c1N0ZXA7CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBqID0gMDsgaiA8IHBoaVNlZ21lbnRzOyBqICsrICkgewoKCQkJdmFyIHRoZXRhU2VnbWVudExldmVsID0gaiAqICggdGhldGFTZWdtZW50cyArIDEgKTsKCgkJCWZvciAoIGkgPSAwOyBpIDwgdGhldGFTZWdtZW50czsgaSArKyApIHsKCgkJCQlzZWdtZW50ID0gaSArIHRoZXRhU2VnbWVudExldmVsOwoKCQkJCXZhciBhID0gc2VnbWVudDsKCQkJCXZhciBiID0gc2VnbWVudCArIHRoZXRhU2VnbWVudHMgKyAxOwoJCQkJdmFyIGMgPSBzZWdtZW50ICsgdGhldGFTZWdtZW50cyArIDI7CgkJCQl2YXIgZCA9IHNlZ21lbnQgKyAxOwoKCQkJCS8vIGZhY2VzCgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCX0KCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCX0KCglSaW5nQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglSaW5nQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmluZ0J1ZmZlckdlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cHM6Ly9naXRodWIuY29tL3p6ODUKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBMYXRoZUdlb21ldHJ5CgoJZnVuY3Rpb24gTGF0aGVHZW9tZXRyeSggcG9pbnRzLCBzZWdtZW50cywgcGhpU3RhcnQsIHBoaUxlbmd0aCApIHsKCgkJR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnTGF0aGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcG9pbnRzOiBwb2ludHMsCgkJCXNlZ21lbnRzOiBzZWdtZW50cywKCQkJcGhpU3RhcnQ6IHBoaVN0YXJ0LAoJCQlwaGlMZW5ndGg6IHBoaUxlbmd0aAoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgTGF0aGVCdWZmZXJHZW9tZXRyeSggcG9pbnRzLCBzZWdtZW50cywgcGhpU3RhcnQsIHBoaUxlbmd0aCApICk7CgkJdGhpcy5tZXJnZVZlcnRpY2VzKCk7CgoJfQoKCUxhdGhlR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggR2VvbWV0cnkucHJvdG90eXBlICk7CglMYXRoZUdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExhdGhlR2VvbWV0cnk7CgoJLy8gTGF0aGVCdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIExhdGhlQnVmZmVyR2VvbWV0cnkoIHBvaW50cywgc2VnbWVudHMsIHBoaVN0YXJ0LCBwaGlMZW5ndGggKSB7CgoJCUJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0xhdGhlQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXBvaW50czogcG9pbnRzLAoJCQlzZWdtZW50czogc2VnbWVudHMsCgkJCXBoaVN0YXJ0OiBwaGlTdGFydCwKCQkJcGhpTGVuZ3RoOiBwaGlMZW5ndGgKCQl9OwoKCQlzZWdtZW50cyA9IE1hdGguZmxvb3IoIHNlZ21lbnRzICkgfHwgMTI7CgkJcGhpU3RhcnQgPSBwaGlTdGFydCB8fCAwOwoJCXBoaUxlbmd0aCA9IHBoaUxlbmd0aCB8fCBNYXRoLlBJICogMjsKCgkJLy8gY2xhbXAgcGhpTGVuZ3RoIHNvIGl0J3MgaW4gcmFuZ2Ugb2YgWyAwLCAyUEkgXQoKCQlwaGlMZW5ndGggPSBfTWF0aC5jbGFtcCggcGhpTGVuZ3RoLCAwLCBNYXRoLlBJICogMiApOwoKCgkJLy8gYnVmZmVycwoKCQl2YXIgaW5kaWNlcyA9IFtdOwoJCXZhciB2ZXJ0aWNlcyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgYmFzZTsKCQl2YXIgaW52ZXJzZVNlZ21lbnRzID0gMS4wIC8gc2VnbWVudHM7CgkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIHV2ID0gbmV3IFZlY3RvcjIoKTsKCQl2YXIgaSwgajsKCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMgYW5kIHV2cwoKCQlmb3IgKCBpID0gMDsgaSA8PSBzZWdtZW50czsgaSArKyApIHsKCgkJCXZhciBwaGkgPSBwaGlTdGFydCArIGkgKiBpbnZlcnNlU2VnbWVudHMgKiBwaGlMZW5ndGg7CgoJCQl2YXIgc2luID0gTWF0aC5zaW4oIHBoaSApOwoJCQl2YXIgY29zID0gTWF0aC5jb3MoIHBoaSApOwoKCQkJZm9yICggaiA9IDA7IGogPD0gKCBwb2ludHMubGVuZ3RoIC0gMSApOyBqICsrICkgewoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcG9pbnRzWyBqIF0ueCAqIHNpbjsKCQkJCXZlcnRleC55ID0gcG9pbnRzWyBqIF0ueTsKCQkJCXZlcnRleC56ID0gcG9pbnRzWyBqIF0ueCAqIGNvczsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1di54ID0gaSAvIHNlZ21lbnRzOwoJCQkJdXYueSA9IGogLyAoIHBvaW50cy5sZW5ndGggLSAxICk7CgoJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgoJCQl9CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBpID0gMDsgaSA8IHNlZ21lbnRzOyBpICsrICkgewoKCQkJZm9yICggaiA9IDA7IGogPCAoIHBvaW50cy5sZW5ndGggLSAxICk7IGogKysgKSB7CgoJCQkJYmFzZSA9IGogKyBpICogcG9pbnRzLmxlbmd0aDsKCgkJCQl2YXIgYSA9IGJhc2U7CgkJCQl2YXIgYiA9IGJhc2UgKyBwb2ludHMubGVuZ3RoOwoJCQkJdmFyIGMgPSBiYXNlICsgcG9pbnRzLmxlbmd0aCArIDE7CgkJCQl2YXIgZCA9IGJhc2UgKyAxOwoKCQkJCS8vIGZhY2VzCgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCX0KCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCQkvLyBnZW5lcmF0ZSBub3JtYWxzCgoJCXRoaXMuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKCgkJLy8gaWYgdGhlIGdlb21ldHJ5IGlzIGNsb3NlZCwgd2UgbmVlZCB0byBhdmVyYWdlIHRoZSBub3JtYWxzIGFsb25nIHRoZSBzZWFtLgoJCS8vIGJlY2F1c2UgdGhlIGNvcnJlc3BvbmRpbmcgdmVydGljZXMgYXJlIGlkZW50aWNhbCAoYnV0IHN0aWxsIGhhdmUgZGlmZmVyZW50IFVWcykuCgoJCWlmICggcGhpTGVuZ3RoID09PSBNYXRoLlBJICogMiApIHsKCgkJCXZhciBub3JtYWxzID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbC5hcnJheTsKCQkJdmFyIG4xID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG4yID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG4gPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gdGhpcyBpcyB0aGUgYnVmZmVyIG9mZnNldCBmb3IgdGhlIGxhc3QgbGluZSBvZiB2ZXJ0aWNlcwoKCQkJYmFzZSA9IHNlZ21lbnRzICogcG9pbnRzLmxlbmd0aCAqIDM7CgoJCQlmb3IgKCBpID0gMCwgaiA9IDA7IGkgPCBwb2ludHMubGVuZ3RoOyBpICsrLCBqICs9IDMgKSB7CgoJCQkJLy8gc2VsZWN0IHRoZSBub3JtYWwgb2YgdGhlIHZlcnRleCBpbiB0aGUgZmlyc3QgbGluZQoKCQkJCW4xLnggPSBub3JtYWxzWyBqICsgMCBdOwoJCQkJbjEueSA9IG5vcm1hbHNbIGogKyAxIF07CgkJCQluMS56ID0gbm9ybWFsc1sgaiArIDIgXTsKCgkJCQkvLyBzZWxlY3QgdGhlIG5vcm1hbCBvZiB0aGUgdmVydGV4IGluIHRoZSBsYXN0IGxpbmUKCgkJCQluMi54ID0gbm9ybWFsc1sgYmFzZSArIGogKyAwIF07CgkJCQluMi55ID0gbm9ybWFsc1sgYmFzZSArIGogKyAxIF07CgkJCQluMi56ID0gbm9ybWFsc1sgYmFzZSArIGogKyAyIF07CgoJCQkJLy8gYXZlcmFnZSBub3JtYWxzCgoJCQkJbi5hZGRWZWN0b3JzKCBuMSwgbjIgKS5ub3JtYWxpemUoKTsKCgkJCQkvLyBhc3NpZ24gdGhlIG5ldyB2YWx1ZXMgdG8gYm90aCBub3JtYWxzCgoJCQkJbm9ybWFsc1sgaiArIDAgXSA9IG5vcm1hbHNbIGJhc2UgKyBqICsgMCBdID0gbi54OwoJCQkJbm9ybWFsc1sgaiArIDEgXSA9IG5vcm1hbHNbIGJhc2UgKyBqICsgMSBdID0gbi55OwoJCQkJbm9ybWFsc1sgaiArIDIgXSA9IG5vcm1hbHNbIGJhc2UgKyBqICsgMiBdID0gbi56OwoKCQkJfQoKCQl9CgoJfQoKCUxhdGhlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglMYXRoZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExhdGhlQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIGpvbm9icjEgLyBodHRwOi8vam9ub2JyMS5jb20KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBTaGFwZUdlb21ldHJ5CgoJZnVuY3Rpb24gU2hhcGVHZW9tZXRyeSggc2hhcGVzLCBjdXJ2ZVNlZ21lbnRzICkgewoKCQlHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdTaGFwZUdlb21ldHJ5JzsKCgkJaWYgKCB0eXBlb2YgY3VydmVTZWdtZW50cyA9PT0gJ29iamVjdCcgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5TaGFwZUdlb21ldHJ5OiBPcHRpb25zIHBhcmFtZXRlciBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCWN1cnZlU2VnbWVudHMgPSBjdXJ2ZVNlZ21lbnRzLmN1cnZlU2VnbWVudHM7CgoJCX0KCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlzaGFwZXM6IHNoYXBlcywKCQkJY3VydmVTZWdtZW50czogY3VydmVTZWdtZW50cwoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgU2hhcGVCdWZmZXJHZW9tZXRyeSggc2hhcGVzLCBjdXJ2ZVNlZ21lbnRzICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJU2hhcGVHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVNoYXBlR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU2hhcGVHZW9tZXRyeTsKCglTaGFwZUdlb21ldHJ5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CgoJCXZhciBkYXRhID0gR2VvbWV0cnkucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCXZhciBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoKCQlyZXR1cm4gdG9KU09OJDEoIHNoYXBlcywgZGF0YSApOwoKCX07CgoJLy8gU2hhcGVCdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIFNoYXBlQnVmZmVyR2VvbWV0cnkoIHNoYXBlcywgY3VydmVTZWdtZW50cyApIHsKCgkJQnVmZmVyR2VvbWV0cnkuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnU2hhcGVCdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJc2hhcGVzOiBzaGFwZXMsCgkJCWN1cnZlU2VnbWVudHM6IGN1cnZlU2VnbWVudHMKCQl9OwoKCQljdXJ2ZVNlZ21lbnRzID0gY3VydmVTZWdtZW50cyB8fCAxMjsKCgkJLy8gYnVmZmVycwoKCQl2YXIgaW5kaWNlcyA9IFtdOwoJCXZhciB2ZXJ0aWNlcyA9IFtdOwoJCXZhciBub3JtYWxzID0gW107CgkJdmFyIHV2cyA9IFtdOwoKCQkvLyBoZWxwZXIgdmFyaWFibGVzCgoJCXZhciBncm91cFN0YXJ0ID0gMDsKCQl2YXIgZ3JvdXBDb3VudCA9IDA7CgoJCS8vIGFsbG93IHNpbmdsZSBhbmQgYXJyYXkgdmFsdWVzIGZvciAic2hhcGVzIiBwYXJhbWV0ZXIKCgkJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSA9PT0gZmFsc2UgKSB7CgoJCQlhZGRTaGFwZSggc2hhcGVzICk7CgoJCX0gZWxzZSB7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBzaGFwZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCWFkZFNoYXBlKCBzaGFwZXNbIGkgXSApOwoKCQkJCXRoaXMuYWRkR3JvdXAoIGdyb3VwU3RhcnQsIGdyb3VwQ291bnQsIGkgKTsgLy8gZW5hYmxlcyBNdWx0aU1hdGVyaWFsIHN1cHBvcnQKCgkJCQlncm91cFN0YXJ0ICs9IGdyb3VwQ291bnQ7CgkJCQlncm91cENvdW50ID0gMDsKCgkJCX0KCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCgkJLy8gaGVscGVyIGZ1bmN0aW9ucwoKCQlmdW5jdGlvbiBhZGRTaGFwZSggc2hhcGUgKSB7CgoJCQl2YXIgaSwgbCwgc2hhcGVIb2xlOwoKCQkJdmFyIGluZGV4T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMzsKCQkJdmFyIHBvaW50cyA9IHNoYXBlLmV4dHJhY3RQb2ludHMoIGN1cnZlU2VnbWVudHMgKTsKCgkJCXZhciBzaGFwZVZlcnRpY2VzID0gcG9pbnRzLnNoYXBlOwoJCQl2YXIgc2hhcGVIb2xlcyA9IHBvaW50cy5ob2xlczsKCgkJCS8vIGNoZWNrIGRpcmVjdGlvbiBvZiB2ZXJ0aWNlcwoKCQkJaWYgKCBTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKCBzaGFwZVZlcnRpY2VzICkgPT09IGZhbHNlICkgewoKCQkJCXNoYXBlVmVydGljZXMgPSBzaGFwZVZlcnRpY2VzLnJldmVyc2UoKTsKCgkJCX0KCgkJCWZvciAoIGkgPSAwLCBsID0gc2hhcGVIb2xlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXNoYXBlSG9sZSA9IHNoYXBlSG9sZXNbIGkgXTsKCgkJCQlpZiAoIFNoYXBlVXRpbHMuaXNDbG9ja1dpc2UoIHNoYXBlSG9sZSApID09PSB0cnVlICkgewoKCQkJCQlzaGFwZUhvbGVzWyBpIF0gPSBzaGFwZUhvbGUucmV2ZXJzZSgpOwoKCQkJCX0KCgkJCX0KCgkJCXZhciBmYWNlcyA9IFNoYXBlVXRpbHMudHJpYW5ndWxhdGVTaGFwZSggc2hhcGVWZXJ0aWNlcywgc2hhcGVIb2xlcyApOwoKCQkJLy8gam9pbiB2ZXJ0aWNlcyBvZiBpbm5lciBhbmQgb3V0ZXIgcGF0aHMgdG8gYSBzaW5nbGUgYXJyYXkKCgkJCWZvciAoIGkgPSAwLCBsID0gc2hhcGVIb2xlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXNoYXBlSG9sZSA9IHNoYXBlSG9sZXNbIGkgXTsKCQkJCXNoYXBlVmVydGljZXMgPSBzaGFwZVZlcnRpY2VzLmNvbmNhdCggc2hhcGVIb2xlICk7CgoJCQl9CgoJCQkvLyB2ZXJ0aWNlcywgbm9ybWFscywgdXZzCgoJCQlmb3IgKCBpID0gMCwgbCA9IHNoYXBlVmVydGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgdmVydGV4ID0gc2hhcGVWZXJ0aWNlc1sgaSBdOwoKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgMCApOwoJCQkJbm9ybWFscy5wdXNoKCAwLCAwLCAxICk7CgkJCQl1dnMucHVzaCggdmVydGV4LngsIHZlcnRleC55ICk7IC8vIHdvcmxkIHV2cwoKCQkJfQoKCQkJLy8gaW5jaWRlcwoKCQkJZm9yICggaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBmYWNlID0gZmFjZXNbIGkgXTsKCgkJCQl2YXIgYSA9IGZhY2VbIDAgXSArIGluZGV4T2Zmc2V0OwoJCQkJdmFyIGIgPSBmYWNlWyAxIF0gKyBpbmRleE9mZnNldDsKCQkJCXZhciBjID0gZmFjZVsgMiBdICsgaW5kZXhPZmZzZXQ7CgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBjICk7CgkJCQlncm91cENvdW50ICs9IDM7CgoJCQl9CgoJCX0KCgl9CgoJU2hhcGVCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCVNoYXBlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU2hhcGVCdWZmZXJHZW9tZXRyeTsKCglTaGFwZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CgoJCXZhciBkYXRhID0gQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCXZhciBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoKCQlyZXR1cm4gdG9KU09OJDEoIHNoYXBlcywgZGF0YSApOwoKCX07CgoJLy8KCglmdW5jdGlvbiB0b0pTT04kMSggc2hhcGVzLCBkYXRhICkgewoKCQlkYXRhLnNoYXBlcyA9IFtdOwoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApICkgewoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGUudXVpZCApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGVzLnV1aWQgKTsKCgkJfQoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCglmdW5jdGlvbiBFZGdlc0dlb21ldHJ5KCBnZW9tZXRyeSwgdGhyZXNob2xkQW5nbGUgKSB7CgoJCUJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0VkZ2VzR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXRocmVzaG9sZEFuZ2xlOiB0aHJlc2hvbGRBbmdsZQoJCX07CgoJCXRocmVzaG9sZEFuZ2xlID0gKCB0aHJlc2hvbGRBbmdsZSAhPT0gdW5kZWZpbmVkICkgPyB0aHJlc2hvbGRBbmdsZSA6IDE7CgoJCS8vIGJ1ZmZlcgoKCQl2YXIgdmVydGljZXMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgdGhyZXNob2xkRG90ID0gTWF0aC5jb3MoIF9NYXRoLkRFRzJSQUQgKiB0aHJlc2hvbGRBbmdsZSApOwoJCXZhciBlZGdlID0gWyAwLCAwIF0sIGVkZ2VzID0ge30sIGVkZ2UxLCBlZGdlMjsKCQl2YXIga2V5LCBrZXlzID0gWyAnYScsICdiJywgJ2MnIF07CgoJCS8vIHByZXBhcmUgc291cmNlIGdlb21ldHJ5CgoJCXZhciBnZW9tZXRyeTI7CgoJCWlmICggZ2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCWdlb21ldHJ5MiA9IG5ldyBHZW9tZXRyeSgpOwoJCQlnZW9tZXRyeTIuZnJvbUJ1ZmZlckdlb21ldHJ5KCBnZW9tZXRyeSApOwoKCQl9IGVsc2UgewoKCQkJZ2VvbWV0cnkyID0gZ2VvbWV0cnkuY2xvbmUoKTsKCgkJfQoKCQlnZW9tZXRyeTIubWVyZ2VWZXJ0aWNlcygpOwoJCWdlb21ldHJ5Mi5jb21wdXRlRmFjZU5vcm1hbHMoKTsKCgkJdmFyIHNvdXJjZVZlcnRpY2VzID0gZ2VvbWV0cnkyLnZlcnRpY2VzOwoJCXZhciBmYWNlcyA9IGdlb21ldHJ5Mi5mYWNlczsKCgkJLy8gbm93IGNyZWF0ZSBhIGRhdGEgc3RydWN0dXJlIHdoZXJlIGVhY2ggZW50cnkgcmVwcmVzZW50cyBhbiBlZGdlIHdpdGggaXRzIGFkam9pbmluZyBmYWNlcwoKCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdmFyIGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJZm9yICggdmFyIGogPSAwOyBqIDwgMzsgaiArKyApIHsKCgkJCQllZGdlMSA9IGZhY2VbIGtleXNbIGogXSBdOwoJCQkJZWRnZTIgPSBmYWNlWyBrZXlzWyAoIGogKyAxICkgJSAzIF0gXTsKCQkJCWVkZ2VbIDAgXSA9IE1hdGgubWluKCBlZGdlMSwgZWRnZTIgKTsKCQkJCWVkZ2VbIDEgXSA9IE1hdGgubWF4KCBlZGdlMSwgZWRnZTIgKTsKCgkJCQlrZXkgPSBlZGdlWyAwIF0gKyAnLCcgKyBlZGdlWyAxIF07CgoJCQkJaWYgKCBlZGdlc1sga2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZWRnZXNbIGtleSBdID0geyBpbmRleDE6IGVkZ2VbIDAgXSwgaW5kZXgyOiBlZGdlWyAxIF0sIGZhY2UxOiBpLCBmYWNlMjogdW5kZWZpbmVkIH07CgoJCQkJfSBlbHNlIHsKCgkJCQkJZWRnZXNbIGtleSBdLmZhY2UyID0gaTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMKCgkJZm9yICgga2V5IGluIGVkZ2VzICkgewoKCQkJdmFyIGUgPSBlZGdlc1sga2V5IF07CgoJCQkvLyBhbiBlZGdlIGlzIG9ubHkgcmVuZGVyZWQgaWYgdGhlIGFuZ2xlIChpbiBkZWdyZWVzKSBiZXR3ZWVuIHRoZSBmYWNlIG5vcm1hbHMgb2YgdGhlIGFkam9pbmluZyBmYWNlcyBleGNlZWRzIHRoaXMgdmFsdWUuIGRlZmF1bHQgPSAxIGRlZ3JlZS4KCgkJCWlmICggZS5mYWNlMiA9PT0gdW5kZWZpbmVkIHx8IGZhY2VzWyBlLmZhY2UxIF0ubm9ybWFsLmRvdCggZmFjZXNbIGUuZmFjZTIgXS5ub3JtYWwgKSA8PSB0aHJlc2hvbGREb3QgKSB7CgoJCQkJdmFyIHZlcnRleCA9IHNvdXJjZVZlcnRpY2VzWyBlLmluZGV4MSBdOwoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCXZlcnRleCA9IHNvdXJjZVZlcnRpY2VzWyBlLmluZGV4MiBdOwoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoKCX0KCglFZGdlc0dlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSApOwoJRWRnZXNHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFZGdlc0dlb21ldHJ5OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKi8KCgkvLyBDeWxpbmRlckdlb21ldHJ5CgoJZnVuY3Rpb24gQ3lsaW5kZXJHZW9tZXRyeSggcmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgewoKCQlHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdDeWxpbmRlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXNUb3A6IHJhZGl1c1RvcCwKCQkJcmFkaXVzQm90dG9tOiByYWRpdXNCb3R0b20sCgkJCWhlaWdodDogaGVpZ2h0LAoJCQlyYWRpYWxTZWdtZW50czogcmFkaWFsU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJb3BlbkVuZGVkOiBvcGVuRW5kZWQsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXRoaXMuZnJvbUJ1ZmZlckdlb21ldHJ5KCBuZXcgQ3lsaW5kZXJCdWZmZXJHZW9tZXRyeSggcmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgKTsKCQl0aGlzLm1lcmdlVmVydGljZXMoKTsKCgl9CgoJQ3lsaW5kZXJHZW9tZXRyeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBHZW9tZXRyeS5wcm90b3R5cGUgKTsKCUN5bGluZGVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3lsaW5kZXJHZW9tZXRyeTsKCgkvLyBDeWxpbmRlckJ1ZmZlckdlb21ldHJ5CgoJZnVuY3Rpb24gQ3lsaW5kZXJCdWZmZXJHZW9tZXRyeSggcmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdDeWxpbmRlckJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXNUb3A6IHJhZGl1c1RvcCwKCQkJcmFkaXVzQm90dG9tOiByYWRpdXNCb3R0b20sCgkJCWhlaWdodDogaGVpZ2h0LAoJCQlyYWRpYWxTZWdtZW50czogcmFkaWFsU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJb3BlbkVuZGVkOiBvcGVuRW5kZWQsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXZhciBzY29wZSA9IHRoaXM7CgoJCXJhZGl1c1RvcCA9IHJhZGl1c1RvcCAhPT0gdW5kZWZpbmVkID8gcmFkaXVzVG9wIDogMTsKCQlyYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b20gIT09IHVuZGVmaW5lZCA/IHJhZGl1c0JvdHRvbSA6IDE7CgkJaGVpZ2h0ID0gaGVpZ2h0IHx8IDE7CgoJCXJhZGlhbFNlZ21lbnRzID0gTWF0aC5mbG9vciggcmFkaWFsU2VnbWVudHMgKSB8fCA4OwoJCWhlaWdodFNlZ21lbnRzID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKSB8fCAxOwoKCQlvcGVuRW5kZWQgPSBvcGVuRW5kZWQgIT09IHVuZGVmaW5lZCA/IG9wZW5FbmRlZCA6IGZhbHNlOwoJCXRoZXRhU3RhcnQgPSB0aGV0YVN0YXJ0ICE9PSB1bmRlZmluZWQgPyB0aGV0YVN0YXJ0IDogMC4wOwoJCXRoZXRhTGVuZ3RoID0gdGhldGFMZW5ndGggIT09IHVuZGVmaW5lZCA/IHRoZXRhTGVuZ3RoIDogTWF0aC5QSSAqIDI7CgoJCS8vIGJ1ZmZlcnMKCgkJdmFyIGluZGljZXMgPSBbXTsKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgbm9ybWFscyA9IFtdOwoJCXZhciB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQl2YXIgaW5kZXggPSAwOwoJCXZhciBpbmRleEFycmF5ID0gW107CgkJdmFyIGhhbGZIZWlnaHQgPSBoZWlnaHQgLyAyOwoJCXZhciBncm91cFN0YXJ0ID0gMDsKCgkJLy8gZ2VuZXJhdGUgZ2VvbWV0cnkKCgkJZ2VuZXJhdGVUb3JzbygpOwoKCQlpZiAoIG9wZW5FbmRlZCA9PT0gZmFsc2UgKSB7CgoJCQlpZiAoIHJhZGl1c1RvcCA+IDAgKSBnZW5lcmF0ZUNhcCggdHJ1ZSApOwoJCQlpZiAoIHJhZGl1c0JvdHRvbSA+IDAgKSBnZW5lcmF0ZUNhcCggZmFsc2UgKTsKCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCQlmdW5jdGlvbiBnZW5lcmF0ZVRvcnNvKCkgewoKCQkJdmFyIHgsIHk7CgkJCXZhciBub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCgkJCXZhciBncm91cENvdW50ID0gMDsKCgkJCS8vIHRoaXMgd2lsbCBiZSB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgbm9ybWFsCgkJCXZhciBzbG9wZSA9ICggcmFkaXVzQm90dG9tIC0gcmFkaXVzVG9wICkgLyBoZWlnaHQ7CgoJCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCQlmb3IgKCB5ID0gMDsgeSA8PSBoZWlnaHRTZWdtZW50czsgeSArKyApIHsKCgkJCQl2YXIgaW5kZXhSb3cgPSBbXTsKCgkJCQl2YXIgdiA9IHkgLyBoZWlnaHRTZWdtZW50czsKCgkJCQkvLyBjYWxjdWxhdGUgdGhlIHJhZGl1cyBvZiB0aGUgY3VycmVudCByb3cKCgkJCQl2YXIgcmFkaXVzID0gdiAqICggcmFkaXVzQm90dG9tIC0gcmFkaXVzVG9wICkgKyByYWRpdXNUb3A7CgoJCQkJZm9yICggeCA9IDA7IHggPD0gcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJCXZhciB1ID0geCAvIHJhZGlhbFNlZ21lbnRzOwoKCQkJCQl2YXIgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCQl2YXIgc2luVGhldGEgPSBNYXRoLnNpbiggdGhldGEgKTsKCQkJCQl2YXIgY29zVGhldGEgPSBNYXRoLmNvcyggdGhldGEgKTsKCgkJCQkJLy8gdmVydGV4CgoJCQkJCXZlcnRleC54ID0gcmFkaXVzICogc2luVGhldGE7CgkJCQkJdmVydGV4LnkgPSAtIHYgKiBoZWlnaHQgKyBoYWxmSGVpZ2h0OwoJCQkJCXZlcnRleC56ID0gcmFkaXVzICogY29zVGhldGE7CgkJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCQkvLyBub3JtYWwKCgkJCQkJbm9ybWFsLnNldCggc2luVGhldGEsIHNsb3BlLCBjb3NUaGV0YSApLm5vcm1hbGl6ZSgpOwoJCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCQkvLyB1dgoKCQkJCQl1dnMucHVzaCggdSwgMSAtIHYgKTsKCgkJCQkJLy8gc2F2ZSBpbmRleCBvZiB2ZXJ0ZXggaW4gcmVzcGVjdGl2ZSByb3cKCgkJCQkJaW5kZXhSb3cucHVzaCggaW5kZXggKysgKTsKCgkJCQl9CgoJCQkJLy8gbm93IHNhdmUgdmVydGljZXMgb2YgdGhlIHJvdyBpbiBvdXIgaW5kZXggYXJyYXkKCgkJCQlpbmRleEFycmF5LnB1c2goIGluZGV4Um93ICk7CgoJCQl9CgoJCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCQlmb3IgKCB4ID0gMDsgeCA8IHJhZGlhbFNlZ21lbnRzOyB4ICsrICkgewoKCQkJCWZvciAoIHkgPSAwOyB5IDwgaGVpZ2h0U2VnbWVudHM7IHkgKysgKSB7CgoJCQkJCS8vIHdlIHVzZSB0aGUgaW5kZXggYXJyYXkgdG8gYWNjZXNzIHRoZSBjb3JyZWN0IGluZGljZXMKCgkJCQkJdmFyIGEgPSBpbmRleEFycmF5WyB5IF1bIHggXTsKCQkJCQl2YXIgYiA9IGluZGV4QXJyYXlbIHkgKyAxIF1bIHggXTsKCQkJCQl2YXIgYyA9IGluZGV4QXJyYXlbIHkgKyAxIF1bIHggKyAxIF07CgkJCQkJdmFyIGQgPSBpbmRleEFycmF5WyB5IF1bIHggKyAxIF07CgoJCQkJCS8vIGZhY2VzCgoJCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJCQkvLyB1cGRhdGUgZ3JvdXAgY291bnRlcgoKCQkJCQlncm91cENvdW50ICs9IDY7CgoJCQkJfQoKCQkJfQoKCQkJLy8gYWRkIGEgZ3JvdXAgdG8gdGhlIGdlb21ldHJ5LiB0aGlzIHdpbGwgZW5zdXJlIG11bHRpIG1hdGVyaWFsIHN1cHBvcnQKCgkJCXNjb3BlLmFkZEdyb3VwKCBncm91cFN0YXJ0LCBncm91cENvdW50LCAwICk7CgoJCQkvLyBjYWxjdWxhdGUgbmV3IHN0YXJ0IHZhbHVlIGZvciBncm91cHMKCgkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZUNhcCggdG9wICkgewoKCQkJdmFyIHgsIGNlbnRlckluZGV4U3RhcnQsIGNlbnRlckluZGV4RW5kOwoKCQkJdmFyIHV2ID0gbmV3IFZlY3RvcjIoKTsKCQkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgZ3JvdXBDb3VudCA9IDA7CgoJCQl2YXIgcmFkaXVzID0gKCB0b3AgPT09IHRydWUgKSA/IHJhZGl1c1RvcCA6IHJhZGl1c0JvdHRvbTsKCQkJdmFyIHNpZ24gPSAoIHRvcCA9PT0gdHJ1ZSApID8gMSA6IC0gMTsKCgkJCS8vIHNhdmUgdGhlIGluZGV4IG9mIHRoZSBmaXJzdCBjZW50ZXIgdmVydGV4CgkJCWNlbnRlckluZGV4U3RhcnQgPSBpbmRleDsKCgkJCS8vIGZpcnN0IHdlIGdlbmVyYXRlIHRoZSBjZW50ZXIgdmVydGV4IGRhdGEgb2YgdGhlIGNhcC4KCQkJLy8gYmVjYXVzZSB0aGUgZ2VvbWV0cnkgbmVlZHMgb25lIHNldCBvZiB1dnMgcGVyIGZhY2UsCgkJCS8vIHdlIG11c3QgZ2VuZXJhdGUgYSBjZW50ZXIgdmVydGV4IHBlciBmYWNlL3NlZ21lbnQKCgkJCWZvciAoIHggPSAxOyB4IDw9IHJhZGlhbFNlZ21lbnRzOyB4ICsrICkgewoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRpY2VzLnB1c2goIDAsIGhhbGZIZWlnaHQgKiBzaWduLCAwICk7CgoJCQkJLy8gbm9ybWFsCgoJCQkJbm9ybWFscy5wdXNoKCAwLCBzaWduLCAwICk7CgoJCQkJLy8gdXYKCgkJCQl1dnMucHVzaCggMC41LCAwLjUgKTsKCgkJCQkvLyBpbmNyZWFzZSBpbmRleAoKCQkJCWluZGV4ICsrOwoKCQkJfQoKCQkJLy8gc2F2ZSB0aGUgaW5kZXggb2YgdGhlIGxhc3QgY2VudGVyIHZlcnRleAoKCQkJY2VudGVySW5kZXhFbmQgPSBpbmRleDsKCgkJCS8vIG5vdyB3ZSBnZW5lcmF0ZSB0aGUgc3Vycm91bmRpbmcgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQkJZm9yICggeCA9IDA7IHggPD0gcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJdmFyIHUgPSB4IC8gcmFkaWFsU2VnbWVudHM7CgkJCQl2YXIgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCXZhciBjb3NUaGV0YSA9IE1hdGguY29zKCB0aGV0YSApOwoJCQkJdmFyIHNpblRoZXRhID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGV4LnggPSByYWRpdXMgKiBzaW5UaGV0YTsKCQkJCXZlcnRleC55ID0gaGFsZkhlaWdodCAqIHNpZ247CgkJCQl2ZXJ0ZXgueiA9IHJhZGl1cyAqIGNvc1RoZXRhOwoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCW5vcm1hbHMucHVzaCggMCwgc2lnbiwgMCApOwoKCQkJCS8vIHV2CgoJCQkJdXYueCA9ICggY29zVGhldGEgKiAwLjUgKSArIDAuNTsKCQkJCXV2LnkgPSAoIHNpblRoZXRhICogMC41ICogc2lnbiApICsgMC41OwoJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQkvLyBpbmNyZWFzZSBpbmRleAoKCQkJCWluZGV4ICsrOwoKCQkJfQoKCQkJLy8gZ2VuZXJhdGUgaW5kaWNlcwoKCQkJZm9yICggeCA9IDA7IHggPCByYWRpYWxTZWdtZW50czsgeCArKyApIHsKCgkJCQl2YXIgYyA9IGNlbnRlckluZGV4U3RhcnQgKyB4OwoJCQkJdmFyIGkgPSBjZW50ZXJJbmRleEVuZCArIHg7CgoJCQkJaWYgKCB0b3AgPT09IHRydWUgKSB7CgoJCQkJCS8vIGZhY2UgdG9wCgoJCQkJCWluZGljZXMucHVzaCggaSwgaSArIDEsIGMgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBmYWNlIGJvdHRvbQoKCQkJCQlpbmRpY2VzLnB1c2goIGkgKyAxLCBpLCBjICk7CgoJCQkJfQoKCQkJCWdyb3VwQ291bnQgKz0gMzsKCgkJCX0KCgkJCS8vIGFkZCBhIGdyb3VwIHRvIHRoZSBnZW9tZXRyeS4gdGhpcyB3aWxsIGVuc3VyZSBtdWx0aSBtYXRlcmlhbCBzdXBwb3J0CgoJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgdG9wID09PSB0cnVlID8gMSA6IDIgKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQl9CgoJfQoKCUN5bGluZGVyQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICk7CglDeWxpbmRlckJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN5bGluZGVyQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIGFiZWxuYXRpb24gLyBodHRwOi8vZ2l0aHViLmNvbS9hYmVsbmF0aW9uCgkgKi8KCgkvLyBDb25lR2VvbWV0cnkKCglmdW5jdGlvbiBDb25lR2VvbWV0cnkoIHJhZGl1cywgaGVpZ2h0LCByYWRpYWxTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIG9wZW5FbmRlZCwgdGhldGFTdGFydCwgdGhldGFMZW5ndGggKSB7CgoJCUN5bGluZGVyR2VvbWV0cnkuY2FsbCggdGhpcywgMCwgcmFkaXVzLCBoZWlnaHQsIHJhZGlhbFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgb3BlbkVuZGVkLCB0aGV0YVN0YXJ0LCB0aGV0YUxlbmd0aCApOwoKCQl0aGlzLnR5cGUgPSAnQ29uZUdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAoJCQlvcGVuRW5kZWQ6IG9wZW5FbmRlZCwKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgl9CgoJQ29uZUdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN5bGluZGVyR2VvbWV0cnkucHJvdG90eXBlICk7CglDb25lR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ29uZUdlb21ldHJ5OwoKCS8vIENvbmVCdWZmZXJHZW9tZXRyeQoKCWZ1bmN0aW9uIENvbmVCdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBoZWlnaHQsIHJhZGlhbFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgb3BlbkVuZGVkLCB0aGV0YVN0YXJ0LCB0aGV0YUxlbmd0aCApIHsKCgkJQ3lsaW5kZXJCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzLCAwLCByYWRpdXMsIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICk7CgoJCXRoaXMudHlwZSA9ICdDb25lQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQloZWlnaHQ6IGhlaWdodCwKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCW9wZW5FbmRlZDogb3BlbkVuZGVkLAoJCQl0aGV0YVN0YXJ0OiB0aGV0YVN0YXJ0LAoJCQl0aGV0YUxlbmd0aDogdGhldGFMZW5ndGgKCQl9OwoKCX0KCglDb25lQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ3lsaW5kZXJCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUgKTsKCUNvbmVCdWZmZXJHZW9tZXRyeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDb25lQnVmZmVyR2VvbWV0cnk7CgoJLyoqCgkgKiBAYXV0aG9yIGJlbmFhZGFtcyAvIGh0dHBzOi8vdHdpdHRlci5jb20vYmVuX2FfYWRhbXMKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKiBAYXV0aG9yIGh1Z2hlcwoJICovCgoJLy8gQ2lyY2xlR2VvbWV0cnkKCglmdW5jdGlvbiBDaXJjbGVHZW9tZXRyeSggcmFkaXVzLCBzZWdtZW50cywgdGhldGFTdGFydCwgdGhldGFMZW5ndGggKSB7CgoJCUdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0NpcmNsZUdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJc2VnbWVudHM6IHNlZ21lbnRzLAoJCQl0aGV0YVN0YXJ0OiB0aGV0YVN0YXJ0LAoJCQl0aGV0YUxlbmd0aDogdGhldGFMZW5ndGgKCQl9OwoKCQl0aGlzLmZyb21CdWZmZXJHZW9tZXRyeSggbmV3IENpcmNsZUJ1ZmZlckdlb21ldHJ5KCByYWRpdXMsIHNlZ21lbnRzLCB0aGV0YVN0YXJ0LCB0aGV0YUxlbmd0aCApICk7CgkJdGhpcy5tZXJnZVZlcnRpY2VzKCk7CgoJfQoKCUNpcmNsZUdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEdlb21ldHJ5LnByb3RvdHlwZSApOwoJQ2lyY2xlR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2lyY2xlR2VvbWV0cnk7CgoJLy8gQ2lyY2xlQnVmZmVyR2VvbWV0cnkKCglmdW5jdGlvbiBDaXJjbGVCdWZmZXJHZW9tZXRyeSggcmFkaXVzLCBzZWdtZW50cywgdGhldGFTdGFydCwgdGhldGFMZW5ndGggKSB7CgoJCUJ1ZmZlckdlb21ldHJ5LmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0NpcmNsZUJ1ZmZlckdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJc2VnbWVudHM6IHNlZ21lbnRzLAoJCQl0aGV0YVN0YXJ0OiB0aGV0YVN0YXJ0LAoJCQl0aGV0YUxlbmd0aDogdGhldGFMZW5ndGgKCQl9OwoKCQlyYWRpdXMgPSByYWRpdXMgfHwgMTsKCQlzZWdtZW50cyA9IHNlZ21lbnRzICE9PSB1bmRlZmluZWQgPyBNYXRoLm1heCggMywgc2VnbWVudHMgKSA6IDg7CgoJCXRoZXRhU3RhcnQgPSB0aGV0YVN0YXJ0ICE9PSB1bmRlZmluZWQgPyB0aGV0YVN0YXJ0IDogMDsKCQl0aGV0YUxlbmd0aCA9IHRoZXRhTGVuZ3RoICE9PSB1bmRlZmluZWQgPyB0aGV0YUxlbmd0aCA6IE1hdGguUEkgKiAyOwoKCQkvLyBidWZmZXJzCgoJCXZhciBpbmRpY2VzID0gW107CgkJdmFyIHZlcnRpY2VzID0gW107CgkJdmFyIG5vcm1hbHMgPSBbXTsKCQl2YXIgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJdmFyIGksIHM7CgkJdmFyIHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIHV2ID0gbmV3IFZlY3RvcjIoKTsKCgkJLy8gY2VudGVyIHBvaW50CgoJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCQl1dnMucHVzaCggMC41LCAwLjUgKTsKCgkJZm9yICggcyA9IDAsIGkgPSAzOyBzIDw9IHNlZ21lbnRzOyBzICsrLCBpICs9IDMgKSB7CgoJCQl2YXIgc2VnbWVudCA9IHRoZXRhU3RhcnQgKyBzIC8gc2VnbWVudHMgKiB0aGV0YUxlbmd0aDsKCgkJCS8vIHZlcnRleAoKCQkJdmVydGV4LnggPSByYWRpdXMgKiBNYXRoLmNvcyggc2VnbWVudCApOwoJCQl2ZXJ0ZXgueSA9IHJhZGl1cyAqIE1hdGguc2luKCBzZWdtZW50ICk7CgoJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkvLyBub3JtYWwKCgkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJLy8gdXZzCgoJCQl1di54ID0gKCB2ZXJ0aWNlc1sgaSBdIC8gcmFkaXVzICsgMSApIC8gMjsKCQkJdXYueSA9ICggdmVydGljZXNbIGkgKyAxIF0gLyByYWRpdXMgKyAxICkgLyAyOwoKCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJfQoKCQkvLyBpbmRpY2VzCgoJCWZvciAoIGkgPSAxOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJaW5kaWNlcy5wdXNoKCBpLCBpICsgMSwgMCApOwoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLmFkZEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCUNpcmNsZUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSApOwoJQ2lyY2xlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ2lyY2xlQnVmZmVyR2VvbWV0cnk7CgoKCgl2YXIgR2VvbWV0cmllcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlXaXJlZnJhbWVHZW9tZXRyeTogV2lyZWZyYW1lR2VvbWV0cnksCgkJUGFyYW1ldHJpY0dlb21ldHJ5OiBQYXJhbWV0cmljR2VvbWV0cnksCgkJUGFyYW1ldHJpY0J1ZmZlckdlb21ldHJ5OiBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnksCgkJVGV0cmFoZWRyb25HZW9tZXRyeTogVGV0cmFoZWRyb25HZW9tZXRyeSwKCQlUZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5OiBUZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LAoJCU9jdGFoZWRyb25HZW9tZXRyeTogT2N0YWhlZHJvbkdlb21ldHJ5LAoJCU9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeTogT2N0YWhlZHJvbkJ1ZmZlckdlb21ldHJ5LAoJCUljb3NhaGVkcm9uR2VvbWV0cnk6IEljb3NhaGVkcm9uR2VvbWV0cnksCgkJSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeTogSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeSwKCQlEb2RlY2FoZWRyb25HZW9tZXRyeTogRG9kZWNhaGVkcm9uR2VvbWV0cnksCgkJRG9kZWNhaGVkcm9uQnVmZmVyR2VvbWV0cnk6IERvZGVjYWhlZHJvbkJ1ZmZlckdlb21ldHJ5LAoJCVBvbHloZWRyb25HZW9tZXRyeTogUG9seWhlZHJvbkdlb21ldHJ5LAoJCVBvbHloZWRyb25CdWZmZXJHZW9tZXRyeTogUG9seWhlZHJvbkJ1ZmZlckdlb21ldHJ5LAoJCVR1YmVHZW9tZXRyeTogVHViZUdlb21ldHJ5LAoJCVR1YmVCdWZmZXJHZW9tZXRyeTogVHViZUJ1ZmZlckdlb21ldHJ5LAoJCVRvcnVzS25vdEdlb21ldHJ5OiBUb3J1c0tub3RHZW9tZXRyeSwKCQlUb3J1c0tub3RCdWZmZXJHZW9tZXRyeTogVG9ydXNLbm90QnVmZmVyR2VvbWV0cnksCgkJVG9ydXNHZW9tZXRyeTogVG9ydXNHZW9tZXRyeSwKCQlUb3J1c0J1ZmZlckdlb21ldHJ5OiBUb3J1c0J1ZmZlckdlb21ldHJ5LAoJCVRleHRHZW9tZXRyeTogVGV4dEdlb21ldHJ5LAoJCVRleHRCdWZmZXJHZW9tZXRyeTogVGV4dEJ1ZmZlckdlb21ldHJ5LAoJCVNwaGVyZUdlb21ldHJ5OiBTcGhlcmVHZW9tZXRyeSwKCQlTcGhlcmVCdWZmZXJHZW9tZXRyeTogU3BoZXJlQnVmZmVyR2VvbWV0cnksCgkJUmluZ0dlb21ldHJ5OiBSaW5nR2VvbWV0cnksCgkJUmluZ0J1ZmZlckdlb21ldHJ5OiBSaW5nQnVmZmVyR2VvbWV0cnksCgkJUGxhbmVHZW9tZXRyeTogUGxhbmVHZW9tZXRyeSwKCQlQbGFuZUJ1ZmZlckdlb21ldHJ5OiBQbGFuZUJ1ZmZlckdlb21ldHJ5LAoJCUxhdGhlR2VvbWV0cnk6IExhdGhlR2VvbWV0cnksCgkJTGF0aGVCdWZmZXJHZW9tZXRyeTogTGF0aGVCdWZmZXJHZW9tZXRyeSwKCQlTaGFwZUdlb21ldHJ5OiBTaGFwZUdlb21ldHJ5LAoJCVNoYXBlQnVmZmVyR2VvbWV0cnk6IFNoYXBlQnVmZmVyR2VvbWV0cnksCgkJRXh0cnVkZUdlb21ldHJ5OiBFeHRydWRlR2VvbWV0cnksCgkJRXh0cnVkZUJ1ZmZlckdlb21ldHJ5OiBFeHRydWRlQnVmZmVyR2VvbWV0cnksCgkJRWRnZXNHZW9tZXRyeTogRWRnZXNHZW9tZXRyeSwKCQlDb25lR2VvbWV0cnk6IENvbmVHZW9tZXRyeSwKCQlDb25lQnVmZmVyR2VvbWV0cnk6IENvbmVCdWZmZXJHZW9tZXRyeSwKCQlDeWxpbmRlckdlb21ldHJ5OiBDeWxpbmRlckdlb21ldHJ5LAoJCUN5bGluZGVyQnVmZmVyR2VvbWV0cnk6IEN5bGluZGVyQnVmZmVyR2VvbWV0cnksCgkJQ2lyY2xlR2VvbWV0cnk6IENpcmNsZUdlb21ldHJ5LAoJCUNpcmNsZUJ1ZmZlckdlb21ldHJ5OiBDaXJjbGVCdWZmZXJHZW9tZXRyeSwKCQlCb3hHZW9tZXRyeTogQm94R2VvbWV0cnksCgkJQm94QnVmZmVyR2VvbWV0cnk6IEJveEJ1ZmZlckdlb21ldHJ5Cgl9KTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqICBjb2xvcjogPFRIUkVFLkNvbG9yPgoJICogfQoJICovCgoJZnVuY3Rpb24gU2hhZG93TWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1NoYWRvd01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJU2hhZG93TWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglTaGFkb3dNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTaGFkb3dNYXRlcmlhbDsKCglTaGFkb3dNYXRlcmlhbC5wcm90b3R5cGUuaXNTaGFkb3dNYXRlcmlhbCA9IHRydWU7CgoJU2hhZG93TWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gUmF3U2hhZGVyTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCVNoYWRlck1hdGVyaWFsLmNhbGwoIHRoaXMsIHBhcmFtZXRlcnMgKTsKCgkJdGhpcy50eXBlID0gJ1Jhd1NoYWRlck1hdGVyaWFsJzsKCgl9CgoJUmF3U2hhZGVyTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggU2hhZGVyTWF0ZXJpYWwucHJvdG90eXBlICk7CglSYXdTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSYXdTaGFkZXJNYXRlcmlhbDsKCglSYXdTaGFkZXJNYXRlcmlhbC5wcm90b3R5cGUuaXNSYXdTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGNvbG9yOiA8aGV4PiwKCSAqICByb3VnaG5lc3M6IDxmbG9hdD4sCgkgKiAgbWV0YWxuZXNzOiA8ZmxvYXQ+LAoJICogIG9wYWNpdHk6IDxmbG9hdD4sCgkgKgoJICogIG1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgbGlnaHRNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgbGlnaHRNYXBJbnRlbnNpdHk6IDxmbG9hdD4KCSAqCgkgKiAgYW9NYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgYW9NYXBJbnRlbnNpdHk6IDxmbG9hdD4KCSAqCgkgKiAgZW1pc3NpdmU6IDxoZXg+LAoJICogIGVtaXNzaXZlSW50ZW5zaXR5OiA8ZmxvYXQ+CgkgKiAgZW1pc3NpdmVNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGJ1bXBNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgYnVtcFNjYWxlOiA8ZmxvYXQ+LAoJICoKCSAqICBub3JtYWxNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgbm9ybWFsTWFwVHlwZTogVEhSRUUuVGFuZ2VudFNwYWNlTm9ybWFsTWFwLAoJICogIG5vcm1hbFNjYWxlOiA8VmVjdG9yMj4sCgkgKgoJICogIGRpc3BsYWNlbWVudE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBkaXNwbGFjZW1lbnRTY2FsZTogPGZsb2F0PiwKCSAqICBkaXNwbGFjZW1lbnRCaWFzOiA8ZmxvYXQ+LAoJICoKCSAqICByb3VnaG5lc3NNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIG1ldGFsbmVzc01hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYWxwaGFNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGVudk1hcDogbmV3IFRIUkVFLkN1YmVUZXh0dXJlKCBbcG9zeCwgbmVneCwgcG9zeSwgbmVneSwgcG9zeiwgbmVnel0gKSwKCSAqICBlbnZNYXBJbnRlbnNpdHk6IDxmbG9hdD4KCSAqCgkgKiAgcmVmcmFjdGlvblJhdGlvOiA8ZmxvYXQ+LAoJICoKCSAqICB3aXJlZnJhbWU6IDxib29sZWFuPiwKCSAqICB3aXJlZnJhbWVMaW5ld2lkdGg6IDxmbG9hdD4sCgkgKgoJICogIHNraW5uaW5nOiA8Ym9vbD4sCgkgKiAgbW9ycGhUYXJnZXRzOiA8Ym9vbD4sCgkgKiAgbW9ycGhOb3JtYWxzOiA8Ym9vbD4KCSAqIH0KCSAqLwoKCWZ1bmN0aW9uIE1lc2hTdGFuZGFyZE1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQlNYXRlcmlhbC5jYWxsKCB0aGlzICk7CgoJCXRoaXMuZGVmaW5lcyA9IHsgJ1NUQU5EQVJEJzogJycgfTsKCgkJdGhpcy50eXBlID0gJ01lc2hTdGFuZGFyZE1hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZGlmZnVzZQoJCXRoaXMucm91Z2huZXNzID0gMC41OwoJCXRoaXMubWV0YWxuZXNzID0gMC41OwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMubGlnaHRNYXAgPSBudWxsOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMuYW9NYXAgPSBudWxsOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMuZW1pc3NpdmUgPSBuZXcgQ29sb3IoIDB4MDAwMDAwICk7CgkJdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IDEuMDsKCQl0aGlzLmVtaXNzaXZlTWFwID0gbnVsbDsKCgkJdGhpcy5idW1wTWFwID0gbnVsbDsKCQl0aGlzLmJ1bXBTY2FsZSA9IDE7CgoJCXRoaXMubm9ybWFsTWFwID0gbnVsbDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBUYW5nZW50U3BhY2VOb3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKCQl0aGlzLnJvdWdobmVzc01hcCA9IG51bGw7CgoJCXRoaXMubWV0YWxuZXNzTWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZW52TWFwID0gbnVsbDsKCQl0aGlzLmVudk1hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLnNraW5uaW5nID0gZmFsc2U7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBmYWxzZTsKCQl0aGlzLm1vcnBoTm9ybWFscyA9IGZhbHNlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCglNZXNoU3RhbmRhcmRNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNYXRlcmlhbC5wcm90b3R5cGUgKTsKCU1lc2hTdGFuZGFyZE1hdGVyaWFsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1lc2hTdGFuZGFyZE1hdGVyaWFsOwoKCU1lc2hTdGFuZGFyZE1hdGVyaWFsLnByb3RvdHlwZS5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID0gdHJ1ZTsKCglNZXNoU3RhbmRhcmRNYXRlcmlhbC5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlNYXRlcmlhbC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5kZWZpbmVzID0geyAnU1RBTkRBUkQnOiAnJyB9OwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoJCXRoaXMucm91Z2huZXNzID0gc291cmNlLnJvdWdobmVzczsKCQl0aGlzLm1ldGFsbmVzcyA9IHNvdXJjZS5tZXRhbG5lc3M7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuZW1pc3NpdmUuY29weSggc291cmNlLmVtaXNzaXZlICk7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IHNvdXJjZS5lbWlzc2l2ZU1hcDsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQl0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKCQl0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CgoJCXRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBzb3VyY2Uubm9ybWFsTWFwVHlwZTsKCQl0aGlzLm5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5ub3JtYWxTY2FsZSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCgkJdGhpcy5yb3VnaG5lc3NNYXAgPSBzb3VyY2Uucm91Z2huZXNzTWFwOwoKCQl0aGlzLm1ldGFsbmVzc01hcCA9IHNvdXJjZS5tZXRhbG5lc3NNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmVudk1hcEludGVuc2l0eSA9IHNvdXJjZS5lbnZNYXBJbnRlbnNpdHk7CgoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gc291cmNlLnJlZnJhY3Rpb25SYXRpbzsKCgkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwoKCQl0aGlzLnNraW5uaW5nID0gc291cmNlLnNraW5uaW5nOwoJCXRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKCQl0aGlzLm1vcnBoTm9ybWFscyA9IHNvdXJjZS5tb3JwaE5vcm1hbHM7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIHJlZmxlY3Rpdml0eTogPGZsb2F0PgoJICogIGNsZWFyQ29hdDogPGZsb2F0PgoJICogIGNsZWFyQ29hdFJvdWdobmVzczogPGZsb2F0PgoJICogfQoJICovCgoJZnVuY3Rpb24gTWVzaFBoeXNpY2FsTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1lc2hTdGFuZGFyZE1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy5kZWZpbmVzID0geyAnUEhZU0lDQUwnOiAnJyB9OwoKCQl0aGlzLnR5cGUgPSAnTWVzaFBoeXNpY2FsTWF0ZXJpYWwnOwoKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IDAuNTsgLy8gbWFwcyB0byBGMCA9IDAuMDQKCgkJdGhpcy5jbGVhckNvYXQgPSAwLjA7CgkJdGhpcy5jbGVhckNvYXRSb3VnaG5lc3MgPSAwLjA7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCU1lc2hQaHlzaWNhbE1hdGVyaWFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE1lc2hTdGFuZGFyZE1hdGVyaWFsLnByb3RvdHlwZSApOwoJTWVzaFBoeXNpY2FsTWF0ZXJpYWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTWVzaFBoeXNpY2FsTWF0ZXJpYWw7CgoJTWVzaFBoeXNpY2FsTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaFBoeXNpY2FsTWF0ZXJpYWwgPSB0cnVlOwoKCU1lc2hQaHlzaWNhbE1hdGVyaWFsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCU1lc2hTdGFuZGFyZE1hdGVyaWFsLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdQSFlTSUNBTCc6ICcnIH07CgoJCXRoaXMucmVmbGVjdGl2aXR5ID0gc291cmNlLnJlZmxlY3Rpdml0eTsKCgkJdGhpcy5jbGVhckNvYXQgPSBzb3VyY2UuY2xlYXJDb2F0OwoJCXRoaXMuY2xlYXJDb2F0Um91Z2huZXNzID0gc291cmNlLmNsZWFyQ29hdFJvdWdobmVzczsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICoKCSAqIHBhcmFtZXRlcnMgPSB7CgkgKiAgY29sb3I6IDxoZXg+LAoJICogIHNwZWN1bGFyOiA8aGV4PiwKCSAqICBzaGluaW5lc3M6IDxmbG9hdD4sCgkgKiAgb3BhY2l0eTogPGZsb2F0PiwKCSAqCgkgKiAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBsaWdodE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBsaWdodE1hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBhb01hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBhb01hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBlbWlzc2l2ZTogPGhleD4sCgkgKiAgZW1pc3NpdmVJbnRlbnNpdHk6IDxmbG9hdD4KCSAqICBlbWlzc2l2ZU1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYnVtcE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBidW1wU2NhbGU6IDxmbG9hdD4sCgkgKgoJICogIG5vcm1hbE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBub3JtYWxNYXBUeXBlOiBUSFJFRS5UYW5nZW50U3BhY2VOb3JtYWxNYXAsCgkgKiAgbm9ybWFsU2NhbGU6IDxWZWN0b3IyPiwKCSAqCgkgKiAgZGlzcGxhY2VtZW50TWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICogIGRpc3BsYWNlbWVudFNjYWxlOiA8ZmxvYXQ+LAoJICogIGRpc3BsYWNlbWVudEJpYXM6IDxmbG9hdD4sCgkgKgoJICogIHNwZWN1bGFyTWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBhbHBoYU1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgZW52TWFwOiBuZXcgVEhSRUUuQ3ViZVRleHR1cmUoIFtwb3N4LCBuZWd4LCBwb3N5LCBuZWd5LCBwb3N6LCBuZWd6XSApLAoJICogIGNvbWJpbmU6IFRIUkVFLk11bHRpcGx5LAoJICogIHJlZmxlY3Rpdml0eTogPGZsb2F0PiwKCSAqICByZWZyYWN0aW9uUmF0aW86IDxmbG9hdD4sCgkgKgoJICogIHdpcmVmcmFtZTogPGJvb2xlYW4+LAoJICogIHdpcmVmcmFtZUxpbmV3aWR0aDogPGZsb2F0PiwKCSAqCgkgKiAgc2tpbm5pbmc6IDxib29sPiwKCSAqICBtb3JwaFRhcmdldHM6IDxib29sPiwKCSAqICBtb3JwaE5vcm1hbHM6IDxib29sPgoJICogfQoJICovCgoJZnVuY3Rpb24gTWVzaFBob25nTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ01lc2hQaG9uZ01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZGlmZnVzZQoJCXRoaXMuc3BlY3VsYXIgPSBuZXcgQ29sb3IoIDB4MTExMTExICk7CgkJdGhpcy5zaGluaW5lc3MgPSAzMDsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmVtaXNzaXZlID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CgkJdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJdGhpcy5za2lubmluZyA9IGZhbHNlOwoJCXRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJTWVzaFBob25nTWF0ZXJpYWwucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTWF0ZXJpYWwucHJvdG90eXBlICk7CglNZXNoUGhvbmdNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoUGhvbmdNYXRlcmlhbDsKCglNZXNoUGhvbmdNYXRlcmlhbC5wcm90b3R5cGUuaXNNZXNoUGhvbmdNYXRlcmlhbCA9IHRydWU7CgoJTWVzaFBob25nTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgkJdGhpcy5zcGVjdWxhci5jb3B5KCBzb3VyY2Uuc3BlY3VsYXIgKTsKCQl0aGlzLnNoaW5pbmVzcyA9IHNvdXJjZS5zaGluaW5lc3M7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuZW1pc3NpdmUuY29weSggc291cmNlLmVtaXNzaXZlICk7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IHNvdXJjZS5lbWlzc2l2ZU1hcDsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQl0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKCQl0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CgoJCXRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBzb3VyY2Uubm9ybWFsTWFwVHlwZTsKCQl0aGlzLm5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5ub3JtYWxTY2FsZSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IHNvdXJjZS5zcGVjdWxhck1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCXRoaXMuY29tYmluZSA9IHNvdXJjZS5jb21iaW5lOwoJCXRoaXMucmVmbGVjdGl2aXR5ID0gc291cmNlLnJlZmxlY3Rpdml0eTsKCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9IHNvdXJjZS53aXJlZnJhbWVMaW5lam9pbjsKCgkJdGhpcy5za2lubmluZyA9IHNvdXJjZS5za2lubmluZzsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCS8qKgoJICogQGF1dGhvciB0YWthaGlyb3ggLyBodHRwOi8vZ2l0aHViLmNvbS90YWthaGlyb3gKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGdyYWRpZW50TWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApCgkgKiB9CgkgKi8KCglmdW5jdGlvbiBNZXNoVG9vbk1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQlNZXNoUGhvbmdNYXRlcmlhbC5jYWxsKCB0aGlzICk7CgoJCXRoaXMuZGVmaW5lcyA9IHsgJ1RPT04nOiAnJyB9OwoKCQl0aGlzLnR5cGUgPSAnTWVzaFRvb25NYXRlcmlhbCc7CgoJCXRoaXMuZ3JhZGllbnRNYXAgPSBudWxsOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCglNZXNoVG9vbk1hdGVyaWFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE1lc2hQaG9uZ01hdGVyaWFsLnByb3RvdHlwZSApOwoJTWVzaFRvb25NYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoVG9vbk1hdGVyaWFsOwoKCU1lc2hUb29uTWF0ZXJpYWwucHJvdG90eXBlLmlzTWVzaFRvb25NYXRlcmlhbCA9IHRydWU7CgoJTWVzaFRvb25NYXRlcmlhbC5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlNZXNoUGhvbmdNYXRlcmlhbC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5ncmFkaWVudE1hcCA9IHNvdXJjZS5ncmFkaWVudE1hcDsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIG9wYWNpdHk6IDxmbG9hdD4sCgkgKgoJICogIGJ1bXBNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgYnVtcFNjYWxlOiA8ZmxvYXQ+LAoJICoKCSAqICBub3JtYWxNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKiAgbm9ybWFsTWFwVHlwZTogVEhSRUUuVGFuZ2VudFNwYWNlTm9ybWFsTWFwLAoJICogIG5vcm1hbFNjYWxlOiA8VmVjdG9yMj4sCgkgKgoJICogIGRpc3BsYWNlbWVudE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBkaXNwbGFjZW1lbnRTY2FsZTogPGZsb2F0PiwKCSAqICBkaXNwbGFjZW1lbnRCaWFzOiA8ZmxvYXQ+LAoJICoKCSAqICB3aXJlZnJhbWU6IDxib29sZWFuPiwKCSAqICB3aXJlZnJhbWVMaW5ld2lkdGg6IDxmbG9hdD4KCSAqCgkgKiAgc2tpbm5pbmc6IDxib29sPiwKCSAqICBtb3JwaFRhcmdldHM6IDxib29sPiwKCSAqICBtb3JwaE5vcm1hbHM6IDxib29sPgoJICogfQoJICovCgoJZnVuY3Rpb24gTWVzaE5vcm1hbE1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQlNYXRlcmlhbC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdNZXNoTm9ybWFsTWF0ZXJpYWwnOwoKCQl0aGlzLmJ1bXBNYXAgPSBudWxsOwoJCXRoaXMuYnVtcFNjYWxlID0gMTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBudWxsOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoKCQl0aGlzLmZvZyA9IGZhbHNlOwoJCXRoaXMubGlnaHRzID0gZmFsc2U7CgoJCXRoaXMuc2tpbm5pbmcgPSBmYWxzZTsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwoJCXRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCU1lc2hOb3JtYWxNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNYXRlcmlhbC5wcm90b3R5cGUgKTsKCU1lc2hOb3JtYWxNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoTm9ybWFsTWF0ZXJpYWw7CgoJTWVzaE5vcm1hbE1hdGVyaWFsLnByb3RvdHlwZS5pc01lc2hOb3JtYWxNYXRlcmlhbCA9IHRydWU7CgoJTWVzaE5vcm1hbE1hdGVyaWFsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCU1hdGVyaWFsLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKCQl0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CgoJCXRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBzb3VyY2Uubm9ybWFsTWFwVHlwZTsKCQl0aGlzLm5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5ub3JtYWxTY2FsZSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCgkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCgkJdGhpcy5za2lubmluZyA9IHNvdXJjZS5za2lubmluZzsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IHNvdXJjZS5tb3JwaFRhcmdldHM7CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBzb3VyY2UubW9ycGhOb3JtYWxzOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqICBjb2xvcjogPGhleD4sCgkgKiAgb3BhY2l0eTogPGZsb2F0PiwKCSAqCgkgKiAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBsaWdodE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBsaWdodE1hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBhb01hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBhb01hcEludGVuc2l0eTogPGZsb2F0PgoJICoKCSAqICBlbWlzc2l2ZTogPGhleD4sCgkgKiAgZW1pc3NpdmVJbnRlbnNpdHk6IDxmbG9hdD4KCSAqICBlbWlzc2l2ZU1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgc3BlY3VsYXJNYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIGFscGhhTWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBlbnZNYXA6IG5ldyBUSFJFRS5DdWJlVGV4dHVyZSggW3Bvc3gsIG5lZ3gsIHBvc3ksIG5lZ3ksIHBvc3osIG5lZ3pdICksCgkgKiAgY29tYmluZTogVEhSRUUuTXVsdGlwbHksCgkgKiAgcmVmbGVjdGl2aXR5OiA8ZmxvYXQ+LAoJICogIHJlZnJhY3Rpb25SYXRpbzogPGZsb2F0PiwKCSAqCgkgKiAgd2lyZWZyYW1lOiA8Ym9vbGVhbj4sCgkgKiAgd2lyZWZyYW1lTGluZXdpZHRoOiA8ZmxvYXQ+LAoJICoKCSAqICBza2lubmluZzogPGJvb2w+LAoJICogIG1vcnBoVGFyZ2V0czogPGJvb2w+LAoJICogIG1vcnBoTm9ybWFsczogPGJvb2w+CgkgKiB9CgkgKi8KCglmdW5jdGlvbiBNZXNoTGFtYmVydE1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQlNYXRlcmlhbC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdNZXNoTGFtYmVydE1hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZGlmZnVzZQoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMubGlnaHRNYXAgPSBudWxsOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMuYW9NYXAgPSBudWxsOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMuZW1pc3NpdmUgPSBuZXcgQ29sb3IoIDB4MDAwMDAwICk7CgkJdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IDEuMDsKCQl0aGlzLmVtaXNzaXZlTWFwID0gbnVsbDsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CgkJdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJdGhpcy5za2lubmluZyA9IGZhbHNlOwoJCXRoaXMubW9ycGhUYXJnZXRzID0gZmFsc2U7CgkJdGhpcy5tb3JwaE5vcm1hbHMgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJTWVzaExhbWJlcnRNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNYXRlcmlhbC5wcm90b3R5cGUgKTsKCU1lc2hMYW1iZXJ0TWF0ZXJpYWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTWVzaExhbWJlcnRNYXRlcmlhbDsKCglNZXNoTGFtYmVydE1hdGVyaWFsLnByb3RvdHlwZS5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgPSB0cnVlOwoKCU1lc2hMYW1iZXJ0TWF0ZXJpYWwucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuZW1pc3NpdmUuY29weSggc291cmNlLmVtaXNzaXZlICk7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IHNvdXJjZS5lbWlzc2l2ZU1hcDsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQl0aGlzLnNwZWN1bGFyTWFwID0gc291cmNlLnNwZWN1bGFyTWFwOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLmVudk1hcCA9IHNvdXJjZS5lbnZNYXA7CgkJdGhpcy5jb21iaW5lID0gc291cmNlLmNvbWJpbmU7CgkJdGhpcy5yZWZsZWN0aXZpdHkgPSBzb3VyY2UucmVmbGVjdGl2aXR5OwoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gc291cmNlLnJlZnJhY3Rpb25SYXRpbzsKCgkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwoKCQl0aGlzLnNraW5uaW5nID0gc291cmNlLnNraW5uaW5nOwoJCXRoaXMubW9ycGhUYXJnZXRzID0gc291cmNlLm1vcnBoVGFyZ2V0czsKCQl0aGlzLm1vcnBoTm9ybWFscyA9IHNvdXJjZS5tb3JwaE5vcm1hbHM7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBwYXJhbWV0ZXJzID0gewoJICogIGNvbG9yOiA8aGV4PiwKCSAqICBvcGFjaXR5OiA8ZmxvYXQ+LAoJICoKCSAqICBtYXRjYXA6IG5ldyBUSFJFRS5UZXh0dXJlKCA8SW1hZ2U+ICksCgkgKgoJICogIG1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqCgkgKiAgYnVtcE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBidW1wU2NhbGU6IDxmbG9hdD4sCgkgKgoJICogIG5vcm1hbE1hcDogbmV3IFRIUkVFLlRleHR1cmUoIDxJbWFnZT4gKSwKCSAqICBub3JtYWxNYXBUeXBlOiBUSFJFRS5UYW5nZW50U3BhY2VOb3JtYWxNYXAsCgkgKiAgbm9ybWFsU2NhbGU6IDxWZWN0b3IyPiwKCSAqCgkgKiAgZGlzcGxhY2VtZW50TWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICogIGRpc3BsYWNlbWVudFNjYWxlOiA8ZmxvYXQ+LAoJICogIGRpc3BsYWNlbWVudEJpYXM6IDxmbG9hdD4sCgkgKgoJICogIGFscGhhTWFwOiBuZXcgVEhSRUUuVGV4dHVyZSggPEltYWdlPiApLAoJICoKCSAqICBza2lubmluZzogPGJvb2w+LAoJICogIG1vcnBoVGFyZ2V0czogPGJvb2w+LAoJICogIG1vcnBoTm9ybWFsczogPGJvb2w+CgkgKiB9CgkgKi8KCglmdW5jdGlvbiBNZXNoTWF0Y2FwTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCU1hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy5kZWZpbmVzID0geyAnTUFUQ0FQJzogJycgfTsKCgkJdGhpcy50eXBlID0gJ01lc2hNYXRjYXBNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7IC8vIGRpZmZ1c2UKCgkJdGhpcy5tYXRjYXAgPSBudWxsOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuc2tpbm5pbmcgPSBmYWxzZTsKCQl0aGlzLm1vcnBoVGFyZ2V0cyA9IGZhbHNlOwoJCXRoaXMubW9ycGhOb3JtYWxzID0gZmFsc2U7CgoJCXRoaXMubGlnaHRzID0gZmFsc2U7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCU1lc2hNYXRjYXBNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNYXRlcmlhbC5wcm90b3R5cGUgKTsKCU1lc2hNYXRjYXBNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBNZXNoTWF0Y2FwTWF0ZXJpYWw7CgoJTWVzaE1hdGNhcE1hdGVyaWFsLnByb3RvdHlwZS5pc01lc2hNYXRjYXBNYXRlcmlhbCA9IHRydWU7CgoJTWVzaE1hdGNhcE1hdGVyaWFsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCU1hdGVyaWFsLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdNQVRDQVAnOiAnJyB9OwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLm1hdGNhcCA9IHNvdXJjZS5tYXRjYXA7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5idW1wTWFwID0gc291cmNlLmJ1bXBNYXA7CgkJdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwoKCQl0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CgkJdGhpcy5ub3JtYWxTY2FsZS5jb3B5KCBzb3VyY2Uubm9ybWFsU2NhbGUgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuc2tpbm5pbmcgPSBzb3VyY2Uuc2tpbm5pbmc7CgkJdGhpcy5tb3JwaFRhcmdldHMgPSBzb3VyY2UubW9ycGhUYXJnZXRzOwoJCXRoaXMubW9ycGhOb3JtYWxzID0gc291cmNlLm1vcnBoTm9ybWFsczsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKgoJICogcGFyYW1ldGVycyA9IHsKCSAqICBjb2xvcjogPGhleD4sCgkgKiAgb3BhY2l0eTogPGZsb2F0PiwKCSAqCgkgKiAgbGluZXdpZHRoOiA8ZmxvYXQ+LAoJICoKCSAqICBzY2FsZTogPGZsb2F0PiwKCSAqICBkYXNoU2l6ZTogPGZsb2F0PiwKCSAqICBnYXBTaXplOiA8ZmxvYXQ+CgkgKiB9CgkgKi8KCglmdW5jdGlvbiBMaW5lRGFzaGVkTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCUxpbmVCYXNpY01hdGVyaWFsLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0xpbmVEYXNoZWRNYXRlcmlhbCc7CgoJCXRoaXMuc2NhbGUgPSAxOwoJCXRoaXMuZGFzaFNpemUgPSAzOwoJCXRoaXMuZ2FwU2l6ZSA9IDE7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCUxpbmVEYXNoZWRNYXRlcmlhbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMaW5lQmFzaWNNYXRlcmlhbC5wcm90b3R5cGUgKTsKCUxpbmVEYXNoZWRNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMaW5lRGFzaGVkTWF0ZXJpYWw7CgoJTGluZURhc2hlZE1hdGVyaWFsLnByb3RvdHlwZS5pc0xpbmVEYXNoZWRNYXRlcmlhbCA9IHRydWU7CgoJTGluZURhc2hlZE1hdGVyaWFsLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCUxpbmVCYXNpY01hdGVyaWFsLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLnNjYWxlID0gc291cmNlLnNjYWxlOwoJCXRoaXMuZGFzaFNpemUgPSBzb3VyY2UuZGFzaFNpemU7CgkJdGhpcy5nYXBTaXplID0gc291cmNlLmdhcFNpemU7CgoJCXJldHVybiB0aGlzOwoKCX07CgoKCgl2YXIgTWF0ZXJpYWxzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewoJCVNoYWRvd01hdGVyaWFsOiBTaGFkb3dNYXRlcmlhbCwKCQlTcHJpdGVNYXRlcmlhbDogU3ByaXRlTWF0ZXJpYWwsCgkJUmF3U2hhZGVyTWF0ZXJpYWw6IFJhd1NoYWRlck1hdGVyaWFsLAoJCVNoYWRlck1hdGVyaWFsOiBTaGFkZXJNYXRlcmlhbCwKCQlQb2ludHNNYXRlcmlhbDogUG9pbnRzTWF0ZXJpYWwsCgkJTWVzaFBoeXNpY2FsTWF0ZXJpYWw6IE1lc2hQaHlzaWNhbE1hdGVyaWFsLAoJCU1lc2hTdGFuZGFyZE1hdGVyaWFsOiBNZXNoU3RhbmRhcmRNYXRlcmlhbCwKCQlNZXNoUGhvbmdNYXRlcmlhbDogTWVzaFBob25nTWF0ZXJpYWwsCgkJTWVzaFRvb25NYXRlcmlhbDogTWVzaFRvb25NYXRlcmlhbCwKCQlNZXNoTm9ybWFsTWF0ZXJpYWw6IE1lc2hOb3JtYWxNYXRlcmlhbCwKCQlNZXNoTGFtYmVydE1hdGVyaWFsOiBNZXNoTGFtYmVydE1hdGVyaWFsLAoJCU1lc2hEZXB0aE1hdGVyaWFsOiBNZXNoRGVwdGhNYXRlcmlhbCwKCQlNZXNoRGlzdGFuY2VNYXRlcmlhbDogTWVzaERpc3RhbmNlTWF0ZXJpYWwsCgkJTWVzaEJhc2ljTWF0ZXJpYWw6IE1lc2hCYXNpY01hdGVyaWFsLAoJCU1lc2hNYXRjYXBNYXRlcmlhbDogTWVzaE1hdGNhcE1hdGVyaWFsLAoJCUxpbmVEYXNoZWRNYXRlcmlhbDogTGluZURhc2hlZE1hdGVyaWFsLAoJCUxpbmVCYXNpY01hdGVyaWFsOiBMaW5lQmFzaWNNYXRlcmlhbCwKCQlNYXRlcmlhbDogTWF0ZXJpYWwKCX0pOwoKCS8qKgoJICogQGF1dGhvciB0c2NodwoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICovCgoJdmFyIEFuaW1hdGlvblV0aWxzID0gewoKCQkvLyBzYW1lIGFzIEFycmF5LnByb3RvdHlwZS5zbGljZSwgYnV0IGFsc28gd29ya3Mgb24gdHlwZWQgYXJyYXlzCgkJYXJyYXlTbGljZTogZnVuY3Rpb24gKCBhcnJheSwgZnJvbSwgdG8gKSB7CgoJCQlpZiAoIEFuaW1hdGlvblV0aWxzLmlzVHlwZWRBcnJheSggYXJyYXkgKSApIHsKCgkJCQkvLyBpbiBpb3M5IGFycmF5LnN1YmFycmF5KGZyb20sIHVuZGVmaW5lZCkgd2lsbCByZXR1cm4gZW1wdHkgYXJyYXkKCQkJCS8vIGJ1dCBhcnJheS5zdWJhcnJheShmcm9tKSBvciBhcnJheS5zdWJhcnJheShmcm9tLCBsZW4pIGlzIGNvcnJlY3QKCQkJCXJldHVybiBuZXcgYXJyYXkuY29uc3RydWN0b3IoIGFycmF5LnN1YmFycmF5KCBmcm9tLCB0byAhPT0gdW5kZWZpbmVkID8gdG8gOiBhcnJheS5sZW5ndGggKSApOwoKCQkJfQoKCQkJcmV0dXJuIGFycmF5LnNsaWNlKCBmcm9tLCB0byApOwoKCQl9LAoKCQkvLyBjb252ZXJ0cyBhbiBhcnJheSB0byBhIHNwZWNpZmljIHR5cGUKCQljb252ZXJ0QXJyYXk6IGZ1bmN0aW9uICggYXJyYXksIHR5cGUsIGZvcmNlQ2xvbmUgKSB7CgoJCQlpZiAoICEgYXJyYXkgfHwgLy8gbGV0ICd1bmRlZmluZWQnIGFuZCAnbnVsbCcgcGFzcwoJCQkJISBmb3JjZUNsb25lICYmIGFycmF5LmNvbnN0cnVjdG9yID09PSB0eXBlICkgcmV0dXJuIGFycmF5OwoKCQkJaWYgKCB0eXBlb2YgdHlwZS5CWVRFU19QRVJfRUxFTUVOVCA9PT0gJ251bWJlcicgKSB7CgoJCQkJcmV0dXJuIG5ldyB0eXBlKCBhcnJheSApOyAvLyBjcmVhdGUgdHlwZWQgYXJyYXkKCgkJCX0KCgkJCXJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJyYXkgKTsgLy8gY3JlYXRlIEFycmF5CgoJCX0sCgoJCWlzVHlwZWRBcnJheTogZnVuY3Rpb24gKCBvYmplY3QgKSB7CgoJCQlyZXR1cm4gQXJyYXlCdWZmZXIuaXNWaWV3KCBvYmplY3QgKSAmJgoJCQkJISAoIG9iamVjdCBpbnN0YW5jZW9mIERhdGFWaWV3ICk7CgoJCX0sCgoJCS8vIHJldHVybnMgYW4gYXJyYXkgYnkgd2hpY2ggdGltZXMgYW5kIHZhbHVlcyBjYW4gYmUgc29ydGVkCgkJZ2V0S2V5ZnJhbWVPcmRlcjogZnVuY3Rpb24gKCB0aW1lcyApIHsKCgkJCWZ1bmN0aW9uIGNvbXBhcmVUaW1lKCBpLCBqICkgewoKCQkJCXJldHVybiB0aW1lc1sgaSBdIC0gdGltZXNbIGogXTsKCgkJCX0KCgkJCXZhciBuID0gdGltZXMubGVuZ3RoOwoJCQl2YXIgcmVzdWx0ID0gbmV3IEFycmF5KCBuICk7CgkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gbjsgKysgaSApIHJlc3VsdFsgaSBdID0gaTsKCgkJCXJlc3VsdC5zb3J0KCBjb21wYXJlVGltZSApOwoKCQkJcmV0dXJuIHJlc3VsdDsKCgkJfSwKCgkJLy8gdXNlcyB0aGUgYXJyYXkgcHJldmlvdXNseSByZXR1cm5lZCBieSAnZ2V0S2V5ZnJhbWVPcmRlcicgdG8gc29ydCBkYXRhCgkJc29ydGVkQXJyYXk6IGZ1bmN0aW9uICggdmFsdWVzLCBzdHJpZGUsIG9yZGVyICkgewoKCQkJdmFyIG5WYWx1ZXMgPSB2YWx1ZXMubGVuZ3RoOwoJCQl2YXIgcmVzdWx0ID0gbmV3IHZhbHVlcy5jb25zdHJ1Y3RvciggblZhbHVlcyApOwoKCQkJZm9yICggdmFyIGkgPSAwLCBkc3RPZmZzZXQgPSAwOyBkc3RPZmZzZXQgIT09IG5WYWx1ZXM7ICsrIGkgKSB7CgoJCQkJdmFyIHNyY09mZnNldCA9IG9yZGVyWyBpIF0gKiBzdHJpZGU7CgoJCQkJZm9yICggdmFyIGogPSAwOyBqICE9PSBzdHJpZGU7ICsrIGogKSB7CgoJCQkJCXJlc3VsdFsgZHN0T2Zmc2V0ICsrIF0gPSB2YWx1ZXNbIHNyY09mZnNldCArIGogXTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0OwoKCQl9LAoKCQkvLyBmdW5jdGlvbiBmb3IgcGFyc2luZyBBT1Mga2V5ZnJhbWUgZm9ybWF0cwoJCWZsYXR0ZW5KU09OOiBmdW5jdGlvbiAoIGpzb25LZXlzLCB0aW1lcywgdmFsdWVzLCB2YWx1ZVByb3BlcnR5TmFtZSApIHsKCgkJCXZhciBpID0gMSwga2V5ID0ganNvbktleXNbIDAgXTsKCgkJCXdoaWxlICgga2V5ICE9PSB1bmRlZmluZWQgJiYga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJa2V5ID0ganNvbktleXNbIGkgKysgXTsKCgkJCX0KCgkJCWlmICgga2V5ID09PSB1bmRlZmluZWQgKSByZXR1cm47IC8vIG5vIGRhdGEKCgkJCXZhciB2YWx1ZSA9IGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXTsKCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOyAvLyBubyBkYXRhCgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgoJCQkJZG8gewoKCQkJCQl2YWx1ZSA9IGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXTsKCgkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJdGltZXMucHVzaCgga2V5LnRpbWUgKTsKCQkJCQkJdmFsdWVzLnB1c2guYXBwbHkoIHZhbHVlcywgdmFsdWUgKTsgLy8gcHVzaCBhbGwgZWxlbWVudHMKCgkJCQkJfQoKCQkJCQlrZXkgPSBqc29uS2V5c1sgaSArKyBdOwoKCQkJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCQkJfSBlbHNlIGlmICggdmFsdWUudG9BcnJheSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIC4uLmFzc3VtZSBUSFJFRS5NYXRoLWlzaAoKCQkJCWRvIHsKCgkJCQkJdmFsdWUgPSBrZXlbIHZhbHVlUHJvcGVydHlOYW1lIF07CgoJCQkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXRpbWVzLnB1c2goIGtleS50aW1lICk7CgkJCQkJCXZhbHVlLnRvQXJyYXkoIHZhbHVlcywgdmFsdWVzLmxlbmd0aCApOwoKCQkJCQl9CgoJCQkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCQkJfSB3aGlsZSAoIGtleSAhPT0gdW5kZWZpbmVkICk7CgoJCQl9IGVsc2UgewoKCQkJCS8vIG90aGVyd2lzZSBwdXNoIGFzLWlzCgoJCQkJZG8gewoKCQkJCQl2YWx1ZSA9IGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXTsKCgkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJdGltZXMucHVzaCgga2V5LnRpbWUgKTsKCQkJCQkJdmFsdWVzLnB1c2goIHZhbHVlICk7CgoJCQkJCX0KCgkJCQkJa2V5ID0ganNvbktleXNbIGkgKysgXTsKCgkJCQl9IHdoaWxlICgga2V5ICE9PSB1bmRlZmluZWQgKTsKCgkJCX0KCgkJfQoKCX07CgoJLyoqCgkgKiBBYnN0cmFjdCBiYXNlIGNsYXNzIG9mIGludGVycG9sYW50cyBvdmVyIHBhcmFtZXRyaWMgc2FtcGxlcy4KCSAqCgkgKiBUaGUgcGFyYW1ldGVyIGRvbWFpbiBpcyBvbmUgZGltZW5zaW9uYWwsIHR5cGljYWxseSB0aGUgdGltZSBvciBhIHBhdGgKCSAqIGFsb25nIGEgY3VydmUgZGVmaW5lZCBieSB0aGUgZGF0YS4KCSAqCgkgKiBUaGUgc2FtcGxlIHZhbHVlcyBjYW4gaGF2ZSBhbnkgZGltZW5zaW9uYWxpdHkgYW5kIGRlcml2ZWQgY2xhc3NlcyBtYXkKCSAqIGFwcGx5IHNwZWNpYWwgaW50ZXJwcmV0YXRpb25zIHRvIHRoZSBkYXRhLgoJICoKCSAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgdGhlIGludGVydmFsIHNlZWsgaW4gYSBUZW1wbGF0ZSBNZXRob2QsIGRlZmVycmluZwoJICogdGhlIGFjdHVhbCBpbnRlcnBvbGF0aW9uIHRvIGRlcml2ZWQgY2xhc3Nlcy4KCSAqCgkgKiBUaW1lIGNvbXBsZXhpdHkgaXMgTygxKSBmb3IgbGluZWFyIGFjY2VzcyBjcm9zc2luZyBhdCBtb3N0IHR3byBwb2ludHMKCSAqIGFuZCBPKGxvZyBOKSBmb3IgcmFuZG9tIGFjY2Vzcywgd2hlcmUgTiBpcyB0aGUgbnVtYmVyIG9mIHBvc2l0aW9ucy4KCSAqCgkgKiBSZWZlcmVuY2VzOgoJICoKCSAqIAkJaHR0cDovL3d3dy5vb2Rlc2lnbi5jb20vdGVtcGxhdGUtbWV0aG9kLXBhdHRlcm4uaHRtbAoJICoKCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIEludGVycG9sYW50KCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQl0aGlzLnBhcmFtZXRlclBvc2l0aW9ucyA9IHBhcmFtZXRlclBvc2l0aW9uczsKCQl0aGlzLl9jYWNoZWRJbmRleCA9IDA7CgoJCXRoaXMucmVzdWx0QnVmZmVyID0gcmVzdWx0QnVmZmVyICE9PSB1bmRlZmluZWQgPwoJCQlyZXN1bHRCdWZmZXIgOiBuZXcgc2FtcGxlVmFsdWVzLmNvbnN0cnVjdG9yKCBzYW1wbGVTaXplICk7CgkJdGhpcy5zYW1wbGVWYWx1ZXMgPSBzYW1wbGVWYWx1ZXM7CgkJdGhpcy52YWx1ZVNpemUgPSBzYW1wbGVTaXplOwoKCX0KCglPYmplY3QuYXNzaWduKCBJbnRlcnBvbGFudC5wcm90b3R5cGUsIHsKCgkJZXZhbHVhdGU6IGZ1bmN0aW9uICggdCApIHsKCgkJCXZhciBwcCA9IHRoaXMucGFyYW1ldGVyUG9zaXRpb25zLAoJCQkJaTEgPSB0aGlzLl9jYWNoZWRJbmRleCwKCgkJCQl0MSA9IHBwWyBpMSBdLAoJCQkJdDAgPSBwcFsgaTEgLSAxIF07CgoJCQl2YWxpZGF0ZV9pbnRlcnZhbDogewoKCQkJCXNlZWs6IHsKCgkJCQkJdmFyIHJpZ2h0OwoKCQkJCQlsaW5lYXJfc2NhbjogewoKCQkJCQkJLy8tIFNlZSBodHRwOi8vanNwZXJmLmNvbS9jb21wYXJpc29uLXRvLXVuZGVmaW5lZC8zCgkJCQkJCS8vLSBzbG93ZXIgY29kZToKCQkJCQkJLy8tCgkJCQkJCS8vLSAJCQkJaWYgKCB0ID49IHQxIHx8IHQxID09PSB1bmRlZmluZWQgKSB7CgkJCQkJCWZvcndhcmRfc2NhbjogaWYgKCAhICggdCA8IHQxICkgKSB7CgoJCQkJCQkJZm9yICggdmFyIGdpdmVVcEF0ID0gaTEgKyAyOyA7ICkgewoKCQkJCQkJCQlpZiAoIHQxID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCQlpZiAoIHQgPCB0MCApIGJyZWFrIGZvcndhcmRfc2NhbjsKCgkJCQkJCQkJCS8vIGFmdGVyIGVuZAoKCQkJCQkJCQkJaTEgPSBwcC5sZW5ndGg7CgkJCQkJCQkJCXRoaXMuX2NhY2hlZEluZGV4ID0gaTE7CgkJCQkJCQkJCXJldHVybiB0aGlzLmFmdGVyRW5kXyggaTEgLSAxLCB0LCB0MCApOwoKCQkJCQkJCQl9CgoJCQkJCQkJCWlmICggaTEgPT09IGdpdmVVcEF0ICkgYnJlYWs7IC8vIHRoaXMgbG9vcAoKCQkJCQkJCQl0MCA9IHQxOwoJCQkJCQkJCXQxID0gcHBbICsrIGkxIF07CgoJCQkJCQkJCWlmICggdCA8IHQxICkgewoKCQkJCQkJCQkJLy8gd2UgaGF2ZSBhcnJpdmVkIGF0IHRoZSBzb3VnaHQgaW50ZXJ2YWwKCQkJCQkJCQkJYnJlYWsgc2VlazsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCQkvLyBwcmVwYXJlIGJpbmFyeSBzZWFyY2ggb24gdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIGluZGV4CgkJCQkJCQlyaWdodCA9IHBwLmxlbmd0aDsKCQkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQkJfQoKCQkJCQkJLy8tIHNsb3dlciBjb2RlOgoJCQkJCQkvLy0JCQkJCWlmICggdCA8IHQwIHx8IHQwID09PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggISAoIHQgPj0gdDAgKSApIHsKCgkJCQkJCQkvLyBsb29waW5nPwoKCQkJCQkJCXZhciB0MWdsb2JhbCA9IHBwWyAxIF07CgoJCQkJCQkJaWYgKCB0IDwgdDFnbG9iYWwgKSB7CgoJCQkJCQkJCWkxID0gMjsgLy8gKyAxLCB1c2luZyB0aGUgc2NhbiBmb3IgdGhlIGRldGFpbHMKCQkJCQkJCQl0MCA9IHQxZ2xvYmFsOwoKCQkJCQkJCX0KCgkJCQkJCQkvLyBsaW5lYXIgcmV2ZXJzZSBzY2FuCgoJCQkJCQkJZm9yICggdmFyIGdpdmVVcEF0ID0gaTEgLSAyOyA7ICkgewoKCQkJCQkJCQlpZiAoIHQwID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCQkvLyBiZWZvcmUgc3RhcnQKCgkJCQkJCQkJCXRoaXMuX2NhY2hlZEluZGV4ID0gMDsKCQkJCQkJCQkJcmV0dXJuIHRoaXMuYmVmb3JlU3RhcnRfKCAwLCB0LCB0MSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJCWlmICggaTEgPT09IGdpdmVVcEF0ICkgYnJlYWs7IC8vIHRoaXMgbG9vcAoKCQkJCQkJCQl0MSA9IHQwOwoJCQkJCQkJCXQwID0gcHBbIC0tIGkxIC0gMSBdOwoKCQkJCQkJCQlpZiAoIHQgPj0gdDAgKSB7CgoJCQkJCQkJCQkvLyB3ZSBoYXZlIGFycml2ZWQgYXQgdGhlIHNvdWdodCBpbnRlcnZhbAoJCQkJCQkJCQlicmVhayBzZWVrOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJCS8vIHByZXBhcmUgYmluYXJ5IHNlYXJjaCBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBpbmRleAoJCQkJCQkJcmlnaHQgPSBpMTsKCQkJCQkJCWkxID0gMDsKCQkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQkJfQoKCQkJCQkJLy8gdGhlIGludGVydmFsIGlzIHZhbGlkCgoJCQkJCQlicmVhayB2YWxpZGF0ZV9pbnRlcnZhbDsKCgkJCQkJfSAvLyBsaW5lYXIgc2NhbgoKCQkJCQkvLyBiaW5hcnkgc2VhcmNoCgoJCQkJCXdoaWxlICggaTEgPCByaWdodCApIHsKCgkJCQkJCXZhciBtaWQgPSAoIGkxICsgcmlnaHQgKSA+Pj4gMTsKCgkJCQkJCWlmICggdCA8IHBwWyBtaWQgXSApIHsKCgkJCQkJCQlyaWdodCA9IG1pZDsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaTEgPSBtaWQgKyAxOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXQxID0gcHBbIGkxIF07CgkJCQkJdDAgPSBwcFsgaTEgLSAxIF07CgoJCQkJCS8vIGNoZWNrIGJvdW5kYXJ5IGNhc2VzLCBhZ2FpbgoKCQkJCQlpZiAoIHQwID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl0aGlzLl9jYWNoZWRJbmRleCA9IDA7CgkJCQkJCXJldHVybiB0aGlzLmJlZm9yZVN0YXJ0XyggMCwgdCwgdDEgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIHQxID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlpMSA9IHBwLmxlbmd0aDsKCQkJCQkJdGhpcy5fY2FjaGVkSW5kZXggPSBpMTsKCQkJCQkJcmV0dXJuIHRoaXMuYWZ0ZXJFbmRfKCBpMSAtIDEsIHQwLCB0ICk7CgoJCQkJCX0KCgkJCQl9IC8vIHNlZWsKCgkJCQl0aGlzLl9jYWNoZWRJbmRleCA9IGkxOwoKCQkJCXRoaXMuaW50ZXJ2YWxDaGFuZ2VkXyggaTEsIHQwLCB0MSApOwoKCQkJfSAvLyB2YWxpZGF0ZV9pbnRlcnZhbAoKCQkJcmV0dXJuIHRoaXMuaW50ZXJwb2xhdGVfKCBpMSwgdDAsIHQsIHQxICk7CgoJCX0sCgoJCXNldHRpbmdzOiBudWxsLCAvLyBvcHRpb25hbCwgc3ViY2xhc3Mtc3BlY2lmaWMgc2V0dGluZ3Mgc3RydWN0dXJlCgkJLy8gTm90ZTogVGhlIGluZGlyZWN0aW9uIGFsbG93cyBjZW50cmFsIGNvbnRyb2wgb2YgbWFueSBpbnRlcnBvbGFudHMuCgoJCS8vIC0tLSBQcm90ZWN0ZWQgaW50ZXJmYWNlCgoJCURlZmF1bHRTZXR0aW5nc186IHt9LAoKCQlnZXRTZXR0aW5nc186IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnNldHRpbmdzIHx8IHRoaXMuRGVmYXVsdFNldHRpbmdzXzsKCgkJfSwKCgkJY29weVNhbXBsZVZhbHVlXzogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCS8vIGNvcGllcyBhIHNhbXBsZSB2YWx1ZSB0byB0aGUgcmVzdWx0IGJ1ZmZlcgoKCQkJdmFyIHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLAoJCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJCW9mZnNldCA9IGluZGV4ICogc3RyaWRlOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQkJcmVzdWx0WyBpIF0gPSB2YWx1ZXNbIG9mZnNldCArIGkgXTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0sCgoJCS8vIFRlbXBsYXRlIG1ldGhvZHMgZm9yIGRlcml2ZWQgY2xhc3NlczoKCgkJaW50ZXJwb2xhdGVfOiBmdW5jdGlvbiAoIC8qIGkxLCB0MCwgdCwgdDEgKi8gKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdjYWxsIHRvIGFic3RyYWN0IG1ldGhvZCcgKTsKCQkJLy8gaW1wbGVtZW50YXRpb25zIHNoYWxsIHJldHVybiB0aGlzLnJlc3VsdEJ1ZmZlcgoKCQl9LAoKCQlpbnRlcnZhbENoYW5nZWRfOiBmdW5jdGlvbiAoIC8qIGkxLCB0MCwgdDEgKi8gKSB7CgoJCQkvLyBlbXB0eQoKCQl9CgoJfSApOwoKCS8vIVwgREVDTEFSRSBBTElBUyBBRlRFUiBhc3NpZ24gcHJvdG90eXBlICEKCU9iamVjdC5hc3NpZ24oIEludGVycG9sYW50LnByb3RvdHlwZSwgewoKCQkvLyggMCwgdCwgdDAgKSwgcmV0dXJucyB0aGlzLnJlc3VsdEJ1ZmZlcgoJCWJlZm9yZVN0YXJ0XzogSW50ZXJwb2xhbnQucHJvdG90eXBlLmNvcHlTYW1wbGVWYWx1ZV8sCgoJCS8vKCBOLTEsIHROLTEsIHQgKSwgcmV0dXJucyB0aGlzLnJlc3VsdEJ1ZmZlcgoJCWFmdGVyRW5kXzogSW50ZXJwb2xhbnQucHJvdG90eXBlLmNvcHlTYW1wbGVWYWx1ZV8sCgoJfSApOwoKCS8qKgoJICogRmFzdCBhbmQgc2ltcGxlIGN1YmljIHNwbGluZSBpbnRlcnBvbGFudC4KCSAqCgkgKiBJdCB3YXMgZGVyaXZlZCBmcm9tIGEgSGVybWl0aWFuIGNvbnN0cnVjdGlvbiBzZXR0aW5nIHRoZSBmaXJzdCBkZXJpdmF0aXZlCgkgKiBhdCBlYWNoIHNhbXBsZSBwb3NpdGlvbiB0byB0aGUgbGluZWFyIHNsb3BlIGJldHdlZW4gbmVpZ2hib3JpbmcgcG9zaXRpb25zCgkgKiBvdmVyIHRoZWlyIHBhcmFtZXRlciBpbnRlcnZhbC4KCSAqCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBDdWJpY0ludGVycG9sYW50KCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlJbnRlcnBvbGFudC5jYWxsKCB0aGlzLCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICk7CgoJCXRoaXMuX3dlaWdodFByZXYgPSAtIDA7CgkJdGhpcy5fb2Zmc2V0UHJldiA9IC0gMDsKCQl0aGlzLl93ZWlnaHROZXh0ID0gLSAwOwoJCXRoaXMuX29mZnNldE5leHQgPSAtIDA7CgoJfQoKCUN1YmljSW50ZXJwb2xhbnQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggSW50ZXJwb2xhbnQucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IEN1YmljSW50ZXJwb2xhbnQsCgoJCURlZmF1bHRTZXR0aW5nc186IHsKCgkJCWVuZGluZ1N0YXJ0OiBaZXJvQ3VydmF0dXJlRW5kaW5nLAoJCQllbmRpbmdFbmQ6IFplcm9DdXJ2YXR1cmVFbmRpbmcKCgkJfSwKCgkJaW50ZXJ2YWxDaGFuZ2VkXzogZnVuY3Rpb24gKCBpMSwgdDAsIHQxICkgewoKCQkJdmFyIHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnMsCgkJCQlpUHJldiA9IGkxIC0gMiwKCQkJCWlOZXh0ID0gaTEgKyAxLAoKCQkJCXRQcmV2ID0gcHBbIGlQcmV2IF0sCgkJCQl0TmV4dCA9IHBwWyBpTmV4dCBdOwoKCQkJaWYgKCB0UHJldiA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXN3aXRjaCAoIHRoaXMuZ2V0U2V0dGluZ3NfKCkuZW5kaW5nU3RhcnQgKSB7CgoJCQkJCWNhc2UgWmVyb1Nsb3BlRW5kaW5nOgoKCQkJCQkJLy8gZicodDApID0gMAoJCQkJCQlpUHJldiA9IGkxOwoJCQkJCQl0UHJldiA9IDIgKiB0MCAtIHQxOwoKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJCS8vIHVzZSB0aGUgb3RoZXIgZW5kIG9mIHRoZSBjdXJ2ZQoJCQkJCQlpUHJldiA9IHBwLmxlbmd0aCAtIDI7CgkJCQkJCXRQcmV2ID0gdDAgKyBwcFsgaVByZXYgXSAtIHBwWyBpUHJldiArIDEgXTsKCgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OiAvLyBaZXJvQ3VydmF0dXJlRW5kaW5nCgoJCQkJCQkvLyBmJycodDApID0gMCBhLmsuYS4gTmF0dXJhbCBTcGxpbmUKCQkJCQkJaVByZXYgPSBpMTsKCQkJCQkJdFByZXYgPSB0MTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHROZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc3dpdGNoICggdGhpcy5nZXRTZXR0aW5nc18oKS5lbmRpbmdFbmQgKSB7CgoJCQkJCWNhc2UgWmVyb1Nsb3BlRW5kaW5nOgoKCQkJCQkJLy8gZicodE4pID0gMAoJCQkJCQlpTmV4dCA9IGkxOwoJCQkJCQl0TmV4dCA9IDIgKiB0MSAtIHQwOwoKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJCS8vIHVzZSB0aGUgb3RoZXIgZW5kIG9mIHRoZSBjdXJ2ZQoJCQkJCQlpTmV4dCA9IDE7CgkJCQkJCXROZXh0ID0gdDEgKyBwcFsgMSBdIC0gcHBbIDAgXTsKCgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OiAvLyBaZXJvQ3VydmF0dXJlRW5kaW5nCgoJCQkJCQkvLyBmJycodE4pID0gMCwgYS5rLmEuIE5hdHVyYWwgU3BsaW5lCgkJCQkJCWlOZXh0ID0gaTEgLSAxOwoJCQkJCQl0TmV4dCA9IHQwOwoKCQkJCX0KCgkJCX0KCgkJCXZhciBoYWxmRHQgPSAoIHQxIC0gdDAgKSAqIDAuNSwKCQkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplOwoKCQkJdGhpcy5fd2VpZ2h0UHJldiA9IGhhbGZEdCAvICggdDAgLSB0UHJldiApOwoJCQl0aGlzLl93ZWlnaHROZXh0ID0gaGFsZkR0IC8gKCB0TmV4dCAtIHQxICk7CgkJCXRoaXMuX29mZnNldFByZXYgPSBpUHJldiAqIHN0cmlkZTsKCQkJdGhpcy5fb2Zmc2V0TmV4dCA9IGlOZXh0ICogc3RyaWRlOwoKCQl9LAoKCQlpbnRlcnBvbGF0ZV86IGZ1bmN0aW9uICggaTEsIHQwLCB0LCB0MSApIHsKCgkJCXZhciByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwKCQkJCXZhbHVlcyA9IHRoaXMuc2FtcGxlVmFsdWVzLAoJCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgoJCQkJbzEgPSBpMSAqIHN0cmlkZSwJCW8wID0gbzEgLSBzdHJpZGUsCgkJCQlvUCA9IHRoaXMuX29mZnNldFByZXYsIAlvTiA9IHRoaXMuX29mZnNldE5leHQsCgkJCQl3UCA9IHRoaXMuX3dlaWdodFByZXYsCXdOID0gdGhpcy5fd2VpZ2h0TmV4dCwKCgkJCQlwID0gKCB0IC0gdDAgKSAvICggdDEgLSB0MCApLAoJCQkJcHAgPSBwICogcCwKCQkJCXBwcCA9IHBwICogcDsKCgkJCS8vIGV2YWx1YXRlIHBvbHlub21pYWxzCgoJCQl2YXIgc1AgPSAtIHdQICogcHBwICsgMiAqIHdQICogcHAgLSB3UCAqIHA7CgkJCXZhciBzMCA9ICggMSArIHdQICkgKiBwcHAgKyAoIC0gMS41IC0gMiAqIHdQICkgKiBwcCArICggLSAwLjUgKyB3UCApICogcCArIDE7CgkJCXZhciBzMSA9ICggLSAxIC0gd04gKSAqIHBwcCArICggMS41ICsgd04gKSAqIHBwICsgMC41ICogcDsKCQkJdmFyIHNOID0gd04gKiBwcHAgLSB3TiAqIHBwOwoKCQkJLy8gY29tYmluZSBkYXRhIGxpbmVhcmx5CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCQlyZXN1bHRbIGkgXSA9CgkJCQkJCXNQICogdmFsdWVzWyBvUCArIGkgXSArCgkJCQkJCXMwICogdmFsdWVzWyBvMCArIGkgXSArCgkJCQkJCXMxICogdmFsdWVzWyBvMSArIGkgXSArCgkJCQkJCXNOICogdmFsdWVzWyBvTiArIGkgXTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBMaW5lYXJJbnRlcnBvbGFudCggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApIHsKCgkJSW50ZXJwb2xhbnQuY2FsbCggdGhpcywgcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCX0KCglMaW5lYXJJbnRlcnBvbGFudC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBJbnRlcnBvbGFudC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogTGluZWFySW50ZXJwb2xhbnQsCgoJCWludGVycG9sYXRlXzogZnVuY3Rpb24gKCBpMSwgdDAsIHQsIHQxICkgewoKCQkJdmFyIHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLAoJCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCgkJCQlvZmZzZXQxID0gaTEgKiBzdHJpZGUsCgkJCQlvZmZzZXQwID0gb2Zmc2V0MSAtIHN0cmlkZSwKCgkJCQl3ZWlnaHQxID0gKCB0IC0gdDAgKSAvICggdDEgLSB0MCApLAoJCQkJd2VpZ2h0MCA9IDEgLSB3ZWlnaHQxOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQkJcmVzdWx0WyBpIF0gPQoJCQkJCQl2YWx1ZXNbIG9mZnNldDAgKyBpIF0gKiB3ZWlnaHQwICsKCQkJCQkJdmFsdWVzWyBvZmZzZXQxICsgaSBdICogd2VpZ2h0MTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogSW50ZXJwb2xhbnQgdGhhdCBldmFsdWF0ZXMgdG8gdGhlIHNhbXBsZSB2YWx1ZSBhdCB0aGUgcG9zaXRpb24gcHJlY2VlZGluZwoJICogdGhlIHBhcmFtZXRlci4KCSAqCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBEaXNjcmV0ZUludGVycG9sYW50KCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlJbnRlcnBvbGFudC5jYWxsKCB0aGlzLCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICk7CgoJfQoKCURpc2NyZXRlSW50ZXJwb2xhbnQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggSW50ZXJwb2xhbnQucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IERpc2NyZXRlSW50ZXJwb2xhbnQsCgoJCWludGVycG9sYXRlXzogZnVuY3Rpb24gKCBpMSAvKiwgdDAsIHQsIHQxICovICkgewoKCQkJcmV0dXJuIHRoaXMuY29weVNhbXBsZVZhbHVlXyggaTEgLSAxICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogQSB0aW1lZCBzZXF1ZW5jZSBvZiBrZXlmcmFtZXMgZm9yIGEgc3BlY2lmaWMgcHJvcGVydHkuCgkgKgoJICoKCSAqIEBhdXRob3IgQmVuIEhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8vCgkgKiBAYXV0aG9yIERhdmlkIFNhcm5vIC8gaHR0cDovL2xpZ2h0aGF1cy51cy8KCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIEtleWZyYW1lVHJhY2soIG5hbWUsIHRpbWVzLCB2YWx1ZXMsIGludGVycG9sYXRpb24gKSB7CgoJCWlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogdHJhY2sgbmFtZSBpcyB1bmRlZmluZWQnICk7CgkJaWYgKCB0aW1lcyA9PT0gdW5kZWZpbmVkIHx8IHRpbWVzLmxlbmd0aCA9PT0gMCApIHRocm93IG5ldyBFcnJvciggJ1RIUkVFLktleWZyYW1lVHJhY2s6IG5vIGtleWZyYW1lcyBpbiB0cmFjayBuYW1lZCAnICsgbmFtZSApOwoKCQl0aGlzLm5hbWUgPSBuYW1lOwoKCQl0aGlzLnRpbWVzID0gQW5pbWF0aW9uVXRpbHMuY29udmVydEFycmF5KCB0aW1lcywgdGhpcy5UaW1lQnVmZmVyVHlwZSApOwoJCXRoaXMudmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuY29udmVydEFycmF5KCB2YWx1ZXMsIHRoaXMuVmFsdWVCdWZmZXJUeXBlICk7CgoJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggaW50ZXJwb2xhdGlvbiB8fCB0aGlzLkRlZmF1bHRJbnRlcnBvbGF0aW9uICk7CgoJfQoKCS8vIFN0YXRpYyBtZXRob2RzCgoJT2JqZWN0LmFzc2lnbiggS2V5ZnJhbWVUcmFjaywgewoKCQkvLyBTZXJpYWxpemF0aW9uIChpbiBzdGF0aWMgY29udGV4dCwgYmVjYXVzZSBvZiBjb25zdHJ1Y3RvciBpbnZvY2F0aW9uCgkJLy8gYW5kIGF1dG9tYXRpYyBpbnZvY2F0aW9uIG9mIC50b0pTT04pOgoKCQl0b0pTT046IGZ1bmN0aW9uICggdHJhY2sgKSB7CgoJCQl2YXIgdHJhY2tUeXBlID0gdHJhY2suY29uc3RydWN0b3I7CgoJCQl2YXIganNvbjsKCgkJCS8vIGRlcml2ZWQgY2xhc3NlcyBjYW4gZGVmaW5lIGEgc3RhdGljIHRvSlNPTiBtZXRob2QKCQkJaWYgKCB0cmFja1R5cGUudG9KU09OICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJanNvbiA9IHRyYWNrVHlwZS50b0pTT04oIHRyYWNrICk7CgoJCQl9IGVsc2UgewoKCQkJCS8vIGJ5IGRlZmF1bHQsIHdlIGFzc3VtZSB0aGUgZGF0YSBjYW4gYmUgc2VyaWFsaXplZCBhcy1pcwoJCQkJanNvbiA9IHsKCgkJCQkJJ25hbWUnOiB0cmFjay5uYW1lLAoJCQkJCSd0aW1lcyc6IEFuaW1hdGlvblV0aWxzLmNvbnZlcnRBcnJheSggdHJhY2sudGltZXMsIEFycmF5ICksCgkJCQkJJ3ZhbHVlcyc6IEFuaW1hdGlvblV0aWxzLmNvbnZlcnRBcnJheSggdHJhY2sudmFsdWVzLCBBcnJheSApCgoJCQkJfTsKCgkJCQl2YXIgaW50ZXJwb2xhdGlvbiA9IHRyYWNrLmdldEludGVycG9sYXRpb24oKTsKCgkJCQlpZiAoIGludGVycG9sYXRpb24gIT09IHRyYWNrLkRlZmF1bHRJbnRlcnBvbGF0aW9uICkgewoKCQkJCQlqc29uLmludGVycG9sYXRpb24gPSBpbnRlcnBvbGF0aW9uOwoKCQkJCX0KCgkJCX0KCgkJCWpzb24udHlwZSA9IHRyYWNrLlZhbHVlVHlwZU5hbWU7IC8vIG1hbmRhdG9yeQoKCQkJcmV0dXJuIGpzb247CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUsIHsKCgkJY29uc3RydWN0b3I6IEtleWZyYW1lVHJhY2ssCgoJCVRpbWVCdWZmZXJUeXBlOiBGbG9hdDMyQXJyYXksCgoJCVZhbHVlQnVmZmVyVHlwZTogRmxvYXQzMkFycmF5LAoKCQlEZWZhdWx0SW50ZXJwb2xhdGlvbjogSW50ZXJwb2xhdGVMaW5lYXIsCgoJCUludGVycG9sYW50RmFjdG9yeU1ldGhvZERpc2NyZXRlOiBmdW5jdGlvbiAoIHJlc3VsdCApIHsKCgkJCXJldHVybiBuZXcgRGlzY3JldGVJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCQl9LAoKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6IGZ1bmN0aW9uICggcmVzdWx0ICkgewoKCQkJcmV0dXJuIG5ldyBMaW5lYXJJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCQl9LAoKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGg6IGZ1bmN0aW9uICggcmVzdWx0ICkgewoKCQkJcmV0dXJuIG5ldyBDdWJpY0ludGVycG9sYW50KCB0aGlzLnRpbWVzLCB0aGlzLnZhbHVlcywgdGhpcy5nZXRWYWx1ZVNpemUoKSwgcmVzdWx0ICk7CgoJCX0sCgoJCXNldEludGVycG9sYXRpb246IGZ1bmN0aW9uICggaW50ZXJwb2xhdGlvbiApIHsKCgkJCXZhciBmYWN0b3J5TWV0aG9kOwoKCQkJc3dpdGNoICggaW50ZXJwb2xhdGlvbiApIHsKCgkJCQljYXNlIEludGVycG9sYXRlRGlzY3JldGU6CgoJCQkJCWZhY3RvcnlNZXRob2QgPSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZERpc2NyZXRlOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIEludGVycG9sYXRlTGluZWFyOgoKCQkJCQlmYWN0b3J5TWV0aG9kID0gdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgSW50ZXJwb2xhdGVTbW9vdGg6CgoJCQkJCWZhY3RvcnlNZXRob2QgPSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aDsKCgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlpZiAoIGZhY3RvcnlNZXRob2QgPT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgbWVzc2FnZSA9ICJ1bnN1cHBvcnRlZCBpbnRlcnBvbGF0aW9uIGZvciAiICsKCQkJCQl0aGlzLlZhbHVlVHlwZU5hbWUgKyAiIGtleWZyYW1lIHRyYWNrIG5hbWVkICIgKyB0aGlzLm5hbWU7CgoJCQkJaWYgKCB0aGlzLmNyZWF0ZUludGVycG9sYW50ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCS8vIGZhbGwgYmFjayB0byBkZWZhdWx0LCB1bmxlc3MgdGhlIGRlZmF1bHQgaXRzZWxmIGlzIG1lc3NlZCB1cAoJCQkJCWlmICggaW50ZXJwb2xhdGlvbiAhPT0gdGhpcy5EZWZhdWx0SW50ZXJwb2xhdGlvbiApIHsKCgkJCQkJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggdGhpcy5EZWZhdWx0SW50ZXJwb2xhdGlvbiApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCBtZXNzYWdlICk7IC8vIGZhdGFsLCBpbiB0aGlzIGNhc2UKCgkJCQkJfQoKCQkJCX0KCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5LZXlmcmFtZVRyYWNrOicsIG1lc3NhZ2UgKTsKCQkJCXJldHVybiB0aGlzOwoKCQkJfQoKCQkJdGhpcy5jcmVhdGVJbnRlcnBvbGFudCA9IGZhY3RvcnlNZXRob2Q7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0SW50ZXJwb2xhdGlvbjogZnVuY3Rpb24gKCkgewoKCQkJc3dpdGNoICggdGhpcy5jcmVhdGVJbnRlcnBvbGFudCApIHsKCgkJCQljYXNlIHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kRGlzY3JldGU6CgoJCQkJCXJldHVybiBJbnRlcnBvbGF0ZURpc2NyZXRlOwoKCQkJCWNhc2UgdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6CgoJCQkJCXJldHVybiBJbnRlcnBvbGF0ZUxpbmVhcjsKCgkJCQljYXNlIHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoOgoKCQkJCQlyZXR1cm4gSW50ZXJwb2xhdGVTbW9vdGg7CgoJCQl9CgoJCX0sCgoJCWdldFZhbHVlU2l6ZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMudmFsdWVzLmxlbmd0aCAvIHRoaXMudGltZXMubGVuZ3RoOwoKCQl9LAoKCQkvLyBtb3ZlIGFsbCBrZXlmcmFtZXMgZWl0aGVyIGZvcndhcmRzIG9yIGJhY2t3YXJkcyBpbiB0aW1lCgkJc2hpZnQ6IGZ1bmN0aW9uICggdGltZU9mZnNldCApIHsKCgkJCWlmICggdGltZU9mZnNldCAhPT0gMC4wICkgewoKCQkJCXZhciB0aW1lcyA9IHRoaXMudGltZXM7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gdGltZXMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQl0aW1lc1sgaSBdICs9IHRpbWVPZmZzZXQ7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCS8vIHNjYWxlIGFsbCBrZXlmcmFtZSB0aW1lcyBieSBhIGZhY3RvciAodXNlZnVsIGZvciBmcmFtZSA8LT4gc2Vjb25kcyBjb252ZXJzaW9ucykKCQlzY2FsZTogZnVuY3Rpb24gKCB0aW1lU2NhbGUgKSB7CgoJCQlpZiAoIHRpbWVTY2FsZSAhPT0gMS4wICkgewoKCQkJCXZhciB0aW1lcyA9IHRoaXMudGltZXM7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gdGltZXMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQl0aW1lc1sgaSBdICo9IHRpbWVTY2FsZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJLy8gcmVtb3ZlcyBrZXlmcmFtZXMgYmVmb3JlIGFuZCBhZnRlciBhbmltYXRpb24gd2l0aG91dCBjaGFuZ2luZyBhbnkgdmFsdWVzIHdpdGhpbiB0aGUgcmFuZ2UgW3N0YXJ0VGltZSwgZW5kVGltZV0uCgkJLy8gSU1QT1JUQU5UOiBXZSBkbyBub3Qgc2hpZnQgYXJvdW5kIGtleXMgdG8gdGhlIHN0YXJ0IG9mIHRoZSB0cmFjayB0aW1lLCBiZWNhdXNlIGZvciBpbnRlcnBvbGF0ZWQga2V5cyB0aGlzIHdpbGwgY2hhbmdlIHRoZWlyIHZhbHVlcwoJCXRyaW06IGZ1bmN0aW9uICggc3RhcnRUaW1lLCBlbmRUaW1lICkgewoKCQkJdmFyIHRpbWVzID0gdGhpcy50aW1lcywKCQkJCW5LZXlzID0gdGltZXMubGVuZ3RoLAoJCQkJZnJvbSA9IDAsCgkJCQl0byA9IG5LZXlzIC0gMTsKCgkJCXdoaWxlICggZnJvbSAhPT0gbktleXMgJiYgdGltZXNbIGZyb20gXSA8IHN0YXJ0VGltZSApIHsKCgkJCQkrKyBmcm9tOwoKCQkJfQoKCQkJd2hpbGUgKCB0byAhPT0gLSAxICYmIHRpbWVzWyB0byBdID4gZW5kVGltZSApIHsKCgkJCQktLSB0bzsKCgkJCX0KCgkJCSsrIHRvOyAvLyBpbmNsdXNpdmUgLT4gZXhjbHVzaXZlIGJvdW5kCgoJCQlpZiAoIGZyb20gIT09IDAgfHwgdG8gIT09IG5LZXlzICkgewoKCQkJCS8vIGVtcHR5IHRyYWNrcyBhcmUgZm9yYmlkZGVuLCBzbyBrZWVwIGF0IGxlYXN0IG9uZSBrZXlmcmFtZQoJCQkJaWYgKCBmcm9tID49IHRvICkgdG8gPSBNYXRoLm1heCggdG8sIDEgKSwgZnJvbSA9IHRvIC0gMTsKCgkJCQl2YXIgc3RyaWRlID0gdGhpcy5nZXRWYWx1ZVNpemUoKTsKCQkJCXRoaXMudGltZXMgPSBBbmltYXRpb25VdGlscy5hcnJheVNsaWNlKCB0aW1lcywgZnJvbSwgdG8gKTsKCQkJCXRoaXMudmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSggdGhpcy52YWx1ZXMsIGZyb20gKiBzdHJpZGUsIHRvICogc3RyaWRlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJLy8gZW5zdXJlIHdlIGRvIG5vdCBnZXQgYSBHYXJiYWdlSW5HYXJiYWdlT3V0IHNpdHVhdGlvbiwgbWFrZSBzdXJlIHRyYWNrcyBhcmUgYXQgbGVhc3QgbWluaW1hbGx5IHZpYWJsZQoJCXZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmFsaWQgPSB0cnVlOwoKCQkJdmFyIHZhbHVlU2l6ZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CgkJCWlmICggdmFsdWVTaXplIC0gTWF0aC5mbG9vciggdmFsdWVTaXplICkgIT09IDAgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLktleWZyYW1lVHJhY2s6IEludmFsaWQgdmFsdWUgc2l6ZSBpbiB0cmFjay4nLCB0aGlzICk7CgkJCQl2YWxpZCA9IGZhbHNlOwoKCQkJfQoKCQkJdmFyIHRpbWVzID0gdGhpcy50aW1lcywKCQkJCXZhbHVlcyA9IHRoaXMudmFsdWVzLAoKCQkJCW5LZXlzID0gdGltZXMubGVuZ3RoOwoKCQkJaWYgKCBuS2V5cyA9PT0gMCApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogVHJhY2sgaXMgZW1wdHkuJywgdGhpcyApOwoJCQkJdmFsaWQgPSBmYWxzZTsKCgkJCX0KCgkJCXZhciBwcmV2VGltZSA9IG51bGw7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgIT09IG5LZXlzOyBpICsrICkgewoKCQkJCXZhciBjdXJyVGltZSA9IHRpbWVzWyBpIF07CgoJCQkJaWYgKCB0eXBlb2YgY3VyclRpbWUgPT09ICdudW1iZXInICYmIGlzTmFOKCBjdXJyVGltZSApICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogVGltZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuJywgdGhpcywgaSwgY3VyclRpbWUgKTsKCQkJCQl2YWxpZCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoKCQkJCX0KCgkJCQlpZiAoIHByZXZUaW1lICE9PSBudWxsICYmIHByZXZUaW1lID4gY3VyclRpbWUgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBPdXQgb2Ygb3JkZXIga2V5cy4nLCB0aGlzLCBpLCBjdXJyVGltZSwgcHJldlRpbWUgKTsKCQkJCQl2YWxpZCA9IGZhbHNlOwoJCQkJCWJyZWFrOwoKCQkJCX0KCgkJCQlwcmV2VGltZSA9IGN1cnJUaW1lOwoKCQkJfQoKCQkJaWYgKCB2YWx1ZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlpZiAoIEFuaW1hdGlvblV0aWxzLmlzVHlwZWRBcnJheSggdmFsdWVzICkgKSB7CgoJCQkJCWZvciAoIHZhciBpID0gMCwgbiA9IHZhbHVlcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJCQl2YXIgdmFsdWUgPSB2YWx1ZXNbIGkgXTsKCgkJCQkJCWlmICggaXNOYU4oIHZhbHVlICkgKSB7CgoJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLktleWZyYW1lVHJhY2s6IFZhbHVlIGlzIG5vdCBhIHZhbGlkIG51bWJlci4nLCB0aGlzLCBpLCB2YWx1ZSApOwoJCQkJCQkJdmFsaWQgPSBmYWxzZTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHZhbGlkOwoKCQl9LAoKCQkvLyByZW1vdmVzIGVxdWl2YWxlbnQgc2VxdWVudGlhbCBrZXlzIGFzIGNvbW1vbiBpbiBtb3JwaCB0YXJnZXQgc2VxdWVuY2VzCgkJLy8gKDAsMCwwLDAsMSwxLDEsMCwwLDAsMCwwLDAsMCkgLS0+ICgwLDAsMSwxLDAsMCkKCQlvcHRpbWl6ZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHRpbWVzID0gdGhpcy50aW1lcywKCQkJCXZhbHVlcyA9IHRoaXMudmFsdWVzLAoJCQkJc3RyaWRlID0gdGhpcy5nZXRWYWx1ZVNpemUoKSwKCgkJCQlzbW9vdGhJbnRlcnBvbGF0aW9uID0gdGhpcy5nZXRJbnRlcnBvbGF0aW9uKCkgPT09IEludGVycG9sYXRlU21vb3RoLAoKCQkJCXdyaXRlSW5kZXggPSAxLAoJCQkJbGFzdEluZGV4ID0gdGltZXMubGVuZ3RoIC0gMTsKCgkJCWZvciAoIHZhciBpID0gMTsgaSA8IGxhc3RJbmRleDsgKysgaSApIHsKCgkJCQl2YXIga2VlcCA9IGZhbHNlOwoKCQkJCXZhciB0aW1lID0gdGltZXNbIGkgXTsKCQkJCXZhciB0aW1lTmV4dCA9IHRpbWVzWyBpICsgMSBdOwoKCQkJCS8vIHJlbW92ZSBhZGphY2VudCBrZXlmcmFtZXMgc2NoZWR1bGVkIGF0IHRoZSBzYW1lIHRpbWUKCgkJCQlpZiAoIHRpbWUgIT09IHRpbWVOZXh0ICYmICggaSAhPT0gMSB8fCB0aW1lICE9PSB0aW1lWyAwIF0gKSApIHsKCgkJCQkJaWYgKCAhIHNtb290aEludGVycG9sYXRpb24gKSB7CgoJCQkJCQkvLyByZW1vdmUgdW5uZWNlc3Nhcnkga2V5ZnJhbWVzIHNhbWUgYXMgdGhlaXIgbmVpZ2hib3JzCgoJCQkJCQl2YXIgb2Zmc2V0ID0gaSAqIHN0cmlkZSwKCQkJCQkJCW9mZnNldFAgPSBvZmZzZXQgLSBzdHJpZGUsCgkJCQkJCQlvZmZzZXROID0gb2Zmc2V0ICsgc3RyaWRlOwoKCQkJCQkJZm9yICggdmFyIGogPSAwOyBqICE9PSBzdHJpZGU7ICsrIGogKSB7CgoJCQkJCQkJdmFyIHZhbHVlID0gdmFsdWVzWyBvZmZzZXQgKyBqIF07CgoJCQkJCQkJaWYgKCB2YWx1ZSAhPT0gdmFsdWVzWyBvZmZzZXRQICsgaiBdIHx8CgkJCQkJCQkJdmFsdWUgIT09IHZhbHVlc1sgb2Zmc2V0TiArIGogXSApIHsKCgkJCQkJCQkJa2VlcCA9IHRydWU7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJa2VlcCA9IHRydWU7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gaW4tcGxhY2UgY29tcGFjdGlvbgoKCQkJCWlmICgga2VlcCApIHsKCgkJCQkJaWYgKCBpICE9PSB3cml0ZUluZGV4ICkgewoKCQkJCQkJdGltZXNbIHdyaXRlSW5kZXggXSA9IHRpbWVzWyBpIF07CgoJCQkJCQl2YXIgcmVhZE9mZnNldCA9IGkgKiBzdHJpZGUsCgkJCQkJCQl3cml0ZU9mZnNldCA9IHdyaXRlSW5kZXggKiBzdHJpZGU7CgoJCQkJCQlmb3IgKCB2YXIgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQkJCQl2YWx1ZXNbIHdyaXRlT2Zmc2V0ICsgaiBdID0gdmFsdWVzWyByZWFkT2Zmc2V0ICsgaiBdOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCSsrIHdyaXRlSW5kZXg7CgoJCQkJfQoKCQkJfQoKCQkJLy8gZmx1c2ggbGFzdCBrZXlmcmFtZSAoY29tcGFjdGlvbiBsb29rcyBhaGVhZCkKCgkJCWlmICggbGFzdEluZGV4ID4gMCApIHsKCgkJCQl0aW1lc1sgd3JpdGVJbmRleCBdID0gdGltZXNbIGxhc3RJbmRleCBdOwoKCQkJCWZvciAoIHZhciByZWFkT2Zmc2V0ID0gbGFzdEluZGV4ICogc3RyaWRlLCB3cml0ZU9mZnNldCA9IHdyaXRlSW5kZXggKiBzdHJpZGUsIGogPSAwOyBqICE9PSBzdHJpZGU7ICsrIGogKSB7CgoJCQkJCXZhbHVlc1sgd3JpdGVPZmZzZXQgKyBqIF0gPSB2YWx1ZXNbIHJlYWRPZmZzZXQgKyBqIF07CgoJCQkJfQoKCQkJCSsrIHdyaXRlSW5kZXg7CgoJCQl9CgoJCQlpZiAoIHdyaXRlSW5kZXggIT09IHRpbWVzLmxlbmd0aCApIHsKCgkJCQl0aGlzLnRpbWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSggdGltZXMsIDAsIHdyaXRlSW5kZXggKTsKCQkJCXRoaXMudmFsdWVzID0gQW5pbWF0aW9uVXRpbHMuYXJyYXlTbGljZSggdmFsdWVzLCAwLCB3cml0ZUluZGV4ICogc3RyaWRlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB0aW1lcyA9IEFuaW1hdGlvblV0aWxzLmFycmF5U2xpY2UoIHRoaXMudGltZXMsIDAgKTsKCQkJdmFyIHZhbHVlcyA9IEFuaW1hdGlvblV0aWxzLmFycmF5U2xpY2UoIHRoaXMudmFsdWVzLCAwICk7CgoJCQl2YXIgVHlwZWRLZXlmcmFtZVRyYWNrID0gdGhpcy5jb25zdHJ1Y3RvcjsKCQkJdmFyIHRyYWNrID0gbmV3IFR5cGVkS2V5ZnJhbWVUcmFjayggdGhpcy5uYW1lLCB0aW1lcywgdmFsdWVzICk7CgoJCQkvLyBJbnRlcnBvbGFudCBhcmd1bWVudCB0byBjb25zdHJ1Y3RvciBpcyBub3Qgc2F2ZWQsIHNvIGNvcHkgdGhlIGZhY3RvcnkgbWV0aG9kIGRpcmVjdGx5LgoJCQl0cmFjay5jcmVhdGVJbnRlcnBvbGFudCA9IHRoaXMuY3JlYXRlSW50ZXJwb2xhbnQ7CgoJCQlyZXR1cm4gdHJhY2s7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogQSBUcmFjayBvZiBCb29sZWFuIGtleWZyYW1lIHZhbHVlcy4KCSAqCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICogQGF1dGhvciB0c2NodwoJICovCgoJZnVuY3Rpb24gQm9vbGVhbktleWZyYW1lVHJhY2soIG5hbWUsIHRpbWVzLCB2YWx1ZXMgKSB7CgoJCUtleWZyYW1lVHJhY2suY2FsbCggdGhpcywgbmFtZSwgdGltZXMsIHZhbHVlcyApOwoKCX0KCglCb29sZWFuS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBLZXlmcmFtZVRyYWNrLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBCb29sZWFuS2V5ZnJhbWVUcmFjaywKCgkJVmFsdWVUeXBlTmFtZTogJ2Jvb2wnLAoJCVZhbHVlQnVmZmVyVHlwZTogQXJyYXksCgoJCURlZmF1bHRJbnRlcnBvbGF0aW9uOiBJbnRlcnBvbGF0ZURpc2NyZXRlLAoKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6IHVuZGVmaW5lZCwKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGg6IHVuZGVmaW5lZAoKCQkvLyBOb3RlOiBBY3R1YWxseSB0aGlzIHRyYWNrIGNvdWxkIGhhdmUgYSBvcHRpbWl6ZWQgLyBjb21wcmVzc2VkCgkJLy8gcmVwcmVzZW50YXRpb24gb2YgYSBzaW5nbGUgdmFsdWUgYW5kIGEgY3VzdG9tIGludGVycG9sYW50IHRoYXQKCQkvLyBjb21wdXRlcyAiZmlyc3RWYWx1ZSBeIGlzT2RkKCBpbmRleCApIi4KCgl9ICk7CgoJLyoqCgkgKgoJICogQSBUcmFjayBvZiBrZXlmcmFtZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgY29sb3IuCgkgKgoJICoKCSAqIEBhdXRob3IgQmVuIEhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8vCgkgKiBAYXV0aG9yIERhdmlkIFNhcm5vIC8gaHR0cDovL2xpZ2h0aGF1cy51cy8KCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIENvbG9yS2V5ZnJhbWVUcmFjayggbmFtZSwgdGltZXMsIHZhbHVlcywgaW50ZXJwb2xhdGlvbiApIHsKCgkJS2V5ZnJhbWVUcmFjay5jYWxsKCB0aGlzLCBuYW1lLCB0aW1lcywgdmFsdWVzLCBpbnRlcnBvbGF0aW9uICk7CgoJfQoKCUNvbG9yS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBLZXlmcmFtZVRyYWNrLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBDb2xvcktleWZyYW1lVHJhY2ssCgoJCVZhbHVlVHlwZU5hbWU6ICdjb2xvcicKCgkJLy8gVmFsdWVCdWZmZXJUeXBlIGlzIGluaGVyaXRlZAoKCQkvLyBEZWZhdWx0SW50ZXJwb2xhdGlvbiBpcyBpbmhlcml0ZWQKCgkJLy8gTm90ZTogVmVyeSBiYXNpYyBpbXBsZW1lbnRhdGlvbiBhbmQgbm90aGluZyBzcGVjaWFsIHlldC4KCQkvLyBIb3dldmVyLCB0aGlzIGlzIHRoZSBwbGFjZSBmb3IgY29sb3Igc3BhY2UgcGFyYW1ldGVyaXphdGlvbi4KCgl9ICk7CgoJLyoqCgkgKgoJICogQSBUcmFjayBvZiBudW1lcmljIGtleWZyYW1lIHZhbHVlcy4KCSAqCgkgKiBAYXV0aG9yIEJlbiBIb3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvLwoJICogQGF1dGhvciBEYXZpZCBTYXJubyAvIGh0dHA6Ly9saWdodGhhdXMudXMvCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBOdW1iZXJLZXlmcmFtZVRyYWNrKCBuYW1lLCB0aW1lcywgdmFsdWVzLCBpbnRlcnBvbGF0aW9uICkgewoKCQlLZXlmcmFtZVRyYWNrLmNhbGwoIHRoaXMsIG5hbWUsIHRpbWVzLCB2YWx1ZXMsIGludGVycG9sYXRpb24gKTsKCgl9CgoJTnVtYmVyS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBLZXlmcmFtZVRyYWNrLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBOdW1iZXJLZXlmcmFtZVRyYWNrLAoKCQlWYWx1ZVR5cGVOYW1lOiAnbnVtYmVyJwoKCQkvLyBWYWx1ZUJ1ZmZlclR5cGUgaXMgaW5oZXJpdGVkCgoJCS8vIERlZmF1bHRJbnRlcnBvbGF0aW9uIGlzIGluaGVyaXRlZAoKCX0gKTsKCgkvKioKCSAqIFNwaGVyaWNhbCBsaW5lYXIgdW5pdCBxdWF0ZXJuaW9uIGludGVycG9sYW50LgoJICoKCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApIHsKCgkJSW50ZXJwb2xhbnQuY2FsbCggdGhpcywgcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCX0KCglRdWF0ZXJuaW9uTGluZWFySW50ZXJwb2xhbnQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggSW50ZXJwb2xhbnQucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCwKCgkJaW50ZXJwb2xhdGVfOiBmdW5jdGlvbiAoIGkxLCB0MCwgdCwgdDEgKSB7CgoJCQl2YXIgcmVzdWx0ID0gdGhpcy5yZXN1bHRCdWZmZXIsCgkJCQl2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlcywKCQkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJCW9mZnNldCA9IGkxICogc3RyaWRlLAoKCQkJCWFscGhhID0gKCB0IC0gdDAgKSAvICggdDEgLSB0MCApOwoKCQkJZm9yICggdmFyIGVuZCA9IG9mZnNldCArIHN0cmlkZTsgb2Zmc2V0ICE9PSBlbmQ7IG9mZnNldCArPSA0ICkgewoKCQkJCVF1YXRlcm5pb24uc2xlcnBGbGF0KCByZXN1bHQsIDAsIHZhbHVlcywgb2Zmc2V0IC0gc3RyaWRlLCB2YWx1ZXMsIG9mZnNldCwgYWxwaGEgKTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogQSBUcmFjayBvZiBxdWF0ZXJuaW9uIGtleWZyYW1lIHZhbHVlcy4KCSAqCgkgKiBAYXV0aG9yIEJlbiBIb3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvLwoJICogQGF1dGhvciBEYXZpZCBTYXJubyAvIGh0dHA6Ly9saWdodGhhdXMudXMvCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCglmdW5jdGlvbiBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjayggbmFtZSwgdGltZXMsIHZhbHVlcywgaW50ZXJwb2xhdGlvbiApIHsKCgkJS2V5ZnJhbWVUcmFjay5jYWxsKCB0aGlzLCBuYW1lLCB0aW1lcywgdmFsdWVzLCBpbnRlcnBvbGF0aW9uICk7CgoJfQoKCVF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIEtleWZyYW1lVHJhY2sucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLAoKCQlWYWx1ZVR5cGVOYW1lOiAncXVhdGVybmlvbicsCgoJCS8vIFZhbHVlQnVmZmVyVHlwZSBpcyBpbmhlcml0ZWQKCgkJRGVmYXVsdEludGVycG9sYXRpb246IEludGVycG9sYXRlTGluZWFyLAoKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6IGZ1bmN0aW9uICggcmVzdWx0ICkgewoKCQkJcmV0dXJuIG5ldyBRdWF0ZXJuaW9uTGluZWFySW50ZXJwb2xhbnQoIHRoaXMudGltZXMsIHRoaXMudmFsdWVzLCB0aGlzLmdldFZhbHVlU2l6ZSgpLCByZXN1bHQgKTsKCgkJfSwKCgkJSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoOiB1bmRlZmluZWQgLy8gbm90IHlldCBpbXBsZW1lbnRlZAoKCX0gKTsKCgkvKioKCSAqCgkgKiBBIFRyYWNrIHRoYXQgaW50ZXJwb2xhdGVzIFN0cmluZ3MKCSAqCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICogQGF1dGhvciB0c2NodwoJICovCgoJZnVuY3Rpb24gU3RyaW5nS2V5ZnJhbWVUcmFjayggbmFtZSwgdGltZXMsIHZhbHVlcywgaW50ZXJwb2xhdGlvbiApIHsKCgkJS2V5ZnJhbWVUcmFjay5jYWxsKCB0aGlzLCBuYW1lLCB0aW1lcywgdmFsdWVzLCBpbnRlcnBvbGF0aW9uICk7CgoJfQoKCVN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogU3RyaW5nS2V5ZnJhbWVUcmFjaywKCgkJVmFsdWVUeXBlTmFtZTogJ3N0cmluZycsCgkJVmFsdWVCdWZmZXJUeXBlOiBBcnJheSwKCgkJRGVmYXVsdEludGVycG9sYXRpb246IEludGVycG9sYXRlRGlzY3JldGUsCgoJCUludGVycG9sYW50RmFjdG9yeU1ldGhvZExpbmVhcjogdW5kZWZpbmVkLAoKCQlJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGg6IHVuZGVmaW5lZAoKCX0gKTsKCgkvKioKCSAqCgkgKiBBIFRyYWNrIG9mIHZlY3RvcmVkIGtleWZyYW1lIHZhbHVlcy4KCSAqCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICogQGF1dGhvciB0c2NodwoJICovCgoJZnVuY3Rpb24gVmVjdG9yS2V5ZnJhbWVUcmFjayggbmFtZSwgdGltZXMsIHZhbHVlcywgaW50ZXJwb2xhdGlvbiApIHsKCgkJS2V5ZnJhbWVUcmFjay5jYWxsKCB0aGlzLCBuYW1lLCB0aW1lcywgdmFsdWVzLCBpbnRlcnBvbGF0aW9uICk7CgoJfQoKCVZlY3RvcktleWZyYW1lVHJhY2sucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogVmVjdG9yS2V5ZnJhbWVUcmFjaywKCgkJVmFsdWVUeXBlTmFtZTogJ3ZlY3RvcicKCgkJLy8gVmFsdWVCdWZmZXJUeXBlIGlzIGluaGVyaXRlZAoKCQkvLyBEZWZhdWx0SW50ZXJwb2xhdGlvbiBpcyBpbmhlcml0ZWQKCgl9ICk7CgoJLyoqCgkgKgoJICogUmV1c2FibGUgc2V0IG9mIFRyYWNrcyB0aGF0IHJlcHJlc2VudCBhbiBhbmltYXRpb24uCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICovCgoJZnVuY3Rpb24gQW5pbWF0aW9uQ2xpcCggbmFtZSwgZHVyYXRpb24sIHRyYWNrcyApIHsKCgkJdGhpcy5uYW1lID0gbmFtZTsKCQl0aGlzLnRyYWNrcyA9IHRyYWNrczsKCQl0aGlzLmR1cmF0aW9uID0gKCBkdXJhdGlvbiAhPT0gdW5kZWZpbmVkICkgPyBkdXJhdGlvbiA6IC0gMTsKCgkJdGhpcy51dWlkID0gX01hdGguZ2VuZXJhdGVVVUlEKCk7CgoJCS8vIHRoaXMgbWVhbnMgaXQgc2hvdWxkIGZpZ3VyZSBvdXQgaXRzIGR1cmF0aW9uIGJ5IHNjYW5uaW5nIHRoZSB0cmFja3MKCQlpZiAoIHRoaXMuZHVyYXRpb24gPCAwICkgewoKCQkJdGhpcy5yZXNldER1cmF0aW9uKCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZ2V0VHJhY2tUeXBlRm9yVmFsdWVUeXBlTmFtZSggdHlwZU5hbWUgKSB7CgoJCXN3aXRjaCAoIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkgKSB7CgoJCQljYXNlICdzY2FsYXInOgoJCQljYXNlICdkb3VibGUnOgoJCQljYXNlICdmbG9hdCc6CgkJCWNhc2UgJ251bWJlcic6CgkJCWNhc2UgJ2ludGVnZXInOgoKCQkJCXJldHVybiBOdW1iZXJLZXlmcmFtZVRyYWNrOwoKCQkJY2FzZSAndmVjdG9yJzoKCQkJY2FzZSAndmVjdG9yMic6CgkJCWNhc2UgJ3ZlY3RvcjMnOgoJCQljYXNlICd2ZWN0b3I0JzoKCgkJCQlyZXR1cm4gVmVjdG9yS2V5ZnJhbWVUcmFjazsKCgkJCWNhc2UgJ2NvbG9yJzoKCgkJCQlyZXR1cm4gQ29sb3JLZXlmcmFtZVRyYWNrOwoKCQkJY2FzZSAncXVhdGVybmlvbic6CgoJCQkJcmV0dXJuIFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrOwoKCQkJY2FzZSAnYm9vbCc6CgkJCWNhc2UgJ2Jvb2xlYW4nOgoKCQkJCXJldHVybiBCb29sZWFuS2V5ZnJhbWVUcmFjazsKCgkJCWNhc2UgJ3N0cmluZyc6CgoJCQkJcmV0dXJuIFN0cmluZ0tleWZyYW1lVHJhY2s7CgoJCX0KCgkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogVW5zdXBwb3J0ZWQgdHlwZU5hbWU6ICcgKyB0eXBlTmFtZSApOwoKCX0KCglmdW5jdGlvbiBwYXJzZUtleWZyYW1lVHJhY2soIGpzb24gKSB7CgoJCWlmICgganNvbi50eXBlID09PSB1bmRlZmluZWQgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiB0cmFjayB0eXBlIHVuZGVmaW5lZCwgY2FuIG5vdCBwYXJzZScgKTsKCgkJfQoKCQl2YXIgdHJhY2tUeXBlID0gZ2V0VHJhY2tUeXBlRm9yVmFsdWVUeXBlTmFtZSgganNvbi50eXBlICk7CgoJCWlmICgganNvbi50aW1lcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJdmFyIHRpbWVzID0gW10sIHZhbHVlcyA9IFtdOwoKCQkJQW5pbWF0aW9uVXRpbHMuZmxhdHRlbkpTT04oIGpzb24ua2V5cywgdGltZXMsIHZhbHVlcywgJ3ZhbHVlJyApOwoKCQkJanNvbi50aW1lcyA9IHRpbWVzOwoJCQlqc29uLnZhbHVlcyA9IHZhbHVlczsKCgkJfQoKCQkvLyBkZXJpdmVkIGNsYXNzZXMgY2FuIGRlZmluZSBhIHN0YXRpYyBwYXJzZSBtZXRob2QKCQlpZiAoIHRyYWNrVHlwZS5wYXJzZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJcmV0dXJuIHRyYWNrVHlwZS5wYXJzZSgganNvbiApOwoKCQl9IGVsc2UgewoKCQkJLy8gYnkgZGVmYXVsdCwgd2UgYXNzdW1lIGEgY29uc3RydWN0b3IgY29tcGF0aWJsZSB3aXRoIHRoZSBiYXNlCgkJCXJldHVybiBuZXcgdHJhY2tUeXBlKCBqc29uLm5hbWUsIGpzb24udGltZXMsIGpzb24udmFsdWVzLCBqc29uLmludGVycG9sYXRpb24gKTsKCgkJfQoKCX0KCglPYmplY3QuYXNzaWduKCBBbmltYXRpb25DbGlwLCB7CgoJCXBhcnNlOiBmdW5jdGlvbiAoIGpzb24gKSB7CgoJCQl2YXIgdHJhY2tzID0gW10sCgkJCQlqc29uVHJhY2tzID0ganNvbi50cmFja3MsCgkJCQlmcmFtZVRpbWUgPSAxLjAgLyAoIGpzb24uZnBzIHx8IDEuMCApOwoKCQkJZm9yICggdmFyIGkgPSAwLCBuID0ganNvblRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdHJhY2tzLnB1c2goIHBhcnNlS2V5ZnJhbWVUcmFjaygganNvblRyYWNrc1sgaSBdICkuc2NhbGUoIGZyYW1lVGltZSApICk7CgoJCQl9CgoJCQlyZXR1cm4gbmV3IEFuaW1hdGlvbkNsaXAoIGpzb24ubmFtZSwganNvbi5kdXJhdGlvbiwgdHJhY2tzICk7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCBjbGlwICkgewoKCQkJdmFyIHRyYWNrcyA9IFtdLAoJCQkJY2xpcFRyYWNrcyA9IGNsaXAudHJhY2tzOwoKCQkJdmFyIGpzb24gPSB7CgoJCQkJJ25hbWUnOiBjbGlwLm5hbWUsCgkJCQknZHVyYXRpb24nOiBjbGlwLmR1cmF0aW9uLAoJCQkJJ3RyYWNrcyc6IHRyYWNrcywKCQkJCSd1dWlkJzogY2xpcC51dWlkCgoJCQl9OwoKCQkJZm9yICggdmFyIGkgPSAwLCBuID0gY2xpcFRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdHJhY2tzLnB1c2goIEtleWZyYW1lVHJhY2sudG9KU09OKCBjbGlwVHJhY2tzWyBpIF0gKSApOwoKCQkJfQoKCQkJcmV0dXJuIGpzb247CgoJCX0sCgoJCUNyZWF0ZUZyb21Nb3JwaFRhcmdldFNlcXVlbmNlOiBmdW5jdGlvbiAoIG5hbWUsIG1vcnBoVGFyZ2V0U2VxdWVuY2UsIGZwcywgbm9Mb29wICkgewoKCQkJdmFyIG51bU1vcnBoVGFyZ2V0cyA9IG1vcnBoVGFyZ2V0U2VxdWVuY2UubGVuZ3RoOwoJCQl2YXIgdHJhY2tzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBudW1Nb3JwaFRhcmdldHM7IGkgKysgKSB7CgoJCQkJdmFyIHRpbWVzID0gW107CgkJCQl2YXIgdmFsdWVzID0gW107CgoJCQkJdGltZXMucHVzaCgKCQkJCQkoIGkgKyBudW1Nb3JwaFRhcmdldHMgLSAxICkgJSBudW1Nb3JwaFRhcmdldHMsCgkJCQkJaSwKCQkJCQkoIGkgKyAxICkgJSBudW1Nb3JwaFRhcmdldHMgKTsKCgkJCQl2YWx1ZXMucHVzaCggMCwgMSwgMCApOwoKCQkJCXZhciBvcmRlciA9IEFuaW1hdGlvblV0aWxzLmdldEtleWZyYW1lT3JkZXIoIHRpbWVzICk7CgkJCQl0aW1lcyA9IEFuaW1hdGlvblV0aWxzLnNvcnRlZEFycmF5KCB0aW1lcywgMSwgb3JkZXIgKTsKCQkJCXZhbHVlcyA9IEFuaW1hdGlvblV0aWxzLnNvcnRlZEFycmF5KCB2YWx1ZXMsIDEsIG9yZGVyICk7CgoJCQkJLy8gaWYgdGhlcmUgaXMgYSBrZXkgYXQgdGhlIGZpcnN0IGZyYW1lLCBkdXBsaWNhdGUgaXQgYXMgdGhlCgkJCQkvLyBsYXN0IGZyYW1lIGFzIHdlbGwgZm9yIHBlcmZlY3QgbG9vcC4KCQkJCWlmICggISBub0xvb3AgJiYgdGltZXNbIDAgXSA9PT0gMCApIHsKCgkJCQkJdGltZXMucHVzaCggbnVtTW9ycGhUYXJnZXRzICk7CgkJCQkJdmFsdWVzLnB1c2goIHZhbHVlc1sgMCBdICk7CgoJCQkJfQoKCQkJCXRyYWNrcy5wdXNoKAoJCQkJCW5ldyBOdW1iZXJLZXlmcmFtZVRyYWNrKAoJCQkJCQknLm1vcnBoVGFyZ2V0SW5mbHVlbmNlc1snICsgbW9ycGhUYXJnZXRTZXF1ZW5jZVsgaSBdLm5hbWUgKyAnXScsCgkJCQkJCXRpbWVzLCB2YWx1ZXMKCQkJCQkpLnNjYWxlKCAxLjAgLyBmcHMgKSApOwoKCQkJfQoKCQkJcmV0dXJuIG5ldyBBbmltYXRpb25DbGlwKCBuYW1lLCAtIDEsIHRyYWNrcyApOwoKCQl9LAoKCQlmaW5kQnlOYW1lOiBmdW5jdGlvbiAoIG9iamVjdE9yQ2xpcEFycmF5LCBuYW1lICkgewoKCQkJdmFyIGNsaXBBcnJheSA9IG9iamVjdE9yQ2xpcEFycmF5OwoKCQkJaWYgKCAhIEFycmF5LmlzQXJyYXkoIG9iamVjdE9yQ2xpcEFycmF5ICkgKSB7CgoJCQkJdmFyIG8gPSBvYmplY3RPckNsaXBBcnJheTsKCQkJCWNsaXBBcnJheSA9IG8uZ2VvbWV0cnkgJiYgby5nZW9tZXRyeS5hbmltYXRpb25zIHx8IG8uYW5pbWF0aW9uczsKCgkJCX0KCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IGNsaXBBcnJheS5sZW5ndGg7IGkgKysgKSB7CgoJCQkJaWYgKCBjbGlwQXJyYXlbIGkgXS5uYW1lID09PSBuYW1lICkgewoKCQkJCQlyZXR1cm4gY2xpcEFycmF5WyBpIF07CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIG51bGw7CgoJCX0sCgoJCUNyZWF0ZUNsaXBzRnJvbU1vcnBoVGFyZ2V0U2VxdWVuY2VzOiBmdW5jdGlvbiAoIG1vcnBoVGFyZ2V0cywgZnBzLCBub0xvb3AgKSB7CgoJCQl2YXIgYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHMgPSB7fTsKCgkJCS8vIHRlc3RlZCB3aXRoIGh0dHBzOi8vcmVnZXgxMDEuY29tLyBvbiB0cmljayBzZXF1ZW5jZXMKCQkJLy8gc3VjaCBmbGFtaW5nb19mbHlBXzAwMywgZmxhbWluZ29fcnVuMV8wMDMsIGNyZGVhdGgwMDU5CgkJCXZhciBwYXR0ZXJuID0gL14oW1x3LV0qPykoW1xkXSspJC87CgoJCQkvLyBzb3J0IG1vcnBoIHRhcmdldCBuYW1lcyBpbnRvIGFuaW1hdGlvbiBncm91cHMgYmFzZWQKCQkJLy8gcGF0dGVybnMgbGlrZSBXYWxrXzAwMSwgV2Fsa18wMDIsIFJ1bl8wMDEsIFJ1bl8wMDIKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1vcnBoVGFyZ2V0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl2YXIgbW9ycGhUYXJnZXQgPSBtb3JwaFRhcmdldHNbIGkgXTsKCQkJCXZhciBwYXJ0cyA9IG1vcnBoVGFyZ2V0Lm5hbWUubWF0Y2goIHBhdHRlcm4gKTsKCgkJCQlpZiAoIHBhcnRzICYmIHBhcnRzLmxlbmd0aCA+IDEgKSB7CgoJCQkJCXZhciBuYW1lID0gcGFydHNbIDEgXTsKCgkJCQkJdmFyIGFuaW1hdGlvbk1vcnBoVGFyZ2V0cyA9IGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzWyBuYW1lIF07CgkJCQkJaWYgKCAhIGFuaW1hdGlvbk1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJCWFuaW1hdGlvblRvTW9ycGhUYXJnZXRzWyBuYW1lIF0gPSBhbmltYXRpb25Nb3JwaFRhcmdldHMgPSBbXTsKCgkJCQkJfQoKCQkJCQlhbmltYXRpb25Nb3JwaFRhcmdldHMucHVzaCggbW9ycGhUYXJnZXQgKTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgY2xpcHMgPSBbXTsKCgkJCWZvciAoIHZhciBuYW1lIGluIGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzICkgewoKCQkJCWNsaXBzLnB1c2goIEFuaW1hdGlvbkNsaXAuQ3JlYXRlRnJvbU1vcnBoVGFyZ2V0U2VxdWVuY2UoIG5hbWUsIGFuaW1hdGlvblRvTW9ycGhUYXJnZXRzWyBuYW1lIF0sIGZwcywgbm9Mb29wICkgKTsKCgkJCX0KCgkJCXJldHVybiBjbGlwczsKCgkJfSwKCgkJLy8gcGFyc2UgdGhlIGFuaW1hdGlvbi5oaWVyYXJjaHkgZm9ybWF0CgkJcGFyc2VBbmltYXRpb246IGZ1bmN0aW9uICggYW5pbWF0aW9uLCBib25lcyApIHsKCgkJCWlmICggISBhbmltYXRpb24gKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkFuaW1hdGlvbkNsaXA6IE5vIGFuaW1hdGlvbiBpbiBKU09OTG9hZGVyIGRhdGEuJyApOwoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQl2YXIgYWRkTm9uZW1wdHlUcmFjayA9IGZ1bmN0aW9uICggdHJhY2tUeXBlLCB0cmFja05hbWUsIGFuaW1hdGlvbktleXMsIHByb3BlcnR5TmFtZSwgZGVzdFRyYWNrcyApIHsKCgkJCQkvLyBvbmx5IHJldHVybiB0cmFjayBpZiB0aGVyZSBhcmUgYWN0dWFsbHkga2V5cy4KCQkJCWlmICggYW5pbWF0aW9uS2V5cy5sZW5ndGggIT09IDAgKSB7CgoJCQkJCXZhciB0aW1lcyA9IFtdOwoJCQkJCXZhciB2YWx1ZXMgPSBbXTsKCgkJCQkJQW5pbWF0aW9uVXRpbHMuZmxhdHRlbkpTT04oIGFuaW1hdGlvbktleXMsIHRpbWVzLCB2YWx1ZXMsIHByb3BlcnR5TmFtZSApOwoKCQkJCQkvLyBlbXB0eSBrZXlzIGFyZSBmaWx0ZXJlZCBvdXQsIHNvIGNoZWNrIGFnYWluCgkJCQkJaWYgKCB0aW1lcy5sZW5ndGggIT09IDAgKSB7CgoJCQkJCQlkZXN0VHJhY2tzLnB1c2goIG5ldyB0cmFja1R5cGUoIHRyYWNrTmFtZSwgdGltZXMsIHZhbHVlcyApICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9OwoKCQkJdmFyIHRyYWNrcyA9IFtdOwoKCQkJdmFyIGNsaXBOYW1lID0gYW5pbWF0aW9uLm5hbWUgfHwgJ2RlZmF1bHQnOwoJCQkvLyBhdXRvbWF0aWMgbGVuZ3RoIGRldGVybWluYXRpb24gaW4gQW5pbWF0aW9uQ2xpcC4KCQkJdmFyIGR1cmF0aW9uID0gYW5pbWF0aW9uLmxlbmd0aCB8fCAtIDE7CgkJCXZhciBmcHMgPSBhbmltYXRpb24uZnBzIHx8IDMwOwoKCQkJdmFyIGhpZXJhcmNoeVRyYWNrcyA9IGFuaW1hdGlvbi5oaWVyYXJjaHkgfHwgW107CgoJCQlmb3IgKCB2YXIgaCA9IDA7IGggPCBoaWVyYXJjaHlUcmFja3MubGVuZ3RoOyBoICsrICkgewoKCQkJCXZhciBhbmltYXRpb25LZXlzID0gaGllcmFyY2h5VHJhY2tzWyBoIF0ua2V5czsKCgkJCQkvLyBza2lwIGVtcHR5IHRyYWNrcwoJCQkJaWYgKCAhIGFuaW1hdGlvbktleXMgfHwgYW5pbWF0aW9uS2V5cy5sZW5ndGggPT09IDAgKSBjb250aW51ZTsKCgkJCQkvLyBwcm9jZXNzIG1vcnBoIHRhcmdldHMKCQkJCWlmICggYW5pbWF0aW9uS2V5c1sgMCBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJLy8gZmlndXJlIG91dCBhbGwgbW9ycGggdGFyZ2V0cyB1c2VkIGluIHRoaXMgdHJhY2sKCQkJCQl2YXIgbW9ycGhUYXJnZXROYW1lcyA9IHt9OwoKCQkJCQlmb3IgKCB2YXIgayA9IDA7IGsgPCBhbmltYXRpb25LZXlzLmxlbmd0aDsgayArKyApIHsKCgkJCQkJCWlmICggYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJCQlmb3IgKCB2YXIgbSA9IDA7IG0gPCBhbmltYXRpb25LZXlzWyBrIF0ubW9ycGhUYXJnZXRzLmxlbmd0aDsgbSArKyApIHsKCgkJCQkJCQkJbW9ycGhUYXJnZXROYW1lc1sgYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0c1sgbSBdIF0gPSAtIDE7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCS8vIGNyZWF0ZSBhIHRyYWNrIGZvciBlYWNoIG1vcnBoIHRhcmdldCB3aXRoIGFsbCB6ZXJvCgkJCQkJLy8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzIGV4Y2VwdCBmb3IgdGhlIGtleXMgaW4gd2hpY2gKCQkJCQkvLyB0aGUgbW9ycGhUYXJnZXQgaXMgbmFtZWQuCgkJCQkJZm9yICggdmFyIG1vcnBoVGFyZ2V0TmFtZSBpbiBtb3JwaFRhcmdldE5hbWVzICkgewoKCQkJCQkJdmFyIHRpbWVzID0gW107CgkJCQkJCXZhciB2YWx1ZXMgPSBbXTsKCgkJCQkJCWZvciAoIHZhciBtID0gMDsgbSAhPT0gYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cy5sZW5ndGg7ICsrIG0gKSB7CgoJCQkJCQkJdmFyIGFuaW1hdGlvbktleSA9IGFuaW1hdGlvbktleXNbIGsgXTsKCgkJCQkJCQl0aW1lcy5wdXNoKCBhbmltYXRpb25LZXkudGltZSApOwoJCQkJCQkJdmFsdWVzLnB1c2goICggYW5pbWF0aW9uS2V5Lm1vcnBoVGFyZ2V0ID09PSBtb3JwaFRhcmdldE5hbWUgKSA/IDEgOiAwICk7CgoJCQkJCQl9CgoJCQkJCQl0cmFja3MucHVzaCggbmV3IE51bWJlcktleWZyYW1lVHJhY2soICcubW9ycGhUYXJnZXRJbmZsdWVuY2VbJyArIG1vcnBoVGFyZ2V0TmFtZSArICddJywgdGltZXMsIHZhbHVlcyApICk7CgoJCQkJCX0KCgkJCQkJZHVyYXRpb24gPSBtb3JwaFRhcmdldE5hbWVzLmxlbmd0aCAqICggZnBzIHx8IDEuMCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIC4uLmFzc3VtZSBza2VsZXRhbCBhbmltYXRpb24KCgkJCQkJdmFyIGJvbmVOYW1lID0gJy5ib25lc1snICsgYm9uZXNbIGggXS5uYW1lICsgJ10nOwoKCQkJCQlhZGROb25lbXB0eVRyYWNrKAoJCQkJCQlWZWN0b3JLZXlmcmFtZVRyYWNrLCBib25lTmFtZSArICcucG9zaXRpb24nLAoJCQkJCQlhbmltYXRpb25LZXlzLCAncG9zJywgdHJhY2tzICk7CgoJCQkJCWFkZE5vbmVtcHR5VHJhY2soCgkJCQkJCVF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLCBib25lTmFtZSArICcucXVhdGVybmlvbicsCgkJCQkJCWFuaW1hdGlvbktleXMsICdyb3QnLCB0cmFja3MgKTsKCgkJCQkJYWRkTm9uZW1wdHlUcmFjaygKCQkJCQkJVmVjdG9yS2V5ZnJhbWVUcmFjaywgYm9uZU5hbWUgKyAnLnNjYWxlJywKCQkJCQkJYW5pbWF0aW9uS2V5cywgJ3NjbCcsIHRyYWNrcyApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdHJhY2tzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCXZhciBjbGlwID0gbmV3IEFuaW1hdGlvbkNsaXAoIGNsaXBOYW1lLCBkdXJhdGlvbiwgdHJhY2tzICk7CgoJCQlyZXR1cm4gY2xpcDsKCgkJfQoKCX0gKTsKCglPYmplY3QuYXNzaWduKCBBbmltYXRpb25DbGlwLnByb3RvdHlwZSwgewoKCQlyZXNldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdHJhY2tzID0gdGhpcy50cmFja3MsIGR1cmF0aW9uID0gMDsKCgkJCWZvciAoIHZhciBpID0gMCwgbiA9IHRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdmFyIHRyYWNrID0gdGhpcy50cmFja3NbIGkgXTsKCgkJCQlkdXJhdGlvbiA9IE1hdGgubWF4KCBkdXJhdGlvbiwgdHJhY2sudGltZXNbIHRyYWNrLnRpbWVzLmxlbmd0aCAtIDEgXSApOwoKCQkJfQoKCQkJdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRyaW06IGZ1bmN0aW9uICgpIHsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLnRyYWNrc1sgaSBdLnRyaW0oIDAsIHRoaXMuZHVyYXRpb24gKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl2YWxpZGF0ZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHZhbGlkID0gdHJ1ZTsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl2YWxpZCA9IHZhbGlkICYmIHRoaXMudHJhY2tzWyBpIF0udmFsaWRhdGUoKTsKCgkJCX0KCgkJCXJldHVybiB2YWxpZDsKCgkJfSwKCgkJb3B0aW1pemU6IGZ1bmN0aW9uICgpIHsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLnRyYWNrc1sgaSBdLm9wdGltaXplKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdHJhY2tzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnRyYWNrcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdHJhY2tzLnB1c2goIHRoaXMudHJhY2tzWyBpIF0uY2xvbmUoKSApOwoKCQkJfQoKCQkJcmV0dXJuIG5ldyBBbmltYXRpb25DbGlwKCB0aGlzLm5hbWUsIHRoaXMuZHVyYXRpb24sIHRyYWNrcyApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCXZhciBDYWNoZSA9IHsKCgkJZW5hYmxlZDogZmFsc2UsCgoJCWZpbGVzOiB7fSwKCgkJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCgkJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQWRkaW5nIGtleTonLCBrZXkgKTsKCgkJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCgkJfSwKCgkJZ2V0OiBmdW5jdGlvbiAoIGtleSApIHsKCgkJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQ2hlY2tpbmcga2V5OicsIGtleSApOwoKCQkJcmV0dXJuIHRoaXMuZmlsZXNbIGtleSBdOwoKCQl9LAoKCQlyZW1vdmU6IGZ1bmN0aW9uICgga2V5ICkgewoKCQkJZGVsZXRlIHRoaXMuZmlsZXNbIGtleSBdOwoKCQl9LAoKCQljbGVhcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5maWxlcyA9IHt9OwoKCQl9CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBMb2FkaW5nTWFuYWdlciggb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQl2YXIgaXNMb2FkaW5nID0gZmFsc2U7CgkJdmFyIGl0ZW1zTG9hZGVkID0gMDsKCQl2YXIgaXRlbXNUb3RhbCA9IDA7CgkJdmFyIHVybE1vZGlmaWVyID0gdW5kZWZpbmVkOwoKCQkvLyBSZWZlciB0byAjNTY4OSBmb3IgdGhlIHJlYXNvbiB3aHkgd2UgZG9uJ3Qgc2V0IC5vblN0YXJ0CgkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgoJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCQl0aGlzLm9uTG9hZCA9IG9uTG9hZDsKCQl0aGlzLm9uUHJvZ3Jlc3MgPSBvblByb2dyZXNzOwoJCXRoaXMub25FcnJvciA9IG9uRXJyb3I7CgoJCXRoaXMuaXRlbVN0YXJ0ID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc1RvdGFsICsrOwoKCQkJaWYgKCBpc0xvYWRpbmcgPT09IGZhbHNlICkgewoKCQkJCWlmICggc2NvcGUub25TdGFydCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgoJCQkJfQoKCQkJfQoKCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCgkJfTsKCgkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc0xvYWRlZCArKzsKCgkJCWlmICggc2NvcGUub25Qcm9ncmVzcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCgkJCX0KCgkJCWlmICggaXRlbXNMb2FkZWQgPT09IGl0ZW1zVG90YWwgKSB7CgoJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgoJCQkJaWYgKCBzY29wZS5vbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2NvcGUub25Mb2FkKCk7CgoJCQkJfQoKCQkJfQoKCQl9OwoKCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCBzY29wZS5vbkVycm9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc2NvcGUub25FcnJvciggdXJsICk7CgoJCQl9CgoJCX07CgoJCXRoaXMucmVzb2x2ZVVSTCA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCgkJCQlyZXR1cm4gdXJsTW9kaWZpZXIoIHVybCApOwoKCQkJfQoKCQkJcmV0dXJuIHVybDsKCgkJfTsKCgkJdGhpcy5zZXRVUkxNb2RpZmllciA9IGZ1bmN0aW9uICggdHJhbnNmb3JtICkgewoKCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgkJCXJldHVybiB0aGlzOwoKCQl9OwoKCX0KCgl2YXIgRGVmYXVsdExvYWRpbmdNYW5hZ2VyID0gbmV3IExvYWRpbmdNYW5hZ2VyKCk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJdmFyIGxvYWRpbmcgPSB7fTsKCglmdW5jdGlvbiBGaWxlTG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgl9CgoJT2JqZWN0LmFzc2lnbiggRmlsZUxvYWRlci5wcm90b3R5cGUsIHsKCgkJbG9hZDogZnVuY3Rpb24gKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCWlmICggdXJsID09PSB1bmRlZmluZWQgKSB1cmwgPSAnJzsKCgkJCWlmICggdGhpcy5wYXRoICE9PSB1bmRlZmluZWQgKSB1cmwgPSB0aGlzLnBhdGggKyB1cmw7CgoJCQl1cmwgPSB0aGlzLm1hbmFnZXIucmVzb2x2ZVVSTCggdXJsICk7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIGNhY2hlZCA9IENhY2hlLmdldCggdXJsICk7CgoJCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCBjYWNoZWQgKTsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQl9LCAwICk7CgoJCQkJcmV0dXJuIGNhY2hlZDsKCgkJCX0KCgkJCS8vIENoZWNrIGlmIHJlcXVlc3QgaXMgZHVwbGljYXRlCgoJCQlpZiAoIGxvYWRpbmdbIHVybCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJbG9hZGluZ1sgdXJsIF0ucHVzaCggewoKCQkJCQlvbkxvYWQ6IG9uTG9hZCwKCQkJCQlvblByb2dyZXNzOiBvblByb2dyZXNzLAoJCQkJCW9uRXJyb3I6IG9uRXJyb3IKCgkJCQl9ICk7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJLy8gQ2hlY2sgZm9yIGRhdGE6IFVSSQoJCQl2YXIgZGF0YVVyaVJlZ2V4ID0gL15kYXRhOiguKj8pKDtiYXNlNjQpPywoLiopJC87CgkJCXZhciBkYXRhVXJpUmVnZXhSZXN1bHQgPSB1cmwubWF0Y2goIGRhdGFVcmlSZWdleCApOwoKCQkJLy8gU2FmYXJpIGNhbiBub3QgaGFuZGxlIERhdGEgVVJJcyB0aHJvdWdoIFhNTEh0dHBSZXF1ZXN0IHNvIHByb2Nlc3MgbWFudWFsbHkKCQkJaWYgKCBkYXRhVXJpUmVnZXhSZXN1bHQgKSB7CgoJCQkJdmFyIG1pbWVUeXBlID0gZGF0YVVyaVJlZ2V4UmVzdWx0WyAxIF07CgkJCQl2YXIgaXNCYXNlNjQgPSAhISBkYXRhVXJpUmVnZXhSZXN1bHRbIDIgXTsKCQkJCXZhciBkYXRhID0gZGF0YVVyaVJlZ2V4UmVzdWx0WyAzIF07CgoJCQkJZGF0YSA9IGRlY29kZVVSSUNvbXBvbmVudCggZGF0YSApOwoKCQkJCWlmICggaXNCYXNlNjQgKSBkYXRhID0gYXRvYiggZGF0YSApOwoKCQkJCXRyeSB7CgoJCQkJCXZhciByZXNwb25zZTsKCQkJCQl2YXIgcmVzcG9uc2VUeXBlID0gKCB0aGlzLnJlc3BvbnNlVHlwZSB8fCAnJyApLnRvTG93ZXJDYXNlKCk7CgoJCQkJCXN3aXRjaCAoIHJlc3BvbnNlVHlwZSApIHsKCgkJCQkJCWNhc2UgJ2FycmF5YnVmZmVyJzoKCQkJCQkJY2FzZSAnYmxvYic6CgoJCQkJCQkJdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheSggZGF0YS5sZW5ndGggKTsKCgkJCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCQkJdmlld1sgaSBdID0gZGF0YS5jaGFyQ29kZUF0KCBpICk7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggcmVzcG9uc2VUeXBlID09PSAnYmxvYicgKSB7CgoJCQkJCQkJCXJlc3BvbnNlID0gbmV3IEJsb2IoIFsgdmlldy5idWZmZXIgXSwgeyB0eXBlOiBtaW1lVHlwZSB9ICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJcmVzcG9uc2UgPSB2aWV3LmJ1ZmZlcjsKCgkJCQkJCQl9CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlICdkb2N1bWVudCc6CgoJCQkJCQkJdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKCQkJCQkJCXJlc3BvbnNlID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyggZGF0YSwgbWltZVR5cGUgKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ2pzb24nOgoKCQkJCQkJCXJlc3BvbnNlID0gSlNPTi5wYXJzZSggZGF0YSApOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDogLy8gJ3RleHQnIG9yIG90aGVyCgoJCQkJCQkJcmVzcG9uc2UgPSBkYXRhOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJCS8vIFdhaXQgZm9yIG5leHQgYnJvd3NlciB0aWNrIGxpa2Ugc3RhbmRhcmQgWE1MSHR0cFJlcXVlc3QgZXZlbnQgZGlzcGF0Y2hpbmcgZG9lcwoJCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHsKCgkJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCByZXNwb25zZSApOwoKCQkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQkJfSwgMCApOwoKCQkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQkJLy8gV2FpdCBmb3IgbmV4dCBicm93c2VyIHRpY2sgbGlrZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBldmVudCBkaXNwYXRjaGluZyBkb2VzCgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24gKCkgewoKCQkJCQkJaWYgKCBvbkVycm9yICkgb25FcnJvciggZXJyb3IgKTsKCgkJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQkJfSwgMCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gSW5pdGlhbGlzZSBhcnJheSBmb3IgZHVwbGljYXRlIHJlcXVlc3RzCgoJCQkJbG9hZGluZ1sgdXJsIF0gPSBbXTsKCgkJCQlsb2FkaW5nWyB1cmwgXS5wdXNoKCB7CgoJCQkJCW9uTG9hZDogb25Mb2FkLAoJCQkJCW9uUHJvZ3Jlc3M6IG9uUHJvZ3Jlc3MsCgkJCQkJb25FcnJvcjogb25FcnJvcgoKCQkJCX0gKTsKCgkJCQl2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoKCQkJCXJlcXVlc3Qub3BlbiggJ0dFVCcsIHVybCwgdHJ1ZSApOwoKCQkJCXJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBmdW5jdGlvbiAoIGV2ZW50ICkgewoKCQkJCQl2YXIgcmVzcG9uc2UgPSB0aGlzLnJlc3BvbnNlOwoKCQkJCQlDYWNoZS5hZGQoIHVybCwgcmVzcG9uc2UgKTsKCgkJCQkJdmFyIGNhbGxiYWNrcyA9IGxvYWRpbmdbIHVybCBdOwoKCQkJCQlkZWxldGUgbG9hZGluZ1sgdXJsIF07CgoJCQkJCWlmICggdGhpcy5zdGF0dXMgPT09IDIwMCB8fCB0aGlzLnN0YXR1cyA9PT0gMCApIHsKCgkJCQkJCS8vIFNvbWUgYnJvd3NlcnMgcmV0dXJuIEhUVFAgU3RhdHVzIDAgd2hlbiB1c2luZyBub24taHR0cCBwcm90b2NvbAoJCQkJCQkvLyBlLmcuICdmaWxlOi8vJyBvciAnZGF0YTovLycuIEhhbmRsZSBhcyBzdWNjZXNzLgoKCQkJCQkJaWYgKCB0aGlzLnN0YXR1cyA9PT0gMCApIGNvbnNvbGUud2FybiggJ1RIUkVFLkZpbGVMb2FkZXI6IEhUVFAgU3RhdHVzIDAgcmVjZWl2ZWQuJyApOwoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQl2YXIgY2FsbGJhY2sgPSBjYWxsYmFja3NbIGkgXTsKCQkJCQkJCWlmICggY2FsbGJhY2sub25Mb2FkICkgY2FsbGJhY2sub25Mb2FkKCByZXNwb25zZSApOwoKCQkJCQkJfQoKCQkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQkJdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJCQlpZiAoIGNhbGxiYWNrLm9uRXJyb3IgKSBjYWxsYmFjay5vbkVycm9yKCBldmVudCApOwoKCQkJCQkJfQoKCQkJCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJCQl9CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlyZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoICdwcm9ncmVzcycsIGZ1bmN0aW9uICggZXZlbnQgKSB7CgoJCQkJCXZhciBjYWxsYmFja3MgPSBsb2FkaW5nWyB1cmwgXTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCXZhciBjYWxsYmFjayA9IGNhbGxiYWNrc1sgaSBdOwoJCQkJCQlpZiAoIGNhbGxiYWNrLm9uUHJvZ3Jlc3MgKSBjYWxsYmFjay5vblByb2dyZXNzKCBldmVudCApOwoKCQkJCQl9CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlyZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoICdlcnJvcicsIGZ1bmN0aW9uICggZXZlbnQgKSB7CgoJCQkJCXZhciBjYWxsYmFja3MgPSBsb2FkaW5nWyB1cmwgXTsKCgkJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJCWlmICggY2FsbGJhY2sub25FcnJvciApIGNhbGxiYWNrLm9uRXJyb3IoIGV2ZW50ICk7CgoJCQkJCX0KCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlyZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoICdhYm9ydCcsIGZ1bmN0aW9uICggZXZlbnQgKSB7CgoJCQkJCXZhciBjYWxsYmFja3MgPSBsb2FkaW5nWyB1cmwgXTsKCgkJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJdmFyIGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJCWlmICggY2FsbGJhY2sub25FcnJvciApIGNhbGxiYWNrLm9uRXJyb3IoIGV2ZW50ICk7CgoJCQkJCX0KCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlpZiAoIHRoaXMucmVzcG9uc2VUeXBlICE9PSB1bmRlZmluZWQgKSByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9IHRoaXMucmVzcG9uc2VUeXBlOwoJCQkJaWYgKCB0aGlzLndpdGhDcmVkZW50aWFscyAhPT0gdW5kZWZpbmVkICkgcmVxdWVzdC53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLndpdGhDcmVkZW50aWFsczsKCgkJCQlpZiAoIHJlcXVlc3Qub3ZlcnJpZGVNaW1lVHlwZSApIHJlcXVlc3Qub3ZlcnJpZGVNaW1lVHlwZSggdGhpcy5taW1lVHlwZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5taW1lVHlwZSA6ICd0ZXh0L3BsYWluJyApOwoKCQkJCWZvciAoIHZhciBoZWFkZXIgaW4gdGhpcy5yZXF1ZXN0SGVhZGVyICkgewoKCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoIGhlYWRlciwgdGhpcy5yZXF1ZXN0SGVhZGVyWyBoZWFkZXIgXSApOwoKCQkJCX0KCgkJCQlyZXF1ZXN0LnNlbmQoIG51bGwgKTsKCgkJCX0KCgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCXJldHVybiByZXF1ZXN0OwoKCQl9LAoKCQlzZXRQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRSZXNwb25zZVR5cGU6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnJlc3BvbnNlVHlwZSA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0V2l0aENyZWRlbnRpYWxzOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy53aXRoQ3JlZGVudGlhbHMgPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldE1pbWVUeXBlOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5taW1lVHlwZSA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0UmVxdWVzdEhlYWRlcjogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMucmVxdWVzdEhlYWRlciA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8vCgkgKi8KCglmdW5jdGlvbiBBbmltYXRpb25Mb2FkZXIoIG1hbmFnZXIgKSB7CgoJCXRoaXMubWFuYWdlciA9ICggbWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyBtYW5hZ2VyIDogRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwoKCX0KCglPYmplY3QuYXNzaWduKCBBbmltYXRpb25Mb2FkZXIucHJvdG90eXBlLCB7CgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCBzY29wZS5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRQYXRoKCBzY29wZS5wYXRoICk7CgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggdGV4dCApIHsKCgkJCQlvbkxvYWQoIHNjb3BlLnBhcnNlKCBKU09OLnBhcnNlKCB0ZXh0ICkgKSApOwoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQl9LAoKCQlwYXJzZTogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJdmFyIGFuaW1hdGlvbnMgPSBbXTsKCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IGpzb24ubGVuZ3RoOyBpICsrICkgewoKCQkJCXZhciBjbGlwID0gQW5pbWF0aW9uQ2xpcC5wYXJzZSgganNvblsgaSBdICk7CgoJCQkJYW5pbWF0aW9ucy5wdXNoKCBjbGlwICk7CgoJCQl9CgoJCQlyZXR1cm4gYW5pbWF0aW9uczsKCgkJfSwKCgkJc2V0UGF0aDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMucGF0aCA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKgoJICogQWJzdHJhY3QgQmFzZSBjbGFzcyB0byBibG9jayBiYXNlZCB0ZXh0dXJlcyBsb2FkZXIgKGRkcywgcHZyLCAuLi4pCgkgKi8KCglmdW5jdGlvbiBDb21wcmVzc2VkVGV4dHVyZUxvYWRlciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCS8vIG92ZXJyaWRlIGluIHN1YiBjbGFzc2VzCgkJdGhpcy5fcGFyc2VyID0gbnVsbDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQ29tcHJlc3NlZFRleHR1cmVMb2FkZXIucHJvdG90eXBlLCB7CgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIGltYWdlcyA9IFtdOwoKCQkJdmFyIHRleHR1cmUgPSBuZXcgQ29tcHJlc3NlZFRleHR1cmUoKTsKCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlczsKCgkJCXZhciBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQkJbG9hZGVyLnNldFJlc3BvbnNlVHlwZSggJ2FycmF5YnVmZmVyJyApOwoKCQkJZnVuY3Rpb24gbG9hZFRleHR1cmUoIGkgKSB7CgoJCQkJbG9hZGVyLmxvYWQoIHVybFsgaSBdLCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCQkJdmFyIHRleERhdGFzID0gc2NvcGUuX3BhcnNlciggYnVmZmVyLCB0cnVlICk7CgoJCQkJCWltYWdlc1sgaSBdID0gewoJCQkJCQl3aWR0aDogdGV4RGF0YXMud2lkdGgsCgkJCQkJCWhlaWdodDogdGV4RGF0YXMuaGVpZ2h0LAoJCQkJCQlmb3JtYXQ6IHRleERhdGFzLmZvcm1hdCwKCQkJCQkJbWlwbWFwczogdGV4RGF0YXMubWlwbWFwcwoJCQkJCX07CgoJCQkJCWxvYWRlZCArPSAxOwoKCQkJCQlpZiAoIGxvYWRlZCA9PT0gNiApIHsKCgkJCQkJCWlmICggdGV4RGF0YXMubWlwbWFwQ291bnQgPT09IDEgKQoJCQkJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CgoJCQkJCQl0ZXh0dXJlLmZvcm1hdCA9IHRleERhdGFzLmZvcm1hdDsKCQkJCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggdGV4dHVyZSApOwoKCQkJCQl9CgoJCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQkJfQoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCB1cmwgKSApIHsKCgkJCQl2YXIgbG9hZGVkID0gMDsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gdXJsLmxlbmd0aDsgaSA8IGlsOyArKyBpICkgewoKCQkJCQlsb2FkVGV4dHVyZSggaSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gY29tcHJlc3NlZCBjdWJlbWFwIHRleHR1cmUgc3RvcmVkIGluIGEgc2luZ2xlIEREUyBmaWxlCgoJCQkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJCXZhciB0ZXhEYXRhcyA9IHNjb3BlLl9wYXJzZXIoIGJ1ZmZlciwgdHJ1ZSApOwoKCQkJCQlpZiAoIHRleERhdGFzLmlzQ3ViZW1hcCApIHsKCgkJCQkJCXZhciBmYWNlcyA9IHRleERhdGFzLm1pcG1hcHMubGVuZ3RoIC8gdGV4RGF0YXMubWlwbWFwQ291bnQ7CgoJCQkJCQlmb3IgKCB2YXIgZiA9IDA7IGYgPCBmYWNlczsgZiArKyApIHsKCgkJCQkJCQlpbWFnZXNbIGYgXSA9IHsgbWlwbWFwczogW10gfTsKCgkJCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0ZXhEYXRhcy5taXBtYXBDb3VudDsgaSArKyApIHsKCgkJCQkJCQkJaW1hZ2VzWyBmIF0ubWlwbWFwcy5wdXNoKCB0ZXhEYXRhcy5taXBtYXBzWyBmICogdGV4RGF0YXMubWlwbWFwQ291bnQgKyBpIF0gKTsKCQkJCQkJCQlpbWFnZXNbIGYgXS5mb3JtYXQgPSB0ZXhEYXRhcy5mb3JtYXQ7CgkJCQkJCQkJaW1hZ2VzWyBmIF0ud2lkdGggPSB0ZXhEYXRhcy53aWR0aDsKCQkJCQkJCQlpbWFnZXNbIGYgXS5oZWlnaHQgPSB0ZXhEYXRhcy5oZWlnaHQ7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGFzLndpZHRoOwoJCQkJCQl0ZXh0dXJlLmltYWdlLmhlaWdodCA9IHRleERhdGFzLmhlaWdodDsKCQkJCQkJdGV4dHVyZS5taXBtYXBzID0gdGV4RGF0YXMubWlwbWFwczsKCgkJCQkJfQoKCQkJCQlpZiAoIHRleERhdGFzLm1pcG1hcENvdW50ID09PSAxICkgewoKCQkJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CgoJCQkJCX0KCgkJCQkJdGV4dHVyZS5mb3JtYXQgPSB0ZXhEYXRhcy5mb3JtYXQ7CgkJCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIE5pa29zIE0uIC8gaHR0cHM6Ly9naXRodWIuY29tL2ZvbzEyMy8KCSAqCgkgKiBBYnN0cmFjdCBCYXNlIGNsYXNzIHRvIGxvYWQgZ2VuZXJpYyBiaW5hcnkgdGV4dHVyZXMgZm9ybWF0cyAocmdiZSwgaGRyLCAuLi4pCgkgKi8KCglmdW5jdGlvbiBEYXRhVGV4dHVyZUxvYWRlciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCS8vIG92ZXJyaWRlIGluIHN1YiBjbGFzc2VzCgkJdGhpcy5fcGFyc2VyID0gbnVsbDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggRGF0YVRleHR1cmVMb2FkZXIucHJvdG90eXBlLCB7CgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIHRleHR1cmUgPSBuZXcgRGF0YVRleHR1cmUoKTsKCgkJCXZhciBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRSZXNwb25zZVR5cGUoICdhcnJheWJ1ZmZlcicgKTsKCQkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoJCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCQl2YXIgdGV4RGF0YSA9IHNjb3BlLl9wYXJzZXIoIGJ1ZmZlciApOwoKCQkJCWlmICggISB0ZXhEYXRhICkgcmV0dXJuOwoKCQkJCWlmICggdGV4RGF0YS5pbWFnZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQl0ZXh0dXJlLmltYWdlID0gdGV4RGF0YS5pbWFnZTsKCgkJCQl9IGVsc2UgaWYgKCB0ZXhEYXRhLmRhdGEgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGEud2lkdGg7CgkJCQkJdGV4dHVyZS5pbWFnZS5oZWlnaHQgPSB0ZXhEYXRhLmhlaWdodDsKCQkJCQl0ZXh0dXJlLmltYWdlLmRhdGEgPSB0ZXhEYXRhLmRhdGE7CgoJCQkJfQoKCQkJCXRleHR1cmUud3JhcFMgPSB0ZXhEYXRhLndyYXBTICE9PSB1bmRlZmluZWQgPyB0ZXhEYXRhLndyYXBTIDogQ2xhbXBUb0VkZ2VXcmFwcGluZzsKCQkJCXRleHR1cmUud3JhcFQgPSB0ZXhEYXRhLndyYXBUICE9PSB1bmRlZmluZWQgPyB0ZXhEYXRhLndyYXBUIDogQ2xhbXBUb0VkZ2VXcmFwcGluZzsKCgkJCQl0ZXh0dXJlLm1hZ0ZpbHRlciA9IHRleERhdGEubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyB0ZXhEYXRhLm1hZ0ZpbHRlciA6IExpbmVhckZpbHRlcjsKCQkJCXRleHR1cmUubWluRmlsdGVyID0gdGV4RGF0YS5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCA/IHRleERhdGEubWluRmlsdGVyIDogTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyOwoKCQkJCXRleHR1cmUuYW5pc290cm9weSA9IHRleERhdGEuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkID8gdGV4RGF0YS5hbmlzb3Ryb3B5IDogMTsKCgkJCQlpZiAoIHRleERhdGEuZm9ybWF0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRleHR1cmUuZm9ybWF0ID0gdGV4RGF0YS5mb3JtYXQ7CgoJCQkJfQoJCQkJaWYgKCB0ZXhEYXRhLnR5cGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZS50eXBlID0gdGV4RGF0YS50eXBlOwoKCQkJCX0KCgkJCQlpZiAoIHRleERhdGEubWlwbWFwcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQl0ZXh0dXJlLm1pcG1hcHMgPSB0ZXhEYXRhLm1pcG1hcHM7CgoJCQkJfQoKCQkJCWlmICggdGV4RGF0YS5taXBtYXBDb3VudCA9PT0gMSApIHsKCgkJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CgoJCQkJfQoKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0ZXh0dXJlLCB0ZXhEYXRhICk7CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoKCWZ1bmN0aW9uIEltYWdlTG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgl9CgoJT2JqZWN0LmFzc2lnbiggSW1hZ2VMb2FkZXIucHJvdG90eXBlLCB7CgoJCWNyb3NzT3JpZ2luOiAnYW5vbnltb3VzJywKCgkJbG9hZDogZnVuY3Rpb24gKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCWlmICggdXJsID09PSB1bmRlZmluZWQgKSB1cmwgPSAnJzsKCgkJCWlmICggdGhpcy5wYXRoICE9PSB1bmRlZmluZWQgKSB1cmwgPSB0aGlzLnBhdGggKyB1cmw7CgoJCQl1cmwgPSB0aGlzLm1hbmFnZXIucmVzb2x2ZVVSTCggdXJsICk7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIGNhY2hlZCA9IENhY2hlLmdldCggdXJsICk7CgoJCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCBjYWNoZWQgKTsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQl9LCAwICk7CgoJCQkJcmV0dXJuIGNhY2hlZDsKCgkJCX0KCgkJCXZhciBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyggJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnLCAnaW1nJyApOwoKCQkJZnVuY3Rpb24gb25JbWFnZUxvYWQoKSB7CgoJCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJCWltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlcnJvcicsIG9uSW1hZ2VFcnJvciwgZmFsc2UgKTsKCgkJCQlDYWNoZS5hZGQoIHVybCwgdGhpcyApOwoKCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0aGlzICk7CgoJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uSW1hZ2VFcnJvciggZXZlbnQgKSB7CgoJCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJCWltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlcnJvcicsIG9uSW1hZ2VFcnJvciwgZmFsc2UgKTsKCgkJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9CgoJCQlpbWFnZS5hZGRFdmVudExpc3RlbmVyKCAnbG9hZCcsIG9uSW1hZ2VMb2FkLCBmYWxzZSApOwoJCQlpbWFnZS5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCBvbkltYWdlRXJyb3IsIGZhbHNlICk7CgoJCQlpZiAoIHVybC5zdWJzdHIoIDAsIDUgKSAhPT0gJ2RhdGE6JyApIHsKCgkJCQlpZiAoIHRoaXMuY3Jvc3NPcmlnaW4gIT09IHVuZGVmaW5lZCApIGltYWdlLmNyb3NzT3JpZ2luID0gdGhpcy5jcm9zc09yaWdpbjsKCgkJCX0KCgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCWltYWdlLnNyYyA9IHVybDsKCgkJCXJldHVybiBpbWFnZTsKCgkJfSwKCgkJc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLmNyb3NzT3JpZ2luID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCglmdW5jdGlvbiBDdWJlVGV4dHVyZUxvYWRlciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJfQoKCU9iamVjdC5hc3NpZ24oIEN1YmVUZXh0dXJlTG9hZGVyLnByb3RvdHlwZSwgewoKCQljcm9zc09yaWdpbjogJ2Fub255bW91cycsCgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJscywgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQkJdmFyIHRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoKTsKCgkJCXZhciBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCQlsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oIHRoaXMuY3Jvc3NPcmlnaW4gKTsKCQkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoKCQkJdmFyIGxvYWRlZCA9IDA7CgoJCQlmdW5jdGlvbiBsb2FkVGV4dHVyZSggaSApIHsKCgkJCQlsb2FkZXIubG9hZCggdXJsc1sgaSBdLCBmdW5jdGlvbiAoIGltYWdlICkgewoKCQkJCQl0ZXh0dXJlLmltYWdlc1sgaSBdID0gaW1hZ2U7CgoJCQkJCWxvYWRlZCArKzsKCgkJCQkJaWYgKCBsb2FkZWQgPT09IDYgKSB7CgoJCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQkJCX0KCgkJCQl9LCB1bmRlZmluZWQsIG9uRXJyb3IgKTsKCgkJCX0KCgkJCWZvciAoIHZhciBpID0gMDsgaSA8IHVybHMubGVuZ3RoOyArKyBpICkgewoKCQkJCWxvYWRUZXh0dXJlKCBpICk7CgoJCQl9CgoJCQlyZXR1cm4gdGV4dHVyZTsKCgkJfSwKCgkJc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLmNyb3NzT3JpZ2luID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCglmdW5jdGlvbiBUZXh0dXJlTG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgl9CgoJT2JqZWN0LmFzc2lnbiggVGV4dHVyZUxvYWRlci5wcm90b3R5cGUsIHsKCgkJY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLAoKCQlsb2FkOiBmdW5jdGlvbiAoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQkJdmFyIHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJdmFyIGxvYWRlciA9IG5ldyBJbWFnZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgoJCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIGltYWdlICkgewoKCQkJCXRleHR1cmUuaW1hZ2UgPSBpbWFnZTsKCgkJCQkvLyBKUEVHcyBjYW4ndCBoYXZlIGFuIGFscGhhIGNoYW5uZWwsIHNvIG1lbW9yeSBjYW4gYmUgc2F2ZWQgYnkgc3RvcmluZyB0aGVtIGFzIFJHQi4KCQkJCXZhciBpc0pQRUcgPSB1cmwuc2VhcmNoKCAvXC5qcGU/ZygkfFw/KS9pICkgPiAwIHx8IHVybC5zZWFyY2goIC9eZGF0YVw6aW1hZ2VcL2pwZWcvICkgPT09IDA7CgoJCQkJdGV4dHVyZS5mb3JtYXQgPSBpc0pQRUcgPyBSR0JGb3JtYXQgOiBSR0JBRm9ybWF0OwoJCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQkJfQoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0sCgoJCXNldENyb3NzT3JpZ2luOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5jcm9zc09yaWdpbiA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0UGF0aDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMucGF0aCA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqIEV4dGVuc2libGUgY3VydmUgb2JqZWN0CgkgKgoJICogU29tZSBjb21tb24gb2YgY3VydmUgbWV0aG9kczoKCSAqIC5nZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgKSwgLmdldFRhbmdlbnQoIHQgKQoJICogLmdldFBvaW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICksIC5nZXRUYW5nZW50QXQoIHUgKQoJICogLmdldFBvaW50cygpLCAuZ2V0U3BhY2VkUG9pbnRzKCkKCSAqIC5nZXRMZW5ndGgoKQoJICogLnVwZGF0ZUFyY0xlbmd0aHMoKQoJICoKCSAqIFRoaXMgZm9sbG93aW5nIGN1cnZlcyBpbmhlcml0IGZyb20gVEhSRUUuQ3VydmU6CgkgKgoJICogLS0gMkQgY3VydmVzIC0tCgkgKiBUSFJFRS5BcmNDdXJ2ZQoJICogVEhSRUUuQ3ViaWNCZXppZXJDdXJ2ZQoJICogVEhSRUUuRWxsaXBzZUN1cnZlCgkgKiBUSFJFRS5MaW5lQ3VydmUKCSAqIFRIUkVFLlF1YWRyYXRpY0JlemllckN1cnZlCgkgKiBUSFJFRS5TcGxpbmVDdXJ2ZQoJICoKCSAqIC0tIDNEIGN1cnZlcyAtLQoJICogVEhSRUUuQ2F0bXVsbFJvbUN1cnZlMwoJICogVEhSRUUuQ3ViaWNCZXppZXJDdXJ2ZTMKCSAqIFRIUkVFLkxpbmVDdXJ2ZTMKCSAqIFRIUkVFLlF1YWRyYXRpY0JlemllckN1cnZlMwoJICoKCSAqIEEgc2VyaWVzIG9mIGN1cnZlcyBjYW4gYmUgcmVwcmVzZW50ZWQgYXMgYSBUSFJFRS5DdXJ2ZVBhdGguCgkgKgoJICoqLwoKCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoJICoJQWJzdHJhY3QgQ3VydmUgYmFzZSBjbGFzcwoJICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCWZ1bmN0aW9uIEN1cnZlKCkgewoKCQl0aGlzLnR5cGUgPSAnQ3VydmUnOwoKCQl0aGlzLmFyY0xlbmd0aERpdmlzaW9ucyA9IDIwMDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQ3VydmUucHJvdG90eXBlLCB7CgoJCS8vIFZpcnR1YWwgYmFzZSBjbGFzcyBtZXRob2QgdG8gb3ZlcndyaXRlIGFuZCBpbXBsZW1lbnQgaW4gc3ViY2xhc3NlcwoJCS8vCS0gdCBbMCAuLiAxXQoKCQlnZXRQb2ludDogZnVuY3Rpb24gKCAvKiB0LCBvcHRpb25hbFRhcmdldCAqLyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkN1cnZlOiAuZ2V0UG9pbnQoKSBub3QgaW1wbGVtZW50ZWQuJyApOwoJCQlyZXR1cm4gbnVsbDsKCgkJfSwKCgkJLy8gR2V0IHBvaW50IGF0IHJlbGF0aXZlIHBvc2l0aW9uIGluIGN1cnZlIGFjY29yZGluZyB0byBhcmMgbGVuZ3RoCgkJLy8gLSB1IFswIC4uIDFdCgoJCWdldFBvaW50QXQ6IGZ1bmN0aW9uICggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCQl2YXIgdCA9IHRoaXMuZ2V0VXRvVG1hcHBpbmcoIHUgKTsKCQkJcmV0dXJuIHRoaXMuZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICk7CgoJCX0sCgoJCS8vIEdldCBzZXF1ZW5jZSBvZiBwb2ludHMgdXNpbmcgZ2V0UG9pbnQoIHQgKQoKCQlnZXRQb2ludHM6IGZ1bmN0aW9uICggZGl2aXNpb25zICkgewoKCQkJaWYgKCBkaXZpc2lvbnMgPT09IHVuZGVmaW5lZCApIGRpdmlzaW9ucyA9IDU7CgoJCQl2YXIgcG9pbnRzID0gW107CgoJCQlmb3IgKCB2YXIgZCA9IDA7IGQgPD0gZGl2aXNpb25zOyBkICsrICkgewoKCQkJCXBvaW50cy5wdXNoKCB0aGlzLmdldFBvaW50KCBkIC8gZGl2aXNpb25zICkgKTsKCgkJCX0KCgkJCXJldHVybiBwb2ludHM7CgoJCX0sCgoJCS8vIEdldCBzZXF1ZW5jZSBvZiBwb2ludHMgdXNpbmcgZ2V0UG9pbnRBdCggdSApCgoJCWdldFNwYWNlZFBvaW50czogZnVuY3Rpb24gKCBkaXZpc2lvbnMgKSB7CgoJCQlpZiAoIGRpdmlzaW9ucyA9PT0gdW5kZWZpbmVkICkgZGl2aXNpb25zID0gNTsKCgkJCXZhciBwb2ludHMgPSBbXTsKCgkJCWZvciAoIHZhciBkID0gMDsgZCA8PSBkaXZpc2lvbnM7IGQgKysgKSB7CgoJCQkJcG9pbnRzLnB1c2goIHRoaXMuZ2V0UG9pbnRBdCggZCAvIGRpdmlzaW9ucyApICk7CgoJCQl9CgoJCQlyZXR1cm4gcG9pbnRzOwoKCQl9LAoKCQkvLyBHZXQgdG90YWwgY3VydmUgYXJjIGxlbmd0aAoKCQlnZXRMZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBsZW5ndGhzID0gdGhpcy5nZXRMZW5ndGhzKCk7CgkJCXJldHVybiBsZW5ndGhzWyBsZW5ndGhzLmxlbmd0aCAtIDEgXTsKCgkJfSwKCgkJLy8gR2V0IGxpc3Qgb2YgY3VtdWxhdGl2ZSBzZWdtZW50IGxlbmd0aHMKCgkJZ2V0TGVuZ3RoczogZnVuY3Rpb24gKCBkaXZpc2lvbnMgKSB7CgoJCQlpZiAoIGRpdmlzaW9ucyA9PT0gdW5kZWZpbmVkICkgZGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnM7CgoJCQlpZiAoIHRoaXMuY2FjaGVBcmNMZW5ndGhzICYmCgkJCQkoIHRoaXMuY2FjaGVBcmNMZW5ndGhzLmxlbmd0aCA9PT0gZGl2aXNpb25zICsgMSApICYmCgkJCQkhIHRoaXMubmVlZHNVcGRhdGUgKSB7CgoJCQkJcmV0dXJuIHRoaXMuY2FjaGVBcmNMZW5ndGhzOwoKCQkJfQoKCQkJdGhpcy5uZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJdmFyIGNhY2hlID0gW107CgkJCXZhciBjdXJyZW50LCBsYXN0ID0gdGhpcy5nZXRQb2ludCggMCApOwoJCQl2YXIgcCwgc3VtID0gMDsKCgkJCWNhY2hlLnB1c2goIDAgKTsKCgkJCWZvciAoIHAgPSAxOyBwIDw9IGRpdmlzaW9uczsgcCArKyApIHsKCgkJCQljdXJyZW50ID0gdGhpcy5nZXRQb2ludCggcCAvIGRpdmlzaW9ucyApOwoJCQkJc3VtICs9IGN1cnJlbnQuZGlzdGFuY2VUbyggbGFzdCApOwoJCQkJY2FjaGUucHVzaCggc3VtICk7CgkJCQlsYXN0ID0gY3VycmVudDsKCgkJCX0KCgkJCXRoaXMuY2FjaGVBcmNMZW5ndGhzID0gY2FjaGU7CgoJCQlyZXR1cm4gY2FjaGU7IC8vIHsgc3VtczogY2FjaGUsIHN1bTogc3VtIH07IFN1bSBpcyBpbiB0aGUgbGFzdCBlbGVtZW50LgoKCQl9LAoKCQl1cGRhdGVBcmNMZW5ndGhzOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJdGhpcy5nZXRMZW5ndGhzKCk7CgoJCX0sCgoJCS8vIEdpdmVuIHUgKCAwIC4uIDEgKSwgZ2V0IGEgdCB0byBmaW5kIHAuIFRoaXMgZ2l2ZXMgeW91IHBvaW50cyB3aGljaCBhcmUgZXF1aWRpc3RhbnQKCgkJZ2V0VXRvVG1hcHBpbmc6IGZ1bmN0aW9uICggdSwgZGlzdGFuY2UgKSB7CgoJCQl2YXIgYXJjTGVuZ3RocyA9IHRoaXMuZ2V0TGVuZ3RocygpOwoKCQkJdmFyIGkgPSAwLCBpbCA9IGFyY0xlbmd0aHMubGVuZ3RoOwoKCQkJdmFyIHRhcmdldEFyY0xlbmd0aDsgLy8gVGhlIHRhcmdldGVkIHUgZGlzdGFuY2UgdmFsdWUgdG8gZ2V0CgoJCQlpZiAoIGRpc3RhbmNlICkgewoKCQkJCXRhcmdldEFyY0xlbmd0aCA9IGRpc3RhbmNlOwoKCQkJfSBlbHNlIHsKCgkJCQl0YXJnZXRBcmNMZW5ndGggPSB1ICogYXJjTGVuZ3Roc1sgaWwgLSAxIF07CgoJCQl9CgoJCQkvLyBiaW5hcnkgc2VhcmNoIGZvciB0aGUgaW5kZXggd2l0aCBsYXJnZXN0IHZhbHVlIHNtYWxsZXIgdGhhbiB0YXJnZXQgdSBkaXN0YW5jZQoKCQkJdmFyIGxvdyA9IDAsIGhpZ2ggPSBpbCAtIDEsIGNvbXBhcmlzb247CgoJCQl3aGlsZSAoIGxvdyA8PSBoaWdoICkgewoKCQkJCWkgPSBNYXRoLmZsb29yKCBsb3cgKyAoIGhpZ2ggLSBsb3cgKSAvIDIgKTsgLy8gbGVzcyBsaWtlbHkgdG8gb3ZlcmZsb3csIHRob3VnaCBwcm9iYWJseSBub3QgaXNzdWUgaGVyZSwgSlMgZG9lc24ndCByZWFsbHkgaGF2ZSBpbnRlZ2VycywgYWxsIG51bWJlcnMgYXJlIGZsb2F0cwoKCQkJCWNvbXBhcmlzb24gPSBhcmNMZW5ndGhzWyBpIF0gLSB0YXJnZXRBcmNMZW5ndGg7CgoJCQkJaWYgKCBjb21wYXJpc29uIDwgMCApIHsKCgkJCQkJbG93ID0gaSArIDE7CgoJCQkJfSBlbHNlIGlmICggY29tcGFyaXNvbiA+IDAgKSB7CgoJCQkJCWhpZ2ggPSBpIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQloaWdoID0gaTsKCQkJCQlicmVhazsKCgkJCQkJLy8gRE9ORQoKCQkJCX0KCgkJCX0KCgkJCWkgPSBoaWdoOwoKCQkJaWYgKCBhcmNMZW5ndGhzWyBpIF0gPT09IHRhcmdldEFyY0xlbmd0aCApIHsKCgkJCQlyZXR1cm4gaSAvICggaWwgLSAxICk7CgoJCQl9CgoJCQkvLyB3ZSBjb3VsZCBnZXQgZmluZXIgZ3JhaW4gYXQgbGVuZ3Rocywgb3IgdXNlIHNpbXBsZSBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHBvaW50cwoKCQkJdmFyIGxlbmd0aEJlZm9yZSA9IGFyY0xlbmd0aHNbIGkgXTsKCQkJdmFyIGxlbmd0aEFmdGVyID0gYXJjTGVuZ3Roc1sgaSArIDEgXTsKCgkJCXZhciBzZWdtZW50TGVuZ3RoID0gbGVuZ3RoQWZ0ZXIgLSBsZW5ndGhCZWZvcmU7CgoJCQkvLyBkZXRlcm1pbmUgd2hlcmUgd2UgYXJlIGJldHdlZW4gdGhlICdiZWZvcmUnIGFuZCAnYWZ0ZXInIHBvaW50cwoKCQkJdmFyIHNlZ21lbnRGcmFjdGlvbiA9ICggdGFyZ2V0QXJjTGVuZ3RoIC0gbGVuZ3RoQmVmb3JlICkgLyBzZWdtZW50TGVuZ3RoOwoKCQkJLy8gYWRkIHRoYXQgZnJhY3Rpb25hbCBhbW91bnQgdG8gdAoKCQkJdmFyIHQgPSAoIGkgKyBzZWdtZW50RnJhY3Rpb24gKSAvICggaWwgLSAxICk7CgoJCQlyZXR1cm4gdDsKCgkJfSwKCgkJLy8gUmV0dXJucyBhIHVuaXQgdmVjdG9yIHRhbmdlbnQgYXQgdAoJCS8vIEluIGNhc2UgYW55IHN1YiBjdXJ2ZSBkb2VzIG5vdCBpbXBsZW1lbnQgaXRzIHRhbmdlbnQgZGVyaXZhdGlvbiwKCQkvLyAyIHBvaW50cyBhIHNtYWxsIGRlbHRhIGFwYXJ0IHdpbGwgYmUgdXNlZCB0byBmaW5kIGl0cyBncmFkaWVudAoJCS8vIHdoaWNoIHNlZW1zIHRvIGdpdmUgYSByZWFzb25hYmxlIGFwcHJveGltYXRpb24KCgkJZ2V0VGFuZ2VudDogZnVuY3Rpb24gKCB0ICkgewoKCQkJdmFyIGRlbHRhID0gMC4wMDAxOwoJCQl2YXIgdDEgPSB0IC0gZGVsdGE7CgkJCXZhciB0MiA9IHQgKyBkZWx0YTsKCgkJCS8vIENhcHBpbmcgaW4gY2FzZSBvZiBkYW5nZXIKCgkJCWlmICggdDEgPCAwICkgdDEgPSAwOwoJCQlpZiAoIHQyID4gMSApIHQyID0gMTsKCgkJCXZhciBwdDEgPSB0aGlzLmdldFBvaW50KCB0MSApOwoJCQl2YXIgcHQyID0gdGhpcy5nZXRQb2ludCggdDIgKTsKCgkJCXZhciB2ZWMgPSBwdDIuY2xvbmUoKS5zdWIoIHB0MSApOwoJCQlyZXR1cm4gdmVjLm5vcm1hbGl6ZSgpOwoKCQl9LAoKCQlnZXRUYW5nZW50QXQ6IGZ1bmN0aW9uICggdSApIHsKCgkJCXZhciB0ID0gdGhpcy5nZXRVdG9UbWFwcGluZyggdSApOwoJCQlyZXR1cm4gdGhpcy5nZXRUYW5nZW50KCB0ICk7CgoJCX0sCgoJCWNvbXB1dGVGcmVuZXRGcmFtZXM6IGZ1bmN0aW9uICggc2VnbWVudHMsIGNsb3NlZCApIHsKCgkJCS8vIHNlZSBodHRwOi8vd3d3LmNzLmluZGlhbmEuZWR1L3B1Yi90ZWNocmVwb3J0cy9UUjQyNS5wZGYKCgkJCXZhciBub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIHRhbmdlbnRzID0gW107CgkJCXZhciBub3JtYWxzID0gW107CgkJCXZhciBiaW5vcm1hbHMgPSBbXTsKCgkJCXZhciB2ZWMgPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgbWF0ID0gbmV3IE1hdHJpeDQoKTsKCgkJCXZhciBpLCB1LCB0aGV0YTsKCgkJCS8vIGNvbXB1dGUgdGhlIHRhbmdlbnQgdmVjdG9ycyBmb3IgZWFjaCBzZWdtZW50IG9uIHRoZSBjdXJ2ZQoKCQkJZm9yICggaSA9IDA7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQkJdSA9IGkgLyBzZWdtZW50czsKCgkJCQl0YW5nZW50c1sgaSBdID0gdGhpcy5nZXRUYW5nZW50QXQoIHUgKTsKCQkJCXRhbmdlbnRzWyBpIF0ubm9ybWFsaXplKCk7CgoJCQl9CgoJCQkvLyBzZWxlY3QgYW4gaW5pdGlhbCBub3JtYWwgdmVjdG9yIHBlcnBlbmRpY3VsYXIgdG8gdGhlIGZpcnN0IHRhbmdlbnQgdmVjdG9yLAoJCQkvLyBhbmQgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgbWluaW11bSB0YW5nZW50IHh5eiBjb21wb25lbnQKCgkJCW5vcm1hbHNbIDAgXSA9IG5ldyBWZWN0b3IzKCk7CgkJCWJpbm9ybWFsc1sgMCBdID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CgkJCXZhciB0eCA9IE1hdGguYWJzKCB0YW5nZW50c1sgMCBdLnggKTsKCQkJdmFyIHR5ID0gTWF0aC5hYnMoIHRhbmdlbnRzWyAwIF0ueSApOwoJCQl2YXIgdHogPSBNYXRoLmFicyggdGFuZ2VudHNbIDAgXS56ICk7CgoJCQlpZiAoIHR4IDw9IG1pbiApIHsKCgkJCQltaW4gPSB0eDsKCQkJCW5vcm1hbC5zZXQoIDEsIDAsIDAgKTsKCgkJCX0KCgkJCWlmICggdHkgPD0gbWluICkgewoKCQkJCW1pbiA9IHR5OwoJCQkJbm9ybWFsLnNldCggMCwgMSwgMCApOwoKCQkJfQoKCQkJaWYgKCB0eiA8PSBtaW4gKSB7CgoJCQkJbm9ybWFsLnNldCggMCwgMCwgMSApOwoKCQkJfQoKCQkJdmVjLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIDAgXSwgbm9ybWFsICkubm9ybWFsaXplKCk7CgoJCQlub3JtYWxzWyAwIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgMCBdLCB2ZWMgKTsKCQkJYmlub3JtYWxzWyAwIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgMCBdLCBub3JtYWxzWyAwIF0gKTsKCgoJCQkvLyBjb21wdXRlIHRoZSBzbG93bHktdmFyeWluZyBub3JtYWwgYW5kIGJpbm9ybWFsIHZlY3RvcnMgZm9yIGVhY2ggc2VnbWVudCBvbiB0aGUgY3VydmUKCgkJCWZvciAoIGkgPSAxOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJCW5vcm1hbHNbIGkgXSA9IG5vcm1hbHNbIGkgLSAxIF0uY2xvbmUoKTsKCgkJCQliaW5vcm1hbHNbIGkgXSA9IGJpbm9ybWFsc1sgaSAtIDEgXS5jbG9uZSgpOwoKCQkJCXZlYy5jcm9zc1ZlY3RvcnMoIHRhbmdlbnRzWyBpIC0gMSBdLCB0YW5nZW50c1sgaSBdICk7CgoJCQkJaWYgKCB2ZWMubGVuZ3RoKCkgPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJdmVjLm5vcm1hbGl6ZSgpOwoKCQkJCQl0aGV0YSA9IE1hdGguYWNvcyggX01hdGguY2xhbXAoIHRhbmdlbnRzWyBpIC0gMSBdLmRvdCggdGFuZ2VudHNbIGkgXSApLCAtIDEsIDEgKSApOyAvLyBjbGFtcCBmb3IgZmxvYXRpbmcgcHQgZXJyb3JzCgoJCQkJCW5vcm1hbHNbIGkgXS5hcHBseU1hdHJpeDQoIG1hdC5tYWtlUm90YXRpb25BeGlzKCB2ZWMsIHRoZXRhICkgKTsKCgkJCQl9CgoJCQkJYmlub3JtYWxzWyBpIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgaSBdLCBub3JtYWxzWyBpIF0gKTsKCgkJCX0KCgkJCS8vIGlmIHRoZSBjdXJ2ZSBpcyBjbG9zZWQsIHBvc3Rwcm9jZXNzIHRoZSB2ZWN0b3JzIHNvIHRoZSBmaXJzdCBhbmQgbGFzdCBub3JtYWwgdmVjdG9ycyBhcmUgdGhlIHNhbWUKCgkJCWlmICggY2xvc2VkID09PSB0cnVlICkgewoKCQkJCXRoZXRhID0gTWF0aC5hY29zKCBfTWF0aC5jbGFtcCggbm9ybWFsc1sgMCBdLmRvdCggbm9ybWFsc1sgc2VnbWVudHMgXSApLCAtIDEsIDEgKSApOwoJCQkJdGhldGEgLz0gc2VnbWVudHM7CgoJCQkJaWYgKCB0YW5nZW50c1sgMCBdLmRvdCggdmVjLmNyb3NzVmVjdG9ycyggbm9ybWFsc1sgMCBdLCBub3JtYWxzWyBzZWdtZW50cyBdICkgKSA+IDAgKSB7CgoJCQkJCXRoZXRhID0gLSB0aGV0YTsKCgkJCQl9CgoJCQkJZm9yICggaSA9IDE7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQkJCS8vIHR3aXN0IGEgbGl0dGxlLi4uCgkJCQkJbm9ybWFsc1sgaSBdLmFwcGx5TWF0cml4NCggbWF0Lm1ha2VSb3RhdGlvbkF4aXMoIHRhbmdlbnRzWyBpIF0sIHRoZXRhICogaSApICk7CgkJCQkJYmlub3JtYWxzWyBpIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgaSBdLCBub3JtYWxzWyBpIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gewoJCQkJdGFuZ2VudHM6IHRhbmdlbnRzLAoJCQkJbm9ybWFsczogbm9ybWFscywKCQkJCWJpbm9ybWFsczogYmlub3JtYWxzCgkJCX07CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSBzb3VyY2UuYXJjTGVuZ3RoRGl2aXNpb25zOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGRhdGEgPSB7CgkJCQltZXRhZGF0YTogewoJCQkJCXZlcnNpb246IDQuNSwKCQkJCQl0eXBlOiAnQ3VydmUnLAoJCQkJCWdlbmVyYXRvcjogJ0N1cnZlLnRvSlNPTicKCQkJCX0KCQkJfTsKCgkJCWRhdGEuYXJjTGVuZ3RoRGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnM7CgkJCWRhdGEudHlwZSA9IHRoaXMudHlwZTsKCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQlmcm9tSlNPTjogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSBqc29uLmFyY0xlbmd0aERpdmlzaW9uczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCWZ1bmN0aW9uIEVsbGlwc2VDdXJ2ZSggYVgsIGFZLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24gKSB7CgoJCUN1cnZlLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0VsbGlwc2VDdXJ2ZSc7CgoJCXRoaXMuYVggPSBhWCB8fCAwOwoJCXRoaXMuYVkgPSBhWSB8fCAwOwoKCQl0aGlzLnhSYWRpdXMgPSB4UmFkaXVzIHx8IDE7CgkJdGhpcy55UmFkaXVzID0geVJhZGl1cyB8fCAxOwoKCQl0aGlzLmFTdGFydEFuZ2xlID0gYVN0YXJ0QW5nbGUgfHwgMDsKCQl0aGlzLmFFbmRBbmdsZSA9IGFFbmRBbmdsZSB8fCAyICogTWF0aC5QSTsKCgkJdGhpcy5hQ2xvY2t3aXNlID0gYUNsb2Nrd2lzZSB8fCBmYWxzZTsKCgkJdGhpcy5hUm90YXRpb24gPSBhUm90YXRpb24gfHwgMDsKCgl9CgoJRWxsaXBzZUN1cnZlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN1cnZlLnByb3RvdHlwZSApOwoJRWxsaXBzZUN1cnZlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEVsbGlwc2VDdXJ2ZTsKCglFbGxpcHNlQ3VydmUucHJvdG90eXBlLmlzRWxsaXBzZUN1cnZlID0gdHJ1ZTsKCglFbGxpcHNlQ3VydmUucHJvdG90eXBlLmdldFBvaW50ID0gZnVuY3Rpb24gKCB0LCBvcHRpb25hbFRhcmdldCApIHsKCgkJdmFyIHBvaW50ID0gb3B0aW9uYWxUYXJnZXQgfHwgbmV3IFZlY3RvcjIoKTsKCgkJdmFyIHR3b1BpID0gTWF0aC5QSSAqIDI7CgkJdmFyIGRlbHRhQW5nbGUgPSB0aGlzLmFFbmRBbmdsZSAtIHRoaXMuYVN0YXJ0QW5nbGU7CgkJdmFyIHNhbWVQb2ludHMgPSBNYXRoLmFicyggZGVsdGFBbmdsZSApIDwgTnVtYmVyLkVQU0lMT047CgoJCS8vIGVuc3VyZXMgdGhhdCBkZWx0YUFuZ2xlIGlzIDAgLi4gMiBQSQoJCXdoaWxlICggZGVsdGFBbmdsZSA8IDAgKSBkZWx0YUFuZ2xlICs9IHR3b1BpOwoJCXdoaWxlICggZGVsdGFBbmdsZSA+IHR3b1BpICkgZGVsdGFBbmdsZSAtPSB0d29QaTsKCgkJaWYgKCBkZWx0YUFuZ2xlIDwgTnVtYmVyLkVQU0lMT04gKSB7CgoJCQlpZiAoIHNhbWVQb2ludHMgKSB7CgoJCQkJZGVsdGFBbmdsZSA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCWRlbHRhQW5nbGUgPSB0d29QaTsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMuYUNsb2Nrd2lzZSA9PT0gdHJ1ZSAmJiAhIHNhbWVQb2ludHMgKSB7CgoJCQlpZiAoIGRlbHRhQW5nbGUgPT09IHR3b1BpICkgewoKCQkJCWRlbHRhQW5nbGUgPSAtIHR3b1BpOwoKCQkJfSBlbHNlIHsKCgkJCQlkZWx0YUFuZ2xlID0gZGVsdGFBbmdsZSAtIHR3b1BpOwoKCQkJfQoKCQl9CgoJCXZhciBhbmdsZSA9IHRoaXMuYVN0YXJ0QW5nbGUgKyB0ICogZGVsdGFBbmdsZTsKCQl2YXIgeCA9IHRoaXMuYVggKyB0aGlzLnhSYWRpdXMgKiBNYXRoLmNvcyggYW5nbGUgKTsKCQl2YXIgeSA9IHRoaXMuYVkgKyB0aGlzLnlSYWRpdXMgKiBNYXRoLnNpbiggYW5nbGUgKTsKCgkJaWYgKCB0aGlzLmFSb3RhdGlvbiAhPT0gMCApIHsKCgkJCXZhciBjb3MgPSBNYXRoLmNvcyggdGhpcy5hUm90YXRpb24gKTsKCQkJdmFyIHNpbiA9IE1hdGguc2luKCB0aGlzLmFSb3RhdGlvbiApOwoKCQkJdmFyIHR4ID0geCAtIHRoaXMuYVg7CgkJCXZhciB0eSA9IHkgLSB0aGlzLmFZOwoKCQkJLy8gUm90YXRlIHRoZSBwb2ludCBhYm91dCB0aGUgY2VudGVyIG9mIHRoZSBlbGxpcHNlLgoJCQl4ID0gdHggKiBjb3MgLSB0eSAqIHNpbiArIHRoaXMuYVg7CgkJCXkgPSB0eCAqIHNpbiArIHR5ICogY29zICsgdGhpcy5hWTsKCgkJfQoKCQlyZXR1cm4gcG9pbnQuc2V0KCB4LCB5ICk7CgoJfTsKCglFbGxpcHNlQ3VydmUucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJQ3VydmUucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMuYVggPSBzb3VyY2UuYVg7CgkJdGhpcy5hWSA9IHNvdXJjZS5hWTsKCgkJdGhpcy54UmFkaXVzID0gc291cmNlLnhSYWRpdXM7CgkJdGhpcy55UmFkaXVzID0gc291cmNlLnlSYWRpdXM7CgoJCXRoaXMuYVN0YXJ0QW5nbGUgPSBzb3VyY2UuYVN0YXJ0QW5nbGU7CgkJdGhpcy5hRW5kQW5nbGUgPSBzb3VyY2UuYUVuZEFuZ2xlOwoKCQl0aGlzLmFDbG9ja3dpc2UgPSBzb3VyY2UuYUNsb2Nrd2lzZTsKCgkJdGhpcy5hUm90YXRpb24gPSBzb3VyY2UuYVJvdGF0aW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCglFbGxpcHNlQ3VydmUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS5hWCA9IHRoaXMuYVg7CgkJZGF0YS5hWSA9IHRoaXMuYVk7CgoJCWRhdGEueFJhZGl1cyA9IHRoaXMueFJhZGl1czsKCQlkYXRhLnlSYWRpdXMgPSB0aGlzLnlSYWRpdXM7CgoJCWRhdGEuYVN0YXJ0QW5nbGUgPSB0aGlzLmFTdGFydEFuZ2xlOwoJCWRhdGEuYUVuZEFuZ2xlID0gdGhpcy5hRW5kQW5nbGU7CgoJCWRhdGEuYUNsb2Nrd2lzZSA9IHRoaXMuYUNsb2Nrd2lzZTsKCgkJZGF0YS5hUm90YXRpb24gPSB0aGlzLmFSb3RhdGlvbjsKCgkJcmV0dXJuIGRhdGE7CgoJfTsKCglFbGxpcHNlQ3VydmUucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKCBqc29uICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuZnJvbUpTT04uY2FsbCggdGhpcywganNvbiApOwoKCQl0aGlzLmFYID0ganNvbi5hWDsKCQl0aGlzLmFZID0ganNvbi5hWTsKCgkJdGhpcy54UmFkaXVzID0ganNvbi54UmFkaXVzOwoJCXRoaXMueVJhZGl1cyA9IGpzb24ueVJhZGl1czsKCgkJdGhpcy5hU3RhcnRBbmdsZSA9IGpzb24uYVN0YXJ0QW5nbGU7CgkJdGhpcy5hRW5kQW5nbGUgPSBqc29uLmFFbmRBbmdsZTsKCgkJdGhpcy5hQ2xvY2t3aXNlID0ganNvbi5hQ2xvY2t3aXNlOwoKCQl0aGlzLmFSb3RhdGlvbiA9IGpzb24uYVJvdGF0aW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCWZ1bmN0aW9uIEFyY0N1cnZlKCBhWCwgYVksIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKSB7CgoJCUVsbGlwc2VDdXJ2ZS5jYWxsKCB0aGlzLCBhWCwgYVksIGFSYWRpdXMsIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKTsKCgkJdGhpcy50eXBlID0gJ0FyY0N1cnZlJzsKCgl9CgoJQXJjQ3VydmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggRWxsaXBzZUN1cnZlLnByb3RvdHlwZSApOwoJQXJjQ3VydmUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQXJjQ3VydmU7CgoJQXJjQ3VydmUucHJvdG90eXBlLmlzQXJjQ3VydmUgPSB0cnVlOwoKCS8qKgoJICogQGF1dGhvciB6ejg1IGh0dHBzOi8vZ2l0aHViLmNvbS96ejg1CgkgKgoJICogQ2VudHJpcGV0YWwgQ2F0bXVsbFJvbSBDdXJ2ZSAtIHdoaWNoIGlzIHVzZWZ1bCBmb3IgYXZvaWRpbmcKCSAqIGN1c3BzIGFuZCBzZWxmLWludGVyc2VjdGlvbnMgaW4gbm9uLXVuaWZvcm0gY2F0bXVsbCByb20gY3VydmVzLgoJICogaHR0cDovL3d3dy5jZW15dWtzZWwuY29tL3Jlc2VhcmNoL2NhdG11bGxyb21fcGFyYW0vY2F0bXVsbHJvbS5wZGYKCSAqCgkgKiBjdXJ2ZS50eXBlIGFjY2VwdHMgY2VudHJpcGV0YWwoZGVmYXVsdCksIGNob3JkYWwgYW5kIGNhdG11bGxyb20KCSAqIGN1cnZlLnRlbnNpb24gaXMgdXNlZCBmb3IgY2F0bXVsbHJvbSB3aGljaCBkZWZhdWx0cyB0byAwLjUKCSAqLwoKCgkvKgoJQmFzZWQgb24gYW4gb3B0aW1pemVkIGMrKyBzb2x1dGlvbiBpbgoJIC0gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NDg5NzM2L2NhdG11bGwtcm9tLWN1cnZlLXdpdGgtbm8tY3VzcHMtYW5kLW5vLXNlbGYtaW50ZXJzZWN0aW9ucy8KCSAtIGh0dHA6Ly9pZGVvbmUuY29tL05vRWJWTQoKCVRoaXMgQ3ViaWNQb2x5IGNsYXNzIGNvdWxkIGJlIHVzZWQgZm9yIHJldXNpbmcgc29tZSB2YXJpYWJsZXMgYW5kIGNhbGN1bGF0aW9ucywKCWJ1dCBmb3IgdGhyZWUuanMgY3VydmUgdXNlLCBpdCBjb3VsZCBiZSBwb3NzaWJsZSBpbmxpbmVkIGFuZCBmbGF0dGVuIGludG8gYSBzaW5nbGUgZnVuY3Rpb24gY2FsbAoJd2hpY2ggY2FuIGJlIHBsYWNlZCBpbiBDdXJ2ZVV0aWxzLgoJKi8KCglmdW5jdGlvbiBDdWJpY1BvbHkoKSB7CgoJCXZhciBjMCA9IDAsIGMxID0gMCwgYzIgPSAwLCBjMyA9IDA7CgoJCS8qCgkJICogQ29tcHV0ZSBjb2VmZmljaWVudHMgZm9yIGEgY3ViaWMgcG9seW5vbWlhbAoJCSAqICAgcChzKSA9IGMwICsgYzEqcyArIGMyKnNeMiArIGMzKnNeMwoJCSAqIHN1Y2ggdGhhdAoJCSAqICAgcCgwKSA9IHgwLCBwKDEpID0geDEKCQkgKiAgYW5kCgkJICogICBwJygwKSA9IHQwLCBwJygxKSA9IHQxLgoJCSAqLwoJCWZ1bmN0aW9uIGluaXQoIHgwLCB4MSwgdDAsIHQxICkgewoKCQkJYzAgPSB4MDsKCQkJYzEgPSB0MDsKCQkJYzIgPSAtIDMgKiB4MCArIDMgKiB4MSAtIDIgKiB0MCAtIHQxOwoJCQljMyA9IDIgKiB4MCAtIDIgKiB4MSArIHQwICsgdDE7CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWluaXRDYXRtdWxsUm9tOiBmdW5jdGlvbiAoIHgwLCB4MSwgeDIsIHgzLCB0ZW5zaW9uICkgewoKCQkJCWluaXQoIHgxLCB4MiwgdGVuc2lvbiAqICggeDIgLSB4MCApLCB0ZW5zaW9uICogKCB4MyAtIHgxICkgKTsKCgkJCX0sCgoJCQlpbml0Tm9udW5pZm9ybUNhdG11bGxSb206IGZ1bmN0aW9uICggeDAsIHgxLCB4MiwgeDMsIGR0MCwgZHQxLCBkdDIgKSB7CgoJCQkJLy8gY29tcHV0ZSB0YW5nZW50cyB3aGVuIHBhcmFtZXRlcml6ZWQgaW4gW3QxLHQyXQoJCQkJdmFyIHQxID0gKCB4MSAtIHgwICkgLyBkdDAgLSAoIHgyIC0geDAgKSAvICggZHQwICsgZHQxICkgKyAoIHgyIC0geDEgKSAvIGR0MTsKCQkJCXZhciB0MiA9ICggeDIgLSB4MSApIC8gZHQxIC0gKCB4MyAtIHgxICkgLyAoIGR0MSArIGR0MiApICsgKCB4MyAtIHgyICkgLyBkdDI7CgoJCQkJLy8gcmVzY2FsZSB0YW5nZW50cyBmb3IgcGFyYW1ldHJpemF0aW9uIGluIFswLDFdCgkJCQl0MSAqPSBkdDE7CgkJCQl0MiAqPSBkdDE7CgoJCQkJaW5pdCggeDEsIHgyLCB0MSwgdDIgKTsKCgkJCX0sCgoJCQljYWxjOiBmdW5jdGlvbiAoIHQgKSB7CgoJCQkJdmFyIHQyID0gdCAqIHQ7CgkJCQl2YXIgdDMgPSB0MiAqIHQ7CgkJCQlyZXR1cm4gYzAgKyBjMSAqIHQgKyBjMiAqIHQyICsgYzMgKiB0MzsKCgkJCX0KCgkJfTsKCgl9CgoJLy8KCgl2YXIgdG1wID0gbmV3IFZlY3RvcjMoKTsKCXZhciBweCA9IG5ldyBDdWJpY1BvbHkoKSwgcHkgPSBuZXcgQ3ViaWNQb2x5KCksIHB6ID0gbmV3IEN1YmljUG9seSgpOwoKCWZ1bmN0aW9uIENhdG11bGxSb21DdXJ2ZTMoIHBvaW50cywgY2xvc2VkLCBjdXJ2ZVR5cGUsIHRlbnNpb24gKSB7CgoJCUN1cnZlLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0NhdG11bGxSb21DdXJ2ZTMnOwoKCQl0aGlzLnBvaW50cyA9IHBvaW50cyB8fCBbXTsKCQl0aGlzLmNsb3NlZCA9IGNsb3NlZCB8fCBmYWxzZTsKCQl0aGlzLmN1cnZlVHlwZSA9IGN1cnZlVHlwZSB8fCAnY2VudHJpcGV0YWwnOwoJCXRoaXMudGVuc2lvbiA9IHRlbnNpb24gfHwgMC41OwoKCX0KCglDYXRtdWxsUm9tQ3VydmUzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN1cnZlLnByb3RvdHlwZSApOwoJQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDYXRtdWxsUm9tQ3VydmUzOwoKCUNhdG11bGxSb21DdXJ2ZTMucHJvdG90eXBlLmlzQ2F0bXVsbFJvbUN1cnZlMyA9IHRydWU7CgoJQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMygpOwoKCQl2YXIgcG9pbnRzID0gdGhpcy5wb2ludHM7CgkJdmFyIGwgPSBwb2ludHMubGVuZ3RoOwoKCQl2YXIgcCA9ICggbCAtICggdGhpcy5jbG9zZWQgPyAwIDogMSApICkgKiB0OwoJCXZhciBpbnRQb2ludCA9IE1hdGguZmxvb3IoIHAgKTsKCQl2YXIgd2VpZ2h0ID0gcCAtIGludFBvaW50OwoKCQlpZiAoIHRoaXMuY2xvc2VkICkgewoKCQkJaW50UG9pbnQgKz0gaW50UG9pbnQgPiAwID8gMCA6ICggTWF0aC5mbG9vciggTWF0aC5hYnMoIGludFBvaW50ICkgLyBsICkgKyAxICkgKiBsOwoKCQl9IGVsc2UgaWYgKCB3ZWlnaHQgPT09IDAgJiYgaW50UG9pbnQgPT09IGwgLSAxICkgewoKCQkJaW50UG9pbnQgPSBsIC0gMjsKCQkJd2VpZ2h0ID0gMTsKCgkJfQoKCQl2YXIgcDAsIHAxLCBwMiwgcDM7IC8vIDQgcG9pbnRzCgoJCWlmICggdGhpcy5jbG9zZWQgfHwgaW50UG9pbnQgPiAwICkgewoKCQkJcDAgPSBwb2ludHNbICggaW50UG9pbnQgLSAxICkgJSBsIF07CgoJCX0gZWxzZSB7CgoJCQkvLyBleHRyYXBvbGF0ZSBmaXJzdCBwb2ludAoJCQl0bXAuc3ViVmVjdG9ycyggcG9pbnRzWyAwIF0sIHBvaW50c1sgMSBdICkuYWRkKCBwb2ludHNbIDAgXSApOwoJCQlwMCA9IHRtcDsKCgkJfQoKCQlwMSA9IHBvaW50c1sgaW50UG9pbnQgJSBsIF07CgkJcDIgPSBwb2ludHNbICggaW50UG9pbnQgKyAxICkgJSBsIF07CgoJCWlmICggdGhpcy5jbG9zZWQgfHwgaW50UG9pbnQgKyAyIDwgbCApIHsKCgkJCXAzID0gcG9pbnRzWyAoIGludFBvaW50ICsgMiApICUgbCBdOwoKCQl9IGVsc2UgewoKCQkJLy8gZXh0cmFwb2xhdGUgbGFzdCBwb2ludAoJCQl0bXAuc3ViVmVjdG9ycyggcG9pbnRzWyBsIC0gMSBdLCBwb2ludHNbIGwgLSAyIF0gKS5hZGQoIHBvaW50c1sgbCAtIDEgXSApOwoJCQlwMyA9IHRtcDsKCgkJfQoKCQlpZiAoIHRoaXMuY3VydmVUeXBlID09PSAnY2VudHJpcGV0YWwnIHx8IHRoaXMuY3VydmVUeXBlID09PSAnY2hvcmRhbCcgKSB7CgoJCQkvLyBpbml0IENlbnRyaXBldGFsIC8gQ2hvcmRhbCBDYXRtdWxsLVJvbQoJCQl2YXIgcG93ID0gdGhpcy5jdXJ2ZVR5cGUgPT09ICdjaG9yZGFsJyA/IDAuNSA6IDAuMjU7CgkJCXZhciBkdDAgPSBNYXRoLnBvdyggcDAuZGlzdGFuY2VUb1NxdWFyZWQoIHAxICksIHBvdyApOwoJCQl2YXIgZHQxID0gTWF0aC5wb3coIHAxLmRpc3RhbmNlVG9TcXVhcmVkKCBwMiApLCBwb3cgKTsKCQkJdmFyIGR0MiA9IE1hdGgucG93KCBwMi5kaXN0YW5jZVRvU3F1YXJlZCggcDMgKSwgcG93ICk7CgoJCQkvLyBzYWZldHkgY2hlY2sgZm9yIHJlcGVhdGVkIHBvaW50cwoJCQlpZiAoIGR0MSA8IDFlLTQgKSBkdDEgPSAxLjA7CgkJCWlmICggZHQwIDwgMWUtNCApIGR0MCA9IGR0MTsKCQkJaWYgKCBkdDIgPCAxZS00ICkgZHQyID0gZHQxOwoKCQkJcHguaW5pdE5vbnVuaWZvcm1DYXRtdWxsUm9tKCBwMC54LCBwMS54LCBwMi54LCBwMy54LCBkdDAsIGR0MSwgZHQyICk7CgkJCXB5LmluaXROb251bmlmb3JtQ2F0bXVsbFJvbSggcDAueSwgcDEueSwgcDIueSwgcDMueSwgZHQwLCBkdDEsIGR0MiApOwoJCQlwei5pbml0Tm9udW5pZm9ybUNhdG11bGxSb20oIHAwLnosIHAxLnosIHAyLnosIHAzLnosIGR0MCwgZHQxLCBkdDIgKTsKCgkJfSBlbHNlIGlmICggdGhpcy5jdXJ2ZVR5cGUgPT09ICdjYXRtdWxscm9tJyApIHsKCgkJCXB4LmluaXRDYXRtdWxsUm9tKCBwMC54LCBwMS54LCBwMi54LCBwMy54LCB0aGlzLnRlbnNpb24gKTsKCQkJcHkuaW5pdENhdG11bGxSb20oIHAwLnksIHAxLnksIHAyLnksIHAzLnksIHRoaXMudGVuc2lvbiApOwoJCQlwei5pbml0Q2F0bXVsbFJvbSggcDAueiwgcDEueiwgcDIueiwgcDMueiwgdGhpcy50ZW5zaW9uICk7CgoJCX0KCgkJcG9pbnQuc2V0KAoJCQlweC5jYWxjKCB3ZWlnaHQgKSwKCQkJcHkuY2FsYyggd2VpZ2h0ICksCgkJCXB6LmNhbGMoIHdlaWdodCApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX07CgoJQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5wb2ludHMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBsID0gc291cmNlLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdmFyIHBvaW50ID0gc291cmNlLnBvaW50c1sgaSBdOwoKCQkJdGhpcy5wb2ludHMucHVzaCggcG9pbnQuY2xvbmUoKSApOwoKCQl9CgoJCXRoaXMuY2xvc2VkID0gc291cmNlLmNsb3NlZDsKCQl0aGlzLmN1cnZlVHlwZSA9IHNvdXJjZS5jdXJ2ZVR5cGU7CgkJdGhpcy50ZW5zaW9uID0gc291cmNlLnRlbnNpb247CgoJCXJldHVybiB0aGlzOwoKCX07CgoJQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgZGF0YSA9IEN1cnZlLnByb3RvdHlwZS50b0pTT04uY2FsbCggdGhpcyApOwoKCQlkYXRhLnBvaW50cyA9IFtdOwoKCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdmFyIHBvaW50ID0gdGhpcy5wb2ludHNbIGkgXTsKCQkJZGF0YS5wb2ludHMucHVzaCggcG9pbnQudG9BcnJheSgpICk7CgoJCX0KCgkJZGF0YS5jbG9zZWQgPSB0aGlzLmNsb3NlZDsKCQlkYXRhLmN1cnZlVHlwZSA9IHRoaXMuY3VydmVUeXBlOwoJCWRhdGEudGVuc2lvbiA9IHRoaXMudGVuc2lvbjsKCgkJcmV0dXJuIGRhdGE7CgoJfTsKCglDYXRtdWxsUm9tQ3VydmUzLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uICgganNvbiApIHsKCgkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJdGhpcy5wb2ludHMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBsID0ganNvbi5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXZhciBwb2ludCA9IGpzb24ucG9pbnRzWyBpIF07CgkJCXRoaXMucG9pbnRzLnB1c2goIG5ldyBWZWN0b3IzKCkuZnJvbUFycmF5KCBwb2ludCApICk7CgoJCX0KCgkJdGhpcy5jbG9zZWQgPSBqc29uLmNsb3NlZDsKCQl0aGlzLmN1cnZlVHlwZSA9IGpzb24uY3VydmVUeXBlOwoJCXRoaXMudGVuc2lvbiA9IGpzb24udGVuc2lvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCgkvKioKCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqCgkgKiBCZXppZXIgQ3VydmVzIGZvcm11bGFzIG9idGFpbmVkIGZyb20KCSAqIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQsOpemllcl9jdXJ2ZQoJICovCgoJZnVuY3Rpb24gQ2F0bXVsbFJvbSggdCwgcDAsIHAxLCBwMiwgcDMgKSB7CgoJCXZhciB2MCA9ICggcDIgLSBwMCApICogMC41OwoJCXZhciB2MSA9ICggcDMgLSBwMSApICogMC41OwoJCXZhciB0MiA9IHQgKiB0OwoJCXZhciB0MyA9IHQgKiB0MjsKCQlyZXR1cm4gKCAyICogcDEgLSAyICogcDIgKyB2MCArIHYxICkgKiB0MyArICggLSAzICogcDEgKyAzICogcDIgLSAyICogdjAgLSB2MSApICogdDIgKyB2MCAqIHQgKyBwMTsKCgl9CgoJLy8KCglmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMCggdCwgcCApIHsKCgkJdmFyIGsgPSAxIC0gdDsKCQlyZXR1cm4gayAqIGsgKiBwOwoKCX0KCglmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMSggdCwgcCApIHsKCgkJcmV0dXJuIDIgKiAoIDEgLSB0ICkgKiB0ICogcDsKCgl9CgoJZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyUDIoIHQsIHAgKSB7CgoJCXJldHVybiB0ICogdCAqIHA7CgoJfQoKCWZ1bmN0aW9uIFF1YWRyYXRpY0JlemllciggdCwgcDAsIHAxLCBwMiApIHsKCgkJcmV0dXJuIFF1YWRyYXRpY0JlemllclAwKCB0LCBwMCApICsgUXVhZHJhdGljQmV6aWVyUDEoIHQsIHAxICkgKwoJCQlRdWFkcmF0aWNCZXppZXJQMiggdCwgcDIgKTsKCgl9CgoJLy8KCglmdW5jdGlvbiBDdWJpY0JlemllclAwKCB0LCBwICkgewoKCQl2YXIgayA9IDEgLSB0OwoJCXJldHVybiBrICogayAqIGsgKiBwOwoKCX0KCglmdW5jdGlvbiBDdWJpY0JlemllclAxKCB0LCBwICkgewoKCQl2YXIgayA9IDEgLSB0OwoJCXJldHVybiAzICogayAqIGsgKiB0ICogcDsKCgl9CgoJZnVuY3Rpb24gQ3ViaWNCZXppZXJQMiggdCwgcCApIHsKCgkJcmV0dXJuIDMgKiAoIDEgLSB0ICkgKiB0ICogdCAqIHA7CgoJfQoKCWZ1bmN0aW9uIEN1YmljQmV6aWVyUDMoIHQsIHAgKSB7CgoJCXJldHVybiB0ICogdCAqIHQgKiBwOwoKCX0KCglmdW5jdGlvbiBDdWJpY0JlemllciggdCwgcDAsIHAxLCBwMiwgcDMgKSB7CgoJCXJldHVybiBDdWJpY0JlemllclAwKCB0LCBwMCApICsgQ3ViaWNCZXppZXJQMSggdCwgcDEgKSArIEN1YmljQmV6aWVyUDIoIHQsIHAyICkgKwoJCQlDdWJpY0JlemllclAzKCB0LCBwMyApOwoKCX0KCglmdW5jdGlvbiBDdWJpY0JlemllckN1cnZlKCB2MCwgdjEsIHYyLCB2MyApIHsKCgkJQ3VydmUuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnQ3ViaWNCZXppZXJDdXJ2ZSc7CgoJCXRoaXMudjAgPSB2MCB8fCBuZXcgVmVjdG9yMigpOwoJCXRoaXMudjEgPSB2MSB8fCBuZXcgVmVjdG9yMigpOwoJCXRoaXMudjIgPSB2MiB8fCBuZXcgVmVjdG9yMigpOwoJCXRoaXMudjMgPSB2MyB8fCBuZXcgVmVjdG9yMigpOwoKCX0KCglDdWJpY0JlemllckN1cnZlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN1cnZlLnByb3RvdHlwZSApOwoJQ3ViaWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDdWJpY0JlemllckN1cnZlOwoKCUN1YmljQmV6aWVyQ3VydmUucHJvdG90eXBlLmlzQ3ViaWNCZXppZXJDdXJ2ZSA9IHRydWU7CgoJQ3ViaWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMigpOwoKCQl2YXIgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MiwgdjMgPSB0aGlzLnYzOwoKCQlwb2ludC5zZXQoCgkJCUN1YmljQmV6aWVyKCB0LCB2MC54LCB2MS54LCB2Mi54LCB2My54ICksCgkJCUN1YmljQmV6aWVyKCB0LCB2MC55LCB2MS55LCB2Mi55LCB2My55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfTsKCglDdWJpY0JlemllckN1cnZlLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCUN1cnZlLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLnYwLmNvcHkoIHNvdXJjZS52MCApOwoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCQl0aGlzLnYzLmNvcHkoIHNvdXJjZS52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCUN1YmljQmV6aWVyQ3VydmUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgkJZGF0YS52MyA9IHRoaXMudjMudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9OwoKCUN1YmljQmV6aWVyQ3VydmUucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKCBqc29uICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuZnJvbUpTT04uY2FsbCggdGhpcywganNvbiApOwoKCQl0aGlzLnYwLmZyb21BcnJheSgganNvbi52MCApOwoJCXRoaXMudjEuZnJvbUFycmF5KCBqc29uLnYxICk7CgkJdGhpcy52Mi5mcm9tQXJyYXkoIGpzb24udjIgKTsKCQl0aGlzLnYzLmZyb21BcnJheSgganNvbi52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCWZ1bmN0aW9uIEN1YmljQmV6aWVyQ3VydmUzKCB2MCwgdjEsIHYyLCB2MyApIHsKCgkJQ3VydmUuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnQ3ViaWNCZXppZXJDdXJ2ZTMnOwoKCQl0aGlzLnYwID0gdjAgfHwgbmV3IFZlY3RvcjMoKTsKCQl0aGlzLnYxID0gdjEgfHwgbmV3IFZlY3RvcjMoKTsKCQl0aGlzLnYyID0gdjIgfHwgbmV3IFZlY3RvcjMoKTsKCQl0aGlzLnYzID0gdjMgfHwgbmV3IFZlY3RvcjMoKTsKCgl9CgoJQ3ViaWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ3VydmUucHJvdG90eXBlICk7CglDdWJpY0JlemllckN1cnZlMy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDdWJpY0JlemllckN1cnZlMzsKCglDdWJpY0JlemllckN1cnZlMy5wcm90b3R5cGUuaXNDdWJpY0JlemllckN1cnZlMyA9IHRydWU7CgoJQ3ViaWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlLmdldFBvaW50ID0gZnVuY3Rpb24gKCB0LCBvcHRpb25hbFRhcmdldCApIHsKCgkJdmFyIHBvaW50ID0gb3B0aW9uYWxUYXJnZXQgfHwgbmV3IFZlY3RvcjMoKTsKCgkJdmFyIHYwID0gdGhpcy52MCwgdjEgPSB0aGlzLnYxLCB2MiA9IHRoaXMudjIsIHYzID0gdGhpcy52MzsKCgkJcG9pbnQuc2V0KAoJCQlDdWJpY0JlemllciggdCwgdjAueCwgdjEueCwgdjIueCwgdjMueCApLAoJCQlDdWJpY0JlemllciggdCwgdjAueSwgdjEueSwgdjIueSwgdjMueSApLAoJCQlDdWJpY0JlemllciggdCwgdjAueiwgdjEueiwgdjIueiwgdjMueiApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX07CgoJQ3ViaWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJQ3VydmUucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMudjAuY29weSggc291cmNlLnYwICk7CgkJdGhpcy52MS5jb3B5KCBzb3VyY2UudjEgKTsKCQl0aGlzLnYyLmNvcHkoIHNvdXJjZS52MiApOwoJCXRoaXMudjMuY29weSggc291cmNlLnYzICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJQ3ViaWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgkJZGF0YS52MyA9IHRoaXMudjMudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9OwoKCUN1YmljQmV6aWVyQ3VydmUzLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uICgganNvbiApIHsKCgkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgkJdGhpcy52My5mcm9tQXJyYXkoIGpzb24udjMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCglmdW5jdGlvbiBMaW5lQ3VydmUoIHYxLCB2MiApIHsKCgkJQ3VydmUuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnTGluZUN1cnZlJzsKCgkJdGhpcy52MSA9IHYxIHx8IG5ldyBWZWN0b3IyKCk7CgkJdGhpcy52MiA9IHYyIHx8IG5ldyBWZWN0b3IyKCk7CgoJfQoKCUxpbmVDdXJ2ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBDdXJ2ZS5wcm90b3R5cGUgKTsKCUxpbmVDdXJ2ZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMaW5lQ3VydmU7CgoJTGluZUN1cnZlLnByb3RvdHlwZS5pc0xpbmVDdXJ2ZSA9IHRydWU7CgoJTGluZUN1cnZlLnByb3RvdHlwZS5nZXRQb2ludCA9IGZ1bmN0aW9uICggdCwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXZhciBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0IHx8IG5ldyBWZWN0b3IyKCk7CgoJCWlmICggdCA9PT0gMSApIHsKCgkJCXBvaW50LmNvcHkoIHRoaXMudjIgKTsKCgkJfSBlbHNlIHsKCgkJCXBvaW50LmNvcHkoIHRoaXMudjIgKS5zdWIoIHRoaXMudjEgKTsKCQkJcG9pbnQubXVsdGlwbHlTY2FsYXIoIHQgKS5hZGQoIHRoaXMudjEgKTsKCgkJfQoKCQlyZXR1cm4gcG9pbnQ7CgoJfTsKCgkvLyBMaW5lIGN1cnZlIGlzIGxpbmVhciwgc28gd2UgY2FuIG92ZXJ3cml0ZSBkZWZhdWx0IGdldFBvaW50QXQKCglMaW5lQ3VydmUucHJvdG90eXBlLmdldFBvaW50QXQgPSBmdW5jdGlvbiAoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5nZXRQb2ludCggdSwgb3B0aW9uYWxUYXJnZXQgKTsKCgl9OwoKCUxpbmVDdXJ2ZS5wcm90b3R5cGUuZ2V0VGFuZ2VudCA9IGZ1bmN0aW9uICggLyogdCAqLyApIHsKCgkJdmFyIHRhbmdlbnQgPSB0aGlzLnYyLmNsb25lKCkuc3ViKCB0aGlzLnYxICk7CgoJCXJldHVybiB0YW5nZW50Lm5vcm1hbGl6ZSgpOwoKCX07CgoJTGluZUN1cnZlLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCUN1cnZlLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJTGluZUN1cnZlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7CgoJCXZhciBkYXRhID0gQ3VydmUucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX07CgoJTGluZUN1cnZlLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uICgganNvbiApIHsKCgkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJdGhpcy52MS5mcm9tQXJyYXkoIGpzb24udjEgKTsKCQl0aGlzLnYyLmZyb21BcnJheSgganNvbi52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCWZ1bmN0aW9uIExpbmVDdXJ2ZTMoIHYxLCB2MiApIHsKCgkJQ3VydmUuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnTGluZUN1cnZlMyc7CgoJCXRoaXMudjEgPSB2MSB8fCBuZXcgVmVjdG9yMygpOwoJCXRoaXMudjIgPSB2MiB8fCBuZXcgVmVjdG9yMygpOwoKCX0KCglMaW5lQ3VydmUzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN1cnZlLnByb3RvdHlwZSApOwoJTGluZUN1cnZlMy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBMaW5lQ3VydmUzOwoKCUxpbmVDdXJ2ZTMucHJvdG90eXBlLmlzTGluZUN1cnZlMyA9IHRydWU7CgoJTGluZUN1cnZlMy5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMygpOwoKCQlpZiAoIHQgPT09IDEgKSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICk7CgoJCX0gZWxzZSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICkuc3ViKCB0aGlzLnYxICk7CgkJCXBvaW50Lm11bHRpcGx5U2NhbGFyKCB0ICkuYWRkKCB0aGlzLnYxICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50OwoKCX07CgoJLy8gTGluZSBjdXJ2ZSBpcyBsaW5lYXIsIHNvIHdlIGNhbiBvdmVyd3JpdGUgZGVmYXVsdCBnZXRQb2ludEF0CgoJTGluZUN1cnZlMy5wcm90b3R5cGUuZ2V0UG9pbnRBdCA9IGZ1bmN0aW9uICggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmdldFBvaW50KCB1LCBvcHRpb25hbFRhcmdldCApOwoKCX07CgoJTGluZUN1cnZlMy5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy52MS5jb3B5KCBzb3VyY2UudjEgKTsKCQl0aGlzLnYyLmNvcHkoIHNvdXJjZS52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCUxpbmVDdXJ2ZTMucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwoJCWRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKCgkJcmV0dXJuIGRhdGE7CgoJfTsKCglMaW5lQ3VydmUzLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uICgganNvbiApIHsKCgkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJdGhpcy52MS5mcm9tQXJyYXkoIGpzb24udjEgKTsKCQl0aGlzLnYyLmZyb21BcnJheSgganNvbi52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCWZ1bmN0aW9uIFF1YWRyYXRpY0JlemllckN1cnZlKCB2MCwgdjEsIHYyICkgewoKCQlDdXJ2ZS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdRdWFkcmF0aWNCZXppZXJDdXJ2ZSc7CgoJCXRoaXMudjAgPSB2MCB8fCBuZXcgVmVjdG9yMigpOwoJCXRoaXMudjEgPSB2MSB8fCBuZXcgVmVjdG9yMigpOwoJCXRoaXMudjIgPSB2MiB8fCBuZXcgVmVjdG9yMigpOwoKCX0KCglRdWFkcmF0aWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBDdXJ2ZS5wcm90b3R5cGUgKTsKCVF1YWRyYXRpY0JlemllckN1cnZlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFF1YWRyYXRpY0JlemllckN1cnZlOwoKCVF1YWRyYXRpY0JlemllckN1cnZlLnByb3RvdHlwZS5pc1F1YWRyYXRpY0JlemllckN1cnZlID0gdHJ1ZTsKCglRdWFkcmF0aWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMigpOwoKCQl2YXIgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MjsKCgkJcG9pbnQuc2V0KAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLnggKSwKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC55LCB2MS55LCB2Mi55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfTsKCglRdWFkcmF0aWNCZXppZXJDdXJ2ZS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy52MC5jb3B5KCBzb3VyY2UudjAgKTsKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJUXVhZHJhdGljQmV6aWVyQ3VydmUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX07CgoJUXVhZHJhdGljQmV6aWVyQ3VydmUucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKCBqc29uICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuZnJvbUpTT04uY2FsbCggdGhpcywganNvbiApOwoKCQl0aGlzLnYwLmZyb21BcnJheSgganNvbi52MCApOwoJCXRoaXMudjEuZnJvbUFycmF5KCBqc29uLnYxICk7CgkJdGhpcy52Mi5mcm9tQXJyYXkoIGpzb24udjIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCglmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMoIHYwLCB2MSwgdjIgKSB7CgoJCUN1cnZlLmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ1F1YWRyYXRpY0JlemllckN1cnZlMyc7CgoJCXRoaXMudjAgPSB2MCB8fCBuZXcgVmVjdG9yMygpOwoJCXRoaXMudjEgPSB2MSB8fCBuZXcgVmVjdG9yMygpOwoJCXRoaXMudjIgPSB2MiB8fCBuZXcgVmVjdG9yMygpOwoKCX0KCglRdWFkcmF0aWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ3VydmUucHJvdG90eXBlICk7CglRdWFkcmF0aWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUXVhZHJhdGljQmV6aWVyQ3VydmUzOwoKCVF1YWRyYXRpY0JlemllckN1cnZlMy5wcm90b3R5cGUuaXNRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgPSB0cnVlOwoKCVF1YWRyYXRpY0JlemllckN1cnZlMy5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMygpOwoKCQl2YXIgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MjsKCgkJcG9pbnQuc2V0KAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLnggKSwKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC55LCB2MS55LCB2Mi55ICksCgkJCVF1YWRyYXRpY0JlemllciggdCwgdjAueiwgdjEueiwgdjIueiApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX07CgoJUXVhZHJhdGljQmV6aWVyQ3VydmUzLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCUN1cnZlLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQl0aGlzLnYwLmNvcHkoIHNvdXJjZS52MCApOwoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCglRdWFkcmF0aWNCZXppZXJDdXJ2ZTMucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX07CgoJUXVhZHJhdGljQmV6aWVyQ3VydmUzLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uICgganNvbiApIHsKCgkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJZnVuY3Rpb24gU3BsaW5lQ3VydmUoIHBvaW50cyAvKiBhcnJheSBvZiBWZWN0b3IyICovICkgewoKCQlDdXJ2ZS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdTcGxpbmVDdXJ2ZSc7CgoJCXRoaXMucG9pbnRzID0gcG9pbnRzIHx8IFtdOwoKCX0KCglTcGxpbmVDdXJ2ZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBDdXJ2ZS5wcm90b3R5cGUgKTsKCVNwbGluZUN1cnZlLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNwbGluZUN1cnZlOwoKCVNwbGluZUN1cnZlLnByb3RvdHlwZS5pc1NwbGluZUN1cnZlID0gdHJ1ZTsKCglTcGxpbmVDdXJ2ZS5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQl2YXIgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMigpOwoKCQl2YXIgcG9pbnRzID0gdGhpcy5wb2ludHM7CgkJdmFyIHAgPSAoIHBvaW50cy5sZW5ndGggLSAxICkgKiB0OwoKCQl2YXIgaW50UG9pbnQgPSBNYXRoLmZsb29yKCBwICk7CgkJdmFyIHdlaWdodCA9IHAgLSBpbnRQb2ludDsKCgkJdmFyIHAwID0gcG9pbnRzWyBpbnRQb2ludCA9PT0gMCA/IGludFBvaW50IDogaW50UG9pbnQgLSAxIF07CgkJdmFyIHAxID0gcG9pbnRzWyBpbnRQb2ludCBdOwoJCXZhciBwMiA9IHBvaW50c1sgaW50UG9pbnQgPiBwb2ludHMubGVuZ3RoIC0gMiA/IHBvaW50cy5sZW5ndGggLSAxIDogaW50UG9pbnQgKyAxIF07CgkJdmFyIHAzID0gcG9pbnRzWyBpbnRQb2ludCA+IHBvaW50cy5sZW5ndGggLSAzID8gcG9pbnRzLmxlbmd0aCAtIDEgOiBpbnRQb2ludCArIDIgXTsKCgkJcG9pbnQuc2V0KAoJCQlDYXRtdWxsUm9tKCB3ZWlnaHQsIHAwLngsIHAxLngsIHAyLngsIHAzLnggKSwKCQkJQ2F0bXVsbFJvbSggd2VpZ2h0LCBwMC55LCBwMS55LCBwMi55LCBwMy55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfTsKCglTcGxpbmVDdXJ2ZS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJdGhpcy5wb2ludHMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBsID0gc291cmNlLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdmFyIHBvaW50ID0gc291cmNlLnBvaW50c1sgaSBdOwoKCQkJdGhpcy5wb2ludHMucHVzaCggcG9pbnQuY2xvbmUoKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX07CgoJU3BsaW5lQ3VydmUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGRhdGEgPSBDdXJ2ZS5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMgKTsKCgkJZGF0YS5wb2ludHMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBsID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXZhciBwb2ludCA9IHRoaXMucG9pbnRzWyBpIF07CgkJCWRhdGEucG9pbnRzLnB1c2goIHBvaW50LnRvQXJyYXkoKSApOwoKCQl9CgoJCXJldHVybiBkYXRhOwoKCX07CgoJU3BsaW5lQ3VydmUucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKCBqc29uICkgewoKCQlDdXJ2ZS5wcm90b3R5cGUuZnJvbUpTT04uY2FsbCggdGhpcywganNvbiApOwoKCQl0aGlzLnBvaW50cyA9IFtdOwoKCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBqc29uLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdmFyIHBvaW50ID0ganNvbi5wb2ludHNbIGkgXTsKCQkJdGhpcy5wb2ludHMucHVzaCggbmV3IFZlY3RvcjIoKS5mcm9tQXJyYXkoIHBvaW50ICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCgoJdmFyIEN1cnZlcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlBcmNDdXJ2ZTogQXJjQ3VydmUsCgkJQ2F0bXVsbFJvbUN1cnZlMzogQ2F0bXVsbFJvbUN1cnZlMywKCQlDdWJpY0JlemllckN1cnZlOiBDdWJpY0JlemllckN1cnZlLAoJCUN1YmljQmV6aWVyQ3VydmUzOiBDdWJpY0JlemllckN1cnZlMywKCQlFbGxpcHNlQ3VydmU6IEVsbGlwc2VDdXJ2ZSwKCQlMaW5lQ3VydmU6IExpbmVDdXJ2ZSwKCQlMaW5lQ3VydmUzOiBMaW5lQ3VydmUzLAoJCVF1YWRyYXRpY0JlemllckN1cnZlOiBRdWFkcmF0aWNCZXppZXJDdXJ2ZSwKCQlRdWFkcmF0aWNCZXppZXJDdXJ2ZTM6IFF1YWRyYXRpY0JlemllckN1cnZlMywKCQlTcGxpbmVDdXJ2ZTogU3BsaW5lQ3VydmUKCX0pOwoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL3d3dy5sYWI0Z2FtZXMubmV0L3p6ODUvYmxvZwoJICoKCSAqKi8KCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCSAqCUN1cnZlZCBQYXRoIC0gYSBjdXJ2ZSBwYXRoIGlzIHNpbXBseSBhIGFycmF5IG9mIGNvbm5lY3RlZAoJICogIGN1cnZlcywgYnV0IHJldGFpbnMgdGhlIGFwaSBvZiBhIGN1cnZlCgkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJZnVuY3Rpb24gQ3VydmVQYXRoKCkgewoKCQlDdXJ2ZS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdDdXJ2ZVBhdGgnOwoKCQl0aGlzLmN1cnZlcyA9IFtdOwoJCXRoaXMuYXV0b0Nsb3NlID0gZmFsc2U7IC8vIEF1dG9tYXRpY2FsbHkgY2xvc2VzIHRoZSBwYXRoCgoJfQoKCUN1cnZlUGF0aC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBDdXJ2ZS5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogQ3VydmVQYXRoLAoKCQlhZGQ6IGZ1bmN0aW9uICggY3VydmUgKSB7CgoJCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQl9LAoKCQljbG9zZVBhdGg6IGZ1bmN0aW9uICgpIHsKCgkJCS8vIEFkZCBhIGxpbmUgY3VydmUgaWYgc3RhcnQgYW5kIGVuZCBvZiBsaW5lcyBhcmUgbm90IGNvbm5lY3RlZAoJCQl2YXIgc3RhcnRQb2ludCA9IHRoaXMuY3VydmVzWyAwIF0uZ2V0UG9pbnQoIDAgKTsKCQkJdmFyIGVuZFBvaW50ID0gdGhpcy5jdXJ2ZXNbIHRoaXMuY3VydmVzLmxlbmd0aCAtIDEgXS5nZXRQb2ludCggMSApOwoKCQkJaWYgKCAhIHN0YXJ0UG9pbnQuZXF1YWxzKCBlbmRQb2ludCApICkgewoKCQkJCXRoaXMuY3VydmVzLnB1c2goIG5ldyBMaW5lQ3VydmUoIGVuZFBvaW50LCBzdGFydFBvaW50ICkgKTsKCgkJCX0KCgkJfSwKCgkJLy8gVG8gZ2V0IGFjY3VyYXRlIHBvaW50IHdpdGggcmVmZXJlbmNlIHRvCgkJLy8gZW50aXJlIHBhdGggZGlzdGFuY2UgYXQgdGltZSB0LAoJCS8vIGZvbGxvd2luZyBoYXMgdG8gYmUgZG9uZToKCgkJLy8gMS4gTGVuZ3RoIG9mIGVhY2ggc3ViIHBhdGggaGF2ZSB0byBiZSBrbm93bgoJCS8vIDIuIExvY2F0ZSBhbmQgaWRlbnRpZnkgdHlwZSBvZiBjdXJ2ZQoJCS8vIDMuIEdldCB0IGZvciB0aGUgY3VydmUKCQkvLyA0LiBSZXR1cm4gY3VydmUuZ2V0UG9pbnRBdCh0JykKCgkJZ2V0UG9pbnQ6IGZ1bmN0aW9uICggdCApIHsKCgkJCXZhciBkID0gdCAqIHRoaXMuZ2V0TGVuZ3RoKCk7CgkJCXZhciBjdXJ2ZUxlbmd0aHMgPSB0aGlzLmdldEN1cnZlTGVuZ3RocygpOwoJCQl2YXIgaSA9IDA7CgoJCQkvLyBUbyB0aGluayBhYm91dCBib3VuZGFyaWVzIHBvaW50cy4KCgkJCXdoaWxlICggaSA8IGN1cnZlTGVuZ3Rocy5sZW5ndGggKSB7CgoJCQkJaWYgKCBjdXJ2ZUxlbmd0aHNbIGkgXSA+PSBkICkgewoKCQkJCQl2YXIgZGlmZiA9IGN1cnZlTGVuZ3Roc1sgaSBdIC0gZDsKCQkJCQl2YXIgY3VydmUgPSB0aGlzLmN1cnZlc1sgaSBdOwoKCQkJCQl2YXIgc2VnbWVudExlbmd0aCA9IGN1cnZlLmdldExlbmd0aCgpOwoJCQkJCXZhciB1ID0gc2VnbWVudExlbmd0aCA9PT0gMCA/IDAgOiAxIC0gZGlmZiAvIHNlZ21lbnRMZW5ndGg7CgoJCQkJCXJldHVybiBjdXJ2ZS5nZXRQb2ludEF0KCB1ICk7CgoJCQkJfQoKCQkJCWkgKys7CgoJCQl9CgoJCQlyZXR1cm4gbnVsbDsKCgkJCS8vIGxvb3Agd2hlcmUgc3VtICE9IDAsIHN1bSA+IGQgLCBzdW0rMSA8ZAoKCQl9LAoKCQkvLyBXZSBjYW5ub3QgdXNlIHRoZSBkZWZhdWx0IFRIUkVFLkN1cnZlIGdldFBvaW50KCkgd2l0aCBnZXRMZW5ndGgoKSBiZWNhdXNlIGluCgkJLy8gVEhSRUUuQ3VydmUsIGdldExlbmd0aCgpIGRlcGVuZHMgb24gZ2V0UG9pbnQoKSBidXQgaW4gVEhSRUUuQ3VydmVQYXRoCgkJLy8gZ2V0UG9pbnQoKSBkZXBlbmRzIG9uIGdldExlbmd0aAoKCQlnZXRMZW5ndGg6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBsZW5zID0gdGhpcy5nZXRDdXJ2ZUxlbmd0aHMoKTsKCQkJcmV0dXJuIGxlbnNbIGxlbnMubGVuZ3RoIC0gMSBdOwoKCQl9LAoKCQkvLyBjYWNoZUxlbmd0aHMgbXVzdCBiZSByZWNhbGN1bGF0ZWQuCgkJdXBkYXRlQXJjTGVuZ3RoczogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCXRoaXMuY2FjaGVMZW5ndGhzID0gbnVsbDsKCQkJdGhpcy5nZXRDdXJ2ZUxlbmd0aHMoKTsKCgkJfSwKCgkJLy8gQ29tcHV0ZSBsZW5ndGhzIGFuZCBjYWNoZSB0aGVtCgkJLy8gV2UgY2Fubm90IG92ZXJ3cml0ZSBnZXRMZW5ndGhzKCkgYmVjYXVzZSBVdG9UIG1hcHBpbmcgdXNlcyBpdC4KCgkJZ2V0Q3VydmVMZW5ndGhzOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBXZSB1c2UgY2FjaGUgdmFsdWVzIGlmIGN1cnZlcyBhbmQgY2FjaGUgYXJyYXkgYXJlIHNhbWUgbGVuZ3RoCgoJCQlpZiAoIHRoaXMuY2FjaGVMZW5ndGhzICYmIHRoaXMuY2FjaGVMZW5ndGhzLmxlbmd0aCA9PT0gdGhpcy5jdXJ2ZXMubGVuZ3RoICkgewoKCQkJCXJldHVybiB0aGlzLmNhY2hlTGVuZ3RoczsKCgkJCX0KCgkJCS8vIEdldCBsZW5ndGggb2Ygc3ViLWN1cnZlCgkJCS8vIFB1c2ggc3VtcyBpbnRvIGNhY2hlZCBhcnJheQoKCQkJdmFyIGxlbmd0aHMgPSBbXSwgc3VtcyA9IDA7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLmN1cnZlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXN1bXMgKz0gdGhpcy5jdXJ2ZXNbIGkgXS5nZXRMZW5ndGgoKTsKCQkJCWxlbmd0aHMucHVzaCggc3VtcyApOwoKCQkJfQoKCQkJdGhpcy5jYWNoZUxlbmd0aHMgPSBsZW5ndGhzOwoKCQkJcmV0dXJuIGxlbmd0aHM7CgoJCX0sCgoJCWdldFNwYWNlZFBvaW50czogZnVuY3Rpb24gKCBkaXZpc2lvbnMgKSB7CgoJCQlpZiAoIGRpdmlzaW9ucyA9PT0gdW5kZWZpbmVkICkgZGl2aXNpb25zID0gNDA7CgoJCQl2YXIgcG9pbnRzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPD0gZGl2aXNpb25zOyBpICsrICkgewoKCQkJCXBvaW50cy5wdXNoKCB0aGlzLmdldFBvaW50KCBpIC8gZGl2aXNpb25zICkgKTsKCgkJCX0KCgkJCWlmICggdGhpcy5hdXRvQ2xvc2UgKSB7CgoJCQkJcG9pbnRzLnB1c2goIHBvaW50c1sgMCBdICk7CgoJCQl9CgoJCQlyZXR1cm4gcG9pbnRzOwoKCQl9LAoKCQlnZXRQb2ludHM6IGZ1bmN0aW9uICggZGl2aXNpb25zICkgewoKCQkJZGl2aXNpb25zID0gZGl2aXNpb25zIHx8IDEyOwoKCQkJdmFyIHBvaW50cyA9IFtdLCBsYXN0OwoKCQkJZm9yICggdmFyIGkgPSAwLCBjdXJ2ZXMgPSB0aGlzLmN1cnZlczsgaSA8IGN1cnZlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGN1cnZlID0gY3VydmVzWyBpIF07CgkJCQl2YXIgcmVzb2x1dGlvbiA9ICggY3VydmUgJiYgY3VydmUuaXNFbGxpcHNlQ3VydmUgKSA/IGRpdmlzaW9ucyAqIDIKCQkJCQk6ICggY3VydmUgJiYgKCBjdXJ2ZS5pc0xpbmVDdXJ2ZSB8fCBjdXJ2ZS5pc0xpbmVDdXJ2ZTMgKSApID8gMQoJCQkJCQk6ICggY3VydmUgJiYgY3VydmUuaXNTcGxpbmVDdXJ2ZSApID8gZGl2aXNpb25zICogY3VydmUucG9pbnRzLmxlbmd0aAoJCQkJCQkJOiBkaXZpc2lvbnM7CgoJCQkJdmFyIHB0cyA9IGN1cnZlLmdldFBvaW50cyggcmVzb2x1dGlvbiApOwoKCQkJCWZvciAoIHZhciBqID0gMDsgaiA8IHB0cy5sZW5ndGg7IGogKysgKSB7CgoJCQkJCXZhciBwb2ludCA9IHB0c1sgaiBdOwoKCQkJCQlpZiAoIGxhc3QgJiYgbGFzdC5lcXVhbHMoIHBvaW50ICkgKSBjb250aW51ZTsgLy8gZW5zdXJlcyBubyBjb25zZWN1dGl2ZSBwb2ludHMgYXJlIGR1cGxpY2F0ZXMKCgkJCQkJcG9pbnRzLnB1c2goIHBvaW50ICk7CgkJCQkJbGFzdCA9IHBvaW50OwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGhpcy5hdXRvQ2xvc2UgJiYgcG9pbnRzLmxlbmd0aCA+IDEgJiYgISBwb2ludHNbIHBvaW50cy5sZW5ndGggLSAxIF0uZXF1YWxzKCBwb2ludHNbIDAgXSApICkgewoKCQkJCXBvaW50cy5wdXNoKCBwb2ludHNbIDAgXSApOwoKCQkJfQoKCQkJcmV0dXJuIHBvaW50czsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQlDdXJ2ZS5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJCXRoaXMuY3VydmVzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBzb3VyY2UuY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGN1cnZlID0gc291cmNlLmN1cnZlc1sgaSBdOwoKCQkJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlLmNsb25lKCkgKTsKCgkJCX0KCgkJCXRoaXMuYXV0b0Nsb3NlID0gc291cmNlLmF1dG9DbG9zZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBkYXRhID0gQ3VydmUucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCQlkYXRhLmF1dG9DbG9zZSA9IHRoaXMuYXV0b0Nsb3NlOwoJCQlkYXRhLmN1cnZlcyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gdGhpcy5jdXJ2ZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl2YXIgY3VydmUgPSB0aGlzLmN1cnZlc1sgaSBdOwoJCQkJZGF0YS5jdXJ2ZXMucHVzaCggY3VydmUudG9KU09OKCkgKTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQlmcm9tSlNPTjogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJQ3VydmUucHJvdG90eXBlLmZyb21KU09OLmNhbGwoIHRoaXMsIGpzb24gKTsKCgkJCXRoaXMuYXV0b0Nsb3NlID0ganNvbi5hdXRvQ2xvc2U7CgkJCXRoaXMuY3VydmVzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBqc29uLmN1cnZlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBjdXJ2ZSA9IGpzb24uY3VydmVzWyBpIF07CgkJCQl0aGlzLmN1cnZlcy5wdXNoKCBuZXcgQ3VydmVzWyBjdXJ2ZS50eXBlIF0oKS5mcm9tSlNPTiggY3VydmUgKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIHp6ODUgLyBodHRwOi8vd3d3LmxhYjRnYW1lcy5uZXQveno4NS9ibG9nCgkgKiBDcmVhdGVzIGZyZWUgZm9ybSAyZCBwYXRoIHVzaW5nIHNlcmllcyBvZiBwb2ludHMsIGxpbmVzIG9yIGN1cnZlcy4KCSAqKi8KCglmdW5jdGlvbiBQYXRoKCBwb2ludHMgKSB7CgoJCUN1cnZlUGF0aC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdQYXRoJzsKCgkJdGhpcy5jdXJyZW50UG9pbnQgPSBuZXcgVmVjdG9yMigpOwoKCQlpZiAoIHBvaW50cyApIHsKCgkJCXRoaXMuc2V0RnJvbVBvaW50cyggcG9pbnRzICk7CgoJCX0KCgl9CgoJUGF0aC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBDdXJ2ZVBhdGgucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFBhdGgsCgoJCXNldEZyb21Qb2ludHM6IGZ1bmN0aW9uICggcG9pbnRzICkgewoKCQkJdGhpcy5tb3ZlVG8oIHBvaW50c1sgMCBdLngsIHBvaW50c1sgMCBdLnkgKTsKCgkJCWZvciAoIHZhciBpID0gMSwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXRoaXMubGluZVRvKCBwb2ludHNbIGkgXS54LCBwb2ludHNbIGkgXS55ICk7CgoJCQl9CgoJCX0sCgoJCW1vdmVUbzogZnVuY3Rpb24gKCB4LCB5ICkgewoKCQkJdGhpcy5jdXJyZW50UG9pbnQuc2V0KCB4LCB5ICk7IC8vIFRPRE8gY29uc2lkZXIgcmVmZXJlbmNpbmcgdmVjdG9ycyBpbnN0ZWFkIG9mIGNvcHlpbmc/CgoJCX0sCgoJCWxpbmVUbzogZnVuY3Rpb24gKCB4LCB5ICkgewoKCQkJdmFyIGN1cnZlID0gbmV3IExpbmVDdXJ2ZSggdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSwgbmV3IFZlY3RvcjIoIHgsIHkgKSApOwoJCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQkJdGhpcy5jdXJyZW50UG9pbnQuc2V0KCB4LCB5ICk7CgoJCX0sCgoJCXF1YWRyYXRpY0N1cnZlVG86IGZ1bmN0aW9uICggYUNQeCwgYUNQeSwgYVgsIGFZICkgewoKCQkJdmFyIGN1cnZlID0gbmV3IFF1YWRyYXRpY0JlemllckN1cnZlKAoJCQkJdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSwKCQkJCW5ldyBWZWN0b3IyKCBhQ1B4LCBhQ1B5ICksCgkJCQluZXcgVmVjdG9yMiggYVgsIGFZICkKCQkJKTsKCgkJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIGFYLCBhWSApOwoKCQl9LAoKCQliZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbiAoIGFDUDF4LCBhQ1AxeSwgYUNQMngsIGFDUDJ5LCBhWCwgYVkgKSB7CgoJCQl2YXIgY3VydmUgPSBuZXcgQ3ViaWNCZXppZXJDdXJ2ZSgKCQkJCXRoaXMuY3VycmVudFBvaW50LmNsb25lKCksCgkJCQluZXcgVmVjdG9yMiggYUNQMXgsIGFDUDF5ICksCgkJCQluZXcgVmVjdG9yMiggYUNQMngsIGFDUDJ5ICksCgkJCQluZXcgVmVjdG9yMiggYVgsIGFZICkKCQkJKTsKCgkJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIGFYLCBhWSApOwoKCQl9LAoKCQlzcGxpbmVUaHJ1OiBmdW5jdGlvbiAoIHB0cyAvKkFycmF5IG9mIFZlY3RvciovICkgewoKCQkJdmFyIG5wdHMgPSBbIHRoaXMuY3VycmVudFBvaW50LmNsb25lKCkgXS5jb25jYXQoIHB0cyApOwoKCQkJdmFyIGN1cnZlID0gbmV3IFNwbGluZUN1cnZlKCBucHRzICk7CgkJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCQl0aGlzLmN1cnJlbnRQb2ludC5jb3B5KCBwdHNbIHB0cy5sZW5ndGggLSAxIF0gKTsKCgkJfSwKCgkJYXJjOiBmdW5jdGlvbiAoIGFYLCBhWSwgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApIHsKCgkJCXZhciB4MCA9IHRoaXMuY3VycmVudFBvaW50Lng7CgkJCXZhciB5MCA9IHRoaXMuY3VycmVudFBvaW50Lnk7CgoJCQl0aGlzLmFic2FyYyggYVggKyB4MCwgYVkgKyB5MCwgYVJhZGl1cywKCQkJCWFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKTsKCgkJfSwKCgkJYWJzYXJjOiBmdW5jdGlvbiAoIGFYLCBhWSwgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApIHsKCgkJCXRoaXMuYWJzZWxsaXBzZSggYVgsIGFZLCBhUmFkaXVzLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlICk7CgoJCX0sCgoJCWVsbGlwc2U6IGZ1bmN0aW9uICggYVgsIGFZLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24gKSB7CgoJCQl2YXIgeDAgPSB0aGlzLmN1cnJlbnRQb2ludC54OwoJCQl2YXIgeTAgPSB0aGlzLmN1cnJlbnRQb2ludC55OwoKCQkJdGhpcy5hYnNlbGxpcHNlKCBhWCArIHgwLCBhWSArIHkwLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24gKTsKCgkJfSwKCgkJYWJzZWxsaXBzZTogZnVuY3Rpb24gKCBhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbiApIHsKCgkJCXZhciBjdXJ2ZSA9IG5ldyBFbGxpcHNlQ3VydmUoIGFYLCBhWSwgeFJhZGl1cywgeVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSwgYVJvdGF0aW9uICk7CgoJCQlpZiAoIHRoaXMuY3VydmVzLmxlbmd0aCA+IDAgKSB7CgoJCQkJLy8gaWYgYSBwcmV2aW91cyBjdXJ2ZSBpcyBwcmVzZW50LCBhdHRlbXB0IHRvIGpvaW4KCQkJCXZhciBmaXJzdFBvaW50ID0gY3VydmUuZ2V0UG9pbnQoIDAgKTsKCgkJCQlpZiAoICEgZmlyc3RQb2ludC5lcXVhbHMoIHRoaXMuY3VycmVudFBvaW50ICkgKSB7CgoJCQkJCXRoaXMubGluZVRvKCBmaXJzdFBvaW50LngsIGZpcnN0UG9pbnQueSApOwoKCQkJCX0KCgkJCX0KCgkJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCQl2YXIgbGFzdFBvaW50ID0gY3VydmUuZ2V0UG9pbnQoIDEgKTsKCQkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggbGFzdFBvaW50ICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJQ3VydmVQYXRoLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggc291cmNlLmN1cnJlbnRQb2ludCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGRhdGEgPSBDdXJ2ZVBhdGgucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzICk7CgoJCQlkYXRhLmN1cnJlbnRQb2ludCA9IHRoaXMuY3VycmVudFBvaW50LnRvQXJyYXkoKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQlmcm9tSlNPTjogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJQ3VydmVQYXRoLnByb3RvdHlwZS5mcm9tSlNPTi5jYWxsKCB0aGlzLCBqc29uICk7CgoJCQl0aGlzLmN1cnJlbnRQb2ludC5mcm9tQXJyYXkoIGpzb24uY3VycmVudFBvaW50ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3Igeno4NSAvIGh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2cKCSAqIERlZmluZXMgYSAyZCBzaGFwZSBwbGFuZSB1c2luZyBwYXRocy4KCSAqKi8KCgkvLyBTVEVQIDEgQ3JlYXRlIGEgcGF0aC4KCS8vIFNURVAgMiBUdXJuIHBhdGggaW50byBzaGFwZS4KCS8vIFNURVAgMyBFeHRydWRlR2VvbWV0cnkgdGFrZXMgaW4gU2hhcGUvU2hhcGVzCgkvLyBTVEVQIDNhIC0gRXh0cmFjdCBwb2ludHMgZnJvbSBlYWNoIHNoYXBlLCB0dXJuIHRvIHZlcnRpY2VzCgkvLyBTVEVQIDNiIC0gVHJpYW5ndWxhdGUgZWFjaCBzaGFwZSwgYWRkIGZhY2VzLgoKCWZ1bmN0aW9uIFNoYXBlKCBwb2ludHMgKSB7CgoJCVBhdGguY2FsbCggdGhpcywgcG9pbnRzICk7CgoJCXRoaXMudXVpZCA9IF9NYXRoLmdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLnR5cGUgPSAnU2hhcGUnOwoKCQl0aGlzLmhvbGVzID0gW107CgoJfQoKCVNoYXBlLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIFBhdGgucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFNoYXBlLAoKCQlnZXRQb2ludHNIb2xlczogZnVuY3Rpb24gKCBkaXZpc2lvbnMgKSB7CgoJCQl2YXIgaG9sZXNQdHMgPSBbXTsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IHRoaXMuaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlob2xlc1B0c1sgaSBdID0gdGhpcy5ob2xlc1sgaSBdLmdldFBvaW50cyggZGl2aXNpb25zICk7CgoJCQl9CgoJCQlyZXR1cm4gaG9sZXNQdHM7CgoJCX0sCgoJCS8vIGdldCBwb2ludHMgb2Ygc2hhcGUgYW5kIGhvbGVzIChrZXlwb2ludHMgYmFzZWQgb24gc2VnbWVudHMgcGFyYW1ldGVyKQoKCQlleHRyYWN0UG9pbnRzOiBmdW5jdGlvbiAoIGRpdmlzaW9ucyApIHsKCgkJCXJldHVybiB7CgoJCQkJc2hhcGU6IHRoaXMuZ2V0UG9pbnRzKCBkaXZpc2lvbnMgKSwKCQkJCWhvbGVzOiB0aGlzLmdldFBvaW50c0hvbGVzKCBkaXZpc2lvbnMgKQoKCQkJfTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQlQYXRoLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5ob2xlcyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc291cmNlLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGhvbGUgPSBzb3VyY2UuaG9sZXNbIGkgXTsKCgkJCQl0aGlzLmhvbGVzLnB1c2goIGhvbGUuY2xvbmUoKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGRhdGEgPSBQYXRoLnByb3RvdHlwZS50b0pTT04uY2FsbCggdGhpcyApOwoKCQkJZGF0YS51dWlkID0gdGhpcy51dWlkOwoJCQlkYXRhLmhvbGVzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGhvbGUgPSB0aGlzLmhvbGVzWyBpIF07CgkJCQlkYXRhLmhvbGVzLnB1c2goIGhvbGUudG9KU09OKCkgKTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9LAoKCQlmcm9tSlNPTjogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJUGF0aC5wcm90b3R5cGUuZnJvbUpTT04uY2FsbCggdGhpcywganNvbiApOwoKCQkJdGhpcy51dWlkID0ganNvbi51dWlkOwoJCQl0aGlzLmhvbGVzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBqc29uLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGhvbGUgPSBqc29uLmhvbGVzWyBpIF07CgkJCQl0aGlzLmhvbGVzLnB1c2goIG5ldyBQYXRoKCkuZnJvbUpTT04oIGhvbGUgKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIExpZ2h0KCBjb2xvciwgaW50ZW5zaXR5ICkgewoKCQlPYmplY3QzRC5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdMaWdodCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIGNvbG9yICk7CgkJdGhpcy5pbnRlbnNpdHkgPSBpbnRlbnNpdHkgIT09IHVuZGVmaW5lZCA/IGludGVuc2l0eSA6IDE7CgoJCXRoaXMucmVjZWl2ZVNoYWRvdyA9IHVuZGVmaW5lZDsKCgl9CgoJTGlnaHQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IExpZ2h0LAoKCQlpc0xpZ2h0OiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCU9iamVjdDNELnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCQkJdGhpcy5pbnRlbnNpdHkgPSBzb3VyY2UuaW50ZW5zaXR5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCBtZXRhICkgewoKCQkJdmFyIGRhdGEgPSBPYmplY3QzRC5wcm90b3R5cGUudG9KU09OLmNhbGwoIHRoaXMsIG1ldGEgKTsKCgkJCWRhdGEub2JqZWN0LmNvbG9yID0gdGhpcy5jb2xvci5nZXRIZXgoKTsKCQkJZGF0YS5vYmplY3QuaW50ZW5zaXR5ID0gdGhpcy5pbnRlbnNpdHk7CgoJCQlpZiAoIHRoaXMuZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0Lmdyb3VuZENvbG9yID0gdGhpcy5ncm91bmRDb2xvci5nZXRIZXgoKTsKCgkJCWlmICggdGhpcy5kaXN0YW5jZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3QuZGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlOwoJCQlpZiAoIHRoaXMuYW5nbGUgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmFuZ2xlID0gdGhpcy5hbmdsZTsKCQkJaWYgKCB0aGlzLmRlY2F5ICE9PSB1bmRlZmluZWQgKSBkYXRhLm9iamVjdC5kZWNheSA9IHRoaXMuZGVjYXk7CgkJCWlmICggdGhpcy5wZW51bWJyYSAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3QucGVudW1icmEgPSB0aGlzLnBlbnVtYnJhOwoKCQkJaWYgKCB0aGlzLnNoYWRvdyAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3Quc2hhZG93ID0gdGhpcy5zaGFkb3cudG9KU09OKCk7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKi8KCglmdW5jdGlvbiBIZW1pc3BoZXJlTGlnaHQoIHNreUNvbG9yLCBncm91bmRDb2xvciwgaW50ZW5zaXR5ICkgewoKCQlMaWdodC5jYWxsKCB0aGlzLCBza3lDb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMudHlwZSA9ICdIZW1pc3BoZXJlTGlnaHQnOwoKCQl0aGlzLmNhc3RTaGFkb3cgPSB1bmRlZmluZWQ7CgoJCXRoaXMucG9zaXRpb24uY29weSggT2JqZWN0M0QuRGVmYXVsdFVwICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5ncm91bmRDb2xvciA9IG5ldyBDb2xvciggZ3JvdW5kQ29sb3IgKTsKCgl9CgoJSGVtaXNwaGVyZUxpZ2h0LnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIExpZ2h0LnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBIZW1pc3BoZXJlTGlnaHQsCgoJCWlzSGVtaXNwaGVyZUxpZ2h0OiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCUxpZ2h0LnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5ncm91bmRDb2xvci5jb3B5KCBzb3VyY2UuZ3JvdW5kQ29sb3IgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIExpZ2h0U2hhZG93KCBjYW1lcmEgKSB7CgoJCXRoaXMuY2FtZXJhID0gY2FtZXJhOwoKCQl0aGlzLmJpYXMgPSAwOwoJCXRoaXMucmFkaXVzID0gMTsKCgkJdGhpcy5tYXBTaXplID0gbmV3IFZlY3RvcjIoIDUxMiwgNTEyICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgoJfQoKCU9iamVjdC5hc3NpZ24oIExpZ2h0U2hhZG93LnByb3RvdHlwZSwgewoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCXRoaXMuY2FtZXJhID0gc291cmNlLmNhbWVyYS5jbG9uZSgpOwoKCQkJdGhpcy5iaWFzID0gc291cmNlLmJpYXM7CgkJCXRoaXMucmFkaXVzID0gc291cmNlLnJhZGl1czsKCgkJCXRoaXMubWFwU2l6ZS5jb3B5KCBzb3VyY2UubWFwU2l6ZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCXRvSlNPTjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG9iamVjdCA9IHt9OwoKCQkJaWYgKCB0aGlzLmJpYXMgIT09IDAgKSBvYmplY3QuYmlhcyA9IHRoaXMuYmlhczsKCQkJaWYgKCB0aGlzLnJhZGl1cyAhPT0gMSApIG9iamVjdC5yYWRpdXMgPSB0aGlzLnJhZGl1czsKCQkJaWYgKCB0aGlzLm1hcFNpemUueCAhPT0gNTEyIHx8IHRoaXMubWFwU2l6ZS55ICE9PSA1MTIgKSBvYmplY3QubWFwU2l6ZSA9IHRoaXMubWFwU2l6ZS50b0FycmF5KCk7CgoJCQlvYmplY3QuY2FtZXJhID0gdGhpcy5jYW1lcmEudG9KU09OKCBmYWxzZSApLm9iamVjdDsKCQkJZGVsZXRlIG9iamVjdC5jYW1lcmEubWF0cml4OwoKCQkJcmV0dXJuIG9iamVjdDsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBTcG90TGlnaHRTaGFkb3coKSB7CgoJCUxpZ2h0U2hhZG93LmNhbGwoIHRoaXMsIG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggNTAsIDEsIDAuNSwgNTAwICkgKTsKCgl9CgoJU3BvdExpZ2h0U2hhZG93LnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIExpZ2h0U2hhZG93LnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBTcG90TGlnaHRTaGFkb3csCgoJCWlzU3BvdExpZ2h0U2hhZG93OiB0cnVlLAoKCQl1cGRhdGU6IGZ1bmN0aW9uICggbGlnaHQgKSB7CgoJCQl2YXIgY2FtZXJhID0gdGhpcy5jYW1lcmE7CgoJCQl2YXIgZm92ID0gX01hdGguUkFEMkRFRyAqIDIgKiBsaWdodC5hbmdsZTsKCQkJdmFyIGFzcGVjdCA9IHRoaXMubWFwU2l6ZS53aWR0aCAvIHRoaXMubWFwU2l6ZS5oZWlnaHQ7CgkJCXZhciBmYXIgPSBsaWdodC5kaXN0YW5jZSB8fCBjYW1lcmEuZmFyOwoKCQkJaWYgKCBmb3YgIT09IGNhbWVyYS5mb3YgfHwgYXNwZWN0ICE9PSBjYW1lcmEuYXNwZWN0IHx8IGZhciAhPT0gY2FtZXJhLmZhciApIHsKCgkJCQljYW1lcmEuZm92ID0gZm92OwoJCQkJY2FtZXJhLmFzcGVjdCA9IGFzcGVjdDsKCQkJCWNhbWVyYS5mYXIgPSBmYXI7CgkJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQkJfQoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFNwb3RMaWdodCggY29sb3IsIGludGVuc2l0eSwgZGlzdGFuY2UsIGFuZ2xlLCBwZW51bWJyYSwgZGVjYXkgKSB7CgoJCUxpZ2h0LmNhbGwoIHRoaXMsIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy50eXBlID0gJ1Nwb3RMaWdodCc7CgoJCXRoaXMucG9zaXRpb24uY29weSggT2JqZWN0M0QuRGVmYXVsdFVwICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy50YXJnZXQgPSBuZXcgT2JqZWN0M0QoKTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAncG93ZXInLCB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCS8vIGludGVuc2l0eSA9IHBvd2VyIHBlciBzb2xpZCBhbmdsZS4KCQkJCS8vIHJlZjogZXF1YXRpb24gKDE3KSBmcm9tIGh0dHBzOi8vc2VibGFnYXJkZS5maWxlcy53b3JkcHJlc3MuY29tLzIwMTUvMDcvY291cnNlX25vdGVzX21vdmluZ19mcm9zdGJpdGVfdG9fcGJyX3YzMi5wZGYKCQkJCXJldHVybiB0aGlzLmludGVuc2l0eSAqIE1hdGguUEk7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggcG93ZXIgKSB7CgoJCQkJLy8gaW50ZW5zaXR5ID0gcG93ZXIgcGVyIHNvbGlkIGFuZ2xlLgoJCQkJLy8gcmVmOiBlcXVhdGlvbiAoMTcpIGZyb20gaHR0cHM6Ly9zZWJsYWdhcmRlLmZpbGVzLndvcmRwcmVzcy5jb20vMjAxNS8wNy9jb3Vyc2Vfbm90ZXNfbW92aW5nX2Zyb3N0Yml0ZV90b19wYnJfdjMyLnBkZgoJCQkJdGhpcy5pbnRlbnNpdHkgPSBwb3dlciAvIE1hdGguUEk7CgoJCQl9CgkJfSApOwoKCQl0aGlzLmRpc3RhbmNlID0gKCBkaXN0YW5jZSAhPT0gdW5kZWZpbmVkICkgPyBkaXN0YW5jZSA6IDA7CgkJdGhpcy5hbmdsZSA9ICggYW5nbGUgIT09IHVuZGVmaW5lZCApID8gYW5nbGUgOiBNYXRoLlBJIC8gMzsKCQl0aGlzLnBlbnVtYnJhID0gKCBwZW51bWJyYSAhPT0gdW5kZWZpbmVkICkgPyBwZW51bWJyYSA6IDA7CgkJdGhpcy5kZWNheSA9ICggZGVjYXkgIT09IHVuZGVmaW5lZCApID8gZGVjYXkgOiAxOwkvLyBmb3IgcGh5c2ljYWxseSBjb3JyZWN0IGxpZ2h0cywgc2hvdWxkIGJlIDIuCgoJCXRoaXMuc2hhZG93ID0gbmV3IFNwb3RMaWdodFNoYWRvdygpOwoKCX0KCglTcG90TGlnaHQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggTGlnaHQucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFNwb3RMaWdodCwKCgkJaXNTcG90TGlnaHQ6IHRydWUsCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJTGlnaHQucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCQl0aGlzLmRpc3RhbmNlID0gc291cmNlLmRpc3RhbmNlOwoJCQl0aGlzLmFuZ2xlID0gc291cmNlLmFuZ2xlOwoJCQl0aGlzLnBlbnVtYnJhID0gc291cmNlLnBlbnVtYnJhOwoJCQl0aGlzLmRlY2F5ID0gc291cmNlLmRlY2F5OwoKCQkJdGhpcy50YXJnZXQgPSBzb3VyY2UudGFyZ2V0LmNsb25lKCk7CgoJCQl0aGlzLnNoYWRvdyA9IHNvdXJjZS5zaGFkb3cuY2xvbmUoKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCglmdW5jdGlvbiBQb2ludExpZ2h0KCBjb2xvciwgaW50ZW5zaXR5LCBkaXN0YW5jZSwgZGVjYXkgKSB7CgoJCUxpZ2h0LmNhbGwoIHRoaXMsIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy50eXBlID0gJ1BvaW50TGlnaHQnOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdwb3dlcicsIHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJLy8gaW50ZW5zaXR5ID0gcG93ZXIgcGVyIHNvbGlkIGFuZ2xlLgoJCQkJLy8gcmVmOiBlcXVhdGlvbiAoMTUpIGZyb20gaHR0cHM6Ly9zZWJsYWdhcmRlLmZpbGVzLndvcmRwcmVzcy5jb20vMjAxNS8wNy9jb3Vyc2Vfbm90ZXNfbW92aW5nX2Zyb3N0Yml0ZV90b19wYnJfdjMyLnBkZgoJCQkJcmV0dXJuIHRoaXMuaW50ZW5zaXR5ICogNCAqIE1hdGguUEk7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggcG93ZXIgKSB7CgoJCQkJLy8gaW50ZW5zaXR5ID0gcG93ZXIgcGVyIHNvbGlkIGFuZ2xlLgoJCQkJLy8gcmVmOiBlcXVhdGlvbiAoMTUpIGZyb20gaHR0cHM6Ly9zZWJsYWdhcmRlLmZpbGVzLndvcmRwcmVzcy5jb20vMjAxNS8wNy9jb3Vyc2Vfbm90ZXNfbW92aW5nX2Zyb3N0Yml0ZV90b19wYnJfdjMyLnBkZgoJCQkJdGhpcy5pbnRlbnNpdHkgPSBwb3dlciAvICggNCAqIE1hdGguUEkgKTsKCgkJCX0KCQl9ICk7CgoJCXRoaXMuZGlzdGFuY2UgPSAoIGRpc3RhbmNlICE9PSB1bmRlZmluZWQgKSA/IGRpc3RhbmNlIDogMDsKCQl0aGlzLmRlY2F5ID0gKCBkZWNheSAhPT0gdW5kZWZpbmVkICkgPyBkZWNheSA6IDE7CS8vIGZvciBwaHlzaWNhbGx5IGNvcnJlY3QgbGlnaHRzLCBzaG91bGQgYmUgMi4KCgkJdGhpcy5zaGFkb3cgPSBuZXcgTGlnaHRTaGFkb3coIG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggOTAsIDEsIDAuNSwgNTAwICkgKTsKCgl9CgoJUG9pbnRMaWdodC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBMaWdodC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogUG9pbnRMaWdodCwKCgkJaXNQb2ludExpZ2h0OiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCUxpZ2h0LnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5kaXN0YW5jZSA9IHNvdXJjZS5kaXN0YW5jZTsKCQkJdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKCgkJCXRoaXMuc2hhZG93ID0gc291cmNlLnNoYWRvdy5jbG9uZSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICogQGF1dGhvciBhcm9zZSAvIGh0dHA6Ly9naXRodWIuY29tL2Fyb3NlCgkgKi8KCglmdW5jdGlvbiBPcnRob2dyYXBoaWNDYW1lcmEoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgbmVhciwgZmFyICkgewoKCQlDYW1lcmEuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnT3J0aG9ncmFwaGljQ2FtZXJhJzsKCgkJdGhpcy56b29tID0gMTsKCQl0aGlzLnZpZXcgPSBudWxsOwoKCQl0aGlzLmxlZnQgPSAoIGxlZnQgIT09IHVuZGVmaW5lZCApID8gbGVmdCA6IC0gMTsKCQl0aGlzLnJpZ2h0ID0gKCByaWdodCAhPT0gdW5kZWZpbmVkICkgPyByaWdodCA6IDE7CgkJdGhpcy50b3AgPSAoIHRvcCAhPT0gdW5kZWZpbmVkICkgPyB0b3AgOiAxOwoJCXRoaXMuYm90dG9tID0gKCBib3R0b20gIT09IHVuZGVmaW5lZCApID8gYm90dG9tIDogLSAxOwoKCQl0aGlzLm5lYXIgPSAoIG5lYXIgIT09IHVuZGVmaW5lZCApID8gbmVhciA6IDAuMTsKCQl0aGlzLmZhciA9ICggZmFyICE9PSB1bmRlZmluZWQgKSA/IGZhciA6IDIwMDA7CgoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCglPcnRob2dyYXBoaWNDYW1lcmEucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggQ2FtZXJhLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBPcnRob2dyYXBoaWNDYW1lcmEsCgoJCWlzT3J0aG9ncmFwaGljQ2FtZXJhOiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJQ2FtZXJhLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCQl0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDsKCQkJdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKCQkJdGhpcy50b3AgPSBzb3VyY2UudG9wOwoJCQl0aGlzLmJvdHRvbSA9IHNvdXJjZS5ib3R0b207CgkJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwoJCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgoJCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCQkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0Vmlld09mZnNldDogZnVuY3Rpb24gKCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcgPSB7CgkJCQkJZW5hYmxlZDogdHJ1ZSwKCQkJCQlmdWxsV2lkdGg6IDEsCgkJCQkJZnVsbEhlaWdodDogMSwKCQkJCQlvZmZzZXRYOiAwLAoJCQkJCW9mZnNldFk6IDAsCgkJCQkJd2lkdGg6IDEsCgkJCQkJaGVpZ2h0OiAxCgkJCQl9OwoKCQkJfQoKCQkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwoJCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwoJCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJCXRoaXMudmlldy5vZmZzZXRYID0geDsKCQkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwoJCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9LAoKCQljbGVhclZpZXdPZmZzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKCQkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfSwKCgkJdXBkYXRlUHJvamVjdGlvbk1hdHJpeDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGR4ID0gKCB0aGlzLnJpZ2h0IC0gdGhpcy5sZWZ0ICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKCQkJdmFyIGR5ID0gKCB0aGlzLnRvcCAtIHRoaXMuYm90dG9tICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKCQkJdmFyIGN4ID0gKCB0aGlzLnJpZ2h0ICsgdGhpcy5sZWZ0ICkgLyAyOwoJCQl2YXIgY3kgPSAoIHRoaXMudG9wICsgdGhpcy5ib3R0b20gKSAvIDI7CgoJCQl2YXIgbGVmdCA9IGN4IC0gZHg7CgkJCXZhciByaWdodCA9IGN4ICsgZHg7CgkJCXZhciB0b3AgPSBjeSArIGR5OwoJCQl2YXIgYm90dG9tID0gY3kgLSBkeTsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICYmIHRoaXMudmlldy5lbmFibGVkICkgewoKCQkJCXZhciB6b29tVyA9IHRoaXMuem9vbSAvICggdGhpcy52aWV3LndpZHRoIC8gdGhpcy52aWV3LmZ1bGxXaWR0aCApOwoJCQkJdmFyIHpvb21IID0gdGhpcy56b29tIC8gKCB0aGlzLnZpZXcuaGVpZ2h0IC8gdGhpcy52aWV3LmZ1bGxIZWlnaHQgKTsKCQkJCXZhciBzY2FsZVcgPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvIHRoaXMudmlldy53aWR0aDsKCQkJCXZhciBzY2FsZUggPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvIHRoaXMudmlldy5oZWlnaHQ7CgoJCQkJbGVmdCArPSBzY2FsZVcgKiAoIHRoaXMudmlldy5vZmZzZXRYIC8gem9vbVcgKTsKCQkJCXJpZ2h0ID0gbGVmdCArIHNjYWxlVyAqICggdGhpcy52aWV3LndpZHRoIC8gem9vbVcgKTsKCQkJCXRvcCAtPSBzY2FsZUggKiAoIHRoaXMudmlldy5vZmZzZXRZIC8gem9vbUggKTsKCQkJCWJvdHRvbSA9IHRvcCAtIHNjYWxlSCAqICggdGhpcy52aWV3LmhlaWdodCAvIHpvb21IICk7CgoJCQl9CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCB0aGlzLm5lYXIsIHRoaXMuZmFyICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmdldEludmVyc2UoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggbWV0YSApIHsKCgkJCXZhciBkYXRhID0gT2JqZWN0M0QucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzLCBtZXRhICk7CgoJCQlkYXRhLm9iamVjdC56b29tID0gdGhpcy56b29tOwoJCQlkYXRhLm9iamVjdC5sZWZ0ID0gdGhpcy5sZWZ0OwoJCQlkYXRhLm9iamVjdC5yaWdodCA9IHRoaXMucmlnaHQ7CgkJCWRhdGEub2JqZWN0LnRvcCA9IHRoaXMudG9wOwoJCQlkYXRhLm9iamVjdC5ib3R0b20gPSB0aGlzLmJvdHRvbTsKCQkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQkJZGF0YS5vYmplY3QuZmFyID0gdGhpcy5mYXI7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIGRhdGEub2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgdGhpcy52aWV3ICk7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBEaXJlY3Rpb25hbExpZ2h0U2hhZG93KCApIHsKCgkJTGlnaHRTaGFkb3cuY2FsbCggdGhpcywgbmV3IE9ydGhvZ3JhcGhpY0NhbWVyYSggLSA1LCA1LCA1LCAtIDUsIDAuNSwgNTAwICkgKTsKCgl9CgoJRGlyZWN0aW9uYWxMaWdodFNoYWRvdy5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBMaWdodFNoYWRvdy5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogRGlyZWN0aW9uYWxMaWdodFNoYWRvdwoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gRGlyZWN0aW9uYWxMaWdodCggY29sb3IsIGludGVuc2l0eSApIHsKCgkJTGlnaHQuY2FsbCggdGhpcywgY29sb3IsIGludGVuc2l0eSApOwoKCQl0aGlzLnR5cGUgPSAnRGlyZWN0aW9uYWxMaWdodCc7CgoJCXRoaXMucG9zaXRpb24uY29weSggT2JqZWN0M0QuRGVmYXVsdFVwICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy50YXJnZXQgPSBuZXcgT2JqZWN0M0QoKTsKCgkJdGhpcy5zaGFkb3cgPSBuZXcgRGlyZWN0aW9uYWxMaWdodFNoYWRvdygpOwoKCX0KCglEaXJlY3Rpb25hbExpZ2h0LnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIExpZ2h0LnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBEaXJlY3Rpb25hbExpZ2h0LAoKCQlpc0RpcmVjdGlvbmFsTGlnaHQ6IHRydWUsCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJTGlnaHQucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCQl0aGlzLnRhcmdldCA9IHNvdXJjZS50YXJnZXQuY2xvbmUoKTsKCgkJCXRoaXMuc2hhZG93ID0gc291cmNlLnNoYWRvdy5jbG9uZSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gQW1iaWVudExpZ2h0KCBjb2xvciwgaW50ZW5zaXR5ICkgewoKCQlMaWdodC5jYWxsKCB0aGlzLCBjb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMudHlwZSA9ICdBbWJpZW50TGlnaHQnOwoKCQl0aGlzLmNhc3RTaGFkb3cgPSB1bmRlZmluZWQ7CgoJfQoKCUFtYmllbnRMaWdodC5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBMaWdodC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogQW1iaWVudExpZ2h0LAoKCQlpc0FtYmllbnRMaWdodDogdHJ1ZQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYWJlbG5hdGlvbiAvIGh0dHA6Ly9naXRodWIuY29tL2FiZWxuYXRpb24KCSAqLwoKCWZ1bmN0aW9uIFJlY3RBcmVhTGlnaHQoIGNvbG9yLCBpbnRlbnNpdHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCUxpZ2h0LmNhbGwoIHRoaXMsIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy50eXBlID0gJ1JlY3RBcmVhTGlnaHQnOwoKCQl0aGlzLndpZHRoID0gKCB3aWR0aCAhPT0gdW5kZWZpbmVkICkgPyB3aWR0aCA6IDEwOwoJCXRoaXMuaGVpZ2h0ID0gKCBoZWlnaHQgIT09IHVuZGVmaW5lZCApID8gaGVpZ2h0IDogMTA7CgoJfQoKCVJlY3RBcmVhTGlnaHQucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggTGlnaHQucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IFJlY3RBcmVhTGlnaHQsCgoJCWlzUmVjdEFyZWFMaWdodDogdHJ1ZSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQlMaWdodC5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJCXRoaXMud2lkdGggPSBzb3VyY2Uud2lkdGg7CgkJCXRoaXMuaGVpZ2h0ID0gc291cmNlLmhlaWdodDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl0b0pTT046IGZ1bmN0aW9uICggbWV0YSApIHsKCgkJCXZhciBkYXRhID0gTGlnaHQucHJvdG90eXBlLnRvSlNPTi5jYWxsKCB0aGlzLCBtZXRhICk7CgoJCQlkYXRhLm9iamVjdC53aWR0aCA9IHRoaXMud2lkdGg7CgkJCWRhdGEub2JqZWN0LmhlaWdodCA9IHRoaXMuaGVpZ2h0OwoKCQkJcmV0dXJuIGRhdGE7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gTWF0ZXJpYWxMb2FkZXIoIG1hbmFnZXIgKSB7CgoJCXRoaXMubWFuYWdlciA9ICggbWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyBtYW5hZ2VyIDogRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwoJCXRoaXMudGV4dHVyZXMgPSB7fTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggTWF0ZXJpYWxMb2FkZXIucHJvdG90eXBlLCB7CgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCBzY29wZS5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRQYXRoKCBzY29wZS5wYXRoICk7CgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggdGV4dCApIHsKCgkJCQlvbkxvYWQoIHNjb3BlLnBhcnNlKCBKU09OLnBhcnNlKCB0ZXh0ICkgKSApOwoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQl9LAoKCQlwYXJzZTogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJdmFyIHRleHR1cmVzID0gdGhpcy50ZXh0dXJlczsKCgkJCWZ1bmN0aW9uIGdldFRleHR1cmUoIG5hbWUgKSB7CgoJCQkJaWYgKCB0ZXh0dXJlc1sgbmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGVyaWFsTG9hZGVyOiBVbmRlZmluZWQgdGV4dHVyZScsIG5hbWUgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHRleHR1cmVzWyBuYW1lIF07CgoJCQl9CgoJCQl2YXIgbWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWxzWyBqc29uLnR5cGUgXSgpOwoKCQkJaWYgKCBqc29uLnV1aWQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnV1aWQgPSBqc29uLnV1aWQ7CgkJCWlmICgganNvbi5uYW1lICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5uYW1lID0ganNvbi5uYW1lOwoJCQlpZiAoIGpzb24uY29sb3IgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNvbG9yLnNldEhleCgganNvbi5jb2xvciApOwoJCQlpZiAoIGpzb24ucm91Z2huZXNzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5yb3VnaG5lc3MgPSBqc29uLnJvdWdobmVzczsKCQkJaWYgKCBqc29uLm1ldGFsbmVzcyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubWV0YWxuZXNzID0ganNvbi5tZXRhbG5lc3M7CgkJCWlmICgganNvbi5lbWlzc2l2ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW1pc3NpdmUuc2V0SGV4KCBqc29uLmVtaXNzaXZlICk7CgkJCWlmICgganNvbi5zcGVjdWxhciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXIuc2V0SGV4KCBqc29uLnNwZWN1bGFyICk7CgkJCWlmICgganNvbi5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoaW5pbmVzcyA9IGpzb24uc2hpbmluZXNzOwoJCQlpZiAoIGpzb24uY2xlYXJDb2F0ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jbGVhckNvYXQgPSBqc29uLmNsZWFyQ29hdDsKCQkJaWYgKCBqc29uLmNsZWFyQ29hdFJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuY2xlYXJDb2F0Um91Z2huZXNzID0ganNvbi5jbGVhckNvYXRSb3VnaG5lc3M7CgkJCWlmICgganNvbi52ZXJ0ZXhDb2xvcnMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnZlcnRleENvbG9ycyA9IGpzb24udmVydGV4Q29sb3JzOwoJCQlpZiAoIGpzb24uZm9nICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5mb2cgPSBqc29uLmZvZzsKCQkJaWYgKCBqc29uLmZsYXRTaGFkaW5nICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5mbGF0U2hhZGluZyA9IGpzb24uZmxhdFNoYWRpbmc7CgkJCWlmICgganNvbi5ibGVuZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmRpbmcgPSBqc29uLmJsZW5kaW5nOwoJCQlpZiAoIGpzb24uY29tYmluZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuY29tYmluZSA9IGpzb24uY29tYmluZTsKCQkJaWYgKCBqc29uLnNpZGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNpZGUgPSBqc29uLnNpZGU7CgkJCWlmICgganNvbi5vcGFjaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5vcGFjaXR5ID0ganNvbi5vcGFjaXR5OwoJCQlpZiAoIGpzb24udHJhbnNwYXJlbnQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRyYW5zcGFyZW50ID0ganNvbi50cmFuc3BhcmVudDsKCQkJaWYgKCBqc29uLmFscGhhVGVzdCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYWxwaGFUZXN0ID0ganNvbi5hbHBoYVRlc3Q7CgkJCWlmICgganNvbi5kZXB0aFRlc3QgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlcHRoVGVzdCA9IGpzb24uZGVwdGhUZXN0OwoJCQlpZiAoIGpzb24uZGVwdGhXcml0ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGVwdGhXcml0ZSA9IGpzb24uZGVwdGhXcml0ZTsKCQkJaWYgKCBqc29uLmNvbG9yV3JpdGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNvbG9yV3JpdGUgPSBqc29uLmNvbG9yV3JpdGU7CgkJCWlmICgganNvbi53aXJlZnJhbWUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLndpcmVmcmFtZSA9IGpzb24ud2lyZWZyYW1lOwoJCQlpZiAoIGpzb24ud2lyZWZyYW1lTGluZXdpZHRoICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggPSBqc29uLndpcmVmcmFtZUxpbmV3aWR0aDsKCQkJaWYgKCBqc29uLndpcmVmcmFtZUxpbmVjYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLndpcmVmcmFtZUxpbmVjYXAgPSBqc29uLndpcmVmcmFtZUxpbmVjYXA7CgkJCWlmICgganNvbi53aXJlZnJhbWVMaW5lam9pbiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwud2lyZWZyYW1lTGluZWpvaW4gPSBqc29uLndpcmVmcmFtZUxpbmVqb2luOwoKCQkJaWYgKCBqc29uLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5yb3RhdGlvbiA9IGpzb24ucm90YXRpb247CgoJCQlpZiAoIGpzb24ubGluZXdpZHRoICE9PSAxICkgbWF0ZXJpYWwubGluZXdpZHRoID0ganNvbi5saW5ld2lkdGg7CgkJCWlmICgganNvbi5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGFzaFNpemUgPSBqc29uLmRhc2hTaXplOwoJCQlpZiAoIGpzb24uZ2FwU2l6ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZ2FwU2l6ZSA9IGpzb24uZ2FwU2l6ZTsKCQkJaWYgKCBqc29uLnNjYWxlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zY2FsZSA9IGpzb24uc2NhbGU7CgoJCQlpZiAoIGpzb24ucG9seWdvbk9mZnNldCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucG9seWdvbk9mZnNldCA9IGpzb24ucG9seWdvbk9mZnNldDsKCQkJaWYgKCBqc29uLnBvbHlnb25PZmZzZXRGYWN0b3IgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRGYWN0b3IgPSBqc29uLnBvbHlnb25PZmZzZXRGYWN0b3I7CgkJCWlmICgganNvbi5wb2x5Z29uT2Zmc2V0VW5pdHMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRVbml0cyA9IGpzb24ucG9seWdvbk9mZnNldFVuaXRzOwoKCQkJaWYgKCBqc29uLnNraW5uaW5nICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5za2lubmluZyA9IGpzb24uc2tpbm5pbmc7CgkJCWlmICgganNvbi5tb3JwaFRhcmdldHMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1vcnBoVGFyZ2V0cyA9IGpzb24ubW9ycGhUYXJnZXRzOwoJCQlpZiAoIGpzb24uZGl0aGVyaW5nICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5kaXRoZXJpbmcgPSBqc29uLmRpdGhlcmluZzsKCgkJCWlmICgganNvbi52aXNpYmxlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC52aXNpYmxlID0ganNvbi52aXNpYmxlOwoJCQlpZiAoIGpzb24udXNlckRhdGEgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnVzZXJEYXRhID0ganNvbi51c2VyRGF0YTsKCgkJCS8vIFNoYWRlciBNYXRlcmlhbAoKCQkJaWYgKCBqc29uLnVuaWZvcm1zICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZm9yICggdmFyIG5hbWUgaW4ganNvbi51bmlmb3JtcyApIHsKCgkJCQkJdmFyIHVuaWZvcm0gPSBqc29uLnVuaWZvcm1zWyBuYW1lIF07CgoJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0gPSB7fTsKCgkJCQkJc3dpdGNoICggdW5pZm9ybS50eXBlICkgewoKCQkJCQkJY2FzZSAndCc6CgkJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gZ2V0VGV4dHVyZSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlICdjJzoKCQkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgQ29sb3IoKS5zZXRIZXgoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAndjInOgoJCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBWZWN0b3IyKCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ3YzJzoKCQkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgVmVjdG9yMygpLmZyb21BcnJheSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlICd2NCc6CgkJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnbTMnOgoJCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBNYXRyaXgzKCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgoJCQkJCQljYXNlICdtNCc6CgkJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gbmV3IE1hdHJpeDQoKS5mcm9tQXJyYXkoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBqc29uLmRlZmluZXMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlZmluZXMgPSBqc29uLmRlZmluZXM7CgkJCWlmICgganNvbi52ZXJ0ZXhTaGFkZXIgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnZlcnRleFNoYWRlciA9IGpzb24udmVydGV4U2hhZGVyOwoJCQlpZiAoIGpzb24uZnJhZ21lbnRTaGFkZXIgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmZyYWdtZW50U2hhZGVyID0ganNvbi5mcmFnbWVudFNoYWRlcjsKCgkJCWlmICgganNvbi5leHRlbnNpb25zICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZm9yICggdmFyIGtleSBpbiBqc29uLmV4dGVuc2lvbnMgKSB7CgoJCQkJCW1hdGVyaWFsLmV4dGVuc2lvbnNbIGtleSBdID0ganNvbi5leHRlbnNpb25zWyBrZXkgXTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBEZXByZWNhdGVkCgoJCQlpZiAoIGpzb24uc2hhZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZmxhdFNoYWRpbmcgPSBqc29uLnNoYWRpbmcgPT09IDE7IC8vIFRIUkVFLkZsYXRTaGFkaW5nCgoJCQkvLyBmb3IgUG9pbnRzTWF0ZXJpYWwKCgkJCWlmICgganNvbi5zaXplICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaXplID0ganNvbi5zaXplOwoJCQlpZiAoIGpzb24uc2l6ZUF0dGVudWF0aW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPSBqc29uLnNpemVBdHRlbnVhdGlvbjsKCgkJCS8vIG1hcHMKCgkJCWlmICgganNvbi5tYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1hcCA9IGdldFRleHR1cmUoIGpzb24ubWFwICk7CgoJCQlpZiAoIGpzb24uYWxwaGFNYXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCQltYXRlcmlhbC5hbHBoYU1hcCA9IGdldFRleHR1cmUoIGpzb24uYWxwaGFNYXAgKTsKCQkJCW1hdGVyaWFsLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICgganNvbi5idW1wTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5idW1wTWFwID0gZ2V0VGV4dHVyZSgganNvbi5idW1wTWFwICk7CgkJCWlmICgganNvbi5idW1wU2NhbGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmJ1bXBTY2FsZSA9IGpzb24uYnVtcFNjYWxlOwoKCQkJaWYgKCBqc29uLm5vcm1hbE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubm9ybWFsTWFwID0gZ2V0VGV4dHVyZSgganNvbi5ub3JtYWxNYXAgKTsKCQkJaWYgKCBqc29uLm5vcm1hbE1hcFR5cGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPSBqc29uLm5vcm1hbE1hcFR5cGU7CgkJCWlmICgganNvbi5ub3JtYWxTY2FsZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBub3JtYWxTY2FsZSA9IGpzb24ubm9ybWFsU2NhbGU7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBub3JtYWxTY2FsZSApID09PSBmYWxzZSApIHsKCgkJCQkJLy8gQmxlbmRlciBleHBvcnRlciB1c2VkIHRvIGV4cG9ydCBhIHNjYWxhci4gU2VlICM3NDU5CgoJCQkJCW5vcm1hbFNjYWxlID0gWyBub3JtYWxTY2FsZSwgbm9ybWFsU2NhbGUgXTsKCgkJCQl9CgoJCQkJbWF0ZXJpYWwubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMigpLmZyb21BcnJheSggbm9ybWFsU2NhbGUgKTsKCgkJCX0KCgkJCWlmICgganNvbi5kaXNwbGFjZW1lbnRNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCA9IGdldFRleHR1cmUoIGpzb24uZGlzcGxhY2VtZW50TWFwICk7CgkJCWlmICgganNvbi5kaXNwbGFjZW1lbnRTY2FsZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGUgPSBqc29uLmRpc3BsYWNlbWVudFNjYWxlOwoJCQlpZiAoIGpzb24uZGlzcGxhY2VtZW50QmlhcyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhcyA9IGpzb24uZGlzcGxhY2VtZW50QmlhczsKCgkJCWlmICgganNvbi5yb3VnaG5lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJvdWdobmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24ucm91Z2huZXNzTWFwICk7CgkJCWlmICgganNvbi5tZXRhbG5lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1ldGFsbmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24ubWV0YWxuZXNzTWFwICk7CgoJCQlpZiAoIGpzb24uZW1pc3NpdmVNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmVtaXNzaXZlTWFwID0gZ2V0VGV4dHVyZSgganNvbi5lbWlzc2l2ZU1hcCApOwoJCQlpZiAoIGpzb24uZW1pc3NpdmVJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmVtaXNzaXZlSW50ZW5zaXR5ID0ganNvbi5lbWlzc2l2ZUludGVuc2l0eTsKCgkJCWlmICgganNvbi5zcGVjdWxhck1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJNYXAgPSBnZXRUZXh0dXJlKCBqc29uLnNwZWN1bGFyTWFwICk7CgoJCQlpZiAoIGpzb24uZW52TWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5lbnZNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmVudk1hcCApOwoJCQlpZiAoIGpzb24uZW52TWFwSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5lbnZNYXBJbnRlbnNpdHkgPSBqc29uLmVudk1hcEludGVuc2l0eTsKCgkJCWlmICgganNvbi5yZWZsZWN0aXZpdHkgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJlZmxlY3Rpdml0eSA9IGpzb24ucmVmbGVjdGl2aXR5OwoKCQkJaWYgKCBqc29uLmxpZ2h0TWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5saWdodE1hcCA9IGdldFRleHR1cmUoIGpzb24ubGlnaHRNYXAgKTsKCQkJaWYgKCBqc29uLmxpZ2h0TWFwSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5saWdodE1hcEludGVuc2l0eSA9IGpzb24ubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQlpZiAoIGpzb24uYW9NYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFvTWFwID0gZ2V0VGV4dHVyZSgganNvbi5hb01hcCApOwoJCQlpZiAoIGpzb24uYW9NYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFvTWFwSW50ZW5zaXR5ID0ganNvbi5hb01hcEludGVuc2l0eTsKCgkJCWlmICgganNvbi5ncmFkaWVudE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZ3JhZGllbnRNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmdyYWRpZW50TWFwICk7CgoJCQlyZXR1cm4gbWF0ZXJpYWw7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFRleHR1cmVzOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy50ZXh0dXJlcyA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgRG9uIE1jQ3VyZHkgLyBodHRwczovL3d3dy5kb25tY2N1cmR5LmNvbQoJICovCgoJdmFyIExvYWRlclV0aWxzID0gewoKCQlkZWNvZGVUZXh0OiBmdW5jdGlvbiAoIGFycmF5ICkgewoKCQkJaWYgKCB0eXBlb2YgVGV4dERlY29kZXIgIT09ICd1bmRlZmluZWQnICkgewoKCQkJCXJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoIGFycmF5ICk7CgoJCQl9CgoJCQkvLyBBdm9pZCB0aGUgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBhcnJheSkgc2hvcnRjdXQsIHdoaWNoCgkJCS8vIHRocm93cyBhICJtYXhpbXVtIGNhbGwgc3RhY2sgc2l6ZSBleGNlZWRlZCIgZXJyb3IgZm9yIGxhcmdlIGFycmF5cy4KCgkJCXZhciBzID0gJyc7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJLy8gSW1wbGljaXRseSBhc3N1bWVzIGxpdHRsZS1lbmRpYW4uCgkJCQlzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoIGFycmF5WyBpIF0gKTsKCgkJCX0KCgkJCS8vIE1lcmdlcyBtdWx0aS1ieXRlIHV0Zi04IGNoYXJhY3RlcnMuCgkJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoIGVzY2FwZSggcyApICk7CgoJCX0sCgoJCWV4dHJhY3RVcmxCYXNlOiBmdW5jdGlvbiAoIHVybCApIHsKCgkJCXZhciBpbmRleCA9IHVybC5sYXN0SW5kZXhPZiggJy8nICk7CgoJCQlpZiAoIGluZGV4ID09PSAtIDEgKSByZXR1cm4gJy4vJzsKCgkJCXJldHVybiB1cmwuc3Vic3RyKCAwLCBpbmRleCArIDEgKTsKCgkJfQoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gQnVmZmVyR2VvbWV0cnlMb2FkZXIoIG1hbmFnZXIgKSB7CgoJCXRoaXMubWFuYWdlciA9ICggbWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyBtYW5hZ2VyIDogRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwoKCX0KCglPYmplY3QuYXNzaWduKCBCdWZmZXJHZW9tZXRyeUxvYWRlci5wcm90b3R5cGUsIHsKCgkJbG9hZDogZnVuY3Rpb24gKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCXZhciBzY29wZSA9IHRoaXM7CgoJCQl2YXIgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHNjb3BlLm1hbmFnZXIgKTsKCQkJbG9hZGVyLnNldFBhdGgoIHNjb3BlLnBhdGggKTsKCQkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCB0ZXh0ICkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0sCgoJCXBhcnNlOiBmdW5jdGlvbiAoIGpzb24gKSB7CgoJCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJCXZhciBpbmRleCA9IGpzb24uZGF0YS5pbmRleDsKCgkJCWlmICggaW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgdHlwZWRBcnJheSA9IG5ldyBUWVBFRF9BUlJBWVNbIGluZGV4LnR5cGUgXSggaW5kZXguYXJyYXkgKTsKCQkJCWdlb21ldHJ5LnNldEluZGV4KCBuZXcgQnVmZmVyQXR0cmlidXRlKCB0eXBlZEFycmF5LCAxICkgKTsKCgkJCX0KCgkJCXZhciBhdHRyaWJ1dGVzID0ganNvbi5kYXRhLmF0dHJpYnV0ZXM7CgoJCQlmb3IgKCB2YXIga2V5IGluIGF0dHJpYnV0ZXMgKSB7CgoJCQkJdmFyIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoJCQkJdmFyIHR5cGVkQXJyYXkgPSBuZXcgVFlQRURfQVJSQVlTWyBhdHRyaWJ1dGUudHlwZSBdKCBhdHRyaWJ1dGUuYXJyYXkgKTsKCgkJCQl2YXIgYnVmZmVyQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdHlwZWRBcnJheSwgYXR0cmlidXRlLml0ZW1TaXplLCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoJCQkJaWYgKCBhdHRyaWJ1dGUubmFtZSAhPT0gdW5kZWZpbmVkICkgYnVmZmVyQXR0cmlidXRlLm5hbWUgPSBhdHRyaWJ1dGUubmFtZTsKCQkJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSgga2V5LCBidWZmZXJBdHRyaWJ1dGUgKTsKCgkJCX0KCgkJCXZhciBtb3JwaEF0dHJpYnV0ZXMgPSBqc29uLmRhdGEubW9ycGhBdHRyaWJ1dGVzOwoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJZm9yICggdmFyIGtleSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJCXZhciBhdHRyaWJ1dGVBcnJheSA9IG1vcnBoQXR0cmlidXRlc1sga2V5IF07CgoJCQkJCXZhciBhcnJheSA9IFtdOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gYXR0cmlidXRlQXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQl2YXIgYXR0cmlidXRlID0gYXR0cmlidXRlQXJyYXlbIGkgXTsKCQkJCQkJdmFyIHR5cGVkQXJyYXkgPSBuZXcgVFlQRURfQVJSQVlTWyBhdHRyaWJ1dGUudHlwZSBdKCBhdHRyaWJ1dGUuYXJyYXkgKTsKCgkJCQkJCXZhciBidWZmZXJBdHRyaWJ1dGUgPSBuZXcgQnVmZmVyQXR0cmlidXRlKCB0eXBlZEFycmF5LCBhdHRyaWJ1dGUuaXRlbVNpemUsIGF0dHJpYnV0ZS5ub3JtYWxpemVkICk7CgkJCQkJCWlmICggYXR0cmlidXRlLm5hbWUgIT09IHVuZGVmaW5lZCApIGJ1ZmZlckF0dHJpYnV0ZS5uYW1lID0gYXR0cmlidXRlLm5hbWU7CgkJCQkJCWFycmF5LnB1c2goIGJ1ZmZlckF0dHJpYnV0ZSApOwoKCQkJCQl9CgoJCQkJCWdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlc1sga2V5IF0gPSBhcnJheTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgZ3JvdXBzID0ganNvbi5kYXRhLmdyb3VwcyB8fCBqc29uLmRhdGEuZHJhd2NhbGxzIHx8IGpzb24uZGF0YS5vZmZzZXRzOwoKCQkJaWYgKCBncm91cHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIG4gPSBncm91cHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQl2YXIgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQkJZ2VvbWV0cnkuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQkJCX0KCgkJCX0KCgkJCXZhciBib3VuZGluZ1NwaGVyZSA9IGpzb24uZGF0YS5ib3VuZGluZ1NwaGVyZTsKCgkJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgY2VudGVyID0gbmV3IFZlY3RvcjMoKTsKCgkJCQlpZiAoIGJvdW5kaW5nU3BoZXJlLmNlbnRlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljZW50ZXIuZnJvbUFycmF5KCBib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCgkJCQl9CgoJCQkJZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCBjZW50ZXIsIGJvdW5kaW5nU3BoZXJlLnJhZGl1cyApOwoKCQkJfQoKCQkJaWYgKCBqc29uLm5hbWUgKSBnZW9tZXRyeS5uYW1lID0ganNvbi5uYW1lOwoJCQlpZiAoIGpzb24udXNlckRhdGEgKSBnZW9tZXRyeS51c2VyRGF0YSA9IGpzb24udXNlckRhdGE7CgoJCQlyZXR1cm4gZ2VvbWV0cnk7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJdmFyIFRZUEVEX0FSUkFZUyA9IHsKCQlJbnQ4QXJyYXk6IEludDhBcnJheSwKCQlVaW50OEFycmF5OiBVaW50OEFycmF5LAoJCS8vIFdvcmthcm91bmQgZm9yIElFMTEgcHJlIEtCMjkyOTQzNy4gU2VlICMxMTQ0MAoJCVVpbnQ4Q2xhbXBlZEFycmF5OiB0eXBlb2YgVWludDhDbGFtcGVkQXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDhDbGFtcGVkQXJyYXkgOiBVaW50OEFycmF5LAoJCUludDE2QXJyYXk6IEludDE2QXJyYXksCgkJVWludDE2QXJyYXk6IFVpbnQxNkFycmF5LAoJCUludDMyQXJyYXk6IEludDMyQXJyYXksCgkJVWludDMyQXJyYXk6IFVpbnQzMkFycmF5LAoJCUZsb2F0MzJBcnJheTogRmxvYXQzMkFycmF5LAoJCUZsb2F0NjRBcnJheTogRmxvYXQ2NEFycmF5Cgl9OwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIE9iamVjdExvYWRlciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgkJdGhpcy5yZXNvdXJjZVBhdGggPSAnJzsKCgl9CgoJT2JqZWN0LmFzc2lnbiggT2JqZWN0TG9hZGVyLnByb3RvdHlwZSwgewoKCQljcm9zc09yaWdpbjogJ2Fub255bW91cycsCgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdmFyIHBhdGggPSAoIHRoaXMucGF0aCA9PT0gdW5kZWZpbmVkICkgPyBMb2FkZXJVdGlscy5leHRyYWN0VXJsQmFzZSggdXJsICkgOiB0aGlzLnBhdGg7CgkJCXRoaXMucmVzb3VyY2VQYXRoID0gdGhpcy5yZXNvdXJjZVBhdGggfHwgcGF0aDsKCgkJCXZhciBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggc2NvcGUubWFuYWdlciApOwoJCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggdGV4dCApIHsKCgkJCQl2YXIganNvbiA9IG51bGw7CgoJCQkJdHJ5IHsKCgkJCQkJanNvbiA9IEpTT04ucGFyc2UoIHRleHQgKTsKCgkJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJCWlmICggb25FcnJvciAhPT0gdW5kZWZpbmVkICkgb25FcnJvciggZXJyb3IgKTsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFOk9iamVjdExvYWRlcjogQ2FuXCd0IHBhcnNlICcgKyB1cmwgKyAnLicsIGVycm9yLm1lc3NhZ2UgKTsKCgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQl2YXIgbWV0YWRhdGEgPSBqc29uLm1ldGFkYXRhOwoKCQkJCWlmICggbWV0YWRhdGEgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS50eXBlID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEudHlwZS50b0xvd2VyQ2FzZSgpID09PSAnZ2VvbWV0cnknICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBDYW5cJ3QgbG9hZCAnICsgdXJsICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQlzY29wZS5wYXJzZSgganNvbiwgb25Mb2FkICk7CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFJlc291cmNlUGF0aDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMucmVzb3VyY2VQYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRDcm9zc09yaWdpbjogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXBhcnNlOiBmdW5jdGlvbiAoIGpzb24sIG9uTG9hZCApIHsKCgkJCXZhciBzaGFwZXMgPSB0aGlzLnBhcnNlU2hhcGUoIGpzb24uc2hhcGVzICk7CgkJCXZhciBnZW9tZXRyaWVzID0gdGhpcy5wYXJzZUdlb21ldHJpZXMoIGpzb24uZ2VvbWV0cmllcywgc2hhcGVzICk7CgoJCQl2YXIgaW1hZ2VzID0gdGhpcy5wYXJzZUltYWdlcygganNvbi5pbWFnZXMsIGZ1bmN0aW9uICgpIHsKCgkJCQlpZiAoIG9uTG9hZCAhPT0gdW5kZWZpbmVkICkgb25Mb2FkKCBvYmplY3QgKTsKCgkJCX0gKTsKCgkJCXZhciB0ZXh0dXJlcyA9IHRoaXMucGFyc2VUZXh0dXJlcygganNvbi50ZXh0dXJlcywgaW1hZ2VzICk7CgkJCXZhciBtYXRlcmlhbHMgPSB0aGlzLnBhcnNlTWF0ZXJpYWxzKCBqc29uLm1hdGVyaWFscywgdGV4dHVyZXMgKTsKCgkJCXZhciBvYmplY3QgPSB0aGlzLnBhcnNlT2JqZWN0KCBqc29uLm9iamVjdCwgZ2VvbWV0cmllcywgbWF0ZXJpYWxzICk7CgoJCQlpZiAoIGpzb24uYW5pbWF0aW9ucyApIHsKCgkJCQlvYmplY3QuYW5pbWF0aW9ucyA9IHRoaXMucGFyc2VBbmltYXRpb25zKCBqc29uLmFuaW1hdGlvbnMgKTsKCgkJCX0KCgkJCWlmICgganNvbi5pbWFnZXMgPT09IHVuZGVmaW5lZCB8fCBqc29uLmltYWdlcy5sZW5ndGggPT09IDAgKSB7CgoJCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIG9uTG9hZCggb2JqZWN0ICk7CgoJCQl9CgoJCQlyZXR1cm4gb2JqZWN0OwoKCQl9LAoKCQlwYXJzZVNoYXBlOiBmdW5jdGlvbiAoIGpzb24gKSB7CgoJCQl2YXIgc2hhcGVzID0ge307CgoJCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBqc29uLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXZhciBzaGFwZSA9IG5ldyBTaGFwZSgpLmZyb21KU09OKCBqc29uWyBpIF0gKTsKCgkJCQkJc2hhcGVzWyBzaGFwZS51dWlkIF0gPSBzaGFwZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gc2hhcGVzOwoKCQl9LAoKCQlwYXJzZUdlb21ldHJpZXM6IGZ1bmN0aW9uICgganNvbiwgc2hhcGVzICkgewoKCQkJdmFyIGdlb21ldHJpZXMgPSB7fTsKCgkJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBidWZmZXJHZW9tZXRyeUxvYWRlciA9IG5ldyBCdWZmZXJHZW9tZXRyeUxvYWRlcigpOwoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGpzb24ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdmFyIGdlb21ldHJ5OwoJCQkJCXZhciBkYXRhID0ganNvblsgaSBdOwoKCQkJCQlzd2l0Y2ggKCBkYXRhLnR5cGUgKSB7CgoJCQkJCQljYXNlICdQbGFuZUdlb21ldHJ5JzoKCQkJCQkJY2FzZSAnUGxhbmVCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS53aWR0aCwKCQkJCQkJCQlkYXRhLmhlaWdodCwKCQkJCQkJCQlkYXRhLndpZHRoU2VnbWVudHMsCgkJCQkJCQkJZGF0YS5oZWlnaHRTZWdtZW50cwoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ0JveEdlb21ldHJ5JzoKCQkJCQkJY2FzZSAnQm94QnVmZmVyR2VvbWV0cnknOgoJCQkJCQljYXNlICdDdWJlR2VvbWV0cnknOiAvLyBiYWNrd2FyZHMgY29tcGF0aWJsZQoKCQkJCQkJCWdlb21ldHJ5ID0gbmV3IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdKAoJCQkJCQkJCWRhdGEud2lkdGgsCgkJCQkJCQkJZGF0YS5oZWlnaHQsCgkJCQkJCQkJZGF0YS5kZXB0aCwKCQkJCQkJCQlkYXRhLndpZHRoU2VnbWVudHMsCgkJCQkJCQkJZGF0YS5oZWlnaHRTZWdtZW50cywKCQkJCQkJCQlkYXRhLmRlcHRoU2VnbWVudHMKCQkJCQkJCSk7CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlICdDaXJjbGVHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ0NpcmNsZUJ1ZmZlckdlb21ldHJ5JzoKCgkJCQkJCQlnZW9tZXRyeSA9IG5ldyBHZW9tZXRyaWVzWyBkYXRhLnR5cGUgXSgKCQkJCQkJCQlkYXRhLnJhZGl1cywKCQkJCQkJCQlkYXRhLnNlZ21lbnRzLAoJCQkJCQkJCWRhdGEudGhldGFTdGFydCwKCQkJCQkJCQlkYXRhLnRoZXRhTGVuZ3RoCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnQ3lsaW5kZXJHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ0N5bGluZGVyQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJCWdlb21ldHJ5ID0gbmV3IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdKAoJCQkJCQkJCWRhdGEucmFkaXVzVG9wLAoJCQkJCQkJCWRhdGEucmFkaXVzQm90dG9tLAoJCQkJCQkJCWRhdGEuaGVpZ2h0LAoJCQkJCQkJCWRhdGEucmFkaWFsU2VnbWVudHMsCgkJCQkJCQkJZGF0YS5oZWlnaHRTZWdtZW50cywKCQkJCQkJCQlkYXRhLm9wZW5FbmRlZCwKCQkJCQkJCQlkYXRhLnRoZXRhU3RhcnQsCgkJCQkJCQkJZGF0YS50aGV0YUxlbmd0aAoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ0NvbmVHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ0NvbmVCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS5yYWRpdXMsCgkJCQkJCQkJZGF0YS5oZWlnaHQsCgkJCQkJCQkJZGF0YS5yYWRpYWxTZWdtZW50cywKCQkJCQkJCQlkYXRhLmhlaWdodFNlZ21lbnRzLAoJCQkJCQkJCWRhdGEub3BlbkVuZGVkLAoJCQkJCQkJCWRhdGEudGhldGFTdGFydCwKCQkJCQkJCQlkYXRhLnRoZXRhTGVuZ3RoCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnU3BoZXJlR2VvbWV0cnknOgoJCQkJCQljYXNlICdTcGhlcmVCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS5yYWRpdXMsCgkJCQkJCQkJZGF0YS53aWR0aFNlZ21lbnRzLAoJCQkJCQkJCWRhdGEuaGVpZ2h0U2VnbWVudHMsCgkJCQkJCQkJZGF0YS5waGlTdGFydCwKCQkJCQkJCQlkYXRhLnBoaUxlbmd0aCwKCQkJCQkJCQlkYXRhLnRoZXRhU3RhcnQsCgkJCQkJCQkJZGF0YS50aGV0YUxlbmd0aAoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ0RvZGVjYWhlZHJvbkdlb21ldHJ5JzoKCQkJCQkJY2FzZSAnRG9kZWNhaGVkcm9uQnVmZmVyR2VvbWV0cnknOgoJCQkJCQljYXNlICdJY29zYWhlZHJvbkdlb21ldHJ5JzoKCQkJCQkJY2FzZSAnSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ09jdGFoZWRyb25HZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ09jdGFoZWRyb25CdWZmZXJHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1RldHJhaGVkcm9uR2VvbWV0cnknOgoJCQkJCQljYXNlICdUZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5JzoKCgkJCQkJCQlnZW9tZXRyeSA9IG5ldyBHZW9tZXRyaWVzWyBkYXRhLnR5cGUgXSgKCQkJCQkJCQlkYXRhLnJhZGl1cywKCQkJCQkJCQlkYXRhLmRldGFpbAoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ1JpbmdHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1JpbmdCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS5pbm5lclJhZGl1cywKCQkJCQkJCQlkYXRhLm91dGVyUmFkaXVzLAoJCQkJCQkJCWRhdGEudGhldGFTZWdtZW50cywKCQkJCQkJCQlkYXRhLnBoaVNlZ21lbnRzLAoJCQkJCQkJCWRhdGEudGhldGFTdGFydCwKCQkJCQkJCQlkYXRhLnRoZXRhTGVuZ3RoCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnVG9ydXNHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1RvcnVzQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJCWdlb21ldHJ5ID0gbmV3IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdKAoJCQkJCQkJCWRhdGEucmFkaXVzLAoJCQkJCQkJCWRhdGEudHViZSwKCQkJCQkJCQlkYXRhLnJhZGlhbFNlZ21lbnRzLAoJCQkJCQkJCWRhdGEudHVidWxhclNlZ21lbnRzLAoJCQkJCQkJCWRhdGEuYXJjCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnVG9ydXNLbm90R2VvbWV0cnknOgoJCQkJCQljYXNlICdUb3J1c0tub3RCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS5yYWRpdXMsCgkJCQkJCQkJZGF0YS50dWJlLAoJCQkJCQkJCWRhdGEudHVidWxhclNlZ21lbnRzLAoJCQkJCQkJCWRhdGEucmFkaWFsU2VnbWVudHMsCgkJCQkJCQkJZGF0YS5wLAoJCQkJCQkJCWRhdGEucQoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ1R1YmVHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1R1YmVCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJLy8gVGhpcyBvbmx5IHdvcmtzIGZvciBidWlsdC1pbiBjdXJ2ZXMgKGUuZy4gQ2F0bXVsbFJvbUN1cnZlMykuCgkJCQkJCQkvLyBVc2VyIGRlZmluZWQgY3VydmVzIG9yIGluc3RhbmNlcyBvZiBDdXJ2ZVBhdGggd2lsbCBub3QgYmUgZGVzZXJpYWxpemVkLgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJbmV3IEN1cnZlc1sgZGF0YS5wYXRoLnR5cGUgXSgpLmZyb21KU09OKCBkYXRhLnBhdGggKSwKCQkJCQkJCQlkYXRhLnR1YnVsYXJTZWdtZW50cywKCQkJCQkJCQlkYXRhLnJhZGl1cywKCQkJCQkJCQlkYXRhLnJhZGlhbFNlZ21lbnRzLAoJCQkJCQkJCWRhdGEuY2xvc2VkCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnTGF0aGVHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ0xhdGhlQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJCWdlb21ldHJ5ID0gbmV3IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdKAoJCQkJCQkJCWRhdGEucG9pbnRzLAoJCQkJCQkJCWRhdGEuc2VnbWVudHMsCgkJCQkJCQkJZGF0YS5waGlTdGFydCwKCQkJCQkJCQlkYXRhLnBoaUxlbmd0aAoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgJ1BvbHloZWRyb25HZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1BvbHloZWRyb25CdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBuZXcgR2VvbWV0cmllc1sgZGF0YS50eXBlIF0oCgkJCQkJCQkJZGF0YS52ZXJ0aWNlcywKCQkJCQkJCQlkYXRhLmluZGljZXMsCgkJCQkJCQkJZGF0YS5yYWRpdXMsCgkJCQkJCQkJZGF0YS5kZXRhaWxzCgkJCQkJCQkpOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnU2hhcGVHZW9tZXRyeSc6CgkJCQkJCWNhc2UgJ1NoYXBlQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJCXZhciBnZW9tZXRyeVNoYXBlcyA9IFtdOwoKCQkJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCQkJdmFyIHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQkJCQkJCWdlb21ldHJ5U2hhcGVzLnB1c2goIHNoYXBlICk7CgoJCQkJCQkJfQoKCQkJCQkJCWdlb21ldHJ5ID0gbmV3IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdKAoJCQkJCQkJCWdlb21ldHJ5U2hhcGVzLAoJCQkJCQkJCWRhdGEuY3VydmVTZWdtZW50cwoJCQkJCQkJKTsKCgkJCQkJCQlicmVhazsKCgoJCQkJCQljYXNlICdFeHRydWRlR2VvbWV0cnknOgoJCQkJCQljYXNlICdFeHRydWRlQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJCXZhciBnZW9tZXRyeVNoYXBlcyA9IFtdOwoKCQkJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCQkJdmFyIHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQkJCQkJCWdlb21ldHJ5U2hhcGVzLnB1c2goIHNoYXBlICk7CgoJCQkJCQkJfQoKCQkJCQkJCXZhciBleHRydWRlUGF0aCA9IGRhdGEub3B0aW9ucy5leHRydWRlUGF0aDsKCgkJCQkJCQlpZiAoIGV4dHJ1ZGVQYXRoICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCWRhdGEub3B0aW9ucy5leHRydWRlUGF0aCA9IG5ldyBDdXJ2ZXNbIGV4dHJ1ZGVQYXRoLnR5cGUgXSgpLmZyb21KU09OKCBleHRydWRlUGF0aCApOwoKCQkJCQkJCX0KCgkJCQkJCQlnZW9tZXRyeSA9IG5ldyBHZW9tZXRyaWVzWyBkYXRhLnR5cGUgXSgKCQkJCQkJCQlnZW9tZXRyeVNoYXBlcywKCQkJCQkJCQlkYXRhLm9wdGlvbnMKCQkJCQkJCSk7CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlICdCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQkJZ2VvbWV0cnkgPSBidWZmZXJHZW9tZXRyeUxvYWRlci5wYXJzZSggZGF0YSApOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSAnR2VvbWV0cnknOgoKCQkJCQkJCWlmICggJ1RIUkVFJyBpbiB3aW5kb3cgJiYgJ0xlZ2FjeUpTT05Mb2FkZXInIGluIFRIUkVFICkgewoKCQkJCQkJCQl2YXIgZ2VvbWV0cnlMb2FkZXIgPSBuZXcgVEhSRUUuTGVnYWN5SlNPTkxvYWRlcigpOwoJCQkJCQkJCWdlb21ldHJ5ID0gZ2VvbWV0cnlMb2FkZXIucGFyc2UoIGRhdGEsIHRoaXMucmVzb3VyY2VQYXRoICkuZ2VvbWV0cnk7CgoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3RMb2FkZXI6IFlvdSBoYXZlIHRvIGltcG9ydCBMZWdhY3lKU09OTG9hZGVyIGluIG9yZGVyIGxvYWQgZ2VvbWV0cnkgZGF0YSBvZiB0eXBlICJHZW9tZXRyeSIuJyApOwoKCQkJCQkJCX0KCgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgoJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbnN1cHBvcnRlZCBnZW9tZXRyeSB0eXBlICInICsgZGF0YS50eXBlICsgJyInICk7CgoJCQkJCQkJY29udGludWU7CgoJCQkJCX0KCgkJCQkJZ2VvbWV0cnkudXVpZCA9IGRhdGEudXVpZDsKCgkJCQkJaWYgKCBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCApIGdlb21ldHJ5Lm5hbWUgPSBkYXRhLm5hbWU7CgkJCQkJaWYgKCBnZW9tZXRyeS5pc0J1ZmZlckdlb21ldHJ5ID09PSB0cnVlICYmIGRhdGEudXNlckRhdGEgIT09IHVuZGVmaW5lZCApIGdlb21ldHJ5LnVzZXJEYXRhID0gZGF0YS51c2VyRGF0YTsKCgkJCQkJZ2VvbWV0cmllc1sgZGF0YS51dWlkIF0gPSBnZW9tZXRyeTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZ2VvbWV0cmllczsKCgkJfSwKCgkJcGFyc2VNYXRlcmlhbHM6IGZ1bmN0aW9uICgganNvbiwgdGV4dHVyZXMgKSB7CgoJCQl2YXIgY2FjaGUgPSB7fTsgLy8gTXVsdGlNYXRlcmlhbAoJCQl2YXIgbWF0ZXJpYWxzID0ge307CgoJCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgbG9hZGVyID0gbmV3IE1hdGVyaWFsTG9hZGVyKCk7CgkJCQlsb2FkZXIuc2V0VGV4dHVyZXMoIHRleHR1cmVzICk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0ganNvbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQl2YXIgZGF0YSA9IGpzb25bIGkgXTsKCgkJCQkJaWYgKCBkYXRhLnR5cGUgPT09ICdNdWx0aU1hdGVyaWFsJyApIHsKCgkJCQkJCS8vIERlcHJlY2F0ZWQKCgkJCQkJCXZhciBhcnJheSA9IFtdOwoKCQkJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgZGF0YS5tYXRlcmlhbHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCXZhciBtYXRlcmlhbCA9IGRhdGEubWF0ZXJpYWxzWyBqIF07CgoJCQkJCQkJaWYgKCBjYWNoZVsgbWF0ZXJpYWwudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCWNhY2hlWyBtYXRlcmlhbC51dWlkIF0gPSBsb2FkZXIucGFyc2UoIG1hdGVyaWFsICk7CgoJCQkJCQkJfQoKCQkJCQkJCWFycmF5LnB1c2goIGNhY2hlWyBtYXRlcmlhbC51dWlkIF0gKTsKCgkJCQkJCX0KCgkJCQkJCW1hdGVyaWFsc1sgZGF0YS51dWlkIF0gPSBhcnJheTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggY2FjaGVbIGRhdGEudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJY2FjaGVbIGRhdGEudXVpZCBdID0gbG9hZGVyLnBhcnNlKCBkYXRhICk7CgoJCQkJCQl9CgoJCQkJCQltYXRlcmlhbHNbIGRhdGEudXVpZCBdID0gY2FjaGVbIGRhdGEudXVpZCBdOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIG1hdGVyaWFsczsKCgkJfSwKCgkJcGFyc2VBbmltYXRpb25zOiBmdW5jdGlvbiAoIGpzb24gKSB7CgoJCQl2YXIgYW5pbWF0aW9ucyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwganNvbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdmFyIGRhdGEgPSBqc29uWyBpIF07CgoJCQkJdmFyIGNsaXAgPSBBbmltYXRpb25DbGlwLnBhcnNlKCBkYXRhICk7CgoJCQkJaWYgKCBkYXRhLnV1aWQgIT09IHVuZGVmaW5lZCApIGNsaXAudXVpZCA9IGRhdGEudXVpZDsKCgkJCQlhbmltYXRpb25zLnB1c2goIGNsaXAgKTsKCgkJCX0KCgkJCXJldHVybiBhbmltYXRpb25zOwoKCQl9LAoKCQlwYXJzZUltYWdlczogZnVuY3Rpb24gKCBqc29uLCBvbkxvYWQgKSB7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoJCQl2YXIgaW1hZ2VzID0ge307CgoJCQlmdW5jdGlvbiBsb2FkSW1hZ2UoIHVybCApIHsKCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQkJcmV0dXJuIGxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICgpIHsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCQl9LCB1bmRlZmluZWQsIGZ1bmN0aW9uICgpIHsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJfSApOwoKCQkJfQoKCQkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgJiYganNvbi5sZW5ndGggPiAwICkgewoKCQkJCXZhciBtYW5hZ2VyID0gbmV3IExvYWRpbmdNYW5hZ2VyKCBvbkxvYWQgKTsKCgkJCQl2YXIgbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCBtYW5hZ2VyICk7CgkJCQlsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oIHRoaXMuY3Jvc3NPcmlnaW4gKTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0ganNvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdmFyIGltYWdlID0ganNvblsgaSBdOwoJCQkJCXZhciB1cmwgPSBpbWFnZS51cmw7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggdXJsICkgKSB7CgoJCQkJCQkvLyBsb2FkIGFycmF5IG9mIGltYWdlcyBlLmcgQ3ViZVRleHR1cmUKCgkJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gW107CgoJCQkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gdXJsLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJCXZhciBjdXJyZW50VXJsID0gdXJsWyBqIF07CgoJCQkJCQkJdmFyIHBhdGggPSAvXihcL1wvKXwoW2Etel0rOihcL1wvKT8pL2kudGVzdCggY3VycmVudFVybCApID8gY3VycmVudFVybCA6IHNjb3BlLnJlc291cmNlUGF0aCArIGN1cnJlbnRVcmw7CgoJCQkJCQkJaW1hZ2VzWyBpbWFnZS51dWlkIF0ucHVzaCggbG9hZEltYWdlKCBwYXRoICkgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGxvYWQgc2luZ2xlIGltYWdlCgoJCQkJCQl2YXIgcGF0aCA9IC9eKFwvXC8pfChbYS16XSs6KFwvXC8pPykvaS50ZXN0KCBpbWFnZS51cmwgKSA/IGltYWdlLnVybCA6IHNjb3BlLnJlc291cmNlUGF0aCArIGltYWdlLnVybDsKCgkJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gbG9hZEltYWdlKCBwYXRoICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gaW1hZ2VzOwoKCQl9LAoKCQlwYXJzZVRleHR1cmVzOiBmdW5jdGlvbiAoIGpzb24sIGltYWdlcyApIHsKCgkJCWZ1bmN0aW9uIHBhcnNlQ29uc3RhbnQoIHZhbHVlLCB0eXBlICkgewoKCQkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHJldHVybiB2YWx1ZTsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXIucGFyc2VUZXh0dXJlOiBDb25zdGFudCBzaG91bGQgYmUgaW4gbnVtZXJpYyBmb3JtLicsIHZhbHVlICk7CgoJCQkJcmV0dXJuIHR5cGVbIHZhbHVlIF07CgoJCQl9CgoJCQl2YXIgdGV4dHVyZXMgPSB7fTsKCgkJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IGpzb24ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdmFyIGRhdGEgPSBqc29uWyBpIF07CgoJCQkJCWlmICggZGF0YS5pbWFnZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBObyAiaW1hZ2UiIHNwZWNpZmllZCBmb3InLCBkYXRhLnV1aWQgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGltYWdlc1sgZGF0YS5pbWFnZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCBpbWFnZScsIGRhdGEuaW1hZ2UgKTsKCgkJCQkJfQoKCQkJCQl2YXIgdGV4dHVyZTsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBpbWFnZXNbIGRhdGEuaW1hZ2UgXSApICkgewoKCQkJCQkJdGV4dHVyZSA9IG5ldyBDdWJlVGV4dHVyZSggaW1hZ2VzWyBkYXRhLmltYWdlIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRleHR1cmUgPSBuZXcgVGV4dHVyZSggaW1hZ2VzWyBkYXRhLmltYWdlIF0gKTsKCgkJCQkJfQoKCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJdGV4dHVyZS51dWlkID0gZGF0YS51dWlkOwoKCQkJCQlpZiAoIGRhdGEubmFtZSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5uYW1lID0gZGF0YS5uYW1lOwoKCQkJCQlpZiAoIGRhdGEubWFwcGluZyAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5tYXBwaW5nID0gcGFyc2VDb25zdGFudCggZGF0YS5tYXBwaW5nLCBURVhUVVJFX01BUFBJTkcgKTsKCgkJCQkJaWYgKCBkYXRhLm9mZnNldCAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5vZmZzZXQuZnJvbUFycmF5KCBkYXRhLm9mZnNldCApOwoJCQkJCWlmICggZGF0YS5yZXBlYXQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUucmVwZWF0LmZyb21BcnJheSggZGF0YS5yZXBlYXQgKTsKCQkJCQlpZiAoIGRhdGEuY2VudGVyICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmNlbnRlci5mcm9tQXJyYXkoIGRhdGEuY2VudGVyICk7CgkJCQkJaWYgKCBkYXRhLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnJvdGF0aW9uID0gZGF0YS5yb3RhdGlvbjsKCgkJCQkJaWYgKCBkYXRhLndyYXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXRleHR1cmUud3JhcFMgPSBwYXJzZUNvbnN0YW50KCBkYXRhLndyYXBbIDAgXSwgVEVYVFVSRV9XUkFQUElORyApOwoJCQkJCQl0ZXh0dXJlLndyYXBUID0gcGFyc2VDb25zdGFudCggZGF0YS53cmFwWyAxIF0sIFRFWFRVUkVfV1JBUFBJTkcgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGRhdGEuZm9ybWF0ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmZvcm1hdCA9IGRhdGEuZm9ybWF0OwoJCQkJCWlmICggZGF0YS50eXBlICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnR5cGUgPSBkYXRhLnR5cGU7CgkJCQkJaWYgKCBkYXRhLmVuY29kaW5nICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmVuY29kaW5nID0gZGF0YS5lbmNvZGluZzsKCgkJCQkJaWYgKCBkYXRhLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5taW5GaWx0ZXIgPSBwYXJzZUNvbnN0YW50KCBkYXRhLm1pbkZpbHRlciwgVEVYVFVSRV9GSUxURVIgKTsKCQkJCQlpZiAoIGRhdGEubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm1hZ0ZpbHRlciA9IHBhcnNlQ29uc3RhbnQoIGRhdGEubWFnRmlsdGVyLCBURVhUVVJFX0ZJTFRFUiApOwoJCQkJCWlmICggZGF0YS5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmFuaXNvdHJvcHkgPSBkYXRhLmFuaXNvdHJvcHk7CgoJCQkJCWlmICggZGF0YS5mbGlwWSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5mbGlwWSA9IGRhdGEuZmxpcFk7CgoJCQkJCWlmICggZGF0YS5wcmVtdWx0aXBseUFscGhhICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgPSBkYXRhLnByZW11bHRpcGx5QWxwaGE7CgkJCQkJaWYgKCBkYXRhLnVucGFja0FsaWdubWVudCAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgPSBkYXRhLnVucGFja0FsaWdubWVudDsKCgkJCQkJdGV4dHVyZXNbIGRhdGEudXVpZCBdID0gdGV4dHVyZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGV4dHVyZXM7CgoJCX0sCgoJCXBhcnNlT2JqZWN0OiBmdW5jdGlvbiAoIGRhdGEsIGdlb21ldHJpZXMsIG1hdGVyaWFscyApIHsKCgkJCXZhciBvYmplY3Q7CgoJCQlmdW5jdGlvbiBnZXRHZW9tZXRyeSggbmFtZSApIHsKCgkJCQlpZiAoIGdlb21ldHJpZXNbIG5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCBnZW9tZXRyeScsIG5hbWUgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIGdlb21ldHJpZXNbIG5hbWUgXTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGdldE1hdGVyaWFsKCBuYW1lICkgewoKCQkJCWlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIHVuZGVmaW5lZDsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG5hbWUgKSApIHsKCgkJCQkJdmFyIGFycmF5ID0gW107CgoJCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCXZhciB1dWlkID0gbmFtZVsgaSBdOwoKCQkJCQkJaWYgKCBtYXRlcmlhbHNbIHV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlcjogVW5kZWZpbmVkIG1hdGVyaWFsJywgdXVpZCApOwoKCQkJCQkJfQoKCQkJCQkJYXJyYXkucHVzaCggbWF0ZXJpYWxzWyB1dWlkIF0gKTsKCgkJCQkJfQoKCQkJCQlyZXR1cm4gYXJyYXk7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWxzWyBuYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbmRlZmluZWQgbWF0ZXJpYWwnLCBuYW1lICk7CgoJCQkJfQoKCQkJCXJldHVybiBtYXRlcmlhbHNbIG5hbWUgXTsKCgkJCX0KCgkJCXN3aXRjaCAoIGRhdGEudHlwZSApIHsKCgkJCQljYXNlICdTY2VuZSc6CgoJCQkJCW9iamVjdCA9IG5ldyBTY2VuZSgpOwoKCQkJCQlpZiAoIGRhdGEuYmFja2dyb3VuZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJaWYgKCBOdW1iZXIuaXNJbnRlZ2VyKCBkYXRhLmJhY2tncm91bmQgKSApIHsKCgkJCQkJCQlvYmplY3QuYmFja2dyb3VuZCA9IG5ldyBDb2xvciggZGF0YS5iYWNrZ3JvdW5kICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCBkYXRhLmZvZyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJaWYgKCBkYXRhLmZvZy50eXBlID09PSAnRm9nJyApIHsKCgkJCQkJCQlvYmplY3QuZm9nID0gbmV3IEZvZyggZGF0YS5mb2cuY29sb3IsIGRhdGEuZm9nLm5lYXIsIGRhdGEuZm9nLmZhciApOwoKCQkJCQkJfSBlbHNlIGlmICggZGF0YS5mb2cudHlwZSA9PT0gJ0ZvZ0V4cDInICkgewoKCQkJCQkJCW9iamVjdC5mb2cgPSBuZXcgRm9nRXhwMiggZGF0YS5mb2cuY29sb3IsIGRhdGEuZm9nLmRlbnNpdHkgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCQljYXNlICdQZXJzcGVjdGl2ZUNhbWVyYSc6CgoJCQkJCW9iamVjdCA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZGF0YS5mb3YsIGRhdGEuYXNwZWN0LCBkYXRhLm5lYXIsIGRhdGEuZmFyICk7CgoJCQkJCWlmICggZGF0YS5mb2N1cyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmZvY3VzID0gZGF0YS5mb2N1czsKCQkJCQlpZiAoIGRhdGEuem9vbSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0Lnpvb20gPSBkYXRhLnpvb207CgkJCQkJaWYgKCBkYXRhLmZpbG1HYXVnZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmZpbG1HYXVnZSA9IGRhdGEuZmlsbUdhdWdlOwoJCQkJCWlmICggZGF0YS5maWxtT2Zmc2V0ICE9PSB1bmRlZmluZWQgKSBvYmplY3QuZmlsbU9mZnNldCA9IGRhdGEuZmlsbU9mZnNldDsKCQkJCQlpZiAoIGRhdGEudmlldyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgZGF0YS52aWV3ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ09ydGhvZ3JhcGhpY0NhbWVyYSc6CgoJCQkJCW9iamVjdCA9IG5ldyBPcnRob2dyYXBoaWNDYW1lcmEoIGRhdGEubGVmdCwgZGF0YS5yaWdodCwgZGF0YS50b3AsIGRhdGEuYm90dG9tLCBkYXRhLm5lYXIsIGRhdGEuZmFyICk7CgoJCQkJCWlmICggZGF0YS56b29tICE9PSB1bmRlZmluZWQgKSBvYmplY3Quem9vbSA9IGRhdGEuem9vbTsKCQkJCQlpZiAoIGRhdGEudmlldyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgZGF0YS52aWV3ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ0FtYmllbnRMaWdodCc6CgoJCQkJCW9iamVjdCA9IG5ldyBBbWJpZW50TGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuaW50ZW5zaXR5ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ0RpcmVjdGlvbmFsTGlnaHQnOgoKCQkJCQlvYmplY3QgPSBuZXcgRGlyZWN0aW9uYWxMaWdodCggZGF0YS5jb2xvciwgZGF0YS5pbnRlbnNpdHkgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnUG9pbnRMaWdodCc6CgoJCQkJCW9iamVjdCA9IG5ldyBQb2ludExpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmludGVuc2l0eSwgZGF0YS5kaXN0YW5jZSwgZGF0YS5kZWNheSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdSZWN0QXJlYUxpZ2h0JzoKCgkJCQkJb2JqZWN0ID0gbmV3IFJlY3RBcmVhTGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuaW50ZW5zaXR5LCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdTcG90TGlnaHQnOgoKCQkJCQlvYmplY3QgPSBuZXcgU3BvdExpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmludGVuc2l0eSwgZGF0YS5kaXN0YW5jZSwgZGF0YS5hbmdsZSwgZGF0YS5wZW51bWJyYSwgZGF0YS5kZWNheSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdIZW1pc3BoZXJlTGlnaHQnOgoKCQkJCQlvYmplY3QgPSBuZXcgSGVtaXNwaGVyZUxpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmdyb3VuZENvbG9yLCBkYXRhLmludGVuc2l0eSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdTa2lubmVkTWVzaCc6CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlci5wYXJzZU9iamVjdCgpIGRvZXMgbm90IHN1cHBvcnQgU2tpbm5lZE1lc2ggeWV0LicgKTsKCgkJCQljYXNlICdNZXNoJzoKCgkJCQkJdmFyIGdlb21ldHJ5ID0gZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKTsKCQkJCQl2YXIgbWF0ZXJpYWwgPSBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApOwoKCQkJCQlpZiAoIGdlb21ldHJ5LmJvbmVzICYmIGdlb21ldHJ5LmJvbmVzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlvYmplY3QgPSBuZXcgU2tpbm5lZE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJb2JqZWN0ID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCQl9CgoJCQkJCWlmICggZGF0YS5kcmF3TW9kZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNldERyYXdNb2RlKCBkYXRhLmRyYXdNb2RlICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ0xPRCc6CgoJCQkJCW9iamVjdCA9IG5ldyBMT0QoKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnTGluZSc6CgoJCQkJCW9iamVjdCA9IG5ldyBMaW5lKCBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApLCBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApLCBkYXRhLm1vZGUgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnTGluZUxvb3AnOgoKCQkJCQlvYmplY3QgPSBuZXcgTGluZUxvb3AoIGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICksIGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICkgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnTGluZVNlZ21lbnRzJzoKCgkJCQkJb2JqZWN0ID0gbmV3IExpbmVTZWdtZW50cyggZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKSwgZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdQb2ludENsb3VkJzoKCQkJCWNhc2UgJ1BvaW50cyc6CgoJCQkJCW9iamVjdCA9IG5ldyBQb2ludHMoIGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICksIGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICkgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnU3ByaXRlJzoKCgkJCQkJb2JqZWN0ID0gbmV3IFNwcml0ZSggZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdHcm91cCc6CgoJCQkJCW9iamVjdCA9IG5ldyBHcm91cCgpOwoKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoKCQkJCQlvYmplY3QgPSBuZXcgT2JqZWN0M0QoKTsKCgkJCX0KCgkJCW9iamVjdC51dWlkID0gZGF0YS51dWlkOwoKCQkJaWYgKCBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCApIG9iamVjdC5uYW1lID0gZGF0YS5uYW1lOwoKCQkJaWYgKCBkYXRhLm1hdHJpeCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW9iamVjdC5tYXRyaXguZnJvbUFycmF5KCBkYXRhLm1hdHJpeCApOwoKCQkJCWlmICggZGF0YS5tYXRyaXhBdXRvVXBkYXRlICE9PSB1bmRlZmluZWQgKSBvYmplY3QubWF0cml4QXV0b1VwZGF0ZSA9IGRhdGEubWF0cml4QXV0b1VwZGF0ZTsKCQkJCWlmICggb2JqZWN0Lm1hdHJpeEF1dG9VcGRhdGUgKSBvYmplY3QubWF0cml4LmRlY29tcG9zZSggb2JqZWN0LnBvc2l0aW9uLCBvYmplY3QucXVhdGVybmlvbiwgb2JqZWN0LnNjYWxlICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggZGF0YS5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnBvc2l0aW9uLmZyb21BcnJheSggZGF0YS5wb3NpdGlvbiApOwoJCQkJaWYgKCBkYXRhLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBvYmplY3Qucm90YXRpb24uZnJvbUFycmF5KCBkYXRhLnJvdGF0aW9uICk7CgkJCQlpZiAoIGRhdGEucXVhdGVybmlvbiAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnF1YXRlcm5pb24uZnJvbUFycmF5KCBkYXRhLnF1YXRlcm5pb24gKTsKCQkJCWlmICggZGF0YS5zY2FsZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNjYWxlLmZyb21BcnJheSggZGF0YS5zY2FsZSApOwoKCQkJfQoKCQkJaWYgKCBkYXRhLmNhc3RTaGFkb3cgIT09IHVuZGVmaW5lZCApIG9iamVjdC5jYXN0U2hhZG93ID0gZGF0YS5jYXN0U2hhZG93OwoJCQlpZiAoIGRhdGEucmVjZWl2ZVNoYWRvdyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnJlY2VpdmVTaGFkb3cgPSBkYXRhLnJlY2VpdmVTaGFkb3c7CgoJCQlpZiAoIGRhdGEuc2hhZG93ICkgewoKCQkJCWlmICggZGF0YS5zaGFkb3cuYmlhcyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNoYWRvdy5iaWFzID0gZGF0YS5zaGFkb3cuYmlhczsKCQkJCWlmICggZGF0YS5zaGFkb3cucmFkaXVzICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2hhZG93LnJhZGl1cyA9IGRhdGEuc2hhZG93LnJhZGl1czsKCQkJCWlmICggZGF0YS5zaGFkb3cubWFwU2l6ZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNoYWRvdy5tYXBTaXplLmZyb21BcnJheSggZGF0YS5zaGFkb3cubWFwU2l6ZSApOwoJCQkJaWYgKCBkYXRhLnNoYWRvdy5jYW1lcmEgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cuY2FtZXJhID0gdGhpcy5wYXJzZU9iamVjdCggZGF0YS5zaGFkb3cuY2FtZXJhICk7CgoJCQl9CgoJCQlpZiAoIGRhdGEudmlzaWJsZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnZpc2libGUgPSBkYXRhLnZpc2libGU7CgkJCWlmICggZGF0YS5mcnVzdHVtQ3VsbGVkICE9PSB1bmRlZmluZWQgKSBvYmplY3QuZnJ1c3R1bUN1bGxlZCA9IGRhdGEuZnJ1c3R1bUN1bGxlZDsKCQkJaWYgKCBkYXRhLnJlbmRlck9yZGVyICE9PSB1bmRlZmluZWQgKSBvYmplY3QucmVuZGVyT3JkZXIgPSBkYXRhLnJlbmRlck9yZGVyOwoJCQlpZiAoIGRhdGEudXNlckRhdGEgIT09IHVuZGVmaW5lZCApIG9iamVjdC51c2VyRGF0YSA9IGRhdGEudXNlckRhdGE7CgkJCWlmICggZGF0YS5sYXllcnMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5sYXllcnMubWFzayA9IGRhdGEubGF5ZXJzOwoKCQkJaWYgKCBkYXRhLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdmFyIGNoaWxkcmVuID0gZGF0YS5jaGlsZHJlbjsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCW9iamVjdC5hZGQoIHRoaXMucGFyc2VPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGdlb21ldHJpZXMsIG1hdGVyaWFscyApICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBkYXRhLnR5cGUgPT09ICdMT0QnICkgewoKCQkJCXZhciBsZXZlbHMgPSBkYXRhLmxldmVsczsKCgkJCQlmb3IgKCB2YXIgbCA9IDA7IGwgPCBsZXZlbHMubGVuZ3RoOyBsICsrICkgewoKCQkJCQl2YXIgbGV2ZWwgPSBsZXZlbHNbIGwgXTsKCQkJCQl2YXIgY2hpbGQgPSBvYmplY3QuZ2V0T2JqZWN0QnlQcm9wZXJ0eSggJ3V1aWQnLCBsZXZlbC5vYmplY3QgKTsKCgkJCQkJaWYgKCBjaGlsZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJb2JqZWN0LmFkZExldmVsKCBjaGlsZCwgbGV2ZWwuZGlzdGFuY2UgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBvYmplY3Q7CgoJCX0KCgl9ICk7CgoJdmFyIFRFWFRVUkVfTUFQUElORyA9IHsKCQlVVk1hcHBpbmc6IFVWTWFwcGluZywKCQlDdWJlUmVmbGVjdGlvbk1hcHBpbmc6IEN1YmVSZWZsZWN0aW9uTWFwcGluZywKCQlDdWJlUmVmcmFjdGlvbk1hcHBpbmc6IEN1YmVSZWZyYWN0aW9uTWFwcGluZywKCQlFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZzogRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcsCgkJRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmc6IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nLAoJCVNwaGVyaWNhbFJlZmxlY3Rpb25NYXBwaW5nOiBTcGhlcmljYWxSZWZsZWN0aW9uTWFwcGluZywKCQlDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzogQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcsCgkJQ3ViZVVWUmVmcmFjdGlvbk1hcHBpbmc6IEN1YmVVVlJlZnJhY3Rpb25NYXBwaW5nCgl9OwoKCXZhciBURVhUVVJFX1dSQVBQSU5HID0gewoJCVJlcGVhdFdyYXBwaW5nOiBSZXBlYXRXcmFwcGluZywKCQlDbGFtcFRvRWRnZVdyYXBwaW5nOiBDbGFtcFRvRWRnZVdyYXBwaW5nLAoJCU1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcKCX07CgoJdmFyIFRFWFRVUkVfRklMVEVSID0gewoJCU5lYXJlc3RGaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsCgkJTmVhcmVzdE1pcE1hcE5lYXJlc3RGaWx0ZXI6IE5lYXJlc3RNaXBNYXBOZWFyZXN0RmlsdGVyLAoJCU5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXI6IE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIsCgkJTGluZWFyRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCgkJTGluZWFyTWlwTWFwTmVhcmVzdEZpbHRlcjogTGluZWFyTWlwTWFwTmVhcmVzdEZpbHRlciwKCQlMaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXI6IExpbmVhck1pcE1hcExpbmVhckZpbHRlcgoJfTsKCgkvKioKCSAqIEBhdXRob3IgdGhlc3BpdGUgLyBodHRwOi8vY2xpY2t0b3JlbGVhc2UuY29tLwoJICovCgoKCWZ1bmN0aW9uIEltYWdlQml0bWFwTG9hZGVyKCBtYW5hZ2VyICkgewoKCQlpZiAoIHR5cGVvZiBjcmVhdGVJbWFnZUJpdG1hcCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogY3JlYXRlSW1hZ2VCaXRtYXAoKSBub3Qgc3VwcG9ydGVkLicgKTsKCgkJfQoKCQlpZiAoIHR5cGVvZiBmZXRjaCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogZmV0Y2goKSBub3Qgc3VwcG9ydGVkLicgKTsKCgkJfQoKCQl0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyICE9PSB1bmRlZmluZWQgPyBtYW5hZ2VyIDogRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwoJCXRoaXMub3B0aW9ucyA9IHVuZGVmaW5lZDsKCgl9CgoJSW1hZ2VCaXRtYXBMb2FkZXIucHJvdG90eXBlID0gewoKCQljb25zdHJ1Y3RvcjogSW1hZ2VCaXRtYXBMb2FkZXIsCgoJCXNldE9wdGlvbnM6IGZ1bmN0aW9uIHNldE9wdGlvbnMoIG9wdGlvbnMgKSB7CgoJCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQlpZiAoIHVybCA9PT0gdW5kZWZpbmVkICkgdXJsID0gJyc7CgoJCQlpZiAoIHRoaXMucGF0aCAhPT0gdW5kZWZpbmVkICkgdXJsID0gdGhpcy5wYXRoICsgdXJsOwoKCQkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQkJdmFyIHNjb3BlID0gdGhpczsKCgkJCXZhciBjYWNoZWQgPSBDYWNoZS5nZXQoIHVybCApOwoKCQkJaWYgKCBjYWNoZWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQkJc2V0VGltZW91dCggZnVuY3Rpb24gKCkgewoKCQkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggY2FjaGVkICk7CgoJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJfSwgMCApOwoKCQkJCXJldHVybiBjYWNoZWQ7CgoJCQl9CgoJCQlmZXRjaCggdXJsICkudGhlbiggZnVuY3Rpb24gKCByZXMgKSB7CgoJCQkJcmV0dXJuIHJlcy5ibG9iKCk7CgoJCQl9ICkudGhlbiggZnVuY3Rpb24gKCBibG9iICkgewoKCQkJCWlmICggc2NvcGUub3B0aW9ucyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkvLyBXb3JrYXJvdW5kIGZvciBGaXJlRm94LiBJdCBjYXVzZXMgYW4gZXJyb3IgaWYgeW91IHBhc3Mgb3B0aW9ucy4KCQkJCQlyZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAoIGJsb2IgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAoIGJsb2IsIHNjb3BlLm9wdGlvbnMgKTsKCgkJCQl9CgoJCQl9ICkudGhlbiggZnVuY3Rpb24gKCBpbWFnZUJpdG1hcCApIHsKCgkJCQlDYWNoZS5hZGQoIHVybCwgaW1hZ2VCaXRtYXAgKTsKCgkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggaW1hZ2VCaXRtYXAgKTsKCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJfSApLmNhdGNoKCBmdW5jdGlvbiAoIGUgKSB7CgoJCQkJaWYgKCBvbkVycm9yICkgb25FcnJvciggZSApOwoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9ICk7CgoJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCX0sCgoJCXNldENyb3NzT3JpZ2luOiBmdW5jdGlvbiAoIC8qIHZhbHVlICovICkgewoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9OwoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL3d3dy5sYWI0Z2FtZXMubmV0L3p6ODUvYmxvZwoJICogbWluaW1hbCBjbGFzcyBmb3IgcHJveGluZyBmdW5jdGlvbnMgdG8gUGF0aC4gUmVwbGFjZXMgb2xkICJleHRyYWN0U3VicGF0aHMoKSIKCSAqKi8KCglmdW5jdGlvbiBTaGFwZVBhdGgoKSB7CgoJCXRoaXMudHlwZSA9ICdTaGFwZVBhdGgnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCk7CgoJCXRoaXMuc3ViUGF0aHMgPSBbXTsKCQl0aGlzLmN1cnJlbnRQYXRoID0gbnVsbDsKCgl9CgoJT2JqZWN0LmFzc2lnbiggU2hhcGVQYXRoLnByb3RvdHlwZSwgewoKCQltb3ZlVG86IGZ1bmN0aW9uICggeCwgeSApIHsKCgkJCXRoaXMuY3VycmVudFBhdGggPSBuZXcgUGF0aCgpOwoJCQl0aGlzLnN1YlBhdGhzLnB1c2goIHRoaXMuY3VycmVudFBhdGggKTsKCQkJdGhpcy5jdXJyZW50UGF0aC5tb3ZlVG8oIHgsIHkgKTsKCgkJfSwKCgkJbGluZVRvOiBmdW5jdGlvbiAoIHgsIHkgKSB7CgoJCQl0aGlzLmN1cnJlbnRQYXRoLmxpbmVUbyggeCwgeSApOwoKCQl9LAoKCQlxdWFkcmF0aWNDdXJ2ZVRvOiBmdW5jdGlvbiAoIGFDUHgsIGFDUHksIGFYLCBhWSApIHsKCgkJCXRoaXMuY3VycmVudFBhdGgucXVhZHJhdGljQ3VydmVUbyggYUNQeCwgYUNQeSwgYVgsIGFZICk7CgoJCX0sCgoJCWJlemllckN1cnZlVG86IGZ1bmN0aW9uICggYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSApIHsKCgkJCXRoaXMuY3VycmVudFBhdGguYmV6aWVyQ3VydmVUbyggYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSApOwoKCQl9LAoKCQlzcGxpbmVUaHJ1OiBmdW5jdGlvbiAoIHB0cyApIHsKCgkJCXRoaXMuY3VycmVudFBhdGguc3BsaW5lVGhydSggcHRzICk7CgoJCX0sCgoJCXRvU2hhcGVzOiBmdW5jdGlvbiAoIGlzQ0NXLCBub0hvbGVzICkgewoKCQkJZnVuY3Rpb24gdG9TaGFwZXNOb0hvbGVzKCBpblN1YnBhdGhzICkgewoKCQkJCXZhciBzaGFwZXMgPSBbXTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGwgPSBpblN1YnBhdGhzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXZhciB0bXBQYXRoID0gaW5TdWJwYXRoc1sgaSBdOwoKCQkJCQl2YXIgdG1wU2hhcGUgPSBuZXcgU2hhcGUoKTsKCQkJCQl0bXBTaGFwZS5jdXJ2ZXMgPSB0bXBQYXRoLmN1cnZlczsKCgkJCQkJc2hhcGVzLnB1c2goIHRtcFNoYXBlICk7CgoJCQkJfQoKCQkJCXJldHVybiBzaGFwZXM7CgoJCQl9CgoJCQlmdW5jdGlvbiBpc1BvaW50SW5zaWRlUG9seWdvbiggaW5QdCwgaW5Qb2x5Z29uICkgewoKCQkJCXZhciBwb2x5TGVuID0gaW5Qb2x5Z29uLmxlbmd0aDsKCgkJCQkvLyBpblB0IG9uIHBvbHlnb24gY29udG91ciA9PiBpbW1lZGlhdGUgc3VjY2VzcyAgICBvcgoJCQkJLy8gdG9nZ2xpbmcgb2YgaW5zaWRlL291dHNpZGUgYXQgZXZlcnkgc2luZ2xlISBpbnRlcnNlY3Rpb24gcG9pbnQgb2YgYW4gZWRnZQoJCQkJLy8gIHdpdGggdGhlIGhvcml6b250YWwgbGluZSB0aHJvdWdoIGluUHQsIGxlZnQgb2YgaW5QdAoJCQkJLy8gIG5vdCBjb3VudGluZyBsb3dlclkgZW5kcG9pbnRzIG9mIGVkZ2VzIGFuZCB3aG9sZSBlZGdlcyBvbiB0aGF0IGxpbmUKCQkJCXZhciBpbnNpZGUgPSBmYWxzZTsKCQkJCWZvciAoIHZhciBwID0gcG9seUxlbiAtIDEsIHEgPSAwOyBxIDwgcG9seUxlbjsgcCA9IHEgKysgKSB7CgoJCQkJCXZhciBlZGdlTG93UHQgPSBpblBvbHlnb25bIHAgXTsKCQkJCQl2YXIgZWRnZUhpZ2hQdCA9IGluUG9seWdvblsgcSBdOwoKCQkJCQl2YXIgZWRnZUR4ID0gZWRnZUhpZ2hQdC54IC0gZWRnZUxvd1B0Lng7CgkJCQkJdmFyIGVkZ2VEeSA9IGVkZ2VIaWdoUHQueSAtIGVkZ2VMb3dQdC55OwoKCQkJCQlpZiAoIE1hdGguYWJzKCBlZGdlRHkgKSA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJLy8gbm90IHBhcmFsbGVsCgkJCQkJCWlmICggZWRnZUR5IDwgMCApIHsKCgkJCQkJCQllZGdlTG93UHQgPSBpblBvbHlnb25bIHEgXTsgZWRnZUR4ID0gLSBlZGdlRHg7CgkJCQkJCQllZGdlSGlnaFB0ID0gaW5Qb2x5Z29uWyBwIF07IGVkZ2VEeSA9IC0gZWRnZUR5OwoKCQkJCQkJfQoJCQkJCQlpZiAoICggaW5QdC55IDwgZWRnZUxvd1B0LnkgKSB8fCAoIGluUHQueSA+IGVkZ2VIaWdoUHQueSApICkgCQljb250aW51ZTsKCgkJCQkJCWlmICggaW5QdC55ID09PSBlZGdlTG93UHQueSApIHsKCgkJCQkJCQlpZiAoIGluUHQueCA9PT0gZWRnZUxvd1B0LnggKQkJcmV0dXJuCXRydWU7CQkvLyBpblB0IGlzIG9uIGNvbnRvdXIgPwoJCQkJCQkJLy8gY29udGludWU7CQkJCS8vIG5vIGludGVyc2VjdGlvbiBvciBlZGdlTG93UHQgPT4gZG9lc24ndCBjb3VudCAhISEKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdmFyIHBlcnBFZGdlID0gZWRnZUR5ICogKCBpblB0LnggLSBlZGdlTG93UHQueCApIC0gZWRnZUR4ICogKCBpblB0LnkgLSBlZGdlTG93UHQueSApOwoJCQkJCQkJaWYgKCBwZXJwRWRnZSA9PT0gMCApCQkJCXJldHVybgl0cnVlOwkJLy8gaW5QdCBpcyBvbiBjb250b3VyID8KCQkJCQkJCWlmICggcGVycEVkZ2UgPCAwICkgCQkJCWNvbnRpbnVlOwoJCQkJCQkJaW5zaWRlID0gISBpbnNpZGU7CQkvLyB0cnVlIGludGVyc2VjdGlvbiBsZWZ0IG9mIGluUHQKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHBhcmFsbGVsIG9yIGNvbGxpbmVhcgoJCQkJCQlpZiAoIGluUHQueSAhPT0gZWRnZUxvd1B0LnkgKSAJCWNvbnRpbnVlOwkJCS8vIHBhcmFsbGVsCgkJCQkJCS8vIGVkZ2UgbGllcyBvbiB0aGUgc2FtZSBob3Jpem9udGFsIGxpbmUgYXMgaW5QdAoJCQkJCQlpZiAoICggKCBlZGdlSGlnaFB0LnggPD0gaW5QdC54ICkgJiYgKCBpblB0LnggPD0gZWRnZUxvd1B0LnggKSApIHx8CgkJCQkJCQkgKCAoIGVkZ2VMb3dQdC54IDw9IGluUHQueCApICYmICggaW5QdC54IDw9IGVkZ2VIaWdoUHQueCApICkgKQkJcmV0dXJuCXRydWU7CS8vIGluUHQ6IFBvaW50IG9uIGNvbnRvdXIgIQoJCQkJCQkvLyBjb250aW51ZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4JaW5zaWRlOwoKCQkJfQoKCQkJdmFyIGlzQ2xvY2tXaXNlID0gU2hhcGVVdGlscy5pc0Nsb2NrV2lzZTsKCgkJCXZhciBzdWJQYXRocyA9IHRoaXMuc3ViUGF0aHM7CgkJCWlmICggc3ViUGF0aHMubGVuZ3RoID09PSAwICkgcmV0dXJuIFtdOwoKCQkJaWYgKCBub0hvbGVzID09PSB0cnVlICkJcmV0dXJuCXRvU2hhcGVzTm9Ib2xlcyggc3ViUGF0aHMgKTsKCgoJCQl2YXIgc29saWQsIHRtcFBhdGgsIHRtcFNoYXBlLCBzaGFwZXMgPSBbXTsKCgkJCWlmICggc3ViUGF0aHMubGVuZ3RoID09PSAxICkgewoKCQkJCXRtcFBhdGggPSBzdWJQYXRoc1sgMCBdOwoJCQkJdG1wU2hhcGUgPSBuZXcgU2hhcGUoKTsKCQkJCXRtcFNoYXBlLmN1cnZlcyA9IHRtcFBhdGguY3VydmVzOwoJCQkJc2hhcGVzLnB1c2goIHRtcFNoYXBlICk7CgkJCQlyZXR1cm4gc2hhcGVzOwoKCQkJfQoKCQkJdmFyIGhvbGVzRmlyc3QgPSAhIGlzQ2xvY2tXaXNlKCBzdWJQYXRoc1sgMCBdLmdldFBvaW50cygpICk7CgkJCWhvbGVzRmlyc3QgPSBpc0NDVyA/ICEgaG9sZXNGaXJzdCA6IGhvbGVzRmlyc3Q7CgoJCQkvLyBjb25zb2xlLmxvZygiSG9sZXMgZmlyc3QiLCBob2xlc0ZpcnN0KTsKCgkJCXZhciBiZXR0ZXJTaGFwZUhvbGVzID0gW107CgkJCXZhciBuZXdTaGFwZXMgPSBbXTsKCQkJdmFyIG5ld1NoYXBlSG9sZXMgPSBbXTsKCQkJdmFyIG1haW5JZHggPSAwOwoJCQl2YXIgdG1wUG9pbnRzOwoKCQkJbmV3U2hhcGVzWyBtYWluSWR4IF0gPSB1bmRlZmluZWQ7CgkJCW5ld1NoYXBlSG9sZXNbIG1haW5JZHggXSA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc3ViUGF0aHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl0bXBQYXRoID0gc3ViUGF0aHNbIGkgXTsKCQkJCXRtcFBvaW50cyA9IHRtcFBhdGguZ2V0UG9pbnRzKCk7CgkJCQlzb2xpZCA9IGlzQ2xvY2tXaXNlKCB0bXBQb2ludHMgKTsKCQkJCXNvbGlkID0gaXNDQ1cgPyAhIHNvbGlkIDogc29saWQ7CgoJCQkJaWYgKCBzb2xpZCApIHsKCgkJCQkJaWYgKCAoICEgaG9sZXNGaXJzdCApICYmICggbmV3U2hhcGVzWyBtYWluSWR4IF0gKSApCW1haW5JZHggKys7CgoJCQkJCW5ld1NoYXBlc1sgbWFpbklkeCBdID0geyBzOiBuZXcgU2hhcGUoKSwgcDogdG1wUG9pbnRzIH07CgkJCQkJbmV3U2hhcGVzWyBtYWluSWR4IF0ucy5jdXJ2ZXMgPSB0bXBQYXRoLmN1cnZlczsKCgkJCQkJaWYgKCBob2xlc0ZpcnN0ICkJbWFpbklkeCArKzsKCQkJCQluZXdTaGFwZUhvbGVzWyBtYWluSWR4IF0gPSBbXTsKCgkJCQkJLy9jb25zb2xlLmxvZygnY3cnLCBpKTsKCgkJCQl9IGVsc2UgewoKCQkJCQluZXdTaGFwZUhvbGVzWyBtYWluSWR4IF0ucHVzaCggeyBoOiB0bXBQYXRoLCBwOiB0bXBQb2ludHNbIDAgXSB9ICk7CgoJCQkJCS8vY29uc29sZS5sb2coJ2NjdycsIGkpOwoKCQkJCX0KCgkJCX0KCgkJCS8vIG9ubHkgSG9sZXM/IC0+IHByb2JhYmx5IGFsbCBTaGFwZXMgd2l0aCB3cm9uZyBvcmllbnRhdGlvbgoJCQlpZiAoICEgbmV3U2hhcGVzWyAwIF0gKQlyZXR1cm4JdG9TaGFwZXNOb0hvbGVzKCBzdWJQYXRocyApOwoKCgkJCWlmICggbmV3U2hhcGVzLmxlbmd0aCA+IDEgKSB7CgoJCQkJdmFyIGFtYmlndW91cyA9IGZhbHNlOwoJCQkJdmFyIHRvQ2hhbmdlID0gW107CgoJCQkJZm9yICggdmFyIHNJZHggPSAwLCBzTGVuID0gbmV3U2hhcGVzLmxlbmd0aDsgc0lkeCA8IHNMZW47IHNJZHggKysgKSB7CgoJCQkJCWJldHRlclNoYXBlSG9sZXNbIHNJZHggXSA9IFtdOwoKCQkJCX0KCgkJCQlmb3IgKCB2YXIgc0lkeCA9IDAsIHNMZW4gPSBuZXdTaGFwZXMubGVuZ3RoOyBzSWR4IDwgc0xlbjsgc0lkeCArKyApIHsKCgkJCQkJdmFyIHNobyA9IG5ld1NoYXBlSG9sZXNbIHNJZHggXTsKCgkJCQkJZm9yICggdmFyIGhJZHggPSAwOyBoSWR4IDwgc2hvLmxlbmd0aDsgaElkeCArKyApIHsKCgkJCQkJCXZhciBobyA9IHNob1sgaElkeCBdOwoJCQkJCQl2YXIgaG9sZV91bmFzc2lnbmVkID0gdHJ1ZTsKCgkJCQkJCWZvciAoIHZhciBzMklkeCA9IDA7IHMySWR4IDwgbmV3U2hhcGVzLmxlbmd0aDsgczJJZHggKysgKSB7CgoJCQkJCQkJaWYgKCBpc1BvaW50SW5zaWRlUG9seWdvbiggaG8ucCwgbmV3U2hhcGVzWyBzMklkeCBdLnAgKSApIHsKCgkJCQkJCQkJaWYgKCBzSWR4ICE9PSBzMklkeCApCXRvQ2hhbmdlLnB1c2goIHsgZnJvbXM6IHNJZHgsIHRvczogczJJZHgsIGhvbGU6IGhJZHggfSApOwoJCQkJCQkJCWlmICggaG9sZV91bmFzc2lnbmVkICkgewoKCQkJCQkJCQkJaG9sZV91bmFzc2lnbmVkID0gZmFsc2U7CgkJCQkJCQkJCWJldHRlclNoYXBlSG9sZXNbIHMySWR4IF0ucHVzaCggaG8gKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCWFtYmlndW91cyA9IHRydWU7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9CgkJCQkJCWlmICggaG9sZV91bmFzc2lnbmVkICkgewoKCQkJCQkJCWJldHRlclNoYXBlSG9sZXNbIHNJZHggXS5wdXNoKCBobyApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoJCQkJLy8gY29uc29sZS5sb2coImFtYmlndW91czogIiwgYW1iaWd1b3VzKTsKCQkJCWlmICggdG9DaGFuZ2UubGVuZ3RoID4gMCApIHsKCgkJCQkJLy8gY29uc29sZS5sb2coInRvIGNoYW5nZTogIiwgdG9DaGFuZ2UpOwoJCQkJCWlmICggISBhbWJpZ3VvdXMgKQluZXdTaGFwZUhvbGVzID0gYmV0dGVyU2hhcGVIb2xlczsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgdG1wSG9sZXM7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbmV3U2hhcGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRtcFNoYXBlID0gbmV3U2hhcGVzWyBpIF0uczsKCQkJCXNoYXBlcy5wdXNoKCB0bXBTaGFwZSApOwoJCQkJdG1wSG9sZXMgPSBuZXdTaGFwZUhvbGVzWyBpIF07CgoJCQkJZm9yICggdmFyIGogPSAwLCBqbCA9IHRtcEhvbGVzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQl0bXBTaGFwZS5ob2xlcy5wdXNoKCB0bXBIb2xlc1sgaiBdLmggKTsKCgkJCQl9CgoJCQl9CgoJCQkvL2NvbnNvbGUubG9nKCJzaGFwZSIsIHNoYXBlcyk7CgoJCQlyZXR1cm4gc2hhcGVzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL3d3dy5sYWI0Z2FtZXMubmV0L3p6ODUvYmxvZwoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCglmdW5jdGlvbiBGb250KCBkYXRhICkgewoKCQl0aGlzLnR5cGUgPSAnRm9udCc7CgoJCXRoaXMuZGF0YSA9IGRhdGE7CgoJfQoKCU9iamVjdC5hc3NpZ24oIEZvbnQucHJvdG90eXBlLCB7CgoJCWlzRm9udDogdHJ1ZSwKCgkJZ2VuZXJhdGVTaGFwZXM6IGZ1bmN0aW9uICggdGV4dCwgc2l6ZSApIHsKCgkJCWlmICggc2l6ZSA9PT0gdW5kZWZpbmVkICkgc2l6ZSA9IDEwMDsKCgkJCXZhciBzaGFwZXMgPSBbXTsKCQkJdmFyIHBhdGhzID0gY3JlYXRlUGF0aHMoIHRleHQsIHNpemUsIHRoaXMuZGF0YSApOwoKCQkJZm9yICggdmFyIHAgPSAwLCBwbCA9IHBhdGhzLmxlbmd0aDsgcCA8IHBsOyBwICsrICkgewoKCQkJCUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KCBzaGFwZXMsIHBhdGhzWyBwIF0udG9TaGFwZXMoKSApOwoKCQkJfQoKCQkJcmV0dXJuIHNoYXBlczsKCgkJfQoKCX0gKTsKCglmdW5jdGlvbiBjcmVhdGVQYXRocyggdGV4dCwgc2l6ZSwgZGF0YSApIHsKCgkJdmFyIGNoYXJzID0gQXJyYXkuZnJvbSA/IEFycmF5LmZyb20oIHRleHQgKSA6IFN0cmluZyggdGV4dCApLnNwbGl0KCAnJyApOyAvLyBzZWUgIzEzOTg4CgkJdmFyIHNjYWxlID0gc2l6ZSAvIGRhdGEucmVzb2x1dGlvbjsKCQl2YXIgbGluZV9oZWlnaHQgPSAoIGRhdGEuYm91bmRpbmdCb3gueU1heCAtIGRhdGEuYm91bmRpbmdCb3gueU1pbiArIGRhdGEudW5kZXJsaW5lVGhpY2tuZXNzICkgKiBzY2FsZTsKCgkJdmFyIHBhdGhzID0gW107CgoJCXZhciBvZmZzZXRYID0gMCwgb2Zmc2V0WSA9IDA7CgoJCWZvciAoIHZhciBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCXZhciBjaGFyID0gY2hhcnNbIGkgXTsKCgkJCWlmICggY2hhciA9PT0gJ1xuJyApIHsKCgkJCQlvZmZzZXRYID0gMDsKCQkJCW9mZnNldFkgLT0gbGluZV9oZWlnaHQ7CgoJCQl9IGVsc2UgewoKCQkJCXZhciByZXQgPSBjcmVhdGVQYXRoKCBjaGFyLCBzY2FsZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgZGF0YSApOwoJCQkJb2Zmc2V0WCArPSByZXQub2Zmc2V0WDsKCQkJCXBhdGhzLnB1c2goIHJldC5wYXRoICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHBhdGhzOwoKCX0KCglmdW5jdGlvbiBjcmVhdGVQYXRoKCBjaGFyLCBzY2FsZSwgb2Zmc2V0WCwgb2Zmc2V0WSwgZGF0YSApIHsKCgkJdmFyIGdseXBoID0gZGF0YS5nbHlwaHNbIGNoYXIgXSB8fCBkYXRhLmdseXBoc1sgJz8nIF07CgoJCWlmICggISBnbHlwaCApIHJldHVybjsKCgkJdmFyIHBhdGggPSBuZXcgU2hhcGVQYXRoKCk7CgoJCXZhciB4LCB5LCBjcHgsIGNweSwgY3B4MSwgY3B5MSwgY3B4MiwgY3B5MjsKCgkJaWYgKCBnbHlwaC5vICkgewoKCQkJdmFyIG91dGxpbmUgPSBnbHlwaC5fY2FjaGVkT3V0bGluZSB8fCAoIGdseXBoLl9jYWNoZWRPdXRsaW5lID0gZ2x5cGguby5zcGxpdCggJyAnICkgKTsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IG91dGxpbmUubGVuZ3RoOyBpIDwgbDsgKSB7CgoJCQkJdmFyIGFjdGlvbiA9IG91dGxpbmVbIGkgKysgXTsKCgkJCQlzd2l0Y2ggKCBhY3Rpb24gKSB7CgoJCQkJCWNhc2UgJ20nOiAvLyBtb3ZlVG8KCgkJCQkJCXggPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFg7CgkJCQkJCXkgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFk7CgoJCQkJCQlwYXRoLm1vdmVUbyggeCwgeSApOwoKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2wnOiAvLyBsaW5lVG8KCgkJCQkJCXggPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFg7CgkJCQkJCXkgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFk7CgoJCQkJCQlwYXRoLmxpbmVUbyggeCwgeSApOwoKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ3EnOiAvLyBxdWFkcmF0aWNDdXJ2ZVRvCgoJCQkJCQljcHggPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFg7CgkJCQkJCWNweSA9IG91dGxpbmVbIGkgKysgXSAqIHNjYWxlICsgb2Zmc2V0WTsKCQkJCQkJY3B4MSA9IG91dGxpbmVbIGkgKysgXSAqIHNjYWxlICsgb2Zmc2V0WDsKCQkJCQkJY3B5MSA9IG91dGxpbmVbIGkgKysgXSAqIHNjYWxlICsgb2Zmc2V0WTsKCgkJCQkJCXBhdGgucXVhZHJhdGljQ3VydmVUbyggY3B4MSwgY3B5MSwgY3B4LCBjcHkgKTsKCgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdiJzogLy8gYmV6aWVyQ3VydmVUbwoKCQkJCQkJY3B4ID0gb3V0bGluZVsgaSArKyBdICogc2NhbGUgKyBvZmZzZXRYOwoJCQkJCQljcHkgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFk7CgkJCQkJCWNweDEgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFg7CgkJCQkJCWNweTEgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFk7CgkJCQkJCWNweDIgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFg7CgkJCQkJCWNweTIgPSBvdXRsaW5lWyBpICsrIF0gKiBzY2FsZSArIG9mZnNldFk7CgoJCQkJCQlwYXRoLmJlemllckN1cnZlVG8oIGNweDEsIGNweTEsIGNweDIsIGNweTIsIGNweCwgY3B5ICk7CgoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsgb2Zmc2V0WDogZ2x5cGguaGEgKiBzY2FsZSwgcGF0aDogcGF0aCB9OwoKCX0KCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBGb250TG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgl9CgoJT2JqZWN0LmFzc2lnbiggRm9udExvYWRlci5wcm90b3R5cGUsIHsKCgkJbG9hZDogZnVuY3Rpb24gKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCXZhciBzY29wZSA9IHRoaXM7CgoJCQl2YXIgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggdGV4dCApIHsKCgkJCQl2YXIganNvbjsKCgkJCQl0cnkgewoKCQkJCQlqc29uID0gSlNPTi5wYXJzZSggdGV4dCApOwoKCQkJCX0gY2F0Y2ggKCBlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Gb250TG9hZGVyOiB0eXBlZmFjZS5qcyBzdXBwb3J0IGlzIGJlaW5nIGRlcHJlY2F0ZWQuIFVzZSB0eXBlZmFjZS5qc29uIGluc3RlYWQuJyApOwoJCQkJCWpzb24gPSBKU09OLnBhcnNlKCB0ZXh0LnN1YnN0cmluZyggNjUsIHRleHQubGVuZ3RoIC0gMiApICk7CgoJCQkJfQoKCQkJCXZhciBmb250ID0gc2NvcGUucGFyc2UoIGpzb24gKTsKCgkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggZm9udCApOwoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQl9LAoKCQlwYXJzZTogZnVuY3Rpb24gKCBqc29uICkgewoKCQkJcmV0dXJuIG5ldyBGb250KCBqc29uICk7CgoJCX0sCgoJCXNldFBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhdGggPSB2YWx1ZTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gTG9hZGVyKCkge30KCglMb2FkZXIuSGFuZGxlcnMgPSB7CgoJCWhhbmRsZXJzOiBbXSwKCgkJYWRkOiBmdW5jdGlvbiAoIHJlZ2V4LCBsb2FkZXIgKSB7CgoJCQl0aGlzLmhhbmRsZXJzLnB1c2goIHJlZ2V4LCBsb2FkZXIgKTsKCgkJfSwKCgkJZ2V0OiBmdW5jdGlvbiAoIGZpbGUgKSB7CgoJCQl2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyICkgewoKCQkJCXZhciByZWdleCA9IGhhbmRsZXJzWyBpIF07CgkJCQl2YXIgbG9hZGVyID0gaGFuZGxlcnNbIGkgKyAxIF07CgoJCQkJaWYgKCByZWdleC50ZXN0KCBmaWxlICkgKSB7CgoJCQkJCXJldHVybiBsb2FkZXI7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgl9OwoKCU9iamVjdC5hc3NpZ24oIExvYWRlci5wcm90b3R5cGUsIHsKCgkJY3Jvc3NPcmlnaW46ICdhbm9ueW1vdXMnLAoKCQlvbkxvYWRTdGFydDogZnVuY3Rpb24gKCkge30sCgoJCW9uTG9hZFByb2dyZXNzOiBmdW5jdGlvbiAoKSB7fSwKCgkJb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHt9LAoKCQlpbml0TWF0ZXJpYWxzOiBmdW5jdGlvbiAoIG1hdGVyaWFscywgdGV4dHVyZVBhdGgsIGNyb3NzT3JpZ2luICkgewoKCQkJdmFyIGFycmF5ID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBtYXRlcmlhbHMubGVuZ3RoOyArKyBpICkgewoKCQkJCWFycmF5WyBpIF0gPSB0aGlzLmNyZWF0ZU1hdGVyaWFsKCBtYXRlcmlhbHNbIGkgXSwgdGV4dHVyZVBhdGgsIGNyb3NzT3JpZ2luICk7CgoJCQl9CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0sCgoJCWNyZWF0ZU1hdGVyaWFsOiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBCbGVuZGluZ01vZGUgPSB7CgkJCQlOb0JsZW5kaW5nOiBOb0JsZW5kaW5nLAoJCQkJTm9ybWFsQmxlbmRpbmc6IE5vcm1hbEJsZW5kaW5nLAoJCQkJQWRkaXRpdmVCbGVuZGluZzogQWRkaXRpdmVCbGVuZGluZywKCQkJCVN1YnRyYWN0aXZlQmxlbmRpbmc6IFN1YnRyYWN0aXZlQmxlbmRpbmcsCgkJCQlNdWx0aXBseUJsZW5kaW5nOiBNdWx0aXBseUJsZW5kaW5nLAoJCQkJQ3VzdG9tQmxlbmRpbmc6IEN1c3RvbUJsZW5kaW5nCgkJCX07CgoJCQl2YXIgY29sb3IgPSBuZXcgQ29sb3IoKTsKCQkJdmFyIHRleHR1cmVMb2FkZXIgPSBuZXcgVGV4dHVyZUxvYWRlcigpOwoJCQl2YXIgbWF0ZXJpYWxMb2FkZXIgPSBuZXcgTWF0ZXJpYWxMb2FkZXIoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjcmVhdGVNYXRlcmlhbCggbSwgdGV4dHVyZVBhdGgsIGNyb3NzT3JpZ2luICkgewoKCQkJCS8vIGNvbnZlcnQgZnJvbSBvbGQgbWF0ZXJpYWwgZm9ybWF0CgoJCQkJdmFyIHRleHR1cmVzID0ge307CgoJCQkJZnVuY3Rpb24gbG9hZFRleHR1cmUoIHBhdGgsIHJlcGVhdCwgb2Zmc2V0LCB3cmFwLCBhbmlzb3Ryb3B5ICkgewoKCQkJCQl2YXIgZnVsbFBhdGggPSB0ZXh0dXJlUGF0aCArIHBhdGg7CgkJCQkJdmFyIGxvYWRlciA9IExvYWRlci5IYW5kbGVycy5nZXQoIGZ1bGxQYXRoICk7CgoJCQkJCXZhciB0ZXh0dXJlOwoKCQkJCQlpZiAoIGxvYWRlciAhPT0gbnVsbCApIHsKCgkJCQkJCXRleHR1cmUgPSBsb2FkZXIubG9hZCggZnVsbFBhdGggKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRleHR1cmVMb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oIGNyb3NzT3JpZ2luICk7CgkJCQkJCXRleHR1cmUgPSB0ZXh0dXJlTG9hZGVyLmxvYWQoIGZ1bGxQYXRoICk7CgoJCQkJCX0KCgkJCQkJaWYgKCByZXBlYXQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXRleHR1cmUucmVwZWF0LmZyb21BcnJheSggcmVwZWF0ICk7CgoJCQkJCQlpZiAoIHJlcGVhdFsgMCBdICE9PSAxICkgdGV4dHVyZS53cmFwUyA9IFJlcGVhdFdyYXBwaW5nOwoJCQkJCQlpZiAoIHJlcGVhdFsgMSBdICE9PSAxICkgdGV4dHVyZS53cmFwVCA9IFJlcGVhdFdyYXBwaW5nOwoKCQkJCQl9CgoJCQkJCWlmICggb2Zmc2V0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl0ZXh0dXJlLm9mZnNldC5mcm9tQXJyYXkoIG9mZnNldCApOwoKCQkJCQl9CgoJCQkJCWlmICggd3JhcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJaWYgKCB3cmFwWyAwIF0gPT09ICdyZXBlYXQnICkgdGV4dHVyZS53cmFwUyA9IFJlcGVhdFdyYXBwaW5nOwoJCQkJCQlpZiAoIHdyYXBbIDAgXSA9PT0gJ21pcnJvcicgKSB0ZXh0dXJlLndyYXBTID0gTWlycm9yZWRSZXBlYXRXcmFwcGluZzsKCgkJCQkJCWlmICggd3JhcFsgMSBdID09PSAncmVwZWF0JyApIHRleHR1cmUud3JhcFQgPSBSZXBlYXRXcmFwcGluZzsKCQkJCQkJaWYgKCB3cmFwWyAxIF0gPT09ICdtaXJyb3InICkgdGV4dHVyZS53cmFwVCA9IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc7CgoJCQkJCX0KCgkJCQkJaWYgKCBhbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl0ZXh0dXJlLmFuaXNvdHJvcHkgPSBhbmlzb3Ryb3B5OwoKCQkJCQl9CgoJCQkJCXZhciB1dWlkID0gX01hdGguZ2VuZXJhdGVVVUlEKCk7CgoJCQkJCXRleHR1cmVzWyB1dWlkIF0gPSB0ZXh0dXJlOwoKCQkJCQlyZXR1cm4gdXVpZDsKCgkJCQl9CgoJCQkJLy8KCgkJCQl2YXIganNvbiA9IHsKCQkJCQl1dWlkOiBfTWF0aC5nZW5lcmF0ZVVVSUQoKSwKCQkJCQl0eXBlOiAnTWVzaExhbWJlcnRNYXRlcmlhbCcKCQkJCX07CgoJCQkJZm9yICggdmFyIG5hbWUgaW4gbSApIHsKCgkJCQkJdmFyIHZhbHVlID0gbVsgbmFtZSBdOwoKCQkJCQlzd2l0Y2ggKCBuYW1lICkgewoKCQkJCQkJY2FzZSAnRGJnQ29sb3InOgoJCQkJCQljYXNlICdEYmdJbmRleCc6CgkJCQkJCWNhc2UgJ29wdGljYWxEZW5zaXR5JzoKCQkJCQkJY2FzZSAnaWxsdW1pbmF0aW9uJzoKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdEYmdOYW1lJzoKCQkJCQkJCWpzb24ubmFtZSA9IHZhbHVlOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ2JsZW5kaW5nJzoKCQkJCQkJCWpzb24uYmxlbmRpbmcgPSBCbGVuZGluZ01vZGVbIHZhbHVlIF07CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnY29sb3JBbWJpZW50JzoKCQkJCQkJY2FzZSAnbWFwQW1iaWVudCc6CgkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Mb2FkZXIuY3JlYXRlTWF0ZXJpYWw6JywgbmFtZSwgJ2lzIG5vIGxvbmdlciBzdXBwb3J0ZWQuJyApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ2NvbG9yRGlmZnVzZSc6CgkJCQkJCQlqc29uLmNvbG9yID0gY29sb3IuZnJvbUFycmF5KCB2YWx1ZSApLmdldEhleCgpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ2NvbG9yU3BlY3VsYXInOgoJCQkJCQkJanNvbi5zcGVjdWxhciA9IGNvbG9yLmZyb21BcnJheSggdmFsdWUgKS5nZXRIZXgoKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdjb2xvckVtaXNzaXZlJzoKCQkJCQkJCWpzb24uZW1pc3NpdmUgPSBjb2xvci5mcm9tQXJyYXkoIHZhbHVlICkuZ2V0SGV4KCk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnc3BlY3VsYXJDb2VmJzoKCQkJCQkJCWpzb24uc2hpbmluZXNzID0gdmFsdWU7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnc2hhZGluZyc6CgkJCQkJCQlpZiAoIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICdiYXNpYycgKSBqc29uLnR5cGUgPSAnTWVzaEJhc2ljTWF0ZXJpYWwnOwoJCQkJCQkJaWYgKCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAncGhvbmcnICkganNvbi50eXBlID0gJ01lc2hQaG9uZ01hdGVyaWFsJzsKCQkJCQkJCWlmICggdmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ3N0YW5kYXJkJyApIGpzb24udHlwZSA9ICdNZXNoU3RhbmRhcmRNYXRlcmlhbCc7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwRGlmZnVzZSc6CgkJCQkJCQlqc29uLm1hcCA9IGxvYWRUZXh0dXJlKCB2YWx1ZSwgbS5tYXBEaWZmdXNlUmVwZWF0LCBtLm1hcERpZmZ1c2VPZmZzZXQsIG0ubWFwRGlmZnVzZVdyYXAsIG0ubWFwRGlmZnVzZUFuaXNvdHJvcHkgKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdtYXBEaWZmdXNlUmVwZWF0JzoKCQkJCQkJY2FzZSAnbWFwRGlmZnVzZU9mZnNldCc6CgkJCQkJCWNhc2UgJ21hcERpZmZ1c2VXcmFwJzoKCQkJCQkJY2FzZSAnbWFwRGlmZnVzZUFuaXNvdHJvcHknOgoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEVtaXNzaXZlJzoKCQkJCQkJCWpzb24uZW1pc3NpdmVNYXAgPSBsb2FkVGV4dHVyZSggdmFsdWUsIG0ubWFwRW1pc3NpdmVSZXBlYXQsIG0ubWFwRW1pc3NpdmVPZmZzZXQsIG0ubWFwRW1pc3NpdmVXcmFwLCBtLm1hcEVtaXNzaXZlQW5pc290cm9weSApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEVtaXNzaXZlUmVwZWF0JzoKCQkJCQkJY2FzZSAnbWFwRW1pc3NpdmVPZmZzZXQnOgoJCQkJCQljYXNlICdtYXBFbWlzc2l2ZVdyYXAnOgoJCQkJCQljYXNlICdtYXBFbWlzc2l2ZUFuaXNvdHJvcHknOgoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcExpZ2h0JzoKCQkJCQkJCWpzb24ubGlnaHRNYXAgPSBsb2FkVGV4dHVyZSggdmFsdWUsIG0ubWFwTGlnaHRSZXBlYXQsIG0ubWFwTGlnaHRPZmZzZXQsIG0ubWFwTGlnaHRXcmFwLCBtLm1hcExpZ2h0QW5pc290cm9weSApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcExpZ2h0UmVwZWF0JzoKCQkJCQkJY2FzZSAnbWFwTGlnaHRPZmZzZXQnOgoJCQkJCQljYXNlICdtYXBMaWdodFdyYXAnOgoJCQkJCQljYXNlICdtYXBMaWdodEFuaXNvdHJvcHknOgoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEFPJzoKCQkJCQkJCWpzb24uYW9NYXAgPSBsb2FkVGV4dHVyZSggdmFsdWUsIG0ubWFwQU9SZXBlYXQsIG0ubWFwQU9PZmZzZXQsIG0ubWFwQU9XcmFwLCBtLm1hcEFPQW5pc290cm9weSApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEFPUmVwZWF0JzoKCQkJCQkJY2FzZSAnbWFwQU9PZmZzZXQnOgoJCQkJCQljYXNlICdtYXBBT1dyYXAnOgoJCQkJCQljYXNlICdtYXBBT0FuaXNvdHJvcHknOgoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEJ1bXAnOgoJCQkJCQkJanNvbi5idW1wTWFwID0gbG9hZFRleHR1cmUoIHZhbHVlLCBtLm1hcEJ1bXBSZXBlYXQsIG0ubWFwQnVtcE9mZnNldCwgbS5tYXBCdW1wV3JhcCwgbS5tYXBCdW1wQW5pc290cm9weSApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEJ1bXBTY2FsZSc6CgkJCQkJCQlqc29uLmJ1bXBTY2FsZSA9IHZhbHVlOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcEJ1bXBSZXBlYXQnOgoJCQkJCQljYXNlICdtYXBCdW1wT2Zmc2V0JzoKCQkJCQkJY2FzZSAnbWFwQnVtcFdyYXAnOgoJCQkJCQljYXNlICdtYXBCdW1wQW5pc290cm9weSc6CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwTm9ybWFsJzoKCQkJCQkJCWpzb24ubm9ybWFsTWFwID0gbG9hZFRleHR1cmUoIHZhbHVlLCBtLm1hcE5vcm1hbFJlcGVhdCwgbS5tYXBOb3JtYWxPZmZzZXQsIG0ubWFwTm9ybWFsV3JhcCwgbS5tYXBOb3JtYWxBbmlzb3Ryb3B5ICk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwTm9ybWFsRmFjdG9yJzoKCQkJCQkJCWpzb24ubm9ybWFsU2NhbGUgPSB2YWx1ZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdtYXBOb3JtYWxSZXBlYXQnOgoJCQkJCQljYXNlICdtYXBOb3JtYWxPZmZzZXQnOgoJCQkJCQljYXNlICdtYXBOb3JtYWxXcmFwJzoKCQkJCQkJY2FzZSAnbWFwTm9ybWFsQW5pc290cm9weSc6CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwU3BlY3VsYXInOgoJCQkJCQkJanNvbi5zcGVjdWxhck1hcCA9IGxvYWRUZXh0dXJlKCB2YWx1ZSwgbS5tYXBTcGVjdWxhclJlcGVhdCwgbS5tYXBTcGVjdWxhck9mZnNldCwgbS5tYXBTcGVjdWxhcldyYXAsIG0ubWFwU3BlY3VsYXJBbmlzb3Ryb3B5ICk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwU3BlY3VsYXJSZXBlYXQnOgoJCQkJCQljYXNlICdtYXBTcGVjdWxhck9mZnNldCc6CgkJCQkJCWNhc2UgJ21hcFNwZWN1bGFyV3JhcCc6CgkJCQkJCWNhc2UgJ21hcFNwZWN1bGFyQW5pc290cm9weSc6CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwTWV0YWxuZXNzJzoKCQkJCQkJCWpzb24ubWV0YWxuZXNzTWFwID0gbG9hZFRleHR1cmUoIHZhbHVlLCBtLm1hcE1ldGFsbmVzc1JlcGVhdCwgbS5tYXBNZXRhbG5lc3NPZmZzZXQsIG0ubWFwTWV0YWxuZXNzV3JhcCwgbS5tYXBNZXRhbG5lc3NBbmlzb3Ryb3B5ICk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnbWFwTWV0YWxuZXNzUmVwZWF0JzoKCQkJCQkJY2FzZSAnbWFwTWV0YWxuZXNzT2Zmc2V0JzoKCQkJCQkJY2FzZSAnbWFwTWV0YWxuZXNzV3JhcCc6CgkJCQkJCWNhc2UgJ21hcE1ldGFsbmVzc0FuaXNvdHJvcHknOgoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcFJvdWdobmVzcyc6CgkJCQkJCQlqc29uLnJvdWdobmVzc01hcCA9IGxvYWRUZXh0dXJlKCB2YWx1ZSwgbS5tYXBSb3VnaG5lc3NSZXBlYXQsIG0ubWFwUm91Z2huZXNzT2Zmc2V0LCBtLm1hcFJvdWdobmVzc1dyYXAsIG0ubWFwUm91Z2huZXNzQW5pc290cm9weSApOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ21hcFJvdWdobmVzc1JlcGVhdCc6CgkJCQkJCWNhc2UgJ21hcFJvdWdobmVzc09mZnNldCc6CgkJCQkJCWNhc2UgJ21hcFJvdWdobmVzc1dyYXAnOgoJCQkJCQljYXNlICdtYXBSb3VnaG5lc3NBbmlzb3Ryb3B5JzoKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdtYXBBbHBoYSc6CgkJCQkJCQlqc29uLmFscGhhTWFwID0gbG9hZFRleHR1cmUoIHZhbHVlLCBtLm1hcEFscGhhUmVwZWF0LCBtLm1hcEFscGhhT2Zmc2V0LCBtLm1hcEFscGhhV3JhcCwgbS5tYXBBbHBoYUFuaXNvdHJvcHkgKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdtYXBBbHBoYVJlcGVhdCc6CgkJCQkJCWNhc2UgJ21hcEFscGhhT2Zmc2V0JzoKCQkJCQkJY2FzZSAnbWFwQWxwaGFXcmFwJzoKCQkJCQkJY2FzZSAnbWFwQWxwaGFBbmlzb3Ryb3B5JzoKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICdmbGlwU2lkZWQnOgoJCQkJCQkJanNvbi5zaWRlID0gQmFja1NpZGU7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnZG91YmxlU2lkZWQnOgoJCQkJCQkJanNvbi5zaWRlID0gRG91YmxlU2lkZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICd0cmFuc3BhcmVuY3knOgoJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTG9hZGVyLmNyZWF0ZU1hdGVyaWFsOiB0cmFuc3BhcmVuY3kgaGFzIGJlZW4gcmVuYW1lZCB0byBvcGFjaXR5JyApOwoJCQkJCQkJanNvbi5vcGFjaXR5ID0gdmFsdWU7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAnZGVwdGhUZXN0JzoKCQkJCQkJY2FzZSAnZGVwdGhXcml0ZSc6CgkJCQkJCWNhc2UgJ2NvbG9yV3JpdGUnOgoJCQkJCQljYXNlICdvcGFjaXR5JzoKCQkJCQkJY2FzZSAncmVmbGVjdGl2aXR5JzoKCQkJCQkJY2FzZSAndHJhbnNwYXJlbnQnOgoJCQkJCQljYXNlICd2aXNpYmxlJzoKCQkJCQkJY2FzZSAnd2lyZWZyYW1lJzoKCQkJCQkJCWpzb25bIG5hbWUgXSA9IHZhbHVlOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgJ3ZlcnRleENvbG9ycyc6CgkJCQkJCQlpZiAoIHZhbHVlID09PSB0cnVlICkganNvbi52ZXJ0ZXhDb2xvcnMgPSBWZXJ0ZXhDb2xvcnM7CgkJCQkJCQlpZiAoIHZhbHVlID09PSAnZmFjZScgKSBqc29uLnZlcnRleENvbG9ycyA9IEZhY2VDb2xvcnM7CgkJCQkJCQlicmVhazsKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Mb2FkZXIuY3JlYXRlTWF0ZXJpYWw6IFVuc3VwcG9ydGVkJywgbmFtZSwgdmFsdWUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICgganNvbi50eXBlID09PSAnTWVzaEJhc2ljTWF0ZXJpYWwnICkgZGVsZXRlIGpzb24uZW1pc3NpdmU7CgkJCQlpZiAoIGpzb24udHlwZSAhPT0gJ01lc2hQaG9uZ01hdGVyaWFsJyApIGRlbGV0ZSBqc29uLnNwZWN1bGFyOwoKCQkJCWlmICgganNvbi5vcGFjaXR5IDwgMSApIGpzb24udHJhbnNwYXJlbnQgPSB0cnVlOwoKCQkJCW1hdGVyaWFsTG9hZGVyLnNldFRleHR1cmVzKCB0ZXh0dXJlcyApOwoKCQkJCXJldHVybiBtYXRlcmlhbExvYWRlci5wYXJzZSgganNvbiApOwoKCQkJfTsKCgkJfSApKCkKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJdmFyIGNvbnRleHQ7CgoJdmFyIEF1ZGlvQ29udGV4dCA9IHsKCgkJZ2V0Q29udGV4dDogZnVuY3Rpb24gKCkgewoKCQkJaWYgKCBjb250ZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29udGV4dCA9IG5ldyAoIHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCApKCk7CgoJCQl9CgoJCQlyZXR1cm4gY29udGV4dDsKCgkJfSwKCgkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWNvbnRleHQgPSB2YWx1ZTsKCgkJfQoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIFJlZWNlIEFhcm9uIExlY3JpdmFpbiAvIGh0dHA6Ly9yZWVjZW5vdGVzLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIEF1ZGlvTG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQXVkaW9Mb2FkZXIucHJvdG90eXBlLCB7CgoJCWxvYWQ6IGZ1bmN0aW9uICggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQl2YXIgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCQlsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCAnYXJyYXlidWZmZXInICk7CgkJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJLy8gQ3JlYXRlIGEgY29weSBvZiB0aGUgYnVmZmVyLiBUaGUgYGRlY29kZUF1ZGlvRGF0YWAgbWV0aG9kCgkJCQkvLyBkZXRhY2hlcyB0aGUgYnVmZmVyIHdoZW4gY29tcGxldGUsIHByZXZlbnRpbmcgcmV1c2UuCgkJCQl2YXIgYnVmZmVyQ29weSA9IGJ1ZmZlci5zbGljZSggMCApOwoKCQkJCXZhciBjb250ZXh0ID0gQXVkaW9Db250ZXh0LmdldENvbnRleHQoKTsKCQkJCWNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKCBidWZmZXJDb3B5LCBmdW5jdGlvbiAoIGF1ZGlvQnVmZmVyICkgewoKCQkJCQlvbkxvYWQoIGF1ZGlvQnVmZmVyICk7CgoJCQkJfSApOwoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQl9LAoKCQlzZXRQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIFN0ZXJlb0NhbWVyYSgpIHsKCgkJdGhpcy50eXBlID0gJ1N0ZXJlb0NhbWVyYSc7CgoJCXRoaXMuYXNwZWN0ID0gMTsKCgkJdGhpcy5leWVTZXAgPSAwLjA2NDsKCgkJdGhpcy5jYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJdGhpcy5jYW1lcmFMLmxheWVycy5lbmFibGUoIDEgKTsKCQl0aGlzLmNhbWVyYUwubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNhbWVyYVIgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKCQl0aGlzLmNhbWVyYVIubGF5ZXJzLmVuYWJsZSggMiApOwoJCXRoaXMuY2FtZXJhUi5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJfQoKCU9iamVjdC5hc3NpZ24oIFN0ZXJlb0NhbWVyYS5wcm90b3R5cGUsIHsKCgkJdXBkYXRlOiAoIGZ1bmN0aW9uICgpIHsKCgkJCXZhciBpbnN0YW5jZSwgZm9jdXMsIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIsIHpvb20sIGV5ZVNlcDsKCgkJCXZhciBleWVSaWdodCA9IG5ldyBNYXRyaXg0KCk7CgkJCXZhciBleWVMZWZ0ID0gbmV3IE1hdHJpeDQoKTsKCgkJCXJldHVybiBmdW5jdGlvbiB1cGRhdGUoIGNhbWVyYSApIHsKCgkJCQl2YXIgbmVlZHNVcGRhdGUgPSBpbnN0YW5jZSAhPT0gdGhpcyB8fCBmb2N1cyAhPT0gY2FtZXJhLmZvY3VzIHx8IGZvdiAhPT0gY2FtZXJhLmZvdiB8fAoJCQkJCQkJCQkJCQkJYXNwZWN0ICE9PSBjYW1lcmEuYXNwZWN0ICogdGhpcy5hc3BlY3QgfHwgbmVhciAhPT0gY2FtZXJhLm5lYXIgfHwKCQkJCQkJCQkJCQkJCWZhciAhPT0gY2FtZXJhLmZhciB8fCB6b29tICE9PSBjYW1lcmEuem9vbSB8fCBleWVTZXAgIT09IHRoaXMuZXllU2VwOwoKCQkJCWlmICggbmVlZHNVcGRhdGUgKSB7CgoJCQkJCWluc3RhbmNlID0gdGhpczsKCQkJCQlmb2N1cyA9IGNhbWVyYS5mb2N1czsKCQkJCQlmb3YgPSBjYW1lcmEuZm92OwoJCQkJCWFzcGVjdCA9IGNhbWVyYS5hc3BlY3QgKiB0aGlzLmFzcGVjdDsKCQkJCQluZWFyID0gY2FtZXJhLm5lYXI7CgkJCQkJZmFyID0gY2FtZXJhLmZhcjsKCQkJCQl6b29tID0gY2FtZXJhLnpvb207CgoJCQkJCS8vIE9mZi1heGlzIHN0ZXJlb3Njb3BpYyBlZmZlY3QgYmFzZWQgb24KCQkJCQkvLyBodHRwOi8vcGF1bGJvdXJrZS5uZXQvc3RlcmVvZ3JhcGhpY3Mvc3RlcmVvcmVuZGVyLwoKCQkJCQl2YXIgcHJvamVjdGlvbk1hdHJpeCA9IGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmNsb25lKCk7CgkJCQkJZXllU2VwID0gdGhpcy5leWVTZXAgLyAyOwoJCQkJCXZhciBleWVTZXBPblByb2plY3Rpb24gPSBleWVTZXAgKiBuZWFyIC8gZm9jdXM7CgkJCQkJdmFyIHltYXggPSAoIG5lYXIgKiBNYXRoLnRhbiggX01hdGguREVHMlJBRCAqIGZvdiAqIDAuNSApICkgLyB6b29tOwoJCQkJCXZhciB4bWluLCB4bWF4OwoKCQkJCQkvLyB0cmFuc2xhdGUgeE9mZnNldAoKCQkJCQlleWVMZWZ0LmVsZW1lbnRzWyAxMiBdID0gLSBleWVTZXA7CgkJCQkJZXllUmlnaHQuZWxlbWVudHNbIDEyIF0gPSBleWVTZXA7CgoJCQkJCS8vIGZvciBsZWZ0IGV5ZQoKCQkJCQl4bWluID0gLSB5bWF4ICogYXNwZWN0ICsgZXllU2VwT25Qcm9qZWN0aW9uOwoJCQkJCXhtYXggPSB5bWF4ICogYXNwZWN0ICsgZXllU2VwT25Qcm9qZWN0aW9uOwoKCQkJCQlwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyAwIF0gPSAyICogbmVhciAvICggeG1heCAtIHhtaW4gKTsKCQkJCQlwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA4IF0gPSAoIHhtYXggKyB4bWluICkgLyAoIHhtYXggLSB4bWluICk7CgoJCQkJCXRoaXMuY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHByb2plY3Rpb25NYXRyaXggKTsKCgkJCQkJLy8gZm9yIHJpZ2h0IGV5ZQoKCQkJCQl4bWluID0gLSB5bWF4ICogYXNwZWN0IC0gZXllU2VwT25Qcm9qZWN0aW9uOwoJCQkJCXhtYXggPSB5bWF4ICogYXNwZWN0IC0gZXllU2VwT25Qcm9qZWN0aW9uOwoKCQkJCQlwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyAwIF0gPSAyICogbmVhciAvICggeG1heCAtIHhtaW4gKTsKCQkJCQlwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA4IF0gPSAoIHhtYXggKyB4bWluICkgLyAoIHhtYXggLSB4bWluICk7CgoJCQkJCXRoaXMuY2FtZXJhUi5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHByb2plY3Rpb25NYXRyaXggKTsKCgkJCQl9CgoJCQkJdGhpcy5jYW1lcmFMLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLm11bHRpcGx5KCBleWVMZWZ0ICk7CgkJCQl0aGlzLmNhbWVyYVIubWF0cml4V29ybGQuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkubXVsdGlwbHkoIGV5ZVJpZ2h0ICk7CgoJCQl9OwoKCQl9ICkoKQoKCX0gKTsKCgkvKioKCSAqIENhbWVyYSBmb3IgcmVuZGVyaW5nIGN1YmUgbWFwcwoJICoJLSByZW5kZXJzIHNjZW5lIGludG8gYXhpcy1hbGlnbmVkIGN1YmUKCSAqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gQ3ViZUNhbWVyYSggbmVhciwgZmFyLCBjdWJlUmVzb2x1dGlvbiwgb3B0aW9ucyApIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLnR5cGUgPSAnQ3ViZUNhbWVyYSc7CgoJCXZhciBmb3YgPSA5MCwgYXNwZWN0ID0gMTsKCgkJdmFyIGNhbWVyYVBYID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFgudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQljYW1lcmFQWC5sb29rQXQoIG5ldyBWZWN0b3IzKCAxLCAwLCAwICkgKTsKCQl0aGlzLmFkZCggY2FtZXJhUFggKTsKCgkJdmFyIGNhbWVyYU5YID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlgudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQljYW1lcmFOWC5sb29rQXQoIG5ldyBWZWN0b3IzKCAtIDEsIDAsIDAgKSApOwoJCXRoaXMuYWRkKCBjYW1lcmFOWCApOwoKCQl2YXIgY2FtZXJhUFkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQljYW1lcmFQWS51cC5zZXQoIDAsIDAsIDEgKTsKCQljYW1lcmFQWS5sb29rQXQoIG5ldyBWZWN0b3IzKCAwLCAxLCAwICkgKTsKCQl0aGlzLmFkZCggY2FtZXJhUFkgKTsKCgkJdmFyIGNhbWVyYU5ZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtIDEgKTsKCQljYW1lcmFOWS5sb29rQXQoIG5ldyBWZWN0b3IzKCAwLCAtIDEsIDAgKSApOwoJCXRoaXMuYWRkKCBjYW1lcmFOWSApOwoKCQl2YXIgY2FtZXJhUFogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQljYW1lcmFQWi51cC5zZXQoIDAsIC0gMSwgMCApOwoJCWNhbWVyYVBaLmxvb2tBdCggbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSApOwoJCXRoaXMuYWRkKCBjYW1lcmFQWiApOwoKCQl2YXIgY2FtZXJhTlogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQljYW1lcmFOWi51cC5zZXQoIDAsIC0gMSwgMCApOwoJCWNhbWVyYU5aLmxvb2tBdCggbmV3IFZlY3RvcjMoIDAsIDAsIC0gMSApICk7CgkJdGhpcy5hZGQoIGNhbWVyYU5aICk7CgoJCW9wdGlvbnMgPSBvcHRpb25zIHx8IHsgZm9ybWF0OiBSR0JGb3JtYXQsIG1hZ0ZpbHRlcjogTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXI6IExpbmVhckZpbHRlciB9OwoKCQl0aGlzLnJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldEN1YmUoIGN1YmVSZXNvbHV0aW9uLCBjdWJlUmVzb2x1dGlvbiwgb3B0aW9ucyApOwoJCXRoaXMucmVuZGVyVGFyZ2V0LnRleHR1cmUubmFtZSA9ICJDdWJlQ2FtZXJhIjsKCgkJdGhpcy51cGRhdGUgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSApIHsKCgkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQl2YXIgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKCQkJdmFyIHJlbmRlclRhcmdldCA9IHRoaXMucmVuZGVyVGFyZ2V0OwoJCQl2YXIgZ2VuZXJhdGVNaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWCApOwoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDEgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlggKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCAyICk7CgkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVBZICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMyApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWSApOwoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDQgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhUFogKTsKCgkJCXJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGdlbmVyYXRlTWlwbWFwczsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA1ICk7CgkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYU5aICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJfTsKCgkJdGhpcy5jbGVhciA9IGZ1bmN0aW9uICggcmVuZGVyZXIsIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApIHsKCgkJCXZhciBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCQl2YXIgcmVuZGVyVGFyZ2V0ID0gdGhpcy5yZW5kZXJUYXJnZXQ7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCBpICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApOwoKCQkJfQoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCX07CgoJfQoKCUN1YmVDYW1lcmEucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICk7CglDdWJlQ2FtZXJhLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEN1YmVDYW1lcmE7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gQ2xvY2soIGF1dG9TdGFydCApIHsKCgkJdGhpcy5hdXRvU3RhcnQgPSAoIGF1dG9TdGFydCAhPT0gdW5kZWZpbmVkICkgPyBhdXRvU3RhcnQgOiB0cnVlOwoKCQl0aGlzLnN0YXJ0VGltZSA9IDA7CgkJdGhpcy5vbGRUaW1lID0gMDsKCQl0aGlzLmVsYXBzZWRUaW1lID0gMDsKCgkJdGhpcy5ydW5uaW5nID0gZmFsc2U7CgoJfQoKCU9iamVjdC5hc3NpZ24oIENsb2NrLnByb3RvdHlwZSwgewoKCQlzdGFydDogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5zdGFydFRpbWUgPSAoIHR5cGVvZiBwZXJmb3JtYW5jZSA9PT0gJ3VuZGVmaW5lZCcgPyBEYXRlIDogcGVyZm9ybWFuY2UgKS5ub3coKTsgLy8gc2VlICMxMDczMgoKCQkJdGhpcy5vbGRUaW1lID0gdGhpcy5zdGFydFRpbWU7CgkJCXRoaXMuZWxhcHNlZFRpbWUgPSAwOwoJCQl0aGlzLnJ1bm5pbmcgPSB0cnVlOwoKCQl9LAoKCQlzdG9wOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmdldEVsYXBzZWRUaW1lKCk7CgkJCXRoaXMucnVubmluZyA9IGZhbHNlOwoJCQl0aGlzLmF1dG9TdGFydCA9IGZhbHNlOwoKCQl9LAoKCQlnZXRFbGFwc2VkVGltZTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5nZXREZWx0YSgpOwoJCQlyZXR1cm4gdGhpcy5lbGFwc2VkVGltZTsKCgkJfSwKCgkJZ2V0RGVsdGE6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBkaWZmID0gMDsKCgkJCWlmICggdGhpcy5hdXRvU3RhcnQgJiYgISB0aGlzLnJ1bm5pbmcgKSB7CgoJCQkJdGhpcy5zdGFydCgpOwoJCQkJcmV0dXJuIDA7CgoJCQl9CgoJCQlpZiAoIHRoaXMucnVubmluZyApIHsKCgkJCQl2YXIgbmV3VGltZSA9ICggdHlwZW9mIHBlcmZvcm1hbmNlID09PSAndW5kZWZpbmVkJyA/IERhdGUgOiBwZXJmb3JtYW5jZSApLm5vdygpOwoKCQkJCWRpZmYgPSAoIG5ld1RpbWUgLSB0aGlzLm9sZFRpbWUgKSAvIDEwMDA7CgkJCQl0aGlzLm9sZFRpbWUgPSBuZXdUaW1lOwoKCQkJCXRoaXMuZWxhcHNlZFRpbWUgKz0gZGlmZjsKCgkJCX0KCgkJCXJldHVybiBkaWZmOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqLwoKCWZ1bmN0aW9uIEF1ZGlvTGlzdGVuZXIoKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0F1ZGlvTGlzdGVuZXInOwoKCQl0aGlzLmNvbnRleHQgPSBBdWRpb0NvbnRleHQuZ2V0Q29udGV4dCgpOwoKCQl0aGlzLmdhaW4gPSB0aGlzLmNvbnRleHQuY3JlYXRlR2FpbigpOwoJCXRoaXMuZ2Fpbi5jb25uZWN0KCB0aGlzLmNvbnRleHQuZGVzdGluYXRpb24gKTsKCgkJdGhpcy5maWx0ZXIgPSBudWxsOwoKCQl0aGlzLnRpbWVEZWx0YSA9IDA7CgoJfQoKCUF1ZGlvTGlzdGVuZXIucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IEF1ZGlvTGlzdGVuZXIsCgoJCWdldElucHV0OiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5nYWluOwoKCQl9LAoKCQlyZW1vdmVGaWx0ZXI6IGZ1bmN0aW9uICggKSB7CgoJCQlpZiAoIHRoaXMuZmlsdGVyICE9PSBudWxsICkgewoKCQkJCXRoaXMuZ2Fpbi5kaXNjb25uZWN0KCB0aGlzLmZpbHRlciApOwoJCQkJdGhpcy5maWx0ZXIuZGlzY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgkJCQl0aGlzLmdhaW4uY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgkJCQl0aGlzLmZpbHRlciA9IG51bGw7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0RmlsdGVyOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5maWx0ZXI7CgoJCX0sCgoJCXNldEZpbHRlcjogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdGhpcy5maWx0ZXIgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5nYWluLmRpc2Nvbm5lY3QoIHRoaXMuZmlsdGVyICk7CgkJCQl0aGlzLmZpbHRlci5kaXNjb25uZWN0KCB0aGlzLmNvbnRleHQuZGVzdGluYXRpb24gKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5nYWluLmRpc2Nvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoKCQkJfQoKCQkJdGhpcy5maWx0ZXIgPSB2YWx1ZTsKCQkJdGhpcy5nYWluLmNvbm5lY3QoIHRoaXMuZmlsdGVyICk7CgkJCXRoaXMuZmlsdGVyLmNvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldE1hc3RlclZvbHVtZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZ2Fpbi5nYWluLnZhbHVlOwoKCQl9LAoKCQlzZXRNYXN0ZXJWb2x1bWU6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLmdhaW4uZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIHZhbHVlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl1cGRhdGVNYXRyaXhXb3JsZDogKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgcXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCXZhciBzY2FsZSA9IG5ldyBWZWN0b3IzKCk7CgoJCQl2YXIgb3JpZW50YXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQl2YXIgY2xvY2sgPSBuZXcgQ2xvY2soKTsKCgkJCXJldHVybiBmdW5jdGlvbiB1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQkJT2JqZWN0M0QucHJvdG90eXBlLnVwZGF0ZU1hdHJpeFdvcmxkLmNhbGwoIHRoaXMsIGZvcmNlICk7CgoJCQkJdmFyIGxpc3RlbmVyID0gdGhpcy5jb250ZXh0Lmxpc3RlbmVyOwoJCQkJdmFyIHVwID0gdGhpcy51cDsKCgkJCQl0aGlzLnRpbWVEZWx0YSA9IGNsb2NrLmdldERlbHRhKCk7CgoJCQkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApOwoKCQkJCW9yaWVudGF0aW9uLnNldCggMCwgMCwgLSAxICkuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uICk7CgoJCQkJaWYgKCBsaXN0ZW5lci5wb3NpdGlvblggKSB7CgoJCQkJCS8vIGNvZGUgcGF0aCBmb3IgQ2hyb21lIChzZWUgIzE0MzkzKQoKCQkJCQl2YXIgZW5kVGltZSA9IHRoaXMuY29udGV4dC5jdXJyZW50VGltZSArIHRoaXMudGltZURlbHRhOwoKCQkJCQlsaXN0ZW5lci5wb3NpdGlvblgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHBvc2l0aW9uLngsIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci5wb3NpdGlvblkubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHBvc2l0aW9uLnksIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci5wb3NpdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHBvc2l0aW9uLnosIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci5mb3J3YXJkWC5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggb3JpZW50YXRpb24ueCwgZW5kVGltZSApOwoJCQkJCWxpc3RlbmVyLmZvcndhcmRZLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBvcmllbnRhdGlvbi55LCBlbmRUaW1lICk7CgkJCQkJbGlzdGVuZXIuZm9yd2FyZFoubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIG9yaWVudGF0aW9uLnosIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci51cFgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHVwLngsIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci51cFkubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHVwLnksIGVuZFRpbWUgKTsKCQkJCQlsaXN0ZW5lci51cFoubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHVwLnosIGVuZFRpbWUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlsaXN0ZW5lci5zZXRQb3NpdGlvbiggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwoJCQkJCWxpc3RlbmVyLnNldE9yaWVudGF0aW9uKCBvcmllbnRhdGlvbi54LCBvcmllbnRhdGlvbi55LCBvcmllbnRhdGlvbi56LCB1cC54LCB1cC55LCB1cC56ICk7CgoJCQkJfQoKCQkJfTsKCgkJfSApKCkKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBSZWVjZSBBYXJvbiBMZWNyaXZhaW4gLyBodHRwOi8vcmVlY2Vub3Rlcy5jb20vCgkgKi8KCglmdW5jdGlvbiBBdWRpbyggbGlzdGVuZXIgKSB7CgoJCU9iamVjdDNELmNhbGwoIHRoaXMgKTsKCgkJdGhpcy50eXBlID0gJ0F1ZGlvJzsKCgkJdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyOwoJCXRoaXMuY29udGV4dCA9IGxpc3RlbmVyLmNvbnRleHQ7CgoJCXRoaXMuZ2FpbiA9IHRoaXMuY29udGV4dC5jcmVhdGVHYWluKCk7CgkJdGhpcy5nYWluLmNvbm5lY3QoIGxpc3RlbmVyLmdldElucHV0KCkgKTsKCgkJdGhpcy5hdXRvcGxheSA9IGZhbHNlOwoKCQl0aGlzLmJ1ZmZlciA9IG51bGw7CgkJdGhpcy5kZXR1bmUgPSAwOwoJCXRoaXMubG9vcCA9IGZhbHNlOwoJCXRoaXMuc3RhcnRUaW1lID0gMDsKCQl0aGlzLm9mZnNldCA9IDA7CgkJdGhpcy5wbGF5YmFja1JhdGUgPSAxOwoJCXRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CgkJdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSB0cnVlOwoJCXRoaXMuc291cmNlVHlwZSA9ICdlbXB0eSc7CgoJCXRoaXMuZmlsdGVycyA9IFtdOwoKCX0KCglBdWRpby5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogQXVkaW8sCgoJCWdldE91dHB1dDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZ2FpbjsKCgkJfSwKCgkJc2V0Tm9kZVNvdXJjZTogZnVuY3Rpb24gKCBhdWRpb05vZGUgKSB7CgoJCQl0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9IGZhbHNlOwoJCQl0aGlzLnNvdXJjZVR5cGUgPSAnYXVkaW9Ob2RlJzsKCQkJdGhpcy5zb3VyY2UgPSBhdWRpb05vZGU7CgkJCXRoaXMuY29ubmVjdCgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldE1lZGlhRWxlbWVudFNvdXJjZTogZnVuY3Rpb24gKCBtZWRpYUVsZW1lbnQgKSB7CgoJCQl0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9IGZhbHNlOwoJCQl0aGlzLnNvdXJjZVR5cGUgPSAnbWVkaWFOb2RlJzsKCQkJdGhpcy5zb3VyY2UgPSB0aGlzLmNvbnRleHQuY3JlYXRlTWVkaWFFbGVtZW50U291cmNlKCBtZWRpYUVsZW1lbnQgKTsKCQkJdGhpcy5jb25uZWN0KCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0QnVmZmVyOiBmdW5jdGlvbiAoIGF1ZGlvQnVmZmVyICkgewoKCQkJdGhpcy5idWZmZXIgPSBhdWRpb0J1ZmZlcjsKCQkJdGhpcy5zb3VyY2VUeXBlID0gJ2J1ZmZlcic7CgoJCQlpZiAoIHRoaXMuYXV0b3BsYXkgKSB0aGlzLnBsYXkoKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlwbGF5OiBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiBBdWRpbyBpcyBhbHJlYWR5IHBsYXlpbmcuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdmFyIHNvdXJjZSA9IHRoaXMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsKCgkJCXNvdXJjZS5idWZmZXIgPSB0aGlzLmJ1ZmZlcjsKCQkJc291cmNlLmxvb3AgPSB0aGlzLmxvb3A7CgkJCXNvdXJjZS5vbmVuZGVkID0gdGhpcy5vbkVuZGVkLmJpbmQoIHRoaXMgKTsKCQkJdGhpcy5zdGFydFRpbWUgPSB0aGlzLmNvbnRleHQuY3VycmVudFRpbWU7CgkJCXNvdXJjZS5zdGFydCggdGhpcy5zdGFydFRpbWUsIHRoaXMub2Zmc2V0ICk7CgoJCQl0aGlzLmlzUGxheWluZyA9IHRydWU7CgoJCQl0aGlzLnNvdXJjZSA9IHNvdXJjZTsKCgkJCXRoaXMuc2V0RGV0dW5lKCB0aGlzLmRldHVuZSApOwoJCQl0aGlzLnNldFBsYXliYWNrUmF0ZSggdGhpcy5wbGF5YmFja1JhdGUgKTsKCgkJCXJldHVybiB0aGlzLmNvbm5lY3QoKTsKCgkJfSwKCgkJcGF1c2U6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLicgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQkJdGhpcy5zb3VyY2Uuc3RvcCgpOwoJCQkJdGhpcy5zb3VyY2Uub25lbmRlZCA9IG51bGw7CgkJCQl0aGlzLm9mZnNldCArPSAoIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSAtIHRoaXMuc3RhcnRUaW1lICkgKiB0aGlzLnBsYXliYWNrUmF0ZTsKCQkJCXRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc3RvcDogZnVuY3Rpb24gKCkgewoKCQkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdGhpcy5zb3VyY2Uuc3RvcCgpOwoJCQl0aGlzLnNvdXJjZS5vbmVuZGVkID0gbnVsbDsKCQkJdGhpcy5vZmZzZXQgPSAwOwoJCQl0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNvbm5lY3Q6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7CgoJCQkJdGhpcy5zb3VyY2UuY29ubmVjdCggdGhpcy5maWx0ZXJzWyAwIF0gKTsKCgkJCQlmb3IgKCB2YXIgaSA9IDEsIGwgPSB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdGhpcy5maWx0ZXJzWyBpIC0gMSBdLmNvbm5lY3QoIHRoaXMuZmlsdGVyc1sgaSBdICk7CgoJCQkJfQoKCQkJCXRoaXMuZmlsdGVyc1sgdGhpcy5maWx0ZXJzLmxlbmd0aCAtIDEgXS5jb25uZWN0KCB0aGlzLmdldE91dHB1dCgpICk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuc291cmNlLmNvbm5lY3QoIHRoaXMuZ2V0T3V0cHV0KCkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlkaXNjb25uZWN0OiBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHRoaXMuZmlsdGVycy5sZW5ndGggPiAwICkgewoKCQkJCXRoaXMuc291cmNlLmRpc2Nvbm5lY3QoIHRoaXMuZmlsdGVyc1sgMCBdICk7CgoJCQkJZm9yICggdmFyIGkgPSAxLCBsID0gdGhpcy5maWx0ZXJzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXRoaXMuZmlsdGVyc1sgaSAtIDEgXS5kaXNjb25uZWN0KCB0aGlzLmZpbHRlcnNbIGkgXSApOwoKCQkJCX0KCgkJCQl0aGlzLmZpbHRlcnNbIHRoaXMuZmlsdGVycy5sZW5ndGggLSAxIF0uZGlzY29ubmVjdCggdGhpcy5nZXRPdXRwdXQoKSApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNvdXJjZS5kaXNjb25uZWN0KCB0aGlzLmdldE91dHB1dCgpICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0RmlsdGVyczogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZmlsdGVyczsKCgkJfSwKCgkJc2V0RmlsdGVyczogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggISB2YWx1ZSApIHZhbHVlID0gW107CgoJCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJCXRoaXMuZGlzY29ubmVjdCgpOwoJCQkJdGhpcy5maWx0ZXJzID0gdmFsdWU7CgkJCQl0aGlzLmNvbm5lY3QoKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5maWx0ZXJzID0gdmFsdWU7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RGV0dW5lOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5kZXR1bmUgPSB2YWx1ZTsKCgkJCWlmICggdGhpcy5zb3VyY2UuZGV0dW5lID09PSB1bmRlZmluZWQgKSByZXR1cm47IC8vIG9ubHkgc2V0IGRldHVuZSB3aGVuIGF2YWlsYWJsZQoKCQkJaWYgKCB0aGlzLmlzUGxheWluZyA9PT0gdHJ1ZSApIHsKCgkJCQl0aGlzLnNvdXJjZS5kZXR1bmUuc2V0VGFyZ2V0QXRUaW1lKCB0aGlzLmRldHVuZSwgdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lLCAwLjAxICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0RGV0dW5lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5kZXR1bmU7CgoJCX0sCgoJCWdldEZpbHRlcjogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuZ2V0RmlsdGVycygpWyAwIF07CgoJCX0sCgoJCXNldEZpbHRlcjogZnVuY3Rpb24gKCBmaWx0ZXIgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGaWx0ZXJzKCBmaWx0ZXIgPyBbIGZpbHRlciBdIDogW10gKTsKCgkJfSwKCgkJc2V0UGxheWJhY2tSYXRlOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdGhpcy5wbGF5YmFja1JhdGUgPSB2YWx1ZTsKCgkJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQkJdGhpcy5zb3VyY2UucGxheWJhY2tSYXRlLnNldFRhcmdldEF0VGltZSggdGhpcy5wbGF5YmFja1JhdGUsIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSwgMC4wMSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldFBsYXliYWNrUmF0ZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMucGxheWJhY2tSYXRlOwoKCQl9LAoKCQlvbkVuZGVkOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoKCQl9LAoKCQlnZXRMb29wOiBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogdGhpcyBBdWRpbyBoYXMgbm8gcGxheWJhY2sgY29udHJvbC4nICk7CgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdGhpcy5sb29wOwoKCQl9LAoKCQlzZXRMb29wOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdGhpcy5sb29wID0gdmFsdWU7CgoJCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJCXRoaXMuc291cmNlLmxvb3AgPSB0aGlzLmxvb3A7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZ2V0Vm9sdW1lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5nYWluLmdhaW4udmFsdWU7CgoJCX0sCgoJCXNldFZvbHVtZTogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMuZ2Fpbi5nYWluLnNldFRhcmdldEF0VGltZSggdmFsdWUsIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSwgMC4wMSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gUG9zaXRpb25hbEF1ZGlvKCBsaXN0ZW5lciApIHsKCgkJQXVkaW8uY2FsbCggdGhpcywgbGlzdGVuZXIgKTsKCgkJdGhpcy5wYW5uZXIgPSB0aGlzLmNvbnRleHQuY3JlYXRlUGFubmVyKCk7CgkJdGhpcy5wYW5uZXIuY29ubmVjdCggdGhpcy5nYWluICk7CgoJfQoKCVBvc2l0aW9uYWxBdWRpby5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBBdWRpby5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogUG9zaXRpb25hbEF1ZGlvLAoKCQlnZXRPdXRwdXQ6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnBhbm5lcjsKCgkJfSwKCgkJZ2V0UmVmRGlzdGFuY2U6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnBhbm5lci5yZWZEaXN0YW5jZTsKCgkJfSwKCgkJc2V0UmVmRGlzdGFuY2U6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnBhbm5lci5yZWZEaXN0YW5jZSA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldFJvbGxvZmZGYWN0b3I6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnBhbm5lci5yb2xsb2ZmRmFjdG9yOwoKCQl9LAoKCQlzZXRSb2xsb2ZmRmFjdG9yOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYW5uZXIucm9sbG9mZkZhY3RvciA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldERpc3RhbmNlTW9kZWw6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLnBhbm5lci5kaXN0YW5jZU1vZGVsOwoKCQl9LAoKCQlzZXREaXN0YW5jZU1vZGVsOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYW5uZXIuZGlzdGFuY2VNb2RlbCA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldE1heERpc3RhbmNlOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5wYW5uZXIubWF4RGlzdGFuY2U7CgoJCX0sCgoJCXNldE1heERpc3RhbmNlOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYW5uZXIubWF4RGlzdGFuY2UgPSB2YWx1ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXREaXJlY3Rpb25hbENvbmU6IGZ1bmN0aW9uICggY29uZUlubmVyQW5nbGUsIGNvbmVPdXRlckFuZ2xlLCBjb25lT3V0ZXJHYWluICkgewoKCQkJdGhpcy5wYW5uZXIuY29uZUlubmVyQW5nbGUgPSBjb25lSW5uZXJBbmdsZTsKCQkJdGhpcy5wYW5uZXIuY29uZU91dGVyQW5nbGUgPSBjb25lT3V0ZXJBbmdsZTsKCQkJdGhpcy5wYW5uZXIuY29uZU91dGVyR2FpbiA9IGNvbmVPdXRlckdhaW47CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdXBkYXRlTWF0cml4V29ybGQ6ICggZnVuY3Rpb24gKCkgewoKCQkJdmFyIHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoJCQl2YXIgc2NhbGUgPSBuZXcgVmVjdG9yMygpOwoKCQkJdmFyIG9yaWVudGF0aW9uID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiB1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQkJT2JqZWN0M0QucHJvdG90eXBlLnVwZGF0ZU1hdHJpeFdvcmxkLmNhbGwoIHRoaXMsIGZvcmNlICk7CgoJCQkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gdHJ1ZSAmJiB0aGlzLmlzUGxheWluZyA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApOwoKCQkJCW9yaWVudGF0aW9uLnNldCggMCwgMCwgMSApLmFwcGx5UXVhdGVybmlvbiggcXVhdGVybmlvbiApOwoKCQkJCXZhciBwYW5uZXIgPSB0aGlzLnBhbm5lcjsKCgkJCQlpZiAoIHBhbm5lci5wb3NpdGlvblggKSB7CgoJCQkJCS8vIGNvZGUgcGF0aCBmb3IgQ2hyb21lIGFuZCBGaXJlZm94IChzZWUgIzE0MzkzKQoKCQkJCQl2YXIgZW5kVGltZSA9IHRoaXMuY29udGV4dC5jdXJyZW50VGltZSArIHRoaXMubGlzdGVuZXIudGltZURlbHRhOwoKCQkJCQlwYW5uZXIucG9zaXRpb25YLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBwb3NpdGlvbi54LCBlbmRUaW1lICk7CgkJCQkJcGFubmVyLnBvc2l0aW9uWS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggcG9zaXRpb24ueSwgZW5kVGltZSApOwoJCQkJCXBhbm5lci5wb3NpdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHBvc2l0aW9uLnosIGVuZFRpbWUgKTsKCQkJCQlwYW5uZXIub3JpZW50YXRpb25YLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBvcmllbnRhdGlvbi54LCBlbmRUaW1lICk7CgkJCQkJcGFubmVyLm9yaWVudGF0aW9uWS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggb3JpZW50YXRpb24ueSwgZW5kVGltZSApOwoJCQkJCXBhbm5lci5vcmllbnRhdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIG9yaWVudGF0aW9uLnosIGVuZFRpbWUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlwYW5uZXIuc2V0UG9zaXRpb24oIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHBvc2l0aW9uLnogKTsKCQkJCQlwYW5uZXIuc2V0T3JpZW50YXRpb24oIG9yaWVudGF0aW9uLngsIG9yaWVudGF0aW9uLnksIG9yaWVudGF0aW9uLnogKTsKCgkJCQl9CgoJCQl9OwoKCQl9ICkoKQoKCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gQXVkaW9BbmFseXNlciggYXVkaW8sIGZmdFNpemUgKSB7CgoJCXRoaXMuYW5hbHlzZXIgPSBhdWRpby5jb250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7CgkJdGhpcy5hbmFseXNlci5mZnRTaXplID0gZmZ0U2l6ZSAhPT0gdW5kZWZpbmVkID8gZmZ0U2l6ZSA6IDIwNDg7CgoJCXRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KCB0aGlzLmFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50ICk7CgoJCWF1ZGlvLmdldE91dHB1dCgpLmNvbm5lY3QoIHRoaXMuYW5hbHlzZXIgKTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQXVkaW9BbmFseXNlci5wcm90b3R5cGUsIHsKCgkJZ2V0RnJlcXVlbmN5RGF0YTogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5hbmFseXNlci5nZXRCeXRlRnJlcXVlbmN5RGF0YSggdGhpcy5kYXRhICk7CgoJCQlyZXR1cm4gdGhpcy5kYXRhOwoKCQl9LAoKCQlnZXRBdmVyYWdlRnJlcXVlbmN5OiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdmFsdWUgPSAwLCBkYXRhID0gdGhpcy5nZXRGcmVxdWVuY3lEYXRhKCk7CgoJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQl2YWx1ZSArPSBkYXRhWyBpIF07CgoJCQl9CgoJCQlyZXR1cm4gdmFsdWUgLyBkYXRhLmxlbmd0aDsKCgkJfQoKCX0gKTsKCgkvKioKCSAqCgkgKiBCdWZmZXJlZCBzY2VuZSBncmFwaCBwcm9wZXJ0eSB0aGF0IGFsbG93cyB3ZWlnaHRlZCBhY2N1bXVsYXRpb24uCgkgKgoJICoKCSAqIEBhdXRob3IgQmVuIEhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8vCgkgKiBAYXV0aG9yIERhdmlkIFNhcm5vIC8gaHR0cDovL2xpZ2h0aGF1cy51cy8KCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIFByb3BlcnR5TWl4ZXIoIGJpbmRpbmcsIHR5cGVOYW1lLCB2YWx1ZVNpemUgKSB7CgoJCXRoaXMuYmluZGluZyA9IGJpbmRpbmc7CgkJdGhpcy52YWx1ZVNpemUgPSB2YWx1ZVNpemU7CgoJCXZhciBidWZmZXJUeXBlID0gRmxvYXQ2NEFycmF5LAoJCQltaXhGdW5jdGlvbjsKCgkJc3dpdGNoICggdHlwZU5hbWUgKSB7CgoJCQljYXNlICdxdWF0ZXJuaW9uJzoKCQkJCW1peEZ1bmN0aW9uID0gdGhpcy5fc2xlcnA7CgkJCQlicmVhazsKCgkJCWNhc2UgJ3N0cmluZyc6CgkJCWNhc2UgJ2Jvb2wnOgoJCQkJYnVmZmVyVHlwZSA9IEFycmF5OwoJCQkJbWl4RnVuY3Rpb24gPSB0aGlzLl9zZWxlY3Q7CgkJCQlicmVhazsKCgkJCWRlZmF1bHQ6CgkJCQltaXhGdW5jdGlvbiA9IHRoaXMuX2xlcnA7CgoJCX0KCgkJdGhpcy5idWZmZXIgPSBuZXcgYnVmZmVyVHlwZSggdmFsdWVTaXplICogNCApOwoJCS8vIGxheW91dDogWyBpbmNvbWluZyB8IGFjY3UwIHwgYWNjdTEgfCBvcmlnIF0KCQkvLwoJCS8vIGludGVycG9sYXRvcnMgY2FuIHVzZSAuYnVmZmVyIGFzIHRoZWlyIC5yZXN1bHQKCQkvLyB0aGUgZGF0YSB0aGVuIGdvZXMgdG8gJ2luY29taW5nJwoJCS8vCgkJLy8gJ2FjY3UwJyBhbmQgJ2FjY3UxJyBhcmUgdXNlZCBmcmFtZS1pbnRlcmxlYXZlZCBmb3IKCQkvLyB0aGUgY3VtdWxhdGl2ZSByZXN1bHQgYW5kIGFyZSBjb21wYXJlZCB0byBkZXRlY3QKCQkvLyBjaGFuZ2VzCgkJLy8KCQkvLyAnb3JpZycgc3RvcmVzIHRoZSBvcmlnaW5hbCBzdGF0ZSBvZiB0aGUgcHJvcGVydHkKCgkJdGhpcy5fbWl4QnVmZmVyUmVnaW9uID0gbWl4RnVuY3Rpb247CgoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CgoJCXRoaXMudXNlQ291bnQgPSAwOwoJCXRoaXMucmVmZXJlbmNlQ291bnQgPSAwOwoKCX0KCglPYmplY3QuYXNzaWduKCBQcm9wZXJ0eU1peGVyLnByb3RvdHlwZSwgewoKCQkvLyBhY2N1bXVsYXRlIGRhdGEgaW4gdGhlICdpbmNvbWluZycgcmVnaW9uIGludG8gJ2FjY3U8aT4nCgkJYWNjdW11bGF0ZTogZnVuY3Rpb24gKCBhY2N1SW5kZXgsIHdlaWdodCApIHsKCgkJCS8vIG5vdGU6IGhhcHBpbHkgYWNjdW11bGF0aW5nIG5vdGhpbmcgd2hlbiB3ZWlnaHQgPSAwLCB0aGUgY2FsbGVyIGtub3dzCgkJCS8vIHRoZSB3ZWlnaHQgYW5kIHNob3VsZG4ndCBoYXZlIG1hZGUgdGhlIGNhbGwgaW4gdGhlIGZpcnN0IHBsYWNlCgoJCQl2YXIgYnVmZmVyID0gdGhpcy5idWZmZXIsCgkJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJCW9mZnNldCA9IGFjY3VJbmRleCAqIHN0cmlkZSArIHN0cmlkZSwKCgkJCQljdXJyZW50V2VpZ2h0ID0gdGhpcy5jdW11bGF0aXZlV2VpZ2h0OwoKCQkJaWYgKCBjdXJyZW50V2VpZ2h0ID09PSAwICkgewoKCQkJCS8vIGFjY3VOIDo9IGluY29taW5nICogd2VpZ2h0CgoJCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgaSBdID0gYnVmZmVyWyBpIF07CgoJCQkJfQoKCQkJCWN1cnJlbnRXZWlnaHQgPSB3ZWlnaHQ7CgoJCQl9IGVsc2UgewoKCQkJCS8vIGFjY3VOIDo9IGFjY3VOICsgaW5jb21pbmcgKiB3ZWlnaHQKCgkJCQljdXJyZW50V2VpZ2h0ICs9IHdlaWdodDsKCQkJCXZhciBtaXggPSB3ZWlnaHQgLyBjdXJyZW50V2VpZ2h0OwoJCQkJdGhpcy5fbWl4QnVmZmVyUmVnaW9uKCBidWZmZXIsIG9mZnNldCwgMCwgbWl4LCBzdHJpZGUgKTsKCgkJCX0KCgkJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IGN1cnJlbnRXZWlnaHQ7CgoJCX0sCgoJCS8vIGFwcGx5IHRoZSBzdGF0ZSBvZiAnYWNjdTxpPicgdG8gdGhlIGJpbmRpbmcgd2hlbiBhY2N1cyBkaWZmZXIKCQlhcHBseTogZnVuY3Rpb24gKCBhY2N1SW5kZXggKSB7CgoJCQl2YXIgc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgkJCQlidWZmZXIgPSB0aGlzLmJ1ZmZlciwKCQkJCW9mZnNldCA9IGFjY3VJbmRleCAqIHN0cmlkZSArIHN0cmlkZSwKCgkJCQl3ZWlnaHQgPSB0aGlzLmN1bXVsYXRpdmVXZWlnaHQsCgoJCQkJYmluZGluZyA9IHRoaXMuYmluZGluZzsKCgkJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CgoJCQlpZiAoIHdlaWdodCA8IDEgKSB7CgoJCQkJLy8gYWNjdU4gOj0gYWNjdU4gKyBvcmlnaW5hbCAqICggMSAtIGN1bXVsYXRpdmVXZWlnaHQgKQoKCQkJCXZhciBvcmlnaW5hbFZhbHVlT2Zmc2V0ID0gc3RyaWRlICogMzsKCgkJCQl0aGlzLl9taXhCdWZmZXJSZWdpb24oCgkJCQkJYnVmZmVyLCBvZmZzZXQsIG9yaWdpbmFsVmFsdWVPZmZzZXQsIDEgLSB3ZWlnaHQsIHN0cmlkZSApOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSBzdHJpZGUsIGUgPSBzdHJpZGUgKyBzdHJpZGU7IGkgIT09IGU7ICsrIGkgKSB7CgoJCQkJaWYgKCBidWZmZXJbIGkgXSAhPT0gYnVmZmVyWyBpICsgc3RyaWRlIF0gKSB7CgoJCQkJCS8vIHZhbHVlIGhhcyBjaGFuZ2VkIC0+IHVwZGF0ZSBzY2VuZSBncmFwaAoKCQkJCQliaW5kaW5nLnNldFZhbHVlKCBidWZmZXIsIG9mZnNldCApOwoJCQkJCWJyZWFrOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJLy8gcmVtZW1iZXIgdGhlIHN0YXRlIG9mIHRoZSBib3VuZCBwcm9wZXJ0eSBhbmQgY29weSBpdCB0byBib3RoIGFjY3VzCgkJc2F2ZU9yaWdpbmFsU3RhdGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBiaW5kaW5nID0gdGhpcy5iaW5kaW5nOwoKCQkJdmFyIGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAoJCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgoJCQkJb3JpZ2luYWxWYWx1ZU9mZnNldCA9IHN0cmlkZSAqIDM7CgoJCQliaW5kaW5nLmdldFZhbHVlKCBidWZmZXIsIG9yaWdpbmFsVmFsdWVPZmZzZXQgKTsKCgkJCS8vIGFjY3VbMC4uMV0gOj0gb3JpZyAtLSBpbml0aWFsbHkgZGV0ZWN0IGNoYW5nZXMgYWdhaW5zdCB0aGUgb3JpZ2luYWwKCQkJZm9yICggdmFyIGkgPSBzdHJpZGUsIGUgPSBvcmlnaW5hbFZhbHVlT2Zmc2V0OyBpICE9PSBlOyArKyBpICkgewoKCQkJCWJ1ZmZlclsgaSBdID0gYnVmZmVyWyBvcmlnaW5hbFZhbHVlT2Zmc2V0ICsgKCBpICUgc3RyaWRlICkgXTsKCgkJCX0KCgkJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CgoJCX0sCgoJCS8vIGFwcGx5IHRoZSBzdGF0ZSBwcmV2aW91c2x5IHRha2VuIHZpYSAnc2F2ZU9yaWdpbmFsU3RhdGUnIHRvIHRoZSBiaW5kaW5nCgkJcmVzdG9yZU9yaWdpbmFsU3RhdGU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBvcmlnaW5hbFZhbHVlT2Zmc2V0ID0gdGhpcy52YWx1ZVNpemUgKiAzOwoJCQl0aGlzLmJpbmRpbmcuc2V0VmFsdWUoIHRoaXMuYnVmZmVyLCBvcmlnaW5hbFZhbHVlT2Zmc2V0ICk7CgoJCX0sCgoKCQkvLyBtaXggZnVuY3Rpb25zCgoJCV9zZWxlY3Q6IGZ1bmN0aW9uICggYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlICkgewoKCQkJaWYgKCB0ID49IDAuNSApIHsKCgkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCQkJYnVmZmVyWyBkc3RPZmZzZXQgKyBpIF0gPSBidWZmZXJbIHNyY09mZnNldCArIGkgXTsKCgkJCQl9CgoJCQl9CgoJCX0sCgoJCV9zbGVycDogZnVuY3Rpb24gKCBidWZmZXIsIGRzdE9mZnNldCwgc3JjT2Zmc2V0LCB0ICkgewoKCQkJUXVhdGVybmlvbi5zbGVycEZsYXQoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCBzcmNPZmZzZXQsIHQgKTsKCgkJfSwKCgkJX2xlcnA6IGZ1bmN0aW9uICggYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlICkgewoKCQkJdmFyIHMgPSAxIC0gdDsKCgkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJCXZhciBqID0gZHN0T2Zmc2V0ICsgaTsKCgkJCQlidWZmZXJbIGogXSA9IGJ1ZmZlclsgaiBdICogcyArIGJ1ZmZlclsgc3JjT2Zmc2V0ICsgaSBdICogdDsKCgkJCX0KCgkJfQoKCX0gKTsKCgkvKioKCSAqCgkgKiBBIHJlZmVyZW5jZSB0byBhIHJlYWwgcHJvcGVydHkgaW4gdGhlIHNjZW5lIGdyYXBoLgoJICoKCSAqCgkgKiBAYXV0aG9yIEJlbiBIb3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvLwoJICogQGF1dGhvciBEYXZpZCBTYXJubyAvIGh0dHA6Ly9saWdodGhhdXMudXMvCgkgKiBAYXV0aG9yIHRzY2h3CgkgKi8KCgkvLyBDaGFyYWN0ZXJzIFtdLjovIGFyZSByZXNlcnZlZCBmb3IgdHJhY2sgYmluZGluZyBzeW50YXguCgl2YXIgUkVTRVJWRURfQ0hBUlNfUkUgPSAnXFxbXFxdXFwuOlxcLyc7CgoJZnVuY3Rpb24gQ29tcG9zaXRlKCB0YXJnZXRHcm91cCwgcGF0aCwgb3B0aW9uYWxQYXJzZWRQYXRoICkgewoKCQl2YXIgcGFyc2VkUGF0aCA9IG9wdGlvbmFsUGFyc2VkUGF0aCB8fCBQcm9wZXJ0eUJpbmRpbmcucGFyc2VUcmFja05hbWUoIHBhdGggKTsKCgkJdGhpcy5fdGFyZ2V0R3JvdXAgPSB0YXJnZXRHcm91cDsKCQl0aGlzLl9iaW5kaW5ncyA9IHRhcmdldEdyb3VwLnN1YnNjcmliZV8oIHBhdGgsIHBhcnNlZFBhdGggKTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQ29tcG9zaXRlLnByb3RvdHlwZSwgewoKCQlnZXRWYWx1ZTogZnVuY3Rpb24gKCBhcnJheSwgb2Zmc2V0ICkgewoKCQkJdGhpcy5iaW5kKCk7IC8vIGJpbmQgYWxsIGJpbmRpbmcKCgkJCXZhciBmaXJzdFZhbGlkSW5kZXggPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sCgkJCQliaW5kaW5nID0gdGhpcy5fYmluZGluZ3NbIGZpcnN0VmFsaWRJbmRleCBdOwoKCQkJLy8gYW5kIG9ubHkgY2FsbCAuZ2V0VmFsdWUgb24gdGhlIGZpcnN0CgkJCWlmICggYmluZGluZyAhPT0gdW5kZWZpbmVkICkgYmluZGluZy5nZXRWYWx1ZSggYXJyYXksIG9mZnNldCApOwoKCQl9LAoKCQlzZXRWYWx1ZTogZnVuY3Rpb24gKCBhcnJheSwgb2Zmc2V0ICkgewoKCQkJdmFyIGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCQlmb3IgKCB2YXIgaSA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQliaW5kaW5nc1sgaSBdLnNldFZhbHVlKCBhcnJheSwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0sCgoJCWJpbmQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwoKCQkJZm9yICggdmFyIGkgPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJYmluZGluZ3NbIGkgXS5iaW5kKCk7CgoJCQl9CgoJCX0sCgoJCXVuYmluZDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCQlmb3IgKCB2YXIgaSA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQliaW5kaW5nc1sgaSBdLnVuYmluZCgpOwoKCQkJfQoKCQl9CgoJfSApOwoKCglmdW5jdGlvbiBQcm9wZXJ0eUJpbmRpbmcoIHJvb3ROb2RlLCBwYXRoLCBwYXJzZWRQYXRoICkgewoKCQl0aGlzLnBhdGggPSBwYXRoOwoJCXRoaXMucGFyc2VkUGF0aCA9IHBhcnNlZFBhdGggfHwgUHJvcGVydHlCaW5kaW5nLnBhcnNlVHJhY2tOYW1lKCBwYXRoICk7CgoJCXRoaXMubm9kZSA9IFByb3BlcnR5QmluZGluZy5maW5kTm9kZSggcm9vdE5vZGUsIHRoaXMucGFyc2VkUGF0aC5ub2RlTmFtZSApIHx8IHJvb3ROb2RlOwoKCQl0aGlzLnJvb3ROb2RlID0gcm9vdE5vZGU7CgoJfQoKCU9iamVjdC5hc3NpZ24oIFByb3BlcnR5QmluZGluZywgewoKCQlDb21wb3NpdGU6IENvbXBvc2l0ZSwKCgkJY3JlYXRlOiBmdW5jdGlvbiAoIHJvb3QsIHBhdGgsIHBhcnNlZFBhdGggKSB7CgoJCQlpZiAoICEgKCByb290ICYmIHJvb3QuaXNBbmltYXRpb25PYmplY3RHcm91cCApICkgewoKCQkJCXJldHVybiBuZXcgUHJvcGVydHlCaW5kaW5nKCByb290LCBwYXRoLCBwYXJzZWRQYXRoICk7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBuZXcgUHJvcGVydHlCaW5kaW5nLkNvbXBvc2l0ZSggcm9vdCwgcGF0aCwgcGFyc2VkUGF0aCApOwoKCQkJfQoKCQl9LAoKCQkvKioKCQkgKiBSZXBsYWNlcyBzcGFjZXMgd2l0aCB1bmRlcnNjb3JlcyBhbmQgcmVtb3ZlcyB1bnN1cHBvcnRlZCBjaGFyYWN0ZXJzIGZyb20KCQkgKiBub2RlIG5hbWVzLCB0byBlbnN1cmUgY29tcGF0aWJpbGl0eSB3aXRoIHBhcnNlVHJhY2tOYW1lKCkuCgkJICoKCQkgKiBAcGFyYW0gIHtzdHJpbmd9IG5hbWUgTm9kZSBuYW1lIHRvIGJlIHNhbml0aXplZC4KCQkgKiBAcmV0dXJuIHtzdHJpbmd9CgkJICovCgkJc2FuaXRpemVOb2RlTmFtZTogKCBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgcmVzZXJ2ZWRSZSA9IG5ldyBSZWdFeHAoICdbJyArIFJFU0VSVkVEX0NIQVJTX1JFICsgJ10nLCAnZycgKTsKCgkJCXJldHVybiBmdW5jdGlvbiBzYW5pdGl6ZU5vZGVOYW1lKCBuYW1lICkgewoKCQkJCXJldHVybiBuYW1lLnJlcGxhY2UoIC9ccy9nLCAnXycgKS5yZXBsYWNlKCByZXNlcnZlZFJlLCAnJyApOwoKCQkJfTsKCgkJfSgpICksCgoJCXBhcnNlVHJhY2tOYW1lOiBmdW5jdGlvbiAoKSB7CgoJCQkvLyBBdHRlbXB0cyB0byBhbGxvdyBub2RlIG5hbWVzIGZyb20gYW55IGxhbmd1YWdlLiBFUzUncyBgXHdgIHJlZ2V4cCBtYXRjaGVzCgkJCS8vIG9ubHkgbGF0aW4gY2hhcmFjdGVycywgYW5kIHRoZSB1bmljb2RlIFxwe0x9IGlzIG5vdCB5ZXQgc3VwcG9ydGVkLiBTbwoJCQkvLyBpbnN0ZWFkLCB3ZSBleGNsdWRlIHJlc2VydmVkIGNoYXJhY3RlcnMgYW5kIG1hdGNoIGV2ZXJ5dGhpbmcgZWxzZS4KCQkJdmFyIHdvcmRDaGFyID0gJ1teJyArIFJFU0VSVkVEX0NIQVJTX1JFICsgJ10nOwoJCQl2YXIgd29yZENoYXJPckRvdCA9ICdbXicgKyBSRVNFUlZFRF9DSEFSU19SRS5yZXBsYWNlKCAnXFwuJywgJycgKSArICddJzsKCgkJCS8vIFBhcmVudCBkaXJlY3RvcmllcywgZGVsaW1pdGVkIGJ5ICcvJyBvciAnOicuIEN1cnJlbnRseSB1bnVzZWQsIGJ1dCBtdXN0CgkJCS8vIGJlIG1hdGNoZWQgdG8gcGFyc2UgdGhlIHJlc3Qgb2YgdGhlIHRyYWNrIG5hbWUuCgkJCXZhciBkaXJlY3RvcnlSZSA9IC8oKD86V0MrW1wvOl0pKikvLnNvdXJjZS5yZXBsYWNlKCAnV0MnLCB3b3JkQ2hhciApOwoKCQkJLy8gVGFyZ2V0IG5vZGUuIE1heSBjb250YWluIHdvcmQgY2hhcmFjdGVycyAoYS16QS1aMC05XykgYW5kICcuJyBvciAnLScuCgkJCXZhciBub2RlUmUgPSAvKFdDT0QrKT8vLnNvdXJjZS5yZXBsYWNlKCAnV0NPRCcsIHdvcmRDaGFyT3JEb3QgKTsKCgkJCS8vIE9iamVjdCBvbiB0YXJnZXQgbm9kZSwgYW5kIGFjY2Vzc29yLiBNYXkgbm90IGNvbnRhaW4gcmVzZXJ2ZWQKCQkJLy8gY2hhcmFjdGVycy4gQWNjZXNzb3IgbWF5IGNvbnRhaW4gYW55IGNoYXJhY3RlciBleGNlcHQgY2xvc2luZyBicmFja2V0LgoJCQl2YXIgb2JqZWN0UmUgPSAvKD86XC4oV0MrKSg/OlxbKC4rKVxdKT8pPy8uc291cmNlLnJlcGxhY2UoICdXQycsIHdvcmRDaGFyICk7CgoJCQkvLyBQcm9wZXJ0eSBhbmQgYWNjZXNzb3IuIE1heSBub3QgY29udGFpbiByZXNlcnZlZCBjaGFyYWN0ZXJzLiBBY2Nlc3NvciBtYXkKCQkJLy8gY29udGFpbiBhbnkgbm9uLWJyYWNrZXQgY2hhcmFjdGVycy4KCQkJdmFyIHByb3BlcnR5UmUgPSAvXC4oV0MrKSg/OlxbKC4rKVxdKT8vLnNvdXJjZS5yZXBsYWNlKCAnV0MnLCB3b3JkQ2hhciApOwoKCQkJdmFyIHRyYWNrUmUgPSBuZXcgUmVnRXhwKCAnJwoJCQkJKyAnXicKCQkJCSsgZGlyZWN0b3J5UmUKCQkJCSsgbm9kZVJlCgkJCQkrIG9iamVjdFJlCgkJCQkrIHByb3BlcnR5UmUKCQkJCSsgJyQnCgkJCSk7CgoJCQl2YXIgc3VwcG9ydGVkT2JqZWN0TmFtZXMgPSBbICdtYXRlcmlhbCcsICdtYXRlcmlhbHMnLCAnYm9uZXMnIF07CgoJCQlyZXR1cm4gZnVuY3Rpb24gcGFyc2VUcmFja05hbWUoIHRyYWNrTmFtZSApIHsKCgkJCQl2YXIgbWF0Y2hlcyA9IHRyYWNrUmUuZXhlYyggdHJhY2tOYW1lICk7CgoJCQkJaWYgKCAhIG1hdGNoZXMgKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1Byb3BlcnR5QmluZGluZzogQ2Fubm90IHBhcnNlIHRyYWNrTmFtZTogJyArIHRyYWNrTmFtZSApOwoKCQkJCX0KCgkJCQl2YXIgcmVzdWx0cyA9IHsKCQkJCQkvLyBkaXJlY3RvcnlOYW1lOiBtYXRjaGVzWyAxIF0sIC8vICh0c2NodykgY3VycmVudGx5IHVudXNlZAoJCQkJCW5vZGVOYW1lOiBtYXRjaGVzWyAyIF0sCgkJCQkJb2JqZWN0TmFtZTogbWF0Y2hlc1sgMyBdLAoJCQkJCW9iamVjdEluZGV4OiBtYXRjaGVzWyA0IF0sCgkJCQkJcHJvcGVydHlOYW1lOiBtYXRjaGVzWyA1IF0sIC8vIHJlcXVpcmVkCgkJCQkJcHJvcGVydHlJbmRleDogbWF0Y2hlc1sgNiBdCgkJCQl9OwoKCQkJCXZhciBsYXN0RG90ID0gcmVzdWx0cy5ub2RlTmFtZSAmJiByZXN1bHRzLm5vZGVOYW1lLmxhc3RJbmRleE9mKCAnLicgKTsKCgkJCQlpZiAoIGxhc3REb3QgIT09IHVuZGVmaW5lZCAmJiBsYXN0RG90ICE9PSAtIDEgKSB7CgoJCQkJCXZhciBvYmplY3ROYW1lID0gcmVzdWx0cy5ub2RlTmFtZS5zdWJzdHJpbmcoIGxhc3REb3QgKyAxICk7CgoJCQkJCS8vIE9iamVjdCBuYW1lcyBtdXN0IGJlIGNoZWNrZWQgYWdhaW5zdCBhIHdoaXRlbGlzdC4gT3RoZXJ3aXNlLCB0aGVyZQoJCQkJCS8vIGlzIG5vIHdheSB0byBwYXJzZSAnZm9vLmJhci5iYXonOiAnYmF6JyBtdXN0IGJlIGEgcHJvcGVydHksIGJ1dAoJCQkJCS8vICdiYXInIGNvdWxkIGJlIHRoZSBvYmplY3ROYW1lLCBvciBwYXJ0IG9mIGEgbm9kZU5hbWUgKHdoaWNoIGNhbgoJCQkJCS8vIGluY2x1ZGUgJy4nIGNoYXJhY3RlcnMpLgoJCQkJCWlmICggc3VwcG9ydGVkT2JqZWN0TmFtZXMuaW5kZXhPZiggb2JqZWN0TmFtZSApICE9PSAtIDEgKSB7CgoJCQkJCQlyZXN1bHRzLm5vZGVOYW1lID0gcmVzdWx0cy5ub2RlTmFtZS5zdWJzdHJpbmcoIDAsIGxhc3REb3QgKTsKCQkJCQkJcmVzdWx0cy5vYmplY3ROYW1lID0gb2JqZWN0TmFtZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHJlc3VsdHMucHJvcGVydHlOYW1lID09PSBudWxsIHx8IHJlc3VsdHMucHJvcGVydHlOYW1lLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkJdGhyb3cgbmV3IEVycm9yKCAnUHJvcGVydHlCaW5kaW5nOiBjYW4gbm90IHBhcnNlIHByb3BlcnR5TmFtZSBmcm9tIHRyYWNrTmFtZTogJyArIHRyYWNrTmFtZSApOwoKCQkJCX0KCgkJCQlyZXR1cm4gcmVzdWx0czsKCgkJCX07CgoJCX0oKSwKCgkJZmluZE5vZGU6IGZ1bmN0aW9uICggcm9vdCwgbm9kZU5hbWUgKSB7CgoJCQlpZiAoICEgbm9kZU5hbWUgfHwgbm9kZU5hbWUgPT09ICIiIHx8IG5vZGVOYW1lID09PSAicm9vdCIgfHwgbm9kZU5hbWUgPT09ICIuIiB8fCBub2RlTmFtZSA9PT0gLSAxIHx8IG5vZGVOYW1lID09PSByb290Lm5hbWUgfHwgbm9kZU5hbWUgPT09IHJvb3QudXVpZCApIHsKCgkJCQlyZXR1cm4gcm9vdDsKCgkJCX0KCgkJCS8vIHNlYXJjaCBpbnRvIHNrZWxldG9uIGJvbmVzLgoJCQlpZiAoIHJvb3Quc2tlbGV0b24gKSB7CgoJCQkJdmFyIGJvbmUgPSByb290LnNrZWxldG9uLmdldEJvbmVCeU5hbWUoIG5vZGVOYW1lICk7CgoJCQkJaWYgKCBib25lICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiBib25lOwoKCQkJCX0KCgkJCX0KCgkJCS8vIHNlYXJjaCBpbnRvIG5vZGUgc3VidHJlZS4KCQkJaWYgKCByb290LmNoaWxkcmVuICkgewoKCQkJCXZhciBzZWFyY2hOb2RlU3VidHJlZSA9IGZ1bmN0aW9uICggY2hpbGRyZW4gKSB7CgoJCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCXZhciBjaGlsZE5vZGUgPSBjaGlsZHJlblsgaSBdOwoKCQkJCQkJaWYgKCBjaGlsZE5vZGUubmFtZSA9PT0gbm9kZU5hbWUgfHwgY2hpbGROb2RlLnV1aWQgPT09IG5vZGVOYW1lICkgewoKCQkJCQkJCXJldHVybiBjaGlsZE5vZGU7CgoJCQkJCQl9CgoJCQkJCQl2YXIgcmVzdWx0ID0gc2VhcmNoTm9kZVN1YnRyZWUoIGNoaWxkTm9kZS5jaGlsZHJlbiApOwoKCQkJCQkJaWYgKCByZXN1bHQgKSByZXR1cm4gcmVzdWx0OwoKCQkJCQl9CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX07CgoJCQkJdmFyIHN1YlRyZWVOb2RlID0gc2VhcmNoTm9kZVN1YnRyZWUoIHJvb3QuY2hpbGRyZW4gKTsKCgkJCQlpZiAoIHN1YlRyZWVOb2RlICkgewoKCQkJCQlyZXR1cm4gc3ViVHJlZU5vZGU7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZSwgeyAvLyBwcm90b3R5cGUsIGNvbnRpbnVlZAoKCQkvLyB0aGVzZSBhcmUgdXNlZCB0byAiYmluZCIgYSBub25leGlzdGVudCBwcm9wZXJ0eQoJCV9nZXRWYWx1ZV91bmF2YWlsYWJsZTogZnVuY3Rpb24gKCkge30sCgkJX3NldFZhbHVlX3VuYXZhaWxhYmxlOiBmdW5jdGlvbiAoKSB7fSwKCgkJQmluZGluZ1R5cGU6IHsKCQkJRGlyZWN0OiAwLAoJCQlFbnRpcmVBcnJheTogMSwKCQkJQXJyYXlFbGVtZW50OiAyLAoJCQlIYXNGcm9tVG9BcnJheTogMwoJCX0sCgoJCVZlcnNpb25pbmc6IHsKCQkJTm9uZTogMCwKCQkJTmVlZHNVcGRhdGU6IDEsCgkJCU1hdHJpeFdvcmxkTmVlZHNVcGRhdGU6IDIKCQl9LAoKCQlHZXR0ZXJCeUJpbmRpbmdUeXBlOiBbCgoJCQlmdW5jdGlvbiBnZXRWYWx1ZV9kaXJlY3QoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCWJ1ZmZlclsgb2Zmc2V0IF0gPSB0aGlzLm5vZGVbIHRoaXMucHJvcGVydHlOYW1lIF07CgoJCQl9LAoKCQkJZnVuY3Rpb24gZ2V0VmFsdWVfYXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCXZhciBzb3VyY2UgPSB0aGlzLnJlc29sdmVkUHJvcGVydHk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gc291cmNlLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQkJYnVmZmVyWyBvZmZzZXQgKysgXSA9IHNvdXJjZVsgaSBdOwoKCQkJCX0KCgkJCX0sCgoJCQlmdW5jdGlvbiBnZXRWYWx1ZV9hcnJheUVsZW1lbnQoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCWJ1ZmZlclsgb2Zmc2V0IF0gPSB0aGlzLnJlc29sdmVkUHJvcGVydHlbIHRoaXMucHJvcGVydHlJbmRleCBdOwoKCQkJfSwKCgkJCWZ1bmN0aW9uIGdldFZhbHVlX3RvQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eS50b0FycmF5KCBidWZmZXIsIG9mZnNldCApOwoKCQkJfQoKCQldLAoKCQlTZXR0ZXJCeUJpbmRpbmdUeXBlQW5kVmVyc2lvbmluZzogWwoKCQkJWwoJCQkJLy8gRGlyZWN0CgoJCQkJZnVuY3Rpb24gc2V0VmFsdWVfZGlyZWN0KCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdGhpcy50YXJnZXRPYmplY3RbIHRoaXMucHJvcGVydHlOYW1lIF0gPSBidWZmZXJbIG9mZnNldCBdOwoKCQkJCX0sCgoJCQkJZnVuY3Rpb24gc2V0VmFsdWVfZGlyZWN0X3NldE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdGhpcy50YXJnZXRPYmplY3RbIHRoaXMucHJvcGVydHlOYW1lIF0gPSBidWZmZXJbIG9mZnNldCBdOwoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9LAoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2RpcmVjdF9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdGhpcy50YXJnZXRPYmplY3RbIHRoaXMucHJvcGVydHlOYW1lIF0gPSBidWZmZXJbIG9mZnNldCBdOwoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCV0sIFsKCgkJCQkvLyBFbnRpcmVBcnJheQoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2FycmF5KCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdmFyIGRlc3QgPSB0aGlzLnJlc29sdmVkUHJvcGVydHk7CgoJCQkJCWZvciAoIHZhciBpID0gMCwgbiA9IGRlc3QubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQkJZGVzdFsgaSBdID0gYnVmZmVyWyBvZmZzZXQgKysgXTsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJZnVuY3Rpb24gc2V0VmFsdWVfYXJyYXlfc2V0TmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCQl2YXIgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJCQlkZXN0WyBpIF0gPSBidWZmZXJbIG9mZnNldCArKyBdOwoKCQkJCQl9CgoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9LAoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2FycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCQl2YXIgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJCQlkZXN0WyBpIF0gPSBidWZmZXJbIG9mZnNldCArKyBdOwoKCQkJCQl9CgoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCV0sIFsKCgkJCQkvLyBBcnJheUVsZW1lbnQKCgkJCQlmdW5jdGlvbiBzZXRWYWx1ZV9hcnJheUVsZW1lbnQoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCQl0aGlzLnJlc29sdmVkUHJvcGVydHlbIHRoaXMucHJvcGVydHlJbmRleCBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCgkJCQl9LAoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2FycmF5RWxlbWVudF9zZXROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCQkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eVsgdGhpcy5wcm9wZXJ0eUluZGV4IF0gPSBidWZmZXJbIG9mZnNldCBdOwoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9LAoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2FycmF5RWxlbWVudF9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdGhpcy5yZXNvbHZlZFByb3BlcnR5WyB0aGlzLnByb3BlcnR5SW5kZXggXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgkJCQkJdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJfQoKCQkJXSwgWwoKCQkJCS8vIEhhc1RvRnJvbUFycmF5CgoJCQkJZnVuY3Rpb24gc2V0VmFsdWVfZnJvbUFycmF5KCBidWZmZXIsIG9mZnNldCApIHsKCgkJCQkJdGhpcy5yZXNvbHZlZFByb3BlcnR5LmZyb21BcnJheSggYnVmZmVyLCBvZmZzZXQgKTsKCgkJCQl9LAoKCQkJCWZ1bmN0aW9uIHNldFZhbHVlX2Zyb21BcnJheV9zZXROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCQkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eS5mcm9tQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICk7CgkJCQkJdGhpcy50YXJnZXRPYmplY3QubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0sCgoJCQkJZnVuY3Rpb24gc2V0VmFsdWVfZnJvbUFycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQkJCQl0aGlzLnJlc29sdmVkUHJvcGVydHkuZnJvbUFycmF5KCBidWZmZXIsIG9mZnNldCApOwoJCQkJCXRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCV0KCgkJXSwKCgkJZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlX3VuYm91bmQoIHRhcmdldEFycmF5LCBvZmZzZXQgKSB7CgoJCQl0aGlzLmJpbmQoKTsKCQkJdGhpcy5nZXRWYWx1ZSggdGFyZ2V0QXJyYXksIG9mZnNldCApOwoKCQkJLy8gTm90ZTogVGhpcyBjbGFzcyB1c2VzIGEgU3RhdGUgcGF0dGVybiBvbiBhIHBlci1tZXRob2QgYmFzaXM6CgkJCS8vICdiaW5kJyBzZXRzICd0aGlzLmdldFZhbHVlJyAvICdzZXRWYWx1ZScgYW5kIHNoYWRvd3MgdGhlCgkJCS8vIHByb3RvdHlwZSB2ZXJzaW9uIG9mIHRoZXNlIG1ldGhvZHMgd2l0aCBvbmUgdGhhdCByZXByZXNlbnRzCgkJCS8vIHRoZSBib3VuZCBzdGF0ZS4gV2hlbiB0aGUgcHJvcGVydHkgaXMgbm90IGZvdW5kLCB0aGUgbWV0aG9kcwoJCQkvLyBiZWNvbWUgbm8tb3BzLgoKCQl9LAoKCQlzZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWVfdW5ib3VuZCggc291cmNlQXJyYXksIG9mZnNldCApIHsKCgkJCXRoaXMuYmluZCgpOwoJCQl0aGlzLnNldFZhbHVlKCBzb3VyY2VBcnJheSwgb2Zmc2V0ICk7CgoJCX0sCgoJCS8vIGNyZWF0ZSBnZXR0ZXIgLyBzZXR0ZXIgcGFpciBmb3IgYSBwcm9wZXJ0eSBpbiB0aGUgc2NlbmUgZ3JhcGgKCQliaW5kOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdGFyZ2V0T2JqZWN0ID0gdGhpcy5ub2RlLAoJCQkJcGFyc2VkUGF0aCA9IHRoaXMucGFyc2VkUGF0aCwKCgkJCQlvYmplY3ROYW1lID0gcGFyc2VkUGF0aC5vYmplY3ROYW1lLAoJCQkJcHJvcGVydHlOYW1lID0gcGFyc2VkUGF0aC5wcm9wZXJ0eU5hbWUsCgkJCQlwcm9wZXJ0eUluZGV4ID0gcGFyc2VkUGF0aC5wcm9wZXJ0eUluZGV4OwoKCQkJaWYgKCAhIHRhcmdldE9iamVjdCApIHsKCgkJCQl0YXJnZXRPYmplY3QgPSBQcm9wZXJ0eUJpbmRpbmcuZmluZE5vZGUoIHRoaXMucm9vdE5vZGUsIHBhcnNlZFBhdGgubm9kZU5hbWUgKSB8fCB0aGlzLnJvb3ROb2RlOwoKCQkJCXRoaXMubm9kZSA9IHRhcmdldE9iamVjdDsKCgkJCX0KCgkJCS8vIHNldCBmYWlsIHN0YXRlIHNvIHdlIGNhbiBqdXN0ICdyZXR1cm4nIG9uIGVycm9yCgkJCXRoaXMuZ2V0VmFsdWUgPSB0aGlzLl9nZXRWYWx1ZV91bmF2YWlsYWJsZTsKCQkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYXZhaWxhYmxlOwoKCQkJLy8gZW5zdXJlIHRoZXJlIGlzIGEgdmFsdWUgbm9kZQoJCQlpZiAoICEgdGFyZ2V0T2JqZWN0ICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IFRyeWluZyB0byB1cGRhdGUgbm9kZSBmb3IgdHJhY2s6ICcgKyB0aGlzLnBhdGggKyAnIGJ1dCBpdCB3YXNuXCd0IGZvdW5kLicgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggb2JqZWN0TmFtZSApIHsKCgkJCQl2YXIgb2JqZWN0SW5kZXggPSBwYXJzZWRQYXRoLm9iamVjdEluZGV4OwoKCQkJCS8vIHNwZWNpYWwgY2FzZXMgd2VyZSB3ZSBuZWVkIHRvIHJlYWNoIGRlZXBlciBpbnRvIHRoZSBoaWVyYXJjaHkgdG8gZ2V0IHRoZSBmYWNlIG1hdGVyaWFscy4uLi4KCQkJCXN3aXRjaCAoIG9iamVjdE5hbWUgKSB7CgoJCQkJCWNhc2UgJ21hdGVyaWFscyc6CgoJCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsICkgewoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBtYXRlcmlhbCBhcyBub2RlIGRvZXMgbm90IGhhdmUgYSBtYXRlcmlhbC4nLCB0aGlzICk7CgkJCQkJCQlyZXR1cm47CgoJCQkJCQl9CgoJCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsLm1hdGVyaWFscyApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbWF0ZXJpYWwubWF0ZXJpYWxzIGFzIG5vZGUubWF0ZXJpYWwgZG9lcyBub3QgaGF2ZSBhIG1hdGVyaWFscyBhcnJheS4nLCB0aGlzICk7CgkJCQkJCQlyZXR1cm47CgoJCQkJCQl9CgoJCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3QubWF0ZXJpYWwubWF0ZXJpYWxzOwoKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ2JvbmVzJzoKCgkJCQkJCWlmICggISB0YXJnZXRPYmplY3Quc2tlbGV0b24gKSB7CgoJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIGJvbmVzIGFzIG5vZGUgZG9lcyBub3QgaGF2ZSBhIHNrZWxldG9uLicsIHRoaXMgKTsKCQkJCQkJCXJldHVybjsKCgkJCQkJCX0KCgkJCQkJCS8vIHBvdGVudGlhbCBmdXR1cmUgb3B0aW1pemF0aW9uOiBza2lwIHRoaXMgaWYgcHJvcGVydHlJbmRleCBpcyBhbHJlYWR5IGFuIGludGVnZXIKCQkJCQkJLy8gYW5kIGNvbnZlcnQgdGhlIGludGVnZXIgc3RyaW5nIHRvIGEgdHJ1ZSBpbnRlZ2VyLgoKCQkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0LnNrZWxldG9uLmJvbmVzOwoKCQkJCQkJLy8gc3VwcG9ydCByZXNvbHZpbmcgbW9ycGhUYXJnZXQgbmFtZXMgaW50byBpbmRpY2VzLgoJCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0YXJnZXRPYmplY3QubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCWlmICggdGFyZ2V0T2JqZWN0WyBpIF0ubmFtZSA9PT0gb2JqZWN0SW5kZXggKSB7CgoJCQkJCQkJCW9iamVjdEluZGV4ID0gaTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCgkJCQkJCWlmICggdGFyZ2V0T2JqZWN0WyBvYmplY3ROYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gb2JqZWN0TmFtZSBvZiBub2RlIHVuZGVmaW5lZC4nLCB0aGlzICk7CgkJCQkJCQlyZXR1cm47CgoJCQkJCQl9CgoJCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3RbIG9iamVjdE5hbWUgXTsKCgkJCQl9CgoKCQkJCWlmICggb2JqZWN0SW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaWYgKCB0YXJnZXRPYmplY3RbIG9iamVjdEluZGV4IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IFRyeWluZyB0byBiaW5kIHRvIG9iamVjdEluZGV4IG9mIG9iamVjdE5hbWUsIGJ1dCBpcyB1bmRlZmluZWQuJywgdGhpcywgdGFyZ2V0T2JqZWN0ICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3RbIG9iamVjdEluZGV4IF07CgoJCQkJfQoKCQkJfQoKCQkJLy8gcmVzb2x2ZSBwcm9wZXJ0eQoJCQl2YXIgbm9kZVByb3BlcnR5ID0gdGFyZ2V0T2JqZWN0WyBwcm9wZXJ0eU5hbWUgXTsKCgkJCWlmICggbm9kZVByb3BlcnR5ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJdmFyIG5vZGVOYW1lID0gcGFyc2VkUGF0aC5ub2RlTmFtZTsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBUcnlpbmcgdG8gdXBkYXRlIHByb3BlcnR5IGZvciB0cmFjazogJyArIG5vZGVOYW1lICsKCQkJCQknLicgKyBwcm9wZXJ0eU5hbWUgKyAnIGJ1dCBpdCB3YXNuXCd0IGZvdW5kLicsIHRhcmdldE9iamVjdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJLy8gZGV0ZXJtaW5lIHZlcnNpb25pbmcgc2NoZW1lCgkJCXZhciB2ZXJzaW9uaW5nID0gdGhpcy5WZXJzaW9uaW5nLk5vbmU7CgoJCQl0aGlzLnRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdDsKCgkJCWlmICggdGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlICE9PSB1bmRlZmluZWQgKSB7IC8vIG1hdGVyaWFsCgoJCQkJdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5OZWVkc1VwZGF0ZTsKCgkJCX0gZWxzZSBpZiAoIHRhcmdldE9iamVjdC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlICE9PSB1bmRlZmluZWQgKSB7IC8vIG5vZGUgdHJhbnNmb3JtCgoJCQkJdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5NYXRyaXhXb3JsZE5lZWRzVXBkYXRlOwoKCQkJfQoKCQkJLy8gZGV0ZXJtaW5lIGhvdyB0aGUgcHJvcGVydHkgZ2V0cyBib3VuZAoJCQl2YXIgYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkRpcmVjdDsKCgkJCWlmICggcHJvcGVydHlJbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIGFjY2VzcyBhIHN1YiBlbGVtZW50IG9mIHRoZSBwcm9wZXJ0eSBhcnJheSAob25seSBwcmltaXRpdmVzIGFyZSBzdXBwb3J0ZWQgcmlnaHQgbm93KQoKCQkJCWlmICggcHJvcGVydHlOYW1lID09PSAibW9ycGhUYXJnZXRJbmZsdWVuY2VzIiApIHsKCgkJCQkJLy8gcG90ZW50aWFsIG9wdGltaXphdGlvbiwgc2tpcCB0aGlzIGlmIHByb3BlcnR5SW5kZXggaXMgYWxyZWFkeSBhbiBpbnRlZ2VyLCBhbmQgY29udmVydCB0aGUgaW50ZWdlciBzdHJpbmcgdG8gYSB0cnVlIGludGVnZXIuCgoJCQkJCS8vIHN1cHBvcnQgcmVzb2x2aW5nIG1vcnBoVGFyZ2V0IG5hbWVzIGludG8gaW5kaWNlcy4KCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5ICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcyBiZWNhdXNlIG5vZGUgZG9lcyBub3QgaGF2ZSBhIGdlb21ldHJ5LicsIHRoaXMgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCWlmICggdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzIGJlY2F1c2Ugbm9kZSBkb2VzIG5vdCBoYXZlIGEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLicsIHRoaXMgKTsKCQkJCQkJCXJldHVybjsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMubm9kZS5nZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24ubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCWlmICggdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvblsgaSBdLm5hbWUgPT09IHByb3BlcnR5SW5kZXggKSB7CgoJCQkJCQkJCXByb3BlcnR5SW5kZXggPSBpOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5Lm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzIGJlY2F1c2Ugbm9kZSBkb2VzIG5vdCBoYXZlIGEgZ2VvbWV0cnkubW9ycGhUYXJnZXRzLicsIHRoaXMgKTsKCQkJCQkJCXJldHVybjsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IHRoaXMubm9kZS5nZW9tZXRyeS5tb3JwaFRhcmdldHMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCWlmICggdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1sgaSBdLm5hbWUgPT09IHByb3BlcnR5SW5kZXggKSB7CgoJCQkJCQkJCXByb3BlcnR5SW5kZXggPSBpOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQliaW5kaW5nVHlwZSA9IHRoaXMuQmluZGluZ1R5cGUuQXJyYXlFbGVtZW50OwoKCQkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eSA9IG5vZGVQcm9wZXJ0eTsKCQkJCXRoaXMucHJvcGVydHlJbmRleCA9IHByb3BlcnR5SW5kZXg7CgoJCQl9IGVsc2UgaWYgKCBub2RlUHJvcGVydHkuZnJvbUFycmF5ICE9PSB1bmRlZmluZWQgJiYgbm9kZVByb3BlcnR5LnRvQXJyYXkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBtdXN0IHVzZSBjb3B5IGZvciBPYmplY3QzRC5FdWxlci9RdWF0ZXJuaW9uCgoJCQkJYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkhhc0Zyb21Ub0FycmF5OwoKCQkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eSA9IG5vZGVQcm9wZXJ0eTsKCgkJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIG5vZGVQcm9wZXJ0eSApICkgewoKCQkJCWJpbmRpbmdUeXBlID0gdGhpcy5CaW5kaW5nVHlwZS5FbnRpcmVBcnJheTsKCgkJCQl0aGlzLnJlc29sdmVkUHJvcGVydHkgPSBub2RlUHJvcGVydHk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lOwoKCQkJfQoKCQkJLy8gc2VsZWN0IGdldHRlciAvIHNldHRlcgoJCQl0aGlzLmdldFZhbHVlID0gdGhpcy5HZXR0ZXJCeUJpbmRpbmdUeXBlWyBiaW5kaW5nVHlwZSBdOwoJCQl0aGlzLnNldFZhbHVlID0gdGhpcy5TZXR0ZXJCeUJpbmRpbmdUeXBlQW5kVmVyc2lvbmluZ1sgYmluZGluZ1R5cGUgXVsgdmVyc2lvbmluZyBdOwoKCQl9LAoKCQl1bmJpbmQ6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMubm9kZSA9IG51bGw7CgoJCQkvLyBiYWNrIHRvIHRoZSBwcm90b3R5cGUgdmVyc2lvbiBvZiBnZXRWYWx1ZSAvIHNldFZhbHVlCgkJCS8vIG5vdGU6IGF2b2lkaW5nIHRvIG11dGF0ZSB0aGUgc2hhcGUgb2YgJ3RoaXMnIHZpYSAnZGVsZXRlJwoJCQl0aGlzLmdldFZhbHVlID0gdGhpcy5fZ2V0VmFsdWVfdW5ib3VuZDsKCQkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYm91bmQ7CgoJCX0KCgl9ICk7CgoJLy8hXCBERUNMQVJFIEFMSUFTIEFGVEVSIGFzc2lnbiBwcm90b3R5cGUgIQoJT2JqZWN0LmFzc2lnbiggUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZSwgewoKCQkvLyBpbml0aWFsIHN0YXRlIG9mIHRoZXNlIG1ldGhvZHMgdGhhdCBjYWxscyAnYmluZCcKCQlfZ2V0VmFsdWVfdW5ib3VuZDogUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5nZXRWYWx1ZSwKCQlfc2V0VmFsdWVfdW5ib3VuZDogUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5zZXRWYWx1ZSwKCgl9ICk7CgoJLyoqCgkgKgoJICogQSBncm91cCBvZiBvYmplY3RzIHRoYXQgcmVjZWl2ZXMgYSBzaGFyZWQgYW5pbWF0aW9uIHN0YXRlLgoJICoKCSAqIFVzYWdlOgoJICoKCSAqICAtIEFkZCBvYmplY3RzIHlvdSB3b3VsZCBvdGhlcndpc2UgcGFzcyBhcyAncm9vdCcgdG8gdGhlCgkgKiAgICBjb25zdHJ1Y3RvciBvciB0aGUgLmNsaXBBY3Rpb24gbWV0aG9kIG9mIEFuaW1hdGlvbk1peGVyLgoJICoKCSAqICAtIEluc3RlYWQgcGFzcyB0aGlzIG9iamVjdCBhcyAncm9vdCcuCgkgKgoJICogIC0gWW91IGNhbiBhbHNvIGFkZCBhbmQgcmVtb3ZlIG9iamVjdHMgbGF0ZXIgd2hlbiB0aGUgbWl4ZXIKCSAqICAgIGlzIHJ1bm5pbmcuCgkgKgoJICogTm90ZToKCSAqCgkgKiAgICBPYmplY3RzIG9mIHRoaXMgY2xhc3MgYXBwZWFyIGFzIG9uZSBvYmplY3QgdG8gdGhlIG1peGVyLAoJICogICAgc28gY2FjaGUgY29udHJvbCBvZiB0aGUgaW5kaXZpZHVhbCBvYmplY3RzIG11c3QgYmUgZG9uZQoJICogICAgb24gdGhlIGdyb3VwLgoJICoKCSAqIExpbWl0YXRpb246CgkgKgoJICogIC0gVGhlIGFuaW1hdGVkIHByb3BlcnRpZXMgbXVzdCBiZSBjb21wYXRpYmxlIGFtb25nIHRoZQoJICogICAgYWxsIG9iamVjdHMgaW4gdGhlIGdyb3VwLgoJICoKCSAqICAtIEEgc2luZ2xlIHByb3BlcnR5IGNhbiBlaXRoZXIgYmUgY29udHJvbGxlZCB0aHJvdWdoIGEKCSAqICAgIHRhcmdldCBncm91cCBvciBkaXJlY3RseSwgYnV0IG5vdCBib3RoLgoJICoKCSAqIEBhdXRob3IgdHNjaHcKCSAqLwoKCWZ1bmN0aW9uIEFuaW1hdGlvbk9iamVjdEdyb3VwKCkgewoKCQl0aGlzLnV1aWQgPSBfTWF0aC5nZW5lcmF0ZVVVSUQoKTsKCgkJLy8gY2FjaGVkIG9iamVjdHMgZm9sbG93ZWQgYnkgdGhlIGFjdGl2ZSBvbmVzCgkJdGhpcy5fb2JqZWN0cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcmd1bWVudHMgKTsKCgkJdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSAwOyAvLyB0aHJlc2hvbGQKCQkvLyBub3RlOiByZWFkIGJ5IFByb3BlcnR5QmluZGluZy5Db21wb3NpdGUKCgkJdmFyIGluZGljZXMgPSB7fTsKCQl0aGlzLl9pbmRpY2VzQnlVVUlEID0gaW5kaWNlczsgLy8gZm9yIGJvb2trZWVwaW5nCgoJCWZvciAoIHZhciBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQlpbmRpY2VzWyBhcmd1bWVudHNbIGkgXS51dWlkIF0gPSBpOwoKCQl9CgoJCXRoaXMuX3BhdGhzID0gW107IC8vIGluc2lkZTogc3RyaW5nCgkJdGhpcy5fcGFyc2VkUGF0aHMgPSBbXTsgLy8gaW5zaWRlOiB7IHdlIGRvbid0IGNhcmUsIGhlcmUgfQoJCXRoaXMuX2JpbmRpbmdzID0gW107IC8vIGluc2lkZTogQXJyYXk8IFByb3BlcnR5QmluZGluZyA+CgkJdGhpcy5fYmluZGluZ3NJbmRpY2VzQnlQYXRoID0ge307IC8vIGluc2lkZTogaW5kaWNlcyBpbiB0aGVzZSBhcnJheXMKCgkJdmFyIHNjb3BlID0gdGhpczsKCgkJdGhpcy5zdGF0cyA9IHsKCgkJCW9iamVjdHM6IHsKCQkJCWdldCB0b3RhbCgpIHsKCgkJCQkJcmV0dXJuIHNjb3BlLl9vYmplY3RzLmxlbmd0aDsKCgkJCQl9LAoJCQkJZ2V0IGluVXNlKCkgewoKCQkJCQlyZXR1cm4gdGhpcy50b3RhbCAtIHNjb3BlLm5DYWNoZWRPYmplY3RzXzsKCgkJCQl9CgkJCX0sCgkJCWdldCBiaW5kaW5nc1Blck9iamVjdCgpIHsKCgkJCQlyZXR1cm4gc2NvcGUuX2JpbmRpbmdzLmxlbmd0aDsKCgkJCX0KCgkJfTsKCgl9CgoJT2JqZWN0LmFzc2lnbiggQW5pbWF0aW9uT2JqZWN0R3JvdXAucHJvdG90eXBlLCB7CgoJCWlzQW5pbWF0aW9uT2JqZWN0R3JvdXA6IHRydWUsCgoJCWFkZDogZnVuY3Rpb24gKCkgewoKCQkJdmFyIG9iamVjdHMgPSB0aGlzLl9vYmplY3RzLAoJCQkJbk9iamVjdHMgPSBvYmplY3RzLmxlbmd0aCwKCQkJCW5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c18sCgkJCQlpbmRpY2VzQnlVVUlEID0gdGhpcy5faW5kaWNlc0J5VVVJRCwKCQkJCXBhdGhzID0gdGhpcy5fcGF0aHMsCgkJCQlwYXJzZWRQYXRocyA9IHRoaXMuX3BhcnNlZFBhdGhzLAoJCQkJYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJCW5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aCwKCQkJCWtub3duT2JqZWN0ID0gdW5kZWZpbmVkOwoKCQkJZm9yICggdmFyIGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQl2YXIgb2JqZWN0ID0gYXJndW1lbnRzWyBpIF0sCgkJCQkJdXVpZCA9IG9iamVjdC51dWlkLAoJCQkJCWluZGV4ID0gaW5kaWNlc0J5VVVJRFsgdXVpZCBdOwoKCQkJCWlmICggaW5kZXggPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gdW5rbm93biBvYmplY3QgLT4gYWRkIGl0IHRvIHRoZSBBQ1RJVkUgcmVnaW9uCgoJCQkJCWluZGV4ID0gbk9iamVjdHMgKys7CgkJCQkJaW5kaWNlc0J5VVVJRFsgdXVpZCBdID0gaW5kZXg7CgkJCQkJb2JqZWN0cy5wdXNoKCBvYmplY3QgKTsKCgkJCQkJLy8gYWNjb3VudGluZyBpcyBkb25lLCBub3cgZG8gdGhlIHNhbWUgZm9yIGFsbCBiaW5kaW5ncwoKCQkJCQlmb3IgKCB2YXIgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCQliaW5kaW5nc1sgaiBdLnB1c2goIG5ldyBQcm9wZXJ0eUJpbmRpbmcoIG9iamVjdCwgcGF0aHNbIGogXSwgcGFyc2VkUGF0aHNbIGogXSApICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBpbmRleCA8IG5DYWNoZWRPYmplY3RzICkgewoKCQkJCQlrbm93bk9iamVjdCA9IG9iamVjdHNbIGluZGV4IF07CgoJCQkJCS8vIG1vdmUgZXhpc3Rpbmcgb2JqZWN0IHRvIHRoZSBBQ1RJVkUgcmVnaW9uCgoJCQkJCXZhciBmaXJzdEFjdGl2ZUluZGV4ID0gLS0gbkNhY2hlZE9iamVjdHMsCgkJCQkJCWxhc3RDYWNoZWRPYmplY3QgPSBvYmplY3RzWyBmaXJzdEFjdGl2ZUluZGV4IF07CgoJCQkJCWluZGljZXNCeVVVSURbIGxhc3RDYWNoZWRPYmplY3QudXVpZCBdID0gaW5kZXg7CgkJCQkJb2JqZWN0c1sgaW5kZXggXSA9IGxhc3RDYWNoZWRPYmplY3Q7CgoJCQkJCWluZGljZXNCeVVVSURbIHV1aWQgXSA9IGZpcnN0QWN0aXZlSW5kZXg7CgkJCQkJb2JqZWN0c1sgZmlyc3RBY3RpdmVJbmRleCBdID0gb2JqZWN0OwoKCQkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJCWZvciAoIHZhciBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCXZhciBiaW5kaW5nc0ZvclBhdGggPSBiaW5kaW5nc1sgaiBdLAoJCQkJCQkJbGFzdENhY2hlZCA9IGJpbmRpbmdzRm9yUGF0aFsgZmlyc3RBY3RpdmVJbmRleCBdLAoJCQkJCQkJYmluZGluZyA9IGJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXTsKCgkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGxhc3RDYWNoZWQ7CgoJCQkJCQlpZiAoIGJpbmRpbmcgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkvLyBzaW5jZSB3ZSBkbyBub3QgYm90aGVyIHRvIGNyZWF0ZSBuZXcgYmluZGluZ3MKCQkJCQkJCS8vIGZvciBvYmplY3RzIHRoYXQgYXJlIGNhY2hlZCwgdGhlIGJpbmRpbmcgbWF5CgkJCQkJCQkvLyBvciBtYXkgbm90IGV4aXN0CgoJCQkJCQkJYmluZGluZyA9IG5ldyBQcm9wZXJ0eUJpbmRpbmcoIG9iamVjdCwgcGF0aHNbIGogXSwgcGFyc2VkUGF0aHNbIGogXSApOwoKCQkJCQkJfQoKCQkJCQkJYmluZGluZ3NGb3JQYXRoWyBmaXJzdEFjdGl2ZUluZGV4IF0gPSBiaW5kaW5nOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0c1sgaW5kZXggXSAhPT0ga25vd25PYmplY3QgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5BbmltYXRpb25PYmplY3RHcm91cDogRGlmZmVyZW50IG9iamVjdHMgd2l0aCB0aGUgc2FtZSBVVUlEICcgKwoJCQkJCQknZGV0ZWN0ZWQuIENsZWFuIHRoZSBjYWNoZXMgb3IgcmVjcmVhdGUgeW91ciBpbmZyYXN0cnVjdHVyZSB3aGVuIHJlbG9hZGluZyBzY2VuZXMuJyApOwoKCQkJCX0gLy8gZWxzZSB0aGUgb2JqZWN0IGlzIGFscmVhZHkgd2hlcmUgd2Ugd2FudCBpdCB0byBiZQoKCQkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCQl0aGlzLm5DYWNoZWRPYmplY3RzXyA9IG5DYWNoZWRPYmplY3RzOwoKCQl9LAoKCQlyZW1vdmU6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJCW5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c18sCgkJCQlpbmRpY2VzQnlVVUlEID0gdGhpcy5faW5kaWNlc0J5VVVJRCwKCQkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCQluQmluZGluZ3MgPSBiaW5kaW5ncy5sZW5ndGg7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCXZhciBvYmplY3QgPSBhcmd1bWVudHNbIGkgXSwKCQkJCQl1dWlkID0gb2JqZWN0LnV1aWQsCgkJCQkJaW5kZXggPSBpbmRpY2VzQnlVVUlEWyB1dWlkIF07CgoJCQkJaWYgKCBpbmRleCAhPT0gdW5kZWZpbmVkICYmIGluZGV4ID49IG5DYWNoZWRPYmplY3RzICkgewoKCQkJCQkvLyBtb3ZlIGV4aXN0aW5nIG9iamVjdCBpbnRvIHRoZSBDQUNIRUQgcmVnaW9uCgoJCQkJCXZhciBsYXN0Q2FjaGVkSW5kZXggPSBuQ2FjaGVkT2JqZWN0cyArKywKCQkJCQkJZmlyc3RBY3RpdmVPYmplY3QgPSBvYmplY3RzWyBsYXN0Q2FjaGVkSW5kZXggXTsKCgkJCQkJaW5kaWNlc0J5VVVJRFsgZmlyc3RBY3RpdmVPYmplY3QudXVpZCBdID0gaW5kZXg7CgkJCQkJb2JqZWN0c1sgaW5kZXggXSA9IGZpcnN0QWN0aXZlT2JqZWN0OwoKCQkJCQlpbmRpY2VzQnlVVUlEWyB1dWlkIF0gPSBsYXN0Q2FjaGVkSW5kZXg7CgkJCQkJb2JqZWN0c1sgbGFzdENhY2hlZEluZGV4IF0gPSBvYmplY3Q7CgoJCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQkJZm9yICggdmFyIGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQkJdmFyIGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF0sCgkJCQkJCQlmaXJzdEFjdGl2ZSA9IGJpbmRpbmdzRm9yUGF0aFsgbGFzdENhY2hlZEluZGV4IF0sCgkJCQkJCQliaW5kaW5nID0gYmluZGluZ3NGb3JQYXRoWyBpbmRleCBdOwoKCQkJCQkJYmluZGluZ3NGb3JQYXRoWyBpbmRleCBdID0gZmlyc3RBY3RpdmU7CgkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgbGFzdENhY2hlZEluZGV4IF0gPSBiaW5kaW5nOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCQl0aGlzLm5DYWNoZWRPYmplY3RzXyA9IG5DYWNoZWRPYmplY3RzOwoKCQl9LAoKCQkvLyByZW1vdmUgJiBmb3JnZXQKCQl1bmNhY2hlOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsCgkJCQluT2JqZWN0cyA9IG9iamVjdHMubGVuZ3RoLAoJCQkJbkNhY2hlZE9iamVjdHMgPSB0aGlzLm5DYWNoZWRPYmplY3RzXywKCQkJCWluZGljZXNCeVVVSUQgPSB0aGlzLl9pbmRpY2VzQnlVVUlELAoJCQkJYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJCW5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKCgkJCWZvciAoIHZhciBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdmFyIG9iamVjdCA9IGFyZ3VtZW50c1sgaSBdLAoJCQkJCXV1aWQgPSBvYmplY3QudXVpZCwKCQkJCQlpbmRleCA9IGluZGljZXNCeVVVSURbIHV1aWQgXTsKCgkJCQlpZiAoIGluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWRlbGV0ZSBpbmRpY2VzQnlVVUlEWyB1dWlkIF07CgoJCQkJCWlmICggaW5kZXggPCBuQ2FjaGVkT2JqZWN0cyApIHsKCgkJCQkJCS8vIG9iamVjdCBpcyBjYWNoZWQsIHNocmluayB0aGUgQ0FDSEVEIHJlZ2lvbgoKCQkJCQkJdmFyIGZpcnN0QWN0aXZlSW5kZXggPSAtLSBuQ2FjaGVkT2JqZWN0cywKCQkJCQkJCWxhc3RDYWNoZWRPYmplY3QgPSBvYmplY3RzWyBmaXJzdEFjdGl2ZUluZGV4IF0sCgkJCQkJCQlsYXN0SW5kZXggPSAtLSBuT2JqZWN0cywKCQkJCQkJCWxhc3RPYmplY3QgPSBvYmplY3RzWyBsYXN0SW5kZXggXTsKCgkJCQkJCS8vIGxhc3QgY2FjaGVkIG9iamVjdCB0YWtlcyB0aGlzIG9iamVjdCdzIHBsYWNlCgkJCQkJCWluZGljZXNCeVVVSURbIGxhc3RDYWNoZWRPYmplY3QudXVpZCBdID0gaW5kZXg7CgkJCQkJCW9iamVjdHNbIGluZGV4IF0gPSBsYXN0Q2FjaGVkT2JqZWN0OwoKCQkJCQkJLy8gbGFzdCBvYmplY3QgZ29lcyB0byB0aGUgYWN0aXZhdGVkIHNsb3QgYW5kIHBvcAoJCQkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0T2JqZWN0LnV1aWQgXSA9IGZpcnN0QWN0aXZlSW5kZXg7CgkJCQkJCW9iamVjdHNbIGZpcnN0QWN0aXZlSW5kZXggXSA9IGxhc3RPYmplY3Q7CgkJCQkJCW9iamVjdHMucG9wKCk7CgoJCQkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJCQlmb3IgKCB2YXIgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCQkJdmFyIGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF0sCgkJCQkJCQkJbGFzdENhY2hlZCA9IGJpbmRpbmdzRm9yUGF0aFsgZmlyc3RBY3RpdmVJbmRleCBdLAoJCQkJCQkJCWxhc3QgPSBiaW5kaW5nc0ZvclBhdGhbIGxhc3RJbmRleCBdOwoKCQkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGxhc3RDYWNoZWQ7CgkJCQkJCQliaW5kaW5nc0ZvclBhdGhbIGZpcnN0QWN0aXZlSW5kZXggXSA9IGxhc3Q7CgkJCQkJCQliaW5kaW5nc0ZvclBhdGgucG9wKCk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBvYmplY3QgaXMgYWN0aXZlLCBqdXN0IHN3YXAgd2l0aCB0aGUgbGFzdCBhbmQgcG9wCgoJCQkJCQl2YXIgbGFzdEluZGV4ID0gLS0gbk9iamVjdHMsCgkJCQkJCQlsYXN0T2JqZWN0ID0gb2JqZWN0c1sgbGFzdEluZGV4IF07CgoJCQkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0T2JqZWN0LnV1aWQgXSA9IGluZGV4OwoJCQkJCQlvYmplY3RzWyBpbmRleCBdID0gbGFzdE9iamVjdDsKCQkJCQkJb2JqZWN0cy5wb3AoKTsKCgkJCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQkJCWZvciAoIHZhciBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCQl2YXIgYmluZGluZ3NGb3JQYXRoID0gYmluZGluZ3NbIGogXTsKCgkJCQkJCQliaW5kaW5nc0ZvclBhdGhbIGluZGV4IF0gPSBiaW5kaW5nc0ZvclBhdGhbIGxhc3RJbmRleCBdOwoJCQkJCQkJYmluZGluZ3NGb3JQYXRoLnBvcCgpOwoKCQkJCQkJfQoKCQkJCQl9IC8vIGNhY2hlZCBvciBhY3RpdmUKCgkJCQl9IC8vIGlmIG9iamVjdCBpcyBrbm93bgoKCQkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCQl0aGlzLm5DYWNoZWRPYmplY3RzXyA9IG5DYWNoZWRPYmplY3RzOwoKCQl9LAoKCQkvLyBJbnRlcm5hbCBpbnRlcmZhY2UgdXNlZCBieSBiZWZyaWVuZGVkIFByb3BlcnR5QmluZGluZy5Db21wb3NpdGU6CgoJCXN1YnNjcmliZV86IGZ1bmN0aW9uICggcGF0aCwgcGFyc2VkUGF0aCApIHsKCgkJCS8vIHJldHVybnMgYW4gYXJyYXkgb2YgYmluZGluZ3MgZm9yIHRoZSBnaXZlbiBwYXRoIHRoYXQgaXMgY2hhbmdlZAoJCQkvLyBhY2NvcmRpbmcgdG8gdGhlIGNvbnRhaW5lZCBvYmplY3RzIGluIHRoZSBncm91cAoKCQkJdmFyIGluZGljZXNCeVBhdGggPSB0aGlzLl9iaW5kaW5nc0luZGljZXNCeVBhdGgsCgkJCQlpbmRleCA9IGluZGljZXNCeVBhdGhbIHBhdGggXSwKCQkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCQlpZiAoIGluZGV4ICE9PSB1bmRlZmluZWQgKSByZXR1cm4gYmluZGluZ3NbIGluZGV4IF07CgoJCQl2YXIgcGF0aHMgPSB0aGlzLl9wYXRocywKCQkJCXBhcnNlZFBhdGhzID0gdGhpcy5fcGFyc2VkUGF0aHMsCgkJCQlvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJCW5PYmplY3RzID0gb2JqZWN0cy5sZW5ndGgsCgkJCQluQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfLAoJCQkJYmluZGluZ3NGb3JQYXRoID0gbmV3IEFycmF5KCBuT2JqZWN0cyApOwoKCQkJaW5kZXggPSBiaW5kaW5ncy5sZW5ndGg7CgoJCQlpbmRpY2VzQnlQYXRoWyBwYXRoIF0gPSBpbmRleDsKCgkJCXBhdGhzLnB1c2goIHBhdGggKTsKCQkJcGFyc2VkUGF0aHMucHVzaCggcGFyc2VkUGF0aCApOwoJCQliaW5kaW5ncy5wdXNoKCBiaW5kaW5nc0ZvclBhdGggKTsKCgkJCWZvciAoIHZhciBpID0gbkNhY2hlZE9iamVjdHMsIG4gPSBvYmplY3RzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQl2YXIgb2JqZWN0ID0gb2JqZWN0c1sgaSBdOwoJCQkJYmluZGluZ3NGb3JQYXRoWyBpIF0gPSBuZXcgUHJvcGVydHlCaW5kaW5nKCBvYmplY3QsIHBhdGgsIHBhcnNlZFBhdGggKTsKCgkJCX0KCgkJCXJldHVybiBiaW5kaW5nc0ZvclBhdGg7CgoJCX0sCgoJCXVuc3Vic2NyaWJlXzogZnVuY3Rpb24gKCBwYXRoICkgewoKCQkJLy8gdGVsbHMgdGhlIGdyb3VwIHRvIGZvcmdldCBhYm91dCBhIHByb3BlcnR5IHBhdGggYW5kIG5vIGxvbmdlcgoJCQkvLyB1cGRhdGUgdGhlIGFycmF5IHByZXZpb3VzbHkgb2J0YWluZWQgd2l0aCAnc3Vic2NyaWJlXycKCgkJCXZhciBpbmRpY2VzQnlQYXRoID0gdGhpcy5fYmluZGluZ3NJbmRpY2VzQnlQYXRoLAoJCQkJaW5kZXggPSBpbmRpY2VzQnlQYXRoWyBwYXRoIF07CgoJCQlpZiAoIGluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdmFyIHBhdGhzID0gdGhpcy5fcGF0aHMsCgkJCQkJcGFyc2VkUGF0aHMgPSB0aGlzLl9wYXJzZWRQYXRocywKCQkJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQkJCWxhc3RCaW5kaW5nc0luZGV4ID0gYmluZGluZ3MubGVuZ3RoIC0gMSwKCQkJCQlsYXN0QmluZGluZ3MgPSBiaW5kaW5nc1sgbGFzdEJpbmRpbmdzSW5kZXggXSwKCQkJCQlsYXN0QmluZGluZ3NQYXRoID0gcGF0aFsgbGFzdEJpbmRpbmdzSW5kZXggXTsKCgkJCQlpbmRpY2VzQnlQYXRoWyBsYXN0QmluZGluZ3NQYXRoIF0gPSBpbmRleDsKCgkJCQliaW5kaW5nc1sgaW5kZXggXSA9IGxhc3RCaW5kaW5nczsKCQkJCWJpbmRpbmdzLnBvcCgpOwoKCQkJCXBhcnNlZFBhdGhzWyBpbmRleCBdID0gcGFyc2VkUGF0aHNbIGxhc3RCaW5kaW5nc0luZGV4IF07CgkJCQlwYXJzZWRQYXRocy5wb3AoKTsKCgkJCQlwYXRoc1sgaW5kZXggXSA9IHBhdGhzWyBsYXN0QmluZGluZ3NJbmRleCBdOwoJCQkJcGF0aHMucG9wKCk7CgoJCQl9CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogQWN0aW9uIHByb3ZpZGVkIGJ5IEFuaW1hdGlvbk1peGVyIGZvciBzY2hlZHVsaW5nIGNsaXAgcGxheWJhY2sgb24gc3BlY2lmaWMKCSAqIG9iamVjdHMuCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICogQGF1dGhvciB0c2NodwoJICoKCSAqLwoKCWZ1bmN0aW9uIEFuaW1hdGlvbkFjdGlvbiggbWl4ZXIsIGNsaXAsIGxvY2FsUm9vdCApIHsKCgkJdGhpcy5fbWl4ZXIgPSBtaXhlcjsKCQl0aGlzLl9jbGlwID0gY2xpcDsKCQl0aGlzLl9sb2NhbFJvb3QgPSBsb2NhbFJvb3QgfHwgbnVsbDsKCgkJdmFyIHRyYWNrcyA9IGNsaXAudHJhY2tzLAoJCQluVHJhY2tzID0gdHJhY2tzLmxlbmd0aCwKCQkJaW50ZXJwb2xhbnRzID0gbmV3IEFycmF5KCBuVHJhY2tzICk7CgoJCXZhciBpbnRlcnBvbGFudFNldHRpbmdzID0gewoJCQllbmRpbmdTdGFydDogWmVyb0N1cnZhdHVyZUVuZGluZywKCQkJZW5kaW5nRW5kOiBaZXJvQ3VydmF0dXJlRW5kaW5nCgkJfTsKCgkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuVHJhY2tzOyArKyBpICkgewoKCQkJdmFyIGludGVycG9sYW50ID0gdHJhY2tzWyBpIF0uY3JlYXRlSW50ZXJwb2xhbnQoIG51bGwgKTsKCQkJaW50ZXJwb2xhbnRzWyBpIF0gPSBpbnRlcnBvbGFudDsKCQkJaW50ZXJwb2xhbnQuc2V0dGluZ3MgPSBpbnRlcnBvbGFudFNldHRpbmdzOwoKCQl9CgoJCXRoaXMuX2ludGVycG9sYW50U2V0dGluZ3MgPSBpbnRlcnBvbGFudFNldHRpbmdzOwoKCQl0aGlzLl9pbnRlcnBvbGFudHMgPSBpbnRlcnBvbGFudHM7IC8vIGJvdW5kIGJ5IHRoZSBtaXhlcgoKCQkvLyBpbnNpZGU6IFByb3BlcnR5TWl4ZXIgKG1hbmFnZWQgYnkgdGhlIG1peGVyKQoJCXRoaXMuX3Byb3BlcnR5QmluZGluZ3MgPSBuZXcgQXJyYXkoIG5UcmFja3MgKTsKCgkJdGhpcy5fY2FjaGVJbmRleCA9IG51bGw7IC8vIGZvciB0aGUgbWVtb3J5IG1hbmFnZXIKCQl0aGlzLl9ieUNsaXBDYWNoZUluZGV4ID0gbnVsbDsgLy8gZm9yIHRoZSBtZW1vcnkgbWFuYWdlcgoKCQl0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudCA9IG51bGw7CgkJdGhpcy5fd2VpZ2h0SW50ZXJwb2xhbnQgPSBudWxsOwoKCQl0aGlzLmxvb3AgPSBMb29wUmVwZWF0OwoJCXRoaXMuX2xvb3BDb3VudCA9IC0gMTsKCgkJLy8gZ2xvYmFsIG1peGVyIHRpbWUgd2hlbiB0aGUgYWN0aW9uIGlzIHRvIGJlIHN0YXJ0ZWQKCQkvLyBpdCdzIHNldCBiYWNrIHRvICdudWxsJyB1cG9uIHN0YXJ0IG9mIHRoZSBhY3Rpb24KCQl0aGlzLl9zdGFydFRpbWUgPSBudWxsOwoKCQkvLyBzY2FsZWQgbG9jYWwgdGltZSBvZiB0aGUgYWN0aW9uCgkJLy8gZ2V0cyBjbGFtcGVkIG9yIHdyYXBwZWQgdG8gMC4uY2xpcC5kdXJhdGlvbiBhY2NvcmRpbmcgdG8gbG9vcAoJCXRoaXMudGltZSA9IDA7CgoJCXRoaXMudGltZVNjYWxlID0gMTsKCQl0aGlzLl9lZmZlY3RpdmVUaW1lU2NhbGUgPSAxOwoKCQl0aGlzLndlaWdodCA9IDE7CgkJdGhpcy5fZWZmZWN0aXZlV2VpZ2h0ID0gMTsKCgkJdGhpcy5yZXBldGl0aW9ucyA9IEluZmluaXR5OyAvLyBuby4gb2YgcmVwZXRpdGlvbnMgd2hlbiBsb29waW5nCgoJCXRoaXMucGF1c2VkID0gZmFsc2U7IC8vIHRydWUgLT4gemVybyBlZmZlY3RpdmUgdGltZSBzY2FsZQoJCXRoaXMuZW5hYmxlZCA9IHRydWU7IC8vIGZhbHNlIC0+IHplcm8gZWZmZWN0aXZlIHdlaWdodAoKCQl0aGlzLmNsYW1wV2hlbkZpbmlzaGVkID0gZmFsc2U7Ly8ga2VlcCBmZWVkaW5nIHRoZSBsYXN0IGZyYW1lPwoKCQl0aGlzLnplcm9TbG9wZUF0U3RhcnQgPSB0cnVlOy8vIGZvciBzbW9vdGggaW50ZXJwb2xhdGlvbiB3L28gc2VwYXJhdGUKCQl0aGlzLnplcm9TbG9wZUF0RW5kID0gdHJ1ZTsvLyBjbGlwcyBmb3Igc3RhcnQsIGxvb3AgYW5kIGVuZAoKCX0KCglPYmplY3QuYXNzaWduKCBBbmltYXRpb25BY3Rpb24ucHJvdG90eXBlLCB7CgoJCS8vIFN0YXRlICYgU2NoZWR1bGluZwoKCQlwbGF5OiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLl9taXhlci5fYWN0aXZhdGVBY3Rpb24oIHRoaXMgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzdG9wOiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLl9taXhlci5fZGVhY3RpdmF0ZUFjdGlvbiggdGhpcyApOwoKCQkJcmV0dXJuIHRoaXMucmVzZXQoKTsKCgkJfSwKCgkJcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMucGF1c2VkID0gZmFsc2U7CgkJCXRoaXMuZW5hYmxlZCA9IHRydWU7CgoJCQl0aGlzLnRpbWUgPSAwOyAvLyByZXN0YXJ0IGNsaXAKCQkJdGhpcy5fbG9vcENvdW50ID0gLSAxOy8vIGZvcmdldCBwcmV2aW91cyBsb29wcwoJCQl0aGlzLl9zdGFydFRpbWUgPSBudWxsOy8vIGZvcmdldCBzY2hlZHVsaW5nCgoJCQlyZXR1cm4gdGhpcy5zdG9wRmFkaW5nKCkuc3RvcFdhcnBpbmcoKTsKCgkJfSwKCgkJaXNSdW5uaW5nOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5lbmFibGVkICYmICEgdGhpcy5wYXVzZWQgJiYgdGhpcy50aW1lU2NhbGUgIT09IDAgJiYKCQkJCXRoaXMuX3N0YXJ0VGltZSA9PT0gbnVsbCAmJiB0aGlzLl9taXhlci5faXNBY3RpdmVBY3Rpb24oIHRoaXMgKTsKCgkJfSwKCgkJLy8gcmV0dXJuIHRydWUgd2hlbiBwbGF5IGhhcyBiZWVuIGNhbGxlZAoJCWlzU2NoZWR1bGVkOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5fbWl4ZXIuX2lzQWN0aXZlQWN0aW9uKCB0aGlzICk7CgoJCX0sCgoJCXN0YXJ0QXQ6IGZ1bmN0aW9uICggdGltZSApIHsKCgkJCXRoaXMuX3N0YXJ0VGltZSA9IHRpbWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0TG9vcDogZnVuY3Rpb24gKCBtb2RlLCByZXBldGl0aW9ucyApIHsKCgkJCXRoaXMubG9vcCA9IG1vZGU7CgkJCXRoaXMucmVwZXRpdGlvbnMgPSByZXBldGl0aW9uczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQkvLyBXZWlnaHQKCgkJLy8gc2V0IHRoZSB3ZWlnaHQgc3RvcHBpbmcgYW55IHNjaGVkdWxlZCBmYWRpbmcKCQkvLyBhbHRob3VnaCAuZW5hYmxlZCA9IGZhbHNlIHlpZWxkcyBhbiBlZmZlY3RpdmUgd2VpZ2h0IG9mIHplcm8sIHRoaXMKCQkvLyBtZXRob2QgZG9lcyAqbm90KiBjaGFuZ2UgLmVuYWJsZWQsIGJlY2F1c2UgaXQgd291bGQgYmUgY29uZnVzaW5nCgkJc2V0RWZmZWN0aXZlV2VpZ2h0OiBmdW5jdGlvbiAoIHdlaWdodCApIHsKCgkJCXRoaXMud2VpZ2h0ID0gd2VpZ2h0OwoKCQkJLy8gbm90ZTogc2FtZSBsb2dpYyBhcyB3aGVuIHVwZGF0ZWQgYXQgcnVudGltZQoJCQl0aGlzLl9lZmZlY3RpdmVXZWlnaHQgPSB0aGlzLmVuYWJsZWQgPyB3ZWlnaHQgOiAwOwoKCQkJcmV0dXJuIHRoaXMuc3RvcEZhZGluZygpOwoKCQl9LAoKCQkvLyByZXR1cm4gdGhlIHdlaWdodCBjb25zaWRlcmluZyBmYWRpbmcgYW5kIC5lbmFibGVkCgkJZ2V0RWZmZWN0aXZlV2VpZ2h0OiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5fZWZmZWN0aXZlV2VpZ2h0OwoKCQl9LAoKCQlmYWRlSW46IGZ1bmN0aW9uICggZHVyYXRpb24gKSB7CgoJCQlyZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoIGR1cmF0aW9uLCAwLCAxICk7CgoJCX0sCgoJCWZhZGVPdXQ6IGZ1bmN0aW9uICggZHVyYXRpb24gKSB7CgoJCQlyZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoIGR1cmF0aW9uLCAxLCAwICk7CgoJCX0sCgoJCWNyb3NzRmFkZUZyb206IGZ1bmN0aW9uICggZmFkZU91dEFjdGlvbiwgZHVyYXRpb24sIHdhcnAgKSB7CgoJCQlmYWRlT3V0QWN0aW9uLmZhZGVPdXQoIGR1cmF0aW9uICk7CgkJCXRoaXMuZmFkZUluKCBkdXJhdGlvbiApOwoKCQkJaWYgKCB3YXJwICkgewoKCQkJCXZhciBmYWRlSW5EdXJhdGlvbiA9IHRoaXMuX2NsaXAuZHVyYXRpb24sCgkJCQkJZmFkZU91dER1cmF0aW9uID0gZmFkZU91dEFjdGlvbi5fY2xpcC5kdXJhdGlvbiwKCgkJCQkJc3RhcnRFbmRSYXRpbyA9IGZhZGVPdXREdXJhdGlvbiAvIGZhZGVJbkR1cmF0aW9uLAoJCQkJCWVuZFN0YXJ0UmF0aW8gPSBmYWRlSW5EdXJhdGlvbiAvIGZhZGVPdXREdXJhdGlvbjsKCgkJCQlmYWRlT3V0QWN0aW9uLndhcnAoIDEuMCwgc3RhcnRFbmRSYXRpbywgZHVyYXRpb24gKTsKCQkJCXRoaXMud2FycCggZW5kU3RhcnRSYXRpbywgMS4wLCBkdXJhdGlvbiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNyb3NzRmFkZVRvOiBmdW5jdGlvbiAoIGZhZGVJbkFjdGlvbiwgZHVyYXRpb24sIHdhcnAgKSB7CgoJCQlyZXR1cm4gZmFkZUluQWN0aW9uLmNyb3NzRmFkZUZyb20oIHRoaXMsIGR1cmF0aW9uLCB3YXJwICk7CgoJCX0sCgoJCXN0b3BGYWRpbmc6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB3ZWlnaHRJbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwoKCQkJaWYgKCB3ZWlnaHRJbnRlcnBvbGFudCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IG51bGw7CgkJCQl0aGlzLl9taXhlci5fdGFrZUJhY2tDb250cm9sSW50ZXJwb2xhbnQoIHdlaWdodEludGVycG9sYW50ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJLy8gVGltZSBTY2FsZSBDb250cm9sCgoJCS8vIHNldCB0aGUgdGltZSBzY2FsZSBzdG9wcGluZyBhbnkgc2NoZWR1bGVkIHdhcnBpbmcKCQkvLyBhbHRob3VnaCAucGF1c2VkID0gdHJ1ZSB5aWVsZHMgYW4gZWZmZWN0aXZlIHRpbWUgc2NhbGUgb2YgemVybywgdGhpcwoJCS8vIG1ldGhvZCBkb2VzICpub3QqIGNoYW5nZSAucGF1c2VkLCBiZWNhdXNlIGl0IHdvdWxkIGJlIGNvbmZ1c2luZwoJCXNldEVmZmVjdGl2ZVRpbWVTY2FsZTogZnVuY3Rpb24gKCB0aW1lU2NhbGUgKSB7CgoJCQl0aGlzLnRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKCQkJdGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlID0gdGhpcy5wYXVzZWQgPyAwIDogdGltZVNjYWxlOwoKCQkJcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKCgkJfSwKCgkJLy8gcmV0dXJuIHRoZSB0aW1lIHNjYWxlIGNvbnNpZGVyaW5nIHdhcnBpbmcgYW5kIC5wYXVzZWQKCQlnZXRFZmZlY3RpdmVUaW1lU2NhbGU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLl9lZmZlY3RpdmVUaW1lU2NhbGU7CgoJCX0sCgoJCXNldER1cmF0aW9uOiBmdW5jdGlvbiAoIGR1cmF0aW9uICkgewoKCQkJdGhpcy50aW1lU2NhbGUgPSB0aGlzLl9jbGlwLmR1cmF0aW9uIC8gZHVyYXRpb247CgoJCQlyZXR1cm4gdGhpcy5zdG9wV2FycGluZygpOwoKCQl9LAoKCQlzeW5jV2l0aDogZnVuY3Rpb24gKCBhY3Rpb24gKSB7CgoJCQl0aGlzLnRpbWUgPSBhY3Rpb24udGltZTsKCQkJdGhpcy50aW1lU2NhbGUgPSBhY3Rpb24udGltZVNjYWxlOwoKCQkJcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKCgkJfSwKCgkJaGFsdDogZnVuY3Rpb24gKCBkdXJhdGlvbiApIHsKCgkJCXJldHVybiB0aGlzLndhcnAoIHRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSwgMCwgZHVyYXRpb24gKTsKCgkJfSwKCgkJd2FycDogZnVuY3Rpb24gKCBzdGFydFRpbWVTY2FsZSwgZW5kVGltZVNjYWxlLCBkdXJhdGlvbiApIHsKCgkJCXZhciBtaXhlciA9IHRoaXMuX21peGVyLCBub3cgPSBtaXhlci50aW1lLAoJCQkJaW50ZXJwb2xhbnQgPSB0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudCwKCgkJCQl0aW1lU2NhbGUgPSB0aGlzLnRpbWVTY2FsZTsKCgkJCWlmICggaW50ZXJwb2xhbnQgPT09IG51bGwgKSB7CgoJCQkJaW50ZXJwb2xhbnQgPSBtaXhlci5fbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpOwoJCQkJdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQgPSBpbnRlcnBvbGFudDsKCgkJCX0KCgkJCXZhciB0aW1lcyA9IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9ucywKCQkJCXZhbHVlcyA9IGludGVycG9sYW50LnNhbXBsZVZhbHVlczsKCgkJCXRpbWVzWyAwIF0gPSBub3c7CgkJCXRpbWVzWyAxIF0gPSBub3cgKyBkdXJhdGlvbjsKCgkJCXZhbHVlc1sgMCBdID0gc3RhcnRUaW1lU2NhbGUgLyB0aW1lU2NhbGU7CgkJCXZhbHVlc1sgMSBdID0gZW5kVGltZVNjYWxlIC8gdGltZVNjYWxlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXN0b3BXYXJwaW5nOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgdGltZVNjYWxlSW50ZXJwb2xhbnQgPSB0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudDsKCgkJCWlmICggdGltZVNjYWxlSW50ZXJwb2xhbnQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQgPSBudWxsOwoJCQkJdGhpcy5fbWl4ZXIuX3Rha2VCYWNrQ29udHJvbEludGVycG9sYW50KCB0aW1lU2NhbGVJbnRlcnBvbGFudCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCS8vIE9iamVjdCBBY2Nlc3NvcnMKCgkJZ2V0TWl4ZXI6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLl9taXhlcjsKCgkJfSwKCgkJZ2V0Q2xpcDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuX2NsaXA7CgoJCX0sCgoJCWdldFJvb3Q6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLl9sb2NhbFJvb3QgfHwgdGhpcy5fbWl4ZXIuX3Jvb3Q7CgoJCX0sCgoJCS8vIEludGVybmEKCgkJX3VwZGF0ZTogZnVuY3Rpb24gKCB0aW1lLCBkZWx0YVRpbWUsIHRpbWVEaXJlY3Rpb24sIGFjY3VJbmRleCApIHsKCgkJCS8vIGNhbGxlZCBieSB0aGUgbWl4ZXIKCgkJCWlmICggISB0aGlzLmVuYWJsZWQgKSB7CgoJCQkJLy8gY2FsbCAuX3VwZGF0ZVdlaWdodCgpIHRvIHVwZGF0ZSAuX2VmZmVjdGl2ZVdlaWdodAoKCQkJCXRoaXMuX3VwZGF0ZVdlaWdodCggdGltZSApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJdmFyIHN0YXJ0VGltZSA9IHRoaXMuX3N0YXJ0VGltZTsKCgkJCWlmICggc3RhcnRUaW1lICE9PSBudWxsICkgewoKCQkJCS8vIGNoZWNrIGZvciBzY2hlZHVsZWQgc3RhcnQgb2YgYWN0aW9uCgoJCQkJdmFyIHRpbWVSdW5uaW5nID0gKCB0aW1lIC0gc3RhcnRUaW1lICkgKiB0aW1lRGlyZWN0aW9uOwoJCQkJaWYgKCB0aW1lUnVubmluZyA8IDAgfHwgdGltZURpcmVjdGlvbiA9PT0gMCApIHsKCgkJCQkJcmV0dXJuOyAvLyB5ZXQgdG8gY29tZSAvIGRvbid0IGRlY2lkZSB3aGVuIGRlbHRhID0gMAoKCQkJCX0KCgkJCQkvLyBzdGFydAoKCQkJCXRoaXMuX3N0YXJ0VGltZSA9IG51bGw7IC8vIHVuc2NoZWR1bGUKCQkJCWRlbHRhVGltZSA9IHRpbWVEaXJlY3Rpb24gKiB0aW1lUnVubmluZzsKCgkJCX0KCgkJCS8vIGFwcGx5IHRpbWUgc2NhbGUgYW5kIGFkdmFuY2UgdGltZQoKCQkJZGVsdGFUaW1lICo9IHRoaXMuX3VwZGF0ZVRpbWVTY2FsZSggdGltZSApOwoJCQl2YXIgY2xpcFRpbWUgPSB0aGlzLl91cGRhdGVUaW1lKCBkZWx0YVRpbWUgKTsKCgkJCS8vIG5vdGU6IF91cGRhdGVUaW1lIG1heSBkaXNhYmxlIHRoZSBhY3Rpb24gcmVzdWx0aW5nIGluCgkJCS8vIGFuIGVmZmVjdGl2ZSB3ZWlnaHQgb2YgMAoKCQkJdmFyIHdlaWdodCA9IHRoaXMuX3VwZGF0ZVdlaWdodCggdGltZSApOwoKCQkJaWYgKCB3ZWlnaHQgPiAwICkgewoKCQkJCXZhciBpbnRlcnBvbGFudHMgPSB0aGlzLl9pbnRlcnBvbGFudHM7CgkJCQl2YXIgcHJvcGVydHlNaXhlcnMgPSB0aGlzLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQkJCWZvciAoIHZhciBqID0gMCwgbSA9IGludGVycG9sYW50cy5sZW5ndGg7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCWludGVycG9sYW50c1sgaiBdLmV2YWx1YXRlKCBjbGlwVGltZSApOwoJCQkJCXByb3BlcnR5TWl4ZXJzWyBqIF0uYWNjdW11bGF0ZSggYWNjdUluZGV4LCB3ZWlnaHQgKTsKCgkJCQl9CgoJCQl9CgoJCX0sCgoJCV91cGRhdGVXZWlnaHQ6IGZ1bmN0aW9uICggdGltZSApIHsKCgkJCXZhciB3ZWlnaHQgPSAwOwoKCQkJaWYgKCB0aGlzLmVuYWJsZWQgKSB7CgoJCQkJd2VpZ2h0ID0gdGhpcy53ZWlnaHQ7CgkJCQl2YXIgaW50ZXJwb2xhbnQgPSB0aGlzLl93ZWlnaHRJbnRlcnBvbGFudDsKCgkJCQlpZiAoIGludGVycG9sYW50ICE9PSBudWxsICkgewoKCQkJCQl2YXIgaW50ZXJwb2xhbnRWYWx1ZSA9IGludGVycG9sYW50LmV2YWx1YXRlKCB0aW1lIClbIDAgXTsKCgkJCQkJd2VpZ2h0ICo9IGludGVycG9sYW50VmFsdWU7CgoJCQkJCWlmICggdGltZSA+IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9uc1sgMSBdICkgewoKCQkJCQkJdGhpcy5zdG9wRmFkaW5nKCk7CgoJCQkJCQlpZiAoIGludGVycG9sYW50VmFsdWUgPT09IDAgKSB7CgoJCQkJCQkJLy8gZmFkZWQgb3V0LCBkaXNhYmxlCgkJCQkJCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IHdlaWdodDsKCQkJcmV0dXJuIHdlaWdodDsKCgkJfSwKCgkJX3VwZGF0ZVRpbWVTY2FsZTogZnVuY3Rpb24gKCB0aW1lICkgewoKCQkJdmFyIHRpbWVTY2FsZSA9IDA7CgoJCQlpZiAoICEgdGhpcy5wYXVzZWQgKSB7CgoJCQkJdGltZVNjYWxlID0gdGhpcy50aW1lU2NhbGU7CgoJCQkJdmFyIGludGVycG9sYW50ID0gdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQ7CgoJCQkJaWYgKCBpbnRlcnBvbGFudCAhPT0gbnVsbCApIHsKCgkJCQkJdmFyIGludGVycG9sYW50VmFsdWUgPSBpbnRlcnBvbGFudC5ldmFsdWF0ZSggdGltZSApWyAwIF07CgoJCQkJCXRpbWVTY2FsZSAqPSBpbnRlcnBvbGFudFZhbHVlOwoKCQkJCQlpZiAoIHRpbWUgPiBpbnRlcnBvbGFudC5wYXJhbWV0ZXJQb3NpdGlvbnNbIDEgXSApIHsKCgkJCQkJCXRoaXMuc3RvcFdhcnBpbmcoKTsKCgkJCQkJCWlmICggdGltZVNjYWxlID09PSAwICkgewoKCQkJCQkJCS8vIG1vdGlvbiBoYXMgaGFsdGVkLCBwYXVzZQoJCQkJCQkJdGhpcy5wYXVzZWQgPSB0cnVlOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyB3YXJwIGRvbmUgLSBhcHBseSBmaW5hbCB0aW1lIHNjYWxlCgkJCQkJCQl0aGlzLnRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKCQkJcmV0dXJuIHRpbWVTY2FsZTsKCgkJfSwKCgkJX3VwZGF0ZVRpbWU6IGZ1bmN0aW9uICggZGVsdGFUaW1lICkgewoKCQkJdmFyIHRpbWUgPSB0aGlzLnRpbWUgKyBkZWx0YVRpbWU7CgkJCXZhciBkdXJhdGlvbiA9IHRoaXMuX2NsaXAuZHVyYXRpb247CgkJCXZhciBsb29wID0gdGhpcy5sb29wOwoJCQl2YXIgbG9vcENvdW50ID0gdGhpcy5fbG9vcENvdW50OwoKCQkJdmFyIHBpbmdQb25nID0gKCBsb29wID09PSBMb29wUGluZ1BvbmcgKTsKCgkJCWlmICggZGVsdGFUaW1lID09PSAwICkgewoKCQkJCWlmICggbG9vcENvdW50ID09PSAtIDEgKSByZXR1cm4gdGltZTsKCgkJCQlyZXR1cm4gKCBwaW5nUG9uZyAmJiAoIGxvb3BDb3VudCAmIDEgKSA9PT0gMSApID8gZHVyYXRpb24gLSB0aW1lIDogdGltZTsKCgkJCX0KCgkJCWlmICggbG9vcCA9PT0gTG9vcE9uY2UgKSB7CgoJCQkJaWYgKCBsb29wQ291bnQgPT09IC0gMSApIHsKCgkJCQkJLy8ganVzdCBzdGFydGVkCgoJCQkJCXRoaXMuX2xvb3BDb3VudCA9IDA7CgkJCQkJdGhpcy5fc2V0RW5kaW5ncyggdHJ1ZSwgdHJ1ZSwgZmFsc2UgKTsKCgkJCQl9CgoJCQkJaGFuZGxlX3N0b3A6IHsKCgkJCQkJaWYgKCB0aW1lID49IGR1cmF0aW9uICkgewoKCQkJCQkJdGltZSA9IGR1cmF0aW9uOwoKCQkJCQl9IGVsc2UgaWYgKCB0aW1lIDwgMCApIHsKCgkJCQkJCXRpbWUgPSAwOwoKCQkJCQl9IGVsc2UgYnJlYWsgaGFuZGxlX3N0b3A7CgoJCQkJCWlmICggdGhpcy5jbGFtcFdoZW5GaW5pc2hlZCApIHRoaXMucGF1c2VkID0gdHJ1ZTsKCQkJCQllbHNlIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQkJCQl0aGlzLl9taXhlci5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJCXR5cGU6ICdmaW5pc2hlZCcsIGFjdGlvbjogdGhpcywKCQkJCQkJZGlyZWN0aW9uOiBkZWx0YVRpbWUgPCAwID8gLSAxIDogMQoJCQkJCX0gKTsKCgkJCQl9CgoJCQl9IGVsc2UgeyAvLyByZXBldGl0aXZlIFJlcGVhdCBvciBQaW5nUG9uZwoKCQkJCWlmICggbG9vcENvdW50ID09PSAtIDEgKSB7CgoJCQkJCS8vIGp1c3Qgc3RhcnRlZAoKCQkJCQlpZiAoIGRlbHRhVGltZSA+PSAwICkgewoKCQkJCQkJbG9vcENvdW50ID0gMDsKCgkJCQkJCXRoaXMuX3NldEVuZGluZ3MoIHRydWUsIHRoaXMucmVwZXRpdGlvbnMgPT09IDAsIHBpbmdQb25nICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyB3aGVuIGxvb3BpbmcgaW4gcmV2ZXJzZSBkaXJlY3Rpb24sIHRoZSBpbml0aWFsCgkJCQkJCS8vIHRyYW5zaXRpb24gdGhyb3VnaCB6ZXJvIGNvdW50cyBhcyBhIHJlcGV0aXRpb24sCgkJCQkJCS8vIHNvIGxlYXZlIGxvb3BDb3VudCBhdCAtMQoKCQkJCQkJdGhpcy5fc2V0RW5kaW5ncyggdGhpcy5yZXBldGl0aW9ucyA9PT0gMCwgdHJ1ZSwgcGluZ1BvbmcgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHRpbWUgPj0gZHVyYXRpb24gfHwgdGltZSA8IDAgKSB7CgoJCQkJCS8vIHdyYXAgYXJvdW5kCgoJCQkJCXZhciBsb29wRGVsdGEgPSBNYXRoLmZsb29yKCB0aW1lIC8gZHVyYXRpb24gKTsgLy8gc2lnbmVkCgkJCQkJdGltZSAtPSBkdXJhdGlvbiAqIGxvb3BEZWx0YTsKCgkJCQkJbG9vcENvdW50ICs9IE1hdGguYWJzKCBsb29wRGVsdGEgKTsKCgkJCQkJdmFyIHBlbmRpbmcgPSB0aGlzLnJlcGV0aXRpb25zIC0gbG9vcENvdW50OwoKCQkJCQlpZiAoIHBlbmRpbmcgPD0gMCApIHsKCgkJCQkJCS8vIGhhdmUgdG8gc3RvcCAoc3dpdGNoIHN0YXRlLCBjbGFtcCB0aW1lLCBmaXJlIGV2ZW50KQoKCQkJCQkJaWYgKCB0aGlzLmNsYW1wV2hlbkZpbmlzaGVkICkgdGhpcy5wYXVzZWQgPSB0cnVlOwoJCQkJCQllbHNlIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQkJCQkJdGltZSA9IGRlbHRhVGltZSA+IDAgPyBkdXJhdGlvbiA6IDA7CgoJCQkJCQl0aGlzLl9taXhlci5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJCQl0eXBlOiAnZmluaXNoZWQnLCBhY3Rpb246IHRoaXMsCgkJCQkJCQlkaXJlY3Rpb246IGRlbHRhVGltZSA+IDAgPyAxIDogLSAxCgkJCQkJCX0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGtlZXAgcnVubmluZwoKCQkJCQkJaWYgKCBwZW5kaW5nID09PSAxICkgewoKCQkJCQkJCS8vIGVudGVyaW5nIHRoZSBsYXN0IHJvdW5kCgoJCQkJCQkJdmFyIGF0U3RhcnQgPSBkZWx0YVRpbWUgPCAwOwoJCQkJCQkJdGhpcy5fc2V0RW5kaW5ncyggYXRTdGFydCwgISBhdFN0YXJ0LCBwaW5nUG9uZyApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl0aGlzLl9zZXRFbmRpbmdzKCBmYWxzZSwgZmFsc2UsIHBpbmdQb25nICk7CgoJCQkJCQl9CgoJCQkJCQl0aGlzLl9sb29wQ291bnQgPSBsb29wQ291bnQ7CgoJCQkJCQl0aGlzLl9taXhlci5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJCQl0eXBlOiAnbG9vcCcsIGFjdGlvbjogdGhpcywgbG9vcERlbHRhOiBsb29wRGVsdGEKCQkJCQkJfSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggcGluZ1BvbmcgJiYgKCBsb29wQ291bnQgJiAxICkgPT09IDEgKSB7CgoJCQkJCS8vIGludmVydCB0aW1lIGZvciB0aGUgInBvbmcgcm91bmQiCgoJCQkJCXRoaXMudGltZSA9IHRpbWU7CgkJCQkJcmV0dXJuIGR1cmF0aW9uIC0gdGltZTsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLnRpbWUgPSB0aW1lOwoJCQlyZXR1cm4gdGltZTsKCgkJfSwKCgkJX3NldEVuZGluZ3M6IGZ1bmN0aW9uICggYXRTdGFydCwgYXRFbmQsIHBpbmdQb25nICkgewoKCQkJdmFyIHNldHRpbmdzID0gdGhpcy5faW50ZXJwb2xhbnRTZXR0aW5nczsKCgkJCWlmICggcGluZ1BvbmcgKSB7CgoJCQkJc2V0dGluZ3MuZW5kaW5nU3RhcnQgPSBaZXJvU2xvcGVFbmRpbmc7CgkJCQlzZXR0aW5ncy5lbmRpbmdFbmQgPSBaZXJvU2xvcGVFbmRpbmc7CgoJCQl9IGVsc2UgewoKCQkJCS8vIGFzc3VtaW5nIGZvciBMb29wT25jZSBhdFN0YXJ0ID09IGF0RW5kID09IHRydWUKCgkJCQlpZiAoIGF0U3RhcnQgKSB7CgoJCQkJCXNldHRpbmdzLmVuZGluZ1N0YXJ0ID0gdGhpcy56ZXJvU2xvcGVBdFN0YXJ0ID8gWmVyb1Nsb3BlRW5kaW5nIDogWmVyb0N1cnZhdHVyZUVuZGluZzsKCgkJCQl9IGVsc2UgewoKCQkJCQlzZXR0aW5ncy5lbmRpbmdTdGFydCA9IFdyYXBBcm91bmRFbmRpbmc7CgoJCQkJfQoKCQkJCWlmICggYXRFbmQgKSB7CgoJCQkJCXNldHRpbmdzLmVuZGluZ0VuZCA9IHRoaXMuemVyb1Nsb3BlQXRFbmQgPyBaZXJvU2xvcGVFbmRpbmcgOiBaZXJvQ3VydmF0dXJlRW5kaW5nOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXNldHRpbmdzLmVuZGluZ0VuZCAJID0gV3JhcEFyb3VuZEVuZGluZzsKCgkJCQl9CgoJCQl9CgoJCX0sCgoJCV9zY2hlZHVsZUZhZGluZzogZnVuY3Rpb24gKCBkdXJhdGlvbiwgd2VpZ2h0Tm93LCB3ZWlnaHRUaGVuICkgewoKCQkJdmFyIG1peGVyID0gdGhpcy5fbWl4ZXIsIG5vdyA9IG1peGVyLnRpbWUsCgkJCQlpbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwoKCQkJaWYgKCBpbnRlcnBvbGFudCA9PT0gbnVsbCApIHsKCgkJCQlpbnRlcnBvbGFudCA9IG1peGVyLl9sZW5kQ29udHJvbEludGVycG9sYW50KCk7CgkJCQl0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IGludGVycG9sYW50OwoKCQkJfQoKCQkJdmFyIHRpbWVzID0gaW50ZXJwb2xhbnQucGFyYW1ldGVyUG9zaXRpb25zLAoJCQkJdmFsdWVzID0gaW50ZXJwb2xhbnQuc2FtcGxlVmFsdWVzOwoKCQkJdGltZXNbIDAgXSA9IG5vdzsKCQkJdmFsdWVzWyAwIF0gPSB3ZWlnaHROb3c7CgkJCXRpbWVzWyAxIF0gPSBub3cgKyBkdXJhdGlvbjsKCQkJdmFsdWVzWyAxIF0gPSB3ZWlnaHRUaGVuOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKgoJICogUGxheWVyIGZvciBBbmltYXRpb25DbGlwcy4KCSAqCgkgKgoJICogQGF1dGhvciBCZW4gSG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pby8KCSAqIEBhdXRob3IgRGF2aWQgU2Fybm8gLyBodHRwOi8vbGlnaHRoYXVzLnVzLwoJICogQGF1dGhvciB0c2NodwoJICovCgoJZnVuY3Rpb24gQW5pbWF0aW9uTWl4ZXIoIHJvb3QgKSB7CgoJCXRoaXMuX3Jvb3QgPSByb290OwoJCXRoaXMuX2luaXRNZW1vcnlNYW5hZ2VyKCk7CgkJdGhpcy5fYWNjdUluZGV4ID0gMDsKCgkJdGhpcy50aW1lID0gMDsKCgkJdGhpcy50aW1lU2NhbGUgPSAxLjA7CgoJfQoKCUFuaW1hdGlvbk1peGVyLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUgKSwgewoKCQljb25zdHJ1Y3RvcjogQW5pbWF0aW9uTWl4ZXIsCgoJCV9iaW5kQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiwgcHJvdG90eXBlQWN0aW9uICkgewoKCQkJdmFyIHJvb3QgPSBhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290LAoJCQkJdHJhY2tzID0gYWN0aW9uLl9jbGlwLnRyYWNrcywKCQkJCW5UcmFja3MgPSB0cmFja3MubGVuZ3RoLAoJCQkJYmluZGluZ3MgPSBhY3Rpb24uX3Byb3BlcnR5QmluZGluZ3MsCgkJCQlpbnRlcnBvbGFudHMgPSBhY3Rpb24uX2ludGVycG9sYW50cywKCQkJCXJvb3RVdWlkID0gcm9vdC51dWlkLAoJCQkJYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsCgkJCQliaW5kaW5nc0J5TmFtZSA9IGJpbmRpbmdzQnlSb290WyByb290VXVpZCBdOwoKCQkJaWYgKCBiaW5kaW5nc0J5TmFtZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWJpbmRpbmdzQnlOYW1lID0ge307CgkJCQliaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXSA9IGJpbmRpbmdzQnlOYW1lOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuVHJhY2tzOyArKyBpICkgewoKCQkJCXZhciB0cmFjayA9IHRyYWNrc1sgaSBdLAoJCQkJCXRyYWNrTmFtZSA9IHRyYWNrLm5hbWUsCgkJCQkJYmluZGluZyA9IGJpbmRpbmdzQnlOYW1lWyB0cmFja05hbWUgXTsKCgkJCQlpZiAoIGJpbmRpbmcgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJYmluZGluZ3NbIGkgXSA9IGJpbmRpbmc7CgoJCQkJfSBlbHNlIHsKCgkJCQkJYmluZGluZyA9IGJpbmRpbmdzWyBpIF07CgoJCQkJCWlmICggYmluZGluZyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gZXhpc3RpbmcgYmluZGluZywgbWFrZSBzdXJlIHRoZSBjYWNoZSBrbm93cwoKCQkJCQkJaWYgKCBiaW5kaW5nLl9jYWNoZUluZGV4ID09PSBudWxsICkgewoKCQkJCQkJCSsrIGJpbmRpbmcucmVmZXJlbmNlQ291bnQ7CgkJCQkJCQl0aGlzLl9hZGRJbmFjdGl2ZUJpbmRpbmcoIGJpbmRpbmcsIHJvb3RVdWlkLCB0cmFja05hbWUgKTsKCgkJCQkJCX0KCgkJCQkJCWNvbnRpbnVlOwoKCQkJCQl9CgoJCQkJCXZhciBwYXRoID0gcHJvdG90eXBlQWN0aW9uICYmIHByb3RvdHlwZUFjdGlvbi4KCQkJCQkJX3Byb3BlcnR5QmluZGluZ3NbIGkgXS5iaW5kaW5nLnBhcnNlZFBhdGg7CgoJCQkJCWJpbmRpbmcgPSBuZXcgUHJvcGVydHlNaXhlcigKCQkJCQkJUHJvcGVydHlCaW5kaW5nLmNyZWF0ZSggcm9vdCwgdHJhY2tOYW1lLCBwYXRoICksCgkJCQkJCXRyYWNrLlZhbHVlVHlwZU5hbWUsIHRyYWNrLmdldFZhbHVlU2l6ZSgpICk7CgoJCQkJCSsrIGJpbmRpbmcucmVmZXJlbmNlQ291bnQ7CgkJCQkJdGhpcy5fYWRkSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nLCByb290VXVpZCwgdHJhY2tOYW1lICk7CgoJCQkJCWJpbmRpbmdzWyBpIF0gPSBiaW5kaW5nOwoKCQkJCX0KCgkJCQlpbnRlcnBvbGFudHNbIGkgXS5yZXN1bHRCdWZmZXIgPSBiaW5kaW5nLmJ1ZmZlcjsKCgkJCX0KCgkJfSwKCgkJX2FjdGl2YXRlQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiApIHsKCgkJCWlmICggISB0aGlzLl9pc0FjdGl2ZUFjdGlvbiggYWN0aW9uICkgKSB7CgoJCQkJaWYgKCBhY3Rpb24uX2NhY2hlSW5kZXggPT09IG51bGwgKSB7CgoJCQkJCS8vIHRoaXMgYWN0aW9uIGhhcyBiZWVuIGZvcmdvdHRlbiBieSB0aGUgY2FjaGUsIGJ1dCB0aGUgdXNlcgoJCQkJCS8vIGFwcGVhcnMgdG8gYmUgc3RpbGwgdXNpbmcgaXQgLT4gcmViaW5kCgoJCQkJCXZhciByb290VXVpZCA9ICggYWN0aW9uLl9sb2NhbFJvb3QgfHwgdGhpcy5fcm9vdCApLnV1aWQsCgkJCQkJCWNsaXBVdWlkID0gYWN0aW9uLl9jbGlwLnV1aWQsCgkJCQkJCWFjdGlvbnNGb3JDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJCQkJdGhpcy5fYmluZEFjdGlvbiggYWN0aW9uLAoJCQkJCQlhY3Rpb25zRm9yQ2xpcCAmJiBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnNbIDAgXSApOwoKCQkJCQl0aGlzLl9hZGRJbmFjdGl2ZUFjdGlvbiggYWN0aW9uLCBjbGlwVXVpZCwgcm9vdFV1aWQgKTsKCgkJCQl9CgoJCQkJdmFyIGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQkJCS8vIGluY3JlbWVudCByZWZlcmVuY2UgY291bnRzIC8gc29ydCBvdXQgc3RhdGUKCQkJCWZvciAoIHZhciBpID0gMCwgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQkJdmFyIGJpbmRpbmcgPSBiaW5kaW5nc1sgaSBdOwoKCQkJCQlpZiAoIGJpbmRpbmcudXNlQ291bnQgKysgPT09IDAgKSB7CgoJCQkJCQl0aGlzLl9sZW5kQmluZGluZyggYmluZGluZyApOwoJCQkJCQliaW5kaW5nLnNhdmVPcmlnaW5hbFN0YXRlKCk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5fbGVuZEFjdGlvbiggYWN0aW9uICk7CgoJCQl9CgoJCX0sCgoJCV9kZWFjdGl2YXRlQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiApIHsKCgkJCWlmICggdGhpcy5faXNBY3RpdmVBY3Rpb24oIGFjdGlvbiApICkgewoKCQkJCXZhciBiaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5nczsKCgkJCQkvLyBkZWNyZW1lbnQgcmVmZXJlbmNlIGNvdW50cyAvIHNvcnQgb3V0IHN0YXRlCgkJCQlmb3IgKCB2YXIgaSA9IDAsIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJCXZhciBiaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCQkJaWYgKCAtLSBiaW5kaW5nLnVzZUNvdW50ID09PSAwICkgewoKCQkJCQkJYmluZGluZy5yZXN0b3JlT3JpZ2luYWxTdGF0ZSgpOwoJCQkJCQl0aGlzLl90YWtlQmFja0JpbmRpbmcoIGJpbmRpbmcgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQl0aGlzLl90YWtlQmFja0FjdGlvbiggYWN0aW9uICk7CgoJCQl9CgoJCX0sCgoJCS8vIE1lbW9yeSBtYW5hZ2VyCgoJCV9pbml0TWVtb3J5TWFuYWdlcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5fYWN0aW9ucyA9IFtdOyAvLyAnbkFjdGl2ZUFjdGlvbnMnIGZvbGxvd2VkIGJ5IGluYWN0aXZlIG9uZXMKCQkJdGhpcy5fbkFjdGl2ZUFjdGlvbnMgPSAwOwoKCQkJdGhpcy5fYWN0aW9uc0J5Q2xpcCA9IHt9OwoJCQkvLyBpbnNpZGU6CgkJCS8vIHsKCQkJLy8gCWtub3duQWN0aW9uczogQXJyYXk8IEFuaW1hdGlvbkFjdGlvbiA+IC0gdXNlZCBhcyBwcm90b3R5cGVzCgkJCS8vIAlhY3Rpb25CeVJvb3Q6IEFuaW1hdGlvbkFjdGlvbiAtIGxvb2t1cAoJCQkvLyB9CgoKCQkJdGhpcy5fYmluZGluZ3MgPSBbXTsgLy8gJ25BY3RpdmVCaW5kaW5ncycgZm9sbG93ZWQgYnkgaW5hY3RpdmUgb25lcwoJCQl0aGlzLl9uQWN0aXZlQmluZGluZ3MgPSAwOwoKCQkJdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lID0ge307IC8vIGluc2lkZTogTWFwPCBuYW1lLCBQcm9wZXJ0eU1peGVyID4KCgoJCQl0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzID0gW107IC8vIHNhbWUgZ2FtZSBhcyBhYm92ZQoJCQl0aGlzLl9uQWN0aXZlQ29udHJvbEludGVycG9sYW50cyA9IDA7CgoJCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQkJdGhpcy5zdGF0cyA9IHsKCgkJCQlhY3Rpb25zOiB7CgkJCQkJZ2V0IHRvdGFsKCkgewoKCQkJCQkJcmV0dXJuIHNjb3BlLl9hY3Rpb25zLmxlbmd0aDsKCgkJCQkJfSwKCQkJCQlnZXQgaW5Vc2UoKSB7CgoJCQkJCQlyZXR1cm4gc2NvcGUuX25BY3RpdmVBY3Rpb25zOwoKCQkJCQl9CgkJCQl9LAoJCQkJYmluZGluZ3M6IHsKCQkJCQlnZXQgdG90YWwoKSB7CgoJCQkJCQlyZXR1cm4gc2NvcGUuX2JpbmRpbmdzLmxlbmd0aDsKCgkJCQkJfSwKCQkJCQlnZXQgaW5Vc2UoKSB7CgoJCQkJCQlyZXR1cm4gc2NvcGUuX25BY3RpdmVCaW5kaW5nczsKCgkJCQkJfQoJCQkJfSwKCQkJCWNvbnRyb2xJbnRlcnBvbGFudHM6IHsKCQkJCQlnZXQgdG90YWwoKSB7CgoJCQkJCQlyZXR1cm4gc2NvcGUuX2NvbnRyb2xJbnRlcnBvbGFudHMubGVuZ3RoOwoKCQkJCQl9LAoJCQkJCWdldCBpblVzZSgpIHsKCgkJCQkJCXJldHVybiBzY29wZS5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHM7CgoJCQkJCX0KCQkJCX0KCgkJCX07CgoJCX0sCgoJCS8vIE1lbW9yeSBtYW5hZ2VtZW50IGZvciBBbmltYXRpb25BY3Rpb24gb2JqZWN0cwoKCQlfaXNBY3RpdmVBY3Rpb246IGZ1bmN0aW9uICggYWN0aW9uICkgewoKCQkJdmFyIGluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4OwoJCQlyZXR1cm4gaW5kZXggIT09IG51bGwgJiYgaW5kZXggPCB0aGlzLl9uQWN0aXZlQWN0aW9uczsKCgkJfSwKCgkJX2FkZEluYWN0aXZlQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiwgY2xpcFV1aWQsIHJvb3RVdWlkICkgewoKCQkJdmFyIGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLAoJCQkJYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXAsCgkJCQlhY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF07CgoJCQlpZiAoIGFjdGlvbnNGb3JDbGlwID09PSB1bmRlZmluZWQgKSB7CgoJCQkJYWN0aW9uc0ZvckNsaXAgPSB7CgoJCQkJCWtub3duQWN0aW9uczogWyBhY3Rpb24gXSwKCQkJCQlhY3Rpb25CeVJvb3Q6IHt9CgoJCQkJfTsKCgkJCQlhY3Rpb24uX2J5Q2xpcENhY2hlSW5kZXggPSAwOwoKCQkJCWFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF0gPSBhY3Rpb25zRm9yQ2xpcDsKCgkJCX0gZWxzZSB7CgoJCQkJdmFyIGtub3duQWN0aW9ucyA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uczsKCgkJCQlhY3Rpb24uX2J5Q2xpcENhY2hlSW5kZXggPSBrbm93bkFjdGlvbnMubGVuZ3RoOwoJCQkJa25vd25BY3Rpb25zLnB1c2goIGFjdGlvbiApOwoKCQkJfQoKCQkJYWN0aW9uLl9jYWNoZUluZGV4ID0gYWN0aW9ucy5sZW5ndGg7CgkJCWFjdGlvbnMucHVzaCggYWN0aW9uICk7CgoJCQlhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF0gPSBhY3Rpb247CgoJCX0sCgoJCV9yZW1vdmVJbmFjdGl2ZUFjdGlvbjogZnVuY3Rpb24gKCBhY3Rpb24gKSB7CgoJCQl2YXIgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCQlsYXN0SW5hY3RpdmVBY3Rpb24gPSBhY3Rpb25zWyBhY3Rpb25zLmxlbmd0aCAtIDEgXSwKCQkJCWNhY2hlSW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXg7CgoJCQlsYXN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwoJCQlhY3Rpb25zWyBjYWNoZUluZGV4IF0gPSBsYXN0SW5hY3RpdmVBY3Rpb247CgkJCWFjdGlvbnMucG9wKCk7CgoJCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBudWxsOwoKCgkJCXZhciBjbGlwVXVpZCA9IGFjdGlvbi5fY2xpcC51dWlkLAoJCQkJYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXAsCgkJCQlhY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF0sCgkJCQlrbm93bkFjdGlvbnNGb3JDbGlwID0gYWN0aW9uc0ZvckNsaXAua25vd25BY3Rpb25zLAoKCQkJCWxhc3RLbm93bkFjdGlvbiA9CgkJCQkJa25vd25BY3Rpb25zRm9yQ2xpcFsga25vd25BY3Rpb25zRm9yQ2xpcC5sZW5ndGggLSAxIF0sCgoJCQkJYnlDbGlwQ2FjaGVJbmRleCA9IGFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleDsKCgkJCWxhc3RLbm93bkFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IGJ5Q2xpcENhY2hlSW5kZXg7CgkJCWtub3duQWN0aW9uc0ZvckNsaXBbIGJ5Q2xpcENhY2hlSW5kZXggXSA9IGxhc3RLbm93bkFjdGlvbjsKCQkJa25vd25BY3Rpb25zRm9yQ2xpcC5wb3AoKTsKCgkJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CgoKCQkJdmFyIGFjdGlvbkJ5Um9vdCA9IGFjdGlvbnNGb3JDbGlwLmFjdGlvbkJ5Um9vdCwKCQkJCXJvb3RVdWlkID0gKCBhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290ICkudXVpZDsKCgkJCWRlbGV0ZSBhY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF07CgoJCQlpZiAoIGtub3duQWN0aW9uc0ZvckNsaXAubGVuZ3RoID09PSAwICkgewoKCQkJCWRlbGV0ZSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQkJfQoKCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVCaW5kaW5nc0ZvckFjdGlvbiggYWN0aW9uICk7CgoJCX0sCgoJCV9yZW1vdmVJbmFjdGl2ZUJpbmRpbmdzRm9yQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiApIHsKCgkJCXZhciBiaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5nczsKCQkJZm9yICggdmFyIGkgPSAwLCBuID0gYmluZGluZ3MubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCXZhciBiaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCQlpZiAoIC0tIGJpbmRpbmcucmVmZXJlbmNlQ291bnQgPT09IDAgKSB7CgoJCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZyggYmluZGluZyApOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJX2xlbmRBY3Rpb246IGZ1bmN0aW9uICggYWN0aW9uICkgewoKCQkJLy8gWyBhY3RpdmUgYWN0aW9ucyB8ICBpbmFjdGl2ZSBhY3Rpb25zICBdCgkJCS8vIFsgIGFjdGl2ZSBhY3Rpb25zID58IGluYWN0aXZlIGFjdGlvbnMgXQoJCQkvLyAgICAgICAgICAgICAgICAgcyAgICAgICAgYQoJCQkvLyAgICAgICAgICAgICAgICAgIDwtc3dhcC0+CgkJCS8vICAgICAgICAgICAgICAgICBhICAgICAgICBzCgoJCQl2YXIgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCQlwcmV2SW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXgsCgoJCQkJbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMgKyssCgoJCQkJZmlyc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbIGxhc3RBY3RpdmVJbmRleCBdOwoKCQkJYWN0aW9uLl9jYWNoZUluZGV4ID0gbGFzdEFjdGl2ZUluZGV4OwoJCQlhY3Rpb25zWyBsYXN0QWN0aXZlSW5kZXggXSA9IGFjdGlvbjsKCgkJCWZpcnN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJCWFjdGlvbnNbIHByZXZJbmRleCBdID0gZmlyc3RJbmFjdGl2ZUFjdGlvbjsKCgkJfSwKCgkJX3Rha2VCYWNrQWN0aW9uOiBmdW5jdGlvbiAoIGFjdGlvbiApIHsKCgkJCS8vIFsgIGFjdGl2ZSBhY3Rpb25zICB8IGluYWN0aXZlIGFjdGlvbnMgXQoJCQkvLyBbIGFjdGl2ZSBhY3Rpb25zIHw8IGluYWN0aXZlIGFjdGlvbnMgIF0KCQkJLy8gICAgICAgIGEgICAgICAgIHMKCQkJLy8gICAgICAgICA8LXN3YXAtPgoJCQkvLyAgICAgICAgcyAgICAgICAgYQoKCQkJdmFyIGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLAoJCQkJcHJldkluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4LAoKCQkJCWZpcnN0SW5hY3RpdmVJbmRleCA9IC0tIHRoaXMuX25BY3RpdmVBY3Rpb25zLAoKCQkJCWxhc3RBY3RpdmVBY3Rpb24gPSBhY3Rpb25zWyBmaXJzdEluYWN0aXZlSW5kZXggXTsKCgkJCWFjdGlvbi5fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKCQkJYWN0aW9uc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF0gPSBhY3Rpb247CgoJCQlsYXN0QWN0aXZlQWN0aW9uLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwoJCQlhY3Rpb25zWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVBY3Rpb247CgoJCX0sCgoJCS8vIE1lbW9yeSBtYW5hZ2VtZW50IGZvciBQcm9wZXJ0eU1peGVyIG9iamVjdHMKCgkJX2FkZEluYWN0aXZlQmluZGluZzogZnVuY3Rpb24gKCBiaW5kaW5nLCByb290VXVpZCwgdHJhY2tOYW1lICkgewoKCQkJdmFyIGJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lLAoJCQkJYmluZGluZ0J5TmFtZSA9IGJpbmRpbmdzQnlSb290WyByb290VXVpZCBdLAoKCQkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCQlpZiAoIGJpbmRpbmdCeU5hbWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQliaW5kaW5nQnlOYW1lID0ge307CgkJCQliaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXSA9IGJpbmRpbmdCeU5hbWU7CgoJCQl9CgoJCQliaW5kaW5nQnlOYW1lWyB0cmFja05hbWUgXSA9IGJpbmRpbmc7CgoJCQliaW5kaW5nLl9jYWNoZUluZGV4ID0gYmluZGluZ3MubGVuZ3RoOwoJCQliaW5kaW5ncy5wdXNoKCBiaW5kaW5nICk7CgoJCX0sCgoJCV9yZW1vdmVJbmFjdGl2ZUJpbmRpbmc6IGZ1bmN0aW9uICggYmluZGluZyApIHsKCgkJCXZhciBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQkJcHJvcEJpbmRpbmcgPSBiaW5kaW5nLmJpbmRpbmcsCgkJCQlyb290VXVpZCA9IHByb3BCaW5kaW5nLnJvb3ROb2RlLnV1aWQsCgkJCQl0cmFja05hbWUgPSBwcm9wQmluZGluZy5wYXRoLAoJCQkJYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsCgkJCQliaW5kaW5nQnlOYW1lID0gYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF0sCgoJCQkJbGFzdEluYWN0aXZlQmluZGluZyA9IGJpbmRpbmdzWyBiaW5kaW5ncy5sZW5ndGggLSAxIF0sCgkJCQljYWNoZUluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleDsKCgkJCWxhc3RJbmFjdGl2ZUJpbmRpbmcuX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwoJCQliaW5kaW5nc1sgY2FjaGVJbmRleCBdID0gbGFzdEluYWN0aXZlQmluZGluZzsKCQkJYmluZGluZ3MucG9wKCk7CgoJCQlkZWxldGUgYmluZGluZ0J5TmFtZVsgdHJhY2tOYW1lIF07CgoJCQlyZW1vdmVfZW1wdHlfbWFwOiB7CgoJCQkJZm9yICggdmFyIF8gaW4gYmluZGluZ0J5TmFtZSApIGJyZWFrIHJlbW92ZV9lbXB0eV9tYXA7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKCgkJCQlkZWxldGUgYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF07CgoJCQl9CgoJCX0sCgoJCV9sZW5kQmluZGluZzogZnVuY3Rpb24gKCBiaW5kaW5nICkgewoKCQkJdmFyIGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCQlwcmV2SW5kZXggPSBiaW5kaW5nLl9jYWNoZUluZGV4LAoKCQkJCWxhc3RBY3RpdmVJbmRleCA9IHRoaXMuX25BY3RpdmVCaW5kaW5ncyArKywKCgkJCQlmaXJzdEluYWN0aXZlQmluZGluZyA9IGJpbmRpbmdzWyBsYXN0QWN0aXZlSW5kZXggXTsKCgkJCWJpbmRpbmcuX2NhY2hlSW5kZXggPSBsYXN0QWN0aXZlSW5kZXg7CgkJCWJpbmRpbmdzWyBsYXN0QWN0aXZlSW5kZXggXSA9IGJpbmRpbmc7CgoJCQlmaXJzdEluYWN0aXZlQmluZGluZy5fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQkJYmluZGluZ3NbIHByZXZJbmRleCBdID0gZmlyc3RJbmFjdGl2ZUJpbmRpbmc7CgoJCX0sCgoJCV90YWtlQmFja0JpbmRpbmc6IGZ1bmN0aW9uICggYmluZGluZyApIHsKCgkJCXZhciBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQkJcHJldkluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleCwKCgkJCQlmaXJzdEluYWN0aXZlSW5kZXggPSAtLSB0aGlzLl9uQWN0aXZlQmluZGluZ3MsCgoJCQkJbGFzdEFjdGl2ZUJpbmRpbmcgPSBiaW5kaW5nc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF07CgoJCQliaW5kaW5nLl9jYWNoZUluZGV4ID0gZmlyc3RJbmFjdGl2ZUluZGV4OwoJCQliaW5kaW5nc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF0gPSBiaW5kaW5nOwoKCQkJbGFzdEFjdGl2ZUJpbmRpbmcuX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJCWJpbmRpbmdzWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVCaW5kaW5nOwoKCQl9LAoKCgkJLy8gTWVtb3J5IG1hbmFnZW1lbnQgb2YgSW50ZXJwb2xhbnRzIGZvciB3ZWlnaHQgYW5kIHRpbWUgc2NhbGUKCgkJX2xlbmRDb250cm9sSW50ZXJwb2xhbnQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBpbnRlcnBvbGFudHMgPSB0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzLAoJCQkJbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHMgKyssCgkJCQlpbnRlcnBvbGFudCA9IGludGVycG9sYW50c1sgbGFzdEFjdGl2ZUluZGV4IF07CgoJCQlpZiAoIGludGVycG9sYW50ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJaW50ZXJwb2xhbnQgPSBuZXcgTGluZWFySW50ZXJwb2xhbnQoCgkJCQkJbmV3IEZsb2F0MzJBcnJheSggMiApLCBuZXcgRmxvYXQzMkFycmF5KCAyICksCgkJCQkJMSwgdGhpcy5fY29udHJvbEludGVycG9sYW50c1Jlc3VsdEJ1ZmZlciApOwoKCQkJCWludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IGxhc3RBY3RpdmVJbmRleDsKCQkJCWludGVycG9sYW50c1sgbGFzdEFjdGl2ZUluZGV4IF0gPSBpbnRlcnBvbGFudDsKCgkJCX0KCgkJCXJldHVybiBpbnRlcnBvbGFudDsKCgkJfSwKCgkJX3Rha2VCYWNrQ29udHJvbEludGVycG9sYW50OiBmdW5jdGlvbiAoIGludGVycG9sYW50ICkgewoKCQkJdmFyIGludGVycG9sYW50cyA9IHRoaXMuX2NvbnRyb2xJbnRlcnBvbGFudHMsCgkJCQlwcmV2SW5kZXggPSBpbnRlcnBvbGFudC5fX2NhY2hlSW5kZXgsCgoJCQkJZmlyc3RJbmFjdGl2ZUluZGV4ID0gLS0gdGhpcy5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHMsCgoJCQkJbGFzdEFjdGl2ZUludGVycG9sYW50ID0gaW50ZXJwb2xhbnRzWyBmaXJzdEluYWN0aXZlSW5kZXggXTsKCgkJCWludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKCQkJaW50ZXJwb2xhbnRzWyBmaXJzdEluYWN0aXZlSW5kZXggXSA9IGludGVycG9sYW50OwoKCQkJbGFzdEFjdGl2ZUludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQkJaW50ZXJwb2xhbnRzWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVJbnRlcnBvbGFudDsKCgkJfSwKCgkJX2NvbnRyb2xJbnRlcnBvbGFudHNSZXN1bHRCdWZmZXI6IG5ldyBGbG9hdDMyQXJyYXkoIDEgKSwKCgkJLy8gcmV0dXJuIGFuIGFjdGlvbiBmb3IgYSBjbGlwIG9wdGlvbmFsbHkgdXNpbmcgYSBjdXN0b20gcm9vdCB0YXJnZXQKCQkvLyBvYmplY3QgKHRoaXMgbWV0aG9kIGFsbG9jYXRlcyBhIGxvdCBvZiBkeW5hbWljIG1lbW9yeSBpbiBjYXNlIGEKCQkvLyBwcmV2aW91c2x5IHVua25vd24gY2xpcC9yb290IGNvbWJpbmF0aW9uIGlzIHNwZWNpZmllZCkKCQljbGlwQWN0aW9uOiBmdW5jdGlvbiAoIGNsaXAsIG9wdGlvbmFsUm9vdCApIHsKCgkJCXZhciByb290ID0gb3B0aW9uYWxSb290IHx8IHRoaXMuX3Jvb3QsCgkJCQlyb290VXVpZCA9IHJvb3QudXVpZCwKCgkJCQljbGlwT2JqZWN0ID0gdHlwZW9mIGNsaXAgPT09ICdzdHJpbmcnID8KCQkJCQlBbmltYXRpb25DbGlwLmZpbmRCeU5hbWUoIHJvb3QsIGNsaXAgKSA6IGNsaXAsCgoJCQkJY2xpcFV1aWQgPSBjbGlwT2JqZWN0ICE9PSBudWxsID8gY2xpcE9iamVjdC51dWlkIDogY2xpcCwKCgkJCQlhY3Rpb25zRm9yQ2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF0sCgkJCQlwcm90b3R5cGVBY3Rpb24gPSBudWxsOwoKCQkJaWYgKCBhY3Rpb25zRm9yQ2xpcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBleGlzdGluZ0FjdGlvbiA9CgkJCQkJCWFjdGlvbnNGb3JDbGlwLmFjdGlvbkJ5Um9vdFsgcm9vdFV1aWQgXTsKCgkJCQlpZiAoIGV4aXN0aW5nQWN0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXJldHVybiBleGlzdGluZ0FjdGlvbjsKCgkJCQl9CgoJCQkJLy8gd2Uga25vdyB0aGUgY2xpcCwgc28gd2UgZG9uJ3QgaGF2ZSB0byBwYXJzZSBhbGwKCQkJCS8vIHRoZSBiaW5kaW5ncyBhZ2FpbiBidXQgY2FuIGp1c3QgY29weQoJCQkJcHJvdG90eXBlQWN0aW9uID0gYWN0aW9uc0ZvckNsaXAua25vd25BY3Rpb25zWyAwIF07CgoJCQkJLy8gYWxzbywgdGFrZSB0aGUgY2xpcCBmcm9tIHRoZSBwcm90b3R5cGUgYWN0aW9uCgkJCQlpZiAoIGNsaXBPYmplY3QgPT09IG51bGwgKQoJCQkJCWNsaXBPYmplY3QgPSBwcm90b3R5cGVBY3Rpb24uX2NsaXA7CgoJCQl9CgoJCQkvLyBjbGlwIG11c3QgYmUga25vd24gd2hlbiBzcGVjaWZpZWQgdmlhIHN0cmluZwoJCQlpZiAoIGNsaXBPYmplY3QgPT09IG51bGwgKSByZXR1cm4gbnVsbDsKCgkJCS8vIGFsbG9jYXRlIGFsbCByZXNvdXJjZXMgcmVxdWlyZWQgdG8gcnVuIGl0CgkJCXZhciBuZXdBY3Rpb24gPSBuZXcgQW5pbWF0aW9uQWN0aW9uKCB0aGlzLCBjbGlwT2JqZWN0LCBvcHRpb25hbFJvb3QgKTsKCgkJCXRoaXMuX2JpbmRBY3Rpb24oIG5ld0FjdGlvbiwgcHJvdG90eXBlQWN0aW9uICk7CgoJCQkvLyBhbmQgbWFrZSB0aGUgYWN0aW9uIGtub3duIHRvIHRoZSBtZW1vcnkgbWFuYWdlcgoJCQl0aGlzLl9hZGRJbmFjdGl2ZUFjdGlvbiggbmV3QWN0aW9uLCBjbGlwVXVpZCwgcm9vdFV1aWQgKTsKCgkJCXJldHVybiBuZXdBY3Rpb247CgoJCX0sCgoJCS8vIGdldCBhbiBleGlzdGluZyBhY3Rpb24KCQlleGlzdGluZ0FjdGlvbjogZnVuY3Rpb24gKCBjbGlwLCBvcHRpb25hbFJvb3QgKSB7CgoJCQl2YXIgcm9vdCA9IG9wdGlvbmFsUm9vdCB8fCB0aGlzLl9yb290LAoJCQkJcm9vdFV1aWQgPSByb290LnV1aWQsCgoJCQkJY2xpcE9iamVjdCA9IHR5cGVvZiBjbGlwID09PSAnc3RyaW5nJyA/CgkJCQkJQW5pbWF0aW9uQ2xpcC5maW5kQnlOYW1lKCByb290LCBjbGlwICkgOiBjbGlwLAoKCQkJCWNsaXBVdWlkID0gY2xpcE9iamVjdCA/IGNsaXBPYmplY3QudXVpZCA6IGNsaXAsCgoJCQkJYWN0aW9uc0ZvckNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQkJaWYgKCBhY3Rpb25zRm9yQ2xpcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF0gfHwgbnVsbDsKCgkJCX0KCgkJCXJldHVybiBudWxsOwoKCQl9LAoKCQkvLyBkZWFjdGl2YXRlcyBhbGwgcHJldmlvdXNseSBzY2hlZHVsZWQgYWN0aW9ucwoJCXN0b3BBbGxBY3Rpb246IGZ1bmN0aW9uICgpIHsKCgkJCXZhciBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJCW5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMsCgkJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQkJbkJpbmRpbmdzID0gdGhpcy5fbkFjdGl2ZUJpbmRpbmdzOwoKCQkJdGhpcy5fbkFjdGl2ZUFjdGlvbnMgPSAwOwoJCQl0aGlzLl9uQWN0aXZlQmluZGluZ3MgPSAwOwoKCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuQWN0aW9uczsgKysgaSApIHsKCgkJCQlhY3Rpb25zWyBpIF0ucmVzZXQoKTsKCgkJCX0KCgkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gbkJpbmRpbmdzOyArKyBpICkgewoKCQkJCWJpbmRpbmdzWyBpIF0udXNlQ291bnQgPSAwOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCS8vIGFkdmFuY2UgdGhlIHRpbWUgYW5kIHVwZGF0ZSBhcHBseSB0aGUgYW5pbWF0aW9uCgkJdXBkYXRlOiBmdW5jdGlvbiAoIGRlbHRhVGltZSApIHsKCgkJCWRlbHRhVGltZSAqPSB0aGlzLnRpbWVTY2FsZTsKCgkJCXZhciBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJCW5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMsCgoJCQkJdGltZSA9IHRoaXMudGltZSArPSBkZWx0YVRpbWUsCgkJCQl0aW1lRGlyZWN0aW9uID0gTWF0aC5zaWduKCBkZWx0YVRpbWUgKSwKCgkJCQlhY2N1SW5kZXggPSB0aGlzLl9hY2N1SW5kZXggXj0gMTsKCgkJCS8vIHJ1biBhY3RpdmUgYWN0aW9ucwoKCQkJZm9yICggdmFyIGkgPSAwOyBpICE9PSBuQWN0aW9uczsgKysgaSApIHsKCgkJCQl2YXIgYWN0aW9uID0gYWN0aW9uc1sgaSBdOwoKCQkJCWFjdGlvbi5fdXBkYXRlKCB0aW1lLCBkZWx0YVRpbWUsIHRpbWVEaXJlY3Rpb24sIGFjY3VJbmRleCApOwoKCQkJfQoKCQkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCQl2YXIgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJCW5CaW5kaW5ncyA9IHRoaXMuX25BY3RpdmVCaW5kaW5nczsKCgkJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gbkJpbmRpbmdzOyArKyBpICkgewoKCQkJCWJpbmRpbmdzWyBpIF0uYXBwbHkoIGFjY3VJbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCS8vIHJldHVybiB0aGlzIG1peGVyJ3Mgcm9vdCB0YXJnZXQgb2JqZWN0CgkJZ2V0Um9vdDogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuX3Jvb3Q7CgoJCX0sCgoJCS8vIGZyZWUgYWxsIHJlc291cmNlcyBzcGVjaWZpYyB0byBhIHBhcnRpY3VsYXIgY2xpcAoJCXVuY2FjaGVDbGlwOiBmdW5jdGlvbiAoIGNsaXAgKSB7CgoJCQl2YXIgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCQljbGlwVXVpZCA9IGNsaXAudXVpZCwKCQkJCWFjdGlvbnNCeUNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwLAoJCQkJYWN0aW9uc0ZvckNsaXAgPSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQkJaWYgKCBhY3Rpb25zRm9yQ2xpcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIG5vdGU6IGp1c3QgY2FsbGluZyBfcmVtb3ZlSW5hY3RpdmVBY3Rpb24gd291bGQgbWVzcyB1cCB0aGUKCQkJCS8vIGl0ZXJhdGlvbiBzdGF0ZSBhbmQgYWxzbyByZXF1aXJlIHVwZGF0aW5nIHRoZSBzdGF0ZSB3ZSBjYW4KCQkJCS8vIGp1c3QgdGhyb3cgYXdheQoKCQkJCXZhciBhY3Rpb25zVG9SZW1vdmUgPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnM7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBuID0gYWN0aW9uc1RvUmVtb3ZlLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQkJdmFyIGFjdGlvbiA9IGFjdGlvbnNUb1JlbW92ZVsgaSBdOwoKCQkJCQl0aGlzLl9kZWFjdGl2YXRlQWN0aW9uKCBhY3Rpb24gKTsKCgkJCQkJdmFyIGNhY2hlSW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXgsCgkJCQkJCWxhc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbIGFjdGlvbnMubGVuZ3RoIC0gMSBdOwoKCQkJCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBudWxsOwoJCQkJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CgoJCQkJCWxhc3RJbmFjdGl2ZUFjdGlvbi5fY2FjaGVJbmRleCA9IGNhY2hlSW5kZXg7CgkJCQkJYWN0aW9uc1sgY2FjaGVJbmRleCBdID0gbGFzdEluYWN0aXZlQWN0aW9uOwoJCQkJCWFjdGlvbnMucG9wKCk7CgoJCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZ3NGb3JBY3Rpb24oIGFjdGlvbiApOwoKCQkJCX0KCgkJCQlkZWxldGUgYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJCX0KCgkJfSwKCgkJLy8gZnJlZSBhbGwgcmVzb3VyY2VzIHNwZWNpZmljIHRvIGEgcGFydGljdWxhciByb290IHRhcmdldCBvYmplY3QKCQl1bmNhY2hlUm9vdDogZnVuY3Rpb24gKCByb290ICkgewoKCQkJdmFyIHJvb3RVdWlkID0gcm9vdC51dWlkLAoJCQkJYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXA7CgoJCQlmb3IgKCB2YXIgY2xpcFV1aWQgaW4gYWN0aW9uc0J5Q2xpcCApIHsKCgkJCQl2YXIgYWN0aW9uQnlSb290ID0gYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXS5hY3Rpb25CeVJvb3QsCgkJCQkJYWN0aW9uID0gYWN0aW9uQnlSb290WyByb290VXVpZCBdOwoKCQkJCWlmICggYWN0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRoaXMuX2RlYWN0aXZhdGVBY3Rpb24oIGFjdGlvbiApOwoJCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQWN0aW9uKCBhY3Rpb24gKTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIgYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsCgkJCQliaW5kaW5nQnlOYW1lID0gYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF07CgoJCQlpZiAoIGJpbmRpbmdCeU5hbWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlmb3IgKCB2YXIgdHJhY2tOYW1lIGluIGJpbmRpbmdCeU5hbWUgKSB7CgoJCQkJCXZhciBiaW5kaW5nID0gYmluZGluZ0J5TmFtZVsgdHJhY2tOYW1lIF07CgkJCQkJYmluZGluZy5yZXN0b3JlT3JpZ2luYWxTdGF0ZSgpOwoJCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZyggYmluZGluZyApOwoKCQkJCX0KCgkJCX0KCgkJfSwKCgkJLy8gcmVtb3ZlIGEgdGFyZ2V0ZWQgY2xpcCBmcm9tIHRoZSBjYWNoZQoJCXVuY2FjaGVBY3Rpb246IGZ1bmN0aW9uICggY2xpcCwgb3B0aW9uYWxSb290ICkgewoKCQkJdmFyIGFjdGlvbiA9IHRoaXMuZXhpc3RpbmdBY3Rpb24oIGNsaXAsIG9wdGlvbmFsUm9vdCApOwoKCQkJaWYgKCBhY3Rpb24gIT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZGVhY3RpdmF0ZUFjdGlvbiggYWN0aW9uICk7CgkJCQl0aGlzLl9yZW1vdmVJbmFjdGl2ZUFjdGlvbiggYWN0aW9uICk7CgoJCQl9CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gVW5pZm9ybSggdmFsdWUgKSB7CgoJCWlmICggdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlVuaWZvcm06IFR5cGUgcGFyYW1ldGVyIGlzIG5vIGxvbmdlciBuZWVkZWQuJyApOwoJCQl2YWx1ZSA9IGFyZ3VtZW50c1sgMSBdOwoKCQl9CgoJCXRoaXMudmFsdWUgPSB2YWx1ZTsKCgl9CgoJVW5pZm9ybS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgoJCXJldHVybiBuZXcgVW5pZm9ybSggdGhpcy52YWx1ZS5jbG9uZSA9PT0gdW5kZWZpbmVkID8gdGhpcy52YWx1ZSA6IHRoaXMudmFsdWUuY2xvbmUoKSApOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIGJlbmFhZGFtcyAvIGh0dHBzOi8vdHdpdHRlci5jb20vYmVuX2FfYWRhbXMKCSAqLwoKCWZ1bmN0aW9uIEluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5KCkgewoKCQlCdWZmZXJHZW9tZXRyeS5jYWxsKCB0aGlzICk7CgoJCXRoaXMudHlwZSA9ICdJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSc7CgkJdGhpcy5tYXhJbnN0YW5jZWRDb3VudCA9IHVuZGVmaW5lZDsKCgl9CgoJSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlID0gT2JqZWN0LmFzc2lnbiggT2JqZWN0LmNyZWF0ZSggQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IEluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5LAoKCQlpc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5OiB0cnVlLAoKCQljb3B5OiBmdW5jdGlvbiAoIHNvdXJjZSApIHsKCgkJCUJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5tYXhJbnN0YW5jZWRDb3VudCA9IHNvdXJjZS5tYXhJbnN0YW5jZWRDb3VudDsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQljbG9uZTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBiZW5hYWRhbXMgLyBodHRwczovL3R3aXR0ZXIuY29tL2Jlbl9hX2FkYW1zCgkgKi8KCglmdW5jdGlvbiBJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciggYXJyYXksIHN0cmlkZSwgbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJSW50ZXJsZWF2ZWRCdWZmZXIuY2FsbCggdGhpcywgYXJyYXksIHN0cmlkZSApOwoKCQl0aGlzLm1lc2hQZXJBdHRyaWJ1dGUgPSBtZXNoUGVyQXR0cmlidXRlIHx8IDE7CgoJfQoKCUluc3RhbmNlZEludGVybGVhdmVkQnVmZmVyLnByb3RvdHlwZSA9IE9iamVjdC5hc3NpZ24oIE9iamVjdC5jcmVhdGUoIEludGVybGVhdmVkQnVmZmVyLnByb3RvdHlwZSApLCB7CgoJCWNvbnN0cnVjdG9yOiBJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciwKCgkJaXNJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlcjogdHJ1ZSwKCgkJY29weTogZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCQlJbnRlcmxlYXZlZEJ1ZmZlci5wcm90b3R5cGUuY29weS5jYWxsKCB0aGlzLCBzb3VyY2UgKTsKCgkJCXRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IHNvdXJjZS5tZXNoUGVyQXR0cmlidXRlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGJlbmFhZGFtcyAvIGh0dHBzOi8vdHdpdHRlci5jb20vYmVuX2FfYWRhbXMKCSAqLwoKCWZ1bmN0aW9uIEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkLCBtZXNoUGVyQXR0cmlidXRlICkgewoKCQlpZiAoIHR5cGVvZiAoIG5vcm1hbGl6ZWQgKSA9PT0gJ251bWJlcicgKSB7CgoJCQltZXNoUGVyQXR0cmlidXRlID0gbm9ybWFsaXplZDsKCgkJCW5vcm1hbGl6ZWQgPSBmYWxzZTsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5JbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGU6IFRoZSBjb25zdHJ1Y3RvciBub3cgZXhwZWN0cyBub3JtYWxpemVkIGFzIHRoZSB0aGlyZCBhcmd1bWVudC4nICk7CgoJCX0KCgkJQnVmZmVyQXR0cmlidXRlLmNhbGwoIHRoaXMsIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl0aGlzLm1lc2hQZXJBdHRyaWJ1dGUgPSBtZXNoUGVyQXR0cmlidXRlIHx8IDE7CgoJfQoKCUluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZS5wcm90b3R5cGUgPSBPYmplY3QuYXNzaWduKCBPYmplY3QuY3JlYXRlKCBCdWZmZXJBdHRyaWJ1dGUucHJvdG90eXBlICksIHsKCgkJY29uc3RydWN0b3I6IEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSwKCgkJaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGU6IHRydWUsCgoJCWNvcHk6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSApOwoKCQkJdGhpcy5tZXNoUGVyQXR0cmlidXRlID0gc291cmNlLm1lc2hQZXJBdHRyaWJ1dGU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvLwoJICogQGF1dGhvciBzdGVwaG9taSAvIGh0dHA6Ly9zdGVwaGFuZWdpbmllci5jb20vCgkgKi8KCglmdW5jdGlvbiBSYXljYXN0ZXIoIG9yaWdpbiwgZGlyZWN0aW9uLCBuZWFyLCBmYXIgKSB7CgoJCXRoaXMucmF5ID0gbmV3IFJheSggb3JpZ2luLCBkaXJlY3Rpb24gKTsKCQkvLyBkaXJlY3Rpb24gaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkIChmb3IgYWNjdXJhdGUgZGlzdGFuY2UgY2FsY3VsYXRpb25zKQoKCQl0aGlzLm5lYXIgPSBuZWFyIHx8IDA7CgkJdGhpcy5mYXIgPSBmYXIgfHwgSW5maW5pdHk7CgoJCXRoaXMucGFyYW1zID0gewoJCQlNZXNoOiB7fSwKCQkJTGluZToge30sCgkJCUxPRDoge30sCgkJCVBvaW50czogeyB0aHJlc2hvbGQ6IDEgfSwKCQkJU3ByaXRlOiB7fQoJCX07CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLnBhcmFtcywgewoJCQlQb2ludENsb3VkOiB7CgkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUmF5Y2FzdGVyOiBwYXJhbXMuUG9pbnRDbG91ZCBoYXMgYmVlbiByZW5hbWVkIHRvIHBhcmFtcy5Qb2ludHMuJyApOwoJCQkJCXJldHVybiB0aGlzLlBvaW50czsKCgkJCQl9CgkJCX0KCQl9ICk7CgoJfQoKCWZ1bmN0aW9uIGFzY1NvcnQoIGEsIGIgKSB7CgoJCXJldHVybiBhLmRpc3RhbmNlIC0gYi5kaXN0YW5jZTsKCgl9CgoJZnVuY3Rpb24gaW50ZXJzZWN0T2JqZWN0KCBvYmplY3QsIHJheWNhc3RlciwgaW50ZXJzZWN0cywgcmVjdXJzaXZlICkgewoKCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJb2JqZWN0LnJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApOwoKCQlpZiAoIHJlY3Vyc2l2ZSA9PT0gdHJ1ZSApIHsKCgkJCXZhciBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJaW50ZXJzZWN0T2JqZWN0KCBjaGlsZHJlblsgaSBdLCByYXljYXN0ZXIsIGludGVyc2VjdHMsIHRydWUgKTsKCgkJCX0KCgkJfQoKCX0KCglPYmplY3QuYXNzaWduKCBSYXljYXN0ZXIucHJvdG90eXBlLCB7CgoJCWxpbmVQcmVjaXNpb246IDEsCgoJCXNldDogZnVuY3Rpb24gKCBvcmlnaW4sIGRpcmVjdGlvbiApIHsKCgkJCS8vIGRpcmVjdGlvbiBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQgKGZvciBhY2N1cmF0ZSBkaXN0YW5jZSBjYWxjdWxhdGlvbnMpCgoJCQl0aGlzLnJheS5zZXQoIG9yaWdpbiwgZGlyZWN0aW9uICk7CgoJCX0sCgoJCXNldEZyb21DYW1lcmE6IGZ1bmN0aW9uICggY29vcmRzLCBjYW1lcmEgKSB7CgoJCQlpZiAoICggY2FtZXJhICYmIGNhbWVyYS5pc1BlcnNwZWN0aXZlQ2FtZXJhICkgKSB7CgoJCQkJdGhpcy5yYXkub3JpZ2luLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJCQl0aGlzLnJheS5kaXJlY3Rpb24uc2V0KCBjb29yZHMueCwgY29vcmRzLnksIDAuNSApLnVucHJvamVjdCggY2FtZXJhICkuc3ViKCB0aGlzLnJheS5vcmlnaW4gKS5ub3JtYWxpemUoKTsKCgkJCX0gZWxzZSBpZiAoICggY2FtZXJhICYmIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSApICkgewoKCQkJCXRoaXMucmF5Lm9yaWdpbi5zZXQoIGNvb3Jkcy54LCBjb29yZHMueSwgKCBjYW1lcmEubmVhciArIGNhbWVyYS5mYXIgKSAvICggY2FtZXJhLm5lYXIgLSBjYW1lcmEuZmFyICkgKS51bnByb2plY3QoIGNhbWVyYSApOyAvLyBzZXQgb3JpZ2luIGluIHBsYW5lIG9mIGNhbWVyYQoJCQkJdGhpcy5yYXkuZGlyZWN0aW9uLnNldCggMCwgMCwgLSAxICkudHJhbnNmb3JtRGlyZWN0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlJheWNhc3RlcjogVW5zdXBwb3J0ZWQgY2FtZXJhIHR5cGUuJyApOwoKCQkJfQoKCQl9LAoKCQlpbnRlcnNlY3RPYmplY3Q6IGZ1bmN0aW9uICggb2JqZWN0LCByZWN1cnNpdmUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQkJdmFyIGludGVyc2VjdHMgPSBvcHRpb25hbFRhcmdldCB8fCBbXTsKCgkJCWludGVyc2VjdE9iamVjdCggb2JqZWN0LCB0aGlzLCBpbnRlcnNlY3RzLCByZWN1cnNpdmUgKTsKCgkJCWludGVyc2VjdHMuc29ydCggYXNjU29ydCApOwoKCQkJcmV0dXJuIGludGVyc2VjdHM7CgoJCX0sCgoJCWludGVyc2VjdE9iamVjdHM6IGZ1bmN0aW9uICggb2JqZWN0cywgcmVjdXJzaXZlLCBvcHRpb25hbFRhcmdldCApIHsKCgkJCXZhciBpbnRlcnNlY3RzID0gb3B0aW9uYWxUYXJnZXQgfHwgW107CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG9iamVjdHMgKSA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHM6IG9iamVjdHMgaXMgbm90IGFuIEFycmF5LicgKTsKCQkJCXJldHVybiBpbnRlcnNlY3RzOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gb2JqZWN0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWludGVyc2VjdE9iamVjdCggb2JqZWN0c1sgaSBdLCB0aGlzLCBpbnRlcnNlY3RzLCByZWN1cnNpdmUgKTsKCgkJCX0KCgkJCWludGVyc2VjdHMuc29ydCggYXNjU29ydCApOwoKCQkJcmV0dXJuIGludGVyc2VjdHM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGJob3VzdG9uIC8gaHR0cDovL2NsYXJhLmlvCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiBSZWY6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1NwaGVyaWNhbF9jb29yZGluYXRlX3N5c3RlbQoJICoKCSAqIFRoZSBwb2xhciBhbmdsZSAocGhpKSBpcyBtZWFzdXJlZCBmcm9tIHRoZSBwb3NpdGl2ZSB5LWF4aXMuIFRoZSBwb3NpdGl2ZSB5LWF4aXMgaXMgdXAuCgkgKiBUaGUgYXppbXV0aGFsIGFuZ2xlICh0aGV0YSkgaXMgbWVhc3VyZWQgZnJvbSB0aGUgcG9zaXRpdmUgei1heGl6LgoJICovCgoJZnVuY3Rpb24gU3BoZXJpY2FsKCByYWRpdXMsIHBoaSwgdGhldGEgKSB7CgoJCXRoaXMucmFkaXVzID0gKCByYWRpdXMgIT09IHVuZGVmaW5lZCApID8gcmFkaXVzIDogMS4wOwoJCXRoaXMucGhpID0gKCBwaGkgIT09IHVuZGVmaW5lZCApID8gcGhpIDogMDsgLy8gcG9sYXIgYW5nbGUKCQl0aGlzLnRoZXRhID0gKCB0aGV0YSAhPT0gdW5kZWZpbmVkICkgPyB0aGV0YSA6IDA7IC8vIGF6aW11dGhhbCBhbmdsZQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJT2JqZWN0LmFzc2lnbiggU3BoZXJpY2FsLnByb3RvdHlwZSwgewoKCQlzZXQ6IGZ1bmN0aW9uICggcmFkaXVzLCBwaGksIHRoZXRhICkgewoKCQkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgkJCXRoaXMucGhpID0gcGhpOwoJCQl0aGlzLnRoZXRhID0gdGhldGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBvdGhlciApIHsKCgkJCXRoaXMucmFkaXVzID0gb3RoZXIucmFkaXVzOwoJCQl0aGlzLnBoaSA9IG90aGVyLnBoaTsKCQkJdGhpcy50aGV0YSA9IG90aGVyLnRoZXRhOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCS8vIHJlc3RyaWN0IHBoaSB0byBiZSBiZXR3ZWUgRVBTIGFuZCBQSS1FUFMKCQltYWtlU2FmZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIEVQUyA9IDAuMDAwMDAxOwoJCQl0aGlzLnBoaSA9IE1hdGgubWF4KCBFUFMsIE1hdGgubWluKCBNYXRoLlBJIC0gRVBTLCB0aGlzLnBoaSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbVZlY3RvcjM6IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiB0aGlzLnNldEZyb21DYXJ0ZXNpYW5Db29yZHMoIHYueCwgdi55LCB2LnogKTsKCgkJfSwKCgkJc2V0RnJvbUNhcnRlc2lhbkNvb3JkczogZnVuY3Rpb24gKCB4LCB5LCB6ICkgewoKCQkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIHggKiB4ICsgeSAqIHkgKyB6ICogeiApOwoKCQkJaWYgKCB0aGlzLnJhZGl1cyA9PT0gMCApIHsKCgkJCQl0aGlzLnRoZXRhID0gMDsKCQkJCXRoaXMucGhpID0gMDsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy50aGV0YSA9IE1hdGguYXRhbjIoIHgsIHogKTsKCQkJCXRoaXMucGhpID0gTWF0aC5hY29zKCBfTWF0aC5jbGFtcCggeSAvIHRoaXMucmFkaXVzLCAtIDEsIDEgKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICoKCSAqIFJlZjogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ3lsaW5kcmljYWxfY29vcmRpbmF0ZV9zeXN0ZW0KCSAqCgkgKi8KCglmdW5jdGlvbiBDeWxpbmRyaWNhbCggcmFkaXVzLCB0aGV0YSwgeSApIHsKCgkJdGhpcy5yYWRpdXMgPSAoIHJhZGl1cyAhPT0gdW5kZWZpbmVkICkgPyByYWRpdXMgOiAxLjA7IC8vIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byBhIHBvaW50IGluIHRoZSB4LXogcGxhbmUKCQl0aGlzLnRoZXRhID0gKCB0aGV0YSAhPT0gdW5kZWZpbmVkICkgPyB0aGV0YSA6IDA7IC8vIGNvdW50ZXJjbG9ja3dpc2UgYW5nbGUgaW4gdGhlIHgteiBwbGFuZSBtZWFzdXJlZCBpbiByYWRpYW5zIGZyb20gdGhlIHBvc2l0aXZlIHotYXhpcwoJCXRoaXMueSA9ICggeSAhPT0gdW5kZWZpbmVkICkgPyB5IDogMDsgLy8gaGVpZ2h0IGFib3ZlIHRoZSB4LXogcGxhbmUKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCU9iamVjdC5hc3NpZ24oIEN5bGluZHJpY2FsLnByb3RvdHlwZSwgewoKCQlzZXQ6IGZ1bmN0aW9uICggcmFkaXVzLCB0aGV0YSwgeSApIHsKCgkJCXRoaXMucmFkaXVzID0gcmFkaXVzOwoJCQl0aGlzLnRoZXRhID0gdGhldGE7CgkJCXRoaXMueSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY2xvbmU6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfSwKCgkJY29weTogZnVuY3Rpb24gKCBvdGhlciApIHsKCgkJCXRoaXMucmFkaXVzID0gb3RoZXIucmFkaXVzOwoJCQl0aGlzLnRoZXRhID0gb3RoZXIudGhldGE7CgkJCXRoaXMueSA9IG90aGVyLnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RnJvbVZlY3RvcjM6IGZ1bmN0aW9uICggdiApIHsKCgkJCXJldHVybiB0aGlzLnNldEZyb21DYXJ0ZXNpYW5Db29yZHMoIHYueCwgdi55LCB2LnogKTsKCgkJfSwKCgkJc2V0RnJvbUNhcnRlc2lhbkNvb3JkczogZnVuY3Rpb24gKCB4LCB5LCB6ICkgewoKCQkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIHggKiB4ICsgeiAqIHogKTsKCQkJdGhpcy50aGV0YSA9IE1hdGguYXRhbjIoIHgsIHogKTsKCQkJdGhpcy55ID0geTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfSApOwoKCS8qKgoJICogQGF1dGhvciBiaG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pbwoJICovCgoJZnVuY3Rpb24gQm94MiggbWluLCBtYXggKSB7CgoJCXRoaXMubWluID0gKCBtaW4gIT09IHVuZGVmaW5lZCApID8gbWluIDogbmV3IFZlY3RvcjIoICsgSW5maW5pdHksICsgSW5maW5pdHkgKTsKCQl0aGlzLm1heCA9ICggbWF4ICE9PSB1bmRlZmluZWQgKSA/IG1heCA6IG5ldyBWZWN0b3IyKCAtIEluZmluaXR5LCAtIEluZmluaXR5ICk7CgoJfQoKCU9iamVjdC5hc3NpZ24oIEJveDIucHJvdG90eXBlLCB7CgoJCXNldDogZnVuY3Rpb24gKCBtaW4sIG1heCApIHsKCgkJCXRoaXMubWluLmNvcHkoIG1pbiApOwoJCQl0aGlzLm1heC5jb3B5KCBtYXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tUG9pbnRzOiBmdW5jdGlvbiAoIHBvaW50cyApIHsKCgkJCXRoaXMubWFrZUVtcHR5KCk7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRoaXMuZXhwYW5kQnlQb2ludCggcG9pbnRzWyBpIF0gKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRGcm9tQ2VudGVyQW5kU2l6ZTogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxID0gbmV3IFZlY3RvcjIoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBzZXRGcm9tQ2VudGVyQW5kU2l6ZSggY2VudGVyLCBzaXplICkgewoKCQkJCXZhciBoYWxmU2l6ZSA9IHYxLmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgkJCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJCQl0aGlzLm1heC5jb3B5KCBjZW50ZXIgKS5hZGQoIGhhbGZTaXplICk7CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQl9KCksCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggYm94ICkgewoKCQkJdGhpcy5taW4uY29weSggYm94Lm1pbiApOwoJCQl0aGlzLm1heC5jb3B5KCBib3gubWF4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJbWFrZUVtcHR5OiBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLm1pbi54ID0gdGhpcy5taW4ueSA9ICsgSW5maW5pdHk7CgkJCXRoaXMubWF4LnggPSB0aGlzLm1heC55ID0gLSBJbmZpbml0eTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlpc0VtcHR5OiBmdW5jdGlvbiAoKSB7CgoJCQkvLyB0aGlzIGlzIGEgbW9yZSByb2J1c3QgY2hlY2sgZm9yIGVtcHR5IHRoYW4gKCB2b2x1bWUgPD0gMCApIGJlY2F1c2Ugdm9sdW1lIGNhbiBnZXQgcG9zaXRpdmUgd2l0aCB0d28gbmVnYXRpdmUgYXhlcwoKCQkJcmV0dXJuICggdGhpcy5tYXgueCA8IHRoaXMubWluLnggKSB8fCAoIHRoaXMubWF4LnkgPCB0aGlzLm1pbi55ICk7CgoJCX0sCgoJCWdldENlbnRlcjogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDI6IC5nZXRDZW50ZXIoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjIoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoIDAsIDAgKSA6IHRhcmdldC5hZGRWZWN0b3JzKCB0aGlzLm1pbiwgdGhpcy5tYXggKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCX0sCgoJCWdldFNpemU6IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJaWYgKCB0YXJnZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3gyOiAuZ2V0U2l6ZSgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMigpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCApIDogdGFyZ2V0LnN1YlZlY3RvcnMoIHRoaXMubWF4LCB0aGlzLm1pbiApOwoKCQl9LAoKCQlleHBhbmRCeVBvaW50OiBmdW5jdGlvbiAoIHBvaW50ICkgewoKCQkJdGhpcy5taW4ubWluKCBwb2ludCApOwoJCQl0aGlzLm1heC5tYXgoIHBvaW50ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXhwYW5kQnlWZWN0b3I6IGZ1bmN0aW9uICggdmVjdG9yICkgewoKCQkJdGhpcy5taW4uc3ViKCB2ZWN0b3IgKTsKCQkJdGhpcy5tYXguYWRkKCB2ZWN0b3IgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlleHBhbmRCeVNjYWxhcjogZnVuY3Rpb24gKCBzY2FsYXIgKSB7CgoJCQl0aGlzLm1pbi5hZGRTY2FsYXIoIC0gc2NhbGFyICk7CgkJCXRoaXMubWF4LmFkZFNjYWxhciggc2NhbGFyICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJY29udGFpbnNQb2ludDogZnVuY3Rpb24gKCBwb2ludCApIHsKCgkJCXJldHVybiBwb2ludC54IDwgdGhpcy5taW4ueCB8fCBwb2ludC54ID4gdGhpcy5tYXgueCB8fAoJCQkJcG9pbnQueSA8IHRoaXMubWluLnkgfHwgcG9pbnQueSA+IHRoaXMubWF4LnkgPyBmYWxzZSA6IHRydWU7CgoJCX0sCgoJCWNvbnRhaW5zQm94OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJgoJCQkJdGhpcy5taW4ueSA8PSBib3gubWluLnkgJiYgYm94Lm1heC55IDw9IHRoaXMubWF4Lnk7CgoJCX0sCgoJCWdldFBhcmFtZXRlcjogZnVuY3Rpb24gKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJLy8gVGhpcyBjYW4gcG90ZW50aWFsbHkgaGF2ZSBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBib3gKCQkJLy8gaGFzIGEgc2l6ZSBkaW1lbnNpb24gb2YgMC4KCgkJCWlmICggdGFyZ2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94MjogLmdldFBhcmFtZXRlcigpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMigpOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5zZXQoCgkJCQkoIHBvaW50LnggLSB0aGlzLm1pbi54ICkgLyAoIHRoaXMubWF4LnggLSB0aGlzLm1pbi54ICksCgkJCQkoIHBvaW50LnkgLSB0aGlzLm1pbi55ICkgLyAoIHRoaXMubWF4LnkgLSB0aGlzLm1pbi55ICkKCQkJKTsKCgkJfSwKCgkJaW50ZXJzZWN0c0JveDogZnVuY3Rpb24gKCBib3ggKSB7CgoJCQkvLyB1c2luZyA0IHNwbGl0dGluZyBwbGFuZXMgdG8gcnVsZSBvdXQgaW50ZXJzZWN0aW9ucwoKCQkJcmV0dXJuIGJveC5tYXgueCA8IHRoaXMubWluLnggfHwgYm94Lm1pbi54ID4gdGhpcy5tYXgueCB8fAoJCQkJYm94Lm1heC55IDwgdGhpcy5taW4ueSB8fCBib3gubWluLnkgPiB0aGlzLm1heC55ID8gZmFsc2UgOiB0cnVlOwoKCQl9LAoKCQljbGFtcFBvaW50OiBmdW5jdGlvbiAoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDI6IC5jbGFtcFBvaW50KCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IyKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuY2xhbXAoIHRoaXMubWluLCB0aGlzLm1heCApOwoKCQl9LAoKCQlkaXN0YW5jZVRvUG9pbnQ6IGZ1bmN0aW9uICgpIHsKCgkJCXZhciB2MSA9IG5ldyBWZWN0b3IyKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJCQl2YXIgY2xhbXBlZFBvaW50ID0gdjEuY29weSggcG9pbnQgKS5jbGFtcCggdGhpcy5taW4sIHRoaXMubWF4ICk7CgkJCQlyZXR1cm4gY2xhbXBlZFBvaW50LnN1YiggcG9pbnQgKS5sZW5ndGgoKTsKCgkJCX07CgoJCX0oKSwKCgkJaW50ZXJzZWN0OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXRoaXMubWluLm1heCggYm94Lm1pbiApOwoJCQl0aGlzLm1heC5taW4oIGJveC5tYXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQl1bmlvbjogZnVuY3Rpb24gKCBib3ggKSB7CgoJCQl0aGlzLm1pbi5taW4oIGJveC5taW4gKTsKCQkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJdHJhbnNsYXRlOiBmdW5jdGlvbiAoIG9mZnNldCApIHsKCgkJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJCXRoaXMubWF4LmFkZCggb2Zmc2V0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCXJldHVybiBib3gubWluLmVxdWFscyggdGhpcy5taW4gKSAmJiBib3gubWF4LmVxdWFscyggdGhpcy5tYXggKTsKCgkJfQoKCX0gKTsKCgkvKioKCSAqIEBhdXRob3IgYmhvdXN0b24gLyBodHRwOi8vY2xhcmEuaW8KCSAqLwoKCWZ1bmN0aW9uIExpbmUzKCBzdGFydCwgZW5kICkgewoKCQl0aGlzLnN0YXJ0ID0gKCBzdGFydCAhPT0gdW5kZWZpbmVkICkgPyBzdGFydCA6IG5ldyBWZWN0b3IzKCk7CgkJdGhpcy5lbmQgPSAoIGVuZCAhPT0gdW5kZWZpbmVkICkgPyBlbmQgOiBuZXcgVmVjdG9yMygpOwoKCX0KCglPYmplY3QuYXNzaWduKCBMaW5lMy5wcm90b3R5cGUsIHsKCgkJc2V0OiBmdW5jdGlvbiAoIHN0YXJ0LCBlbmQgKSB7CgoJCQl0aGlzLnN0YXJ0LmNvcHkoIHN0YXJ0ICk7CgkJCXRoaXMuZW5kLmNvcHkoIGVuZCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWNsb25lOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0sCgoJCWNvcHk6IGZ1bmN0aW9uICggbGluZSApIHsKCgkJCXRoaXMuc3RhcnQuY29weSggbGluZS5zdGFydCApOwoJCQl0aGlzLmVuZC5jb3B5KCBsaW5lLmVuZCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCWdldENlbnRlcjogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUzOiAuZ2V0Q2VudGVyKCkgdGFyZ2V0IGlzIG5vdyByZXF1aXJlZCcgKTsKCQkJCXRhcmdldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuc3RhcnQsIHRoaXMuZW5kICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKCQl9LAoKCQlkZWx0YTogZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUzOiAuZGVsdGEoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5lbmQsIHRoaXMuc3RhcnQgKTsKCgkJfSwKCgkJZGlzdGFuY2VTcTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuZW5kICk7CgoJCX0sCgoJCWRpc3RhbmNlOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gdGhpcy5zdGFydC5kaXN0YW5jZVRvKCB0aGlzLmVuZCApOwoKCQl9LAoKCQlhdDogZnVuY3Rpb24gKCB0LCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUzOiAuYXQoKSB0YXJnZXQgaXMgbm93IHJlcXVpcmVkJyApOwoJCQkJdGFyZ2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLmRlbHRhKCB0YXJnZXQgKS5tdWx0aXBseVNjYWxhciggdCApLmFkZCggdGhpcy5zdGFydCApOwoKCQl9LAoKCQljbG9zZXN0UG9pbnRUb1BvaW50UGFyYW1ldGVyOiBmdW5jdGlvbiAoKSB7CgoJCQl2YXIgc3RhcnRQID0gbmV3IFZlY3RvcjMoKTsKCQkJdmFyIHN0YXJ0RW5kID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBjbG9zZXN0UG9pbnRUb1BvaW50UGFyYW1ldGVyKCBwb2ludCwgY2xhbXBUb0xpbmUgKSB7CgoJCQkJc3RhcnRQLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLnN0YXJ0ICk7CgkJCQlzdGFydEVuZC5zdWJWZWN0b3JzKCB0aGlzLmVuZCwgdGhpcy5zdGFydCApOwoKCQkJCXZhciBzdGFydEVuZDIgPSBzdGFydEVuZC5kb3QoIHN0YXJ0RW5kICk7CgkJCQl2YXIgc3RhcnRFbmRfc3RhcnRQID0gc3RhcnRFbmQuZG90KCBzdGFydFAgKTsKCgkJCQl2YXIgdCA9IHN0YXJ0RW5kX3N0YXJ0UCAvIHN0YXJ0RW5kMjsKCgkJCQlpZiAoIGNsYW1wVG9MaW5lICkgewoKCQkJCQl0ID0gX01hdGguY2xhbXAoIHQsIDAsIDEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHQ7CgoJCQl9OwoKCQl9KCksCgoJCWNsb3Nlc3RQb2ludFRvUG9pbnQ6IGZ1bmN0aW9uICggcG9pbnQsIGNsYW1wVG9MaW5lLCB0YXJnZXQgKSB7CgoJCQl2YXIgdCA9IHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlciggcG9pbnQsIGNsYW1wVG9MaW5lICk7CgoJCQlpZiAoIHRhcmdldCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUzOiAuY2xvc2VzdFBvaW50VG9Qb2ludCgpIHRhcmdldCBpcyBub3cgcmVxdWlyZWQnICk7CgkJCQl0YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuZGVsdGEoIHRhcmdldCApLm11bHRpcGx5U2NhbGFyKCB0ICkuYWRkKCB0aGlzLnN0YXJ0ICk7CgoJCX0sCgoJCWFwcGx5TWF0cml4NDogZnVuY3Rpb24gKCBtYXRyaXggKSB7CgoJCQl0aGlzLnN0YXJ0LmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgkJCXRoaXMuZW5kLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJZXF1YWxzOiBmdW5jdGlvbiAoIGxpbmUgKSB7CgoJCQlyZXR1cm4gbGluZS5zdGFydC5lcXVhbHMoIHRoaXMuc3RhcnQgKSAmJiBsaW5lLmVuZC5lcXVhbHMoIHRoaXMuZW5kICk7CgoJCX0KCgl9ICk7CgoJLyoqCgkgKiBAYXV0aG9yIGFsdGVyZWRxIC8gaHR0cDovL2FsdGVyZWRxdWFsaWEuY29tLwoJICovCgoJZnVuY3Rpb24gSW1tZWRpYXRlUmVuZGVyT2JqZWN0KCBtYXRlcmlhbCApIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJdGhpcy5yZW5kZXIgPSBmdW5jdGlvbiAoIC8qIHJlbmRlckNhbGxiYWNrICovICkge307CgoJfQoKCUltbWVkaWF0ZVJlbmRlck9iamVjdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKTsKCUltbWVkaWF0ZVJlbmRlck9iamVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBJbW1lZGlhdGVSZW5kZXJPYmplY3Q7CgoJSW1tZWRpYXRlUmVuZGVyT2JqZWN0LnByb3RvdHlwZS5pc0ltbWVkaWF0ZVJlbmRlck9iamVjdCA9IHRydWU7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKi8KCglmdW5jdGlvbiBWZXJ0ZXhOb3JtYWxzSGVscGVyKCBvYmplY3QsIHNpemUsIGhleCwgbGluZXdpZHRoICkgewoKCQl0aGlzLm9iamVjdCA9IG9iamVjdDsKCgkJdGhpcy5zaXplID0gKCBzaXplICE9PSB1bmRlZmluZWQgKSA/IHNpemUgOiAxOwoKCQl2YXIgY29sb3IgPSAoIGhleCAhPT0gdW5kZWZpbmVkICkgPyBoZXggOiAweGZmMDAwMDsKCgkJdmFyIHdpZHRoID0gKCBsaW5ld2lkdGggIT09IHVuZGVmaW5lZCApID8gbGluZXdpZHRoIDogMTsKCgkJLy8KCgkJdmFyIG5Ob3JtYWxzID0gMDsKCgkJdmFyIG9iakdlb21ldHJ5ID0gdGhpcy5vYmplY3QuZ2VvbWV0cnk7CgoJCWlmICggb2JqR2VvbWV0cnkgJiYgb2JqR2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCW5Ob3JtYWxzID0gb2JqR2VvbWV0cnkuZmFjZXMubGVuZ3RoICogMzsKCgkJfSBlbHNlIGlmICggb2JqR2VvbWV0cnkgJiYgb2JqR2VvbWV0cnkuaXNCdWZmZXJHZW9tZXRyeSApIHsKCgkJCW5Ob3JtYWxzID0gb2JqR2VvbWV0cnkuYXR0cmlidXRlcy5ub3JtYWwuY291bnQ7CgoJCX0KCgkJLy8KCgkJdmFyIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbk5vcm1hbHMgKiAyICogMywgMyApOwoKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIHBvc2l0aW9ucyApOwoKCQlMaW5lU2VnbWVudHMuY2FsbCggdGhpcywgZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIGxpbmV3aWR0aDogd2lkdGggfSApICk7CgoJCS8vCgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCglWZXJ0ZXhOb3JtYWxzSGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIExpbmVTZWdtZW50cy5wcm90b3R5cGUgKTsKCVZlcnRleE5vcm1hbHNIZWxwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gVmVydGV4Tm9ybWFsc0hlbHBlcjsKCglWZXJ0ZXhOb3JtYWxzSGVscGVyLnByb3RvdHlwZS51cGRhdGUgPSAoIGZ1bmN0aW9uICgpIHsKCgkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgdjIgPSBuZXcgVmVjdG9yMygpOwoJCXZhciBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpOwoKCQlyZXR1cm4gZnVuY3Rpb24gdXBkYXRlKCkgewoKCQkJdmFyIGtleXMgPSBbICdhJywgJ2InLCAnYycgXTsKCgkJCXRoaXMub2JqZWN0LnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQlub3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCB0aGlzLm9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJdmFyIG1hdHJpeFdvcmxkID0gdGhpcy5vYmplY3QubWF0cml4V29ybGQ7CgoJCQl2YXIgcG9zaXRpb24gPSB0aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgoJCQkvLwoKCQkJdmFyIG9iakdlb21ldHJ5ID0gdGhpcy5vYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIG9iakdlb21ldHJ5ICYmIG9iakdlb21ldHJ5LmlzR2VvbWV0cnkgKSB7CgoJCQkJdmFyIHZlcnRpY2VzID0gb2JqR2VvbWV0cnkudmVydGljZXM7CgoJCQkJdmFyIGZhY2VzID0gb2JqR2VvbWV0cnkuZmFjZXM7CgoJCQkJdmFyIGlkeCA9IDA7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gZmFjZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdmFyIGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gZmFjZS52ZXJ0ZXhOb3JtYWxzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJdmFyIHZlcnRleCA9IHZlcnRpY2VzWyBmYWNlWyBrZXlzWyBqIF0gXSBdOwoKCQkJCQkJdmFyIG5vcm1hbCA9IGZhY2UudmVydGV4Tm9ybWFsc1sgaiBdOwoKCQkJCQkJdjEuY29weSggdmVydGV4ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQkJCQkJdjIuY29weSggbm9ybWFsICkuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhciggdGhpcy5zaXplICkuYWRkKCB2MSApOwoKCQkJCQkJcG9zaXRpb24uc2V0WFlaKCBpZHgsIHYxLngsIHYxLnksIHYxLnogKTsKCgkJCQkJCWlkeCA9IGlkeCArIDE7CgoJCQkJCQlwb3NpdGlvbi5zZXRYWVooIGlkeCwgdjIueCwgdjIueSwgdjIueiApOwoKCQkJCQkJaWR4ID0gaWR4ICsgMTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9iakdlb21ldHJ5ICYmIG9iakdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJdmFyIG9ialBvcyA9IG9iakdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgoJCQkJdmFyIG9iak5vcm0gPSBvYmpHZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbDsKCgkJCQl2YXIgaWR4ID0gMDsKCgkJCQkvLyBmb3Igc2ltcGxpY2l0eSwgaWdub3JlIGluZGV4IGFuZCBkcmF3Y2FsbHMsIGFuZCByZW5kZXIgZXZlcnkgbm9ybWFsCgoJCQkJZm9yICggdmFyIGogPSAwLCBqbCA9IG9ialBvcy5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQl2MS5zZXQoIG9ialBvcy5nZXRYKCBqICksIG9ialBvcy5nZXRZKCBqICksIG9ialBvcy5nZXRaKCBqICkgKS5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgoJCQkJCXYyLnNldCggb2JqTm9ybS5nZXRYKCBqICksIG9iak5vcm0uZ2V0WSggaiApLCBvYmpOb3JtLmdldFooIGogKSApOwoKCQkJCQl2Mi5hcHBseU1hdHJpeDMoIG5vcm1hbE1hdHJpeCApLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCB0aGlzLnNpemUgKS5hZGQoIHYxICk7CgoJCQkJCXBvc2l0aW9uLnNldFhZWiggaWR4LCB2MS54LCB2MS55LCB2MS56ICk7CgoJCQkJCWlkeCA9IGlkeCArIDE7CgoJCQkJCXBvc2l0aW9uLnNldFhZWiggaWR4LCB2Mi54LCB2Mi55LCB2Mi56ICk7CgoJCQkJCWlkeCA9IGlkeCArIDE7CgoJCQkJfQoKCQkJfQoKCQkJcG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9OwoKCX0oKSApOwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIFNwb3RMaWdodEhlbHBlciggbGlnaHQsIGNvbG9yICkgewoKCQlPYmplY3QzRC5jYWxsKCB0aGlzICk7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCQl0aGlzLmxpZ2h0LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCXRoaXMubWF0cml4ID0gbGlnaHQubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdmFyIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCXZhciBwb3NpdGlvbnMgPSBbCgkJCTAsIDAsIDAsIAkwLCAwLCAxLAoJCQkwLCAwLCAwLCAJMSwgMCwgMSwKCQkJMCwgMCwgMCwJLSAxLCAwLCAxLAoJCQkwLCAwLCAwLCAJMCwgMSwgMSwKCQkJMCwgMCwgMCwgCTAsIC0gMSwgMQoJCV07CgoJCWZvciAoIHZhciBpID0gMCwgaiA9IDEsIGwgPSAzMjsgaSA8IGw7IGkgKyssIGogKysgKSB7CgoJCQl2YXIgcDEgPSAoIGkgLyBsICkgKiBNYXRoLlBJICogMjsKCQkJdmFyIHAyID0gKCBqIC8gbCApICogTWF0aC5QSSAqIDI7CgoJCQlwb3NpdGlvbnMucHVzaCgKCQkJCU1hdGguY29zKCBwMSApLCBNYXRoLnNpbiggcDEgKSwgMSwKCQkJCU1hdGguY29zKCBwMiApLCBNYXRoLnNpbiggcDIgKSwgMQoJCQkpOwoKCQl9CgoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApICk7CgoJCXZhciBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBmb2c6IGZhbHNlIH0gKTsKCgkJdGhpcy5jb25lID0gbmV3IExpbmVTZWdtZW50cyggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkJdGhpcy5hZGQoIHRoaXMuY29uZSApOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCglTcG90TGlnaHRIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICk7CglTcG90TGlnaHRIZWxwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3BvdExpZ2h0SGVscGVyOwoKCVNwb3RMaWdodEhlbHBlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCgkJdGhpcy5jb25lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmNvbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX07CgoJU3BvdExpZ2h0SGVscGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7CgoJCXZhciB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQlyZXR1cm4gZnVuY3Rpb24gdXBkYXRlKCkgewoKCQkJdGhpcy5saWdodC51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJdmFyIGNvbmVMZW5ndGggPSB0aGlzLmxpZ2h0LmRpc3RhbmNlID8gdGhpcy5saWdodC5kaXN0YW5jZSA6IDEwMDA7CgkJCXZhciBjb25lV2lkdGggPSBjb25lTGVuZ3RoICogTWF0aC50YW4oIHRoaXMubGlnaHQuYW5nbGUgKTsKCgkJCXRoaXMuY29uZS5zY2FsZS5zZXQoIGNvbmVXaWR0aCwgY29uZVdpZHRoLCBjb25lTGVuZ3RoICk7CgoJCQl2ZWN0b3Iuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLmxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoKCQkJdGhpcy5jb25lLmxvb2tBdCggdmVjdG9yICk7CgoJCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLmNvbmUubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuY29uZS5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgoJCQl9CgoJCX07CgoJfSgpOwoKCS8qKgoJICogQGF1dGhvciBTZWFuIEdyaWZmaW4gLyBodHRwOi8vdHdpdHRlci5jb20vc2dyaWYKCSAqIEBhdXRob3IgTWljaGFlbCBHdWVycmVybyAvIGh0dHA6Ly9yZWFsaXR5bWVsdGRvd24uY29tCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBpa2VyciAvIGh0dHA6Ly92ZXJvbGQuY29tCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICovCgoJZnVuY3Rpb24gZ2V0Qm9uZUxpc3QoIG9iamVjdCApIHsKCgkJdmFyIGJvbmVMaXN0ID0gW107CgoJCWlmICggb2JqZWN0ICYmIG9iamVjdC5pc0JvbmUgKSB7CgoJCQlib25lTGlzdC5wdXNoKCBvYmplY3QgKTsKCgkJfQoKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBvYmplY3QuY2hpbGRyZW4ubGVuZ3RoOyBpICsrICkgewoKCQkJYm9uZUxpc3QucHVzaC5hcHBseSggYm9uZUxpc3QsIGdldEJvbmVMaXN0KCBvYmplY3QuY2hpbGRyZW5bIGkgXSApICk7CgoJCX0KCgkJcmV0dXJuIGJvbmVMaXN0OwoKCX0KCglmdW5jdGlvbiBTa2VsZXRvbkhlbHBlciggb2JqZWN0ICkgewoKCQl2YXIgYm9uZXMgPSBnZXRCb25lTGlzdCggb2JqZWN0ICk7CgoJCXZhciBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgY29sb3JzID0gW107CgoJCXZhciBjb2xvcjEgPSBuZXcgQ29sb3IoIDAsIDAsIDEgKTsKCQl2YXIgY29sb3IyID0gbmV3IENvbG9yKCAwLCAxLCAwICk7CgoJCWZvciAoIHZhciBpID0gMDsgaSA8IGJvbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCXZhciBib25lID0gYm9uZXNbIGkgXTsKCgkJCWlmICggYm9uZS5wYXJlbnQgJiYgYm9uZS5wYXJlbnQuaXNCb25lICkgewoKCQkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJCWNvbG9ycy5wdXNoKCBjb2xvcjEuciwgY29sb3IxLmcsIGNvbG9yMS5iICk7CgkJCQljb2xvcnMucHVzaCggY29sb3IyLnIsIGNvbG9yMi5nLCBjb2xvcjIuYiApOwoKCQkJfQoKCQl9CgoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdjb2xvcicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQl2YXIgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgdmVydGV4Q29sb3JzOiBWZXJ0ZXhDb2xvcnMsIGRlcHRoVGVzdDogZmFsc2UsIGRlcHRoV3JpdGU6IGZhbHNlLCB0cmFuc3BhcmVudDogdHJ1ZSB9ICk7CgoJCUxpbmVTZWdtZW50cy5jYWxsKCB0aGlzLCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy5yb290ID0gb2JqZWN0OwoJCXRoaXMuYm9uZXMgPSBib25lczsKCgkJdGhpcy5tYXRyaXggPSBvYmplY3QubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJfQoKCVNrZWxldG9uSGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIExpbmVTZWdtZW50cy5wcm90b3R5cGUgKTsKCVNrZWxldG9uSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNrZWxldG9uSGVscGVyOwoKCVNrZWxldG9uSGVscGVyLnByb3RvdHlwZS51cGRhdGVNYXRyaXhXb3JsZCA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIHZlY3RvciA9IG5ldyBWZWN0b3IzKCk7CgoJCXZhciBib25lTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQl2YXIgbWF0cml4V29ybGRJbnYgPSBuZXcgTWF0cml4NCgpOwoKCQlyZXR1cm4gZnVuY3Rpb24gdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKCQkJdmFyIGJvbmVzID0gdGhpcy5ib25lczsKCgkJCXZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCXZhciBwb3NpdGlvbiA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQkJbWF0cml4V29ybGRJbnYuZ2V0SW52ZXJzZSggdGhpcy5yb290Lm1hdHJpeFdvcmxkICk7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGogPSAwOyBpIDwgYm9uZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCXZhciBib25lID0gYm9uZXNbIGkgXTsKCgkJCQlpZiAoIGJvbmUucGFyZW50ICYmIGJvbmUucGFyZW50LmlzQm9uZSApIHsKCgkJCQkJYm9uZU1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBtYXRyaXhXb3JsZEludiwgYm9uZS5tYXRyaXhXb3JsZCApOwoJCQkJCXZlY3Rvci5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGJvbmVNYXRyaXggKTsKCQkJCQlwb3NpdGlvbi5zZXRYWVooIGosIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnogKTsKCgkJCQkJYm9uZU1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBtYXRyaXhXb3JsZEludiwgYm9uZS5wYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCQl2ZWN0b3Iuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBib25lTWF0cml4ICk7CgkJCQkJcG9zaXRpb24uc2V0WFlaKCBqICsgMSwgdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCQlqICs9IDI7CgoJCQkJfQoKCQkJfQoKCQkJZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICkubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJT2JqZWN0M0QucHJvdG90eXBlLnVwZGF0ZU1hdHJpeFdvcmxkLmNhbGwoIHRoaXMsIGZvcmNlICk7CgoJCX07CgoJfSgpOwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBQb2ludExpZ2h0SGVscGVyKCBsaWdodCwgc3BoZXJlU2l6ZSwgY29sb3IgKSB7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCQl0aGlzLmxpZ2h0LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdmFyIGdlb21ldHJ5ID0gbmV3IFNwaGVyZUJ1ZmZlckdlb21ldHJ5KCBzcGhlcmVTaXplLCA0LCAyICk7CgkJdmFyIG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IHdpcmVmcmFtZTogdHJ1ZSwgZm9nOiBmYWxzZSB9ICk7CgoJCU1lc2guY2FsbCggdGhpcywgZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMubWF0cml4ID0gdGhpcy5saWdodC5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy51cGRhdGUoKTsKCgoJCS8qCgkJdmFyIGRpc3RhbmNlR2VvbWV0cnkgPSBuZXcgVEhSRUUuSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeSggMSwgMiApOwoJCXZhciBkaXN0YW5jZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBoZXhDb2xvciwgZm9nOiBmYWxzZSwgd2lyZWZyYW1lOiB0cnVlLCBvcGFjaXR5OiAwLjEsIHRyYW5zcGFyZW50OiB0cnVlIH0gKTsKCgkJdGhpcy5saWdodFNwaGVyZSA9IG5ldyBUSFJFRS5NZXNoKCBidWxiR2VvbWV0cnksIGJ1bGJNYXRlcmlhbCApOwoJCXRoaXMubGlnaHREaXN0YW5jZSA9IG5ldyBUSFJFRS5NZXNoKCBkaXN0YW5jZUdlb21ldHJ5LCBkaXN0YW5jZU1hdGVyaWFsICk7CgoJCXZhciBkID0gbGlnaHQuZGlzdGFuY2U7CgoJCWlmICggZCA9PT0gMC4wICkgewoKCQkJdGhpcy5saWdodERpc3RhbmNlLnZpc2libGUgPSBmYWxzZTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMubGlnaHREaXN0YW5jZS5zY2FsZS5zZXQoIGQsIGQsIGQgKTsKCgkJfQoKCQl0aGlzLmFkZCggdGhpcy5saWdodERpc3RhbmNlICk7CgkJKi8KCgl9CgoJUG9pbnRMaWdodEhlbHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBNZXNoLnByb3RvdHlwZSApOwoJUG9pbnRMaWdodEhlbHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQb2ludExpZ2h0SGVscGVyOwoKCVBvaW50TGlnaHRIZWxwZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX07CgoJUG9pbnRMaWdodEhlbHBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoKCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLm1hdGVyaWFsLmNvbG9yLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCgkJfQoKCQkvKgoJCXZhciBkID0gdGhpcy5saWdodC5kaXN0YW5jZTsKCgkJaWYgKCBkID09PSAwLjAgKSB7CgoJCQl0aGlzLmxpZ2h0RGlzdGFuY2UudmlzaWJsZSA9IGZhbHNlOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5saWdodERpc3RhbmNlLnZpc2libGUgPSB0cnVlOwoJCQl0aGlzLmxpZ2h0RGlzdGFuY2Uuc2NhbGUuc2V0KCBkLCBkLCBkICk7CgoJCX0KCQkqLwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIGFiZWxuYXRpb24gLyBodHRwOi8vZ2l0aHViLmNvbS9hYmVsbmF0aW9uCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqCgkgKiAgVGhpcyBoZWxwZXIgbXVzdCBiZSBhZGRlZCBhcyBhIGNoaWxkIG9mIHRoZSBsaWdodAoJICovCgoJZnVuY3Rpb24gUmVjdEFyZWFMaWdodEhlbHBlciggbGlnaHQsIGNvbG9yICkgewoKCQl0aGlzLnR5cGUgPSAnUmVjdEFyZWFMaWdodEhlbHBlcic7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCgkJdGhpcy5jb2xvciA9IGNvbG9yOyAvLyBvcHRpb25hbCBoYXJkd2lyZWQgY29sb3IgZm9yIHRoZSBoZWxwZXIKCgkJdmFyIHBvc2l0aW9ucyA9IFsgMSwgMSwgMCwgLSAxLCAxLCAwLCAtIDEsIC0gMSwgMCwgMSwgLSAxLCAwLCAxLCAxLCAwIF07CgoJCXZhciBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApICk7CgkJZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCXZhciBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBmb2c6IGZhbHNlIH0gKTsKCgkJTGluZS5jYWxsKCB0aGlzLCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJLy8KCgkJdmFyIHBvc2l0aW9uczIgPSBbIDEsIDEsIDAsIC0gMSwgMSwgMCwgLSAxLCAtIDEsIDAsIDEsIDEsIDAsIC0gMSwgLSAxLCAwLCAxLCAtIDEsIDAgXTsKCgkJdmFyIGdlb21ldHJ5MiA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5Mi5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMyLCAzICkgKTsKCQlnZW9tZXRyeTIuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCXRoaXMuYWRkKCBuZXcgTWVzaCggZ2VvbWV0cnkyLCBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsgc2lkZTogQmFja1NpZGUsIGZvZzogZmFsc2UgfSApICkgKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJUmVjdEFyZWFMaWdodEhlbHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMaW5lLnByb3RvdHlwZSApOwoJUmVjdEFyZWFMaWdodEhlbHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZWN0QXJlYUxpZ2h0SGVscGVyOwoKCVJlY3RBcmVhTGlnaHRIZWxwZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJdGhpcy5zY2FsZS5zZXQoIDAuNSAqIHRoaXMubGlnaHQud2lkdGgsIDAuNSAqIHRoaXMubGlnaHQuaGVpZ2h0LCAxICk7CgoJCWlmICggdGhpcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCQkJdGhpcy5jaGlsZHJlblsgMCBdLm1hdGVyaWFsLmNvbG9yLnNldCggdGhpcy5jb2xvciApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICkubXVsdGlwbHlTY2FsYXIoIHRoaXMubGlnaHQuaW50ZW5zaXR5ICk7CgoJCQkvLyBwcmV2ZW50IGh1ZSBzaGlmdAoJCQl2YXIgYyA9IHRoaXMubWF0ZXJpYWwuY29sb3I7CgkJCXZhciBtYXggPSBNYXRoLm1heCggYy5yLCBjLmcsIGMuYiApOwoJCQlpZiAoIG1heCA+IDEgKSBjLm11bHRpcGx5U2NhbGFyKCAxIC8gbWF4ICk7CgoJCQl0aGlzLmNoaWxkcmVuWyAwIF0ubWF0ZXJpYWwuY29sb3IuY29weSggdGhpcy5tYXRlcmlhbC5jb2xvciApOwoKCQl9CgoJfTsKCglSZWN0QXJlYUxpZ2h0SGVscGVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCQl0aGlzLmNoaWxkcmVuWyAwIF0uZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMuY2hpbGRyZW5bIDAgXS5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBNdWdlbjg3IC8gaHR0cHM6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCWZ1bmN0aW9uIEhlbWlzcGhlcmVMaWdodEhlbHBlciggbGlnaHQsIHNpemUsIGNvbG9yICkgewoKCQlPYmplY3QzRC5jYWxsKCB0aGlzICk7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCQl0aGlzLmxpZ2h0LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCXRoaXMubWF0cml4ID0gbGlnaHQubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdmFyIGdlb21ldHJ5ID0gbmV3IE9jdGFoZWRyb25CdWZmZXJHZW9tZXRyeSggc2l6ZSApOwoJCWdlb21ldHJ5LnJvdGF0ZVkoIE1hdGguUEkgKiAwLjUgKTsKCgkJdGhpcy5tYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyB3aXJlZnJhbWU6IHRydWUsIGZvZzogZmFsc2UgfSApOwoJCWlmICggdGhpcy5jb2xvciA9PT0gdW5kZWZpbmVkICkgdGhpcy5tYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPSBWZXJ0ZXhDb2xvcnM7CgoJCXZhciBwb3NpdGlvbiA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoJCXZhciBjb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KCBwb3NpdGlvbi5jb3VudCAqIDMgKTsKCgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAnY29sb3InLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQl0aGlzLmFkZCggbmV3IE1lc2goIGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsICkgKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJSGVtaXNwaGVyZUxpZ2h0SGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIE9iamVjdDNELnByb3RvdHlwZSApOwoJSGVtaXNwaGVyZUxpZ2h0SGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEhlbWlzcGhlcmVMaWdodEhlbHBlcjsKCglIZW1pc3BoZXJlTGlnaHRIZWxwZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCXRoaXMuY2hpbGRyZW5bIDAgXS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5jaGlsZHJlblsgMCBdLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9OwoKCUhlbWlzcGhlcmVMaWdodEhlbHBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKCgkJdmFyIGNvbG9yMSA9IG5ldyBDb2xvcigpOwoJCXZhciBjb2xvcjIgPSBuZXcgQ29sb3IoKTsKCgkJcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZSgpIHsKCgkJCXZhciBtZXNoID0gdGhpcy5jaGlsZHJlblsgMCBdOwoKCQkJaWYgKCB0aGlzLmNvbG9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdmFyIGNvbG9ycyA9IG1lc2guZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAnY29sb3InICk7CgoJCQkJY29sb3IxLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCQkJCWNvbG9yMi5jb3B5KCB0aGlzLmxpZ2h0Lmdyb3VuZENvbG9yICk7CgoJCQkJZm9yICggdmFyIGkgPSAwLCBsID0gY29sb3JzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCQkJdmFyIGNvbG9yID0gKCBpIDwgKCBsIC8gMiApICkgPyBjb2xvcjEgOiBjb2xvcjI7CgoJCQkJCWNvbG9ycy5zZXRYWVooIGksIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCgkJCQl9CgoJCQkJY29sb3JzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCW1lc2gubG9va0F0KCB2ZWN0b3Iuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLmxpZ2h0Lm1hdHJpeFdvcmxkICkubmVnYXRlKCkgKTsKCgkJfTsKCgl9KCk7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gR3JpZEhlbHBlciggc2l6ZSwgZGl2aXNpb25zLCBjb2xvcjEsIGNvbG9yMiApIHsKCgkJc2l6ZSA9IHNpemUgfHwgMTA7CgkJZGl2aXNpb25zID0gZGl2aXNpb25zIHx8IDEwOwoJCWNvbG9yMSA9IG5ldyBDb2xvciggY29sb3IxICE9PSB1bmRlZmluZWQgPyBjb2xvcjEgOiAweDQ0NDQ0NCApOwoJCWNvbG9yMiA9IG5ldyBDb2xvciggY29sb3IyICE9PSB1bmRlZmluZWQgPyBjb2xvcjIgOiAweDg4ODg4OCApOwoKCQl2YXIgY2VudGVyID0gZGl2aXNpb25zIC8gMjsKCQl2YXIgc3RlcCA9IHNpemUgLyBkaXZpc2lvbnM7CgkJdmFyIGhhbGZTaXplID0gc2l6ZSAvIDI7CgoJCXZhciB2ZXJ0aWNlcyA9IFtdLCBjb2xvcnMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBqID0gMCwgayA9IC0gaGFsZlNpemU7IGkgPD0gZGl2aXNpb25zOyBpICsrLCBrICs9IHN0ZXAgKSB7CgoJCQl2ZXJ0aWNlcy5wdXNoKCAtIGhhbGZTaXplLCAwLCBrLCBoYWxmU2l6ZSwgMCwgayApOwoJCQl2ZXJ0aWNlcy5wdXNoKCBrLCAwLCAtIGhhbGZTaXplLCBrLCAwLCBoYWxmU2l6ZSApOwoKCQkJdmFyIGNvbG9yID0gaSA9PT0gY2VudGVyID8gY29sb3IxIDogY29sb3IyOwoKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCgkJfQoKCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJdmFyIG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IHZlcnRleENvbG9yczogVmVydGV4Q29sb3JzIH0gKTsKCgkJTGluZVNlZ21lbnRzLmNhbGwoIHRoaXMsIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCX0KCglHcmlkSGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIExpbmVTZWdtZW50cy5wcm90b3R5cGUgKTsKCUdyaWRIZWxwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gR3JpZEhlbHBlcjsKCgkvKioKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwOi8vZ2l0aHViLmNvbS9NdWdlbjg3CgkgKiBAYXV0aG9yIEhlY3RhdGUgLyBodHRwOi8vd3d3LmdpdGh1Yi5jb20vSGVjdGF0ZQoJICovCgoJZnVuY3Rpb24gUG9sYXJHcmlkSGVscGVyKCByYWRpdXMsIHJhZGlhbHMsIGNpcmNsZXMsIGRpdmlzaW9ucywgY29sb3IxLCBjb2xvcjIgKSB7CgoJCXJhZGl1cyA9IHJhZGl1cyB8fCAxMDsKCQlyYWRpYWxzID0gcmFkaWFscyB8fCAxNjsKCQljaXJjbGVzID0gY2lyY2xlcyB8fCA4OwoJCWRpdmlzaW9ucyA9IGRpdmlzaW9ucyB8fCA2NDsKCQljb2xvcjEgPSBuZXcgQ29sb3IoIGNvbG9yMSAhPT0gdW5kZWZpbmVkID8gY29sb3IxIDogMHg0NDQ0NDQgKTsKCQljb2xvcjIgPSBuZXcgQ29sb3IoIGNvbG9yMiAhPT0gdW5kZWZpbmVkID8gY29sb3IyIDogMHg4ODg4ODggKTsKCgkJdmFyIHZlcnRpY2VzID0gW107CgkJdmFyIGNvbG9ycyA9IFtdOwoKCQl2YXIgeCwgejsKCQl2YXIgdiwgaSwgaiwgciwgY29sb3I7CgoJCS8vIGNyZWF0ZSB0aGUgcmFkaWFscwoKCQlmb3IgKCBpID0gMDsgaSA8PSByYWRpYWxzOyBpICsrICkgewoKCQkJdiA9ICggaSAvIHJhZGlhbHMgKSAqICggTWF0aC5QSSAqIDIgKTsKCgkJCXggPSBNYXRoLnNpbiggdiApICogcmFkaXVzOwoJCQl6ID0gTWF0aC5jb3MoIHYgKSAqIHJhZGl1czsKCgkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJdmVydGljZXMucHVzaCggeCwgMCwgeiApOwoKCQkJY29sb3IgPSAoIGkgJiAxICkgPyBjb2xvcjEgOiBjb2xvcjI7CgoJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoKCQl9CgoJCS8vIGNyZWF0ZSB0aGUgY2lyY2xlcwoKCQlmb3IgKCBpID0gMDsgaSA8PSBjaXJjbGVzOyBpICsrICkgewoKCQkJY29sb3IgPSAoIGkgJiAxICkgPyBjb2xvcjEgOiBjb2xvcjI7CgoJCQlyID0gcmFkaXVzIC0gKCByYWRpdXMgLyBjaXJjbGVzICogaSApOwoKCQkJZm9yICggaiA9IDA7IGogPCBkaXZpc2lvbnM7IGogKysgKSB7CgoJCQkJLy8gZmlyc3QgdmVydGV4CgoJCQkJdiA9ICggaiAvIGRpdmlzaW9ucyApICogKCBNYXRoLlBJICogMiApOwoKCQkJCXggPSBNYXRoLnNpbiggdiApICogcjsKCQkJCXogPSBNYXRoLmNvcyggdiApICogcjsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAwLCB6ICk7CgkJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoKCQkJCS8vIHNlY29uZCB2ZXJ0ZXgKCgkJCQl2ID0gKCAoIGogKyAxICkgLyBkaXZpc2lvbnMgKSAqICggTWF0aC5QSSAqIDIgKTsKCgkJCQl4ID0gTWF0aC5zaW4oIHYgKSAqIHI7CgkJCQl6ID0gTWF0aC5jb3MoIHYgKSAqIHI7CgoJCQkJdmVydGljZXMucHVzaCggeCwgMCwgeiApOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCgkJCX0KCgkJfQoKCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJdmFyIG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IHZlcnRleENvbG9yczogVmVydGV4Q29sb3JzIH0gKTsKCgkJTGluZVNlZ21lbnRzLmNhbGwoIHRoaXMsIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCX0KCglQb2xhckdyaWRIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTGluZVNlZ21lbnRzLnByb3RvdHlwZSApOwoJUG9sYXJHcmlkSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBvbGFyR3JpZEhlbHBlcjsKCgkvKioKCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHA6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCWZ1bmN0aW9uIFBvc2l0aW9uYWxBdWRpb0hlbHBlciggYXVkaW8sIHJhbmdlLCBkaXZpc2lvbnNJbm5lckFuZ2xlLCBkaXZpc2lvbnNPdXRlckFuZ2xlICkgewoKCQl0aGlzLmF1ZGlvID0gYXVkaW87CgkJdGhpcy5yYW5nZSA9IHJhbmdlIHx8IDE7CgkJdGhpcy5kaXZpc2lvbnNJbm5lckFuZ2xlID0gZGl2aXNpb25zSW5uZXJBbmdsZSB8fCAxNjsKCQl0aGlzLmRpdmlzaW9uc091dGVyQW5nbGUgPSBkaXZpc2lvbnNPdXRlckFuZ2xlIHx8IDI7CgoJCXZhciBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCXZhciBkaXZpc2lvbnMgPSB0aGlzLmRpdmlzaW9uc0lubmVyQW5nbGUgKyB0aGlzLmRpdmlzaW9uc091dGVyQW5nbGUgKiAyOwoJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KCAoIGRpdmlzaW9ucyAqIDMgKyAzICkgKiAzICk7CgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQl2YXIgbWF0ZXJpYWxJbm5lckFuZ2xlID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweDAwZmYwMCB9ICk7CgkJdmFyIG1hdGVyaWFsT3V0ZXJBbmdsZSA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmMDAgfSApOwoKCQlMaW5lLmNhbGwoIHRoaXMsIGdlb21ldHJ5LCBbIG1hdGVyaWFsT3V0ZXJBbmdsZSwgbWF0ZXJpYWxJbm5lckFuZ2xlIF0gKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJUG9zaXRpb25hbEF1ZGlvSGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIExpbmUucHJvdG90eXBlICk7CglQb3NpdGlvbmFsQXVkaW9IZWxwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUG9zaXRpb25hbEF1ZGlvSGVscGVyOwoKCVBvc2l0aW9uYWxBdWRpb0hlbHBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgYXVkaW8gPSB0aGlzLmF1ZGlvOwoJCXZhciByYW5nZSA9IHRoaXMucmFuZ2U7CgkJdmFyIGRpdmlzaW9uc0lubmVyQW5nbGUgPSB0aGlzLmRpdmlzaW9uc0lubmVyQW5nbGU7CgkJdmFyIGRpdmlzaW9uc091dGVyQW5nbGUgPSB0aGlzLmRpdmlzaW9uc091dGVyQW5nbGU7CgoJCXZhciBjb25lSW5uZXJBbmdsZSA9IF9NYXRoLmRlZ1RvUmFkKCBhdWRpby5wYW5uZXIuY29uZUlubmVyQW5nbGUgKTsKCQl2YXIgY29uZU91dGVyQW5nbGUgPSBfTWF0aC5kZWdUb1JhZCggYXVkaW8ucGFubmVyLmNvbmVPdXRlckFuZ2xlICk7CgoJCXZhciBoYWxmQ29uZUlubmVyQW5nbGUgPSBjb25lSW5uZXJBbmdsZSAvIDI7CgkJdmFyIGhhbGZDb25lT3V0ZXJBbmdsZSA9IGNvbmVPdXRlckFuZ2xlIC8gMjsKCgkJdmFyIHN0YXJ0ID0gMDsKCQl2YXIgY291bnQgPSAwOwoJCXZhciBpLCBzdHJpZGU7CgoJCXZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJdmFyIHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJZ2VvbWV0cnkuY2xlYXJHcm91cHMoKTsKCgkJLy8KCgkJZnVuY3Rpb24gZ2VuZXJhdGVTZWdtZW50KCBmcm9tLCB0bywgZGl2aXNpb25zLCBtYXRlcmlhbEluZGV4ICkgewoKCQkJdmFyIHN0ZXAgPSAoIHRvIC0gZnJvbSApIC8gZGl2aXNpb25zOwoKCQkJcG9zaXRpb25BdHRyaWJ1dGUuc2V0WFlaKCBzdGFydCwgMCwgMCwgMCApOwoJCQljb3VudCArKzsKCgkJCWZvciAoIGkgPSBmcm9tOyBpIDwgdG87IGkgKz0gc3RlcCApIHsKCgkJCQlzdHJpZGUgPSBzdGFydCArIGNvdW50OwoKCQkJCXBvc2l0aW9uQXR0cmlidXRlLnNldFhZWiggc3RyaWRlLCBNYXRoLnNpbiggaSApICogcmFuZ2UsIDAsIE1hdGguY29zKCBpICkgKiByYW5nZSApOwoJCQkJcG9zaXRpb25BdHRyaWJ1dGUuc2V0WFlaKCBzdHJpZGUgKyAxLCBNYXRoLnNpbiggTWF0aC5taW4oIGkgKyBzdGVwLCB0byApICkgKiByYW5nZSwgMCwgTWF0aC5jb3MoIE1hdGgubWluKCBpICsgc3RlcCwgdG8gKSApICogcmFuZ2UgKTsKCQkJCXBvc2l0aW9uQXR0cmlidXRlLnNldFhZWiggc3RyaWRlICsgMiwgMCwgMCwgMCApOwoKCQkJCWNvdW50ICs9IDM7CgoJCQl9CgoJCQlnZW9tZXRyeS5hZGRHcm91cCggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ICk7CgoJCQlzdGFydCArPSBjb3VudDsKCQkJY291bnQgPSAwOwoKCQl9CgoJCS8vCgoJCWdlbmVyYXRlU2VnbWVudCggLSBoYWxmQ29uZU91dGVyQW5nbGUsIC0gaGFsZkNvbmVJbm5lckFuZ2xlLCBkaXZpc2lvbnNPdXRlckFuZ2xlLCAwICk7CgkJZ2VuZXJhdGVTZWdtZW50KCAtIGhhbGZDb25lSW5uZXJBbmdsZSwgaGFsZkNvbmVJbm5lckFuZ2xlLCBkaXZpc2lvbnNJbm5lckFuZ2xlLCAxICk7CgkJZ2VuZXJhdGVTZWdtZW50KCBoYWxmQ29uZUlubmVyQW5nbGUsIGhhbGZDb25lT3V0ZXJBbmdsZSwgZGl2aXNpb25zT3V0ZXJBbmdsZSwgMCApOwoKCQkvLwoKCQlwb3NpdGlvbkF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCWlmICggY29uZUlubmVyQW5nbGUgPT09IGNvbmVPdXRlckFuZ2xlICkgdGhpcy5tYXRlcmlhbFsgMCBdLnZpc2libGUgPSBmYWxzZTsKCgl9OwoKCVBvc2l0aW9uYWxBdWRpb0hlbHBlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbFsgMCBdLmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsWyAxIF0uZGlzcG9zZSgpOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5CgkgKi8KCglmdW5jdGlvbiBGYWNlTm9ybWFsc0hlbHBlciggb2JqZWN0LCBzaXplLCBoZXgsIGxpbmV3aWR0aCApIHsKCgkJLy8gRmFjZU5vcm1hbHNIZWxwZXIgb25seSBzdXBwb3J0cyBUSFJFRS5HZW9tZXRyeQoKCQl0aGlzLm9iamVjdCA9IG9iamVjdDsKCgkJdGhpcy5zaXplID0gKCBzaXplICE9PSB1bmRlZmluZWQgKSA/IHNpemUgOiAxOwoKCQl2YXIgY29sb3IgPSAoIGhleCAhPT0gdW5kZWZpbmVkICkgPyBoZXggOiAweGZmZmYwMDsKCgkJdmFyIHdpZHRoID0gKCBsaW5ld2lkdGggIT09IHVuZGVmaW5lZCApID8gbGluZXdpZHRoIDogMTsKCgkJLy8KCgkJdmFyIG5Ob3JtYWxzID0gMDsKCgkJdmFyIG9iakdlb21ldHJ5ID0gdGhpcy5vYmplY3QuZ2VvbWV0cnk7CgoJCWlmICggb2JqR2VvbWV0cnkgJiYgb2JqR2VvbWV0cnkuaXNHZW9tZXRyeSApIHsKCgkJCW5Ob3JtYWxzID0gb2JqR2VvbWV0cnkuZmFjZXMubGVuZ3RoOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRmFjZU5vcm1hbHNIZWxwZXI6IG9ubHkgVEhSRUUuR2VvbWV0cnkgaXMgc3VwcG9ydGVkLiBVc2UgVEhSRUUuVmVydGV4Tm9ybWFsc0hlbHBlciwgaW5zdGVhZC4nICk7CgoJCX0KCgkJLy8KCgkJdmFyIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbk5vcm1hbHMgKiAyICogMywgMyApOwoKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIHBvc2l0aW9ucyApOwoKCQlMaW5lU2VnbWVudHMuY2FsbCggdGhpcywgZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIGxpbmV3aWR0aDogd2lkdGggfSApICk7CgoJCS8vCgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoJCXRoaXMudXBkYXRlKCk7CgoJfQoKCUZhY2VOb3JtYWxzSGVscGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIExpbmVTZWdtZW50cy5wcm90b3R5cGUgKTsKCUZhY2VOb3JtYWxzSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEZhY2VOb3JtYWxzSGVscGVyOwoKCUZhY2VOb3JtYWxzSGVscGVyLnByb3RvdHlwZS51cGRhdGUgPSAoIGZ1bmN0aW9uICgpIHsKCgkJdmFyIHYxID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgdjIgPSBuZXcgVmVjdG9yMygpOwoJCXZhciBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpOwoKCQlyZXR1cm4gZnVuY3Rpb24gdXBkYXRlKCkgewoKCQkJdGhpcy5vYmplY3QudXBkYXRlTWF0cml4V29ybGQoIHRydWUgKTsKCgkJCW5vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIHRoaXMub2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQl2YXIgbWF0cml4V29ybGQgPSB0aGlzLm9iamVjdC5tYXRyaXhXb3JsZDsKCgkJCXZhciBwb3NpdGlvbiA9IHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCS8vCgoJCQl2YXIgb2JqR2VvbWV0cnkgPSB0aGlzLm9iamVjdC5nZW9tZXRyeTsKCgkJCXZhciB2ZXJ0aWNlcyA9IG9iakdlb21ldHJ5LnZlcnRpY2VzOwoKCQkJdmFyIGZhY2VzID0gb2JqR2VvbWV0cnkuZmFjZXM7CgoJCQl2YXIgaWR4ID0gMDsKCgkJCWZvciAoIHZhciBpID0gMCwgbCA9IGZhY2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJCXZhciBub3JtYWwgPSBmYWNlLm5vcm1hbDsKCgkJCQl2MS5jb3B5KCB2ZXJ0aWNlc1sgZmFjZS5hIF0gKQoJCQkJCS5hZGQoIHZlcnRpY2VzWyBmYWNlLmIgXSApCgkJCQkJLmFkZCggdmVydGljZXNbIGZhY2UuYyBdICkKCQkJCQkuZGl2aWRlU2NhbGFyKCAzICkKCQkJCQkuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQkJCXYyLmNvcHkoIG5vcm1hbCApLmFwcGx5TWF0cml4Myggbm9ybWFsTWF0cml4ICkubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIHRoaXMuc2l6ZSApLmFkZCggdjEgKTsKCgkJCQlwb3NpdGlvbi5zZXRYWVooIGlkeCwgdjEueCwgdjEueSwgdjEueiApOwoKCQkJCWlkeCA9IGlkeCArIDE7CgoJCQkJcG9zaXRpb24uc2V0WFlaKCBpZHgsIHYyLngsIHYyLnksIHYyLnogKTsKCgkJCQlpZHggPSBpZHggKyAxOwoKCQkJfQoKCQkJcG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9OwoKCX0oKSApOwoKCS8qKgoJICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIERpcmVjdGlvbmFsTGlnaHRIZWxwZXIoIGxpZ2h0LCBzaXplLCBjb2xvciApIHsKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQl0aGlzLmxpZ2h0ID0gbGlnaHQ7CgkJdGhpcy5saWdodC51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQl0aGlzLm1hdHJpeCA9IGxpZ2h0Lm1hdHJpeFdvcmxkOwoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNvbG9yID0gY29sb3I7CgoJCWlmICggc2l6ZSA9PT0gdW5kZWZpbmVkICkgc2l6ZSA9IDE7CgoJCXZhciBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIFsKCQkJLSBzaXplLCBzaXplLCAwLAoJCQlzaXplLCBzaXplLCAwLAoJCQlzaXplLCAtIHNpemUsIDAsCgkJCS0gc2l6ZSwgLSBzaXplLCAwLAoJCQktIHNpemUsIHNpemUsIDAKCQldLCAzICkgKTsKCgkJdmFyIG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGZvZzogZmFsc2UgfSApOwoKCQl0aGlzLmxpZ2h0UGxhbmUgPSBuZXcgTGluZSggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkJdGhpcy5hZGQoIHRoaXMubGlnaHRQbGFuZSApOwoKCQlnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIFsgMCwgMCwgMCwgMCwgMCwgMSBdLCAzICkgKTsKCgkJdGhpcy50YXJnZXRMaW5lID0gbmV3IExpbmUoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJCXRoaXMuYWRkKCB0aGlzLnRhcmdldExpbmUgKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJRGlyZWN0aW9uYWxMaWdodEhlbHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBPYmplY3QzRC5wcm90b3R5cGUgKTsKCURpcmVjdGlvbmFsTGlnaHRIZWxwZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRGlyZWN0aW9uYWxMaWdodEhlbHBlcjsKCglEaXJlY3Rpb25hbExpZ2h0SGVscGVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewoKCQl0aGlzLmxpZ2h0UGxhbmUuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubGlnaHRQbGFuZS5tYXRlcmlhbC5kaXNwb3NlKCk7CgkJdGhpcy50YXJnZXRMaW5lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLnRhcmdldExpbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX07CgoJRGlyZWN0aW9uYWxMaWdodEhlbHBlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgdjEgPSBuZXcgVmVjdG9yMygpOwoJCXZhciB2MiA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIHYzID0gbmV3IFZlY3RvcjMoKTsKCgkJcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZSgpIHsKCgkJCXYxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5saWdodC5tYXRyaXhXb3JsZCApOwoJCQl2Mi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgkJCXYzLnN1YlZlY3RvcnMoIHYyLCB2MSApOwoKCQkJdGhpcy5saWdodFBsYW5lLmxvb2tBdCggdjIgKTsKCgkJCWlmICggdGhpcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubGlnaHRQbGFuZS5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCQkJCXRoaXMudGFyZ2V0TGluZS5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5saWdodFBsYW5lLm1hdGVyaWFsLmNvbG9yLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCQkJCXRoaXMudGFyZ2V0TGluZS5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgoJCQl9CgoJCQl0aGlzLnRhcmdldExpbmUubG9va0F0KCB2MiApOwoJCQl0aGlzLnRhcmdldExpbmUuc2NhbGUueiA9IHYzLmxlbmd0aCgpOwoKCQl9OwoKCX0oKTsKCgkvKioKCSAqIEBhdXRob3IgYWx0ZXJlZHEgLyBodHRwOi8vYWx0ZXJlZHF1YWxpYS5jb20vCgkgKiBAYXV0aG9yIE11Z2VuODcgLyBodHRwczovL2dpdGh1Yi5jb20vTXVnZW44NwoJICoKCSAqCS0gc2hvd3MgZnJ1c3R1bSwgbGluZSBvZiBzaWdodCBhbmQgdXAgb2YgdGhlIGNhbWVyYQoJICoJLSBzdWl0YWJsZSBmb3IgZmFzdCB1cGRhdGVzCgkgKiAJLSBiYXNlZCBvbiBmcnVzdHVtIHZpc3VhbGl6YXRpb24gaW4gbGlnaHRnbC5qcyBzaGFkb3dtYXAgZXhhbXBsZQoJICoJCWh0dHA6Ly9ldmFudy5naXRodWIuY29tL2xpZ2h0Z2wuanMvdGVzdHMvc2hhZG93bWFwLmh0bWwKCSAqLwoKCWZ1bmN0aW9uIENhbWVyYUhlbHBlciggY2FtZXJhICkgewoKCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQl2YXIgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCB2ZXJ0ZXhDb2xvcnM6IEZhY2VDb2xvcnMgfSApOwoKCQl2YXIgdmVydGljZXMgPSBbXTsKCQl2YXIgY29sb3JzID0gW107CgoJCXZhciBwb2ludE1hcCA9IHt9OwoKCQkvLyBjb2xvcnMKCgkJdmFyIGNvbG9yRnJ1c3R1bSA9IG5ldyBDb2xvciggMHhmZmFhMDAgKTsKCQl2YXIgY29sb3JDb25lID0gbmV3IENvbG9yKCAweGZmMDAwMCApOwoJCXZhciBjb2xvclVwID0gbmV3IENvbG9yKCAweDAwYWFmZiApOwoJCXZhciBjb2xvclRhcmdldCA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCQl2YXIgY29sb3JDcm9zcyA9IG5ldyBDb2xvciggMHgzMzMzMzMgKTsKCgkJLy8gbmVhcgoKCQlhZGRMaW5lKCAnbjEnLCAnbjInLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjInLCAnbjQnLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjQnLCAnbjMnLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjMnLCAnbjEnLCBjb2xvckZydXN0dW0gKTsKCgkJLy8gZmFyCgoJCWFkZExpbmUoICdmMScsICdmMicsIGNvbG9yRnJ1c3R1bSApOwoJCWFkZExpbmUoICdmMicsICdmNCcsIGNvbG9yRnJ1c3R1bSApOwoJCWFkZExpbmUoICdmNCcsICdmMycsIGNvbG9yRnJ1c3R1bSApOwoJCWFkZExpbmUoICdmMycsICdmMScsIGNvbG9yRnJ1c3R1bSApOwoKCQkvLyBzaWRlcwoKCQlhZGRMaW5lKCAnbjEnLCAnZjEnLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjInLCAnZjInLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjMnLCAnZjMnLCBjb2xvckZydXN0dW0gKTsKCQlhZGRMaW5lKCAnbjQnLCAnZjQnLCBjb2xvckZydXN0dW0gKTsKCgkJLy8gY29uZQoKCQlhZGRMaW5lKCAncCcsICduMScsIGNvbG9yQ29uZSApOwoJCWFkZExpbmUoICdwJywgJ24yJywgY29sb3JDb25lICk7CgkJYWRkTGluZSggJ3AnLCAnbjMnLCBjb2xvckNvbmUgKTsKCQlhZGRMaW5lKCAncCcsICduNCcsIGNvbG9yQ29uZSApOwoKCQkvLyB1cAoKCQlhZGRMaW5lKCAndTEnLCAndTInLCBjb2xvclVwICk7CgkJYWRkTGluZSggJ3UyJywgJ3UzJywgY29sb3JVcCApOwoJCWFkZExpbmUoICd1MycsICd1MScsIGNvbG9yVXAgKTsKCgkJLy8gdGFyZ2V0CgoJCWFkZExpbmUoICdjJywgJ3QnLCBjb2xvclRhcmdldCApOwoJCWFkZExpbmUoICdwJywgJ2MnLCBjb2xvckNyb3NzICk7CgoJCS8vIGNyb3NzCgoJCWFkZExpbmUoICdjbjEnLCAnY24yJywgY29sb3JDcm9zcyApOwoJCWFkZExpbmUoICdjbjMnLCAnY240JywgY29sb3JDcm9zcyApOwoKCQlhZGRMaW5lKCAnY2YxJywgJ2NmMicsIGNvbG9yQ3Jvc3MgKTsKCQlhZGRMaW5lKCAnY2YzJywgJ2NmNCcsIGNvbG9yQ3Jvc3MgKTsKCgkJZnVuY3Rpb24gYWRkTGluZSggYSwgYiwgY29sb3IgKSB7CgoJCQlhZGRQb2ludCggYSwgY29sb3IgKTsKCQkJYWRkUG9pbnQoIGIsIGNvbG9yICk7CgoJCX0KCgkJZnVuY3Rpb24gYWRkUG9pbnQoIGlkLCBjb2xvciApIHsKCgkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJY29sb3JzLnB1c2goIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCgkJCWlmICggcG9pbnRNYXBbIGlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb2ludE1hcFsgaWQgXSA9IFtdOwoKCQkJfQoKCQkJcG9pbnRNYXBbIGlkIF0ucHVzaCggKCB2ZXJ0aWNlcy5sZW5ndGggLyAzICkgLSAxICk7CgoJCX0KCgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGNvbG9ycywgMyApICk7CgoJCUxpbmVTZWdtZW50cy5jYWxsKCB0aGlzLCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy5jYW1lcmEgPSBjYW1lcmE7CgkJaWYgKCB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4ICkgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl0aGlzLm1hdHJpeCA9IGNhbWVyYS5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5wb2ludE1hcCA9IHBvaW50TWFwOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCglDYW1lcmFIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTGluZVNlZ21lbnRzLnByb3RvdHlwZSApOwoJQ2FtZXJhSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENhbWVyYUhlbHBlcjsKCglDYW1lcmFIZWxwZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGdlb21ldHJ5LCBwb2ludE1hcDsKCgkJdmFyIHZlY3RvciA9IG5ldyBWZWN0b3IzKCk7CgkJdmFyIGNhbWVyYSA9IG5ldyBDYW1lcmEoKTsKCgkJZnVuY3Rpb24gc2V0UG9pbnQoIHBvaW50LCB4LCB5LCB6ICkgewoKCQkJdmVjdG9yLnNldCggeCwgeSwgeiApLnVucHJvamVjdCggY2FtZXJhICk7CgoJCQl2YXIgcG9pbnRzID0gcG9pbnRNYXBbIHBvaW50IF07CgoJCQlpZiAoIHBvaW50cyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBwb3NpdGlvbiA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQkJCWZvciAoIHZhciBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQlwb3NpdGlvbi5zZXRYWVooIHBvaW50c1sgaSBdLCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBmdW5jdGlvbiB1cGRhdGUoKSB7CgoJCQlnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCXBvaW50TWFwID0gdGhpcy5wb2ludE1hcDsKCgkJCXZhciB3ID0gMSwgaCA9IDE7CgoJCQkvLyB3ZSBuZWVkIGp1c3QgY2FtZXJhIHByb2plY3Rpb24gbWF0cml4CgkJCS8vIHdvcmxkIG1hdHJpeCBtdXN0IGJlIGlkZW50aXR5CgoJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5jb3B5KCB0aGlzLmNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkvLyBjZW50ZXIgLyB0YXJnZXQKCgkJCXNldFBvaW50KCAnYycsIDAsIDAsIC0gMSApOwoJCQlzZXRQb2ludCggJ3QnLCAwLCAwLCAxICk7CgoJCQkvLyBuZWFyCgoJCQlzZXRQb2ludCggJ24xJywgLSB3LCAtIGgsIC0gMSApOwoJCQlzZXRQb2ludCggJ24yJywgdywgLSBoLCAtIDEgKTsKCQkJc2V0UG9pbnQoICduMycsIC0gdywgaCwgLSAxICk7CgkJCXNldFBvaW50KCAnbjQnLCB3LCBoLCAtIDEgKTsKCgkJCS8vIGZhcgoKCQkJc2V0UG9pbnQoICdmMScsIC0gdywgLSBoLCAxICk7CgkJCXNldFBvaW50KCAnZjInLCB3LCAtIGgsIDEgKTsKCQkJc2V0UG9pbnQoICdmMycsIC0gdywgaCwgMSApOwoJCQlzZXRQb2ludCggJ2Y0JywgdywgaCwgMSApOwoKCQkJLy8gdXAKCgkJCXNldFBvaW50KCAndTEnLCB3ICogMC43LCBoICogMS4xLCAtIDEgKTsKCQkJc2V0UG9pbnQoICd1MicsIC0gdyAqIDAuNywgaCAqIDEuMSwgLSAxICk7CgkJCXNldFBvaW50KCAndTMnLCAwLCBoICogMiwgLSAxICk7CgoJCQkvLyBjcm9zcwoKCQkJc2V0UG9pbnQoICdjZjEnLCAtIHcsIDAsIDEgKTsKCQkJc2V0UG9pbnQoICdjZjInLCB3LCAwLCAxICk7CgkJCXNldFBvaW50KCAnY2YzJywgMCwgLSBoLCAxICk7CgkJCXNldFBvaW50KCAnY2Y0JywgMCwgaCwgMSApOwoKCQkJc2V0UG9pbnQoICdjbjEnLCAtIHcsIDAsIC0gMSApOwoJCQlzZXRQb2ludCggJ2NuMicsIHcsIDAsIC0gMSApOwoJCQlzZXRQb2ludCggJ2NuMycsIDAsIC0gaCwgLSAxICk7CgkJCXNldFBvaW50KCAnY240JywgMCwgaCwgLSAxICk7CgoJCQlnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX07CgoJfSgpOwoKCS8qKgoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KCSAqIEBhdXRob3IgTXVnZW44NyAvIGh0dHA6Ly9naXRodWIuY29tL011Z2VuODcKCSAqLwoKCWZ1bmN0aW9uIEJveEhlbHBlciggb2JqZWN0LCBjb2xvciApIHsKCgkJdGhpcy5vYmplY3QgPSBvYmplY3Q7CgoJCWlmICggY29sb3IgPT09IHVuZGVmaW5lZCApIGNvbG9yID0gMHhmZmZmMDA7CgoJCXZhciBpbmRpY2VzID0gbmV3IFVpbnQxNkFycmF5KCBbIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDAsIDQsIDUsIDUsIDYsIDYsIDcsIDcsIDQsIDAsIDQsIDEsIDUsIDIsIDYsIDMsIDcgXSApOwoJCXZhciBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KCA4ICogMyApOwoKCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRJbmRleCggbmV3IEJ1ZmZlckF0dHJpYnV0ZSggaW5kaWNlcywgMSApICk7CgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQlMaW5lU2VnbWVudHMuY2FsbCggdGhpcywgZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IgfSApICk7CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCglCb3hIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTGluZVNlZ21lbnRzLnByb3RvdHlwZSApOwoJQm94SGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEJveEhlbHBlcjsKCglCb3hIZWxwZXIucHJvdG90eXBlLnVwZGF0ZSA9ICggZnVuY3Rpb24gKCkgewoKCQl2YXIgYm94ID0gbmV3IEJveDMoKTsKCgkJcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0ICkgewoKCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3hIZWxwZXI6IC51cGRhdGUoKSBoYXMgbm8gbG9uZ2VyIGFyZ3VtZW50cy4nICk7CgoJCQl9CgoJCQlpZiAoIHRoaXMub2JqZWN0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJYm94LnNldEZyb21PYmplY3QoIHRoaXMub2JqZWN0ICk7CgoJCQl9CgoJCQlpZiAoIGJveC5pc0VtcHR5KCkgKSByZXR1cm47CgoJCQl2YXIgbWluID0gYm94Lm1pbjsKCQkJdmFyIG1heCA9IGJveC5tYXg7CgoJCQkvKgoJCQkgIDVfX19fNAoJCQkxL19fXzAvfAoJCQl8IDZfX3xfNwoJCQkyL19fXzMvCgoJCQkwOiBtYXgueCwgbWF4LnksIG1heC56CgkJCTE6IG1pbi54LCBtYXgueSwgbWF4LnoKCQkJMjogbWluLngsIG1pbi55LCBtYXguegoJCQkzOiBtYXgueCwgbWluLnksIG1heC56CgkJCTQ6IG1heC54LCBtYXgueSwgbWluLnoKCQkJNTogbWluLngsIG1heC55LCBtaW4uegoJCQk2OiBtaW4ueCwgbWluLnksIG1pbi56CgkJCTc6IG1heC54LCBtaW4ueSwgbWluLnoKCQkJKi8KCgkJCXZhciBwb3NpdGlvbiA9IHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJdmFyIGFycmF5ID0gcG9zaXRpb24uYXJyYXk7CgoJCQlhcnJheVsgMCBdID0gbWF4Lng7IGFycmF5WyAxIF0gPSBtYXgueTsgYXJyYXlbIDIgXSA9IG1heC56OwoJCQlhcnJheVsgMyBdID0gbWluLng7IGFycmF5WyA0IF0gPSBtYXgueTsgYXJyYXlbIDUgXSA9IG1heC56OwoJCQlhcnJheVsgNiBdID0gbWluLng7IGFycmF5WyA3IF0gPSBtaW4ueTsgYXJyYXlbIDggXSA9IG1heC56OwoJCQlhcnJheVsgOSBdID0gbWF4Lng7IGFycmF5WyAxMCBdID0gbWluLnk7IGFycmF5WyAxMSBdID0gbWF4Lno7CgkJCWFycmF5WyAxMiBdID0gbWF4Lng7IGFycmF5WyAxMyBdID0gbWF4Lnk7IGFycmF5WyAxNCBdID0gbWluLno7CgkJCWFycmF5WyAxNSBdID0gbWluLng7IGFycmF5WyAxNiBdID0gbWF4Lnk7IGFycmF5WyAxNyBdID0gbWluLno7CgkJCWFycmF5WyAxOCBdID0gbWluLng7IGFycmF5WyAxOSBdID0gbWluLnk7IGFycmF5WyAyMCBdID0gbWluLno7CgkJCWFycmF5WyAyMSBdID0gbWF4Lng7IGFycmF5WyAyMiBdID0gbWluLnk7IGFycmF5WyAyMyBdID0gbWluLno7CgoJCQlwb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl0aGlzLmdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl9OwoKCX0gKSgpOwoKCUJveEhlbHBlci5wcm90b3R5cGUuc2V0RnJvbU9iamVjdCA9IGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQl0aGlzLm9iamVjdCA9IG9iamVjdDsKCQl0aGlzLnVwZGF0ZSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9OwoKCUJveEhlbHBlci5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uICggc291cmNlICkgewoKCQlMaW5lU2VnbWVudHMucHJvdG90eXBlLmNvcHkuY2FsbCggdGhpcywgc291cmNlICk7CgoJCXRoaXMub2JqZWN0ID0gc291cmNlLm9iamVjdDsKCgkJcmV0dXJuIHRoaXM7CgoJfTsKCglCb3hIZWxwZXIucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgV2VzdExhbmdsZXkgLyBodHRwOi8vZ2l0aHViLmNvbS9XZXN0TGFuZ2xleQoJICovCgoJZnVuY3Rpb24gQm94M0hlbHBlciggYm94LCBoZXggKSB7CgoJCXRoaXMudHlwZSA9ICdCb3gzSGVscGVyJzsKCgkJdGhpcy5ib3ggPSBib3g7CgoJCXZhciBjb2xvciA9ICggaGV4ICE9PSB1bmRlZmluZWQgKSA/IGhleCA6IDB4ZmZmZjAwOwoKCQl2YXIgaW5kaWNlcyA9IG5ldyBVaW50MTZBcnJheSggWyAwLCAxLCAxLCAyLCAyLCAzLCAzLCAwLCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA0LCAwLCA0LCAxLCA1LCAyLCA2LCAzLCA3IF0gKTsKCgkJdmFyIHBvc2l0aW9ucyA9IFsgMSwgMSwgMSwgLSAxLCAxLCAxLCAtIDEsIC0gMSwgMSwgMSwgLSAxLCAxLCAxLCAxLCAtIDEsIC0gMSwgMSwgLSAxLCAtIDEsIC0gMSwgLSAxLCAxLCAtIDEsIC0gMSBdOwoKCQl2YXIgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJZ2VvbWV0cnkuc2V0SW5kZXgoIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGluZGljZXMsIDEgKSApOwoKCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQlMaW5lU2VnbWVudHMuY2FsbCggdGhpcywgZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IgfSApICk7CgoJCXRoaXMuZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJfQoKCUJveDNIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTGluZVNlZ21lbnRzLnByb3RvdHlwZSApOwoJQm94M0hlbHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBCb3gzSGVscGVyOwoKCUJveDNIZWxwZXIucHJvdG90eXBlLnVwZGF0ZU1hdHJpeFdvcmxkID0gZnVuY3Rpb24gKCBmb3JjZSApIHsKCgkJdmFyIGJveCA9IHRoaXMuYm94OwoKCQlpZiAoIGJveC5pc0VtcHR5KCkgKSByZXR1cm47CgoJCWJveC5nZXRDZW50ZXIoIHRoaXMucG9zaXRpb24gKTsKCgkJYm94LmdldFNpemUoIHRoaXMuc2NhbGUgKTsKCgkJdGhpcy5zY2FsZS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCU9iamVjdDNELnByb3RvdHlwZS51cGRhdGVNYXRyaXhXb3JsZC5jYWxsKCB0aGlzLCBmb3JjZSApOwoKCX07CgoJLyoqCgkgKiBAYXV0aG9yIFdlc3RMYW5nbGV5IC8gaHR0cDovL2dpdGh1Yi5jb20vV2VzdExhbmdsZXkKCSAqLwoKCWZ1bmN0aW9uIFBsYW5lSGVscGVyKCBwbGFuZSwgc2l6ZSwgaGV4ICkgewoKCQl0aGlzLnR5cGUgPSAnUGxhbmVIZWxwZXInOwoKCQl0aGlzLnBsYW5lID0gcGxhbmU7CgoJCXRoaXMuc2l6ZSA9ICggc2l6ZSA9PT0gdW5kZWZpbmVkICkgPyAxIDogc2l6ZTsKCgkJdmFyIGNvbG9yID0gKCBoZXggIT09IHVuZGVmaW5lZCApID8gaGV4IDogMHhmZmZmMDA7CgoJCXZhciBwb3NpdGlvbnMgPSBbIDEsIC0gMSwgMSwgLSAxLCAxLCAxLCAtIDEsIC0gMSwgMSwgMSwgMSwgMSwgLSAxLCAxLCAxLCAtIDEsIC0gMSwgMSwgMSwgLSAxLCAxLCAxLCAxLCAxLCAwLCAwLCAxLCAwLCAwLCAwIF07CgoJCXZhciBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApICk7CgkJZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCUxpbmUuY2FsbCggdGhpcywgZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IgfSApICk7CgoJCS8vCgoJCXZhciBwb3NpdGlvbnMyID0gWyAxLCAxLCAxLCAtIDEsIDEsIDEsIC0gMSwgLSAxLCAxLCAxLCAxLCAxLCAtIDEsIC0gMSwgMSwgMSwgLSAxLCAxIF07CgoJCXZhciBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeTIuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zMiwgMyApICk7CgkJZ2VvbWV0cnkyLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl0aGlzLmFkZCggbmV3IE1lc2goIGdlb21ldHJ5MiwgbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvciwgb3BhY2l0eTogMC4yLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UgfSApICkgKTsKCgl9CgoJUGxhbmVIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTGluZS5wcm90b3R5cGUgKTsKCVBsYW5lSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBsYW5lSGVscGVyOwoKCVBsYW5lSGVscGVyLnByb3RvdHlwZS51cGRhdGVNYXRyaXhXb3JsZCA9IGZ1bmN0aW9uICggZm9yY2UgKSB7CgoJCXZhciBzY2FsZSA9IC0gdGhpcy5wbGFuZS5jb25zdGFudDsKCgkJaWYgKCBNYXRoLmFicyggc2NhbGUgKSA8IDFlLTggKSBzY2FsZSA9IDFlLTg7IC8vIHNpZ24gZG9lcyBub3QgbWF0dGVyCgoJCXRoaXMuc2NhbGUuc2V0KCAwLjUgKiB0aGlzLnNpemUsIDAuNSAqIHRoaXMuc2l6ZSwgc2NhbGUgKTsKCgkJdGhpcy5jaGlsZHJlblsgMCBdLm1hdGVyaWFsLnNpZGUgPSAoIHNjYWxlIDwgMCApID8gQmFja1NpZGUgOiBGcm9udFNpZGU7IC8vIHJlbmRlcmVyIGZsaXBzIHNpZGUgd2hlbiBkZXRlcm1pbmFudCA8IDA7IGZsaXBwaW5nIG5vdCB3YW50ZWQgaGVyZQoKCQl0aGlzLmxvb2tBdCggdGhpcy5wbGFuZS5ub3JtYWwgKTsKCgkJT2JqZWN0M0QucHJvdG90eXBlLnVwZGF0ZU1hdHJpeFdvcmxkLmNhbGwoIHRoaXMsIGZvcmNlICk7CgoJfTsKCgkvKioKCSAqIEBhdXRob3IgV2VzdExhbmdsZXkgLyBodHRwOi8vZ2l0aHViLmNvbS9XZXN0TGFuZ2xleQoJICogQGF1dGhvciB6ejg1IC8gaHR0cDovL2dpdGh1Yi5jb20veno4NQoJICogQGF1dGhvciBiaG91c3RvbiAvIGh0dHA6Ly9jbGFyYS5pbwoJICoKCSAqIENyZWF0ZXMgYW4gYXJyb3cgZm9yIHZpc3VhbGl6aW5nIGRpcmVjdGlvbnMKCSAqCgkgKiBQYXJhbWV0ZXJzOgoJICogIGRpciAtIFZlY3RvcjMKCSAqICBvcmlnaW4gLSBWZWN0b3IzCgkgKiAgbGVuZ3RoIC0gTnVtYmVyCgkgKiAgY29sb3IgLSBjb2xvciBpbiBoZXggdmFsdWUKCSAqICBoZWFkTGVuZ3RoIC0gTnVtYmVyCgkgKiAgaGVhZFdpZHRoIC0gTnVtYmVyCgkgKi8KCgl2YXIgbGluZUdlb21ldHJ5LCBjb25lR2VvbWV0cnk7CgoJZnVuY3Rpb24gQXJyb3dIZWxwZXIoIGRpciwgb3JpZ2luLCBsZW5ndGgsIGNvbG9yLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKSB7CgoJCS8vIGRpciBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJT2JqZWN0M0QuY2FsbCggdGhpcyApOwoKCQlpZiAoIGRpciA9PT0gdW5kZWZpbmVkICkgZGlyID0gbmV3IFZlY3RvcjMoIDAsIDAsIDEgKTsKCQlpZiAoIG9yaWdpbiA9PT0gdW5kZWZpbmVkICkgb3JpZ2luID0gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKTsKCQlpZiAoIGxlbmd0aCA9PT0gdW5kZWZpbmVkICkgbGVuZ3RoID0gMTsKCQlpZiAoIGNvbG9yID09PSB1bmRlZmluZWQgKSBjb2xvciA9IDB4ZmZmZjAwOwoJCWlmICggaGVhZExlbmd0aCA9PT0gdW5kZWZpbmVkICkgaGVhZExlbmd0aCA9IDAuMiAqIGxlbmd0aDsKCQlpZiAoIGhlYWRXaWR0aCA9PT0gdW5kZWZpbmVkICkgaGVhZFdpZHRoID0gMC4yICogaGVhZExlbmd0aDsKCgkJaWYgKCBsaW5lR2VvbWV0cnkgPT09IHVuZGVmaW5lZCApIHsKCgkJCWxpbmVHZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCQlsaW5lR2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggWyAwLCAwLCAwLCAwLCAxLCAwIF0sIDMgKSApOwoKCQkJY29uZUdlb21ldHJ5ID0gbmV3IEN5bGluZGVyQnVmZmVyR2VvbWV0cnkoIDAsIDAuNSwgMSwgNSwgMSApOwoJCQljb25lR2VvbWV0cnkudHJhbnNsYXRlKCAwLCAtIDAuNSwgMCApOwoKCQl9CgoJCXRoaXMucG9zaXRpb24uY29weSggb3JpZ2luICk7CgoJCXRoaXMubGluZSA9IG5ldyBMaW5lKCBsaW5lR2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IgfSApICk7CgkJdGhpcy5saW5lLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQl0aGlzLmFkZCggdGhpcy5saW5lICk7CgoJCXRoaXMuY29uZSA9IG5ldyBNZXNoKCBjb25lR2VvbWV0cnksIG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IgfSApICk7CgkJdGhpcy5jb25lLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQl0aGlzLmFkZCggdGhpcy5jb25lICk7CgoJCXRoaXMuc2V0RGlyZWN0aW9uKCBkaXIgKTsKCQl0aGlzLnNldExlbmd0aCggbGVuZ3RoLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKTsKCgl9CgoJQXJyb3dIZWxwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggT2JqZWN0M0QucHJvdG90eXBlICk7CglBcnJvd0hlbHBlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBcnJvd0hlbHBlcjsKCglBcnJvd0hlbHBlci5wcm90b3R5cGUuc2V0RGlyZWN0aW9uID0gKCBmdW5jdGlvbiAoKSB7CgoJCXZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKCQl2YXIgcmFkaWFuczsKCgkJcmV0dXJuIGZ1bmN0aW9uIHNldERpcmVjdGlvbiggZGlyICkgewoKCQkJLy8gZGlyIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKCQkJaWYgKCBkaXIueSA+IDAuOTk5OTkgKSB7CgoJCQkJdGhpcy5xdWF0ZXJuaW9uLnNldCggMCwgMCwgMCwgMSApOwoKCQkJfSBlbHNlIGlmICggZGlyLnkgPCAtIDAuOTk5OTkgKSB7CgoJCQkJdGhpcy5xdWF0ZXJuaW9uLnNldCggMSwgMCwgMCwgMCApOwoKCQkJfSBlbHNlIHsKCgkJCQlheGlzLnNldCggZGlyLnosIDAsIC0gZGlyLnggKS5ub3JtYWxpemUoKTsKCgkJCQlyYWRpYW5zID0gTWF0aC5hY29zKCBkaXIueSApOwoKCQkJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCByYWRpYW5zICk7CgoJCQl9CgoJCX07CgoJfSgpICk7CgoJQXJyb3dIZWxwZXIucHJvdG90eXBlLnNldExlbmd0aCA9IGZ1bmN0aW9uICggbGVuZ3RoLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKSB7CgoJCWlmICggaGVhZExlbmd0aCA9PT0gdW5kZWZpbmVkICkgaGVhZExlbmd0aCA9IDAuMiAqIGxlbmd0aDsKCQlpZiAoIGhlYWRXaWR0aCA9PT0gdW5kZWZpbmVkICkgaGVhZFdpZHRoID0gMC4yICogaGVhZExlbmd0aDsKCgkJdGhpcy5saW5lLnNjYWxlLnNldCggMSwgTWF0aC5tYXgoIDAsIGxlbmd0aCAtIGhlYWRMZW5ndGggKSwgMSApOwoJCXRoaXMubGluZS51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5jb25lLnNjYWxlLnNldCggaGVhZFdpZHRoLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKTsKCQl0aGlzLmNvbmUucG9zaXRpb24ueSA9IGxlbmd0aDsKCQl0aGlzLmNvbmUudXBkYXRlTWF0cml4KCk7CgoJfTsKCglBcnJvd0hlbHBlci5wcm90b3R5cGUuc2V0Q29sb3IgPSBmdW5jdGlvbiAoIGNvbG9yICkgewoKCQl0aGlzLmxpbmUubWF0ZXJpYWwuY29sb3IuY29weSggY29sb3IgKTsKCQl0aGlzLmNvbmUubWF0ZXJpYWwuY29sb3IuY29weSggY29sb3IgKTsKCgl9OwoKCUFycm93SGVscGVyLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKCBzb3VyY2UgKSB7CgoJCU9iamVjdDNELnByb3RvdHlwZS5jb3B5LmNhbGwoIHRoaXMsIHNvdXJjZSwgZmFsc2UgKTsKCgkJdGhpcy5saW5lLmNvcHkoIHNvdXJjZS5saW5lICk7CgkJdGhpcy5jb25lLmNvcHkoIHNvdXJjZS5jb25lICk7CgoJCXJldHVybiB0aGlzOwoKCX07CgoJQXJyb3dIZWxwZXIucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfTsKCgkvKioKCSAqIEBhdXRob3Igc3JvdWNoZXJheSAvIGh0dHA6Ly9zcm91Y2hlcmF5Lm9yZy8KCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20vCgkgKi8KCglmdW5jdGlvbiBBeGVzSGVscGVyKCBzaXplICkgewoKCQlzaXplID0gc2l6ZSB8fCAxOwoKCQl2YXIgdmVydGljZXMgPSBbCgkJCTAsIDAsIDAsCXNpemUsIDAsIDAsCgkJCTAsIDAsIDAsCTAsIHNpemUsIDAsCgkJCTAsIDAsIDAsCTAsIDAsIHNpemUKCQldOwoKCQl2YXIgY29sb3JzID0gWwoJCQkxLCAwLCAwLAkxLCAwLjYsIDAsCgkJCTAsIDEsIDAsCTAuNiwgMSwgMCwKCQkJMCwgMCwgMSwJMCwgMC42LCAxCgkJXTsKCgkJdmFyIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCWdlb21ldHJ5LmFkZEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGNvbG9ycywgMyApICk7CgoJCXZhciBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyB2ZXJ0ZXhDb2xvcnM6IFZlcnRleENvbG9ycyB9ICk7CgoJCUxpbmVTZWdtZW50cy5jYWxsKCB0aGlzLCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgl9CgoJQXhlc0hlbHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBMaW5lU2VnbWVudHMucHJvdG90eXBlICk7CglBeGVzSGVscGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEF4ZXNIZWxwZXI7CgoJLyoqCgkgKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwoJICovCgoJZnVuY3Rpb24gRmFjZTQoIGEsIGIsIGMsIGQsIG5vcm1hbCwgY29sb3IsIG1hdGVyaWFsSW5kZXggKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkZhY2U0IGhhcyBiZWVuIHJlbW92ZWQuIEEgVEhSRUUuRmFjZTMgd2lsbCBiZSBjcmVhdGVkIGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgRmFjZTMoIGEsIGIsIGMsIG5vcm1hbCwgY29sb3IsIG1hdGVyaWFsSW5kZXggKTsKCgl9CgoJdmFyIExpbmVTdHJpcCA9IDA7CgoJdmFyIExpbmVQaWVjZXMgPSAxOwoKCWZ1bmN0aW9uIE1lc2hGYWNlTWF0ZXJpYWwoIG1hdGVyaWFscyApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuTWVzaEZhY2VNYXRlcmlhbCBoYXMgYmVlbiByZW1vdmVkLiBVc2UgYW4gQXJyYXkgaW5zdGVhZC4nICk7CgkJcmV0dXJuIG1hdGVyaWFsczsKCgl9CgoJZnVuY3Rpb24gTXVsdGlNYXRlcmlhbCggbWF0ZXJpYWxzICkgewoKCQlpZiAoIG1hdGVyaWFscyA9PT0gdW5kZWZpbmVkICkgbWF0ZXJpYWxzID0gW107CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLk11bHRpTWF0ZXJpYWwgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIGFuIEFycmF5IGluc3RlYWQuJyApOwoJCW1hdGVyaWFscy5pc011bHRpTWF0ZXJpYWwgPSB0cnVlOwoJCW1hdGVyaWFscy5tYXRlcmlhbHMgPSBtYXRlcmlhbHM7CgkJbWF0ZXJpYWxzLmNsb25lID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIG1hdGVyaWFscy5zbGljZSgpOwoKCQl9OwoJCXJldHVybiBtYXRlcmlhbHM7CgoJfQoKCWZ1bmN0aW9uIFBvaW50Q2xvdWQoIGdlb21ldHJ5LCBtYXRlcmlhbCApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuUG9pbnRDbG91ZCBoYXMgYmVlbiByZW5hbWVkIHRvIFRIUkVFLlBvaW50cy4nICk7CgkJcmV0dXJuIG5ldyBQb2ludHMoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCX0KCglmdW5jdGlvbiBQYXJ0aWNsZSggbWF0ZXJpYWwgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlBhcnRpY2xlIGhhcyBiZWVuIHJlbmFtZWQgdG8gVEhSRUUuU3ByaXRlLicgKTsKCQlyZXR1cm4gbmV3IFNwcml0ZSggbWF0ZXJpYWwgKTsKCgl9CgoJZnVuY3Rpb24gUGFydGljbGVTeXN0ZW0oIGdlb21ldHJ5LCBtYXRlcmlhbCApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuUGFydGljbGVTeXN0ZW0gaGFzIGJlZW4gcmVuYW1lZCB0byBUSFJFRS5Qb2ludHMuJyApOwoJCXJldHVybiBuZXcgUG9pbnRzKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgl9CgoJZnVuY3Rpb24gUG9pbnRDbG91ZE1hdGVyaWFsKCBwYXJhbWV0ZXJzICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5Qb2ludENsb3VkTWF0ZXJpYWwgaGFzIGJlZW4gcmVuYW1lZCB0byBUSFJFRS5Qb2ludHNNYXRlcmlhbC4nICk7CgkJcmV0dXJuIG5ldyBQb2ludHNNYXRlcmlhbCggcGFyYW1ldGVycyApOwoKCX0KCglmdW5jdGlvbiBQYXJ0aWNsZUJhc2ljTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlBhcnRpY2xlQmFzaWNNYXRlcmlhbCBoYXMgYmVlbiByZW5hbWVkIHRvIFRIUkVFLlBvaW50c01hdGVyaWFsLicgKTsKCQlyZXR1cm4gbmV3IFBvaW50c01hdGVyaWFsKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWZ1bmN0aW9uIFBhcnRpY2xlU3lzdGVtTWF0ZXJpYWwoIHBhcmFtZXRlcnMgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlBhcnRpY2xlU3lzdGVtTWF0ZXJpYWwgaGFzIGJlZW4gcmVuYW1lZCB0byBUSFJFRS5Qb2ludHNNYXRlcmlhbC4nICk7CgkJcmV0dXJuIG5ldyBQb2ludHNNYXRlcmlhbCggcGFyYW1ldGVycyApOwoKCX0KCglmdW5jdGlvbiBWZXJ0ZXgoIHgsIHksIHogKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlcnRleCBoYXMgYmVlbiByZW1vdmVkLiBVc2UgVEhSRUUuVmVjdG9yMyBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gbmV3IFZlY3RvcjMoIHgsIHksIHogKTsKCgl9CgoJLy8KCglmdW5jdGlvbiBEeW5hbWljQnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkR5bmFtaWNCdWZmZXJBdHRyaWJ1dGUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoKS5zZXREeW5hbWljKCB0cnVlICkgaW5zdGVhZC4nICk7CgkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApLnNldER5bmFtaWMoIHRydWUgKTsKCgl9CgoJZnVuY3Rpb24gSW50OEF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5JbnQ4QXR0cmlidXRlIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBuZXcgVEhSRUUuSW50OEJ1ZmZlckF0dHJpYnV0ZSgpIGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgSW50OEJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICk7CgoJfQoKCWZ1bmN0aW9uIFVpbnQ4QXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlVpbnQ4QXR0cmlidXRlIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBuZXcgVEhSRUUuVWludDhCdWZmZXJBdHRyaWJ1dGUoKSBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gbmV3IFVpbnQ4QnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKTsKCgl9CgoJZnVuY3Rpb24gVWludDhDbGFtcGVkQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlVpbnQ4Q2xhbXBlZEF0dHJpYnV0ZSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgbmV3IFRIUkVFLlVpbnQ4Q2xhbXBlZEJ1ZmZlckF0dHJpYnV0ZSgpIGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgVWludDhDbGFtcGVkQnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKTsKCgl9CgoJZnVuY3Rpb24gSW50MTZBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuSW50MTZBdHRyaWJ1dGUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5JbnQxNkJ1ZmZlckF0dHJpYnV0ZSgpIGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgSW50MTZCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApOwoKCX0KCglmdW5jdGlvbiBVaW50MTZBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuVWludDE2QXR0cmlidXRlIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBuZXcgVEhSRUUuVWludDE2QnVmZmVyQXR0cmlidXRlKCkgaW5zdGVhZC4nICk7CgkJcmV0dXJuIG5ldyBVaW50MTZCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApOwoKCX0KCglmdW5jdGlvbiBJbnQzMkF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5JbnQzMkF0dHJpYnV0ZSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgbmV3IFRIUkVFLkludDMyQnVmZmVyQXR0cmlidXRlKCkgaW5zdGVhZC4nICk7CgkJcmV0dXJuIG5ldyBJbnQzMkJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICk7CgoJfQoKCWZ1bmN0aW9uIFVpbnQzMkF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5VaW50MzJBdHRyaWJ1dGUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5VaW50MzJCdWZmZXJBdHRyaWJ1dGUoKSBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gbmV3IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplICk7CgoJfQoKCWZ1bmN0aW9uIEZsb2F0MzJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuRmxvYXQzMkF0dHJpYnV0ZSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoKSBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGFycmF5LCBpdGVtU2l6ZSApOwoKCX0KCglmdW5jdGlvbiBGbG9hdDY0QXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkZsb2F0NjRBdHRyaWJ1dGUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5GbG9hdDY0QnVmZmVyQXR0cmlidXRlKCkgaW5zdGVhZC4nICk7CgkJcmV0dXJuIG5ldyBGbG9hdDY0QnVmZmVyQXR0cmlidXRlKCBhcnJheSwgaXRlbVNpemUgKTsKCgl9CgoJLy8KCglDdXJ2ZS5jcmVhdGUgPSBmdW5jdGlvbiAoIGNvbnN0cnVjdCwgZ2V0UG9pbnQgKSB7CgoJCWNvbnNvbGUubG9nKCAnVEhSRUUuQ3VydmUuY3JlYXRlKCkgaGFzIGJlZW4gZGVwcmVjYXRlZCcgKTsKCgkJY29uc3RydWN0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIEN1cnZlLnByb3RvdHlwZSApOwoJCWNvbnN0cnVjdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBjb25zdHJ1Y3Q7CgkJY29uc3RydWN0LnByb3RvdHlwZS5nZXRQb2ludCA9IGdldFBvaW50OwoKCQlyZXR1cm4gY29uc3RydWN0OwoKCX07CgoJLy8KCglPYmplY3QuYXNzaWduKCBDdXJ2ZVBhdGgucHJvdG90eXBlLCB7CgoJCWNyZWF0ZVBvaW50c0dlb21ldHJ5OiBmdW5jdGlvbiAoIGRpdmlzaW9ucyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkN1cnZlUGF0aDogLmNyZWF0ZVBvaW50c0dlb21ldHJ5KCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5HZW9tZXRyeSgpLnNldEZyb21Qb2ludHMoIHBvaW50cyApIGluc3RlYWQuJyApOwoKCQkJLy8gZ2VuZXJhdGUgZ2VvbWV0cnkgZnJvbSBwYXRoIHBvaW50cyAoZm9yIExpbmUgb3IgUG9pbnRzIG9iamVjdHMpCgoJCQl2YXIgcHRzID0gdGhpcy5nZXRQb2ludHMoIGRpdmlzaW9ucyApOwoJCQlyZXR1cm4gdGhpcy5jcmVhdGVHZW9tZXRyeSggcHRzICk7CgoJCX0sCgoJCWNyZWF0ZVNwYWNlZFBvaW50c0dlb21ldHJ5OiBmdW5jdGlvbiAoIGRpdmlzaW9ucyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkN1cnZlUGF0aDogLmNyZWF0ZVNwYWNlZFBvaW50c0dlb21ldHJ5KCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5HZW9tZXRyeSgpLnNldEZyb21Qb2ludHMoIHBvaW50cyApIGluc3RlYWQuJyApOwoKCQkJLy8gZ2VuZXJhdGUgZ2VvbWV0cnkgZnJvbSBlcXVpZGlzdGFudCBzYW1wbGluZyBhbG9uZyB0aGUgcGF0aAoKCQkJdmFyIHB0cyA9IHRoaXMuZ2V0U3BhY2VkUG9pbnRzKCBkaXZpc2lvbnMgKTsKCQkJcmV0dXJuIHRoaXMuY3JlYXRlR2VvbWV0cnkoIHB0cyApOwoKCQl9LAoKCQljcmVhdGVHZW9tZXRyeTogZnVuY3Rpb24gKCBwb2ludHMgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5DdXJ2ZVBhdGg6IC5jcmVhdGVHZW9tZXRyeSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBuZXcgVEhSRUUuR2VvbWV0cnkoKS5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKSBpbnN0ZWFkLicgKTsKCgkJCXZhciBnZW9tZXRyeSA9IG5ldyBHZW9tZXRyeSgpOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdmFyIHBvaW50ID0gcG9pbnRzWyBpIF07CgkJCQlnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKCBuZXcgVmVjdG9yMyggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICkgKTsKCgkJCX0KCgkJCXJldHVybiBnZW9tZXRyeTsKCgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5hc3NpZ24oIFBhdGgucHJvdG90eXBlLCB7CgoJCWZyb21Qb2ludHM6IGZ1bmN0aW9uICggcG9pbnRzICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUGF0aDogLmZyb21Qb2ludHMoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRGcm9tUG9pbnRzKCkuJyApOwoJCQl0aGlzLnNldEZyb21Qb2ludHMoIHBvaW50cyApOwoKCQl9CgoJfSApOwoKCS8vCgoJZnVuY3Rpb24gQ2xvc2VkU3BsaW5lQ3VydmUzKCBwb2ludHMgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNsb3NlZFNwbGluZUN1cnZlMyBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgVEhSRUUuQ2F0bXVsbFJvbUN1cnZlMyBpbnN0ZWFkLicgKTsKCgkJQ2F0bXVsbFJvbUN1cnZlMy5jYWxsKCB0aGlzLCBwb2ludHMgKTsKCQl0aGlzLnR5cGUgPSAnY2F0bXVsbHJvbSc7CgkJdGhpcy5jbG9zZWQgPSB0cnVlOwoKCX0KCglDbG9zZWRTcGxpbmVDdXJ2ZTMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUgKTsKCgkvLwoKCWZ1bmN0aW9uIFNwbGluZUN1cnZlMyggcG9pbnRzICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5TcGxpbmVDdXJ2ZTMgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMgaW5zdGVhZC4nICk7CgoJCUNhdG11bGxSb21DdXJ2ZTMuY2FsbCggdGhpcywgcG9pbnRzICk7CgkJdGhpcy50eXBlID0gJ2NhdG11bGxyb20nOwoKCX0KCglTcGxpbmVDdXJ2ZTMucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUgKTsKCgkvLwoKCWZ1bmN0aW9uIFNwbGluZSggcG9pbnRzICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5TcGxpbmUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMgaW5zdGVhZC4nICk7CgoJCUNhdG11bGxSb21DdXJ2ZTMuY2FsbCggdGhpcywgcG9pbnRzICk7CgkJdGhpcy50eXBlID0gJ2NhdG11bGxyb20nOwoKCX0KCglTcGxpbmUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggQ2F0bXVsbFJvbUN1cnZlMy5wcm90b3R5cGUgKTsKCglPYmplY3QuYXNzaWduKCBTcGxpbmUucHJvdG90eXBlLCB7CgoJCWluaXRGcm9tQXJyYXk6IGZ1bmN0aW9uICggLyogYSAqLyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5TcGxpbmU6IC5pbml0RnJvbUFycmF5KCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0sCgkJZ2V0Q29udHJvbFBvaW50c0FycmF5OiBmdW5jdGlvbiAoIC8qIG9wdGlvbmFsVGFyZ2V0ICovICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlNwbGluZTogLmdldENvbnRyb2xQb2ludHNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCXJlcGFyYW1ldHJpemVCeUFyY0xlbmd0aDogZnVuY3Rpb24gKCAvKiBzYW1wbGluZ0NvZWYgKi8gKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuU3BsaW5lOiAucmVwYXJhbWV0cml6ZUJ5QXJjTGVuZ3RoKCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0KCgl9ICk7CgoJLy8KCglmdW5jdGlvbiBBeGlzSGVscGVyKCBzaXplICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5BeGlzSGVscGVyIGhhcyBiZWVuIHJlbmFtZWQgdG8gVEhSRUUuQXhlc0hlbHBlci4nICk7CgkJcmV0dXJuIG5ldyBBeGVzSGVscGVyKCBzaXplICk7CgoJfQoKCWZ1bmN0aW9uIEJvdW5kaW5nQm94SGVscGVyKCBvYmplY3QsIGNvbG9yICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3VuZGluZ0JveEhlbHBlciBoYXMgYmVlbiBkZXByZWNhdGVkLiBDcmVhdGluZyBhIFRIUkVFLkJveEhlbHBlciBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gbmV3IEJveEhlbHBlciggb2JqZWN0LCBjb2xvciApOwoKCX0KCglmdW5jdGlvbiBFZGdlc0hlbHBlciggb2JqZWN0LCBoZXggKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkVkZ2VzSGVscGVyIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBUSFJFRS5FZGdlc0dlb21ldHJ5IGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgTGluZVNlZ21lbnRzKCBuZXcgRWRnZXNHZW9tZXRyeSggb2JqZWN0Lmdlb21ldHJ5ICksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogaGV4ICE9PSB1bmRlZmluZWQgPyBoZXggOiAweGZmZmZmZiB9ICkgKTsKCgl9CgoJR3JpZEhlbHBlci5wcm90b3R5cGUuc2V0Q29sb3JzID0gZnVuY3Rpb24gKCkgewoKCQljb25zb2xlLmVycm9yKCAnVEhSRUUuR3JpZEhlbHBlcjogc2V0Q29sb3JzKCkgaGFzIGJlZW4gZGVwcmVjYXRlZCwgcGFzcyB0aGVtIGluIHRoZSBjb25zdHJ1Y3RvciBpbnN0ZWFkLicgKTsKCgl9OwoKCVNrZWxldG9uSGVscGVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7CgoJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Ta2VsZXRvbkhlbHBlcjogdXBkYXRlKCkgbm8gbG9uZ2VyIG5lZWRzIHRvIGJlIGNhbGxlZC4nICk7CgoJfTsKCglmdW5jdGlvbiBXaXJlZnJhbWVIZWxwZXIoIG9iamVjdCwgaGV4ICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5XaXJlZnJhbWVIZWxwZXIgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIFRIUkVFLldpcmVmcmFtZUdlb21ldHJ5IGluc3RlYWQuJyApOwoJCXJldHVybiBuZXcgTGluZVNlZ21lbnRzKCBuZXcgV2lyZWZyYW1lR2VvbWV0cnkoIG9iamVjdC5nZW9tZXRyeSApLCBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IGhleCAhPT0gdW5kZWZpbmVkID8gaGV4IDogMHhmZmZmZmYgfSApICk7CgoJfQoKCS8vCgoJT2JqZWN0LmFzc2lnbiggTG9hZGVyLnByb3RvdHlwZSwgewoKCQlleHRyYWN0VXJsQmFzZTogZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Mb2FkZXI6IC5leHRyYWN0VXJsQmFzZSgpIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSBUSFJFRS5Mb2FkZXJVdGlscy5leHRyYWN0VXJsQmFzZSgpIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UoIHVybCApOwoKCQl9CgoJfSApOwoKCWZ1bmN0aW9uIFhIUkxvYWRlciggbWFuYWdlciApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuWEhSTG9hZGVyIGhhcyBiZWVuIHJlbmFtZWQgdG8gVEhSRUUuRmlsZUxvYWRlci4nICk7CgkJcmV0dXJuIG5ldyBGaWxlTG9hZGVyKCBtYW5hZ2VyICk7CgoJfQoKCWZ1bmN0aW9uIEJpbmFyeVRleHR1cmVMb2FkZXIoIG1hbmFnZXIgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJpbmFyeVRleHR1cmVMb2FkZXIgaGFzIGJlZW4gcmVuYW1lZCB0byBUSFJFRS5EYXRhVGV4dHVyZUxvYWRlci4nICk7CgkJcmV0dXJuIG5ldyBEYXRhVGV4dHVyZUxvYWRlciggbWFuYWdlciApOwoKCX0KCglPYmplY3QuYXNzaWduKCBPYmplY3RMb2FkZXIucHJvdG90eXBlLCB7CgoJCXNldFRleHR1cmVQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiAuc2V0VGV4dHVyZVBhdGgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRSZXNvdXJjZVBhdGgoKS4nICk7CgkJCXJldHVybiB0aGlzLnNldFJlc291cmNlUGF0aCggdmFsdWUgKTsKCgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5hc3NpZ24oIEJveDIucHJvdG90eXBlLCB7CgoJCWNlbnRlcjogZnVuY3Rpb24gKCBvcHRpb25hbFRhcmdldCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDI6IC5jZW50ZXIoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRDZW50ZXIoKS4nICk7CgkJCXJldHVybiB0aGlzLmdldENlbnRlciggb3B0aW9uYWxUYXJnZXQgKTsKCgkJfSwKCQllbXB0eTogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94MjogLmVtcHR5KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuaXNFbXB0eSgpLicgKTsKCQkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpOwoKCQl9LAoJCWlzSW50ZXJzZWN0aW9uQm94OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDI6IC5pc0ludGVyc2VjdGlvbkJveCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmludGVyc2VjdHNCb3goKS4nICk7CgkJCXJldHVybiB0aGlzLmludGVyc2VjdHNCb3goIGJveCApOwoKCQl9LAoJCXNpemU6IGZ1bmN0aW9uICggb3B0aW9uYWxUYXJnZXQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3gyOiAuc2l6ZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldFNpemUoKS4nICk7CgkJCXJldHVybiB0aGlzLmdldFNpemUoIG9wdGlvbmFsVGFyZ2V0ICk7CgoJCX0KCX0gKTsKCglPYmplY3QuYXNzaWduKCBCb3gzLnByb3RvdHlwZSwgewoKCQljZW50ZXI6IGZ1bmN0aW9uICggb3B0aW9uYWxUYXJnZXQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3gzOiAuY2VudGVyKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0Q2VudGVyKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXRDZW50ZXIoIG9wdGlvbmFsVGFyZ2V0ICk7CgoJCX0sCgkJZW1wdHk6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJveDM6IC5lbXB0eSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmlzRW1wdHkoKS4nICk7CgkJCXJldHVybiB0aGlzLmlzRW1wdHkoKTsKCgkJfSwKCQlpc0ludGVyc2VjdGlvbkJveDogZnVuY3Rpb24gKCBib3ggKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3gzOiAuaXNJbnRlcnNlY3Rpb25Cb3goKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzQm94KCkuJyApOwoJCQlyZXR1cm4gdGhpcy5pbnRlcnNlY3RzQm94KCBib3ggKTsKCgkJfSwKCQlpc0ludGVyc2VjdGlvblNwaGVyZTogZnVuY3Rpb24gKCBzcGhlcmUgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3gzOiAuaXNJbnRlcnNlY3Rpb25TcGhlcmUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzU3BoZXJlKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5pbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKTsKCgkJfSwKCQlzaXplOiBmdW5jdGlvbiAoIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94MzogLnNpemUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRTaXplKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXRTaXplKCBvcHRpb25hbFRhcmdldCApOwoKCQl9Cgl9ICk7CgoJTGluZTMucHJvdG90eXBlLmNlbnRlciA9IGZ1bmN0aW9uICggb3B0aW9uYWxUYXJnZXQgKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUzOiAuY2VudGVyKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0Q2VudGVyKCkuJyApOwoJCXJldHVybiB0aGlzLmdldENlbnRlciggb3B0aW9uYWxUYXJnZXQgKTsKCgl9OwoKCU9iamVjdC5hc3NpZ24oIF9NYXRoLCB7CgoJCXJhbmRvbTE2OiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRoOiAucmFuZG9tMTYoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgTWF0aC5yYW5kb20oKSBpbnN0ZWFkLicgKTsKCQkJcmV0dXJuIE1hdGgucmFuZG9tKCk7CgoJCX0sCgoJCW5lYXJlc3RQb3dlck9mVHdvOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0aDogLm5lYXJlc3RQb3dlck9mVHdvKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZmxvb3JQb3dlck9mVHdvKCkuJyApOwoJCQlyZXR1cm4gX01hdGguZmxvb3JQb3dlck9mVHdvKCB2YWx1ZSApOwoKCQl9LAoKCQluZXh0UG93ZXJPZlR3bzogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGg6IC5uZXh0UG93ZXJPZlR3bygpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmNlaWxQb3dlck9mVHdvKCkuJyApOwoJCQlyZXR1cm4gX01hdGguY2VpbFBvd2VyT2ZUd28oIHZhbHVlICk7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggTWF0cml4My5wcm90b3R5cGUsIHsKCgkJZmxhdHRlblRvQXJyYXlPZmZzZXQ6IGZ1bmN0aW9uICggYXJyYXksIG9mZnNldCApIHsKCgkJCWNvbnNvbGUud2FybiggIlRIUkVFLk1hdHJpeDM6IC5mbGF0dGVuVG9BcnJheU9mZnNldCgpIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAudG9BcnJheSgpIGluc3RlYWQuIiApOwoJCQlyZXR1cm4gdGhpcy50b0FycmF5KCBhcnJheSwgb2Zmc2V0ICk7CgoJCX0sCgkJbXVsdGlwbHlWZWN0b3IzOiBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDM6IC5tdWx0aXBseVZlY3RvcjMoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgdmVjdG9yLmFwcGx5TWF0cml4MyggbWF0cml4ICkgaW5zdGVhZC4nICk7CgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXgzKCB0aGlzICk7CgoJCX0sCgkJbXVsdGlwbHlWZWN0b3IzQXJyYXk6IGZ1bmN0aW9uICggLyogYSAqLyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NYXRyaXgzOiAubXVsdGlwbHlWZWN0b3IzQXJyYXkoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlhcHBseVRvQnVmZmVyOiBmdW5jdGlvbiAoIGJ1ZmZlciAvKiwgb2Zmc2V0LCBsZW5ndGggKi8gKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRyaXgzOiAuYXBwbHlUb0J1ZmZlcigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBtYXRyaXguYXBwbHlUb0J1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlICkgaW5zdGVhZC4nICk7CgkJCXJldHVybiB0aGlzLmFwcGx5VG9CdWZmZXJBdHRyaWJ1dGUoIGJ1ZmZlciApOwoKCQl9LAoJCWFwcGx5VG9WZWN0b3IzQXJyYXk6IGZ1bmN0aW9uICggLyogYXJyYXksIG9mZnNldCwgbGVuZ3RoICovICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk1hdHJpeDM6IC5hcHBseVRvVmVjdG9yM0FycmF5KCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggTWF0cml4NC5wcm90b3R5cGUsIHsKCgkJZXh0cmFjdFBvc2l0aW9uOiBmdW5jdGlvbiAoIG0gKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRyaXg0OiAuZXh0cmFjdFBvc2l0aW9uKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuY29weVBvc2l0aW9uKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5jb3B5UG9zaXRpb24oIG0gKTsKCgkJfSwKCQlmbGF0dGVuVG9BcnJheU9mZnNldDogZnVuY3Rpb24gKCBhcnJheSwgb2Zmc2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAiVEhSRUUuTWF0cml4NDogLmZsYXR0ZW5Ub0FycmF5T2Zmc2V0KCkgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC50b0FycmF5KCkgaW5zdGVhZC4iICk7CgkJCXJldHVybiB0aGlzLnRvQXJyYXkoIGFycmF5LCBvZmZzZXQgKTsKCgkJfSwKCQlnZXRQb3NpdGlvbjogZnVuY3Rpb24gKCkgewoKCQkJdmFyIHYxOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIGdldFBvc2l0aW9uKCkgewoKCQkJCWlmICggdjEgPT09IHVuZGVmaW5lZCApIHYxID0gbmV3IFZlY3RvcjMoKTsKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDQ6IC5nZXRQb3NpdGlvbigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBWZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbWF0cml4ICkgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdjEuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMyApOwoKCQkJfTsKCgkJfSgpLAoJCXNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb246IGZ1bmN0aW9uICggcSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDQ6IC5zZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oKS4nICk7CgkJCXJldHVybiB0aGlzLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICk7CgoJCX0sCgkJbXVsdGlwbHlUb0FycmF5OiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRyaXg0OiAubXVsdGlwbHlUb0FycmF5KCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0sCgkJbXVsdGlwbHlWZWN0b3IzOiBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVZlY3RvcjMoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgdmVjdG9yLmFwcGx5TWF0cml4NCggbWF0cml4ICkgaW5zdGVhZC4nICk7CgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzICk7CgoJCX0sCgkJbXVsdGlwbHlWZWN0b3I0OiBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdHJpeDQ6IC5tdWx0aXBseVZlY3RvcjQoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgdmVjdG9yLmFwcGx5TWF0cml4NCggbWF0cml4ICkgaW5zdGVhZC4nICk7CgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzICk7CgoJCX0sCgkJbXVsdGlwbHlWZWN0b3IzQXJyYXk6IGZ1bmN0aW9uICggLyogYSAqLyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NYXRyaXg0OiAubXVsdGlwbHlWZWN0b3IzQXJyYXkoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlyb3RhdGVBeGlzOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRyaXg0OiAucm90YXRlQXhpcygpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBWZWN0b3IzLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICkgaW5zdGVhZC4nICk7CgkJCXYudHJhbnNmb3JtRGlyZWN0aW9uKCB0aGlzICk7CgoJCX0sCgkJY3Jvc3NWZWN0b3I6IGZ1bmN0aW9uICggdmVjdG9yICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0cml4NDogLmNyb3NzVmVjdG9yKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHZlY3Rvci5hcHBseU1hdHJpeDQoIG1hdHJpeCApIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCggdGhpcyApOwoKCQl9LAoJCXRyYW5zbGF0ZTogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk1hdHJpeDQ6IC50cmFuc2xhdGUoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlyb3RhdGVYOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTWF0cml4NDogLnJvdGF0ZVgoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlyb3RhdGVZOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTWF0cml4NDogLnJvdGF0ZVkoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlyb3RhdGVaOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTWF0cml4NDogLnJvdGF0ZVooKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCQlyb3RhdGVCeUF4aXM6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NYXRyaXg0OiAucm90YXRlQnlBeGlzKCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0sCgkJYXBwbHlUb0J1ZmZlcjogZnVuY3Rpb24gKCBidWZmZXIgLyosIG9mZnNldCwgbGVuZ3RoICovICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0cml4NDogLmFwcGx5VG9CdWZmZXIoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgbWF0cml4LmFwcGx5VG9CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gdGhpcy5hcHBseVRvQnVmZmVyQXR0cmlidXRlKCBidWZmZXIgKTsKCgkJfSwKCQlhcHBseVRvVmVjdG9yM0FycmF5OiBmdW5jdGlvbiAoIC8qIGFycmF5LCBvZmZzZXQsIGxlbmd0aCAqLyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5NYXRyaXg0OiAuYXBwbHlUb1ZlY3RvcjNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCW1ha2VGcnVzdHVtOiBmdW5jdGlvbiAoIGxlZnQsIHJpZ2h0LCBib3R0b20sIHRvcCwgbmVhciwgZmFyICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0cml4NDogLm1ha2VGcnVzdHVtKCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIC5tYWtlUGVyc3BlY3RpdmUoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgbmVhciwgZmFyICkgaW5zdGVhZC4nICk7CgkJCXJldHVybiB0aGlzLm1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIgKTsKCgkJfQoKCX0gKTsKCglQbGFuZS5wcm90b3R5cGUuaXNJbnRlcnNlY3Rpb25MaW5lID0gZnVuY3Rpb24gKCBsaW5lICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5QbGFuZTogLmlzSW50ZXJzZWN0aW9uTGluZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmludGVyc2VjdHNMaW5lKCkuJyApOwoJCXJldHVybiB0aGlzLmludGVyc2VjdHNMaW5lKCBsaW5lICk7CgoJfTsKCglRdWF0ZXJuaW9uLnByb3RvdHlwZS5tdWx0aXBseVZlY3RvcjMgPSBmdW5jdGlvbiAoIHZlY3RvciApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuUXVhdGVybmlvbjogLm11bHRpcGx5VmVjdG9yMygpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBpcyBub3cgdmVjdG9yLmFwcGx5UXVhdGVybmlvbiggcXVhdGVybmlvbiApIGluc3RlYWQuJyApOwoJCXJldHVybiB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKCB0aGlzICk7CgoJfTsKCglPYmplY3QuYXNzaWduKCBSYXkucHJvdG90eXBlLCB7CgoJCWlzSW50ZXJzZWN0aW9uQm94OiBmdW5jdGlvbiAoIGJveCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlJheTogLmlzSW50ZXJzZWN0aW9uQm94KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuaW50ZXJzZWN0c0JveCgpLicgKTsKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c0JveCggYm94ICk7CgoJCX0sCgkJaXNJbnRlcnNlY3Rpb25QbGFuZTogZnVuY3Rpb24gKCBwbGFuZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlJheTogLmlzSW50ZXJzZWN0aW9uUGxhbmUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5pbnRlcnNlY3RzUGxhbmUoKS4nICk7CgkJCXJldHVybiB0aGlzLmludGVyc2VjdHNQbGFuZSggcGxhbmUgKTsKCgkJfSwKCQlpc0ludGVyc2VjdGlvblNwaGVyZTogZnVuY3Rpb24gKCBzcGhlcmUgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5SYXk6IC5pc0ludGVyc2VjdGlvblNwaGVyZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmludGVyc2VjdHNTcGhlcmUoKS4nICk7CgkJCXJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFRyaWFuZ2xlLnByb3RvdHlwZSwgewoKCQlhcmVhOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmFyZWEoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRBcmVhKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXRBcmVhKCk7CgoJCX0sCgkJYmFyeWNvb3JkRnJvbVBvaW50OiBmdW5jdGlvbiAoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZTogLmJhcnljb29yZEZyb21Qb2ludCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldEJhcnljb29yZCgpLicgKTsKCQkJcmV0dXJuIHRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgdGFyZ2V0ICk7CgoJCX0sCgkJbWlkcG9pbnQ6IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVHJpYW5nbGU6IC5taWRwb2ludCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdldE1pZHBvaW50KCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXRNaWRwb2ludCggdGFyZ2V0ICk7CgoJCX0sCgkJbm9ybWFsOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlRyaWFuZ2xlOiAubm9ybWFsKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0Tm9ybWFsKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXROb3JtYWwoIHRhcmdldCApOwoKCQl9LAoJCXBsYW5lOiBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlRyaWFuZ2xlOiAucGxhbmUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRQbGFuZSgpLicgKTsKCQkJcmV0dXJuIHRoaXMuZ2V0UGxhbmUoIHRhcmdldCApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFRyaWFuZ2xlLCB7CgoJCWJhcnljb29yZEZyb21Qb2ludDogZnVuY3Rpb24gKCBwb2ludCwgYSwgYiwgYywgdGFyZ2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVHJpYW5nbGU6IC5iYXJ5Y29vcmRGcm9tUG9pbnQoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXRCYXJ5Y29vcmQoKS4nICk7CgkJCXJldHVybiBUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCB0YXJnZXQgKTsKCgkJfSwKCQlub3JtYWw6IGZ1bmN0aW9uICggYSwgYiwgYywgdGFyZ2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVHJpYW5nbGU6IC5ub3JtYWwoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5nZXROb3JtYWwoKS4nICk7CgkJCXJldHVybiBUcmlhbmdsZS5nZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFNoYXBlLnByb3RvdHlwZSwgewoKCQlleHRyYWN0QWxsUG9pbnRzOiBmdW5jdGlvbiAoIGRpdmlzaW9ucyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNoYXBlOiAuZXh0cmFjdEFsbFBvaW50cygpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAuZXh0cmFjdFBvaW50cygpIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gdGhpcy5leHRyYWN0UG9pbnRzKCBkaXZpc2lvbnMgKTsKCgkJfSwKCQlleHRydWRlOiBmdW5jdGlvbiAoIG9wdGlvbnMgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5TaGFwZTogLmV4dHJ1ZGUoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgRXh0cnVkZUdlb21ldHJ5KCkgaW5zdGVhZC4nICk7CgkJCXJldHVybiBuZXcgRXh0cnVkZUdlb21ldHJ5KCB0aGlzLCBvcHRpb25zICk7CgoJCX0sCgkJbWFrZUdlb21ldHJ5OiBmdW5jdGlvbiAoIG9wdGlvbnMgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5TaGFwZTogLm1ha2VHZW9tZXRyeSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBTaGFwZUdlb21ldHJ5KCkgaW5zdGVhZC4nICk7CgkJCXJldHVybiBuZXcgU2hhcGVHZW9tZXRyeSggdGhpcywgb3B0aW9ucyApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFZlY3RvcjIucHJvdG90eXBlLCB7CgoJCWZyb21BdHRyaWJ1dGU6IGZ1bmN0aW9uICggYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMjogLmZyb21BdHRyaWJ1dGUoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5mcm9tQnVmZmVyQXR0cmlidXRlKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4LCBvZmZzZXQgKTsKCgkJfSwKCQlkaXN0YW5jZVRvTWFuaGF0dGFuOiBmdW5jdGlvbiAoIHYgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3IyOiAuZGlzdGFuY2VUb01hbmhhdHRhbigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLm1hbmhhdHRhbkRpc3RhbmNlVG8oKS4nICk7CgkJCXJldHVybiB0aGlzLm1hbmhhdHRhbkRpc3RhbmNlVG8oIHYgKTsKCgkJfSwKCQlsZW5ndGhNYW5oYXR0YW46IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjI6IC5sZW5ndGhNYW5oYXR0YW4oKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5tYW5oYXR0YW5MZW5ndGgoKS4nICk7CgkJCXJldHVybiB0aGlzLm1hbmhhdHRhbkxlbmd0aCgpOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIFZlY3RvcjMucHJvdG90eXBlLCB7CgoJCXNldEV1bGVyRnJvbVJvdGF0aW9uTWF0cml4OiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuVmVjdG9yMzogLnNldEV1bGVyRnJvbVJvdGF0aW9uTWF0cml4KCkgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIEV1bGVyLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGluc3RlYWQuJyApOwoKCQl9LAoJCXNldEV1bGVyRnJvbVF1YXRlcm5pb246IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5WZWN0b3IzOiAuc2V0RXVsZXJGcm9tUXVhdGVybmlvbigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBFdWxlci5zZXRGcm9tUXVhdGVybmlvbigpIGluc3RlYWQuJyApOwoKCQl9LAoJCWdldFBvc2l0aW9uRnJvbU1hdHJpeDogZnVuY3Rpb24gKCBtICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMzogLmdldFBvc2l0aW9uRnJvbU1hdHJpeCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnNldEZyb21NYXRyaXhQb3NpdGlvbigpLicgKTsKCQkJcmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBtICk7CgoJCX0sCgkJZ2V0U2NhbGVGcm9tTWF0cml4OiBmdW5jdGlvbiAoIG0gKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3IzOiAuZ2V0U2NhbGVGcm9tTWF0cml4KCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuc2V0RnJvbU1hdHJpeFNjYWxlKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4U2NhbGUoIG0gKTsKCgkJfSwKCQlnZXRDb2x1bW5Gcm9tTWF0cml4OiBmdW5jdGlvbiAoIGluZGV4LCBtYXRyaXggKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3IzOiAuZ2V0Q29sdW1uRnJvbU1hdHJpeCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnNldEZyb21NYXRyaXhDb2x1bW4oKS4nICk7CgkJCXJldHVybiB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG1hdHJpeCwgaW5kZXggKTsKCgkJfSwKCQlhcHBseVByb2plY3Rpb246IGZ1bmN0aW9uICggbSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjM6IC5hcHBseVByb2plY3Rpb24oKSBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLmFwcGx5TWF0cml4NCggbSApIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIG0gKTsKCgkJfSwKCQlmcm9tQXR0cmlidXRlOiBmdW5jdGlvbiAoIGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjM6IC5mcm9tQXR0cmlidXRlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLicgKTsKCQkJcmV0dXJuIHRoaXMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0ICk7CgoJCX0sCgkJZGlzdGFuY2VUb01hbmhhdHRhbjogZnVuY3Rpb24gKCB2ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVmVjdG9yMzogLmRpc3RhbmNlVG9NYW5oYXR0YW4oKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5tYW5oYXR0YW5EaXN0YW5jZVRvKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5tYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICk7CgoJCX0sCgkJbGVuZ3RoTWFuaGF0dGFuOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3IzOiAubGVuZ3RoTWFuaGF0dGFuKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFuaGF0dGFuTGVuZ3RoKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5tYW5oYXR0YW5MZW5ndGgoKTsKCgkJfQoKCX0gKTsKCglPYmplY3QuYXNzaWduKCBWZWN0b3I0LnByb3RvdHlwZSwgewoKCQlmcm9tQXR0cmlidXRlOiBmdW5jdGlvbiAoIGF0dHJpYnV0ZSwgaW5kZXgsIG9mZnNldCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlZlY3RvcjQ6IC5mcm9tQXR0cmlidXRlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSgpLicgKTsKCQkJcmV0dXJuIHRoaXMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCwgb2Zmc2V0ICk7CgoJCX0sCgkJbGVuZ3RoTWFuaGF0dGFuOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5WZWN0b3I0OiAubGVuZ3RoTWFuaGF0dGFuKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAubWFuaGF0dGFuTGVuZ3RoKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5tYW5oYXR0YW5MZW5ndGgoKTsKCgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5hc3NpZ24oIEdlb21ldHJ5LnByb3RvdHlwZSwgewoKCQljb21wdXRlVGFuZ2VudHM6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5HZW9tZXRyeTogLmNvbXB1dGVUYW5nZW50cygpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCWNvbXB1dGVMaW5lRGlzdGFuY2VzOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuR2VvbWV0cnk6IC5jb21wdXRlTGluZURpc3RhbmNlcygpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBUSFJFRS5MaW5lLmNvbXB1dGVMaW5lRGlzdGFuY2VzKCkgaW5zdGVhZC4nICk7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmFzc2lnbiggT2JqZWN0M0QucHJvdG90eXBlLCB7CgoJCWdldENoaWxkQnlOYW1lOiBmdW5jdGlvbiAoIG5hbWUgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3QzRDogLmdldENoaWxkQnlOYW1lKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAuZ2V0T2JqZWN0QnlOYW1lKCkuJyApOwoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeU5hbWUoIG5hbWUgKTsKCgkJfSwKCQlyZW5kZXJEZXB0aDogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0M0Q6IC5yZW5kZXJEZXB0aCBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLnJlbmRlck9yZGVyLCBpbnN0ZWFkLicgKTsKCgkJfSwKCQl0cmFuc2xhdGU6IGZ1bmN0aW9uICggZGlzdGFuY2UsIGF4aXMgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3QzRDogLnRyYW5zbGF0ZSgpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAudHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIGluc3RlYWQuJyApOwoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIGF4aXMsIGRpc3RhbmNlICk7CgoJCX0sCgkJZ2V0V29ybGRSb3RhdGlvbjogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk9iamVjdDNEOiAuZ2V0V29ybGRSb3RhdGlvbigpIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBUSFJFRS5PYmplY3QzRC5nZXRXb3JsZFF1YXRlcm5pb24oIHRhcmdldCApIGluc3RlYWQuJyApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBPYmplY3QzRC5wcm90b3R5cGUsIHsKCgkJZXVsZXJPcmRlcjogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3QzRDogLmV1bGVyT3JkZXIgaXMgbm93IC5yb3RhdGlvbi5vcmRlci4nICk7CgkJCQlyZXR1cm4gdGhpcy5yb3RhdGlvbi5vcmRlcjsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3QzRDogLmV1bGVyT3JkZXIgaXMgbm93IC5yb3RhdGlvbi5vcmRlci4nICk7CgkJCQl0aGlzLnJvdGF0aW9uLm9yZGVyID0gdmFsdWU7CgoJCQl9CgkJfSwKCQl1c2VRdWF0ZXJuaW9uOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdDNEOiAudXNlUXVhdGVybmlvbiBoYXMgYmVlbiByZW1vdmVkLiBUaGUgbGlicmFyeSBub3cgdXNlcyBxdWF0ZXJuaW9ucyBieSBkZWZhdWx0LicgKTsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdDNEOiAudXNlUXVhdGVybmlvbiBoYXMgYmVlbiByZW1vdmVkLiBUaGUgbGlicmFyeSBub3cgdXNlcyBxdWF0ZXJuaW9ucyBieSBkZWZhdWx0LicgKTsKCgkJCX0KCQl9CgoJfSApOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBMT0QucHJvdG90eXBlLCB7CgoJCW9iamVjdHM6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTE9EOiAub2JqZWN0cyBoYXMgYmVlbiByZW5hbWVkIHRvIC5sZXZlbHMuJyApOwoJCQkJcmV0dXJuIHRoaXMubGV2ZWxzOwoKCQkJfQoJCX0KCgl9ICk7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBTa2VsZXRvbi5wcm90b3R5cGUsICd1c2VWZXJ0ZXhUZXh0dXJlJywgewoKCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNrZWxldG9uOiB1c2VWZXJ0ZXhUZXh0dXJlIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuU2tlbGV0b246IHVzZVZlcnRleFRleHR1cmUgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0KCgl9ICk7CgoJU2tpbm5lZE1lc2gucHJvdG90eXBlLmluaXRCb25lcyA9IGZ1bmN0aW9uICgpIHsKCgkJY29uc29sZS5lcnJvciggJ1RIUkVFLlNraW5uZWRNZXNoOiBpbml0Qm9uZXMoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgl9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggQ3VydmUucHJvdG90eXBlLCAnX19hcmNMZW5ndGhEaXZpc2lvbnMnLCB7CgoJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ3VydmU6IC5fX2FyY0xlbmd0aERpdmlzaW9ucyBpcyBub3cgLmFyY0xlbmd0aERpdmlzaW9ucy4nICk7CgkJCXJldHVybiB0aGlzLmFyY0xlbmd0aERpdmlzaW9uczsKCgkJfSwKCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5DdXJ2ZTogLl9fYXJjTGVuZ3RoRGl2aXNpb25zIGlzIG5vdyAuYXJjTGVuZ3RoRGl2aXNpb25zLicgKTsKCQkJdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSB2YWx1ZTsKCgkJfQoKCX0gKTsKCgkvLwoKCVBlcnNwZWN0aXZlQ2FtZXJhLnByb3RvdHlwZS5zZXRMZW5zID0gZnVuY3Rpb24gKCBmb2NhbExlbmd0aCwgZmlsbUdhdWdlICkgewoKCQljb25zb2xlLndhcm4oICJUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYS5zZXRMZW5zIGlzIGRlcHJlY2F0ZWQuICIgKwoJCQkJIlVzZSAuc2V0Rm9jYWxMZW5ndGggYW5kIC5maWxtR2F1Z2UgZm9yIGEgcGhvdG9ncmFwaGljIHNldHVwLiIgKTsKCgkJaWYgKCBmaWxtR2F1Z2UgIT09IHVuZGVmaW5lZCApIHRoaXMuZmlsbUdhdWdlID0gZmlsbUdhdWdlOwoJCXRoaXMuc2V0Rm9jYWxMZW5ndGgoIGZvY2FsTGVuZ3RoICk7CgoJfTsKCgkvLwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBMaWdodC5wcm90b3R5cGUsIHsKCQlvbmx5U2hhZG93OiB7CgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpZ2h0OiAub25seVNoYWRvdyBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCX0KCQl9LAoJCXNoYWRvd0NhbWVyYUZvdjogewoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFGb3YgaXMgbm93IC5zaGFkb3cuY2FtZXJhLmZvdi4nICk7CgkJCQl0aGlzLnNoYWRvdy5jYW1lcmEuZm92ID0gdmFsdWU7CgoJCQl9CgkJfSwKCQlzaGFkb3dDYW1lcmFMZWZ0OiB7CgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5MaWdodDogLnNoYWRvd0NhbWVyYUxlZnQgaXMgbm93IC5zaGFkb3cuY2FtZXJhLmxlZnQuJyApOwoJCQkJdGhpcy5zaGFkb3cuY2FtZXJhLmxlZnQgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXNoYWRvd0NhbWVyYVJpZ2h0OiB7CgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5MaWdodDogLnNoYWRvd0NhbWVyYVJpZ2h0IGlzIG5vdyAuc2hhZG93LmNhbWVyYS5yaWdodC4nICk7CgkJCQl0aGlzLnNoYWRvdy5jYW1lcmEucmlnaHQgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXNoYWRvd0NhbWVyYVRvcDogewoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFUb3AgaXMgbm93IC5zaGFkb3cuY2FtZXJhLnRvcC4nICk7CgkJCQl0aGlzLnNoYWRvdy5jYW1lcmEudG9wID0gdmFsdWU7CgoJCQl9CgkJfSwKCQlzaGFkb3dDYW1lcmFCb3R0b206IHsKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpZ2h0OiAuc2hhZG93Q2FtZXJhQm90dG9tIGlzIG5vdyAuc2hhZG93LmNhbWVyYS5ib3R0b20uJyApOwoJCQkJdGhpcy5zaGFkb3cuY2FtZXJhLmJvdHRvbSA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJc2hhZG93Q2FtZXJhTmVhcjogewoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGlnaHQ6IC5zaGFkb3dDYW1lcmFOZWFyIGlzIG5vdyAuc2hhZG93LmNhbWVyYS5uZWFyLicgKTsKCQkJCXRoaXMuc2hhZG93LmNhbWVyYS5uZWFyID0gdmFsdWU7CgoJCQl9CgkJfSwKCQlzaGFkb3dDYW1lcmFGYXI6IHsKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpZ2h0OiAuc2hhZG93Q2FtZXJhRmFyIGlzIG5vdyAuc2hhZG93LmNhbWVyYS5mYXIuJyApOwoJCQkJdGhpcy5zaGFkb3cuY2FtZXJhLmZhciA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJc2hhZG93Q2FtZXJhVmlzaWJsZTogewoJCQlzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5MaWdodDogLnNoYWRvd0NhbWVyYVZpc2libGUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG5ldyBUSFJFRS5DYW1lcmFIZWxwZXIoIGxpZ2h0LnNoYWRvdy5jYW1lcmEgKSBpbnN0ZWFkLicgKTsKCgkJCX0KCQl9LAoJCXNoYWRvd0JpYXM6IHsKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpZ2h0OiAuc2hhZG93QmlhcyBpcyBub3cgLnNoYWRvdy5iaWFzLicgKTsKCQkJCXRoaXMuc2hhZG93LmJpYXMgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXNoYWRvd0RhcmtuZXNzOiB7CgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpZ2h0OiAuc2hhZG93RGFya25lc3MgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCQl9CgkJfSwKCQlzaGFkb3dNYXBXaWR0aDogewoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGlnaHQ6IC5zaGFkb3dNYXBXaWR0aCBpcyBub3cgLnNoYWRvdy5tYXBTaXplLndpZHRoLicgKTsKCQkJCXRoaXMuc2hhZG93Lm1hcFNpemUud2lkdGggPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXNoYWRvd01hcEhlaWdodDogewoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGlnaHQ6IC5zaGFkb3dNYXBIZWlnaHQgaXMgbm93IC5zaGFkb3cubWFwU2l6ZS5oZWlnaHQuJyApOwoJCQkJdGhpcy5zaGFkb3cubWFwU2l6ZS5oZWlnaHQgPSB2YWx1ZTsKCgkJCX0KCQl9Cgl9ICk7CgoJLy8KCglPYmplY3QuZGVmaW5lUHJvcGVydGllcyggQnVmZmVyQXR0cmlidXRlLnByb3RvdHlwZSwgewoKCQlsZW5ndGg6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiAubGVuZ3RoIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAuY291bnQgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdGhpcy5hcnJheS5sZW5ndGg7CgoJCQl9CgkJfSwKCQljb3B5SW5kaWNlc0FycmF5OiBmdW5jdGlvbiAoIC8qIGluZGljZXMgKi8gKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiAuY29weUluZGljZXNBcnJheSgpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5hc3NpZ24oIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSwgewoKCQlhZGRJbmRleDogZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuYWRkSW5kZXgoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5zZXRJbmRleCgpLicgKTsKCQkJdGhpcy5zZXRJbmRleCggaW5kZXggKTsKCgkJfSwKCQlhZGREcmF3Q2FsbDogZnVuY3Rpb24gKCBzdGFydCwgY291bnQsIGluZGV4T2Zmc2V0ICkgewoKCQkJaWYgKCBpbmRleE9mZnNldCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuYWRkRHJhd0NhbGwoKSBubyBsb25nZXIgc3VwcG9ydHMgaW5kZXhPZmZzZXQuJyApOwoKCQkJfQoJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmFkZERyYXdDYWxsKCkgaXMgbm93IC5hZGRHcm91cCgpLicgKTsKCQkJdGhpcy5hZGRHcm91cCggc3RhcnQsIGNvdW50ICk7CgoJCX0sCgkJY2xlYXJEcmF3Q2FsbHM6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY2xlYXJEcmF3Q2FsbHMoKSBpcyBub3cgLmNsZWFyR3JvdXBzKCkuJyApOwoJCQl0aGlzLmNsZWFyR3JvdXBzKCk7CgoJCX0sCgkJY29tcHV0ZVRhbmdlbnRzOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNvbXB1dGVUYW5nZW50cygpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCWNvbXB1dGVPZmZzZXRzOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNvbXB1dGVPZmZzZXRzKCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0KCgl9ICk7CgoJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIEJ1ZmZlckdlb21ldHJ5LnByb3RvdHlwZSwgewoKCQlkcmF3Y2FsbHM6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuZHJhd2NhbGxzIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmdyb3Vwcy4nICk7CgkJCQlyZXR1cm4gdGhpcy5ncm91cHM7CgoJCQl9CgkJfSwKCQlvZmZzZXRzOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAub2Zmc2V0cyBoYXMgYmVlbiByZW5hbWVkIHRvIC5ncm91cHMuJyApOwoJCQkJcmV0dXJuIHRoaXMuZ3JvdXBzOwoKCQkJfQoJCX0KCgl9ICk7CgoJLy8KCglPYmplY3QuYXNzaWduKCBFeHRydWRlQnVmZmVyR2VvbWV0cnkucHJvdG90eXBlLCB7CgoJCWdldEFycmF5czogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkV4dHJ1ZGVCdWZmZXJHZW9tZXRyeTogLmdldEFycmF5cygpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoKCQlhZGRTaGFwZUxpc3Q6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5FeHRydWRlQnVmZmVyR2VvbWV0cnk6IC5hZGRTaGFwZUxpc3QoKSBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJfSwKCgkJYWRkU2hhcGU6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5FeHRydWRlQnVmZmVyR2VvbWV0cnk6IC5hZGRTaGFwZSgpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9CgoJfSApOwoKCS8vCgoJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIFVuaWZvcm0ucHJvdG90eXBlLCB7CgoJCWR5bmFtaWM6IHsKCQkJc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVW5pZm9ybTogLmR5bmFtaWMgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIG9iamVjdC5vbkJlZm9yZVJlbmRlcigpIGluc3RlYWQuJyApOwoKCQkJfQoJCX0sCgkJb25VcGRhdGU6IHsKCQkJdmFsdWU6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Vbmlmb3JtOiAub25VcGRhdGUoKSBoYXMgYmVlbiByZW1vdmVkLiBVc2Ugb2JqZWN0Lm9uQmVmb3JlUmVuZGVyKCkgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCQl9CgoJfSApOwoKCS8vCgoJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIE1hdGVyaWFsLnByb3RvdHlwZSwgewoKCQl3cmFwQXJvdW5kOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGVyaWFsOiAud3JhcEFyb3VuZCBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGVyaWFsOiAud3JhcEFyb3VuZCBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCX0KCQl9LAoKCQlvdmVyZHJhdzogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRlcmlhbDogLm92ZXJkcmF3IGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0ZXJpYWw6IC5vdmVyZHJhdyBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCX0KCQl9LAoKCQl3cmFwUkdCOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGVyaWFsOiAud3JhcFJHQiBoYXMgYmVlbiByZW1vdmVkLicgKTsKCQkJCXJldHVybiBuZXcgQ29sb3IoKTsKCgkJCX0KCQl9LAoKCQlzaGFkaW5nOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS4nICsgdGhpcy50eXBlICsgJzogLnNoYWRpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHRoZSBib29sZWFuIC5mbGF0U2hhZGluZyBpbnN0ZWFkLicgKTsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS4nICsgdGhpcy50eXBlICsgJzogLnNoYWRpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIHRoZSBib29sZWFuIC5mbGF0U2hhZGluZyBpbnN0ZWFkLicgKTsKCQkJCXRoaXMuZmxhdFNoYWRpbmcgPSAoIHZhbHVlID09PSBGbGF0U2hhZGluZyApOwoKCQkJfQoJCX0KCgl9ICk7CgoJT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIE1lc2hQaG9uZ01hdGVyaWFsLnByb3RvdHlwZSwgewoKCQltZXRhbDogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbDogLm1ldGFsIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1lc2hQaG9uZ01hdGVyaWFsOiAubWV0YWwgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsIGluc3RlYWQnICk7CgoJCQl9CgkJfQoKCX0gKTsKCglPYmplY3QuZGVmaW5lUHJvcGVydGllcyggU2hhZGVyTWF0ZXJpYWwucHJvdG90eXBlLCB7CgoJCWRlcml2YXRpdmVzOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNoYWRlck1hdGVyaWFsOiAuZGVyaXZhdGl2ZXMgaGFzIGJlZW4gbW92ZWQgdG8gLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMuJyApOwoJCQkJcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5kZXJpdmF0aXZlczsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS4gU2hhZGVyTWF0ZXJpYWw6IC5kZXJpdmF0aXZlcyBoYXMgYmVlbiBtb3ZlZCB0byAuZXh0ZW5zaW9ucy5kZXJpdmF0aXZlcy4nICk7CgkJCQl0aGlzLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMgPSB2YWx1ZTsKCgkJCX0KCQl9CgoJfSApOwoKCS8vCgoJT2JqZWN0LmFzc2lnbiggV2ViR0xSZW5kZXJlci5wcm90b3R5cGUsIHsKCgkJY2xlYXJUYXJnZXQ6IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuY2xlYXJUYXJnZXQoKSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLnNldFJlbmRlclRhcmdldCgpIGFuZCAuY2xlYXIoKSBpbnN0ZWFkLicgKTsKCQkJdGhpcy5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApOwoJCQl0aGlzLmNsZWFyKCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwgKTsKCgkJfSwKCgkJYW5pbWF0ZTogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5hbmltYXRlKCkgaXMgbm93IC5zZXRBbmltYXRpb25Mb29wKCkuJyApOwoJCQl0aGlzLnNldEFuaW1hdGlvbkxvb3AoIGNhbGxiYWNrICk7CgoJCX0sCgoJCWdldEN1cnJlbnRSZW5kZXJUYXJnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5nZXRDdXJyZW50UmVuZGVyVGFyZ2V0KCkgaXMgbm93IC5nZXRSZW5kZXJUYXJnZXQoKS4nICk7CgkJCXJldHVybiB0aGlzLmdldFJlbmRlclRhcmdldCgpOwoKCQl9LAoKCQlnZXRNYXhBbmlzb3Ryb3B5OiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuZ2V0TWF4QW5pc290cm9weSgpIGlzIG5vdyAuY2FwYWJpbGl0aWVzLmdldE1heEFuaXNvdHJvcHkoKS4nICk7CgkJCXJldHVybiB0aGlzLmNhcGFiaWxpdGllcy5nZXRNYXhBbmlzb3Ryb3B5KCk7CgoJCX0sCgoJCWdldFByZWNpc2lvbjogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLmdldFByZWNpc2lvbigpIGlzIG5vdyAuY2FwYWJpbGl0aWVzLnByZWNpc2lvbi4nICk7CgkJCXJldHVybiB0aGlzLmNhcGFiaWxpdGllcy5wcmVjaXNpb247CgoJCX0sCgoJCXJlc2V0R0xTdGF0ZTogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnJlc2V0R0xTdGF0ZSgpIGlzIG5vdyAuc3RhdGUucmVzZXQoKS4nICk7CgkJCXJldHVybiB0aGlzLnN0YXRlLnJlc2V0KCk7CgoJCX0sCgoJCXN1cHBvcnRzRmxvYXRUZXh0dXJlczogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzRmxvYXRUZXh0dXJlcygpIGlzIG5vdyAuZXh0ZW5zaW9ucy5nZXQoIFwnT0VTX3RleHR1cmVfZmxvYXRcJyApLicgKTsKCQkJcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoICdPRVNfdGV4dHVyZV9mbG9hdCcgKTsKCgkJfSwKCQlzdXBwb3J0c0hhbGZGbG9hdFRleHR1cmVzOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc3VwcG9ydHNIYWxmRmxvYXRUZXh0dXJlcygpIGlzIG5vdyAuZXh0ZW5zaW9ucy5nZXQoIFwnT0VTX3RleHR1cmVfaGFsZl9mbG9hdFwnICkuJyApOwoJCQlyZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXQnICk7CgoJCX0sCgkJc3VwcG9ydHNTdGFuZGFyZERlcml2YXRpdmVzOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc3VwcG9ydHNTdGFuZGFyZERlcml2YXRpdmVzKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggXCdPRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXNcJyApLicgKTsKCQkJcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoICdPRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMnICk7CgoJCX0sCgkJc3VwcG9ydHNDb21wcmVzc2VkVGV4dHVyZVMzVEM6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zdXBwb3J0c0NvbXByZXNzZWRUZXh0dXJlUzNUQygpIGlzIG5vdyAuZXh0ZW5zaW9ucy5nZXQoIFwnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGNcJyApLicgKTsKCQkJcmV0dXJuIHRoaXMuZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCgkJfSwKCQlzdXBwb3J0c0NvbXByZXNzZWRUZXh0dXJlUFZSVEM6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zdXBwb3J0c0NvbXByZXNzZWRUZXh0dXJlUFZSVEMoKSBpcyBub3cgLmV4dGVuc2lvbnMuZ2V0KCBcJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0Y1wnICkuJyApOwoJCQlyZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCgkJfSwKCQlzdXBwb3J0c0JsZW5kTWluTWF4OiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc3VwcG9ydHNCbGVuZE1pbk1heCgpIGlzIG5vdyAuZXh0ZW5zaW9ucy5nZXQoIFwnRVhUX2JsZW5kX21pbm1heFwnICkuJyApOwoJCQlyZXR1cm4gdGhpcy5leHRlbnNpb25zLmdldCggJ0VYVF9ibGVuZF9taW5tYXgnICk7CgoJCX0sCgkJc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlczogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzVmVydGV4VGV4dHVyZXMoKSBpcyBub3cgLmNhcGFiaWxpdGllcy52ZXJ0ZXhUZXh0dXJlcy4nICk7CgkJCXJldHVybiB0aGlzLmNhcGFiaWxpdGllcy52ZXJ0ZXhUZXh0dXJlczsKCgkJfSwKCQlzdXBwb3J0c0luc3RhbmNlZEFycmF5czogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnN1cHBvcnRzSW5zdGFuY2VkQXJyYXlzKCkgaXMgbm93IC5leHRlbnNpb25zLmdldCggXCdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzXCcgKS4nICk7CgkJCXJldHVybiB0aGlzLmV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCgkJfSwKCQllbmFibGVTY2lzc29yVGVzdDogZnVuY3Rpb24gKCBib29sZWFuICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLmVuYWJsZVNjaXNzb3JUZXN0KCkgaXMgbm93IC5zZXRTY2lzc29yVGVzdCgpLicgKTsKCQkJdGhpcy5zZXRTY2lzc29yVGVzdCggYm9vbGVhbiApOwoKCQl9LAoJCWluaXRNYXRlcmlhbDogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLmluaXRNYXRlcmlhbCgpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCWFkZFByZVBsdWdpbjogZnVuY3Rpb24gKCkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLmFkZFByZVBsdWdpbigpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9LAoJCWFkZFBvc3RQbHVnaW46IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5hZGRQb3N0UGx1Z2luKCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0sCgkJdXBkYXRlU2hhZG93TWFwOiBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAudXBkYXRlU2hhZG93TWFwKCkgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCX0sCgkJc2V0RmFjZUN1bGxpbmc6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zZXRGYWNlQ3VsbGluZygpIGhhcyBiZWVuIHJlbW92ZWQuJyApOwoKCQl9CgoJfSApOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBXZWJHTFJlbmRlcmVyLnByb3RvdHlwZSwgewoKCQlzaGFkb3dNYXBFbmFibGVkOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB0aGlzLnNoYWRvd01hcC5lbmFibGVkOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXBFbmFibGVkIGlzIG5vdyAuc2hhZG93TWFwLmVuYWJsZWQuJyApOwoJCQkJdGhpcy5zaGFkb3dNYXAuZW5hYmxlZCA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJc2hhZG93TWFwVHlwZTogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gdGhpcy5zaGFkb3dNYXAudHlwZTsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc2hhZG93TWFwVHlwZSBpcyBub3cgLnNoYWRvd01hcC50eXBlLicgKTsKCQkJCXRoaXMuc2hhZG93TWFwLnR5cGUgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXNoYWRvd01hcEN1bGxGYWNlOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXBDdWxsRmFjZSBoYXMgYmVlbiByZW1vdmVkLiBTZXQgTWF0ZXJpYWwuc2hhZG93U2lkZSBpbnN0ZWFkLicgKTsKCQkJCXJldHVybiB1bmRlZmluZWQ7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggLyogdmFsdWUgKi8gKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcEN1bGxGYWNlIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuJyApOwoKCQkJfQoJCX0KCX0gKTsKCglPYmplY3QuZGVmaW5lUHJvcGVydGllcyggV2ViR0xTaGFkb3dNYXAucHJvdG90eXBlLCB7CgoJCWN1bGxGYWNlOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXAuY3VsbEZhY2UgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IE1hdGVyaWFsLnNoYWRvd1NpZGUgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIC8qIGN1bGxGYWNlICovICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXAuY3VsbEZhY2UgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IE1hdGVyaWFsLnNoYWRvd1NpZGUgaW5zdGVhZC4nICk7CgoJCQl9CgkJfSwKCQlyZW5kZXJSZXZlcnNlU2lkZWQ6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcC5yZW5kZXJSZXZlcnNlU2lkZWQgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IE1hdGVyaWFsLnNoYWRvd1NpZGUgaW5zdGVhZC4nICk7CgkJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogLnNoYWRvd01hcC5yZW5kZXJSZXZlcnNlU2lkZWQgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IE1hdGVyaWFsLnNoYWRvd1NpZGUgaW5zdGVhZC4nICk7CgoJCQl9CgkJfSwKCQlyZW5kZXJTaW5nbGVTaWRlZDogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAuc2hhZG93TWFwLnJlbmRlclNpbmdsZVNpZGVkIGhhcyBiZWVuIHJlbW92ZWQuIFNldCBNYXRlcmlhbC5zaGFkb3dTaWRlIGluc3RlYWQuJyApOwoJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IC5zaGFkb3dNYXAucmVuZGVyU2luZ2xlU2lkZWQgaGFzIGJlZW4gcmVtb3ZlZC4gU2V0IE1hdGVyaWFsLnNoYWRvd1NpZGUgaW5zdGVhZC4nICk7CgoJCQl9CgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBXZWJHTFJlbmRlclRhcmdldEN1YmUucHJvdG90eXBlLCB7CgoJCWFjdGl2ZUN1YmVGYWNlOiB7CgkJCXNldDogZnVuY3Rpb24gKCAvKiB2YWx1ZSAqLyApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldEN1YmU6IC5hY3RpdmVDdWJlRmFjZSBoYXMgYmVlbiByZW1vdmVkLiBJdCBpcyBub3cgdGhlIHNlY29uZCBwYXJhbWV0ZXIgb2YgV2ViR0xSZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoKS4nICk7CgoJCQl9CgkJfSwKCQlhY3RpdmVNaXBNYXBMZXZlbDogewoJCQlzZXQ6IGZ1bmN0aW9uICggLyogdmFsdWUgKi8gKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXRDdWJlOiAuYWN0aXZlTWlwTWFwTGV2ZWwgaGFzIGJlZW4gcmVtb3ZlZC4gSXQgaXMgbm93IHRoZSB0aGlyZCBwYXJhbWV0ZXIgb2YgV2ViR0xSZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoKS4nICk7CgoJCQl9CgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBXZWJHTFJlbmRlclRhcmdldC5wcm90b3R5cGUsIHsKCgkJd3JhcFM6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC53cmFwUyBpcyBub3cgLnRleHR1cmUud3JhcFMuJyApOwoJCQkJcmV0dXJuIHRoaXMudGV4dHVyZS53cmFwUzsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLndyYXBTIGlzIG5vdyAudGV4dHVyZS53cmFwUy4nICk7CgkJCQl0aGlzLnRleHR1cmUud3JhcFMgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCXdyYXBUOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAud3JhcFQgaXMgbm93IC50ZXh0dXJlLndyYXBULicgKTsKCQkJCXJldHVybiB0aGlzLnRleHR1cmUud3JhcFQ7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC53cmFwVCBpcyBub3cgLnRleHR1cmUud3JhcFQuJyApOwoJCQkJdGhpcy50ZXh0dXJlLndyYXBUID0gdmFsdWU7CgoJCQl9CgkJfSwKCQltYWdGaWx0ZXI6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5tYWdGaWx0ZXIgaXMgbm93IC50ZXh0dXJlLm1hZ0ZpbHRlci4nICk7CgkJCQlyZXR1cm4gdGhpcy50ZXh0dXJlLm1hZ0ZpbHRlcjsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLm1hZ0ZpbHRlciBpcyBub3cgLnRleHR1cmUubWFnRmlsdGVyLicgKTsKCQkJCXRoaXMudGV4dHVyZS5tYWdGaWx0ZXIgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCW1pbkZpbHRlcjogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLm1pbkZpbHRlciBpcyBub3cgLnRleHR1cmUubWluRmlsdGVyLicgKTsKCQkJCXJldHVybiB0aGlzLnRleHR1cmUubWluRmlsdGVyOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAubWluRmlsdGVyIGlzIG5vdyAudGV4dHVyZS5taW5GaWx0ZXIuJyApOwoJCQkJdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJYW5pc290cm9weTogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLmFuaXNvdHJvcHkgaXMgbm93IC50ZXh0dXJlLmFuaXNvdHJvcHkuJyApOwoJCQkJcmV0dXJuIHRoaXMudGV4dHVyZS5hbmlzb3Ryb3B5OwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAuYW5pc290cm9weSBpcyBub3cgLnRleHR1cmUuYW5pc290cm9weS4nICk7CgkJCQl0aGlzLnRleHR1cmUuYW5pc290cm9weSA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJb2Zmc2V0OiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAub2Zmc2V0IGlzIG5vdyAudGV4dHVyZS5vZmZzZXQuJyApOwoJCQkJcmV0dXJuIHRoaXMudGV4dHVyZS5vZmZzZXQ7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5vZmZzZXQgaXMgbm93IC50ZXh0dXJlLm9mZnNldC4nICk7CgkJCQl0aGlzLnRleHR1cmUub2Zmc2V0ID0gdmFsdWU7CgoJCQl9CgkJfSwKCQlyZXBlYXQ6IHsKCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5yZXBlYXQgaXMgbm93IC50ZXh0dXJlLnJlcGVhdC4nICk7CgkJCQlyZXR1cm4gdGhpcy50ZXh0dXJlLnJlcGVhdDsKCgkJCX0sCgkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnJlcGVhdCBpcyBub3cgLnRleHR1cmUucmVwZWF0LicgKTsKCQkJCXRoaXMudGV4dHVyZS5yZXBlYXQgPSB2YWx1ZTsKCgkJCX0KCQl9LAoJCWZvcm1hdDogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLmZvcm1hdCBpcyBub3cgLnRleHR1cmUuZm9ybWF0LicgKTsKCQkJCXJldHVybiB0aGlzLnRleHR1cmUuZm9ybWF0OwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAuZm9ybWF0IGlzIG5vdyAudGV4dHVyZS5mb3JtYXQuJyApOwoJCQkJdGhpcy50ZXh0dXJlLmZvcm1hdCA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJdHlwZTogewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogLnR5cGUgaXMgbm93IC50ZXh0dXJlLnR5cGUuJyApOwoJCQkJcmV0dXJuIHRoaXMudGV4dHVyZS50eXBlOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAudHlwZSBpcyBub3cgLnRleHR1cmUudHlwZS4nICk7CgkJCQl0aGlzLnRleHR1cmUudHlwZSA9IHZhbHVlOwoKCQkJfQoJCX0sCgkJZ2VuZXJhdGVNaXBtYXBzOiB7CgkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiAuZ2VuZXJhdGVNaXBtYXBzIGlzIG5vdyAudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMuJyApOwoJCQkJcmV0dXJuIHRoaXMudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHM7CgoJCQl9LAoJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJUYXJnZXQ6IC5nZW5lcmF0ZU1pcG1hcHMgaXMgbm93IC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcy4nICk7CgkJCQl0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gdmFsdWU7CgoJCQl9CgkJfQoKCX0gKTsKCgkvLwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBXZWJWUk1hbmFnZXIucHJvdG90eXBlLCB7CgoJCXN0YW5kaW5nOiB7CgkJCXNldDogZnVuY3Rpb24gKCAvKiB2YWx1ZSAqLyApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJWUk1hbmFnZXI6IC5zdGFuZGluZyBoYXMgYmVlbiByZW1vdmVkLicgKTsKCgkJCX0KCQl9LAoJCXVzZXJIZWlnaHQ6IHsKCQkJc2V0OiBmdW5jdGlvbiAoIC8qIHZhbHVlICovICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYlZSTWFuYWdlcjogLnVzZXJIZWlnaHQgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJCQl9CgkJfQoKCX0gKTsKCgkvLwoKCUF1ZGlvLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKCBmaWxlICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogLmxvYWQgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIFRIUkVFLkF1ZGlvTG9hZGVyIGluc3RlYWQuJyApOwoJCXZhciBzY29wZSA9IHRoaXM7CgkJdmFyIGF1ZGlvTG9hZGVyID0gbmV3IEF1ZGlvTG9hZGVyKCk7CgkJYXVkaW9Mb2FkZXIubG9hZCggZmlsZSwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQlzY29wZS5zZXRCdWZmZXIoIGJ1ZmZlciApOwoKCQl9ICk7CgkJcmV0dXJuIHRoaXM7CgoJfTsKCglBdWRpb0FuYWx5c2VyLnByb3RvdHlwZS5nZXREYXRhID0gZnVuY3Rpb24gKCkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpb0FuYWx5c2VyOiAuZ2V0RGF0YSgpIGlzIG5vdyAuZ2V0RnJlcXVlbmN5RGF0YSgpLicgKTsKCQlyZXR1cm4gdGhpcy5nZXRGcmVxdWVuY3lEYXRhKCk7CgoJfTsKCgkvLwoKCUN1YmVDYW1lcmEucHJvdG90eXBlLnVwZGF0ZUN1YmVNYXAgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuQ3ViZUNhbWVyYTogLnVwZGF0ZUN1YmVNYXAoKSBpcyBub3cgLnVwZGF0ZSgpLicgKTsKCQlyZXR1cm4gdGhpcy51cGRhdGUoIHJlbmRlcmVyLCBzY2VuZSApOwoKCX07CgoJLy8KCgl2YXIgR2VvbWV0cnlVdGlscyA9IHsKCgkJbWVyZ2U6IGZ1bmN0aW9uICggZ2VvbWV0cnkxLCBnZW9tZXRyeTIsIG1hdGVyaWFsSW5kZXhPZmZzZXQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5HZW9tZXRyeVV0aWxzOiAubWVyZ2UoKSBoYXMgYmVlbiBtb3ZlZCB0byBHZW9tZXRyeS4gVXNlIGdlb21ldHJ5Lm1lcmdlKCBnZW9tZXRyeTIsIG1hdHJpeCwgbWF0ZXJpYWxJbmRleE9mZnNldCApIGluc3RlYWQuJyApOwoJCQl2YXIgbWF0cml4OwoKCQkJaWYgKCBnZW9tZXRyeTIuaXNNZXNoICkgewoKCQkJCWdlb21ldHJ5Mi5tYXRyaXhBdXRvVXBkYXRlICYmIGdlb21ldHJ5Mi51cGRhdGVNYXRyaXgoKTsKCgkJCQltYXRyaXggPSBnZW9tZXRyeTIubWF0cml4OwoJCQkJZ2VvbWV0cnkyID0gZ2VvbWV0cnkyLmdlb21ldHJ5OwoKCQkJfQoKCQkJZ2VvbWV0cnkxLm1lcmdlKCBnZW9tZXRyeTIsIG1hdHJpeCwgbWF0ZXJpYWxJbmRleE9mZnNldCApOwoKCQl9LAoKCQljZW50ZXI6IGZ1bmN0aW9uICggZ2VvbWV0cnkgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5HZW9tZXRyeVV0aWxzOiAuY2VudGVyKCkgaGFzIGJlZW4gbW92ZWQgdG8gR2VvbWV0cnkuIFVzZSBnZW9tZXRyeS5jZW50ZXIoKSBpbnN0ZWFkLicgKTsKCQkJcmV0dXJuIGdlb21ldHJ5LmNlbnRlcigpOwoKCQl9CgoJfTsKCglJbWFnZVV0aWxzLmNyb3NzT3JpZ2luID0gdW5kZWZpbmVkOwoKCUltYWdlVXRpbHMubG9hZFRleHR1cmUgPSBmdW5jdGlvbiAoIHVybCwgbWFwcGluZywgb25Mb2FkLCBvbkVycm9yICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSBUSFJFRS5UZXh0dXJlTG9hZGVyKCkgaW5zdGVhZC4nICk7CgoJCXZhciBsb2FkZXIgPSBuZXcgVGV4dHVyZUxvYWRlcigpOwoJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoKCQl2YXIgdGV4dHVyZSA9IGxvYWRlci5sb2FkKCB1cmwsIG9uTG9hZCwgdW5kZWZpbmVkLCBvbkVycm9yICk7CgoJCWlmICggbWFwcGluZyApIHRleHR1cmUubWFwcGluZyA9IG1hcHBpbmc7CgoJCXJldHVybiB0ZXh0dXJlOwoKCX07CgoJSW1hZ2VVdGlscy5sb2FkVGV4dHVyZUN1YmUgPSBmdW5jdGlvbiAoIHVybHMsIG1hcHBpbmcsIG9uTG9hZCwgb25FcnJvciApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZUN1YmUgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIFRIUkVFLkN1YmVUZXh0dXJlTG9hZGVyKCkgaW5zdGVhZC4nICk7CgoJCXZhciBsb2FkZXIgPSBuZXcgQ3ViZVRleHR1cmVMb2FkZXIoKTsKCQlsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oIHRoaXMuY3Jvc3NPcmlnaW4gKTsKCgkJdmFyIHRleHR1cmUgPSBsb2FkZXIubG9hZCggdXJscywgb25Mb2FkLCB1bmRlZmluZWQsIG9uRXJyb3IgKTsKCgkJaWYgKCBtYXBwaW5nICkgdGV4dHVyZS5tYXBwaW5nID0gbWFwcGluZzsKCgkJcmV0dXJuIHRleHR1cmU7CgoJfTsKCglJbWFnZVV0aWxzLmxvYWRDb21wcmVzc2VkVGV4dHVyZSA9IGZ1bmN0aW9uICgpIHsKCgkJY29uc29sZS5lcnJvciggJ1RIUkVFLkltYWdlVXRpbHMubG9hZENvbXByZXNzZWRUZXh0dXJlIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSBUSFJFRS5ERFNMb2FkZXIgaW5zdGVhZC4nICk7CgoJfTsKCglJbWFnZVV0aWxzLmxvYWRDb21wcmVzc2VkVGV4dHVyZUN1YmUgPSBmdW5jdGlvbiAoKSB7CgoJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5JbWFnZVV0aWxzLmxvYWRDb21wcmVzc2VkVGV4dHVyZUN1YmUgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIFRIUkVFLkREU0xvYWRlciBpbnN0ZWFkLicgKTsKCgl9OwoKCS8vCgoJZnVuY3Rpb24gUHJvamVjdG9yKCkgewoKCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvamVjdG9yIGhhcyBiZWVuIG1vdmVkIHRvIC9leGFtcGxlcy9qcy9yZW5kZXJlcnMvUHJvamVjdG9yLmpzLicgKTsKCgkJdGhpcy5wcm9qZWN0VmVjdG9yID0gZnVuY3Rpb24gKCB2ZWN0b3IsIGNhbWVyYSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlByb2plY3RvcjogLnByb2plY3RWZWN0b3IoKSBpcyBub3cgdmVjdG9yLnByb2plY3QoKS4nICk7CgkJCXZlY3Rvci5wcm9qZWN0KCBjYW1lcmEgKTsKCgkJfTsKCgkJdGhpcy51bnByb2plY3RWZWN0b3IgPSBmdW5jdGlvbiAoIHZlY3RvciwgY2FtZXJhICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUHJvamVjdG9yOiAudW5wcm9qZWN0VmVjdG9yKCkgaXMgbm93IHZlY3Rvci51bnByb2plY3QoKS4nICk7CgkJCXZlY3Rvci51bnByb2plY3QoIGNhbWVyYSApOwoKCQl9OwoKCQl0aGlzLnBpY2tpbmdSYXkgPSBmdW5jdGlvbiAoKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvamVjdG9yOiAucGlja2luZ1JheSgpIGlzIG5vdyByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYSgpLicgKTsKCgkJfTsKCgl9CgoJLy8KCglmdW5jdGlvbiBDYW52YXNSZW5kZXJlcigpIHsKCgkJY29uc29sZS5lcnJvciggJ1RIUkVFLkNhbnZhc1JlbmRlcmVyIGhhcyBiZWVuIHJlbW92ZWQnICk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gSlNPTkxvYWRlcigpIHsKCgkJY29uc29sZS5lcnJvciggJ1RIUkVFLkpTT05Mb2FkZXIgaGFzIGJlZW4gcmVtb3ZlZC4nICk7CgoJfQoKCS8vCgoJdmFyIFNjZW5lVXRpbHMgPSB7CgoJCWNyZWF0ZU11bHRpTWF0ZXJpYWxPYmplY3Q6IGZ1bmN0aW9uICggLyogZ2VvbWV0cnksIG1hdGVyaWFscyAqLyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5TY2VuZVV0aWxzIGhhcyBiZWVuIG1vdmVkIHRvIC9leGFtcGxlcy9qcy91dGlscy9TY2VuZVV0aWxzLmpzJyApOwoKCQl9LAoKCQlkZXRhY2g6IGZ1bmN0aW9uICggLyogY2hpbGQsIHBhcmVudCwgc2NlbmUgKi8gKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuU2NlbmVVdGlscyBoYXMgYmVlbiBtb3ZlZCB0byAvZXhhbXBsZXMvanMvdXRpbHMvU2NlbmVVdGlscy5qcycgKTsKCgkJfSwKCgkJYXR0YWNoOiBmdW5jdGlvbiAoIC8qIGNoaWxkLCBzY2VuZSwgcGFyZW50ICovICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlNjZW5lVXRpbHMgaGFzIGJlZW4gbW92ZWQgdG8gL2V4YW1wbGVzL2pzL3V0aWxzL1NjZW5lVXRpbHMuanMnICk7CgoJCX0KCgl9OwoKCS8vCgoJZnVuY3Rpb24gTGVuc0ZsYXJlKCkgewoKCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTGVuc0ZsYXJlIGhhcyBiZWVuIG1vdmVkIHRvIC9leGFtcGxlcy9qcy9vYmplY3RzL0xlbnNmbGFyZS5qcycgKTsKCgl9CgoJZXhwb3J0cy5XZWJHTE11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gV2ViR0xNdWx0aXNhbXBsZVJlbmRlclRhcmdldDsKCWV4cG9ydHMuV2ViR0xSZW5kZXJUYXJnZXRDdWJlID0gV2ViR0xSZW5kZXJUYXJnZXRDdWJlOwoJZXhwb3J0cy5XZWJHTFJlbmRlclRhcmdldCA9IFdlYkdMUmVuZGVyVGFyZ2V0OwoJZXhwb3J0cy5XZWJHTFJlbmRlcmVyID0gV2ViR0xSZW5kZXJlcjsKCWV4cG9ydHMuU2hhZGVyTGliID0gU2hhZGVyTGliOwoJZXhwb3J0cy5Vbmlmb3Jtc0xpYiA9IFVuaWZvcm1zTGliOwoJZXhwb3J0cy5Vbmlmb3Jtc1V0aWxzID0gVW5pZm9ybXNVdGlsczsKCWV4cG9ydHMuU2hhZGVyQ2h1bmsgPSBTaGFkZXJDaHVuazsKCWV4cG9ydHMuRm9nRXhwMiA9IEZvZ0V4cDI7CglleHBvcnRzLkZvZyA9IEZvZzsKCWV4cG9ydHMuU2NlbmUgPSBTY2VuZTsKCWV4cG9ydHMuU3ByaXRlID0gU3ByaXRlOwoJZXhwb3J0cy5MT0QgPSBMT0Q7CglleHBvcnRzLlNraW5uZWRNZXNoID0gU2tpbm5lZE1lc2g7CglleHBvcnRzLlNrZWxldG9uID0gU2tlbGV0b247CglleHBvcnRzLkJvbmUgPSBCb25lOwoJZXhwb3J0cy5NZXNoID0gTWVzaDsKCWV4cG9ydHMuTGluZVNlZ21lbnRzID0gTGluZVNlZ21lbnRzOwoJZXhwb3J0cy5MaW5lTG9vcCA9IExpbmVMb29wOwoJZXhwb3J0cy5MaW5lID0gTGluZTsKCWV4cG9ydHMuUG9pbnRzID0gUG9pbnRzOwoJZXhwb3J0cy5Hcm91cCA9IEdyb3VwOwoJZXhwb3J0cy5WaWRlb1RleHR1cmUgPSBWaWRlb1RleHR1cmU7CglleHBvcnRzLkRhdGFUZXh0dXJlID0gRGF0YVRleHR1cmU7CglleHBvcnRzLkRhdGFUZXh0dXJlMkRBcnJheSA9IERhdGFUZXh0dXJlMkRBcnJheTsKCWV4cG9ydHMuRGF0YVRleHR1cmUzRCA9IERhdGFUZXh0dXJlM0Q7CglleHBvcnRzLkNvbXByZXNzZWRUZXh0dXJlID0gQ29tcHJlc3NlZFRleHR1cmU7CglleHBvcnRzLkN1YmVUZXh0dXJlID0gQ3ViZVRleHR1cmU7CglleHBvcnRzLkNhbnZhc1RleHR1cmUgPSBDYW52YXNUZXh0dXJlOwoJZXhwb3J0cy5EZXB0aFRleHR1cmUgPSBEZXB0aFRleHR1cmU7CglleHBvcnRzLlRleHR1cmUgPSBUZXh0dXJlOwoJZXhwb3J0cy5BbmltYXRpb25Mb2FkZXIgPSBBbmltYXRpb25Mb2FkZXI7CglleHBvcnRzLkNvbXByZXNzZWRUZXh0dXJlTG9hZGVyID0gQ29tcHJlc3NlZFRleHR1cmVMb2FkZXI7CglleHBvcnRzLkRhdGFUZXh0dXJlTG9hZGVyID0gRGF0YVRleHR1cmVMb2FkZXI7CglleHBvcnRzLkN1YmVUZXh0dXJlTG9hZGVyID0gQ3ViZVRleHR1cmVMb2FkZXI7CglleHBvcnRzLlRleHR1cmVMb2FkZXIgPSBUZXh0dXJlTG9hZGVyOwoJZXhwb3J0cy5PYmplY3RMb2FkZXIgPSBPYmplY3RMb2FkZXI7CglleHBvcnRzLk1hdGVyaWFsTG9hZGVyID0gTWF0ZXJpYWxMb2FkZXI7CglleHBvcnRzLkJ1ZmZlckdlb21ldHJ5TG9hZGVyID0gQnVmZmVyR2VvbWV0cnlMb2FkZXI7CglleHBvcnRzLkRlZmF1bHRMb2FkaW5nTWFuYWdlciA9IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCWV4cG9ydHMuTG9hZGluZ01hbmFnZXIgPSBMb2FkaW5nTWFuYWdlcjsKCWV4cG9ydHMuSW1hZ2VMb2FkZXIgPSBJbWFnZUxvYWRlcjsKCWV4cG9ydHMuSW1hZ2VCaXRtYXBMb2FkZXIgPSBJbWFnZUJpdG1hcExvYWRlcjsKCWV4cG9ydHMuRm9udExvYWRlciA9IEZvbnRMb2FkZXI7CglleHBvcnRzLkZpbGVMb2FkZXIgPSBGaWxlTG9hZGVyOwoJZXhwb3J0cy5Mb2FkZXIgPSBMb2FkZXI7CglleHBvcnRzLkxvYWRlclV0aWxzID0gTG9hZGVyVXRpbHM7CglleHBvcnRzLkNhY2hlID0gQ2FjaGU7CglleHBvcnRzLkF1ZGlvTG9hZGVyID0gQXVkaW9Mb2FkZXI7CglleHBvcnRzLlNwb3RMaWdodFNoYWRvdyA9IFNwb3RMaWdodFNoYWRvdzsKCWV4cG9ydHMuU3BvdExpZ2h0ID0gU3BvdExpZ2h0OwoJZXhwb3J0cy5Qb2ludExpZ2h0ID0gUG9pbnRMaWdodDsKCWV4cG9ydHMuUmVjdEFyZWFMaWdodCA9IFJlY3RBcmVhTGlnaHQ7CglleHBvcnRzLkhlbWlzcGhlcmVMaWdodCA9IEhlbWlzcGhlcmVMaWdodDsKCWV4cG9ydHMuRGlyZWN0aW9uYWxMaWdodFNoYWRvdyA9IERpcmVjdGlvbmFsTGlnaHRTaGFkb3c7CglleHBvcnRzLkRpcmVjdGlvbmFsTGlnaHQgPSBEaXJlY3Rpb25hbExpZ2h0OwoJZXhwb3J0cy5BbWJpZW50TGlnaHQgPSBBbWJpZW50TGlnaHQ7CglleHBvcnRzLkxpZ2h0U2hhZG93ID0gTGlnaHRTaGFkb3c7CglleHBvcnRzLkxpZ2h0ID0gTGlnaHQ7CglleHBvcnRzLlN0ZXJlb0NhbWVyYSA9IFN0ZXJlb0NhbWVyYTsKCWV4cG9ydHMuUGVyc3BlY3RpdmVDYW1lcmEgPSBQZXJzcGVjdGl2ZUNhbWVyYTsKCWV4cG9ydHMuT3J0aG9ncmFwaGljQ2FtZXJhID0gT3J0aG9ncmFwaGljQ2FtZXJhOwoJZXhwb3J0cy5DdWJlQ2FtZXJhID0gQ3ViZUNhbWVyYTsKCWV4cG9ydHMuQXJyYXlDYW1lcmEgPSBBcnJheUNhbWVyYTsKCWV4cG9ydHMuQ2FtZXJhID0gQ2FtZXJhOwoJZXhwb3J0cy5BdWRpb0xpc3RlbmVyID0gQXVkaW9MaXN0ZW5lcjsKCWV4cG9ydHMuUG9zaXRpb25hbEF1ZGlvID0gUG9zaXRpb25hbEF1ZGlvOwoJZXhwb3J0cy5BdWRpb0NvbnRleHQgPSBBdWRpb0NvbnRleHQ7CglleHBvcnRzLkF1ZGlvQW5hbHlzZXIgPSBBdWRpb0FuYWx5c2VyOwoJZXhwb3J0cy5BdWRpbyA9IEF1ZGlvOwoJZXhwb3J0cy5WZWN0b3JLZXlmcmFtZVRyYWNrID0gVmVjdG9yS2V5ZnJhbWVUcmFjazsKCWV4cG9ydHMuU3RyaW5nS2V5ZnJhbWVUcmFjayA9IFN0cmluZ0tleWZyYW1lVHJhY2s7CglleHBvcnRzLlF1YXRlcm5pb25LZXlmcmFtZVRyYWNrID0gUXVhdGVybmlvbktleWZyYW1lVHJhY2s7CglleHBvcnRzLk51bWJlcktleWZyYW1lVHJhY2sgPSBOdW1iZXJLZXlmcmFtZVRyYWNrOwoJZXhwb3J0cy5Db2xvcktleWZyYW1lVHJhY2sgPSBDb2xvcktleWZyYW1lVHJhY2s7CglleHBvcnRzLkJvb2xlYW5LZXlmcmFtZVRyYWNrID0gQm9vbGVhbktleWZyYW1lVHJhY2s7CglleHBvcnRzLlByb3BlcnR5TWl4ZXIgPSBQcm9wZXJ0eU1peGVyOwoJZXhwb3J0cy5Qcm9wZXJ0eUJpbmRpbmcgPSBQcm9wZXJ0eUJpbmRpbmc7CglleHBvcnRzLktleWZyYW1lVHJhY2sgPSBLZXlmcmFtZVRyYWNrOwoJZXhwb3J0cy5BbmltYXRpb25VdGlscyA9IEFuaW1hdGlvblV0aWxzOwoJZXhwb3J0cy5BbmltYXRpb25PYmplY3RHcm91cCA9IEFuaW1hdGlvbk9iamVjdEdyb3VwOwoJZXhwb3J0cy5BbmltYXRpb25NaXhlciA9IEFuaW1hdGlvbk1peGVyOwoJZXhwb3J0cy5BbmltYXRpb25DbGlwID0gQW5pbWF0aW9uQ2xpcDsKCWV4cG9ydHMuVW5pZm9ybSA9IFVuaWZvcm07CglleHBvcnRzLkluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ID0gSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLkJ1ZmZlckdlb21ldHJ5ID0gQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLkdlb21ldHJ5ID0gR2VvbWV0cnk7CglleHBvcnRzLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlID0gSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLkluc3RhbmNlZEludGVybGVhdmVkQnVmZmVyID0gSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXI7CglleHBvcnRzLkludGVybGVhdmVkQnVmZmVyID0gSW50ZXJsZWF2ZWRCdWZmZXI7CglleHBvcnRzLkluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSA9IEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZTsKCWV4cG9ydHMuRmFjZTMgPSBGYWNlMzsKCWV4cG9ydHMuT2JqZWN0M0QgPSBPYmplY3QzRDsKCWV4cG9ydHMuUmF5Y2FzdGVyID0gUmF5Y2FzdGVyOwoJZXhwb3J0cy5MYXllcnMgPSBMYXllcnM7CglleHBvcnRzLkV2ZW50RGlzcGF0Y2hlciA9IEV2ZW50RGlzcGF0Y2hlcjsKCWV4cG9ydHMuQ2xvY2sgPSBDbG9jazsKCWV4cG9ydHMuUXVhdGVybmlvbkxpbmVhckludGVycG9sYW50ID0gUXVhdGVybmlvbkxpbmVhckludGVycG9sYW50OwoJZXhwb3J0cy5MaW5lYXJJbnRlcnBvbGFudCA9IExpbmVhckludGVycG9sYW50OwoJZXhwb3J0cy5EaXNjcmV0ZUludGVycG9sYW50ID0gRGlzY3JldGVJbnRlcnBvbGFudDsKCWV4cG9ydHMuQ3ViaWNJbnRlcnBvbGFudCA9IEN1YmljSW50ZXJwb2xhbnQ7CglleHBvcnRzLkludGVycG9sYW50ID0gSW50ZXJwb2xhbnQ7CglleHBvcnRzLlRyaWFuZ2xlID0gVHJpYW5nbGU7CglleHBvcnRzLk1hdGggPSBfTWF0aDsKCWV4cG9ydHMuU3BoZXJpY2FsID0gU3BoZXJpY2FsOwoJZXhwb3J0cy5DeWxpbmRyaWNhbCA9IEN5bGluZHJpY2FsOwoJZXhwb3J0cy5QbGFuZSA9IFBsYW5lOwoJZXhwb3J0cy5GcnVzdHVtID0gRnJ1c3R1bTsKCWV4cG9ydHMuU3BoZXJlID0gU3BoZXJlOwoJZXhwb3J0cy5SYXkgPSBSYXk7CglleHBvcnRzLk1hdHJpeDQgPSBNYXRyaXg0OwoJZXhwb3J0cy5NYXRyaXgzID0gTWF0cml4MzsKCWV4cG9ydHMuQm94MyA9IEJveDM7CglleHBvcnRzLkJveDIgPSBCb3gyOwoJZXhwb3J0cy5MaW5lMyA9IExpbmUzOwoJZXhwb3J0cy5FdWxlciA9IEV1bGVyOwoJZXhwb3J0cy5WZWN0b3I0ID0gVmVjdG9yNDsKCWV4cG9ydHMuVmVjdG9yMyA9IFZlY3RvcjM7CglleHBvcnRzLlZlY3RvcjIgPSBWZWN0b3IyOwoJZXhwb3J0cy5RdWF0ZXJuaW9uID0gUXVhdGVybmlvbjsKCWV4cG9ydHMuQ29sb3IgPSBDb2xvcjsKCWV4cG9ydHMuSW1tZWRpYXRlUmVuZGVyT2JqZWN0ID0gSW1tZWRpYXRlUmVuZGVyT2JqZWN0OwoJZXhwb3J0cy5WZXJ0ZXhOb3JtYWxzSGVscGVyID0gVmVydGV4Tm9ybWFsc0hlbHBlcjsKCWV4cG9ydHMuU3BvdExpZ2h0SGVscGVyID0gU3BvdExpZ2h0SGVscGVyOwoJZXhwb3J0cy5Ta2VsZXRvbkhlbHBlciA9IFNrZWxldG9uSGVscGVyOwoJZXhwb3J0cy5Qb2ludExpZ2h0SGVscGVyID0gUG9pbnRMaWdodEhlbHBlcjsKCWV4cG9ydHMuUmVjdEFyZWFMaWdodEhlbHBlciA9IFJlY3RBcmVhTGlnaHRIZWxwZXI7CglleHBvcnRzLkhlbWlzcGhlcmVMaWdodEhlbHBlciA9IEhlbWlzcGhlcmVMaWdodEhlbHBlcjsKCWV4cG9ydHMuR3JpZEhlbHBlciA9IEdyaWRIZWxwZXI7CglleHBvcnRzLlBvbGFyR3JpZEhlbHBlciA9IFBvbGFyR3JpZEhlbHBlcjsKCWV4cG9ydHMuUG9zaXRpb25hbEF1ZGlvSGVscGVyID0gUG9zaXRpb25hbEF1ZGlvSGVscGVyOwoJZXhwb3J0cy5GYWNlTm9ybWFsc0hlbHBlciA9IEZhY2VOb3JtYWxzSGVscGVyOwoJZXhwb3J0cy5EaXJlY3Rpb25hbExpZ2h0SGVscGVyID0gRGlyZWN0aW9uYWxMaWdodEhlbHBlcjsKCWV4cG9ydHMuQ2FtZXJhSGVscGVyID0gQ2FtZXJhSGVscGVyOwoJZXhwb3J0cy5Cb3hIZWxwZXIgPSBCb3hIZWxwZXI7CglleHBvcnRzLkJveDNIZWxwZXIgPSBCb3gzSGVscGVyOwoJZXhwb3J0cy5QbGFuZUhlbHBlciA9IFBsYW5lSGVscGVyOwoJZXhwb3J0cy5BcnJvd0hlbHBlciA9IEFycm93SGVscGVyOwoJZXhwb3J0cy5BeGVzSGVscGVyID0gQXhlc0hlbHBlcjsKCWV4cG9ydHMuU2hhcGUgPSBTaGFwZTsKCWV4cG9ydHMuUGF0aCA9IFBhdGg7CglleHBvcnRzLlNoYXBlUGF0aCA9IFNoYXBlUGF0aDsKCWV4cG9ydHMuRm9udCA9IEZvbnQ7CglleHBvcnRzLkN1cnZlUGF0aCA9IEN1cnZlUGF0aDsKCWV4cG9ydHMuQ3VydmUgPSBDdXJ2ZTsKCWV4cG9ydHMuSW1hZ2VVdGlscyA9IEltYWdlVXRpbHM7CglleHBvcnRzLlNoYXBlVXRpbHMgPSBTaGFwZVV0aWxzOwoJZXhwb3J0cy5XZWJHTFV0aWxzID0gV2ViR0xVdGlsczsKCWV4cG9ydHMuV2lyZWZyYW1lR2VvbWV0cnkgPSBXaXJlZnJhbWVHZW9tZXRyeTsKCWV4cG9ydHMuUGFyYW1ldHJpY0dlb21ldHJ5ID0gUGFyYW1ldHJpY0dlb21ldHJ5OwoJZXhwb3J0cy5QYXJhbWV0cmljQnVmZmVyR2VvbWV0cnkgPSBQYXJhbWV0cmljQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLlRldHJhaGVkcm9uR2VvbWV0cnkgPSBUZXRyYWhlZHJvbkdlb21ldHJ5OwoJZXhwb3J0cy5UZXRyYWhlZHJvbkJ1ZmZlckdlb21ldHJ5ID0gVGV0cmFoZWRyb25CdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuT2N0YWhlZHJvbkdlb21ldHJ5ID0gT2N0YWhlZHJvbkdlb21ldHJ5OwoJZXhwb3J0cy5PY3RhaGVkcm9uQnVmZmVyR2VvbWV0cnkgPSBPY3RhaGVkcm9uQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLkljb3NhaGVkcm9uR2VvbWV0cnkgPSBJY29zYWhlZHJvbkdlb21ldHJ5OwoJZXhwb3J0cy5JY29zYWhlZHJvbkJ1ZmZlckdlb21ldHJ5ID0gSWNvc2FoZWRyb25CdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuRG9kZWNhaGVkcm9uR2VvbWV0cnkgPSBEb2RlY2FoZWRyb25HZW9tZXRyeTsKCWV4cG9ydHMuRG9kZWNhaGVkcm9uQnVmZmVyR2VvbWV0cnkgPSBEb2RlY2FoZWRyb25CdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuUG9seWhlZHJvbkdlb21ldHJ5ID0gUG9seWhlZHJvbkdlb21ldHJ5OwoJZXhwb3J0cy5Qb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnkgPSBQb2x5aGVkcm9uQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLlR1YmVHZW9tZXRyeSA9IFR1YmVHZW9tZXRyeTsKCWV4cG9ydHMuVHViZUJ1ZmZlckdlb21ldHJ5ID0gVHViZUJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5Ub3J1c0tub3RHZW9tZXRyeSA9IFRvcnVzS25vdEdlb21ldHJ5OwoJZXhwb3J0cy5Ub3J1c0tub3RCdWZmZXJHZW9tZXRyeSA9IFRvcnVzS25vdEJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5Ub3J1c0dlb21ldHJ5ID0gVG9ydXNHZW9tZXRyeTsKCWV4cG9ydHMuVG9ydXNCdWZmZXJHZW9tZXRyeSA9IFRvcnVzQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLlRleHRHZW9tZXRyeSA9IFRleHRHZW9tZXRyeTsKCWV4cG9ydHMuVGV4dEJ1ZmZlckdlb21ldHJ5ID0gVGV4dEJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5TcGhlcmVHZW9tZXRyeSA9IFNwaGVyZUdlb21ldHJ5OwoJZXhwb3J0cy5TcGhlcmVCdWZmZXJHZW9tZXRyeSA9IFNwaGVyZUJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5SaW5nR2VvbWV0cnkgPSBSaW5nR2VvbWV0cnk7CglleHBvcnRzLlJpbmdCdWZmZXJHZW9tZXRyeSA9IFJpbmdCdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuUGxhbmVHZW9tZXRyeSA9IFBsYW5lR2VvbWV0cnk7CglleHBvcnRzLlBsYW5lQnVmZmVyR2VvbWV0cnkgPSBQbGFuZUJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5MYXRoZUdlb21ldHJ5ID0gTGF0aGVHZW9tZXRyeTsKCWV4cG9ydHMuTGF0aGVCdWZmZXJHZW9tZXRyeSA9IExhdGhlQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLlNoYXBlR2VvbWV0cnkgPSBTaGFwZUdlb21ldHJ5OwoJZXhwb3J0cy5TaGFwZUJ1ZmZlckdlb21ldHJ5ID0gU2hhcGVCdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuRXh0cnVkZUdlb21ldHJ5ID0gRXh0cnVkZUdlb21ldHJ5OwoJZXhwb3J0cy5FeHRydWRlQnVmZmVyR2VvbWV0cnkgPSBFeHRydWRlQnVmZmVyR2VvbWV0cnk7CglleHBvcnRzLkVkZ2VzR2VvbWV0cnkgPSBFZGdlc0dlb21ldHJ5OwoJZXhwb3J0cy5Db25lR2VvbWV0cnkgPSBDb25lR2VvbWV0cnk7CglleHBvcnRzLkNvbmVCdWZmZXJHZW9tZXRyeSA9IENvbmVCdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuQ3lsaW5kZXJHZW9tZXRyeSA9IEN5bGluZGVyR2VvbWV0cnk7CglleHBvcnRzLkN5bGluZGVyQnVmZmVyR2VvbWV0cnkgPSBDeWxpbmRlckJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5DaXJjbGVHZW9tZXRyeSA9IENpcmNsZUdlb21ldHJ5OwoJZXhwb3J0cy5DaXJjbGVCdWZmZXJHZW9tZXRyeSA9IENpcmNsZUJ1ZmZlckdlb21ldHJ5OwoJZXhwb3J0cy5Cb3hHZW9tZXRyeSA9IEJveEdlb21ldHJ5OwoJZXhwb3J0cy5DdWJlR2VvbWV0cnkgPSBCb3hHZW9tZXRyeTsKCWV4cG9ydHMuQm94QnVmZmVyR2VvbWV0cnkgPSBCb3hCdWZmZXJHZW9tZXRyeTsKCWV4cG9ydHMuU2hhZG93TWF0ZXJpYWwgPSBTaGFkb3dNYXRlcmlhbDsKCWV4cG9ydHMuU3ByaXRlTWF0ZXJpYWwgPSBTcHJpdGVNYXRlcmlhbDsKCWV4cG9ydHMuUmF3U2hhZGVyTWF0ZXJpYWwgPSBSYXdTaGFkZXJNYXRlcmlhbDsKCWV4cG9ydHMuU2hhZGVyTWF0ZXJpYWwgPSBTaGFkZXJNYXRlcmlhbDsKCWV4cG9ydHMuUG9pbnRzTWF0ZXJpYWwgPSBQb2ludHNNYXRlcmlhbDsKCWV4cG9ydHMuTWVzaFBoeXNpY2FsTWF0ZXJpYWwgPSBNZXNoUGh5c2ljYWxNYXRlcmlhbDsKCWV4cG9ydHMuTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPSBNZXNoU3RhbmRhcmRNYXRlcmlhbDsKCWV4cG9ydHMuTWVzaFBob25nTWF0ZXJpYWwgPSBNZXNoUGhvbmdNYXRlcmlhbDsKCWV4cG9ydHMuTWVzaFRvb25NYXRlcmlhbCA9IE1lc2hUb29uTWF0ZXJpYWw7CglleHBvcnRzLk1lc2hOb3JtYWxNYXRlcmlhbCA9IE1lc2hOb3JtYWxNYXRlcmlhbDsKCWV4cG9ydHMuTWVzaExhbWJlcnRNYXRlcmlhbCA9IE1lc2hMYW1iZXJ0TWF0ZXJpYWw7CglleHBvcnRzLk1lc2hEZXB0aE1hdGVyaWFsID0gTWVzaERlcHRoTWF0ZXJpYWw7CglleHBvcnRzLk1lc2hEaXN0YW5jZU1hdGVyaWFsID0gTWVzaERpc3RhbmNlTWF0ZXJpYWw7CglleHBvcnRzLk1lc2hCYXNpY01hdGVyaWFsID0gTWVzaEJhc2ljTWF0ZXJpYWw7CglleHBvcnRzLk1lc2hNYXRjYXBNYXRlcmlhbCA9IE1lc2hNYXRjYXBNYXRlcmlhbDsKCWV4cG9ydHMuTGluZURhc2hlZE1hdGVyaWFsID0gTGluZURhc2hlZE1hdGVyaWFsOwoJZXhwb3J0cy5MaW5lQmFzaWNNYXRlcmlhbCA9IExpbmVCYXNpY01hdGVyaWFsOwoJZXhwb3J0cy5NYXRlcmlhbCA9IE1hdGVyaWFsOwoJZXhwb3J0cy5GbG9hdDY0QnVmZmVyQXR0cmlidXRlID0gRmxvYXQ2NEJ1ZmZlckF0dHJpYnV0ZTsKCWV4cG9ydHMuRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSA9IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLlVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA9IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZTsKCWV4cG9ydHMuSW50MzJCdWZmZXJBdHRyaWJ1dGUgPSBJbnQzMkJ1ZmZlckF0dHJpYnV0ZTsKCWV4cG9ydHMuVWludDE2QnVmZmVyQXR0cmlidXRlID0gVWludDE2QnVmZmVyQXR0cmlidXRlOwoJZXhwb3J0cy5JbnQxNkJ1ZmZlckF0dHJpYnV0ZSA9IEludDE2QnVmZmVyQXR0cmlidXRlOwoJZXhwb3J0cy5VaW50OENsYW1wZWRCdWZmZXJBdHRyaWJ1dGUgPSBVaW50OENsYW1wZWRCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLlVpbnQ4QnVmZmVyQXR0cmlidXRlID0gVWludDhCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLkludDhCdWZmZXJBdHRyaWJ1dGUgPSBJbnQ4QnVmZmVyQXR0cmlidXRlOwoJZXhwb3J0cy5CdWZmZXJBdHRyaWJ1dGUgPSBCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLkFyY0N1cnZlID0gQXJjQ3VydmU7CglleHBvcnRzLkNhdG11bGxSb21DdXJ2ZTMgPSBDYXRtdWxsUm9tQ3VydmUzOwoJZXhwb3J0cy5DdWJpY0JlemllckN1cnZlID0gQ3ViaWNCZXppZXJDdXJ2ZTsKCWV4cG9ydHMuQ3ViaWNCZXppZXJDdXJ2ZTMgPSBDdWJpY0JlemllckN1cnZlMzsKCWV4cG9ydHMuRWxsaXBzZUN1cnZlID0gRWxsaXBzZUN1cnZlOwoJZXhwb3J0cy5MaW5lQ3VydmUgPSBMaW5lQ3VydmU7CglleHBvcnRzLkxpbmVDdXJ2ZTMgPSBMaW5lQ3VydmUzOwoJZXhwb3J0cy5RdWFkcmF0aWNCZXppZXJDdXJ2ZSA9IFF1YWRyYXRpY0JlemllckN1cnZlOwoJZXhwb3J0cy5RdWFkcmF0aWNCZXppZXJDdXJ2ZTMgPSBRdWFkcmF0aWNCZXppZXJDdXJ2ZTM7CglleHBvcnRzLlNwbGluZUN1cnZlID0gU3BsaW5lQ3VydmU7CglleHBvcnRzLlJFVklTSU9OID0gUkVWSVNJT047CglleHBvcnRzLk1PVVNFID0gTU9VU0U7CglleHBvcnRzLkN1bGxGYWNlTm9uZSA9IEN1bGxGYWNlTm9uZTsKCWV4cG9ydHMuQ3VsbEZhY2VCYWNrID0gQ3VsbEZhY2VCYWNrOwoJZXhwb3J0cy5DdWxsRmFjZUZyb250ID0gQ3VsbEZhY2VGcm9udDsKCWV4cG9ydHMuQ3VsbEZhY2VGcm9udEJhY2sgPSBDdWxsRmFjZUZyb250QmFjazsKCWV4cG9ydHMuRnJvbnRGYWNlRGlyZWN0aW9uQ1cgPSBGcm9udEZhY2VEaXJlY3Rpb25DVzsKCWV4cG9ydHMuRnJvbnRGYWNlRGlyZWN0aW9uQ0NXID0gRnJvbnRGYWNlRGlyZWN0aW9uQ0NXOwoJZXhwb3J0cy5CYXNpY1NoYWRvd01hcCA9IEJhc2ljU2hhZG93TWFwOwoJZXhwb3J0cy5QQ0ZTaGFkb3dNYXAgPSBQQ0ZTaGFkb3dNYXA7CglleHBvcnRzLlBDRlNvZnRTaGFkb3dNYXAgPSBQQ0ZTb2Z0U2hhZG93TWFwOwoJZXhwb3J0cy5Gcm9udFNpZGUgPSBGcm9udFNpZGU7CglleHBvcnRzLkJhY2tTaWRlID0gQmFja1NpZGU7CglleHBvcnRzLkRvdWJsZVNpZGUgPSBEb3VibGVTaWRlOwoJZXhwb3J0cy5GbGF0U2hhZGluZyA9IEZsYXRTaGFkaW5nOwoJZXhwb3J0cy5TbW9vdGhTaGFkaW5nID0gU21vb3RoU2hhZGluZzsKCWV4cG9ydHMuTm9Db2xvcnMgPSBOb0NvbG9yczsKCWV4cG9ydHMuRmFjZUNvbG9ycyA9IEZhY2VDb2xvcnM7CglleHBvcnRzLlZlcnRleENvbG9ycyA9IFZlcnRleENvbG9yczsKCWV4cG9ydHMuTm9CbGVuZGluZyA9IE5vQmxlbmRpbmc7CglleHBvcnRzLk5vcm1hbEJsZW5kaW5nID0gTm9ybWFsQmxlbmRpbmc7CglleHBvcnRzLkFkZGl0aXZlQmxlbmRpbmcgPSBBZGRpdGl2ZUJsZW5kaW5nOwoJZXhwb3J0cy5TdWJ0cmFjdGl2ZUJsZW5kaW5nID0gU3VidHJhY3RpdmVCbGVuZGluZzsKCWV4cG9ydHMuTXVsdGlwbHlCbGVuZGluZyA9IE11bHRpcGx5QmxlbmRpbmc7CglleHBvcnRzLkN1c3RvbUJsZW5kaW5nID0gQ3VzdG9tQmxlbmRpbmc7CglleHBvcnRzLkFkZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CglleHBvcnRzLlN1YnRyYWN0RXF1YXRpb24gPSBTdWJ0cmFjdEVxdWF0aW9uOwoJZXhwb3J0cy5SZXZlcnNlU3VidHJhY3RFcXVhdGlvbiA9IFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uOwoJZXhwb3J0cy5NaW5FcXVhdGlvbiA9IE1pbkVxdWF0aW9uOwoJZXhwb3J0cy5NYXhFcXVhdGlvbiA9IE1heEVxdWF0aW9uOwoJZXhwb3J0cy5aZXJvRmFjdG9yID0gWmVyb0ZhY3RvcjsKCWV4cG9ydHMuT25lRmFjdG9yID0gT25lRmFjdG9yOwoJZXhwb3J0cy5TcmNDb2xvckZhY3RvciA9IFNyY0NvbG9yRmFjdG9yOwoJZXhwb3J0cy5PbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gT25lTWludXNTcmNDb2xvckZhY3RvcjsKCWV4cG9ydHMuU3JjQWxwaGFGYWN0b3IgPSBTcmNBbHBoYUZhY3RvcjsKCWV4cG9ydHMuT25lTWludXNTcmNBbHBoYUZhY3RvciA9IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3I7CglleHBvcnRzLkRzdEFscGhhRmFjdG9yID0gRHN0QWxwaGFGYWN0b3I7CglleHBvcnRzLk9uZU1pbnVzRHN0QWxwaGFGYWN0b3IgPSBPbmVNaW51c0RzdEFscGhhRmFjdG9yOwoJZXhwb3J0cy5Ec3RDb2xvckZhY3RvciA9IERzdENvbG9yRmFjdG9yOwoJZXhwb3J0cy5PbmVNaW51c0RzdENvbG9yRmFjdG9yID0gT25lTWludXNEc3RDb2xvckZhY3RvcjsKCWV4cG9ydHMuU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciA9IFNyY0FscGhhU2F0dXJhdGVGYWN0b3I7CglleHBvcnRzLk5ldmVyRGVwdGggPSBOZXZlckRlcHRoOwoJZXhwb3J0cy5BbHdheXNEZXB0aCA9IEFsd2F5c0RlcHRoOwoJZXhwb3J0cy5MZXNzRGVwdGggPSBMZXNzRGVwdGg7CglleHBvcnRzLkxlc3NFcXVhbERlcHRoID0gTGVzc0VxdWFsRGVwdGg7CglleHBvcnRzLkVxdWFsRGVwdGggPSBFcXVhbERlcHRoOwoJZXhwb3J0cy5HcmVhdGVyRXF1YWxEZXB0aCA9IEdyZWF0ZXJFcXVhbERlcHRoOwoJZXhwb3J0cy5HcmVhdGVyRGVwdGggPSBHcmVhdGVyRGVwdGg7CglleHBvcnRzLk5vdEVxdWFsRGVwdGggPSBOb3RFcXVhbERlcHRoOwoJZXhwb3J0cy5NdWx0aXBseU9wZXJhdGlvbiA9IE11bHRpcGx5T3BlcmF0aW9uOwoJZXhwb3J0cy5NaXhPcGVyYXRpb24gPSBNaXhPcGVyYXRpb247CglleHBvcnRzLkFkZE9wZXJhdGlvbiA9IEFkZE9wZXJhdGlvbjsKCWV4cG9ydHMuTm9Ub25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CglleHBvcnRzLkxpbmVhclRvbmVNYXBwaW5nID0gTGluZWFyVG9uZU1hcHBpbmc7CglleHBvcnRzLlJlaW5oYXJkVG9uZU1hcHBpbmcgPSBSZWluaGFyZFRvbmVNYXBwaW5nOwoJZXhwb3J0cy5VbmNoYXJ0ZWQyVG9uZU1hcHBpbmcgPSBVbmNoYXJ0ZWQyVG9uZU1hcHBpbmc7CglleHBvcnRzLkNpbmVvblRvbmVNYXBwaW5nID0gQ2luZW9uVG9uZU1hcHBpbmc7CglleHBvcnRzLkFDRVNGaWxtaWNUb25lTWFwcGluZyA9IEFDRVNGaWxtaWNUb25lTWFwcGluZzsKCWV4cG9ydHMuVVZNYXBwaW5nID0gVVZNYXBwaW5nOwoJZXhwb3J0cy5DdWJlUmVmbGVjdGlvbk1hcHBpbmcgPSBDdWJlUmVmbGVjdGlvbk1hcHBpbmc7CglleHBvcnRzLkN1YmVSZWZyYWN0aW9uTWFwcGluZyA9IEN1YmVSZWZyYWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgPSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgPSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuU3BoZXJpY2FsUmVmbGVjdGlvbk1hcHBpbmcgPSBTcGhlcmljYWxSZWZsZWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgPSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuQ3ViZVVWUmVmcmFjdGlvbk1hcHBpbmcgPSBDdWJlVVZSZWZyYWN0aW9uTWFwcGluZzsKCWV4cG9ydHMuUmVwZWF0V3JhcHBpbmcgPSBSZXBlYXRXcmFwcGluZzsKCWV4cG9ydHMuQ2xhbXBUb0VkZ2VXcmFwcGluZyA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CglleHBvcnRzLk1pcnJvcmVkUmVwZWF0V3JhcHBpbmcgPSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOwoJZXhwb3J0cy5OZWFyZXN0RmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCWV4cG9ydHMuTmVhcmVzdE1pcE1hcE5lYXJlc3RGaWx0ZXIgPSBOZWFyZXN0TWlwTWFwTmVhcmVzdEZpbHRlcjsKCWV4cG9ydHMuTmVhcmVzdE1pcE1hcExpbmVhckZpbHRlciA9IE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXI7CglleHBvcnRzLkxpbmVhckZpbHRlciA9IExpbmVhckZpbHRlcjsKCWV4cG9ydHMuTGluZWFyTWlwTWFwTmVhcmVzdEZpbHRlciA9IExpbmVhck1pcE1hcE5lYXJlc3RGaWx0ZXI7CglleHBvcnRzLkxpbmVhck1pcE1hcExpbmVhckZpbHRlciA9IExpbmVhck1pcE1hcExpbmVhckZpbHRlcjsKCWV4cG9ydHMuVW5zaWduZWRCeXRlVHlwZSA9IFVuc2lnbmVkQnl0ZVR5cGU7CglleHBvcnRzLkJ5dGVUeXBlID0gQnl0ZVR5cGU7CglleHBvcnRzLlNob3J0VHlwZSA9IFNob3J0VHlwZTsKCWV4cG9ydHMuVW5zaWduZWRTaG9ydFR5cGUgPSBVbnNpZ25lZFNob3J0VHlwZTsKCWV4cG9ydHMuSW50VHlwZSA9IEludFR5cGU7CglleHBvcnRzLlVuc2lnbmVkSW50VHlwZSA9IFVuc2lnbmVkSW50VHlwZTsKCWV4cG9ydHMuRmxvYXRUeXBlID0gRmxvYXRUeXBlOwoJZXhwb3J0cy5IYWxmRmxvYXRUeXBlID0gSGFsZkZsb2F0VHlwZTsKCWV4cG9ydHMuVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlOwoJZXhwb3J0cy5VbnNpZ25lZFNob3J0NTU1MVR5cGUgPSBVbnNpZ25lZFNob3J0NTU1MVR5cGU7CglleHBvcnRzLlVuc2lnbmVkU2hvcnQ1NjVUeXBlID0gVW5zaWduZWRTaG9ydDU2NVR5cGU7CglleHBvcnRzLlVuc2lnbmVkSW50MjQ4VHlwZSA9IFVuc2lnbmVkSW50MjQ4VHlwZTsKCWV4cG9ydHMuQWxwaGFGb3JtYXQgPSBBbHBoYUZvcm1hdDsKCWV4cG9ydHMuUkdCRm9ybWF0ID0gUkdCRm9ybWF0OwoJZXhwb3J0cy5SR0JBRm9ybWF0ID0gUkdCQUZvcm1hdDsKCWV4cG9ydHMuTHVtaW5hbmNlRm9ybWF0ID0gTHVtaW5hbmNlRm9ybWF0OwoJZXhwb3J0cy5MdW1pbmFuY2VBbHBoYUZvcm1hdCA9IEx1bWluYW5jZUFscGhhRm9ybWF0OwoJZXhwb3J0cy5SR0JFRm9ybWF0ID0gUkdCRUZvcm1hdDsKCWV4cG9ydHMuRGVwdGhGb3JtYXQgPSBEZXB0aEZvcm1hdDsKCWV4cG9ydHMuRGVwdGhTdGVuY2lsRm9ybWF0ID0gRGVwdGhTdGVuY2lsRm9ybWF0OwoJZXhwb3J0cy5SZWRGb3JtYXQgPSBSZWRGb3JtYXQ7CglleHBvcnRzLlJHQl9TM1RDX0RYVDFfRm9ybWF0ID0gUkdCX1MzVENfRFhUMV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfUzNUQ19EWFQxX0Zvcm1hdCA9IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdDsKCWV4cG9ydHMuUkdCQV9TM1RDX0RYVDNfRm9ybWF0ID0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0OwoJZXhwb3J0cy5SR0JBX1MzVENfRFhUNV9Gb3JtYXQgPSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQ7CglleHBvcnRzLlJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ID0gUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQ7CglleHBvcnRzLlJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdCA9IFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdDsKCWV4cG9ydHMuUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0OwoJZXhwb3J0cy5SR0JfRVRDMV9Gb3JtYXQgPSBSR0JfRVRDMV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ180eDRfRm9ybWF0ID0gUkdCQV9BU1RDXzR4NF9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ181eDRfRm9ybWF0ID0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ181eDVfRm9ybWF0ID0gUkdCQV9BU1RDXzV4NV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ182eDVfRm9ybWF0ID0gUkdCQV9BU1RDXzZ4NV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ182eDZfRm9ybWF0ID0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ184eDVfRm9ybWF0ID0gUkdCQV9BU1RDXzh4NV9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ184eDZfRm9ybWF0ID0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ184eDhfRm9ybWF0ID0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ18xMHg1X0Zvcm1hdCA9IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdDsKCWV4cG9ydHMuUkdCQV9BU1RDXzEweDZfRm9ybWF0ID0gUkdCQV9BU1RDXzEweDZfRm9ybWF0OwoJZXhwb3J0cy5SR0JBX0FTVENfMTB4OF9Gb3JtYXQgPSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQ7CglleHBvcnRzLlJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0OwoJZXhwb3J0cy5SR0JBX0FTVENfMTJ4MTBfRm9ybWF0ID0gUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdDsKCWV4cG9ydHMuUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQ7CglleHBvcnRzLkxvb3BPbmNlID0gTG9vcE9uY2U7CglleHBvcnRzLkxvb3BSZXBlYXQgPSBMb29wUmVwZWF0OwoJZXhwb3J0cy5Mb29wUGluZ1BvbmcgPSBMb29wUGluZ1Bvbmc7CglleHBvcnRzLkludGVycG9sYXRlRGlzY3JldGUgPSBJbnRlcnBvbGF0ZURpc2NyZXRlOwoJZXhwb3J0cy5JbnRlcnBvbGF0ZUxpbmVhciA9IEludGVycG9sYXRlTGluZWFyOwoJZXhwb3J0cy5JbnRlcnBvbGF0ZVNtb290aCA9IEludGVycG9sYXRlU21vb3RoOwoJZXhwb3J0cy5aZXJvQ3VydmF0dXJlRW5kaW5nID0gWmVyb0N1cnZhdHVyZUVuZGluZzsKCWV4cG9ydHMuWmVyb1Nsb3BlRW5kaW5nID0gWmVyb1Nsb3BlRW5kaW5nOwoJZXhwb3J0cy5XcmFwQXJvdW5kRW5kaW5nID0gV3JhcEFyb3VuZEVuZGluZzsKCWV4cG9ydHMuVHJpYW5nbGVzRHJhd01vZGUgPSBUcmlhbmdsZXNEcmF3TW9kZTsKCWV4cG9ydHMuVHJpYW5nbGVTdHJpcERyYXdNb2RlID0gVHJpYW5nbGVTdHJpcERyYXdNb2RlOwoJZXhwb3J0cy5UcmlhbmdsZUZhbkRyYXdNb2RlID0gVHJpYW5nbGVGYW5EcmF3TW9kZTsKCWV4cG9ydHMuTGluZWFyRW5jb2RpbmcgPSBMaW5lYXJFbmNvZGluZzsKCWV4cG9ydHMuc1JHQkVuY29kaW5nID0gc1JHQkVuY29kaW5nOwoJZXhwb3J0cy5HYW1tYUVuY29kaW5nID0gR2FtbWFFbmNvZGluZzsKCWV4cG9ydHMuUkdCRUVuY29kaW5nID0gUkdCRUVuY29kaW5nOwoJZXhwb3J0cy5Mb2dMdXZFbmNvZGluZyA9IExvZ0x1dkVuY29kaW5nOwoJZXhwb3J0cy5SR0JNN0VuY29kaW5nID0gUkdCTTdFbmNvZGluZzsKCWV4cG9ydHMuUkdCTTE2RW5jb2RpbmcgPSBSR0JNMTZFbmNvZGluZzsKCWV4cG9ydHMuUkdCREVuY29kaW5nID0gUkdCREVuY29kaW5nOwoJZXhwb3J0cy5CYXNpY0RlcHRoUGFja2luZyA9IEJhc2ljRGVwdGhQYWNraW5nOwoJZXhwb3J0cy5SR0JBRGVwdGhQYWNraW5nID0gUkdCQURlcHRoUGFja2luZzsKCWV4cG9ydHMuVGFuZ2VudFNwYWNlTm9ybWFsTWFwID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJZXhwb3J0cy5PYmplY3RTcGFjZU5vcm1hbE1hcCA9IE9iamVjdFNwYWNlTm9ybWFsTWFwOwoJZXhwb3J0cy5GYWNlNCA9IEZhY2U0OwoJZXhwb3J0cy5MaW5lU3RyaXAgPSBMaW5lU3RyaXA7CglleHBvcnRzLkxpbmVQaWVjZXMgPSBMaW5lUGllY2VzOwoJZXhwb3J0cy5NZXNoRmFjZU1hdGVyaWFsID0gTWVzaEZhY2VNYXRlcmlhbDsKCWV4cG9ydHMuTXVsdGlNYXRlcmlhbCA9IE11bHRpTWF0ZXJpYWw7CglleHBvcnRzLlBvaW50Q2xvdWQgPSBQb2ludENsb3VkOwoJZXhwb3J0cy5QYXJ0aWNsZSA9IFBhcnRpY2xlOwoJZXhwb3J0cy5QYXJ0aWNsZVN5c3RlbSA9IFBhcnRpY2xlU3lzdGVtOwoJZXhwb3J0cy5Qb2ludENsb3VkTWF0ZXJpYWwgPSBQb2ludENsb3VkTWF0ZXJpYWw7CglleHBvcnRzLlBhcnRpY2xlQmFzaWNNYXRlcmlhbCA9IFBhcnRpY2xlQmFzaWNNYXRlcmlhbDsKCWV4cG9ydHMuUGFydGljbGVTeXN0ZW1NYXRlcmlhbCA9IFBhcnRpY2xlU3lzdGVtTWF0ZXJpYWw7CglleHBvcnRzLlZlcnRleCA9IFZlcnRleDsKCWV4cG9ydHMuRHluYW1pY0J1ZmZlckF0dHJpYnV0ZSA9IER5bmFtaWNCdWZmZXJBdHRyaWJ1dGU7CglleHBvcnRzLkludDhBdHRyaWJ1dGUgPSBJbnQ4QXR0cmlidXRlOwoJZXhwb3J0cy5VaW50OEF0dHJpYnV0ZSA9IFVpbnQ4QXR0cmlidXRlOwoJZXhwb3J0cy5VaW50OENsYW1wZWRBdHRyaWJ1dGUgPSBVaW50OENsYW1wZWRBdHRyaWJ1dGU7CglleHBvcnRzLkludDE2QXR0cmlidXRlID0gSW50MTZBdHRyaWJ1dGU7CglleHBvcnRzLlVpbnQxNkF0dHJpYnV0ZSA9IFVpbnQxNkF0dHJpYnV0ZTsKCWV4cG9ydHMuSW50MzJBdHRyaWJ1dGUgPSBJbnQzMkF0dHJpYnV0ZTsKCWV4cG9ydHMuVWludDMyQXR0cmlidXRlID0gVWludDMyQXR0cmlidXRlOwoJZXhwb3J0cy5GbG9hdDMyQXR0cmlidXRlID0gRmxvYXQzMkF0dHJpYnV0ZTsKCWV4cG9ydHMuRmxvYXQ2NEF0dHJpYnV0ZSA9IEZsb2F0NjRBdHRyaWJ1dGU7CglleHBvcnRzLkNsb3NlZFNwbGluZUN1cnZlMyA9IENsb3NlZFNwbGluZUN1cnZlMzsKCWV4cG9ydHMuU3BsaW5lQ3VydmUzID0gU3BsaW5lQ3VydmUzOwoJZXhwb3J0cy5TcGxpbmUgPSBTcGxpbmU7CglleHBvcnRzLkF4aXNIZWxwZXIgPSBBeGlzSGVscGVyOwoJZXhwb3J0cy5Cb3VuZGluZ0JveEhlbHBlciA9IEJvdW5kaW5nQm94SGVscGVyOwoJZXhwb3J0cy5FZGdlc0hlbHBlciA9IEVkZ2VzSGVscGVyOwoJZXhwb3J0cy5XaXJlZnJhbWVIZWxwZXIgPSBXaXJlZnJhbWVIZWxwZXI7CglleHBvcnRzLlhIUkxvYWRlciA9IFhIUkxvYWRlcjsKCWV4cG9ydHMuQmluYXJ5VGV4dHVyZUxvYWRlciA9IEJpbmFyeVRleHR1cmVMb2FkZXI7CglleHBvcnRzLkdlb21ldHJ5VXRpbHMgPSBHZW9tZXRyeVV0aWxzOwoJZXhwb3J0cy5Qcm9qZWN0b3IgPSBQcm9qZWN0b3I7CglleHBvcnRzLkNhbnZhc1JlbmRlcmVyID0gQ2FudmFzUmVuZGVyZXI7CglleHBvcnRzLkpTT05Mb2FkZXIgPSBKU09OTG9hZGVyOwoJZXhwb3J0cy5TY2VuZVV0aWxzID0gU2NlbmVVdGlsczsKCWV4cG9ydHMuTGVuc0ZsYXJlID0gTGVuc0ZsYXJlOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7Cgp9KSk7Cgp9LHt9XSwzODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8vIENvcHlyaWdodCAyMDE2IFRoZSBEcmFjbyBBdXRob3JzLgovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KLy8KJ3VzZSBzdHJpY3QnOwoKLyoqCiAqIEBwYXJhbSB7VEhSRUUuTG9hZGluZ01hbmFnZXJ9IG1hbmFnZXIKICovClRIUkVFLkRSQUNPTG9hZGVyID0gZnVuY3Rpb24obWFuYWdlcikgewogICAgdGhpcy50aW1lTG9hZGVkID0gMDsKICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXIgfHwgVEhSRUUuRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwogICAgdGhpcy5tYXRlcmlhbHMgPSBudWxsOwogICAgdGhpcy52ZXJib3NpdHkgPSAwOwogICAgdGhpcy5hdHRyaWJ1dGVPcHRpb25zID0ge307CiAgICB0aGlzLmRyYXdNb2RlID0gVEhSRUUuVHJpYW5nbGVzRHJhd01vZGU7CiAgICAvLyBOYXRpdmUgRHJhY28gYXR0cmlidXRlIHR5cGUgdG8gVGhyZWUuSlMgYXR0cmlidXRlIHR5cGUuCiAgICB0aGlzLm5hdGl2ZUF0dHJpYnV0ZU1hcCA9IHsKICAgICAgJ3Bvc2l0aW9uJyA6ICdQT1NJVElPTicsCiAgICAgICdub3JtYWwnIDogJ05PUk1BTCcsCiAgICAgICdjb2xvcicgOiAnQ09MT1InLAogICAgICAndXYnIDogJ1RFWF9DT09SRCcKICAgIH07Cn07CgpUSFJFRS5EUkFDT0xvYWRlci5wcm90b3R5cGUgPSB7CgogICAgY29uc3RydWN0b3I6IFRIUkVFLkRSQUNPTG9hZGVyLAoKICAgIGxvYWQ6IGZ1bmN0aW9uKHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB7CiAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKICAgICAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLkZpbGVMb2FkZXIoc2NvcGUubWFuYWdlcik7CiAgICAgICAgbG9hZGVyLnNldFBhdGgodGhpcy5wYXRoKTsKICAgICAgICBsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCdhcnJheWJ1ZmZlcicpOwogICAgICAgIGxvYWRlci5sb2FkKHVybCwgZnVuY3Rpb24oYmxvYikgewogICAgICAgICAgICBzY29wZS5kZWNvZGVEcmFjb0ZpbGUoYmxvYiwgb25Mb2FkKTsKICAgICAgICB9LCBvblByb2dyZXNzLCBvbkVycm9yKTsKICAgIH0sCgogICAgc2V0UGF0aDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLnBhdGggPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgc2V0VmVyYm9zaXR5OiBmdW5jdGlvbihsZXZlbCkgewogICAgICAgIHRoaXMudmVyYm9zaXR5ID0gbGV2ZWw7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogIFNldHMgZGVzaXJlZCBtb2RlIGZvciBnZW5lcmF0ZWQgZ2VvbWV0cnkgaW5kaWNlcy4KICAgICAqICBDYW4gYmUgZWl0aGVyOgogICAgICogICAgICBUSFJFRS5UcmlhbmdsZXNEcmF3TW9kZQogICAgICogICAgICBUSFJFRS5UcmlhbmdsZVN0cmlwRHJhd01vZGUKICAgICAqLwogICAgc2V0RHJhd01vZGU6IGZ1bmN0aW9uKGRyYXdNb2RlKSB7CiAgICAgICAgdGhpcy5kcmF3TW9kZSA9IGRyYXdNb2RlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFNraXBzIGRlcXVhbnRpemF0aW9uIGZvciBhIHNwZWNpZmljIGF0dHJpYnV0ZS4KICAgICAqIHxhdHRyaWJ1dGVOYW1lfCBpcyB0aGUgVEhSRUUuanMgbmFtZSBvZiB0aGUgZ2l2ZW4gYXR0cmlidXRlIHR5cGUuCiAgICAgKiBUaGUgb25seSBjdXJyZW50bHkgc3VwcG9ydGVkIHxhdHRyaWJ1dGVOYW1lfCBpcyAncG9zaXRpb24nLCBtb3JlIG1heSBiZQogICAgICogYWRkZWQgaW4gZnV0dXJlLgogICAgICovCiAgICBzZXRTa2lwRGVxdWFudGl6YXRpb246IGZ1bmN0aW9uKGF0dHJpYnV0ZU5hbWUsIHNraXApIHsKICAgICAgICB2YXIgc2tpcERlcXVhbnRpemF0aW9uID0gdHJ1ZTsKICAgICAgICBpZiAodHlwZW9mIHNraXAgIT09ICd1bmRlZmluZWQnKQogICAgICAgICAgc2tpcERlcXVhbnRpemF0aW9uID0gc2tpcDsKICAgICAgICB0aGlzLmdldEF0dHJpYnV0ZU9wdGlvbnMoYXR0cmlidXRlTmFtZSkuc2tpcERlcXVhbnRpemF0aW9uID0KICAgICAgICAgICAgc2tpcERlcXVhbnRpemF0aW9uOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIERlY29tcHJlc3NlcyBhIERyYWNvIGJ1ZmZlci4gTmFtZXMgb2YgYXR0cmlidXRlcyAoZm9yIElEIGFuZCB0eXBlIG1hcHMpCiAgICAgKiBtdXN0IGJlIG9uZSBvZiB0aGUgc3VwcG9ydGVkIHRocmVlLmpzIHR5cGVzLCBpbmNsdWRpbmc6IHBvc2l0aW9uLCBjb2xvciwKICAgICAqIG5vcm1hbCwgdXYsIHV2Miwgc2tpbkluZGV4LCBza2luV2VpZ2h0LgogICAgICoKICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IHJhd0J1ZmZlcgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlVW5pcXVlSWRNYXAgUHJvdmlkZXMgYSBwcmUtZGVmaW5lZCBJRAogICAgICogICAgIGZvciBlYWNoIGF0dHJpYnV0ZSBpbiB0aGUgZ2VvbWV0cnkgdG8gYmUgZGVjb2RlZC4gSWYgZ2l2ZW4sCiAgICAgKiAgICAgYGF0dHJpYnV0ZVR5cGVNYXBgIGlzIHJlcXVpcmVkIGFuZCBgbmF0aXZlQXR0cmlidXRlTWFwYCB3aWxsIGJlCiAgICAgKiAgICAgaWdub3JlZC4KICAgICAqIEBwYXJhbSB7T2JqZWN0fHVuZGVmaW5lZH0gYXR0cmlidXRlVHlwZU1hcCBQcm92aWRlcyBhIHByZWRlZmluZWQgZGF0YQogICAgICogICAgIHR5cGUgKGFzIGEgdHlwZWQgYXJyYXkgY29uc3RydWN0b3IpIGZvciBlYWNoIGF0dHJpYnV0ZSBpbiB0aGUKICAgICAqICAgICBnZW9tZXRyeSB0byBiZSBkZWNvZGVkLgogICAgICovCiAgICBkZWNvZGVEcmFjb0ZpbGU6IGZ1bmN0aW9uKHJhd0J1ZmZlciwgY2FsbGJhY2ssIGF0dHJpYnV0ZVVuaXF1ZUlkTWFwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVUeXBlTWFwKSB7CiAgICAgIHZhciBzY29wZSA9IHRoaXM7CiAgICAgIFRIUkVFLkRSQUNPTG9hZGVyLmdldERlY29kZXJNb2R1bGUoKQogICAgICAgICAgLnRoZW4oIGZ1bmN0aW9uICggbW9kdWxlICkgewogICAgICAgICAgICBzY29wZS5kZWNvZGVEcmFjb0ZpbGVJbnRlcm5hbCggcmF3QnVmZmVyLCBtb2R1bGUuZGVjb2RlciwgY2FsbGJhY2ssCiAgICAgICAgICAgICAgYXR0cmlidXRlVW5pcXVlSWRNYXAsIGF0dHJpYnV0ZVR5cGVNYXApOwogICAgICAgICAgfSk7CiAgICB9LAoKICAgIGRlY29kZURyYWNvRmlsZUludGVybmFsOiBmdW5jdGlvbihyYXdCdWZmZXIsIGRyYWNvRGVjb2RlciwgY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlVW5pcXVlSWRNYXAsIGF0dHJpYnV0ZVR5cGVNYXApIHsKICAgICAgLyoKICAgICAgICogSGVyZSBpcyBob3cgdG8gdXNlIERyYWNvIEphdmFzY3JpcHQgZGVjb2RlciBhbmQgZ2V0IHRoZSBnZW9tZXRyeS4KICAgICAgICovCiAgICAgIHZhciBidWZmZXIgPSBuZXcgZHJhY29EZWNvZGVyLkRlY29kZXJCdWZmZXIoKTsKICAgICAgYnVmZmVyLkluaXQobmV3IEludDhBcnJheShyYXdCdWZmZXIpLCByYXdCdWZmZXIuYnl0ZUxlbmd0aCk7CiAgICAgIHZhciBkZWNvZGVyID0gbmV3IGRyYWNvRGVjb2Rlci5EZWNvZGVyKCk7CgogICAgICAvKgogICAgICAgKiBEZXRlcm1pbmUgd2hhdCB0eXBlIGlzIHRoaXMgZmlsZTogbWVzaCBvciBwb2ludCBjbG91ZC4KICAgICAgICovCiAgICAgIHZhciBnZW9tZXRyeVR5cGUgPSBkZWNvZGVyLkdldEVuY29kZWRHZW9tZXRyeVR5cGUoYnVmZmVyKTsKICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PSBkcmFjb0RlY29kZXIuVFJJQU5HVUxBUl9NRVNIKSB7CiAgICAgICAgaWYgKHRoaXMudmVyYm9zaXR5ID4gMCkgewogICAgICAgICAgY29uc29sZS5sb2coJ0xvYWRlZCBhIG1lc2guJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PSBkcmFjb0RlY29kZXIuUE9JTlRfQ0xPVUQpIHsKICAgICAgICBpZiAodGhpcy52ZXJib3NpdHkgPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnTG9hZGVkIGEgcG9pbnQgY2xvdWQuJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBlcnJvck1zZyA9ICdUSFJFRS5EUkFDT0xvYWRlcjogVW5rbm93biBnZW9tZXRyeSB0eXBlLic7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvck1zZyk7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTsKICAgICAgfQogICAgICBjYWxsYmFjayh0aGlzLmNvbnZlcnREcmFjb0dlb21ldHJ5VG8zSlMoZHJhY29EZWNvZGVyLCBkZWNvZGVyLAogICAgICAgICAgZ2VvbWV0cnlUeXBlLCBidWZmZXIsIGF0dHJpYnV0ZVVuaXF1ZUlkTWFwLCBhdHRyaWJ1dGVUeXBlTWFwKSk7CiAgICB9LAoKICAgIGFkZEF0dHJpYnV0ZVRvR2VvbWV0cnk6IGZ1bmN0aW9uKGRyYWNvRGVjb2RlciwgZGVjb2RlciwgZHJhY29HZW9tZXRyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlb21ldHJ5LCBnZW9tZXRyeUJ1ZmZlcikgewogICAgICBpZiAoYXR0cmlidXRlLnB0ciA9PT0gMCkgewogICAgICAgIHZhciBlcnJvck1zZyA9ICdUSFJFRS5EUkFDT0xvYWRlcjogTm8gYXR0cmlidXRlICcgKyBhdHRyaWJ1dGVOYW1lOwogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNc2cpOwogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyk7CiAgICAgIH0KCiAgICAgIHZhciBudW1Db21wb25lbnRzID0gYXR0cmlidXRlLm51bV9jb21wb25lbnRzKCk7CiAgICAgIHZhciBudW1Qb2ludHMgPSBkcmFjb0dlb21ldHJ5Lm51bV9wb2ludHMoKTsKICAgICAgdmFyIG51bVZhbHVlcyA9IG51bVBvaW50cyAqIG51bUNvbXBvbmVudHM7CiAgICAgIHZhciBhdHRyaWJ1dGVEYXRhOwogICAgICB2YXIgVHlwZWRCdWZmZXJBdHRyaWJ1dGU7CgogICAgICBzd2l0Y2ggKCBhdHRyaWJ1dGVUeXBlICkgewoKICAgICAgICBjYXNlIEZsb2F0MzJBcnJheToKICAgICAgICAgIGF0dHJpYnV0ZURhdGEgPSBuZXcgZHJhY29EZWNvZGVyLkRyYWNvRmxvYXQzMkFycmF5KCk7CiAgICAgICAgICBkZWNvZGVyLkdldEF0dHJpYnV0ZUZsb2F0Rm9yQWxsUG9pbnRzKAogICAgICAgICAgICBkcmFjb0dlb21ldHJ5LCBhdHRyaWJ1dGUsIGF0dHJpYnV0ZURhdGEpOwogICAgICAgICAgZ2VvbWV0cnlCdWZmZXJbIGF0dHJpYnV0ZU5hbWUgXSA9IG5ldyBGbG9hdDMyQXJyYXkoIG51bVZhbHVlcyApOwogICAgICAgICAgVHlwZWRCdWZmZXJBdHRyaWJ1dGUgPSBUSFJFRS5GbG9hdDMyQnVmZmVyQXR0cmlidXRlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgSW50OEFycmF5OgogICAgICAgICAgYXR0cmlidXRlRGF0YSA9IG5ldyBkcmFjb0RlY29kZXIuRHJhY29JbnQ4QXJyYXkoKTsKICAgICAgICAgIGRlY29kZXIuR2V0QXR0cmlidXRlSW50OEZvckFsbFBvaW50cygKICAgICAgICAgICAgZHJhY29HZW9tZXRyeSwgYXR0cmlidXRlLCBhdHRyaWJ1dGVEYXRhICk7CiAgICAgICAgICBnZW9tZXRyeUJ1ZmZlclsgYXR0cmlidXRlTmFtZSBdID0gbmV3IEludDhBcnJheSggbnVtVmFsdWVzICk7CiAgICAgICAgICBUeXBlZEJ1ZmZlckF0dHJpYnV0ZSA9IFRIUkVFLkludDhCdWZmZXJBdHRyaWJ1dGU7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBJbnQxNkFycmF5OgogICAgICAgICAgYXR0cmlidXRlRGF0YSA9IG5ldyBkcmFjb0RlY29kZXIuRHJhY29JbnQxNkFycmF5KCk7CiAgICAgICAgICBkZWNvZGVyLkdldEF0dHJpYnV0ZUludDE2Rm9yQWxsUG9pbnRzKAogICAgICAgICAgICBkcmFjb0dlb21ldHJ5LCBhdHRyaWJ1dGUsIGF0dHJpYnV0ZURhdGEpOwogICAgICAgICAgZ2VvbWV0cnlCdWZmZXJbIGF0dHJpYnV0ZU5hbWUgXSA9IG5ldyBJbnQxNkFycmF5KCBudW1WYWx1ZXMgKTsKICAgICAgICAgIFR5cGVkQnVmZmVyQXR0cmlidXRlID0gVEhSRUUuSW50MTZCdWZmZXJBdHRyaWJ1dGU7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBJbnQzMkFycmF5OgogICAgICAgICAgYXR0cmlidXRlRGF0YSA9IG5ldyBkcmFjb0RlY29kZXIuRHJhY29JbnQzMkFycmF5KCk7CiAgICAgICAgICBkZWNvZGVyLkdldEF0dHJpYnV0ZUludDMyRm9yQWxsUG9pbnRzKAogICAgICAgICAgICBkcmFjb0dlb21ldHJ5LCBhdHRyaWJ1dGUsIGF0dHJpYnV0ZURhdGEpOwogICAgICAgICAgZ2VvbWV0cnlCdWZmZXJbIGF0dHJpYnV0ZU5hbWUgXSA9IG5ldyBJbnQzMkFycmF5KCBudW1WYWx1ZXMgKTsKICAgICAgICAgIFR5cGVkQnVmZmVyQXR0cmlidXRlID0gVEhSRUUuSW50MzJCdWZmZXJBdHRyaWJ1dGU7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBVaW50OEFycmF5OgogICAgICAgICAgYXR0cmlidXRlRGF0YSA9IG5ldyBkcmFjb0RlY29kZXIuRHJhY29VSW50OEFycmF5KCk7CiAgICAgICAgICBkZWNvZGVyLkdldEF0dHJpYnV0ZVVJbnQ4Rm9yQWxsUG9pbnRzKAogICAgICAgICAgICBkcmFjb0dlb21ldHJ5LCBhdHRyaWJ1dGUsIGF0dHJpYnV0ZURhdGEpOwogICAgICAgICAgZ2VvbWV0cnlCdWZmZXJbIGF0dHJpYnV0ZU5hbWUgXSA9IG5ldyBVaW50OEFycmF5KCBudW1WYWx1ZXMgKTsKICAgICAgICAgIFR5cGVkQnVmZmVyQXR0cmlidXRlID0gVEhSRUUuVWludDhCdWZmZXJBdHRyaWJ1dGU7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBVaW50MTZBcnJheToKICAgICAgICAgIGF0dHJpYnV0ZURhdGEgPSBuZXcgZHJhY29EZWNvZGVyLkRyYWNvVUludDE2QXJyYXkoKTsKICAgICAgICAgIGRlY29kZXIuR2V0QXR0cmlidXRlVUludDE2Rm9yQWxsUG9pbnRzKAogICAgICAgICAgICBkcmFjb0dlb21ldHJ5LCBhdHRyaWJ1dGUsIGF0dHJpYnV0ZURhdGEpOwogICAgICAgICAgZ2VvbWV0cnlCdWZmZXJbIGF0dHJpYnV0ZU5hbWUgXSA9IG5ldyBVaW50MTZBcnJheSggbnVtVmFsdWVzICk7CiAgICAgICAgICBUeXBlZEJ1ZmZlckF0dHJpYnV0ZSA9IFRIUkVFLlVpbnQxNkJ1ZmZlckF0dHJpYnV0ZTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFVpbnQzMkFycmF5OgogICAgICAgICAgYXR0cmlidXRlRGF0YSA9IG5ldyBkcmFjb0RlY29kZXIuRHJhY29VSW50MzJBcnJheSgpOwogICAgICAgICAgZGVjb2Rlci5HZXRBdHRyaWJ1dGVVSW50MzJGb3JBbGxQb2ludHMoCiAgICAgICAgICAgIGRyYWNvR2VvbWV0cnksIGF0dHJpYnV0ZSwgYXR0cmlidXRlRGF0YSk7CiAgICAgICAgICBnZW9tZXRyeUJ1ZmZlclsgYXR0cmlidXRlTmFtZSBdID0gbmV3IFVpbnQzMkFycmF5KCBudW1WYWx1ZXMgKTsKICAgICAgICAgIFR5cGVkQnVmZmVyQXR0cmlidXRlID0gVEhSRUUuVWludDMyQnVmZmVyQXR0cmlidXRlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAnVEhSRUUuRFJBQ09Mb2FkZXI6IFVuZXhwZWN0ZWQgYXR0cmlidXRlIHR5cGUuJzsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIGVycm9yTXNnICk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIGVycm9yTXNnICk7CgogICAgICB9CgogICAgICAvLyBDb3B5IGRhdGEgZnJvbSBkZWNvZGVyLgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bVZhbHVlczsgaSsrKSB7CiAgICAgICAgZ2VvbWV0cnlCdWZmZXJbYXR0cmlidXRlTmFtZV1baV0gPSBhdHRyaWJ1dGVEYXRhLkdldFZhbHVlKGkpOwogICAgICB9CiAgICAgIC8vIEFkZCBhdHRyaWJ1dGUgdG8gVEhSRUVKUyBnZW9tZXRyeSBmb3IgcmVuZGVyaW5nLgogICAgICBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwKICAgICAgICAgIG5ldyBUeXBlZEJ1ZmZlckF0dHJpYnV0ZShnZW9tZXRyeUJ1ZmZlclthdHRyaWJ1dGVOYW1lXSwKICAgICAgICAgICAgbnVtQ29tcG9uZW50cykpOwogICAgICBkcmFjb0RlY29kZXIuZGVzdHJveShhdHRyaWJ1dGVEYXRhKTsKICAgIH0sCgogICAgY29udmVydERyYWNvR2VvbWV0cnlUbzNKUzogZnVuY3Rpb24oZHJhY29EZWNvZGVyLCBkZWNvZGVyLCBnZW9tZXRyeVR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIsIGF0dHJpYnV0ZVVuaXF1ZUlkTWFwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlVHlwZU1hcCkgewogICAgICAgIC8vIFRPRE86IFNob3VsZCBub3QgYXNzdW1lIG5hdGl2ZSBEcmFjbyBhdHRyaWJ1dGUgSURzIGFwcGx5LgogICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZU9wdGlvbnMoJ3Bvc2l0aW9uJykuc2tpcERlcXVhbnRpemF0aW9uID09PSB0cnVlKSB7CiAgICAgICAgICBkZWNvZGVyLlNraXBBdHRyaWJ1dGVUcmFuc2Zvcm0oZHJhY29EZWNvZGVyLlBPU0lUSU9OKTsKICAgICAgICB9CiAgICAgICAgdmFyIGRyYWNvR2VvbWV0cnk7CiAgICAgICAgdmFyIGRlY29kaW5nU3RhdHVzOwogICAgICAgIHZhciBzdGFydF90aW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PT0gZHJhY29EZWNvZGVyLlRSSUFOR1VMQVJfTUVTSCkgewogICAgICAgICAgZHJhY29HZW9tZXRyeSA9IG5ldyBkcmFjb0RlY29kZXIuTWVzaCgpOwogICAgICAgICAgZGVjb2RpbmdTdGF0dXMgPSBkZWNvZGVyLkRlY29kZUJ1ZmZlclRvTWVzaChidWZmZXIsIGRyYWNvR2VvbWV0cnkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkcmFjb0dlb21ldHJ5ID0gbmV3IGRyYWNvRGVjb2Rlci5Qb2ludENsb3VkKCk7CiAgICAgICAgICBkZWNvZGluZ1N0YXR1cyA9CiAgICAgICAgICAgICAgZGVjb2Rlci5EZWNvZGVCdWZmZXJUb1BvaW50Q2xvdWQoYnVmZmVyLCBkcmFjb0dlb21ldHJ5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFkZWNvZGluZ1N0YXR1cy5vaygpIHx8IGRyYWNvR2VvbWV0cnkucHRyID09IDApIHsKICAgICAgICAgIHZhciBlcnJvck1zZyA9ICdUSFJFRS5EUkFDT0xvYWRlcjogRGVjb2RpbmcgZmFpbGVkOiAnOwogICAgICAgICAgZXJyb3JNc2cgKz0gZGVjb2RpbmdTdGF0dXMuZXJyb3JfbXNnKCk7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTXNnKTsKICAgICAgICAgIGRyYWNvRGVjb2Rlci5kZXN0cm95KGRlY29kZXIpOwogICAgICAgICAgZHJhY29EZWNvZGVyLmRlc3Ryb3koZHJhY29HZW9tZXRyeSk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlY29kZV9lbmQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICBkcmFjb0RlY29kZXIuZGVzdHJveShidWZmZXIpOwogICAgICAgIC8qCiAgICAgICAgICogRXhhbXBsZSBvbiBob3cgdG8gcmV0cmlldmUgbWVzaCBhbmQgYXR0cmlidXRlcy4KICAgICAgICAgKi8KICAgICAgICB2YXIgbnVtRmFjZXM7CiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PSBkcmFjb0RlY29kZXIuVFJJQU5HVUxBUl9NRVNIKSB7CiAgICAgICAgICBudW1GYWNlcyA9IGRyYWNvR2VvbWV0cnkubnVtX2ZhY2VzKCk7CiAgICAgICAgICBpZiAodGhpcy52ZXJib3NpdHkgPiAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOdW1iZXIgb2YgZmFjZXMgbG9hZGVkOiAnICsgbnVtRmFjZXMudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG51bUZhY2VzID0gMDsKICAgICAgICB9CgogICAgICAgIHZhciBudW1Qb2ludHMgPSBkcmFjb0dlb21ldHJ5Lm51bV9wb2ludHMoKTsKICAgICAgICB2YXIgbnVtQXR0cmlidXRlcyA9IGRyYWNvR2VvbWV0cnkubnVtX2F0dHJpYnV0ZXMoKTsKICAgICAgICBpZiAodGhpcy52ZXJib3NpdHkgPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnTnVtYmVyIG9mIHBvaW50cyBsb2FkZWQ6ICcgKyBudW1Qb2ludHMudG9TdHJpbmcoKSk7CiAgICAgICAgICBjb25zb2xlLmxvZygnTnVtYmVyIG9mIGF0dHJpYnV0ZXMgbG9hZGVkOiAnICsKICAgICAgICAgICAgICBudW1BdHRyaWJ1dGVzLnRvU3RyaW5nKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gVmVyaWZ5IGlmIHRoZXJlIGlzIHBvc2l0aW9uIGF0dHJpYnV0ZS4KICAgICAgICAvLyBUT0RPOiBTaG91bGQgbm90IGFzc3VtZSBuYXRpdmUgRHJhY28gYXR0cmlidXRlIElEcyBhcHBseS4KICAgICAgICB2YXIgcG9zQXR0SWQgPSBkZWNvZGVyLkdldEF0dHJpYnV0ZUlkKGRyYWNvR2VvbWV0cnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFjb0RlY29kZXIuUE9TSVRJT04pOwogICAgICAgIGlmIChwb3NBdHRJZCA9PSAtMSkgewogICAgICAgICAgdmFyIGVycm9yTXNnID0gJ1RIUkVFLkRSQUNPTG9hZGVyOiBObyBwb3NpdGlvbiBhdHRyaWJ1dGUgZm91bmQuJzsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JNc2cpOwogICAgICAgICAgZHJhY29EZWNvZGVyLmRlc3Ryb3koZGVjb2Rlcik7CiAgICAgICAgICBkcmFjb0RlY29kZXIuZGVzdHJveShkcmFjb0dlb21ldHJ5KTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1zZyk7CiAgICAgICAgfQogICAgICAgIHZhciBwb3NBdHRyaWJ1dGUgPSBkZWNvZGVyLkdldEF0dHJpYnV0ZShkcmFjb0dlb21ldHJ5LCBwb3NBdHRJZCk7CgogICAgICAgIC8vIFN0cnVjdHVyZSBmb3IgY29udmVydGluZyB0byBUSFJFRUpTIGdlb21ldHJ5IGxhdGVyLgogICAgICAgIHZhciBnZW9tZXRyeUJ1ZmZlciA9IHt9OwogICAgICAgIC8vIEltcG9ydCBkYXRhIHRvIFRocmVlIEpTIGdlb21ldHJ5LgogICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpOwoKICAgICAgICAvLyBEbyBub3QgdXNlIGJvdGggdGhlIG5hdGl2ZSBhdHRyaWJ1dGUgbWFwIGFuZCBhIHByb3ZpZGVkIChlLmcuIGdsVEYpIG1hcC4KICAgICAgICBpZiAoIGF0dHJpYnV0ZVVuaXF1ZUlkTWFwICkgewoKICAgICAgICAgIC8vIEFkZCBhdHRyaWJ1dGVzIG9mIHVzZXIgc3BlY2lmaWVkIHVuaXF1ZSBpZC4gRS5nLiBHTFRGIG1vZGVscy4KICAgICAgICAgIGZvciAodmFyIGF0dHJpYnV0ZU5hbWUgaW4gYXR0cmlidXRlVW5pcXVlSWRNYXApIHsKICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZVR5cGUgPSBhdHRyaWJ1dGVUeXBlTWFwW2F0dHJpYnV0ZU5hbWVdOwogICAgICAgICAgICB2YXIgYXR0cmlidXRlSWQgPSBhdHRyaWJ1dGVVbmlxdWVJZE1hcFthdHRyaWJ1dGVOYW1lXTsKICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGRlY29kZXIuR2V0QXR0cmlidXRlQnlVbmlxdWVJZChkcmFjb0dlb21ldHJ5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUlkKTsKICAgICAgICAgICAgdGhpcy5hZGRBdHRyaWJ1dGVUb0dlb21ldHJ5KGRyYWNvRGVjb2RlciwgZGVjb2RlciwgZHJhY29HZW9tZXRyeSwKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGF0dHJpYnV0ZSwgZ2VvbWV0cnksIGdlb21ldHJ5QnVmZmVyKTsKICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAvLyBBZGQgbmF0aXZlIERyYWNvIGF0dHJpYnV0ZSB0eXBlIHRvIGdlb21ldHJ5LgogICAgICAgICAgZm9yICh2YXIgYXR0cmlidXRlTmFtZSBpbiB0aGlzLm5hdGl2ZUF0dHJpYnV0ZU1hcCkgewogICAgICAgICAgICB2YXIgYXR0SWQgPSBkZWNvZGVyLkdldEF0dHJpYnV0ZUlkKGRyYWNvR2VvbWV0cnksCiAgICAgICAgICAgICAgICBkcmFjb0RlY29kZXJbdGhpcy5uYXRpdmVBdHRyaWJ1dGVNYXBbYXR0cmlidXRlTmFtZV1dKTsKICAgICAgICAgICAgaWYgKGF0dElkICE9PSAtMSkgewogICAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2l0eSA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdMb2FkZWQgJyArIGF0dHJpYnV0ZU5hbWUgKyAnIGF0dHJpYnV0ZS4nKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZSA9IGRlY29kZXIuR2V0QXR0cmlidXRlKGRyYWNvR2VvbWV0cnksIGF0dElkKTsKICAgICAgICAgICAgICB0aGlzLmFkZEF0dHJpYnV0ZVRvR2VvbWV0cnkoZHJhY29EZWNvZGVyLCBkZWNvZGVyLCBkcmFjb0dlb21ldHJ5LAogICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lLCBGbG9hdDMyQXJyYXksIGF0dHJpYnV0ZSwgZ2VvbWV0cnksIGdlb21ldHJ5QnVmZmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIC8vIEZvciBtZXNoLCB3ZSBuZWVkIHRvIGdlbmVyYXRlIHRoZSBmYWNlcy4KICAgICAgICBpZiAoZ2VvbWV0cnlUeXBlID09IGRyYWNvRGVjb2Rlci5UUklBTkdVTEFSX01FU0gpIHsKICAgICAgICAgIGlmICh0aGlzLmRyYXdNb2RlID09PSBUSFJFRS5UcmlhbmdsZVN0cmlwRHJhd01vZGUpIHsKICAgICAgICAgICAgdmFyIHN0cmlwc0FycmF5ID0gbmV3IGRyYWNvRGVjb2Rlci5EcmFjb0ludDMyQXJyYXkoKTsKICAgICAgICAgICAgdmFyIG51bVN0cmlwcyA9IGRlY29kZXIuR2V0VHJpYW5nbGVTdHJpcHNGcm9tTWVzaCgKICAgICAgICAgICAgICAgIGRyYWNvR2VvbWV0cnksIHN0cmlwc0FycmF5KTsKICAgICAgICAgICAgZ2VvbWV0cnlCdWZmZXIuaW5kaWNlcyA9IG5ldyBVaW50MzJBcnJheShzdHJpcHNBcnJheS5zaXplKCkpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cmlwc0FycmF5LnNpemUoKTsgKytpKSB7CiAgICAgICAgICAgICAgZ2VvbWV0cnlCdWZmZXIuaW5kaWNlc1tpXSA9IHN0cmlwc0FycmF5LkdldFZhbHVlKGkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRyYWNvRGVjb2Rlci5kZXN0cm95KHN0cmlwc0FycmF5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBudW1JbmRpY2VzID0gbnVtRmFjZXMgKiAzOwogICAgICAgICAgICBnZW9tZXRyeUJ1ZmZlci5pbmRpY2VzID0gbmV3IFVpbnQzMkFycmF5KG51bUluZGljZXMpOwogICAgICAgICAgICB2YXIgaWEgPSBuZXcgZHJhY29EZWNvZGVyLkRyYWNvSW50MzJBcnJheSgpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUZhY2VzOyArK2kpIHsKICAgICAgICAgICAgICBkZWNvZGVyLkdldEZhY2VGcm9tTWVzaChkcmFjb0dlb21ldHJ5LCBpLCBpYSk7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaSAqIDM7CiAgICAgICAgICAgICAgZ2VvbWV0cnlCdWZmZXIuaW5kaWNlc1tpbmRleF0gPSBpYS5HZXRWYWx1ZSgwKTsKICAgICAgICAgICAgICBnZW9tZXRyeUJ1ZmZlci5pbmRpY2VzW2luZGV4ICsgMV0gPSBpYS5HZXRWYWx1ZSgxKTsKICAgICAgICAgICAgICBnZW9tZXRyeUJ1ZmZlci5pbmRpY2VzW2luZGV4ICsgMl0gPSBpYS5HZXRWYWx1ZSgyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkcmFjb0RlY29kZXIuZGVzdHJveShpYSk7CiAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGdlb21ldHJ5LmRyYXdNb2RlID0gdGhpcy5kcmF3TW9kZTsKICAgICAgICBpZiAoZ2VvbWV0cnlUeXBlID09IGRyYWNvRGVjb2Rlci5UUklBTkdVTEFSX01FU0gpIHsKICAgICAgICAgIGdlb21ldHJ5LnNldEluZGV4KG5ldyhnZW9tZXRyeUJ1ZmZlci5pbmRpY2VzLmxlbmd0aCA+IDY1NTM1ID8KICAgICAgICAgICAgICAgIFRIUkVFLlVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFRIUkVFLlVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSkKICAgICAgICAgICAgICAoZ2VvbWV0cnlCdWZmZXIuaW5kaWNlcywgMSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gVE9ETzogU2hvdWxkIG5vdCBhc3N1bWUgbmF0aXZlIERyYWNvIGF0dHJpYnV0ZSBJRHMgYXBwbHkuCiAgICAgICAgLy8gVE9ETzogQ2FuIG90aGVyIGF0dHJpYnV0ZSB0eXBlcyBiZSBxdWFudGl6ZWQ/CiAgICAgICAgdmFyIHBvc1RyYW5zZm9ybSA9IG5ldyBkcmFjb0RlY29kZXIuQXR0cmlidXRlUXVhbnRpemF0aW9uVHJhbnNmb3JtKCk7CiAgICAgICAgaWYgKHBvc1RyYW5zZm9ybS5Jbml0RnJvbUF0dHJpYnV0ZShwb3NBdHRyaWJ1dGUpKSB7CiAgICAgICAgICAvLyBRdWFudGl6ZWQgYXR0cmlidXRlLiBTdG9yZSB0aGUgcXVhbnRpemF0aW9uIHBhcmFtZXRlcnMgaW50byB0aGUKICAgICAgICAgIC8vIFRIUkVFLmpzIGF0dHJpYnV0ZS4KICAgICAgICAgIGdlb21ldHJ5LmF0dHJpYnV0ZXNbJ3Bvc2l0aW9uJ10uaXNRdWFudGl6ZWQgPSB0cnVlOwogICAgICAgICAgZ2VvbWV0cnkuYXR0cmlidXRlc1sncG9zaXRpb24nXS5tYXhSYW5nZSA9IHBvc1RyYW5zZm9ybS5yYW5nZSgpOwogICAgICAgICAgZ2VvbWV0cnkuYXR0cmlidXRlc1sncG9zaXRpb24nXS5udW1RdWFudGl6YXRpb25CaXRzID0KICAgICAgICAgICAgICBwb3NUcmFuc2Zvcm0ucXVhbnRpemF0aW9uX2JpdHMoKTsKICAgICAgICAgIGdlb21ldHJ5LmF0dHJpYnV0ZXNbJ3Bvc2l0aW9uJ10ubWluVmFsdWVzID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzsgKytpKSB7CiAgICAgICAgICAgIGdlb21ldHJ5LmF0dHJpYnV0ZXNbJ3Bvc2l0aW9uJ10ubWluVmFsdWVzW2ldID0KICAgICAgICAgICAgICAgIHBvc1RyYW5zZm9ybS5taW5fdmFsdWUoaSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRyYWNvRGVjb2Rlci5kZXN0cm95KHBvc1RyYW5zZm9ybSk7CiAgICAgICAgZHJhY29EZWNvZGVyLmRlc3Ryb3koZGVjb2Rlcik7CiAgICAgICAgZHJhY29EZWNvZGVyLmRlc3Ryb3koZHJhY29HZW9tZXRyeSk7CgogICAgICAgIHRoaXMuZGVjb2RlX3RpbWUgPSBkZWNvZGVfZW5kIC0gc3RhcnRfdGltZTsKICAgICAgICB0aGlzLmltcG9ydF90aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBkZWNvZGVfZW5kOwoKICAgICAgICBpZiAodGhpcy52ZXJib3NpdHkgPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnRGVjb2RlIHRpbWU6ICcgKyB0aGlzLmRlY29kZV90aW1lKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCdJbXBvcnQgdGltZTogJyArIHRoaXMuaW1wb3J0X3RpbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2VvbWV0cnk7CiAgICB9LAoKICAgIGlzVmVyc2lvblN1cHBvcnRlZDogZnVuY3Rpb24odmVyc2lvbiwgY2FsbGJhY2spIHsKICAgICAgICBUSFJFRS5EUkFDT0xvYWRlci5nZXREZWNvZGVyTW9kdWxlKCkKICAgICAgICAgICAgLnRoZW4oIGZ1bmN0aW9uICggbW9kdWxlICkgewogICAgICAgICAgICAgIGNhbGxiYWNrKCBtb2R1bGUuZGVjb2Rlci5pc1ZlcnNpb25TdXBwb3J0ZWQoIHZlcnNpb24gKSApOwogICAgICAgICAgICB9KTsKICAgIH0sCgogICAgZ2V0QXR0cmlidXRlT3B0aW9uczogZnVuY3Rpb24oYXR0cmlidXRlTmFtZSkgewogICAgICAgIGlmICh0eXBlb2YgdGhpcy5hdHRyaWJ1dGVPcHRpb25zW2F0dHJpYnV0ZU5hbWVdID09PSAndW5kZWZpbmVkJykKICAgICAgICAgIHRoaXMuYXR0cmlidXRlT3B0aW9uc1thdHRyaWJ1dGVOYW1lXSA9IHt9OwogICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZU9wdGlvbnNbYXR0cmlidXRlTmFtZV07CiAgICB9Cn07CgpUSFJFRS5EUkFDT0xvYWRlci5kZWNvZGVyUGF0aCA9ICcuLyc7ClRIUkVFLkRSQUNPTG9hZGVyLmRlY29kZXJDb25maWcgPSB7fTsKVEhSRUUuRFJBQ09Mb2FkZXIuZGVjb2Rlck1vZHVsZVByb21pc2UgPSBudWxsOwoKLyoqCiAqIFNldHMgdGhlIGJhc2UgcGF0aCBmb3IgZGVjb2RlciBzb3VyY2UgZmlsZXMuCiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoCiAqLwpUSFJFRS5EUkFDT0xvYWRlci5zZXREZWNvZGVyUGF0aCA9IGZ1bmN0aW9uICggcGF0aCApIHsKICBUSFJFRS5EUkFDT0xvYWRlci5kZWNvZGVyUGF0aCA9IHBhdGg7Cn07CgovKioKICogU2V0cyBkZWNvZGVyIGNvbmZpZ3VyYXRpb24gYW5kIHJlbGVhc2VzIHNpbmdsZXRvbiBkZWNvZGVyIG1vZHVsZS4gTW9kdWxlCiAqIHdpbGwgYmUgcmVjcmVhdGVkIHdpdGggdGhlIG5leHQgZGVjb2RpbmcgY2FsbC4KICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZwogKi8KVEhSRUUuRFJBQ09Mb2FkZXIuc2V0RGVjb2RlckNvbmZpZyA9IGZ1bmN0aW9uICggY29uZmlnICkgewogIHZhciB3YXNtQmluYXJ5ID0gVEhSRUUuRFJBQ09Mb2FkZXIuZGVjb2RlckNvbmZpZy53YXNtQmluYXJ5OwogIFRIUkVFLkRSQUNPTG9hZGVyLmRlY29kZXJDb25maWcgPSBjb25maWcgfHwge307CiAgVEhSRUUuRFJBQ09Mb2FkZXIucmVsZWFzZURlY29kZXJNb2R1bGUoKTsKCiAgLy8gUmV1c2UgV0FTTSBiaW5hcnkuCiAgaWYgKCB3YXNtQmluYXJ5ICkgVEhSRUUuRFJBQ09Mb2FkZXIuZGVjb2RlckNvbmZpZy53YXNtQmluYXJ5ID0gd2FzbUJpbmFyeTsKfTsKCi8qKgogKiBSZWxlYXNlcyB0aGUgc2luZ2xldG9uIERyYWNvRGVjb2Rlck1vZHVsZSBpbnN0YW5jZS4gTW9kdWxlIHdpbGwgYmUgcmVjcmVhdGVkCiAqIHdpdGggdGhlIG5leHQgZGVjb2RpbmcgY2FsbC4KICovClRIUkVFLkRSQUNPTG9hZGVyLnJlbGVhc2VEZWNvZGVyTW9kdWxlID0gZnVuY3Rpb24gKCkgewogIFRIUkVFLkRSQUNPTG9hZGVyLmRlY29kZXJNb2R1bGVQcm9taXNlID0gbnVsbDsKfTsKCi8qKgogKiBHZXRzIFdlYkFzc2VtYmx5IG9yIGFzbS5qcyBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgRHJhY29EZWNvZGVyTW9kdWxlCiAqIGFmdGVyIHRlc3RpbmcgZm9yIGJyb3dzZXIgc3VwcG9ydC4gUmV0dXJucyBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbgogKiBtb2R1bGUgaXMgYXZhaWxhYmxlLgogKiBAcmV0dXJuIHtQcm9taXNlPHtkZWNvZGVyOiBEcmFjb0RlY29kZXJNb2R1bGV9Pn0KICovClRIUkVFLkRSQUNPTG9hZGVyLmdldERlY29kZXJNb2R1bGUgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHNjb3BlID0gdGhpczsKICB2YXIgcGF0aCA9IFRIUkVFLkRSQUNPTG9hZGVyLmRlY29kZXJQYXRoOwogIHZhciBjb25maWcgPSBUSFJFRS5EUkFDT0xvYWRlci5kZWNvZGVyQ29uZmlnOwogIHZhciBwcm9taXNlID0gVEhSRUUuRFJBQ09Mb2FkZXIuZGVjb2Rlck1vZHVsZVByb21pc2U7CgogIGlmICggcHJvbWlzZSApIHJldHVybiBwcm9taXNlOwoKICAvLyBMb2FkIHNvdXJjZSBmaWxlcy4KICBpZiAoIHR5cGVvZiBEcmFjb0RlY29kZXJNb2R1bGUgIT09ICd1bmRlZmluZWQnICkgewogICAgLy8gTG9hZGVkIGV4dGVybmFsbHkuCiAgICBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgfSBlbHNlIGlmICggdHlwZW9mIFdlYkFzc2VtYmx5ICE9PSAnb2JqZWN0JyB8fCBjb25maWcudHlwZSA9PT0gJ2pzJyApIHsKICAgIC8vIExvYWQgd2l0aCBhc20uanMuCiAgICBwcm9taXNlID0gVEhSRUUuRFJBQ09Mb2FkZXIuX2xvYWRTY3JpcHQoIHBhdGggKyAnZHJhY29fZGVjb2Rlci5qcycgKTsKICB9IGVsc2UgewogICAgLy8gTG9hZCB3aXRoIFdlYkFzc2VtYmx5LgogICAgY29uZmlnLndhc21CaW5hcnlGaWxlID0gcGF0aCArICdkcmFjb19kZWNvZGVyLndhc20nOwogICAgcHJvbWlzZSA9IFRIUkVFLkRSQUNPTG9hZGVyLl9sb2FkU2NyaXB0KCBwYXRoICsgJ2RyYWNvX3dhc21fd3JhcHBlci5qcycgKQogICAgICAgIC50aGVuKCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gVEhSRUUuRFJBQ09Mb2FkZXIuX2xvYWRBcnJheUJ1ZmZlciggY29uZmlnLndhc21CaW5hcnlGaWxlICk7CiAgICAgICAgfSApCiAgICAgICAgLnRoZW4oIGZ1bmN0aW9uICggd2FzbUJpbmFyeSApIHsKICAgICAgICAgIGNvbmZpZy53YXNtQmluYXJ5ID0gd2FzbUJpbmFyeTsKICAgICAgICB9ICk7CiAgfQoKICAvLyBXYWl0IGZvciBzb3VyY2UgZmlsZXMsIHRoZW4gY3JlYXRlIGFuZCByZXR1cm4gYSBkZWNvZGVyLgogIHByb21pc2UgPSBwcm9taXNlLnRoZW4oIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlICkgewogICAgICBjb25maWcub25Nb2R1bGVMb2FkZWQgPSBmdW5jdGlvbiAoIGRlY29kZXIgKSB7CiAgICAgICAgc2NvcGUudGltZUxvYWRlZCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIC8vIE1vZHVsZSBpcyBQcm9taXNlLWxpa2UuIFdyYXAgYmVmb3JlIHJlc29sdmluZyB0byBhdm9pZCBsb29wLgogICAgICAgIHJlc29sdmUoIHsgZGVjb2RlcjogZGVjb2RlciB9ICk7CiAgICAgIH07CiAgICAgIERyYWNvRGVjb2Rlck1vZHVsZSggY29uZmlnICk7CiAgICB9ICk7CiAgfSApOwoKICBUSFJFRS5EUkFDT0xvYWRlci5kZWNvZGVyTW9kdWxlUHJvbWlzZSA9IHByb21pc2U7CiAgcmV0dXJuIHByb21pc2U7Cn07CgovKioKICogQHBhcmFtIHtzdHJpbmd9IHNyYwogKiBAcmV0dXJuIHtQcm9taXNlfQogKi8KVEhSRUUuRFJBQ09Mb2FkZXIuX2xvYWRTY3JpcHQgPSBmdW5jdGlvbiAoIHNyYyApIHsKICB2YXIgcHJldlNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnZGVjb2Rlcl9zY3JpcHQnICk7CiAgaWYgKCBwcmV2U2NyaXB0ICE9PSBudWxsICkgewogICAgcHJldlNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBwcmV2U2NyaXB0ICk7CiAgfQogIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdoZWFkJyApWyAwIF07CiAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzY3JpcHQnICk7CiAgc2NyaXB0LmlkID0gJ2RlY29kZXJfc2NyaXB0JzsKICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwogIHNjcmlwdC5zcmMgPSBzcmM7CiAgcmV0dXJuIG5ldyBQcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUgKSB7CiAgICBzY3JpcHQub25sb2FkID0gcmVzb2x2ZTsKICAgIGhlYWQuYXBwZW5kQ2hpbGQoIHNjcmlwdCApOwogIH0pOwp9OwoKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBzcmMKICogQHJldHVybiB7UHJvbWlzZX0KICovClRIUkVFLkRSQUNPTG9hZGVyLl9sb2FkQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiAoIHNyYyApIHsKICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLkZpbGVMb2FkZXIoKTsKICBsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCAnYXJyYXlidWZmZXInICk7CiAgcmV0dXJuIG5ldyBQcm9taXNlKCBmdW5jdGlvbiggcmVzb2x2ZSwgcmVqZWN0ICkgewogICAgbG9hZGVyLmxvYWQoIHNyYywgcmVzb2x2ZSwgdW5kZWZpbmVkLCByZWplY3QgKTsKICB9KTsKfTsKCn0se31dLDM5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIEBhdXRob3IgUmljaCBUaWJiZXR0IC8gaHR0cHM6Ly9naXRodWIuY29tL3JpY2h0cgogKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tLwogKiBAYXV0aG9yIFRvbnkgUGFyaXNpIC8gaHR0cDovL3d3dy50b255cGFyaXNpLmNvbS8KICogQGF1dGhvciBUYWthaGlybyAvIGh0dHBzOi8vZ2l0aHViLmNvbS90YWthaGlyb3gKICogQGF1dGhvciBEb24gTWNDdXJkeSAvIGh0dHBzOi8vd3d3LmRvbm1jY3VyZHkuY29tCiAqLwoKVEhSRUUuR0xURkxvYWRlciA9ICggZnVuY3Rpb24gKCkgewoKCWZ1bmN0aW9uIEdMVEZMb2FkZXIoIG1hbmFnZXIgKSB7CgoJCXRoaXMubWFuYWdlciA9ICggbWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyBtYW5hZ2VyIDogVEhSRUUuRGVmYXVsdExvYWRpbmdNYW5hZ2VyOwoJCXRoaXMuZHJhY29Mb2FkZXIgPSBudWxsOwoKCX0KCglHTFRGTG9hZGVyLnByb3RvdHlwZSA9IHsKCgkJY29uc3RydWN0b3I6IEdMVEZMb2FkZXIsCgoJCWNyb3NzT3JpZ2luOiAnYW5vbnltb3VzJywKCgkJbG9hZDogZnVuY3Rpb24gKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCXZhciBzY29wZSA9IHRoaXM7CgoJCQl2YXIgcmVzb3VyY2VQYXRoOwoKCQkJaWYgKCB0aGlzLnJlc291cmNlUGF0aCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJlc291cmNlUGF0aCA9IHRoaXMucmVzb3VyY2VQYXRoOwoKCQkJfSBlbHNlIGlmICggdGhpcy5wYXRoICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmVzb3VyY2VQYXRoID0gdGhpcy5wYXRoOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXNvdXJjZVBhdGggPSBUSFJFRS5Mb2FkZXJVdGlscy5leHRyYWN0VXJsQmFzZSggdXJsICk7CgoJCQl9CgoJCQkvLyBUZWxscyB0aGUgTG9hZGluZ01hbmFnZXIgdG8gdHJhY2sgYW4gZXh0cmEgaXRlbSwgd2hpY2ggcmVzb2x2ZXMgYWZ0ZXIKCQkJLy8gdGhlIG1vZGVsIGlzIGZ1bGx5IGxvYWRlZC4gVGhpcyBtZWFucyB0aGUgY291bnQgb2YgaXRlbXMgbG9hZGVkIHdpbGwKCQkJLy8gYmUgaW5jb3JyZWN0LCBidXQgZW5zdXJlcyBtYW5hZ2VyLm9uTG9hZCgpIGRvZXMgbm90IGZpcmUgZWFybHkuCgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCXZhciBfb25FcnJvciA9IGZ1bmN0aW9uICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9OwoKCQkJdmFyIGxvYWRlciA9IG5ldyBUSFJFRS5GaWxlTG9hZGVyKCBzY29wZS5tYW5hZ2VyICk7CgoJCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJCWxvYWRlci5zZXRSZXNwb25zZVR5cGUoICdhcnJheWJ1ZmZlcicgKTsKCgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggZGF0YSApIHsKCgkJCQl0cnkgewoKCQkJCQlzY29wZS5wYXJzZSggZGF0YSwgcmVzb3VyY2VQYXRoLCBmdW5jdGlvbiAoIGdsdGYgKSB7CgoJCQkJCQlvbkxvYWQoIGdsdGYgKTsKCgkJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJCX0sIF9vbkVycm9yICk7CgoJCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJCV9vbkVycm9yKCBlICk7CgoJCQkJfQoKCQkJfSwgb25Qcm9ncmVzcywgX29uRXJyb3IgKTsKCgkJfSwKCgkJc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLmNyb3NzT3JpZ2luID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRQYXRoOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJdGhpcy5wYXRoID0gdmFsdWU7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlzZXRSZXNvdXJjZVBhdGg6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQl0aGlzLnJlc291cmNlUGF0aCA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfSwKCgkJc2V0RFJBQ09Mb2FkZXI6IGZ1bmN0aW9uICggZHJhY29Mb2FkZXIgKSB7CgoJCQl0aGlzLmRyYWNvTG9hZGVyID0gZHJhY29Mb2FkZXI7CgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlwYXJzZTogZnVuY3Rpb24gKCBkYXRhLCBwYXRoLCBvbkxvYWQsIG9uRXJyb3IgKSB7CgoJCQl2YXIgY29udGVudDsKCQkJdmFyIGV4dGVuc2lvbnMgPSB7fTsKCgkJCWlmICggdHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnICkgewoKCQkJCWNvbnRlbnQgPSBkYXRhOwoKCQkJfSBlbHNlIHsKCgkJCQl2YXIgbWFnaWMgPSBUSFJFRS5Mb2FkZXJVdGlscy5kZWNvZGVUZXh0KCBuZXcgVWludDhBcnJheSggZGF0YSwgMCwgNCApICk7CgoJCQkJaWYgKCBtYWdpYyA9PT0gQklOQVJZX0VYVEVOU0lPTl9IRUFERVJfTUFHSUMgKSB7CgoJCQkJCXRyeSB7CgoJCQkJCQlleHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9CSU5BUllfR0xURiBdID0gbmV3IEdMVEZCaW5hcnlFeHRlbnNpb24oIGRhdGEgKTsKCgkJCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCQkJaWYgKCBvbkVycm9yICkgb25FcnJvciggZXJyb3IgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCWNvbnRlbnQgPSBleHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9CSU5BUllfR0xURiBdLmNvbnRlbnQ7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29udGVudCA9IFRIUkVFLkxvYWRlclV0aWxzLmRlY29kZVRleHQoIG5ldyBVaW50OEFycmF5KCBkYXRhICkgKTsKCgkJCQl9CgoJCQl9CgoJCQl2YXIganNvbiA9IEpTT04ucGFyc2UoIGNvbnRlbnQgKTsKCgkJCWlmICgganNvbi5hc3NldCA9PT0gdW5kZWZpbmVkIHx8IGpzb24uYXNzZXQudmVyc2lvblsgMCBdIDwgMiApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBuZXcgRXJyb3IoICdUSFJFRS5HTFRGTG9hZGVyOiBVbnN1cHBvcnRlZCBhc3NldC4gZ2xURiB2ZXJzaW9ucyA+PTIuMCBhcmUgc3VwcG9ydGVkLiBVc2UgTGVnYWN5R0xURkxvYWRlciBpbnN0ZWFkLicgKSApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBqc29uLmV4dGVuc2lvbnNVc2VkICkgewoKCQkJCWZvciAoIHZhciBpID0gMDsgaSA8IGpzb24uZXh0ZW5zaW9uc1VzZWQubGVuZ3RoOyArKyBpICkgewoKCQkJCQl2YXIgZXh0ZW5zaW9uTmFtZSA9IGpzb24uZXh0ZW5zaW9uc1VzZWRbIGkgXTsKCQkJCQl2YXIgZXh0ZW5zaW9uc1JlcXVpcmVkID0ganNvbi5leHRlbnNpb25zUmVxdWlyZWQgfHwgW107CgoJCQkJCXN3aXRjaCAoIGV4dGVuc2lvbk5hbWUgKSB7CgoJCQkJCQljYXNlIEVYVEVOU0lPTlMuS0hSX0xJR0hUU19QVU5DVFVBTDoKCQkJCQkJCWV4dGVuc2lvbnNbIGV4dGVuc2lvbk5hbWUgXSA9IG5ldyBHTFRGTGlnaHRzRXh0ZW5zaW9uKCBqc29uICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgRVhURU5TSU9OUy5LSFJfTUFURVJJQUxTX1VOTElUOgoJCQkJCQkJZXh0ZW5zaW9uc1sgZXh0ZW5zaW9uTmFtZSBdID0gbmV3IEdMVEZNYXRlcmlhbHNVbmxpdEV4dGVuc2lvbigganNvbiApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEVYVEVOU0lPTlMuS0hSX01BVEVSSUFMU19QQlJfU1BFQ1VMQVJfR0xPU1NJTkVTUzoKCQkJCQkJCWV4dGVuc2lvbnNbIGV4dGVuc2lvbk5hbWUgXSA9IG5ldyBHTFRGTWF0ZXJpYWxzUGJyU3BlY3VsYXJHbG9zc2luZXNzRXh0ZW5zaW9uKCBqc29uICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgRVhURU5TSU9OUy5LSFJfRFJBQ09fTUVTSF9DT01QUkVTU0lPTjoKCQkJCQkJCWV4dGVuc2lvbnNbIGV4dGVuc2lvbk5hbWUgXSA9IG5ldyBHTFRGRHJhY29NZXNoQ29tcHJlc3Npb25FeHRlbnNpb24oIGpzb24sIHRoaXMuZHJhY29Mb2FkZXIgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBFWFRFTlNJT05TLk1TRlRfVEVYVFVSRV9ERFM6CgkJCQkJCQlleHRlbnNpb25zWyBFWFRFTlNJT05TLk1TRlRfVEVYVFVSRV9ERFMgXSA9IG5ldyBHTFRGVGV4dHVyZUREU0V4dGVuc2lvbigpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEVYVEVOU0lPTlMuS0hSX1RFWFRVUkVfVFJBTlNGT1JNOgoJCQkJCQkJZXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5LSFJfVEVYVFVSRV9UUkFOU0ZPUk0gXSA9IG5ldyBHTFRGVGV4dHVyZVRyYW5zZm9ybUV4dGVuc2lvbigganNvbiApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQlkZWZhdWx0OgoKCQkJCQkJCWlmICggZXh0ZW5zaW9uc1JlcXVpcmVkLmluZGV4T2YoIGV4dGVuc2lvbk5hbWUgKSA+PSAwICkgewoKCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5HTFRGTG9hZGVyOiBVbmtub3duIGV4dGVuc2lvbiAiJyArIGV4dGVuc2lvbk5hbWUgKyAnIi4nICk7CgoJCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdmFyIHBhcnNlciA9IG5ldyBHTFRGUGFyc2VyKCBqc29uLCBleHRlbnNpb25zLCB7CgoJCQkJcGF0aDogcGF0aCB8fCB0aGlzLnJlc291cmNlUGF0aCB8fCAnJywKCQkJCWNyb3NzT3JpZ2luOiB0aGlzLmNyb3NzT3JpZ2luLAoJCQkJbWFuYWdlcjogdGhpcy5tYW5hZ2VyCgoJCQl9ICk7CgoJCQlwYXJzZXIucGFyc2UoIG9uTG9hZCwgb25FcnJvciApOwoKCQl9CgoJfTsKCgkvKiBHTFRGUkVHSVNUUlkgKi8KCglmdW5jdGlvbiBHTFRGUmVnaXN0cnkoKSB7CgoJCXZhciBvYmplY3RzID0ge307CgoJCXJldHVybgl7CgoJCQlnZXQ6IGZ1bmN0aW9uICgga2V5ICkgewoKCQkJCXJldHVybiBvYmplY3RzWyBrZXkgXTsKCgkJCX0sCgoJCQlhZGQ6IGZ1bmN0aW9uICgga2V5LCBvYmplY3QgKSB7CgoJCQkJb2JqZWN0c1sga2V5IF0gPSBvYmplY3Q7CgoJCQl9LAoKCQkJcmVtb3ZlOiBmdW5jdGlvbiAoIGtleSApIHsKCgkJCQlkZWxldGUgb2JqZWN0c1sga2V5IF07CgoJCQl9LAoKCQkJcmVtb3ZlQWxsOiBmdW5jdGlvbiAoKSB7CgoJCQkJb2JqZWN0cyA9IHt9OwoKCQkJfQoKCQl9OwoKCX0KCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoJLyoqKioqKioqKiogRVhURU5TSU9OUyAqKioqKioqKioqKi8KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJdmFyIEVYVEVOU0lPTlMgPSB7CgkJS0hSX0JJTkFSWV9HTFRGOiAnS0hSX2JpbmFyeV9nbFRGJywKCQlLSFJfRFJBQ09fTUVTSF9DT01QUkVTU0lPTjogJ0tIUl9kcmFjb19tZXNoX2NvbXByZXNzaW9uJywKCQlLSFJfTElHSFRTX1BVTkNUVUFMOiAnS0hSX2xpZ2h0c19wdW5jdHVhbCcsCgkJS0hSX01BVEVSSUFMU19QQlJfU1BFQ1VMQVJfR0xPU1NJTkVTUzogJ0tIUl9tYXRlcmlhbHNfcGJyU3BlY3VsYXJHbG9zc2luZXNzJywKCQlLSFJfTUFURVJJQUxTX1VOTElUOiAnS0hSX21hdGVyaWFsc191bmxpdCcsCgkJS0hSX1RFWFRVUkVfVFJBTlNGT1JNOiAnS0hSX3RleHR1cmVfdHJhbnNmb3JtJywKCQlNU0ZUX1RFWFRVUkVfRERTOiAnTVNGVF90ZXh0dXJlX2RkcycKCX07CgoJLyoqCgkgKiBERFMgVGV4dHVyZSBFeHRlbnNpb24KCSAqCgkgKiBTcGVjaWZpY2F0aW9uOgoJICogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL3RyZWUvbWFzdGVyL2V4dGVuc2lvbnMvMi4wL1ZlbmRvci9NU0ZUX3RleHR1cmVfZGRzCgkgKgoJICovCglmdW5jdGlvbiBHTFRGVGV4dHVyZUREU0V4dGVuc2lvbigpIHsKCgkJaWYgKCAhIFRIUkVFLkREU0xvYWRlciApIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkdMVEZMb2FkZXI6IEF0dGVtcHRpbmcgdG8gbG9hZCAuZGRzIHRleHR1cmUgd2l0aG91dCBpbXBvcnRpbmcgVEhSRUUuRERTTG9hZGVyJyApOwoKCQl9CgoJCXRoaXMubmFtZSA9IEVYVEVOU0lPTlMuTVNGVF9URVhUVVJFX0REUzsKCQl0aGlzLmRkc0xvYWRlciA9IG5ldyBUSFJFRS5ERFNMb2FkZXIoKTsKCgl9CgoJLyoqCgkgKiBMaWdodHMgRXh0ZW5zaW9uCgkgKgoJICogU3BlY2lmaWNhdGlvbjogUEVORElORwoJICovCglmdW5jdGlvbiBHTFRGTGlnaHRzRXh0ZW5zaW9uKCBqc29uICkgewoKCQl0aGlzLm5hbWUgPSBFWFRFTlNJT05TLktIUl9MSUdIVFNfUFVOQ1RVQUw7CgoJCXZhciBleHRlbnNpb24gPSAoIGpzb24uZXh0ZW5zaW9ucyAmJiBqc29uLmV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX0xJR0hUU19QVU5DVFVBTCBdICkgfHwge307CgkJdGhpcy5saWdodERlZnMgPSBleHRlbnNpb24ubGlnaHRzIHx8IFtdOwoKCX0KCglHTFRGTGlnaHRzRXh0ZW5zaW9uLnByb3RvdHlwZS5sb2FkTGlnaHQgPSBmdW5jdGlvbiAoIGxpZ2h0SW5kZXggKSB7CgoJCXZhciBsaWdodERlZiA9IHRoaXMubGlnaHREZWZzWyBsaWdodEluZGV4IF07CgkJdmFyIGxpZ2h0Tm9kZTsKCgkJdmFyIGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCAweGZmZmZmZiApOwoJCWlmICggbGlnaHREZWYuY29sb3IgIT09IHVuZGVmaW5lZCApIGNvbG9yLmZyb21BcnJheSggbGlnaHREZWYuY29sb3IgKTsKCgkJdmFyIHJhbmdlID0gbGlnaHREZWYucmFuZ2UgIT09IHVuZGVmaW5lZCA/IGxpZ2h0RGVmLnJhbmdlIDogMDsKCgkJc3dpdGNoICggbGlnaHREZWYudHlwZSApIHsKCgkJCWNhc2UgJ2RpcmVjdGlvbmFsJzoKCQkJCWxpZ2h0Tm9kZSA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCBjb2xvciApOwoJCQkJbGlnaHROb2RlLnRhcmdldC5wb3NpdGlvbi5zZXQoIDAsIDAsIC0gMSApOwoJCQkJbGlnaHROb2RlLmFkZCggbGlnaHROb2RlLnRhcmdldCApOwoJCQkJYnJlYWs7CgoJCQljYXNlICdwb2ludCc6CgkJCQlsaWdodE5vZGUgPSBuZXcgVEhSRUUuUG9pbnRMaWdodCggY29sb3IgKTsKCQkJCWxpZ2h0Tm9kZS5kaXN0YW5jZSA9IHJhbmdlOwoJCQkJYnJlYWs7CgoJCQljYXNlICdzcG90JzoKCQkJCWxpZ2h0Tm9kZSA9IG5ldyBUSFJFRS5TcG90TGlnaHQoIGNvbG9yICk7CgkJCQlsaWdodE5vZGUuZGlzdGFuY2UgPSByYW5nZTsKCQkJCS8vIEhhbmRsZSBzcG90bGlnaHQgcHJvcGVydGllcy4KCQkJCWxpZ2h0RGVmLnNwb3QgPSBsaWdodERlZi5zcG90IHx8IHt9OwoJCQkJbGlnaHREZWYuc3BvdC5pbm5lckNvbmVBbmdsZSA9IGxpZ2h0RGVmLnNwb3QuaW5uZXJDb25lQW5nbGUgIT09IHVuZGVmaW5lZCA/IGxpZ2h0RGVmLnNwb3QuaW5uZXJDb25lQW5nbGUgOiAwOwoJCQkJbGlnaHREZWYuc3BvdC5vdXRlckNvbmVBbmdsZSA9IGxpZ2h0RGVmLnNwb3Qub3V0ZXJDb25lQW5nbGUgIT09IHVuZGVmaW5lZCA/IGxpZ2h0RGVmLnNwb3Qub3V0ZXJDb25lQW5nbGUgOiBNYXRoLlBJIC8gNC4wOwoJCQkJbGlnaHROb2RlLmFuZ2xlID0gbGlnaHREZWYuc3BvdC5vdXRlckNvbmVBbmdsZTsKCQkJCWxpZ2h0Tm9kZS5wZW51bWJyYSA9IDEuMCAtIGxpZ2h0RGVmLnNwb3QuaW5uZXJDb25lQW5nbGUgLyBsaWdodERlZi5zcG90Lm91dGVyQ29uZUFuZ2xlOwoJCQkJbGlnaHROb2RlLnRhcmdldC5wb3NpdGlvbi5zZXQoIDAsIDAsIC0gMSApOwoJCQkJbGlnaHROb2RlLmFkZCggbGlnaHROb2RlLnRhcmdldCApOwoJCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuR0xURkxvYWRlcjogVW5leHBlY3RlZCBsaWdodCB0eXBlLCAiJyArIGxpZ2h0RGVmLnR5cGUgKyAnIi4nICk7CgoJCX0KCgkJLy8gU29tZSBsaWdodHMgKGUuZy4gc3BvdCkgZGVmYXVsdCB0byBhIHBvc2l0aW9uIG90aGVyIHRoYW4gdGhlIG9yaWdpbi4gUmVzZXQgdGhlIHBvc2l0aW9uCgkJLy8gaGVyZSwgYmVjYXVzZSBub2RlLWxldmVsIHBhcnNpbmcgd2lsbCBvbmx5IG92ZXJyaWRlIHBvc2l0aW9uIGlmIGV4cGxpY2l0bHkgc3BlY2lmaWVkLgoJCWxpZ2h0Tm9kZS5wb3NpdGlvbi5zZXQoIDAsIDAsIDAgKTsKCgkJbGlnaHROb2RlLmRlY2F5ID0gMjsKCgkJaWYgKCBsaWdodERlZi5pbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGxpZ2h0Tm9kZS5pbnRlbnNpdHkgPSBsaWdodERlZi5pbnRlbnNpdHk7CgoJCWxpZ2h0Tm9kZS5uYW1lID0gbGlnaHREZWYubmFtZSB8fCAoICdsaWdodF8nICsgbGlnaHRJbmRleCApOwoKCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCBsaWdodE5vZGUgKTsKCgl9OwoKCS8qKgoJICogVW5saXQgTWF0ZXJpYWxzIEV4dGVuc2lvbiAocGVuZGluZykKCSAqCgkgKiBQUjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL3B1bGwvMTE2MwoJICovCglmdW5jdGlvbiBHTFRGTWF0ZXJpYWxzVW5saXRFeHRlbnNpb24oIGpzb24gKSB7CgoJCXRoaXMubmFtZSA9IEVYVEVOU0lPTlMuS0hSX01BVEVSSUFMU19VTkxJVDsKCgl9CgoJR0xURk1hdGVyaWFsc1VubGl0RXh0ZW5zaW9uLnByb3RvdHlwZS5nZXRNYXRlcmlhbFR5cGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsICkgewoKCQlyZXR1cm4gVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWw7CgoJfTsKCglHTFRGTWF0ZXJpYWxzVW5saXRFeHRlbnNpb24ucHJvdG90eXBlLmV4dGVuZFBhcmFtcyA9IGZ1bmN0aW9uICggbWF0ZXJpYWxQYXJhbXMsIG1hdGVyaWFsLCBwYXJzZXIgKSB7CgoJCXZhciBwZW5kaW5nID0gW107CgoJCW1hdGVyaWFsUGFyYW1zLmNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCAxLjAsIDEuMCwgMS4wICk7CgkJbWF0ZXJpYWxQYXJhbXMub3BhY2l0eSA9IDEuMDsKCgkJdmFyIG1ldGFsbGljUm91Z2huZXNzID0gbWF0ZXJpYWwucGJyTWV0YWxsaWNSb3VnaG5lc3M7CgoJCWlmICggbWV0YWxsaWNSb3VnaG5lc3MgKSB7CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1ldGFsbGljUm91Z2huZXNzLmJhc2VDb2xvckZhY3RvciApICkgewoKCQkJCXZhciBhcnJheSA9IG1ldGFsbGljUm91Z2huZXNzLmJhc2VDb2xvckZhY3RvcjsKCgkJCQltYXRlcmlhbFBhcmFtcy5jb2xvci5mcm9tQXJyYXkoIGFycmF5ICk7CgkJCQltYXRlcmlhbFBhcmFtcy5vcGFjaXR5ID0gYXJyYXlbIDMgXTsKCgkJCX0KCgkJCWlmICggbWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIG1hdGVyaWFsUGFyYW1zLCAnbWFwJywgbWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yVGV4dHVyZSApICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIFByb21pc2UuYWxsKCBwZW5kaW5nICk7CgoJfTsKCgkvKiBCSU5BUlkgRVhURU5TSU9OICovCgoJdmFyIEJJTkFSWV9FWFRFTlNJT05fQlVGRkVSX05BTUUgPSAnYmluYXJ5X2dsVEYnOwoJdmFyIEJJTkFSWV9FWFRFTlNJT05fSEVBREVSX01BR0lDID0gJ2dsVEYnOwoJdmFyIEJJTkFSWV9FWFRFTlNJT05fSEVBREVSX0xFTkdUSCA9IDEyOwoJdmFyIEJJTkFSWV9FWFRFTlNJT05fQ0hVTktfVFlQRVMgPSB7IEpTT046IDB4NEU0RjUzNEEsIEJJTjogMHgwMDRFNDk0MiB9OwoKCWZ1bmN0aW9uIEdMVEZCaW5hcnlFeHRlbnNpb24oIGRhdGEgKSB7CgoJCXRoaXMubmFtZSA9IEVYVEVOU0lPTlMuS0hSX0JJTkFSWV9HTFRGOwoJCXRoaXMuY29udGVudCA9IG51bGw7CgkJdGhpcy5ib2R5ID0gbnVsbDsKCgkJdmFyIGhlYWRlclZpZXcgPSBuZXcgRGF0YVZpZXcoIGRhdGEsIDAsIEJJTkFSWV9FWFRFTlNJT05fSEVBREVSX0xFTkdUSCApOwoKCQl0aGlzLmhlYWRlciA9IHsKCQkJbWFnaWM6IFRIUkVFLkxvYWRlclV0aWxzLmRlY29kZVRleHQoIG5ldyBVaW50OEFycmF5KCBkYXRhLnNsaWNlKCAwLCA0ICkgKSApLAoJCQl2ZXJzaW9uOiBoZWFkZXJWaWV3LmdldFVpbnQzMiggNCwgdHJ1ZSApLAoJCQlsZW5ndGg6IGhlYWRlclZpZXcuZ2V0VWludDMyKCA4LCB0cnVlICkKCQl9OwoKCQlpZiAoIHRoaXMuaGVhZGVyLm1hZ2ljICE9PSBCSU5BUllfRVhURU5TSU9OX0hFQURFUl9NQUdJQyApIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkdMVEZMb2FkZXI6IFVuc3VwcG9ydGVkIGdsVEYtQmluYXJ5IGhlYWRlci4nICk7CgoJCX0gZWxzZSBpZiAoIHRoaXMuaGVhZGVyLnZlcnNpb24gPCAyLjAgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5HTFRGTG9hZGVyOiBMZWdhY3kgYmluYXJ5IGZpbGUgZGV0ZWN0ZWQuIFVzZSBMZWdhY3lHTFRGTG9hZGVyIGluc3RlYWQuJyApOwoKCQl9CgoJCXZhciBjaHVua1ZpZXcgPSBuZXcgRGF0YVZpZXcoIGRhdGEsIEJJTkFSWV9FWFRFTlNJT05fSEVBREVSX0xFTkdUSCApOwoJCXZhciBjaHVua0luZGV4ID0gMDsKCgkJd2hpbGUgKCBjaHVua0luZGV4IDwgY2h1bmtWaWV3LmJ5dGVMZW5ndGggKSB7CgoJCQl2YXIgY2h1bmtMZW5ndGggPSBjaHVua1ZpZXcuZ2V0VWludDMyKCBjaHVua0luZGV4LCB0cnVlICk7CgkJCWNodW5rSW5kZXggKz0gNDsKCgkJCXZhciBjaHVua1R5cGUgPSBjaHVua1ZpZXcuZ2V0VWludDMyKCBjaHVua0luZGV4LCB0cnVlICk7CgkJCWNodW5rSW5kZXggKz0gNDsKCgkJCWlmICggY2h1bmtUeXBlID09PSBCSU5BUllfRVhURU5TSU9OX0NIVU5LX1RZUEVTLkpTT04gKSB7CgoJCQkJdmFyIGNvbnRlbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KCBkYXRhLCBCSU5BUllfRVhURU5TSU9OX0hFQURFUl9MRU5HVEggKyBjaHVua0luZGV4LCBjaHVua0xlbmd0aCApOwoJCQkJdGhpcy5jb250ZW50ID0gVEhSRUUuTG9hZGVyVXRpbHMuZGVjb2RlVGV4dCggY29udGVudEFycmF5ICk7CgoJCQl9IGVsc2UgaWYgKCBjaHVua1R5cGUgPT09IEJJTkFSWV9FWFRFTlNJT05fQ0hVTktfVFlQRVMuQklOICkgewoKCQkJCXZhciBieXRlT2Zmc2V0ID0gQklOQVJZX0VYVEVOU0lPTl9IRUFERVJfTEVOR1RIICsgY2h1bmtJbmRleDsKCQkJCXRoaXMuYm9keSA9IGRhdGEuc2xpY2UoIGJ5dGVPZmZzZXQsIGJ5dGVPZmZzZXQgKyBjaHVua0xlbmd0aCApOwoKCQkJfQoKCQkJLy8gQ2xpZW50cyBtdXN0IGlnbm9yZSBjaHVua3Mgd2l0aCB1bmtub3duIHR5cGVzLgoKCQkJY2h1bmtJbmRleCArPSBjaHVua0xlbmd0aDsKCgkJfQoKCQlpZiAoIHRoaXMuY29udGVudCA9PT0gbnVsbCApIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkdMVEZMb2FkZXI6IEpTT04gY29udGVudCBub3QgZm91bmQuJyApOwoKCQl9CgoJfQoKCS8qKgoJICogRFJBQ08gTWVzaCBDb21wcmVzc2lvbiBFeHRlbnNpb24KCSAqCgkgKiBTcGVjaWZpY2F0aW9uOiBodHRwczovL2dpdGh1Yi5jb20vS2hyb25vc0dyb3VwL2dsVEYvcHVsbC84NzQKCSAqLwoJZnVuY3Rpb24gR0xURkRyYWNvTWVzaENvbXByZXNzaW9uRXh0ZW5zaW9uKCBqc29uLCBkcmFjb0xvYWRlciApIHsKCgkJaWYgKCAhIGRyYWNvTG9hZGVyICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuR0xURkxvYWRlcjogTm8gRFJBQ09Mb2FkZXIgaW5zdGFuY2UgcHJvdmlkZWQuJyApOwoKCQl9CgoJCXRoaXMubmFtZSA9IEVYVEVOU0lPTlMuS0hSX0RSQUNPX01FU0hfQ09NUFJFU1NJT047CgkJdGhpcy5qc29uID0ganNvbjsKCQl0aGlzLmRyYWNvTG9hZGVyID0gZHJhY29Mb2FkZXI7CgoJfQoKCUdMVEZEcmFjb01lc2hDb21wcmVzc2lvbkV4dGVuc2lvbi5wcm90b3R5cGUuZGVjb2RlUHJpbWl0aXZlID0gZnVuY3Rpb24gKCBwcmltaXRpdmUsIHBhcnNlciApIHsKCgkJdmFyIGpzb24gPSB0aGlzLmpzb247CgkJdmFyIGRyYWNvTG9hZGVyID0gdGhpcy5kcmFjb0xvYWRlcjsKCQl2YXIgYnVmZmVyVmlld0luZGV4ID0gcHJpbWl0aXZlLmV4dGVuc2lvbnNbIHRoaXMubmFtZSBdLmJ1ZmZlclZpZXc7CgkJdmFyIGdsdGZBdHRyaWJ1dGVNYXAgPSBwcmltaXRpdmUuZXh0ZW5zaW9uc1sgdGhpcy5uYW1lIF0uYXR0cmlidXRlczsKCQl2YXIgdGhyZWVBdHRyaWJ1dGVNYXAgPSB7fTsKCQl2YXIgYXR0cmlidXRlTm9ybWFsaXplZE1hcCA9IHt9OwoJCXZhciBhdHRyaWJ1dGVUeXBlTWFwID0ge307CgoJCWZvciAoIHZhciBhdHRyaWJ1dGVOYW1lIGluIGdsdGZBdHRyaWJ1dGVNYXAgKSB7CgoJCQl2YXIgdGhyZWVBdHRyaWJ1dGVOYW1lID0gQVRUUklCVVRFU1sgYXR0cmlidXRlTmFtZSBdIHx8IGF0dHJpYnV0ZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkJCXRocmVlQXR0cmlidXRlTWFwWyB0aHJlZUF0dHJpYnV0ZU5hbWUgXSA9IGdsdGZBdHRyaWJ1dGVNYXBbIGF0dHJpYnV0ZU5hbWUgXTsKCgkJfQoKCQlmb3IgKCBhdHRyaWJ1dGVOYW1lIGluIHByaW1pdGl2ZS5hdHRyaWJ1dGVzICkgewoKCQkJdmFyIHRocmVlQXR0cmlidXRlTmFtZSA9IEFUVFJJQlVURVNbIGF0dHJpYnV0ZU5hbWUgXSB8fCBhdHRyaWJ1dGVOYW1lLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIGdsdGZBdHRyaWJ1dGVNYXBbIGF0dHJpYnV0ZU5hbWUgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXZhciBhY2Nlc3NvckRlZiA9IGpzb24uYWNjZXNzb3JzWyBwcmltaXRpdmUuYXR0cmlidXRlc1sgYXR0cmlidXRlTmFtZSBdIF07CgkJCQl2YXIgY29tcG9uZW50VHlwZSA9IFdFQkdMX0NPTVBPTkVOVF9UWVBFU1sgYWNjZXNzb3JEZWYuY29tcG9uZW50VHlwZSBdOwoKCQkJCWF0dHJpYnV0ZVR5cGVNYXBbIHRocmVlQXR0cmlidXRlTmFtZSBdID0gY29tcG9uZW50VHlwZTsKCQkJCWF0dHJpYnV0ZU5vcm1hbGl6ZWRNYXBbIHRocmVlQXR0cmlidXRlTmFtZSBdID0gYWNjZXNzb3JEZWYubm9ybWFsaXplZCA9PT0gdHJ1ZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gcGFyc2VyLmdldERlcGVuZGVuY3koICdidWZmZXJWaWV3JywgYnVmZmVyVmlld0luZGV4ICkudGhlbiggZnVuY3Rpb24gKCBidWZmZXJWaWV3ICkgewoKCQkJcmV0dXJuIG5ldyBQcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUgKSB7CgoJCQkJZHJhY29Mb2FkZXIuZGVjb2RlRHJhY29GaWxlKCBidWZmZXJWaWV3LCBmdW5jdGlvbiAoIGdlb21ldHJ5ICkgewoKCQkJCQlmb3IgKCB2YXIgYXR0cmlidXRlTmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKCQkJCQkJdmFyIGF0dHJpYnV0ZSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXNbIGF0dHJpYnV0ZU5hbWUgXTsKCQkJCQkJdmFyIG5vcm1hbGl6ZWQgPSBhdHRyaWJ1dGVOb3JtYWxpemVkTWFwWyBhdHRyaWJ1dGVOYW1lIF07CgoJCQkJCQlpZiAoIG5vcm1hbGl6ZWQgIT09IHVuZGVmaW5lZCApIGF0dHJpYnV0ZS5ub3JtYWxpemVkID0gbm9ybWFsaXplZDsKCgkJCQkJfQoKCQkJCQlyZXNvbHZlKCBnZW9tZXRyeSApOwoKCQkJCX0sIHRocmVlQXR0cmlidXRlTWFwLCBhdHRyaWJ1dGVUeXBlTWFwICk7CgoJCQl9ICk7CgoJCX0gKTsKCgl9OwoKCS8qKgoJICogVGV4dHVyZSBUcmFuc2Zvcm0gRXh0ZW5zaW9uCgkgKgoJICogU3BlY2lmaWNhdGlvbjoKCSAqLwoJZnVuY3Rpb24gR0xURlRleHR1cmVUcmFuc2Zvcm1FeHRlbnNpb24oIGpzb24gKSB7CgoJCXRoaXMubmFtZSA9IEVYVEVOU0lPTlMuS0hSX1RFWFRVUkVfVFJBTlNGT1JNOwoKCX0KCglHTFRGVGV4dHVyZVRyYW5zZm9ybUV4dGVuc2lvbi5wcm90b3R5cGUuZXh0ZW5kVGV4dHVyZSA9IGZ1bmN0aW9uICggdGV4dHVyZSwgdHJhbnNmb3JtICkgewoKCQl0ZXh0dXJlID0gdGV4dHVyZS5jbG9uZSgpOwoKCQlpZiAoIHRyYW5zZm9ybS5vZmZzZXQgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRleHR1cmUub2Zmc2V0LmZyb21BcnJheSggdHJhbnNmb3JtLm9mZnNldCApOwoKCQl9CgoJCWlmICggdHJhbnNmb3JtLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0ZXh0dXJlLnJvdGF0aW9uID0gdHJhbnNmb3JtLnJvdGF0aW9uOwoKCQl9CgoJCWlmICggdHJhbnNmb3JtLnNjYWxlICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0ZXh0dXJlLnJlcGVhdC5mcm9tQXJyYXkoIHRyYW5zZm9ybS5zY2FsZSApOwoKCQl9CgoJCWlmICggdHJhbnNmb3JtLnRleENvb3JkICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5HTFRGTG9hZGVyOiBDdXN0b20gVVYgc2V0cyBpbiAiJyArIHRoaXMubmFtZSArICciIGV4dGVuc2lvbiBub3QgeWV0IHN1cHBvcnRlZC4nICk7CgoJCX0KCgkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCXJldHVybiB0ZXh0dXJlOwoKCX07CgoJLyoqCgkgKiBTcGVjdWxhci1HbG9zc2luZXNzIEV4dGVuc2lvbgoJICoKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi90cmVlL21hc3Rlci9leHRlbnNpb25zLzIuMC9LaHJvbm9zL0tIUl9tYXRlcmlhbHNfcGJyU3BlY3VsYXJHbG9zc2luZXNzCgkgKi8KCWZ1bmN0aW9uIEdMVEZNYXRlcmlhbHNQYnJTcGVjdWxhckdsb3NzaW5lc3NFeHRlbnNpb24oKSB7CgoJCXJldHVybiB7CgoJCQluYW1lOiBFWFRFTlNJT05TLktIUl9NQVRFUklBTFNfUEJSX1NQRUNVTEFSX0dMT1NTSU5FU1MsCgoJCQlzcGVjdWxhckdsb3NzaW5lc3NQYXJhbXM6IFsKCQkJCSdjb2xvcicsCgkJCQknbWFwJywKCQkJCSdsaWdodE1hcCcsCgkJCQknbGlnaHRNYXBJbnRlbnNpdHknLAoJCQkJJ2FvTWFwJywKCQkJCSdhb01hcEludGVuc2l0eScsCgkJCQknZW1pc3NpdmUnLAoJCQkJJ2VtaXNzaXZlSW50ZW5zaXR5JywKCQkJCSdlbWlzc2l2ZU1hcCcsCgkJCQknYnVtcE1hcCcsCgkJCQknYnVtcFNjYWxlJywKCQkJCSdub3JtYWxNYXAnLAoJCQkJJ2Rpc3BsYWNlbWVudE1hcCcsCgkJCQknZGlzcGxhY2VtZW50U2NhbGUnLAoJCQkJJ2Rpc3BsYWNlbWVudEJpYXMnLAoJCQkJJ3NwZWN1bGFyTWFwJywKCQkJCSdzcGVjdWxhcicsCgkJCQknZ2xvc3NpbmVzc01hcCcsCgkJCQknZ2xvc3NpbmVzcycsCgkJCQknYWxwaGFNYXAnLAoJCQkJJ2Vudk1hcCcsCgkJCQknZW52TWFwSW50ZW5zaXR5JywKCQkJCSdyZWZyYWN0aW9uUmF0aW8nLAoJCQldLAoKCQkJZ2V0TWF0ZXJpYWxUeXBlOiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIFRIUkVFLlNoYWRlck1hdGVyaWFsOwoKCQkJfSwKCgkJCWV4dGVuZFBhcmFtczogZnVuY3Rpb24gKCBwYXJhbXMsIG1hdGVyaWFsLCBwYXJzZXIgKSB7CgoJCQkJdmFyIHBiclNwZWN1bGFyR2xvc3NpbmVzcyA9IG1hdGVyaWFsLmV4dGVuc2lvbnNbIHRoaXMubmFtZSBdOwoKCQkJCXZhciBzaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbICdzdGFuZGFyZCcgXTsKCgkJCQl2YXIgdW5pZm9ybXMgPSBUSFJFRS5Vbmlmb3Jtc1V0aWxzLmNsb25lKCBzaGFkZXIudW5pZm9ybXMgKTsKCgkJCQl2YXIgc3BlY3VsYXJNYXBQYXJzRnJhZ21lbnRDaHVuayA9IFsKCQkJCQknI2lmZGVmIFVTRV9TUEVDVUxBUk1BUCcsCgkJCQkJJwl1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDsnLAoJCQkJCScjZW5kaWYnCgkJCQldLmpvaW4oICdcbicgKTsKCgkJCQl2YXIgZ2xvc3NpbmVzc01hcFBhcnNGcmFnbWVudENodW5rID0gWwoJCQkJCScjaWZkZWYgVVNFX0dMT1NTSU5FU1NNQVAnLAoJCQkJCScJdW5pZm9ybSBzYW1wbGVyMkQgZ2xvc3NpbmVzc01hcDsnLAoJCQkJCScjZW5kaWYnCgkJCQldLmpvaW4oICdcbicgKTsKCgkJCQl2YXIgc3BlY3VsYXJNYXBGcmFnbWVudENodW5rID0gWwoJCQkJCSd2ZWMzIHNwZWN1bGFyRmFjdG9yID0gc3BlY3VsYXI7JywKCQkJCQknI2lmZGVmIFVTRV9TUEVDVUxBUk1BUCcsCgkJCQkJJwl2ZWM0IHRleGVsU3BlY3VsYXIgPSB0ZXh0dXJlMkQoIHNwZWN1bGFyTWFwLCB2VXYgKTsnLAoJCQkJCScJdGV4ZWxTcGVjdWxhciA9IHNSR0JUb0xpbmVhciggdGV4ZWxTcGVjdWxhciApOycsCgkJCQkJJwkvLyByZWFkcyBjaGFubmVsIFJHQiwgY29tcGF0aWJsZSB3aXRoIGEgZ2xURiBTcGVjdWxhci1HbG9zc2luZXNzIChSR0JBKSB0ZXh0dXJlJywKCQkJCQknCXNwZWN1bGFyRmFjdG9yICo9IHRleGVsU3BlY3VsYXIucmdiOycsCgkJCQkJJyNlbmRpZicKCQkJCV0uam9pbiggJ1xuJyApOwoKCQkJCXZhciBnbG9zc2luZXNzTWFwRnJhZ21lbnRDaHVuayA9IFsKCQkJCQknZmxvYXQgZ2xvc3NpbmVzc0ZhY3RvciA9IGdsb3NzaW5lc3M7JywKCQkJCQknI2lmZGVmIFVTRV9HTE9TU0lORVNTTUFQJywKCQkJCQknCXZlYzQgdGV4ZWxHbG9zc2luZXNzID0gdGV4dHVyZTJEKCBnbG9zc2luZXNzTWFwLCB2VXYgKTsnLAoJCQkJCScJLy8gcmVhZHMgY2hhbm5lbCBBLCBjb21wYXRpYmxlIHdpdGggYSBnbFRGIFNwZWN1bGFyLUdsb3NzaW5lc3MgKFJHQkEpIHRleHR1cmUnLAoJCQkJCScJZ2xvc3NpbmVzc0ZhY3RvciAqPSB0ZXhlbEdsb3NzaW5lc3MuYTsnLAoJCQkJCScjZW5kaWYnCgkJCQldLmpvaW4oICdcbicgKTsKCgkJCQl2YXIgbGlnaHRQaHlzaWNhbEZyYWdtZW50Q2h1bmsgPSBbCgkJCQkJJ1BoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWw7JywKCQkJCQknbWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjsnLAoJCQkJCSdtYXRlcmlhbC5zcGVjdWxhclJvdWdobmVzcyA9IGNsYW1wKCAxLjAgLSBnbG9zc2luZXNzRmFjdG9yLCAwLjA0LCAxLjAgKTsnLAoJCQkJCSdtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gc3BlY3VsYXJGYWN0b3IucmdiOycsCgkJCQldLmpvaW4oICdcbicgKTsKCgkJCQl2YXIgZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXIKCQkJCQkucmVwbGFjZSggJ3VuaWZvcm0gZmxvYXQgcm91Z2huZXNzOycsICd1bmlmb3JtIHZlYzMgc3BlY3VsYXI7JyApCgkJCQkJLnJlcGxhY2UoICd1bmlmb3JtIGZsb2F0IG1ldGFsbmVzczsnLCAndW5pZm9ybSBmbG9hdCBnbG9zc2luZXNzOycgKQoJCQkJCS5yZXBsYWNlKCAnI2luY2x1ZGUgPHJvdWdobmVzc21hcF9wYXJzX2ZyYWdtZW50PicsIHNwZWN1bGFyTWFwUGFyc0ZyYWdtZW50Q2h1bmsgKQoJCQkJCS5yZXBsYWNlKCAnI2luY2x1ZGUgPG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50PicsIGdsb3NzaW5lc3NNYXBQYXJzRnJhZ21lbnRDaHVuayApCgkJCQkJLnJlcGxhY2UoICcjaW5jbHVkZSA8cm91Z2huZXNzbWFwX2ZyYWdtZW50PicsIHNwZWN1bGFyTWFwRnJhZ21lbnRDaHVuayApCgkJCQkJLnJlcGxhY2UoICcjaW5jbHVkZSA8bWV0YWxuZXNzbWFwX2ZyYWdtZW50PicsIGdsb3NzaW5lc3NNYXBGcmFnbWVudENodW5rICkKCQkJCQkucmVwbGFjZSggJyNpbmNsdWRlIDxsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQ+JywgbGlnaHRQaHlzaWNhbEZyYWdtZW50Q2h1bmsgKTsKCgkJCQlkZWxldGUgdW5pZm9ybXMucm91Z2huZXNzOwoJCQkJZGVsZXRlIHVuaWZvcm1zLm1ldGFsbmVzczsKCQkJCWRlbGV0ZSB1bmlmb3Jtcy5yb3VnaG5lc3NNYXA7CgkJCQlkZWxldGUgdW5pZm9ybXMubWV0YWxuZXNzTWFwOwoKCQkJCXVuaWZvcm1zLnNwZWN1bGFyID0geyB2YWx1ZTogbmV3IFRIUkVFLkNvbG9yKCkuc2V0SGV4KCAweDExMTExMSApIH07CgkJCQl1bmlmb3Jtcy5nbG9zc2luZXNzID0geyB2YWx1ZTogMC41IH07CgkJCQl1bmlmb3Jtcy5zcGVjdWxhck1hcCA9IHsgdmFsdWU6IG51bGwgfTsKCQkJCXVuaWZvcm1zLmdsb3NzaW5lc3NNYXAgPSB7IHZhbHVlOiBudWxsIH07CgoJCQkJcGFyYW1zLnZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXI7CgkJCQlwYXJhbXMuZnJhZ21lbnRTaGFkZXIgPSBmcmFnbWVudFNoYWRlcjsKCQkJCXBhcmFtcy51bmlmb3JtcyA9IHVuaWZvcm1zOwoJCQkJcGFyYW1zLmRlZmluZXMgPSB7ICdTVEFOREFSRCc6ICcnIH07CgoJCQkJcGFyYW1zLmNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCAxLjAsIDEuMCwgMS4wICk7CgkJCQlwYXJhbXMub3BhY2l0eSA9IDEuMDsKCgkJCQl2YXIgcGVuZGluZyA9IFtdOwoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggcGJyU3BlY3VsYXJHbG9zc2luZXNzLmRpZmZ1c2VGYWN0b3IgKSApIHsKCgkJCQkJdmFyIGFycmF5ID0gcGJyU3BlY3VsYXJHbG9zc2luZXNzLmRpZmZ1c2VGYWN0b3I7CgoJCQkJCXBhcmFtcy5jb2xvci5mcm9tQXJyYXkoIGFycmF5ICk7CgkJCQkJcGFyYW1zLm9wYWNpdHkgPSBhcnJheVsgMyBdOwoKCQkJCX0KCgkJCQlpZiAoIHBiclNwZWN1bGFyR2xvc3NpbmVzcy5kaWZmdXNlVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlwZW5kaW5nLnB1c2goIHBhcnNlci5hc3NpZ25UZXh0dXJlKCBwYXJhbXMsICdtYXAnLCBwYnJTcGVjdWxhckdsb3NzaW5lc3MuZGlmZnVzZVRleHR1cmUgKSApOwoKCQkJCX0KCgkJCQlwYXJhbXMuZW1pc3NpdmUgPSBuZXcgVEhSRUUuQ29sb3IoIDAuMCwgMC4wLCAwLjAgKTsKCQkJCXBhcmFtcy5nbG9zc2luZXNzID0gcGJyU3BlY3VsYXJHbG9zc2luZXNzLmdsb3NzaW5lc3NGYWN0b3IgIT09IHVuZGVmaW5lZCA/IHBiclNwZWN1bGFyR2xvc3NpbmVzcy5nbG9zc2luZXNzRmFjdG9yIDogMS4wOwoJCQkJcGFyYW1zLnNwZWN1bGFyID0gbmV3IFRIUkVFLkNvbG9yKCAxLjAsIDEuMCwgMS4wICk7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBwYnJTcGVjdWxhckdsb3NzaW5lc3Muc3BlY3VsYXJGYWN0b3IgKSApIHsKCgkJCQkJcGFyYW1zLnNwZWN1bGFyLmZyb21BcnJheSggcGJyU3BlY3VsYXJHbG9zc2luZXNzLnNwZWN1bGFyRmFjdG9yICk7CgoJCQkJfQoKCQkJCWlmICggcGJyU3BlY3VsYXJHbG9zc2luZXNzLnNwZWN1bGFyR2xvc3NpbmVzc1RleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdmFyIHNwZWNHbG9zc01hcERlZiA9IHBiclNwZWN1bGFyR2xvc3NpbmVzcy5zcGVjdWxhckdsb3NzaW5lc3NUZXh0dXJlOwoJCQkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIHBhcmFtcywgJ2dsb3NzaW5lc3NNYXAnLCBzcGVjR2xvc3NNYXBEZWYgKSApOwoJCQkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIHBhcmFtcywgJ3NwZWN1bGFyTWFwJywgc3BlY0dsb3NzTWFwRGVmICkgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIFByb21pc2UuYWxsKCBwZW5kaW5nICk7CgoJCQl9LAoKCQkJY3JlYXRlTWF0ZXJpYWw6IGZ1bmN0aW9uICggcGFyYW1zICkgewoKCQkJCS8vIHNldHVwIG1hdGVyaWFsIHByb3BlcnRpZXMgYmFzZWQgb24gTWVzaFN0YW5kYXJkTWF0ZXJpYWwgZm9yIFNwZWN1bGFyLUdsb3NzaW5lc3MKCgkJCQl2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuU2hhZGVyTWF0ZXJpYWwoIHsKCQkJCQlkZWZpbmVzOiBwYXJhbXMuZGVmaW5lcywKCQkJCQl2ZXJ0ZXhTaGFkZXI6IHBhcmFtcy52ZXJ0ZXhTaGFkZXIsCgkJCQkJZnJhZ21lbnRTaGFkZXI6IHBhcmFtcy5mcmFnbWVudFNoYWRlciwKCQkJCQl1bmlmb3JtczogcGFyYW1zLnVuaWZvcm1zLAoJCQkJCWZvZzogdHJ1ZSwKCQkJCQlsaWdodHM6IHRydWUsCgkJCQkJb3BhY2l0eTogcGFyYW1zLm9wYWNpdHksCgkJCQkJdHJhbnNwYXJlbnQ6IHBhcmFtcy50cmFuc3BhcmVudAoJCQkJfSApOwoKCQkJCW1hdGVyaWFsLmlzR0xURlNwZWN1bGFyR2xvc3NpbmVzc01hdGVyaWFsID0gdHJ1ZTsKCgkJCQltYXRlcmlhbC5jb2xvciA9IHBhcmFtcy5jb2xvcjsKCgkJCQltYXRlcmlhbC5tYXAgPSBwYXJhbXMubWFwID09PSB1bmRlZmluZWQgPyBudWxsIDogcGFyYW1zLm1hcDsKCgkJCQltYXRlcmlhbC5saWdodE1hcCA9IG51bGw7CgkJCQltYXRlcmlhbC5saWdodE1hcEludGVuc2l0eSA9IDEuMDsKCgkJCQltYXRlcmlhbC5hb01hcCA9IHBhcmFtcy5hb01hcCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHBhcmFtcy5hb01hcDsKCQkJCW1hdGVyaWFsLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQkJCW1hdGVyaWFsLmVtaXNzaXZlID0gcGFyYW1zLmVtaXNzaXZlOwoJCQkJbWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJCQltYXRlcmlhbC5lbWlzc2l2ZU1hcCA9IHBhcmFtcy5lbWlzc2l2ZU1hcCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHBhcmFtcy5lbWlzc2l2ZU1hcDsKCgkJCQltYXRlcmlhbC5idW1wTWFwID0gcGFyYW1zLmJ1bXBNYXAgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBwYXJhbXMuYnVtcE1hcDsKCQkJCW1hdGVyaWFsLmJ1bXBTY2FsZSA9IDE7CgoJCQkJbWF0ZXJpYWwubm9ybWFsTWFwID0gcGFyYW1zLm5vcm1hbE1hcCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHBhcmFtcy5ub3JtYWxNYXA7CgkJCQlpZiAoIHBhcmFtcy5ub3JtYWxTY2FsZSApIG1hdGVyaWFsLm5vcm1hbFNjYWxlID0gcGFyYW1zLm5vcm1hbFNjYWxlOwoKCQkJCW1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJCQltYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJCQltYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJCQltYXRlcmlhbC5zcGVjdWxhck1hcCA9IHBhcmFtcy5zcGVjdWxhck1hcCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHBhcmFtcy5zcGVjdWxhck1hcDsKCQkJCW1hdGVyaWFsLnNwZWN1bGFyID0gcGFyYW1zLnNwZWN1bGFyOwoKCQkJCW1hdGVyaWFsLmdsb3NzaW5lc3NNYXAgPSBwYXJhbXMuZ2xvc3NpbmVzc01hcCA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHBhcmFtcy5nbG9zc2luZXNzTWFwOwoJCQkJbWF0ZXJpYWwuZ2xvc3NpbmVzcyA9IHBhcmFtcy5nbG9zc2luZXNzOwoKCQkJCW1hdGVyaWFsLmFscGhhTWFwID0gbnVsbDsKCgkJCQltYXRlcmlhbC5lbnZNYXAgPSBwYXJhbXMuZW52TWFwID09PSB1bmRlZmluZWQgPyBudWxsIDogcGFyYW1zLmVudk1hcDsKCQkJCW1hdGVyaWFsLmVudk1hcEludGVuc2l0eSA9IDEuMDsKCgkJCQltYXRlcmlhbC5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKCQkJCW1hdGVyaWFsLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMgPSB0cnVlOwoKCQkJCXJldHVybiBtYXRlcmlhbDsKCgkJCX0sCgoJCQkvKioKCQkJICogQ2xvbmVzIGEgR0xURlNwZWN1bGFyR2xvc3NpbmVzc01hdGVyaWFsIGluc3RhbmNlLiBUaGUgU2hhZGVyTWF0ZXJpYWwuY29weSgpIG1ldGhvZCBjYW4KCQkJICogY29weSBvbmx5IHByb3BlcnRpZXMgaXQga25vd3MgYWJvdXQgb3IgaW5oZXJpdHMsIGFuZCBtaXNzZXMgbWFueSBwcm9wZXJ0aWVzIHRoYXQgd291bGQKCQkJICogbm9ybWFsbHkgYmUgZGVmaW5lZCBieSBNZXNoU3RhbmRhcmRNYXRlcmlhbC4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgYWxsb3dzIEdMVEZTcGVjdWxhckdsb3NzaW5lc3NNYXRlcmlhbHMgdG8gYmUgY2xvbmVkIGluIHRoZSBwcm9jZXNzIG9mCgkJCSAqIGxvYWRpbmcgYSBnbFRGIG1vZGVsLCBidXQgY2xvbmluZyBsYXRlciAoZS5nLiBieSB0aGUgdXNlcikgd291bGQgcmVxdWlyZSB0aGVzZSBjaGFuZ2VzCgkJCSAqIEFORCBhbHNvIHVwZGF0aW5nIGAub25CZWZvcmVSZW5kZXJgIG9uIHRoZSBwYXJlbnQgbWVzaC4KCQkJICoKCQkJICogQHBhcmFtICB7VEhSRUUuU2hhZGVyTWF0ZXJpYWx9IHNvdXJjZQoJCQkgKiBAcmV0dXJuIHtUSFJFRS5TaGFkZXJNYXRlcmlhbH0KCQkJICovCgkJCWNsb25lTWF0ZXJpYWw6IGZ1bmN0aW9uICggc291cmNlICkgewoKCQkJCXZhciB0YXJnZXQgPSBzb3VyY2UuY2xvbmUoKTsKCgkJCQl0YXJnZXQuaXNHTFRGU3BlY3VsYXJHbG9zc2luZXNzTWF0ZXJpYWwgPSB0cnVlOwoKCQkJCXZhciBwYXJhbXMgPSB0aGlzLnNwZWN1bGFyR2xvc3NpbmVzc1BhcmFtczsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gcGFyYW1zLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl0YXJnZXRbIHBhcmFtc1sgaSBdIF0gPSBzb3VyY2VbIHBhcmFtc1sgaSBdIF07CgoJCQkJfQoKCQkJCXJldHVybiB0YXJnZXQ7CgoJCQl9LAoKCQkJLy8gSGVyZSdzIGJhc2VkIG9uIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbigpIGFuZCByZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCgpIGluIFdlYkdMUmVuZGVyZXIuCgkJCXJlZnJlc2hVbmlmb3JtczogZnVuY3Rpb24gKCByZW5kZXJlciwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApIHsKCgkJCQlpZiAoIG1hdGVyaWFsLmlzR0xURlNwZWN1bGFyR2xvc3NpbmVzc01hdGVyaWFsICE9PSB0cnVlICkgewoKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCXZhciB1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwoJCQkJdmFyIGRlZmluZXMgPSBtYXRlcmlhbC5kZWZpbmVzOwoKCQkJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKCQkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJCXVuaWZvcm1zLmVtaXNzaXZlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmVtaXNzaXZlICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLmVtaXNzaXZlSW50ZW5zaXR5ICk7CgoJCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoJCQkJdW5pZm9ybXMuc3BlY3VsYXJNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhck1hcDsKCQkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKCQkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQkJdW5pZm9ybXMuYW9NYXAudmFsdWUgPSBtYXRlcmlhbC5hb01hcDsKCQkJCXVuaWZvcm1zLmFvTWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuYW9NYXBJbnRlbnNpdHk7CgoJCQkJLy8gdXYgcmVwZWF0IGFuZCBvZmZzZXQgc2V0dGluZyBwcmlvcml0aWVzCgkJCQkvLyAxLiBjb2xvciBtYXAKCQkJCS8vIDIuIHNwZWN1bGFyIG1hcAoJCQkJLy8gMy4gbm9ybWFsIG1hcAoJCQkJLy8gNC4gYnVtcCBtYXAKCQkJCS8vIDUuIGFscGhhIG1hcAoJCQkJLy8gNi4gZW1pc3NpdmUgbWFwCgoJCQkJdmFyIHV2U2NhbGVNYXA7CgoJCQkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5tYXA7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuc3BlY3VsYXJNYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5zcGVjdWxhck1hcDsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKCQkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5idW1wTWFwOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmdsb3NzaW5lc3NNYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5nbG9zc2luZXNzTWFwOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJCQl1dlNjYWxlTWFwID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuZW1pc3NpdmVNYXAgKSB7CgoJCQkJCXV2U2NhbGVNYXAgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCgkJCQl9CgoJCQkJaWYgKCB1dlNjYWxlTWFwICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCS8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJCQkJaWYgKCB1dlNjYWxlTWFwLmlzV2ViR0xSZW5kZXJUYXJnZXQgKSB7CgoJCQkJCQl1dlNjYWxlTWFwID0gdXZTY2FsZU1hcC50ZXh0dXJlOwoKCQkJCQl9CgoJCQkJCWlmICggdXZTY2FsZU1hcC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQkJdXZTY2FsZU1hcC51cGRhdGVNYXRyaXgoKTsKCgkJCQkJfQoKCQkJCQl1bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCB1dlNjYWxlTWFwLm1hdHJpeCApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmVudk1hcCApIHsKCgkJCQkJdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwOwoJCQkJCXVuaWZvcm1zLmVudk1hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcEludGVuc2l0eTsKCgkJCQkJLy8gZG9uJ3QgZmxpcCBDdWJlVGV4dHVyZSBlbnZNYXBzLCBmbGlwIGV2ZXJ5dGhpbmcgZWxzZToKCQkJCQkvLyAgV2ViR0xSZW5kZXJUYXJnZXRDdWJlIHdpbGwgYmUgZmxpcHBlZCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkJCQkvLyAgV2ViR0xSZW5kZXJUYXJnZXRDdWJlLnRleHR1cmUgd2lsbCBiZSBmbGlwcGVkIGJlY2F1c2UgaXQncyBhIFRleHR1cmUgYW5kIE5PVCBhIEN1YmVUZXh0dXJlCgkJCQkJLy8gdGhpcyBjaGVjayBtdXN0IGJlIGhhbmRsZWQgZGlmZmVyZW50bHksIG9yIHJlbW92ZWQgZW50aXJlbHksIGlmIFdlYkdMUmVuZGVyVGFyZ2V0Q3ViZSB1c2VzIGEgQ3ViZVRleHR1cmUgaW4gdGhlIGZ1dHVyZQoJCQkJCXVuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXAuaXNDdWJlVGV4dHVyZSA/IC0gMSA6IDE7CgoJCQkJCXVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKCQkJCQl1bmlmb3Jtcy5yZWZyYWN0aW9uUmF0aW8udmFsdWUgPSBtYXRlcmlhbC5yZWZyYWN0aW9uUmF0aW87CgoJCQkJCXVuaWZvcm1zLm1heE1pcExldmVsLnZhbHVlID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIG1hdGVyaWFsLmVudk1hcCApLl9fbWF4TWlwTGV2ZWw7CgoJCQkJfQoKCQkJCXVuaWZvcm1zLnNwZWN1bGFyLnZhbHVlLmNvcHkoIG1hdGVyaWFsLnNwZWN1bGFyICk7CgkJCQl1bmlmb3Jtcy5nbG9zc2luZXNzLnZhbHVlID0gbWF0ZXJpYWwuZ2xvc3NpbmVzczsKCgkJCQl1bmlmb3Jtcy5nbG9zc2luZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuZ2xvc3NpbmVzc01hcDsKCgkJCQl1bmlmb3Jtcy5lbWlzc2l2ZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmVtaXNzaXZlTWFwOwoJCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgkJCQl1bmlmb3Jtcy5ub3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5ub3JtYWxNYXA7CgoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudEJpYXMudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRCaWFzOwoKCQkJCWlmICggdW5pZm9ybXMuZ2xvc3NpbmVzc01hcC52YWx1ZSAhPT0gbnVsbCAmJiBkZWZpbmVzLlVTRV9HTE9TU0lORVNTTUFQID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWRlZmluZXMuVVNFX0dMT1NTSU5FU1NNQVAgPSAnJzsKCQkJCQkvLyBzZXQgVVNFX1JPVUdITkVTU01BUCB0byBlbmFibGUgdlV2CgkJCQkJZGVmaW5lcy5VU0VfUk9VR0hORVNTTUFQID0gJyc7CgoJCQkJfQoKCQkJCWlmICggdW5pZm9ybXMuZ2xvc3NpbmVzc01hcC52YWx1ZSA9PT0gbnVsbCAmJiBkZWZpbmVzLlVTRV9HTE9TU0lORVNTTUFQICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWRlbGV0ZSBkZWZpbmVzLlVTRV9HTE9TU0lORVNTTUFQOwoJCQkJCWRlbGV0ZSBkZWZpbmVzLlVTRV9ST1VHSE5FU1NNQVA7CgoJCQkJfQoKCQkJfQoKCQl9OwoKCX0KCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoJLyoqKioqKioqKiogSU5URVJQT0xBVElPTiAqKioqKioqKi8KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJLy8gU3BsaW5lIEludGVycG9sYXRpb24KCS8vIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjYXBwZW5kaXgtYy1zcGxpbmUtaW50ZXJwb2xhdGlvbgoJZnVuY3Rpb24gR0xURkN1YmljU3BsaW5lSW50ZXJwb2xhbnQoIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKSB7CgoJCVRIUkVFLkludGVycG9sYW50LmNhbGwoIHRoaXMsIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKTsKCgl9CgoJR0xURkN1YmljU3BsaW5lSW50ZXJwb2xhbnQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggVEhSRUUuSW50ZXJwb2xhbnQucHJvdG90eXBlICk7CglHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudDsKCglHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudC5wcm90b3R5cGUuY29weVNhbXBsZVZhbHVlXyA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCS8vIENvcGllcyBhIHNhbXBsZSB2YWx1ZSB0byB0aGUgcmVzdWx0IGJ1ZmZlci4gU2VlIGRlc2NyaXB0aW9uIG9mIGdsVEYKCQkvLyBDVUJJQ1NQTElORSB2YWx1ZXMgbGF5b3V0IGluIGludGVycG9sYXRlXygpIGZ1bmN0aW9uIGJlbG93LgoKCQl2YXIgcmVzdWx0ID0gdGhpcy5yZXN1bHRCdWZmZXIsCgkJCXZhbHVlcyA9IHRoaXMuc2FtcGxlVmFsdWVzLAoJCQl2YWx1ZVNpemUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJb2Zmc2V0ID0gaW5kZXggKiB2YWx1ZVNpemUgKiAzICsgdmFsdWVTaXplOwoKCQlmb3IgKCB2YXIgaSA9IDA7IGkgIT09IHZhbHVlU2l6ZTsgaSArKyApIHsKCgkJCXJlc3VsdFsgaSBdID0gdmFsdWVzWyBvZmZzZXQgKyBpIF07CgoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCgl9OwoKCUdMVEZDdWJpY1NwbGluZUludGVycG9sYW50LnByb3RvdHlwZS5iZWZvcmVTdGFydF8gPSBHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudC5wcm90b3R5cGUuY29weVNhbXBsZVZhbHVlXzsKCglHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudC5wcm90b3R5cGUuYWZ0ZXJFbmRfID0gR0xURkN1YmljU3BsaW5lSW50ZXJwb2xhbnQucHJvdG90eXBlLmNvcHlTYW1wbGVWYWx1ZV87CgoJR0xURkN1YmljU3BsaW5lSW50ZXJwb2xhbnQucHJvdG90eXBlLmludGVycG9sYXRlXyA9IGZ1bmN0aW9uICggaTEsIHQwLCB0LCB0MSApIHsKCgkJdmFyIHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyOwoJCXZhciB2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlczsKCQl2YXIgc3RyaWRlID0gdGhpcy52YWx1ZVNpemU7CgoJCXZhciBzdHJpZGUyID0gc3RyaWRlICogMjsKCQl2YXIgc3RyaWRlMyA9IHN0cmlkZSAqIDM7CgoJCXZhciB0ZCA9IHQxIC0gdDA7CgoJCXZhciBwID0gKCB0IC0gdDAgKSAvIHRkOwoJCXZhciBwcCA9IHAgKiBwOwoJCXZhciBwcHAgPSBwcCAqIHA7CgoJCXZhciBvZmZzZXQxID0gaTEgKiBzdHJpZGUzOwoJCXZhciBvZmZzZXQwID0gb2Zmc2V0MSAtIHN0cmlkZTM7CgoJCXZhciBzMiA9IC0gMiAqIHBwcCArIDMgKiBwcDsKCQl2YXIgczMgPSBwcHAgLSBwcDsKCQl2YXIgczAgPSAxIC0gczI7CgkJdmFyIHMxID0gczMgLSBwcCArIHA7CgoJCS8vIExheW91dCBvZiBrZXlmcmFtZSBvdXRwdXQgdmFsdWVzIGZvciBDVUJJQ1NQTElORSBhbmltYXRpb25zOgoJCS8vICAgWyBpblRhbmdlbnRfMSwgc3BsaW5lVmVydGV4XzEsIG91dFRhbmdlbnRfMSwgaW5UYW5nZW50XzIsIHNwbGluZVZlcnRleF8yLCAuLi4gXQoJCWZvciAoIHZhciBpID0gMDsgaSAhPT0gc3RyaWRlOyBpICsrICkgewoKCQkJdmFyIHAwID0gdmFsdWVzWyBvZmZzZXQwICsgaSArIHN0cmlkZSBdOyAvLyBzcGxpbmVWZXJ0ZXhfawoJCQl2YXIgbTAgPSB2YWx1ZXNbIG9mZnNldDAgKyBpICsgc3RyaWRlMiBdICogdGQ7IC8vIG91dFRhbmdlbnRfayAqICh0X2srMSAtIHRfaykKCQkJdmFyIHAxID0gdmFsdWVzWyBvZmZzZXQxICsgaSArIHN0cmlkZSBdOyAvLyBzcGxpbmVWZXJ0ZXhfaysxCgkJCXZhciBtMSA9IHZhbHVlc1sgb2Zmc2V0MSArIGkgXSAqIHRkOyAvLyBpblRhbmdlbnRfaysxICogKHRfaysxIC0gdF9rKQoKCQkJcmVzdWx0WyBpIF0gPSBzMCAqIHAwICsgczEgKiBtMCArIHMyICogcDEgKyBzMyAqIG0xOwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfTsKCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoJLyoqKioqKioqKiogSU5URVJOQUxTICoqKioqKioqKioqKi8KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoJLyogQ09OU1RBTlRTICovCgoJdmFyIFdFQkdMX0NPTlNUQU5UUyA9IHsKCQlGTE9BVDogNTEyNiwKCQkvL0ZMT0FUX01BVDI6IDM1Njc0LAoJCUZMT0FUX01BVDM6IDM1Njc1LAoJCUZMT0FUX01BVDQ6IDM1Njc2LAoJCUZMT0FUX1ZFQzI6IDM1NjY0LAoJCUZMT0FUX1ZFQzM6IDM1NjY1LAoJCUZMT0FUX1ZFQzQ6IDM1NjY2LAoJCUxJTkVBUjogOTcyOSwKCQlSRVBFQVQ6IDEwNDk3LAoJCVNBTVBMRVJfMkQ6IDM1Njc4LAoJCVBPSU5UUzogMCwKCQlMSU5FUzogMSwKCQlMSU5FX0xPT1A6IDIsCgkJTElORV9TVFJJUDogMywKCQlUUklBTkdMRVM6IDQsCgkJVFJJQU5HTEVfU1RSSVA6IDUsCgkJVFJJQU5HTEVfRkFOOiA2LAoJCVVOU0lHTkVEX0JZVEU6IDUxMjEsCgkJVU5TSUdORURfU0hPUlQ6IDUxMjMKCX07CgoJdmFyIFdFQkdMX1RZUEUgPSB7CgkJNTEyNjogTnVtYmVyLAoJCS8vMzU2NzQ6IFRIUkVFLk1hdHJpeDIsCgkJMzU2NzU6IFRIUkVFLk1hdHJpeDMsCgkJMzU2NzY6IFRIUkVFLk1hdHJpeDQsCgkJMzU2NjQ6IFRIUkVFLlZlY3RvcjIsCgkJMzU2NjU6IFRIUkVFLlZlY3RvcjMsCgkJMzU2NjY6IFRIUkVFLlZlY3RvcjQsCgkJMzU2Nzg6IFRIUkVFLlRleHR1cmUKCX07CgoJdmFyIFdFQkdMX0NPTVBPTkVOVF9UWVBFUyA9IHsKCQk1MTIwOiBJbnQ4QXJyYXksCgkJNTEyMTogVWludDhBcnJheSwKCQk1MTIyOiBJbnQxNkFycmF5LAoJCTUxMjM6IFVpbnQxNkFycmF5LAoJCTUxMjU6IFVpbnQzMkFycmF5LAoJCTUxMjY6IEZsb2F0MzJBcnJheQoJfTsKCgl2YXIgV0VCR0xfRklMVEVSUyA9IHsKCQk5NzI4OiBUSFJFRS5OZWFyZXN0RmlsdGVyLAoJCTk3Mjk6IFRIUkVFLkxpbmVhckZpbHRlciwKCQk5OTg0OiBUSFJFRS5OZWFyZXN0TWlwTWFwTmVhcmVzdEZpbHRlciwKCQk5OTg1OiBUSFJFRS5MaW5lYXJNaXBNYXBOZWFyZXN0RmlsdGVyLAoJCTk5ODY6IFRIUkVFLk5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIsCgkJOTk4NzogVEhSRUUuTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyCgl9OwoKCXZhciBXRUJHTF9XUkFQUElOR1MgPSB7CgkJMzMwNzE6IFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmcsCgkJMzM2NDg6IFRIUkVFLk1pcnJvcmVkUmVwZWF0V3JhcHBpbmcsCgkJMTA0OTc6IFRIUkVFLlJlcGVhdFdyYXBwaW5nCgl9OwoKCXZhciBXRUJHTF9TSURFUyA9IHsKCQkxMDI4OiBUSFJFRS5CYWNrU2lkZSwgLy8gQ3VsbGluZyBmcm9udAoJCTEwMjk6IFRIUkVFLkZyb250U2lkZSAvLyBDdWxsaW5nIGJhY2sKCQkvLzEwMzI6IFRIUkVFLk5vU2lkZSAgIC8vIEN1bGxpbmcgZnJvbnQgYW5kIGJhY2ssIHdoYXQgdG8gZG8/Cgl9OwoKCXZhciBXRUJHTF9ERVBUSF9GVU5DUyA9IHsKCQk1MTI6IFRIUkVFLk5ldmVyRGVwdGgsCgkJNTEzOiBUSFJFRS5MZXNzRGVwdGgsCgkJNTE0OiBUSFJFRS5FcXVhbERlcHRoLAoJCTUxNTogVEhSRUUuTGVzc0VxdWFsRGVwdGgsCgkJNTE2OiBUSFJFRS5HcmVhdGVyRXF1YWxEZXB0aCwKCQk1MTc6IFRIUkVFLk5vdEVxdWFsRGVwdGgsCgkJNTE4OiBUSFJFRS5HcmVhdGVyRXF1YWxEZXB0aCwKCQk1MTk6IFRIUkVFLkFsd2F5c0RlcHRoCgl9OwoKCXZhciBXRUJHTF9CTEVORF9FUVVBVElPTlMgPSB7CgkJMzI3NzQ6IFRIUkVFLkFkZEVxdWF0aW9uLAoJCTMyNzc4OiBUSFJFRS5TdWJ0cmFjdEVxdWF0aW9uLAoJCTMyNzc5OiBUSFJFRS5SZXZlcnNlU3VidHJhY3RFcXVhdGlvbgoJfTsKCgl2YXIgV0VCR0xfQkxFTkRfRlVOQ1MgPSB7CgkJMDogVEhSRUUuWmVyb0ZhY3RvciwKCQkxOiBUSFJFRS5PbmVGYWN0b3IsCgkJNzY4OiBUSFJFRS5TcmNDb2xvckZhY3RvciwKCQk3Njk6IFRIUkVFLk9uZU1pbnVzU3JjQ29sb3JGYWN0b3IsCgkJNzcwOiBUSFJFRS5TcmNBbHBoYUZhY3RvciwKCQk3NzE6IFRIUkVFLk9uZU1pbnVzU3JjQWxwaGFGYWN0b3IsCgkJNzcyOiBUSFJFRS5Ec3RBbHBoYUZhY3RvciwKCQk3NzM6IFRIUkVFLk9uZU1pbnVzRHN0QWxwaGFGYWN0b3IsCgkJNzc0OiBUSFJFRS5Ec3RDb2xvckZhY3RvciwKCQk3NzU6IFRIUkVFLk9uZU1pbnVzRHN0Q29sb3JGYWN0b3IsCgkJNzc2OiBUSFJFRS5TcmNBbHBoYVNhdHVyYXRlRmFjdG9yCgkJLy8gVGhlIGZvbGxvd2luZ3MgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgVGhyZWUuanMgeWV0CgkJLy8zMjc2OTogQ09OU1RBTlRfQ09MT1IsCgkJLy8zMjc3MDogT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SLAoJCS8vMzI3NzE6IENPTlNUQU5UX0FMUEhBLAoJCS8vMzI3NzI6IE9ORV9NSU5VU19DT05TVEFOVF9DT0xPUgoJfTsKCgl2YXIgV0VCR0xfVFlQRV9TSVpFUyA9IHsKCQknU0NBTEFSJzogMSwKCQknVkVDMic6IDIsCgkJJ1ZFQzMnOiAzLAoJCSdWRUM0JzogNCwKCQknTUFUMic6IDQsCgkJJ01BVDMnOiA5LAoJCSdNQVQ0JzogMTYKCX07CgoJdmFyIEFUVFJJQlVURVMgPSB7CgkJUE9TSVRJT046ICdwb3NpdGlvbicsCgkJTk9STUFMOiAnbm9ybWFsJywKCQlUQU5HRU5UOiAndGFuZ2VudCcsCgkJVEVYQ09PUkRfMDogJ3V2JywKCQlURVhDT09SRF8xOiAndXYyJywKCQlDT0xPUl8wOiAnY29sb3InLAoJCVdFSUdIVFNfMDogJ3NraW5XZWlnaHQnLAoJCUpPSU5UU18wOiAnc2tpbkluZGV4JywKCX07CgoJdmFyIFBBVEhfUFJPUEVSVElFUyA9IHsKCQlzY2FsZTogJ3NjYWxlJywKCQl0cmFuc2xhdGlvbjogJ3Bvc2l0aW9uJywKCQlyb3RhdGlvbjogJ3F1YXRlcm5pb24nLAoJCXdlaWdodHM6ICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnCgl9OwoKCXZhciBJTlRFUlBPTEFUSU9OID0gewoJCUNVQklDU1BMSU5FOiB1bmRlZmluZWQsIC8vIFdlIHVzZSBhIGN1c3RvbSBpbnRlcnBvbGFudCAoR0xURkN1YmljU3BsaW5lSW50ZXJwb2xhdGlvbikgZm9yIENVQklDU1BMSU5FIHRyYWNrcy4gRWFjaAoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtleWZyYW1lIHRyYWNrIHdpbGwgYmUgaW5pdGlhbGl6ZWQgd2l0aCBhIGRlZmF1bHQgaW50ZXJwb2xhdGlvbiB0eXBlLCB0aGVuIG1vZGlmaWVkLgoJCUxJTkVBUjogVEhSRUUuSW50ZXJwb2xhdGVMaW5lYXIsCgkJU1RFUDogVEhSRUUuSW50ZXJwb2xhdGVEaXNjcmV0ZQoJfTsKCgl2YXIgU1RBVEVTX0VOQUJMRVMgPSB7CgkJMjg4NDogJ0NVTExfRkFDRScsCgkJMjkyOTogJ0RFUFRIX1RFU1QnLAoJCTMwNDI6ICdCTEVORCcsCgkJMzA4OTogJ1NDSVNTT1JfVEVTVCcsCgkJMzI4MjM6ICdQT0xZR09OX09GRlNFVF9GSUxMJywKCQkzMjkyNjogJ1NBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRScKCX07CgoJdmFyIEFMUEhBX01PREVTID0gewoJCU9QQVFVRTogJ09QQVFVRScsCgkJTUFTSzogJ01BU0snLAoJCUJMRU5EOiAnQkxFTkQnCgl9OwoKCXZhciBNSU1FX1RZUEVfRk9STUFUUyA9IHsKCQknaW1hZ2UvcG5nJzogVEhSRUUuUkdCQUZvcm1hdCwKCQknaW1hZ2UvanBlZyc6IFRIUkVFLlJHQkZvcm1hdAoJfTsKCgkvKiBVVElMSVRZIEZVTkNUSU9OUyAqLwoKCWZ1bmN0aW9uIHJlc29sdmVVUkwoIHVybCwgcGF0aCApIHsKCgkJLy8gSW52YWxpZCBVUkwKCQlpZiAoIHR5cGVvZiB1cmwgIT09ICdzdHJpbmcnIHx8IHVybCA9PT0gJycgKSByZXR1cm4gJyc7CgoJCS8vIEFic29sdXRlIFVSTCBodHRwOi8vLGh0dHBzOi8vLC8vCgkJaWYgKCAvXihodHRwcz86KT9cL1wvL2kudGVzdCggdXJsICkgKSByZXR1cm4gdXJsOwoKCQkvLyBEYXRhIFVSSQoJCWlmICggL15kYXRhOi4qLC4qJC9pLnRlc3QoIHVybCApICkgcmV0dXJuIHVybDsKCgkJLy8gQmxvYiBVUkwKCQlpZiAoIC9eYmxvYjouKiQvaS50ZXN0KCB1cmwgKSApIHJldHVybiB1cmw7CgoJCS8vIFJlbGF0aXZlIFVSTAoJCXJldHVybiBwYXRoICsgdXJsOwoKCX0KCgl2YXIgZGVmYXVsdE1hdGVyaWFsOwoKCS8qKgoJICogU3BlY2lmaWNhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL2Jsb2IvbWFzdGVyL3NwZWNpZmljYXRpb24vMi4wL1JFQURNRS5tZCNkZWZhdWx0LW1hdGVyaWFsCgkgKi8KCWZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRNYXRlcmlhbCgpIHsKCgkJZGVmYXVsdE1hdGVyaWFsID0gZGVmYXVsdE1hdGVyaWFsIHx8IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCggewoJCQljb2xvcjogMHhGRkZGRkYsCgkJCWVtaXNzaXZlOiAweDAwMDAwMCwKCQkJbWV0YWxuZXNzOiAxLAoJCQlyb3VnaG5lc3M6IDEsCgkJCXRyYW5zcGFyZW50OiBmYWxzZSwKCQkJZGVwdGhUZXN0OiB0cnVlLAoJCQlzaWRlOiBUSFJFRS5Gcm9udFNpZGUKCQl9ICk7CgoJCXJldHVybiBkZWZhdWx0TWF0ZXJpYWw7CgoJfQoKCWZ1bmN0aW9uIGFkZFVua25vd25FeHRlbnNpb25zVG9Vc2VyRGF0YSgga25vd25FeHRlbnNpb25zLCBvYmplY3QsIG9iamVjdERlZiApIHsKCgkJLy8gQWRkIHVua25vd24gZ2xURiBleHRlbnNpb25zIHRvIGFuIG9iamVjdCdzIHVzZXJEYXRhLgoKCQlmb3IgKCB2YXIgbmFtZSBpbiBvYmplY3REZWYuZXh0ZW5zaW9ucyApIHsKCgkJCWlmICgga25vd25FeHRlbnNpb25zWyBuYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlvYmplY3QudXNlckRhdGEuZ2x0ZkV4dGVuc2lvbnMgPSBvYmplY3QudXNlckRhdGEuZ2x0ZkV4dGVuc2lvbnMgfHwge307CgkJCQlvYmplY3QudXNlckRhdGEuZ2x0ZkV4dGVuc2lvbnNbIG5hbWUgXSA9IG9iamVjdERlZi5leHRlbnNpb25zWyBuYW1lIF07CgoJCQl9CgoJCX0KCgl9CgoJLyoqCgkgKiBAcGFyYW0ge1RIUkVFLk9iamVjdDNEfFRIUkVFLk1hdGVyaWFsfFRIUkVFLkJ1ZmZlckdlb21ldHJ5fSBvYmplY3QKCSAqIEBwYXJhbSB7R0xURi5kZWZpbml0aW9ufSBnbHRmRGVmCgkgKi8KCWZ1bmN0aW9uIGFzc2lnbkV4dHJhc1RvVXNlckRhdGEoIG9iamVjdCwgZ2x0ZkRlZiApIHsKCgkJaWYgKCBnbHRmRGVmLmV4dHJhcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCB0eXBlb2YgZ2x0ZkRlZi5leHRyYXMgPT09ICdvYmplY3QnICkgewoKCQkJCW9iamVjdC51c2VyRGF0YSA9IGdsdGZEZWYuZXh0cmFzOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5HTFRGTG9hZGVyOiBJZ25vcmluZyBwcmltaXRpdmUgdHlwZSAuZXh0cmFzLCAnICsgZ2x0ZkRlZi5leHRyYXMgKTsKCgkJCX0KCgkJfQoKCX0KCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjbW9ycGgtdGFyZ2V0cwoJICoKCSAqIEBwYXJhbSB7VEhSRUUuQnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5CgkgKiBAcGFyYW0ge0FycmF5PEdMVEYuVGFyZ2V0Pn0gdGFyZ2V0cwoJICogQHBhcmFtIHtHTFRGUGFyc2VyfSBwYXJzZXIKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuQnVmZmVyR2VvbWV0cnk+fQoJICovCglmdW5jdGlvbiBhZGRNb3JwaFRhcmdldHMoIGdlb21ldHJ5LCB0YXJnZXRzLCBwYXJzZXIgKSB7CgoJCXZhciBoYXNNb3JwaFBvc2l0aW9uID0gZmFsc2U7CgkJdmFyIGhhc01vcnBoTm9ybWFsID0gZmFsc2U7CgoJCWZvciAoIHZhciBpID0gMCwgaWwgPSB0YXJnZXRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJdmFyIHRhcmdldCA9IHRhcmdldHNbIGkgXTsKCgkJCWlmICggdGFyZ2V0LlBPU0lUSU9OICE9PSB1bmRlZmluZWQgKSBoYXNNb3JwaFBvc2l0aW9uID0gdHJ1ZTsKCQkJaWYgKCB0YXJnZXQuTk9STUFMICE9PSB1bmRlZmluZWQgKSBoYXNNb3JwaE5vcm1hbCA9IHRydWU7CgoJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gJiYgaGFzTW9ycGhOb3JtYWwgKSBicmVhazsKCgkJfQoKCQlpZiAoICEgaGFzTW9ycGhQb3NpdGlvbiAmJiAhIGhhc01vcnBoTm9ybWFsICkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSggZ2VvbWV0cnkgKTsKCgkJdmFyIHBlbmRpbmdQb3NpdGlvbkFjY2Vzc29ycyA9IFtdOwoJCXZhciBwZW5kaW5nTm9ybWFsQWNjZXNzb3JzID0gW107CgoJCWZvciAoIHZhciBpID0gMCwgaWwgPSB0YXJnZXRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJdmFyIHRhcmdldCA9IHRhcmdldHNbIGkgXTsKCgkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiApIHsKCgkJCQl2YXIgcGVuZGluZ0FjY2Vzc29yID0gdGFyZ2V0LlBPU0lUSU9OICE9PSB1bmRlZmluZWQKCQkJCQk/IHBhcnNlci5nZXREZXBlbmRlbmN5KCAnYWNjZXNzb3InLCB0YXJnZXQuUE9TSVRJT04gKQoJCQkJCTogZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCQlwZW5kaW5nUG9zaXRpb25BY2Nlc3NvcnMucHVzaCggcGVuZGluZ0FjY2Vzc29yICk7CgoJCQl9CgoJCQlpZiAoIGhhc01vcnBoTm9ybWFsICkgewoKCQkJCXZhciBwZW5kaW5nQWNjZXNzb3IgPSB0YXJnZXQuTk9STUFMICE9PSB1bmRlZmluZWQKCQkJCQk/IHBhcnNlci5nZXREZXBlbmRlbmN5KCAnYWNjZXNzb3InLCB0YXJnZXQuTk9STUFMICkKCQkJCQk6IGdlb21ldHJ5LmF0dHJpYnV0ZXMubm9ybWFsOwoKCQkJCXBlbmRpbmdOb3JtYWxBY2Nlc3NvcnMucHVzaCggcGVuZGluZ0FjY2Vzc29yICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIFByb21pc2UuYWxsKCBbCgkJCVByb21pc2UuYWxsKCBwZW5kaW5nUG9zaXRpb25BY2Nlc3NvcnMgKSwKCQkJUHJvbWlzZS5hbGwoIHBlbmRpbmdOb3JtYWxBY2Nlc3NvcnMgKQoJCV0gKS50aGVuKCBmdW5jdGlvbiAoIGFjY2Vzc29ycyApIHsKCgkJCXZhciBtb3JwaFBvc2l0aW9ucyA9IGFjY2Vzc29yc1sgMCBdOwoJCQl2YXIgbW9ycGhOb3JtYWxzID0gYWNjZXNzb3JzWyAxIF07CgoJCQkvLyBDbG9uZSBtb3JwaCB0YXJnZXQgYWNjZXNzb3JzIGJlZm9yZSBtb2RpZnlpbmcgdGhlbS4KCgkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtb3JwaFBvc2l0aW9ucy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQlpZiAoIGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24gPT09IG1vcnBoUG9zaXRpb25zWyBpIF0gKSBjb250aW51ZTsKCgkJCQltb3JwaFBvc2l0aW9uc1sgaSBdID0gY2xvbmVCdWZmZXJBdHRyaWJ1dGUoIG1vcnBoUG9zaXRpb25zWyBpIF0gKTsKCgkJCX0KCgkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtb3JwaE5vcm1hbHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJaWYgKCBnZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbCA9PT0gbW9ycGhOb3JtYWxzWyBpIF0gKSBjb250aW51ZTsKCgkJCQltb3JwaE5vcm1hbHNbIGkgXSA9IGNsb25lQnVmZmVyQXR0cmlidXRlKCBtb3JwaE5vcm1hbHNbIGkgXSApOwoKCQkJfQoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHRhcmdldHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdmFyIHRhcmdldCA9IHRhcmdldHNbIGkgXTsKCQkJCXZhciBhdHRyaWJ1dGVOYW1lID0gJ21vcnBoVGFyZ2V0JyArIGk7CgoJCQkJaWYgKCBoYXNNb3JwaFBvc2l0aW9uICkgewoKCQkJCQkvLyBUaHJlZS5qcyBtb3JwaCBwb3NpdGlvbiBpcyBhYnNvbHV0ZSB2YWx1ZS4gVGhlIGZvcm11bGEgaXMKCQkJCQkvLyAgIGJhc2VQb3NpdGlvbgoJCQkJCS8vICAgICArIHdlaWdodDAgKiAoIG1vcnBoUG9zaXRpb24wIC0gYmFzZVBvc2l0aW9uICkKCQkJCQkvLyAgICAgKyB3ZWlnaHQxICogKCBtb3JwaFBvc2l0aW9uMSAtIGJhc2VQb3NpdGlvbiApCgkJCQkJLy8gICAgIC4uLgoJCQkJCS8vIHdoaWxlIHRoZSBnbFRGIG9uZSBpcyByZWxhdGl2ZQoJCQkJCS8vICAgYmFzZVBvc2l0aW9uCgkJCQkJLy8gICAgICsgd2VpZ2h0MCAqIGdsVEZtb3JwaFBvc2l0aW9uMAoJCQkJCS8vICAgICArIHdlaWdodDEgKiBnbFRGbW9ycGhQb3NpdGlvbjEKCQkJCQkvLyAgICAgLi4uCgkJCQkJLy8gdGhlbiB3ZSBuZWVkIHRvIGNvbnZlcnQgZnJvbSByZWxhdGl2ZSB0byBhYnNvbHV0ZSBoZXJlLgoKCQkJCQlpZiAoIHRhcmdldC5QT1NJVElPTiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJdmFyIHBvc2l0aW9uQXR0cmlidXRlID0gbW9ycGhQb3NpdGlvbnNbIGkgXTsKCQkJCQkJcG9zaXRpb25BdHRyaWJ1dGUubmFtZSA9IGF0dHJpYnV0ZU5hbWU7CgoJCQkJCQl2YXIgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJCQkJZm9yICggdmFyIGogPSAwLCBqbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBqIDwgamw7IGogKysgKSB7CgoJCQkJCQkJcG9zaXRpb25BdHRyaWJ1dGUuc2V0WFlaKAoJCQkJCQkJCWosCgkJCQkJCQkJcG9zaXRpb25BdHRyaWJ1dGUuZ2V0WCggaiApICsgcG9zaXRpb24uZ2V0WCggaiApLAoJCQkJCQkJCXBvc2l0aW9uQXR0cmlidXRlLmdldFkoIGogKSArIHBvc2l0aW9uLmdldFkoIGogKSwKCQkJCQkJCQlwb3NpdGlvbkF0dHJpYnV0ZS5nZXRaKCBqICkgKyBwb3NpdGlvbi5nZXRaKCBqICkKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBoYXNNb3JwaE5vcm1hbCApIHsKCgkJCQkJLy8gc2VlIHRhcmdldC5QT1NJVElPTidzIGNvbW1lbnQKCgkJCQkJaWYgKCB0YXJnZXQuTk9STUFMICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl2YXIgbm9ybWFsQXR0cmlidXRlID0gbW9ycGhOb3JtYWxzWyBpIF07CgkJCQkJCW5vcm1hbEF0dHJpYnV0ZS5uYW1lID0gYXR0cmlidXRlTmFtZTsKCgkJCQkJCXZhciBub3JtYWwgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbDsKCgkJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSBub3JtYWxBdHRyaWJ1dGUuY291bnQ7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKAoJCQkJCQkJCWosCgkJCQkJCQkJbm9ybWFsQXR0cmlidXRlLmdldFgoIGogKSArIG5vcm1hbC5nZXRYKCBqICksCgkJCQkJCQkJbm9ybWFsQXR0cmlidXRlLmdldFkoIGogKSArIG5vcm1hbC5nZXRZKCBqICksCgkJCQkJCQkJbm9ybWFsQXR0cmlidXRlLmdldFooIGogKSArIG5vcm1hbC5nZXRaKCBqICkKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gKSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gPSBtb3JwaFBvc2l0aW9uczsKCQkJaWYgKCBoYXNNb3JwaE5vcm1hbCApIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgPSBtb3JwaE5vcm1hbHM7CgoJCQlyZXR1cm4gZ2VvbWV0cnk7CgoJCX0gKTsKCgl9CgoJLyoqCgkgKiBAcGFyYW0ge1RIUkVFLk1lc2h9IG1lc2gKCSAqIEBwYXJhbSB7R0xURi5NZXNofSBtZXNoRGVmCgkgKi8KCWZ1bmN0aW9uIHVwZGF0ZU1vcnBoVGFyZ2V0cyggbWVzaCwgbWVzaERlZiApIHsKCgkJbWVzaC51cGRhdGVNb3JwaFRhcmdldHMoKTsKCgkJaWYgKCBtZXNoRGVmLndlaWdodHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtZXNoRGVmLndlaWdodHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJbWVzaC5tb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSA9IG1lc2hEZWYud2VpZ2h0c1sgaSBdOwoKCQkJfQoKCQl9CgoJCS8vIC5leHRyYXMgaGFzIHVzZXItZGVmaW5lZCBkYXRhLCBzbyBjaGVjayB0aGF0IC5leHRyYXMudGFyZ2V0TmFtZXMgaXMgYW4gYXJyYXkuCgkJaWYgKCBtZXNoRGVmLmV4dHJhcyAmJiBBcnJheS5pc0FycmF5KCBtZXNoRGVmLmV4dHJhcy50YXJnZXROYW1lcyApICkgewoKCQkJdmFyIHRhcmdldE5hbWVzID0gbWVzaERlZi5leHRyYXMudGFyZ2V0TmFtZXM7CgoJCQlpZiAoIG1lc2gubW9ycGhUYXJnZXRJbmZsdWVuY2VzLmxlbmd0aCA9PT0gdGFyZ2V0TmFtZXMubGVuZ3RoICkgewoKCQkJCW1lc2gubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0ge307CgoJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHRhcmdldE5hbWVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQltZXNoLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgdGFyZ2V0TmFtZXNbIGkgXSBdID0gaTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkdMVEZMb2FkZXI6IEludmFsaWQgZXh0cmFzLnRhcmdldE5hbWVzIGxlbmd0aC4gSWdub3JpbmcgbmFtZXMuJyApOwoKCQkJfQoKCQl9CgoJfQoJZnVuY3Rpb24gaXNPYmplY3RFcXVhbCggYSwgYiApIHsKCgkJaWYgKCBPYmplY3Qua2V5cyggYSApLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMoIGIgKS5sZW5ndGggKSByZXR1cm4gZmFsc2U7CgoJCWZvciAoIHZhciBrZXkgaW4gYSApIHsKCgkJCWlmICggYVsga2V5IF0gIT09IGJbIGtleSBdICkgcmV0dXJuIGZhbHNlOwoKCQl9CgoJCXJldHVybiB0cnVlOwoKCX0KCglmdW5jdGlvbiBjcmVhdGVQcmltaXRpdmVLZXkoIHByaW1pdGl2ZURlZiApIHsKCgkJdmFyIGRyYWNvRXh0ZW5zaW9uID0gcHJpbWl0aXZlRGVmLmV4dGVuc2lvbnMgJiYgcHJpbWl0aXZlRGVmLmV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX0RSQUNPX01FU0hfQ09NUFJFU1NJT04gXTsKCQl2YXIgZ2VvbWV0cnlLZXk7CgoJCWlmICggZHJhY29FeHRlbnNpb24gKSB7CgoJCQlnZW9tZXRyeUtleSA9ICdkcmFjbzonICsgZHJhY29FeHRlbnNpb24uYnVmZmVyVmlldwoJCQkJKyAnOicgKyBkcmFjb0V4dGVuc2lvbi5pbmRpY2VzCgkJCQkrICc6JyArIGNyZWF0ZUF0dHJpYnV0ZXNLZXkoIGRyYWNvRXh0ZW5zaW9uLmF0dHJpYnV0ZXMgKTsKCgkJfSBlbHNlIHsKCgkJCWdlb21ldHJ5S2V5ID0gcHJpbWl0aXZlRGVmLmluZGljZXMgKyAnOicgKyBjcmVhdGVBdHRyaWJ1dGVzS2V5KCBwcmltaXRpdmVEZWYuYXR0cmlidXRlcyApICsgJzonICsgcHJpbWl0aXZlRGVmLm1vZGU7CgoJCX0KCgkJcmV0dXJuIGdlb21ldHJ5S2V5OwoKCX0KCglmdW5jdGlvbiBjcmVhdGVBdHRyaWJ1dGVzS2V5KCBhdHRyaWJ1dGVzICkgewoKCQl2YXIgYXR0cmlidXRlc0tleSA9ICcnOwoKCQl2YXIga2V5cyA9IE9iamVjdC5rZXlzKCBhdHRyaWJ1dGVzICkuc29ydCgpOwoKCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0ga2V5cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWF0dHJpYnV0ZXNLZXkgKz0ga2V5c1sgaSBdICsgJzonICsgYXR0cmlidXRlc1sga2V5c1sgaSBdIF0gKyAnOyc7CgoJCX0KCgkJcmV0dXJuIGF0dHJpYnV0ZXNLZXk7CgoJfQoKCWZ1bmN0aW9uIGNsb25lQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUgKSB7CgoJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQl2YXIgY291bnQgPSBhdHRyaWJ1dGUuY291bnQ7CgkJCXZhciBpdGVtU2l6ZSA9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCQkJdmFyIGFycmF5ID0gYXR0cmlidXRlLmFycmF5LnNsaWNlKCAwLCBjb3VudCAqIGl0ZW1TaXplICk7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGogPSAwOyBpIDwgY291bnQ7ICsrIGkgKSB7CgoJCQkJYXJyYXlbIGogKysgXSA9IGF0dHJpYnV0ZS5nZXRYKCBpICk7CgkJCQlpZiAoIGl0ZW1TaXplID49IDIgKSBhcnJheVsgaiArKyBdID0gYXR0cmlidXRlLmdldFkoIGkgKTsKCQkJCWlmICggaXRlbVNpemUgPj0gMyApIGFycmF5WyBqICsrIF0gPSBhdHRyaWJ1dGUuZ2V0WiggaSApOwoJCQkJaWYgKCBpdGVtU2l6ZSA+PSA0ICkgYXJyYXlbIGogKysgXSA9IGF0dHJpYnV0ZS5nZXRXKCBpICk7CgoJCQl9CgoJCQlyZXR1cm4gbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoKCQl9CgoJCXJldHVybiBhdHRyaWJ1dGUuY2xvbmUoKTsKCgl9CgoJLyogR0xURiBQQVJTRVIgKi8KCglmdW5jdGlvbiBHTFRGUGFyc2VyKCBqc29uLCBleHRlbnNpb25zLCBvcHRpb25zICkgewoKCQl0aGlzLmpzb24gPSBqc29uIHx8IHt9OwoJCXRoaXMuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnMgfHwge307CgkJdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCgkJLy8gbG9hZGVyIG9iamVjdCBjYWNoZQoJCXRoaXMuY2FjaGUgPSBuZXcgR0xURlJlZ2lzdHJ5KCk7CgoJCS8vIEJ1ZmZlckdlb21ldHJ5IGNhY2hpbmcKCQl0aGlzLnByaW1pdGl2ZUNhY2hlID0ge307CgoJCXRoaXMudGV4dHVyZUxvYWRlciA9IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCB0aGlzLm9wdGlvbnMubWFuYWdlciApOwoJCXRoaXMudGV4dHVyZUxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5vcHRpb25zLmNyb3NzT3JpZ2luICk7CgoJCXRoaXMuZmlsZUxvYWRlciA9IG5ldyBUSFJFRS5GaWxlTG9hZGVyKCB0aGlzLm9wdGlvbnMubWFuYWdlciApOwoJCXRoaXMuZmlsZUxvYWRlci5zZXRSZXNwb25zZVR5cGUoICdhcnJheWJ1ZmZlcicgKTsKCgl9CgoJR0xURlBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoIG9uTG9hZCwgb25FcnJvciApIHsKCgkJdmFyIHBhcnNlciA9IHRoaXM7CgkJdmFyIGpzb24gPSB0aGlzLmpzb247CgkJdmFyIGV4dGVuc2lvbnMgPSB0aGlzLmV4dGVuc2lvbnM7CgoJCS8vIENsZWFyIHRoZSBsb2FkZXIgY2FjaGUKCQl0aGlzLmNhY2hlLnJlbW92ZUFsbCgpOwoKCQkvLyBNYXJrIHRoZSBzcGVjaWFsIG5vZGVzL21lc2hlcyBpbiBqc29uIGZvciBlZmZpY2llbnQgcGFyc2UKCQl0aGlzLm1hcmtEZWZzKCk7CgoJCVByb21pc2UuYWxsKCBbCgoJCQl0aGlzLmdldERlcGVuZGVuY2llcyggJ3NjZW5lJyApLAoJCQl0aGlzLmdldERlcGVuZGVuY2llcyggJ2FuaW1hdGlvbicgKSwKCQkJdGhpcy5nZXREZXBlbmRlbmNpZXMoICdjYW1lcmEnICksCgoJCV0gKS50aGVuKCBmdW5jdGlvbiAoIGRlcGVuZGVuY2llcyApIHsKCgkJCXZhciByZXN1bHQgPSB7CgkJCQlzY2VuZTogZGVwZW5kZW5jaWVzWyAwIF1bIGpzb24uc2NlbmUgfHwgMCBdLAoJCQkJc2NlbmVzOiBkZXBlbmRlbmNpZXNbIDAgXSwKCQkJCWFuaW1hdGlvbnM6IGRlcGVuZGVuY2llc1sgMSBdLAoJCQkJY2FtZXJhczogZGVwZW5kZW5jaWVzWyAyIF0sCgkJCQlhc3NldDoganNvbi5hc3NldCwKCQkJCXBhcnNlcjogcGFyc2VyLAoJCQkJdXNlckRhdGE6IHt9CgkJCX07CgoJCQlhZGRVbmtub3duRXh0ZW5zaW9uc1RvVXNlckRhdGEoIGV4dGVuc2lvbnMsIHJlc3VsdCwganNvbiApOwoKCQkJb25Mb2FkKCByZXN1bHQgKTsKCgkJfSApLmNhdGNoKCBvbkVycm9yICk7CgoJfTsKCgkvKioKCSAqIE1hcmtzIHRoZSBzcGVjaWFsIG5vZGVzL21lc2hlcyBpbiBqc29uIGZvciBlZmZpY2llbnQgcGFyc2UuCgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLm1hcmtEZWZzID0gZnVuY3Rpb24gKCkgewoKCQl2YXIgbm9kZURlZnMgPSB0aGlzLmpzb24ubm9kZXMgfHwgW107CgkJdmFyIHNraW5EZWZzID0gdGhpcy5qc29uLnNraW5zIHx8IFtdOwoJCXZhciBtZXNoRGVmcyA9IHRoaXMuanNvbi5tZXNoZXMgfHwgW107CgoJCXZhciBtZXNoUmVmZXJlbmNlcyA9IHt9OwoJCXZhciBtZXNoVXNlcyA9IHt9OwoKCQkvLyBOb3RoaW5nIGluIHRoZSBub2RlIGRlZmluaXRpb24gaW5kaWNhdGVzIHdoZXRoZXIgaXQgaXMgYSBCb25lIG9yIGFuCgkJLy8gT2JqZWN0M0QuIFVzZSB0aGUgc2tpbnMnIGpvaW50IHJlZmVyZW5jZXMgdG8gbWFyayBib25lcy4KCQlmb3IgKCB2YXIgc2tpbkluZGV4ID0gMCwgc2tpbkxlbmd0aCA9IHNraW5EZWZzLmxlbmd0aDsgc2tpbkluZGV4IDwgc2tpbkxlbmd0aDsgc2tpbkluZGV4ICsrICkgewoKCQkJdmFyIGpvaW50cyA9IHNraW5EZWZzWyBza2luSW5kZXggXS5qb2ludHM7CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gam9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCW5vZGVEZWZzWyBqb2ludHNbIGkgXSBdLmlzQm9uZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJLy8gTWVzaGVzIGNhbiAoYW5kIHNob3VsZCkgYmUgcmV1c2VkIGJ5IG11bHRpcGxlIG5vZGVzIGluIGEgZ2xURiBhc3NldC4gVG8KCQkvLyBhdm9pZCBoYXZpbmcgbW9yZSB0aGFuIG9uZSBUSFJFRS5NZXNoIHdpdGggdGhlIHNhbWUgbmFtZSwgY291bnQKCQkvLyByZWZlcmVuY2VzIGFuZCByZW5hbWUgaW5zdGFuY2VzIGJlbG93LgoJCS8vCgkJLy8gRXhhbXBsZTogQ2VzaXVtTWlsa1RydWNrIHNhbXBsZSBtb2RlbCByZXVzZXMgIldoZWVsIiBtZXNoZXMuCgkJZm9yICggdmFyIG5vZGVJbmRleCA9IDAsIG5vZGVMZW5ndGggPSBub2RlRGVmcy5sZW5ndGg7IG5vZGVJbmRleCA8IG5vZGVMZW5ndGg7IG5vZGVJbmRleCArKyApIHsKCgkJCXZhciBub2RlRGVmID0gbm9kZURlZnNbIG5vZGVJbmRleCBdOwoKCQkJaWYgKCBub2RlRGVmLm1lc2ggIT09IHVuZGVmaW5lZCApIHsKCgkJCQlpZiAoIG1lc2hSZWZlcmVuY2VzWyBub2RlRGVmLm1lc2ggXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQltZXNoUmVmZXJlbmNlc1sgbm9kZURlZi5tZXNoIF0gPSBtZXNoVXNlc1sgbm9kZURlZi5tZXNoIF0gPSAwOwoKCQkJCX0KCgkJCQltZXNoUmVmZXJlbmNlc1sgbm9kZURlZi5tZXNoIF0gKys7CgoJCQkJLy8gTm90aGluZyBpbiB0aGUgbWVzaCBkZWZpbml0aW9uIGluZGljYXRlcyB3aGV0aGVyIGl0IGlzCgkJCQkvLyBhIFNraW5uZWRNZXNoIG9yIE1lc2guIFVzZSB0aGUgbm9kZSdzIG1lc2ggcmVmZXJlbmNlCgkJCQkvLyB0byBtYXJrIFNraW5uZWRNZXNoIGlmIG5vZGUgaGFzIHNraW4uCgkJCQlpZiAoIG5vZGVEZWYuc2tpbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQltZXNoRGVmc1sgbm9kZURlZi5tZXNoIF0uaXNTa2lubmVkTWVzaCA9IHRydWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXRoaXMuanNvbi5tZXNoUmVmZXJlbmNlcyA9IG1lc2hSZWZlcmVuY2VzOwoJCXRoaXMuanNvbi5tZXNoVXNlcyA9IG1lc2hVc2VzOwoKCX07CgoJLyoqCgkgKiBSZXF1ZXN0cyB0aGUgc3BlY2lmaWVkIGRlcGVuZGVuY3kgYXN5bmNocm9ub3VzbHksIHdpdGggY2FjaGluZy4KCSAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlCgkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuT2JqZWN0M0R8VEhSRUUuTWF0ZXJpYWx8VEhSRUUuVGV4dHVyZXxUSFJFRS5BbmltYXRpb25DbGlwfEFycmF5QnVmZmVyfE9iamVjdD59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmdldERlcGVuZGVuY3kgPSBmdW5jdGlvbiAoIHR5cGUsIGluZGV4ICkgewoKCQl2YXIgY2FjaGVLZXkgPSB0eXBlICsgJzonICsgaW5kZXg7CgkJdmFyIGRlcGVuZGVuY3kgPSB0aGlzLmNhY2hlLmdldCggY2FjaGVLZXkgKTsKCgkJaWYgKCAhIGRlcGVuZGVuY3kgKSB7CgoJCQlzd2l0Y2ggKCB0eXBlICkgewoKCQkJCWNhc2UgJ3NjZW5lJzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5sb2FkU2NlbmUoIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbm9kZSc6CgkJCQkJZGVwZW5kZW5jeSA9IHRoaXMubG9hZE5vZGUoIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWVzaCc6CgkJCQkJZGVwZW5kZW5jeSA9IHRoaXMubG9hZE1lc2goIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnYWNjZXNzb3InOgoJCQkJCWRlcGVuZGVuY3kgPSB0aGlzLmxvYWRBY2Nlc3NvciggaW5kZXggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdidWZmZXJWaWV3JzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5sb2FkQnVmZmVyVmlldyggaW5kZXggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdidWZmZXInOgoJCQkJCWRlcGVuZGVuY3kgPSB0aGlzLmxvYWRCdWZmZXIoIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWF0ZXJpYWwnOgoJCQkJCWRlcGVuZGVuY3kgPSB0aGlzLmxvYWRNYXRlcmlhbCggaW5kZXggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICd0ZXh0dXJlJzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5sb2FkVGV4dHVyZSggaW5kZXggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdza2luJzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5sb2FkU2tpbiggaW5kZXggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdhbmltYXRpb24nOgoJCQkJCWRlcGVuZGVuY3kgPSB0aGlzLmxvYWRBbmltYXRpb24oIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnY2FtZXJhJzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5sb2FkQ2FtZXJhKCBpbmRleCApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ2xpZ2h0JzoKCQkJCQlkZXBlbmRlbmN5ID0gdGhpcy5leHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9MSUdIVFNfUFVOQ1RVQUwgXS5sb2FkTGlnaHQoIGluZGV4ICk7CgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdVbmtub3duIHR5cGU6ICcgKyB0eXBlICk7CgoJCQl9CgoJCQl0aGlzLmNhY2hlLmFkZCggY2FjaGVLZXksIGRlcGVuZGVuY3kgKTsKCgkJfQoKCQlyZXR1cm4gZGVwZW5kZW5jeTsKCgl9OwoKCS8qKgoJICogUmVxdWVzdHMgYWxsIGRlcGVuZGVuY2llcyBvZiB0aGUgc3BlY2lmaWVkIHR5cGUgYXN5bmNocm9ub3VzbHksIHdpdGggY2FjaGluZy4KCSAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlCgkgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PE9iamVjdD4+fQoJICovCglHTFRGUGFyc2VyLnByb3RvdHlwZS5nZXREZXBlbmRlbmNpZXMgPSBmdW5jdGlvbiAoIHR5cGUgKSB7CgoJCXZhciBkZXBlbmRlbmNpZXMgPSB0aGlzLmNhY2hlLmdldCggdHlwZSApOwoKCQlpZiAoICEgZGVwZW5kZW5jaWVzICkgewoKCQkJdmFyIHBhcnNlciA9IHRoaXM7CgkJCXZhciBkZWZzID0gdGhpcy5qc29uWyB0eXBlICsgKCB0eXBlID09PSAnbWVzaCcgPyAnZXMnIDogJ3MnICkgXSB8fCBbXTsKCgkJCWRlcGVuZGVuY2llcyA9IFByb21pc2UuYWxsKCBkZWZzLm1hcCggZnVuY3Rpb24gKCBkZWYsIGluZGV4ICkgewoKCQkJCXJldHVybiBwYXJzZXIuZ2V0RGVwZW5kZW5jeSggdHlwZSwgaW5kZXggKTsKCgkJCX0gKSApOwoKCQkJdGhpcy5jYWNoZS5hZGQoIHR5cGUsIGRlcGVuZGVuY2llcyApOwoKCQl9CgoJCXJldHVybiBkZXBlbmRlbmNpZXM7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjYnVmZmVycy1hbmQtYnVmZmVyLXZpZXdzCgkgKiBAcGFyYW0ge251bWJlcn0gYnVmZmVySW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXlCdWZmZXI+fQoJICovCglHTFRGUGFyc2VyLnByb3RvdHlwZS5sb2FkQnVmZmVyID0gZnVuY3Rpb24gKCBidWZmZXJJbmRleCApIHsKCgkJdmFyIGJ1ZmZlckRlZiA9IHRoaXMuanNvbi5idWZmZXJzWyBidWZmZXJJbmRleCBdOwoJCXZhciBsb2FkZXIgPSB0aGlzLmZpbGVMb2FkZXI7CgoJCWlmICggYnVmZmVyRGVmLnR5cGUgJiYgYnVmZmVyRGVmLnR5cGUgIT09ICdhcnJheWJ1ZmZlcicgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5HTFRGTG9hZGVyOiAnICsgYnVmZmVyRGVmLnR5cGUgKyAnIGJ1ZmZlciB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuJyApOwoKCQl9CgoJCS8vIElmIHByZXNlbnQsIEdMQiBjb250YWluZXIgaXMgcmVxdWlyZWQgdG8gYmUgdGhlIGZpcnN0IGJ1ZmZlci4KCQlpZiAoIGJ1ZmZlckRlZi51cmkgPT09IHVuZGVmaW5lZCAmJiBidWZmZXJJbmRleCA9PT0gMCApIHsKCgkJCXJldHVybiBQcm9taXNlLnJlc29sdmUoIHRoaXMuZXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5LSFJfQklOQVJZX0dMVEYgXS5ib2R5ICk7CgoJCX0KCgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCXJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7CgoJCQlsb2FkZXIubG9hZCggcmVzb2x2ZVVSTCggYnVmZmVyRGVmLnVyaSwgb3B0aW9ucy5wYXRoICksIHJlc29sdmUsIHVuZGVmaW5lZCwgZnVuY3Rpb24gKCkgewoKCQkJCXJlamVjdCggbmV3IEVycm9yKCAnVEhSRUUuR0xURkxvYWRlcjogRmFpbGVkIHRvIGxvYWQgYnVmZmVyICInICsgYnVmZmVyRGVmLnVyaSArICciLicgKSApOwoKCQkJfSApOwoKCQl9ICk7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjYnVmZmVycy1hbmQtYnVmZmVyLXZpZXdzCgkgKiBAcGFyYW0ge251bWJlcn0gYnVmZmVyVmlld0luZGV4CgkgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5QnVmZmVyPn0KCSAqLwoJR0xURlBhcnNlci5wcm90b3R5cGUubG9hZEJ1ZmZlclZpZXcgPSBmdW5jdGlvbiAoIGJ1ZmZlclZpZXdJbmRleCApIHsKCgkJdmFyIGJ1ZmZlclZpZXdEZWYgPSB0aGlzLmpzb24uYnVmZmVyVmlld3NbIGJ1ZmZlclZpZXdJbmRleCBdOwoKCQlyZXR1cm4gdGhpcy5nZXREZXBlbmRlbmN5KCAnYnVmZmVyJywgYnVmZmVyVmlld0RlZi5idWZmZXIgKS50aGVuKCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCXZhciBieXRlTGVuZ3RoID0gYnVmZmVyVmlld0RlZi5ieXRlTGVuZ3RoIHx8IDA7CgkJCXZhciBieXRlT2Zmc2V0ID0gYnVmZmVyVmlld0RlZi5ieXRlT2Zmc2V0IHx8IDA7CgkJCXJldHVybiBidWZmZXIuc2xpY2UoIGJ5dGVPZmZzZXQsIGJ5dGVPZmZzZXQgKyBieXRlTGVuZ3RoICk7CgoJCX0gKTsKCgl9OwoKCS8qKgoJICogU3BlY2lmaWNhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL2Jsb2IvbWFzdGVyL3NwZWNpZmljYXRpb24vMi4wL1JFQURNRS5tZCNhY2Nlc3NvcnMKCSAqIEBwYXJhbSB7bnVtYmVyfSBhY2Nlc3NvckluZGV4CgkgKiBAcmV0dXJuIHtQcm9taXNlPFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZXxUSFJFRS5JbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZT59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRBY2Nlc3NvciA9IGZ1bmN0aW9uICggYWNjZXNzb3JJbmRleCApIHsKCgkJdmFyIHBhcnNlciA9IHRoaXM7CgkJdmFyIGpzb24gPSB0aGlzLmpzb247CgoJCXZhciBhY2Nlc3NvckRlZiA9IHRoaXMuanNvbi5hY2Nlc3NvcnNbIGFjY2Vzc29ySW5kZXggXTsKCgkJaWYgKCBhY2Nlc3NvckRlZi5idWZmZXJWaWV3ID09PSB1bmRlZmluZWQgJiYgYWNjZXNzb3JEZWYuc3BhcnNlID09PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBJZ25vcmUgZW1wdHkgYWNjZXNzb3JzLCB3aGljaCBtYXkgYmUgdXNlZCB0byBkZWNsYXJlIHJ1bnRpbWUKCQkJLy8gaW5mb3JtYXRpb24gYWJvdXQgYXR0cmlidXRlcyBjb21pbmcgZnJvbSBhbm90aGVyIHNvdXJjZSAoZS5nLiBEcmFjbwoJCQkvLyBjb21wcmVzc2lvbiBleHRlbnNpb24pLgoJCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCBudWxsICk7CgoJCX0KCgkJdmFyIHBlbmRpbmdCdWZmZXJWaWV3cyA9IFtdOwoKCQlpZiAoIGFjY2Vzc29yRGVmLmJ1ZmZlclZpZXcgIT09IHVuZGVmaW5lZCApIHsKCgkJCXBlbmRpbmdCdWZmZXJWaWV3cy5wdXNoKCB0aGlzLmdldERlcGVuZGVuY3koICdidWZmZXJWaWV3JywgYWNjZXNzb3JEZWYuYnVmZmVyVmlldyApICk7CgoJCX0gZWxzZSB7CgoJCQlwZW5kaW5nQnVmZmVyVmlld3MucHVzaCggbnVsbCApOwoKCQl9CgoJCWlmICggYWNjZXNzb3JEZWYuc3BhcnNlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlwZW5kaW5nQnVmZmVyVmlld3MucHVzaCggdGhpcy5nZXREZXBlbmRlbmN5KCAnYnVmZmVyVmlldycsIGFjY2Vzc29yRGVmLnNwYXJzZS5pbmRpY2VzLmJ1ZmZlclZpZXcgKSApOwoJCQlwZW5kaW5nQnVmZmVyVmlld3MucHVzaCggdGhpcy5nZXREZXBlbmRlbmN5KCAnYnVmZmVyVmlldycsIGFjY2Vzc29yRGVmLnNwYXJzZS52YWx1ZXMuYnVmZmVyVmlldyApICk7CgoJCX0KCgkJcmV0dXJuIFByb21pc2UuYWxsKCBwZW5kaW5nQnVmZmVyVmlld3MgKS50aGVuKCBmdW5jdGlvbiAoIGJ1ZmZlclZpZXdzICkgewoKCQkJdmFyIGJ1ZmZlclZpZXcgPSBidWZmZXJWaWV3c1sgMCBdOwoKCQkJdmFyIGl0ZW1TaXplID0gV0VCR0xfVFlQRV9TSVpFU1sgYWNjZXNzb3JEZWYudHlwZSBdOwoJCQl2YXIgVHlwZWRBcnJheSA9IFdFQkdMX0NPTVBPTkVOVF9UWVBFU1sgYWNjZXNzb3JEZWYuY29tcG9uZW50VHlwZSBdOwoKCQkJLy8gRm9yIFZFQzM6IGl0ZW1TaXplIGlzIDMsIGVsZW1lbnRCeXRlcyBpcyA0LCBpdGVtQnl0ZXMgaXMgMTIuCgkJCXZhciBlbGVtZW50Qnl0ZXMgPSBUeXBlZEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwoJCQl2YXIgaXRlbUJ5dGVzID0gZWxlbWVudEJ5dGVzICogaXRlbVNpemU7CgkJCXZhciBieXRlT2Zmc2V0ID0gYWNjZXNzb3JEZWYuYnl0ZU9mZnNldCB8fCAwOwoJCQl2YXIgYnl0ZVN0cmlkZSA9IGFjY2Vzc29yRGVmLmJ1ZmZlclZpZXcgIT09IHVuZGVmaW5lZCA/IGpzb24uYnVmZmVyVmlld3NbIGFjY2Vzc29yRGVmLmJ1ZmZlclZpZXcgXS5ieXRlU3RyaWRlIDogdW5kZWZpbmVkOwoJCQl2YXIgbm9ybWFsaXplZCA9IGFjY2Vzc29yRGVmLm5vcm1hbGl6ZWQgPT09IHRydWU7CgkJCXZhciBhcnJheSwgYnVmZmVyQXR0cmlidXRlOwoKCQkJLy8gVGhlIGJ1ZmZlciBpcyBub3QgaW50ZXJsZWF2ZWQgaWYgdGhlIHN0cmlkZSBpcyB0aGUgaXRlbSBzaXplIGluIGJ5dGVzLgoJCQlpZiAoIGJ5dGVTdHJpZGUgJiYgYnl0ZVN0cmlkZSAhPT0gaXRlbUJ5dGVzICkgewoKCQkJCXZhciBpYkNhY2hlS2V5ID0gJ0ludGVybGVhdmVkQnVmZmVyOicgKyBhY2Nlc3NvckRlZi5idWZmZXJWaWV3ICsgJzonICsgYWNjZXNzb3JEZWYuY29tcG9uZW50VHlwZTsKCQkJCXZhciBpYiA9IHBhcnNlci5jYWNoZS5nZXQoIGliQ2FjaGVLZXkgKTsKCgkJCQlpZiAoICEgaWIgKSB7CgoJCQkJCS8vIFVzZSB0aGUgZnVsbCBidWZmZXIgaWYgaXQncyBpbnRlcmxlYXZlZC4KCQkJCQlhcnJheSA9IG5ldyBUeXBlZEFycmF5KCBidWZmZXJWaWV3ICk7CgoJCQkJCS8vIEludGVnZXIgcGFyYW1ldGVycyB0byBJQi9JQkEgYXJlIGluIGFycmF5IGVsZW1lbnRzLCBub3QgYnl0ZXMuCgkJCQkJaWIgPSBuZXcgVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXIoIGFycmF5LCBieXRlU3RyaWRlIC8gZWxlbWVudEJ5dGVzICk7CgoJCQkJCXBhcnNlci5jYWNoZS5hZGQoIGliQ2FjaGVLZXksIGliICk7CgoJCQkJfQoKCQkJCWJ1ZmZlckF0dHJpYnV0ZSA9IG5ldyBUSFJFRS5JbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaWIsIGl0ZW1TaXplLCBieXRlT2Zmc2V0IC8gZWxlbWVudEJ5dGVzLCBub3JtYWxpemVkICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggYnVmZmVyVmlldyA9PT0gbnVsbCApIHsKCgkJCQkJYXJyYXkgPSBuZXcgVHlwZWRBcnJheSggYWNjZXNzb3JEZWYuY291bnQgKiBpdGVtU2l6ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWFycmF5ID0gbmV3IFR5cGVkQXJyYXkoIGJ1ZmZlclZpZXcsIGJ5dGVPZmZzZXQsIGFjY2Vzc29yRGVmLmNvdW50ICogaXRlbVNpemUgKTsKCgkJCQl9CgoJCQkJYnVmZmVyQXR0cmlidXRlID0gbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZSggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCQl9CgoJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vS2hyb25vc0dyb3VwL2dsVEYvYmxvYi9tYXN0ZXIvc3BlY2lmaWNhdGlvbi8yLjAvUkVBRE1FLm1kI3NwYXJzZS1hY2Nlc3NvcnMKCQkJaWYgKCBhY2Nlc3NvckRlZi5zcGFyc2UgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl2YXIgaXRlbVNpemVJbmRpY2VzID0gV0VCR0xfVFlQRV9TSVpFUy5TQ0FMQVI7CgkJCQl2YXIgVHlwZWRBcnJheUluZGljZXMgPSBXRUJHTF9DT01QT05FTlRfVFlQRVNbIGFjY2Vzc29yRGVmLnNwYXJzZS5pbmRpY2VzLmNvbXBvbmVudFR5cGUgXTsKCgkJCQl2YXIgYnl0ZU9mZnNldEluZGljZXMgPSBhY2Nlc3NvckRlZi5zcGFyc2UuaW5kaWNlcy5ieXRlT2Zmc2V0IHx8IDA7CgkJCQl2YXIgYnl0ZU9mZnNldFZhbHVlcyA9IGFjY2Vzc29yRGVmLnNwYXJzZS52YWx1ZXMuYnl0ZU9mZnNldCB8fCAwOwoKCQkJCXZhciBzcGFyc2VJbmRpY2VzID0gbmV3IFR5cGVkQXJyYXlJbmRpY2VzKCBidWZmZXJWaWV3c1sgMSBdLCBieXRlT2Zmc2V0SW5kaWNlcywgYWNjZXNzb3JEZWYuc3BhcnNlLmNvdW50ICogaXRlbVNpemVJbmRpY2VzICk7CgkJCQl2YXIgc3BhcnNlVmFsdWVzID0gbmV3IFR5cGVkQXJyYXkoIGJ1ZmZlclZpZXdzWyAyIF0sIGJ5dGVPZmZzZXRWYWx1ZXMsIGFjY2Vzc29yRGVmLnNwYXJzZS5jb3VudCAqIGl0ZW1TaXplICk7CgoJCQkJaWYgKCBidWZmZXJWaWV3ICE9PSBudWxsICkgewoKCQkJCQkvLyBBdm9pZCBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsIEFycmF5QnVmZmVyLCBpZiB0aGUgYnVmZmVyVmlldyB3YXNuJ3QgaW5pdGlhbGl6ZWQgd2l0aCB6ZXJvZXMuCgkJCQkJYnVmZmVyQXR0cmlidXRlLnNldEFycmF5KCBidWZmZXJBdHRyaWJ1dGUuYXJyYXkuc2xpY2UoKSApOwoKCQkJCX0KCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gc3BhcnNlSW5kaWNlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdmFyIGluZGV4ID0gc3BhcnNlSW5kaWNlc1sgaSBdOwoKCQkJCQlidWZmZXJBdHRyaWJ1dGUuc2V0WCggaW5kZXgsIHNwYXJzZVZhbHVlc1sgaSAqIGl0ZW1TaXplIF0gKTsKCQkJCQlpZiAoIGl0ZW1TaXplID49IDIgKSBidWZmZXJBdHRyaWJ1dGUuc2V0WSggaW5kZXgsIHNwYXJzZVZhbHVlc1sgaSAqIGl0ZW1TaXplICsgMSBdICk7CgkJCQkJaWYgKCBpdGVtU2l6ZSA+PSAzICkgYnVmZmVyQXR0cmlidXRlLnNldFooIGluZGV4LCBzcGFyc2VWYWx1ZXNbIGkgKiBpdGVtU2l6ZSArIDIgXSApOwoJCQkJCWlmICggaXRlbVNpemUgPj0gNCApIGJ1ZmZlckF0dHJpYnV0ZS5zZXRXKCBpbmRleCwgc3BhcnNlVmFsdWVzWyBpICogaXRlbVNpemUgKyAzIF0gKTsKCQkJCQlpZiAoIGl0ZW1TaXplID49IDUgKSB0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5HTFRGTG9hZGVyOiBVbnN1cHBvcnRlZCBpdGVtU2l6ZSBpbiBzcGFyc2UgQnVmZmVyQXR0cmlidXRlLicgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gYnVmZmVyQXR0cmlidXRlOwoKCQl9ICk7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi90cmVlL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMCN0ZXh0dXJlcwoJICogQHBhcmFtIHtudW1iZXJ9IHRleHR1cmVJbmRleAoJICogQHJldHVybiB7UHJvbWlzZTxUSFJFRS5UZXh0dXJlPn0KCSAqLwoJR0xURlBhcnNlci5wcm90b3R5cGUubG9hZFRleHR1cmUgPSBmdW5jdGlvbiAoIHRleHR1cmVJbmRleCApIHsKCgkJdmFyIHBhcnNlciA9IHRoaXM7CgkJdmFyIGpzb24gPSB0aGlzLmpzb247CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgkJdmFyIHRleHR1cmVMb2FkZXIgPSB0aGlzLnRleHR1cmVMb2FkZXI7CgoJCXZhciBVUkwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7CgoJCXZhciB0ZXh0dXJlRGVmID0ganNvbi50ZXh0dXJlc1sgdGV4dHVyZUluZGV4IF07CgoJCXZhciB0ZXh0dXJlRXh0ZW5zaW9ucyA9IHRleHR1cmVEZWYuZXh0ZW5zaW9ucyB8fCB7fTsKCgkJdmFyIHNvdXJjZTsKCgkJaWYgKCB0ZXh0dXJlRXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5NU0ZUX1RFWFRVUkVfRERTIF0gKSB7CgoJCQlzb3VyY2UgPSBqc29uLmltYWdlc1sgdGV4dHVyZUV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuTVNGVF9URVhUVVJFX0REUyBdLnNvdXJjZSBdOwoKCQl9IGVsc2UgewoKCQkJc291cmNlID0ganNvbi5pbWFnZXNbIHRleHR1cmVEZWYuc291cmNlIF07CgoJCX0KCgkJdmFyIHNvdXJjZVVSSSA9IHNvdXJjZS51cmk7CgkJdmFyIGlzT2JqZWN0VVJMID0gZmFsc2U7CgoJCWlmICggc291cmNlLmJ1ZmZlclZpZXcgIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIExvYWQgYmluYXJ5IGltYWdlIGRhdGEgZnJvbSBidWZmZXJWaWV3LCBpZiBwcm92aWRlZC4KCgkJCXNvdXJjZVVSSSA9IHBhcnNlci5nZXREZXBlbmRlbmN5KCAnYnVmZmVyVmlldycsIHNvdXJjZS5idWZmZXJWaWV3ICkudGhlbiggZnVuY3Rpb24gKCBidWZmZXJWaWV3ICkgewoKCQkJCWlzT2JqZWN0VVJMID0gdHJ1ZTsKCQkJCXZhciBibG9iID0gbmV3IEJsb2IoIFsgYnVmZmVyVmlldyBdLCB7IHR5cGU6IHNvdXJjZS5taW1lVHlwZSB9ICk7CgkJCQlzb3VyY2VVUkkgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKCBibG9iICk7CgkJCQlyZXR1cm4gc291cmNlVVJJOwoKCQkJfSApOwoKCQl9CgoJCXJldHVybiBQcm9taXNlLnJlc29sdmUoIHNvdXJjZVVSSSApLnRoZW4oIGZ1bmN0aW9uICggc291cmNlVVJJICkgewoKCQkJLy8gTG9hZCBUZXh0dXJlIHJlc291cmNlLgoKCQkJdmFyIGxvYWRlciA9IFRIUkVFLkxvYWRlci5IYW5kbGVycy5nZXQoIHNvdXJjZVVSSSApOwoKCQkJaWYgKCAhIGxvYWRlciApIHsKCgkJCQlsb2FkZXIgPSB0ZXh0dXJlRXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5NU0ZUX1RFWFRVUkVfRERTIF0KCQkJCQk/IHBhcnNlci5leHRlbnNpb25zWyBFWFRFTlNJT05TLk1TRlRfVEVYVFVSRV9ERFMgXS5kZHNMb2FkZXIKCQkJCQk6IHRleHR1cmVMb2FkZXI7CgoJCQl9CgoJCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJCWxvYWRlci5sb2FkKCByZXNvbHZlVVJMKCBzb3VyY2VVUkksIG9wdGlvbnMucGF0aCApLCByZXNvbHZlLCB1bmRlZmluZWQsIHJlamVjdCApOwoKCQkJfSApOwoKCQl9ICkudGhlbiggZnVuY3Rpb24gKCB0ZXh0dXJlICkgewoKCQkJLy8gQ2xlYW4gdXAgcmVzb3VyY2VzIGFuZCBjb25maWd1cmUgVGV4dHVyZS4KCgkJCWlmICggaXNPYmplY3RVUkwgPT09IHRydWUgKSB7CgoJCQkJVVJMLnJldm9rZU9iamVjdFVSTCggc291cmNlVVJJICk7CgoJCQl9CgoJCQl0ZXh0dXJlLmZsaXBZID0gZmFsc2U7CgoJCQlpZiAoIHRleHR1cmVEZWYubmFtZSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5uYW1lID0gdGV4dHVyZURlZi5uYW1lOwoKCQkJLy8gSWdub3JlIHVua25vd24gbWltZSB0eXBlcywgbGlrZSBERFMgZmlsZXMuCgkJCWlmICggc291cmNlLm1pbWVUeXBlIGluIE1JTUVfVFlQRV9GT1JNQVRTICkgewoKCQkJCXRleHR1cmUuZm9ybWF0ID0gTUlNRV9UWVBFX0ZPUk1BVFNbIHNvdXJjZS5taW1lVHlwZSBdOwoKCQkJfQoKCQkJdmFyIHNhbXBsZXJzID0ganNvbi5zYW1wbGVycyB8fCB7fTsKCQkJdmFyIHNhbXBsZXIgPSBzYW1wbGVyc1sgdGV4dHVyZURlZi5zYW1wbGVyIF0gfHwge307CgoJCQl0ZXh0dXJlLm1hZ0ZpbHRlciA9IFdFQkdMX0ZJTFRFUlNbIHNhbXBsZXIubWFnRmlsdGVyIF0gfHwgVEhSRUUuTGluZWFyRmlsdGVyOwoJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IFdFQkdMX0ZJTFRFUlNbIHNhbXBsZXIubWluRmlsdGVyIF0gfHwgVEhSRUUuTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyOwoJCQl0ZXh0dXJlLndyYXBTID0gV0VCR0xfV1JBUFBJTkdTWyBzYW1wbGVyLndyYXBTIF0gfHwgVEhSRUUuUmVwZWF0V3JhcHBpbmc7CgkJCXRleHR1cmUud3JhcFQgPSBXRUJHTF9XUkFQUElOR1NbIHNhbXBsZXIud3JhcFQgXSB8fCBUSFJFRS5SZXBlYXRXcmFwcGluZzsKCgkJCXJldHVybiB0ZXh0dXJlOwoKCQl9ICk7CgoJfTsKCgkvKioKCSAqIEFzeW5jaHJvbm91c2x5IGFzc2lnbnMgYSB0ZXh0dXJlIHRvIHRoZSBnaXZlbiBtYXRlcmlhbCBwYXJhbWV0ZXJzLgoJICogQHBhcmFtIHtPYmplY3R9IG1hdGVyaWFsUGFyYW1zCgkgKiBAcGFyYW0ge3N0cmluZ30gbWFwTmFtZQoJICogQHBhcmFtIHtPYmplY3R9IG1hcERlZgoJICogQHJldHVybiB7UHJvbWlzZX0KCSAqLwoJR0xURlBhcnNlci5wcm90b3R5cGUuYXNzaWduVGV4dHVyZSA9IGZ1bmN0aW9uICggbWF0ZXJpYWxQYXJhbXMsIG1hcE5hbWUsIG1hcERlZiApIHsKCgkJdmFyIHBhcnNlciA9IHRoaXM7CgoJCXJldHVybiB0aGlzLmdldERlcGVuZGVuY3koICd0ZXh0dXJlJywgbWFwRGVmLmluZGV4ICkudGhlbiggZnVuY3Rpb24gKCB0ZXh0dXJlICkgewoKCQkJc3dpdGNoICggbWFwTmFtZSApIHsKCgkJCQljYXNlICdhb01hcCc6CgkJCQljYXNlICdlbWlzc2l2ZU1hcCc6CgkJCQljYXNlICdtZXRhbG5lc3NNYXAnOgoJCQkJY2FzZSAnbm9ybWFsTWFwJzoKCQkJCWNhc2UgJ3JvdWdobmVzc01hcCc6CgkJCQkJdGV4dHVyZS5mb3JtYXQgPSBUSFJFRS5SR0JGb3JtYXQ7CgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlpZiAoIHBhcnNlci5leHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9URVhUVVJFX1RSQU5TRk9STSBdICkgewoKCQkJCXZhciB0cmFuc2Zvcm0gPSBtYXBEZWYuZXh0ZW5zaW9ucyAhPT0gdW5kZWZpbmVkID8gbWFwRGVmLmV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX1RFWFRVUkVfVFJBTlNGT1JNIF0gOiB1bmRlZmluZWQ7CgoJCQkJaWYgKCB0cmFuc2Zvcm0gKSB7CgoJCQkJCXRleHR1cmUgPSBwYXJzZXIuZXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5LSFJfVEVYVFVSRV9UUkFOU0ZPUk0gXS5leHRlbmRUZXh0dXJlKCB0ZXh0dXJlLCB0cmFuc2Zvcm0gKTsKCgkJCQl9CgoJCQl9CgoJCQltYXRlcmlhbFBhcmFtc1sgbWFwTmFtZSBdID0gdGV4dHVyZTsKCgkJfSApOwoKCX07CgoJLyoqCgkgKiBBc3NpZ25zIGZpbmFsIG1hdGVyaWFsIHRvIGEgTWVzaCwgTGluZSwgb3IgUG9pbnRzIGluc3RhbmNlLiBUaGUgaW5zdGFuY2UKCSAqIGFscmVhZHkgaGFzIGEgbWF0ZXJpYWwgKGdlbmVyYXRlZCBmcm9tIHRoZSBnbFRGIG1hdGVyaWFsIG9wdGlvbnMgYWxvbmUpCgkgKiBidXQgcmV1c2Ugb2YgdGhlIHNhbWUgZ2xURiBtYXRlcmlhbCBtYXkgcmVxdWlyZSBtdWx0aXBsZSB0aHJlZWpzIG1hdGVyaWFscwoJICogdG8gYWNjb21vZGF0ZSBkaWZmZXJlbnQgcHJpbWl0aXZlIHR5cGVzLCBkZWZpbmVzLCBldGMuIE5ldyBtYXRlcmlhbHMgd2lsbAoJICogYmUgY3JlYXRlZCBpZiBuZWNlc3NhcnksIGFuZCByZXVzZWQgZnJvbSBhIGNhY2hlLgoJICogQHBhcmFtICB7VEhSRUUuT2JqZWN0M0R9IG1lc2ggTWVzaCwgTGluZSwgb3IgUG9pbnRzIGluc3RhbmNlLgoJICovCglHTFRGUGFyc2VyLnByb3RvdHlwZS5hc3NpZ25GaW5hbE1hdGVyaWFsID0gZnVuY3Rpb24gKCBtZXNoICkgewoKCQl2YXIgZ2VvbWV0cnkgPSBtZXNoLmdlb21ldHJ5OwoJCXZhciBtYXRlcmlhbCA9IG1lc2gubWF0ZXJpYWw7CgkJdmFyIGV4dGVuc2lvbnMgPSB0aGlzLmV4dGVuc2lvbnM7CgoJCXZhciB1c2VWZXJ0ZXhUYW5nZW50cyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAhPT0gdW5kZWZpbmVkOwoJCXZhciB1c2VWZXJ0ZXhDb2xvcnMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQ7CgkJdmFyIHVzZUZsYXRTaGFkaW5nID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5ub3JtYWwgPT09IHVuZGVmaW5lZDsKCQl2YXIgdXNlU2tpbm5pbmcgPSBtZXNoLmlzU2tpbm5lZE1lc2ggPT09IHRydWU7CgkJdmFyIHVzZU1vcnBoVGFyZ2V0cyA9IE9iamVjdC5rZXlzKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMgKS5sZW5ndGggPiAwOwoJCXZhciB1c2VNb3JwaE5vcm1hbHMgPSB1c2VNb3JwaFRhcmdldHMgJiYgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkOwoKCQlpZiAoIG1lc2guaXNQb2ludHMgKSB7CgoJCQl2YXIgY2FjaGVLZXkgPSAnUG9pbnRzTWF0ZXJpYWw6JyArIG1hdGVyaWFsLnV1aWQ7CgoJCQl2YXIgcG9pbnRzTWF0ZXJpYWwgPSB0aGlzLmNhY2hlLmdldCggY2FjaGVLZXkgKTsKCgkJCWlmICggISBwb2ludHNNYXRlcmlhbCApIHsKCgkJCQlwb2ludHNNYXRlcmlhbCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCgpOwoJCQkJVEhSRUUuTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggcG9pbnRzTWF0ZXJpYWwsIG1hdGVyaWFsICk7CgkJCQlwb2ludHNNYXRlcmlhbC5jb2xvci5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCQkJcG9pbnRzTWF0ZXJpYWwubWFwID0gbWF0ZXJpYWwubWFwOwoJCQkJcG9pbnRzTWF0ZXJpYWwubGlnaHRzID0gZmFsc2U7IC8vIFBvaW50c01hdGVyaWFsIGRvZXNuJ3Qgc3VwcG9ydCBsaWdodHMgeWV0CgoJCQkJdGhpcy5jYWNoZS5hZGQoIGNhY2hlS2V5LCBwb2ludHNNYXRlcmlhbCApOwoKCQkJfQoKCQkJbWF0ZXJpYWwgPSBwb2ludHNNYXRlcmlhbDsKCgkJfSBlbHNlIGlmICggbWVzaC5pc0xpbmUgKSB7CgoJCQl2YXIgY2FjaGVLZXkgPSAnTGluZUJhc2ljTWF0ZXJpYWw6JyArIG1hdGVyaWFsLnV1aWQ7CgoJCQl2YXIgbGluZU1hdGVyaWFsID0gdGhpcy5jYWNoZS5nZXQoIGNhY2hlS2V5ICk7CgoJCQlpZiAoICEgbGluZU1hdGVyaWFsICkgewoKCQkJCWxpbmVNYXRlcmlhbCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCgpOwoJCQkJVEhSRUUuTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggbGluZU1hdGVyaWFsLCBtYXRlcmlhbCApOwoJCQkJbGluZU1hdGVyaWFsLmNvbG9yLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CgkJCQlsaW5lTWF0ZXJpYWwubGlnaHRzID0gZmFsc2U7IC8vIExpbmVCYXNpY01hdGVyaWFsIGRvZXNuJ3Qgc3VwcG9ydCBsaWdodHMgeWV0CgoJCQkJdGhpcy5jYWNoZS5hZGQoIGNhY2hlS2V5LCBsaW5lTWF0ZXJpYWwgKTsKCgkJCX0KCgkJCW1hdGVyaWFsID0gbGluZU1hdGVyaWFsOwoKCQl9CgoJCS8vIENsb25lIHRoZSBtYXRlcmlhbCBpZiBpdCB3aWxsIGJlIG1vZGlmaWVkCgkJaWYgKCB1c2VWZXJ0ZXhUYW5nZW50cyB8fCB1c2VWZXJ0ZXhDb2xvcnMgfHwgdXNlRmxhdFNoYWRpbmcgfHwgdXNlU2tpbm5pbmcgfHwgdXNlTW9ycGhUYXJnZXRzICkgewoKCQkJdmFyIGNhY2hlS2V5ID0gJ0Nsb25lZE1hdGVyaWFsOicgKyBtYXRlcmlhbC51dWlkICsgJzonOwoKCQkJaWYgKCBtYXRlcmlhbC5pc0dMVEZTcGVjdWxhckdsb3NzaW5lc3NNYXRlcmlhbCApIGNhY2hlS2V5ICs9ICdzcGVjdWxhci1nbG9zc2luZXNzOic7CgkJCWlmICggdXNlU2tpbm5pbmcgKSBjYWNoZUtleSArPSAnc2tpbm5pbmc6JzsKCQkJaWYgKCB1c2VWZXJ0ZXhUYW5nZW50cyApIGNhY2hlS2V5ICs9ICd2ZXJ0ZXgtdGFuZ2VudHM6JzsKCQkJaWYgKCB1c2VWZXJ0ZXhDb2xvcnMgKSBjYWNoZUtleSArPSAndmVydGV4LWNvbG9yczonOwoJCQlpZiAoIHVzZUZsYXRTaGFkaW5nICkgY2FjaGVLZXkgKz0gJ2ZsYXQtc2hhZGluZzonOwoJCQlpZiAoIHVzZU1vcnBoVGFyZ2V0cyApIGNhY2hlS2V5ICs9ICdtb3JwaC10YXJnZXRzOic7CgkJCWlmICggdXNlTW9ycGhOb3JtYWxzICkgY2FjaGVLZXkgKz0gJ21vcnBoLW5vcm1hbHM6JzsKCgkJCXZhciBjYWNoZWRNYXRlcmlhbCA9IHRoaXMuY2FjaGUuZ2V0KCBjYWNoZUtleSApOwoKCQkJaWYgKCAhIGNhY2hlZE1hdGVyaWFsICkgewoKCQkJCWNhY2hlZE1hdGVyaWFsID0gbWF0ZXJpYWwuaXNHTFRGU3BlY3VsYXJHbG9zc2luZXNzTWF0ZXJpYWwKCQkJCQk/IGV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX01BVEVSSUFMU19QQlJfU1BFQ1VMQVJfR0xPU1NJTkVTUyBdLmNsb25lTWF0ZXJpYWwoIG1hdGVyaWFsICkKCQkJCQk6IG1hdGVyaWFsLmNsb25lKCk7CgoJCQkJaWYgKCB1c2VTa2lubmluZyApIGNhY2hlZE1hdGVyaWFsLnNraW5uaW5nID0gdHJ1ZTsKCQkJCWlmICggdXNlVmVydGV4VGFuZ2VudHMgKSBjYWNoZWRNYXRlcmlhbC52ZXJ0ZXhUYW5nZW50cyA9IHRydWU7CgkJCQlpZiAoIHVzZVZlcnRleENvbG9ycyApIGNhY2hlZE1hdGVyaWFsLnZlcnRleENvbG9ycyA9IFRIUkVFLlZlcnRleENvbG9yczsKCQkJCWlmICggdXNlRmxhdFNoYWRpbmcgKSBjYWNoZWRNYXRlcmlhbC5mbGF0U2hhZGluZyA9IHRydWU7CgkJCQlpZiAoIHVzZU1vcnBoVGFyZ2V0cyApIGNhY2hlZE1hdGVyaWFsLm1vcnBoVGFyZ2V0cyA9IHRydWU7CgkJCQlpZiAoIHVzZU1vcnBoTm9ybWFscyApIGNhY2hlZE1hdGVyaWFsLm1vcnBoTm9ybWFscyA9IHRydWU7CgoJCQkJdGhpcy5jYWNoZS5hZGQoIGNhY2hlS2V5LCBjYWNoZWRNYXRlcmlhbCApOwoKCQkJfQoKCQkJbWF0ZXJpYWwgPSBjYWNoZWRNYXRlcmlhbDsKCgkJfQoKCQkvLyB3b3JrYXJvdW5kcyBmb3IgbWVzaCBhbmQgZ2VvbWV0cnkKCgkJaWYgKCBtYXRlcmlhbC5hb01hcCAmJiBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2MiA9PT0gdW5kZWZpbmVkICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnNvbGUubG9nKCAnVEhSRUUuR0xURkxvYWRlcjogRHVwbGljYXRpbmcgVVZzIHRvIHN1cHBvcnQgYW9NYXAuJyApOwoJCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICd1djInLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2LmFycmF5LCAyICkgKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmlzR0xURlNwZWN1bGFyR2xvc3NpbmVzc01hdGVyaWFsICkgewoKCQkJLy8gZm9yIEdMVEZTcGVjdWxhckdsb3NzaW5lc3NNYXRlcmlhbChTaGFkZXJNYXRlcmlhbCkgdW5pZm9ybXMgcnVudGltZSB1cGRhdGUKCQkJbWVzaC5vbkJlZm9yZVJlbmRlciA9IGV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX01BVEVSSUFMU19QQlJfU1BFQ1VMQVJfR0xPU1NJTkVTUyBdLnJlZnJlc2hVbmlmb3JtczsKCgkJfQoKCQltZXNoLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjbWF0ZXJpYWxzCgkgKiBAcGFyYW0ge251bWJlcn0gbWF0ZXJpYWxJbmRleAoJICogQHJldHVybiB7UHJvbWlzZTxUSFJFRS5NYXRlcmlhbD59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRNYXRlcmlhbCA9IGZ1bmN0aW9uICggbWF0ZXJpYWxJbmRleCApIHsKCgkJdmFyIHBhcnNlciA9IHRoaXM7CgkJdmFyIGpzb24gPSB0aGlzLmpzb247CgkJdmFyIGV4dGVuc2lvbnMgPSB0aGlzLmV4dGVuc2lvbnM7CgkJdmFyIG1hdGVyaWFsRGVmID0ganNvbi5tYXRlcmlhbHNbIG1hdGVyaWFsSW5kZXggXTsKCgkJdmFyIG1hdGVyaWFsVHlwZTsKCQl2YXIgbWF0ZXJpYWxQYXJhbXMgPSB7fTsKCQl2YXIgbWF0ZXJpYWxFeHRlbnNpb25zID0gbWF0ZXJpYWxEZWYuZXh0ZW5zaW9ucyB8fCB7fTsKCgkJdmFyIHBlbmRpbmcgPSBbXTsKCgkJaWYgKCBtYXRlcmlhbEV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX01BVEVSSUFMU19QQlJfU1BFQ1VMQVJfR0xPU1NJTkVTUyBdICkgewoKCQkJdmFyIHNnRXh0ZW5zaW9uID0gZXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5LSFJfTUFURVJJQUxTX1BCUl9TUEVDVUxBUl9HTE9TU0lORVNTIF07CgkJCW1hdGVyaWFsVHlwZSA9IHNnRXh0ZW5zaW9uLmdldE1hdGVyaWFsVHlwZSggbWF0ZXJpYWxEZWYgKTsKCQkJcGVuZGluZy5wdXNoKCBzZ0V4dGVuc2lvbi5leHRlbmRQYXJhbXMoIG1hdGVyaWFsUGFyYW1zLCBtYXRlcmlhbERlZiwgcGFyc2VyICkgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWxFeHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9NQVRFUklBTFNfVU5MSVQgXSApIHsKCgkJCXZhciBrbXVFeHRlbnNpb24gPSBleHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9NQVRFUklBTFNfVU5MSVQgXTsKCQkJbWF0ZXJpYWxUeXBlID0ga211RXh0ZW5zaW9uLmdldE1hdGVyaWFsVHlwZSggbWF0ZXJpYWxEZWYgKTsKCQkJcGVuZGluZy5wdXNoKCBrbXVFeHRlbnNpb24uZXh0ZW5kUGFyYW1zKCBtYXRlcmlhbFBhcmFtcywgbWF0ZXJpYWxEZWYsIHBhcnNlciApICk7CgoJCX0gZWxzZSB7CgoJCQkvLyBTcGVjaWZpY2F0aW9uOgoJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vS2hyb25vc0dyb3VwL2dsVEYvdHJlZS9tYXN0ZXIvc3BlY2lmaWNhdGlvbi8yLjAjbWV0YWxsaWMtcm91Z2huZXNzLW1hdGVyaWFsCgoJCQltYXRlcmlhbFR5cGUgPSBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbDsKCgkJCXZhciBtZXRhbGxpY1JvdWdobmVzcyA9IG1hdGVyaWFsRGVmLnBick1ldGFsbGljUm91Z2huZXNzIHx8IHt9OwoKCQkJbWF0ZXJpYWxQYXJhbXMuY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoIDEuMCwgMS4wLCAxLjAgKTsKCQkJbWF0ZXJpYWxQYXJhbXMub3BhY2l0eSA9IDEuMDsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggbWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yRmFjdG9yICkgKSB7CgoJCQkJdmFyIGFycmF5ID0gbWV0YWxsaWNSb3VnaG5lc3MuYmFzZUNvbG9yRmFjdG9yOwoKCQkJCW1hdGVyaWFsUGFyYW1zLmNvbG9yLmZyb21BcnJheSggYXJyYXkgKTsKCQkJCW1hdGVyaWFsUGFyYW1zLm9wYWNpdHkgPSBhcnJheVsgMyBdOwoKCQkJfQoKCQkJaWYgKCBtZXRhbGxpY1JvdWdobmVzcy5iYXNlQ29sb3JUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcGVuZGluZy5wdXNoKCBwYXJzZXIuYXNzaWduVGV4dHVyZSggbWF0ZXJpYWxQYXJhbXMsICdtYXAnLCBtZXRhbGxpY1JvdWdobmVzcy5iYXNlQ29sb3JUZXh0dXJlICkgKTsKCgkJCX0KCgkJCW1hdGVyaWFsUGFyYW1zLm1ldGFsbmVzcyA9IG1ldGFsbGljUm91Z2huZXNzLm1ldGFsbGljRmFjdG9yICE9PSB1bmRlZmluZWQgPyBtZXRhbGxpY1JvdWdobmVzcy5tZXRhbGxpY0ZhY3RvciA6IDEuMDsKCQkJbWF0ZXJpYWxQYXJhbXMucm91Z2huZXNzID0gbWV0YWxsaWNSb3VnaG5lc3Mucm91Z2huZXNzRmFjdG9yICE9PSB1bmRlZmluZWQgPyBtZXRhbGxpY1JvdWdobmVzcy5yb3VnaG5lc3NGYWN0b3IgOiAxLjA7CgoJCQlpZiAoIG1ldGFsbGljUm91Z2huZXNzLm1ldGFsbGljUm91Z2huZXNzVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIG1hdGVyaWFsUGFyYW1zLCAnbWV0YWxuZXNzTWFwJywgbWV0YWxsaWNSb3VnaG5lc3MubWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlICkgKTsKCQkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIG1hdGVyaWFsUGFyYW1zLCAncm91Z2huZXNzTWFwJywgbWV0YWxsaWNSb3VnaG5lc3MubWV0YWxsaWNSb3VnaG5lc3NUZXh0dXJlICkgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsRGVmLmRvdWJsZVNpZGVkID09PSB0cnVlICkgewoKCQkJbWF0ZXJpYWxQYXJhbXMuc2lkZSA9IFRIUkVFLkRvdWJsZVNpZGU7CgoJCX0KCgkJdmFyIGFscGhhTW9kZSA9IG1hdGVyaWFsRGVmLmFscGhhTW9kZSB8fCBBTFBIQV9NT0RFUy5PUEFRVUU7CgoJCWlmICggYWxwaGFNb2RlID09PSBBTFBIQV9NT0RFUy5CTEVORCApIHsKCgkJCW1hdGVyaWFsUGFyYW1zLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJfSBlbHNlIHsKCgkJCW1hdGVyaWFsUGFyYW1zLnRyYW5zcGFyZW50ID0gZmFsc2U7CgoJCQlpZiAoIGFscGhhTW9kZSA9PT0gQUxQSEFfTU9ERVMuTUFTSyApIHsKCgkJCQltYXRlcmlhbFBhcmFtcy5hbHBoYVRlc3QgPSBtYXRlcmlhbERlZi5hbHBoYUN1dG9mZiAhPT0gdW5kZWZpbmVkID8gbWF0ZXJpYWxEZWYuYWxwaGFDdXRvZmYgOiAwLjU7CgoJCQl9CgoJCX0KCgkJaWYgKCBtYXRlcmlhbERlZi5ub3JtYWxUZXh0dXJlICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWxUeXBlICE9PSBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCApIHsKCgkJCXBlbmRpbmcucHVzaCggcGFyc2VyLmFzc2lnblRleHR1cmUoIG1hdGVyaWFsUGFyYW1zLCAnbm9ybWFsTWFwJywgbWF0ZXJpYWxEZWYubm9ybWFsVGV4dHVyZSApICk7CgoJCQltYXRlcmlhbFBhcmFtcy5ub3JtYWxTY2FsZSA9IG5ldyBUSFJFRS5WZWN0b3IyKCAxLCAxICk7CgoJCQlpZiAoIG1hdGVyaWFsRGVmLm5vcm1hbFRleHR1cmUuc2NhbGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQltYXRlcmlhbFBhcmFtcy5ub3JtYWxTY2FsZS5zZXQoIG1hdGVyaWFsRGVmLm5vcm1hbFRleHR1cmUuc2NhbGUsIG1hdGVyaWFsRGVmLm5vcm1hbFRleHR1cmUuc2NhbGUgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsRGVmLm9jY2x1c2lvblRleHR1cmUgIT09IHVuZGVmaW5lZCAmJiBtYXRlcmlhbFR5cGUgIT09IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsICkgewoKCQkJcGVuZGluZy5wdXNoKCBwYXJzZXIuYXNzaWduVGV4dHVyZSggbWF0ZXJpYWxQYXJhbXMsICdhb01hcCcsIG1hdGVyaWFsRGVmLm9jY2x1c2lvblRleHR1cmUgKSApOwoKCQkJaWYgKCBtYXRlcmlhbERlZi5vY2NsdXNpb25UZXh0dXJlLnN0cmVuZ3RoICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJbWF0ZXJpYWxQYXJhbXMuYW9NYXBJbnRlbnNpdHkgPSBtYXRlcmlhbERlZi5vY2NsdXNpb25UZXh0dXJlLnN0cmVuZ3RoOwoKCQkJfQoKCQl9CgoJCWlmICggbWF0ZXJpYWxEZWYuZW1pc3NpdmVGYWN0b3IgIT09IHVuZGVmaW5lZCAmJiBtYXRlcmlhbFR5cGUgIT09IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsICkgewoKCQkJbWF0ZXJpYWxQYXJhbXMuZW1pc3NpdmUgPSBuZXcgVEhSRUUuQ29sb3IoKS5mcm9tQXJyYXkoIG1hdGVyaWFsRGVmLmVtaXNzaXZlRmFjdG9yICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbERlZi5lbWlzc2l2ZVRleHR1cmUgIT09IHVuZGVmaW5lZCAmJiBtYXRlcmlhbFR5cGUgIT09IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsICkgewoKCQkJcGVuZGluZy5wdXNoKCBwYXJzZXIuYXNzaWduVGV4dHVyZSggbWF0ZXJpYWxQYXJhbXMsICdlbWlzc2l2ZU1hcCcsIG1hdGVyaWFsRGVmLmVtaXNzaXZlVGV4dHVyZSApICk7CgoJCX0KCgkJcmV0dXJuIFByb21pc2UuYWxsKCBwZW5kaW5nICkudGhlbiggZnVuY3Rpb24gKCkgewoKCQkJdmFyIG1hdGVyaWFsOwoKCQkJaWYgKCBtYXRlcmlhbFR5cGUgPT09IFRIUkVFLlNoYWRlck1hdGVyaWFsICkgewoKCQkJCW1hdGVyaWFsID0gZXh0ZW5zaW9uc1sgRVhURU5TSU9OUy5LSFJfTUFURVJJQUxTX1BCUl9TUEVDVUxBUl9HTE9TU0lORVNTIF0uY3JlYXRlTWF0ZXJpYWwoIG1hdGVyaWFsUGFyYW1zICk7CgoJCQl9IGVsc2UgewoKCQkJCW1hdGVyaWFsID0gbmV3IG1hdGVyaWFsVHlwZSggbWF0ZXJpYWxQYXJhbXMgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWxEZWYubmFtZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubmFtZSA9IG1hdGVyaWFsRGVmLm5hbWU7CgoJCQkvLyBiYXNlQ29sb3JUZXh0dXJlLCBlbWlzc2l2ZVRleHR1cmUsIGFuZCBzcGVjdWxhckdsb3NzaW5lc3NUZXh0dXJlIHVzZSBzUkdCIGVuY29kaW5nLgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIG1hdGVyaWFsLm1hcC5lbmNvZGluZyA9IFRIUkVFLnNSR0JFbmNvZGluZzsKCQkJaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCApIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmVuY29kaW5nID0gVEhSRUUuc1JHQkVuY29kaW5nOwoJCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyTWFwICkgbWF0ZXJpYWwuc3BlY3VsYXJNYXAuZW5jb2RpbmcgPSBUSFJFRS5zUkdCRW5jb2Rpbmc7CgoJCQlhc3NpZ25FeHRyYXNUb1VzZXJEYXRhKCBtYXRlcmlhbCwgbWF0ZXJpYWxEZWYgKTsKCgkJCWlmICggbWF0ZXJpYWxEZWYuZXh0ZW5zaW9ucyApIGFkZFVua25vd25FeHRlbnNpb25zVG9Vc2VyRGF0YSggZXh0ZW5zaW9ucywgbWF0ZXJpYWwsIG1hdGVyaWFsRGVmICk7CgoJCQlyZXR1cm4gbWF0ZXJpYWw7CgoJCX0gKTsKCgl9OwoKCS8qKgoJICogQHBhcmFtIHtUSFJFRS5CdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkKCSAqIEBwYXJhbSB7R0xURi5QcmltaXRpdmV9IHByaW1pdGl2ZURlZgoJICogQHBhcmFtIHtHTFRGUGFyc2VyfSBwYXJzZXIKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuQnVmZmVyR2VvbWV0cnk+fQoJICovCglmdW5jdGlvbiBhZGRQcmltaXRpdmVBdHRyaWJ1dGVzKCBnZW9tZXRyeSwgcHJpbWl0aXZlRGVmLCBwYXJzZXIgKSB7CgoJCXZhciBhdHRyaWJ1dGVzID0gcHJpbWl0aXZlRGVmLmF0dHJpYnV0ZXM7CgoJCXZhciBwZW5kaW5nID0gW107CgoJCWZ1bmN0aW9uIGFzc2lnbkF0dHJpYnV0ZUFjY2Vzc29yKCBhY2Nlc3NvckluZGV4LCBhdHRyaWJ1dGVOYW1lICkgewoKCQkJcmV0dXJuIHBhcnNlci5nZXREZXBlbmRlbmN5KCAnYWNjZXNzb3InLCBhY2Nlc3NvckluZGV4ICkKCQkJCS50aGVuKCBmdW5jdGlvbiAoIGFjY2Vzc29yICkgewoKCQkJCQlnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoIGF0dHJpYnV0ZU5hbWUsIGFjY2Vzc29yICk7CgoJCQkJfSApOwoKCQl9CgoJCWZvciAoIHZhciBnbHRmQXR0cmlidXRlTmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJdmFyIHRocmVlQXR0cmlidXRlTmFtZSA9IEFUVFJJQlVURVNbIGdsdGZBdHRyaWJ1dGVOYW1lIF0gfHwgZ2x0ZkF0dHJpYnV0ZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkJCS8vIFNraXAgYXR0cmlidXRlcyBhbHJlYWR5IHByb3ZpZGVkIGJ5IGUuZy4gRHJhY28gZXh0ZW5zaW9uLgoJCQlpZiAoIHRocmVlQXR0cmlidXRlTmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgY29udGludWU7CgoJCQlwZW5kaW5nLnB1c2goIGFzc2lnbkF0dHJpYnV0ZUFjY2Vzc29yKCBhdHRyaWJ1dGVzWyBnbHRmQXR0cmlidXRlTmFtZSBdLCB0aHJlZUF0dHJpYnV0ZU5hbWUgKSApOwoKCQl9CgoJCWlmICggcHJpbWl0aXZlRGVmLmluZGljZXMgIT09IHVuZGVmaW5lZCAmJiAhIGdlb21ldHJ5LmluZGV4ICkgewoKCQkJdmFyIGFjY2Vzc29yID0gcGFyc2VyLmdldERlcGVuZGVuY3koICdhY2Nlc3NvcicsIHByaW1pdGl2ZURlZi5pbmRpY2VzICkudGhlbiggZnVuY3Rpb24gKCBhY2Nlc3NvciApIHsKCgkJCQlnZW9tZXRyeS5zZXRJbmRleCggYWNjZXNzb3IgKTsKCgkJCX0gKTsKCgkJCXBlbmRpbmcucHVzaCggYWNjZXNzb3IgKTsKCgkJfQoKCQlhc3NpZ25FeHRyYXNUb1VzZXJEYXRhKCBnZW9tZXRyeSwgcHJpbWl0aXZlRGVmICk7CgoJCXJldHVybiBQcm9taXNlLmFsbCggcGVuZGluZyApLnRoZW4oIGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBwcmltaXRpdmVEZWYudGFyZ2V0cyAhPT0gdW5kZWZpbmVkCgkJCQk/IGFkZE1vcnBoVGFyZ2V0cyggZ2VvbWV0cnksIHByaW1pdGl2ZURlZi50YXJnZXRzLCBwYXJzZXIgKQoJCQkJOiBnZW9tZXRyeTsKCgkJfSApOwoKCX0KCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi9ibG9iL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMC9SRUFETUUubWQjZ2VvbWV0cnkKCSAqCgkgKiBDcmVhdGVzIEJ1ZmZlckdlb21ldHJpZXMgZnJvbSBwcmltaXRpdmVzLgoJICoKCSAqIEBwYXJhbSB7QXJyYXk8R0xURi5QcmltaXRpdmU+fSBwcmltaXRpdmVzCgkgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PFRIUkVFLkJ1ZmZlckdlb21ldHJ5Pj59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRHZW9tZXRyaWVzID0gZnVuY3Rpb24gKCBwcmltaXRpdmVzICkgewoKCQl2YXIgcGFyc2VyID0gdGhpczsKCQl2YXIgZXh0ZW5zaW9ucyA9IHRoaXMuZXh0ZW5zaW9uczsKCQl2YXIgY2FjaGUgPSB0aGlzLnByaW1pdGl2ZUNhY2hlOwoKCQlmdW5jdGlvbiBjcmVhdGVEcmFjb1ByaW1pdGl2ZSggcHJpbWl0aXZlICkgewoKCQkJcmV0dXJuIGV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX0RSQUNPX01FU0hfQ09NUFJFU1NJT04gXQoJCQkJLmRlY29kZVByaW1pdGl2ZSggcHJpbWl0aXZlLCBwYXJzZXIgKQoJCQkJLnRoZW4oIGZ1bmN0aW9uICggZ2VvbWV0cnkgKSB7CgoJCQkJCXJldHVybiBhZGRQcmltaXRpdmVBdHRyaWJ1dGVzKCBnZW9tZXRyeSwgcHJpbWl0aXZlLCBwYXJzZXIgKTsKCgkJCQl9ICk7CgoJCX0KCgkJdmFyIHBlbmRpbmcgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHByaW1pdGl2ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl2YXIgcHJpbWl0aXZlID0gcHJpbWl0aXZlc1sgaSBdOwoJCQl2YXIgY2FjaGVLZXkgPSBjcmVhdGVQcmltaXRpdmVLZXkoIHByaW1pdGl2ZSApOwoKCQkJLy8gU2VlIGlmIHdlJ3ZlIGFscmVhZHkgY3JlYXRlZCB0aGlzIGdlb21ldHJ5CgkJCXZhciBjYWNoZWQgPSBjYWNoZVsgY2FjaGVLZXkgXTsKCgkJCWlmICggY2FjaGVkICkgewoKCQkJCS8vIFVzZSB0aGUgY2FjaGVkIGdlb21ldHJ5IGlmIGl0IGV4aXN0cwoJCQkJcGVuZGluZy5wdXNoKCBjYWNoZWQucHJvbWlzZSApOwoKCQkJfSBlbHNlIHsKCgkJCQl2YXIgZ2VvbWV0cnlQcm9taXNlOwoKCQkJCWlmICggcHJpbWl0aXZlLmV4dGVuc2lvbnMgJiYgcHJpbWl0aXZlLmV4dGVuc2lvbnNbIEVYVEVOU0lPTlMuS0hSX0RSQUNPX01FU0hfQ09NUFJFU1NJT04gXSApIHsKCgkJCQkJLy8gVXNlIERSQUNPIGdlb21ldHJ5IGlmIGF2YWlsYWJsZQoJCQkJCWdlb21ldHJ5UHJvbWlzZSA9IGNyZWF0ZURyYWNvUHJpbWl0aXZlKCBwcmltaXRpdmUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBPdGhlcndpc2UgY3JlYXRlIGEgbmV3IGdlb21ldHJ5CgkJCQkJZ2VvbWV0cnlQcm9taXNlID0gYWRkUHJpbWl0aXZlQXR0cmlidXRlcyggbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCksIHByaW1pdGl2ZSwgcGFyc2VyICk7CgoJCQkJfQoKCQkJCS8vIENhY2hlIHRoaXMgZ2VvbWV0cnkKCQkJCWNhY2hlWyBjYWNoZUtleSBdID0geyBwcmltaXRpdmU6IHByaW1pdGl2ZSwgcHJvbWlzZTogZ2VvbWV0cnlQcm9taXNlIH07CgoJCQkJcGVuZGluZy5wdXNoKCBnZW9tZXRyeVByb21pc2UgKTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gUHJvbWlzZS5hbGwoIHBlbmRpbmcgKTsKCgl9OwoKCS8qKgoJICogU3BlY2lmaWNhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL2Jsb2IvbWFzdGVyL3NwZWNpZmljYXRpb24vMi4wL1JFQURNRS5tZCNtZXNoZXMKCSAqIEBwYXJhbSB7bnVtYmVyfSBtZXNoSW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuR3JvdXB8VEhSRUUuTWVzaHxUSFJFRS5Ta2lubmVkTWVzaD59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRNZXNoID0gZnVuY3Rpb24gKCBtZXNoSW5kZXggKSB7CgoJCXZhciBwYXJzZXIgPSB0aGlzOwoJCXZhciBqc29uID0gdGhpcy5qc29uOwoJCXZhciBleHRlbnNpb25zID0gdGhpcy5leHRlbnNpb25zOwoKCQl2YXIgbWVzaERlZiA9IGpzb24ubWVzaGVzWyBtZXNoSW5kZXggXTsKCQl2YXIgcHJpbWl0aXZlcyA9IG1lc2hEZWYucHJpbWl0aXZlczsKCgkJdmFyIHBlbmRpbmcgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHByaW1pdGl2ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl2YXIgbWF0ZXJpYWwgPSBwcmltaXRpdmVzWyBpIF0ubWF0ZXJpYWwgPT09IHVuZGVmaW5lZAoJCQkJPyBjcmVhdGVEZWZhdWx0TWF0ZXJpYWwoKQoJCQkJOiB0aGlzLmdldERlcGVuZGVuY3koICdtYXRlcmlhbCcsIHByaW1pdGl2ZXNbIGkgXS5tYXRlcmlhbCApOwoKCQkJcGVuZGluZy5wdXNoKCBtYXRlcmlhbCApOwoKCQl9CgoJCXJldHVybiBQcm9taXNlLmFsbCggcGVuZGluZyApLnRoZW4oIGZ1bmN0aW9uICggb3JpZ2luYWxNYXRlcmlhbHMgKSB7CgoJCQlyZXR1cm4gcGFyc2VyLmxvYWRHZW9tZXRyaWVzKCBwcmltaXRpdmVzICkudGhlbiggZnVuY3Rpb24gKCBnZW9tZXRyaWVzICkgewoKCQkJCXZhciBtZXNoZXMgPSBbXTsKCgkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gZ2VvbWV0cmllcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdmFyIGdlb21ldHJ5ID0gZ2VvbWV0cmllc1sgaSBdOwoJCQkJCXZhciBwcmltaXRpdmUgPSBwcmltaXRpdmVzWyBpIF07CgoJCQkJCS8vIDEuIGNyZWF0ZSBNZXNoCgoJCQkJCXZhciBtZXNoOwoKCQkJCQl2YXIgbWF0ZXJpYWwgPSBvcmlnaW5hbE1hdGVyaWFsc1sgaSBdOwoKCQkJCQlpZiAoIHByaW1pdGl2ZS5tb2RlID09PSBXRUJHTF9DT05TVEFOVFMuVFJJQU5HTEVTIHx8CgkJCQkJCXByaW1pdGl2ZS5tb2RlID09PSBXRUJHTF9DT05TVEFOVFMuVFJJQU5HTEVfU1RSSVAgfHwKCQkJCQkJcHJpbWl0aXZlLm1vZGUgPT09IFdFQkdMX0NPTlNUQU5UUy5UUklBTkdMRV9GQU4gfHwKCQkJCQkJcHJpbWl0aXZlLm1vZGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCS8vIC5pc1NraW5uZWRNZXNoIGlzbid0IGluIGdsVEYgc3BlYy4gU2VlIC5tYXJrRGVmcygpCgkJCQkJCW1lc2ggPSBtZXNoRGVmLmlzU2tpbm5lZE1lc2ggPT09IHRydWUKCQkJCQkJCT8gbmV3IFRIUkVFLlNraW5uZWRNZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKQoJCQkJCQkJOiBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCQkJCQlpZiAoIG1lc2guaXNTa2lubmVkTWVzaCA9PT0gdHJ1ZSApIG1lc2gubm9ybWFsaXplU2tpbldlaWdodHMoKTsgLy8gIzE1MzE5CgoJCQkJCQlpZiAoIHByaW1pdGl2ZS5tb2RlID09PSBXRUJHTF9DT05TVEFOVFMuVFJJQU5HTEVfU1RSSVAgKSB7CgoJCQkJCQkJbWVzaC5kcmF3TW9kZSA9IFRIUkVFLlRyaWFuZ2xlU3RyaXBEcmF3TW9kZTsKCgkJCQkJCX0gZWxzZSBpZiAoIHByaW1pdGl2ZS5tb2RlID09PSBXRUJHTF9DT05TVEFOVFMuVFJJQU5HTEVfRkFOICkgewoKCQkJCQkJCW1lc2guZHJhd01vZGUgPSBUSFJFRS5UcmlhbmdsZUZhbkRyYXdNb2RlOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgaWYgKCBwcmltaXRpdmUubW9kZSA9PT0gV0VCR0xfQ09OU1RBTlRTLkxJTkVTICkgewoKCQkJCQkJbWVzaCA9IG5ldyBUSFJFRS5MaW5lU2VnbWVudHMoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgaWYgKCBwcmltaXRpdmUubW9kZSA9PT0gV0VCR0xfQ09OU1RBTlRTLkxJTkVfU1RSSVAgKSB7CgoJCQkJCQltZXNoID0gbmV3IFRIUkVFLkxpbmUoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgaWYgKCBwcmltaXRpdmUubW9kZSA9PT0gV0VCR0xfQ09OU1RBTlRTLkxJTkVfTE9PUCApIHsKCgkJCQkJCW1lc2ggPSBuZXcgVEhSRUUuTGluZUxvb3AoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCQl9IGVsc2UgaWYgKCBwcmltaXRpdmUubW9kZSA9PT0gV0VCR0xfQ09OU1RBTlRTLlBPSU5UUyApIHsKCgkJCQkJCW1lc2ggPSBuZXcgVEhSRUUuUG9pbnRzKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkdMVEZMb2FkZXI6IFByaW1pdGl2ZSBtb2RlIHVuc3VwcG9ydGVkOiAnICsgcHJpbWl0aXZlLm1vZGUgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIE9iamVjdC5rZXlzKCBtZXNoLmdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcyApLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQl1cGRhdGVNb3JwaFRhcmdldHMoIG1lc2gsIG1lc2hEZWYgKTsKCgkJCQkJfQoKCQkJCQltZXNoLm5hbWUgPSBtZXNoRGVmLm5hbWUgfHwgKCAnbWVzaF8nICsgbWVzaEluZGV4ICk7CgoJCQkJCWlmICggZ2VvbWV0cmllcy5sZW5ndGggPiAxICkgbWVzaC5uYW1lICs9ICdfJyArIGk7CgoJCQkJCWFzc2lnbkV4dHJhc1RvVXNlckRhdGEoIG1lc2gsIG1lc2hEZWYgKTsKCgkJCQkJcGFyc2VyLmFzc2lnbkZpbmFsTWF0ZXJpYWwoIG1lc2ggKTsKCgkJCQkJbWVzaGVzLnB1c2goIG1lc2ggKTsKCgkJCQl9CgoJCQkJaWYgKCBtZXNoZXMubGVuZ3RoID09PSAxICkgewoKCQkJCQlyZXR1cm4gbWVzaGVzWyAwIF07CgoJCQkJfQoKCQkJCXZhciBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwoKCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBtZXNoZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWdyb3VwLmFkZCggbWVzaGVzWyBpIF0gKTsKCgkJCQl9CgoJCQkJcmV0dXJuIGdyb3VwOwoKCQkJfSApOwoKCQl9ICk7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi90cmVlL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMCNjYW1lcmFzCgkgKiBAcGFyYW0ge251bWJlcn0gY2FtZXJhSW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuQ2FtZXJhPn0KCSAqLwoJR0xURlBhcnNlci5wcm90b3R5cGUubG9hZENhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhSW5kZXggKSB7CgoJCXZhciBjYW1lcmE7CgkJdmFyIGNhbWVyYURlZiA9IHRoaXMuanNvbi5jYW1lcmFzWyBjYW1lcmFJbmRleCBdOwoJCXZhciBwYXJhbXMgPSBjYW1lcmFEZWZbIGNhbWVyYURlZi50eXBlIF07CgoJCWlmICggISBwYXJhbXMgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5HTFRGTG9hZGVyOiBNaXNzaW5nIGNhbWVyYSBwYXJhbWV0ZXJzLicgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggY2FtZXJhRGVmLnR5cGUgPT09ICdwZXJzcGVjdGl2ZScgKSB7CgoJCQljYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIFRIUkVFLk1hdGgucmFkVG9EZWcoIHBhcmFtcy55Zm92ICksIHBhcmFtcy5hc3BlY3RSYXRpbyB8fCAxLCBwYXJhbXMuem5lYXIgfHwgMSwgcGFyYW1zLnpmYXIgfHwgMmU2ICk7CgoJCX0gZWxzZSBpZiAoIGNhbWVyYURlZi50eXBlID09PSAnb3J0aG9ncmFwaGljJyApIHsKCgkJCWNhbWVyYSA9IG5ldyBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEoIHBhcmFtcy54bWFnIC8gLSAyLCBwYXJhbXMueG1hZyAvIDIsIHBhcmFtcy55bWFnIC8gMiwgcGFyYW1zLnltYWcgLyAtIDIsIHBhcmFtcy56bmVhciwgcGFyYW1zLnpmYXIgKTsKCgkJfQoKCQlpZiAoIGNhbWVyYURlZi5uYW1lICE9PSB1bmRlZmluZWQgKSBjYW1lcmEubmFtZSA9IGNhbWVyYURlZi5uYW1lOwoKCQlhc3NpZ25FeHRyYXNUb1VzZXJEYXRhKCBjYW1lcmEsIGNhbWVyYURlZiApOwoKCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCBjYW1lcmEgKTsKCgl9OwoKCS8qKgoJICogU3BlY2lmaWNhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL3RyZWUvbWFzdGVyL3NwZWNpZmljYXRpb24vMi4wI3NraW5zCgkgKiBAcGFyYW0ge251bWJlcn0gc2tpbkluZGV4CgkgKiBAcmV0dXJuIHtQcm9taXNlPE9iamVjdD59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRTa2luID0gZnVuY3Rpb24gKCBza2luSW5kZXggKSB7CgoJCXZhciBza2luRGVmID0gdGhpcy5qc29uLnNraW5zWyBza2luSW5kZXggXTsKCgkJdmFyIHNraW5FbnRyeSA9IHsgam9pbnRzOiBza2luRGVmLmpvaW50cyB9OwoKCQlpZiAoIHNraW5EZWYuaW52ZXJzZUJpbmRNYXRyaWNlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZSggc2tpbkVudHJ5ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXMuZ2V0RGVwZW5kZW5jeSggJ2FjY2Vzc29yJywgc2tpbkRlZi5pbnZlcnNlQmluZE1hdHJpY2VzICkudGhlbiggZnVuY3Rpb24gKCBhY2Nlc3NvciApIHsKCgkJCXNraW5FbnRyeS5pbnZlcnNlQmluZE1hdHJpY2VzID0gYWNjZXNzb3I7CgoJCQlyZXR1cm4gc2tpbkVudHJ5OwoKCQl9ICk7CgoJfTsKCgkvKioKCSAqIFNwZWNpZmljYXRpb246IGh0dHBzOi8vZ2l0aHViLmNvbS9LaHJvbm9zR3JvdXAvZ2xURi90cmVlL21hc3Rlci9zcGVjaWZpY2F0aW9uLzIuMCNhbmltYXRpb25zCgkgKiBAcGFyYW0ge251bWJlcn0gYW5pbWF0aW9uSW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuQW5pbWF0aW9uQ2xpcD59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRBbmltYXRpb24gPSBmdW5jdGlvbiAoIGFuaW1hdGlvbkluZGV4ICkgewoKCQl2YXIganNvbiA9IHRoaXMuanNvbjsKCgkJdmFyIGFuaW1hdGlvbkRlZiA9IGpzb24uYW5pbWF0aW9uc1sgYW5pbWF0aW9uSW5kZXggXTsKCgkJdmFyIHBlbmRpbmdOb2RlcyA9IFtdOwoJCXZhciBwZW5kaW5nSW5wdXRBY2Nlc3NvcnMgPSBbXTsKCQl2YXIgcGVuZGluZ091dHB1dEFjY2Vzc29ycyA9IFtdOwoJCXZhciBwZW5kaW5nU2FtcGxlcnMgPSBbXTsKCQl2YXIgcGVuZGluZ1RhcmdldHMgPSBbXTsKCgkJZm9yICggdmFyIGkgPSAwLCBpbCA9IGFuaW1hdGlvbkRlZi5jaGFubmVscy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCXZhciBjaGFubmVsID0gYW5pbWF0aW9uRGVmLmNoYW5uZWxzWyBpIF07CgkJCXZhciBzYW1wbGVyID0gYW5pbWF0aW9uRGVmLnNhbXBsZXJzWyBjaGFubmVsLnNhbXBsZXIgXTsKCQkJdmFyIHRhcmdldCA9IGNoYW5uZWwudGFyZ2V0OwoJCQl2YXIgbmFtZSA9IHRhcmdldC5ub2RlICE9PSB1bmRlZmluZWQgPyB0YXJnZXQubm9kZSA6IHRhcmdldC5pZDsgLy8gTk9URTogdGFyZ2V0LmlkIGlzIGRlcHJlY2F0ZWQuCgkJCXZhciBpbnB1dCA9IGFuaW1hdGlvbkRlZi5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgPyBhbmltYXRpb25EZWYucGFyYW1ldGVyc1sgc2FtcGxlci5pbnB1dCBdIDogc2FtcGxlci5pbnB1dDsKCQkJdmFyIG91dHB1dCA9IGFuaW1hdGlvbkRlZi5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgPyBhbmltYXRpb25EZWYucGFyYW1ldGVyc1sgc2FtcGxlci5vdXRwdXQgXSA6IHNhbXBsZXIub3V0cHV0OwoKCQkJcGVuZGluZ05vZGVzLnB1c2goIHRoaXMuZ2V0RGVwZW5kZW5jeSggJ25vZGUnLCBuYW1lICkgKTsKCQkJcGVuZGluZ0lucHV0QWNjZXNzb3JzLnB1c2goIHRoaXMuZ2V0RGVwZW5kZW5jeSggJ2FjY2Vzc29yJywgaW5wdXQgKSApOwoJCQlwZW5kaW5nT3V0cHV0QWNjZXNzb3JzLnB1c2goIHRoaXMuZ2V0RGVwZW5kZW5jeSggJ2FjY2Vzc29yJywgb3V0cHV0ICkgKTsKCQkJcGVuZGluZ1NhbXBsZXJzLnB1c2goIHNhbXBsZXIgKTsKCQkJcGVuZGluZ1RhcmdldHMucHVzaCggdGFyZ2V0ICk7CgoJCX0KCgkJcmV0dXJuIFByb21pc2UuYWxsKCBbCgoJCQlQcm9taXNlLmFsbCggcGVuZGluZ05vZGVzICksCgkJCVByb21pc2UuYWxsKCBwZW5kaW5nSW5wdXRBY2Nlc3NvcnMgKSwKCQkJUHJvbWlzZS5hbGwoIHBlbmRpbmdPdXRwdXRBY2Nlc3NvcnMgKSwKCQkJUHJvbWlzZS5hbGwoIHBlbmRpbmdTYW1wbGVycyApLAoJCQlQcm9taXNlLmFsbCggcGVuZGluZ1RhcmdldHMgKQoKCQldICkudGhlbiggZnVuY3Rpb24gKCBkZXBlbmRlbmNpZXMgKSB7CgoJCQl2YXIgbm9kZXMgPSBkZXBlbmRlbmNpZXNbIDAgXTsKCQkJdmFyIGlucHV0QWNjZXNzb3JzID0gZGVwZW5kZW5jaWVzWyAxIF07CgkJCXZhciBvdXRwdXRBY2Nlc3NvcnMgPSBkZXBlbmRlbmNpZXNbIDIgXTsKCQkJdmFyIHNhbXBsZXJzID0gZGVwZW5kZW5jaWVzWyAzIF07CgkJCXZhciB0YXJnZXRzID0gZGVwZW5kZW5jaWVzWyA0IF07CgoJCQl2YXIgdHJhY2tzID0gW107CgoJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbm9kZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdmFyIG5vZGUgPSBub2Rlc1sgaSBdOwoJCQkJdmFyIGlucHV0QWNjZXNzb3IgPSBpbnB1dEFjY2Vzc29yc1sgaSBdOwoJCQkJdmFyIG91dHB1dEFjY2Vzc29yID0gb3V0cHV0QWNjZXNzb3JzWyBpIF07CgkJCQl2YXIgc2FtcGxlciA9IHNhbXBsZXJzWyBpIF07CgkJCQl2YXIgdGFyZ2V0ID0gdGFyZ2V0c1sgaSBdOwoKCQkJCWlmICggbm9kZSA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgoJCQkJbm9kZS51cGRhdGVNYXRyaXgoKTsKCQkJCW5vZGUubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgoJCQkJdmFyIFR5cGVkS2V5ZnJhbWVUcmFjazsKCgkJCQlzd2l0Y2ggKCBQQVRIX1BST1BFUlRJRVNbIHRhcmdldC5wYXRoIF0gKSB7CgoJCQkJCWNhc2UgUEFUSF9QUk9QRVJUSUVTLndlaWdodHM6CgoJCQkJCQlUeXBlZEtleWZyYW1lVHJhY2sgPSBUSFJFRS5OdW1iZXJLZXlmcmFtZVRyYWNrOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBQQVRIX1BST1BFUlRJRVMucm90YXRpb246CgoJCQkJCQlUeXBlZEtleWZyYW1lVHJhY2sgPSBUSFJFRS5RdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjazsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgUEFUSF9QUk9QRVJUSUVTLnBvc2l0aW9uOgoJCQkJCWNhc2UgUEFUSF9QUk9QRVJUSUVTLnNjYWxlOgoJCQkJCWRlZmF1bHQ6CgoJCQkJCQlUeXBlZEtleWZyYW1lVHJhY2sgPSBUSFJFRS5WZWN0b3JLZXlmcmFtZVRyYWNrOwoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQkJdmFyIHRhcmdldE5hbWUgPSBub2RlLm5hbWUgPyBub2RlLm5hbWUgOiBub2RlLnV1aWQ7CgoJCQkJdmFyIGludGVycG9sYXRpb24gPSBzYW1wbGVyLmludGVycG9sYXRpb24gIT09IHVuZGVmaW5lZCA/IElOVEVSUE9MQVRJT05bIHNhbXBsZXIuaW50ZXJwb2xhdGlvbiBdIDogVEhSRUUuSW50ZXJwb2xhdGVMaW5lYXI7CgoJCQkJdmFyIHRhcmdldE5hbWVzID0gW107CgoJCQkJaWYgKCBQQVRIX1BST1BFUlRJRVNbIHRhcmdldC5wYXRoIF0gPT09IFBBVEhfUFJPUEVSVElFUy53ZWlnaHRzICkgewoKCQkJCQkvLyBOb2RlIG1heSBiZSBhIFRIUkVFLkdyb3VwIChnbFRGIG1lc2ggd2l0aCBzZXZlcmFsIHByaW1pdGl2ZXMpIG9yIGEgVEhSRUUuTWVzaC4KCQkJCQlub2RlLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJCWlmICggb2JqZWN0LmlzTWVzaCA9PT0gdHJ1ZSAmJiBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzICkgewoKCQkJCQkJCXRhcmdldE5hbWVzLnB1c2goIG9iamVjdC5uYW1lID8gb2JqZWN0Lm5hbWUgOiBvYmplY3QudXVpZCApOwoKCQkJCQkJfQoKCQkJCQl9ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGFyZ2V0TmFtZXMucHVzaCggdGFyZ2V0TmFtZSApOwoKCQkJCX0KCgkJCQlmb3IgKCB2YXIgaiA9IDAsIGpsID0gdGFyZ2V0TmFtZXMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCXZhciB0cmFjayA9IG5ldyBUeXBlZEtleWZyYW1lVHJhY2soCgkJCQkJCXRhcmdldE5hbWVzWyBqIF0gKyAnLicgKyBQQVRIX1BST1BFUlRJRVNbIHRhcmdldC5wYXRoIF0sCgkJCQkJCWlucHV0QWNjZXNzb3IuYXJyYXksCgkJCQkJCW91dHB1dEFjY2Vzc29yLmFycmF5LAoJCQkJCQlpbnRlcnBvbGF0aW9uCgkJCQkJKTsKCgkJCQkJLy8gT3ZlcnJpZGUgaW50ZXJwb2xhdGlvbiB3aXRoIGN1c3RvbSBmYWN0b3J5IG1ldGhvZC4KCQkJCQlpZiAoIHNhbXBsZXIuaW50ZXJwb2xhdGlvbiA9PT0gJ0NVQklDU1BMSU5FJyApIHsKCgkJCQkJCXRyYWNrLmNyZWF0ZUludGVycG9sYW50ID0gZnVuY3Rpb24gSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kR0xURkN1YmljU3BsaW5lKCByZXN1bHQgKSB7CgoJCQkJCQkJLy8gQSBDVUJJQ1NQTElORSBrZXlmcmFtZSBpbiBnbFRGIGhhcyB0aHJlZSBvdXRwdXQgdmFsdWVzIGZvciBlYWNoIGlucHV0IHZhbHVlLAoJCQkJCQkJLy8gcmVwcmVzZW50aW5nIGluVGFuZ2VudCwgc3BsaW5lVmVydGV4LCBhbmQgb3V0VGFuZ2VudC4gQXMgYSByZXN1bHQsIHRyYWNrLmdldFZhbHVlU2l6ZSgpCgkJCQkJCQkvLyBtdXN0IGJlIGRpdmlkZWQgYnkgdGhyZWUgdG8gZ2V0IHRoZSBpbnRlcnBvbGFudCdzIHNhbXBsZVNpemUgYXJndW1lbnQuCgoJCQkJCQkJcmV0dXJuIG5ldyBHTFRGQ3ViaWNTcGxpbmVJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCkgLyAzLCByZXN1bHQgKTsKCgkJCQkJCX07CgoJCQkJCQkvLyBNYXJrIGFzIENVQklDU1BMSU5FLiBgdHJhY2suZ2V0SW50ZXJwb2xhdGlvbigpYCBkb2Vzbid0IHN1cHBvcnQgY3VzdG9tIGludGVycG9sYW50cy4KCQkJCQkJdHJhY2suY3JlYXRlSW50ZXJwb2xhbnQuaXNJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RHTFRGQ3ViaWNTcGxpbmUgPSB0cnVlOwoKCQkJCQl9CgoJCQkJCXRyYWNrcy5wdXNoKCB0cmFjayApOwoKCQkJCX0KCgkJCX0KCgkJCXZhciBuYW1lID0gYW5pbWF0aW9uRGVmLm5hbWUgIT09IHVuZGVmaW5lZCA/IGFuaW1hdGlvbkRlZi5uYW1lIDogJ2FuaW1hdGlvbl8nICsgYW5pbWF0aW9uSW5kZXg7CgoJCQlyZXR1cm4gbmV3IFRIUkVFLkFuaW1hdGlvbkNsaXAoIG5hbWUsIHVuZGVmaW5lZCwgdHJhY2tzICk7CgoJCX0gKTsKCgl9OwoKCS8qKgoJICogU3BlY2lmaWNhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL0tocm9ub3NHcm91cC9nbFRGL3RyZWUvbWFzdGVyL3NwZWNpZmljYXRpb24vMi4wI25vZGVzLWFuZC1oaWVyYXJjaHkKCSAqIEBwYXJhbSB7bnVtYmVyfSBub2RlSW5kZXgKCSAqIEByZXR1cm4ge1Byb21pc2U8VEhSRUUuT2JqZWN0M0Q+fQoJICovCglHTFRGUGFyc2VyLnByb3RvdHlwZS5sb2FkTm9kZSA9IGZ1bmN0aW9uICggbm9kZUluZGV4ICkgewoKCQl2YXIganNvbiA9IHRoaXMuanNvbjsKCQl2YXIgZXh0ZW5zaW9ucyA9IHRoaXMuZXh0ZW5zaW9uczsKCQl2YXIgcGFyc2VyID0gdGhpczsKCgkJdmFyIG1lc2hSZWZlcmVuY2VzID0ganNvbi5tZXNoUmVmZXJlbmNlczsKCQl2YXIgbWVzaFVzZXMgPSBqc29uLm1lc2hVc2VzOwoKCQl2YXIgbm9kZURlZiA9IGpzb24ubm9kZXNbIG5vZGVJbmRleCBdOwoKCQlyZXR1cm4gKCBmdW5jdGlvbiAoKSB7CgoJCQkvLyAuaXNCb25lIGlzbid0IGluIGdsVEYgc3BlYy4gU2VlIC5tYXJrRGVmcwoJCQlpZiAoIG5vZGVEZWYuaXNCb25lID09PSB0cnVlICkgewoKCQkJCXJldHVybiBQcm9taXNlLnJlc29sdmUoIG5ldyBUSFJFRS5Cb25lKCkgKTsKCgkJCX0gZWxzZSBpZiAoIG5vZGVEZWYubWVzaCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBwYXJzZXIuZ2V0RGVwZW5kZW5jeSggJ21lc2gnLCBub2RlRGVmLm1lc2ggKS50aGVuKCBmdW5jdGlvbiAoIG1lc2ggKSB7CgoJCQkJCXZhciBub2RlOwoKCQkJCQlpZiAoIG1lc2hSZWZlcmVuY2VzWyBub2RlRGVmLm1lc2ggXSA+IDEgKSB7CgoJCQkJCQl2YXIgaW5zdGFuY2VOdW0gPSBtZXNoVXNlc1sgbm9kZURlZi5tZXNoIF0gKys7CgoJCQkJCQlub2RlID0gbWVzaC5jbG9uZSgpOwoJCQkJCQlub2RlLm5hbWUgKz0gJ19pbnN0YW5jZV8nICsgaW5zdGFuY2VOdW07CgoJCQkJCQkvLyBvbkJlZm9yZVJlbmRlciBjb3B5IGZvciBTcGVjdWxhci1HbG9zc2luZXNzCgkJCQkJCW5vZGUub25CZWZvcmVSZW5kZXIgPSBtZXNoLm9uQmVmb3JlUmVuZGVyOwoKCQkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQkJbm9kZS5jaGlsZHJlblsgaSBdLm5hbWUgKz0gJ19pbnN0YW5jZV8nICsgaW5zdGFuY2VOdW07CgkJCQkJCQlub2RlLmNoaWxkcmVuWyBpIF0ub25CZWZvcmVSZW5kZXIgPSBtZXNoLmNoaWxkcmVuWyBpIF0ub25CZWZvcmVSZW5kZXI7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlub2RlID0gbWVzaDsKCgkJCQkJfQoKCQkJCQkvLyBpZiB3ZWlnaHRzIGFyZSBwcm92aWRlZCBvbiB0aGUgbm9kZSwgb3ZlcnJpZGUgd2VpZ2h0cyBvbiB0aGUgbWVzaC4KCQkJCQlpZiAoIG5vZGVEZWYud2VpZ2h0cyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJbm9kZS50cmF2ZXJzZSggZnVuY3Rpb24gKCBvICkgewoKCQkJCQkJCWlmICggISBvLmlzTWVzaCApIHJldHVybjsKCgkJCQkJCQlmb3IgKCB2YXIgaSA9IDAsIGlsID0gbm9kZURlZi53ZWlnaHRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCQlvLm1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdID0gbm9kZURlZi53ZWlnaHRzWyBpIF07CgoJCQkJCQkJfQoKCQkJCQkJfSApOwoKCQkJCQl9CgoJCQkJCXJldHVybiBub2RlOwoKCQkJCX0gKTsKCgkJCX0gZWxzZSBpZiAoIG5vZGVEZWYuY2FtZXJhICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIHBhcnNlci5nZXREZXBlbmRlbmN5KCAnY2FtZXJhJywgbm9kZURlZi5jYW1lcmEgKTsKCgkJCX0gZWxzZSBpZiAoIG5vZGVEZWYuZXh0ZW5zaW9ucwoJCQkJJiYgbm9kZURlZi5leHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9MSUdIVFNfUFVOQ1RVQUwgXQoJCQkJJiYgbm9kZURlZi5leHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9MSUdIVFNfUFVOQ1RVQUwgXS5saWdodCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBwYXJzZXIuZ2V0RGVwZW5kZW5jeSggJ2xpZ2h0Jywgbm9kZURlZi5leHRlbnNpb25zWyBFWFRFTlNJT05TLktIUl9MSUdIVFNfUFVOQ1RVQUwgXS5saWdodCApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCBuZXcgVEhSRUUuT2JqZWN0M0QoKSApOwoKCQkJfQoKCQl9KCkgKS50aGVuKCBmdW5jdGlvbiAoIG5vZGUgKSB7CgoJCQlpZiAoIG5vZGVEZWYubmFtZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW5vZGUubmFtZSA9IFRIUkVFLlByb3BlcnR5QmluZGluZy5zYW5pdGl6ZU5vZGVOYW1lKCBub2RlRGVmLm5hbWUgKTsKCgkJCX0KCgkJCWFzc2lnbkV4dHJhc1RvVXNlckRhdGEoIG5vZGUsIG5vZGVEZWYgKTsKCgkJCWlmICggbm9kZURlZi5leHRlbnNpb25zICkgYWRkVW5rbm93bkV4dGVuc2lvbnNUb1VzZXJEYXRhKCBleHRlbnNpb25zLCBub2RlLCBub2RlRGVmICk7CgoJCQlpZiAoIG5vZGVEZWYubWF0cml4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdmFyIG1hdHJpeCA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7CgkJCQltYXRyaXguZnJvbUFycmF5KCBub2RlRGVmLm1hdHJpeCApOwoJCQkJbm9kZS5hcHBseU1hdHJpeCggbWF0cml4ICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggbm9kZURlZi50cmFuc2xhdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlub2RlLnBvc2l0aW9uLmZyb21BcnJheSggbm9kZURlZi50cmFuc2xhdGlvbiApOwoKCQkJCX0KCgkJCQlpZiAoIG5vZGVEZWYucm90YXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbm9kZS5xdWF0ZXJuaW9uLmZyb21BcnJheSggbm9kZURlZi5yb3RhdGlvbiApOwoKCQkJCX0KCgkJCQlpZiAoIG5vZGVEZWYuc2NhbGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbm9kZS5zY2FsZS5mcm9tQXJyYXkoIG5vZGVEZWYuc2NhbGUgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbm9kZTsKCgkJfSApOwoKCX07CgoJLyoqCgkgKiBTcGVjaWZpY2F0aW9uOiBodHRwczovL2dpdGh1Yi5jb20vS2hyb25vc0dyb3VwL2dsVEYvdHJlZS9tYXN0ZXIvc3BlY2lmaWNhdGlvbi8yLjAjc2NlbmVzCgkgKiBAcGFyYW0ge251bWJlcn0gc2NlbmVJbmRleAoJICogQHJldHVybiB7UHJvbWlzZTxUSFJFRS5TY2VuZT59CgkgKi8KCUdMVEZQYXJzZXIucHJvdG90eXBlLmxvYWRTY2VuZSA9IGZ1bmN0aW9uICgpIHsKCgkJLy8gc2NlbmUgbm9kZSBoaWVyYWNoeSBidWlsZGVyCgoJCWZ1bmN0aW9uIGJ1aWxkTm9kZUhpZXJhY2h5KCBub2RlSWQsIHBhcmVudE9iamVjdCwganNvbiwgcGFyc2VyICkgewoKCQkJdmFyIG5vZGVEZWYgPSBqc29uLm5vZGVzWyBub2RlSWQgXTsKCgkJCXJldHVybiBwYXJzZXIuZ2V0RGVwZW5kZW5jeSggJ25vZGUnLCBub2RlSWQgKS50aGVuKCBmdW5jdGlvbiAoIG5vZGUgKSB7CgoJCQkJaWYgKCBub2RlRGVmLnNraW4gPT09IHVuZGVmaW5lZCApIHJldHVybiBub2RlOwoKCQkJCS8vIGJ1aWxkIHNrZWxldG9uIGhlcmUgYXMgd2VsbAoKCQkJCXZhciBza2luRW50cnk7CgoJCQkJcmV0dXJuIHBhcnNlci5nZXREZXBlbmRlbmN5KCAnc2tpbicsIG5vZGVEZWYuc2tpbiApLnRoZW4oIGZ1bmN0aW9uICggc2tpbiApIHsKCgkJCQkJc2tpbkVudHJ5ID0gc2tpbjsKCgkJCQkJdmFyIHBlbmRpbmdKb2ludHMgPSBbXTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IHNraW5FbnRyeS5qb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQlwZW5kaW5nSm9pbnRzLnB1c2goIHBhcnNlci5nZXREZXBlbmRlbmN5KCAnbm9kZScsIHNraW5FbnRyeS5qb2ludHNbIGkgXSApICk7CgoJCQkJCX0KCgkJCQkJcmV0dXJuIFByb21pc2UuYWxsKCBwZW5kaW5nSm9pbnRzICk7CgoJCQkJfSApLnRoZW4oIGZ1bmN0aW9uICggam9pbnROb2RlcyApIHsKCgkJCQkJdmFyIG1lc2hlcyA9IG5vZGUuaXNHcm91cCA9PT0gdHJ1ZSA/IG5vZGUuY2hpbGRyZW4gOiBbIG5vZGUgXTsKCgkJCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG1lc2hlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCXZhciBtZXNoID0gbWVzaGVzWyBpIF07CgoJCQkJCQl2YXIgYm9uZXMgPSBbXTsKCQkJCQkJdmFyIGJvbmVJbnZlcnNlcyA9IFtdOwoKCQkJCQkJZm9yICggdmFyIGogPSAwLCBqbCA9IGpvaW50Tm9kZXMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCQkJdmFyIGpvaW50Tm9kZSA9IGpvaW50Tm9kZXNbIGogXTsKCgkJCQkJCQlpZiAoIGpvaW50Tm9kZSApIHsKCgkJCQkJCQkJYm9uZXMucHVzaCggam9pbnROb2RlICk7CgoJCQkJCQkJCXZhciBtYXQgPSBuZXcgVEhSRUUuTWF0cml4NCgpOwoKCQkJCQkJCQlpZiAoIHNraW5FbnRyeS5pbnZlcnNlQmluZE1hdHJpY2VzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCQltYXQuZnJvbUFycmF5KCBza2luRW50cnkuaW52ZXJzZUJpbmRNYXRyaWNlcy5hcnJheSwgaiAqIDE2ICk7CgoJCQkJCQkJCX0KCgkJCQkJCQkJYm9uZUludmVyc2VzLnB1c2goIG1hdCApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkdMVEZMb2FkZXI6IEpvaW50ICIlcyIgY291bGQgbm90IGJlIGZvdW5kLicsIHNraW5FbnRyeS5qb2ludHNbIGogXSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCW1lc2guYmluZCggbmV3IFRIUkVFLlNrZWxldG9uKCBib25lcywgYm9uZUludmVyc2VzICksIG1lc2gubWF0cml4V29ybGQgKTsKCgkJCQkJfQoKCQkJCQlyZXR1cm4gbm9kZTsKCgkJCQl9ICk7CgoJCQl9ICkudGhlbiggZnVuY3Rpb24gKCBub2RlICkgewoKCQkJCS8vIGJ1aWxkIG5vZGUgaGllcmFjaHkKCgkJCQlwYXJlbnRPYmplY3QuYWRkKCBub2RlICk7CgoJCQkJdmFyIHBlbmRpbmcgPSBbXTsKCgkJCQlpZiAoIG5vZGVEZWYuY2hpbGRyZW4gKSB7CgoJCQkJCXZhciBjaGlsZHJlbiA9IG5vZGVEZWYuY2hpbGRyZW47CgoJCQkJCWZvciAoIHZhciBpID0gMCwgaWwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCXZhciBjaGlsZCA9IGNoaWxkcmVuWyBpIF07CgkJCQkJCXBlbmRpbmcucHVzaCggYnVpbGROb2RlSGllcmFjaHkoIGNoaWxkLCBub2RlLCBqc29uLCBwYXJzZXIgKSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXJldHVybiBQcm9taXNlLmFsbCggcGVuZGluZyApOwoKCQkJfSApOwoKCQl9CgoJCXJldHVybiBmdW5jdGlvbiBsb2FkU2NlbmUoIHNjZW5lSW5kZXggKSB7CgoJCQl2YXIganNvbiA9IHRoaXMuanNvbjsKCQkJdmFyIGV4dGVuc2lvbnMgPSB0aGlzLmV4dGVuc2lvbnM7CgkJCXZhciBzY2VuZURlZiA9IHRoaXMuanNvbi5zY2VuZXNbIHNjZW5lSW5kZXggXTsKCQkJdmFyIHBhcnNlciA9IHRoaXM7CgoJCQl2YXIgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTsKCQkJaWYgKCBzY2VuZURlZi5uYW1lICE9PSB1bmRlZmluZWQgKSBzY2VuZS5uYW1lID0gc2NlbmVEZWYubmFtZTsKCgkJCWFzc2lnbkV4dHJhc1RvVXNlckRhdGEoIHNjZW5lLCBzY2VuZURlZiApOwoKCQkJaWYgKCBzY2VuZURlZi5leHRlbnNpb25zICkgYWRkVW5rbm93bkV4dGVuc2lvbnNUb1VzZXJEYXRhKCBleHRlbnNpb25zLCBzY2VuZSwgc2NlbmVEZWYgKTsKCgkJCXZhciBub2RlSWRzID0gc2NlbmVEZWYubm9kZXMgfHwgW107CgoJCQl2YXIgcGVuZGluZyA9IFtdOwoKCQkJZm9yICggdmFyIGkgPSAwLCBpbCA9IG5vZGVJZHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJcGVuZGluZy5wdXNoKCBidWlsZE5vZGVIaWVyYWNoeSggbm9kZUlkc1sgaSBdLCBzY2VuZSwganNvbiwgcGFyc2VyICkgKTsKCgkJCX0KCgkJCXJldHVybiBQcm9taXNlLmFsbCggcGVuZGluZyApLnRoZW4oIGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gc2NlbmU7CgoJCQl9ICk7CgoJCX07CgoJfSgpOwoKCXJldHVybiBHTFRGTG9hZGVyOwoKfSApKCk7Cgp9LHt9XSw0MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBMb2FkcyBhIFdhdmVmcm9udCAubXRsIGZpbGUgc3BlY2lmeWluZyBtYXRlcmlhbHMKICoKICogQGF1dGhvciBhbmdlbHh1YW5jaGFuZwogKi8KClRIUkVFLk1UTExvYWRlciA9IGZ1bmN0aW9uICggbWFuYWdlciApIHsKCgl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IFRIUkVFLkRlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCn07CgpUSFJFRS5NVExMb2FkZXIucHJvdG90eXBlID0gewoKCWNvbnN0cnVjdG9yOiBUSFJFRS5NVExMb2FkZXIsCgoJLyoqCgkgKiBMb2FkcyBhbmQgcGFyc2VzIGEgTVRMIGFzc2V0IGZyb20gYSBVUkwuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd9IHVybCAtIFVSTCB0byB0aGUgTVRMIGZpbGUuCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Mb2FkXSAtIENhbGxiYWNrIGludm9rZWQgd2l0aCB0aGUgbG9hZGVkIG9iamVjdC4KCSAqIEBwYXJhbSB7RnVuY3Rpb259IFtvblByb2dyZXNzXSAtIENhbGxiYWNrIGZvciBkb3dubG9hZCBwcm9ncmVzcy4KCSAqIEBwYXJhbSB7RnVuY3Rpb259IFtvbkVycm9yXSAtIENhbGxiYWNrIGZvciBkb3dubG9hZCBlcnJvcnMuCgkgKgoJICogQHNlZSBzZXRQYXRoIHNldFJlc291cmNlUGF0aAoJICoKCSAqIEBub3RlIEluIG9yZGVyIGZvciByZWxhdGl2ZSB0ZXh0dXJlIHJlZmVyZW5jZXMgdG8gcmVzb2x2ZSBjb3JyZWN0bHkKCSAqIHlvdSBtdXN0IGNhbGwgc2V0UmVzb3VyY2VQYXRoKCkgZXhwbGljaXRseSBwcmlvciB0byBsb2FkLgoJICovCglsb2FkOiBmdW5jdGlvbiAoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQl2YXIgc2NvcGUgPSB0aGlzOwoKCQl2YXIgcGF0aCA9ICggdGhpcy5wYXRoID09PSB1bmRlZmluZWQgKSA/IFRIUkVFLkxvYWRlclV0aWxzLmV4dHJhY3RVcmxCYXNlKCB1cmwgKSA6IHRoaXMucGF0aDsKCgkJdmFyIGxvYWRlciA9IG5ldyBUSFJFRS5GaWxlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCB0ZXh0ICkgewoKCQkJb25Mb2FkKCBzY29wZS5wYXJzZSggdGV4dCwgcGF0aCApICk7CgoJCX0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKTsKCgl9LAoKCS8qKgoJICogU2V0IGJhc2UgcGF0aCBmb3IgcmVzb2x2aW5nIHJlZmVyZW5jZXMuCgkgKiBJZiBzZXQgdGhpcyBwYXRoIHdpbGwgYmUgcHJlcGVuZGVkIHRvIGVhY2ggbG9hZGVkIGFuZCBmb3VuZCByZWZlcmVuY2UuCgkgKgoJICogQHNlZSBzZXRSZXNvdXJjZVBhdGgKCSAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCgkgKiBAcmV0dXJuIHtUSFJFRS5NVExMb2FkZXJ9CgkgKgoJICogQGV4YW1wbGUKCSAqICAgICBtdGxMb2FkZXIuc2V0UGF0aCggJ2Fzc2V0cy9vYmovJyApOwoJICogICAgIG10bExvYWRlci5sb2FkKCAnbXkubXRsJywgLi4uICk7CgkgKi8KCXNldFBhdGg6IGZ1bmN0aW9uICggcGF0aCApIHsKCgkJdGhpcy5wYXRoID0gcGF0aDsKCQlyZXR1cm4gdGhpczsKCgl9LAoKCS8qKgoJICogU2V0IGJhc2UgcGF0aCBmb3IgYWRkaXRpb25hbCByZXNvdXJjZXMgbGlrZSB0ZXh0dXJlcy4KCSAqCgkgKiBAc2VlIHNldFBhdGgKCSAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCgkgKiBAcmV0dXJuIHtUSFJFRS5NVExMb2FkZXJ9CgkgKgoJICogQGV4YW1wbGUKCSAqICAgICBtdGxMb2FkZXIuc2V0UGF0aCggJ2Fzc2V0cy9vYmovJyApOwoJICogICAgIG10bExvYWRlci5zZXRSZXNvdXJjZVBhdGgoICdhc3NldHMvdGV4dHVyZXMvJyApOwoJICogICAgIG10bExvYWRlci5sb2FkKCAnbXkubXRsJywgLi4uICk7CgkgKi8KCXNldFJlc291cmNlUGF0aDogZnVuY3Rpb24gKCBwYXRoICkgewoKCQl0aGlzLnJlc291cmNlUGF0aCA9IHBhdGg7CgkJcmV0dXJuIHRoaXM7CgoJfSwKCglzZXRUZXh0dXJlUGF0aDogZnVuY3Rpb24gKCBwYXRoICkgewoKCQljb25zb2xlLndhcm4oICdUSFJFRS5NVExMb2FkZXI6IC5zZXRUZXh0dXJlUGF0aCgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLnNldFJlc291cmNlUGF0aCgpLicgKTsKCQlyZXR1cm4gdGhpcy5zZXRSZXNvdXJjZVBhdGgoIHBhdGggKTsKCgl9LAoKCXNldENyb3NzT3JpZ2luOiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQl0aGlzLmNyb3NzT3JpZ2luID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfSwKCglzZXRNYXRlcmlhbE9wdGlvbnM6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCXRoaXMubWF0ZXJpYWxPcHRpb25zID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfSwKCgkvKioKCSAqIFBhcnNlcyBhIE1UTCBmaWxlLgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IC0gQ29udGVudCBvZiBNVEwgZmlsZQoJICogQHJldHVybiB7VEhSRUUuTVRMTG9hZGVyLk1hdGVyaWFsQ3JlYXRvcn0KCSAqCgkgKiBAc2VlIHNldFBhdGggc2V0UmVzb3VyY2VQYXRoCgkgKgoJICogQG5vdGUgSW4gb3JkZXIgZm9yIHJlbGF0aXZlIHRleHR1cmUgcmVmZXJlbmNlcyB0byByZXNvbHZlIGNvcnJlY3RseQoJICogeW91IG11c3QgY2FsbCBzZXRSZXNvdXJjZVBhdGgoKSBleHBsaWNpdGx5IHByaW9yIHRvIHBhcnNlLgoJICovCglwYXJzZTogZnVuY3Rpb24gKCB0ZXh0LCBwYXRoICkgewoKCQl2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KCAnXG4nICk7CgkJdmFyIGluZm8gPSB7fTsKCQl2YXIgZGVsaW1pdGVyX3BhdHRlcm4gPSAvXHMrLzsKCQl2YXIgbWF0ZXJpYWxzSW5mbyA9IHt9OwoKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkgKysgKSB7CgoJCQl2YXIgbGluZSA9IGxpbmVzWyBpIF07CgkJCWxpbmUgPSBsaW5lLnRyaW0oKTsKCgkJCWlmICggbGluZS5sZW5ndGggPT09IDAgfHwgbGluZS5jaGFyQXQoIDAgKSA9PT0gJyMnICkgewoKCQkJCS8vIEJsYW5rIGxpbmUgb3IgY29tbWVudCBpZ25vcmUKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJdmFyIHBvcyA9IGxpbmUuaW5kZXhPZiggJyAnICk7CgoJCQl2YXIga2V5ID0gKCBwb3MgPj0gMCApID8gbGluZS5zdWJzdHJpbmcoIDAsIHBvcyApIDogbGluZTsKCQkJa2V5ID0ga2V5LnRvTG93ZXJDYXNlKCk7CgoJCQl2YXIgdmFsdWUgPSAoIHBvcyA+PSAwICkgPyBsaW5lLnN1YnN0cmluZyggcG9zICsgMSApIDogJyc7CgkJCXZhbHVlID0gdmFsdWUudHJpbSgpOwoKCQkJaWYgKCBrZXkgPT09ICduZXdtdGwnICkgewoKCQkJCS8vIE5ldyBtYXRlcmlhbAoKCQkJCWluZm8gPSB7IG5hbWU6IHZhbHVlIH07CgkJCQltYXRlcmlhbHNJbmZvWyB2YWx1ZSBdID0gaW5mbzsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBrZXkgPT09ICdrYScgfHwga2V5ID09PSAna2QnIHx8IGtleSA9PT0gJ2tzJyB8fCBrZXkgPT09J2tlJyApIHsKCgkJCQkJdmFyIHNzID0gdmFsdWUuc3BsaXQoIGRlbGltaXRlcl9wYXR0ZXJuLCAzICk7CgkJCQkJaW5mb1sga2V5IF0gPSBbIHBhcnNlRmxvYXQoIHNzWyAwIF0gKSwgcGFyc2VGbG9hdCggc3NbIDEgXSApLCBwYXJzZUZsb2F0KCBzc1sgMiBdICkgXTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpbmZvWyBrZXkgXSA9IHZhbHVlOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQl2YXIgbWF0ZXJpYWxDcmVhdG9yID0gbmV3IFRIUkVFLk1UTExvYWRlci5NYXRlcmlhbENyZWF0b3IoIHRoaXMucmVzb3VyY2VQYXRoIHx8IHBhdGgsIHRoaXMubWF0ZXJpYWxPcHRpb25zICk7CgkJbWF0ZXJpYWxDcmVhdG9yLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CgkJbWF0ZXJpYWxDcmVhdG9yLnNldE1hbmFnZXIoIHRoaXMubWFuYWdlciApOwoJCW1hdGVyaWFsQ3JlYXRvci5zZXRNYXRlcmlhbHMoIG1hdGVyaWFsc0luZm8gKTsKCQlyZXR1cm4gbWF0ZXJpYWxDcmVhdG9yOwoKCX0KCn07CgovKioKICogQ3JlYXRlIGEgbmV3IFRIUkVFLU1UTExvYWRlci5NYXRlcmlhbENyZWF0b3IKICogQHBhcmFtIGJhc2VVcmwgLSBVcmwgcmVsYXRpdmUgdG8gd2hpY2ggdGV4dHVyZXMgYXJlIGxvYWRlZAogKiBAcGFyYW0gb3B0aW9ucyAtIFNldCBvZiBvcHRpb25zIG9uIGhvdyB0byBjb25zdHJ1Y3QgdGhlIG1hdGVyaWFscwogKiAgICAgICAgICAgICAgICAgIHNpZGU6IFdoaWNoIHNpZGUgdG8gYXBwbHkgdGhlIG1hdGVyaWFsCiAqICAgICAgICAgICAgICAgICAgICAgICAgVEhSRUUuRnJvbnRTaWRlIChkZWZhdWx0KSwgVEhSRUUuQmFja1NpZGUsIFRIUkVFLkRvdWJsZVNpZGUKICogICAgICAgICAgICAgICAgICB3cmFwOiBXaGF0IHR5cGUgb2Ygd3JhcHBpbmcgdG8gYXBwbHkgZm9yIHRleHR1cmVzCiAqICAgICAgICAgICAgICAgICAgICAgICAgVEhSRUUuUmVwZWF0V3JhcHBpbmcgKGRlZmF1bHQpLCBUSFJFRS5DbGFtcFRvRWRnZVdyYXBwaW5nLCBUSFJFRS5NaXJyb3JlZFJlcGVhdFdyYXBwaW5nCiAqICAgICAgICAgICAgICAgICAgbm9ybWFsaXplUkdCOiBSR0JzIG5lZWQgdG8gYmUgbm9ybWFsaXplZCB0byAwLTEgZnJvbSAwLTI1NQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdDogZmFsc2UsIGFzc3VtZWQgdG8gYmUgYWxyZWFkeSBub3JtYWxpemVkCiAqICAgICAgICAgICAgICAgICAgaWdub3JlWmVyb1JHQnM6IElnbm9yZSB2YWx1ZXMgb2YgUkdCcyAoS2EsS2QsS3MpIHRoYXQgYXJlIGFsbCAwJ3MKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdDogZmFsc2UKICogQGNvbnN0cnVjdG9yCiAqLwoKVEhSRUUuTVRMTG9hZGVyLk1hdGVyaWFsQ3JlYXRvciA9IGZ1bmN0aW9uICggYmFzZVVybCwgb3B0aW9ucyApIHsKCgl0aGlzLmJhc2VVcmwgPSBiYXNlVXJsIHx8ICcnOwoJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCXRoaXMubWF0ZXJpYWxzSW5mbyA9IHt9OwoJdGhpcy5tYXRlcmlhbHMgPSB7fTsKCXRoaXMubWF0ZXJpYWxzQXJyYXkgPSBbXTsKCXRoaXMubmFtZUxvb2t1cCA9IHt9OwoKCXRoaXMuc2lkZSA9ICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5zaWRlICkgPyB0aGlzLm9wdGlvbnMuc2lkZSA6IFRIUkVFLkZyb250U2lkZTsKCXRoaXMud3JhcCA9ICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy53cmFwICkgPyB0aGlzLm9wdGlvbnMud3JhcCA6IFRIUkVFLlJlcGVhdFdyYXBwaW5nOwoKfTsKClRIUkVFLk1UTExvYWRlci5NYXRlcmlhbENyZWF0b3IucHJvdG90eXBlID0gewoKCWNvbnN0cnVjdG9yOiBUSFJFRS5NVExMb2FkZXIuTWF0ZXJpYWxDcmVhdG9yLAoKCWNyb3NzT3JpZ2luOiAnYW5vbnltb3VzJywKCglzZXRDcm9zc09yaWdpbjogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJdGhpcy5jcm9zc09yaWdpbiA9IHZhbHVlOwoJCXJldHVybiB0aGlzOwoKCX0sCgoJc2V0TWFuYWdlcjogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJdGhpcy5tYW5hZ2VyID0gdmFsdWU7CgoJfSwKCglzZXRNYXRlcmlhbHM6IGZ1bmN0aW9uICggbWF0ZXJpYWxzSW5mbyApIHsKCgkJdGhpcy5tYXRlcmlhbHNJbmZvID0gdGhpcy5jb252ZXJ0KCBtYXRlcmlhbHNJbmZvICk7CgkJdGhpcy5tYXRlcmlhbHMgPSB7fTsKCQl0aGlzLm1hdGVyaWFsc0FycmF5ID0gW107CgkJdGhpcy5uYW1lTG9va3VwID0ge307CgoJfSwKCgljb252ZXJ0OiBmdW5jdGlvbiAoIG1hdGVyaWFsc0luZm8gKSB7CgoJCWlmICggISB0aGlzLm9wdGlvbnMgKSByZXR1cm4gbWF0ZXJpYWxzSW5mbzsKCgkJdmFyIGNvbnZlcnRlZCA9IHt9OwoKCQlmb3IgKCB2YXIgbW4gaW4gbWF0ZXJpYWxzSW5mbyApIHsKCgkJCS8vIENvbnZlcnQgbWF0ZXJpYWxzIGluZm8gaW50byBub3JtYWxpemVkIGZvcm0gYmFzZWQgb24gb3B0aW9ucwoKCQkJdmFyIG1hdCA9IG1hdGVyaWFsc0luZm9bIG1uIF07CgoJCQl2YXIgY292bWF0ID0ge307CgoJCQljb252ZXJ0ZWRbIG1uIF0gPSBjb3ZtYXQ7CgoJCQlmb3IgKCB2YXIgcHJvcCBpbiBtYXQgKSB7CgoJCQkJdmFyIHNhdmUgPSB0cnVlOwoJCQkJdmFyIHZhbHVlID0gbWF0WyBwcm9wIF07CgkJCQl2YXIgbHByb3AgPSBwcm9wLnRvTG93ZXJDYXNlKCk7CgoJCQkJc3dpdGNoICggbHByb3AgKSB7CgoJCQkJCWNhc2UgJ2tkJzoKCQkJCQljYXNlICdrYSc6CgkJCQkJY2FzZSAna3MnOgoKCQkJCQkJLy8gRGlmZnVzZSBjb2xvciAoY29sb3IgdW5kZXIgd2hpdGUgbGlnaHQpIHVzaW5nIFJHQiB2YWx1ZXMKCgkJCQkJCWlmICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5ub3JtYWxpemVSR0IgKSB7CgoJCQkJCQkJdmFsdWUgPSBbIHZhbHVlWyAwIF0gLyAyNTUsIHZhbHVlWyAxIF0gLyAyNTUsIHZhbHVlWyAyIF0gLyAyNTUgXTsKCgkJCQkJCX0KCgkJCQkJCWlmICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5pZ25vcmVaZXJvUkdCcyApIHsKCgkJCQkJCQlpZiAoIHZhbHVlWyAwIF0gPT09IDAgJiYgdmFsdWVbIDEgXSA9PT0gMCAmJiB2YWx1ZVsgMiBdID09PSAwICkgewoKCQkJCQkJCQkvLyBpZ25vcmUKCgkJCQkJCQkJc2F2ZSA9IGZhbHNlOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJCWlmICggc2F2ZSApIHsKCgkJCQkJY292bWF0WyBscHJvcCBdID0gdmFsdWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBjb252ZXJ0ZWQ7CgoJfSwKCglwcmVsb2FkOiBmdW5jdGlvbiAoKSB7CgoJCWZvciAoIHZhciBtbiBpbiB0aGlzLm1hdGVyaWFsc0luZm8gKSB7CgoJCQl0aGlzLmNyZWF0ZSggbW4gKTsKCgkJfQoKCX0sCgoJZ2V0SW5kZXg6IGZ1bmN0aW9uICggbWF0ZXJpYWxOYW1lICkgewoKCQlyZXR1cm4gdGhpcy5uYW1lTG9va3VwWyBtYXRlcmlhbE5hbWUgXTsKCgl9LAoKCWdldEFzQXJyYXk6IGZ1bmN0aW9uICgpIHsKCgkJdmFyIGluZGV4ID0gMDsKCgkJZm9yICggdmFyIG1uIGluIHRoaXMubWF0ZXJpYWxzSW5mbyApIHsKCgkJCXRoaXMubWF0ZXJpYWxzQXJyYXlbIGluZGV4IF0gPSB0aGlzLmNyZWF0ZSggbW4gKTsKCQkJdGhpcy5uYW1lTG9va3VwWyBtbiBdID0gaW5kZXg7CgkJCWluZGV4ICsrOwoKCQl9CgoJCXJldHVybiB0aGlzLm1hdGVyaWFsc0FycmF5OwoKCX0sCgoJY3JlYXRlOiBmdW5jdGlvbiAoIG1hdGVyaWFsTmFtZSApIHsKCgkJaWYgKCB0aGlzLm1hdGVyaWFsc1sgbWF0ZXJpYWxOYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuY3JlYXRlTWF0ZXJpYWxfKCBtYXRlcmlhbE5hbWUgKTsKCgkJfQoKCQlyZXR1cm4gdGhpcy5tYXRlcmlhbHNbIG1hdGVyaWFsTmFtZSBdOwoKCX0sCgoJY3JlYXRlTWF0ZXJpYWxfOiBmdW5jdGlvbiAoIG1hdGVyaWFsTmFtZSApIHsKCgkJLy8gQ3JlYXRlIG1hdGVyaWFsCgoJCXZhciBzY29wZSA9IHRoaXM7CgkJdmFyIG1hdCA9IHRoaXMubWF0ZXJpYWxzSW5mb1sgbWF0ZXJpYWxOYW1lIF07CgkJdmFyIHBhcmFtcyA9IHsKCgkJCW5hbWU6IG1hdGVyaWFsTmFtZSwKCQkJc2lkZTogdGhpcy5zaWRlCgoJCX07CgoJCWZ1bmN0aW9uIHJlc29sdmVVUkwoIGJhc2VVcmwsIHVybCApIHsKCgkJCWlmICggdHlwZW9mIHVybCAhPT0gJ3N0cmluZycgfHwgdXJsID09PSAnJyApCgkJCQlyZXR1cm4gJyc7CgoJCQkvLyBBYnNvbHV0ZSBVUkwKCQkJaWYgKCAvXmh0dHBzPzpcL1wvL2kudGVzdCggdXJsICkgKSByZXR1cm4gdXJsOwoKCQkJcmV0dXJuIGJhc2VVcmwgKyB1cmw7CgoJCX0KCgkJZnVuY3Rpb24gc2V0TWFwRm9yVHlwZSggbWFwVHlwZSwgdmFsdWUgKSB7CgoJCQlpZiAoIHBhcmFtc1sgbWFwVHlwZSBdICkgcmV0dXJuOyAvLyBLZWVwIHRoZSBmaXJzdCBlbmNvdW50ZXJlZCB0ZXh0dXJlCgoJCQl2YXIgdGV4UGFyYW1zID0gc2NvcGUuZ2V0VGV4dHVyZVBhcmFtcyggdmFsdWUsIHBhcmFtcyApOwoJCQl2YXIgbWFwID0gc2NvcGUubG9hZFRleHR1cmUoIHJlc29sdmVVUkwoIHNjb3BlLmJhc2VVcmwsIHRleFBhcmFtcy51cmwgKSApOwoKCQkJbWFwLnJlcGVhdC5jb3B5KCB0ZXhQYXJhbXMuc2NhbGUgKTsKCQkJbWFwLm9mZnNldC5jb3B5KCB0ZXhQYXJhbXMub2Zmc2V0ICk7CgoJCQltYXAud3JhcFMgPSBzY29wZS53cmFwOwoJCQltYXAud3JhcFQgPSBzY29wZS53cmFwOwoKCQkJcGFyYW1zWyBtYXBUeXBlIF0gPSBtYXA7CgoJCX0KCgkJZm9yICggdmFyIHByb3AgaW4gbWF0ICkgewoKCQkJdmFyIHZhbHVlID0gbWF0WyBwcm9wIF07CgkJCXZhciBuOwoKCQkJaWYgKCB2YWx1ZSA9PT0gJycgKSBjb250aW51ZTsKCgkJCXN3aXRjaCAoIHByb3AudG9Mb3dlckNhc2UoKSApIHsKCgkJCQkvLyBOcyBpcyBtYXRlcmlhbCBzcGVjdWxhciBleHBvbmVudAoKCQkJCWNhc2UgJ2tkJzoKCgkJCQkJLy8gRGlmZnVzZSBjb2xvciAoY29sb3IgdW5kZXIgd2hpdGUgbGlnaHQpIHVzaW5nIFJHQiB2YWx1ZXMKCgkJCQkJcGFyYW1zLmNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuZnJvbUFycmF5KCB2YWx1ZSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdrcyc6CgoJCQkJCS8vIFNwZWN1bGFyIGNvbG9yIChjb2xvciB3aGVuIGxpZ2h0IGlzIHJlZmxlY3RlZCBmcm9tIHNoaW55IHN1cmZhY2UpIHVzaW5nIFJHQiB2YWx1ZXMKCQkJCQlwYXJhbXMuc3BlY3VsYXIgPSBuZXcgVEhSRUUuQ29sb3IoKS5mcm9tQXJyYXkoIHZhbHVlICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ2tlJzoKCgkJCQkJLy8gRW1pc3NpdmUgdXNpbmcgUkdCIHZhbHVlcwoJCQkJCXBhcmFtcy5lbWlzc2l2ZSA9IG5ldyBUSFJFRS5Db2xvcigpLmZyb21BcnJheSggdmFsdWUgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWFwX2tkJzoKCgkJCQkJLy8gRGlmZnVzZSB0ZXh0dXJlIG1hcAoKCQkJCQlzZXRNYXBGb3JUeXBlKCAibWFwIiwgdmFsdWUgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWFwX2tzJzoKCgkJCQkJLy8gU3BlY3VsYXIgbWFwCgoJCQkJCXNldE1hcEZvclR5cGUoICJzcGVjdWxhck1hcCIsIHZhbHVlICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ21hcF9rZSc6CgoJCQkJCS8vIEVtaXNzaXZlIG1hcAoKCQkJCQlzZXRNYXBGb3JUeXBlKCAiZW1pc3NpdmVNYXAiLCB2YWx1ZSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdub3JtJzoKCgkJCQkJc2V0TWFwRm9yVHlwZSggIm5vcm1hbE1hcCIsIHZhbHVlICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ21hcF9idW1wJzoKCQkJCWNhc2UgJ2J1bXAnOgoKCQkJCQkvLyBCdW1wIHRleHR1cmUgbWFwCgoJCQkJCXNldE1hcEZvclR5cGUoICJidW1wTWFwIiwgdmFsdWUgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWFwX2QnOgoKCQkJCQkvLyBBbHBoYSBtYXAKCgkJCQkJc2V0TWFwRm9yVHlwZSggImFscGhhTWFwIiwgdmFsdWUgKTsKCQkJCQlwYXJhbXMudHJhbnNwYXJlbnQgPSB0cnVlOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICducyc6CgoJCQkJCS8vIFRoZSBzcGVjdWxhciBleHBvbmVudCAoZGVmaW5lcyB0aGUgZm9jdXMgb2YgdGhlIHNwZWN1bGFyIGhpZ2hsaWdodCkKCQkJCQkvLyBBIGhpZ2ggZXhwb25lbnQgcmVzdWx0cyBpbiBhIHRpZ2h0LCBjb25jZW50cmF0ZWQgaGlnaGxpZ2h0LiBOcyB2YWx1ZXMgbm9ybWFsbHkgcmFuZ2UgZnJvbSAwIHRvIDEwMDAuCgoJCQkJCXBhcmFtcy5zaGluaW5lc3MgPSBwYXJzZUZsb2F0KCB2YWx1ZSApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdkJzoKCQkJCQluID0gcGFyc2VGbG9hdCggdmFsdWUgKTsKCgkJCQkJaWYgKCBuIDwgMSApIHsKCgkJCQkJCXBhcmFtcy5vcGFjaXR5ID0gbjsKCQkJCQkJcGFyYW1zLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCQljYXNlICd0cic6CgkJCQkJbiA9IHBhcnNlRmxvYXQoIHZhbHVlICk7CgoJCQkJCWlmICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5pbnZlcnRUclByb3BlcnR5ICkgbiA9IDEgLSBuOwoKCQkJCQlpZiAoIG4gPiAwICkgewoKCQkJCQkJcGFyYW1zLm9wYWNpdHkgPSAxIC0gbjsKCQkJCQkJcGFyYW1zLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXRoaXMubWF0ZXJpYWxzWyBtYXRlcmlhbE5hbWUgXSA9IG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCggcGFyYW1zICk7CgkJcmV0dXJuIHRoaXMubWF0ZXJpYWxzWyBtYXRlcmlhbE5hbWUgXTsKCgl9LAoKCWdldFRleHR1cmVQYXJhbXM6IGZ1bmN0aW9uICggdmFsdWUsIG1hdFBhcmFtcyApIHsKCgkJdmFyIHRleFBhcmFtcyA9IHsKCgkJCXNjYWxlOiBuZXcgVEhSRUUuVmVjdG9yMiggMSwgMSApLAoJCQlvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKCAwLCAwICkKCgkJIH07CgoJCXZhciBpdGVtcyA9IHZhbHVlLnNwbGl0KCAvXHMrLyApOwoJCXZhciBwb3M7CgoJCXBvcyA9IGl0ZW1zLmluZGV4T2YoICctYm0nICk7CgoJCWlmICggcG9zID49IDAgKSB7CgoJCQltYXRQYXJhbXMuYnVtcFNjYWxlID0gcGFyc2VGbG9hdCggaXRlbXNbIHBvcyArIDEgXSApOwoJCQlpdGVtcy5zcGxpY2UoIHBvcywgMiApOwoKCQl9CgoJCXBvcyA9IGl0ZW1zLmluZGV4T2YoICctcycgKTsKCgkJaWYgKCBwb3MgPj0gMCApIHsKCgkJCXRleFBhcmFtcy5zY2FsZS5zZXQoIHBhcnNlRmxvYXQoIGl0ZW1zWyBwb3MgKyAxIF0gKSwgcGFyc2VGbG9hdCggaXRlbXNbIHBvcyArIDIgXSApICk7CgkJCWl0ZW1zLnNwbGljZSggcG9zLCA0ICk7IC8vIHdlIGV4cGVjdCAzIHBhcmFtZXRlcnMgaGVyZSEKCgkJfQoKCQlwb3MgPSBpdGVtcy5pbmRleE9mKCAnLW8nICk7CgoJCWlmICggcG9zID49IDAgKSB7CgoJCQl0ZXhQYXJhbXMub2Zmc2V0LnNldCggcGFyc2VGbG9hdCggaXRlbXNbIHBvcyArIDEgXSApLCBwYXJzZUZsb2F0KCBpdGVtc1sgcG9zICsgMiBdICkgKTsKCQkJaXRlbXMuc3BsaWNlKCBwb3MsIDQgKTsgLy8gd2UgZXhwZWN0IDMgcGFyYW1ldGVycyBoZXJlIQoKCQl9CgoJCXRleFBhcmFtcy51cmwgPSBpdGVtcy5qb2luKCAnICcgKS50cmltKCk7CgkJcmV0dXJuIHRleFBhcmFtczsKCgl9LAoKCWxvYWRUZXh0dXJlOiBmdW5jdGlvbiAoIHVybCwgbWFwcGluZywgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQl2YXIgdGV4dHVyZTsKCQl2YXIgbG9hZGVyID0gVEhSRUUuTG9hZGVyLkhhbmRsZXJzLmdldCggdXJsICk7CgkJdmFyIG1hbmFnZXIgPSAoIHRoaXMubWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyB0aGlzLm1hbmFnZXIgOiBUSFJFRS5EZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCWlmICggbG9hZGVyID09PSBudWxsICkgewoKCQkJbG9hZGVyID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoIG1hbmFnZXIgKTsKCgkJfQoKCQlpZiAoIGxvYWRlci5zZXRDcm9zc09yaWdpbiApIGxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCXRleHR1cmUgPSBsb2FkZXIubG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKTsKCgkJaWYgKCBtYXBwaW5nICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm1hcHBpbmcgPSBtYXBwaW5nOwoKCQlyZXR1cm4gdGV4dHVyZTsKCgl9Cgp9OwoKfSx7fV0sNDE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbS8KICovCgpUSFJFRS5PQkpMb2FkZXIgPSAoIGZ1bmN0aW9uICgpIHsKCgkvLyBvIG9iamVjdF9uYW1lIHwgZyBncm91cF9uYW1lCgl2YXIgb2JqZWN0X3BhdHRlcm4gPSAvXltvZ11ccyooLispPy87CgkvLyBtdGxsaWIgZmlsZV9yZWZlcmVuY2UKCXZhciBtYXRlcmlhbF9saWJyYXJ5X3BhdHRlcm4gPSAvXm10bGxpYiAvOwoJLy8gdXNlbXRsIG1hdGVyaWFsX25hbWUKCXZhciBtYXRlcmlhbF91c2VfcGF0dGVybiA9IC9edXNlbXRsIC87CgoJZnVuY3Rpb24gUGFyc2VyU3RhdGUoKSB7CgoJCXZhciBzdGF0ZSA9IHsKCQkJb2JqZWN0czogW10sCgkJCW9iamVjdDoge30sCgoJCQl2ZXJ0aWNlczogW10sCgkJCW5vcm1hbHM6IFtdLAoJCQljb2xvcnM6IFtdLAoJCQl1dnM6IFtdLAoKCQkJbWF0ZXJpYWxMaWJyYXJpZXM6IFtdLAoKCQkJc3RhcnRPYmplY3Q6IGZ1bmN0aW9uICggbmFtZSwgZnJvbURlY2xhcmF0aW9uICkgewoKCQkJCS8vIElmIHRoZSBjdXJyZW50IG9iamVjdCAoaW5pdGlhbCBmcm9tIHJlc2V0KSBpcyBub3QgZnJvbSBhIGcvbyBkZWNsYXJhdGlvbiBpbiB0aGUgcGFyc2VkCgkJCQkvLyBmaWxlLiBXZSBuZWVkIHRvIHVzZSBpdCBmb3IgdGhlIGZpcnN0IHBhcnNlZCBnL28gdG8ga2VlcCB0aGluZ3MgaW4gc3luYy4KCQkJCWlmICggdGhpcy5vYmplY3QgJiYgdGhpcy5vYmplY3QuZnJvbURlY2xhcmF0aW9uID09PSBmYWxzZSApIHsKCgkJCQkJdGhpcy5vYmplY3QubmFtZSA9IG5hbWU7CgkJCQkJdGhpcy5vYmplY3QuZnJvbURlY2xhcmF0aW9uID0gKCBmcm9tRGVjbGFyYXRpb24gIT09IGZhbHNlICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQl2YXIgcHJldmlvdXNNYXRlcmlhbCA9ICggdGhpcy5vYmplY3QgJiYgdHlwZW9mIHRoaXMub2JqZWN0LmN1cnJlbnRNYXRlcmlhbCA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMub2JqZWN0LmN1cnJlbnRNYXRlcmlhbCgpIDogdW5kZWZpbmVkICk7CgoJCQkJaWYgKCB0aGlzLm9iamVjdCAmJiB0eXBlb2YgdGhpcy5vYmplY3QuX2ZpbmFsaXplID09PSAnZnVuY3Rpb24nICkgewoKCQkJCQl0aGlzLm9iamVjdC5fZmluYWxpemUoIHRydWUgKTsKCgkJCQl9CgoJCQkJdGhpcy5vYmplY3QgPSB7CgkJCQkJbmFtZTogbmFtZSB8fCAnJywKCQkJCQlmcm9tRGVjbGFyYXRpb246ICggZnJvbURlY2xhcmF0aW9uICE9PSBmYWxzZSApLAoKCQkJCQlnZW9tZXRyeTogewoJCQkJCQl2ZXJ0aWNlczogW10sCgkJCQkJCW5vcm1hbHM6IFtdLAoJCQkJCQljb2xvcnM6IFtdLAoJCQkJCQl1dnM6IFtdCgkJCQkJfSwKCQkJCQltYXRlcmlhbHM6IFtdLAoJCQkJCXNtb290aDogdHJ1ZSwKCgkJCQkJc3RhcnRNYXRlcmlhbDogZnVuY3Rpb24gKCBuYW1lLCBsaWJyYXJpZXMgKSB7CgoJCQkJCQl2YXIgcHJldmlvdXMgPSB0aGlzLl9maW5hbGl6ZSggZmFsc2UgKTsKCgkJCQkJCS8vIE5ldyB1c2VtdGwgZGVjbGFyYXRpb24gb3ZlcndyaXRlcyBhbiBpbmhlcml0ZWQgbWF0ZXJpYWwsIGV4Y2VwdCBpZiBmYWNlcyB3ZXJlIGRlY2xhcmVkCgkJCQkJCS8vIGFmdGVyIHRoZSBtYXRlcmlhbCwgdGhlbiBpdCBtdXN0IGJlIHByZXNlcnZlZCBmb3IgcHJvcGVyIE11bHRpTWF0ZXJpYWwgY29udGludWF0aW9uLgoJCQkJCQlpZiAoIHByZXZpb3VzICYmICggcHJldmlvdXMuaW5oZXJpdGVkIHx8IHByZXZpb3VzLmdyb3VwQ291bnQgPD0gMCApICkgewoKCQkJCQkJCXRoaXMubWF0ZXJpYWxzLnNwbGljZSggcHJldmlvdXMuaW5kZXgsIDEgKTsKCgkJCQkJCX0KCgkJCQkJCXZhciBtYXRlcmlhbCA9IHsKCQkJCQkJCWluZGV4OiB0aGlzLm1hdGVyaWFscy5sZW5ndGgsCgkJCQkJCQluYW1lOiBuYW1lIHx8ICcnLAoJCQkJCQkJbXRsbGliOiAoIEFycmF5LmlzQXJyYXkoIGxpYnJhcmllcyApICYmIGxpYnJhcmllcy5sZW5ndGggPiAwID8gbGlicmFyaWVzWyBsaWJyYXJpZXMubGVuZ3RoIC0gMSBdIDogJycgKSwKCQkJCQkJCXNtb290aDogKCBwcmV2aW91cyAhPT0gdW5kZWZpbmVkID8gcHJldmlvdXMuc21vb3RoIDogdGhpcy5zbW9vdGggKSwKCQkJCQkJCWdyb3VwU3RhcnQ6ICggcHJldmlvdXMgIT09IHVuZGVmaW5lZCA/IHByZXZpb3VzLmdyb3VwRW5kIDogMCApLAoJCQkJCQkJZ3JvdXBFbmQ6IC0gMSwKCQkJCQkJCWdyb3VwQ291bnQ6IC0gMSwKCQkJCQkJCWluaGVyaXRlZDogZmFsc2UsCgoJCQkJCQkJY2xvbmU6IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQkJCQkJCXZhciBjbG9uZWQgPSB7CgkJCQkJCQkJCWluZGV4OiAoIHR5cGVvZiBpbmRleCA9PT0gJ251bWJlcicgPyBpbmRleCA6IHRoaXMuaW5kZXggKSwKCQkJCQkJCQkJbmFtZTogdGhpcy5uYW1lLAoJCQkJCQkJCQltdGxsaWI6IHRoaXMubXRsbGliLAoJCQkJCQkJCQlzbW9vdGg6IHRoaXMuc21vb3RoLAoJCQkJCQkJCQlncm91cFN0YXJ0OiAwLAoJCQkJCQkJCQlncm91cEVuZDogLSAxLAoJCQkJCQkJCQlncm91cENvdW50OiAtIDEsCgkJCQkJCQkJCWluaGVyaXRlZDogZmFsc2UKCQkJCQkJCQl9OwoJCQkJCQkJCWNsb25lZC5jbG9uZSA9IHRoaXMuY2xvbmUuYmluZCggY2xvbmVkICk7CgkJCQkJCQkJcmV0dXJuIGNsb25lZDsKCgkJCQkJCQl9CgkJCQkJCX07CgoJCQkJCQl0aGlzLm1hdGVyaWFscy5wdXNoKCBtYXRlcmlhbCApOwoKCQkJCQkJcmV0dXJuIG1hdGVyaWFsOwoKCQkJCQl9LAoKCQkJCQljdXJyZW50TWF0ZXJpYWw6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCWlmICggdGhpcy5tYXRlcmlhbHMubGVuZ3RoID4gMCApIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy5tYXRlcmlhbHNbIHRoaXMubWF0ZXJpYWxzLmxlbmd0aCAtIDEgXTsKCgkJCQkJCX0KCgkJCQkJCXJldHVybiB1bmRlZmluZWQ7CgoJCQkJCX0sCgoJCQkJCV9maW5hbGl6ZTogZnVuY3Rpb24gKCBlbmQgKSB7CgoJCQkJCQl2YXIgbGFzdE11bHRpTWF0ZXJpYWwgPSB0aGlzLmN1cnJlbnRNYXRlcmlhbCgpOwoJCQkJCQlpZiAoIGxhc3RNdWx0aU1hdGVyaWFsICYmIGxhc3RNdWx0aU1hdGVyaWFsLmdyb3VwRW5kID09PSAtIDEgKSB7CgoJCQkJCQkJbGFzdE11bHRpTWF0ZXJpYWwuZ3JvdXBFbmQgPSB0aGlzLmdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aCAvIDM7CgkJCQkJCQlsYXN0TXVsdGlNYXRlcmlhbC5ncm91cENvdW50ID0gbGFzdE11bHRpTWF0ZXJpYWwuZ3JvdXBFbmQgLSBsYXN0TXVsdGlNYXRlcmlhbC5ncm91cFN0YXJ0OwoJCQkJCQkJbGFzdE11bHRpTWF0ZXJpYWwuaW5oZXJpdGVkID0gZmFsc2U7CgoJCQkJCQl9CgoJCQkJCQkvLyBJZ25vcmUgb2JqZWN0cyB0YWlsIG1hdGVyaWFscyBpZiBubyBmYWNlIGRlY2xhcmF0aW9ucyBmb2xsb3dlZCB0aGVtIGJlZm9yZSBhIG5ldyBvL2cgc3RhcnRlZC4KCQkJCQkJaWYgKCBlbmQgJiYgdGhpcy5tYXRlcmlhbHMubGVuZ3RoID4gMSApIHsKCgkJCQkJCQlmb3IgKCB2YXIgbWkgPSB0aGlzLm1hdGVyaWFscy5sZW5ndGggLSAxOyBtaSA+PSAwOyBtaSAtLSApIHsKCgkJCQkJCQkJaWYgKCB0aGlzLm1hdGVyaWFsc1sgbWkgXS5ncm91cENvdW50IDw9IDAgKSB7CgoJCQkJCQkJCQl0aGlzLm1hdGVyaWFscy5zcGxpY2UoIG1pLCAxICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQkvLyBHdWFyYW50ZWUgYXQgbGVhc3Qgb25lIGVtcHR5IG1hdGVyaWFsLCB0aGlzIG1ha2VzIHRoZSBjcmVhdGlvbiBsYXRlciBtb3JlIHN0cmFpZ2h0IGZvcndhcmQuCgkJCQkJCWlmICggZW5kICYmIHRoaXMubWF0ZXJpYWxzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkJCQl0aGlzLm1hdGVyaWFscy5wdXNoKCB7CgkJCQkJCQkJbmFtZTogJycsCgkJCQkJCQkJc21vb3RoOiB0aGlzLnNtb290aAoJCQkJCQkJfSApOwoKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIGxhc3RNdWx0aU1hdGVyaWFsOwoKCQkJCQl9CgkJCQl9OwoKCQkJCS8vIEluaGVyaXQgcHJldmlvdXMgb2JqZWN0cyBtYXRlcmlhbC4KCQkJCS8vIFNwZWMgdGVsbHMgdXMgdGhhdCBhIGRlY2xhcmVkIG1hdGVyaWFsIG11c3QgYmUgc2V0IHRvIGFsbCBvYmplY3RzIHVudGlsIGEgbmV3IG1hdGVyaWFsIGlzIGRlY2xhcmVkLgoJCQkJLy8gSWYgYSB1c2VtdGwgZGVjbGFyYXRpb24gaXMgZW5jb3VudGVyZWQgd2hpbGUgdGhpcyBuZXcgb2JqZWN0IGlzIGJlaW5nIHBhcnNlZCwgaXQgd2lsbAoJCQkJLy8gb3ZlcndyaXRlIHRoZSBpbmhlcml0ZWQgbWF0ZXJpYWwuIEV4Y2VwdGlvbiBiZWluZyB0aGF0IHRoZXJlIHdhcyBhbHJlYWR5IGZhY2UgZGVjbGFyYXRpb25zCgkJCQkvLyB0byB0aGUgaW5oZXJpdGVkIG1hdGVyaWFsLCB0aGVuIGl0IHdpbGwgYmUgcHJlc2VydmVkIGZvciBwcm9wZXIgTXVsdGlNYXRlcmlhbCBjb250aW51YXRpb24uCgoJCQkJaWYgKCBwcmV2aW91c01hdGVyaWFsICYmIHByZXZpb3VzTWF0ZXJpYWwubmFtZSAmJiB0eXBlb2YgcHJldmlvdXNNYXRlcmlhbC5jbG9uZSA9PT0gJ2Z1bmN0aW9uJyApIHsKCgkJCQkJdmFyIGRlY2xhcmVkID0gcHJldmlvdXNNYXRlcmlhbC5jbG9uZSggMCApOwoJCQkJCWRlY2xhcmVkLmluaGVyaXRlZCA9IHRydWU7CgkJCQkJdGhpcy5vYmplY3QubWF0ZXJpYWxzLnB1c2goIGRlY2xhcmVkICk7CgoJCQkJfQoKCQkJCXRoaXMub2JqZWN0cy5wdXNoKCB0aGlzLm9iamVjdCApOwoKCQkJfSwKCgkJCWZpbmFsaXplOiBmdW5jdGlvbiAoKSB7CgoJCQkJaWYgKCB0aGlzLm9iamVjdCAmJiB0eXBlb2YgdGhpcy5vYmplY3QuX2ZpbmFsaXplID09PSAnZnVuY3Rpb24nICkgewoKCQkJCQl0aGlzLm9iamVjdC5fZmluYWxpemUoIHRydWUgKTsKCgkJCQl9CgoJCQl9LAoKCQkJcGFyc2VWZXJ0ZXhJbmRleDogZnVuY3Rpb24gKCB2YWx1ZSwgbGVuICkgewoKCQkJCXZhciBpbmRleCA9IHBhcnNlSW50KCB2YWx1ZSwgMTAgKTsKCQkJCXJldHVybiAoIGluZGV4ID49IDAgPyBpbmRleCAtIDEgOiBpbmRleCArIGxlbiAvIDMgKSAqIDM7CgoJCQl9LAoKCQkJcGFyc2VOb3JtYWxJbmRleDogZnVuY3Rpb24gKCB2YWx1ZSwgbGVuICkgewoKCQkJCXZhciBpbmRleCA9IHBhcnNlSW50KCB2YWx1ZSwgMTAgKTsKCQkJCXJldHVybiAoIGluZGV4ID49IDAgPyBpbmRleCAtIDEgOiBpbmRleCArIGxlbiAvIDMgKSAqIDM7CgoJCQl9LAoKCQkJcGFyc2VVVkluZGV4OiBmdW5jdGlvbiAoIHZhbHVlLCBsZW4gKSB7CgoJCQkJdmFyIGluZGV4ID0gcGFyc2VJbnQoIHZhbHVlLCAxMCApOwoJCQkJcmV0dXJuICggaW5kZXggPj0gMCA/IGluZGV4IC0gMSA6IGluZGV4ICsgbGVuIC8gMiApICogMjsKCgkJCX0sCgoJCQlhZGRWZXJ0ZXg6IGZ1bmN0aW9uICggYSwgYiwgYyApIHsKCgkJCQl2YXIgc3JjID0gdGhpcy52ZXJ0aWNlczsKCQkJCXZhciBkc3QgPSB0aGlzLm9iamVjdC5nZW9tZXRyeS52ZXJ0aWNlczsKCgkJCQlkc3QucHVzaCggc3JjWyBhICsgMCBdLCBzcmNbIGEgKyAxIF0sIHNyY1sgYSArIDIgXSApOwoJCQkJZHN0LnB1c2goIHNyY1sgYiArIDAgXSwgc3JjWyBiICsgMSBdLCBzcmNbIGIgKyAyIF0gKTsKCQkJCWRzdC5wdXNoKCBzcmNbIGMgKyAwIF0sIHNyY1sgYyArIDEgXSwgc3JjWyBjICsgMiBdICk7CgoJCQl9LAoKCQkJYWRkVmVydGV4UG9pbnQ6IGZ1bmN0aW9uICggYSApIHsKCgkJCQl2YXIgc3JjID0gdGhpcy52ZXJ0aWNlczsKCQkJCXZhciBkc3QgPSB0aGlzLm9iamVjdC5nZW9tZXRyeS52ZXJ0aWNlczsKCgkJCQlkc3QucHVzaCggc3JjWyBhICsgMCBdLCBzcmNbIGEgKyAxIF0sIHNyY1sgYSArIDIgXSApOwoKCQkJfSwKCgkJCWFkZFZlcnRleExpbmU6IGZ1bmN0aW9uICggYSApIHsKCgkJCQl2YXIgc3JjID0gdGhpcy52ZXJ0aWNlczsKCQkJCXZhciBkc3QgPSB0aGlzLm9iamVjdC5nZW9tZXRyeS52ZXJ0aWNlczsKCgkJCQlkc3QucHVzaCggc3JjWyBhICsgMCBdLCBzcmNbIGEgKyAxIF0sIHNyY1sgYSArIDIgXSApOwoKCQkJfSwKCgkJCWFkZE5vcm1hbDogZnVuY3Rpb24gKCBhLCBiLCBjICkgewoKCQkJCXZhciBzcmMgPSB0aGlzLm5vcm1hbHM7CgkJCQl2YXIgZHN0ID0gdGhpcy5vYmplY3QuZ2VvbWV0cnkubm9ybWFsczsKCgkJCQlkc3QucHVzaCggc3JjWyBhICsgMCBdLCBzcmNbIGEgKyAxIF0sIHNyY1sgYSArIDIgXSApOwoJCQkJZHN0LnB1c2goIHNyY1sgYiArIDAgXSwgc3JjWyBiICsgMSBdLCBzcmNbIGIgKyAyIF0gKTsKCQkJCWRzdC5wdXNoKCBzcmNbIGMgKyAwIF0sIHNyY1sgYyArIDEgXSwgc3JjWyBjICsgMiBdICk7CgoJCQl9LAoKCQkJYWRkQ29sb3I6IGZ1bmN0aW9uICggYSwgYiwgYyApIHsKCgkJCQl2YXIgc3JjID0gdGhpcy5jb2xvcnM7CgkJCQl2YXIgZHN0ID0gdGhpcy5vYmplY3QuZ2VvbWV0cnkuY29sb3JzOwoKCQkJCWRzdC5wdXNoKCBzcmNbIGEgKyAwIF0sIHNyY1sgYSArIDEgXSwgc3JjWyBhICsgMiBdICk7CgkJCQlkc3QucHVzaCggc3JjWyBiICsgMCBdLCBzcmNbIGIgKyAxIF0sIHNyY1sgYiArIDIgXSApOwoJCQkJZHN0LnB1c2goIHNyY1sgYyArIDAgXSwgc3JjWyBjICsgMSBdLCBzcmNbIGMgKyAyIF0gKTsKCgkJCX0sCgoJCQlhZGRVVjogZnVuY3Rpb24gKCBhLCBiLCBjICkgewoKCQkJCXZhciBzcmMgPSB0aGlzLnV2czsKCQkJCXZhciBkc3QgPSB0aGlzLm9iamVjdC5nZW9tZXRyeS51dnM7CgoJCQkJZHN0LnB1c2goIHNyY1sgYSArIDAgXSwgc3JjWyBhICsgMSBdICk7CgkJCQlkc3QucHVzaCggc3JjWyBiICsgMCBdLCBzcmNbIGIgKyAxIF0gKTsKCQkJCWRzdC5wdXNoKCBzcmNbIGMgKyAwIF0sIHNyY1sgYyArIDEgXSApOwoKCQkJfSwKCgkJCWFkZFVWTGluZTogZnVuY3Rpb24gKCBhICkgewoKCQkJCXZhciBzcmMgPSB0aGlzLnV2czsKCQkJCXZhciBkc3QgPSB0aGlzLm9iamVjdC5nZW9tZXRyeS51dnM7CgoJCQkJZHN0LnB1c2goIHNyY1sgYSArIDAgXSwgc3JjWyBhICsgMSBdICk7CgoJCQl9LAoKCQkJYWRkRmFjZTogZnVuY3Rpb24gKCBhLCBiLCBjLCB1YSwgdWIsIHVjLCBuYSwgbmIsIG5jICkgewoKCQkJCXZhciB2TGVuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CgoJCQkJdmFyIGlhID0gdGhpcy5wYXJzZVZlcnRleEluZGV4KCBhLCB2TGVuICk7CgkJCQl2YXIgaWIgPSB0aGlzLnBhcnNlVmVydGV4SW5kZXgoIGIsIHZMZW4gKTsKCQkJCXZhciBpYyA9IHRoaXMucGFyc2VWZXJ0ZXhJbmRleCggYywgdkxlbiApOwoKCQkJCXRoaXMuYWRkVmVydGV4KCBpYSwgaWIsIGljICk7CgoJCQkJaWYgKCB1YSAhPT0gdW5kZWZpbmVkICYmIHVhICE9PSAnJyApIHsKCgkJCQkJdmFyIHV2TGVuID0gdGhpcy51dnMubGVuZ3RoOwoJCQkJCWlhID0gdGhpcy5wYXJzZVVWSW5kZXgoIHVhLCB1dkxlbiApOwoJCQkJCWliID0gdGhpcy5wYXJzZVVWSW5kZXgoIHViLCB1dkxlbiApOwoJCQkJCWljID0gdGhpcy5wYXJzZVVWSW5kZXgoIHVjLCB1dkxlbiApOwoJCQkJCXRoaXMuYWRkVVYoIGlhLCBpYiwgaWMgKTsKCgkJCQl9CgoJCQkJaWYgKCBuYSAhPT0gdW5kZWZpbmVkICYmIG5hICE9PSAnJyApIHsKCgkJCQkJLy8gTm9ybWFscyBhcmUgbWFueSB0aW1lcyB0aGUgc2FtZS4gSWYgc28sIHNraXAgZnVuY3Rpb24gY2FsbCBhbmQgcGFyc2VJbnQuCgkJCQkJdmFyIG5MZW4gPSB0aGlzLm5vcm1hbHMubGVuZ3RoOwoJCQkJCWlhID0gdGhpcy5wYXJzZU5vcm1hbEluZGV4KCBuYSwgbkxlbiApOwoKCQkJCQlpYiA9IG5hID09PSBuYiA/IGlhIDogdGhpcy5wYXJzZU5vcm1hbEluZGV4KCBuYiwgbkxlbiApOwoJCQkJCWljID0gbmEgPT09IG5jID8gaWEgOiB0aGlzLnBhcnNlTm9ybWFsSW5kZXgoIG5jLCBuTGVuICk7CgoJCQkJCXRoaXMuYWRkTm9ybWFsKCBpYSwgaWIsIGljICk7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5jb2xvcnMubGVuZ3RoID4gMCApIHsKCgkJCQkJdGhpcy5hZGRDb2xvciggaWEsIGliLCBpYyApOwoKCQkJCX0KCgkJCX0sCgoJCQlhZGRQb2ludEdlb21ldHJ5OiBmdW5jdGlvbiAoIHZlcnRpY2VzICkgewoKCQkJCXRoaXMub2JqZWN0Lmdlb21ldHJ5LnR5cGUgPSAnUG9pbnRzJzsKCgkJCQl2YXIgdkxlbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwoKCQkJCWZvciAoIHZhciB2aSA9IDAsIGwgPSB2ZXJ0aWNlcy5sZW5ndGg7IHZpIDwgbDsgdmkgKysgKSB7CgoJCQkJCXRoaXMuYWRkVmVydGV4UG9pbnQoIHRoaXMucGFyc2VWZXJ0ZXhJbmRleCggdmVydGljZXNbIHZpIF0sIHZMZW4gKSApOwoKCQkJCX0KCgkJCX0sCgoJCQlhZGRMaW5lR2VvbWV0cnk6IGZ1bmN0aW9uICggdmVydGljZXMsIHV2cyApIHsKCgkJCQl0aGlzLm9iamVjdC5nZW9tZXRyeS50eXBlID0gJ0xpbmUnOwoKCQkJCXZhciB2TGVuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CgkJCQl2YXIgdXZMZW4gPSB0aGlzLnV2cy5sZW5ndGg7CgoJCQkJZm9yICggdmFyIHZpID0gMCwgbCA9IHZlcnRpY2VzLmxlbmd0aDsgdmkgPCBsOyB2aSArKyApIHsKCgkJCQkJdGhpcy5hZGRWZXJ0ZXhMaW5lKCB0aGlzLnBhcnNlVmVydGV4SW5kZXgoIHZlcnRpY2VzWyB2aSBdLCB2TGVuICkgKTsKCgkJCQl9CgoJCQkJZm9yICggdmFyIHV2aSA9IDAsIGwgPSB1dnMubGVuZ3RoOyB1dmkgPCBsOyB1dmkgKysgKSB7CgoJCQkJCXRoaXMuYWRkVVZMaW5lKCB0aGlzLnBhcnNlVVZJbmRleCggdXZzWyB1dmkgXSwgdXZMZW4gKSApOwoKCQkJCX0KCgkJCX0KCgkJfTsKCgkJc3RhdGUuc3RhcnRPYmplY3QoICcnLCBmYWxzZSApOwoKCQlyZXR1cm4gc3RhdGU7CgoJfQoKCS8vCgoJZnVuY3Rpb24gT0JKTG9hZGVyKCBtYW5hZ2VyICkgewoKCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IFRIUkVFLkRlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCgkJdGhpcy5tYXRlcmlhbHMgPSBudWxsOwoKCX0KCglPQkpMb2FkZXIucHJvdG90eXBlID0gewoKCQljb25zdHJ1Y3RvcjogT0JKTG9hZGVyLAoKCQlsb2FkOiBmdW5jdGlvbiAoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQkJdmFyIHNjb3BlID0gdGhpczsKCgkJCXZhciBsb2FkZXIgPSBuZXcgVEhSRUUuRmlsZUxvYWRlciggc2NvcGUubWFuYWdlciApOwoJCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggdGV4dCApIHsKCgkJCQlvbkxvYWQoIHNjb3BlLnBhcnNlKCB0ZXh0ICkgKTsKCgkJCX0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKTsKCgkJfSwKCgkJc2V0UGF0aDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXRoaXMucGF0aCA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0sCgoJCXNldE1hdGVyaWFsczogZnVuY3Rpb24gKCBtYXRlcmlhbHMgKSB7CgoJCQl0aGlzLm1hdGVyaWFscyA9IG1hdGVyaWFsczsKCgkJCXJldHVybiB0aGlzOwoKCQl9LAoKCQlwYXJzZTogZnVuY3Rpb24gKCB0ZXh0ICkgewoKCQkJY29uc29sZS50aW1lKCAnT0JKTG9hZGVyJyApOwoKCQkJdmFyIHN0YXRlID0gbmV3IFBhcnNlclN0YXRlKCk7CgoJCQlpZiAoIHRleHQuaW5kZXhPZiggJ1xyXG4nICkgIT09IC0gMSApIHsKCgkJCQkvLyBUaGlzIGlzIGZhc3RlciB0aGFuIFN0cmluZy5zcGxpdCB3aXRoIHJlZ2V4IHRoYXQgc3BsaXRzIG9uIGJvdGgKCQkJCXRleHQgPSB0ZXh0LnJlcGxhY2UoIC9cclxuL2csICdcbicgKTsKCgkJCX0KCgkJCWlmICggdGV4dC5pbmRleE9mKCAnXFxcbicgKSAhPT0gLSAxICkgewoKCQkJCS8vIGpvaW4gbGluZXMgc2VwYXJhdGVkIGJ5IGEgbGluZSBjb250aW51YXRpb24gY2hhcmFjdGVyIChcKQoJCQkJdGV4dCA9IHRleHQucmVwbGFjZSggL1xcXG4vZywgJycgKTsKCgkJCX0KCgkJCXZhciBsaW5lcyA9IHRleHQuc3BsaXQoICdcbicgKTsKCQkJdmFyIGxpbmUgPSAnJywgbGluZUZpcnN0Q2hhciA9ICcnOwoJCQl2YXIgbGluZUxlbmd0aCA9IDA7CgkJCXZhciByZXN1bHQgPSBbXTsKCgkJCS8vIEZhc3RlciB0byBqdXN0IHRyaW0gbGVmdCBzaWRlIG9mIHRoZSBsaW5lLiBVc2UgaWYgYXZhaWxhYmxlLgoJCQl2YXIgdHJpbUxlZnQgPSAoIHR5cGVvZiAnJy50cmltTGVmdCA9PT0gJ2Z1bmN0aW9uJyApOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gbGluZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlsaW5lID0gbGluZXNbIGkgXTsKCgkJCQlsaW5lID0gdHJpbUxlZnQgPyBsaW5lLnRyaW1MZWZ0KCkgOiBsaW5lLnRyaW0oKTsKCgkJCQlsaW5lTGVuZ3RoID0gbGluZS5sZW5ndGg7CgoJCQkJaWYgKCBsaW5lTGVuZ3RoID09PSAwICkgY29udGludWU7CgoJCQkJbGluZUZpcnN0Q2hhciA9IGxpbmUuY2hhckF0KCAwICk7CgoJCQkJLy8gQHRvZG8gaW52b2tlIHBhc3NlZCBpbiBoYW5kbGVyIGlmIGFueQoJCQkJaWYgKCBsaW5lRmlyc3RDaGFyID09PSAnIycgKSBjb250aW51ZTsKCgkJCQlpZiAoIGxpbmVGaXJzdENoYXIgPT09ICd2JyApIHsKCgkJCQkJdmFyIGRhdGEgPSBsaW5lLnNwbGl0KCAvXHMrLyApOwoKCQkJCQlzd2l0Y2ggKCBkYXRhWyAwIF0gKSB7CgoJCQkJCQljYXNlICd2JzoKCQkJCQkJCXN0YXRlLnZlcnRpY2VzLnB1c2goCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMSBdICksCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMiBdICksCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMyBdICkKCQkJCQkJCSk7CgkJCQkJCQlpZiAoIGRhdGEubGVuZ3RoID09PSA4ICkgewoKCQkJCQkJCQlzdGF0ZS5jb2xvcnMucHVzaCgKCQkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgNCBdICksCgkJCQkJCQkJCXBhcnNlRmxvYXQoIGRhdGFbIDUgXSApLAoJCQkJCQkJCQlwYXJzZUZsb2F0KCBkYXRhWyA2IF0gKQoKCQkJCQkJCQkpOwoKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICd2bic6CgkJCQkJCQlzdGF0ZS5ub3JtYWxzLnB1c2goCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMSBdICksCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMiBdICksCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMyBdICkKCQkJCQkJCSk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAndnQnOgoJCQkJCQkJc3RhdGUudXZzLnB1c2goCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMSBdICksCgkJCQkJCQkJcGFyc2VGbG9hdCggZGF0YVsgMiBdICkKCQkJCQkJCSk7CgkJCQkJCQlicmVhazsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIGxpbmVGaXJzdENoYXIgPT09ICdmJyApIHsKCgkJCQkJdmFyIGxpbmVEYXRhID0gbGluZS5zdWJzdHIoIDEgKS50cmltKCk7CgkJCQkJdmFyIHZlcnRleERhdGEgPSBsaW5lRGF0YS5zcGxpdCggL1xzKy8gKTsKCQkJCQl2YXIgZmFjZVZlcnRpY2VzID0gW107CgoJCQkJCS8vIFBhcnNlIHRoZSBmYWNlIHZlcnRleCBkYXRhIGludG8gYW4gZWFzeSB0byB3b3JrIHdpdGggZm9ybWF0CgoJCQkJCWZvciAoIHZhciBqID0gMCwgamwgPSB2ZXJ0ZXhEYXRhLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJdmFyIHZlcnRleCA9IHZlcnRleERhdGFbIGogXTsKCgkJCQkJCWlmICggdmVydGV4Lmxlbmd0aCA+IDAgKSB7CgoJCQkJCQkJdmFyIHZlcnRleFBhcnRzID0gdmVydGV4LnNwbGl0KCAnLycgKTsKCQkJCQkJCWZhY2VWZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXhQYXJ0cyApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCS8vIERyYXcgYW4gZWRnZSBiZXR3ZWVuIHRoZSBmaXJzdCB2ZXJ0ZXggYW5kIGFsbCBzdWJzZXF1ZW50IHZlcnRpY2VzIHRvIGZvcm0gYW4gbi1nb24KCgkJCQkJdmFyIHYxID0gZmFjZVZlcnRpY2VzWyAwIF07CgoJCQkJCWZvciAoIHZhciBqID0gMSwgamwgPSBmYWNlVmVydGljZXMubGVuZ3RoIC0gMTsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJdmFyIHYyID0gZmFjZVZlcnRpY2VzWyBqIF07CgkJCQkJCXZhciB2MyA9IGZhY2VWZXJ0aWNlc1sgaiArIDEgXTsKCgkJCQkJCXN0YXRlLmFkZEZhY2UoCgkJCQkJCQl2MVsgMCBdLCB2MlsgMCBdLCB2M1sgMCBdLAoJCQkJCQkJdjFbIDEgXSwgdjJbIDEgXSwgdjNbIDEgXSwKCQkJCQkJCXYxWyAyIF0sIHYyWyAyIF0sIHYzWyAyIF0KCQkJCQkJKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIGxpbmVGaXJzdENoYXIgPT09ICdsJyApIHsKCgkJCQkJdmFyIGxpbmVQYXJ0cyA9IGxpbmUuc3Vic3RyaW5nKCAxICkudHJpbSgpLnNwbGl0KCAiICIgKTsKCQkJCQl2YXIgbGluZVZlcnRpY2VzID0gW10sIGxpbmVVVnMgPSBbXTsKCgkJCQkJaWYgKCBsaW5lLmluZGV4T2YoICIvIiApID09PSAtIDEgKSB7CgoJCQkJCQlsaW5lVmVydGljZXMgPSBsaW5lUGFydHM7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlmb3IgKCB2YXIgbGkgPSAwLCBsbGVuID0gbGluZVBhcnRzLmxlbmd0aDsgbGkgPCBsbGVuOyBsaSArKyApIHsKCgkJCQkJCQl2YXIgcGFydHMgPSBsaW5lUGFydHNbIGxpIF0uc3BsaXQoICIvIiApOwoKCQkJCQkJCWlmICggcGFydHNbIDAgXSAhPT0gIiIgKSBsaW5lVmVydGljZXMucHVzaCggcGFydHNbIDAgXSApOwoJCQkJCQkJaWYgKCBwYXJ0c1sgMSBdICE9PSAiIiApIGxpbmVVVnMucHVzaCggcGFydHNbIDEgXSApOwoKCQkJCQkJfQoKCQkJCQl9CgkJCQkJc3RhdGUuYWRkTGluZUdlb21ldHJ5KCBsaW5lVmVydGljZXMsIGxpbmVVVnMgKTsKCgkJCQl9IGVsc2UgaWYgKCBsaW5lRmlyc3RDaGFyID09PSAncCcgKSB7CgoJCQkJCXZhciBsaW5lRGF0YSA9IGxpbmUuc3Vic3RyKCAxICkudHJpbSgpOwoJCQkJCXZhciBwb2ludERhdGEgPSBsaW5lRGF0YS5zcGxpdCggIiAiICk7CgoJCQkJCXN0YXRlLmFkZFBvaW50R2VvbWV0cnkoIHBvaW50RGF0YSApOwoKCQkJCX0gZWxzZSBpZiAoICggcmVzdWx0ID0gb2JqZWN0X3BhdHRlcm4uZXhlYyggbGluZSApICkgIT09IG51bGwgKSB7CgoJCQkJCS8vIG8gb2JqZWN0X25hbWUKCQkJCQkvLyBvcgoJCQkJCS8vIGcgZ3JvdXBfbmFtZQoKCQkJCQkvLyBXT1JLQVJPVU5EOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0yODY5CgkJCQkJLy8gdmFyIG5hbWUgPSByZXN1bHRbIDAgXS5zdWJzdHIoIDEgKS50cmltKCk7CgkJCQkJdmFyIG5hbWUgPSAoICIgIiArIHJlc3VsdFsgMCBdLnN1YnN0ciggMSApLnRyaW0oKSApLnN1YnN0ciggMSApOwoKCQkJCQlzdGF0ZS5zdGFydE9iamVjdCggbmFtZSApOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsX3VzZV9wYXR0ZXJuLnRlc3QoIGxpbmUgKSApIHsKCgkJCQkJLy8gbWF0ZXJpYWwKCgkJCQkJc3RhdGUub2JqZWN0LnN0YXJ0TWF0ZXJpYWwoIGxpbmUuc3Vic3RyaW5nKCA3ICkudHJpbSgpLCBzdGF0ZS5tYXRlcmlhbExpYnJhcmllcyApOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsX2xpYnJhcnlfcGF0dGVybi50ZXN0KCBsaW5lICkgKSB7CgoJCQkJCS8vIG10bCBmaWxlCgoJCQkJCXN0YXRlLm1hdGVyaWFsTGlicmFyaWVzLnB1c2goIGxpbmUuc3Vic3RyaW5nKCA3ICkudHJpbSgpICk7CgoJCQkJfSBlbHNlIGlmICggbGluZUZpcnN0Q2hhciA9PT0gJ3MnICkgewoKCQkJCQlyZXN1bHQgPSBsaW5lLnNwbGl0KCAnICcgKTsKCgkJCQkJLy8gc21vb3RoIHNoYWRpbmcKCgkJCQkJLy8gQHRvZG8gSGFuZGxlIGZpbGVzIHRoYXQgaGF2ZSB2YXJ5aW5nIHNtb290aCB2YWx1ZXMgZm9yIGEgc2V0IG9mIGZhY2VzIGluc2lkZSBvbmUgZ2VvbWV0cnksCgkJCQkJLy8gYnV0IGRvZXMgbm90IGRlZmluZSBhIHVzZW10bCBmb3IgZWFjaCBmYWNlIHNldC4KCQkJCQkvLyBUaGlzIHNob3VsZCBiZSBkZXRlY3RlZCBhbmQgYSBkdW1teSBtYXRlcmlhbCBjcmVhdGVkIChsYXRlciBNdWx0aU1hdGVyaWFsIGFuZCBnZW9tZXRyeSBncm91cHMpLgoJCQkJCS8vIFRoaXMgcmVxdWlyZXMgc29tZSBjYXJlIHRvIG5vdCBjcmVhdGUgZXh0cmEgbWF0ZXJpYWwgb24gZWFjaCBzbW9vdGggdmFsdWUgZm9yICJub3JtYWwiIG9iaiBmaWxlcy4KCQkJCQkvLyB3aGVyZSBleHBsaWNpdCB1c2VtdGwgZGVmaW5lcyBnZW9tZXRyeSBncm91cHMuCgkJCQkJLy8gRXhhbXBsZSBhc3NldDogZXhhbXBsZXMvbW9kZWxzL29iai9jZXJiZXJ1cy9DZXJiZXJ1cy5vYmoKCgkJCQkJLyoKCQkJCQkgKiBodHRwOi8vcGF1bGJvdXJrZS5uZXQvZGF0YWZvcm1hdHMvb2JqLwoJCQkJCSAqIG9yCgkJCQkJICogaHR0cDovL3d3dy5jcy51dGFoLmVkdS9+Ym91bG9zL2NzMzUwNS9vYmpfc3BlYy5wZGYKCQkJCQkgKgoJCQkJCSAqIEZyb20gY2hhcHRlciAiR3JvdXBpbmciIFN5bnRheCBleHBsYW5hdGlvbiAicyBncm91cF9udW1iZXIiOgoJCQkJCSAqICJncm91cF9udW1iZXIgaXMgdGhlIHNtb290aGluZyBncm91cCBudW1iZXIuIFRvIHR1cm4gb2ZmIHNtb290aGluZyBncm91cHMsIHVzZSBhIHZhbHVlIG9mIDAgb3Igb2ZmLgoJCQkJCSAqIFBvbHlnb25hbCBlbGVtZW50cyB1c2UgZ3JvdXAgbnVtYmVycyB0byBwdXQgZWxlbWVudHMgaW4gZGlmZmVyZW50IHNtb290aGluZyBncm91cHMuIEZvciBmcmVlLWZvcm0KCQkJCQkgKiBzdXJmYWNlcywgc21vb3RoaW5nIGdyb3VwcyBhcmUgZWl0aGVyIHR1cm5lZCBvbiBvciBvZmY7IHRoZXJlIGlzIG5vIGRpZmZlcmVuY2UgYmV0d2VlbiB2YWx1ZXMgZ3JlYXRlcgoJCQkJCSAqIHRoYW4gMC4iCgkJCQkJICovCgkJCQkJaWYgKCByZXN1bHQubGVuZ3RoID4gMSApIHsKCgkJCQkJCXZhciB2YWx1ZSA9IHJlc3VsdFsgMSBdLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoJCQkJCQlzdGF0ZS5vYmplY3Quc21vb3RoID0gKCB2YWx1ZSAhPT0gJzAnICYmIHZhbHVlICE9PSAnb2ZmJyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gWkJydXNoIGNhbiBwcm9kdWNlICJzIiBsaW5lcyAjMTE3MDcKCQkJCQkJc3RhdGUub2JqZWN0LnNtb290aCA9IHRydWU7CgoJCQkJCX0KCQkJCQl2YXIgbWF0ZXJpYWwgPSBzdGF0ZS5vYmplY3QuY3VycmVudE1hdGVyaWFsKCk7CgkJCQkJaWYgKCBtYXRlcmlhbCApIG1hdGVyaWFsLnNtb290aCA9IHN0YXRlLm9iamVjdC5zbW9vdGg7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gSGFuZGxlIG51bGwgdGVybWluYXRlZCBmaWxlcyB3aXRob3V0IGV4Y2VwdGlvbgoJCQkJCWlmICggbGluZSA9PT0gJ1wwJyApIGNvbnRpbnVlOwoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5PQkpMb2FkZXI6IFVuZXhwZWN0ZWQgbGluZTogIicgKyBsaW5lICsgJyInICk7CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUuZmluYWxpemUoKTsKCgkJCXZhciBjb250YWluZXIgPSBuZXcgVEhSRUUuR3JvdXAoKTsKCQkJY29udGFpbmVyLm1hdGVyaWFsTGlicmFyaWVzID0gW10uY29uY2F0KCBzdGF0ZS5tYXRlcmlhbExpYnJhcmllcyApOwoKCQkJZm9yICggdmFyIGkgPSAwLCBsID0gc3RhdGUub2JqZWN0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXZhciBvYmplY3QgPSBzdGF0ZS5vYmplY3RzWyBpIF07CgkJCQl2YXIgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgkJCQl2YXIgbWF0ZXJpYWxzID0gb2JqZWN0Lm1hdGVyaWFsczsKCQkJCXZhciBpc0xpbmUgPSAoIGdlb21ldHJ5LnR5cGUgPT09ICdMaW5lJyApOwoJCQkJdmFyIGlzUG9pbnRzID0gKCBnZW9tZXRyeS50eXBlID09PSAnUG9pbnRzJyApOwoJCQkJdmFyIGhhc1ZlcnRleENvbG9ycyA9IGZhbHNlOwoKCQkJCS8vIFNraXAgby9nIGxpbmUgZGVjbGFyYXRpb25zIHRoYXQgZGlkIG5vdCBmb2xsb3cgd2l0aCBhbnkgZmFjZXMKCQkJCWlmICggZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoID09PSAwICkgY29udGludWU7CgoJCQkJdmFyIGJ1ZmZlcmdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CgoJCQkJYnVmZmVyZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgVEhSRUUuRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggZ2VvbWV0cnkudmVydGljZXMsIDMgKSApOwoKCQkJCWlmICggZ2VvbWV0cnkubm9ybWFscy5sZW5ndGggPiAwICkgewoKCQkJCQlidWZmZXJnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgVEhSRUUuRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggZ2VvbWV0cnkubm9ybWFscywgMyApICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJYnVmZmVyZ2VvbWV0cnkuY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKCgkJCQl9CgoJCQkJaWYgKCBnZW9tZXRyeS5jb2xvcnMubGVuZ3RoID4gMCApIHsKCgkJCQkJaGFzVmVydGV4Q29sb3JzID0gdHJ1ZTsKCQkJCQlidWZmZXJnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICdjb2xvcicsIG5ldyBUSFJFRS5GbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5jb2xvcnMsIDMgKSApOwoKCQkJCX0KCgkJCQlpZiAoIGdlb21ldHJ5LnV2cy5sZW5ndGggPiAwICkgewoKCQkJCQlidWZmZXJnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoICd1dicsIG5ldyBUSFJFRS5GbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS51dnMsIDIgKSApOwoKCQkJCX0KCgkJCQkvLyBDcmVhdGUgbWF0ZXJpYWxzCgoJCQkJdmFyIGNyZWF0ZWRNYXRlcmlhbHMgPSBbXTsKCgkJCQlmb3IgKCB2YXIgbWkgPSAwLCBtaUxlbiA9IG1hdGVyaWFscy5sZW5ndGg7IG1pIDwgbWlMZW47IG1pICsrICkgewoKCQkJCQl2YXIgc291cmNlTWF0ZXJpYWwgPSBtYXRlcmlhbHNbIG1pIF07CgkJCQkJdmFyIG1hdGVyaWFsID0gdW5kZWZpbmVkOwoKCQkJCQlpZiAoIHRoaXMubWF0ZXJpYWxzICE9PSBudWxsICkgewoKCQkJCQkJbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFscy5jcmVhdGUoIHNvdXJjZU1hdGVyaWFsLm5hbWUgKTsKCgkJCQkJCS8vIG10bCBldGMuIGxvYWRlcnMgcHJvYmFibHkgY2FuJ3QgY3JlYXRlIGxpbmUgbWF0ZXJpYWxzIGNvcnJlY3RseSwgY29weSBwcm9wZXJ0aWVzIHRvIGEgbGluZSBtYXRlcmlhbC4KCQkJCQkJaWYgKCBpc0xpbmUgJiYgbWF0ZXJpYWwgJiYgISAoIG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuTGluZUJhc2ljTWF0ZXJpYWwgKSApIHsKCgkJCQkJCQl2YXIgbWF0ZXJpYWxMaW5lID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKCk7CgkJCQkJCQlUSFJFRS5NYXRlcmlhbC5wcm90b3R5cGUuY29weS5jYWxsKCBtYXRlcmlhbExpbmUsIG1hdGVyaWFsICk7CgkJCQkJCQltYXRlcmlhbExpbmUuY29sb3IuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJCQkJCW1hdGVyaWFsTGluZS5saWdodHMgPSBmYWxzZTsKCQkJCQkJCW1hdGVyaWFsID0gbWF0ZXJpYWxMaW5lOwoKCQkJCQkJfSBlbHNlIGlmICggaXNQb2ludHMgJiYgbWF0ZXJpYWwgJiYgISAoIG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuUG9pbnRzTWF0ZXJpYWwgKSApIHsKCgkJCQkJCQl2YXIgbWF0ZXJpYWxQb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzTWF0ZXJpYWwoIHsgc2l6ZTogMTAsIHNpemVBdHRlbnVhdGlvbjogZmFsc2UgfSApOwoJCQkJCQkJVEhSRUUuTWF0ZXJpYWwucHJvdG90eXBlLmNvcHkuY2FsbCggbWF0ZXJpYWxQb2ludHMsIG1hdGVyaWFsICk7CgkJCQkJCQltYXRlcmlhbFBvaW50cy5jb2xvci5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCQkJCQkJbWF0ZXJpYWxQb2ludHMubWFwID0gbWF0ZXJpYWwubWFwOwoJCQkJCQkJbWF0ZXJpYWxQb2ludHMubGlnaHRzID0gZmFsc2U7CgkJCQkJCQltYXRlcmlhbCA9IG1hdGVyaWFsUG9pbnRzOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWlmICggISBtYXRlcmlhbCApIHsKCgkJCQkJCWlmICggaXNMaW5lICkgewoKCQkJCQkJCW1hdGVyaWFsID0gbmV3IFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsKCk7CgoJCQkJCQl9IGVsc2UgaWYgKCBpc1BvaW50cyApIHsKCgkJCQkJCQltYXRlcmlhbCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCggeyBzaXplOiAxLCBzaXplQXR0ZW51YXRpb246IGZhbHNlIH0gKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoKTsKCgkJCQkJCX0KCgkJCQkJCW1hdGVyaWFsLm5hbWUgPSBzb3VyY2VNYXRlcmlhbC5uYW1lOwoKCQkJCQl9CgoJCQkJCW1hdGVyaWFsLmZsYXRTaGFkaW5nID0gc291cmNlTWF0ZXJpYWwuc21vb3RoID8gZmFsc2UgOiB0cnVlOwoJCQkJCW1hdGVyaWFsLnZlcnRleENvbG9ycyA9IGhhc1ZlcnRleENvbG9ycyA/IFRIUkVFLlZlcnRleENvbG9ycyA6IFRIUkVFLk5vQ29sb3JzOwoKCQkJCQljcmVhdGVkTWF0ZXJpYWxzLnB1c2goIG1hdGVyaWFsICk7CgoJCQkJfQoKCQkJCS8vIENyZWF0ZSBtZXNoCgoJCQkJdmFyIG1lc2g7CgoJCQkJaWYgKCBjcmVhdGVkTWF0ZXJpYWxzLmxlbmd0aCA+IDEgKSB7CgoJCQkJCWZvciAoIHZhciBtaSA9IDAsIG1pTGVuID0gbWF0ZXJpYWxzLmxlbmd0aDsgbWkgPCBtaUxlbjsgbWkgKysgKSB7CgoJCQkJCQl2YXIgc291cmNlTWF0ZXJpYWwgPSBtYXRlcmlhbHNbIG1pIF07CgkJCQkJCWJ1ZmZlcmdlb21ldHJ5LmFkZEdyb3VwKCBzb3VyY2VNYXRlcmlhbC5ncm91cFN0YXJ0LCBzb3VyY2VNYXRlcmlhbC5ncm91cENvdW50LCBtaSApOwoKCQkJCQl9CgoJCQkJCWlmICggaXNMaW5lICkgewoKCQkJCQkJbWVzaCA9IG5ldyBUSFJFRS5MaW5lU2VnbWVudHMoIGJ1ZmZlcmdlb21ldHJ5LCBjcmVhdGVkTWF0ZXJpYWxzICk7CgoJCQkJCX0gZWxzZSBpZiAoIGlzUG9pbnRzICkgewoKCQkJCQkJbWVzaCA9IG5ldyBUSFJFRS5Qb2ludHMoIGJ1ZmZlcmdlb21ldHJ5LCBjcmVhdGVkTWF0ZXJpYWxzICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQltZXNoID0gbmV3IFRIUkVFLk1lc2goIGJ1ZmZlcmdlb21ldHJ5LCBjcmVhdGVkTWF0ZXJpYWxzICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGlzTGluZSApIHsKCgkJCQkJCW1lc2ggPSBuZXcgVEhSRUUuTGluZVNlZ21lbnRzKCBidWZmZXJnZW9tZXRyeSwgY3JlYXRlZE1hdGVyaWFsc1sgMCBdICk7CgoJCQkJCX0gZWxzZSBpZiAoIGlzUG9pbnRzICkgewoKCQkJCQkJbWVzaCA9IG5ldyBUSFJFRS5Qb2ludHMoIGJ1ZmZlcmdlb21ldHJ5LCBjcmVhdGVkTWF0ZXJpYWxzWyAwIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCW1lc2ggPSBuZXcgVEhSRUUuTWVzaCggYnVmZmVyZ2VvbWV0cnksIGNyZWF0ZWRNYXRlcmlhbHNbIDAgXSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCW1lc2gubmFtZSA9IG9iamVjdC5uYW1lOwoKCQkJCWNvbnRhaW5lci5hZGQoIG1lc2ggKTsKCgkJCX0KCgkJCWNvbnNvbGUudGltZUVuZCggJ09CSkxvYWRlcicgKTsKCgkJCXJldHVybiBjb250YWluZXI7CgoJCX0KCgl9OwoKCXJldHVybiBPQkpMb2FkZXI7Cgp9ICkoKTsKCn0se31dLDQyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGNyZWF0ZUxheW91dCA9IF9kZXJlcV8oJ2xheW91dC1ibWZvbnQtdGV4dCcpCnZhciBpbmhlcml0cyA9IF9kZXJlcV8oJ2luaGVyaXRzJykKdmFyIGNyZWF0ZUluZGljZXMgPSBfZGVyZXFfKCdxdWFkLWluZGljZXMnKQp2YXIgYnVmZmVyID0gX2RlcmVxXygndGhyZWUtYnVmZmVyLXZlcnRleC1kYXRhJykKdmFyIGFzc2lnbiA9IF9kZXJlcV8oJ29iamVjdC1hc3NpZ24nKQoKdmFyIHZlcnRpY2VzID0gX2RlcmVxXygnLi9saWIvdmVydGljZXMnKQp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuL2xpYi91dGlscycpCgp2YXIgQmFzZSA9IFRIUkVFLkJ1ZmZlckdlb21ldHJ5Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGNyZWF0ZVRleHRHZW9tZXRyeSAob3B0KSB7CiAgcmV0dXJuIG5ldyBUZXh0R2VvbWV0cnkob3B0KQp9CgpmdW5jdGlvbiBUZXh0R2VvbWV0cnkgKG9wdCkgewogIEJhc2UuY2FsbCh0aGlzKQoKICBpZiAodHlwZW9mIG9wdCA9PT0gJ3N0cmluZycpIHsKICAgIG9wdCA9IHsgdGV4dDogb3B0IH0KICB9CgogIC8vIHVzZSB0aGVzZSBhcyBkZWZhdWx0IHZhbHVlcyBmb3IgYW55IHN1YnNlcXVlbnQKICAvLyBjYWxscyB0byB1cGRhdGUoKQogIHRoaXMuX29wdCA9IGFzc2lnbih7fSwgb3B0KQoKICAvLyBhbHNvIGRvIGFuIGluaXRpYWwgc2V0dXAuLi4KICBpZiAob3B0KSB0aGlzLnVwZGF0ZShvcHQpCn0KCmluaGVyaXRzKFRleHRHZW9tZXRyeSwgQmFzZSkKClRleHRHZW9tZXRyeS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKG9wdCkgewogIGlmICh0eXBlb2Ygb3B0ID09PSAnc3RyaW5nJykgewogICAgb3B0ID0geyB0ZXh0OiBvcHQgfQogIH0KCiAgLy8gdXNlIGNvbnN0cnVjdG9yIGRlZmF1bHRzCiAgb3B0ID0gYXNzaWduKHt9LCB0aGlzLl9vcHQsIG9wdCkKCiAgaWYgKCFvcHQuZm9udCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcignbXVzdCBzcGVjaWZ5IGEgeyBmb250IH0gaW4gb3B0aW9ucycpCiAgfQoKICB0aGlzLmxheW91dCA9IGNyZWF0ZUxheW91dChvcHQpCgogIC8vIGdldCB2ZWMyIHRleGNvb3JkcwogIHZhciBmbGlwWSA9IG9wdC5mbGlwWSAhPT0gZmFsc2UKCiAgLy8gdGhlIGRlc2lyZWQgQk1Gb250IGRhdGEKICB2YXIgZm9udCA9IG9wdC5mb250CgogIC8vIGRldGVybWluZSB0ZXh0dXJlIHNpemUgZnJvbSBmb250IGZpbGUKICB2YXIgdGV4V2lkdGggPSBmb250LmNvbW1vbi5zY2FsZVcKICB2YXIgdGV4SGVpZ2h0ID0gZm9udC5jb21tb24uc2NhbGVICgogIC8vIGdldCB2aXNpYmxlIGdseXBocwogIHZhciBnbHlwaHMgPSB0aGlzLmxheW91dC5nbHlwaHMuZmlsdGVyKGZ1bmN0aW9uIChnbHlwaCkgewogICAgdmFyIGJpdG1hcCA9IGdseXBoLmRhdGEKICAgIHJldHVybiBiaXRtYXAud2lkdGggKiBiaXRtYXAuaGVpZ2h0ID4gMAogIH0pCgogIC8vIHByb3ZpZGUgdmlzaWJsZSBnbHlwaHMgZm9yIGNvbnZlbmllbmNlCiAgdGhpcy52aXNpYmxlR2x5cGhzID0gZ2x5cGhzCgogIC8vIGdldCBjb21tb24gdmVydGV4IGRhdGEKICB2YXIgcG9zaXRpb25zID0gdmVydGljZXMucG9zaXRpb25zKGdseXBocykKICB2YXIgdXZzID0gdmVydGljZXMudXZzKGdseXBocywgdGV4V2lkdGgsIHRleEhlaWdodCwgZmxpcFkpCiAgdmFyIGluZGljZXMgPSBjcmVhdGVJbmRpY2VzKHsKICAgIGNsb2Nrd2lzZTogdHJ1ZSwKICAgIHR5cGU6ICd1aW50MTYnLAogICAgY291bnQ6IGdseXBocy5sZW5ndGgKICB9KQoKICAvLyB1cGRhdGUgdmVydGV4IGRhdGEKICBidWZmZXIuaW5kZXgodGhpcywgaW5kaWNlcywgMSwgJ3VpbnQxNicpCiAgYnVmZmVyLmF0dHIodGhpcywgJ3Bvc2l0aW9uJywgcG9zaXRpb25zLCAyKQogIGJ1ZmZlci5hdHRyKHRoaXMsICd1dicsIHV2cywgMikKCiAgLy8gdXBkYXRlIG11bHRpcGFnZSBkYXRhCiAgaWYgKCFvcHQubXVsdGlwYWdlICYmICdwYWdlJyBpbiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgIC8vIGRpc2FibGUgbXVsdGlwYWdlIHJlbmRlcmluZwogICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoJ3BhZ2UnKQogIH0gZWxzZSBpZiAob3B0Lm11bHRpcGFnZSkgewogICAgdmFyIHBhZ2VzID0gdmVydGljZXMucGFnZXMoZ2x5cGhzKQogICAgLy8gZW5hYmxlIG11bHRpcGFnZSByZW5kZXJpbmcKICAgIGJ1ZmZlci5hdHRyKHRoaXMsICdwYWdlJywgcGFnZXMsIDEpCiAgfQp9CgpUZXh0R2VvbWV0cnkucHJvdG90eXBlLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCkgewogICAgdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG5ldyBUSFJFRS5TcGhlcmUoKQogIH0KCiAgdmFyIHBvc2l0aW9ucyA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbi5hcnJheQogIHZhciBpdGVtU2l6ZSA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbi5pdGVtU2l6ZQogIGlmICghcG9zaXRpb25zIHx8ICFpdGVtU2l6ZSB8fCBwb3NpdGlvbnMubGVuZ3RoIDwgMikgewogICAgdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSAwCiAgICB0aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlci5zZXQoMCwgMCwgMCkKICAgIHJldHVybgogIH0KICB1dGlscy5jb21wdXRlU3BoZXJlKHBvc2l0aW9ucywgdGhpcy5ib3VuZGluZ1NwaGVyZSkKICBpZiAoaXNOYU4odGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMpKSB7CiAgICBjb25zb2xlLmVycm9yKCdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogJyArCiAgICAgICdDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgJyArCiAgICAgICcicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicpCiAgfQp9CgpUZXh0R2VvbWV0cnkucHJvdG90eXBlLmNvbXB1dGVCb3VuZGluZ0JveCA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5ib3VuZGluZ0JveCA9PT0gbnVsbCkgewogICAgdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBUSFJFRS5Cb3gzKCkKICB9CgogIHZhciBiYm94ID0gdGhpcy5ib3VuZGluZ0JveAogIHZhciBwb3NpdGlvbnMgPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXkKICB2YXIgaXRlbVNpemUgPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb24uaXRlbVNpemUKICBpZiAoIXBvc2l0aW9ucyB8fCAhaXRlbVNpemUgfHwgcG9zaXRpb25zLmxlbmd0aCA8IDIpIHsKICAgIGJib3gubWFrZUVtcHR5KCkKICAgIHJldHVybgogIH0KICB1dGlscy5jb21wdXRlQm94KHBvc2l0aW9ucywgYmJveCkKfQoKfSx7Ii4vbGliL3V0aWxzIjo0MywiLi9saWIvdmVydGljZXMiOjQ0LCJpbmhlcml0cyI6MTksImxheW91dC1ibWZvbnQtdGV4dCI6MjQsIm9iamVjdC1hc3NpZ24iOjI3LCJxdWFkLWluZGljZXMiOjM1LCJ0aHJlZS1idWZmZXItdmVydGV4LWRhdGEiOjQ1fV0sNDM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgaXRlbVNpemUgPSAyCnZhciBib3ggPSB7IG1pbjogWzAsIDBdLCBtYXg6IFswLCAwXSB9CgpmdW5jdGlvbiBib3VuZHMgKHBvc2l0aW9ucykgewogIHZhciBjb3VudCA9IHBvc2l0aW9ucy5sZW5ndGggLyBpdGVtU2l6ZQogIGJveC5taW5bMF0gPSBwb3NpdGlvbnNbMF0KICBib3gubWluWzFdID0gcG9zaXRpb25zWzFdCiAgYm94Lm1heFswXSA9IHBvc2l0aW9uc1swXQogIGJveC5tYXhbMV0gPSBwb3NpdGlvbnNbMV0KCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICB2YXIgeCA9IHBvc2l0aW9uc1tpICogaXRlbVNpemUgKyAwXQogICAgdmFyIHkgPSBwb3NpdGlvbnNbaSAqIGl0ZW1TaXplICsgMV0KICAgIGJveC5taW5bMF0gPSBNYXRoLm1pbih4LCBib3gubWluWzBdKQogICAgYm94Lm1pblsxXSA9IE1hdGgubWluKHksIGJveC5taW5bMV0pCiAgICBib3gubWF4WzBdID0gTWF0aC5tYXgoeCwgYm94Lm1heFswXSkKICAgIGJveC5tYXhbMV0gPSBNYXRoLm1heCh5LCBib3gubWF4WzFdKQogIH0KfQoKbW9kdWxlLmV4cG9ydHMuY29tcHV0ZUJveCA9IGZ1bmN0aW9uIChwb3NpdGlvbnMsIG91dHB1dCkgewogIGJvdW5kcyhwb3NpdGlvbnMpCiAgb3V0cHV0Lm1pbi5zZXQoYm94Lm1pblswXSwgYm94Lm1pblsxXSwgMCkKICBvdXRwdXQubWF4LnNldChib3gubWF4WzBdLCBib3gubWF4WzFdLCAwKQp9Cgptb2R1bGUuZXhwb3J0cy5jb21wdXRlU3BoZXJlID0gZnVuY3Rpb24gKHBvc2l0aW9ucywgb3V0cHV0KSB7CiAgYm91bmRzKHBvc2l0aW9ucykKICB2YXIgbWluWCA9IGJveC5taW5bMF0KICB2YXIgbWluWSA9IGJveC5taW5bMV0KICB2YXIgbWF4WCA9IGJveC5tYXhbMF0KICB2YXIgbWF4WSA9IGJveC5tYXhbMV0KICB2YXIgd2lkdGggPSBtYXhYIC0gbWluWAogIHZhciBoZWlnaHQgPSBtYXhZIC0gbWluWQogIHZhciBsZW5ndGggPSBNYXRoLnNxcnQod2lkdGggKiB3aWR0aCArIGhlaWdodCAqIGhlaWdodCkKICBvdXRwdXQuY2VudGVyLnNldChtaW5YICsgd2lkdGggLyAyLCBtaW5ZICsgaGVpZ2h0IC8gMiwgMCkKICBvdXRwdXQucmFkaXVzID0gbGVuZ3RoIC8gMgp9Cgp9LHt9XSw0NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzLnBhZ2VzID0gZnVuY3Rpb24gcGFnZXMgKGdseXBocykgewogIHZhciBwYWdlcyA9IG5ldyBGbG9hdDMyQXJyYXkoZ2x5cGhzLmxlbmd0aCAqIDQgKiAxKQogIHZhciBpID0gMAogIGdseXBocy5mb3JFYWNoKGZ1bmN0aW9uIChnbHlwaCkgewogICAgdmFyIGlkID0gZ2x5cGguZGF0YS5wYWdlIHx8IDAKICAgIHBhZ2VzW2krK10gPSBpZAogICAgcGFnZXNbaSsrXSA9IGlkCiAgICBwYWdlc1tpKytdID0gaWQKICAgIHBhZ2VzW2krK10gPSBpZAogIH0pCiAgcmV0dXJuIHBhZ2VzCn0KCm1vZHVsZS5leHBvcnRzLnV2cyA9IGZ1bmN0aW9uIHV2cyAoZ2x5cGhzLCB0ZXhXaWR0aCwgdGV4SGVpZ2h0LCBmbGlwWSkgewogIHZhciB1dnMgPSBuZXcgRmxvYXQzMkFycmF5KGdseXBocy5sZW5ndGggKiA0ICogMikKICB2YXIgaSA9IDAKICBnbHlwaHMuZm9yRWFjaChmdW5jdGlvbiAoZ2x5cGgpIHsKICAgIHZhciBiaXRtYXAgPSBnbHlwaC5kYXRhCiAgICB2YXIgYncgPSAoYml0bWFwLnggKyBiaXRtYXAud2lkdGgpCiAgICB2YXIgYmggPSAoYml0bWFwLnkgKyBiaXRtYXAuaGVpZ2h0KQoKICAgIC8vIHRvcCBsZWZ0IHBvc2l0aW9uCiAgICB2YXIgdTAgPSBiaXRtYXAueCAvIHRleFdpZHRoCiAgICB2YXIgdjEgPSBiaXRtYXAueSAvIHRleEhlaWdodAogICAgdmFyIHUxID0gYncgLyB0ZXhXaWR0aAogICAgdmFyIHYwID0gYmggLyB0ZXhIZWlnaHQKCiAgICBpZiAoZmxpcFkpIHsKICAgICAgdjEgPSAodGV4SGVpZ2h0IC0gYml0bWFwLnkpIC8gdGV4SGVpZ2h0CiAgICAgIHYwID0gKHRleEhlaWdodCAtIGJoKSAvIHRleEhlaWdodAogICAgfQoKICAgIC8vIEJMCiAgICB1dnNbaSsrXSA9IHUwCiAgICB1dnNbaSsrXSA9IHYxCiAgICAvLyBUTAogICAgdXZzW2krK10gPSB1MAogICAgdXZzW2krK10gPSB2MAogICAgLy8gVFIKICAgIHV2c1tpKytdID0gdTEKICAgIHV2c1tpKytdID0gdjAKICAgIC8vIEJSCiAgICB1dnNbaSsrXSA9IHUxCiAgICB1dnNbaSsrXSA9IHYxCiAgfSkKICByZXR1cm4gdXZzCn0KCm1vZHVsZS5leHBvcnRzLnBvc2l0aW9ucyA9IGZ1bmN0aW9uIHBvc2l0aW9ucyAoZ2x5cGhzKSB7CiAgdmFyIHBvc2l0aW9ucyA9IG5ldyBGbG9hdDMyQXJyYXkoZ2x5cGhzLmxlbmd0aCAqIDQgKiAyKQogIHZhciBpID0gMAogIGdseXBocy5mb3JFYWNoKGZ1bmN0aW9uIChnbHlwaCkgewogICAgdmFyIGJpdG1hcCA9IGdseXBoLmRhdGEKCiAgICAvLyBib3R0b20gbGVmdCBwb3NpdGlvbgogICAgdmFyIHggPSBnbHlwaC5wb3NpdGlvblswXSArIGJpdG1hcC54b2Zmc2V0CiAgICB2YXIgeSA9IGdseXBoLnBvc2l0aW9uWzFdICsgYml0bWFwLnlvZmZzZXQKCiAgICAvLyBxdWFkIHNpemUKICAgIHZhciB3ID0gYml0bWFwLndpZHRoCiAgICB2YXIgaCA9IGJpdG1hcC5oZWlnaHQKCiAgICAvLyBCTAogICAgcG9zaXRpb25zW2krK10gPSB4CiAgICBwb3NpdGlvbnNbaSsrXSA9IHkKICAgIC8vIFRMCiAgICBwb3NpdGlvbnNbaSsrXSA9IHgKICAgIHBvc2l0aW9uc1tpKytdID0geSArIGgKICAgIC8vIFRSCiAgICBwb3NpdGlvbnNbaSsrXSA9IHggKyB3CiAgICBwb3NpdGlvbnNbaSsrXSA9IHkgKyBoCiAgICAvLyBCUgogICAgcG9zaXRpb25zW2krK10gPSB4ICsgdwogICAgcG9zaXRpb25zW2krK10gPSB5CiAgfSkKICByZXR1cm4gcG9zaXRpb25zCn0KCn0se31dLDQ1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGZsYXR0ZW4gPSBfZGVyZXFfKCdmbGF0dGVuLXZlcnRleC1kYXRhJykKdmFyIHdhcm5lZCA9IGZhbHNlOwoKbW9kdWxlLmV4cG9ydHMuYXR0ciA9IHNldEF0dHJpYnV0ZQptb2R1bGUuZXhwb3J0cy5pbmRleCA9IHNldEluZGV4CgpmdW5jdGlvbiBzZXRJbmRleCAoZ2VvbWV0cnksIGRhdGEsIGl0ZW1TaXplLCBkdHlwZSkgewogIGlmICh0eXBlb2YgaXRlbVNpemUgIT09ICdudW1iZXInKSBpdGVtU2l6ZSA9IDEKICBpZiAodHlwZW9mIGR0eXBlICE9PSAnc3RyaW5nJykgZHR5cGUgPSAndWludDE2JwoKICB2YXIgaXNSNjkgPSAhZ2VvbWV0cnkuaW5kZXggJiYgdHlwZW9mIGdlb21ldHJ5LnNldEluZGV4ICE9PSAnZnVuY3Rpb24nCiAgdmFyIGF0dHJpYiA9IGlzUjY5ID8gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCdpbmRleCcpIDogZ2VvbWV0cnkuaW5kZXgKICB2YXIgbmV3QXR0cmliID0gdXBkYXRlQXR0cmlidXRlKGF0dHJpYiwgZGF0YSwgaXRlbVNpemUsIGR0eXBlKQogIGlmIChuZXdBdHRyaWIpIHsKICAgIGlmIChpc1I2OSkgZ2VvbWV0cnkuYWRkQXR0cmlidXRlKCdpbmRleCcsIG5ld0F0dHJpYikKICAgIGVsc2UgZ2VvbWV0cnkuaW5kZXggPSBuZXdBdHRyaWIKICB9Cn0KCmZ1bmN0aW9uIHNldEF0dHJpYnV0ZSAoZ2VvbWV0cnksIGtleSwgZGF0YSwgaXRlbVNpemUsIGR0eXBlKSB7CiAgaWYgKHR5cGVvZiBpdGVtU2l6ZSAhPT0gJ251bWJlcicpIGl0ZW1TaXplID0gMwogIGlmICh0eXBlb2YgZHR5cGUgIT09ICdzdHJpbmcnKSBkdHlwZSA9ICdmbG9hdDMyJwogIGlmIChBcnJheS5pc0FycmF5KGRhdGEpICYmCiAgICBBcnJheS5pc0FycmF5KGRhdGFbMF0pICYmCiAgICBkYXRhWzBdLmxlbmd0aCAhPT0gaXRlbVNpemUpIHsKICAgIHRocm93IG5ldyBFcnJvcignTmVzdGVkIHZlcnRleCBhcnJheSBoYXMgdW5leHBlY3RlZCBzaXplOyBleHBlY3RlZCAnICsKICAgICAgaXRlbVNpemUgKyAnIGJ1dCBmb3VuZCAnICsgZGF0YVswXS5sZW5ndGgpCiAgfQoKICB2YXIgYXR0cmliID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKGtleSkKICB2YXIgbmV3QXR0cmliID0gdXBkYXRlQXR0cmlidXRlKGF0dHJpYiwgZGF0YSwgaXRlbVNpemUsIGR0eXBlKQogIGlmIChuZXdBdHRyaWIpIHsKICAgIGdlb21ldHJ5LmFkZEF0dHJpYnV0ZShrZXksIG5ld0F0dHJpYikKICB9Cn0KCmZ1bmN0aW9uIHVwZGF0ZUF0dHJpYnV0ZSAoYXR0cmliLCBkYXRhLCBpdGVtU2l6ZSwgZHR5cGUpIHsKICBkYXRhID0gZGF0YSB8fCBbXQogIGlmICghYXR0cmliIHx8IHJlYnVpbGRBdHRyaWJ1dGUoYXR0cmliLCBkYXRhLCBpdGVtU2l6ZSkpIHsKICAgIC8vIGNyZWF0ZSBhIG5ldyBhcnJheSB3aXRoIGRlc2lyZWQgdHlwZQogICAgZGF0YSA9IGZsYXR0ZW4oZGF0YSwgZHR5cGUpCgogICAgdmFyIG5lZWRzTmV3QnVmZmVyID0gYXR0cmliICYmIHR5cGVvZiBhdHRyaWIuc2V0QXJyYXkgIT09ICdmdW5jdGlvbicKICAgIGlmICghYXR0cmliIHx8IG5lZWRzTmV3QnVmZmVyKSB7CiAgICAgIC8vIFdlIGFyZSBvbiBhbiBvbGQgdmVyc2lvbiBvZiBUaHJlZUpTIHdoaWNoIGNhbid0CiAgICAgIC8vIHN1cHBvcnQgZ3Jvd2luZyAvIHNocmlua2luZyBidWZmZXJzLCBzbyB3ZSBuZWVkCiAgICAgIC8vIHRvIGJ1aWxkIGEgbmV3IGJ1ZmZlcgogICAgICBpZiAobmVlZHNOZXdCdWZmZXIgJiYgIXdhcm5lZCkgewogICAgICAgIHdhcm5lZCA9IHRydWUKICAgICAgICBjb25zb2xlLndhcm4oWwogICAgICAgICAgJ0EgV2ViR0wgYnVmZmVyIGlzIGJlaW5nIHVwZGF0ZWQgd2l0aCBhIG5ldyBzaXplIG9yIGl0ZW1TaXplLCAnLAogICAgICAgICAgJ2hvd2V2ZXIgdGhpcyB2ZXJzaW9uIG9mIFRocmVlSlMgb25seSBzdXBwb3J0cyBmaXhlZC1zaXplIGJ1ZmZlcnMuJywKICAgICAgICAgICdcblRoZSBvbGQgYnVmZmVyIG1heSBzdGlsbCBiZSBrZXB0IGluIG1lbW9yeS5cbicsCiAgICAgICAgICAnVG8gYXZvaWQgbWVtb3J5IGxlYWtzLCBpdCBpcyByZWNvbW1lbmRlZCB0aGF0IHlvdSBkaXNwb3NlICcsCiAgICAgICAgICAneW91ciBnZW9tZXRyaWVzIGFuZCBjcmVhdGUgbmV3IG9uZXMsIG9yIHVwZGF0ZSB0byBUaHJlZUpTIHI4MiBvciBuZXdlci5cbicsCiAgICAgICAgICAnU2VlIGhlcmUgZm9yIGRpc2N1c3Npb246XG4nLAogICAgICAgICAgJ2h0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC85NjMxJwogICAgICAgIF0uam9pbignJykpCiAgICAgIH0KCiAgICAgIC8vIEJ1aWxkIGEgbmV3IGF0dHJpYnV0ZQogICAgICBhdHRyaWIgPSBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKGRhdGEsIGl0ZW1TaXplKTsKICAgIH0KCiAgICBhdHRyaWIuaXRlbVNpemUgPSBpdGVtU2l6ZQogICAgYXR0cmliLm5lZWRzVXBkYXRlID0gdHJ1ZQoKICAgIC8vIE5ldyB2ZXJzaW9ucyBvZiBUaHJlZUpTIHN1Z2dlc3QgdXNpbmcgc2V0QXJyYXkKICAgIC8vIHRvIGNoYW5nZSB0aGUgZGF0YS4gSXQgd2lsbCB1c2UgYnVmZmVyRGF0YSBpbnRlcm5hbGx5LAogICAgLy8gc28geW91IGNhbiBjaGFuZ2UgdGhlIGFycmF5IHNpemUgd2l0aG91dCBhbnkgaXNzdWVzCiAgICBpZiAodHlwZW9mIGF0dHJpYi5zZXRBcnJheSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBhdHRyaWIuc2V0QXJyYXkoZGF0YSkKICAgIH0KCiAgICByZXR1cm4gYXR0cmliCiAgfSBlbHNlIHsKICAgIC8vIGNvcHkgZGF0YSBpbnRvIHRoZSBleGlzdGluZyBhcnJheQogICAgZmxhdHRlbihkYXRhLCBhdHRyaWIuYXJyYXkpCiAgICBhdHRyaWIubmVlZHNVcGRhdGUgPSB0cnVlCiAgICByZXR1cm4gbnVsbAogIH0KfQoKLy8gVGVzdCB3aGV0aGVyIHRoZSBhdHRyaWJ1dGUgbmVlZHMgdG8gYmUgcmUtY3JlYXRlZCwKLy8gcmV0dXJucyBmYWxzZSBpZiB3ZSBjYW4gcmUtdXNlIGl0IGFzLWlzLgpmdW5jdGlvbiByZWJ1aWxkQXR0cmlidXRlIChhdHRyaWIsIGRhdGEsIGl0ZW1TaXplKSB7CiAgaWYgKGF0dHJpYi5pdGVtU2l6ZSAhPT0gaXRlbVNpemUpIHJldHVybiB0cnVlCiAgaWYgKCFhdHRyaWIuYXJyYXkpIHJldHVybiB0cnVlCiAgdmFyIGF0dHJpYkxlbmd0aCA9IGF0dHJpYi5hcnJheS5sZW5ndGgKICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSAmJiBBcnJheS5pc0FycmF5KGRhdGFbMF0pKSB7CiAgICAvLyBbIFsgeCwgeSwgeiBdIF0KICAgIHJldHVybiBhdHRyaWJMZW5ndGggIT09IGRhdGEubGVuZ3RoICogaXRlbVNpemUKICB9IGVsc2UgewogICAgLy8gWyB4LCB5LCB6IF0KICAgIHJldHVybiBhdHRyaWJMZW5ndGggIT09IGRhdGEubGVuZ3RoCiAgfQogIHJldHVybiBmYWxzZQp9Cgp9LHsiZmxhdHRlbi12ZXJ0ZXgtZGF0YSI6MTV9XSw0NjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoc2V0SW1tZWRpYXRlLGNsZWFySW1tZWRpYXRlKXsKdmFyIG5leHRUaWNrID0gX2RlcmVxXygncHJvY2Vzcy9icm93c2VyLmpzJykubmV4dFRpY2s7CnZhciBhcHBseSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseTsKdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwp2YXIgaW1tZWRpYXRlSWRzID0ge307CnZhciBuZXh0SW1tZWRpYXRlSWQgPSAwOwoKLy8gRE9NIEFQSXMsIGZvciBjb21wbGV0ZW5lc3MKCmV4cG9ydHMuc2V0VGltZW91dCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiBuZXcgVGltZW91dChhcHBseS5jYWxsKHNldFRpbWVvdXQsIHdpbmRvdywgYXJndW1lbnRzKSwgY2xlYXJUaW1lb3V0KTsKfTsKZXhwb3J0cy5zZXRJbnRlcnZhbCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiBuZXcgVGltZW91dChhcHBseS5jYWxsKHNldEludGVydmFsLCB3aW5kb3csIGFyZ3VtZW50cyksIGNsZWFySW50ZXJ2YWwpOwp9OwpleHBvcnRzLmNsZWFyVGltZW91dCA9CmV4cG9ydHMuY2xlYXJJbnRlcnZhbCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsgdGltZW91dC5jbG9zZSgpOyB9OwoKZnVuY3Rpb24gVGltZW91dChpZCwgY2xlYXJGbikgewogIHRoaXMuX2lkID0gaWQ7CiAgdGhpcy5fY2xlYXJGbiA9IGNsZWFyRm47Cn0KVGltZW91dC5wcm90b3R5cGUudW5yZWYgPSBUaW1lb3V0LnByb3RvdHlwZS5yZWYgPSBmdW5jdGlvbigpIHt9OwpUaW1lb3V0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogIHRoaXMuX2NsZWFyRm4uY2FsbCh3aW5kb3csIHRoaXMuX2lkKTsKfTsKCi8vIERvZXMgbm90IHN0YXJ0IHRoZSB0aW1lLCBqdXN0IHNldHMgdXAgdGhlIG1lbWJlcnMgbmVlZGVkLgpleHBvcnRzLmVucm9sbCA9IGZ1bmN0aW9uKGl0ZW0sIG1zZWNzKSB7CiAgY2xlYXJUaW1lb3V0KGl0ZW0uX2lkbGVUaW1lb3V0SWQpOwogIGl0ZW0uX2lkbGVUaW1lb3V0ID0gbXNlY3M7Cn07CgpleHBvcnRzLnVuZW5yb2xsID0gZnVuY3Rpb24oaXRlbSkgewogIGNsZWFyVGltZW91dChpdGVtLl9pZGxlVGltZW91dElkKTsKICBpdGVtLl9pZGxlVGltZW91dCA9IC0xOwp9OwoKZXhwb3J0cy5fdW5yZWZBY3RpdmUgPSBleHBvcnRzLmFjdGl2ZSA9IGZ1bmN0aW9uKGl0ZW0pIHsKICBjbGVhclRpbWVvdXQoaXRlbS5faWRsZVRpbWVvdXRJZCk7CgogIHZhciBtc2VjcyA9IGl0ZW0uX2lkbGVUaW1lb3V0OwogIGlmIChtc2VjcyA+PSAwKSB7CiAgICBpdGVtLl9pZGxlVGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiBvblRpbWVvdXQoKSB7CiAgICAgIGlmIChpdGVtLl9vblRpbWVvdXQpCiAgICAgICAgaXRlbS5fb25UaW1lb3V0KCk7CiAgICB9LCBtc2Vjcyk7CiAgfQp9OwoKLy8gVGhhdCdzIG5vdCBob3cgbm9kZS5qcyBpbXBsZW1lbnRzIGl0IGJ1dCB0aGUgZXhwb3NlZCBhcGkgaXMgdGhlIHNhbWUuCmV4cG9ydHMuc2V0SW1tZWRpYXRlID0gdHlwZW9mIHNldEltbWVkaWF0ZSA9PT0gImZ1bmN0aW9uIiA/IHNldEltbWVkaWF0ZSA6IGZ1bmN0aW9uKGZuKSB7CiAgdmFyIGlkID0gbmV4dEltbWVkaWF0ZUlkKys7CiAgdmFyIGFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoIDwgMiA/IGZhbHNlIDogc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKICBpbW1lZGlhdGVJZHNbaWRdID0gdHJ1ZTsKCiAgbmV4dFRpY2soZnVuY3Rpb24gb25OZXh0VGljaygpIHsKICAgIGlmIChpbW1lZGlhdGVJZHNbaWRdKSB7CiAgICAgIC8vIGZuLmNhbGwoKSBpcyBmYXN0ZXIgc28gd2Ugb3B0aW1pemUgZm9yIHRoZSBjb21tb24gdXNlLWNhc2UKICAgICAgLy8gQHNlZSBodHRwOi8vanNwZXJmLmNvbS9jYWxsLWFwcGx5LXNlZ3UKICAgICAgaWYgKGFyZ3MpIHsKICAgICAgICBmbi5hcHBseShudWxsLCBhcmdzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmbi5jYWxsKG51bGwpOwogICAgICB9CiAgICAgIC8vIFByZXZlbnQgaWRzIGZyb20gbGVha2luZwogICAgICBleHBvcnRzLmNsZWFySW1tZWRpYXRlKGlkKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIGlkOwp9OwoKZXhwb3J0cy5jbGVhckltbWVkaWF0ZSA9IHR5cGVvZiBjbGVhckltbWVkaWF0ZSA9PT0gImZ1bmN0aW9uIiA/IGNsZWFySW1tZWRpYXRlIDogZnVuY3Rpb24oaWQpIHsKICBkZWxldGUgaW1tZWRpYXRlSWRzW2lkXTsKfTsKfSkuY2FsbCh0aGlzLF9kZXJlcV8oInRpbWVycyIpLnNldEltbWVkaWF0ZSxfZGVyZXFfKCJ0aW1lcnMiKS5jbGVhckltbWVkaWF0ZSkKCn0seyJwcm9jZXNzL2Jyb3dzZXIuanMiOjQ3LCJ0aW1lcnMiOjQ2fV0sNDc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewphcmd1bWVudHNbNF1bNV1bMF0uYXBwbHkoZXhwb3J0cyxhcmd1bWVudHMpCn0seyJkdXAiOjV9XSw0ODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CgpleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSB0cmltOwoKZnVuY3Rpb24gdHJpbShzdHIpewogIHJldHVybiBzdHIucmVwbGFjZSgvXlxzKnxccyokL2csICcnKTsKfQoKZXhwb3J0cy5sZWZ0ID0gZnVuY3Rpb24oc3RyKXsKICByZXR1cm4gc3RyLnJlcGxhY2UoL15ccyovLCAnJyk7Cn07CgpleHBvcnRzLnJpZ2h0ID0gZnVuY3Rpb24oc3RyKXsKICByZXR1cm4gc3RyLnJlcGxhY2UoL1xzKiQvLCAnJyk7Cn07Cgp9LHt9XSw0OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAoZ2xvYmFsKXsKLyoqCiAqIEBsaWNlbnNlCiAqIHdlYnZyLXBvbHlmaWxsCiAqIENvcHlyaWdodCAoYykgMjAxNS0yMDE3IEdvb2dsZQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIEBsaWNlbnNlCiAqIGNhcmRib2FyZC12ci1kaXNwbGF5CiAqIENvcHlyaWdodCAoYykgMjAxNS0yMDE3IEdvb2dsZQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKLyoqCiAqIEBsaWNlbnNlCiAqIHdlYnZyLXBvbHlmaWxsLWRwZGIgCiAqIENvcHlyaWdodCAoYykgMjAxNyBHb29nbGUKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCi8qKgogKiBAbGljZW5zZQogKiB3Z2x1LXByZXNlcnZlLXN0YXRlCiAqIENvcHlyaWdodCAoYykgMjAxNiwgQnJhbmRvbiBKb25lcy4KICoKICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQogKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAqCiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCiAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgogKiBUSEUgU09GVFdBUkUuCiAqLwoKLyoqCiAqIEBsaWNlbnNlCiAqIG5vc2xlZXAuanMKICogQ29weXJpZ2h0IChjKSAyMDE3LCBSaWNoIFRpYmJldHQKICoKICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQogKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAqCiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCiAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgogKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgogKiBUSEUgU09GVFdBUkUuCiAqLwoKKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKCXR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDoKCXR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6CgkoZ2xvYmFsLldlYlZSUG9seWZpbGwgPSBmYWN0b3J5KCkpOwp9KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JzsKCnZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgoKCmZ1bmN0aW9uIHVud3JhcEV4cG9ydHMgKHgpIHsKCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZuLCBtb2R1bGUpIHsKCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKfQoKdmFyIGlzTW9iaWxlID0gZnVuY3Rpb24gaXNNb2JpbGUoKSB7CiAgcmV0dXJuICgvQW5kcm9pZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgL2lQaG9uZXxpUGFkfGlQb2QvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpCiAgKTsKfTsKdmFyIGNvcHlBcnJheSA9IGZ1bmN0aW9uIGNvcHlBcnJheShzb3VyY2UsIGRlc3QpIHsKICBmb3IgKHZhciBpID0gMCwgbiA9IHNvdXJjZS5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgIGRlc3RbaV0gPSBzb3VyY2VbaV07CiAgfQp9Owp2YXIgZXh0ZW5kID0gZnVuY3Rpb24gZXh0ZW5kKGRlc3QsIHNyYykgewogIGZvciAodmFyIGtleSBpbiBzcmMpIHsKICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICBkZXN0W2tleV0gPSBzcmNba2V5XTsKICAgIH0KICB9CiAgcmV0dXJuIGRlc3Q7Cn07Cgp2YXIgY2FyZGJvYXJkVnJEaXNwbGF5ID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewovKioKICogQGxpY2Vuc2UKICogY2FyZGJvYXJkLXZyLWRpc3BsYXkKICogQ29weXJpZ2h0IChjKSAyMDE1LTIwMTcgR29vZ2xlCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCi8qKgogKiBAbGljZW5zZQogKiBnbC1wcmVzZXJ2ZS1zdGF0ZQogKiBDb3B5cmlnaHQgKGMpIDIwMTYsIEJyYW5kb24gSm9uZXMuCiAqCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogKgogKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgogKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICogVEhFIFNPRlRXQVJFLgogKi8KLyoqCiAqIEBsaWNlbnNlCiAqIHdlYnZyLXBvbHlmaWxsLWRwZGIKICogQ29weXJpZ2h0IChjKSAyMDE1LTIwMTcgR29vZ2xlCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCi8qKgogKiBAbGljZW5zZQogKiBub3NsZWVwLmpzCiAqIENvcHlyaWdodCAoYykgMjAxNywgUmljaCBUaWJiZXR0CiAqCiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwogKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogKgogKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgogKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICogVEhFIFNPRlRXQVJFLgogKi8KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwp9KGNvbW1vbmpzR2xvYmFsLCAoZnVuY3Rpb24gKCkgeyB2YXIgY2xhc3NDYWxsQ2hlY2sgPSBmdW5jdGlvbiAoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfTsKdmFyIGNyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICAgIH0KICB9CiAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9Owp9KCk7CnZhciBzbGljZWRUb0FycmF5ID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIHNsaWNlSXRlcmF0b3IoYXJyLCBpKSB7CiAgICB2YXIgX2FyciA9IFtdOwogICAgdmFyIF9uID0gdHJ1ZTsKICAgIHZhciBfZCA9IGZhbHNlOwogICAgdmFyIF9lID0gdW5kZWZpbmVkOwogICAgdHJ5IHsKICAgICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CiAgICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2QgPSB0cnVlOwogICAgICBfZSA9IGVycjsKICAgIH0gZmluYWxseSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0pIF9pWyJyZXR1cm4iXSgpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGlmIChfZCkgdGhyb3cgX2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBfYXJyOwogIH0KICByZXR1cm4gZnVuY3Rpb24gKGFyciwgaSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgICByZXR1cm4gYXJyOwogICAgfSBlbHNlIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikpIHsKICAgICAgcmV0dXJuIHNsaWNlSXRlcmF0b3IoYXJyLCBpKTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKICAgIH0KICB9Owp9KCk7CnZhciBNSU5fVElNRVNURVAgPSAwLjAwMTsKdmFyIE1BWF9USU1FU1RFUCA9IDE7CnZhciBkYXRhVXJpID0gZnVuY3Rpb24gZGF0YVVyaShtaW1lVHlwZSwgc3ZnKSB7CiAgcmV0dXJuICdkYXRhOicgKyBtaW1lVHlwZSArICcsJyArIGVuY29kZVVSSUNvbXBvbmVudChzdmcpOwp9Owp2YXIgbGVycCA9IGZ1bmN0aW9uIGxlcnAoYSwgYiwgdCkgewogIHJldHVybiBhICsgKGIgLSBhKSAqIHQ7Cn07CnZhciBpc0lPUyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgaXNJT1MgPSAvaVBhZHxpUGhvbmV8aVBvZC8udGVzdChuYXZpZ2F0b3IucGxhdGZvcm0pOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gaXNJT1M7CiAgfTsKfSgpOwp2YXIgaXNXZWJWaWV3QW5kcm9pZCA9IGZ1bmN0aW9uICgpIHsKICB2YXIgaXNXZWJWaWV3QW5kcm9pZCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignVmVyc2lvbicpICE9PSAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUnKSAhPT0gLTE7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBpc1dlYlZpZXdBbmRyb2lkOwogIH07Cn0oKTsKdmFyIGlzU2FmYXJpID0gZnVuY3Rpb24gKCkgewogIHZhciBpc1NhZmFyaSA9IC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBpc1NhZmFyaTsKICB9Owp9KCk7CnZhciBpc0ZpcmVmb3hBbmRyb2lkID0gZnVuY3Rpb24gKCkgewogIHZhciBpc0ZpcmVmb3hBbmRyb2lkID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdGaXJlZm94JykgIT09IC0xICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpICE9PSAtMTsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGlzRmlyZWZveEFuZHJvaWQ7CiAgfTsKfSgpOwp2YXIgZ2V0Q2hyb21lVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKICB2YXIgbWF0Y2ggPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8uKkNocm9tZVwvKFswLTldKykvKTsKICB2YXIgdmFsdWUgPSBtYXRjaCA/IHBhcnNlSW50KG1hdGNoWzFdLCAxMCkgOiBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKfSgpOwp2YXIgaXNDaHJvbWVXaXRob3V0RGV2aWNlTW90aW9uID0gZnVuY3Rpb24gKCkgewogIHZhciB2YWx1ZSA9IGZhbHNlOwogIGlmIChnZXRDaHJvbWVWZXJzaW9uKCkgPT09IDY1KSB7CiAgICB2YXIgbWF0Y2ggPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8uKkNocm9tZVwvKFswLTlcLl0qKS8pOwogICAgaWYgKG1hdGNoKSB7CiAgICAgIHZhciBfbWF0Y2gkMSRzcGxpdCA9IG1hdGNoWzFdLnNwbGl0KCcuJyksCiAgICAgICAgICBfbWF0Y2gkMSRzcGxpdDIgPSBzbGljZWRUb0FycmF5KF9tYXRjaCQxJHNwbGl0LCA0KSwKICAgICAgICAgIG1ham9yID0gX21hdGNoJDEkc3BsaXQyWzBdLAogICAgICAgICAgbWlub3IgPSBfbWF0Y2gkMSRzcGxpdDJbMV0sCiAgICAgICAgICBicmFuY2ggPSBfbWF0Y2gkMSRzcGxpdDJbMl0sCiAgICAgICAgICBidWlsZCA9IF9tYXRjaCQxJHNwbGl0MlszXTsKICAgICAgdmFsdWUgPSBwYXJzZUludChicmFuY2gsIDEwKSA9PT0gMzMyNSAmJiBwYXJzZUludChidWlsZCwgMTApIDwgMTQ4OwogICAgfQogIH0KICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHZhbHVlOwogIH07Cn0oKTsKdmFyIGlzUjcgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIGlzUjcgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1I3IEJ1aWxkJykgIT09IC0xOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gaXNSNzsKICB9Owp9KCk7CnZhciBpc0xhbmRzY2FwZU1vZGUgPSBmdW5jdGlvbiBpc0xhbmRzY2FwZU1vZGUoKSB7CiAgdmFyIHJ0biA9IHdpbmRvdy5vcmllbnRhdGlvbiA9PSA5MCB8fCB3aW5kb3cub3JpZW50YXRpb24gPT0gLTkwOwogIHJldHVybiBpc1I3KCkgPyAhcnRuIDogcnRuOwp9Owp2YXIgaXNUaW1lc3RhbXBEZWx0YVZhbGlkID0gZnVuY3Rpb24gaXNUaW1lc3RhbXBEZWx0YVZhbGlkKHRpbWVzdGFtcERlbHRhUykgewogIGlmIChpc05hTih0aW1lc3RhbXBEZWx0YVMpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICh0aW1lc3RhbXBEZWx0YVMgPD0gTUlOX1RJTUVTVEVQKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICh0aW1lc3RhbXBEZWx0YVMgPiBNQVhfVElNRVNURVApIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIHRydWU7Cn07CnZhciBnZXRTY3JlZW5XaWR0aCA9IGZ1bmN0aW9uIGdldFNjcmVlbldpZHRoKCkgewogIHJldHVybiBNYXRoLm1heCh3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKfTsKdmFyIGdldFNjcmVlbkhlaWdodCA9IGZ1bmN0aW9uIGdldFNjcmVlbkhlaWdodCgpIHsKICByZXR1cm4gTWF0aC5taW4od2luZG93LnNjcmVlbi53aWR0aCwgd2luZG93LnNjcmVlbi5oZWlnaHQpICogd2luZG93LmRldmljZVBpeGVsUmF0aW87Cn07CnZhciByZXF1ZXN0RnVsbHNjcmVlbiA9IGZ1bmN0aW9uIHJlcXVlc3RGdWxsc2NyZWVuKGVsZW1lbnQpIHsKICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmIChlbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKSB7CiAgICBlbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgfSBlbHNlIGlmIChlbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKSB7CiAgICBlbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgfSBlbHNlIGlmIChlbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuKSB7CiAgICBlbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CiAgfSBlbHNlIGlmIChlbGVtZW50Lm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgIGVsZW1lbnQubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiB0cnVlOwp9Owp2YXIgZXhpdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiBleGl0RnVsbHNjcmVlbigpIHsKICBpZiAoZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHsKICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikgewogICAgZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHsKICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gdHJ1ZTsKfTsKdmFyIGdldEZ1bGxzY3JlZW5FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKSB7CiAgcmV0dXJuIGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnQ7Cn07CnZhciBsaW5rUHJvZ3JhbSA9IGZ1bmN0aW9uIGxpbmtQcm9ncmFtKGdsLCB2ZXJ0ZXhTb3VyY2UsIGZyYWdtZW50U291cmNlLCBhdHRyaWJMb2NhdGlvbk1hcCkgewogIHZhciB2ZXJ0ZXhTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUik7CiAgZ2wuc2hhZGVyU291cmNlKHZlcnRleFNoYWRlciwgdmVydGV4U291cmNlKTsKICBnbC5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlcik7CiAgdmFyIGZyYWdtZW50U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7CiAgZ2wuc2hhZGVyU291cmNlKGZyYWdtZW50U2hhZGVyLCBmcmFnbWVudFNvdXJjZSk7CiAgZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CiAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleFNoYWRlcik7CiAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKICBmb3IgKHZhciBhdHRyaWJOYW1lIGluIGF0dHJpYkxvY2F0aW9uTWFwKSB7CiAgICBnbC5iaW5kQXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgYXR0cmliTG9jYXRpb25NYXBbYXR0cmliTmFtZV0sIGF0dHJpYk5hbWUpOwogIH1nbC5saW5rUHJvZ3JhbShwcm9ncmFtKTsKICBnbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwogIHJldHVybiBwcm9ncmFtOwp9Owp2YXIgZ2V0UHJvZ3JhbVVuaWZvcm1zID0gZnVuY3Rpb24gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCBwcm9ncmFtKSB7CiAgdmFyIHVuaWZvcm1zID0ge307CiAgdmFyIHVuaWZvcm1Db3VudCA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuQUNUSVZFX1VOSUZPUk1TKTsKICB2YXIgdW5pZm9ybU5hbWUgPSAnJzsKICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaWZvcm1Db3VudDsgaSsrKSB7CiAgICB2YXIgdW5pZm9ybUluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpOwogICAgdW5pZm9ybU5hbWUgPSB1bmlmb3JtSW5mby5uYW1lLnJlcGxhY2UoJ1swXScsICcnKTsKICAgIHVuaWZvcm1zW3VuaWZvcm1OYW1lXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCB1bmlmb3JtTmFtZSk7CiAgfQogIHJldHVybiB1bmlmb3JtczsKfTsKdmFyIG9ydGhvTWF0cml4ID0gZnVuY3Rpb24gb3J0aG9NYXRyaXgob3V0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikgewogIHZhciBsciA9IDEgLyAobGVmdCAtIHJpZ2h0KSwKICAgICAgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCksCiAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTsKICBvdXRbMF0gPSAtMiAqIGxyOwogIG91dFsxXSA9IDA7CiAgb3V0WzJdID0gMDsKICBvdXRbM10gPSAwOwogIG91dFs0XSA9IDA7CiAgb3V0WzVdID0gLTIgKiBidDsKICBvdXRbNl0gPSAwOwogIG91dFs3XSA9IDA7CiAgb3V0WzhdID0gMDsKICBvdXRbOV0gPSAwOwogIG91dFsxMF0gPSAyICogbmY7CiAgb3V0WzExXSA9IDA7CiAgb3V0WzEyXSA9IChsZWZ0ICsgcmlnaHQpICogbHI7CiAgb3V0WzEzXSA9ICh0b3AgKyBib3R0b20pICogYnQ7CiAgb3V0WzE0XSA9IChmYXIgKyBuZWFyKSAqIG5mOwogIG91dFsxNV0gPSAxOwogIHJldHVybiBvdXQ7Cn07CnZhciBpc01vYmlsZSA9IGZ1bmN0aW9uIGlzTW9iaWxlKCkgewogIHZhciBjaGVjayA9IGZhbHNlOwogIChmdW5jdGlvbiAoYSkgewogICAgaWYgKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlOwogIH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOwogIHJldHVybiBjaGVjazsKfTsKdmFyIGV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZChkZXN0LCBzcmMpIHsKICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CiAgICBpZiAoc3JjLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgZGVzdFtrZXldID0gc3JjW2tleV07CiAgICB9CiAgfQogIHJldHVybiBkZXN0Owp9Owp2YXIgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQgPSBmdW5jdGlvbiBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpIHsKICBpZiAoaXNJT1MoKSkgewogICAgdmFyIHdpZHRoID0gY2FudmFzLnN0eWxlLndpZHRoOwogICAgdmFyIGhlaWdodCA9IGNhbnZhcy5zdHlsZS5oZWlnaHQ7CiAgICBjYW52YXMuc3R5bGUud2lkdGggPSBwYXJzZUludCh3aWR0aCkgKyAxICsgJ3B4JzsKICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpICsgJ3B4JzsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBjYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKICAgIH0sIDEwMCk7CiAgfQogIHdpbmRvdy5jYW52YXMgPSBjYW52YXM7Cn07CnZhciBmcmFtZURhdGFGcm9tUG9zZSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgcGlPdmVyMTgwID0gTWF0aC5QSSAvIDE4MC4wOwogIHZhciByYWQ0NSA9IE1hdGguUEkgKiAwLjI1OwogIGZ1bmN0aW9uIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcob3V0LCBmb3YsIG5lYXIsIGZhcikgewogICAgdmFyIHVwVGFuID0gTWF0aC50YW4oZm92ID8gZm92LnVwRGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKICAgICAgICBkb3duVGFuID0gTWF0aC50YW4oZm92ID8gZm92LmRvd25EZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAogICAgICAgIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YubGVmdERlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCiAgICAgICAgcmlnaHRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YucmlnaHREZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAogICAgICAgIHhTY2FsZSA9IDIuMCAvIChsZWZ0VGFuICsgcmlnaHRUYW4pLAogICAgICAgIHlTY2FsZSA9IDIuMCAvICh1cFRhbiArIGRvd25UYW4pOwogICAgb3V0WzBdID0geFNjYWxlOwogICAgb3V0WzFdID0gMC4wOwogICAgb3V0WzJdID0gMC4wOwogICAgb3V0WzNdID0gMC4wOwogICAgb3V0WzRdID0gMC4wOwogICAgb3V0WzVdID0geVNjYWxlOwogICAgb3V0WzZdID0gMC4wOwogICAgb3V0WzddID0gMC4wOwogICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIDAuNSk7CiAgICBvdXRbOV0gPSAodXBUYW4gLSBkb3duVGFuKSAqIHlTY2FsZSAqIDAuNTsKICAgIG91dFsxMF0gPSBmYXIgLyAobmVhciAtIGZhcik7CiAgICBvdXRbMTFdID0gLTEuMDsKICAgIG91dFsxMl0gPSAwLjA7CiAgICBvdXRbMTNdID0gMC4wOwogICAgb3V0WzE0XSA9IGZhciAqIG5lYXIgLyAobmVhciAtIGZhcik7CiAgICBvdXRbMTVdID0gMC4wOwogICAgcmV0dXJuIG91dDsKICB9CiAgZnVuY3Rpb24gbWF0NF9mcm9tUm90YXRpb25UcmFuc2xhdGlvbihvdXQsIHEsIHYpIHsKICAgIHZhciB4ID0gcVswXSwKICAgICAgICB5ID0gcVsxXSwKICAgICAgICB6ID0gcVsyXSwKICAgICAgICB3ID0gcVszXSwKICAgICAgICB4MiA9IHggKyB4LAogICAgICAgIHkyID0geSArIHksCiAgICAgICAgejIgPSB6ICsgeiwKICAgICAgICB4eCA9IHggKiB4MiwKICAgICAgICB4eSA9IHggKiB5MiwKICAgICAgICB4eiA9IHggKiB6MiwKICAgICAgICB5eSA9IHkgKiB5MiwKICAgICAgICB5eiA9IHkgKiB6MiwKICAgICAgICB6eiA9IHogKiB6MiwKICAgICAgICB3eCA9IHcgKiB4MiwKICAgICAgICB3eSA9IHcgKiB5MiwKICAgICAgICB3eiA9IHcgKiB6MjsKICAgIG91dFswXSA9IDEgLSAoeXkgKyB6eik7CiAgICBvdXRbMV0gPSB4eSArIHd6OwogICAgb3V0WzJdID0geHogLSB3eTsKICAgIG91dFszXSA9IDA7CiAgICBvdXRbNF0gPSB4eSAtIHd6OwogICAgb3V0WzVdID0gMSAtICh4eCArIHp6KTsKICAgIG91dFs2XSA9IHl6ICsgd3g7CiAgICBvdXRbN10gPSAwOwogICAgb3V0WzhdID0geHogKyB3eTsKICAgIG91dFs5XSA9IHl6IC0gd3g7CiAgICBvdXRbMTBdID0gMSAtICh4eCArIHl5KTsKICAgIG91dFsxMV0gPSAwOwogICAgb3V0WzEyXSA9IHZbMF07CiAgICBvdXRbMTNdID0gdlsxXTsKICAgIG91dFsxNF0gPSB2WzJdOwogICAgb3V0WzE1XSA9IDE7CiAgICByZXR1cm4gb3V0OwogIH0KICBmdW5jdGlvbiBtYXQ0X3RyYW5zbGF0ZShvdXQsIGEsIHYpIHsKICAgIHZhciB4ID0gdlswXSwKICAgICAgICB5ID0gdlsxXSwKICAgICAgICB6ID0gdlsyXSwKICAgICAgICBhMDAsCiAgICAgICAgYTAxLAogICAgICAgIGEwMiwKICAgICAgICBhMDMsCiAgICAgICAgYTEwLAogICAgICAgIGExMSwKICAgICAgICBhMTIsCiAgICAgICAgYTEzLAogICAgICAgIGEyMCwKICAgICAgICBhMjEsCiAgICAgICAgYTIyLAogICAgICAgIGEyMzsKICAgIGlmIChhID09PSBvdXQpIHsKICAgICAgb3V0WzEyXSA9IGFbMF0gKiB4ICsgYVs0XSAqIHkgKyBhWzhdICogeiArIGFbMTJdOwogICAgICBvdXRbMTNdID0gYVsxXSAqIHggKyBhWzVdICogeSArIGFbOV0gKiB6ICsgYVsxM107CiAgICAgIG91dFsxNF0gPSBhWzJdICogeCArIGFbNl0gKiB5ICsgYVsxMF0gKiB6ICsgYVsxNF07CiAgICAgIG91dFsxNV0gPSBhWzNdICogeCArIGFbN10gKiB5ICsgYVsxMV0gKiB6ICsgYVsxNV07CiAgICB9IGVsc2UgewogICAgICBhMDAgPSBhWzBdO2EwMSA9IGFbMV07YTAyID0gYVsyXTthMDMgPSBhWzNdOwogICAgICBhMTAgPSBhWzRdO2ExMSA9IGFbNV07YTEyID0gYVs2XTthMTMgPSBhWzddOwogICAgICBhMjAgPSBhWzhdO2EyMSA9IGFbOV07YTIyID0gYVsxMF07YTIzID0gYVsxMV07CiAgICAgIG91dFswXSA9IGEwMDtvdXRbMV0gPSBhMDE7b3V0WzJdID0gYTAyO291dFszXSA9IGEwMzsKICAgICAgb3V0WzRdID0gYTEwO291dFs1XSA9IGExMTtvdXRbNl0gPSBhMTI7b3V0WzddID0gYTEzOwogICAgICBvdXRbOF0gPSBhMjA7b3V0WzldID0gYTIxO291dFsxMF0gPSBhMjI7b3V0WzExXSA9IGEyMzsKICAgICAgb3V0WzEyXSA9IGEwMCAqIHggKyBhMTAgKiB5ICsgYTIwICogeiArIGFbMTJdOwogICAgICBvdXRbMTNdID0gYTAxICogeCArIGExMSAqIHkgKyBhMjEgKiB6ICsgYVsxM107CiAgICAgIG91dFsxNF0gPSBhMDIgKiB4ICsgYTEyICogeSArIGEyMiAqIHogKyBhWzE0XTsKICAgICAgb3V0WzE1XSA9IGEwMyAqIHggKyBhMTMgKiB5ICsgYTIzICogeiArIGFbMTVdOwogICAgfQogICAgcmV0dXJuIG91dDsKICB9CiAgZnVuY3Rpb24gbWF0NF9pbnZlcnQob3V0LCBhKSB7CiAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICBhMDEgPSBhWzFdLAogICAgICAgIGEwMiA9IGFbMl0sCiAgICAgICAgYTAzID0gYVszXSwKICAgICAgICBhMTAgPSBhWzRdLAogICAgICAgIGExMSA9IGFbNV0sCiAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICBhMTMgPSBhWzddLAogICAgICAgIGEyMCA9IGFbOF0sCiAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICBhMjIgPSBhWzEwXSwKICAgICAgICBhMjMgPSBhWzExXSwKICAgICAgICBhMzAgPSBhWzEyXSwKICAgICAgICBhMzEgPSBhWzEzXSwKICAgICAgICBhMzIgPSBhWzE0XSwKICAgICAgICBhMzMgPSBhWzE1XSwKICAgICAgICBiMDAgPSBhMDAgKiBhMTEgLSBhMDEgKiBhMTAsCiAgICAgICAgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwLAogICAgICAgIGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMCwKICAgICAgICBiMDMgPSBhMDEgKiBhMTIgLSBhMDIgKiBhMTEsCiAgICAgICAgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExLAogICAgICAgIGIwNSA9IGEwMiAqIGExMyAtIGEwMyAqIGExMiwKICAgICAgICBiMDYgPSBhMjAgKiBhMzEgLSBhMjEgKiBhMzAsCiAgICAgICAgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwLAogICAgICAgIGIwOCA9IGEyMCAqIGEzMyAtIGEyMyAqIGEzMCwKICAgICAgICBiMDkgPSBhMjEgKiBhMzIgLSBhMjIgKiBhMzEsCiAgICAgICAgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxLAogICAgICAgIGIxMSA9IGEyMiAqIGEzMyAtIGEyMyAqIGEzMiwKICAgIGRldCA9IGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjsKICAgIGlmICghZGV0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZGV0ID0gMS4wIC8gZGV0OwogICAgb3V0WzBdID0gKGExMSAqIGIxMSAtIGExMiAqIGIxMCArIGExMyAqIGIwOSkgKiBkZXQ7CiAgICBvdXRbMV0gPSAoYTAyICogYjEwIC0gYTAxICogYjExIC0gYTAzICogYjA5KSAqIGRldDsKICAgIG91dFsyXSA9IChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0OwogICAgb3V0WzNdID0gKGEyMiAqIGIwNCAtIGEyMSAqIGIwNSAtIGEyMyAqIGIwMykgKiBkZXQ7CiAgICBvdXRbNF0gPSAoYTEyICogYjA4IC0gYTEwICogYjExIC0gYTEzICogYjA3KSAqIGRldDsKICAgIG91dFs1XSA9IChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0OwogICAgb3V0WzZdID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7CiAgICBvdXRbN10gPSAoYTIwICogYjA1IC0gYTIyICogYjAyICsgYTIzICogYjAxKSAqIGRldDsKICAgIG91dFs4XSA9IChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0OwogICAgb3V0WzldID0gKGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNikgKiBkZXQ7CiAgICBvdXRbMTBdID0gKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQ7CiAgICBvdXRbMTFdID0gKGEyMSAqIGIwMiAtIGEyMCAqIGIwNCAtIGEyMyAqIGIwMCkgKiBkZXQ7CiAgICBvdXRbMTJdID0gKGExMSAqIGIwNyAtIGExMCAqIGIwOSAtIGExMiAqIGIwNikgKiBkZXQ7CiAgICBvdXRbMTNdID0gKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQ7CiAgICBvdXRbMTRdID0gKGEzMSAqIGIwMSAtIGEzMCAqIGIwMyAtIGEzMiAqIGIwMCkgKiBkZXQ7CiAgICBvdXRbMTVdID0gKGEyMCAqIGIwMyAtIGEyMSAqIGIwMSArIGEyMiAqIGIwMCkgKiBkZXQ7CiAgICByZXR1cm4gb3V0OwogIH0KICB2YXIgZGVmYXVsdE9yaWVudGF0aW9uID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgMCwgMV0pOwogIHZhciBkZWZhdWx0UG9zaXRpb24gPSBuZXcgRmxvYXQzMkFycmF5KFswLCAwLCAwXSk7CiAgZnVuY3Rpb24gdXBkYXRlRXllTWF0cmljZXMocHJvamVjdGlvbiwgdmlldywgcG9zZSwgZm92LCBvZmZzZXQsIHZyRGlzcGxheSkgewogICAgbWF0NF9wZXJzcGVjdGl2ZUZyb21GaWVsZE9mVmlldyhwcm9qZWN0aW9uLCBmb3YgfHwgbnVsbCwgdnJEaXNwbGF5LmRlcHRoTmVhciwgdnJEaXNwbGF5LmRlcHRoRmFyKTsKICAgIHZhciBvcmllbnRhdGlvbiA9IHBvc2Uub3JpZW50YXRpb24gfHwgZGVmYXVsdE9yaWVudGF0aW9uOwogICAgdmFyIHBvc2l0aW9uID0gcG9zZS5wb3NpdGlvbiB8fCBkZWZhdWx0UG9zaXRpb247CiAgICBtYXQ0X2Zyb21Sb3RhdGlvblRyYW5zbGF0aW9uKHZpZXcsIG9yaWVudGF0aW9uLCBwb3NpdGlvbik7CiAgICBpZiAob2Zmc2V0KSBtYXQ0X3RyYW5zbGF0ZSh2aWV3LCB2aWV3LCBvZmZzZXQpOwogICAgbWF0NF9pbnZlcnQodmlldywgdmlldyk7CiAgfQogIHJldHVybiBmdW5jdGlvbiAoZnJhbWVEYXRhLCBwb3NlLCB2ckRpc3BsYXkpIHsKICAgIGlmICghZnJhbWVEYXRhIHx8ICFwb3NlKSByZXR1cm4gZmFsc2U7CiAgICBmcmFtZURhdGEucG9zZSA9IHBvc2U7CiAgICBmcmFtZURhdGEudGltZXN0YW1wID0gcG9zZS50aW1lc3RhbXA7CiAgICB1cGRhdGVFeWVNYXRyaWNlcyhmcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5sZWZ0Vmlld01hdHJpeCwgcG9zZSwgdnJEaXNwbGF5Ll9nZXRGaWVsZE9mVmlldygibGVmdCIpLCB2ckRpc3BsYXkuX2dldEV5ZU9mZnNldCgibGVmdCIpLCB2ckRpc3BsYXkpOwogICAgdXBkYXRlRXllTWF0cmljZXMoZnJhbWVEYXRhLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCwgZnJhbWVEYXRhLnJpZ2h0Vmlld01hdHJpeCwgcG9zZSwgdnJEaXNwbGF5Ll9nZXRGaWVsZE9mVmlldygicmlnaHQiKSwgdnJEaXNwbGF5Ll9nZXRFeWVPZmZzZXQoInJpZ2h0IiksIHZyRGlzcGxheSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Owp9KCk7CnZhciBpc0luc2lkZUNyb3NzT3JpZ2luSUZyYW1lID0gZnVuY3Rpb24gaXNJbnNpZGVDcm9zc09yaWdpbklGcmFtZSgpIHsKICB2YXIgaXNGcmFtZWQgPSB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDsKICB2YXIgcmVmT3JpZ2luID0gZ2V0T3JpZ2luRnJvbVVybChkb2N1bWVudC5yZWZlcnJlcik7CiAgdmFyIHRoaXNPcmlnaW4gPSBnZXRPcmlnaW5Gcm9tVXJsKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKICByZXR1cm4gaXNGcmFtZWQgJiYgcmVmT3JpZ2luICE9PSB0aGlzT3JpZ2luOwp9Owp2YXIgZ2V0T3JpZ2luRnJvbVVybCA9IGZ1bmN0aW9uIGdldE9yaWdpbkZyb21VcmwodXJsKSB7CiAgdmFyIGRvbWFpbklkeDsKICB2YXIgcHJvdG9TZXBJZHggPSB1cmwuaW5kZXhPZigiOi8vIik7CiAgaWYgKHByb3RvU2VwSWR4ICE9PSAtMSkgewogICAgZG9tYWluSWR4ID0gcHJvdG9TZXBJZHggKyAzOwogIH0gZWxzZSB7CiAgICBkb21haW5JZHggPSAwOwogIH0KICB2YXIgZG9tYWluRW5kSWR4ID0gdXJsLmluZGV4T2YoJy8nLCBkb21haW5JZHgpOwogIGlmIChkb21haW5FbmRJZHggPT09IC0xKSB7CiAgICBkb21haW5FbmRJZHggPSB1cmwubGVuZ3RoOwogIH0KICByZXR1cm4gdXJsLnN1YnN0cmluZygwLCBkb21haW5FbmRJZHgpOwp9Owp2YXIgZ2V0UXVhdGVybmlvbkFuZ2xlID0gZnVuY3Rpb24gZ2V0UXVhdGVybmlvbkFuZ2xlKHF1YXQpIHsKICBpZiAocXVhdC53ID4gMSkgewogICAgY29uc29sZS53YXJuKCdnZXRRdWF0ZXJuaW9uQW5nbGU6IHcgPiAxJyk7CiAgICByZXR1cm4gMDsKICB9CiAgdmFyIGFuZ2xlID0gMiAqIE1hdGguYWNvcyhxdWF0LncpOwogIHJldHVybiBhbmdsZTsKfTsKdmFyIHdhcm5PbmNlID0gZnVuY3Rpb24gKCkgewogIHZhciBvYnNlcnZlZFdhcm5pbmdzID0ge307CiAgcmV0dXJuIGZ1bmN0aW9uIChrZXksIG1lc3NhZ2UpIHsKICAgIGlmIChvYnNlcnZlZFdhcm5pbmdzW2tleV0gPT09IHVuZGVmaW5lZCkgewogICAgICBjb25zb2xlLndhcm4oJ3dlYnZyLXBvbHlmaWxsOiAnICsgbWVzc2FnZSk7CiAgICAgIG9ic2VydmVkV2FybmluZ3Nba2V5XSA9IHRydWU7CiAgICB9CiAgfTsKfSgpOwp2YXIgZGVwcmVjYXRlV2FybmluZyA9IGZ1bmN0aW9uIGRlcHJlY2F0ZVdhcm5pbmcoZGVwcmVjYXRlZCwgc3VnZ2VzdGVkKSB7CiAgdmFyIGFsdGVybmF0aXZlID0gc3VnZ2VzdGVkID8gJ1BsZWFzZSB1c2UgJyArIHN1Z2dlc3RlZCArICcgaW5zdGVhZC4nIDogJyc7CiAgd2Fybk9uY2UoZGVwcmVjYXRlZCwgZGVwcmVjYXRlZCArICcgaGFzIGJlZW4gZGVwcmVjYXRlZC4gJyArICdUaGlzIG1heSBub3Qgd29yayBvbiBuYXRpdmUgV2ViVlIgZGlzcGxheXMuICcgKyBhbHRlcm5hdGl2ZSk7Cn07CmZ1bmN0aW9uIFdHTFVQcmVzZXJ2ZUdMU3RhdGUoZ2wsIGJpbmRpbmdzLCBjYWxsYmFjaykgewogIGlmICghYmluZGluZ3MpIHsKICAgIGNhbGxiYWNrKGdsKTsKICAgIHJldHVybjsKICB9CiAgdmFyIGJvdW5kVmFsdWVzID0gW107CiAgdmFyIGFjdGl2ZVRleHR1cmUgPSBudWxsOwogIGZvciAodmFyIGkgPSAwOyBpIDwgYmluZGluZ3MubGVuZ3RoOyArK2kpIHsKICAgIHZhciBiaW5kaW5nID0gYmluZGluZ3NbaV07CiAgICBzd2l0Y2ggKGJpbmRpbmcpIHsKICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfMkQ6CiAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQOgogICAgICAgIHZhciB0ZXh0dXJlVW5pdCA9IGJpbmRpbmdzWysraV07CiAgICAgICAgaWYgKHRleHR1cmVVbml0IDwgZ2wuVEVYVFVSRTAgfHwgdGV4dHVyZVVuaXQgPiBnbC5URVhUVVJFMzEpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRFWFRVUkVfQklORElOR18yRCBvciBURVhUVVJFX0JJTkRJTkdfQ1VCRV9NQVAgbXVzdCBiZSBmb2xsb3dlZCBieSBhIHZhbGlkIHRleHR1cmUgdW5pdCIpOwogICAgICAgICAgYm91bmRWYWx1ZXMucHVzaChudWxsLCBudWxsKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoIWFjdGl2ZVRleHR1cmUpIHsKICAgICAgICAgIGFjdGl2ZVRleHR1cmUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQUNUSVZFX1RFWFRVUkUpOwogICAgICAgIH0KICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVVbml0KTsKICAgICAgICBib3VuZFZhbHVlcy5wdXNoKGdsLmdldFBhcmFtZXRlcihiaW5kaW5nKSwgbnVsbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgZ2wuQUNUSVZFX1RFWFRVUkU6CiAgICAgICAgYWN0aXZlVGV4dHVyZSA9IGdsLmdldFBhcmFtZXRlcihnbC5BQ1RJVkVfVEVYVFVSRSk7CiAgICAgICAgYm91bmRWYWx1ZXMucHVzaChudWxsKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBib3VuZFZhbHVlcy5wdXNoKGdsLmdldFBhcmFtZXRlcihiaW5kaW5nKSk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIGNhbGxiYWNrKGdsKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmRpbmdzLmxlbmd0aDsgKytpKSB7CiAgICB2YXIgYmluZGluZyA9IGJpbmRpbmdzW2ldOwogICAgdmFyIGJvdW5kVmFsdWUgPSBib3VuZFZhbHVlc1tpXTsKICAgIHN3aXRjaCAoYmluZGluZykgewogICAgICBjYXNlIGdsLkFDVElWRV9URVhUVVJFOgogICAgICAgIGJyZWFrOwogICAgICBjYXNlIGdsLkFSUkFZX0JVRkZFUl9CSU5ESU5HOgogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBib3VuZFZhbHVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBnbC5DT0xPUl9DTEVBUl9WQUxVRToKICAgICAgICBnbC5jbGVhckNvbG9yKGJvdW5kVmFsdWVbMF0sIGJvdW5kVmFsdWVbMV0sIGJvdW5kVmFsdWVbMl0sIGJvdW5kVmFsdWVbM10pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIGdsLkNPTE9SX1dSSVRFTUFTSzoKICAgICAgICBnbC5jb2xvck1hc2soYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgZ2wuQ1VSUkVOVF9QUk9HUkFNOgogICAgICAgIGdsLnVzZVByb2dyYW0oYm91bmRWYWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVJfQklORElORzoKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBib3VuZFZhbHVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBnbC5GUkFNRUJVRkZFUl9CSU5ESU5HOgogICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgYm91bmRWYWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgZ2wuUkVOREVSQlVGRkVSX0JJTkRJTkc6CiAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIGJvdW5kVmFsdWUpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR18yRDoKICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwogICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgYm91bmRWYWx1ZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQOgogICAgICAgIHZhciB0ZXh0dXJlVW5pdCA9IGJpbmRpbmdzWysraV07CiAgICAgICAgaWYgKHRleHR1cmVVbml0IDwgZ2wuVEVYVFVSRTAgfHwgdGV4dHVyZVVuaXQgPiBnbC5URVhUVVJFMzEpCiAgICAgICAgICBicmVhazsKICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVVbml0KTsKICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFX0NVQkVfTUFQLCBib3VuZFZhbHVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBnbC5WSUVXUE9SVDoKICAgICAgICBnbC52aWV3cG9ydChib3VuZFZhbHVlWzBdLCBib3VuZFZhbHVlWzFdLCBib3VuZFZhbHVlWzJdLCBib3VuZFZhbHVlWzNdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBnbC5CTEVORDoKICAgICAgY2FzZSBnbC5DVUxMX0ZBQ0U6CiAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKICAgICAgY2FzZSBnbC5TQ0lTU09SX1RFU1Q6CiAgICAgIGNhc2UgZ2wuU1RFTkNJTF9URVNUOgogICAgICAgIGlmIChib3VuZFZhbHVlKSB7CiAgICAgICAgICBnbC5lbmFibGUoYmluZGluZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdsLmRpc2FibGUoYmluZGluZyk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnNvbGUubG9nKCJObyBHTCByZXN0b3JlIGJlaGF2aW9yIGZvciAweCIgKyBiaW5kaW5nLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoYWN0aXZlVGV4dHVyZSkgewogICAgICBnbC5hY3RpdmVUZXh0dXJlKGFjdGl2ZVRleHR1cmUpOwogICAgfQogIH0KfQp2YXIgZ2xQcmVzZXJ2ZVN0YXRlID0gV0dMVVByZXNlcnZlR0xTdGF0ZTsKdmFyIGRpc3RvcnRpb25WUyA9IFsnYXR0cmlidXRlIHZlYzIgcG9zaXRpb247JywgJ2F0dHJpYnV0ZSB2ZWMzIHRleENvb3JkOycsICd2YXJ5aW5nIHZlYzIgdlRleENvb3JkOycsICd1bmlmb3JtIHZlYzQgdmlld3BvcnRPZmZzZXRTY2FsZVsyXTsnLCAndm9pZCBtYWluKCkgeycsICcgIHZlYzQgdmlld3BvcnQgPSB2aWV3cG9ydE9mZnNldFNjYWxlW2ludCh0ZXhDb29yZC56KV07JywgJyAgdlRleENvb3JkID0gKHRleENvb3JkLnh5ICogdmlld3BvcnQuencpICsgdmlld3BvcnQueHk7JywgJyAgZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wLCAxLjAgKTsnLCAnfSddLmpvaW4oJ1xuJyk7CnZhciBkaXN0b3J0aW9uRlMgPSBbJ3ByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OycsICd1bmlmb3JtIHNhbXBsZXIyRCBkaWZmdXNlOycsICd2YXJ5aW5nIHZlYzIgdlRleENvb3JkOycsICd2b2lkIG1haW4oKSB7JywgJyAgZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKGRpZmZ1c2UsIHZUZXhDb29yZCk7JywgJ30nXS5qb2luKCdcbicpOwpmdW5jdGlvbiBDYXJkYm9hcmREaXN0b3J0ZXIoZ2wsIGNhcmRib2FyZFVJLCBidWZmZXJTY2FsZSwgZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzKSB7CiAgdGhpcy5nbCA9IGdsOwogIHRoaXMuY2FyZGJvYXJkVUkgPSBjYXJkYm9hcmRVSTsKICB0aGlzLmJ1ZmZlclNjYWxlID0gYnVmZmVyU2NhbGU7CiAgdGhpcy5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MgPSBkaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3M7CiAgdGhpcy5jdHhBdHRyaWJzID0gZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKICB0aGlzLm1lc2hXaWR0aCA9IDIwOwogIHRoaXMubWVzaEhlaWdodCA9IDIwOwogIHRoaXMuYnVmZmVyV2lkdGggPSBnbC5kcmF3aW5nQnVmZmVyV2lkdGg7CiAgdGhpcy5idWZmZXJIZWlnaHQgPSBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0OwogIHRoaXMucmVhbEJpbmRGcmFtZWJ1ZmZlciA9IGdsLmJpbmRGcmFtZWJ1ZmZlcjsKICB0aGlzLnJlYWxFbmFibGUgPSBnbC5lbmFibGU7CiAgdGhpcy5yZWFsRGlzYWJsZSA9IGdsLmRpc2FibGU7CiAgdGhpcy5yZWFsQ29sb3JNYXNrID0gZ2wuY29sb3JNYXNrOwogIHRoaXMucmVhbENsZWFyQ29sb3IgPSBnbC5jbGVhckNvbG9yOwogIHRoaXMucmVhbFZpZXdwb3J0ID0gZ2wudmlld3BvcnQ7CiAgaWYgKCFpc0lPUygpKSB7CiAgICB0aGlzLnJlYWxDYW52YXNXaWR0aCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2wuY2FudmFzLl9fcHJvdG9fXywgJ3dpZHRoJyk7CiAgICB0aGlzLnJlYWxDYW52YXNIZWlnaHQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsLmNhbnZhcy5fX3Byb3RvX18sICdoZWlnaHQnKTsKICB9CiAgdGhpcy5pc1BhdGNoZWQgPSBmYWxzZTsKICB0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gbnVsbDsKICB0aGlzLmN1bGxGYWNlID0gZmFsc2U7CiAgdGhpcy5kZXB0aFRlc3QgPSBmYWxzZTsKICB0aGlzLmJsZW5kID0gZmFsc2U7CiAgdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwogIHRoaXMuc3RlbmNpbFRlc3QgPSBmYWxzZTsKICB0aGlzLnZpZXdwb3J0ID0gWzAsIDAsIDAsIDBdOwogIHRoaXMuY29sb3JNYXNrID0gW3RydWUsIHRydWUsIHRydWUsIHRydWVdOwogIHRoaXMuY2xlYXJDb2xvciA9IFswLCAwLCAwLCAwXTsKICB0aGlzLmF0dHJpYnMgPSB7CiAgICBwb3NpdGlvbjogMCwKICAgIHRleENvb3JkOiAxCiAgfTsKICB0aGlzLnByb2dyYW0gPSBsaW5rUHJvZ3JhbShnbCwgZGlzdG9ydGlvblZTLCBkaXN0b3J0aW9uRlMsIHRoaXMuYXR0cmlicyk7CiAgdGhpcy51bmlmb3JtcyA9IGdldFByb2dyYW1Vbmlmb3JtcyhnbCwgdGhpcy5wcm9ncmFtKTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGUgPSBuZXcgRmxvYXQzMkFycmF5KDgpOwogIHRoaXMuc2V0VGV4dHVyZUJvdW5kcygpOwogIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgdGhpcy5pbmRleEJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogIHRoaXMuaW5kZXhDb3VudCA9IDA7CiAgdGhpcy5yZW5kZXJUYXJnZXQgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CiAgdGhpcy5mcmFtZWJ1ZmZlciA9IGdsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CiAgdGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIgPSBudWxsOwogIHRoaXMuZGVwdGhCdWZmZXIgPSBudWxsOwogIHRoaXMuc3RlbmNpbEJ1ZmZlciA9IG51bGw7CiAgaWYgKHRoaXMuY3R4QXR0cmlicy5kZXB0aCAmJiB0aGlzLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgdGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIgPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICB9IGVsc2UgaWYgKHRoaXMuY3R4QXR0cmlicy5kZXB0aCkgewogICAgdGhpcy5kZXB0aEJ1ZmZlciA9IGdsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwogIH0gZWxzZSBpZiAodGhpcy5jdHhBdHRyaWJzLnN0ZW5jaWwpIHsKICAgIHRoaXMuc3RlbmNpbEJ1ZmZlciA9IGdsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwogIH0KICB0aGlzLnBhdGNoKCk7CiAgdGhpcy5vblJlc2l6ZSgpOwp9CkNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgZ2wgPSB0aGlzLmdsOwogIHRoaXMudW5wYXRjaCgpOwogIGdsLmRlbGV0ZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKICBnbC5kZWxldGVCdWZmZXIodGhpcy52ZXJ0ZXhCdWZmZXIpOwogIGdsLmRlbGV0ZUJ1ZmZlcih0aGlzLmluZGV4QnVmZmVyKTsKICBnbC5kZWxldGVUZXh0dXJlKHRoaXMucmVuZGVyVGFyZ2V0KTsKICBnbC5kZWxldGVGcmFtZWJ1ZmZlcih0aGlzLmZyYW1lYnVmZmVyKTsKICBpZiAodGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIpIHsKICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CiAgfQogIGlmICh0aGlzLmRlcHRoQnVmZmVyKSB7CiAgICBnbC5kZWxldGVSZW5kZXJidWZmZXIodGhpcy5kZXB0aEJ1ZmZlcik7CiAgfQogIGlmICh0aGlzLnN0ZW5jaWxCdWZmZXIpIHsKICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLnN0ZW5jaWxCdWZmZXIpOwogIH0KICBpZiAodGhpcy5jYXJkYm9hcmRVSSkgewogICAgdGhpcy5jYXJkYm9hcmRVSS5kZXN0cm95KCk7CiAgfQp9OwpDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKCkgewogIHZhciBnbCA9IHRoaXMuZ2w7CiAgdmFyIHNlbGYgPSB0aGlzOwogIHZhciBnbFN0YXRlID0gW2dsLlJFTkRFUkJVRkZFUl9CSU5ESU5HLCBnbC5URVhUVVJFX0JJTkRJTkdfMkQsIGdsLlRFWFRVUkUwXTsKICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewogICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgIGlmIChzZWxmLnNjaXNzb3JUZXN0KSB7CiAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKICAgIH0KICAgIHNlbGYucmVhbENvbG9yTWFzay5jYWxsKGdsLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTsKICAgIHNlbGYucmVhbFZpZXdwb3J0LmNhbGwoZ2wsIDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDEpOwogICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIHNlbGYuZnJhbWVidWZmZXIpOwogICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2VsZi5yZW5kZXJUYXJnZXQpOwogICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBzZWxmLmN0eEF0dHJpYnMuYWxwaGEgPyBnbC5SR0JBIDogZ2wuUkdCLCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCwgMCwgc2VsZi5jdHhBdHRyaWJzLmFscGhhID8gZ2wuUkdCQSA6IGdsLlJHQiwgZ2wuVU5TSUdORURfQllURSwgbnVsbCk7CiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTElORUFSKTsKICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpOwogICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTsKICAgIGdsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKGdsLkZSQU1FQlVGRkVSLCBnbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2wuVEVYVFVSRV8yRCwgc2VsZi5yZW5kZXJUYXJnZXQsIDApOwogICAgaWYgKHNlbGYuY3R4QXR0cmlicy5kZXB0aCAmJiBzZWxmLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aFN0ZW5jaWxCdWZmZXIpOwogICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuREVQVEhfU1RFTkNJTCwgc2VsZi5idWZmZXJXaWR0aCwgc2VsZi5idWZmZXJIZWlnaHQpOwogICAgICBnbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhTdGVuY2lsQnVmZmVyKTsKICAgIH0gZWxzZSBpZiAoc2VsZi5jdHhBdHRyaWJzLmRlcHRoKSB7CiAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoQnVmZmVyKTsKICAgICAgZ2wucmVuZGVyYnVmZmVyU3RvcmFnZShnbC5SRU5ERVJCVUZGRVIsIGdsLkRFUFRIX0NPTVBPTkVOVDE2LCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CiAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhCdWZmZXIpOwogICAgfSBlbHNlIGlmIChzZWxmLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5zdGVuY2lsQnVmZmVyKTsKICAgICAgZ2wucmVuZGVyYnVmZmVyU3RvcmFnZShnbC5SRU5ERVJCVUZGRVIsIGdsLlNURU5DSUxfSU5ERVg4LCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CiAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5TVEVOQ0lMX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5zdGVuY2lsQnVmZmVyKTsKICAgIH0KICAgIGlmICghZ2wuY2hlY2tGcmFtZWJ1ZmZlclN0YXR1cyhnbC5GUkFNRUJVRkZFUikgPT09IGdsLkZSQU1FQlVGRkVSX0NPTVBMRVRFKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZyYW1lYnVmZmVyIGluY29tcGxldGUhJyk7CiAgICB9CiAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIHNlbGYubGFzdEJvdW5kRnJhbWVidWZmZXIpOwogICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CiAgICB9CiAgICBzZWxmLnJlYWxDb2xvck1hc2suYXBwbHkoZ2wsIHNlbGYuY29sb3JNYXNrKTsKICAgIHNlbGYucmVhbFZpZXdwb3J0LmFwcGx5KGdsLCBzZWxmLnZpZXdwb3J0KTsKICAgIHNlbGYucmVhbENsZWFyQ29sb3IuYXBwbHkoZ2wsIHNlbGYuY2xlYXJDb2xvcik7CiAgfSk7CiAgaWYgKHRoaXMuY2FyZGJvYXJkVUkpIHsKICAgIHRoaXMuY2FyZGJvYXJkVUkub25SZXNpemUoKTsKICB9Cn07CkNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUucGF0Y2ggPSBmdW5jdGlvbiAoKSB7CiAgaWYgKHRoaXMuaXNQYXRjaGVkKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBzZWxmID0gdGhpczsKICB2YXIgY2FudmFzID0gdGhpcy5nbC5jYW52YXM7CiAgdmFyIGdsID0gdGhpcy5nbDsKICBpZiAoIWlzSU9TKCkpIHsKICAgIGNhbnZhcy53aWR0aCA9IGdldFNjcmVlbldpZHRoKCkgKiB0aGlzLmJ1ZmZlclNjYWxlOwogICAgY2FudmFzLmhlaWdodCA9IGdldFNjcmVlbkhlaWdodCgpICogdGhpcy5idWZmZXJTY2FsZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICd3aWR0aCcsIHsKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gc2VsZi5idWZmZXJXaWR0aDsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgICBzZWxmLmJ1ZmZlcldpZHRoID0gdmFsdWU7CiAgICAgICAgc2VsZi5yZWFsQ2FudmFzV2lkdGguc2V0LmNhbGwoY2FudmFzLCB2YWx1ZSk7CiAgICAgICAgc2VsZi5vblJlc2l6ZSgpOwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICdoZWlnaHQnLCB7CiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuYnVmZmVySGVpZ2h0OwogICAgICB9LAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAgICAgIHNlbGYuYnVmZmVySGVpZ2h0ID0gdmFsdWU7CiAgICAgICAgc2VsZi5yZWFsQ2FudmFzSGVpZ2h0LnNldC5jYWxsKGNhbnZhcywgdmFsdWUpOwogICAgICAgIHNlbGYub25SZXNpemUoKTsKICAgICAgfQogICAgfSk7CiAgfQogIHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuRlJBTUVCVUZGRVJfQklORElORyk7CiAgaWYgKHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPT0gbnVsbCkgewogICAgdGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IHRoaXMuZnJhbWVidWZmZXI7CiAgICB0aGlzLmdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgdGhpcy5mcmFtZWJ1ZmZlcik7CiAgfQogIHRoaXMuZ2wuYmluZEZyYW1lYnVmZmVyID0gZnVuY3Rpb24gKHRhcmdldCwgZnJhbWVidWZmZXIpIHsKICAgIHNlbGYubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlciA/IGZyYW1lYnVmZmVyIDogc2VsZi5mcmFtZWJ1ZmZlcjsKICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCB0YXJnZXQsIHNlbGYubGFzdEJvdW5kRnJhbWVidWZmZXIpOwogIH07CiAgdGhpcy5jdWxsRmFjZSA9IGdsLmdldFBhcmFtZXRlcihnbC5DVUxMX0ZBQ0UpOwogIHRoaXMuZGVwdGhUZXN0ID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkRFUFRIX1RFU1QpOwogIHRoaXMuYmxlbmQgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQkxFTkQpOwogIHRoaXMuc2Npc3NvclRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuU0NJU1NPUl9URVNUKTsKICB0aGlzLnN0ZW5jaWxUZXN0ID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLlNURU5DSUxfVEVTVCk7CiAgZ2wuZW5hYmxlID0gZnVuY3Rpb24gKHBuYW1lKSB7CiAgICBzd2l0Y2ggKHBuYW1lKSB7CiAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgogICAgICAgIHNlbGYuY3VsbEZhY2UgPSB0cnVlO2JyZWFrOwogICAgICBjYXNlIGdsLkRFUFRIX1RFU1Q6CiAgICAgICAgc2VsZi5kZXB0aFRlc3QgPSB0cnVlO2JyZWFrOwogICAgICBjYXNlIGdsLkJMRU5EOgogICAgICAgIHNlbGYuYmxlbmQgPSB0cnVlO2JyZWFrOwogICAgICBjYXNlIGdsLlNDSVNTT1JfVEVTVDoKICAgICAgICBzZWxmLnNjaXNzb3JUZXN0ID0gdHJ1ZTticmVhazsKICAgICAgY2FzZSBnbC5TVEVOQ0lMX1RFU1Q6CiAgICAgICAgc2VsZi5zdGVuY2lsVGVzdCA9IHRydWU7YnJlYWs7CiAgICB9CiAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgcG5hbWUpOwogIH07CiAgZ2wuZGlzYWJsZSA9IGZ1bmN0aW9uIChwbmFtZSkgewogICAgc3dpdGNoIChwbmFtZSkgewogICAgICBjYXNlIGdsLkNVTExfRkFDRToKICAgICAgICBzZWxmLmN1bGxGYWNlID0gZmFsc2U7YnJlYWs7CiAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKICAgICAgICBzZWxmLmRlcHRoVGVzdCA9IGZhbHNlO2JyZWFrOwogICAgICBjYXNlIGdsLkJMRU5EOgogICAgICAgIHNlbGYuYmxlbmQgPSBmYWxzZTticmVhazsKICAgICAgY2FzZSBnbC5TQ0lTU09SX1RFU1Q6CiAgICAgICAgc2VsZi5zY2lzc29yVGVzdCA9IGZhbHNlO2JyZWFrOwogICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKICAgICAgICBzZWxmLnN0ZW5jaWxUZXN0ID0gZmFsc2U7YnJlYWs7CiAgICB9CiAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIHBuYW1lKTsKICB9OwogIHRoaXMuY29sb3JNYXNrID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNPTE9SX1dSSVRFTUFTSyk7CiAgZ2wuY29sb3JNYXNrID0gZnVuY3Rpb24gKHIsIGcsIGIsIGEpIHsKICAgIHNlbGYuY29sb3JNYXNrWzBdID0gcjsKICAgIHNlbGYuY29sb3JNYXNrWzFdID0gZzsKICAgIHNlbGYuY29sb3JNYXNrWzJdID0gYjsKICAgIHNlbGYuY29sb3JNYXNrWzNdID0gYTsKICAgIHNlbGYucmVhbENvbG9yTWFzay5jYWxsKGdsLCByLCBnLCBiLCBhKTsKICB9OwogIHRoaXMuY2xlYXJDb2xvciA9IGdsLmdldFBhcmFtZXRlcihnbC5DT0xPUl9DTEVBUl9WQUxVRSk7CiAgZ2wuY2xlYXJDb2xvciA9IGZ1bmN0aW9uIChyLCBnLCBiLCBhKSB7CiAgICBzZWxmLmNsZWFyQ29sb3JbMF0gPSByOwogICAgc2VsZi5jbGVhckNvbG9yWzFdID0gZzsKICAgIHNlbGYuY2xlYXJDb2xvclsyXSA9IGI7CiAgICBzZWxmLmNsZWFyQ29sb3JbM10gPSBhOwogICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5jYWxsKGdsLCByLCBnLCBiLCBhKTsKICB9OwogIHRoaXMudmlld3BvcnQgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuVklFV1BPUlQpOwogIGdsLnZpZXdwb3J0ID0gZnVuY3Rpb24gKHgsIHksIHcsIGgpIHsKICAgIHNlbGYudmlld3BvcnRbMF0gPSB4OwogICAgc2VsZi52aWV3cG9ydFsxXSA9IHk7CiAgICBzZWxmLnZpZXdwb3J0WzJdID0gdzsKICAgIHNlbGYudmlld3BvcnRbM10gPSBoOwogICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgeCwgeSwgdywgaCk7CiAgfTsKICB0aGlzLmlzUGF0Y2hlZCA9IHRydWU7CiAgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQoY2FudmFzKTsKfTsKQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS51bnBhdGNoID0gZnVuY3Rpb24gKCkgewogIGlmICghdGhpcy5pc1BhdGNoZWQpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIGdsID0gdGhpcy5nbDsKICB2YXIgY2FudmFzID0gdGhpcy5nbC5jYW52YXM7CiAgaWYgKCFpc0lPUygpKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY2FudmFzLCAnd2lkdGgnLCB0aGlzLnJlYWxDYW52YXNXaWR0aCk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY2FudmFzLCAnaGVpZ2h0JywgdGhpcy5yZWFsQ2FudmFzSGVpZ2h0KTsKICB9CiAgY2FudmFzLndpZHRoID0gdGhpcy5idWZmZXJXaWR0aDsKICBjYW52YXMuaGVpZ2h0ID0gdGhpcy5idWZmZXJIZWlnaHQ7CiAgZ2wuYmluZEZyYW1lYnVmZmVyID0gdGhpcy5yZWFsQmluZEZyYW1lYnVmZmVyOwogIGdsLmVuYWJsZSA9IHRoaXMucmVhbEVuYWJsZTsKICBnbC5kaXNhYmxlID0gdGhpcy5yZWFsRGlzYWJsZTsKICBnbC5jb2xvck1hc2sgPSB0aGlzLnJlYWxDb2xvck1hc2s7CiAgZ2wuY2xlYXJDb2xvciA9IHRoaXMucmVhbENsZWFyQ29sb3I7CiAgZ2wudmlld3BvcnQgPSB0aGlzLnJlYWxWaWV3cG9ydDsKICBpZiAodGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9PSB0aGlzLmZyYW1lYnVmZmVyKSB7CiAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwogIH0KICB0aGlzLmlzUGF0Y2hlZCA9IGZhbHNlOwogIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQoY2FudmFzKTsKICB9LCAxKTsKfTsKQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5zZXRUZXh0dXJlQm91bmRzID0gZnVuY3Rpb24gKGxlZnRCb3VuZHMsIHJpZ2h0Qm91bmRzKSB7CiAgaWYgKCFsZWZ0Qm91bmRzKSB7CiAgICBsZWZ0Qm91bmRzID0gWzAsIDAsIDAuNSwgMV07CiAgfQogIGlmICghcmlnaHRCb3VuZHMpIHsKICAgIHJpZ2h0Qm91bmRzID0gWzAuNSwgMCwgMC41LCAxXTsKICB9CiAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzBdID0gbGVmdEJvdW5kc1swXTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMV0gPSBsZWZ0Qm91bmRzWzFdOwogIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVsyXSA9IGxlZnRCb3VuZHNbMl07CiAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzNdID0gbGVmdEJvdW5kc1szXTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbNF0gPSByaWdodEJvdW5kc1swXTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbNV0gPSByaWdodEJvdW5kc1sxXTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbNl0gPSByaWdodEJvdW5kc1syXTsKICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbN10gPSByaWdodEJvdW5kc1szXTsKfTsKQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5zdWJtaXRGcmFtZSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgZ2wgPSB0aGlzLmdsOwogIHZhciBzZWxmID0gdGhpczsKICB2YXIgZ2xTdGF0ZSA9IFtdOwogIGlmICghdGhpcy5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MpIHsKICAgIGdsU3RhdGUucHVzaChnbC5DVVJSRU5UX1BST0dSQU0sIGdsLkFSUkFZX0JVRkZFUl9CSU5ESU5HLCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUl9CSU5ESU5HLCBnbC5URVhUVVJFX0JJTkRJTkdfMkQsIGdsLlRFWFRVUkUwKTsKICB9CiAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgbnVsbCk7CiAgICBpZiAoc2VsZi5jdWxsRmFjZSkgewogICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLkNVTExfRkFDRSk7CiAgICB9CiAgICBpZiAoc2VsZi5kZXB0aFRlc3QpIHsKICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5ERVBUSF9URVNUKTsKICAgIH0KICAgIGlmIChzZWxmLmJsZW5kKSB7CiAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuQkxFTkQpOwogICAgfQogICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwogICAgfQogICAgaWYgKHNlbGYuc3RlbmNpbFRlc3QpIHsKICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TVEVOQ0lMX1RFU1QpOwogICAgfQogICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHRydWUsIHRydWUsIHRydWUsIHRydWUpOwogICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgIGlmIChzZWxmLmN0eEF0dHJpYnMuYWxwaGEgfHwgaXNJT1MoKSkgewogICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDEpOwogICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKICAgIH0KICAgIGdsLnVzZVByb2dyYW0oc2VsZi5wcm9ncmFtKTsKICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHNlbGYuaW5kZXhCdWZmZXIpOwogICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHNlbGYudmVydGV4QnVmZmVyKTsKICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNlbGYuYXR0cmlicy5wb3NpdGlvbik7CiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShzZWxmLmF0dHJpYnMudGV4Q29vcmQpOwogICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihzZWxmLmF0dHJpYnMucG9zaXRpb24sIDIsIGdsLkZMT0FULCBmYWxzZSwgMjAsIDApOwogICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihzZWxmLmF0dHJpYnMudGV4Q29vcmQsIDMsIGdsLkZMT0FULCBmYWxzZSwgMjAsIDgpOwogICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7CiAgICBnbC51bmlmb3JtMWkoc2VsZi51bmlmb3Jtcy5kaWZmdXNlLCAwKTsKICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHNlbGYucmVuZGVyVGFyZ2V0KTsKICAgIGdsLnVuaWZvcm00ZnYoc2VsZi51bmlmb3Jtcy52aWV3cG9ydE9mZnNldFNjYWxlLCBzZWxmLnZpZXdwb3J0T2Zmc2V0U2NhbGUpOwogICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgc2VsZi5pbmRleENvdW50LCBnbC5VTlNJR05FRF9TSE9SVCwgMCk7CiAgICBpZiAoc2VsZi5jYXJkYm9hcmRVSSkgewogICAgICBzZWxmLmNhcmRib2FyZFVJLnJlbmRlck5vU3RhdGUoKTsKICAgIH0KICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKHNlbGYuZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmZyYW1lYnVmZmVyKTsKICAgIGlmICghc2VsZi5jdHhBdHRyaWJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlcikgewogICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDApOwogICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKICAgIH0KICAgIGlmICghc2VsZi5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MpIHsKICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmxhc3RCb3VuZEZyYW1lYnVmZmVyKTsKICAgIH0KICAgIGlmIChzZWxmLmN1bGxGYWNlKSB7CiAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5DVUxMX0ZBQ0UpOwogICAgfQogICAgaWYgKHNlbGYuZGVwdGhUZXN0KSB7CiAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5ERVBUSF9URVNUKTsKICAgIH0KICAgIGlmIChzZWxmLmJsZW5kKSB7CiAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5CTEVORCk7CiAgICB9CiAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewogICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKICAgIH0KICAgIGlmIChzZWxmLnN0ZW5jaWxUZXN0KSB7CiAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5TVEVOQ0lMX1RFU1QpOwogICAgfQogICAgc2VsZi5yZWFsQ29sb3JNYXNrLmFwcGx5KGdsLCBzZWxmLmNvbG9yTWFzayk7CiAgICBzZWxmLnJlYWxWaWV3cG9ydC5hcHBseShnbCwgc2VsZi52aWV3cG9ydCk7CiAgICBpZiAoc2VsZi5jdHhBdHRyaWJzLmFscGhhIHx8ICFzZWxmLmN0eEF0dHJpYnMucHJlc2VydmVEcmF3aW5nQnVmZmVyKSB7CiAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuYXBwbHkoZ2wsIHNlbGYuY2xlYXJDb2xvcik7CiAgICB9CiAgfSk7CiAgaWYgKGlzSU9TKCkpIHsKICAgIHZhciBjYW52YXMgPSBnbC5jYW52YXM7CiAgICBpZiAoY2FudmFzLndpZHRoICE9IHNlbGYuYnVmZmVyV2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSBzZWxmLmJ1ZmZlckhlaWdodCkgewogICAgICBzZWxmLmJ1ZmZlcldpZHRoID0gY2FudmFzLndpZHRoOwogICAgICBzZWxmLmJ1ZmZlckhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CiAgICAgIHNlbGYub25SZXNpemUoKTsKICAgIH0KICB9Cn07CkNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUudXBkYXRlRGV2aWNlSW5mbyA9IGZ1bmN0aW9uIChkZXZpY2VJbmZvKSB7CiAgdmFyIGdsID0gdGhpcy5nbDsKICB2YXIgc2VsZiA9IHRoaXM7CiAgdmFyIGdsU3RhdGUgPSBbZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkddOwogIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICB2YXIgdmVydGljZXMgPSBzZWxmLmNvbXB1dGVNZXNoVmVydGljZXNfKHNlbGYubWVzaFdpZHRoLCBzZWxmLm1lc2hIZWlnaHQsIGRldmljZUluZm8pOwogICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHNlbGYudmVydGV4QnVmZmVyKTsKICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlcywgZ2wuU1RBVElDX0RSQVcpOwogICAgaWYgKCFzZWxmLmluZGV4Q291bnQpIHsKICAgICAgdmFyIGluZGljZXMgPSBzZWxmLmNvbXB1dGVNZXNoSW5kaWNlc18oc2VsZi5tZXNoV2lkdGgsIHNlbGYubWVzaEhlaWdodCk7CiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHNlbGYuaW5kZXhCdWZmZXIpOwogICAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpbmRpY2VzLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgIHNlbGYuaW5kZXhDb3VudCA9IGluZGljZXMubGVuZ3RoOwogICAgfQogIH0pOwp9OwpDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLmNvbXB1dGVNZXNoVmVydGljZXNfID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIGRldmljZUluZm8pIHsKICB2YXIgdmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiB3aWR0aCAqIGhlaWdodCAqIDUpOwogIHZhciBsZW5zRnJ1c3R1bSA9IGRldmljZUluZm8uZ2V0TGVmdEV5ZVZpc2libGVUYW5BbmdsZXMoKTsKICB2YXIgbm9MZW5zRnJ1c3R1bSA9IGRldmljZUluZm8uZ2V0TGVmdEV5ZU5vTGVuc1RhbkFuZ2xlcygpOwogIHZhciB2aWV3cG9ydCA9IGRldmljZUluZm8uZ2V0TGVmdEV5ZVZpc2libGVTY3JlZW5SZWN0KG5vTGVuc0ZydXN0dW0pOwogIHZhciB2aWR4ID0gMDsKICBmb3IgKHZhciBlID0gMDsgZSA8IDI7IGUrKykgewogICAgZm9yICh2YXIgaiA9IDA7IGogPCBoZWlnaHQ7IGorKykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdpZHRoOyBpKyssIHZpZHgrKykgewogICAgICAgIHZhciB1ID0gaSAvICh3aWR0aCAtIDEpOwogICAgICAgIHZhciB2ID0gaiAvIChoZWlnaHQgLSAxKTsKICAgICAgICB2YXIgcyA9IHU7CiAgICAgICAgdmFyIHQgPSB2OwogICAgICAgIHZhciB4ID0gbGVycChsZW5zRnJ1c3R1bVswXSwgbGVuc0ZydXN0dW1bMl0sIHUpOwogICAgICAgIHZhciB5ID0gbGVycChsZW5zRnJ1c3R1bVszXSwgbGVuc0ZydXN0dW1bMV0sIHYpOwogICAgICAgIHZhciBkID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpOwogICAgICAgIHZhciByID0gZGV2aWNlSW5mby5kaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKGQpOwogICAgICAgIHZhciBwID0geCAqIHIgLyBkOwogICAgICAgIHZhciBxID0geSAqIHIgLyBkOwogICAgICAgIHUgPSAocCAtIG5vTGVuc0ZydXN0dW1bMF0pIC8gKG5vTGVuc0ZydXN0dW1bMl0gLSBub0xlbnNGcnVzdHVtWzBdKTsKICAgICAgICB2ID0gKHEgLSBub0xlbnNGcnVzdHVtWzNdKSAvIChub0xlbnNGcnVzdHVtWzFdIC0gbm9MZW5zRnJ1c3R1bVszXSk7CiAgICAgICAgdSA9ICh2aWV3cG9ydC54ICsgdSAqIHZpZXdwb3J0LndpZHRoIC0gMC41KSAqIDIuMDsKICAgICAgICB2ID0gKHZpZXdwb3J0LnkgKyB2ICogdmlld3BvcnQuaGVpZ2h0IC0gMC41KSAqIDIuMDsKICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDBdID0gdTsKICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDFdID0gdjsKICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDJdID0gczsKICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDNdID0gdDsKICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDRdID0gZTsKICAgICAgfQogICAgfQogICAgdmFyIHcgPSBsZW5zRnJ1c3R1bVsyXSAtIGxlbnNGcnVzdHVtWzBdOwogICAgbGVuc0ZydXN0dW1bMF0gPSAtKHcgKyBsZW5zRnJ1c3R1bVswXSk7CiAgICBsZW5zRnJ1c3R1bVsyXSA9IHcgLSBsZW5zRnJ1c3R1bVsyXTsKICAgIHcgPSBub0xlbnNGcnVzdHVtWzJdIC0gbm9MZW5zRnJ1c3R1bVswXTsKICAgIG5vTGVuc0ZydXN0dW1bMF0gPSAtKHcgKyBub0xlbnNGcnVzdHVtWzBdKTsKICAgIG5vTGVuc0ZydXN0dW1bMl0gPSB3IC0gbm9MZW5zRnJ1c3R1bVsyXTsKICAgIHZpZXdwb3J0LnggPSAxIC0gKHZpZXdwb3J0LnggKyB2aWV3cG9ydC53aWR0aCk7CiAgfQogIHJldHVybiB2ZXJ0aWNlczsKfTsKQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5jb21wdXRlTWVzaEluZGljZXNfID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHsKICB2YXIgaW5kaWNlcyA9IG5ldyBVaW50MTZBcnJheSgyICogKHdpZHRoIC0gMSkgKiAoaGVpZ2h0IC0gMSkgKiA2KTsKICB2YXIgaGFsZndpZHRoID0gd2lkdGggLyAyOwogIHZhciBoYWxmaGVpZ2h0ID0gaGVpZ2h0IC8gMjsKICB2YXIgdmlkeCA9IDA7CiAgdmFyIGlpZHggPSAwOwogIGZvciAodmFyIGUgPSAwOyBlIDwgMjsgZSsrKSB7CiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGhlaWdodDsgaisrKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2lkdGg7IGkrKywgdmlkeCsrKSB7CiAgICAgICAgaWYgKGkgPT0gMCB8fCBqID09IDApIGNvbnRpbnVlOwogICAgICAgIGlmIChpIDw9IGhhbGZ3aWR0aCA9PSBqIDw9IGhhbGZoZWlnaHQpIHsKICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHg7CiAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGggLSAxOwogICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwogICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHg7CiAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CiAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGg7CiAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwogICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwogICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CiAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGggLSAxOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICByZXR1cm4gaW5kaWNlczsKfTsKQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JfID0gZnVuY3Rpb24gKHByb3RvLCBhdHRyTmFtZSkgewogIHZhciBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihwcm90bywgYXR0ck5hbWUpOwogIGlmIChkZXNjcmlwdG9yLmdldCA9PT0gdW5kZWZpbmVkIHx8IGRlc2NyaXB0b3Iuc2V0ID09PSB1bmRlZmluZWQpIHsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IHRydWU7CiAgICBkZXNjcmlwdG9yLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKTsKICAgIH07CiAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbCk7CiAgICB9OwogIH0KICByZXR1cm4gZGVzY3JpcHRvcjsKfTsKdmFyIHVpVlMgPSBbJ2F0dHJpYnV0ZSB2ZWMyIHBvc2l0aW9uOycsICd1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdDsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdCAqIHZlYzQoIHBvc2l0aW9uLCAtMS4wLCAxLjAgKTsnLCAnfSddLmpvaW4oJ1xuJyk7CnZhciB1aUZTID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLCAndW5pZm9ybSB2ZWM0IGNvbG9yOycsICd2b2lkIG1haW4oKSB7JywgJyAgZ2xfRnJhZ0NvbG9yID0gY29sb3I7JywgJ30nXS5qb2luKCdcbicpOwp2YXIgREVHMlJBRCA9IE1hdGguUEkgLyAxODAuMDsKdmFyIGtBbmdsZVBlckdlYXJTZWN0aW9uID0gNjA7CnZhciBrT3V0ZXJSaW1FbmRBbmdsZSA9IDEyOwp2YXIga0lubmVyUmltQmVnaW5BbmdsZSA9IDIwOwp2YXIga091dGVyUmFkaXVzID0gMTsKdmFyIGtNaWRkbGVSYWRpdXMgPSAwLjc1Owp2YXIga0lubmVyUmFkaXVzID0gMC4zMTI1Owp2YXIga0NlbnRlckxpbmVUaGlja25lc3NEcCA9IDQ7CnZhciBrQnV0dG9uV2lkdGhEcCA9IDI4Owp2YXIga1RvdWNoU2xvcEZhY3RvciA9IDEuNTsKZnVuY3Rpb24gQ2FyZGJvYXJkVUkoZ2wpIHsKICB0aGlzLmdsID0gZ2w7CiAgdGhpcy5hdHRyaWJzID0gewogICAgcG9zaXRpb246IDAKICB9OwogIHRoaXMucHJvZ3JhbSA9IGxpbmtQcm9ncmFtKGdsLCB1aVZTLCB1aUZTLCB0aGlzLmF0dHJpYnMpOwogIHRoaXMudW5pZm9ybXMgPSBnZXRQcm9ncmFtVW5pZm9ybXMoZ2wsIHRoaXMucHJvZ3JhbSk7CiAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICB0aGlzLmdlYXJPZmZzZXQgPSAwOwogIHRoaXMuZ2VhclZlcnRleENvdW50ID0gMDsKICB0aGlzLmFycm93T2Zmc2V0ID0gMDsKICB0aGlzLmFycm93VmVydGV4Q291bnQgPSAwOwogIHRoaXMucHJvak1hdCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogIHRoaXMubGlzdGVuZXIgPSBudWxsOwogIHRoaXMub25SZXNpemUoKTsKfQpDYXJkYm9hcmRVSS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgZ2wgPSB0aGlzLmdsOwogIGlmICh0aGlzLmxpc3RlbmVyKSB7CiAgICBnbC5jYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7CiAgfQogIGdsLmRlbGV0ZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKICBnbC5kZWxldGVCdWZmZXIodGhpcy52ZXJ0ZXhCdWZmZXIpOwp9OwpDYXJkYm9hcmRVSS5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24gKG9wdGlvbnNDYWxsYmFjaywgYmFja0NhbGxiYWNrKSB7CiAgdmFyIGNhbnZhcyA9IHRoaXMuZ2wuY2FudmFzOwogIHRoaXMubGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBtaWRsaW5lID0gY2FudmFzLmNsaWVudFdpZHRoIC8gMjsKICAgIHZhciBidXR0b25TaXplID0ga0J1dHRvbldpZHRoRHAgKiBrVG91Y2hTbG9wRmFjdG9yOwogICAgaWYgKGV2ZW50LmNsaWVudFggPiBtaWRsaW5lIC0gYnV0dG9uU2l6ZSAmJiBldmVudC5jbGllbnRYIDwgbWlkbGluZSArIGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WSA+IGNhbnZhcy5jbGllbnRIZWlnaHQgLSBidXR0b25TaXplKSB7CiAgICAgIG9wdGlvbnNDYWxsYmFjayhldmVudCk7CiAgICB9CiAgICBlbHNlIGlmIChldmVudC5jbGllbnRYIDwgYnV0dG9uU2l6ZSAmJiBldmVudC5jbGllbnRZIDwgYnV0dG9uU2l6ZSkgewogICAgICAgIGJhY2tDYWxsYmFjayhldmVudCk7CiAgICAgIH0KICB9OwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTsKfTsKQ2FyZGJvYXJkVUkucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKCkgewogIHZhciBnbCA9IHRoaXMuZ2w7CiAgdmFyIHNlbGYgPSB0aGlzOwogIHZhciBnbFN0YXRlID0gW2dsLkFSUkFZX0JVRkZFUl9CSU5ESU5HXTsKICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewogICAgdmFyIHZlcnRpY2VzID0gW107CiAgICB2YXIgbWlkbGluZSA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aCAvIDI7CiAgICB2YXIgcGh5c2ljYWxQaXhlbHMgPSBNYXRoLm1heChzY3JlZW4ud2lkdGgsIHNjcmVlbi5oZWlnaHQpICogd2luZG93LmRldmljZVBpeGVsUmF0aW87CiAgICB2YXIgc2NhbGluZ1JhdGlvID0gZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gcGh5c2ljYWxQaXhlbHM7CiAgICB2YXIgZHBzID0gc2NhbGluZ1JhdGlvICogd2luZG93LmRldmljZVBpeGVsUmF0aW87CiAgICB2YXIgbGluZVdpZHRoID0ga0NlbnRlckxpbmVUaGlja25lc3NEcCAqIGRwcyAvIDI7CiAgICB2YXIgYnV0dG9uU2l6ZSA9IGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvciAqIGRwczsKICAgIHZhciBidXR0b25TY2FsZSA9IGtCdXR0b25XaWR0aERwICogZHBzIC8gMjsKICAgIHZhciBidXR0b25Cb3JkZXIgPSAoa0J1dHRvbldpZHRoRHAgKiBrVG91Y2hTbG9wRmFjdG9yIC0ga0J1dHRvbldpZHRoRHApICogZHBzOwogICAgdmVydGljZXMucHVzaChtaWRsaW5lIC0gbGluZVdpZHRoLCBidXR0b25TaXplKTsKICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSAtIGxpbmVXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICB2ZXJ0aWNlcy5wdXNoKG1pZGxpbmUgKyBsaW5lV2lkdGgsIGJ1dHRvblNpemUpOwogICAgdmVydGljZXMucHVzaChtaWRsaW5lICsgbGluZVdpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgIHNlbGYuZ2Vhck9mZnNldCA9IHZlcnRpY2VzLmxlbmd0aCAvIDI7CiAgICBmdW5jdGlvbiBhZGRHZWFyU2VnbWVudCh0aGV0YSwgcikgewogICAgICB2YXIgYW5nbGUgPSAoOTAgLSB0aGV0YSkgKiBERUcyUkFEOwogICAgICB2YXIgeCA9IE1hdGguY29zKGFuZ2xlKTsKICAgICAgdmFyIHkgPSBNYXRoLnNpbihhbmdsZSk7CiAgICAgIHZlcnRpY2VzLnB1c2goa0lubmVyUmFkaXVzICogeCAqIGJ1dHRvblNjYWxlICsgbWlkbGluZSwga0lubmVyUmFkaXVzICogeSAqIGJ1dHRvblNjYWxlICsgYnV0dG9uU2NhbGUpOwogICAgICB2ZXJ0aWNlcy5wdXNoKHIgKiB4ICogYnV0dG9uU2NhbGUgKyBtaWRsaW5lLCByICogeSAqIGJ1dHRvblNjYWxlICsgYnV0dG9uU2NhbGUpOwogICAgfQogICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gNjsgaSsrKSB7CiAgICAgIHZhciBzZWdtZW50VGhldGEgPSBpICoga0FuZ2xlUGVyR2VhclNlY3Rpb247CiAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSwga091dGVyUmFkaXVzKTsKICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhICsga091dGVyUmltRW5kQW5nbGUsIGtPdXRlclJhZGl1cyk7CiAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIGtJbm5lclJpbUJlZ2luQW5nbGUsIGtNaWRkbGVSYWRpdXMpOwogICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyAoa0FuZ2xlUGVyR2VhclNlY3Rpb24gLSBrSW5uZXJSaW1CZWdpbkFuZ2xlKSwga01pZGRsZVJhZGl1cyk7CiAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIChrQW5nbGVQZXJHZWFyU2VjdGlvbiAtIGtPdXRlclJpbUVuZEFuZ2xlKSwga091dGVyUmFkaXVzKTsKICAgIH0KICAgIHNlbGYuZ2VhclZlcnRleENvdW50ID0gdmVydGljZXMubGVuZ3RoIC8gMiAtIHNlbGYuZ2Vhck9mZnNldDsKICAgIHNlbGYuYXJyb3dPZmZzZXQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyOwogICAgZnVuY3Rpb24gYWRkQXJyb3dWZXJ0ZXgoeCwgeSkgewogICAgICB2ZXJ0aWNlcy5wdXNoKGJ1dHRvbkJvcmRlciArIHgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQgLSBidXR0b25Cb3JkZXIgLSB5KTsKICAgIH0KICAgIHZhciBhbmdsZWRMaW5lV2lkdGggPSBsaW5lV2lkdGggLyBNYXRoLnNpbig0NSAqIERFRzJSQUQpOwogICAgYWRkQXJyb3dWZXJ0ZXgoMCwgYnV0dG9uU2NhbGUpOwogICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUsIDApOwogICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUgKyBhbmdsZWRMaW5lV2lkdGgsIGFuZ2xlZExpbmVXaWR0aCk7CiAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICsgYW5nbGVkTGluZVdpZHRoKTsKICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBhbmdsZWRMaW5lV2lkdGgpOwogICAgYWRkQXJyb3dWZXJ0ZXgoMCwgYnV0dG9uU2NhbGUpOwogICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUsIGJ1dHRvblNjYWxlICogMik7CiAgICBhZGRBcnJvd1ZlcnRleChidXR0b25TY2FsZSArIGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgKiAyIC0gYW5nbGVkTGluZVdpZHRoKTsKICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBhbmdsZWRMaW5lV2lkdGgpOwogICAgYWRkQXJyb3dWZXJ0ZXgoMCwgYnV0dG9uU2NhbGUpOwogICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSAtIGxpbmVXaWR0aCk7CiAgICBhZGRBcnJvd1ZlcnRleChrQnV0dG9uV2lkdGhEcCAqIGRwcywgYnV0dG9uU2NhbGUgLSBsaW5lV2lkdGgpOwogICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSArIGxpbmVXaWR0aCk7CiAgICBhZGRBcnJvd1ZlcnRleChrQnV0dG9uV2lkdGhEcCAqIGRwcywgYnV0dG9uU2NhbGUgKyBsaW5lV2lkdGgpOwogICAgc2VsZi5hcnJvd1ZlcnRleENvdW50ID0gdmVydGljZXMubGVuZ3RoIC8gMiAtIHNlbGYuYXJyb3dPZmZzZXQ7CiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwogICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpLCBnbC5TVEFUSUNfRFJBVyk7CiAgfSk7Cn07CkNhcmRib2FyZFVJLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIGdsID0gdGhpcy5nbDsKICB2YXIgc2VsZiA9IHRoaXM7CiAgdmFyIGdsU3RhdGUgPSBbZ2wuQ1VMTF9GQUNFLCBnbC5ERVBUSF9URVNULCBnbC5CTEVORCwgZ2wuU0NJU1NPUl9URVNULCBnbC5TVEVOQ0lMX1RFU1QsIGdsLkNPTE9SX1dSSVRFTUFTSywgZ2wuVklFV1BPUlQsIGdsLkNVUlJFTlRfUFJPR1JBTSwgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkddOwogIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICBnbC5kaXNhYmxlKGdsLkNVTExfRkFDRSk7CiAgICBnbC5kaXNhYmxlKGdsLkRFUFRIX1RFU1QpOwogICAgZ2wuZGlzYWJsZShnbC5CTEVORCk7CiAgICBnbC5kaXNhYmxlKGdsLlNDSVNTT1JfVEVTVCk7CiAgICBnbC5kaXNhYmxlKGdsLlNURU5DSUxfVEVTVCk7CiAgICBnbC5jb2xvck1hc2sodHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwogICAgc2VsZi5yZW5kZXJOb1N0YXRlKCk7CiAgfSk7Cn07CkNhcmRib2FyZFVJLnByb3RvdHlwZS5yZW5kZXJOb1N0YXRlID0gZnVuY3Rpb24gKCkgewogIHZhciBnbCA9IHRoaXMuZ2w7CiAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwogIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlcik7CiAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkodGhpcy5hdHRyaWJzLnBvc2l0aW9uKTsKICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHRoaXMuYXR0cmlicy5wb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCA4LCAwKTsKICBnbC51bmlmb3JtNGYodGhpcy51bmlmb3Jtcy5jb2xvciwgMS4wLCAxLjAsIDEuMCwgMS4wKTsKICBvcnRob01hdHJpeCh0aGlzLnByb2pNYXQsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgMCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMC4xLCAxMDI0LjApOwogIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy51bmlmb3Jtcy5wcm9qZWN0aW9uTWF0LCBmYWxzZSwgdGhpcy5wcm9qTWF0KTsKICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCAwLCA0KTsKICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCB0aGlzLmdlYXJPZmZzZXQsIHRoaXMuZ2VhclZlcnRleENvdW50KTsKICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCB0aGlzLmFycm93T2Zmc2V0LCB0aGlzLmFycm93VmVydGV4Q291bnQpOwp9OwpmdW5jdGlvbiBEaXN0b3J0aW9uKGNvZWZmaWNpZW50cykgewogIHRoaXMuY29lZmZpY2llbnRzID0gY29lZmZpY2llbnRzOwp9CkRpc3RvcnRpb24ucHJvdG90eXBlLmRpc3RvcnRJbnZlcnNlID0gZnVuY3Rpb24gKHJhZGl1cykgewogIHZhciByMCA9IDA7CiAgdmFyIHIxID0gMTsKICB2YXIgZHIwID0gcmFkaXVzIC0gdGhpcy5kaXN0b3J0KHIwKTsKICB3aGlsZSAoTWF0aC5hYnMocjEgLSByMCkgPiAwLjAwMDEgICAgICAgICAgICAgKSB7CiAgICB2YXIgZHIxID0gcmFkaXVzIC0gdGhpcy5kaXN0b3J0KHIxKTsKICAgIHZhciByMiA9IHIxIC0gZHIxICogKChyMSAtIHIwKSAvIChkcjEgLSBkcjApKTsKICAgIHIwID0gcjE7CiAgICByMSA9IHIyOwogICAgZHIwID0gZHIxOwogIH0KICByZXR1cm4gcjE7Cn07CkRpc3RvcnRpb24ucHJvdG90eXBlLmRpc3RvcnQgPSBmdW5jdGlvbiAocmFkaXVzKSB7CiAgdmFyIHIyID0gcmFkaXVzICogcmFkaXVzOwogIHZhciByZXQgPSAwOwogIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHJldCA9IHIyICogKHJldCArIHRoaXMuY29lZmZpY2llbnRzW2ldKTsKICB9CiAgcmV0dXJuIChyZXQgKyAxKSAqIHJhZGl1czsKfTsKdmFyIGRlZ1RvUmFkID0gTWF0aC5QSSAvIDE4MDsKdmFyIHJhZFRvRGVnID0gMTgwIC8gTWF0aC5QSTsKdmFyIFZlY3RvcjMgPSBmdW5jdGlvbiBWZWN0b3IzKHgsIHksIHopIHsKICB0aGlzLnggPSB4IHx8IDA7CiAgdGhpcy55ID0geSB8fCAwOwogIHRoaXMueiA9IHogfHwgMDsKfTsKVmVjdG9yMy5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFZlY3RvcjMsCiAgc2V0OiBmdW5jdGlvbiBzZXQoeCwgeSwgeikgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLnogPSB6OwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBjb3B5OiBmdW5jdGlvbiBjb3B5KHYpIHsKICAgIHRoaXMueCA9IHYueDsKICAgIHRoaXMueSA9IHYueTsKICAgIHRoaXMueiA9IHYuejsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbGVuZ3RoOiBmdW5jdGlvbiBsZW5ndGgoKSB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueik7CiAgfSwKICBub3JtYWxpemU6IGZ1bmN0aW9uIG5vcm1hbGl6ZSgpIHsKICAgIHZhciBzY2FsYXIgPSB0aGlzLmxlbmd0aCgpOwogICAgaWYgKHNjYWxhciAhPT0gMCkgewogICAgICB2YXIgaW52U2NhbGFyID0gMSAvIHNjYWxhcjsKICAgICAgdGhpcy5tdWx0aXBseVNjYWxhcihpbnZTY2FsYXIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy54ID0gMDsKICAgICAgdGhpcy55ID0gMDsKICAgICAgdGhpcy56ID0gMDsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0sCiAgbXVsdGlwbHlTY2FsYXI6IGZ1bmN0aW9uIG11bHRpcGx5U2NhbGFyKHNjYWxhcikgewogICAgdGhpcy54ICo9IHNjYWxhcjsKICAgIHRoaXMueSAqPSBzY2FsYXI7CiAgICB0aGlzLnogKj0gc2NhbGFyOwogIH0sCiAgYXBwbHlRdWF0ZXJuaW9uOiBmdW5jdGlvbiBhcHBseVF1YXRlcm5pb24ocSkgewogICAgdmFyIHggPSB0aGlzLng7CiAgICB2YXIgeSA9IHRoaXMueTsKICAgIHZhciB6ID0gdGhpcy56OwogICAgdmFyIHF4ID0gcS54OwogICAgdmFyIHF5ID0gcS55OwogICAgdmFyIHF6ID0gcS56OwogICAgdmFyIHF3ID0gcS53OwogICAgdmFyIGl4ID0gcXcgKiB4ICsgcXkgKiB6IC0gcXogKiB5OwogICAgdmFyIGl5ID0gcXcgKiB5ICsgcXogKiB4IC0gcXggKiB6OwogICAgdmFyIGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgdmFyIGl3ID0gLXF4ICogeCAtIHF5ICogeSAtIHF6ICogejsKICAgIHRoaXMueCA9IGl4ICogcXcgKyBpdyAqIC1xeCArIGl5ICogLXF6IC0gaXogKiAtcXk7CiAgICB0aGlzLnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgdGhpcy56ID0gaXogKiBxdyArIGl3ICogLXF6ICsgaXggKiAtcXkgLSBpeSAqIC1xeDsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgZG90OiBmdW5jdGlvbiBkb3QodikgewogICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKICB9LAogIGNyb3NzVmVjdG9yczogZnVuY3Rpb24gY3Jvc3NWZWN0b3JzKGEsIGIpIHsKICAgIHZhciBheCA9IGEueCwKICAgICAgICBheSA9IGEueSwKICAgICAgICBheiA9IGEuejsKICAgIHZhciBieCA9IGIueCwKICAgICAgICBieSA9IGIueSwKICAgICAgICBieiA9IGIuejsKICAgIHRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwogICAgdGhpcy55ID0gYXogKiBieCAtIGF4ICogYno7CiAgICB0aGlzLnogPSBheCAqIGJ5IC0gYXkgKiBieDsKICAgIHJldHVybiB0aGlzOwogIH0KfTsKdmFyIFF1YXRlcm5pb24gPSBmdW5jdGlvbiBRdWF0ZXJuaW9uKHgsIHksIHosIHcpIHsKICB0aGlzLnggPSB4IHx8IDA7CiAgdGhpcy55ID0geSB8fCAwOwogIHRoaXMueiA9IHogfHwgMDsKICB0aGlzLncgPSB3ICE9PSB1bmRlZmluZWQgPyB3IDogMTsKfTsKUXVhdGVybmlvbi5wcm90b3R5cGUgPSB7CiAgY29uc3RydWN0b3I6IFF1YXRlcm5pb24sCiAgc2V0OiBmdW5jdGlvbiBzZXQoeCwgeSwgeiwgdykgewogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLnogPSB6OwogICAgdGhpcy53ID0gdzsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgY29weTogZnVuY3Rpb24gY29weShxdWF0ZXJuaW9uKSB7CiAgICB0aGlzLnggPSBxdWF0ZXJuaW9uLng7CiAgICB0aGlzLnkgPSBxdWF0ZXJuaW9uLnk7CiAgICB0aGlzLnogPSBxdWF0ZXJuaW9uLno7CiAgICB0aGlzLncgPSBxdWF0ZXJuaW9uLnc7CiAgICByZXR1cm4gdGhpczsKICB9LAogIHNldEZyb21FdWxlclhZWjogZnVuY3Rpb24gc2V0RnJvbUV1bGVyWFlaKHgsIHksIHopIHsKICAgIHZhciBjMSA9IE1hdGguY29zKHggLyAyKTsKICAgIHZhciBjMiA9IE1hdGguY29zKHkgLyAyKTsKICAgIHZhciBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgIHZhciBzMSA9IE1hdGguc2luKHggLyAyKTsKICAgIHZhciBzMiA9IE1hdGguc2luKHkgLyAyKTsKICAgIHZhciBzMyA9IE1hdGguc2luKHogLyAyKTsKICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0RnJvbUV1bGVyWVhaOiBmdW5jdGlvbiBzZXRGcm9tRXVsZXJZWFooeCwgeSwgeikgewogICAgdmFyIGMxID0gTWF0aC5jb3MoeCAvIDIpOwogICAgdmFyIGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgdmFyIGMzID0gTWF0aC5jb3MoeiAvIDIpOwogICAgdmFyIHMxID0gTWF0aC5zaW4oeCAvIDIpOwogICAgdmFyIHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgdmFyIHMzID0gTWF0aC5zaW4oeiAvIDIpOwogICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBzZXRGcm9tQXhpc0FuZ2xlOiBmdW5jdGlvbiBzZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIGFuZ2xlKSB7CiAgICB2YXIgaGFsZkFuZ2xlID0gYW5nbGUgLyAyLAogICAgICAgIHMgPSBNYXRoLnNpbihoYWxmQW5nbGUpOwogICAgdGhpcy54ID0gYXhpcy54ICogczsKICAgIHRoaXMueSA9IGF4aXMueSAqIHM7CiAgICB0aGlzLnogPSBheGlzLnogKiBzOwogICAgdGhpcy53ID0gTWF0aC5jb3MoaGFsZkFuZ2xlKTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbXVsdGlwbHk6IGZ1bmN0aW9uIG11bHRpcGx5KHEpIHsKICAgIHJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnModGhpcywgcSk7CiAgfSwKICBtdWx0aXBseVF1YXRlcm5pb25zOiBmdW5jdGlvbiBtdWx0aXBseVF1YXRlcm5pb25zKGEsIGIpIHsKICAgIHZhciBxYXggPSBhLngsCiAgICAgICAgcWF5ID0gYS55LAogICAgICAgIHFheiA9IGEueiwKICAgICAgICBxYXcgPSBhLnc7CiAgICB2YXIgcWJ4ID0gYi54LAogICAgICAgIHFieSA9IGIueSwKICAgICAgICBxYnogPSBiLnosCiAgICAgICAgcWJ3ID0gYi53OwogICAgdGhpcy54ID0gcWF4ICogcWJ3ICsgcWF3ICogcWJ4ICsgcWF5ICogcWJ6IC0gcWF6ICogcWJ5OwogICAgdGhpcy55ID0gcWF5ICogcWJ3ICsgcWF3ICogcWJ5ICsgcWF6ICogcWJ4IC0gcWF4ICogcWJ6OwogICAgdGhpcy56ID0gcWF6ICogcWJ3ICsgcWF3ICogcWJ6ICsgcWF4ICogcWJ5IC0gcWF5ICogcWJ4OwogICAgdGhpcy53ID0gcWF3ICogcWJ3IC0gcWF4ICogcWJ4IC0gcWF5ICogcWJ5IC0gcWF6ICogcWJ6OwogICAgcmV0dXJuIHRoaXM7CiAgfSwKICBpbnZlcnNlOiBmdW5jdGlvbiBpbnZlcnNlKCkgewogICAgdGhpcy54ICo9IC0xOwogICAgdGhpcy55ICo9IC0xOwogICAgdGhpcy56ICo9IC0xOwogICAgdGhpcy5ub3JtYWxpemUoKTsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoKSB7CiAgICB2YXIgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwogICAgaWYgKGwgPT09IDApIHsKICAgICAgdGhpcy54ID0gMDsKICAgICAgdGhpcy55ID0gMDsKICAgICAgdGhpcy56ID0gMDsKICAgICAgdGhpcy53ID0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGwgPSAxIC8gbDsKICAgICAgdGhpcy54ID0gdGhpcy54ICogbDsKICAgICAgdGhpcy55ID0gdGhpcy55ICogbDsKICAgICAgdGhpcy56ID0gdGhpcy56ICogbDsKICAgICAgdGhpcy53ID0gdGhpcy53ICogbDsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2xlcnA6IGZ1bmN0aW9uIHNsZXJwKHFiLCB0KSB7CiAgICBpZiAodCA9PT0gMCkgcmV0dXJuIHRoaXM7CiAgICBpZiAodCA9PT0gMSkgcmV0dXJuIHRoaXMuY29weShxYik7CiAgICB2YXIgeCA9IHRoaXMueCwKICAgICAgICB5ID0gdGhpcy55LAogICAgICAgIHogPSB0aGlzLnosCiAgICAgICAgdyA9IHRoaXMudzsKICAgIHZhciBjb3NIYWxmVGhldGEgPSB3ICogcWIudyArIHggKiBxYi54ICsgeSAqIHFiLnkgKyB6ICogcWIuejsKICAgIGlmIChjb3NIYWxmVGhldGEgPCAwKSB7CiAgICAgIHRoaXMudyA9IC1xYi53OwogICAgICB0aGlzLnggPSAtcWIueDsKICAgICAgdGhpcy55ID0gLXFiLnk7CiAgICAgIHRoaXMueiA9IC1xYi56OwogICAgICBjb3NIYWxmVGhldGEgPSAtY29zSGFsZlRoZXRhOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jb3B5KHFiKTsKICAgIH0KICAgIGlmIChjb3NIYWxmVGhldGEgPj0gMS4wKSB7CiAgICAgIHRoaXMudyA9IHc7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdmFyIGhhbGZUaGV0YSA9IE1hdGguYWNvcyhjb3NIYWxmVGhldGEpOwogICAgdmFyIHNpbkhhbGZUaGV0YSA9IE1hdGguc3FydCgxLjAgLSBjb3NIYWxmVGhldGEgKiBjb3NIYWxmVGhldGEpOwogICAgaWYgKE1hdGguYWJzKHNpbkhhbGZUaGV0YSkgPCAwLjAwMSkgewogICAgICB0aGlzLncgPSAwLjUgKiAodyArIHRoaXMudyk7CiAgICAgIHRoaXMueCA9IDAuNSAqICh4ICsgdGhpcy54KTsKICAgICAgdGhpcy55ID0gMC41ICogKHkgKyB0aGlzLnkpOwogICAgICB0aGlzLnogPSAwLjUgKiAoeiArIHRoaXMueik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgdmFyIHJhdGlvQSA9IE1hdGguc2luKCgxIC0gdCkgKiBoYWxmVGhldGEpIC8gc2luSGFsZlRoZXRhLAogICAgICAgIHJhdGlvQiA9IE1hdGguc2luKHQgKiBoYWxmVGhldGEpIC8gc2luSGFsZlRoZXRhOwogICAgdGhpcy53ID0gdyAqIHJhdGlvQSArIHRoaXMudyAqIHJhdGlvQjsKICAgIHRoaXMueCA9IHggKiByYXRpb0EgKyB0aGlzLnggKiByYXRpb0I7CiAgICB0aGlzLnkgPSB5ICogcmF0aW9BICsgdGhpcy55ICogcmF0aW9COwogICAgdGhpcy56ID0geiAqIHJhdGlvQSArIHRoaXMueiAqIHJhdGlvQjsKICAgIHJldHVybiB0aGlzOwogIH0sCiAgc2V0RnJvbVVuaXRWZWN0b3JzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdjEsIHI7CiAgICB2YXIgRVBTID0gMC4wMDAwMDE7CiAgICByZXR1cm4gZnVuY3Rpb24gKHZGcm9tLCB2VG8pIHsKICAgICAgaWYgKHYxID09PSB1bmRlZmluZWQpIHYxID0gbmV3IFZlY3RvcjMoKTsKICAgICAgciA9IHZGcm9tLmRvdCh2VG8pICsgMTsKICAgICAgaWYgKHIgPCBFUFMpIHsKICAgICAgICByID0gMDsKICAgICAgICBpZiAoTWF0aC5hYnModkZyb20ueCkgPiBNYXRoLmFicyh2RnJvbS56KSkgewogICAgICAgICAgdjEuc2V0KC12RnJvbS55LCB2RnJvbS54LCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdjEuc2V0KDAsIC12RnJvbS56LCB2RnJvbS55KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdjEuY3Jvc3NWZWN0b3JzKHZGcm9tLCB2VG8pOwogICAgICB9CiAgICAgIHRoaXMueCA9IHYxLng7CiAgICAgIHRoaXMueSA9IHYxLnk7CiAgICAgIHRoaXMueiA9IHYxLno7CiAgICAgIHRoaXMudyA9IHI7CiAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9KCkKfTsKZnVuY3Rpb24gRGV2aWNlKHBhcmFtcykgewogIHRoaXMud2lkdGggPSBwYXJhbXMud2lkdGggfHwgZ2V0U2NyZWVuV2lkdGgoKTsKICB0aGlzLmhlaWdodCA9IHBhcmFtcy5oZWlnaHQgfHwgZ2V0U2NyZWVuSGVpZ2h0KCk7CiAgdGhpcy53aWR0aE1ldGVycyA9IHBhcmFtcy53aWR0aE1ldGVyczsKICB0aGlzLmhlaWdodE1ldGVycyA9IHBhcmFtcy5oZWlnaHRNZXRlcnM7CiAgdGhpcy5iZXZlbE1ldGVycyA9IHBhcmFtcy5iZXZlbE1ldGVyczsKfQp2YXIgREVGQVVMVF9BTkRST0lEID0gbmV3IERldmljZSh7CiAgd2lkdGhNZXRlcnM6IDAuMTEwLAogIGhlaWdodE1ldGVyczogMC4wNjIsCiAgYmV2ZWxNZXRlcnM6IDAuMDA0Cn0pOwp2YXIgREVGQVVMVF9JT1MgPSBuZXcgRGV2aWNlKHsKICB3aWR0aE1ldGVyczogMC4xMDM4LAogIGhlaWdodE1ldGVyczogMC4wNTg0LAogIGJldmVsTWV0ZXJzOiAwLjAwNAp9KTsKdmFyIFZpZXdlcnMgPSB7CiAgQ2FyZGJvYXJkVjE6IG5ldyBDYXJkYm9hcmRWaWV3ZXIoewogICAgaWQ6ICdDYXJkYm9hcmRWMScsCiAgICBsYWJlbDogJ0NhcmRib2FyZCBJL08gMjAxNCcsCiAgICBmb3Y6IDQwLAogICAgaW50ZXJMZW5zRGlzdGFuY2U6IDAuMDYwLAogICAgYmFzZWxpbmVMZW5zRGlzdGFuY2U6IDAuMDM1LAogICAgc2NyZWVuTGVuc0Rpc3RhbmNlOiAwLjA0MiwKICAgIGRpc3RvcnRpb25Db2VmZmljaWVudHM6IFswLjQ0MSwgMC4xNTZdLAogICAgaW52ZXJzZUNvZWZmaWNpZW50czogWy0wLjQ0MTAwMzUsIDAuNDI3NTYxNTUsIC0wLjQ4MDQ0MzksIDAuNTQ2MDEzOSwgLTAuNTg4MjExODMsIDAuNTczMzkzOCwgLTAuNDgzMDMyMDIsIDAuMzMyOTkwODMsIC0wLjE3NTczODQxLCAwLjA2NTE3NzIsIC0wLjAxNDg4OTYzLCAwLjAwMTU1OTgzNF0KICB9KSwKICBDYXJkYm9hcmRWMjogbmV3IENhcmRib2FyZFZpZXdlcih7CiAgICBpZDogJ0NhcmRib2FyZFYyJywKICAgIGxhYmVsOiAnQ2FyZGJvYXJkIEkvTyAyMDE1JywKICAgIGZvdjogNjAsCiAgICBpbnRlckxlbnNEaXN0YW5jZTogMC4wNjQsCiAgICBiYXNlbGluZUxlbnNEaXN0YW5jZTogMC4wMzUsCiAgICBzY3JlZW5MZW5zRGlzdGFuY2U6IDAuMDM5LAogICAgZGlzdG9ydGlvbkNvZWZmaWNpZW50czogWzAuMzQsIDAuNTVdLAogICAgaW52ZXJzZUNvZWZmaWNpZW50czogWy0wLjMzODM2NzA0LCAtMC4xODE2MjE4NSwgMC44NjI2NTUsIC0xLjI0NjIwNTEsIDEuMDU2MDYwMiwgLTAuNTgyMDgzMTcsIDAuMjE2MDkwNzgsIC0wLjA1NDQ0ODIzLCAwLjAwOTE3Nzk1NiwgLTkuOTA0MTY5RS00LCA2LjE4MzUzNUUtNSwgLTEuNjk4MTgwM0UtNl0KICB9KQp9OwpmdW5jdGlvbiBEZXZpY2VJbmZvKGRldmljZVBhcmFtcywgYWRkaXRpb25hbFZpZXdlcnMpIHsKICB0aGlzLnZpZXdlciA9IFZpZXdlcnMuQ2FyZGJvYXJkVjI7CiAgdGhpcy51cGRhdGVEZXZpY2VQYXJhbXMoZGV2aWNlUGFyYW1zKTsKICB0aGlzLmRpc3RvcnRpb24gPSBuZXcgRGlzdG9ydGlvbih0aGlzLnZpZXdlci5kaXN0b3J0aW9uQ29lZmZpY2llbnRzKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGFkZGl0aW9uYWxWaWV3ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgdmlld2VyID0gYWRkaXRpb25hbFZpZXdlcnNbaV07CiAgICBWaWV3ZXJzW3ZpZXdlci5pZF0gPSBuZXcgQ2FyZGJvYXJkVmlld2VyKHZpZXdlcik7CiAgfQp9CkRldmljZUluZm8ucHJvdG90eXBlLnVwZGF0ZURldmljZVBhcmFtcyA9IGZ1bmN0aW9uIChkZXZpY2VQYXJhbXMpIHsKICB0aGlzLmRldmljZSA9IHRoaXMuZGV0ZXJtaW5lRGV2aWNlXyhkZXZpY2VQYXJhbXMpIHx8IHRoaXMuZGV2aWNlOwp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXREZXZpY2UgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuZGV2aWNlOwp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5zZXRWaWV3ZXIgPSBmdW5jdGlvbiAodmlld2VyKSB7CiAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgdGhpcy5kaXN0b3J0aW9uID0gbmV3IERpc3RvcnRpb24odGhpcy52aWV3ZXIuZGlzdG9ydGlvbkNvZWZmaWNpZW50cyk7Cn07CkRldmljZUluZm8ucHJvdG90eXBlLmRldGVybWluZURldmljZV8gPSBmdW5jdGlvbiAoZGV2aWNlUGFyYW1zKSB7CiAgaWYgKCFkZXZpY2VQYXJhbXMpIHsKICAgIGlmIChpc0lPUygpKSB7CiAgICAgIGNvbnNvbGUud2FybignVXNpbmcgZmFsbGJhY2sgaU9TIGRldmljZSBtZWFzdXJlbWVudHMuJyk7CiAgICAgIHJldHVybiBERUZBVUxUX0lPUzsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUud2FybignVXNpbmcgZmFsbGJhY2sgQW5kcm9pZCBkZXZpY2UgbWVhc3VyZW1lbnRzLicpOwogICAgICByZXR1cm4gREVGQVVMVF9BTkRST0lEOwogICAgfQogIH0KICB2YXIgTUVURVJTX1BFUl9JTkNIID0gMC4wMjU0OwogIHZhciBtZXRlcnNQZXJQaXhlbFggPSBNRVRFUlNfUEVSX0lOQ0ggLyBkZXZpY2VQYXJhbXMueGRwaTsKICB2YXIgbWV0ZXJzUGVyUGl4ZWxZID0gTUVURVJTX1BFUl9JTkNIIC8gZGV2aWNlUGFyYW1zLnlkcGk7CiAgdmFyIHdpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKTsKICB2YXIgaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCk7CiAgcmV0dXJuIG5ldyBEZXZpY2UoewogICAgd2lkdGhNZXRlcnM6IG1ldGVyc1BlclBpeGVsWCAqIHdpZHRoLAogICAgaGVpZ2h0TWV0ZXJzOiBtZXRlcnNQZXJQaXhlbFkgKiBoZWlnaHQsCiAgICBiZXZlbE1ldGVyczogZGV2aWNlUGFyYW1zLmJldmVsTW0gKiAwLjAwMQogIH0pOwp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXREaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKICB2YXIgZXllVG9TY3JlZW5EaXN0YW5jZSA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgdmFyIG91dGVyRGlzdCA9IChkZXZpY2Uud2lkdGhNZXRlcnMgLSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UpIC8gMjsKICB2YXIgaW5uZXJEaXN0ID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMjsKICB2YXIgYm90dG9tRGlzdCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVyczsKICB2YXIgdG9wRGlzdCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLSBib3R0b21EaXN0OwogIHZhciBvdXRlckFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KG91dGVyRGlzdCAvIGV5ZVRvU2NyZWVuRGlzdGFuY2UpKTsKICB2YXIgaW5uZXJBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChpbm5lckRpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgdmFyIGJvdHRvbUFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KGJvdHRvbURpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgdmFyIHRvcEFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KHRvcERpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgcmV0dXJuIHsKICAgIGxlZnREZWdyZWVzOiBNYXRoLm1pbihvdXRlckFuZ2xlLCB2aWV3ZXIuZm92KSwKICAgIHJpZ2h0RGVncmVlczogTWF0aC5taW4oaW5uZXJBbmdsZSwgdmlld2VyLmZvdiksCiAgICBkb3duRGVncmVlczogTWF0aC5taW4oYm90dG9tQW5nbGUsIHZpZXdlci5mb3YpLAogICAgdXBEZWdyZWVzOiBNYXRoLm1pbih0b3BBbmdsZSwgdmlld2VyLmZvdikKICB9Owp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllVmlzaWJsZVRhbkFuZ2xlcyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogIHZhciBkaXN0b3J0aW9uID0gdGhpcy5kaXN0b3J0aW9uOwogIHZhciBmb3ZMZWZ0ID0gTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdik7CiAgdmFyIGZvdlRvcCA9IE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdik7CiAgdmFyIGZvdlJpZ2h0ID0gTWF0aC50YW4oZGVnVG9SYWQgKiB2aWV3ZXIuZm92KTsKICB2YXIgZm92Qm90dG9tID0gTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdik7CiAgdmFyIGhhbGZXaWR0aCA9IGRldmljZS53aWR0aE1ldGVycyAvIDQ7CiAgdmFyIGhhbGZIZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gMjsKICB2YXIgdmVydGljYWxMZW5zT2Zmc2V0ID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzIC0gaGFsZkhlaWdodDsKICB2YXIgY2VudGVyWCA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDIgLSBoYWxmV2lkdGg7CiAgdmFyIGNlbnRlclkgPSAtdmVydGljYWxMZW5zT2Zmc2V0OwogIHZhciBjZW50ZXJaID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICB2YXIgc2NyZWVuTGVmdCA9IGRpc3RvcnRpb24uZGlzdG9ydCgoY2VudGVyWCAtIGhhbGZXaWR0aCkgLyBjZW50ZXJaKTsKICB2YXIgc2NyZWVuVG9wID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJZICsgaGFsZkhlaWdodCkgLyBjZW50ZXJaKTsKICB2YXIgc2NyZWVuUmlnaHQgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclggKyBoYWxmV2lkdGgpIC8gY2VudGVyWik7CiAgdmFyIHNjcmVlbkJvdHRvbSA9IGRpc3RvcnRpb24uZGlzdG9ydCgoY2VudGVyWSAtIGhhbGZIZWlnaHQpIC8gY2VudGVyWik7CiAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgcmVzdWx0WzBdID0gTWF0aC5tYXgoZm92TGVmdCwgc2NyZWVuTGVmdCk7CiAgcmVzdWx0WzFdID0gTWF0aC5taW4oZm92VG9wLCBzY3JlZW5Ub3ApOwogIHJlc3VsdFsyXSA9IE1hdGgubWluKGZvdlJpZ2h0LCBzY3JlZW5SaWdodCk7CiAgcmVzdWx0WzNdID0gTWF0aC5tYXgoZm92Qm90dG9tLCBzY3JlZW5Cb3R0b20pOwogIHJldHVybiByZXN1bHQ7Cn07CkRldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVOb0xlbnNUYW5BbmdsZXMgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKICB2YXIgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICB2YXIgZm92TGVmdCA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogIHZhciBmb3ZUb3AgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogIHZhciBmb3ZSaWdodCA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oZGVnVG9SYWQgKiB2aWV3ZXIuZm92KSk7CiAgdmFyIGZvdkJvdHRvbSA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogIHZhciBoYWxmV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyA0OwogIHZhciBoYWxmSGVpZ2h0ID0gZGV2aWNlLmhlaWdodE1ldGVycyAvIDI7CiAgdmFyIHZlcnRpY2FsTGVuc09mZnNldCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVycyAtIGhhbGZIZWlnaHQ7CiAgdmFyIGNlbnRlclggPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC0gaGFsZldpZHRoOwogIHZhciBjZW50ZXJZID0gLXZlcnRpY2FsTGVuc09mZnNldDsKICB2YXIgY2VudGVyWiA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgdmFyIHNjcmVlbkxlZnQgPSAoY2VudGVyWCAtIGhhbGZXaWR0aCkgLyBjZW50ZXJaOwogIHZhciBzY3JlZW5Ub3AgPSAoY2VudGVyWSArIGhhbGZIZWlnaHQpIC8gY2VudGVyWjsKICB2YXIgc2NyZWVuUmlnaHQgPSAoY2VudGVyWCArIGhhbGZXaWR0aCkgLyBjZW50ZXJaOwogIHZhciBzY3JlZW5Cb3R0b20gPSAoY2VudGVyWSAtIGhhbGZIZWlnaHQpIC8gY2VudGVyWjsKICByZXN1bHRbMF0gPSBNYXRoLm1heChmb3ZMZWZ0LCBzY3JlZW5MZWZ0KTsKICByZXN1bHRbMV0gPSBNYXRoLm1pbihmb3ZUb3AsIHNjcmVlblRvcCk7CiAgcmVzdWx0WzJdID0gTWF0aC5taW4oZm92UmlnaHQsIHNjcmVlblJpZ2h0KTsKICByZXN1bHRbM10gPSBNYXRoLm1heChmb3ZCb3R0b20sIHNjcmVlbkJvdHRvbSk7CiAgcmV0dXJuIHJlc3VsdDsKfTsKRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0TGVmdEV5ZVZpc2libGVTY3JlZW5SZWN0ID0gZnVuY3Rpb24gKHVuZGlzdG9ydGVkRnJ1c3R1bSkgewogIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgdmFyIGRpc3QgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwogIHZhciBleWVYID0gKGRldmljZS53aWR0aE1ldGVycyAtIHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSkgLyAyOwogIHZhciBleWVZID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzOwogIHZhciBsZWZ0ID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVswXSAqIGRpc3QgKyBleWVYKSAvIGRldmljZS53aWR0aE1ldGVyczsKICB2YXIgdG9wID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVsxXSAqIGRpc3QgKyBleWVZKSAvIGRldmljZS5oZWlnaHRNZXRlcnM7CiAgdmFyIHJpZ2h0ID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVsyXSAqIGRpc3QgKyBleWVYKSAvIGRldmljZS53aWR0aE1ldGVyczsKICB2YXIgYm90dG9tID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVszXSAqIGRpc3QgKyBleWVZKSAvIGRldmljZS5oZWlnaHRNZXRlcnM7CiAgcmV0dXJuIHsKICAgIHg6IGxlZnQsCiAgICB5OiBib3R0b20sCiAgICB3aWR0aDogcmlnaHQgLSBsZWZ0LAogICAgaGVpZ2h0OiB0b3AgLSBib3R0b20KICB9Owp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAob3B0X2lzVW5kaXN0b3J0ZWQpIHsKICByZXR1cm4gb3B0X2lzVW5kaXN0b3J0ZWQgPyB0aGlzLmdldFVuZGlzdG9ydGVkRmllbGRPZlZpZXdMZWZ0RXllKCkgOiB0aGlzLmdldERpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSgpOwp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRGaWVsZE9mVmlld1JpZ2h0RXllID0gZnVuY3Rpb24gKG9wdF9pc1VuZGlzdG9ydGVkKSB7CiAgdmFyIGZvdiA9IHRoaXMuZ2V0RmllbGRPZlZpZXdMZWZ0RXllKG9wdF9pc1VuZGlzdG9ydGVkKTsKICByZXR1cm4gewogICAgbGVmdERlZ3JlZXM6IGZvdi5yaWdodERlZ3JlZXMsCiAgICByaWdodERlZ3JlZXM6IGZvdi5sZWZ0RGVncmVlcywKICAgIHVwRGVncmVlczogZm92LnVwRGVncmVlcywKICAgIGRvd25EZWdyZWVzOiBmb3YuZG93bkRlZ3JlZXMKICB9Owp9OwpEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRVbmRpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSA9IGZ1bmN0aW9uICgpIHsKICB2YXIgcCA9IHRoaXMuZ2V0VW5kaXN0b3J0ZWRQYXJhbXNfKCk7CiAgcmV0dXJuIHsKICAgIGxlZnREZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLm91dGVyRGlzdCksCiAgICByaWdodERlZ3JlZXM6IHJhZFRvRGVnICogTWF0aC5hdGFuKHAuaW5uZXJEaXN0KSwKICAgIGRvd25EZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLmJvdHRvbURpc3QpLAogICAgdXBEZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLnRvcERpc3QpCiAgfTsKfTsKRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0VW5kaXN0b3J0ZWRWaWV3cG9ydExlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHAgPSB0aGlzLmdldFVuZGlzdG9ydGVkUGFyYW1zXygpOwogIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgdmFyIGV5ZVRvU2NyZWVuRGlzdGFuY2UgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwogIHZhciBzY3JlZW5XaWR0aCA9IGRldmljZS53aWR0aE1ldGVycyAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgdmFyIHNjcmVlbkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogIHZhciB4UHhQZXJUYW5BbmdsZSA9IGRldmljZS53aWR0aCAvIHNjcmVlbldpZHRoOwogIHZhciB5UHhQZXJUYW5BbmdsZSA9IGRldmljZS5oZWlnaHQgLyBzY3JlZW5IZWlnaHQ7CiAgdmFyIHggPSBNYXRoLnJvdW5kKChwLmV5ZVBvc1ggLSBwLm91dGVyRGlzdCkgKiB4UHhQZXJUYW5BbmdsZSk7CiAgdmFyIHkgPSBNYXRoLnJvdW5kKChwLmV5ZVBvc1kgLSBwLmJvdHRvbURpc3QpICogeVB4UGVyVGFuQW5nbGUpOwogIHJldHVybiB7CiAgICB4OiB4LAogICAgeTogeSwKICAgIHdpZHRoOiBNYXRoLnJvdW5kKChwLmV5ZVBvc1ggKyBwLmlubmVyRGlzdCkgKiB4UHhQZXJUYW5BbmdsZSkgLSB4LAogICAgaGVpZ2h0OiBNYXRoLnJvdW5kKChwLmV5ZVBvc1kgKyBwLnRvcERpc3QpICogeVB4UGVyVGFuQW5nbGUpIC0geQogIH07Cn07CkRldmljZUluZm8ucHJvdG90eXBlLmdldFVuZGlzdG9ydGVkUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogIHZhciBkaXN0b3J0aW9uID0gdGhpcy5kaXN0b3J0aW9uOwogIHZhciBleWVUb1NjcmVlbkRpc3RhbmNlID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICB2YXIgaGFsZkxlbnNEaXN0YW5jZSA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDIgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogIHZhciBzY3JlZW5XaWR0aCA9IGRldmljZS53aWR0aE1ldGVycyAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgdmFyIHNjcmVlbkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogIHZhciBleWVQb3NYID0gc2NyZWVuV2lkdGggLyAyIC0gaGFsZkxlbnNEaXN0YW5jZTsKICB2YXIgZXllUG9zWSA9ICh2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnMpIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKICB2YXIgbWF4Rm92ID0gdmlld2VyLmZvdjsKICB2YXIgdmlld2VyTWF4ID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIG1heEZvdikpOwogIHZhciBvdXRlckRpc3QgPSBNYXRoLm1pbihleWVQb3NYLCB2aWV3ZXJNYXgpOwogIHZhciBpbm5lckRpc3QgPSBNYXRoLm1pbihoYWxmTGVuc0Rpc3RhbmNlLCB2aWV3ZXJNYXgpOwogIHZhciBib3R0b21EaXN0ID0gTWF0aC5taW4oZXllUG9zWSwgdmlld2VyTWF4KTsKICB2YXIgdG9wRGlzdCA9IE1hdGgubWluKHNjcmVlbkhlaWdodCAtIGV5ZVBvc1ksIHZpZXdlck1heCk7CiAgcmV0dXJuIHsKICAgIG91dGVyRGlzdDogb3V0ZXJEaXN0LAogICAgaW5uZXJEaXN0OiBpbm5lckRpc3QsCiAgICB0b3BEaXN0OiB0b3BEaXN0LAogICAgYm90dG9tRGlzdDogYm90dG9tRGlzdCwKICAgIGV5ZVBvc1g6IGV5ZVBvc1gsCiAgICBleWVQb3NZOiBleWVQb3NZCiAgfTsKfTsKZnVuY3Rpb24gQ2FyZGJvYXJkVmlld2VyKHBhcmFtcykgewogIHRoaXMuaWQgPSBwYXJhbXMuaWQ7CiAgdGhpcy5sYWJlbCA9IHBhcmFtcy5sYWJlbDsKICB0aGlzLmZvdiA9IHBhcmFtcy5mb3Y7CiAgdGhpcy5pbnRlckxlbnNEaXN0YW5jZSA9IHBhcmFtcy5pbnRlckxlbnNEaXN0YW5jZTsKICB0aGlzLmJhc2VsaW5lTGVuc0Rpc3RhbmNlID0gcGFyYW1zLmJhc2VsaW5lTGVuc0Rpc3RhbmNlOwogIHRoaXMuc2NyZWVuTGVuc0Rpc3RhbmNlID0gcGFyYW1zLnNjcmVlbkxlbnNEaXN0YW5jZTsKICB0aGlzLmRpc3RvcnRpb25Db2VmZmljaWVudHMgPSBwYXJhbXMuZGlzdG9ydGlvbkNvZWZmaWNpZW50czsKICB0aGlzLmludmVyc2VDb2VmZmljaWVudHMgPSBwYXJhbXMuaW52ZXJzZUNvZWZmaWNpZW50czsKfQpEZXZpY2VJbmZvLlZpZXdlcnMgPSBWaWV3ZXJzOwp2YXIgZm9ybWF0ID0gMTsKdmFyIGxhc3RfdXBkYXRlZCA9ICIyMDE4LTEyLTEwVDE3OjAxOjQyWiI7CnZhciBkZXZpY2VzID0gW3sidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9OZXh1cyA3LyoifSx7InVhIjoiTmV4dXMgNyJ9XSwiZHBpIjpbMzIwLjgsMzIzXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9BU1VTX1owMEFELyoifSx7InVhIjoiQVNVU19aMDBBRCJ9XSwiZHBpIjpbNDAzLDQwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAyIFhMLyoifSx7InVhIjoiUGl4ZWwgMiBYTCJ9XSwiZHBpIjo1MzcuOSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAzIFhMLyoifSx7InVhIjoiUGl4ZWwgMyBYTCJ9XSwiZHBpIjpbNTU4LjUsNTUzLjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIFhMLyoifSx7InVhIjoiUGl4ZWwgWEwifV0sImRwaSI6WzUzNy45LDUzM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMy8qIn0seyJ1YSI6IlBpeGVsIDMifV0sImRwaSI6NDQyLjQsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMi8qIn0seyJ1YSI6IlBpeGVsIDIifV0sImRwaSI6NDQxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwvKiJ9LHsidWEiOiJQaXhlbCJ9XSwiZHBpIjpbNDMyLjYsNDM2LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQzY0MzVMVlcvKiJ9LHsidWEiOiJIVEM2NDM1TFZXIn1dLCJkcGkiOls0NDkuNyw0NDMuM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZSBYTC8qIn0seyJ1YSI6IkhUQyBPbmUgWEwifV0sImRwaSI6WzMxNS4zLDMxNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJodGMvKi9OZXh1cyA5LyoifSx7InVhIjoiTmV4dXMgOSJ9XSwiZHBpIjoyODksImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lIE05LyoifSx7InVhIjoiSFRDIE9uZSBNOSJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZV9NOC8qIn0seyJ1YSI6IkhUQyBPbmVfTTgifV0sImRwaSI6WzQ0OS43LDQ0Ny40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmUvKiJ9LHsidWEiOiJIVEMgT25lIn1dLCJkcGkiOjQ3Mi44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL05leHVzIDZQLyoifSx7InVhIjoiTmV4dXMgNlAifV0sImRwaSI6WzUxNS4xLDUxOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovQkxOLUwyNC8qIn0seyJ1YSI6IkhPTk9SQkxOLUwyNCJ9XSwiZHBpIjo0ODAsImJ3Ijo0LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9CS0wtTDA5LyoifSx7InVhIjoiQktMLUwwOSJ9XSwiZHBpIjo0MDMsImJ3IjozLjQ3LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMRU5PVk8vKi9MZW5vdm8gUEIyLTY5MFkvKiJ9LHsidWEiOiJMZW5vdm8gUEIyLTY5MFkifV0sImRwaSI6WzQ1Ny4yLDQ1NC43MTNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTmV4dXMgNVgvKiJ9LHsidWEiOiJOZXh1cyA1WCJ9XSwiZHBpIjpbNDIyLDQxOS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR01TMzQ1LyoifSx7InVhIjoiTEdNUzM0NSJ9XSwiZHBpIjpbMjIxLjcsMjE5LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEctRDgwMC8qIn0seyJ1YSI6IkxHLUQ4MDAifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MRy1EODUwLyoifSx7InVhIjoiTEctRDg1MCJ9XSwiZHBpIjpbNTM3LjksNTQxLjldLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovVlM5ODUgNEcvKiJ9LHsidWEiOiJWUzk4NSA0RyJ9XSwiZHBpIjpbNTM3LjksNTM1LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL05leHVzIDUvKiJ9LHsidWEiOiJOZXh1cyA1IEIifV0sImRwaSI6WzQ0Mi40LDQ0NC44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9OZXh1cyA0LyoifSx7InVhIjoiTmV4dXMgNCJ9XSwiZHBpIjpbMzE5LjgsMzE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHLVA3NjkvKiJ9LHsidWEiOiJMRy1QNzY5In1dLCJkcGkiOlsyNDAuNiwyNDcuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEdNUzMyMy8qIn0seyJ1YSI6IkxHTVMzMjMifV0sImRwaSI6WzIwNi42LDIwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR0xTOTk2LyoifSx7InVhIjoiTEdMUzk5NiJ9XSwiZHBpIjpbNDAzLjQsNDAxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik1pY3JvbWF4LyovNDU2ME1NWC8qIn0seyJ1YSI6IjQ1NjBNTVgifV0sImRwaSI6WzI0MCwyMTkuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTWljcm9tYXgvKi9BMjUwLyoifSx7InVhIjoiTWljcm9tYXggQTI1MCJ9XSwiZHBpIjpbNDgwLDQ0Ni40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJNaWNyb21heC8qL01pY3JvbWF4IEFRNDUwMS8qIn0seyJ1YSI6Ik1pY3JvbWF4IEFRNDUwMSJ9XSwiZHBpIjoyNDAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c1LyoifSx7InVhIjoiTW90byBHICg1KSBQbHVzIn1dLCJkcGkiOls0MDMuNCw0MDNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovRFJPSUQgUkFaUi8qIn0seyJ1YSI6IkRST0lEIFJBWlIifV0sImRwaSI6WzM2OC4xLDI1Ni43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUODMwQy8qIn0seyJ1YSI6IlhUODMwQyJ9XSwiZHBpIjpbMjU0LDI1NS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAyMS8qIn0seyJ1YSI6IlhUMTAyMSJ9XSwiZHBpIjpbMjU0LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDIzLyoifSx7InVhIjoiWFQxMDIzIn1dLCJkcGkiOlsyNTQsMjU2LjddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMjgvKiJ9LHsidWEiOiJYVDEwMjgifV0sImRwaSI6WzMyNi42LDMyNy42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAzNC8qIn0seyJ1YSI6IlhUMTAzNCJ9XSwiZHBpIjpbMzI2LjYsMzI4LjRdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwNTMvKiJ9LHsidWEiOiJYVDEwNTMifV0sImRwaSI6WzMxNS4zLDMxNi4xXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTU2Mi8qIn0seyJ1YSI6IlhUMTU2MiJ9XSwiZHBpIjpbNDAzLjQsNDAyLjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovTmV4dXMgNi8qIn0seyJ1YSI6Ik5leHVzIDYgQiJ9XSwiZHBpIjpbNDk0LjMsNDg5LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDYzLyoifSx7InVhIjoiWFQxMDYzIn1dLCJkcGkiOlsyOTUsMjk2LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDY0LyoifSx7InVhIjoiWFQxMDY0In1dLCJkcGkiOlsyOTUsMjk1LjZdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwOTIvKiJ9LHsidWEiOiJYVDEwOTIifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA5NS8qIn0seyJ1YSI6IlhUMTA5NSJ9XSwiZHBpIjpbNDIyLDQyMy40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c0LyoifSx7InVhIjoiTW90byBHICg0KSJ9XSwiZHBpIjo0MDEsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL0EwMDAxLyoifSx7InVhIjoiQTAwMDEifV0sImRwaSI6WzQwMy40LDQwMV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBFMTAwNS8qIn0seyJ1YSI6Ik9ORSBFMTAwNSJ9XSwiZHBpIjpbNDQyLjQsNDQxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTIwMDUvKiJ9LHsidWEiOiJPTkUgQTIwMDUifV0sImRwaSI6WzM5MS45LDQwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNTAwMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTUwMDAgIn1dLCJkcGkiOls0MDMuNDExLDM5OS43MzddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTUwMTAvKiJ9LHsidWEiOiJPTkVQTFVTIEE1MDEwIn1dLCJkcGkiOls0MDMsNDAwXSwiYnciOjIsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPUFBPLyovWDkwOS8qIn0seyJ1YSI6Ilg5MDkifV0sImRwaSI6WzQ0Mi40LDQ0NC4xXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkwODIvKiJ9LHsidWEiOiJHVC1JOTA4MiJ9XSwiZHBpIjpbMTg0LjcsMTg1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HMzYwUC8qIn0seyJ1YSI6IlNNLUczNjBQIn1dLCJkcGkiOlsxOTYuNywyMDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL05leHVzIFMvKiJ9LHsidWEiOiJOZXh1cyBTIn1dLCJkcGkiOlsyMzQuNSwyMjkuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwLyoifSx7InVhIjoiR1QtSTkzMDAifV0sImRwaSI6WzMwNC44LDMwMy45XSwiYnciOjUsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1UMjMwTlUvKiJ9LHsidWEiOiJTTS1UMjMwTlUifV0sImRwaSI6MjE2LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NHSC1UMzk5LyoifSx7InVhIjoiU0dILVQzOTkifV0sImRwaSI6WzIxNy43LDIzMS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0dILU05MTkvKiJ9LHsidWEiOiJTR0gtTTkxOSJ9XSwiZHBpIjpbNDQwLjgsNDM3LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTAwNS8qIn0seyJ1YSI6IlNNLU45MDA1In1dLCJkcGkiOlszODYuNCwzODddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NBTVNVTkctU00tTjkwMEEvKiJ9LHsidWEiOiJTQU1TVU5HLVNNLU45MDBBIn1dLCJkcGkiOlszODYuNCwzODcuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5NTAwLyoifSx7InVhIjoiR1QtSTk1MDAifV0sImRwaSI6WzQ0Mi41LDQ0My4zXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTUwNS8qIn0seyJ1YSI6IkdULUk5NTA1In1dLCJkcGkiOjQzOS40LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTAwRi8qIn0seyJ1YSI6IlNNLUc5MDBGIn1dLCJkcGkiOls0MTUuNiw0MzEuNl0sImJ3Ijo1LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MDBNLyoifSx7InVhIjoiU00tRzkwME0ifV0sImRwaSI6WzQxNS42LDQzMS42XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzgwMEYvKiJ9LHsidWEiOiJTTS1HODAwRiJ9XSwiZHBpIjozMjYuOCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkwNlMvKiJ9LHsidWEiOiJTTS1HOTA2UyJ9XSwiZHBpIjpbNTYyLjcsNTcyLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTMwMC8qIn0seyJ1YSI6IkdULUk5MzAwIn1dLCJkcGkiOlszMDYuNywzMDQuOF0sImJ3Ijo1LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLVQ1MzUvKiJ9LHsidWEiOiJTTS1UNTM1In1dLCJkcGkiOlsxNDIuNiwxMzYuNF0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkyMEMvKiJ9LHsidWEiOiJTTS1OOTIwQyJ9XSwiZHBpIjpbNTE1LjEsNTE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwUC8qIn0seyJ1YSI6IlNNLU45MjBQIn1dLCJkcGkiOlszODYuMzY1NSwzOTAuMTQ0XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkyMFc4LyoifSx7InVhIjoiU00tTjkyMFc4In1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwSS8qIn0seyJ1YSI6IkdULUk5MzAwSSJ9XSwiZHBpIjpbMzA0LjgsMzA1LjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTE5NS8qIn0seyJ1YSI6IkdULUk5MTk1In1dLCJkcGkiOlsyNDkuNCwyNTYuN10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU1BILUw1MjAvKiJ9LHsidWEiOiJTUEgtTDUyMCJ9XSwiZHBpIjpbMjQ5LjQsMjU1LjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TQU1TVU5HLVNHSC1JNzE3LyoifSx7InVhIjoiU0FNU1VORy1TR0gtSTcxNyJ9XSwiZHBpIjoyODUuOCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU1BILUQ3MTAvKiJ9LHsidWEiOiJTUEgtRDcxMCJ9XSwiZHBpIjpbMjE3LjcsMjA0LjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1ONzEwMC8qIn0seyJ1YSI6IkdULU43MTAwIn1dLCJkcGkiOjI2NS4xLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TQ0gtSTYwNS8qIn0seyJ1YSI6IlNDSC1JNjA1In1dLCJkcGkiOjI2NS4xLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HYWxheHkgTmV4dXMvKiJ9LHsidWEiOiJHYWxheHkgTmV4dXMifV0sImRwaSI6WzMxNS4zLDMxNC4yXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkxMEgvKiJ9LHsidWEiOiJTTS1OOTEwSCJ9XSwiZHBpIjpbNTE1LjEsNTE4XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkxMEMvKiJ9LHsidWEiOiJTTS1OOTEwQyJ9XSwiZHBpIjpbNTE1LjIsNTIwLjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUcxMzBNLyoifSx7InVhIjoiU00tRzEzME0ifV0sImRwaSI6WzE2NS45LDE2NC44XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI4SS8qIn0seyJ1YSI6IlNNLUc5MjhJIn1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjBGLyoifSx7InVhIjoiU00tRzkyMEYifV0sImRwaSI6NTgwLjYsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyMFAvKiJ9LHsidWEiOiJTTS1HOTIwUCJ9XSwiZHBpIjpbNTIyLjUsNTc3XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyNUYvKiJ9LHsidWEiOiJTTS1HOTI1RiJ9XSwiZHBpIjo1ODAuNiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI1Vi8qIn0seyJ1YSI6IlNNLUc5MjVWIn1dLCJkcGkiOls1MjIuNSw1NzYuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MzBGLyoifSx7InVhIjoiU00tRzkzMEYifV0sImRwaSI6NTc2LjYsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MzVGLyoifSx7InVhIjoiU00tRzkzNUYifV0sImRwaSI6NTMzLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NTBGLyoifSx7InVhIjoiU00tRzk1MEYifV0sImRwaSI6WzU2Mi43MDcsNTY1LjI5M10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk1NVUvKiJ9LHsidWEiOiJTTS1HOTU1VSJ9XSwiZHBpIjpbNTIyLjUxNCw1MjUuNzYyXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTU1Ri8qIn0seyJ1YSI6IlNNLUc5NTVGIn1dLCJkcGkiOls1MjIuNTE0LDUyNS43NjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0M2OTAzLyoifSx7InVhIjoiQzY5MDMifV0sImRwaSI6WzQ0Mi41LDQ0My4zXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9ENjY1My8qIn0seyJ1YSI6IkQ2NjUzIn1dLCJkcGkiOls0MjguNiw0MjcuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0U2NjUzLyoifSx7InVhIjoiRTY2NTMifV0sImRwaSI6WzQyOC42LDQyNS43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovRTY4NTMvKiJ9LHsidWEiOiJFNjg1MyJ9XSwiZHBpIjpbNDAzLjQsNDAxLjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9TR1AzMjEvKiJ9LHsidWEiOiJTR1AzMjEifV0sImRwaSI6WzIyNC43LDIyNC4xXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlRDVC8qL0FMQ0FURUwgT05FIFRPVUNIIEZpZXJjZS8qIn0seyJ1YSI6IkFMQ0FURUwgT05FIFRPVUNIIEZpZXJjZSJ9XSwiZHBpIjpbMjQwLDI0Ny41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJUSEwvKi90aGwgNTAwMC8qIn0seyJ1YSI6InRobCA1MDAwIn1dLCJkcGkiOls0ODAsNDQzLjNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkZseS8qL0lRNDQxMi8qIn0seyJ1YSI6IklRNDQxMiJ9XSwiZHBpIjozMDcuOSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJaVEUvKi9aVEUgQmxhZGUgTDIvKiJ9LHsidWEiOiJaVEUgQmxhZGUgTDIifV0sImRwaSI6MjQwLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiQkVORVZFLyovVlI1MTgvKiJ9LHsidWEiOiJWUjUxOCJ9XSwiZHBpIjo0ODAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNjQwLDk2MF19XSwiZHBpIjpbMzI1LjEsMzI4LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls2NDAsMTEzNl19XSwiZHBpIjpbMzE3LjEsMzIwLjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls3NTAsMTMzNF19XSwiZHBpIjozMjYuNCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTI0MiwyMjA4XX1dLCJkcGkiOls0NTMuNiw0NTguNF0sImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzExMjUsMjAwMV19XSwiZHBpIjpbNDEwLjksNDE1LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMTI1LDI0MzZdfV0sImRwaSI6NDU4LCJidyI6NCwiYWMiOjEwMDB9XTsKdmFyIERQREJfQ0FDSEUgPSB7Cglmb3JtYXQ6IGZvcm1hdCwKCWxhc3RfdXBkYXRlZDogbGFzdF91cGRhdGVkLAoJZGV2aWNlczogZGV2aWNlcwp9OwpmdW5jdGlvbiBEcGRiKHVybCwgb25EZXZpY2VQYXJhbXNVcGRhdGVkKSB7CiAgdGhpcy5kcGRiID0gRFBEQl9DQUNIRTsKICB0aGlzLnJlY2FsY3VsYXRlRGV2aWNlUGFyYW1zXygpOwogIGlmICh1cmwpIHsKICAgIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkID0gb25EZXZpY2VQYXJhbXNVcGRhdGVkOwogICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgdmFyIG9iaiA9IHRoaXM7CiAgICB4aHIub3BlbignR0VUJywgdXJsLCB0cnVlKTsKICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICBvYmoubG9hZGluZyA9IGZhbHNlOwogICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8PSAyOTkpIHsKICAgICAgICBvYmouZHBkYiA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTsKICAgICAgICBvYmoucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBvbmxpbmUgRFBEQiEnKTsKICAgICAgfQogICAgfSk7CiAgICB4aHIuc2VuZCgpOwogIH0KfQpEcGRiLnByb3RvdHlwZS5nZXREZXZpY2VQYXJhbXMgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuZGV2aWNlUGFyYW1zOwp9OwpEcGRiLnByb3RvdHlwZS5yZWNhbGN1bGF0ZURldmljZVBhcmFtc18gPSBmdW5jdGlvbiAoKSB7CiAgdmFyIG5ld0RldmljZVBhcmFtcyA9IHRoaXMuY2FsY0RldmljZVBhcmFtc18oKTsKICBpZiAobmV3RGV2aWNlUGFyYW1zKSB7CiAgICB0aGlzLmRldmljZVBhcmFtcyA9IG5ld0RldmljZVBhcmFtczsKICAgIGlmICh0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCkgewogICAgICB0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCh0aGlzLmRldmljZVBhcmFtcyk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZWNhbGN1bGF0ZSBkZXZpY2UgcGFyYW1ldGVycy4nKTsKICB9Cn07CkRwZGIucHJvdG90eXBlLmNhbGNEZXZpY2VQYXJhbXNfID0gZnVuY3Rpb24gKCkgewogIHZhciBkYiA9IHRoaXMuZHBkYjsKICBpZiAoIWRiKSB7CiAgICBjb25zb2xlLmVycm9yKCdEUERCIG5vdCBhdmFpbGFibGUuJyk7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKGRiLmZvcm1hdCAhPSAxKSB7CiAgICBjb25zb2xlLmVycm9yKCdEUERCIGhhcyB1bmV4cGVjdGVkIGZvcm1hdCB2ZXJzaW9uLicpOwogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmICghZGIuZGV2aWNlcyB8fCAhZGIuZGV2aWNlcy5sZW5ndGgpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0RQREIgZG9lcyBub3QgaGF2ZSBhIGRldmljZXMgc2VjdGlvbi4nKTsKICAgIHJldHVybiBudWxsOwogIH0KICB2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYTsKICB2YXIgd2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpOwogIHZhciBoZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKTsKICBpZiAoIWRiLmRldmljZXMpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0RQREIgaGFzIG5vIGRldmljZXMgc2VjdGlvbi4nKTsKICAgIHJldHVybiBudWxsOwogIH0KICBmb3IgKHZhciBpID0gMDsgaSA8IGRiLmRldmljZXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXZpY2UgPSBkYi5kZXZpY2VzW2ldOwogICAgaWYgKCFkZXZpY2UucnVsZXMpIHsKICAgICAgY29uc29sZS53YXJuKCdEZXZpY2VbJyArIGkgKyAnXSBoYXMgbm8gcnVsZXMgc2VjdGlvbi4nKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoZGV2aWNlLnR5cGUgIT0gJ2lvcycgJiYgZGV2aWNlLnR5cGUgIT0gJ2FuZHJvaWQnKSB7CiAgICAgIGNvbnNvbGUud2FybignRGV2aWNlWycgKyBpICsgJ10gaGFzIGludmFsaWQgdHlwZS4nKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoaXNJT1MoKSAhPSAoZGV2aWNlLnR5cGUgPT0gJ2lvcycpKSBjb250aW51ZTsKICAgIHZhciBtYXRjaGVkID0gZmFsc2U7CiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRldmljZS5ydWxlcy5sZW5ndGg7IGorKykgewogICAgICB2YXIgcnVsZSA9IGRldmljZS5ydWxlc1tqXTsKICAgICAgaWYgKHRoaXMucnVsZU1hdGNoZXNfKHJ1bGUsIHVzZXJBZ2VudCwgd2lkdGgsIGhlaWdodCkpIHsKICAgICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKCFtYXRjaGVkKSBjb250aW51ZTsKICAgIHZhciB4ZHBpID0gZGV2aWNlLmRwaVswXSB8fCBkZXZpY2UuZHBpOwogICAgdmFyIHlkcGkgPSBkZXZpY2UuZHBpWzFdIHx8IGRldmljZS5kcGk7CiAgICByZXR1cm4gbmV3IERldmljZVBhcmFtcyh7IHhkcGk6IHhkcGksIHlkcGk6IHlkcGksIGJldmVsTW06IGRldmljZS5idyB9KTsKICB9CiAgY29uc29sZS53YXJuKCdObyBEUERCIGRldmljZSBtYXRjaC4nKTsKICByZXR1cm4gbnVsbDsKfTsKRHBkYi5wcm90b3R5cGUucnVsZU1hdGNoZXNfID0gZnVuY3Rpb24gKHJ1bGUsIHVhLCBzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSB7CiAgaWYgKCFydWxlLnVhICYmICFydWxlLnJlcykgcmV0dXJuIGZhbHNlOwogIGlmIChydWxlLnVhICYmIHJ1bGUudWEuc3Vic3RyaW5nKDAsIDIpID09PSAnU00nKSBydWxlLnVhID0gcnVsZS51YS5zdWJzdHJpbmcoMCwgNyk7CiAgaWYgKHJ1bGUudWEgJiYgdWEuaW5kZXhPZihydWxlLnVhKSA8IDApIHJldHVybiBmYWxzZTsKICBpZiAocnVsZS5yZXMpIHsKICAgIGlmICghcnVsZS5yZXNbMF0gfHwgIXJ1bGUucmVzWzFdKSByZXR1cm4gZmFsc2U7CiAgICB2YXIgcmVzWCA9IHJ1bGUucmVzWzBdOwogICAgdmFyIHJlc1kgPSBydWxlLnJlc1sxXTsKICAgIGlmIChNYXRoLm1pbihzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSAhPSBNYXRoLm1pbihyZXNYLCByZXNZKSB8fCBNYXRoLm1heChzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSAhPSBNYXRoLm1heChyZXNYLCByZXNZKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9OwpmdW5jdGlvbiBEZXZpY2VQYXJhbXMocGFyYW1zKSB7CiAgdGhpcy54ZHBpID0gcGFyYW1zLnhkcGk7CiAgdGhpcy55ZHBpID0gcGFyYW1zLnlkcGk7CiAgdGhpcy5iZXZlbE1tID0gcGFyYW1zLmJldmVsTW07Cn0KZnVuY3Rpb24gU2Vuc29yU2FtcGxlKHNhbXBsZSwgdGltZXN0YW1wUykgewogIHRoaXMuc2V0KHNhbXBsZSwgdGltZXN0YW1wUyk7Cn0KU2Vuc29yU2FtcGxlLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoc2FtcGxlLCB0aW1lc3RhbXBTKSB7CiAgdGhpcy5zYW1wbGUgPSBzYW1wbGU7CiAgdGhpcy50aW1lc3RhbXBTID0gdGltZXN0YW1wUzsKfTsKU2Vuc29yU2FtcGxlLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKHNlbnNvclNhbXBsZSkgewogIHRoaXMuc2V0KHNlbnNvclNhbXBsZS5zYW1wbGUsIHNlbnNvclNhbXBsZS50aW1lc3RhbXBTKTsKfTsKZnVuY3Rpb24gQ29tcGxlbWVudGFyeUZpbHRlcihrRmlsdGVyLCBpc0RlYnVnKSB7CiAgdGhpcy5rRmlsdGVyID0ga0ZpbHRlcjsKICB0aGlzLmlzRGVidWcgPSBpc0RlYnVnOwogIHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQgPSBuZXcgU2Vuc29yU2FtcGxlKCk7CiAgdGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwogIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQgPSBuZXcgU2Vuc29yU2FtcGxlKCk7CiAgaWYgKGlzSU9TKCkpIHsKICAgIHRoaXMuZmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKC0xLCAwLCAwLCAxKTsKICB9IGVsc2UgewogICAgdGhpcy5maWx0ZXJRID0gbmV3IFF1YXRlcm5pb24oMSwgMCwgMCwgMSk7CiAgfQogIHRoaXMucHJldmlvdXNGaWx0ZXJRID0gbmV3IFF1YXRlcm5pb24oKTsKICB0aGlzLnByZXZpb3VzRmlsdGVyUS5jb3B5KHRoaXMuZmlsdGVyUSk7CiAgdGhpcy5hY2NlbFEgPSBuZXcgUXVhdGVybmlvbigpOwogIHRoaXMuaXNPcmllbnRhdGlvbkluaXRpYWxpemVkID0gZmFsc2U7CiAgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5ID0gbmV3IFZlY3RvcjMoKTsKICB0aGlzLm1lYXN1cmVkR3Jhdml0eSA9IG5ldyBWZWN0b3IzKCk7CiAgdGhpcy5neXJvSW50ZWdyYWxRID0gbmV3IFF1YXRlcm5pb24oKTsKfQpDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hZGRBY2NlbE1lYXN1cmVtZW50ID0gZnVuY3Rpb24gKHZlY3RvciwgdGltZXN0YW1wUykgewogIHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQuc2V0KHZlY3RvciwgdGltZXN0YW1wUyk7Cn07CkNvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLmFkZEd5cm9NZWFzdXJlbWVudCA9IGZ1bmN0aW9uICh2ZWN0b3IsIHRpbWVzdGFtcFMpIHsKICB0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQuc2V0KHZlY3RvciwgdGltZXN0YW1wUyk7CiAgdmFyIGRlbHRhVCA9IHRpbWVzdGFtcFMgLSB0aGlzLnByZXZpb3VzR3lyb01lYXN1cmVtZW50LnRpbWVzdGFtcFM7CiAgaWYgKGlzVGltZXN0YW1wRGVsdGFWYWxpZChkZWx0YVQpKSB7CiAgICB0aGlzLnJ1bl8oKTsKICB9CiAgdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC5jb3B5KHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudCk7Cn07CkNvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLnJ1bl8gPSBmdW5jdGlvbiAoKSB7CiAgaWYgKCF0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCkgewogICAgdGhpcy5hY2NlbFEgPSB0aGlzLmFjY2VsVG9RdWF0ZXJuaW9uXyh0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50LnNhbXBsZSk7CiAgICB0aGlzLnByZXZpb3VzRmlsdGVyUS5jb3B5KHRoaXMuYWNjZWxRKTsKICAgIHRoaXMuaXNPcmllbnRhdGlvbkluaXRpYWxpemVkID0gdHJ1ZTsKICAgIHJldHVybjsKICB9CiAgdmFyIGRlbHRhVCA9IHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTIC0gdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTOwogIHZhciBneXJvRGVsdGFRID0gdGhpcy5neXJvVG9RdWF0ZXJuaW9uRGVsdGFfKHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudC5zYW1wbGUsIGRlbHRhVCk7CiAgdGhpcy5neXJvSW50ZWdyYWxRLm11bHRpcGx5KGd5cm9EZWx0YVEpOwogIHRoaXMuZmlsdGVyUS5jb3B5KHRoaXMucHJldmlvdXNGaWx0ZXJRKTsKICB0aGlzLmZpbHRlclEubXVsdGlwbHkoZ3lyb0RlbHRhUSk7CiAgdmFyIGludkZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigpOwogIGludkZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwogIGludkZpbHRlclEuaW52ZXJzZSgpOwogIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5zZXQoMCwgMCwgLTEpOwogIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5hcHBseVF1YXRlcm5pb24oaW52RmlsdGVyUSk7CiAgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5Lm5vcm1hbGl6ZSgpOwogIHRoaXMubWVhc3VyZWRHcmF2aXR5LmNvcHkodGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zYW1wbGUpOwogIHRoaXMubWVhc3VyZWRHcmF2aXR5Lm5vcm1hbGl6ZSgpOwogIHZhciBkZWx0YVEgPSBuZXcgUXVhdGVybmlvbigpOwogIGRlbHRhUS5zZXRGcm9tVW5pdFZlY3RvcnModGhpcy5lc3RpbWF0ZWRHcmF2aXR5LCB0aGlzLm1lYXN1cmVkR3Jhdml0eSk7CiAgZGVsdGFRLmludmVyc2UoKTsKICBpZiAodGhpcy5pc0RlYnVnKSB7CiAgICBjb25zb2xlLmxvZygnRGVsdGE6ICVkIGRlZywgR19lc3Q6ICglcywgJXMsICVzKSwgR19tZWFzOiAoJXMsICVzLCAlcyknLCByYWRUb0RlZyAqIGdldFF1YXRlcm5pb25BbmdsZShkZWx0YVEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkueC50b0ZpeGVkKDEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkueS50b0ZpeGVkKDEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkuei50b0ZpeGVkKDEpLCB0aGlzLm1lYXN1cmVkR3Jhdml0eS54LnRvRml4ZWQoMSksIHRoaXMubWVhc3VyZWRHcmF2aXR5LnkudG9GaXhlZCgxKSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkuei50b0ZpeGVkKDEpKTsKICB9CiAgdmFyIHRhcmdldFEgPSBuZXcgUXVhdGVybmlvbigpOwogIHRhcmdldFEuY29weSh0aGlzLmZpbHRlclEpOwogIHRhcmdldFEubXVsdGlwbHkoZGVsdGFRKTsKICB0aGlzLmZpbHRlclEuc2xlcnAodGFyZ2V0USwgMSAtIHRoaXMua0ZpbHRlcik7CiAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwp9OwpDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5nZXRPcmllbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5maWx0ZXJROwp9OwpDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hY2NlbFRvUXVhdGVybmlvbl8gPSBmdW5jdGlvbiAoYWNjZWwpIHsKICB2YXIgbm9ybUFjY2VsID0gbmV3IFZlY3RvcjMoKTsKICBub3JtQWNjZWwuY29weShhY2NlbCk7CiAgbm9ybUFjY2VsLm5vcm1hbGl6ZSgpOwogIHZhciBxdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBxdWF0LnNldEZyb21Vbml0VmVjdG9ycyhuZXcgVmVjdG9yMygwLCAwLCAtMSksIG5vcm1BY2NlbCk7CiAgcXVhdC5pbnZlcnNlKCk7CiAgcmV0dXJuIHF1YXQ7Cn07CkNvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLmd5cm9Ub1F1YXRlcm5pb25EZWx0YV8gPSBmdW5jdGlvbiAoZ3lybywgZHQpIHsKICB2YXIgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgdmFyIGF4aXMgPSBuZXcgVmVjdG9yMygpOwogIGF4aXMuY29weShneXJvKTsKICBheGlzLm5vcm1hbGl6ZSgpOwogIHF1YXQuc2V0RnJvbUF4aXNBbmdsZShheGlzLCBneXJvLmxlbmd0aCgpICogZHQpOwogIHJldHVybiBxdWF0Owp9OwpmdW5jdGlvbiBQb3NlUHJlZGljdG9yKHByZWRpY3Rpb25UaW1lUywgaXNEZWJ1ZykgewogIHRoaXMucHJlZGljdGlvblRpbWVTID0gcHJlZGljdGlvblRpbWVTOwogIHRoaXMuaXNEZWJ1ZyA9IGlzRGVidWc7CiAgdGhpcy5wcmV2aW91c1EgPSBuZXcgUXVhdGVybmlvbigpOwogIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gbnVsbDsKICB0aGlzLmRlbHRhUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgdGhpcy5vdXRRID0gbmV3IFF1YXRlcm5pb24oKTsKfQpQb3NlUHJlZGljdG9yLnByb3RvdHlwZS5nZXRQcmVkaWN0aW9uID0gZnVuY3Rpb24gKGN1cnJlbnRRLCBneXJvLCB0aW1lc3RhbXBTKSB7CiAgaWYgKCF0aGlzLnByZXZpb3VzVGltZXN0YW1wUykgewogICAgdGhpcy5wcmV2aW91c1EuY29weShjdXJyZW50USk7CiAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICByZXR1cm4gY3VycmVudFE7CiAgfQogIHZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKICBheGlzLmNvcHkoZ3lybyk7CiAgYXhpcy5ub3JtYWxpemUoKTsKICB2YXIgYW5ndWxhclNwZWVkID0gZ3lyby5sZW5ndGgoKTsKICBpZiAoYW5ndWxhclNwZWVkIDwgZGVnVG9SYWQgKiAyMCkgewogICAgaWYgKHRoaXMuaXNEZWJ1ZykgewogICAgICBjb25zb2xlLmxvZygnTW92aW5nIHNsb3dseSwgYXQgJXMgZGVnL3M6IG5vIHByZWRpY3Rpb24nLCAocmFkVG9EZWcgKiBhbmd1bGFyU3BlZWQpLnRvRml4ZWQoMSkpOwogICAgfQogICAgdGhpcy5vdXRRLmNvcHkoY3VycmVudFEpOwogICAgdGhpcy5wcmV2aW91c1EuY29weShjdXJyZW50USk7CiAgICByZXR1cm4gdGhpcy5vdXRROwogIH0KICB2YXIgcHJlZGljdEFuZ2xlID0gYW5ndWxhclNwZWVkICogdGhpcy5wcmVkaWN0aW9uVGltZVM7CiAgdGhpcy5kZWx0YVEuc2V0RnJvbUF4aXNBbmdsZShheGlzLCBwcmVkaWN0QW5nbGUpOwogIHRoaXMub3V0US5jb3B5KHRoaXMucHJldmlvdXNRKTsKICB0aGlzLm91dFEubXVsdGlwbHkodGhpcy5kZWx0YVEpOwogIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwogIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKICByZXR1cm4gdGhpcy5vdXRROwp9OwpmdW5jdGlvbiBGdXNpb25Qb3NlU2Vuc29yKGtGaWx0ZXIsIHByZWRpY3Rpb25UaW1lLCB5YXdPbmx5LCBpc0RlYnVnKSB7CiAgdGhpcy55YXdPbmx5ID0geWF3T25seTsKICB0aGlzLmFjY2VsZXJvbWV0ZXIgPSBuZXcgVmVjdG9yMygpOwogIHRoaXMuZ3lyb3Njb3BlID0gbmV3IFZlY3RvcjMoKTsKICB0aGlzLmZpbHRlciA9IG5ldyBDb21wbGVtZW50YXJ5RmlsdGVyKGtGaWx0ZXIsIGlzRGVidWcpOwogIHRoaXMucG9zZVByZWRpY3RvciA9IG5ldyBQb3NlUHJlZGljdG9yKHByZWRpY3Rpb25UaW1lLCBpc0RlYnVnKTsKICB0aGlzLmlzRmlyZWZveEFuZHJvaWQgPSBpc0ZpcmVmb3hBbmRyb2lkKCk7CiAgdGhpcy5pc0lPUyA9IGlzSU9TKCk7CiAgdmFyIGNocm9tZVZlcnNpb24gPSBnZXRDaHJvbWVWZXJzaW9uKCk7CiAgdGhpcy5pc0RldmljZU1vdGlvbkluUmFkaWFucyA9ICF0aGlzLmlzSU9TICYmIGNocm9tZVZlcnNpb24gJiYgY2hyb21lVmVyc2lvbiA8IDY2OwogIHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uID0gaXNDaHJvbWVXaXRob3V0RGV2aWNlTW90aW9uKCk7CiAgdGhpcy5maWx0ZXJUb1dvcmxkUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgaWYgKGlzSU9TKCkpIHsKICAgIHRoaXMuZmlsdGVyVG9Xb3JsZFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygxLCAwLCAwKSwgTWF0aC5QSSAvIDIpOwogIH0gZWxzZSB7CiAgICB0aGlzLmZpbHRlclRvV29ybGRRLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIC1NYXRoLlBJIC8gMik7CiAgfQogIHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RID0gbmV3IFF1YXRlcm5pb24oKTsKICB0aGlzLndvcmxkVG9TY3JlZW5RID0gbmV3IFF1YXRlcm5pb24oKTsKICB0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEgPSBuZXcgUXVhdGVybmlvbigpOwogIHRoaXMub3JpZ2luYWxQb3NlQWRqdXN0US5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIDEpLCAtd2luZG93Lm9yaWVudGF0aW9uICogTWF0aC5QSSAvIDE4MCk7CiAgdGhpcy5zZXRTY3JlZW5UcmFuc2Zvcm1fKCk7CiAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpKSB7CiAgICB0aGlzLmZpbHRlclRvV29ybGRRLm11bHRpcGx5KHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RKTsKICB9CiAgdGhpcy5yZXNldFEgPSBuZXcgUXVhdGVybmlvbigpOwogIHRoaXMub3JpZW50YXRpb25PdXRfID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICB0aGlzLnN0YXJ0KCk7Cn0KRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIG51bGw7Cn07CkZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLmdldE9yaWVudGF0aW9uID0gZnVuY3Rpb24gKCkgewogIHZhciBvcmllbnRhdGlvbiA9IHZvaWQgMDsKICBpZiAodGhpcy5pc1dpdGhvdXREZXZpY2VNb3Rpb24gJiYgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RKSB7CiAgICB0aGlzLmRldmljZU9yaWVudGF0aW9uRml4USA9IHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaXhRIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHogPSBuZXcgUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMCwgMCwgLTEpLCAwKTsKICAgICAgdmFyIHkgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSAtOTApIHsKICAgICAgICB5LnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMCwgMSwgMCksIE1hdGguUEkgLyAtMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDEsIDApLCBNYXRoLlBJIC8gMik7CiAgICAgIH0KICAgICAgcmV0dXJuIHoubXVsdGlwbHkoeSk7CiAgICB9KCk7CiAgICB0aGlzLmRldmljZU9yaWVudGF0aW9uRmlsdGVyVG9Xb3JsZFEgPSB0aGlzLmRldmljZU9yaWVudGF0aW9uRmlsdGVyVG9Xb3JsZFEgfHwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygxLCAwLCAwKSwgLU1hdGguUEkgLyAyKTsKICAgICAgcmV0dXJuIHE7CiAgICB9KCk7CiAgICBvcmllbnRhdGlvbiA9IHRoaXMuX2RldmljZU9yaWVudGF0aW9uUTsKICAgIHZhciBvdXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgb3V0LmNvcHkob3JpZW50YXRpb24pOwogICAgb3V0Lm11bHRpcGx5KHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaWx0ZXJUb1dvcmxkUSk7CiAgICBvdXQubXVsdGlwbHkodGhpcy5yZXNldFEpOwogICAgb3V0Lm11bHRpcGx5KHRoaXMud29ybGRUb1NjcmVlblEpOwogICAgb3V0Lm11bHRpcGx5UXVhdGVybmlvbnModGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpeFEsIG91dCk7CiAgICBpZiAodGhpcy55YXdPbmx5KSB7CiAgICAgIG91dC54ID0gMDsKICAgICAgb3V0LnogPSAwOwogICAgICBvdXQubm9ybWFsaXplKCk7CiAgICB9CiAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1swXSA9IG91dC54OwogICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMV0gPSBvdXQueTsKICAgIHRoaXMub3JpZW50YXRpb25PdXRfWzJdID0gb3V0Lno7CiAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1szXSA9IG91dC53OwogICAgcmV0dXJuIHRoaXMub3JpZW50YXRpb25PdXRfOwogIH0gZWxzZSB7CiAgICB2YXIgZmlsdGVyT3JpZW50YXRpb24gPSB0aGlzLmZpbHRlci5nZXRPcmllbnRhdGlvbigpOwogICAgb3JpZW50YXRpb24gPSB0aGlzLnBvc2VQcmVkaWN0b3IuZ2V0UHJlZGljdGlvbihmaWx0ZXJPcmllbnRhdGlvbiwgdGhpcy5neXJvc2NvcGUsIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTKTsKICB9CiAgdmFyIG91dCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgb3V0LmNvcHkodGhpcy5maWx0ZXJUb1dvcmxkUSk7CiAgb3V0Lm11bHRpcGx5KHRoaXMucmVzZXRRKTsKICBvdXQubXVsdGlwbHkob3JpZW50YXRpb24pOwogIG91dC5tdWx0aXBseSh0aGlzLndvcmxkVG9TY3JlZW5RKTsKICBpZiAodGhpcy55YXdPbmx5KSB7CiAgICBvdXQueCA9IDA7CiAgICBvdXQueiA9IDA7CiAgICBvdXQubm9ybWFsaXplKCk7CiAgfQogIHRoaXMub3JpZW50YXRpb25PdXRfWzBdID0gb3V0Lng7CiAgdGhpcy5vcmllbnRhdGlvbk91dF9bMV0gPSBvdXQueTsKICB0aGlzLm9yaWVudGF0aW9uT3V0X1syXSA9IG91dC56OwogIHRoaXMub3JpZW50YXRpb25PdXRfWzNdID0gb3V0Lnc7CiAgcmV0dXJuIHRoaXMub3JpZW50YXRpb25PdXRfOwp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5yZXNldFBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5yZXNldFEuY29weSh0aGlzLmZpbHRlci5nZXRPcmllbnRhdGlvbigpKTsKICB0aGlzLnJlc2V0US54ID0gMDsKICB0aGlzLnJlc2V0US55ID0gMDsKICB0aGlzLnJlc2V0US56ICo9IC0xOwogIHRoaXMucmVzZXRRLm5vcm1hbGl6ZSgpOwogIGlmIChpc0xhbmRzY2FwZU1vZGUoKSkgewogICAgdGhpcy5yZXNldFEubXVsdGlwbHkodGhpcy5pbnZlcnNlV29ybGRUb1NjcmVlblEpOwogIH0KICB0aGlzLnJlc2V0US5tdWx0aXBseSh0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEpOwp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbkRldmljZU9yaWVudGF0aW9uXyA9IGZ1bmN0aW9uIChlKSB7CiAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RID0gdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RIHx8IG5ldyBRdWF0ZXJuaW9uKCk7CiAgdmFyIGFscGhhID0gZS5hbHBoYSwKICAgICAgYmV0YSA9IGUuYmV0YSwKICAgICAgZ2FtbWEgPSBlLmdhbW1hOwogIGFscGhhID0gKGFscGhhIHx8IDApICogTWF0aC5QSSAvIDE4MDsKICBiZXRhID0gKGJldGEgfHwgMCkgKiBNYXRoLlBJIC8gMTgwOwogIGdhbW1hID0gKGdhbW1hIHx8IDApICogTWF0aC5QSSAvIDE4MDsKICB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblEuc2V0RnJvbUV1bGVyWVhaKGJldGEsIGFscGhhLCAtZ2FtbWEpOwp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbkRldmljZU1vdGlvbl8gPSBmdW5jdGlvbiAoZGV2aWNlTW90aW9uKSB7CiAgdGhpcy51cGRhdGVEZXZpY2VNb3Rpb25fKGRldmljZU1vdGlvbik7Cn07CkZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnVwZGF0ZURldmljZU1vdGlvbl8gPSBmdW5jdGlvbiAoZGV2aWNlTW90aW9uKSB7CiAgdmFyIGFjY0dyYXZpdHkgPSBkZXZpY2VNb3Rpb24uYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eTsKICB2YXIgcm90UmF0ZSA9IGRldmljZU1vdGlvbi5yb3RhdGlvblJhdGU7CiAgdmFyIHRpbWVzdGFtcFMgPSBkZXZpY2VNb3Rpb24udGltZVN0YW1wIC8gMTAwMDsKICB2YXIgZGVsdGFTID0gdGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTOwogIGlmIChkZWx0YVMgPCAwKSB7CiAgICB3YXJuT25jZSgnZnVzaW9uLXBvc2Utc2Vuc29yOmludmFsaWQ6bm9uLW1vbm90b25pYycsICdJbnZhbGlkIHRpbWVzdGFtcHMgZGV0ZWN0ZWQ6IG5vbi1tb25vdG9uaWMgdGltZXN0YW1wIGZyb20gZGV2aWNlbW90aW9uJyk7CiAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICByZXR1cm47CiAgfSBlbHNlIGlmIChkZWx0YVMgPD0gTUlOX1RJTUVTVEVQIHx8IGRlbHRhUyA+IE1BWF9USU1FU1RFUCkgewogICAgd2Fybk9uY2UoJ2Z1c2lvbi1wb3NlLXNlbnNvcjppbnZhbGlkOm91dHNpZGUtdGhyZXNob2xkJywgJ0ludmFsaWQgdGltZXN0YW1wcyBkZXRlY3RlZDogVGltZXN0YW1wIGZyb20gZGV2aWNlbW90aW9uIG91dHNpZGUgZXhwZWN0ZWQgcmFuZ2UuJyk7CiAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICByZXR1cm47CiAgfQogIHRoaXMuYWNjZWxlcm9tZXRlci5zZXQoLWFjY0dyYXZpdHkueCwgLWFjY0dyYXZpdHkueSwgLWFjY0dyYXZpdHkueik7CiAgaWYgKGlzUjcoKSkgewogICAgdGhpcy5neXJvc2NvcGUuc2V0KC1yb3RSYXRlLmJldGEsIHJvdFJhdGUuYWxwaGEsIHJvdFJhdGUuZ2FtbWEpOwogIH0gZWxzZSB7CiAgICB0aGlzLmd5cm9zY29wZS5zZXQocm90UmF0ZS5hbHBoYSwgcm90UmF0ZS5iZXRhLCByb3RSYXRlLmdhbW1hKTsKICB9CiAgaWYgKCF0aGlzLmlzRGV2aWNlTW90aW9uSW5SYWRpYW5zKSB7CiAgICB0aGlzLmd5cm9zY29wZS5tdWx0aXBseVNjYWxhcihNYXRoLlBJIC8gMTgwKTsKICB9CiAgdGhpcy5maWx0ZXIuYWRkQWNjZWxNZWFzdXJlbWVudCh0aGlzLmFjY2VsZXJvbWV0ZXIsIHRpbWVzdGFtcFMpOwogIHRoaXMuZmlsdGVyLmFkZEd5cm9NZWFzdXJlbWVudCh0aGlzLmd5cm9zY29wZSwgdGltZXN0YW1wUyk7CiAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChzY3JlZW5PcmllbnRhdGlvbikgewogIHRoaXMuc2V0U2NyZWVuVHJhbnNmb3JtXygpOwp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbk1lc3NhZ2VfID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgdmFyIG1lc3NhZ2UgPSBldmVudC5kYXRhOwogIGlmICghbWVzc2FnZSB8fCAhbWVzc2FnZS50eXBlKSB7CiAgICByZXR1cm47CiAgfQogIHZhciB0eXBlID0gbWVzc2FnZS50eXBlLnRvTG93ZXJDYXNlKCk7CiAgaWYgKHR5cGUgIT09ICdkZXZpY2Vtb3Rpb24nKSB7CiAgICByZXR1cm47CiAgfQogIHRoaXMudXBkYXRlRGV2aWNlTW90aW9uXyhtZXNzYWdlLmRldmljZU1vdGlvbkV2ZW50KTsKfTsKRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc2V0U2NyZWVuVHJhbnNmb3JtXyA9IGZ1bmN0aW9uICgpIHsKICB0aGlzLndvcmxkVG9TY3JlZW5RLnNldCgwLCAwLCAwLCAxKTsKICBzd2l0Y2ggKHdpbmRvdy5vcmllbnRhdGlvbikgewogICAgY2FzZSAwOgogICAgICBicmVhazsKICAgIGNhc2UgOTA6CiAgICAgIHRoaXMud29ybGRUb1NjcmVlblEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgLU1hdGguUEkgLyAyKTsKICAgICAgYnJlYWs7CiAgICBjYXNlIC05MDoKICAgICAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIDEpLCBNYXRoLlBJIC8gMik7CiAgICAgIGJyZWFrOwogICAgY2FzZSAxODA6CiAgICAgIGJyZWFrOwogIH0KICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUS5jb3B5KHRoaXMud29ybGRUb1NjcmVlblEpOwogIHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RLmludmVyc2UoKTsKfTsKRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyA9IHRoaXMub25EZXZpY2VNb3Rpb25fLmJpbmQodGhpcyk7CiAgdGhpcy5vbk9yaWVudGF0aW9uQ2hhbmdlQ2FsbGJhY2tfID0gdGhpcy5vbk9yaWVudGF0aW9uQ2hhbmdlXy5iaW5kKHRoaXMpOwogIHRoaXMub25NZXNzYWdlQ2FsbGJhY2tfID0gdGhpcy5vbk1lc3NhZ2VfLmJpbmQodGhpcyk7CiAgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfID0gdGhpcy5vbkRldmljZU9yaWVudGF0aW9uXy5iaW5kKHRoaXMpOwogIGlmIChpc0lPUygpICYmIGlzSW5zaWRlQ3Jvc3NPcmlnaW5JRnJhbWUoKSkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyk7CiAgfQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyk7CiAgaWYgKHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uKSB7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCB0aGlzLm9uRGV2aWNlT3JpZW50YXRpb25DYWxsYmFja18pOwogIH0gZWxzZSB7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyk7CiAgfQp9OwpGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkgewogIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdkZXZpY2Vtb3Rpb24nLCB0aGlzLm9uRGV2aWNlTW90aW9uQ2FsbGJhY2tfKTsKICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCB0aGlzLm9uRGV2aWNlT3JpZW50YXRpb25DYWxsYmFja18pOwogIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyk7CiAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyk7Cn07CnZhciBTRU5TT1JfRlJFUVVFTkNZID0gNjA7CnZhciBYX0FYSVMgPSBuZXcgVmVjdG9yMygxLCAwLCAwKTsKdmFyIFpfQVhJUyA9IG5ldyBWZWN0b3IzKDAsIDAsIDEpOwp2YXIgU0VOU09SX1RPX1ZSID0gbmV3IFF1YXRlcm5pb24oKTsKU0VOU09SX1RPX1ZSLnNldEZyb21BeGlzQW5nbGUoWF9BWElTLCAtTWF0aC5QSSAvIDIpOwpTRU5TT1JfVE9fVlIubXVsdGlwbHkobmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKFpfQVhJUywgTWF0aC5QSSAvIDIpKTsKdmFyIFBvc2VTZW5zb3IgPSBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUG9zZVNlbnNvcihjb25maWcpIHsKICAgIGNsYXNzQ2FsbENoZWNrKHRoaXMsIFBvc2VTZW5zb3IpOwogICAgdGhpcy5jb25maWcgPSBjb25maWc7CiAgICB0aGlzLnNlbnNvciA9IG51bGw7CiAgICB0aGlzLmZ1c2lvblNlbnNvciA9IG51bGw7CiAgICB0aGlzLl9vdXQgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICAgdGhpcy5hcGkgPSBudWxsOwogICAgdGhpcy5lcnJvcnMgPSBbXTsKICAgIHRoaXMuX3NlbnNvclEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgdGhpcy5fb3V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICB0aGlzLl9vblNlbnNvclJlYWQgPSB0aGlzLl9vblNlbnNvclJlYWQuYmluZCh0aGlzKTsKICAgIHRoaXMuX29uU2Vuc29yRXJyb3IgPSB0aGlzLl9vblNlbnNvckVycm9yLmJpbmQodGhpcyk7CiAgICB0aGlzLmluaXQoKTsKICB9CiAgY3JlYXRlQ2xhc3MoUG9zZVNlbnNvciwgW3sKICAgIGtleTogJ2luaXQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgIHZhciBzZW5zb3IgPSBudWxsOwogICAgICB0cnkgewogICAgICAgIHNlbnNvciA9IG5ldyBSZWxhdGl2ZU9yaWVudGF0aW9uU2Vuc29yKHsKICAgICAgICAgIGZyZXF1ZW5jeTogU0VOU09SX0ZSRVFVRU5DWSwKICAgICAgICAgIHJlZmVyZW5jZUZyYW1lOiAnc2NyZWVuJwogICAgICAgIH0pOwogICAgICAgIHNlbnNvci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuX29uU2Vuc29yRXJyb3IpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZXJyb3IpOwogICAgICAgIGlmIChlcnJvci5uYW1lID09PSAnU2VjdXJpdHlFcnJvcicpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBjb25zdHJ1Y3Qgc2Vuc29ycyBkdWUgdG8gdGhlIEZlYXR1cmUgUG9saWN5Jyk7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0F0dGVtcHRpbmcgdG8gZmFsbCBiYWNrIHVzaW5nICJkZXZpY2Vtb3Rpb24iOyBob3dldmVyIHRoaXMgd2lsbCAnICsgJ2ZhaWwgaW4gdGhlIGZ1dHVyZSB3aXRob3V0IGNvcnJlY3QgcGVybWlzc2lvbnMuJyk7CiAgICAgICAgICB0aGlzLnVzZURldmljZU1vdGlvbigpOwogICAgICAgIH0gZWxzZSBpZiAoZXJyb3IubmFtZSA9PT0gJ1JlZmVyZW5jZUVycm9yJykgewogICAgICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzZW5zb3IpIHsKICAgICAgICB0aGlzLmFwaSA9ICdzZW5zb3InOwogICAgICAgIHRoaXMuc2Vuc29yID0gc2Vuc29yOwogICAgICAgIHRoaXMuc2Vuc29yLmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWRpbmcnLCB0aGlzLl9vblNlbnNvclJlYWQpOwogICAgICAgIHRoaXMuc2Vuc29yLnN0YXJ0KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICd1c2VEZXZpY2VNb3Rpb24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVzZURldmljZU1vdGlvbigpIHsKICAgICAgdGhpcy5hcGkgPSAnZGV2aWNlbW90aW9uJzsKICAgICAgdGhpcy5mdXNpb25TZW5zb3IgPSBuZXcgRnVzaW9uUG9zZVNlbnNvcih0aGlzLmNvbmZpZy5LX0ZJTFRFUiwgdGhpcy5jb25maWcuUFJFRElDVElPTl9USU1FX1MsIHRoaXMuY29uZmlnLllBV19PTkxZLCB0aGlzLmNvbmZpZy5ERUJVRyk7CiAgICAgIGlmICh0aGlzLnNlbnNvcikgewogICAgICAgIHRoaXMuc2Vuc29yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlYWRpbmcnLCB0aGlzLl9vblNlbnNvclJlYWQpOwogICAgICAgIHRoaXMuc2Vuc29yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcy5fb25TZW5zb3JFcnJvcik7CiAgICAgICAgdGhpcy5zZW5zb3IgPSBudWxsOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnZ2V0T3JpZW50YXRpb24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9yaWVudGF0aW9uKCkgewogICAgICBpZiAodGhpcy5mdXNpb25TZW5zb3IpIHsKICAgICAgICByZXR1cm4gdGhpcy5mdXNpb25TZW5zb3IuZ2V0T3JpZW50YXRpb24oKTsKICAgICAgfQogICAgICBpZiAoIXRoaXMuc2Vuc29yIHx8ICF0aGlzLnNlbnNvci5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5fb3V0WzBdID0gdGhpcy5fb3V0WzFdID0gdGhpcy5fb3V0WzJdID0gMDsKICAgICAgICB0aGlzLl9vdXRbM10gPSAxOwogICAgICAgIHJldHVybiB0aGlzLl9vdXQ7CiAgICAgIH0KICAgICAgdmFyIHEgPSB0aGlzLnNlbnNvci5xdWF0ZXJuaW9uOwogICAgICB0aGlzLl9zZW5zb3JRLnNldChxWzBdLCBxWzFdLCBxWzJdLCBxWzNdKTsKICAgICAgdmFyIG91dCA9IHRoaXMuX291dFE7CiAgICAgIG91dC5jb3B5KFNFTlNPUl9UT19WUik7CiAgICAgIG91dC5tdWx0aXBseSh0aGlzLl9zZW5zb3JRKTsKICAgICAgaWYgKHRoaXMuY29uZmlnLllBV19PTkxZKSB7CiAgICAgICAgb3V0LnggPSBvdXQueiA9IDA7CiAgICAgICAgb3V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICAgIHRoaXMuX291dFswXSA9IG91dC54OwogICAgICB0aGlzLl9vdXRbMV0gPSBvdXQueTsKICAgICAgdGhpcy5fb3V0WzJdID0gb3V0Lno7CiAgICAgIHRoaXMuX291dFszXSA9IG91dC53OwogICAgICByZXR1cm4gdGhpcy5fb3V0OwogICAgfQogIH0sIHsKICAgIGtleTogJ19vblNlbnNvckVycm9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25TZW5zb3JFcnJvcihldmVudCkgewogICAgICB0aGlzLmVycm9ycy5wdXNoKGV2ZW50LmVycm9yKTsKICAgICAgaWYgKGV2ZW50LmVycm9yLm5hbWUgPT09ICdOb3RBbGxvd2VkRXJyb3InKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignUGVybWlzc2lvbiB0byBhY2Nlc3Mgc2Vuc29yIHdhcyBkZW5pZWQnKTsKICAgICAgfSBlbHNlIGlmIChldmVudC5lcnJvci5uYW1lID09PSAnTm90UmVhZGFibGVFcnJvcicpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdTZW5zb3IgY291bGQgbm90IGJlIHJlYWQnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKGV2ZW50LmVycm9yKTsKICAgICAgfQogICAgICB0aGlzLnVzZURldmljZU1vdGlvbigpOwogICAgfQogIH0sIHsKICAgIGtleTogJ19vblNlbnNvclJlYWQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblNlbnNvclJlYWQoKSB7fQogIH1dKTsKICByZXR1cm4gUG9zZVNlbnNvcjsKfSgpOwp2YXIgcm90YXRlSW5zdHJ1Y3Rpb25zQXNzZXQgPSAiPHN2ZyB3aWR0aD0nMTk4JyBoZWlnaHQ9JzI0MCcgdmlld0JveD0nMCAwIDE5OCAyNDAnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PGcgZmlsbD0nbm9uZScgZmlsbC1ydWxlPSdldmVub2RkJz48cGF0aCBkPSdNMTQ5LjYyNSAxMDkuNTI3bDYuNzM3IDMuODkxdi44ODZjMCAuMTc3LjAxMy4zNi4wMzguNTQ5LjAxLjA4MS4wMi4xNjIuMDI3LjI0Mi4xNCAxLjQxNS45NzQgMi45OTggMi4xMDUgMy45OTlsNS43MiA1LjA2Mi4wODEtLjA5czQuMzgyLTIuNTMgNS4yMzUtMy4wMjRsMjUuOTcgMTQuOTkzdjU0LjAwMWMwIC43NzEtLjM4NiAxLjIxNy0uOTQ4IDEuMjE3LS4yMzMgMC0uNDk1LS4wNzYtLjc3Mi0uMjM2bC0yMy45NjctMTMuODM4LS4wMTQuMDI0LTI3LjMyMiAxNS43NzUtLjg1LTEuMzIzYy00LjczMS0xLjUyOS05Ljc0OC0yLjc0LTE0Ljk1MS0zLjYxYS4yNy4yNyAwIDAgMC0uMDA3LjAyNGwtNS4wNjcgMTYuOTYxLTcuODkxIDQuNTU2LS4wMzctLjA2M3YyNy41OWMwIC43NzItLjM4NiAxLjIxNy0uOTQ4IDEuMjE3LS4yMzIgMC0uNDk1LS4wNzYtLjc3Mi0uMjM2bC00Mi40NzMtMjQuNTIyYy0uOTUtLjU0OS0xLjcyLTEuODc3LTEuNzItMi45Njd2LTEuMDM1bC0uMDIxLjA0N2E1LjExMSA1LjExMSAwIDAgMC0xLjgxNi0uMzk5IDUuNjgyIDUuNjgyIDAgMCAwLS41NDYuMDAxIDEzLjcyNCAxMy43MjQgMCAwIDEtMS45MTgtLjA0MWMtMS42NTUtLjE1My0zLjItLjYtNC40MDQtMS4yOTZsLTQ2LjU3Ni0yNi44OS4wMDUuMDEyLTEwLjI3OC0xOC43NWMtMS4wMDEtMS44MjctLjI0MS00LjIxNiAxLjY5OC01LjMzNmw1Ni4wMTEtMzIuMzQ1YTQuMTk0IDQuMTk0IDAgMCAxIDIuMDk5LS41NzJjMS4zMjYgMCAyLjU3Mi42NTkgMy4yMjcgMS44NTNsLjAwNS0uMDAzLjIyNy40MTMtLjAwNi4wMDRhOS42MyA5LjYzIDAgMCAwIDEuNDc3IDIuMDE4bC4yNzcuMjdjMS45MTQgMS44NSA0LjQ2OCAyLjgwMSA3LjExMyAyLjgwMSAxLjk0OSAwIDMuOTQ4LS41MTcgNS43NzUtMS41NzIuMDEzIDAgNy4zMTktNC4yMTkgNy4zMTktNC4yMTlhNC4xOTQgNC4xOTQgMCAwIDEgMi4wOTktLjU3MmMxLjMyNiAwIDIuNTcyLjY1OCAzLjIyNiAxLjg1M2wzLjI1IDUuOTI4LjAyMi0uMDE4IDYuNzg1IDMuOTE3LS4xMDUtLjE4MiA0Ni44ODEtMjYuOTY1bTAtMS42MzVjLS4yODIgMC0uNTYzLjA3My0uODE1LjIxOGwtNDYuMTY5IDI2LjU1Ni01LjQxLTMuMTI0LTMuMDA1LTUuNDgxYy0uOTEzLTEuNjY3LTIuNjk5LTIuNzAyLTQuNjYtMi43MDMtMS4wMTEgMC0yLjAyLjI3NC0yLjkxNy43OTJhMzgyNSAzODI1IDAgMCAxLTcuMjc1IDQuMTk1bC0uMDQ0LjAyNGE5LjkzNyA5LjkzNyAwIDAgMS00Ljk1NyAxLjM1M2MtMi4yOTIgMC00LjQxNC0uODMyLTUuOTc2LTIuMzQybC0uMjUyLS4yNDVhNy45OTIgNy45OTIgMCAwIDEtMS4xMzktMS41MzQgMS4zNzkgMS4zNzkgMCAwIDAtLjA2LS4xMjJsLS4yMjctLjQxNGExLjcxOCAxLjcxOCAwIDAgMC0uMDk1LS4xNTRjLS45MzgtMS41NzQtMi42NzMtMi41NDUtNC41NzEtMi41NDUtMS4wMTEgMC0yLjAyLjI3NC0yLjkxNy43OTJMMy4xMjUgMTU1LjUwMmMtMi42OTkgMS41NTktMy43MzggNC45NC0yLjMxNCA3LjUzOGwxMC4yNzggMTguNzVjLjE3Ny4zMjMuNDQ4LjU2My43NjEuNzA0bDQ2LjQyNiAyNi44MDRjMS40MDMuODEgMy4xNTcgMS4zMzIgNS4wNzIgMS41MDhhMTUuNjYxIDE1LjY2MSAwIDAgMCAyLjE0Ni4wNDYgNC43NjYgNC43NjYgMCAwIDEgLjM5NiAwYy4wOTYuMDA0LjE5LjAxMS4yODMuMDIyLjEwOSAxLjU5MyAxLjE1OSAzLjMyMyAyLjUyOSA0LjExNGw0Mi40NzIgMjQuNTIyYy41MjQuMzAyIDEuMDU4LjQ1NSAxLjU5LjQ1NSAxLjQ5NyAwIDIuNTgzLTEuMiAyLjU4My0yLjg1MnYtMjYuNTYybDcuMTExLTQuMTA1YTEuNjQgMS42NCAwIDAgMCAuNzQ5LS45NDhsNC42NTgtMTUuNTkzYzQuNDE0Ljc5NyA4LjY5MiAxLjg0OCAxMi43NDIgMy4xMjhsLjUzMy44MjlhMS42MzQgMS42MzQgMCAwIDAgMi4xOTMuNTMxbDI2LjUzMi0xNS4zMTdMMTkzIDE5Mi40MzNjLjUyMy4zMDIgMS4wNTguNDU1IDEuNTkuNDU1IDEuNDk3IDAgMi41ODMtMS4xOTkgMi41ODMtMi44NTJ2LTU0LjAwMWMwLS41ODQtLjMxMi0xLjEyNC0uODE4LTEuNDE2bC0yNS45Ny0xNC45OTNhMS42MzMgMS42MzMgMCAwIDAtMS42MzYuMDAxYy0uNjA2LjM1MS0yLjk5MyAxLjczLTQuMzI1IDIuNDk4bC00LjgwOS00LjI1NWMtLjgxOS0uNzI1LTEuNDYxLTEuOTMzLTEuNTYxLTIuOTM2YTcuNzc2IDcuNzc2IDAgMCAwLS4wMzMtLjI5NCAyLjQ4NyAyLjQ4NyAwIDAgMS0uMDIzLS4zMzZ2LS44ODZjMC0uNTg0LS4zMTItMS4xMjMtLjgxNy0xLjQxNmwtNi43MzktMy44OTFhMS42MzMgMS42MzMgMCAwIDAtLjgxNy0uMjE5JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTk2LjAyNyAxMzIuNjM2bDQ2LjU3NiAyNi44OTFjMS4yMDQuNjk1IDEuOTc5IDEuNTg3IDIuMjQyIDIuNTQxbC0uMDEuMDA3LTgxLjM3NCA0Ni45ODJoLS4wMDFjLTEuNjU0LS4xNTItMy4xOTktLjYtNC40MDMtMS4yOTVsLTQ2LjU3Ni0yNi44OTEgODMuNTQ2LTQ4LjIzNScgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J002My40NjEgMjA5LjE3NGMtLjAwOCAwLS4wMTUgMC0uMDIyLS4wMDItMS42OTMtLjE1Ni0zLjIyOC0uNjA5LTQuNDQxLTEuMzA5bC00Ni41NzYtMjYuODlhLjExOC4xMTggMCAwIDEgMC0uMjAzbDgzLjU0Ni00OC4yMzVhLjExNy4xMTcgMCAwIDEgLjExNyAwbDQ2LjU3NiAyNi44OTFjMS4yMjcuNzA4IDIuMDIxIDEuNjEyIDIuMjk2IDIuNjExYS4xMTYuMTE2IDAgMCAxLS4wNDIuMTI0bC0uMDIxLjAxNi04MS4zNzUgNDYuOTgxYS4xMS4xMSAwIDAgMS0uMDU4LjAxNnptLTUwLjc0Ny0yOC4zMDNsNDYuNDAxIDI2Ljc5YzEuMTc4LjY4IDIuNjcxIDEuMTIxIDQuMzIgMS4yNzZsODEuMjcyLTQ2LjkyMmMtLjI3OS0uOTA3LTEuMDI1LTEuNzMtMi4xNjMtMi4zODdsLTQ2LjUxNy0yNi44NTctODMuMzEzIDQ4LjF6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OC4zMjcgMTY1LjQ3MWE1Ljg1IDUuODUgMCAwIDEtLjU0Ni4wMDFjLTEuODk0LS4wODMtMy4zMDItMS4wMzgtMy4xNDUtMi4xMzJhMi42OTMgMi42OTMgMCAwIDAtLjA3Mi0xLjEwNWwtODEuMTAzIDQ2LjgyMmMuNjI4LjA1OCAxLjI3Mi4wNzMgMS45MTguMDQyLjE4Mi0uMDA5LjM2NC0uMDA5LjU0Ni0uMDAxIDEuODk0LjA4MyAzLjMwMiAxLjAzOCAzLjE0NSAyLjEzMmw3OS4yNTctNDUuNzU5JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTY5LjA3IDIxMS4zNDdhLjExOC4xMTggMCAwIDEtLjExNS0uMTM0Yy4wNDUtLjMxNy0uMDU3LS42MzctLjI5Ny0uOTI1LS41MDUtLjYxLTEuNTU1LTEuMDIyLTIuNzM4LTEuMDc0YTUuOTY2IDUuOTY2IDAgMCAwLS41MzUuMDAxIDE0LjAzIDE0LjAzIDAgMCAxLTEuOTM1LS4wNDEuMTE3LjExNyAwIDAgMS0uMTAzLS4wOTIuMTE2LjExNiAwIDAgMSAuMDU1LS4xMjZsODEuMTA0LTQ2LjgyMmEuMTE3LjExNyAwIDAgMSAuMTcxLjA3Yy4xMDQuMzgxLjEyOS43NjguMDc0IDEuMTUzLS4wNDUuMzE2LjA1Ny42MzcuMjk2LjkyNS41MDYuNjEgMS41NTUgMS4wMjEgMi43MzkgMS4wNzMuMTc4LjAwOC4zNTcuMDA4LjUzNS0uMDAxYS4xMTcuMTE3IDAgMCAxIC4wNjQuMjE4bC03OS4yNTYgNDUuNzU5YS4xMTQuMTE0IDAgMCAxLS4wNTkuMDE2em0tMy40MDUtMi4zNzJjLjA4OSAwIC4xNzcuMDAyLjI2NS4wMDYgMS4yNjYuMDU2IDIuMzUzLjQ4OCAyLjkwOCAxLjE1OC4yMjcuMjc0LjM1LjU3NS4zNi44ODJsNzguNjg1LTQ1LjQyOWMtLjAzNiAwLS4wNzItLjAwMS0uMTA3LS4wMDMtMS4yNjctLjA1Ni0yLjM1NC0uNDg5LTIuOTA5LTEuMTU4LS4yODItLjM0LS40MDItLjcyNC0uMzQ3LTEuMTA3YTIuNjA0IDIuNjA0IDAgMCAwLS4wMzItLjkxTDYzLjg0NiAyMDguOTdhMTMuOTEgMTMuOTEgMCAwIDAgMS41MjguMDEyYy4wOTctLjAwNS4xOTQtLjAwNy4yOTEtLjAwN3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMi4yMDggMTYyLjEzNGMtMS4wMDEtMS44MjctLjI0MS00LjIxNyAxLjY5OC01LjMzN2w1Ni4wMTEtMzIuMzQ0YzEuOTM5LTEuMTIgNC4zMjQtLjU0NiA1LjMyNiAxLjI4MWwuMjMyLjQxYTkuMzQ0IDkuMzQ0IDAgMCAwIDEuNDcgMi4wMjFsLjI3OC4yN2MzLjMyNSAzLjIxNCA4LjU4MyAzLjcxNiAxMi44ODggMS4yM2w3LjMxOS00LjIyYzEuOTQtMS4xMTkgNC4zMjQtLjU0NiA1LjMyNSAxLjI4MmwzLjI1IDUuOTI4LTgzLjUxOSA0OC4yMjktMTAuMjc4LTE4Ljc1eicgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xMi40ODYgMTgxLjAwMWEuMTEyLjExMiAwIDAgMS0uMDMxLS4wMDUuMTE0LjExNCAwIDAgMS0uMDcxLS4wNTZMMi4xMDYgMTYyLjE5Yy0xLjAzMS0xLjg4LS4yNDktNC4zNDUgMS43NDItNS40OTRsNTYuMDEtMzIuMzQ0YTQuMzI4IDQuMzI4IDAgMCAxIDIuMTU4LS41ODhjMS40MTUgMCAyLjY1LjcwMiAzLjMxMSAxLjg4Mi4wMS4wMDguMDE4LjAxNy4wMjQuMDI4bC4yMjcuNDE0YS4xMjIuMTIyIDAgMCAxIC4wMTMuMDM4IDkuNTA4IDkuNTA4IDAgMCAwIDEuNDM5IDEuOTU5bC4yNzUuMjY2YzEuODQ2IDEuNzg2IDQuMzQ0IDIuNzY5IDcuMDMxIDIuNzY5IDEuOTc3IDAgMy45NTQtLjUzOCA1LjcxNy0xLjU1N2EuMTQ4LjE0OCAwIDAgMSAuMDM1LS4wMTNsNy4yODQtNC4yMDZhNC4zMjEgNC4zMjEgMCAwIDEgMi4xNTctLjU4OGMxLjQyNyAwIDIuNjcyLjcxNiAzLjMyOSAxLjkxNGwzLjI0OSA1LjkyOWEuMTE2LjExNiAwIDAgMS0uMDQ0LjE1N2wtODMuNTE4IDQ4LjIyOWEuMTE2LjExNiAwIDAgMS0uMDU5LjAxNnptNDkuNTMtNTcuMDA0Yy0uNzA0IDAtMS40MS4xOTMtMi4wNDEuNTU3bC01Ni4wMSAzMi4zNDVjLTEuODgyIDEuMDg2LTIuNjI0IDMuNDA5LTEuNjU1IDUuMTc5bDEwLjIyMSAxOC42NDUgODMuMzE3LTQ4LjExMi0zLjE5NS01LjgyOWMtLjYxNS0xLjEyMi0xLjc4My0xLjc5Mi0zLjEyNC0xLjc5MmE0LjA4IDQuMDggMCAwIDAtMi4wNC41NTdsLTcuMzE3IDQuMjI1YS4xNDguMTQ4IDAgMCAxLS4wMzUuMDEzIDExLjcgMTEuNyAwIDAgMS01LjgwMSAxLjU2OWMtMi43NDggMC01LjMwMy0xLjAwNy03LjE5NC0yLjgzNWwtLjI3OC0uMjdhOS43MTYgOS43MTYgMCAwIDEtMS40OTctMi4wNDYuMDk2LjA5NiAwIDAgMS0uMDEzLS4wMzdsLS4xOTEtLjM0N2EuMTEuMTEgMCAwIDEtLjAyMy0uMDI5Yy0uNjE1LTEuMTIzLTEuNzgzLTEuNzkzLTMuMTI0LTEuNzkzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J000Mi40MzQgMTU1LjgwOGMtMi41MS0uMDAxLTQuNjk3LTEuMjU4LTUuODUyLTMuMzY1LTEuODExLTMuMzA0LS40MzgtNy42MzQgMy4wNTktOS42NTRsMTIuMjkxLTcuMDk4YTcuNTk5IDcuNTk5IDAgMCAxIDMuNzg5LTEuMDMzYzIuNTEgMCA0LjY5NyAxLjI1OCA1Ljg1MiAzLjM2NSAxLjgxMSAzLjMwNC40MzkgNy42MzQtMy4wNTkgOS42NTRsLTEyLjI5MSA3LjA5OGE3LjYwNiA3LjYwNiAwIDAgMS0zLjc4OSAxLjAzM3ptMTMuMjg3LTIwLjY4M2E3LjEyOCA3LjEyOCAwIDAgMC0zLjU1NS45NzFsLTEyLjI5MSA3LjA5OGMtMy4yNzkgMS44OTMtNC41NzMgNS45NDItMi44ODMgOS4wMjQgMS4wNzEgMS45NTUgMy4xMDYgMy4xMjIgNS40NDIgMy4xMjJhNy4xMyA3LjEzIDAgMCAwIDMuNTU2LS45N2wxMi4yOTEtNy4wOThjMy4yNzktMS44OTMgNC41NzItNS45NDIgMi44ODMtOS4wMjQtMS4wNzItMS45NTUtMy4xMDYtMy4xMjMtNS40NDMtMy4xMjN6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OS41ODggMTA5LjQwN2w2LjczNyAzLjg5di44ODdjMCAuMTc2LjAxMy4zNi4wMzcuNTQ5LjAxMS4wODEuMDIuMTYxLjAyOC4yNDIuMTQgMS40MTUuOTczIDIuOTk4IDIuMTA1IDMuOTk5bDcuMzk2IDYuNTQ1Yy4xNzcuMTU2LjM1OC4yOTUuNTQxLjQxNSAxLjU3OSAxLjA0IDIuOTUuNDY2IDMuMDYyLTEuMjgyLjA0OS0uNzg0LjA1Ny0xLjU5NS4wMjMtMi40MjlsLS4wMDMtLjE2di0xLjE1MWwyNS45ODcgMTUuMDAzdjU0YzAgMS4wOS0uNzcgMS41My0xLjcyLjk4MmwtNDIuNDczLTI0LjUyM2MtLjk1LS41NDgtMS43Mi0xLjg3Ny0xLjcyLTIuOTY2di0zNC4wMzMnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTk0LjU1MyAxOTEuMjVjLS4yNTcgMC0uNTQtLjA4NS0uODMxLS4yNTNsLTQyLjQ3Mi0yNC41MjFjLS45ODEtLjU2Ny0xLjc3OS0xLjk0My0xLjc3OS0zLjA2OHYtMzQuMDMzaC4yMzR2MzQuMDMzYzAgMS4wNTEuNzQ1IDIuMzM2IDEuNjYxIDIuODY2bDQyLjQ3MyAyNC41MjFjLjQyNC4yNDUuODE2LjI4OCAxLjEwMy4xMjIuMjg1LS4xNjQuNDQyLS41Mi40NDItMS4wMDJ2LTUzLjkzM2wtMjUuNzUzLTE0Ljg2OC4wMDMgMS4xMDZjLjAzNC44MzIuMDI2IDEuNjU0LS4wMjQgMi40MzktLjA1NC44NDQtLjM5NiAxLjQ2NC0uOTYzIDEuNzQ2LS42MTkuMzA5LTEuNDUuMTczLTIuMjgtLjM3M2E1LjAyMyA1LjAyMyAwIDAgMS0uNTUzLS40MjZsLTcuMzk3LTYuNTQ0Yy0xLjE1OC0xLjAyNi0xLjk5OS0yLjYyNS0yLjE0My00LjA3NmE5LjYyNCA5LjYyNCAwIDAgMC0uMDI3LS4yMzggNC4yNDEgNC4yNDEgMCAwIDEtLjAzOC0uNTY0di0uODJsLTYuNjgtMy44NTYuMTE3LS4yMDIgNi43MzggMy44OS4wNTguMDM0di45NTRjMCAuMTcxLjAxMi4zNTEuMDM2LjUzMy4wMTEuMDgzLjAyMS4xNjUuMDI5LjI0Ni4xMzggMS4zOTUuOTQ4IDIuOTM1IDIuMDY1IDMuOTIzbDcuMzk3IDYuNTQ1Yy4xNzMuMTUzLjM1LjI4OS41MjcuNDA2Ljc1OC40OTkgMS41MDQuNjMgMi4wNDcuMzU5LjQ5LS4yNDMuNzg2LS43OTUuODM0LTEuNTUxLjA1LS43NzguMDU3LTEuNTkxLjAyNC0yLjQxN2wtLjAwNC0uMTYzdi0xLjM1NWwuMTc1LjEgMjUuOTg3IDE1LjAwNC4wNTkuMDMzdjU0LjA2OGMwIC41NjktLjE5OC45OTYtLjU1OSAxLjIwNGExLjAwMiAxLjAwMiAwIDAgMS0uNTA2LjEzMScgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDUuNjg1IDE2My4xNjFsMjQuMTE1IDEzLjkyMi0yNS45NzggMTQuOTk4LTEuNDYyLS4zMDdjLTYuNTM0LTIuMTctMTMuNjI4LTMuNzI4LTIxLjAxOS00LjYxNi00LjM2NS0uNTI0LTguNjYzIDEuMDk2LTkuNTk4IDMuNjJhMi43NDYgMi43NDYgMCAwIDAtLjAxMSAxLjkyOGMxLjUzOCA0LjI2NyA0LjIzNiA4LjM2MyA3Ljk5NSAxMi4xMzVsLjUzMi44NDUtMjUuOTc3IDE0Ljk5Ny0yNC4xMTUtMTMuOTIyIDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTk0LjI4MiAyMjAuODE4bC0uMDU5LS4wMzMtMjQuMjktMTQuMDI0LjE3NS0uMTAxIDc1LjU3Ny00My42MzQuMDU4LjAzMyAyNC4yOSAxNC4wMjQtMjYuMTkxIDE1LjEyMi0uMDQ1LS4wMS0xLjQ2MS0uMzA3Yy02LjU0OS0yLjE3NC0xMy42MTMtMy43MjUtMjEuMDA5LTQuNjE0YTEzLjc0NCAxMy43NDQgMCAwIDAtMS42MzgtLjA5N2MtMy43NTggMC03LjA1NCAxLjUzMS03LjgzNyAzLjY0MmEyLjYyIDIuNjIgMCAwIDAtLjAxIDEuODQ4YzEuNTM1IDQuMjU4IDQuMjE2IDguMzI2IDcuOTY4IDEyLjA5MWwuMDE2LjAyMS41MjYuODM1LjAwNi4wMS4wNjQuMTAyLS4xMDUuMDYxLTI1Ljk3NyAxNC45OTgtLjA1OC4wMzN6bS0yMy44ODEtMTQuMDU3bDIzLjg4MSAxMy43ODggMjQuODAyLTE0LjMyYy41NDYtLjMxNS44NDYtLjQ4OSAxLjAxNy0uNTc1bC0uNDY2LS43NGMtMy43NzEtMy43ODctNi40NjctNy44ODEtOC4wMTMtMTIuMTY4YTIuODUxIDIuODUxIDAgMCAxIC4wMTEtMi4wMDhjLjgxNS0yLjE5OSA0LjIwMy0zLjc5NSA4LjA1Ni0zLjc5NS41NTcgMCAxLjExNy4wMzMgMS42NjYuMDk5IDcuNDEyLjg5MSAxNC40OTEgMi40NDUgMjEuMDQxIDQuNjIxLjgzNi4xNzUgMS4yMTUuMjU0IDEuMzkuMzA0bDI1Ljc4LTE0Ljg4NC0yMy44ODEtMTMuNzg4LTc1LjI4NCA0My40NjZ6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2Ny4yMyAxMjUuOTc5djUwLjg3MWwtMjcuMzIxIDE1Ljc3My02LjQ2MS0xNC4xNjdjLS45MS0xLjk5Ni0zLjQyOC0xLjczOC01LjYyNC41NzRhMTAuMjM4IDEwLjIzOCAwIDAgMC0yLjMzIDQuMDE4bC02LjQ2IDIxLjYyOC0yNy4zMjIgMTUuNzc0di01MC44NzFsNzUuNTE4LTQzLjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNOTEuNzEyIDIyMC41NjdhLjEyNy4xMjcgMCAwIDEtLjA1OS0uMDE2LjExOC4xMTggMCAwIDEtLjA1OC0uMTAxdi01MC44NzFjMC0uMDQyLjAyMy0uMDguMDU4LS4xMDFsNzUuNTE5LTQzLjZhLjExNy4xMTcgMCAwIDEgLjE3NS4xMDF2NTAuODcxYzAgLjA0MS0uMDIzLjA4LS4wNTkuMWwtMjcuMzIxIDE1Ljc3NWEuMTE4LjExOCAwIDAgMS0uMDk0LjAxLjEyLjEyIDAgMCAxLS4wNzEtLjA2M2wtNi40Ni0xNC4xNjhjLS4zNzUtLjgyMi0xLjA2Mi0xLjI3NS0xLjkzNC0xLjI3NS0xLjA4OSAwLTIuMzY0LjY4Ni0zLjUgMS44ODFhMTAuMjA2IDEwLjIwNiAwIDAgMC0yLjMwMiAzLjk3MmwtNi40NiAyMS42MjdhLjExOC4xMTggMCAwIDEtLjA1NC4wNjhMOTEuNzcgMjIwLjU1MWEuMTIuMTIgMCAwIDEtLjA1OC4wMTZ6bS4xMTctNTAuOTJ2NTAuNjAxbDI3LjEwNi0xNS42NSA2LjQ0Ny0yMS41ODNhMTAuMjg2IDEwLjI4NiAwIDAgMSAyLjM1Ny00LjA2NWMxLjE4LTEuMjQyIDIuNTE3LTEuOTU0IDMuNjY5LTEuOTU0Ljk2OSAwIDEuNzMxLjUwMSAyLjE0NiAxLjQxMWw2LjQwNyAxNC4wNTEgMjcuMTUyLTE1LjY3NnYtNTAuNjAxbC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjguNTQzIDEyNi4yMTN2NTAuODdsLTI3LjMyMiAxNS43NzQtNi40Ni0xNC4xNjhjLS45MS0xLjk5NS0zLjQyOC0xLjczOC01LjYyNC41NzRhMTAuMjQ4IDEwLjI0OCAwIDAgMC0yLjMzIDQuMDE5bC02LjQ2MSAyMS42MjctMjcuMzIxIDE1Ljc3NHYtNTAuODdsNzUuNTE4LTQzLjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNOTMuMDI1IDIyMC44YS4xMjMuMTIzIDAgMCAxLS4wNTktLjAxNS4xMi4xMiAwIDAgMS0uMDU4LS4xMDF2LTUwLjg3MWMwLS4wNDIuMDIzLS4wOC4wNTgtLjEwMWw3NS41MTgtNDMuNmEuMTEyLjExMiAwIDAgMSAuMTE3IDBjLjAzNi4wMi4wNTkuMDU5LjA1OS4xdjUwLjg3MWEuMTE2LjExNiAwIDAgMS0uMDU5LjEwMWwtMjcuMzIxIDE1Ljc3NGEuMTExLjExMSAwIDAgMS0uMDk0LjAxLjExNS4xMTUgMCAwIDEtLjA3MS0uMDYybC02LjQ2LTE0LjE2OGMtLjM3NS0uODIzLTEuMDYyLTEuMjc1LTEuOTM1LTEuMjc1LTEuMDg4IDAtMi4zNjMuNjg1LTMuNDk5IDEuODgxYTEwLjE5IDEwLjE5IDAgMCAwLTIuMzAyIDMuOTcxbC02LjQ2MSAyMS42MjhhLjEwOC4xMDggMCAwIDEtLjA1My4wNjdsLTI3LjMyMiAxNS43NzVhLjEyLjEyIDAgMCAxLS4wNTguMDE1em0uMTE3LTUwLjkxOXY1MC42bDI3LjEwNi0xNS42NDkgNi40NDctMjEuNTg0YTEwLjI5MyAxMC4yOTMgMCAwIDEgMi4zNTctNC4wNjVjMS4xNzktMS4yNDEgMi41MTYtMS45NTQgMy42NjgtMS45NTQuOTY5IDAgMS43MzIuNTAyIDIuMTQ3IDEuNDEybDYuNDA3IDE0LjA1MSAyNy4xNTItMTUuNjc2di01MC42MDFsLTc1LjI4NCA0My40NjZ6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2OS44IDE3Ny4wODNsLTI3LjMyMiAxNS43NzQtNi40Ni0xNC4xNjhjLS45MS0xLjk5NS0zLjQyOC0xLjczOC01LjYyNS41NzRhMTAuMjQ2IDEwLjI0NiAwIDAgMC0yLjMyOSA0LjAxOWwtNi40NjEgMjEuNjI3LTI3LjMyMSAxNS43NzR2LTUwLjg3bDc1LjUxOC00My42djUwLjg3eicgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J005NC4yODIgMjIwLjkxN2EuMjM0LjIzNCAwIDAgMS0uMjM0LS4yMzN2LTUwLjg3MWMwLS4wODMuMDQ1LS4xNjEuMTE3LS4yMDJsNzUuNTE4LTQzLjYwMWEuMjM0LjIzNCAwIDEgMSAuMzUuMjAydjUwLjg3MWEuMjMzLjIzMyAwIDAgMS0uMTE2LjIwMmwtMjcuMzIyIDE1Ljc3NWEuMjMyLjIzMiAwIDAgMS0uMzI5LS4xMDZsLTYuNDYxLTE0LjE2OGMtLjM2LS43ODktLjk5Mi0xLjIwNi0xLjgyOC0xLjIwNi0xLjA1NiAwLTIuMzAxLjY3Mi0zLjQxNSAxLjg0NGExMC4wOTkgMTAuMDk5IDAgMCAwLTIuMjc1IDMuOTI0bC02LjQ2IDIxLjYyOGEuMjM1LjIzNSAwIDAgMS0uMTA3LjEzNmwtMjcuMzIyIDE1Ljc3NGEuMjMuMjMgMCAwIDEtLjExNi4wMzF6bS4yMzMtNTAuOTY5djUwLjMzMWwyNi44OTEtMTUuNTI1IDYuNDM0LTIxLjUzOWExMC40MSAxMC40MSAwIDAgMSAyLjM4NC00LjExMmMxLjIwMS0xLjI2NSAyLjU2OS0xLjk5MSAzLjc1My0xLjk5MSAxLjAxOCAwIDEuODE4LjUyNiAyLjI1MyAxLjQ4bDYuMzU0IDEzLjkzNCAyNi45ODItMTUuNTc4di01MC4zMzFsLTc1LjA1MSA0My4zMzF6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTEwOS44OTQgMTk5Ljk0M2MtMS43NzQgMC0zLjI0MS0uNzI1LTQuMjQ0LTIuMTJhLjIyNC4yMjQgMCAwIDEgLjAyMy0uMjk0LjIzMy4yMzMgMCAwIDEgLjMwMS0uMDIzYy43OC41NDcgMS43MDUuODI3IDIuNzUuODI3IDEuMzIzIDAgMi43NTQtLjQzOSA0LjI1Ni0xLjMwNiA1LjMxMS0zLjA2NyA5LjYzMS0xMC41MTggOS42MzEtMTYuNjExIDAtMS45MjctLjQ0Mi0zLjU2LTEuMjc4LTQuNzI0YS4yMzIuMjMyIDAgMCAxIC4zMjMtLjMyN2MxLjY3MSAxLjE3MiAyLjU5MSAzLjM4MSAyLjU5MSA2LjIxOSAwIDYuMjQyLTQuNDI2IDEzLjg2My05Ljg2NSAxNy4wMDMtMS41NzQuOTA4LTMuMDg0IDEuMzU2LTQuNDg4IDEuMzU2em0tMi45NjktMS41NDJjLjgxMy42NTEgMS44Mi44NzcgMi45NjguODc3aC4wMDFjMS4zMjEgMCAyLjc1My0uMzI3IDQuMjU0LTEuMTk0IDUuMzExLTMuMDY3IDkuNjMyLTEwLjQ2MyA5LjYzMi0xNi41NTYgMC0xLjk3OS0uNDYzLTMuNTk5LTEuMzI2LTQuNzYxLjQxMSAxLjAzNS42MjUgMi4yNzUuNjI1IDMuNjM1IDAgNi4yNDMtNC40MjYgMTMuODgzLTkuODY1IDE3LjAyMy0xLjU3NC45MDktMy4wODQgMS4zMTctNC40OSAxLjMxNy0uNjQxIDAtMS4yNDMtLjE0OS0xLjc5OS0uMzQxeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMTMuMDk3IDE5Ny4yM2M1LjM4NC0zLjEwOCA5Ljc0OC0xMC42MzYgOS43NDgtMTYuODE0IDAtMi4wNTEtLjQ4My0zLjY5Mi0xLjMyMy00Ljg2LTEuNzg0LTEuMjUyLTQuMzc0LTEuMTk0LTcuMjU3LjQ3LTUuMzg0IDMuMTA4LTkuNzQ4IDEwLjYzNi05Ljc0OCAxNi44MTQgMCAyLjA1MS40ODMgMy42OTIgMS4zMjMgNC44NiAxLjc4NCAxLjI1MiA0LjM3NCAxLjE5NCA3LjI1Ny0uNDcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTA4LjcyNCAxOTguNjE0Yy0xLjE0MiAwLTIuMTU4LS4yMTMtMy4wMTktLjgxNy0uMDIxLS4wMTQtLjA0LjAxNC0uMDU1LS4wMDctLjg5NC0xLjI0NC0xLjM2Ny0yLjk0OC0xLjM2Ny00Ljk3MyAwLTYuMjQyIDQuNDI2LTEzLjg2NCA5Ljg2NS0xNy4wMDUgMS41NzQtLjkwOCAzLjA4NC0xLjM2MyA0LjQ5LTEuMzYzIDEuMTQyIDAgMi4xNTguMzA5IDMuMDE4LjkxM2EuMjMuMjMgMCAwIDEgLjA1Ni4wNTZjLjg5NCAxLjI0NCAxLjM2NyAyLjk3MiAxLjM2NyA0Ljk5NyAwIDYuMjQzLTQuNDI2IDEzLjc4My05Ljg2NSAxNi45MjMtMS41NzQuOTA5LTMuMDg0IDEuMjc2LTQuNDkgMS4yNzZ6bS0yLjcxOC0xLjEwOWMuNzc0LjUzMiAxLjY4OC43NzYgMi43MTguNzc2IDEuMzIzIDAgMi43NTQtLjQxMyA0LjI1Ni0xLjI4IDUuMzExLTMuMDY2IDkuNjMxLTEwLjUwNSA5LjYzMS0xNi41OTggMC0xLjkwOS0uNDM0LTMuNTIzLTEuMjU1LTQuNjg1LS43NzQtLjUzMy0xLjY4OC0uNzk5LTIuNzE4LS43OTktMS4zMjMgMC0yLjc1NS40NDEtNC4yNTYgMS4zMDgtNS4zMTEgMy4wNjYtOS42MzEgMTAuNTA2LTkuNjMxIDE2LjU5OSAwIDEuOTA5LjQzNCAzLjUxNyAxLjI1NSA0LjY3OXonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ5LjMxOCAxMTQuMjYybC05Ljk4NCA4Ljg3OCAxNS44OTMgMTEuMDMxIDUuNTg5LTYuMTEyLTExLjQ5OC0xMy43OTcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTY5LjY3NiAxMjAuODRsLTkuNzQ4IDUuNjI3Yy0zLjY0MiAyLjEwMy05LjUyOCAyLjExMy0xMy4xNDcuMDI0LTMuNjItMi4wODktMy42MDEtNS40ODguMDQxLTcuNTkxbDkuNDk1LTUuNjA4LTYuNzI5LTMuODg1LTgxLjgzNiA0Ny4wNzEgNDUuOTIzIDI2LjUxNCAzLjA4MS0xLjc3OWMuNjMxLS4zNjUuODY5LS44OTguNjE4LTEuMzktMi4zNTctNC42MzItMi41OTMtOS41NDYtLjY4My0xNC4yNjIgNS42MzgtMTMuOTIgMjQuNTA5LTI0LjgxNSA0OC42MTgtMjguMDcgOC4xNjktMS4xMDMgMTYuNjgtLjk2NyAyNC43MDQuMzk0Ljg1Mi4xNDUgMS43NzYuMDA4IDIuNDA3LS4zNTdsMy4wODEtMS43NzgtMjUuODI1LTE0LjkxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTExMy42NzUgMTgzLjQ1OWEuNDcuNDcgMCAwIDEtLjIzMy0uMDYybC00NS45MjQtMjYuNTE1YS40NjguNDY4IDAgMCAxIC4wMDEtLjgwOWw4MS44MzYtNDcuMDcxYS40NjcuNDY3IDAgMCAxIC40NjYgMGw2LjcyOSAzLjg4NWEuNDY3LjQ2NyAwIDAgMS0uNDY3LjgwOWwtNi40OTYtMy43NS04MC45IDQ2LjUzMyA0NC45ODggMjUuOTczIDIuODQ4LTEuNjQ0Yy4xOTItLjExMS42Mi0uNDA5LjQzNS0uNzczLTIuNDE2LTQuNzQ4LTIuNjU4LTkuODE0LS43LTE0LjY1IDIuODA2LTYuOTI3IDguODg1LTEzLjI0MiAxNy41ODItMTguMjYzIDguNjU3LTQuOTk4IDE5LjUxOC04LjQ4OSAzMS40MDctMTAuMDk0IDguMTk4LTEuMTA3IDE2Ljc5LS45NyAyNC44NDQuMzk3LjczOS4xMjUgMS41NjEuMDA3IDIuMDk1LS4zMDFsMi4zODEtMS4zNzQtMjUuMTI1LTE0LjUwNmEuNDY3LjQ2NyAwIDAgMSAuNDY3LS44MDlsMjUuODI1IDE0LjkxYS40NjcuNDY3IDAgMCAxIDAgLjgwOWwtMy4wODEgMS43NzljLS43MjEuNDE3LTEuNzYzLjU3NS0yLjcxOC40MTMtNy45NjMtMS4zNTEtMTYuNDU3LTEuNDg2LTI0LjU2My0uMzkyLTExLjc3IDEuNTg5LTIyLjUxMiA1LjAzOS0zMS4wNjUgOS45NzctOC41MTQgNC45MTYtMTQuNDU2IDExLjA3My0xNy4xODMgMTcuODA1LTEuODU0IDQuNTc4LTEuNjIzIDkuMzc2LjY2NiAxMy44NzUuMzcuNzI1LjA1NSAxLjUxMy0uOCAyLjAwNmwtMy4wODEgMS43OGEuNDc2LjQ3NiAwIDAgMS0uMjM0LjA2MicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xNTMuMzE2IDEyOC4yNzljLTIuNDEzIDAtNC44MjEtLjUyOC02LjY1Mi0xLjU4Ni0xLjgxOC0xLjA0OS0yLjgyLTIuNDYxLTIuODItMy45NzUgMC0xLjUyNyAxLjAxNi0yLjk1NSAyLjg2MS00LjAybDkuNDkzLTUuNjA3YS4yMzMuMjMzIDAgMSAxIC4yMzguNDAybC05LjQ5NiA1LjYwOWMtMS42OTYuOTc5LTIuNjI4IDIuMjYzLTIuNjI4IDMuNjE2IDAgMS4zNC45MTggMi42MDggMi41ODUgMy41NzEgMy41NDkgMi4wNDkgOS4zNDMgMi4wMzggMTIuOTE0LS4wMjRsOS43NDgtNS42MjhhLjIzNC4yMzQgMCAwIDEgLjIzNC40MDVsLTkuNzQ4IDUuNjI4Yy0xLjg1OCAxLjA3Mi00LjI5NiAxLjYwOS02LjcyOSAxLjYwOScgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMTMuNjc1IDE4Mi45OTJsLTQ1LjkxMy0yNi41MDhNMTEzLjY3NSAxODMuMzQyYS4zNDYuMzQ2IDAgMCAxLS4xNzUtLjA0N2wtNDUuOTEzLTI2LjUwOGEuMzUuMzUgMCAxIDEgLjM1LS42MDdsNDUuOTEzIDI2LjUwOGEuMzUuMzUgMCAwIDEtLjE3NS42NTQnIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNjcuNzYyIDE1Ni40ODR2NTQuMDAxYzAgMS4wOS43NyAyLjQxOCAxLjcyIDIuOTY3bDQyLjQ3MyAyNC41MjFjLjk1LjU0OSAxLjcyLjExIDEuNzItLjk4di01NC4wMDEnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTEyLjcyNyAyMzguNTYxYy0uMjk3IDAtLjYyLS4wOTUtLjk0Ny0uMjg1bC00Mi40NzMtMjQuNTIxYy0xLjA2My0uNjEzLTEuODk1LTIuMDUtMS44OTUtMy4yN3YtNTQuMDAxYS4zNS4zNSAwIDEgMSAuNzAxIDB2NTQuMDAxYzAgLjk2LjcwNyAyLjE4IDEuNTQ0IDIuNjYzbDQyLjQ3MyAyNC41MjJjLjM0NC4xOTguNjYxLjI0My44Ny4xMjIuMjA2LS4xMTkuMzI1LS40MTEuMzI1LS43OTl2LTU0LjAwMWEuMzUuMzUgMCAxIDEgLjcgMHY1NC4wMDFjMCAuNjU1LS4yMzkgMS4xNTQtLjY3NSAxLjQwNmExLjIzNSAxLjIzNSAwIDAgMS0uNjIzLjE2MicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xMTIuODYgMTQ3LjUxMmgtLjAwMWMtMi4zMTggMC00LjQ5OS0uNTIyLTYuMTQyLTEuNDcxLTEuNzA1LS45ODQtMi42NDMtMi4zMTUtMi42NDMtMy43NDkgMC0xLjQ0NS45NTItMi43OTEgMi42OC0zLjc4OGwxMi4wNDEtNi45NTNjMS42NjgtLjk2MiAzLjg3NC0xLjQ5MyA2LjIxMi0xLjQ5MyAyLjMxOCAwIDQuNDk5LjUyMyA2LjE0MyAxLjQ3MiAxLjcwNC45ODQgMi42NDMgMi4zMTUgMi42NDMgMy43NDggMCAxLjQ0Ni0uOTUyIDIuNzkxLTIuNjggMy43ODlsLTEyLjA0MiA2Ljk1MmMtMS42NjguOTYzLTMuODc0IDEuNDkzLTYuMjExIDEuNDkzem0xMi4xNDctMTYuNzUzYy0yLjIxNyAwLTQuMjk4LjQ5Ny01Ljg2MSAxLjM5OWwtMTIuMDQyIDYuOTUyYy0xLjUwMi44NjgtMi4zMyAxLjk5OC0yLjMzIDMuMTgyIDAgMS4xNzMuODE1IDIuMjg5IDIuMjkzIDMuMTQyIDEuNTM4Ljg4OSAzLjU5NiAxLjM3OCA1Ljc5MiAxLjM3OGguMDAxYzIuMjE2IDAgNC4yOTgtLjQ5NyA1Ljg2MS0xLjM5OWwxMi4wNDEtNi45NTNjMS41MDItLjg2NyAyLjMzLTEuOTk3IDIuMzMtMy4xODIgMC0xLjE3Mi0uODE0LTIuMjg4LTIuMjkyLTMuMTQyLTEuNTM5LS44ODgtMy41OTYtMS4zNzctNS43OTMtMS4zNzd6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2NS42MyAxMjMuMjE5bC01LjczNCAzLjMxMWMtMy4xNjcgMS44MjgtOC4yODYgMS44MzctMTEuNDMzLjAyLTMuMTQ3LTEuODE3LTMuMTMxLTQuNzcyLjAzNi02LjYwMWw1LjczNC0zLjMxIDExLjM5NyA2LjU4JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE1NC4yMzMgMTE3LjQ0OGw5Ljk5NSA1Ljc3MS00LjY4MiAyLjcwNGMtMS40MzQuODI3LTMuMzUyIDEuMjgzLTUuMzk5IDEuMjgzLTIuMDI5IDAtMy45MjMtLjQ0OS01LjMzMy0xLjI2My0xLjI5LS43NDQtMi0xLjY5NC0yLTIuNjc0IDAtLjk5MS43MjMtMS45NTUgMi4wMzYtMi43MTNsNS4zODMtMy4xMDhtMC0uODA5bC01LjczNCAzLjMxYy0zLjE2NyAxLjgyOS0zLjE4MyA0Ljc4NC0uMDM2IDYuNjAxIDEuNTY4LjkwNSAzLjYyMyAxLjM1NyA1LjY4NCAxLjM1NyAyLjA3NyAwIDQuMTU5LS40NiA1Ljc0OS0xLjM3N2w1LjczNC0zLjMxMS0xMS4zOTctNi41OE0xNDUuNDQ1IDE3OS42NjdjLTEuNzczIDAtMy4yNDEtLjg1LTQuMjQzLTIuMjQ1LS4wNjctLjA5Mi0uMDU3LS4yNzUuMDIzLS4zNTYuMDgtLjA4MS4yMDctLjEyLjMtLjA1NS43ODEuNTQ4IDEuNzA2LjgxMiAyLjc1MS44MTEgMS4zMjIgMCAyLjc1NC0uNDQ2IDQuMjU2LTEuMzEzIDUuMzEtMy4wNjYgOS42MzEtMTAuNTIyIDkuNjMxLTE2LjYxNSAwLTEuOTI3LS40NDItMy41NjItMS4yNzktNC43MjZhLjIzNS4yMzUgMCAwIDEgLjAyNC0uMzAxLjIzMi4yMzIgMCAwIDEgLjMtLjAyN2MxLjY3IDEuMTcyIDIuNTkgMy4zOCAyLjU5IDYuMjE5IDAgNi4yNDItNC40MjUgMTMuOTg3LTkuODY1IDE3LjEyNy0xLjU3My45MDgtMy4wODMgMS40ODEtNC40ODggMS40ODF6TTE0Mi40NzYgMTc4Yy44MTQuNjUxIDEuODIgMS4wMDIgMi45NjkgMS4wMDIgMS4zMjIgMCAyLjc1My0uNDUyIDQuMjU1LTEuMzIgNS4zMS0zLjA2NSA5LjYzMS0xMC41MjMgOS42MzEtMTYuNjE3IDAtMS45OC0uNDYzLTMuNjMtMS4zMjUtNC43OTMuNDExIDEuMDM1LjYyNCAyLjI2LjYyNCAzLjYyIDAgNi4yNDItNC40MjUgMTMuODc1LTkuODY1IDE3LjAxNS0xLjU3My45MDktMy4wODQgMS4zNzYtNC40ODkgMS4zNzZhNS40OSA1LjQ5IDAgMCAxLTEuOC0uMjgzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDguNjQ4IDE3Ni43MDRjNS4zODQtMy4xMDggOS43NDgtMTAuNjM2IDkuNzQ4LTE2LjgxMyAwLTIuMDUyLS40ODMtMy42OTMtMS4zMjItNC44NjEtMS43ODUtMS4yNTItNC4zNzUtMS4xOTQtNy4yNTguNDcxLTUuMzgzIDMuMTA4LTkuNzQ4IDEwLjYzNi05Ljc0OCAxNi44MTMgMCAyLjA1MS40ODQgMy42OTIgMS4zMjMgNC44NiAxLjc4NSAxLjI1MyA0LjM3NCAxLjE5NSA3LjI1Ny0uNDcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTQ0LjI3NiAxNzguMjc2Yy0xLjE0MyAwLTIuMTU4LS4zMDctMy4wMTktLjkxMWEuMjE3LjIxNyAwIDAgMS0uMDU1LS4wNTRjLS44OTUtMS4yNDQtMS4zNjctMi45NzItMS4zNjctNC45OTcgMC02LjI0MSA0LjQyNS0xMy44NzUgOS44NjUtMTcuMDE2IDEuNTczLS45MDggMy4wODQtMS4zNjkgNC40ODktMS4zNjkgMS4xNDMgMCAyLjE1OC4zMDcgMy4wMTkuOTFhLjI0LjI0IDAgMCAxIC4wNTUuMDU1Yy44OTQgMS4yNDQgMS4zNjcgMi45NzEgMS4zNjcgNC45OTcgMCA2LjI0MS00LjQyNSAxMy44NzUtOS44NjUgMTcuMDE2LTEuNTczLjkwOC0zLjA4NCAxLjM2OS00LjQ4OSAxLjM2OXptLTIuNzE4LTEuMTcyYy43NzMuNTMzIDEuNjg3LjkwMSAyLjcxOC45MDEgMS4zMjIgMCAyLjc1NC0uNTM4IDQuMjU2LTEuNDA1IDUuMzEtMy4wNjYgOS42MzEtMTAuNTY3IDkuNjMxLTE2LjY2MSAwLTEuOTA4LS40MzQtMy41NTQtMS4yNTYtNC43MTYtLjc3NC0uNTMyLTEuNjg4LS44MTQtMi43MTgtLjgxNC0xLjMyMiAwLTIuNzU0LjQzMy00LjI1NiAxLjMtNS4zMSAzLjA2Ni05LjYzMSAxMC41NjQtOS42MzEgMTYuNjU3IDAgMS45MS40MzQgMy41NzYgMS4yNTYgNC43Mzh6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE1MC43MiAxNzIuMzYxbC0uMzYzLS4yOTVhMjQuMTA1IDI0LjEwNSAwIDAgMCAyLjE0OC0zLjEyOCAyNC4wNSAyNC4wNSAwIDAgMCAxLjk3Ny00LjM3NWwuNDQzLjE0OWEyNC41NCAyNC41NCAwIDAgMS0yLjAxNSA0LjQ2IDI0LjYxIDI0LjYxIDAgMCAxLTIuMTkgMy4xODlNMTE1LjkxNyAxOTEuNTE0bC0uMzYzLS4yOTRhMjQuMTc0IDI0LjE3NCAwIDAgMCAyLjE0OC0zLjEyOCAyNC4wMzggMjQuMDM4IDAgMCAwIDEuOTc2LTQuMzc1bC40NDMuMTQ4YTI0LjQ4IDI0LjQ4IDAgMCAxLTIuMDE1IDQuNDYxIDI0LjY2MiAyNC42NjIgMCAwIDEtMi4xODkgMy4xODhNMTE0IDIzNy40NzZWMTgyLjU4NCAyMzcuNDc2JyBmaWxsPScjNjA3RDhCJy8+PGc+PHBhdGggZD0nTTgxLjgyMiAzNy40NzRjLjAxNy0uMTM1LS4wNzUtLjI4LS4yNjctLjM5Mi0uMzI3LS4xODgtLjgyNi0uMjEtMS4xMDktLjA0NWwtNi4wMTIgMy40NzFjLS4xMzEuMDc2LS4xOTQuMTc4LS4xOTEuMjg1LjAwMi4xMzIuMDAyLjQ2MS4wMDIuNTc4di4wNDNsLS4wMDcuMTI4LTYuNTkxIDMuNzc5Yy0uMDAxIDAtMi4wNzcgMS4wNDYtMi43ODcgNS4xOTIgMCAwLS45MTIgNi45NjEtLjg5OCAxOS43NDUuMDE1IDEyLjU3LjYwNiAxNy4wNyAxLjE2NyAyMS4zNTEuMjIgMS42ODQgMy4wMDEgMi4xMjUgMy4wMDEgMi4xMjUuMzMxLjA0LjY5OC0uMDI3IDEuMDgtLjI0OGw3NS4yNzMtNDMuNTUxYzEuODA4LTEuMDY5IDIuNjY3LTMuNzE5IDMuMDU2LTYuMjg0IDEuMjEzLTcuOTkgMS42NzUtMzIuOTc4LS4yNzUtMzkuODc4LS4xOTYtLjY5My0uNTEtMS4wODMtLjg2OC0xLjI4MmwtMi4wODYtLjc5Yy0uNzI3LjAyOC0xLjQxNi40NjctMS41MzQuNTM1TDgyLjAzMiAzNy4wNzJsLS4yMS40MDInIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNMTQ0LjMxMSAxLjcwMWwyLjA4NS43OWMuMzU4LjE5OS42NzIuNTg5Ljg2OCAxLjI4MiAxLjk0OSA2LjkgMS40ODcgMzEuODg3LjI3NSAzOS44NzgtLjM5IDIuNTY1LTEuMjQ5IDUuMjE1LTMuMDU2IDYuMjg0TDY5LjIxIDkzLjQ4NmExLjc4IDEuNzggMCAwIDEtLjg5Ni4yNThsLS4xODMtLjAxMWMwIC4wMDEtMi43ODItLjQ0LTMuMDAzLTIuMTI0LS41Ni00LjI4Mi0xLjE1MS04Ljc4MS0xLjE2NS0yMS4zNTEtLjAxNS0xMi43ODQuODk3LTE5Ljc0NS44OTctMTkuNzQ1LjcxLTQuMTQ2IDIuNzg3LTUuMTkyIDIuNzg3LTUuMTkybDYuNTkxLTMuNzc5LjAwNy0uMTI4di0uMDQzYzAtLjExNyAwLS40NDYtLjAwMi0uNTc4LS4wMDMtLjEwNy4wNTktLjIxLjE5MS0uMjg1bDYuMDEyLTMuNDcyYS45OC45OCAwIDAgMSAuNDgxLS4xMWMuMjE4IDAgLjQ0OS4wNTMuNjI3LjE1Ni4xOTMuMTEyLjI4NS4yNTguMjY4LjM5MmwuMjExLS40MDIgNjAuNzQ0LTM0LjgzNmMuMTE3LS4wNjguODA2LS41MDcgMS41MzQtLjUzNW0wLS45OTdsLS4wMzkuMDAxYy0uNjE4LjAyMy0xLjI4My4yNDQtMS45NzQuNjU2bC0uMDIxLjAxMi02MC41MTkgMzQuNzA2YTIuMzU4IDIuMzU4IDAgMCAwLS44MzEtLjE1Yy0uMzY1IDAtLjcwNC4wODQtLjk4LjI0NGwtNi4wMTIgMy40NzFjLS40NDIuMjU1LS42OTkuNjktLjY4OSAxLjE2NmwuMDAxLjE1LTYuMDggMy40ODdjLS4zNzMuMTk5LTIuNTQyIDEuNTMxLTMuMjkgNS44OThsLS4wMDYuMDM5Yy0uMDA5LjA3LS45MiA3LjE3My0uOTA2IDE5Ljg3NS4wMTQgMTIuNjIuNjAzIDE3LjExNiAxLjE3MiAyMS40NjVsLjAwMi4wMTVjLjMwOCAyLjM1NSAzLjQ3NSAyLjkyMyAzLjgzNiAyLjk4bC4wMzQuMDA0Yy4xMDEuMDEzLjIwNC4wMTkuMzA1LjAxOWEyLjc3IDIuNzcgMCAwIDAgMS4zOTYtLjM5Mmw3NS4yNzMtNDMuNTUyYzEuODExLTEuMDcxIDIuOTk5LTMuNDIzIDMuNTQyLTYuOTk3IDEuMTg2LTcuODE0IDEuNzM0LTMzLjA5Ni0uMzAxLTQwLjI5OS0uMjUzLS44OTMtLjcwNC0xLjUyNy0xLjM0My0xLjg4MmwtLjEzMi0uMDYyLTIuMDg1LS43ODlhLjk3My45NzMgMCAwIDAtLjM1My0uMDY1JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTEyOC4yNjcgMTEuNTY1bDEuNDk1LjQzNC01Ni4zMzkgMzIuMzI2JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTc0LjIwMiA5MC41NDVhLjUuNSAwIDAgMS0uMjUtLjkzMWwxOC40MzctMTAuNjQ1YS40OTkuNDk5IDAgMSAxIC40OTkuODY0TDc0LjQ1MSA5MC40NzhsLS4yNDkuMDY3TTc1Ljc2NCA0Mi42NTRsLS4xMDgtLjA2Mi4wNDYtLjE3MSA1LjEzNS0yLjk2NC4xNy4wNDUtLjA0NS4xNzEtNS4xMzUgMi45NjQtLjA2My4wMTdNNzAuNTIgOTAuMzc1VjQ2LjQyMWwuMDYzLS4wMzZMMTM3Ljg0IDcuNTU0djQzLjk1NGwtLjA2Mi4wMzZMNzAuNTIgOTAuMzc1em0uMjUtNDMuODExdjQzLjM4bDY2LjgyMS0zOC41NzlWNy45ODVMNzAuNzcgNDYuNTY0eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J004Ni45ODYgODMuMTgyYy0uMjMuMTQ5LS42MTIuMzg0LS44NDkuNTIzbC0xMS41MDUgNi43MDFjLS4yMzcuMTM5LS4yMDYuMjUyLjA2OC4yNTJoLjU2NWMuMjc1IDAgLjY5My0uMTEzLjkzLS4yNTJMODcuNyA4My43MDVjLjIzNy0uMTM5LjQyOC0uMjUzLjQyNS0uMjU2YTExLjI5IDExLjI5IDAgMCAxLS4wMDYtLjUwM2MwLS4yNzQtLjE4OC0uMzc3LS40MTgtLjIyN2wtLjcxNS40NjMnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNzUuMjY2IDkwLjc4Mkg3NC43Yy0uMiAwLS4zMTYtLjA1Ni0uMzQ2LS4xNjYtLjAzLS4xMS4wNDMtLjIxNy4yMTUtLjMxN2wxMS41MDUtNi43MDJjLjIzNi0uMTM4LjYxNS0uMzcxLjg0NC0uNTE5bC43MTUtLjQ2NGEuNDg4LjQ4OCAwIDAgMSAuMjY2LS4wODljLjE3MiAwIC4zNDUuMTMuMzQ1LjQyMSAwIC4yMTQuMDAxLjM2My4wMDMuNDM3bC4wMDYuMDA0LS4wMDQuMDY5Yy0uMDAzLjA3NS0uMDAzLjA3NS0uNDg2LjM1NmwtMTEuNTA1IDYuNzAyYTIuMjgyIDIuMjgyIDAgMCAxLS45OTIuMjY4em0tLjYtLjI1bC4wMzQuMDAxaC41NjZjLjI1MiAwIC42NDktLjEwOC44NjYtLjIzNGwxMS41MDUtNi43MDJjLjE2OC0uMDk4LjI5NC0uMTczLjM2MS0uMjE0LS4wMDQtLjA4NC0uMDA0LS4yMTgtLjAwNC0uNDM3bC0uMDk1LS4xNzEtLjEzMS4wNDktLjcxNC40NjNjLS4yMzIuMTUtLjYxNi4zODYtLjg1NC41MjVsLTExLjUwNSA2LjcwMi0uMDI5LjAxOHonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNzUuMjY2IDg5Ljg3MUg3NC43Yy0uMiAwLS4zMTYtLjA1Ni0uMzQ2LS4xNjYtLjAzLS4xMS4wNDMtLjIxNy4yMTUtLjMxN2wxMS41MDUtNi43MDJjLjI1OC0uMTUxLjY5NC0uMjY4Ljk5My0uMjY4aC41NjVjLjIgMCAuMzE2LjA1Ni4zNDYuMTY2LjAzLjExLS4wNDMuMjE3LS4yMTUuMzE3bC0xMS41MDUgNi43MDJhMi4yODIgMi4yODIgMCAwIDEtLjk5Mi4yNjh6bS0uNi0uMjVsLjAzNC4wMDFoLjU2NmMuMjUyIDAgLjY0OS0uMTA3Ljg2Ni0uMjM0bDExLjUwNS02LjcwMi4wMy0uMDE4LS4wMzUtLjAwMWgtLjU2NWMtLjI1MiAwLS42NDkuMTA4LS44NjcuMjM0bC0xMS41MDUgNi43MDItLjAyOS4wMTh6TTc0LjM3IDkwLjgwMXYtMS4yNDcgMS4yNDcnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNjguMTMgOTMuOTAxYy0uNzUxLS4wOTMtMS4zMTQtLjczNy0xLjQzOS0xLjM3Ni0uODMxLTQuMjM4LTEuMTUxLTguNzgyLTEuMTY1LTIxLjM1Mi0uMDE1LTEyLjc4NC44OTctMTkuNzQ1Ljg5Ny0xOS43NDUuNzExLTQuMTQ2IDIuNzg3LTUuMTkyIDIuNzg3LTUuMTkybDc0Ljg1OS00My4yMTljLjIyMy0uMTI5IDIuNDg3LTEuNTg0IDMuMTk1LjkyMyAxLjk1IDYuOSAxLjQ4OCAzMS44ODcuMjc1IDM5Ljg3OC0uMzg5IDIuNTY1LTEuMjQ4IDUuMjE1LTMuMDU2IDYuMjgzTDY5LjIxIDkzLjY1M2MtLjM4Mi4yMjEtLjc0OS4yODgtMS4wOC4yNDggMCAwLTIuNzgxLS40NDEtMy4wMDEtMi4xMjUtLjU2MS00LjI4MS0xLjE1Mi04Ljc4MS0xLjE2Ny0yMS4zNTEtLjAxNC0xMi43ODQuODk4LTE5Ljc0NS44OTgtMTkuNzQ1LjcxLTQuMTQ2IDIuNzg3LTUuMTkxIDIuNzg3LTUuMTkxbDYuNTk4LTMuODEuODcxLS4xMTkgNi41OTktMy44My4wNDYtLjQ2MUw2OC4xMyA5My45MDEnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNNjguMzE3IDk0LjE2MWwtLjIxNS0uMDEzaC0uMDAxbC0uMjQ0LS4wNDdjLS43MTktLjE1Ni0yLjc3Mi0uNzM2LTIuOTc2LTIuMjkyLS41NjgtNC4zNC0xLjE1NC04LjgxMy0xLjE2OC0yMS4zODQtLjAxNC0xMi42NTQuODkxLTE5LjcwNy45LTE5Ljc3Ny43MjUtNC4yMzEgMi44MzItNS4zMzggMi45MjItNS4zODJsNi42MjgtMy44MjcuODctLjExOSA2LjQ0Ni0zLjc0Mi4wMzQtLjMzNGEuMjQ4LjI0OCAwIDAgMSAuMjczLS4yMjMuMjQ4LjI0OCAwIDAgMSAuMjIzLjI3MmwtLjA1OS41ODktNi43NTIgMy45MTktLjg3LjExOC02LjU1NiAzLjc4NWMtLjAzMS4wMTYtMS45OSAxLjA2OC0yLjY2NiA1LjAxOC0uMDA3LjA2LS45MDggNy4wODYtLjg5NCAxOS43MDIuMDE0IDEyLjUzOS41OTcgMTYuOTk2IDEuMTYxIDIxLjMwNS4wOTEuNjkxLjY4OSAxLjE1NCAxLjMwOSAxLjQ1MmExLjk1IDEuOTUgMCAwIDEtLjIzNi0uNjA5Yy0uNzgxLTMuOTg0LTEuMTU1LTguMjAyLTEuMTctMjEuMzk5LS4wMTQtMTIuNjUzLjg5MS0xOS43MDcuOS0xOS43NzcuNzI1LTQuMjMxIDIuODMyLTUuMzM3IDIuOTIyLTUuMzgyLS4wMDQuMDAxIDc0LjQ0NC00Mi45OCA3NC44NDYtNDMuMjEybC4wMjgtLjAxN2MuOTA0LS41MzggMS43Mi0uNjg4IDIuMzYtLjQzMy41NTUuMjIxLjk0OS43MzMgMS4xNzIgMS41MiAyLjAxNCA3LjEyOCAxLjQ2IDMyLjIxOS4yODEgMzkuOTgzLS41MDcgMy4zNDEtMS41NzUgNS41MTUtMy4xNzUgNi40NjJMNjkuMzM1IDkzLjg2OWEyLjAyMyAyLjAyMyAwIDAgMS0xLjAxOC4yOTJ6bS0uMTQ3LS41MDdjLjI5My4wMzYuNjA0LS4wMzcuOTE1LS4yMTdsNzUuMjczLTQzLjU1MWMxLjgyMy0xLjA3OCAyLjYwMi0zLjkxNSAyLjkzNC02LjEwNiAxLjE3NC03LjczMSAxLjczMS0zMi42OTUtLjI2OC0zOS43NzItLjE3OC0uNjMxLS40NzMtMS4wMzItLjg3Ni0xLjE5Mi0uNDg0LS4xOTMtMS4xNjYtLjA1Mi0xLjkyMS4zOTdsLS4wMzQuMDIxLTc0Ljg1OCA0My4yMThjLS4wMzEuMDE3LTEuOTg5IDEuMDY5LTIuNjY2IDUuMDE5LS4wMDcuMDU5LS45MDggNy4wODUtLjg5NCAxOS43MDIuMDE1IDEzLjE1NS4zODYgMTcuMzUxIDEuMTYxIDIxLjMwMy4wOS40NjEuNDc2Ljk4MyAxLjAzNyAxLjEzOS4xMTQuMDI1LjE4NS4wMzcuMTk2LjAzOWguMDAxeicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J002OS4zMTcgNjguOTgyYy40ODktLjI4MS44ODUtLjA1Ni44ODUuNTA1IDAgLjU2LS4zOTYgMS4yNDMtLjg4NSAxLjUyNS0uNDg4LjI4Mi0uODg0LjA1Ny0uODg0LS41MDQgMC0uNTYuMzk2LTEuMjQzLjg4NC0xLjUyNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OC45MiA3MS4xMzNjLS4yODkgMC0uNDg3LS4yMjgtLjQ4Ny0uNjI1IDAtLjU2LjM5Ni0xLjI0My44ODQtMS41MjZhLjgxMi44MTIgMCAwIDEgLjM5Ny0uMTIxYy4yODkgMCAuNDg4LjIyOS40ODguNjI2IDAgLjU2LS4zOTYgMS4yNDMtLjg4NSAxLjUyNWEuODEyLjgxMiAwIDAgMS0uMzk3LjEyMW0uNzk0LTIuNDU5YS45NzYuOTc2IDAgMCAwLS40OS4xNDdjLS41NDguMzE3LS45NzggMS4wNTgtLjk3OCAxLjY4NyAwIC40ODYuMjcxLjgxMi42NzQuODEyYS45ODUuOTg1IDAgMCAwIC40OTEtLjE0NmMuNTQ4LS4zMTcuOTc4LTEuMDU3Ljk3OC0xLjY4NyAwLS40ODYtLjI3Mi0uODEzLS42NzUtLjgxMycgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OC45MiA3MC45NDdjLS4yNzEgMC0uMjk5LS4zMDctLjI5OS0uNDM5IDAtLjQ5MS4zNjEtMS4xMTYuNzktMS4zNjNhLjYzMi42MzIgMCAwIDEgLjMwMy0uMDk2Yy4yNzIgMCAuMzAxLjMwNi4zMDEuNDM4IDAgLjQ5MS0uMzYzIDEuMTE2LS43OTEgMS4zNjRhLjYyOS42MjkgMCAwIDEtLjMwNC4wOTZtLjc5NC0yLjA4NmEuODEyLjgxMiAwIDAgMC0uMzk3LjEyMWMtLjQ4OC4yODMtLjg4NC45NjYtLjg4NCAxLjUyNiAwIC4zOTcuMTk4LjYyNS40ODcuNjI1YS44MTIuODEyIDAgMCAwIC4zOTctLjEyMWMuNDg5LS4yODIuODg1LS45NjUuODg1LTEuNTI1IDAtLjM5Ny0uMTk5LS42MjYtLjQ4OC0uNjI2JyBmaWxsPScjODA5N0EyJy8+PHBhdGggZD0nTTY5LjQ0NCA4NS4zNWMuMjY0LS4xNTIuNDc3LS4wMzEuNDc3LjI3MiAwIC4zMDMtLjIxMy42Ny0uNDc3LjgyMi0uMjYzLjE1My0uNDc3LjAzMS0uNDc3LS4yNzEgMC0uMzAyLjIxNC0uNjcxLjQ3Ny0uODIzJyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTY5LjIzIDg2LjUxYy0uMTU2IDAtLjI2My0uMTIzLS4yNjMtLjMzNyAwLS4zMDIuMjE0LS42NzEuNDc3LS44MjNhLjQzMS40MzEgMCAwIDEgLjIxNC0uMDY2Yy4xNTYgMCAuMjYzLjEyNC4yNjMuMzM4IDAgLjMwMy0uMjEzLjY3LS40NzcuODIyYS40MzEuNDMxIDAgMCAxLS4yMTQuMDY2bS40MjgtMS40MTJjLS4xIDAtLjIwMy4wMjktLjMwNy4wOS0uMzIuMTg1LS41Ny42MTgtLjU3Ljk4NSAwIC4zMDkuMTg1LjUyNC40NDkuNTI0YS42My42MyAwIDAgMCAuMzA4LS4wOWMuMzItLjE4NS41Ny0uNjE4LjU3LS45ODUgMC0uMzA5LS4xODUtLjUyNC0uNDUtLjUyNCcgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OS4yMyA4Ni4zMjJsLS4wNzYtLjE0OWMwLS4yMzUuMTc5LS41NDQuMzg0LS42NjFsLjEyLS4wNDEuMDc2LjE1MWMwIC4yMzQtLjE3OS41NDItLjM4My42NmwtLjEyMS4wNG0uNDI4LTEuMDM4YS40MzEuNDMxIDAgMCAwLS4yMTQuMDY2Yy0uMjYzLjE1Mi0uNDc3LjUyMS0uNDc3LjgyMyAwIC4yMTQuMTA3LjMzNy4yNjMuMzM3YS40MzEuNDMxIDAgMCAwIC4yMTQtLjA2NmMuMjY0LS4xNTIuNDc3LS41MTkuNDc3LS44MjIgMC0uMjE0LS4xMDctLjMzOC0uMjYzLS4zMzgnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNMTM5LjI3OCA3Ljc2OXY0My42NjdMNzIuMjA4IDkwLjE2VjQ2LjQ5M2w2Ny4wNy0zOC43MjQnIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNzIuMDgzIDkwLjM3NVY0Ni40MjFsLjA2My0uMDM2IDY3LjI1Ny0zOC44MzF2NDMuOTU0bC0uMDYyLjAzNi02Ny4yNTggMzguODMxem0uMjUtNDMuODExdjQzLjM4bDY2LjgyMS0zOC41NzlWNy45ODVMNzIuMzMzIDQ2LjU2NHonIGZpbGw9JyM2MDdEOEInLz48L2c+PHBhdGggZD0nTTEyNS43MzcgODguNjQ3bC03LjYzOSAzLjMzNFY4NGwtMTEuNDU5IDQuNzEzdjguMjY5TDk5IDEwMC4zMTVsMTMuMzY5IDMuNjQ2IDEzLjM2OC0xNS4zMTQnIGZpbGw9JyM0NTVBNjQnLz48L2c+PC9zdmc+IjsKZnVuY3Rpb24gUm90YXRlSW5zdHJ1Y3Rpb25zKCkgewogIHRoaXMubG9hZEljb25fKCk7CiAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICB2YXIgcyA9IG92ZXJsYXkuc3R5bGU7CiAgcy5wb3NpdGlvbiA9ICdmaXhlZCc7CiAgcy50b3AgPSAwOwogIHMucmlnaHQgPSAwOwogIHMuYm90dG9tID0gMDsKICBzLmxlZnQgPSAwOwogIHMuYmFja2dyb3VuZENvbG9yID0gJ2dyYXknOwogIHMuZm9udEZhbWlseSA9ICdzYW5zLXNlcmlmJzsKICBzLnpJbmRleCA9IDEwMDAwMDA7CiAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogIGltZy5zcmMgPSB0aGlzLmljb247CiAgdmFyIHMgPSBpbWcuc3R5bGU7CiAgcy5tYXJnaW5MZWZ0ID0gJzI1JSc7CiAgcy5tYXJnaW5Ub3AgPSAnMjUlJzsKICBzLndpZHRoID0gJzUwJSc7CiAgb3ZlcmxheS5hcHBlbmRDaGlsZChpbWcpOwogIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgdmFyIHMgPSB0ZXh0LnN0eWxlOwogIHMudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgcy5mb250U2l6ZSA9ICcxNnB4JzsKICBzLmxpbmVIZWlnaHQgPSAnMjRweCc7CiAgcy5tYXJnaW4gPSAnMjRweCAyNSUnOwogIHMud2lkdGggPSAnNTAlJzsKICB0ZXh0LmlubmVySFRNTCA9ICdQbGFjZSB5b3VyIHBob25lIGludG8geW91ciBDYXJkYm9hcmQgdmlld2VyLic7CiAgb3ZlcmxheS5hcHBlbmRDaGlsZCh0ZXh0KTsKICB2YXIgc25hY2tiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICB2YXIgcyA9IHNuYWNrYmFyLnN0eWxlOwogIHMuYmFja2dyb3VuZENvbG9yID0gJyNDRkQ4REMnOwogIHMucG9zaXRpb24gPSAnZml4ZWQnOwogIHMuYm90dG9tID0gMDsKICBzLndpZHRoID0gJzEwMCUnOwogIHMuaGVpZ2h0ID0gJzQ4cHgnOwogIHMucGFkZGluZyA9ICcxNHB4IDI0cHgnOwogIHMuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnOwogIHMuY29sb3IgPSAnIzY1NkE2Qic7CiAgb3ZlcmxheS5hcHBlbmRDaGlsZChzbmFja2Jhcik7CiAgdmFyIHNuYWNrYmFyVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHNuYWNrYmFyVGV4dC5zdHlsZS5mbG9hdCA9ICdsZWZ0JzsKICBzbmFja2JhclRleHQuaW5uZXJIVE1MID0gJ05vIENhcmRib2FyZCB2aWV3ZXI/JzsKICB2YXIgc25hY2tiYXJCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgc25hY2tiYXJCdXR0b24uaHJlZiA9ICdodHRwczovL3d3dy5nb29nbGUuY29tL2dldC9jYXJkYm9hcmQvZ2V0LWNhcmRib2FyZC8nOwogIHNuYWNrYmFyQnV0dG9uLmlubmVySFRNTCA9ICdnZXQgb25lJzsKICBzbmFja2JhckJ1dHRvbi50YXJnZXQgPSAnX2JsYW5rJzsKICB2YXIgcyA9IHNuYWNrYmFyQnV0dG9uLnN0eWxlOwogIHMuZmxvYXQgPSAncmlnaHQnOwogIHMuZm9udFdlaWdodCA9IDYwMDsKICBzLnRleHRUcmFuc2Zvcm0gPSAndXBwZXJjYXNlJzsKICBzLmJvcmRlckxlZnQgPSAnMXB4IHNvbGlkIGdyYXknOwogIHMucGFkZGluZ0xlZnQgPSAnMjRweCc7CiAgcy50ZXh0RGVjb3JhdGlvbiA9ICdub25lJzsKICBzLmNvbG9yID0gJyM2NTZBNkInOwogIHNuYWNrYmFyLmFwcGVuZENoaWxkKHNuYWNrYmFyVGV4dCk7CiAgc25hY2tiYXIuYXBwZW5kQ2hpbGQoc25hY2tiYXJCdXR0b24pOwogIHRoaXMub3ZlcmxheSA9IG92ZXJsYXk7CiAgdGhpcy50ZXh0ID0gdGV4dDsKICB0aGlzLmhpZGUoKTsKfQpSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAocGFyZW50KSB7CiAgaWYgKCFwYXJlbnQgJiYgIXRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50KSB7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7CiAgfSBlbHNlIGlmIChwYXJlbnQpIHsKICAgIGlmICh0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCAmJiB0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCAhPSBwYXJlbnQpIHRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMub3ZlcmxheSk7CiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5vdmVybGF5KTsKICB9CiAgdGhpcy5vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIHZhciBpbWcgPSB0aGlzLm92ZXJsYXkucXVlcnlTZWxlY3RvcignaW1nJyk7CiAgdmFyIHMgPSBpbWcuc3R5bGU7CiAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpKSB7CiAgICBzLndpZHRoID0gJzIwJSc7CiAgICBzLm1hcmdpbkxlZnQgPSAnNDAlJzsKICAgIHMubWFyZ2luVG9wID0gJzMlJzsKICB9IGVsc2UgewogICAgcy53aWR0aCA9ICc1MCUnOwogICAgcy5tYXJnaW5MZWZ0ID0gJzI1JSc7CiAgICBzLm1hcmdpblRvcCA9ICcyNSUnOwogIH0KfTsKUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogIHRoaXMub3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9OwpSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLnNob3dUZW1wb3JhcmlseSA9IGZ1bmN0aW9uIChtcywgcGFyZW50KSB7CiAgdGhpcy5zaG93KHBhcmVudCk7CiAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQodGhpcy5oaWRlLmJpbmQodGhpcyksIG1zKTsKfTsKUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5kaXNhYmxlU2hvd1RlbXBvcmFyaWx5ID0gZnVuY3Rpb24gKCkgewogIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsKfTsKUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5kaXNhYmxlU2hvd1RlbXBvcmFyaWx5KCk7CiAgaWYgKCFpc0xhbmRzY2FwZU1vZGUoKSAmJiBpc01vYmlsZSgpKSB7CiAgICB0aGlzLnNob3coKTsKICB9IGVsc2UgewogICAgdGhpcy5oaWRlKCk7CiAgfQp9OwpSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLmxvYWRJY29uXyA9IGZ1bmN0aW9uICgpIHsKICB0aGlzLmljb24gPSBkYXRhVXJpKCdpbWFnZS9zdmcreG1sJywgcm90YXRlSW5zdHJ1Y3Rpb25zQXNzZXQpOwp9Owp2YXIgREVGQVVMVF9WSUVXRVIgPSAnQ2FyZGJvYXJkVjEnOwp2YXIgVklFV0VSX0tFWSA9ICdXRUJWUl9DQVJEQk9BUkRfVklFV0VSJzsKdmFyIENMQVNTX05BTUUgPSAnd2VidnItcG9seWZpbGwtdmlld2VyLXNlbGVjdG9yJzsKZnVuY3Rpb24gVmlld2VyU2VsZWN0b3IoZGVmYXVsdFZpZXdlcikgewogIHRyeSB7CiAgICB0aGlzLnNlbGVjdGVkS2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oVklFV0VSX0tFWSk7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHZpZXdlciBwcm9maWxlOiAlcycsIGVycm9yKTsKICB9CiAgaWYgKCF0aGlzLnNlbGVjdGVkS2V5KSB7CiAgICB0aGlzLnNlbGVjdGVkS2V5ID0gZGVmYXVsdFZpZXdlciB8fCBERUZBVUxUX1ZJRVdFUjsKICB9CiAgdGhpcy5kaWFsb2cgPSB0aGlzLmNyZWF0ZURpYWxvZ18oRGV2aWNlSW5mby5WaWV3ZXJzKTsKICB0aGlzLnJvb3QgPSBudWxsOwogIHRoaXMub25DaGFuZ2VDYWxsYmFja3NfID0gW107Cn0KVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAocm9vdCkgewogIHRoaXMucm9vdCA9IHJvb3Q7CiAgcm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRpYWxvZyk7CiAgdmFyIHNlbGVjdGVkID0gdGhpcy5kaWFsb2cucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLnNlbGVjdGVkS2V5KTsKICBzZWxlY3RlZC5jaGVja2VkID0gdHJ1ZTsKICB0aGlzLmRpYWxvZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKfTsKVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgaWYgKHRoaXMucm9vdCAmJiB0aGlzLnJvb3QuY29udGFpbnModGhpcy5kaWFsb2cpKSB7CiAgICB0aGlzLnJvb3QucmVtb3ZlQ2hpbGQodGhpcy5kaWFsb2cpOwogIH0KICB0aGlzLmRpYWxvZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9OwpWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZ2V0Q3VycmVudFZpZXdlciA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldOwp9OwpWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZ2V0U2VsZWN0ZWRLZXlfID0gZnVuY3Rpb24gKCkgewogIHZhciBpbnB1dCA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ZmllbGRdOmNoZWNrZWQnKTsKICBpZiAoaW5wdXQpIHsKICAgIHJldHVybiBpbnB1dC5pZDsKICB9CiAgcmV0dXJuIG51bGw7Cn07ClZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChjYikgewogIHRoaXMub25DaGFuZ2VDYWxsYmFja3NfLnB1c2goY2IpOwp9OwpWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZmlyZU9uQ2hhbmdlXyA9IGZ1bmN0aW9uICh2aWV3ZXIpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub25DaGFuZ2VDYWxsYmFja3NfLmxlbmd0aDsgaSsrKSB7CiAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzX1tpXSh2aWV3ZXIpOwogIH0KfTsKVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLm9uU2F2ZV8gPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5zZWxlY3RlZEtleSA9IHRoaXMuZ2V0U2VsZWN0ZWRLZXlfKCk7CiAgaWYgKCF0aGlzLnNlbGVjdGVkS2V5IHx8ICFEZXZpY2VJbmZvLlZpZXdlcnNbdGhpcy5zZWxlY3RlZEtleV0pIHsKICAgIGNvbnNvbGUuZXJyb3IoJ1ZpZXdlclNlbGVjdG9yLm9uU2F2ZV86IHRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbiEnKTsKICAgIHJldHVybjsKICB9CiAgdGhpcy5maXJlT25DaGFuZ2VfKERldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XSk7CiAgdHJ5IHsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFZJRVdFUl9LRVksIHRoaXMuc2VsZWN0ZWRLZXkpOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSB2aWV3ZXIgcHJvZmlsZTogJXMnLCBlcnJvcik7CiAgfQogIHRoaXMuaGlkZSgpOwp9OwpWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlRGlhbG9nXyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKENMQVNTX05BTUUpOwogIGNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgdmFyIHMgPSBvdmVybGF5LnN0eWxlOwogIHMucG9zaXRpb24gPSAnZml4ZWQnOwogIHMubGVmdCA9IDA7CiAgcy50b3AgPSAwOwogIHMud2lkdGggPSAnMTAwJSc7CiAgcy5oZWlnaHQgPSAnMTAwJSc7CiAgcy5iYWNrZ3JvdW5kID0gJ3JnYmEoMCwgMCwgMCwgMC4zKSc7CiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGlkZS5iaW5kKHRoaXMpKTsKICB2YXIgd2lkdGggPSAyODA7CiAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHZhciBzID0gZGlhbG9nLnN0eWxlOwogIHMuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnOwogIHMucG9zaXRpb24gPSAnZml4ZWQnOwogIHMudG9wID0gJzI0cHgnOwogIHMubGVmdCA9ICc1MCUnOwogIHMubWFyZ2luTGVmdCA9IC13aWR0aCAvIDIgKyAncHgnOwogIHMud2lkdGggPSB3aWR0aCArICdweCc7CiAgcy5wYWRkaW5nID0gJzI0cHgnOwogIHMub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICBzLmJhY2tncm91bmQgPSAnI2ZhZmFmYSc7CiAgcy5mb250RmFtaWx5ID0gIidSb2JvdG8nLCBzYW5zLXNlcmlmIjsKICBzLmJveFNoYWRvdyA9ICcwcHggNXB4IDIwcHggIzY2Nic7CiAgZGlhbG9nLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlSDFfKCdTZWxlY3QgeW91ciB2aWV3ZXInKSk7CiAgZm9yICh2YXIgaWQgaW4gb3B0aW9ucykgewogICAgZGlhbG9nLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlQ2hvaWNlXyhpZCwgb3B0aW9uc1tpZF0ubGFiZWwpKTsKICB9CiAgZGlhbG9nLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlQnV0dG9uXygnU2F2ZScsIHRoaXMub25TYXZlXy5iaW5kKHRoaXMpKSk7CiAgY29udGFpbmVyLmFwcGVuZENoaWxkKG92ZXJsYXkpOwogIGNvbnRhaW5lci5hcHBlbmRDaGlsZChkaWFsb2cpOwogIHJldHVybiBjb250YWluZXI7Cn07ClZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVIMV8gPSBmdW5jdGlvbiAobmFtZSkgewogIHZhciBoMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7CiAgdmFyIHMgPSBoMS5zdHlsZTsKICBzLmNvbG9yID0gJ2JsYWNrJzsKICBzLmZvbnRTaXplID0gJzIwcHgnOwogIHMuZm9udFdlaWdodCA9ICdib2xkJzsKICBzLm1hcmdpblRvcCA9IDA7CiAgcy5tYXJnaW5Cb3R0b20gPSAnMjRweCc7CiAgaDEuaW5uZXJIVE1MID0gbmFtZTsKICByZXR1cm4gaDE7Cn07ClZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVDaG9pY2VfID0gZnVuY3Rpb24gKGlkLCBuYW1lKSB7CiAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIGRpdi5zdHlsZS5tYXJnaW5Ub3AgPSAnOHB4JzsKICBkaXYuc3R5bGUuY29sb3IgPSAnYmxhY2snOwogIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgaW5wdXQuc3R5bGUuZm9udFNpemUgPSAnMzBweCc7CiAgaW5wdXQuc2V0QXR0cmlidXRlKCdpZCcsIGlkKTsKICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncmFkaW8nKTsKICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgaWQpOwogIGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsICdmaWVsZCcpOwogIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7CiAgbGFiZWwuc3R5bGUubWFyZ2luTGVmdCA9ICc0cHgnOwogIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgaWQpOwogIGxhYmVsLmlubmVySFRNTCA9IG5hbWU7CiAgZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKICBkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOwogIHJldHVybiBkaXY7Cn07ClZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVCdXR0b25fID0gZnVuY3Rpb24gKGxhYmVsLCBvbmNsaWNrKSB7CiAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGJ1dHRvbi5pbm5lckhUTUwgPSBsYWJlbDsKICB2YXIgcyA9IGJ1dHRvbi5zdHlsZTsKICBzLmZsb2F0ID0gJ3JpZ2h0JzsKICBzLnRleHRUcmFuc2Zvcm0gPSAndXBwZXJjYXNlJzsKICBzLmNvbG9yID0gJyMxMDk0ZjcnOwogIHMuZm9udFNpemUgPSAnMTRweCc7CiAgcy5sZXR0ZXJTcGFjaW5nID0gMDsKICBzLmJvcmRlciA9IDA7CiAgcy5iYWNrZ3JvdW5kID0gJ25vbmUnOwogIHMubWFyZ2luVG9wID0gJzE2cHgnOwogIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uY2xpY2spOwogIHJldHVybiBidXR0b247Cn07CnZhciBjb21tb25qc0dsb2JhbCQkMSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGNvbW1vbmpzR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGNvbW1vbmpzR2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwpmdW5jdGlvbiB1bndyYXBFeHBvcnRzJCQxICh4KSB7CglyZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdkZWZhdWx0JykgPyB4WydkZWZhdWx0J10gOiB4Owp9CmZ1bmN0aW9uIGNyZWF0ZUNvbW1vbmpzTW9kdWxlJCQxKGZuLCBtb2R1bGUpIHsKCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKfQp2YXIgTm9TbGVlcCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlJCQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsKCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwp9KShjb21tb25qc0dsb2JhbCQkMSwgZnVuY3Rpb24oKSB7CnJldHVybiAgICAgICAgICAoZnVuY3Rpb24obW9kdWxlcykgewogICAgICAgICAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKICAgICAgICAgCWZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsKICAgICAgICAgCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgewogICAgICAgICAJCQlyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgICAgCQl9CiAgICAgICAgIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewogICAgICAgICAJCQlpOiBtb2R1bGVJZCwKICAgICAgICAgCQkJbDogZmFsc2UsCiAgICAgICAgIAkJCWV4cG9ydHM6IHt9CiAgICAgICAgIAkJfTsKICAgICAgICAgCQltb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKICAgICAgICAgCQltb2R1bGUubCA9IHRydWU7CiAgICAgICAgIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgICAJfQogICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsKICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHsKICAgICAgICAgCQlpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7CiAgICAgICAgIAkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7CiAgICAgICAgIAkJCQljb25maWd1cmFibGU6IGZhbHNlLAogICAgICAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgCQkJCWdldDogZ2V0dGVyCiAgICAgICAgIAkJCX0pOwogICAgICAgICAJCX0KICAgICAgICAgCX07CiAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHsKICAgICAgICAgCQl2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8KICAgICAgICAgCQkJZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDoKICAgICAgICAgCQkJZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTsKICAgICAgICAgCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7CiAgICAgICAgIAkJcmV0dXJuIGdldHRlcjsKICAgICAgICAgCX07CiAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07CiAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiIjsKICAgICAgICAgCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApOwogICAgICAgICB9KQogICAgICAgICAoWwogICAgICAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KdmFyIG1lZGlhRmlsZSA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CnZhciBvbGRJT1MgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBwYXJzZUZsb2F0KCgnJyArICgvQ1BVLipPUyAoWzAtOV9dezMsNH0pWzAtOV9dezAsMX18KENQVSBsaWtlKS4qQXBwbGVXZWJLaXQuKk1vYmlsZS9pLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgWzAsICcnXSlbMV0pLnJlcGxhY2UoJ3VuZGVmaW5lZCcsICczXzInKS5yZXBsYWNlKCdfJywgJy4nKS5yZXBsYWNlKCdfJywgJycpKSA8IDEwICYmICF3aW5kb3cuTVNTdHJlYW07CnZhciBOb1NsZWVwID0gZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIE5vU2xlZXAoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTm9TbGVlcCk7CiAgICBpZiAob2xkSU9TKSB7CiAgICAgIHRoaXMubm9TbGVlcFRpbWVyID0gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubm9TbGVlcFZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTsKICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uc2V0QXR0cmlidXRlKCdzcmMnLCBtZWRpYUZpbGUpOwogICAgICB0aGlzLm5vU2xlZXBWaWRlby5hZGRFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAodGhpcy5ub1NsZWVwVmlkZW8uY3VycmVudFRpbWUgPiAwLjUpIHsKICAgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5yYW5kb20oKTsKICAgICAgICB9CiAgICAgIH0uYmluZCh0aGlzKSk7CiAgICB9CiAgfQogIF9jcmVhdGVDbGFzcyhOb1NsZWVwLCBbewogICAga2V5OiAnZW5hYmxlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgIGlmIChvbGRJT1MpIHsKICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJzsKICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHdpbmRvdy5zdG9wLCAwKTsKICAgICAgICB9LCAxNTAwMCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8ucGxheSgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnZGlzYWJsZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgaWYgKG9sZElPUykgewogICAgICAgIGlmICh0aGlzLm5vU2xlZXBUaW1lcikgewogICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5ub1NsZWVwVGltZXIpOwogICAgICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5wYXVzZSgpOwogICAgICB9CiAgICB9CiAgfV0pOwogIHJldHVybiBOb1NsZWVwOwp9KCk7Cm1vZHVsZS5leHBvcnRzID0gTm9TbGVlcDsKICAgICAgfSksCiAgICAgIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKbW9kdWxlLmV4cG9ydHMgPSAnZGF0YTp2aWRlby9tcDQ7YmFzZTY0LEFBQUFJR1owZVhCdGNEUXlBQUFDQUdsemIyMXBjMjh5WVhaak1XMXdOREVBQUFBSVpuSmxaUUFBQ0tCdFpHRjBBQUFDOHdZRi8vL3YzRVhwdmViWlNMZVdMTmdnMlNQdTczZ3lOalFnTFNCamIzSmxJREUwTWlCeU1qUTNPU0JrWkRjNVlUWXhJQzBnU0M0eU5qUXZUVkJGUnkwMElFRldReUJqYjJSbFl5QXRJRU52Y0hsc1pXWjBJREl3TURNdE1qQXhOQ0F0SUdoMGRIQTZMeTkzZDNjdWRtbGtaVzlzWVc0dWIzSm5MM2d5TmpRdWFIUnRiQ0F0SUc5d2RHbHZibk02SUdOaFltRmpQVEVnY21WbVBURWdaR1ZpYkc5amF6MHhPakE2TUNCaGJtRnNlWE5sUFRCNE1Ub3dlREV4TVNCdFpUMW9aWGdnYzNWaWJXVTlNaUJ3YzNrOU1TQndjM2xmY21ROU1TNHdNRG93TGpBd0lHMXBlR1ZrWDNKbFpqMHdJRzFsWDNKaGJtZGxQVEUySUdOb2NtOXRZVjl0WlQweElIUnlaV3hzYVhNOU1DQTRlRGhrWTNROU1DQmpjVzA5TUNCa1pXRmtlbTl1WlQweU1Td3hNU0JtWVhOMFgzQnphMmx3UFRFZ1kyaHliMjFoWDNGd1gyOW1abk5sZEQwd0lIUm9jbVZoWkhNOU5pQnNiMjlyWVdobFlXUmZkR2h5WldGa2N6MHhJSE5zYVdObFpGOTBhSEpsWVdSelBUQWdibkk5TUNCa1pXTnBiV0YwWlQweElHbHVkR1Z5YkdGalpXUTlNQ0JpYkhWeVlYbGZZMjl0Y0dGMFBUQWdZMjl1YzNSeVlXbHVaV1JmYVc1MGNtRTlNQ0JpWm5KaGJXVnpQVE1nWWw5d2VYSmhiV2xrUFRJZ1lsOWhaR0Z3ZEQweElHSmZZbWxoY3owd0lHUnBjbVZqZEQweElIZGxhV2RvZEdJOU1TQnZjR1Z1WDJkdmNEMHdJSGRsYVdkb2RIQTlNU0JyWlhscGJuUTlNekF3SUd0bGVXbHVkRjl0YVc0OU16QWdjMk5sYm1WamRYUTlOREFnYVc1MGNtRmZjbVZtY21WemFEMHdJSEpqWDJ4dmIydGhhR1ZoWkQweE1DQnlZejFqY21ZZ2JXSjBjbVZsUFRFZ1kzSm1QVEl3TGpBZ2NXTnZiWEE5TUM0Mk1DQnhjRzFwYmowd0lIRndiV0Y0UFRZNUlIRndjM1JsY0QwMElIWmlkbDl0WVhoeVlYUmxQVEl3TURBd0lIWmlkbDlpZFdaemFYcGxQVEkxTURBd0lHTnlabDl0WVhnOU1DNHdJRzVoYkY5b2NtUTlibTl1WlNCbWFXeHNaWEk5TUNCcGNGOXlZWFJwYnoweExqUXdJR0Z4UFRFNk1TNHdNQUNBQUFBQU9XV0loQUEzLy9wK0M3djh0RERTVGpmOTd3NTVpM1NiUlBPNFpZK2hrakQ1aGJrQWtMM3pwSjZoL0xSMUNBQUJ6Z0Ixa3FxelVvcmxoUUFBQUF4Qm1pUVlobi8rcVpZQURMZ0FBQUFKUVo1Q1FoWC9BQWo1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdlWVVRbi93QUxLQ0VBQTBCb0hBQUFBQWtCbm1ORUovOEFDeWtoQUFOQWFCd2hBQU5BYUJ3QUFBQU5RWnBvTkV4RFAvNnBsZ0FNdVNFQUEwQm9IQUFBQUF0Qm5vWkZFU3dyL3dBSStTRUFBMEJvSENFQUEwQm9IQUFBQUFrQm5xVkVKLzhBQ3lraEFBTkFhQndBQUFBSkFaNm5SQ2YvQUFzb0lRQURRR2djSVFBRFFHZ2NBQUFBRFVHYXJEUk1Rei8rcVpZQURMZ2hBQU5BYUJ3QUFBQUxRWjdLUlJVc0svOEFDUGtoQUFOQWFCd0FBQUFKQVo3cFJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdlNjBRbi93QUxLQ0VBQTBCb0hBQUFBQTFCbXZBMFRFTS8vcW1XQUF5NUlRQURRR2djSVFBRFFHZ2NBQUFBQzBHZkRrVVZMQ3YvQUFqNUlRQURRR2djQUFBQUNRR2ZMVVFuL3dBTEtTRUFBMEJvSENFQUEwQm9IQUFBQUFrQm55OUVKLzhBQ3lnaEFBTkFhQndBQUFBTlFaczBORXhEUC82cGxnQU11Q0VBQTBCb0hBQUFBQXRCbjFKRkZTd3Ivd0FJK1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbjNGRUovOEFDeWdoQUFOQWFCd0FBQUFKQVo5elJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFEVUdiZURSTVF6LytxWllBRExraEFBTkFhQndBQUFBTFFaK1dSUlVzSy84QUNQZ2hBQU5BYUJ3aEFBTkFhQndBQUFBSkFaKzFSQ2YvQUFzcElRQURRR2djQUFBQUNRR2Z0MFFuL3dBTEtTRUFBMEJvSENFQUEwQm9IQUFBQUExQm03dzBURU0vL3FtV0FBeTRJUUFEUUdnY0FBQUFDMEdmMmtVVkxDdi9BQWo1SVFBRFFHZ2NBQUFBQ1FHZitVUW4vd0FMS0NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbi90RUovOEFDeWtoQUFOQWFCd0FBQUFOUVp2Z05FeERQLzZwbGdBTXVTRUFBMEJvSENFQUEwQm9IQUFBQUF0Qm5oNUZGU3dyL3dBSStDRUFBMEJvSEFBQUFBa0JuajFFSi84QUN5Z2hBQU5BYUJ3aEFBTkFhQndBQUFBSkFaNC9SQ2YvQUFzcElRQURRR2djQUFBQURVR2FKRFJNUXovK3FaWUFETGdoQUFOQWFCd0FBQUFMUVo1Q1JSVXNLLzhBQ1BraEFBTkFhQndoQUFOQWFCd0FBQUFKQVo1aFJDZi9BQXNvSVFBRFFHZ2NBQUFBQ1FHZVkwUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQTFCbW1nMFRFTS8vcW1XQUF5NUlRQURRR2djQUFBQUMwR2Voa1VWTEN2L0FBajVJUUFEUUdnY0lRQURRR2djQUFBQUNRR2VwVVFuL3dBTEtTRUFBMEJvSEFBQUFBa0JucWRFSi84QUN5Z2hBQU5BYUJ3QUFBQU5RWnFzTkV4RFAvNnBsZ0FNdUNFQUEwQm9IQ0VBQTBCb0hBQUFBQXRCbnNwRkZTd3Ivd0FJK1NFQUEwQm9IQUFBQUFrQm51bEVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVo3clJDZi9BQXNvSVFBRFFHZ2NBQUFBRFVHYThEUk1Rei8rcVpZQURMa2hBQU5BYUJ3aEFBTkFhQndBQUFBTFFaOE9SUlVzSy84QUNQa2hBQU5BYUJ3QUFBQUpBWjh0UkNmL0FBc3BJUUFEUUdnY0lRQURRR2djQUFBQUNRR2ZMMFFuL3dBTEtDRUFBMEJvSEFBQUFBMUJtelEwVEVNLy9xbVdBQXk0SVFBRFFHZ2NBQUFBQzBHZlVrVVZMQ3YvQUFqNUlRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZmNVUW4vd0FMS0NFQUEwQm9IQUFBQUFrQm4zTkVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFOUVp0NE5FeEMvLzZwbGdBTXVTRUFBMEJvSEFBQUFBdEJuNVpGRlN3ci93QUkrQ0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuN1ZFSi84QUN5a2hBQU5BYUJ3QUFBQUpBWiszUkNmL0FBc3BJUUFEUUdnY0FBQUFEVUdidXpSTVFuLytuaEFBWXNBaEFBTkFhQndoQUFOQWFCd0FBQUFKUVovYVFoUC9BQXNwSVFBRFFHZ2NBQUFBQ1FHZitVUW4vd0FMS0NFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSEFBQUNpRnRiMjkyQUFBQWJHMTJhR1FBQUFBQTFZQ0NYOVdBZ2w4QUFBUG9BQUFIL0FBQkFBQUJBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFEQUFBQUdHbHZaSE1BQUFBQUVJQ0FnQWNBVC8vLy92Ny9BQUFGK1hSeVlXc0FBQUJjZEd0b1pBQUFBQVBWZ0lKZjFZQ0NYd0FBQUFFQUFBQUFBQUFIMEFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBeWdBQUFNb0FBQUFBQUNSbFpIUnpBQUFBSEdWc2MzUUFBQUFBQUFBQUFRQUFCOUFBQUJkd0FBRUFBQUFBQlhGdFpHbGhBQUFBSUcxa2FHUUFBQUFBMVlDQ1g5V0FnbDhBQVYrUUFBSy9JRlhFQUFBQUFBQXRhR1JzY2dBQUFBQUFBQUFBZG1sa1pRQUFBQUFBQUFBQUFBQUFBRlpwWkdWdlNHRnVaR3hsY2dBQUFBVWNiV2x1WmdBQUFCUjJiV2hrQUFBQUFRQUFBQUFBQUFBQUFBQUFKR1JwYm1ZQUFBQWNaSEpsWmdBQUFBQUFBQUFCQUFBQURIVnliQ0FBQUFBQkFBQUUzSE4wWW13QUFBQ1ljM1J6WkFBQUFBQUFBQUFCQUFBQWlHRjJZekVBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBQUF5Z0RLQUVnQUFBQklBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBWS8vOEFBQUF5WVhaalF3Rk5RQ2ovNFFBYlowMUFLT3lobzN5U1RVQkFRRkFBQUFNQUVBQXI4Z0R4Z3hsZ0FRQUVhTytHOGdBQUFCaHpkSFJ6QUFBQUFBQUFBQUVBQUFBOEFBQUx1QUFBQUJSemRITnpBQUFBQUFBQUFBRUFBQUFCQUFBQjhHTjBkSE1BQUFBQUFBQUFQQUFBQUFFQUFCZHdBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBRHFZQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUFFQUFBdTRBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQUM3Z0FBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFCeHpkSE5qQUFBQUFBQUFBQUVBQUFBQkFBQUFBUUFBQUFFQUFBRUVjM1J6ZWdBQUFBQUFBQUFBQUFBQVBBQUFBelFBQUFBUUFBQUFEUUFBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQVBBQUFBRFFBQUFBMEFBQUFSQUFBQUR3QUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQU5BQUFBRFFBQUFRQnpkR052QUFBQUFBQUFBRHdBQUFBd0FBQURaQUFBQTNRQUFBT05BQUFEb0FBQUE3a0FBQVBRQUFBRDZ3QUFBLzRBQUFRWEFBQUVMZ0FBQkVNQUFBUmNBQUFFYndBQUJJd0FBQVNoQUFBRXVnQUFCTTBBQUFUa0FBQUUvd0FBQlJJQUFBVXJBQUFGUWdBQUJWMEFBQVZ3QUFBRmlRQUFCYUFBQUFXMUFBQUZ6Z0FBQmVFQUFBWCtBQUFHRXdBQUJpd0FBQVkvQUFBR1ZnQUFCbkVBQUFhRUFBQUduUUFBQnJRQUFBYlBBQUFHNGdBQUJ2VUFBQWNTQUFBSEp3QUFCMEFBQUFkVEFBQUhjQUFBQjRVQUFBZWVBQUFIc1FBQUI4Z0FBQWZqQUFBSDlnQUFDQThBQUFnbUFBQUlRUUFBQ0ZRQUFBaG5BQUFJaEFBQUNKY0FBQU1zZEhKaGF3QUFBRngwYTJoa0FBQUFBOVdBZ2wvVmdJSmZBQUFBQWdBQUFBQUFBQWY4QUFBQUFBQUFBQUFBQUFBQkFRQUFBQUFCQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFDc20xa2FXRUFBQUFnYldSb1pBQUFBQURWZ0lKZjFZQ0NYd0FBckVRQUFXQUFWY1FBQUFBQUFDZG9aR3h5QUFBQUFBQUFBQUJ6YjNWdUFBQUFBQUFBQUFBQUFBQUFVM1JsY21WdkFBQUFBbU50YVc1bUFBQUFFSE50YUdRQUFBQUFBQUFBQUFBQUFDUmthVzVtQUFBQUhHUnlaV1lBQUFBQUFBQUFBUUFBQUF4MWNtd2dBQUFBQVFBQUFpZHpkR0pzQUFBQVozTjBjMlFBQUFBQUFBQUFBUUFBQUZkdGNEUmhBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUNBQkFBQUFBQXJFUUFBQUFBQURObGMyUnpBQUFBQUFPQWdJQWlBQUlBQklDQWdCUkFGUUFBQUFBRERVQUFBQUFBQllDQWdBSVNFQWFBZ0lBQkFnQUFBQmh6ZEhSekFBQUFBQUFBQUFFQUFBQllBQUFFQUFBQUFCeHpkSE5qQUFBQUFBQUFBQUVBQUFBQkFBQUFBUUFBQUFFQUFBQVVjM1J6ZWdBQUFBQUFBQUFHQUFBQVdBQUFBWEJ6ZEdOdkFBQUFBQUFBQUZnQUFBT0JBQUFEaHdBQUE1b0FBQU90QUFBRHN3QUFBOG9BQUFQZkFBQUQ1UUFBQS9nQUFBUUxBQUFFRVFBQUJDZ0FBQVE5QUFBRVVBQUFCRllBQUFScEFBQUVnQUFBQklZQUFBU2JBQUFFcmdBQUJMUUFBQVRIQUFBRTNnQUFCUE1BQUFUNUFBQUZEQUFBQlI4QUFBVWxBQUFGUEFBQUJWRUFBQVZYQUFBRmFnQUFCWDBBQUFXREFBQUZtZ0FBQmE4QUFBWENBQUFGeUFBQUJkc0FBQVh5QUFBRitBQUFCZzBBQUFZZ0FBQUdKZ0FBQmprQUFBWlFBQUFHWlFBQUJtc0FBQVorQUFBR2tRQUFCcGNBQUFhdUFBQUd3d0FBQnNrQUFBYmNBQUFHN3dBQUJ3WUFBQWNNQUFBSElRQUFCelFBQUFjNkFBQUhUUUFBQjJRQUFBZHFBQUFIZndBQUI1SUFBQWVZQUFBSHF3QUFCOElBQUFmWEFBQUgzUUFBQi9BQUFBZ0RBQUFJQ1FBQUNDQUFBQWcxQUFBSU93QUFDRTRBQUFoaEFBQUllQUFBQ0g0QUFBaVJBQUFJcEFBQUNLb0FBQWl3QUFBSXRnQUFDTHdBQUFqQ0FBQUFGblZrZEdFQUFBQU9ibUZ0WlZOMFpYSmxid0FBQUhCMVpIUmhBQUFBYUcxbGRHRUFBQUFBQUFBQUlXaGtiSElBQUFBQUFBQUFBRzFrYVhKaGNIQnNBQUFBQUFBQUFBQUFBQUFBTzJsc2MzUUFBQUF6cVhSdmJ3QUFBQ3RrWVhSaEFBQUFBUUFBQUFCSVlXNWtRbkpoYTJVZ01DNHhNQzR5SURJd01UVXdOakV4TURBPSc7CiAgICAgIH0pCiAgICAgICAgIF0pOwp9KTsKfSk7CnZhciBOb1NsZWVwJDEgPSB1bndyYXBFeHBvcnRzJCQxKE5vU2xlZXApOwp2YXIgbmV4dERpc3BsYXlJZCA9IDEwMDA7CnZhciBkZWZhdWx0TGVmdEJvdW5kcyA9IFswLCAwLCAwLjUsIDFdOwp2YXIgZGVmYXVsdFJpZ2h0Qm91bmRzID0gWzAuNSwgMCwgMC41LCAxXTsKdmFyIHJhZiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7CnZhciBjYWYgPSB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWU7CmZ1bmN0aW9uIFZSRnJhbWVEYXRhKCkgewogIHRoaXMubGVmdFByb2plY3Rpb25NYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICB0aGlzLmxlZnRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgdGhpcy5yaWdodFByb2plY3Rpb25NYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICB0aGlzLnJpZ2h0Vmlld01hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogIHRoaXMucG9zZSA9IG51bGw7Cn0KZnVuY3Rpb24gVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKGNvbmZpZykgewogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgIGhhc1Bvc2l0aW9uOiB7CiAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5oYXNQb3NpdGlvbgogICAgfSwKICAgIGhhc0V4dGVybmFsRGlzcGxheTogewogICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcuaGFzRXh0ZXJuYWxEaXNwbGF5CiAgICB9LAogICAgY2FuUHJlc2VudDogewogICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcuY2FuUHJlc2VudAogICAgfSwKICAgIG1heExheWVyczogewogICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcubWF4TGF5ZXJzCiAgICB9LAogICAgaGFzT3JpZW50YXRpb246IHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5oYXNPcmllbnRhdGlvbicsICdWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YScpOwogICAgICAgIHJldHVybiBjb25maWcuaGFzT3JpZW50YXRpb247CiAgICAgIH0KICAgIH0KICB9KTsKfQpmdW5jdGlvbiBWUkRpc3BsYXkoY29uZmlnKSB7CiAgY29uZmlnID0gY29uZmlnIHx8IHt9OwogIHZhciBVU0VfV0FLRUxPQ0sgPSAnd2FrZWxvY2snIGluIGNvbmZpZyA/IGNvbmZpZy53YWtlbG9jayA6IHRydWU7CiAgdGhpcy5pc1BvbHlmaWxsZWQgPSB0cnVlOwogIHRoaXMuZGlzcGxheUlkID0gbmV4dERpc3BsYXlJZCsrOwogIHRoaXMuZGlzcGxheU5hbWUgPSAnJzsKICB0aGlzLmRlcHRoTmVhciA9IDAuMDE7CiAgdGhpcy5kZXB0aEZhciA9IDEwMDAwLjA7CiAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2lzQ29ubmVjdGVkJywgewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUuaXNDb25uZWN0ZWQnLCAnVlJEaXNwbGF5Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5oYXNFeHRlcm5hbERpc3BsYXknKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pOwogIHRoaXMuY2FwYWJpbGl0aWVzID0gbmV3IFZSRGlzcGxheUNhcGFiaWxpdGllcyh7CiAgICBoYXNQb3NpdGlvbjogZmFsc2UsCiAgICBoYXNPcmllbnRhdGlvbjogZmFsc2UsCiAgICBoYXNFeHRlcm5hbERpc3BsYXk6IGZhbHNlLAogICAgY2FuUHJlc2VudDogZmFsc2UsCiAgICBtYXhMYXllcnM6IDEKICB9KTsKICB0aGlzLnN0YWdlUGFyYW1ldGVycyA9IG51bGw7CiAgdGhpcy53YWl0aW5nRm9yUHJlc2VudF8gPSBmYWxzZTsKICB0aGlzLmxheWVyXyA9IG51bGw7CiAgdGhpcy5vcmlnaW5hbFBhcmVudF8gPSBudWxsOwogIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfID0gbnVsbDsKICB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXyA9IG51bGw7CiAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyA9IG51bGw7CiAgdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfID0gbnVsbDsKICB0aGlzLmZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyXyA9IG51bGw7CiAgdGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXyA9IG51bGw7CiAgaWYgKFVTRV9XQUtFTE9DSyAmJiBpc01vYmlsZSgpKSB7CiAgICB0aGlzLndha2Vsb2NrXyA9IG5ldyBOb1NsZWVwJDEoKTsKICB9Cn0KVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEgPSBmdW5jdGlvbiAoZnJhbWVEYXRhKSB7CiAgcmV0dXJuIGZyYW1lRGF0YUZyb21Qb3NlKGZyYW1lRGF0YSwgdGhpcy5fZ2V0UG9zZSgpLCB0aGlzKTsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRQb3NlID0gZnVuY3Rpb24gKCkgewogIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0UG9zZScsICdWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YScpOwogIHJldHVybiB0aGlzLl9nZXRQb3NlKCk7Cn07ClZSRGlzcGxheS5wcm90b3R5cGUucmVzZXRQb3NlID0gZnVuY3Rpb24gKCkgewogIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUucmVzZXRQb3NlJyk7CiAgcmV0dXJuIHRoaXMuX3Jlc2V0UG9zZSgpOwp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmdldEltbWVkaWF0ZVBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRJbW1lZGlhdGVQb3NlJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CiAgcmV0dXJuIHRoaXMuX2dldFBvc2UoKTsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICByZXR1cm4gcmFmKGNhbGxiYWNrKTsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChpZCkgewogIHJldHVybiBjYWYoaWQpOwp9OwpWUkRpc3BsYXkucHJvdG90eXBlLndyYXBGb3JGdWxsc2NyZWVuID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICBpZiAoaXNJT1MoKSkgewogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQogIGlmICghdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pIHsKICAgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB2YXIgY3NzUHJvcGVydGllcyA9IFsnaGVpZ2h0OiAnICsgTWF0aC5taW4oc2NyZWVuLmhlaWdodCwgc2NyZWVuLndpZHRoKSArICdweCAhaW1wb3J0YW50JywgJ3RvcDogMCAhaW1wb3J0YW50JywgJ2xlZnQ6IDAgIWltcG9ydGFudCcsICdyaWdodDogMCAhaW1wb3J0YW50JywgJ2JvcmRlcjogMCcsICdtYXJnaW46IDAnLCAncGFkZGluZzogMCcsICd6LWluZGV4OiA5OTk5OTkgIWltcG9ydGFudCcsICdwb3NpdGlvbjogZml4ZWQnXTsKICAgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBjc3NQcm9wZXJ0aWVzLmpvaW4oJzsgJykgKyAnOycpOwogICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8uY2xhc3NMaXN0LmFkZCgnd2VidnItcG9seWZpbGwtZnVsbHNjcmVlbi13cmFwcGVyJyk7CiAgfQogIGlmICh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9PSBlbGVtZW50KSB7CiAgICByZXR1cm4gdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl87CiAgfQogIGlmICh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XykgewogICAgaWYgKHRoaXMub3JpZ2luYWxQYXJlbnRfKSB7CiAgICAgIHRoaXMub3JpZ2luYWxQYXJlbnRfLmFwcGVuZENoaWxkKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pOwogICAgfQogIH0KICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9IGVsZW1lbnQ7CiAgdGhpcy5vcmlnaW5hbFBhcmVudF8gPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7CiAgaWYgKCF0aGlzLm9yaWdpbmFsUGFyZW50XykgewogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICB9CiAgaWYgKCF0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXy5wYXJlbnRFbGVtZW50KSB7CiAgICB2YXIgcGFyZW50ID0gdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8ucGFyZW50RWxlbWVudDsKICAgIHBhcmVudC5pbnNlcnRCZWZvcmUodGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8sIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKTsKICAgIHBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xyk7CiAgfQogIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLmluc2VydEJlZm9yZSh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XywgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8uZmlyc3RDaGlsZCk7CiAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyA9IHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsKICB2YXIgc2VsZiA9IHRoaXM7CiAgZnVuY3Rpb24gYXBwbHlGdWxsc2NyZWVuRWxlbWVudFN0eWxlKCkgewogICAgaWYgKCFzZWxmLmZ1bGxzY3JlZW5FbGVtZW50XykgewogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgY3NzUHJvcGVydGllcyA9IFsncG9zaXRpb246IGFic29sdXRlJywgJ3RvcDogMCcsICdsZWZ0OiAwJywgJ3dpZHRoOiAnICsgTWF0aC5tYXgoc2NyZWVuLndpZHRoLCBzY3JlZW4uaGVpZ2h0KSArICdweCcsICdoZWlnaHQ6ICcgKyBNYXRoLm1pbihzY3JlZW4uaGVpZ2h0LCBzY3JlZW4ud2lkdGgpICsgJ3B4JywgJ2JvcmRlcjogMCcsICdtYXJnaW46IDAnLCAncGFkZGluZzogMCddOwogICAgc2VsZi5mdWxsc2NyZWVuRWxlbWVudF8uc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CiAgfQogIGFwcGx5RnVsbHNjcmVlbkVsZW1lbnRTdHlsZSgpOwogIHJldHVybiB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXzsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlciA9IGZ1bmN0aW9uICgpIHsKICBpZiAoIXRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBlbGVtZW50ID0gdGhpcy5mdWxsc2NyZWVuRWxlbWVudF87CiAgaWYgKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8pIHsKICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8pOwogIH0gZWxzZSB7CiAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICB9CiAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPSBudWxsOwogIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8gPSBudWxsOwogIHZhciBwYXJlbnQgPSB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXy5wYXJlbnRFbGVtZW50OwogIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogIGlmICh0aGlzLm9yaWdpbmFsUGFyZW50XyA9PT0gcGFyZW50KSB7CiAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfKTsKICB9CiAgZWxzZSBpZiAodGhpcy5vcmlnaW5hbFBhcmVudF8pIHsKICAgICAgdGhpcy5vcmlnaW5hbFBhcmVudF8uYXBwZW5kQ2hpbGQoZWxlbWVudCk7CiAgICB9CiAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfKTsKICByZXR1cm4gZWxlbWVudDsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0UHJlc2VudCA9IGZ1bmN0aW9uIChsYXllcnMpIHsKICB2YXIgd2FzUHJlc2VudGluZyA9IHRoaXMuaXNQcmVzZW50aW5nOwogIHZhciBzZWxmID0gdGhpczsKICBpZiAoIShsYXllcnMgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUucmVxdWVzdFByZXNlbnQgd2l0aCBub24tYXJyYXkgYXJndW1lbnQnLCAnYW4gYXJyYXkgb2YgVlJMYXllcnMgYXMgdGhlIGZpcnN0IGFyZ3VtZW50Jyk7CiAgICBsYXllcnMgPSBbbGF5ZXJzXTsKICB9CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIGlmICghc2VsZi5jYXBhYmlsaXRpZXMuY2FuUHJlc2VudCkgewogICAgICByZWplY3QobmV3IEVycm9yKCdWUkRpc3BsYXkgaXMgbm90IGNhcGFibGUgb2YgcHJlc2VudGluZy4nKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChsYXllcnMubGVuZ3RoID09IDAgfHwgbGF5ZXJzLmxlbmd0aCA+IHNlbGYuY2FwYWJpbGl0aWVzLm1heExheWVycykgewogICAgICByZWplY3QobmV3IEVycm9yKCdJbnZhbGlkIG51bWJlciBvZiBsYXllcnMuJykpOwogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgaW5jb21pbmdMYXllciA9IGxheWVyc1swXTsKICAgIGlmICghaW5jb21pbmdMYXllci5zb3VyY2UpIHsKICAgICAgcmVzb2x2ZSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgbGVmdEJvdW5kcyA9IGluY29taW5nTGF5ZXIubGVmdEJvdW5kcyB8fCBkZWZhdWx0TGVmdEJvdW5kczsKICAgIHZhciByaWdodEJvdW5kcyA9IGluY29taW5nTGF5ZXIucmlnaHRCb3VuZHMgfHwgZGVmYXVsdFJpZ2h0Qm91bmRzOwogICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKICAgICAgdmFyIGxheWVyID0gc2VsZi5sYXllcl87CiAgICAgIGlmIChsYXllci5zb3VyY2UgIT09IGluY29taW5nTGF5ZXIuc291cmNlKSB7CiAgICAgICAgbGF5ZXIuc291cmNlID0gaW5jb21pbmdMYXllci5zb3VyY2U7CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICBsYXllci5sZWZ0Qm91bmRzW2ldID0gbGVmdEJvdW5kc1tpXTsKICAgICAgICBsYXllci5yaWdodEJvdW5kc1tpXSA9IHJpZ2h0Qm91bmRzW2ldOwogICAgICB9CiAgICAgIHNlbGYud3JhcEZvckZ1bGxzY3JlZW4oc2VsZi5sYXllcl8uc291cmNlKTsKICAgICAgc2VsZi51cGRhdGVQcmVzZW50XygpOwogICAgICByZXNvbHZlKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGYubGF5ZXJfID0gewogICAgICBwcmVkaXN0b3J0ZWQ6IGluY29taW5nTGF5ZXIucHJlZGlzdG9ydGVkLAogICAgICBzb3VyY2U6IGluY29taW5nTGF5ZXIuc291cmNlLAogICAgICBsZWZ0Qm91bmRzOiBsZWZ0Qm91bmRzLnNsaWNlKDApLAogICAgICByaWdodEJvdW5kczogcmlnaHRCb3VuZHMuc2xpY2UoMCkKICAgIH07CiAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwogICAgaWYgKHNlbGYubGF5ZXJfICYmIHNlbGYubGF5ZXJfLnNvdXJjZSkgewogICAgICB2YXIgZnVsbHNjcmVlbkVsZW1lbnQgPSBzZWxmLndyYXBGb3JGdWxsc2NyZWVuKHNlbGYubGF5ZXJfLnNvdXJjZSk7CiAgICAgIHZhciBvbkZ1bGxzY3JlZW5DaGFuZ2UgPSBmdW5jdGlvbiBvbkZ1bGxzY3JlZW5DaGFuZ2UoKSB7CiAgICAgICAgdmFyIGFjdHVhbEZ1bGxzY3JlZW5FbGVtZW50ID0gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKTsKICAgICAgICBzZWxmLmlzUHJlc2VudGluZyA9IGZ1bGxzY3JlZW5FbGVtZW50ID09PSBhY3R1YWxGdWxsc2NyZWVuRWxlbWVudDsKICAgICAgICBpZiAoc2VsZi5pc1ByZXNlbnRpbmcpIHsKICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLmxvY2spIHsKICAgICAgICAgICAgc2NyZWVuLm9yaWVudGF0aW9uLmxvY2soJ2xhbmRzY2FwZS1wcmltYXJ5JykuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignc2NyZWVuLm9yaWVudGF0aW9uLmxvY2soKSBmYWlsZWQgZHVlIHRvJywgZXJyb3IubWVzc2FnZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSBmYWxzZTsKICAgICAgICAgIHNlbGYuYmVnaW5QcmVzZW50XygpOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoc2NyZWVuLm9yaWVudGF0aW9uICYmIHNjcmVlbi5vcmllbnRhdGlvbi51bmxvY2spIHsKICAgICAgICAgICAgc2NyZWVuLm9yaWVudGF0aW9uLnVubG9jaygpOwogICAgICAgICAgfQogICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwogICAgICAgICAgc2VsZi5kaXNhYmxlV2FrZUxvY2soKTsKICAgICAgICAgIHNlbGYuZW5kUHJlc2VudF8oKTsKICAgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgfTsKICAgICAgdmFyIG9uRnVsbHNjcmVlbkVycm9yID0gZnVuY3Rpb24gb25GdWxsc2NyZWVuRXJyb3IoKSB7CiAgICAgICAgaWYgKCFzZWxmLndhaXRpbmdGb3JQcmVzZW50XykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyKCk7CiAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwogICAgICAgIHNlbGYuZGlzYWJsZVdha2VMb2NrKCk7CiAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSBmYWxzZTsKICAgICAgICBzZWxmLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1VuYWJsZSB0byBwcmVzZW50LicpKTsKICAgICAgfTsKICAgICAgc2VsZi5hZGRGdWxsc2NyZWVuTGlzdGVuZXJzXyhmdWxsc2NyZWVuRWxlbWVudCwgb25GdWxsc2NyZWVuQ2hhbmdlLCBvbkZ1bGxzY3JlZW5FcnJvcik7CiAgICAgIGlmIChyZXF1ZXN0RnVsbHNjcmVlbihmdWxsc2NyZWVuRWxlbWVudCkpIHsKICAgICAgICBzZWxmLmVuYWJsZVdha2VMb2NrKCk7CiAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKGlzSU9TKCkgfHwgaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICAgICAgc2VsZi5lbmFibGVXYWtlTG9jaygpOwogICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gdHJ1ZTsKICAgICAgICBzZWxmLmJlZ2luUHJlc2VudF8oKTsKICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfQogICAgfQogICAgaWYgKCFzZWxmLndhaXRpbmdGb3JQcmVzZW50XyAmJiAhaXNJT1MoKSkgewogICAgICBleGl0RnVsbHNjcmVlbigpOwogICAgICByZWplY3QobmV3IEVycm9yKCdVbmFibGUgdG8gcHJlc2VudC4nKSk7CiAgICB9CiAgfSk7Cn07ClZSRGlzcGxheS5wcm90b3R5cGUuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CiAgdmFyIHdhc1ByZXNlbnRpbmcgPSB0aGlzLmlzUHJlc2VudGluZzsKICB2YXIgc2VsZiA9IHRoaXM7CiAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKICB0aGlzLmxheWVyXyA9IG51bGw7CiAgdGhpcy5kaXNhYmxlV2FrZUxvY2soKTsKICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKICAgICAgaWYgKCFleGl0RnVsbHNjcmVlbigpICYmIGlzSU9TKCkpIHsKICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CiAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgfQogICAgICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwogICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CiAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgfQogICAgICByZXNvbHZlKCk7CiAgICB9IGVsc2UgewogICAgICByZWplY3QobmV3IEVycm9yKCdXYXMgbm90IHByZXNlbnRpbmcgdG8gVlJEaXNwbGF5LicpKTsKICAgIH0KICB9KTsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRMYXllcnMgPSBmdW5jdGlvbiAoKSB7CiAgaWYgKHRoaXMubGF5ZXJfKSB7CiAgICByZXR1cm4gW3RoaXMubGF5ZXJfXTsKICB9CiAgcmV0dXJuIFtdOwp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CiAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlDb25uZWN0XyA9IGZ1bmN0aW9uICgpIHsKICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWNvbm5lY3QnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CiAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNoYW5nZUhhbmRsZXIsIGVycm9ySGFuZGxlcikgewogIHRoaXMucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBlbGVtZW50OwogIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gY2hhbmdlSGFuZGxlcjsKICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gZXJyb3JIYW5kbGVyOwogIGlmIChjaGFuZ2VIYW5kbGVyKSB7CiAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQpIHsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbmFibGVkKSB7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVuYWJsZWQpIHsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICB9CiAgfQogIGlmIChlcnJvckhhbmRsZXIpIHsKICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgfSBlbHNlIGlmIChkb2N1bWVudC5tb3pGdWxsU2NyZWVuRW5hYmxlZCkgewogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICB9CiAgfQp9OwpWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKCkgewogIGlmICghdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfKSByZXR1cm47CiAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF87CiAgaWYgKHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfKSB7CiAgICB2YXIgY2hhbmdlSGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfOwogICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbXNmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogIH0KICBpZiAodGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXykgewogICAgdmFyIGVycm9ySGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl87CiAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogIH0KICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwogIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5lbmFibGVXYWtlTG9jayA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy53YWtlbG9ja18pIHsKICAgIHRoaXMud2FrZWxvY2tfLmVuYWJsZSgpOwogIH0KfTsKVlJEaXNwbGF5LnByb3RvdHlwZS5kaXNhYmxlV2FrZUxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgaWYgKHRoaXMud2FrZWxvY2tfKSB7CiAgICB0aGlzLndha2Vsb2NrXy5kaXNhYmxlKCk7CiAgfQp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmJlZ2luUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7Cn07ClZSRGlzcGxheS5wcm90b3R5cGUuZW5kUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7Cn07ClZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewp9OwpWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKICByZXR1cm4gbnVsbDsKfTsKdmFyIGNvbmZpZyA9IHsKICBBRERJVElPTkFMX1ZJRVdFUlM6IFtdLAogIERFRkFVTFRfVklFV0VSOiAnJywKICBNT0JJTEVfV0FLRV9MT0NLOiB0cnVlLAogIERFQlVHOiBmYWxzZSwKICBEUERCX1VSTDogJ2h0dHBzOi8vZHBkYi53ZWJ2ci5yb2Nrcy9kcGRiLmpzb24nLAogIEtfRklMVEVSOiAwLjk4LAogIFBSRURJQ1RJT05fVElNRV9TOiAwLjA0MCwKICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IGZhbHNlLAogIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IGZhbHNlLAogIFlBV19PTkxZOiBmYWxzZSwKICBCVUZGRVJfU0NBTEU6IDAuNSwKICBESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1M6IGZhbHNlCn07CnZhciBFeWUgPSB7CiAgTEVGVDogJ2xlZnQnLAogIFJJR0hUOiAncmlnaHQnCn07CmZ1bmN0aW9uIENhcmRib2FyZFZSRGlzcGxheShjb25maWckJDEpIHsKICB2YXIgZGVmYXVsdHMgPSBleHRlbmQoe30sIGNvbmZpZyk7CiAgY29uZmlnJCQxID0gZXh0ZW5kKGRlZmF1bHRzLCBjb25maWckJDEgfHwge30pOwogIFZSRGlzcGxheS5jYWxsKHRoaXMsIHsKICAgIHdha2Vsb2NrOiBjb25maWckJDEuTU9CSUxFX1dBS0VfTE9DSwogIH0pOwogIHRoaXMuY29uZmlnID0gY29uZmlnJCQxOwogIHRoaXMuZGlzcGxheU5hbWUgPSAnQ2FyZGJvYXJkIFZSRGlzcGxheSc7CiAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKICAgIGhhc09yaWVudGF0aW9uOiB0cnVlLAogICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiBmYWxzZSwKICAgIGNhblByZXNlbnQ6IHRydWUsCiAgICBtYXhMYXllcnM6IDEKICB9KTsKICB0aGlzLnN0YWdlUGFyYW1ldGVycyA9IG51bGw7CiAgdGhpcy5idWZmZXJTY2FsZV8gPSB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEU7CiAgdGhpcy5wb3NlU2Vuc29yXyA9IG5ldyBQb3NlU2Vuc29yKHRoaXMuY29uZmlnKTsKICB0aGlzLmRpc3RvcnRlcl8gPSBudWxsOwogIHRoaXMuY2FyZGJvYXJkVUlfID0gbnVsbDsKICB0aGlzLmRwZGJfID0gbmV3IERwZGIodGhpcy5jb25maWcuRFBEQl9VUkwsIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkXy5iaW5kKHRoaXMpKTsKICB0aGlzLmRldmljZUluZm9fID0gbmV3IERldmljZUluZm8odGhpcy5kcGRiXy5nZXREZXZpY2VQYXJhbXMoKSwgY29uZmlnJCQxLkFERElUSU9OQUxfVklFV0VSUyk7CiAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8gPSBuZXcgVmlld2VyU2VsZWN0b3IoY29uZmlnJCQxLkRFRkFVTFRfVklFV0VSKTsKICB0aGlzLnZpZXdlclNlbGVjdG9yXy5vbkNoYW5nZSh0aGlzLm9uVmlld2VyQ2hhbmdlZF8uYmluZCh0aGlzKSk7CiAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodGhpcy52aWV3ZXJTZWxlY3Rvcl8uZ2V0Q3VycmVudFZpZXdlcigpKTsKICBpZiAoIXRoaXMuY29uZmlnLlJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQpIHsKICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXyA9IG5ldyBSb3RhdGVJbnN0cnVjdGlvbnMoKTsKICB9CiAgaWYgKGlzSU9TKCkpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplXy5iaW5kKHRoaXMpKTsKICB9Cn0KQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVlJEaXNwbGF5LnByb3RvdHlwZSk7CkNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX2dldFBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHsKICAgIHBvc2l0aW9uOiBudWxsLAogICAgb3JpZW50YXRpb246IHRoaXMucG9zZVNlbnNvcl8uZ2V0T3JpZW50YXRpb24oKSwKICAgIGxpbmVhclZlbG9jaXR5OiBudWxsLAogICAgbGluZWFyQWNjZWxlcmF0aW9uOiBudWxsLAogICAgYW5ndWxhclZlbG9jaXR5OiBudWxsLAogICAgYW5ndWxhckFjY2VsZXJhdGlvbjogbnVsbAogIH07Cn07CkNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX3Jlc2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5wb3NlU2Vuc29yXy5yZXNldFBvc2UpIHsKICAgIHRoaXMucG9zZVNlbnNvcl8ucmVzZXRQb3NlKCk7CiAgfQp9OwpDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9nZXRGaWVsZE9mVmlldyA9IGZ1bmN0aW9uICh3aGljaEV5ZSkgewogIHZhciBmaWVsZE9mVmlldzsKICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKICAgIGZpZWxkT2ZWaWV3ID0gdGhpcy5kZXZpY2VJbmZvXy5nZXRGaWVsZE9mVmlld0xlZnRFeWUoKTsKICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewogICAgZmllbGRPZlZpZXcgPSB0aGlzLmRldmljZUluZm9fLmdldEZpZWxkT2ZWaWV3UmlnaHRFeWUoKTsKICB9IGVsc2UgewogICAgY29uc29sZS5lcnJvcignSW52YWxpZCBleWUgcHJvdmlkZWQ6ICVzJywgd2hpY2hFeWUpOwogICAgcmV0dXJuIG51bGw7CiAgfQogIHJldHVybiBmaWVsZE9mVmlldzsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fZ2V0RXllT2Zmc2V0ID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CiAgdmFyIG9mZnNldDsKICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKICAgIG9mZnNldCA9IFstdGhpcy5kZXZpY2VJbmZvXy52aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgKiAwLjUsIDAuMCwgMC4wXTsKICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewogICAgb2Zmc2V0ID0gW3RoaXMuZGV2aWNlSW5mb18udmlld2VyLmludGVyTGVuc0Rpc3RhbmNlICogMC41LCAwLjAsIDAuMF07CiAgfSBlbHNlIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZXllIHByb3ZpZGVkOiAlcycsIHdoaWNoRXllKTsKICAgIHJldHVybiBudWxsOwogIH0KICByZXR1cm4gb2Zmc2V0Owp9OwpDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKICB2YXIgb2Zmc2V0ID0gdGhpcy5fZ2V0RXllT2Zmc2V0KHdoaWNoRXllKTsKICB2YXIgZmllbGRPZlZpZXcgPSB0aGlzLl9nZXRGaWVsZE9mVmlldyh3aGljaEV5ZSk7CiAgdmFyIGV5ZVBhcmFtcyA9IHsKICAgIG9mZnNldDogb2Zmc2V0LAogICAgcmVuZGVyV2lkdGg6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLndpZHRoICogMC41ICogdGhpcy5idWZmZXJTY2FsZV8sCiAgICByZW5kZXJIZWlnaHQ6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLmhlaWdodCAqIHRoaXMuYnVmZmVyU2NhbGVfCiAgfTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXllUGFyYW1zLCAnZmllbGRPZlZpZXcnLCB7CiAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRmllbGRPZlZpZXcnLCAnVlJGcmFtZURhdGFcJ3MgcHJvamVjdGlvbiBtYXRyaWNlcycpOwogICAgICByZXR1cm4gZmllbGRPZlZpZXc7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGV5ZVBhcmFtczsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbkRldmljZVBhcmFtc1VwZGF0ZWRfID0gZnVuY3Rpb24gKG5ld1BhcmFtcykgewogIGlmICh0aGlzLmNvbmZpZy5ERUJVRykgewogICAgY29uc29sZS5sb2coJ0RQREIgcmVwb3J0ZWQgdGhhdCBkZXZpY2UgcGFyYW1zIHdlcmUgdXBkYXRlZC4nKTsKICB9CiAgdGhpcy5kZXZpY2VJbmZvXy51cGRhdGVEZXZpY2VQYXJhbXMobmV3UGFyYW1zKTsKICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKICB9Cn07CkNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUudXBkYXRlQm91bmRzXyA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5sYXllcl8gJiYgdGhpcy5kaXN0b3J0ZXJfICYmICh0aGlzLmxheWVyXy5sZWZ0Qm91bmRzIHx8IHRoaXMubGF5ZXJfLnJpZ2h0Qm91bmRzKSkgewogICAgdGhpcy5kaXN0b3J0ZXJfLnNldFRleHR1cmVCb3VuZHModGhpcy5sYXllcl8ubGVmdEJvdW5kcywgdGhpcy5sYXllcl8ucmlnaHRCb3VuZHMpOwogIH0KfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5iZWdpblByZXNlbnRfID0gZnVuY3Rpb24gKCkgewogIHZhciBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbCcpOwogIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpOwogIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwogIGlmICghZ2wpIHJldHVybjsKICBpZiAodGhpcy5sYXllcl8ucHJlZGlzdG9ydGVkKSB7CiAgICBpZiAoIXRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCkgewogICAgICBnbC5jYW52YXMud2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpICogdGhpcy5idWZmZXJTY2FsZV87CiAgICAgIGdsLmNhbnZhcy5oZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKSAqIHRoaXMuYnVmZmVyU2NhbGVfOwogICAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG5ldyBDYXJkYm9hcmRVSShnbCk7CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmICghdGhpcy5jb25maWcuQ0FSREJPQVJEX1VJX0RJU0FCTEVEKSB7CiAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbmV3IENhcmRib2FyZFVJKGdsKTsKICAgIH0KICAgIHRoaXMuZGlzdG9ydGVyXyA9IG5ldyBDYXJkYm9hcmREaXN0b3J0ZXIoZ2wsIHRoaXMuY2FyZGJvYXJkVUlfLCB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEUsIHRoaXMuY29uZmlnLkRJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUyk7CiAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKICB9CiAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CiAgICB0aGlzLmNhcmRib2FyZFVJXy5saXN0ZW4oZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uc2hvdyh0aGlzLmxheWVyXy5zb3VyY2UucGFyZW50RWxlbWVudCk7CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy5leGl0UHJlc2VudCgpOwogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICB9LmJpbmQodGhpcykpOwogIH0KICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CiAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewogICAgICB0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18uc2hvd1RlbXBvcmFyaWx5KDMwMDAsIHRoaXMubGF5ZXJfLnNvdXJjZS5wYXJlbnRFbGVtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKICAgIH0KICB9CiAgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIgPSB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VfLmJpbmQodGhpcyk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIpOwogIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIgPSB0aGlzLnVwZGF0ZUJvdW5kc18uYmluZCh0aGlzKTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIpOwogIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5lbmRQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICB0aGlzLmRpc3RvcnRlcl8uZGVzdHJveSgpOwogICAgdGhpcy5kaXN0b3J0ZXJfID0gbnVsbDsKICB9CiAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CiAgICB0aGlzLmNhcmRib2FyZFVJXy5kZXN0cm95KCk7CiAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG51bGw7CiAgfQogIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy5oaWRlKCk7CiAgfQogIHRoaXMudmlld2VyU2VsZWN0b3JfLmhpZGUoKTsKICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9yaWVudGF0aW9uSGFuZGxlcik7CiAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyKTsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS51cGRhdGVQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKICB0aGlzLmVuZFByZXNlbnRfKCk7CiAgdGhpcy5iZWdpblByZXNlbnRfKCk7Cn07CkNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewogIGlmICh0aGlzLmRpc3RvcnRlcl8pIHsKICAgIHRoaXMudXBkYXRlQm91bmRzXygpOwogICAgdGhpcy5kaXN0b3J0ZXJfLnN1Ym1pdEZyYW1lKCk7CiAgfSBlbHNlIGlmICh0aGlzLmNhcmRib2FyZFVJXyAmJiB0aGlzLmxheWVyXykgewogICAgdmFyIGNhbnZhcyA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbCcpLmNhbnZhczsKICAgIGlmIChjYW52YXMud2lkdGggIT0gdGhpcy5sYXN0V2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSB0aGlzLmxhc3RIZWlnaHQpIHsKICAgICAgdGhpcy5jYXJkYm9hcmRVSV8ub25SZXNpemUoKTsKICAgIH0KICAgIHRoaXMubGFzdFdpZHRoID0gY2FudmFzLndpZHRoOwogICAgdGhpcy5sYXN0SGVpZ2h0ID0gY2FudmFzLmhlaWdodDsKICAgIHRoaXMuY2FyZGJvYXJkVUlfLnJlbmRlcigpOwogIH0KfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChlKSB7CiAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uaGlkZSgpOwogIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKICB9CiAgdGhpcy5vblJlc2l6ZV8oKTsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblJlc2l6ZV8gPSBmdW5jdGlvbiAoZSkgewogIGlmICh0aGlzLmxheWVyXykgewogICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CiAgICB2YXIgY3NzUHJvcGVydGllcyA9IFsncG9zaXRpb246IGFic29sdXRlJywgJ3RvcDogMCcsICdsZWZ0OiAwJywKICAgICd3aWR0aDogMTAwdncnLCAnaGVpZ2h0OiAxMDB2aCcsICdib3JkZXI6IDAnLCAnbWFyZ2luOiAwJywKICAgICdwYWRkaW5nOiAwcHgnLCAnYm94LXNpemluZzogY29udGVudC1ib3gnXTsKICAgIGdsLmNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY3NzUHJvcGVydGllcy5qb2luKCc7ICcpICsgJzsnKTsKICAgIHNhZmFyaUNzc1NpemVXb3JrYXJvdW5kKGdsLmNhbnZhcyk7CiAgfQp9OwpDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLm9uVmlld2VyQ2hhbmdlZF8gPSBmdW5jdGlvbiAodmlld2VyKSB7CiAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodmlld2VyKTsKICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKICB9CiAgdGhpcy5maXJlVlJEaXNwbGF5RGV2aWNlUGFyYW1zQ2hhbmdlXygpOwp9OwpDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlEZXZpY2VQYXJhbXNDaGFuZ2VfID0gZnVuY3Rpb24gKCkgewogIHZhciBldmVudCA9IG5ldyBDdXN0b21FdmVudCgndnJkaXNwbGF5ZGV2aWNlcGFyYW1zY2hhbmdlJywgewogICAgZGV0YWlsOiB7CiAgICAgIHZyZGlzcGxheTogdGhpcywKICAgICAgZGV2aWNlSW5mbzogdGhpcy5kZXZpY2VJbmZvXwogICAgfQogIH0pOwogIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKfTsKQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRnJhbWVEYXRhID0gVlJGcmFtZURhdGE7CkNhcmRib2FyZFZSRGlzcGxheS5WUkRpc3BsYXkgPSBWUkRpc3BsYXk7CnJldHVybiBDYXJkYm9hcmRWUkRpc3BsYXk7Cn0pKSk7Cn0pOwp2YXIgQ2FyZGJvYXJkVlJEaXNwbGF5ID0gdW53cmFwRXhwb3J0cyhjYXJkYm9hcmRWckRpc3BsYXkpOwoKdmFyIHZlcnNpb24gPSAiMC4xMC4xMCI7Cgp2YXIgRGVmYXVsdENvbmZpZyA9IHsKICBBRERJVElPTkFMX1ZJRVdFUlM6IFtdLAogIERFRkFVTFRfVklFV0VSOiAnJywKICBQUk9WSURFX01PQklMRV9WUkRJU1BMQVk6IHRydWUsCiAgTU9CSUxFX1dBS0VfTE9DSzogdHJ1ZSwKICBERUJVRzogZmFsc2UsCiAgRFBEQl9VUkw6ICdodHRwczovL2RwZGIud2VidnIucm9ja3MvZHBkYi5qc29uJywKICBLX0ZJTFRFUjogMC45OCwKICBQUkVESUNUSU9OX1RJTUVfUzogMC4wNDAsCiAgQ0FSREJPQVJEX1VJX0RJU0FCTEVEOiBmYWxzZSwKICBST1RBVEVfSU5TVFJVQ1RJT05TX0RJU0FCTEVEOiBmYWxzZSwKICBZQVdfT05MWTogZmFsc2UsCiAgQlVGRkVSX1NDQUxFOiAwLjUsCiAgRElSVFlfU1VCTUlUX0ZSQU1FX0JJTkRJTkdTOiBmYWxzZQp9OwoKZnVuY3Rpb24gV2ViVlJQb2x5ZmlsbChjb25maWcpIHsKICB0aGlzLmNvbmZpZyA9IGV4dGVuZChleHRlbmQoe30sIERlZmF1bHRDb25maWcpLCBjb25maWcpOwogIHRoaXMucG9seWZpbGxEaXNwbGF5cyA9IFtdOwogIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwogIHRoaXMuaGFzTmF0aXZlID0gJ2dldFZSRGlzcGxheXMnIGluIG5hdmlnYXRvcjsKICB0aGlzLm5hdGl2ZSA9IHt9OwogIHRoaXMubmF0aXZlLmdldFZSRGlzcGxheXMgPSBuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5czsKICB0aGlzLm5hdGl2ZS5WUkZyYW1lRGF0YSA9IHdpbmRvdy5WUkZyYW1lRGF0YTsKICB0aGlzLm5hdGl2ZS5WUkRpc3BsYXkgPSB3aW5kb3cuVlJEaXNwbGF5OwogIGlmICghdGhpcy5oYXNOYXRpdmUgfHwgdGhpcy5jb25maWcuUFJPVklERV9NT0JJTEVfVlJESVNQTEFZICYmIGlzTW9iaWxlKCkpIHsKICAgIHRoaXMuZW5hYmxlKCk7CiAgICB0aGlzLmdldFZSRGlzcGxheXMoKS50aGVuKGZ1bmN0aW9uIChkaXNwbGF5cykgewogICAgICBpZiAoZGlzcGxheXMgJiYgZGlzcGxheXNbMF0gJiYgZGlzcGxheXNbMF0uZmlyZVZSRGlzcGxheUNvbm5lY3RfKSB7CiAgICAgICAgZGlzcGxheXNbMF0uZmlyZVZSRGlzcGxheUNvbm5lY3RfKCk7CiAgICAgIH0KICAgIH0pOwogIH0KfQpXZWJWUlBvbHlmaWxsLnByb3RvdHlwZS5nZXRQb2x5ZmlsbERpc3BsYXlzID0gZnVuY3Rpb24gKCkgewogIGlmICh0aGlzLl9wb2x5ZmlsbERpc3BsYXlzUG9wdWxhdGVkKSB7CiAgICByZXR1cm4gdGhpcy5wb2x5ZmlsbERpc3BsYXlzOwogIH0KICBpZiAoaXNNb2JpbGUoKSkgewogICAgdmFyIHZyRGlzcGxheSA9IG5ldyBDYXJkYm9hcmRWUkRpc3BsYXkoewogICAgICBBRERJVElPTkFMX1ZJRVdFUlM6IHRoaXMuY29uZmlnLkFERElUSU9OQUxfVklFV0VSUywKICAgICAgREVGQVVMVF9WSUVXRVI6IHRoaXMuY29uZmlnLkRFRkFVTFRfVklFV0VSLAogICAgICBNT0JJTEVfV0FLRV9MT0NLOiB0aGlzLmNvbmZpZy5NT0JJTEVfV0FLRV9MT0NLLAogICAgICBERUJVRzogdGhpcy5jb25maWcuREVCVUcsCiAgICAgIERQREJfVVJMOiB0aGlzLmNvbmZpZy5EUERCX1VSTCwKICAgICAgQ0FSREJPQVJEX1VJX0RJU0FCTEVEOiB0aGlzLmNvbmZpZy5DQVJEQk9BUkRfVUlfRElTQUJMRUQsCiAgICAgIEtfRklMVEVSOiB0aGlzLmNvbmZpZy5LX0ZJTFRFUiwKICAgICAgUFJFRElDVElPTl9USU1FX1M6IHRoaXMuY29uZmlnLlBSRURJQ1RJT05fVElNRV9TLAogICAgICBST1RBVEVfSU5TVFJVQ1RJT05TX0RJU0FCTEVEOiB0aGlzLmNvbmZpZy5ST1RBVEVfSU5TVFJVQ1RJT05TX0RJU0FCTEVELAogICAgICBZQVdfT05MWTogdGhpcy5jb25maWcuWUFXX09OTFksCiAgICAgIEJVRkZFUl9TQ0FMRTogdGhpcy5jb25maWcuQlVGRkVSX1NDQUxFLAogICAgICBESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1M6IHRoaXMuY29uZmlnLkRJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUwogICAgfSk7CiAgICB0aGlzLnBvbHlmaWxsRGlzcGxheXMucHVzaCh2ckRpc3BsYXkpOwogIH0KICB0aGlzLl9wb2x5ZmlsbERpc3BsYXlzUG9wdWxhdGVkID0gdHJ1ZTsKICByZXR1cm4gdGhpcy5wb2x5ZmlsbERpc3BsYXlzOwp9OwpXZWJWUlBvbHlmaWxsLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiAoKSB7CiAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICBpZiAodGhpcy5oYXNOYXRpdmUgJiYgdGhpcy5uYXRpdmUuVlJGcmFtZURhdGEpIHsKICAgIHZhciBOYXRpdmVWUkZyYW1lRGF0YSA9IHRoaXMubmF0aXZlLlZSRnJhbWVEYXRhOwogICAgdmFyIG5hdGl2ZUZyYW1lRGF0YSA9IG5ldyB0aGlzLm5hdGl2ZS5WUkZyYW1lRGF0YSgpOwogICAgdmFyIG5hdGl2ZUdldEZyYW1lRGF0YSA9IHRoaXMubmF0aXZlLlZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhOwogICAgd2luZG93LlZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhID0gZnVuY3Rpb24gKGZyYW1lRGF0YSkgewogICAgICBpZiAoZnJhbWVEYXRhIGluc3RhbmNlb2YgTmF0aXZlVlJGcmFtZURhdGEpIHsKICAgICAgICBuYXRpdmVHZXRGcmFtZURhdGEuY2FsbCh0aGlzLCBmcmFtZURhdGEpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBuYXRpdmVHZXRGcmFtZURhdGEuY2FsbCh0aGlzLCBuYXRpdmVGcmFtZURhdGEpOwogICAgICBmcmFtZURhdGEucG9zZSA9IG5hdGl2ZUZyYW1lRGF0YS5wb3NlOwogICAgICBjb3B5QXJyYXkobmF0aXZlRnJhbWVEYXRhLmxlZnRQcm9qZWN0aW9uTWF0cml4LCBmcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXgpOwogICAgICBjb3B5QXJyYXkobmF0aXZlRnJhbWVEYXRhLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCwgZnJhbWVEYXRhLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCk7CiAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEubGVmdFZpZXdNYXRyaXgsIGZyYW1lRGF0YS5sZWZ0Vmlld01hdHJpeCk7CiAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEucmlnaHRWaWV3TWF0cml4LCBmcmFtZURhdGEucmlnaHRWaWV3TWF0cml4KTsKICAgIH07CiAgfQogIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzID0gdGhpcy5nZXRWUkRpc3BsYXlzLmJpbmQodGhpcyk7CiAgd2luZG93LlZSRGlzcGxheSA9IENhcmRib2FyZFZSRGlzcGxheS5WUkRpc3BsYXk7CiAgd2luZG93LlZSRnJhbWVEYXRhID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRnJhbWVEYXRhOwp9OwpXZWJWUlBvbHlmaWxsLnByb3RvdHlwZS5nZXRWUkRpc3BsYXlzID0gZnVuY3Rpb24gKCkgewogIHZhciBfdGhpcyA9IHRoaXM7CiAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnOwogIGlmICghdGhpcy5oYXNOYXRpdmUpIHsKICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5nZXRQb2x5ZmlsbERpc3BsYXlzKCkpOwogIH0KICByZXR1cm4gdGhpcy5uYXRpdmUuZ2V0VlJEaXNwbGF5cy5jYWxsKG5hdmlnYXRvcikudGhlbihmdW5jdGlvbiAobmF0aXZlRGlzcGxheXMpIHsKICAgIHJldHVybiBuYXRpdmVEaXNwbGF5cy5sZW5ndGggPiAwID8gbmF0aXZlRGlzcGxheXMgOiBfdGhpcy5nZXRQb2x5ZmlsbERpc3BsYXlzKCk7CiAgfSk7Cn07CldlYlZSUG9seWZpbGwudmVyc2lvbiA9IHZlcnNpb247CldlYlZSUG9seWZpbGwuVlJGcmFtZURhdGEgPSBDYXJkYm9hcmRWUkRpc3BsYXkuVlJGcmFtZURhdGE7CldlYlZSUG9seWZpbGwuVlJEaXNwbGF5ID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRGlzcGxheTsKCgp2YXIgd2VidnJQb2x5ZmlsbCA9IE9iamVjdC5mcmVlemUoewoJZGVmYXVsdDogV2ViVlJQb2x5ZmlsbAp9KTsKCnZhciByZXF1aXJlJCQwID0gKCB3ZWJ2clBvbHlmaWxsICYmIFdlYlZSUG9seWZpbGwgKSB8fCB3ZWJ2clBvbHlmaWxsOwoKaWYgKHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tbW9uanNHbG9iYWwud2luZG93KSB7CiAgaWYgKCFjb21tb25qc0dsb2JhbC5kb2N1bWVudCkgewogICAgY29tbW9uanNHbG9iYWwuZG9jdW1lbnQgPSBjb21tb25qc0dsb2JhbC53aW5kb3cuZG9jdW1lbnQ7CiAgfQogIGlmICghY29tbW9uanNHbG9iYWwubmF2aWdhdG9yKSB7CiAgICBjb21tb25qc0dsb2JhbC5uYXZpZ2F0b3IgPSBjb21tb25qc0dsb2JhbC53aW5kb3cubmF2aWdhdG9yOwogIH0KfQp2YXIgc3JjID0gcmVxdWlyZSQkMDsKCnJldHVybiBzcmM7Cgp9KSkpOwoKfSkuY2FsbCh0aGlzLHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCgp9LHt9XSw1MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBuZXdsaW5lID0gL1xuLwp2YXIgbmV3bGluZUNoYXIgPSAnXG4nCnZhciB3aGl0ZXNwYWNlID0gL1xzLwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbih0ZXh0LCBvcHQpIHsKICAgIHZhciBsaW5lcyA9IG1vZHVsZS5leHBvcnRzLmxpbmVzKHRleHQsIG9wdCkKICAgIHJldHVybiBsaW5lcy5tYXAoZnVuY3Rpb24obGluZSkgewogICAgICAgIHJldHVybiB0ZXh0LnN1YnN0cmluZyhsaW5lLnN0YXJ0LCBsaW5lLmVuZCkKICAgIH0pLmpvaW4oJ1xuJykKfQoKbW9kdWxlLmV4cG9ydHMubGluZXMgPSBmdW5jdGlvbiB3b3Jkd3JhcCh0ZXh0LCBvcHQpIHsKICAgIG9wdCA9IG9wdHx8e30KCiAgICAvL3plcm8gd2lkdGggcmVzdWx0cyBpbiBub3RoaW5nIHZpc2libGUKICAgIGlmIChvcHQud2lkdGggPT09IDAgJiYgb3B0Lm1vZGUgIT09ICdub3dyYXAnKSAKICAgICAgICByZXR1cm4gW10KCiAgICB0ZXh0ID0gdGV4dHx8JycKICAgIHZhciB3aWR0aCA9IHR5cGVvZiBvcHQud2lkdGggPT09ICdudW1iZXInID8gb3B0LndpZHRoIDogTnVtYmVyLk1BWF9WQUxVRQogICAgdmFyIHN0YXJ0ID0gTWF0aC5tYXgoMCwgb3B0LnN0YXJ0fHwwKQogICAgdmFyIGVuZCA9IHR5cGVvZiBvcHQuZW5kID09PSAnbnVtYmVyJyA/IG9wdC5lbmQgOiB0ZXh0Lmxlbmd0aAogICAgdmFyIG1vZGUgPSBvcHQubW9kZQoKICAgIHZhciBtZWFzdXJlID0gb3B0Lm1lYXN1cmUgfHwgbW9ub3NwYWNlCiAgICBpZiAobW9kZSA9PT0gJ3ByZScpCiAgICAgICAgcmV0dXJuIHByZShtZWFzdXJlLCB0ZXh0LCBzdGFydCwgZW5kLCB3aWR0aCkKICAgIGVsc2UKICAgICAgICByZXR1cm4gZ3JlZWR5KG1lYXN1cmUsIHRleHQsIHN0YXJ0LCBlbmQsIHdpZHRoLCBtb2RlKQp9CgpmdW5jdGlvbiBpZHhPZih0ZXh0LCBjaHIsIHN0YXJ0LCBlbmQpIHsKICAgIHZhciBpZHggPSB0ZXh0LmluZGV4T2YoY2hyLCBzdGFydCkKICAgIGlmIChpZHggPT09IC0xIHx8IGlkeCA+IGVuZCkKICAgICAgICByZXR1cm4gZW5kCiAgICByZXR1cm4gaWR4Cn0KCmZ1bmN0aW9uIGlzV2hpdGVzcGFjZShjaHIpIHsKICAgIHJldHVybiB3aGl0ZXNwYWNlLnRlc3QoY2hyKQp9CgpmdW5jdGlvbiBwcmUobWVhc3VyZSwgdGV4dCwgc3RhcnQsIGVuZCwgd2lkdGgpIHsKICAgIHZhciBsaW5lcyA9IFtdCiAgICB2YXIgbGluZVN0YXJ0ID0gc3RhcnQKICAgIGZvciAodmFyIGk9c3RhcnQ7IGk8ZW5kICYmIGk8dGV4dC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjaHIgPSB0ZXh0LmNoYXJBdChpKQogICAgICAgIHZhciBpc05ld2xpbmUgPSBuZXdsaW5lLnRlc3QoY2hyKQoKICAgICAgICAvL0lmIHdlJ3ZlIHJlYWNoZWQgYSBuZXdsaW5lLCB0aGVuIHN0ZXAgZG93biBhIGxpbmUKICAgICAgICAvL09yIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIEVPRgogICAgICAgIGlmIChpc05ld2xpbmUgfHwgaT09PWVuZC0xKSB7CiAgICAgICAgICAgIHZhciBsaW5lRW5kID0gaXNOZXdsaW5lID8gaSA6IGkrMQogICAgICAgICAgICB2YXIgbWVhc3VyZWQgPSBtZWFzdXJlKHRleHQsIGxpbmVTdGFydCwgbGluZUVuZCwgd2lkdGgpCiAgICAgICAgICAgIGxpbmVzLnB1c2gobWVhc3VyZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBsaW5lU3RhcnQgPSBpKzEKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gbGluZXMKfQoKZnVuY3Rpb24gZ3JlZWR5KG1lYXN1cmUsIHRleHQsIHN0YXJ0LCBlbmQsIHdpZHRoLCBtb2RlKSB7CiAgICAvL0EgZ3JlZWR5IHdvcmQgd3JhcHBlciBiYXNlZCBvbiBMaWJHRFggYWxnb3JpdGhtCiAgICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9saWJnZHgvbGliZ2R4L2Jsb2IvbWFzdGVyL2dkeC9zcmMvY29tL2JhZGxvZ2ljL2dkeC9ncmFwaGljcy9nMmQvQml0bWFwRm9udENhY2hlLmphdmEKICAgIHZhciBsaW5lcyA9IFtdCgogICAgdmFyIHRlc3RXaWR0aCA9IHdpZHRoCiAgICAvL2lmICdub3dyYXAnIGlzIHNwZWNpZmllZCwgd2Ugb25seSB3cmFwIG9uIG5ld2xpbmUgY2hhcnMKICAgIGlmIChtb2RlID09PSAnbm93cmFwJykKICAgICAgICB0ZXN0V2lkdGggPSBOdW1iZXIuTUFYX1ZBTFVFCgogICAgd2hpbGUgKHN0YXJ0IDwgZW5kICYmIHN0YXJ0IDwgdGV4dC5sZW5ndGgpIHsKICAgICAgICAvL2dldCBuZXh0IG5ld2xpbmUgcG9zaXRpb24KICAgICAgICB2YXIgbmV3TGluZSA9IGlkeE9mKHRleHQsIG5ld2xpbmVDaGFyLCBzdGFydCwgZW5kKQoKICAgICAgICAvL2VhdCB3aGl0ZXNwYWNlIGF0IHN0YXJ0IG9mIGxpbmUKICAgICAgICB3aGlsZSAoc3RhcnQgPCBuZXdMaW5lKSB7CiAgICAgICAgICAgIGlmICghaXNXaGl0ZXNwYWNlKCB0ZXh0LmNoYXJBdChzdGFydCkgKSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHN0YXJ0KysKICAgICAgICB9CgogICAgICAgIC8vZGV0ZXJtaW5lIHZpc2libGUgIyBvZiBnbHlwaHMgZm9yIHRoZSBhdmFpbGFibGUgd2lkdGgKICAgICAgICB2YXIgbWVhc3VyZWQgPSBtZWFzdXJlKHRleHQsIHN0YXJ0LCBuZXdMaW5lLCB0ZXN0V2lkdGgpCgogICAgICAgIHZhciBsaW5lRW5kID0gc3RhcnQgKyAobWVhc3VyZWQuZW5kLW1lYXN1cmVkLnN0YXJ0KQogICAgICAgIHZhciBuZXh0U3RhcnQgPSBsaW5lRW5kICsgbmV3bGluZUNoYXIubGVuZ3RoCgogICAgICAgIC8vaWYgd2UgaGFkIHRvIGN1dCB0aGUgbGluZSBiZWZvcmUgdGhlIG5leHQgbmV3bGluZS4uLgogICAgICAgIGlmIChsaW5lRW5kIDwgbmV3TGluZSkgewogICAgICAgICAgICAvL2ZpbmQgY2hhciB0byBicmVhayBvbgogICAgICAgICAgICB3aGlsZSAobGluZUVuZCA+IHN0YXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNXaGl0ZXNwYWNlKHRleHQuY2hhckF0KGxpbmVFbmQpKSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgbGluZUVuZC0tCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpbmVFbmQgPT09IHN0YXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAobmV4dFN0YXJ0ID4gc3RhcnQgKyBuZXdsaW5lQ2hhci5sZW5ndGgpIG5leHRTdGFydC0tCiAgICAgICAgICAgICAgICBsaW5lRW5kID0gbmV4dFN0YXJ0IC8vIElmIG5vIGNoYXJhY3RlcnMgdG8gYnJlYWssIHNob3cgYWxsLgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV4dFN0YXJ0ID0gbGluZUVuZAogICAgICAgICAgICAgICAgLy9lYXQgd2hpdGVzcGFjZSBhdCBlbmQgb2YgbGluZQogICAgICAgICAgICAgICAgd2hpbGUgKGxpbmVFbmQgPiBzdGFydCkgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNXaGl0ZXNwYWNlKHRleHQuY2hhckF0KGxpbmVFbmQgLSBuZXdsaW5lQ2hhci5sZW5ndGgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBsaW5lRW5kLS0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobGluZUVuZCA+PSBzdGFydCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gbWVhc3VyZSh0ZXh0LCBzdGFydCwgbGluZUVuZCwgdGVzdFdpZHRoKQogICAgICAgICAgICBsaW5lcy5wdXNoKHJlc3VsdCkKICAgICAgICB9CiAgICAgICAgc3RhcnQgPSBuZXh0U3RhcnQKICAgIH0KICAgIHJldHVybiBsaW5lcwp9CgovL2RldGVybWluZXMgdGhlIHZpc2libGUgbnVtYmVyIG9mIGdseXBocyB3aXRoaW4gYSBnaXZlbiB3aWR0aApmdW5jdGlvbiBtb25vc3BhY2UodGV4dCwgc3RhcnQsIGVuZCwgd2lkdGgpIHsKICAgIHZhciBnbHlwaHMgPSBNYXRoLm1pbih3aWR0aCwgZW5kLXN0YXJ0KQogICAgcmV0dXJuIHsKICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgZW5kOiBzdGFydCtnbHlwaHMKICAgIH0KfQp9LHt9XSw1MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKdmFyIHdpbmRvdyA9IF9kZXJlcV8oImdsb2JhbC93aW5kb3ciKQp2YXIgaXNGdW5jdGlvbiA9IF9kZXJlcV8oImlzLWZ1bmN0aW9uIikKdmFyIHBhcnNlSGVhZGVycyA9IF9kZXJlcV8oInBhcnNlLWhlYWRlcnMiKQp2YXIgeHRlbmQgPSBfZGVyZXFfKCJ4dGVuZCIpCgptb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVhIUgovLyBBbGxvdyB1c2Ugb2YgZGVmYXVsdCBpbXBvcnQgc3ludGF4IGluIFR5cGVTY3JpcHQKbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IGNyZWF0ZVhIUjsKY3JlYXRlWEhSLlhNTEh0dHBSZXF1ZXN0ID0gd2luZG93LlhNTEh0dHBSZXF1ZXN0IHx8IG5vb3AKY3JlYXRlWEhSLlhEb21haW5SZXF1ZXN0ID0gIndpdGhDcmVkZW50aWFscyIgaW4gKG5ldyBjcmVhdGVYSFIuWE1MSHR0cFJlcXVlc3QoKSkgPyBjcmVhdGVYSFIuWE1MSHR0cFJlcXVlc3QgOiB3aW5kb3cuWERvbWFpblJlcXVlc3QKCmZvckVhY2hBcnJheShbImdldCIsICJwdXQiLCAicG9zdCIsICJwYXRjaCIsICJoZWFkIiwgImRlbGV0ZSJdLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIGNyZWF0ZVhIUlttZXRob2QgPT09ICJkZWxldGUiID8gImRlbCIgOiBtZXRob2RdID0gZnVuY3Rpb24odXJpLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICAgIG9wdGlvbnMgPSBpbml0UGFyYW1zKHVyaSwgb3B0aW9ucywgY2FsbGJhY2spCiAgICAgICAgb3B0aW9ucy5tZXRob2QgPSBtZXRob2QudG9VcHBlckNhc2UoKQogICAgICAgIHJldHVybiBfY3JlYXRlWEhSKG9wdGlvbnMpCiAgICB9Cn0pCgpmdW5jdGlvbiBmb3JFYWNoQXJyYXkoYXJyYXksIGl0ZXJhdG9yKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaXRlcmF0b3IoYXJyYXlbaV0pCiAgICB9Cn0KCmZ1bmN0aW9uIGlzRW1wdHkob2JqKXsKICAgIGZvcih2YXIgaSBpbiBvYmopewogICAgICAgIGlmKG9iai5oYXNPd25Qcm9wZXJ0eShpKSkgcmV0dXJuIGZhbHNlCiAgICB9CiAgICByZXR1cm4gdHJ1ZQp9CgpmdW5jdGlvbiBpbml0UGFyYW1zKHVyaSwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgIHZhciBwYXJhbXMgPSB1cmkKCiAgICBpZiAoaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucwogICAgICAgIGlmICh0eXBlb2YgdXJpID09PSAic3RyaW5nIikgewogICAgICAgICAgICBwYXJhbXMgPSB7dXJpOnVyaX0KICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHBhcmFtcyA9IHh0ZW5kKG9wdGlvbnMsIHt1cmk6IHVyaX0pCiAgICB9CgogICAgcGFyYW1zLmNhbGxiYWNrID0gY2FsbGJhY2sKICAgIHJldHVybiBwYXJhbXMKfQoKZnVuY3Rpb24gY3JlYXRlWEhSKHVyaSwgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgIG9wdGlvbnMgPSBpbml0UGFyYW1zKHVyaSwgb3B0aW9ucywgY2FsbGJhY2spCiAgICByZXR1cm4gX2NyZWF0ZVhIUihvcHRpb25zKQp9CgpmdW5jdGlvbiBfY3JlYXRlWEhSKG9wdGlvbnMpIHsKICAgIGlmKHR5cGVvZiBvcHRpb25zLmNhbGxiYWNrID09PSAidW5kZWZpbmVkIil7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjYWxsYmFjayBhcmd1bWVudCBtaXNzaW5nIikKICAgIH0KCiAgICB2YXIgY2FsbGVkID0gZmFsc2UKICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNiT25jZShlcnIsIHJlc3BvbnNlLCBib2R5KXsKICAgICAgICBpZighY2FsbGVkKXsKICAgICAgICAgICAgY2FsbGVkID0gdHJ1ZQogICAgICAgICAgICBvcHRpb25zLmNhbGxiYWNrKGVyciwgcmVzcG9uc2UsIGJvZHkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlYWR5c3RhdGVjaGFuZ2UoKSB7CiAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZEZ1bmMsIDApCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJvZHkoKSB7CiAgICAgICAgLy8gQ2hyb21lIHdpdGggcmVxdWVzdFR5cGU9YmxvYiB0aHJvd3MgZXJyb3JzIGFycm91bmQgd2hlbiBldmVuIHRlc3RpbmcgYWNjZXNzIHRvIHJlc3BvbnNlVGV4dAogICAgICAgIHZhciBib2R5ID0gdW5kZWZpbmVkCgogICAgICAgIGlmICh4aHIucmVzcG9uc2UpIHsKICAgICAgICAgICAgYm9keSA9IHhoci5yZXNwb25zZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJvZHkgPSB4aHIucmVzcG9uc2VUZXh0IHx8IGdldFhtbCh4aHIpCiAgICAgICAgfQoKICAgICAgICBpZiAoaXNKc29uKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBib2R5ID0gSlNPTi5wYXJzZShib2R5KQogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJvZHkKICAgIH0KCiAgICBmdW5jdGlvbiBlcnJvckZ1bmMoZXZ0KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRUaW1lcikKICAgICAgICBpZighKGV2dCBpbnN0YW5jZW9mIEVycm9yKSl7CiAgICAgICAgICAgIGV2dCA9IG5ldyBFcnJvcigiIiArIChldnQgfHwgIlVua25vd24gWE1MSHR0cFJlcXVlc3QgRXJyb3IiKSApCiAgICAgICAgfQogICAgICAgIGV2dC5zdGF0dXNDb2RlID0gMAogICAgICAgIHJldHVybiBjYWxsYmFjayhldnQsIGZhaWx1cmVSZXNwb25zZSkKICAgIH0KCiAgICAvLyB3aWxsIGxvYWQgdGhlIGRhdGEgJiBwcm9jZXNzIHRoZSByZXNwb25zZSBpbiBhIHNwZWNpYWwgcmVzcG9uc2Ugb2JqZWN0CiAgICBmdW5jdGlvbiBsb2FkRnVuYygpIHsKICAgICAgICBpZiAoYWJvcnRlZCkgcmV0dXJuCiAgICAgICAgdmFyIHN0YXR1cwogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0VGltZXIpCiAgICAgICAgaWYob3B0aW9ucy51c2VYRFIgJiYgeGhyLnN0YXR1cz09PXVuZGVmaW5lZCkgewogICAgICAgICAgICAvL0lFOCBDT1JTIEdFVCBzdWNjZXNzZnVsIHJlc3BvbnNlIGRvZXNuJ3QgaGF2ZSBhIHN0YXR1cyBmaWVsZCwgYnV0IGJvZHkgaXMgZmluZQogICAgICAgICAgICBzdGF0dXMgPSAyMDAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0dXMgPSAoeGhyLnN0YXR1cyA9PT0gMTIyMyA/IDIwNCA6IHhoci5zdGF0dXMpCiAgICAgICAgfQogICAgICAgIHZhciByZXNwb25zZSA9IGZhaWx1cmVSZXNwb25zZQogICAgICAgIHZhciBlcnIgPSBudWxsCgogICAgICAgIGlmIChzdGF0dXMgIT09IDApewogICAgICAgICAgICByZXNwb25zZSA9IHsKICAgICAgICAgICAgICAgIGJvZHk6IGdldEJvZHkoKSwKICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1cywKICAgICAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICAgICAgaGVhZGVyczoge30sCiAgICAgICAgICAgICAgICB1cmw6IHVyaSwKICAgICAgICAgICAgICAgIHJhd1JlcXVlc3Q6IHhocgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMpeyAvL3JlbWVtYmVyIHhociBjYW4gaW4gZmFjdCBiZSBYRFIgZm9yIENPUlMgaW4gSUUKICAgICAgICAgICAgICAgIHJlc3BvbnNlLmhlYWRlcnMgPSBwYXJzZUhlYWRlcnMoeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXJyID0gbmV3IEVycm9yKCJJbnRlcm5hbCBYTUxIdHRwUmVxdWVzdCBFcnJvciIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIsIHJlc3BvbnNlLCByZXNwb25zZS5ib2R5KQogICAgfQoKICAgIHZhciB4aHIgPSBvcHRpb25zLnhociB8fCBudWxsCgogICAgaWYgKCF4aHIpIHsKICAgICAgICBpZiAob3B0aW9ucy5jb3JzIHx8IG9wdGlvbnMudXNlWERSKSB7CiAgICAgICAgICAgIHhociA9IG5ldyBjcmVhdGVYSFIuWERvbWFpblJlcXVlc3QoKQogICAgICAgIH1lbHNlewogICAgICAgICAgICB4aHIgPSBuZXcgY3JlYXRlWEhSLlhNTEh0dHBSZXF1ZXN0KCkKICAgICAgICB9CiAgICB9CgogICAgdmFyIGtleQogICAgdmFyIGFib3J0ZWQKICAgIHZhciB1cmkgPSB4aHIudXJsID0gb3B0aW9ucy51cmkgfHwgb3B0aW9ucy51cmwKICAgIHZhciBtZXRob2QgPSB4aHIubWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgIkdFVCIKICAgIHZhciBib2R5ID0gb3B0aW9ucy5ib2R5IHx8IG9wdGlvbnMuZGF0YQogICAgdmFyIGhlYWRlcnMgPSB4aHIuaGVhZGVycyA9IG9wdGlvbnMuaGVhZGVycyB8fCB7fQogICAgdmFyIHN5bmMgPSAhIW9wdGlvbnMuc3luYwogICAgdmFyIGlzSnNvbiA9IGZhbHNlCiAgICB2YXIgdGltZW91dFRpbWVyCiAgICB2YXIgZmFpbHVyZVJlc3BvbnNlID0gewogICAgICAgIGJvZHk6IHVuZGVmaW5lZCwKICAgICAgICBoZWFkZXJzOiB7fSwKICAgICAgICBzdGF0dXNDb2RlOiAwLAogICAgICAgIG1ldGhvZDogbWV0aG9kLAogICAgICAgIHVybDogdXJpLAogICAgICAgIHJhd1JlcXVlc3Q6IHhocgogICAgfQoKICAgIGlmICgianNvbiIgaW4gb3B0aW9ucyAmJiBvcHRpb25zLmpzb24gIT09IGZhbHNlKSB7CiAgICAgICAgaXNKc29uID0gdHJ1ZQogICAgICAgIGhlYWRlcnNbImFjY2VwdCJdIHx8IGhlYWRlcnNbIkFjY2VwdCJdIHx8IChoZWFkZXJzWyJBY2NlcHQiXSA9ICJhcHBsaWNhdGlvbi9qc29uIikgLy9Eb24ndCBvdmVycmlkZSBleGlzdGluZyBhY2NlcHQgaGVhZGVyIGRlY2xhcmVkIGJ5IHVzZXIKICAgICAgICBpZiAobWV0aG9kICE9PSAiR0VUIiAmJiBtZXRob2QgIT09ICJIRUFEIikgewogICAgICAgICAgICBoZWFkZXJzWyJjb250ZW50LXR5cGUiXSB8fCBoZWFkZXJzWyJDb250ZW50LVR5cGUiXSB8fCAoaGVhZGVyc1siQ29udGVudC1UeXBlIl0gPSAiYXBwbGljYXRpb24vanNvbiIpIC8vRG9uJ3Qgb3ZlcnJpZGUgZXhpc3RpbmcgYWNjZXB0IGhlYWRlciBkZWNsYXJlZCBieSB1c2VyCiAgICAgICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmpzb24gPT09IHRydWUgPyBib2R5IDogb3B0aW9ucy5qc29uKQogICAgICAgIH0KICAgIH0KCiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gcmVhZHlzdGF0ZWNoYW5nZQogICAgeGhyLm9ubG9hZCA9IGxvYWRGdW5jCiAgICB4aHIub25lcnJvciA9IGVycm9yRnVuYwogICAgLy8gSUU5IG11c3QgaGF2ZSBvbnByb2dyZXNzIGJlIHNldCB0byBhIHVuaXF1ZSBmdW5jdGlvbi4KICAgIHhoci5vbnByb2dyZXNzID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vIElFIG11c3QgZGllCiAgICB9CiAgICB4aHIub25hYm9ydCA9IGZ1bmN0aW9uKCl7CiAgICAgICAgYWJvcnRlZCA9IHRydWU7CiAgICB9CiAgICB4aHIub250aW1lb3V0ID0gZXJyb3JGdW5jCiAgICB4aHIub3BlbihtZXRob2QsIHVyaSwgIXN5bmMsIG9wdGlvbnMudXNlcm5hbWUsIG9wdGlvbnMucGFzc3dvcmQpCiAgICAvL2hhcyB0byBiZSBhZnRlciBvcGVuCiAgICBpZighc3luYykgewogICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSAhIW9wdGlvbnMud2l0aENyZWRlbnRpYWxzCiAgICB9CiAgICAvLyBDYW5ub3Qgc2V0IHRpbWVvdXQgd2l0aCBzeW5jIHJlcXVlc3QKICAgIC8vIG5vdCBzZXR0aW5nIHRpbWVvdXQgb24gdGhlIHhociBvYmplY3QsIGJlY2F1c2Ugb2Ygb2xkIHdlYmtpdHMgZXRjLiBub3QgaGFuZGxpbmcgdGhhdCBjb3JyZWN0bHkKICAgIC8vIGJvdGggbnBtJ3MgcmVxdWVzdCBhbmQganF1ZXJ5IDEueCB1c2UgdGhpcyBraW5kIG9mIHRpbWVvdXQsIHNvIHRoaXMgaXMgYmVpbmcgY29uc2lzdGVudAogICAgaWYgKCFzeW5jICYmIG9wdGlvbnMudGltZW91dCA+IDAgKSB7CiAgICAgICAgdGltZW91dFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICBpZiAoYWJvcnRlZCkgcmV0dXJuCiAgICAgICAgICAgIGFib3J0ZWQgPSB0cnVlLy9JRTkgbWF5IHN0aWxsIGNhbGwgcmVhZHlzdGF0ZWNoYW5nZQogICAgICAgICAgICB4aHIuYWJvcnQoInRpbWVvdXQiKQogICAgICAgICAgICB2YXIgZSA9IG5ldyBFcnJvcigiWE1MSHR0cFJlcXVlc3QgdGltZW91dCIpCiAgICAgICAgICAgIGUuY29kZSA9ICJFVElNRURPVVQiCiAgICAgICAgICAgIGVycm9yRnVuYyhlKQogICAgICAgIH0sIG9wdGlvbnMudGltZW91dCApCiAgICB9CgogICAgaWYgKHhoci5zZXRSZXF1ZXN0SGVhZGVyKSB7CiAgICAgICAgZm9yKGtleSBpbiBoZWFkZXJzKXsKICAgICAgICAgICAgaWYoaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKXsKICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChvcHRpb25zLmhlYWRlcnMgJiYgIWlzRW1wdHkob3B0aW9ucy5oZWFkZXJzKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiSGVhZGVycyBjYW5ub3QgYmUgc2V0IG9uIGFuIFhEb21haW5SZXF1ZXN0IG9iamVjdCIpCiAgICB9CgogICAgaWYgKCJyZXNwb25zZVR5cGUiIGluIG9wdGlvbnMpIHsKICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gb3B0aW9ucy5yZXNwb25zZVR5cGUKICAgIH0KCiAgICBpZiAoImJlZm9yZVNlbmQiIGluIG9wdGlvbnMgJiYKICAgICAgICB0eXBlb2Ygb3B0aW9ucy5iZWZvcmVTZW5kID09PSAiZnVuY3Rpb24iCiAgICApIHsKICAgICAgICBvcHRpb25zLmJlZm9yZVNlbmQoeGhyKQogICAgfQoKICAgIC8vIE1pY3Jvc29mdCBFZGdlIGJyb3dzZXIgc2VuZHMgInVuZGVmaW5lZCIgd2hlbiBzZW5kIGlzIGNhbGxlZCB3aXRoIHVuZGVmaW5lZCB2YWx1ZS4KICAgIC8vIFhNTEh0dHBSZXF1ZXN0IHNwZWMgc2F5cyB0byBwYXNzIG51bGwgYXMgYm9keSB0byBpbmRpY2F0ZSBubyBib2R5CiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL25hdWd0dXIveGhyL2lzc3Vlcy8xMDAuCiAgICB4aHIuc2VuZChib2R5IHx8IG51bGwpCgogICAgcmV0dXJuIHhocgoKCn0KCmZ1bmN0aW9uIGdldFhtbCh4aHIpIHsKICAgIC8vIHhoci5yZXNwb25zZVhNTCB3aWxsIHRocm93IEV4Y2VwdGlvbiAiSW52YWxpZFN0YXRlRXJyb3IiIG9yICJET01FeGNlcHRpb24iCiAgICAvLyBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0L3Jlc3BvbnNlWE1MLgogICAgdHJ5IHsKICAgICAgICBpZiAoeGhyLnJlc3BvbnNlVHlwZSA9PT0gImRvY3VtZW50IikgewogICAgICAgICAgICByZXR1cm4geGhyLnJlc3BvbnNlWE1MCiAgICAgICAgfQogICAgICAgIHZhciBmaXJlZm94QnVnVGFrZW5FZmZlY3QgPSB4aHIucmVzcG9uc2VYTUwgJiYgeGhyLnJlc3BvbnNlWE1MLmRvY3VtZW50RWxlbWVudC5ub2RlTmFtZSA9PT0gInBhcnNlcmVycm9yIgogICAgICAgIGlmICh4aHIucmVzcG9uc2VUeXBlID09PSAiIiAmJiAhZmlyZWZveEJ1Z1Rha2VuRWZmZWN0KSB7CiAgICAgICAgICAgIHJldHVybiB4aHIucmVzcG9uc2VYTUwKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7fQoKICAgIHJldHVybiBudWxsCn0KCmZ1bmN0aW9uIG5vb3AoKSB7fQoKfSx7Imdsb2JhbC93aW5kb3ciOjE3LCJpcy1mdW5jdGlvbiI6MjIsInBhcnNlLWhlYWRlcnMiOjMyLCJ4dGVuZCI6NTN9XSw1MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uIHhtbHBhcnNlcigpIHsKICAvL2NvbW1vbiBicm93c2VycwogIGlmICh0eXBlb2Ygc2VsZi5ET01QYXJzZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyKSB7CiAgICAgIHZhciBwYXJzZXIgPSBuZXcgc2VsZi5ET01QYXJzZXIoKQogICAgICByZXR1cm4gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzdHIsICdhcHBsaWNhdGlvbi94bWwnKQogICAgfQogIH0gCgogIC8vSUU4IGZhbGxiYWNrCiAgaWYgKHR5cGVvZiBzZWxmLkFjdGl2ZVhPYmplY3QgIT09ICd1bmRlZmluZWQnCiAgICAgICYmIG5ldyBzZWxmLkFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxET00nKSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHN0cikgewogICAgICB2YXIgeG1sRG9jID0gbmV3IHNlbGYuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTERPTSIpCiAgICAgIHhtbERvYy5hc3luYyA9ICJmYWxzZSIKICAgICAgeG1sRG9jLmxvYWRYTUwoc3RyKQogICAgICByZXR1cm4geG1sRG9jCiAgICB9CiAgfQoKICAvL2xhc3QgcmVzb3J0IGZhbGxiYWNrCiAgcmV0dXJuIGZ1bmN0aW9uKHN0cikgewogICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICBkaXYuaW5uZXJIVE1MID0gc3RyCiAgICByZXR1cm4gZGl2CiAgfQp9KSgpCgp9LHt9XSw1MzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZXh0ZW5kCgp2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwoKZnVuY3Rpb24gZXh0ZW5kKCkgewogICAgdmFyIHRhcmdldCA9IHt9CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldCgogICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldAp9Cgp9LHt9XSw1NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzPXsKICAibmFtZSI6ICJhZnJhbWUiLAogICJ2ZXJzaW9uIjogIjAuOS4yIiwKICAiZGVzY3JpcHRpb24iOiAiQSB3ZWIgZnJhbWV3b3JrIGZvciBidWlsZGluZyB2aXJ0dWFsIHJlYWxpdHkgZXhwZXJpZW5jZXMuIiwKICAiaG9tZXBhZ2UiOiAiaHR0cHM6Ly9hZnJhbWUuaW8vIiwKICAibWFpbiI6ICJkaXN0L2FmcmFtZS1tYXN0ZXIuanMiLAogICJzY3JpcHRzIjogewogICAgImJyb3dzZXJpZnkiOiAiYnJvd3NlcmlmeSBzcmMvaW5kZXguanMgLXMgJ0FGUkFNRScgLXAgYnJvd3NlcmlmeS1kZXJlcXVpcmUiLAogICAgImJ1aWxkIjogInNoeCBta2RpciAtcCBidWlsZC8gJiYgbnBtIHJ1biBicm93c2VyaWZ5IC0tIC0tZGVidWcgLXQgW2VudmlmeSAtLUlOU1BFQ1RPUl9WRVJTSU9OIGRldl0gLW8gYnVpbGQvYWZyYW1lLmpzIiwKICAgICJjb2RlY292IjogImNvZGVjb3YiLAogICAgImRldiI6ICJucG0gcnVuIGJ1aWxkICYmIGNyb3NzLWVudiBJTlNQRUNUT1JfVkVSU0lPTj1kZXYgbm9kZSAuL3NjcmlwdHMvYnVkbyAtdCBlbnZpZnkiLAogICAgImRpc3QiOiAibm9kZSBzY3JpcHRzL3VwZGF0ZVZlcnNpb25Mb2cuanMgJiYgbnBtIHJ1biBkaXN0Om1pbiAmJiBucG0gcnVuIGRpc3Q6bWF4IiwKICAgICJkaXN0Om1heCI6ICJucG0gcnVuIGJyb3dzZXJpZnkgLXMgLS0gLS1kZWJ1ZyB8IGV4b3JjaXN0IGRpc3QvYWZyYW1lLW1hc3Rlci5qcy5tYXAgPiBkaXN0L2FmcmFtZS1tYXN0ZXIuanMiLAogICAgImRpc3Q6bWluIjogIm5wbSBydW4gYnJvd3NlcmlmeSAtcyAtLSAtLWRlYnVnIC1wIFttaW5pZnlpZnkgLS1tYXAgYWZyYW1lLW1hc3Rlci5taW4uanMubWFwIC0tb3V0cHV0IGRpc3QvYWZyYW1lLW1hc3Rlci5taW4uanMubWFwXSAtbyBkaXN0L2FmcmFtZS1tYXN0ZXIubWluLmpzIiwKICAgICJkb2NzIjogIm1hcmtzZXJ2IC0tZGlyIGRvY3MgLS1wb3J0IDkwMDEiLAogICAgInByZWdocGFnZXMiOiAibm9kZSAuL3NjcmlwdHMvcHJlZ2hwYWdlcy5qcyIsCiAgICAiZ2hwYWdlcyI6ICJnaHBhZ2VzIC1wIGdoLXBhZ2VzLyIsCiAgICAibGludCI6ICJzZW1pc3RhbmRhcmQgLXYgfCBzbmF6enkiLAogICAgImxpbnQ6Zml4IjogInNlbWlzdGFuZGFyZCAtLWZpeCIsCiAgICAicHJlY29tbWl0IjogIm5wbSBydW4gbGludCIsCiAgICAicHJlcHVzaCI6ICJub2RlIHNjcmlwdHMvdGVzdE9ubHlDaGVjay5qcyIsCiAgICAicHJlcmVsZWFzZSI6ICJub2RlIHNjcmlwdHMvcmVsZWFzZS5qcyAwLjkuMSAwLjkuMiIsCiAgICAic3RhcnQiOiAibnBtIHJ1biBkZXYiLAogICAgInN0YXJ0Omh0dHBzIjogImNyb3NzLWVudiBTU0w9dHJ1ZSBucG0gcnVuIGRldiIsCiAgICAidGVzdCI6ICJrYXJtYSBzdGFydCAuL3Rlc3RzL2thcm1hLmNvbmYuanMiLAogICAgInRlc3Q6ZG9jcyI6ICJub2RlIHNjcmlwdHMvZG9jc0xpbnQuanMiLAogICAgInRlc3Q6ZmlyZWZveCI6ICJucG0gdGVzdCAtLSAtLWJyb3dzZXJzIEZpcmVmb3giLAogICAgInRlc3Q6Y2hyb21lIjogIm5wbSB0ZXN0IC0tIC0tYnJvd3NlcnMgQ2hyb21lIiwKICAgICJ0ZXN0Om5vYnJvd3NlciI6ICJOT19CUk9XU0VSPXRydWUgbnBtIHRlc3QiLAogICAgInRlc3Q6bm9kZSI6ICJtb2NoYSAtLXVpIHRkZCB0ZXN0cy9ub2RlIgogIH0sCiAgInJlcG9zaXRvcnkiOiAiYWZyYW1ldnIvYWZyYW1lIiwKICAibGljZW5zZSI6ICJNSVQiLAogICJmaWxlcyI6IFsKICAgICJkaXN0LyoiLAogICAgImRvY3MvKiovKiIsCiAgICAic3JjLyoqLyoiLAogICAgInZlbmRvci8qKi8qIgogIF0sCiAgImRlcGVuZGVuY2llcyI6IHsKICAgICJicm93c2VyaWZ5LWNzcyI6ICJeMC44LjQiLAogICAgImN1c3RvbS1ldmVudC1wb2x5ZmlsbCI6ICJeMS4wLjYiLAogICAgImRlYnVnIjogIm5nb2tldmluL2RlYnVnI25vVGltZXN0YW1wIiwKICAgICJkZWVwLWFzc2lnbiI6ICJeMi4wLjAiLAogICAgImRvY3VtZW50LXJlZ2lzdGVyLWVsZW1lbnQiOiAiZG1hcmNvcy9kb2N1bWVudC1yZWdpc3Rlci1lbGVtZW50IzhjY2M1MzJiN2YzNzQ0YmU5NTQ1NzRjYWYzMDcyYTVmZDI2MGNhOTAiLAogICAgImVudmlmeSI6ICJeMy40LjEiLAogICAgImxvYWQtYm1mb250IjogIl4xLjIuMyIsCiAgICAib2JqZWN0LWFzc2lnbiI6ICJeNC4wLjEiLAogICAgInByZXNlbnQiOiAiMC4wLjYiLAogICAgInByb21pc2UtcG9seWZpbGwiOiAiXjMuMS4wIiwKICAgICJzdHlsZS1hdHRyIjogIl4xLjAuMiIsCiAgICAic3VwZXItYW5pbWVqcyI6ICJeMy4wLjAiLAogICAgInN1cGVyLXRocmVlIjogIl4wLjEwMi4yIiwKICAgICJ0aHJlZS1ibWZvbnQtdGV4dCI6ICJeMi4xLjAiLAogICAgIndlYnZyLXBvbHlmaWxsIjogIl4wLjEwLjEwIgogIH0sCiAgImRldkRlcGVuZGVuY2llcyI6IHsKICAgICJicm93c2VyaWZ5IjogIl4xMy4xLjAiLAogICAgImJyb3dzZXJpZnktZGVyZXF1aXJlIjogIl4wLjkuNCIsCiAgICAiYnJvd3NlcmlmeS1pc3RhbmJ1bCI6ICJeMi4wLjAiLAogICAgImJ1ZG8iOiAiXjkuMi4wIiwKICAgICJjaGFpIjogIl4zLjUuMCIsCiAgICAiY2hhaS1zaGFsbG93LWRlZXAtZXF1YWwiOiAiXjEuNC4wIiwKICAgICJjaGFsayI6ICJeMS4xLjMiLAogICAgImNvZGVjb3YiOiAiXjEuMC4xIiwKICAgICJjcm9zcy1lbnYiOiAiXjUuMC4xIiwKICAgICJleG9yY2lzdCI6ICJeMC40LjAiLAogICAgImdocGFnZXMiOiAiMC4wLjgiLAogICAgImdpdC1yZXYiOiAiXjAuMi4xIiwKICAgICJnbG9iIjogIl43LjEuMSIsCiAgICAiaHVza3kiOiAiXjAuMTEuNyIsCiAgICAiaXN0YW5idWwiOiAiXjAuNC41IiwKICAgICJqc2RvbSI6ICJeOS4xMS4wIiwKICAgICJrYXJtYSI6ICIxLjQuMSIsCiAgICAia2FybWEtYnJvd3NlcmlmeSI6ICJeNS4xLjAiLAogICAgImthcm1hLWNoYWktc2hhbGxvdy1kZWVwLWVxdWFsIjogIjAuMC40IiwKICAgICJrYXJtYS1jaHJvbWUtbGF1bmNoZXIiOiAiXjIuMC4wIiwKICAgICJrYXJtYS1jb3ZlcmFnZSI6ICJeMS4xLjEiLAogICAgImthcm1hLWVudi1wcmVwcm9jZXNzb3IiOiAiXjAuMS4xIiwKICAgICJrYXJtYS1maXJlZm94LWxhdW5jaGVyIjogIl4xLjAuMCIsCiAgICAia2FybWEtbW9jaGEiOiAiXjEuMS4xIiwKICAgICJrYXJtYS1tb2NoYS1yZXBvcnRlciI6ICJeMi4xLjAiLAogICAgImthcm1hLXNpbm9uLWNoYWkiOiAiMS4yLjQiLAogICAgImxvbGV4IjogIl4xLjUuMSIsCiAgICAibWFya3NlcnYiOiAiZ2l0aHViOnN1a2ltYS9tYXJrc2VydiNmZWF0dXJlL2ZpeC1icm9rZW4td2Vic29rZXRpby1saW5rIiwKICAgICJtaW5pZnlpZnkiOiAiXjcuMy4zIiwKICAgICJtb2NoYSI6ICJeMy4wLjIiLAogICAgIm1vemlsbGEtZG93bmxvYWQiOiAiXjEuMS4xIiwKICAgICJyZXBsYWNlLWluLWZpbGUiOiAiXjIuNS4zIiwKICAgICJzZW1pc3RhbmRhcmQiOiAiXjkuMC4wIiwKICAgICJzaGVsbGpzIjogIl4wLjcuNyIsCiAgICAic2h4IjogIl4wLjIuMiIsCiAgICAic2lub24iOiAiXjEuMTcuNSIsCiAgICAic2lub24tY2hhaSI6ICIyLjguMCIsCiAgICAic25henp5IjogIl41LjAuMCIsCiAgICAidG9vLXdvcmR5IjogIm5nb2tldmluL3Rvby13b3JkeSIsCiAgICAidWdsaWZ5anMiOiAiXjIuNC4xMCIsCiAgICAid3JpdGUtZ29vZCI6ICJeMC45LjEiCiAgfSwKICAibGluayI6IHRydWUsCiAgImJyb3dzZXJpZnkiOiB7CiAgICAidHJhbnNmb3JtIjogWwogICAgICAiYnJvd3NlcmlmeS1jc3MiLAogICAgICAiZW52aWZ5IgogICAgXQogIH0sCiAgInNlbWlzdGFuZGFyZCI6IHsKICAgICJpZ25vcmUiOiBbCiAgICAgICJidWlsZC8qKiIsCiAgICAgICJkaXN0LyoqIiwKICAgICAgImV4YW1wbGVzLyoqL3NoYWRlcnMvKi5qcyIsCiAgICAgICIqKi92ZW5kb3IvKioiCiAgICBdCiAgfSwKICAia2V5d29yZHMiOiBbCiAgICAiM2QiLAogICAgImFmcmFtZSIsCiAgICAiY2FyZGJvYXJkIiwKICAgICJjb21wb25lbnRzIiwKICAgICJvY3VsdXMiLAogICAgInRocmVlIiwKICAgICJ0aHJlZS5qcyIsCiAgICAicmlmdCIsCiAgICAidml2ZSIsCiAgICAidnIiLAogICAgIndlYi1jb21wb25lbnRzIiwKICAgICJ3ZWJ2ciIKICBdLAogICJicm93c2VyaWZ5LWNzcyI6IHsKICAgICJtaW5pZnkiOiB0cnVlCiAgfSwKICAiZW5naW5lcyI6IHsKICAgICJub2RlIjogIj49IDQuNi4wIiwKICAgICJucG0iOiAiXjIuMTUuOSIKICB9Cn0KCn0se31dLDU1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGFuaW1lID0gX2RlcmVxXygnc3VwZXItYW5pbWVqcycpOwp2YXIgY29tcG9uZW50cyA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykuY29tcG9uZW50czsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzJyk7Cgp2YXIgY29sb3JIZWxwZXJGcm9tID0gbmV3IFRIUkVFLkNvbG9yKCk7CnZhciBjb2xvckhlbHBlclRvID0gbmV3IFRIUkVFLkNvbG9yKCk7Cgp2YXIgZ2V0Q29tcG9uZW50UHJvcGVydHkgPSB1dGlscy5lbnRpdHkuZ2V0Q29tcG9uZW50UHJvcGVydHk7CnZhciBzZXRDb21wb25lbnRQcm9wZXJ0eSA9IHV0aWxzLmVudGl0eS5zZXRDb21wb25lbnRQcm9wZXJ0eTsKdmFyIHNwbGl0Q2FjaGUgPSB7fTsKCnZhciBUWVBFX0NPTE9SID0gJ2NvbG9yJzsKdmFyIFBST1BfUE9TSVRJT04gPSAncG9zaXRpb24nOwp2YXIgUFJPUF9ST1RBVElPTiA9ICdyb3RhdGlvbic7CnZhciBQUk9QX1NDQUxFID0gJ3NjYWxlJzsKdmFyIFNUUklOR19DT01QT05FTlRTID0gJ2NvbXBvbmVudHMnOwp2YXIgU1RSSU5HX09CSkVDVDNEID0gJ29iamVjdDNEJzsKCi8qKgogKiBBbmltYXRpb24gY29tcG9uZW50IGZvciBBLUZyYW1lIHVzaW5nIGFuaW1lLmpzLgogKgogKiBUaGUgY29tcG9uZW50IG1hbnVhbGx5IGNvbnRyb2xzIHRoZSB0aWNrIGJ5IHNldHRpbmcgYGF1dG9wbGF5OiBmYWxzZWAgb24gYW5pbWUuanMgYW5kCiAqIG1hbnVhbGx5ICogY2FsbGluZyBgYW5pbWF0aW9uLnRpY2soKWAgaW4gdGhlIHRpY2sgaGFuZGxlci4gVG8gcGF1c2Ugb3IgcmVzdW1lLCB3ZSB0b2dnbGUgYQogKiBib29sZWFuICogZmxhZyAqIGBpc0FuaW1hdGlvblBsYXlpbmdgLgogKgogKiBhbmltZS5qcyBhbmltYXRpb24gY29uZmlnIGZvciB0d2VlbmluaW5nIEphdmFzY3JpcHQgb2JqZWN0cyBhbmQgdmFsdWVzIHdvcmtzIGFzOgogKgogKiAgY29uZmlnID0gewogKiAgICB0YXJnZXRzOiB7Zm9vOiAwLjAsIGJhcjogJyMwMDAnfSwKICogICAgZm9vOiAxLjAsCiAqICAgIGJhcjogJyNGRkYnCiAqICB9CiAqCiAqIFRoZSBhYm92ZSB3aWxsIHR3ZWVuIGVhY2ggcHJvcGVydHkgaW4gYHRhcmdldHNgLiBUaGUgYHRvYCB2YWx1ZXMgYXJlIHNldCBpbiB0aGUgcm9vdCBvZgogKiB0aGUgY29uZmlnLgogKgogKiBAbWVtYmVyIHtvYmplY3R9IGFuaW1hdGlvbiAtIGFuaW1lLmpzIGluc3RhbmNlLgogKiBAbWVtYmVyIHtib29sZWFufSBhbmltYXRpb25Jc1BsYXlpbmcgLSBDb250cm9sIGlmIGFuaW1hdGlvbiBpcyBwbGF5aW5nLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ2FuaW1hdGlvbicsIHsKICBzY2hlbWE6IHsKICAgIGF1dG9wbGF5OiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBkZWxheToge2RlZmF1bHQ6IDB9LAogICAgZGlyOiB7ZGVmYXVsdDogJyd9LAogICAgZHVyOiB7ZGVmYXVsdDogMTAwMH0sCiAgICBlYXNpbmc6IHtkZWZhdWx0OiAnZWFzZUluUXVhZCd9LAogICAgZWxhc3RpY2l0eToge2RlZmF1bHQ6IDQwMH0sCiAgICBlbmFibGVkOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBmcm9tOiB7ZGVmYXVsdDogJyd9LAogICAgbG9vcDogewogICAgICBkZWZhdWx0OiAwLAogICAgICBwYXJzZTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgLy8gQm9vbGVhbiBvciBpbnRlZ2VyLgogICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gJ3RydWUnKSB7IHJldHVybiB0cnVlOyB9CiAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSB8fCB2YWx1ZSA9PT0gJ2ZhbHNlJykgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUsIDEwKTsKICAgICAgfQogICAgfSwKICAgIHByb3BlcnR5OiB7ZGVmYXVsdDogJyd9LAogICAgc3RhcnRFdmVudHM6IHt0eXBlOiAnYXJyYXknfSwKICAgIHBhdXNlRXZlbnRzOiB7dHlwZTogJ2FycmF5J30sCiAgICByZXN1bWVFdmVudHM6IHt0eXBlOiAnYXJyYXknfSwKICAgIHJvdW5kOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgdG86IHtkZWZhdWx0OiAnJ30sCiAgICB0eXBlOiB7ZGVmYXVsdDogJyd9LAogICAgaXNSYXdQcm9wZXJ0eToge2RlZmF1bHQ6IGZhbHNlfQogIH0sCgogIG11bHRpcGxlOiB0cnVlLAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgdGhpcy5ldmVudERldGFpbCA9IHtuYW1lOiB0aGlzLmF0dHJOYW1lfTsKICAgIHRoaXMudGltZSA9IDA7CgogICAgdGhpcy5hbmltYXRpb24gPSBudWxsOwogICAgdGhpcy5hbmltYXRpb25Jc1BsYXlpbmcgPSBmYWxzZTsKICAgIHRoaXMub25TdGFydEV2ZW50ID0gdGhpcy5vblN0YXJ0RXZlbnQuYmluZCh0aGlzKTsKICAgIHRoaXMuYmVnaW5BbmltYXRpb24gPSB0aGlzLmJlZ2luQW5pbWF0aW9uLmJpbmQodGhpcyk7CiAgICB0aGlzLnBhdXNlQW5pbWF0aW9uID0gdGhpcy5wYXVzZUFuaW1hdGlvbi5iaW5kKHRoaXMpOwogICAgdGhpcy5yZXN1bWVBbmltYXRpb24gPSB0aGlzLnJlc3VtZUFuaW1hdGlvbi5iaW5kKHRoaXMpOwoKICAgIHRoaXMuZnJvbUNvbG9yID0ge307CiAgICB0aGlzLnRvQ29sb3IgPSB7fTsKICAgIHRoaXMudGFyZ2V0cyA9IHt9OwogICAgdGhpcy50YXJnZXRzQXJyYXkgPSBbXTsKCiAgICB0aGlzLnVwZGF0ZUNvbmZpZ0ZvckRlZmF1bHQgPSB0aGlzLnVwZGF0ZUNvbmZpZ0ZvckRlZmF1bHQuYmluZCh0aGlzKTsKICAgIHRoaXMudXBkYXRlQ29uZmlnRm9yUmF3Q29sb3IgPSB0aGlzLnVwZGF0ZUNvbmZpZ0ZvclJhd0NvbG9yLmJpbmQodGhpcyk7CgogICAgdGhpcy5jb25maWcgPSB7CiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi5hbmltYXRpb25Jc1BsYXlpbmcgPSBmYWxzZTsKICAgICAgICBzZWxmLmVsLmVtaXQoJ2FuaW1hdGlvbmNvbXBsZXRlJywgc2VsZi5ldmVudERldGFpbCwgZmFsc2UpOwogICAgICAgIGlmIChzZWxmLmlkKSB7CiAgICAgICAgICBzZWxmLmVsLmVtaXQoJ2FuaW1hdGlvbmNvbXBsZXRlX18nICsgc2VsZi5pZCwgc2VsZi5ldmVudERldGFpbCwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWc7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICB0aGlzLmFuaW1hdGlvbklzUGxheWluZyA9IGZhbHNlOwoKICAgIGlmICghdGhpcy5kYXRhLmVuYWJsZWQpIHsgcmV0dXJuOyB9CgogICAgaWYgKCFkYXRhLnByb3BlcnR5KSB7IHJldHVybjsgfQoKICAgIC8vIEJhc2UgY29uZmlnLgogICAgY29uZmlnLmF1dG9wbGF5ID0gZmFsc2U7CiAgICBjb25maWcuZGlyZWN0aW9uID0gZGF0YS5kaXI7CiAgICBjb25maWcuZHVyYXRpb24gPSBkYXRhLmR1cjsKICAgIGNvbmZpZy5lYXNpbmcgPSBkYXRhLmVhc2luZzsKICAgIGNvbmZpZy5lbGFzdGljaXR5ID0gZGF0YS5lbGFzdGljaXR5OwogICAgY29uZmlnLmxvb3AgPSBkYXRhLmxvb3A7CiAgICBjb25maWcucm91bmQgPSBkYXRhLnJvdW5kOwoKICAgIC8vIFN0YXJ0IG5ldyBhbmltYXRpb24uCiAgICB0aGlzLmNyZWF0ZUFuZFN0YXJ0QW5pbWF0aW9uKCk7CiAgfSwKCiAgdGljazogZnVuY3Rpb24gKHQsIGR0KSB7CiAgICBpZiAoIXRoaXMuYW5pbWF0aW9uSXNQbGF5aW5nKSB7IHJldHVybjsgfQogICAgdGhpcy50aW1lICs9IGR0OwogICAgdGhpcy5hbmltYXRpb24udGljayh0aGlzLnRpbWUpOwogIH0sCgogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5wYXVzZUFuaW1hdGlvbigpOwogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnBhdXNlZCA9IHRydWU7CiAgICB0aGlzLnBhdXNlZFdhc1BsYXlpbmcgPSB0aGlzLmFuaW1hdGlvbklzUGxheWluZzsKICAgIHRoaXMucGF1c2VBbmltYXRpb24oKTsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICAvKioKICAgKiBgcGxheWAgaGFuZGxlciBvbmx5IGZvciByZXN1bWluZyBzY2VuZS4KICAgKi8KICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMucGF1c2VkKSB7IHJldHVybjsgfQogICAgdGhpcy5wYXVzZWQgPSBmYWxzZTsKICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTsKICAgIGlmICh0aGlzLnBhdXNlZFdhc1BsYXlpbmcpIHsKICAgICAgdGhpcy5yZXN1bWVBbmltYXRpb24oKTsKICAgICAgdGhpcy5wYXVzZWRXYXNQbGF5aW5nID0gZmFsc2U7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogU3RhcnQgYW5pbWF0aW9uIGZyb20gc2NyYXRjaC4KICAgKi8KICBjcmVhdGVBbmRTdGFydEFuaW1hdGlvbjogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CgogICAgdGhpcy51cGRhdGVDb25maWcoKTsKICAgIHRoaXMuYW5pbWF0aW9uSXNQbGF5aW5nID0gZmFsc2U7CiAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1lKHRoaXMuY29uZmlnKTsKICAgIHRoaXMuYW5pbWF0aW9uLmJlZ2FuID0gdHJ1ZTsKCiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CgogICAgLy8gV2FpdCBmb3Igc3RhcnQgZXZlbnRzIGZvciBhbmltYXRpb24uCiAgICBpZiAoIWRhdGEuYXV0b3BsYXkgfHwgZGF0YS5zdGFydEV2ZW50cyAmJiBkYXRhLnN0YXJ0RXZlbnRzLmxlbmd0aCkgeyByZXR1cm47IH0KCiAgICAvLyBEZWxheSBhbmltYXRpb24uCiAgICBpZiAoZGF0YS5kZWxheSkgewogICAgICBzZXRUaW1lb3V0KHRoaXMuYmVnaW5BbmltYXRpb24sIGRhdGEuZGVsYXkpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gUGxheSBhbmltYXRpb24uCiAgICB0aGlzLmJlZ2luQW5pbWF0aW9uKCk7CiAgfSwKCiAgLyoqCiAgICogVGhpcyBpcyBiZWZvcmUgYW5pbWF0aW9uIHN0YXJ0IChpbmNsdWRpbmcgZnJvbSBzdGFydEV2ZW50cykuCiAgICogU2V0IHRvIGluaXRpYWwgc3RhdGUgKGNvbmZpZy5mcm9tLCB0aW1lID0gMCwgc2Vla1RpbWUgPSAwKS4KICAgKi8KICBiZWdpbkFuaW1hdGlvbjogZnVuY3Rpb24gKCkgewogICAgdGhpcy51cGRhdGVDb25maWcoKTsKICAgIHRoaXMuYW5pbWF0aW9uLmJlZ2FuID0gdHJ1ZTsKICAgIHRoaXMudGltZSA9IDA7CiAgICB0aGlzLmFuaW1hdGlvbklzUGxheWluZyA9IHRydWU7CiAgICB0aGlzLnN0b3BSZWxhdGVkQW5pbWF0aW9ucygpOwogICAgdGhpcy5lbC5lbWl0KCdhbmltYXRpb25iZWdpbicsIHRoaXMuZXZlbnREZXRhaWwsIGZhbHNlKTsKICB9LAoKICBwYXVzZUFuaW1hdGlvbjogZnVuY3Rpb24gKCkgewogICAgdGhpcy5hbmltYXRpb25Jc1BsYXlpbmcgPSBmYWxzZTsKICB9LAoKICByZXN1bWVBbmltYXRpb246IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYW5pbWF0aW9uSXNQbGF5aW5nID0gdHJ1ZTsKICB9LAoKICAvKioKICAgKiBzdGFydEV2ZW50cyBjYWxsYmFjay4KICAgKi8KICBvblN0YXJ0RXZlbnQ6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5kYXRhLmVuYWJsZWQpIHsgcmV0dXJuOyB9CgogICAgdGhpcy51cGRhdGVDb25maWcoKTsKICAgIGlmICh0aGlzLmFuaW1hdGlvbikgewogICAgICB0aGlzLmFuaW1hdGlvbi5wYXVzZSgpOwogICAgfQogICAgdGhpcy5hbmltYXRpb24gPSBhbmltZSh0aGlzLmNvbmZpZyk7CgogICAgLy8gSW5jbHVkZSB0aGUgZGVsYXkgYmVmb3JlIGVhY2ggc3RhcnQgZXZlbnQuCiAgICBpZiAodGhpcy5kYXRhLmRlbGF5KSB7CiAgICAgIHNldFRpbWVvdXQodGhpcy5iZWdpbkFuaW1hdGlvbiwgdGhpcy5kYXRhLmRlbGF5KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5iZWdpbkFuaW1hdGlvbigpOwogIH0sCgogIC8qKgogICAqIHJhd1Byb3BlcnR5OiB0cnVlIGFuZCB0eXBlOiBjb2xvcjsKICAgKi8KICB1cGRhdGVDb25maWdGb3JSYXdDb2xvcjogZnVuY3Rpb24gKCkgewogICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGZyb207CiAgICB2YXIga2V5OwogICAgdmFyIHRvOwoKICAgIGlmICh0aGlzLndhaXRDb21wb25lbnRJbml0UmF3UHJvcGVydHkodGhpcy51cGRhdGVDb25maWdGb3JSYXdDb2xvcikpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZyb20gPSBkYXRhLmZyb20gPT09ICcnID8gZ2V0UmF3UHJvcGVydHkoZWwsIGRhdGEucHJvcGVydHkpIDogZGF0YS5mcm9tOwogICAgdG8gPSBkYXRhLnRvOwoKICAgIC8vIFVzZSByL2cvYiB2ZWN0b3IgZm9yIGNvbG9yIHR5cGUuCiAgICB0aGlzLnNldENvbG9yQ29uZmlnKGZyb20sIHRvKTsKICAgIGZyb20gPSB0aGlzLmZyb21Db2xvcjsKICAgIHRvID0gdGhpcy50b0NvbG9yOwoKICAgIHRoaXMudGFyZ2V0c0FycmF5Lmxlbmd0aCA9IDA7CiAgICB0aGlzLnRhcmdldHNBcnJheS5wdXNoKGZyb20pOwogICAgY29uZmlnLnRhcmdldHMgPSB0aGlzLnRhcmdldHNBcnJheTsKICAgIGZvciAoa2V5IGluIHRvKSB7IGNvbmZpZ1trZXldID0gdG9ba2V5XTsgfQoKICAgIGNvbmZpZy51cGRhdGUgPSAoZnVuY3Rpb24gKCkgewogICAgICB2YXIgbGFzdFZhbHVlID0ge307CiAgICAgIHJldHVybiBmdW5jdGlvbiAoYW5pbSkgewogICAgICAgIHZhciB2YWx1ZTsKICAgICAgICB2YWx1ZSA9IGFuaW0uYW5pbWF0YWJsZXNbMF0udGFyZ2V0OwogICAgICAgIC8vIEZvciBhbmltYXRpb24gdGltZWxpbmUuCiAgICAgICAgaWYgKHZhbHVlLnIgPT09IGxhc3RWYWx1ZS5yICYmCiAgICAgICAgICAgIHZhbHVlLmcgPT09IGxhc3RWYWx1ZS5nICYmCiAgICAgICAgICAgIHZhbHVlLmIgPT09IGxhc3RWYWx1ZS5iKSB7IHJldHVybjsgfQoKICAgICAgICBzZXRSYXdQcm9wZXJ0eShlbCwgZGF0YS5wcm9wZXJ0eSwgdmFsdWUsIGRhdGEudHlwZSk7CiAgICAgIH07CiAgICB9KSgpOwogIH0sCgogIC8qKgogICAqIFN0dWZmIHByb3BlcnR5IGludG8gZ2VuZXJpYyBgcHJvcGVydHlgIGtleS4KICAgKi8KICB1cGRhdGVDb25maWdGb3JEZWZhdWx0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWc7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgZnJvbTsKICAgIHZhciBpc0Jvb2xlYW47CiAgICB2YXIgaXNOdW1iZXI7CiAgICB2YXIgdG87CgogICAgaWYgKHRoaXMud2FpdENvbXBvbmVudEluaXRSYXdQcm9wZXJ0eSh0aGlzLnVwZGF0ZUNvbmZpZ0ZvckRlZmF1bHQpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoZGF0YS5mcm9tID09PSAnJykgewogICAgICAvLyBJbmZlciBmcm9tLgogICAgICBmcm9tID0gaXNSYXdQcm9wZXJ0eShkYXRhKQogICAgICAgID8gZ2V0UmF3UHJvcGVydHkoZWwsIGRhdGEucHJvcGVydHkpCiAgICAgICAgOiBnZXRDb21wb25lbnRQcm9wZXJ0eShlbCwgZGF0YS5wcm9wZXJ0eSk7CiAgICB9IGVsc2UgewogICAgICAvLyBFeHBsaWNpdCBmcm9tLgogICAgICBmcm9tID0gZGF0YS5mcm9tOwogICAgfQoKICAgIHRvID0gZGF0YS50bzsKCiAgICBpc051bWJlciA9ICFpc05hTihmcm9tIHx8IHRvKTsKICAgIGlmIChpc051bWJlcikgewogICAgICBmcm9tID0gcGFyc2VGbG9hdChmcm9tKTsKICAgICAgdG8gPSBwYXJzZUZsb2F0KHRvKTsKICAgIH0gZWxzZSB7CiAgICAgIGZyb20gPSBmcm9tID8gZnJvbS50b1N0cmluZygpIDogZnJvbTsKICAgICAgdG8gPSB0byA/IHRvLnRvU3RyaW5nKCkgOiB0bzsKICAgIH0KCiAgICAvLyBDb252ZXJ0IGJvb2xlYW5zIHRvIGludGVnZXIgdG8gYWxsb3cgYm9vbGVhbiBmbGlwcGluZy4KICAgIGlzQm9vbGVhbiA9IGRhdGEudG8gPT09ICd0cnVlJyB8fCBkYXRhLnRvID09PSAnZmFsc2UnIHx8CiAgICAgICAgICAgICAgICBkYXRhLnRvID09PSB0cnVlIHx8IGRhdGEudG8gPT09IGZhbHNlOwogICAgaWYgKGlzQm9vbGVhbikgewogICAgICBmcm9tID0gZGF0YS5mcm9tID09PSAndHJ1ZScgfHwgZGF0YS5mcm9tID09PSB0cnVlID8gMSA6IDA7CiAgICAgIHRvID0gZGF0YS50byA9PT0gJ3RydWUnIHx8IGRhdGEudG8gPT09IHRydWUgPyAxIDogMDsKICAgIH0KCiAgICB0aGlzLnRhcmdldHMuYWZyYW1lUHJvcGVydHkgPSBmcm9tOwogICAgY29uZmlnLnRhcmdldHMgPSB0aGlzLnRhcmdldHM7CiAgICBjb25maWcuYWZyYW1lUHJvcGVydHkgPSB0bzsKICAgIGNvbmZpZy51cGRhdGUgPSAoZnVuY3Rpb24gKCkgewogICAgICB2YXIgbGFzdFZhbHVlOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhbmltKSB7CiAgICAgICAgdmFyIHZhbHVlOwogICAgICAgIHZhbHVlID0gYW5pbS5hbmltYXRhYmxlc1swXS50YXJnZXQuYWZyYW1lUHJvcGVydHk7CgogICAgICAgIC8vIE5lZWQgdG8gZG8gYSBsYXN0IHZhbHVlIGNoZWNrIGZvciBhbmltYXRpb24gdGltZWxpbmUgc2luY2UgYWxsIHRoZSB0d2VlbmluZwogICAgICAgIC8vIGJlZ2lucyBzaW11bHRhZW5vdXNseSBldmVuIGlmIHRoZSB2YWx1ZSBoYXMgbm90IGNoYW5nZWQuIEFsc28gYmV0dGVyIGZvciBwZXJmCiAgICAgICAgLy8gYW55d2F5cy4KICAgICAgICBpZiAodmFsdWUgPT09IGxhc3RWYWx1ZSkgeyByZXR1cm47IH0KICAgICAgICBsYXN0VmFsdWUgPSB2YWx1ZTsKCiAgICAgICAgaWYgKGlzQm9vbGVhbikgeyB2YWx1ZSA9IHZhbHVlID49IDE7IH0KCiAgICAgICAgaWYgKGlzUmF3UHJvcGVydHkoZGF0YSkpIHsKICAgICAgICAgIHNldFJhd1Byb3BlcnR5KGVsLCBkYXRhLnByb3BlcnR5LCB2YWx1ZSwgZGF0YS50eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2V0Q29tcG9uZW50UHJvcGVydHkoZWwsIGRhdGEucHJvcGVydHksIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9KSgpOwogIH0sCgogIC8qKgogICAqIEV4dGVuZCB4L3kvei93IG9udG8gdGhlIGNvbmZpZy4KICAgKiBVcGRhdGUgdmVjdG9yIGJ5IG1vZGlmeWluZyBvYmplY3QzRC4KICAgKi8KICB1cGRhdGVDb25maWdGb3JWZWN0b3I6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZzsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBrZXk7CiAgICB2YXIgZnJvbTsKICAgIHZhciB0bzsKCiAgICAvLyBQYXJzZSBjb29yZGluYXRlcy4KICAgIGZyb20gPSBkYXRhLmZyb20gIT09ICcnCiAgICAgID8gdXRpbHMuY29vcmRpbmF0ZXMucGFyc2UoZGF0YS5mcm9tKSAgLy8gSWYgZGF0YS5mcm9tIGRlZmluZWQsIHVzZSB0aGF0LgogICAgICA6IGdldENvbXBvbmVudFByb3BlcnR5KGVsLCBkYXRhLnByb3BlcnR5KTsgIC8vIElmIGRhdGEuZnJvbSBub3QgZGVmaW5lZCwgZ2V0IG9uIHRoZSBmbHkuCiAgICB0byA9IHV0aWxzLmNvb3JkaW5hdGVzLnBhcnNlKGRhdGEudG8pOwoKICAgIGlmIChkYXRhLnByb3BlcnR5ID09PSBQUk9QX1JPVEFUSU9OKSB7CiAgICAgIHRvUmFkaWFucyhmcm9tKTsKICAgICAgdG9SYWRpYW5zKHRvKTsKICAgIH0KCiAgICAvLyBTZXQgdG8gYW5kIGZyb20uCiAgICB0aGlzLnRhcmdldHNBcnJheS5sZW5ndGggPSAwOwogICAgdGhpcy50YXJnZXRzQXJyYXkucHVzaChmcm9tKTsKICAgIGNvbmZpZy50YXJnZXRzID0gdGhpcy50YXJnZXRzQXJyYXk7CiAgICBmb3IgKGtleSBpbiB0bykgeyBjb25maWdba2V5XSA9IHRvW2tleV07IH0KCiAgICAvLyBJZiBhbmltYXRpbmcgb2JqZWN0M0QgdHJhbnNmb3JtYXRpb24sIHJ1biBtb3JlIG9wdGltaXplZCB1cGRhdGVyLgogICAgaWYgKGRhdGEucHJvcGVydHkgPT09IFBST1BfUE9TSVRJT04gfHwgZGF0YS5wcm9wZXJ0eSA9PT0gUFJPUF9ST1RBVElPTiB8fAogICAgICAgIGRhdGEucHJvcGVydHkgPT09IFBST1BfU0NBTEUpIHsKICAgICAgY29uZmlnLnVwZGF0ZSA9IChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxhc3RWYWx1ZSA9IHt9OwogICAgICAgIHJldHVybiBmdW5jdGlvbiAoYW5pbSkgewogICAgICAgICAgdmFyIHZhbHVlID0gYW5pbS5hbmltYXRhYmxlc1swXS50YXJnZXQ7CgogICAgICAgICAgaWYgKGRhdGEucHJvcGVydHkgPT09IFBST1BfU0NBTEUpIHsKICAgICAgICAgICAgdmFsdWUueCA9IE1hdGgubWF4KDAuMDAwMSwgdmFsdWUueCk7CiAgICAgICAgICAgIHZhbHVlLnkgPSBNYXRoLm1heCgwLjAwMDEsIHZhbHVlLnkpOwogICAgICAgICAgICB2YWx1ZS56ID0gTWF0aC5tYXgoMC4wMDAxLCB2YWx1ZS56KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBGb3IgYW5pbWF0aW9uIHRpbWVsaW5lLgogICAgICAgICAgaWYgKHZhbHVlLnggPT09IGxhc3RWYWx1ZS54ICYmCiAgICAgICAgICAgICAgdmFsdWUueSA9PT0gbGFzdFZhbHVlLnkgJiYKICAgICAgICAgICAgICB2YWx1ZS56ID09PSBsYXN0VmFsdWUueikgeyByZXR1cm47IH0KCiAgICAgICAgICBsYXN0VmFsdWUueCA9IHZhbHVlLng7CiAgICAgICAgICBsYXN0VmFsdWUueSA9IHZhbHVlLnk7CiAgICAgICAgICBsYXN0VmFsdWUueiA9IHZhbHVlLno7CgogICAgICAgICAgZWwub2JqZWN0M0RbZGF0YS5wcm9wZXJ0eV0uc2V0KHZhbHVlLngsIHZhbHVlLnksIHZhbHVlLnopOwogICAgICAgIH07CiAgICAgIH0pKCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBBbmltYXRpbmcgc29tZSB2ZWN0b3IuCiAgICBjb25maWcudXBkYXRlID0gKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGxhc3RWYWx1ZSA9IHt9OwogICAgICByZXR1cm4gZnVuY3Rpb24gKGFuaW0pIHsKICAgICAgICB2YXIgdmFsdWUgPSBhbmltLmFuaW1hdGFibGVzWzBdLnRhcmdldDsKCiAgICAgICAgLy8gQW5pbWF0ZSByb3RhdGlvbiB0aHJvdWdoIHJhZGlhbnMuCiAgICAgICAgLy8gRm9yIGFuaW1hdGlvbiB0aW1lbGluZS4KICAgICAgICBpZiAodmFsdWUueCA9PT0gbGFzdFZhbHVlLnggJiYKICAgICAgICAgICAgdmFsdWUueSA9PT0gbGFzdFZhbHVlLnkgJiYKICAgICAgICAgICAgdmFsdWUueiA9PT0gbGFzdFZhbHVlLnopIHsgcmV0dXJuOyB9CiAgICAgICAgbGFzdFZhbHVlLnggPSB2YWx1ZS54OwogICAgICAgIGxhc3RWYWx1ZS55ID0gdmFsdWUueTsKICAgICAgICBsYXN0VmFsdWUueiA9IHZhbHVlLno7CiAgICAgICAgc2V0Q29tcG9uZW50UHJvcGVydHkoZWwsIGRhdGEucHJvcGVydHksIHZhbHVlKTsKICAgICAgfTsKICAgIH0pKCk7CiAgfSwKCiAgLyoqCiAgICogVXBkYXRlIHRoZSBjb25maWcgYmVmb3JlIGVhY2ggcnVuLgogICAqLwogIHVwZGF0ZUNvbmZpZzogZnVuY3Rpb24gKCkgewogICAgdmFyIHByb3BUeXBlOwoKICAgIC8vIFJvdXRlIGNvbmZpZyB0eXBlLgogICAgcHJvcFR5cGUgPSBnZXRQcm9wZXJ0eVR5cGUodGhpcy5lbCwgdGhpcy5kYXRhLnByb3BlcnR5KTsKICAgIGlmIChpc1Jhd1Byb3BlcnR5KHRoaXMuZGF0YSkgJiYgdGhpcy5kYXRhLnR5cGUgPT09IFRZUEVfQ09MT1IpIHsKICAgICAgdGhpcy51cGRhdGVDb25maWdGb3JSYXdDb2xvcigpOwogICAgfSBlbHNlIGlmIChwcm9wVHlwZSA9PT0gJ3ZlYzInIHx8IHByb3BUeXBlID09PSAndmVjMycgfHwgcHJvcFR5cGUgPT09ICd2ZWM0JykgewogICAgICB0aGlzLnVwZGF0ZUNvbmZpZ0ZvclZlY3RvcigpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy51cGRhdGVDb25maWdGb3JEZWZhdWx0KCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogV2FpdCBmb3IgY29tcG9uZW50IHRvIGluaXRpYWxpemUuCiAgICovCiAgd2FpdENvbXBvbmVudEluaXRSYXdQcm9wZXJ0eTogZnVuY3Rpb24gKGNiKSB7CiAgICB2YXIgY29tcG9uZW50TmFtZTsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBpZiAoZGF0YS5mcm9tICE9PSAnJykgeyByZXR1cm4gZmFsc2U7IH0KCiAgICBpZiAoIWRhdGEucHJvcGVydHkuc3RhcnRzV2l0aChTVFJJTkdfQ09NUE9ORU5UUykpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgY29tcG9uZW50TmFtZSA9IHNwbGl0RG90KGRhdGEucHJvcGVydHkpWzFdOwogICAgaWYgKGVsLmNvbXBvbmVudHNbY29tcG9uZW50TmFtZV0pIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9uZW50aW5pdGlhbGl6ZWQnLCBmdW5jdGlvbiB3YWl0IChldnQpIHsKICAgICAgaWYgKGV2dC5kZXRhaWwubmFtZSAhPT0gY29tcG9uZW50TmFtZSkgeyByZXR1cm47IH0KICAgICAgY2IoKTsKICAgICAgLy8gU2luY2UgdGhlIGNvbmZpZyB3YXMgY3JlYXRlZCBhc3luYywgY3JlYXRlIHRoZSBhbmltYXRpb24gbm93IHNpbmNlIHdlIG1pc3NlZCBpdAogICAgICAvLyBlYXJsaWVyLgogICAgICBzZWxmLmFuaW1hdGlvbiA9IGFuaW1lKHNlbGYuY29uZmlnKTsKICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcG9uZW50aW5pdGlhbGl6ZWQnLCB3YWl0KTsKICAgIH0pOwogICAgcmV0dXJuIHRydWU7CiAgfSwKCiAgLyoqCiAgICogTWFrZSBzdXJlIHR3byBhbmltYXRpb25zIG9uIHRoZSBzYW1lIHByb3BlcnR5IGRvbid0IGZpZ2h0IGVhY2ggb3RoZXIuCiAgICogZS5nLiwgYW5pbWF0aW9uX19tb3VzZWVudGVyPSJwcm9wZXJ0eTogbWF0ZXJpYWwub3BhY2l0eSIKICAgKiAgICAgICBhbmltYXRpb25fX21vdXNlbGVhdmU9InByb3BlcnR5OiBtYXRlcmlhbC5vcGFjaXR5IgogICAqLwogIHN0b3BSZWxhdGVkQW5pbWF0aW9uczogZnVuY3Rpb24gKCkgewogICAgdmFyIGNvbXBvbmVudDsKICAgIHZhciBjb21wb25lbnROYW1lOwogICAgZm9yIChjb21wb25lbnROYW1lIGluIHRoaXMuZWwuY29tcG9uZW50cykgewogICAgICBjb21wb25lbnQgPSB0aGlzLmVsLmNvbXBvbmVudHNbY29tcG9uZW50TmFtZV07CiAgICAgIGlmIChjb21wb25lbnROYW1lID09PSB0aGlzLmF0dHJOYW1lKSB7IGNvbnRpbnVlOyB9CiAgICAgIGlmIChjb21wb25lbnQubmFtZSAhPT0gJ2FuaW1hdGlvbicpIHsgY29udGludWU7IH0KICAgICAgaWYgKCFjb21wb25lbnQuYW5pbWF0aW9uSXNQbGF5aW5nKSB7IGNvbnRpbnVlOyB9CiAgICAgIGlmIChjb21wb25lbnQuZGF0YS5wcm9wZXJ0eSAhPT0gdGhpcy5kYXRhLnByb3BlcnR5KSB7IGNvbnRpbnVlOyB9CiAgICAgIGNvbXBvbmVudC5hbmltYXRpb25Jc1BsYXlpbmcgPSBmYWxzZTsKICAgIH0KICB9LAoKICBhZGRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgYWRkRXZlbnRMaXN0ZW5lcnMoZWwsIGRhdGEuc3RhcnRFdmVudHMsIHRoaXMub25TdGFydEV2ZW50KTsKICAgIGFkZEV2ZW50TGlzdGVuZXJzKGVsLCBkYXRhLnBhdXNlRXZlbnRzLCB0aGlzLnBhdXNlQW5pbWF0aW9uKTsKICAgIGFkZEV2ZW50TGlzdGVuZXJzKGVsLCBkYXRhLnJlc3VtZUV2ZW50cywgdGhpcy5yZXN1bWVBbmltYXRpb24pOwogIH0sCgogIHJlbW92ZUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICByZW1vdmVFdmVudExpc3RlbmVycyhlbCwgZGF0YS5zdGFydEV2ZW50cywgdGhpcy5vblN0YXJ0RXZlbnQpOwogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoZWwsIGRhdGEucGF1c2VFdmVudHMsIHRoaXMucGF1c2VBbmltYXRpb24pOwogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoZWwsIGRhdGEucmVzdW1lRXZlbnRzLCB0aGlzLnJlc3VtZUFuaW1hdGlvbik7CiAgfSwKCiAgc2V0Q29sb3JDb25maWc6IGZ1bmN0aW9uIChmcm9tLCB0bykgewogICAgY29sb3JIZWxwZXJGcm9tLnNldChmcm9tKTsKICAgIGNvbG9ySGVscGVyVG8uc2V0KHRvKTsKICAgIGZyb20gPSB0aGlzLmZyb21Db2xvcjsKICAgIHRvID0gdGhpcy50b0NvbG9yOwogICAgZnJvbS5yID0gY29sb3JIZWxwZXJGcm9tLnI7CiAgICBmcm9tLmcgPSBjb2xvckhlbHBlckZyb20uZzsKICAgIGZyb20uYiA9IGNvbG9ySGVscGVyRnJvbS5iOwogICAgdG8uciA9IGNvbG9ySGVscGVyVG8ucjsKICAgIHRvLmcgPSBjb2xvckhlbHBlclRvLmc7CiAgICB0by5iID0gY29sb3JIZWxwZXJUby5iOwogIH0KfSk7CgovKioKICogR2l2ZW4gcHJvcGVydHkgbmFtZSwgY2hlY2sgc2NoZW1hIHRvIHNlZSB3aGF0IHR5cGUgd2UgYXJlIGFuaW1hdGluZy4KICogV2UganVzdCBjYXJlIHdoZXRoZXIgdGhlIHByb3BlcnR5IGlzIGEgdmVjdG9yLgogKi8KZnVuY3Rpb24gZ2V0UHJvcGVydHlUeXBlIChlbCwgcHJvcGVydHkpIHsKICB2YXIgY29tcG9uZW50OwogIHZhciBjb21wb25lbnROYW1lOwogIHZhciBzcGxpdDsKICB2YXIgcHJvcGVydHlOYW1lOwoKICBzcGxpdCA9IHByb3BlcnR5LnNwbGl0KCcuJyk7CiAgY29tcG9uZW50TmFtZSA9IHNwbGl0WzBdOwogIHByb3BlcnR5TmFtZSA9IHNwbGl0WzFdOwogIGNvbXBvbmVudCA9IGVsLmNvbXBvbmVudHNbY29tcG9uZW50TmFtZV0gfHwgY29tcG9uZW50c1tjb21wb25lbnROYW1lXTsKCiAgLy8gUHJpbWl0aXZlcy4KICBpZiAoIWNvbXBvbmVudCkgeyByZXR1cm4gbnVsbDsgfQoKICAvLyBEeW5hbWljIHNjaGVtYS4gV2Ugb25seSBjYXJlIGFib3V0IHZlY3RvcnMgYW55d2F5cy4KICBpZiAocHJvcGVydHlOYW1lICYmICFjb21wb25lbnQuc2NoZW1hW3Byb3BlcnR5TmFtZV0pIHsgcmV0dXJuIG51bGw7IH0KCiAgLy8gTXVsdGktcHJvcC4KICBpZiAocHJvcGVydHlOYW1lKSB7IHJldHVybiBjb21wb25lbnQuc2NoZW1hW3Byb3BlcnR5TmFtZV0udHlwZTsgfQoKICAvLyBTaW5nbGUtcHJvcC4KICByZXR1cm4gY29tcG9uZW50LnNjaGVtYS50eXBlOwp9CgovKioKICogQ29udmVydCBvYmplY3QgdG8gcmFkaWFucy4KICovCmZ1bmN0aW9uIHRvUmFkaWFucyAob2JqKSB7CiAgb2JqLnggPSBUSFJFRS5NYXRoLmRlZ1RvUmFkKG9iai54KTsKICBvYmoueSA9IFRIUkVFLk1hdGguZGVnVG9SYWQob2JqLnkpOwogIG9iai56ID0gVEhSRUUuTWF0aC5kZWdUb1JhZChvYmoueik7Cn0KCmZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzIChlbCwgZXZlbnROYW1lcywgaGFuZGxlcikgewogIHZhciBpOwogIGZvciAoaSA9IDA7IGkgPCBldmVudE5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZXNbaV0sIGhhbmRsZXIpOwogIH0KfQoKZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcnMgKGVsLCBldmVudE5hbWVzLCBoYW5kbGVyKSB7CiAgdmFyIGk7CiAgZm9yIChpID0gMDsgaSA8IGV2ZW50TmFtZXMubGVuZ3RoOyBpKyspIHsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lc1tpXSwgaGFuZGxlcik7CiAgfQp9CgpmdW5jdGlvbiBnZXRSYXdQcm9wZXJ0eSAoZWwsIHBhdGgpIHsKICB2YXIgaTsKICB2YXIgc3BsaXQ7CiAgdmFyIHZhbHVlOwogIHNwbGl0ID0gc3BsaXREb3QocGF0aCk7CiAgdmFsdWUgPSBlbDsKICBmb3IgKGkgPSAwOyBpIDwgc3BsaXQubGVuZ3RoOyBpKyspIHsKICAgIHZhbHVlID0gdmFsdWVbc3BsaXRbaV1dOwogIH0KICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgY29uc29sZS5sb2coZWwpOwogICAgdGhyb3cgbmV3IEVycm9yKCdbYW5pbWF0aW9uXSBwcm9wZXJ0eSAoJyArIHBhdGggKyAnKSBjb3VsZCBub3QgYmUgZm91bmQnKTsKICB9CiAgcmV0dXJuIHZhbHVlOwp9CgpmdW5jdGlvbiBzZXRSYXdQcm9wZXJ0eSAoZWwsIHBhdGgsIHZhbHVlLCB0eXBlKSB7CiAgdmFyIGk7CiAgdmFyIHNwbGl0OwogIHZhciBwcm9wZXJ0eU5hbWU7CiAgdmFyIHRhcmdldFZhbHVlOwoKICBpZiAocGF0aC5zdGFydHNXaXRoKCdvYmplY3QzRC5yb3RhdGlvbicpKSB7CiAgICB2YWx1ZSA9IFRIUkVFLk1hdGguZGVnVG9SYWQodmFsdWUpOwogIH0KCiAgLy8gV2Fsay4KICBzcGxpdCA9IHNwbGl0RG90KHBhdGgpOwogIHRhcmdldFZhbHVlID0gZWw7CiAgZm9yIChpID0gMDsgaSA8IHNwbGl0Lmxlbmd0aCAtIDE7IGkrKykgeyB0YXJnZXRWYWx1ZSA9IHRhcmdldFZhbHVlW3NwbGl0W2ldXTsgfQogIHByb3BlcnR5TmFtZSA9IHNwbGl0W3NwbGl0Lmxlbmd0aCAtIDFdOwoKICAvLyBSYXcgY29sb3IuCiAgaWYgKHR5cGUgPT09IFRZUEVfQ09MT1IpIHsKICAgIGlmICgncicgaW4gdGFyZ2V0VmFsdWVbcHJvcGVydHlOYW1lXSkgewogICAgICB0YXJnZXRWYWx1ZVtwcm9wZXJ0eU5hbWVdLnIgPSB2YWx1ZS5yOwogICAgICB0YXJnZXRWYWx1ZVtwcm9wZXJ0eU5hbWVdLmcgPSB2YWx1ZS5nOwogICAgICB0YXJnZXRWYWx1ZVtwcm9wZXJ0eU5hbWVdLmIgPSB2YWx1ZS5iOwogICAgfSBlbHNlIHsKICAgICAgdGFyZ2V0VmFsdWVbcHJvcGVydHlOYW1lXS54ID0gdmFsdWUucjsKICAgICAgdGFyZ2V0VmFsdWVbcHJvcGVydHlOYW1lXS55ID0gdmFsdWUuZzsKICAgICAgdGFyZ2V0VmFsdWVbcHJvcGVydHlOYW1lXS56ID0gdmFsdWUuYjsKICAgIH0KICAgIHJldHVybjsKICB9CgogIHRhcmdldFZhbHVlW3Byb3BlcnR5TmFtZV0gPSB2YWx1ZTsKfQoKZnVuY3Rpb24gc3BsaXREb3QgKHBhdGgpIHsKICBpZiAocGF0aCBpbiBzcGxpdENhY2hlKSB7IHJldHVybiBzcGxpdENhY2hlW3BhdGhdOyB9CiAgc3BsaXRDYWNoZVtwYXRoXSA9IHBhdGguc3BsaXQoJy4nKTsKICByZXR1cm4gc3BsaXRDYWNoZVtwYXRoXTsKfQoKZnVuY3Rpb24gaXNSYXdQcm9wZXJ0eSAoZGF0YSkgewogIHJldHVybiBkYXRhLmlzUmF3UHJvcGVydHkgfHwgZGF0YS5wcm9wZXJ0eS5zdGFydHNXaXRoKFNUUklOR19DT01QT05FTlRTKSB8fAogICAgICAgICBkYXRhLnByb3BlcnR5LnN0YXJ0c1dpdGgoU1RSSU5HX09CSkVDVDNEKTsKfQoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscyI6MTc5LCJzdXBlci1hbmltZWpzIjozNn1dLDU2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CgovKioKICogQ2FtZXJhIGNvbXBvbmVudC4KICogUGFpcnMgYWxvbmcgd2l0aCBjYW1lcmEgc3lzdGVtIHRvIGhhbmRsZSB0cmFja2luZyB0aGUgYWN0aXZlIGNhbWVyYS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdjYW1lcmEnLCB7CiAgc2NoZW1hOiB7CiAgICBhY3RpdmU6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGZhcjoge2RlZmF1bHQ6IDEwMDAwfSwKICAgIGZvdjoge2RlZmF1bHQ6IDgwLCBtaW46IDB9LAogICAgbmVhcjoge2RlZmF1bHQ6IDAuMDA1LCBtaW46IDB9LAogICAgc3BlY3RhdG9yOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgem9vbToge2RlZmF1bHQ6IDEsIG1pbjogMH0KICB9LAoKICAvKioKICAgKiBJbml0aWFsaXplIHRocmVlLmpzIGNhbWVyYSBhbmQgYWRkIGl0IHRvIHRoZSBlbnRpdHkuCiAgICogQWRkIHJlZmVyZW5jZSBmcm9tIHNjZW5lIHRvIHRoaXMgZW50aXR5IGFzIHRoZSBjYW1lcmEuCiAgICovCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIGNhbWVyYTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CgogICAgLy8gQ3JlYXRlIGNhbWVyYS4KICAgIGNhbWVyYSA9IHRoaXMuY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCk7CiAgICBlbC5zZXRPYmplY3QzRCgnY2FtZXJhJywgY2FtZXJhKTsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgdGhyZWUuanMgY2FtZXJhLgogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGNhbWVyYSA9IHRoaXMuY2FtZXJhOwoKICAgIC8vIFVwZGF0ZSBwcm9wZXJ0aWVzLgogICAgY2FtZXJhLmFzcGVjdCA9IGRhdGEuYXNwZWN0IHx8ICh3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCk7CiAgICBjYW1lcmEuZmFyID0gZGF0YS5mYXI7CiAgICBjYW1lcmEuZm92ID0gZGF0YS5mb3Y7CiAgICBjYW1lcmEubmVhciA9IGRhdGEubmVhcjsKICAgIGNhbWVyYS56b29tID0gZGF0YS56b29tOwogICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICB0aGlzLnVwZGF0ZUFjdGl2ZUNhbWVyYShvbGREYXRhKTsKICAgIHRoaXMudXBkYXRlU3BlY3RhdG9yQ2FtZXJhKG9sZERhdGEpOwogIH0sCgogIHVwZGF0ZUFjdGl2ZUNhbWVyYTogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzeXN0ZW0gPSB0aGlzLnN5c3RlbTsKICAgIC8vIEFjdGl2ZSBwcm9wZXJ0eSBkaWQgbm90IGNoYW5nZS4KICAgIGlmIChvbGREYXRhICYmIG9sZERhdGEuYWN0aXZlID09PSBkYXRhLmFjdGl2ZSB8fCBkYXRhLnNwZWN0YXRvcikgeyByZXR1cm47IH0KCiAgICAvLyBJZiBgYWN0aXZlYCBwcm9wZXJ0eSBjaGFuZ2VzLCBvciBmaXJzdCB1cGRhdGUsIGhhbmRsZSBhY3RpdmUgY2FtZXJhIHdpdGggc3lzdGVtLgogICAgaWYgKGRhdGEuYWN0aXZlICYmIHN5c3RlbS5hY3RpdmVDYW1lcmFFbCAhPT0gZWwpIHsKICAgICAgLy8gQ2FtZXJhIGVuYWJsZWQuIFNldCBjYW1lcmEgdG8gdGhpcyBjYW1lcmEuCiAgICAgIHN5c3RlbS5zZXRBY3RpdmVDYW1lcmEoZWwpOwogICAgfSBlbHNlIGlmICghZGF0YS5hY3RpdmUgJiYgc3lzdGVtLmFjdGl2ZUNhbWVyYUVsID09PSBlbCkgewogICAgICAvLyBDYW1lcmEgZGlzYWJsZWQuIFNldCBjYW1lcmEgdG8gYW5vdGhlciBjYW1lcmEuCiAgICAgIHN5c3RlbS5kaXNhYmxlQWN0aXZlQ2FtZXJhKCk7CiAgICB9CiAgfSwKCiAgdXBkYXRlU3BlY3RhdG9yQ2FtZXJhOiBmdW5jdGlvbiAob2xkRGF0YSkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIHN5c3RlbSA9IHRoaXMuc3lzdGVtOwogICAgLy8gc3BlY3RhdG9yIHByb3BlcnR5IGRpZCBub3QgY2hhbmdlLgogICAgaWYgKG9sZERhdGEgJiYgb2xkRGF0YS5zcGVjdGF0b3IgPT09IGRhdGEuc3BlY3RhdG9yKSB7IHJldHVybjsgfQoKICAgIC8vIElmIGBzcGVjdGF0b3JgIHByb3BlcnR5IGNoYW5nZXMsIG9yIGZpcnN0IHVwZGF0ZSwgaGFuZGxlIHNwZWN0YXRvciBjYW1lcmEgd2l0aCBzeXN0ZW0uCiAgICBpZiAoZGF0YS5zcGVjdGF0b3IgJiYgc3lzdGVtLnNwZWN0YXRvckNhbWVyYUVsICE9PSBlbCkgewogICAgICAvLyBDYW1lcmEgZW5hYmxlZC4gU2V0IGNhbWVyYSB0byB0aGlzIGNhbWVyYS4KICAgICAgc3lzdGVtLnNldFNwZWN0YXRvckNhbWVyYShlbCk7CiAgICB9IGVsc2UgaWYgKCFkYXRhLnNwZWN0YXRvciAmJiBzeXN0ZW0uc3BlY3RhdG9yQ2FtZXJhRWwgPT09IGVsKSB7CiAgICAgIC8vIENhbWVyYSBkaXNhYmxlZC4gU2V0IGNhbWVyYSB0byBhbm90aGVyIGNhbWVyYS4KICAgICAgc3lzdGVtLmRpc2FibGVTcGVjdGF0b3JDYW1lcmEoKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBSZW1vdmUgY2FtZXJhIG9uIHJlbW92ZSAoY2FsbGJhY2spLgogICAqLwogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbC5yZW1vdmVPYmplY3QzRCgnY2FtZXJhJyk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NH1dLDU3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyogZ2xvYmFsIFRIUkVFICovCnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwoKdmFyIGJpbmQgPSB1dGlscy5iaW5kOwoKdmFyIEVWRU5UUyA9IHsKICBDTElDSzogJ2NsaWNrJywKICBGVVNJTkc6ICdmdXNpbmcnLAogIE1PVVNFRU5URVI6ICdtb3VzZWVudGVyJywKICBNT1VTRURPV046ICdtb3VzZWRvd24nLAogIE1PVVNFTEVBVkU6ICdtb3VzZWxlYXZlJywKICBNT1VTRVVQOiAnbW91c2V1cCcKfTsKCnZhciBTVEFURVMgPSB7CiAgRlVTSU5HOiAnY3Vyc29yLWZ1c2luZycsCiAgSE9WRVJJTkc6ICdjdXJzb3ItaG92ZXJpbmcnLAogIEhPVkVSRUQ6ICdjdXJzb3ItaG92ZXJlZCcKfTsKCnZhciBDQU5WQVNfRVZFTlRTID0gewogIERPV046IFsnbW91c2Vkb3duJywgJ3RvdWNoc3RhcnQnXSwKICBVUDogWydtb3VzZXVwJywgJ3RvdWNoZW5kJ10KfTsKCnZhciBDQU5WQVNfSE9WRVJfQ0xBU1MgPSAnYS1tb3VzZS1jdXJzb3ItaG92ZXInOwoKLyoqCiAqIEN1cnNvciBjb21wb25lbnQuIEFwcGxpZXMgdGhlIHJheWNhc3RlciBjb21wb25lbnQgc3BlY2lmaWNhbGx5IGZvciBzdGFydGluZyB0aGUgcmF5Y2FzdGVyCiAqIGZyb20gdGhlIGNhbWVyYSBhbmQgcG9pbnRpbmcgZnJvbSBjYW1lcmEncyBmYWNpbmcgZGlyZWN0aW9uLCBhbmQgdGhlbiBvbmx5IHJldHVybmluZyB0aGUKICogY2xvc2VzdCBpbnRlcnNlY3Rpb24uIEN1cnNvciBjYW4gYmUgZmluZS10dW5lZCBieSBzZXR0aW5nIHJheWNhc3RlciBwcm9wZXJ0aWVzLgogKgogKiBAbWVtYmVyIHtvYmplY3R9IGZ1c2VUaW1lb3V0IC0gVGltZW91dCB0byB0cmlnZ2VyIGZ1c2UtY2xpY2suCiAqIEBtZW1iZXIge0VsZW1lbnR9IGN1cnNvckRvd25FbCAtIEVudGl0eSB0aGF0IHdhcyBsYXN0IG1vdXNlZG93bmVkIGR1cmluZyBjdXJyZW50IGNsaWNrLgogKiBAbWVtYmVyIHtvYmplY3R9IGludGVyc2VjdGlvbiAtIEF0dHJpYnV0ZXMgb2YgdGhlIGN1cnJlbnQgaW50ZXJzZWN0aW9uIGV2ZW50LCBpbmNsdWRpbmcKICogICAgICAgICAzRC0gYW5kIDJELXNwYWNlIGNvb3JkaW5hdGVzLiBTZWU6IGh0dHA6Ly90aHJlZWpzLm9yZy9kb2NzL2FwaS9jb3JlL1JheWNhc3Rlci5odG1sCiAqIEBtZW1iZXIge0VsZW1lbnR9IGludGVyc2VjdGVkRWwgLSBDdXJyZW50bHktaW50ZXJzZWN0ZWQgZW50aXR5LiBVc2VkIHRvIGtlZXAgdHJhY2sgdG8KICogICAgICAgICBlbWl0IGV2ZW50cyB3aGVuIHVuaW50ZXJzZWN0aW5nLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ2N1cnNvcicsIHsKICBkZXBlbmRlbmNpZXM6IFsncmF5Y2FzdGVyJ10sCgogIHNjaGVtYTogewogICAgZG93bkV2ZW50czoge2RlZmF1bHQ6IFtdfSwKICAgIGZ1c2U6IHtkZWZhdWx0OiB1dGlscy5kZXZpY2UuaXNNb2JpbGUoKX0sCiAgICBmdXNlVGltZW91dDoge2RlZmF1bHQ6IDE1MDAsIG1pbjogMH0sCiAgICBtb3VzZUN1cnNvclN0eWxlc0VuYWJsZWQ6IHtkZWZhdWx0OiB0cnVlfSwKICAgIHVwRXZlbnRzOiB7ZGVmYXVsdDogW119LAogICAgcmF5T3JpZ2luOiB7ZGVmYXVsdDogJ2VudGl0eScsIG9uZU9mOiBbJ21vdXNlJywgJ2VudGl0eSddfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB0aGlzLmZ1c2VUaW1lb3V0ID0gdW5kZWZpbmVkOwogICAgdGhpcy5jdXJzb3JEb3duRWwgPSBudWxsOwogICAgdGhpcy5pbnRlcnNlY3RlZEVsID0gbnVsbDsKICAgIHRoaXMuY2FudmFzQm91bmRzID0gZG9jdW1lbnQuYm9keS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAvLyBEZWJvdW5jZS4KICAgIHRoaXMudXBkYXRlQ2FudmFzQm91bmRzID0gdXRpbHMuZGVib3VuY2UoZnVuY3Rpb24gdXBkYXRlQ2FudmFzQm91bmRzICgpIHsKICAgICAgc2VsZi5jYW52YXNCb3VuZHMgPSBzZWxmLmVsLnNjZW5lRWwuY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgfSwgNTAwKTsKCiAgICB0aGlzLmV2ZW50RGV0YWlsID0ge307CiAgICB0aGlzLmludGVyc2VjdGVkRXZlbnREZXRhaWwgPSB7Y3Vyc29yRWw6IHRoaXMuZWx9OwoKICAgIC8vIEJpbmQgbWV0aG9kcy4KICAgIHRoaXMub25DdXJzb3JEb3duID0gYmluZCh0aGlzLm9uQ3Vyc29yRG93biwgdGhpcyk7CiAgICB0aGlzLm9uQ3Vyc29yVXAgPSBiaW5kKHRoaXMub25DdXJzb3JVcCwgdGhpcyk7CiAgICB0aGlzLm9uSW50ZXJzZWN0aW9uID0gYmluZCh0aGlzLm9uSW50ZXJzZWN0aW9uLCB0aGlzKTsKICAgIHRoaXMub25JbnRlcnNlY3Rpb25DbGVhcmVkID0gYmluZCh0aGlzLm9uSW50ZXJzZWN0aW9uQ2xlYXJlZCwgdGhpcyk7CiAgICB0aGlzLm9uTW91c2VNb3ZlID0gYmluZCh0aGlzLm9uTW91c2VNb3ZlLCB0aGlzKTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICBpZiAodGhpcy5kYXRhLnJheU9yaWdpbiA9PT0gb2xkRGF0YS5yYXlPcmlnaW4pIHsgcmV0dXJuOyB9CiAgICB0aGlzLnVwZGF0ZU1vdXNlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVTdGF0ZShTVEFURVMuSE9WRVJJTkcpOwogICAgZWwucmVtb3ZlU3RhdGUoU1RBVEVTLkZVU0lORyk7CiAgICBjbGVhclRpbWVvdXQodGhpcy5mdXNlVGltZW91dCk7CiAgICBpZiAodGhpcy5pbnRlcnNlY3RlZEVsKSB7IHRoaXMuaW50ZXJzZWN0ZWRFbC5yZW1vdmVTdGF0ZShTVEFURVMuSE9WRVJFRCk7IH0KICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICBhZGRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGNhbnZhczsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBmdW5jdGlvbiBhZGRDYW52YXNMaXN0ZW5lcnMgKCkgewogICAgICBjYW52YXMgPSBlbC5zY2VuZUVsLmNhbnZhczsKICAgICAgaWYgKGRhdGEuZG93bkV2ZW50cy5sZW5ndGggfHwgZGF0YS51cEV2ZW50cy5sZW5ndGgpIHsgcmV0dXJuOyB9CiAgICAgIENBTlZBU19FVkVOVFMuRE9XTi5mb3JFYWNoKGZ1bmN0aW9uIChkb3duRXZlbnQpIHsKICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihkb3duRXZlbnQsIHNlbGYub25DdXJzb3JEb3duKTsKICAgICAgfSk7CiAgICAgIENBTlZBU19FVkVOVFMuVVAuZm9yRWFjaChmdW5jdGlvbiAodXBFdmVudCkgewogICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKHVwRXZlbnQsIHNlbGYub25DdXJzb3JVcCk7CiAgICAgIH0pOwogICAgfQoKICAgIGNhbnZhcyA9IGVsLnNjZW5lRWwuY2FudmFzOwogICAgaWYgKGNhbnZhcykgewogICAgICBhZGRDYW52YXNMaXN0ZW5lcnMoKTsKICAgIH0gZWxzZSB7CiAgICAgIGVsLnNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyLXRhcmdldC1sb2FkZWQnLCBhZGRDYW52YXNMaXN0ZW5lcnMpOwogICAgfQoKICAgIGRhdGEuZG93bkV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChkb3duRXZlbnQpIHsKICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihkb3duRXZlbnQsIHNlbGYub25DdXJzb3JEb3duKTsKICAgIH0pOwogICAgZGF0YS51cEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uICh1cEV2ZW50KSB7CiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodXBFdmVudCwgc2VsZi5vbkN1cnNvclVwKTsKICAgIH0pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncmF5Y2FzdGVyLWludGVyc2VjdGlvbicsIHRoaXMub25JbnRlcnNlY3Rpb24pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncmF5Y2FzdGVyLWludGVyc2VjdGlvbi1jbGVhcmVkJywgdGhpcy5vbkludGVyc2VjdGlvbkNsZWFyZWQpOwoKICAgIGVsLnNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyZXJyZXNpemUnLCB0aGlzLnVwZGF0ZUNhbnZhc0JvdW5kcyk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy51cGRhdGVDYW52YXNCb3VuZHMpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMudXBkYXRlQ2FudmFzQm91bmRzKTsKCiAgICB0aGlzLnVwZGF0ZU1vdXNlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGNhbnZhczsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBjYW52YXMgPSBlbC5zY2VuZUVsLmNhbnZhczsKICAgIGlmIChjYW52YXMgJiYgIWRhdGEuZG93bkV2ZW50cy5sZW5ndGggJiYgIWRhdGEudXBFdmVudHMubGVuZ3RoKSB7CiAgICAgIENBTlZBU19FVkVOVFMuRE9XTi5mb3JFYWNoKGZ1bmN0aW9uIChkb3duRXZlbnQpIHsKICAgICAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihkb3duRXZlbnQsIHNlbGYub25DdXJzb3JEb3duKTsKICAgICAgfSk7CiAgICAgIENBTlZBU19FVkVOVFMuVVAuZm9yRWFjaChmdW5jdGlvbiAodXBFdmVudCkgewogICAgICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKHVwRXZlbnQsIHNlbGYub25DdXJzb3JVcCk7CiAgICAgIH0pOwogICAgfQoKICAgIGRhdGEuZG93bkV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChkb3duRXZlbnQpIHsKICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihkb3duRXZlbnQsIHNlbGYub25DdXJzb3JEb3duKTsKICAgIH0pOwogICAgZGF0YS51cEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uICh1cEV2ZW50KSB7CiAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIodXBFdmVudCwgc2VsZi5vbkN1cnNvclVwKTsKICAgIH0pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmF5Y2FzdGVyLWludGVyc2VjdGlvbicsIHRoaXMub25JbnRlcnNlY3Rpb24pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmF5Y2FzdGVyLWludGVyc2VjdGlvbi1jbGVhcmVkJywgdGhpcy5vbkludGVyc2VjdGlvbkNsZWFyZWQpOwogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMub25Nb3VzZU1vdmUpOwogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uTW91c2VNb3ZlKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlKTsKCiAgICBlbC5zY2VuZUVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbmRlcmVycmVzaXplJywgdGhpcy51cGRhdGVDYW52YXNCb3VuZHMpOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMudXBkYXRlQ2FudmFzQm91bmRzKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnVwZGF0ZUNhbnZhc0JvdW5kcyk7CiAgfSwKCiAgdXBkYXRlTW91c2VFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGNhbnZhczsKICAgIHZhciBlbCA9IHRoaXMuZWw7CgogICAgY2FudmFzID0gZWwuc2NlbmVFbC5jYW52YXM7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZSk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5vbk1vdXNlTW92ZSk7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ3JheWNhc3RlcicsICd1c2VXb3JsZENvb3JkaW5hdGVzJywgZmFsc2UpOwogICAgaWYgKHRoaXMuZGF0YS5yYXlPcmlnaW4gIT09ICdtb3VzZScpIHsgcmV0dXJuOyB9CiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZSwgZmFsc2UpOwogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMub25Nb3VzZU1vdmUsIGZhbHNlKTsKICAgIGVsLnNldEF0dHJpYnV0ZSgncmF5Y2FzdGVyJywgJ3VzZVdvcmxkQ29vcmRpbmF0ZXMnLCB0cnVlKTsKICAgIHRoaXMudXBkYXRlQ2FudmFzQm91bmRzKCk7CiAgfSwKCiAgb25Nb3VzZU1vdmU6IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIHZhciBtb3VzZSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7CiAgICB2YXIgb3JpZ2luID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIHZhciByYXlDYXN0ZXJDb25maWcgPSB7b3JpZ2luOiBvcmlnaW4sIGRpcmVjdGlvbjogZGlyZWN0aW9ufTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKGV2dCkgewogICAgICB2YXIgYm91bmRzID0gdGhpcy5jYW52YXNCb3VuZHM7CiAgICAgIHZhciBjYW1lcmEgPSB0aGlzLmVsLnNjZW5lRWwuY2FtZXJhOwogICAgICB2YXIgbGVmdDsKICAgICAgdmFyIHBvaW50OwogICAgICB2YXIgdG9wOwoKICAgICAgY2FtZXJhLnBhcmVudC51cGRhdGVNYXRyaXhXb3JsZCgpOwoKICAgICAgLy8gQ2FsY3VsYXRlIG1vdXNlIHBvc2l0aW9uIGJhc2VkIG9uIHRoZSBjYW52YXMgZWxlbWVudAogICAgICBpZiAoZXZ0LnR5cGUgPT09ICd0b3VjaG1vdmUnIHx8IGV2dC50eXBlID09PSAndG91Y2hzdGFydCcpIHsKICAgICAgICAvLyBUcmFjayB0aGUgZmlyc3QgdG91Y2ggZm9yIHNpbXBsaWNpdHkuCiAgICAgICAgcG9pbnQgPSBldnQudG91Y2hlcy5pdGVtKDApOwogICAgICB9IGVsc2UgewogICAgICAgIHBvaW50ID0gZXZ0OwogICAgICB9CgogICAgICBsZWZ0ID0gcG9pbnQuY2xpZW50WCAtIGJvdW5kcy5sZWZ0OwogICAgICB0b3AgPSBwb2ludC5jbGllbnRZIC0gYm91bmRzLnRvcDsKICAgICAgbW91c2UueCA9IChsZWZ0IC8gYm91bmRzLndpZHRoKSAqIDIgLSAxOwogICAgICBtb3VzZS55ID0gLSh0b3AgLyBib3VuZHMuaGVpZ2h0KSAqIDIgKyAxOwoKICAgICAgb3JpZ2luLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpOwogICAgICBkaXJlY3Rpb24uc2V0KG1vdXNlLngsIG1vdXNlLnksIDAuNSkudW5wcm9qZWN0KGNhbWVyYSkuc3ViKG9yaWdpbikubm9ybWFsaXplKCk7CiAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdyYXljYXN0ZXInLCByYXlDYXN0ZXJDb25maWcpOwogICAgICBpZiAoZXZ0LnR5cGUgPT09ICd0b3VjaG1vdmUnKSB7IGV2dC5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICB9OwogIH0pKCksCgogIC8qKgogICAqIFRyaWdnZXIgbW91c2Vkb3duIGFuZCBrZWVwIHRyYWNrIG9mIHRoZSBtb3VzZWRvd25lZCBlbnRpdHkuCiAgICovCiAgb25DdXJzb3JEb3duOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAvLyBSYXljYXN0IGFnYWluIGZvciB0b3VjaC4KICAgIGlmICh0aGlzLmRhdGEucmF5T3JpZ2luID09PSAnbW91c2UnICYmIGV2dC50eXBlID09PSAndG91Y2hzdGFydCcpIHsKICAgICAgdGhpcy5vbk1vdXNlTW92ZShldnQpOwogICAgICB0aGlzLmVsLmNvbXBvbmVudHMucmF5Y2FzdGVyLmNoZWNrSW50ZXJzZWN0aW9ucygpOwogICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgIH0KCiAgICB0aGlzLnR3b1dheUVtaXQoRVZFTlRTLk1PVVNFRE9XTik7CiAgICB0aGlzLmN1cnNvckRvd25FbCA9IHRoaXMuaW50ZXJzZWN0ZWRFbDsKICB9LAoKICAvKioKICAgKiBUcmlnZ2VyIG1vdXNldXAgaWY6CiAgICogLSBOb3QgZnVzaW5nIChtb2JpbGUgaGFzIG5vIG1vdXNlKS4KICAgKiAtIEN1cnJlbnRseSBpbnRlcnNlY3RpbmcgYW4gZW50aXR5LgogICAqIC0gQ3VycmVudGx5LWludGVyc2VjdGVkIGVudGl0eSBpcyB0aGUgc2FtZSBhcyB0aGUgb25lIHdoZW4gbW91c2Vkb3duIHdhcyB0cmlnZ2VyZWQsCiAgICogICBpbiBjYXNlIHVzZXIgbW91c2Vkb3duZWQgb25lIGVudGl0eSwgZHJhZ2dlZCB0byBhbm90aGVyLCBhbmQgbW91c2V1cHBlZC4KICAgKi8KICBvbkN1cnNvclVwOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHRoaXMudHdvV2F5RW1pdChFVkVOVFMuTU9VU0VVUCk7CgogICAgLy8gSWYgaW50ZXJzZWN0ZWQgZW50aXR5IGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBjdXJzb3JEb3duLCBzdGlsbCBlbWl0IG1vdXNlVXAgb24gdGhlCiAgICAvLyBwcmV2aW91c2x5IGN1cnNvclVwIGVudGl0eS4KICAgIGlmICh0aGlzLmN1cnNvckRvd25FbCAmJiB0aGlzLmN1cnNvckRvd25FbCAhPT0gdGhpcy5pbnRlcnNlY3RlZEVsKSB7CiAgICAgIHRoaXMuaW50ZXJzZWN0ZWRFdmVudERldGFpbC5pbnRlcnNlY3Rpb24gPSBudWxsOwogICAgICB0aGlzLmN1cnNvckRvd25FbC5lbWl0KEVWRU5UUy5NT1VTRVVQLCB0aGlzLmludGVyc2VjdGVkRXZlbnREZXRhaWwpOwogICAgfQoKICAgIGlmICgoIWRhdGEuZnVzZSB8fCBkYXRhLnJheU9yaWdpbiA9PT0gJ21vdXNlJykgJiYKICAgICAgICB0aGlzLmludGVyc2VjdGVkRWwgJiYgdGhpcy5jdXJzb3JEb3duRWwgPT09IHRoaXMuaW50ZXJzZWN0ZWRFbCkgewogICAgICB0aGlzLnR3b1dheUVtaXQoRVZFTlRTLkNMSUNLKTsKICAgIH0KCiAgICB0aGlzLmN1cnNvckRvd25FbCA9IG51bGw7CiAgICBpZiAoZXZ0LnR5cGUgPT09ICd0b3VjaGVuZCcpIHsgZXZ0LnByZXZlbnREZWZhdWx0KCk7IH0KICB9LAoKICAvKioKICAgKiBIYW5kbGUgaW50ZXJzZWN0aW9uLgogICAqLwogIG9uSW50ZXJzZWN0aW9uOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgY3VycmVudEludGVyc2VjdGlvbjsKICAgIHZhciBjdXJzb3JFbCA9IHRoaXMuZWw7CiAgICB2YXIgaW5kZXg7CiAgICB2YXIgaW50ZXJzZWN0ZWRFbDsKICAgIHZhciBpbnRlcnNlY3Rpb247CgogICAgLy8gU2VsZWN0IGNsb3Nlc3Qgb2JqZWN0LCBleGNsdWRpbmcgdGhlIGN1cnNvci4KICAgIGluZGV4ID0gZXZ0LmRldGFpbC5lbHNbMF0gPT09IGN1cnNvckVsID8gMSA6IDA7CiAgICBpbnRlcnNlY3Rpb24gPSBldnQuZGV0YWlsLmludGVyc2VjdGlvbnNbaW5kZXhdOwogICAgaW50ZXJzZWN0ZWRFbCA9IGV2dC5kZXRhaWwuZWxzW2luZGV4XTsKCiAgICAvLyBJZiBjdXJzb3IgaXMgdGhlIG9ubHkgaW50ZXJzZWN0ZWQgb2JqZWN0LCBpZ25vcmUgdGhlIGV2ZW50LgogICAgaWYgKCFpbnRlcnNlY3RlZEVsKSB7IHJldHVybjsgfQoKICAgIC8vIEFscmVhZHkgaW50ZXJzZWN0aW5nIHRoaXMgZW50aXR5LgogICAgaWYgKHRoaXMuaW50ZXJzZWN0ZWRFbCA9PT0gaW50ZXJzZWN0ZWRFbCkgeyByZXR1cm47IH0KCiAgICAvLyBJZ25vcmUgZXZlbnRzIGZ1cnRoZXIgYXdheSB0aGFuIGFjdGl2ZSBpbnRlcnNlY3Rpb24uCiAgICBpZiAodGhpcy5pbnRlcnNlY3RlZEVsKSB7CiAgICAgIGN1cnJlbnRJbnRlcnNlY3Rpb24gPSB0aGlzLmVsLmNvbXBvbmVudHMucmF5Y2FzdGVyLmdldEludGVyc2VjdGlvbih0aGlzLmludGVyc2VjdGVkRWwpOwogICAgICBpZiAoY3VycmVudEludGVyc2VjdGlvbiAmJiBjdXJyZW50SW50ZXJzZWN0aW9uLmRpc3RhbmNlIDw9IGludGVyc2VjdGlvbi5kaXN0YW5jZSkgeyByZXR1cm47IH0KICAgIH0KCiAgICAvLyBVbnNldCBjdXJyZW50IGludGVyc2VjdGlvbi4KICAgIHRoaXMuY2xlYXJDdXJyZW50SW50ZXJzZWN0aW9uKHRydWUpOwoKICAgIHRoaXMuc2V0SW50ZXJzZWN0aW9uKGludGVyc2VjdGVkRWwsIGludGVyc2VjdGlvbik7CiAgfSwKCiAgLyoqCiAgICogSGFuZGxlIGludGVyc2VjdGlvbiBjbGVhcmVkLgogICAqLwogIG9uSW50ZXJzZWN0aW9uQ2xlYXJlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIGNsZWFyZWRFbHMgPSBldnQuZGV0YWlsLmNsZWFyZWRFbHM7CiAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBpbnRlcnNlY3Rpb24gaGFzIGVuZGVkCiAgICBpZiAoY2xlYXJlZEVscy5pbmRleE9mKHRoaXMuaW50ZXJzZWN0ZWRFbCkgPT09IC0xKSB7IHJldHVybjsgfQogICAgdGhpcy5jbGVhckN1cnJlbnRJbnRlcnNlY3Rpb24oKTsKICB9LAoKICBzZXRJbnRlcnNlY3Rpb246IGZ1bmN0aW9uIChpbnRlcnNlY3RlZEVsLCBpbnRlcnNlY3Rpb24pIHsKICAgIHZhciBjdXJzb3JFbCA9IHRoaXMuZWw7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAvLyBBbHJlYWR5IGludGVyc2VjdGluZy4KICAgIGlmICh0aGlzLmludGVyc2VjdGVkRWwgPT09IGludGVyc2VjdGVkRWwpIHsgcmV0dXJuOyB9CgogICAgLy8gU2V0IG5ldyBpbnRlcnNlY3Rpb24uCiAgICB0aGlzLmludGVyc2VjdGVkRWwgPSBpbnRlcnNlY3RlZEVsOwoKICAgIC8vIEhvdmVyaW5nLgogICAgY3Vyc29yRWwuYWRkU3RhdGUoU1RBVEVTLkhPVkVSSU5HKTsKICAgIGludGVyc2VjdGVkRWwuYWRkU3RhdGUoU1RBVEVTLkhPVkVSRUQpOwogICAgdGhpcy50d29XYXlFbWl0KEVWRU5UUy5NT1VTRUVOVEVSKTsKCiAgICBpZiAodGhpcy5kYXRhLm1vdXNlQ3Vyc29yU3R5bGVzRW5hYmxlZCAmJiB0aGlzLmRhdGEucmF5T3JpZ2luID09PSAnbW91c2UnKSB7CiAgICAgIHRoaXMuZWwuc2NlbmVFbC5jYW52YXMuY2xhc3NMaXN0LmFkZChDQU5WQVNfSE9WRVJfQ0xBU1MpOwogICAgfQoKICAgIC8vIEJlZ2luIGZ1c2UgaWYgbmVjZXNzYXJ5LgogICAgaWYgKGRhdGEuZnVzZVRpbWVvdXQgPT09IDAgfHwgIWRhdGEuZnVzZSkgeyByZXR1cm47IH0KICAgIGN1cnNvckVsLmFkZFN0YXRlKFNUQVRFUy5GVVNJTkcpOwogICAgdGhpcy50d29XYXlFbWl0KEVWRU5UUy5GVVNJTkcpOwogICAgdGhpcy5mdXNlVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gZnVzZSAoKSB7CiAgICAgIGN1cnNvckVsLnJlbW92ZVN0YXRlKFNUQVRFUy5GVVNJTkcpOwogICAgICBzZWxmLnR3b1dheUVtaXQoRVZFTlRTLkNMSUNLKTsKICAgIH0sIGRhdGEuZnVzZVRpbWVvdXQpOwogIH0sCgogIGNsZWFyQ3VycmVudEludGVyc2VjdGlvbjogZnVuY3Rpb24gKGlnbm9yZVJlbWFpbmluZykgewogICAgdmFyIGluZGV4OwogICAgdmFyIGludGVyc2VjdGlvbjsKICAgIHZhciBpbnRlcnNlY3Rpb25zOwogICAgdmFyIGN1cnNvckVsID0gdGhpcy5lbDsKCiAgICAvLyBOb3RoaW5nIHRvIGJlIGNsZWFyZWQuCiAgICBpZiAoIXRoaXMuaW50ZXJzZWN0ZWRFbCkgeyByZXR1cm47IH0KCiAgICAvLyBObyBsb25nZXIgaG92ZXJpbmcgKG9yIGZ1c2luZykuCiAgICB0aGlzLmludGVyc2VjdGVkRWwucmVtb3ZlU3RhdGUoU1RBVEVTLkhPVkVSRUQpOwogICAgY3Vyc29yRWwucmVtb3ZlU3RhdGUoU1RBVEVTLkhPVkVSSU5HKTsKICAgIGN1cnNvckVsLnJlbW92ZVN0YXRlKFNUQVRFUy5GVVNJTkcpOwogICAgdGhpcy50d29XYXlFbWl0KEVWRU5UUy5NT1VTRUxFQVZFKTsKCiAgICBpZiAodGhpcy5kYXRhLm1vdXNlQ3Vyc29yU3R5bGVzRW5hYmxlZCAmJiB0aGlzLmRhdGEucmF5T3JpZ2luID09PSAnbW91c2UnKSB7CiAgICAgIHRoaXMuZWwuc2NlbmVFbC5jYW52YXMuY2xhc3NMaXN0LnJlbW92ZShDQU5WQVNfSE9WRVJfQ0xBU1MpOwogICAgfQoKICAgIC8vIFVuc2V0IGludGVyc2VjdGVkIGVudGl0eSAoYWZ0ZXIgZW1pdHRpbmcgdGhlIGV2ZW50KS4KICAgIHRoaXMuaW50ZXJzZWN0ZWRFbCA9IG51bGw7CgogICAgLy8gQ2xlYXIgZnVzZVRpbWVvdXQuCiAgICBjbGVhclRpbWVvdXQodGhpcy5mdXNlVGltZW91dCk7CgogICAgLy8gU2V0IGludGVyc2VjdGlvbiB0byBhbm90aGVyIHJheWNhc3RlZCBlbGVtZW50IGlmIGFueS4KICAgIGlmIChpZ25vcmVSZW1haW5pbmcgPT09IHRydWUpIHsgcmV0dXJuOyB9CiAgICBpbnRlcnNlY3Rpb25zID0gdGhpcy5lbC5jb21wb25lbnRzLnJheWNhc3Rlci5pbnRlcnNlY3Rpb25zOwogICAgaWYgKGludGVyc2VjdGlvbnMubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfQogICAgLy8gRXhjbHVkZSB0aGUgY3Vyc29yLgogICAgaW5kZXggPSBpbnRlcnNlY3Rpb25zWzBdLm9iamVjdC5lbCA9PT0gY3Vyc29yRWwgPyAxIDogMDsKICAgIGludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbnNbaW5kZXhdOwogICAgaWYgKCFpbnRlcnNlY3Rpb24pIHsgcmV0dXJuOyB9CiAgICB0aGlzLnNldEludGVyc2VjdGlvbihpbnRlcnNlY3Rpb24ub2JqZWN0LmVsLCBpbnRlcnNlY3Rpb24pOwogIH0sCgogIC8qKgogICAqIEhlbHBlciB0byBlbWl0IG9uIGJvdGggdGhlIGN1cnNvciBhbmQgdGhlIGludGVyc2VjdGVkIGVudGl0eSAoaWYgZXhpc3RzKS4KICAgKi8KICB0d29XYXlFbWl0OiBmdW5jdGlvbiAoZXZ0TmFtZSkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBpbnRlcnNlY3RlZEVsID0gdGhpcy5pbnRlcnNlY3RlZEVsOwogICAgdmFyIGludGVyc2VjdGlvbjsKCiAgICBpbnRlcnNlY3Rpb24gPSB0aGlzLmVsLmNvbXBvbmVudHMucmF5Y2FzdGVyLmdldEludGVyc2VjdGlvbihpbnRlcnNlY3RlZEVsKTsKICAgIHRoaXMuZXZlbnREZXRhaWwuaW50ZXJzZWN0ZWRFbCA9IGludGVyc2VjdGVkRWw7CiAgICB0aGlzLmV2ZW50RGV0YWlsLmludGVyc2VjdGlvbiA9IGludGVyc2VjdGlvbjsKICAgIGVsLmVtaXQoZXZ0TmFtZSwgdGhpcy5ldmVudERldGFpbCk7CgogICAgaWYgKCFpbnRlcnNlY3RlZEVsKSB7IHJldHVybjsgfQoKICAgIHRoaXMuaW50ZXJzZWN0ZWRFdmVudERldGFpbC5pbnRlcnNlY3Rpb24gPSBpbnRlcnNlY3Rpb247CiAgICBpbnRlcnNlY3RlZEVsLmVtaXQoZXZ0TmFtZSwgdGhpcy5pbnRlcnNlY3RlZEV2ZW50RGV0YWlsKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL3V0aWxzLyI6MTc5fV0sNTg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgYmluZCA9IF9kZXJlcV8oJy4uL3V0aWxzL2JpbmQnKTsKCnZhciB0cmFja2VkQ29udHJvbHNVdGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMnKTsKdmFyIGNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLmNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cDsKdmFyIGVtaXRJZkF4ZXNDaGFuZ2VkID0gdHJhY2tlZENvbnRyb2xzVXRpbHMuZW1pdElmQXhlc0NoYW5nZWQ7CnZhciBvbkJ1dHRvbkV2ZW50ID0gdHJhY2tlZENvbnRyb2xzVXRpbHMub25CdXR0b25FdmVudDsKCnZhciBEQVlEUkVBTV9DT05UUk9MTEVSX01PREVMX0JBU0VfVVJMID0gJ2h0dHBzOi8vY2RuLmFmcmFtZS5pby9jb250cm9sbGVycy9nb29nbGUvJzsKdmFyIERBWURSRUFNX0NPTlRST0xMRVJfTU9ERUxfT0JKX1VSTCA9IERBWURSRUFNX0NPTlRST0xMRVJfTU9ERUxfQkFTRV9VUkwgKyAndnJfY29udHJvbGxlcl9kYXlkcmVhbS5vYmonOwp2YXIgREFZRFJFQU1fQ09OVFJPTExFUl9NT0RFTF9PQkpfTVRMID0gREFZRFJFQU1fQ09OVFJPTExFUl9NT0RFTF9CQVNFX1VSTCArICd2cl9jb250cm9sbGVyX2RheWRyZWFtLm10bCc7Cgp2YXIgR0FNRVBBRF9JRF9QUkVGSVggPSAnRGF5ZHJlYW0gQ29udHJvbGxlcic7CgovKioKICogRGF5ZHJlYW0gY29udHJvbHMuCiAqIEludGVyZmFjZSB3aXRoIERheWRyZWFtIGNvbnRyb2xsZXIgYW5kIG1hcCBHYW1lcGFkIGV2ZW50cyB0bwogKiBjb250cm9sbGVyIGJ1dHRvbnM6IHRyYWNrcGFkLCBtZW51LCBzeXN0ZW0KICogTG9hZCBhIGNvbnRyb2xsZXIgbW9kZWwgYW5kIGhpZ2hsaWdodCB0aGUgcHJlc3NlZCBidXR0b25zLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ2RheWRyZWFtLWNvbnRyb2xzJywgewogIHNjaGVtYTogewogICAgaGFuZDoge2RlZmF1bHQ6ICcnfSwgIC8vIFRoaXMgaW5mb3JtcyB0aGUgZGVnZW5lcmF0ZSBhcm0gbW9kZWwuCiAgICBidXR0b25Db2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjMDAwMDAwJ30sCiAgICBidXR0b25Ub3VjaGVkQ29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnIzc3Nzc3Nyd9LAogICAgYnV0dG9uSGlnaGxpZ2h0Q29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnI0ZGRkZGRid9LAogICAgbW9kZWw6IHtkZWZhdWx0OiB0cnVlfSwKICAgIG9yaWVudGF0aW9uT2Zmc2V0OiB7dHlwZTogJ3ZlYzMnfSwKICAgIGFybU1vZGVsOiB7ZGVmYXVsdDogdHJ1ZX0KICB9LAoKICAvKioKICAgKiBCdXR0b24gSURzOgogICAqIDAgLSB0cmFja3BhZAogICAqIDEgLSBtZW51IChuZXZlciBkaXNwYXRjaGVkIG9uIHRoaXMgbGF5ZXIpCiAgICogMiAtIHN5c3RlbSAobmV2ZXIgZGlzcGF0Y2hlZCBvbiB0aGlzIGxheWVyKQogICAqLwogIG1hcHBpbmc6IHsKICAgIGF4ZXM6IHt0cmFja3BhZDogWzAsIDFdfSwKICAgIGJ1dHRvbnM6IFsndHJhY2twYWQnLCAnbWVudScsICdzeXN0ZW0nXQogIH0sCgogIGJpbmRNZXRob2RzOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9uTW9kZWxMb2FkZWQgPSBiaW5kKHRoaXMub25Nb2RlbExvYWRlZCwgdGhpcyk7CiAgICB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUgPSBiaW5kKHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSwgdGhpcyk7CiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCA9IGJpbmQodGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQsIHRoaXMpOwogICAgdGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyID0gYmluZCh0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIsIHRoaXMpOwogICAgdGhpcy5vbkF4aXNNb3ZlZCA9IGJpbmQodGhpcy5vbkF4aXNNb3ZlZCwgdGhpcyk7CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdGhpcy5vbkJ1dHRvbkNoYW5nZWQgPSBiaW5kKHRoaXMub25CdXR0b25DaGFuZ2VkLCB0aGlzKTsKICAgIHRoaXMub25CdXR0b25Eb3duID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICdkb3duJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVXAgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3VwJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAndG91Y2hzdGFydCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoRW5kID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaGVuZCcsIHNlbGYpOyB9OwogICAgdGhpcy5jb250cm9sbGVyUHJlc2VudCA9IGZhbHNlOwogICAgdGhpcy5sYXN0Q29udHJvbGxlckNoZWNrID0gMDsKICAgIHRoaXMuYmluZE1ldGhvZHMoKTsKICB9LAoKICBhZGRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vZGVsLWxvYWRlZCcsIHRoaXMub25Nb2RlbExvYWRlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdheGlzbW92ZScsIHRoaXMub25BeGlzTW92ZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gdHJ1ZTsKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vZGVsLWxvYWRlZCcsIHRoaXMub25Nb2RlbExvYWRlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdheGlzbW92ZScsIHRoaXMub25BeGlzTW92ZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gZmFsc2U7CiAgfSwKCiAgY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50OiBmdW5jdGlvbiAoKSB7CiAgICBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAodGhpcywgR0FNRVBBRF9JRF9QUkVGSVgsIHtoYW5kOiB0aGlzLmRhdGEuaGFuZH0pOwogIH0sCgogIHBsYXk6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50KCk7CiAgICB0aGlzLmFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICBwYXVzZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpOwogICAgdGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyKCk7CiAgfSwKCiAgaW5qZWN0VHJhY2tlZENvbnRyb2xzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RyYWNrZWQtY29udHJvbHMnLCB7CiAgICAgIGFybU1vZGVsOiBkYXRhLmFybU1vZGVsLAogICAgICBoYW5kOiBkYXRhLmhhbmQsCiAgICAgIGlkUHJlZml4OiBHQU1FUEFEX0lEX1BSRUZJWCwKICAgICAgb3JpZW50YXRpb25PZmZzZXQ6IGRhdGEub3JpZW50YXRpb25PZmZzZXQKICAgIH0pOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnb2JqLW1vZGVsJywgewogICAgICBvYmo6IERBWURSRUFNX0NPTlRST0xMRVJfTU9ERUxfT0JKX1VSTCwKICAgICAgbXRsOiBEQVlEUkVBTV9DT05UUk9MTEVSX01PREVMX09CSl9NVEwKICAgIH0pOwogIH0sCgogIGFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICByZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCBmYWxzZSk7CiAgfSwKCiAgb25Db250cm9sbGVyc1VwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICB9LAoKICBvbk1vZGVsTG9hZGVkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgY29udHJvbGxlck9iamVjdDNEID0gZXZ0LmRldGFpbC5tb2RlbDsKICAgIHZhciBidXR0b25NZXNoZXM7CiAgICBpZiAoIXRoaXMuZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzID0ge307CiAgICBidXR0b25NZXNoZXMubWVudSA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ0FwcEJ1dHRvbl9BcHBCdXR0b25fQ3lsaW5kZXIuMDA0Jyk7CiAgICBidXR0b25NZXNoZXMuc3lzdGVtID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnSG9tZUJ1dHRvbl9Ib21lQnV0dG9uX0N5bGluZGVyLjAwNScpOwogICAgYnV0dG9uTWVzaGVzLnRyYWNrcGFkID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnVG91Y2hQYWRfVG91Y2hQYWRfQ3lsaW5kZXIuMDAzJyk7CiAgICAvLyBPZmZzZXQgcGl2b3QgcG9pbnQuCiAgICBjb250cm9sbGVyT2JqZWN0M0QucG9zaXRpb24uc2V0KDAsIDAsIC0wLjA0KTsKICB9LAoKICBvbkF4aXNNb3ZlZDogZnVuY3Rpb24gKGV2dCkgewogICAgZW1pdElmQXhlc0NoYW5nZWQodGhpcywgdGhpcy5tYXBwaW5nLmF4ZXMsIGV2dCk7CiAgfSwKCiAgb25CdXR0b25DaGFuZ2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgYnV0dG9uID0gdGhpcy5tYXBwaW5nLmJ1dHRvbnNbZXZ0LmRldGFpbC5pZF07CiAgICBpZiAoIWJ1dHRvbikgcmV0dXJuOwogICAgLy8gUGFzcyBhbG9uZyBjaGFuZ2VkIGV2ZW50IHdpdGggYnV0dG9uIHN0YXRlLCB1c2luZyBidXR0b24gbWFwcGluZyBmb3IgY29udmVuaWVuY2UuCiAgICB0aGlzLmVsLmVtaXQoYnV0dG9uICsgJ2NoYW5nZWQnLCBldnQuZGV0YWlsLnN0YXRlKTsKICB9LAoKICB1cGRhdGVNb2RlbDogZnVuY3Rpb24gKGJ1dHRvbk5hbWUsIGV2dE5hbWUpIHsKICAgIGlmICghdGhpcy5kYXRhLm1vZGVsKSB7IHJldHVybjsgfQogICAgdGhpcy51cGRhdGVCdXR0b25Nb2RlbChidXR0b25OYW1lLCBldnROYW1lKTsKICB9LAoKICB1cGRhdGVCdXR0b25Nb2RlbDogZnVuY3Rpb24gKGJ1dHRvbk5hbWUsIHN0YXRlKSB7CiAgICB2YXIgYnV0dG9uTWVzaGVzID0gdGhpcy5idXR0b25NZXNoZXM7CiAgICBpZiAoIWJ1dHRvbk1lc2hlcyB8fCAhYnV0dG9uTWVzaGVzW2J1dHRvbk5hbWVdKSB7IHJldHVybjsgfQogICAgdmFyIGNvbG9yOwogICAgc3dpdGNoIChzdGF0ZSkgewogICAgICBjYXNlICdkb3duJzoKICAgICAgICBjb2xvciA9IHRoaXMuZGF0YS5idXR0b25IaWdobGlnaHRDb2xvcjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAndG91Y2hzdGFydCc6CiAgICAgICAgY29sb3IgPSB0aGlzLmRhdGEuYnV0dG9uVG91Y2hlZENvbG9yOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbG9yID0gdGhpcy5kYXRhLmJ1dHRvbkNvbG9yOwogICAgfQogICAgYnV0dG9uTWVzaGVzW2J1dHRvbk5hbWVdLm1hdGVyaWFsLmNvbG9yLnNldChjb2xvcik7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi91dGlscy9iaW5kIjoxNzMsIi4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMiOjE4N31dLDU5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIGJpbmQgPSBfZGVyZXFfKCcuLi91dGlscy9iaW5kJyk7Cgp2YXIgdHJhY2tlZENvbnRyb2xzVXRpbHMgPSBfZGVyZXFfKCcuLi91dGlscy90cmFja2VkLWNvbnRyb2xzJyk7CnZhciBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAgPSB0cmFja2VkQ29udHJvbHNVdGlscy5jaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXA7CnZhciBlbWl0SWZBeGVzQ2hhbmdlZCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLmVtaXRJZkF4ZXNDaGFuZ2VkOwp2YXIgb25CdXR0b25FdmVudCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLm9uQnV0dG9uRXZlbnQ7Cgp2YXIgR0VBUlZSX0NPTlRST0xMRVJfTU9ERUxfQkFTRV9VUkwgPSAnaHR0cHM6Ly9jZG4uYWZyYW1lLmlvL2NvbnRyb2xsZXJzL3NhbXN1bmcvJzsKdmFyIEdFQVJWUl9DT05UUk9MTEVSX01PREVMX09CSl9VUkwgPSBHRUFSVlJfQ09OVFJPTExFUl9NT0RFTF9CQVNFX1VSTCArICdnZWFyX3ZyX2NvbnRyb2xsZXIub2JqJzsKdmFyIEdFQVJWUl9DT05UUk9MTEVSX01PREVMX09CSl9NVEwgPSBHRUFSVlJfQ09OVFJPTExFUl9NT0RFTF9CQVNFX1VSTCArICdnZWFyX3ZyX2NvbnRyb2xsZXIubXRsJzsKCnZhciBHQU1FUEFEX0lEX1BSRUZJWCA9ICdHZWFyIFZSJzsKCi8qKgogKiBHZWFyIFZSIGNvbnRyb2xzLgogKiBJbnRlcmZhY2Ugd2l0aCBHZWFyIFZSIGNvbnRyb2xsZXIgYW5kIG1hcCBHYW1lcGFkIGV2ZW50cyB0bwogKiBjb250cm9sbGVyIGJ1dHRvbnM6IHRyYWNrcGFkLCB0cmlnZ2VyCiAqIExvYWQgYSBjb250cm9sbGVyIG1vZGVsIGFuZCBoaWdobGlnaHQgdGhlIHByZXNzZWQgYnV0dG9ucy4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdnZWFydnItY29udHJvbHMnLCB7CiAgc2NoZW1hOiB7CiAgICBoYW5kOiB7ZGVmYXVsdDogJyd9LCAgLy8gVGhpcyBpbmZvcm1zIHRoZSBkZWdlbmVyYXRlIGFybSBtb2RlbC4KICAgIGJ1dHRvbkNvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyMwMDAwMDAnfSwKICAgIGJ1dHRvblRvdWNoZWRDb2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjNzc3Nzc3J30sCiAgICBidXR0b25IaWdobGlnaHRDb2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjRkZGRkZGJ30sCiAgICBtb2RlbDoge2RlZmF1bHQ6IHRydWV9LAogICAgb3JpZW50YXRpb25PZmZzZXQ6IHt0eXBlOiAndmVjMyd9LAogICAgYXJtTW9kZWw6IHtkZWZhdWx0OiB0cnVlfQogIH0sCgogIC8qKgogICAqIEJ1dHRvbiBJRHM6CiAgICogMCAtIHRyYWNrcGFkCiAgICogMSAtIHRyaWdnZXIKICAgKi8KICBtYXBwaW5nOiB7CiAgICBheGVzOiB7dHJhY2twYWQ6IFswLCAxXX0sCiAgICBidXR0b25zOiBbJ3RyYWNrcGFkJywgJ3RyaWdnZXInXQogIH0sCgogIGJpbmRNZXRob2RzOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9uTW9kZWxMb2FkZWQgPSBiaW5kKHRoaXMub25Nb2RlbExvYWRlZCwgdGhpcyk7CiAgICB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUgPSBiaW5kKHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSwgdGhpcyk7CiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCA9IGJpbmQodGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQsIHRoaXMpOwogICAgdGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyID0gYmluZCh0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIsIHRoaXMpOwogICAgdGhpcy5vbkF4aXNNb3ZlZCA9IGJpbmQodGhpcy5vbkF4aXNNb3ZlZCwgdGhpcyk7CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdGhpcy5vbkJ1dHRvbkNoYW5nZWQgPSBiaW5kKHRoaXMub25CdXR0b25DaGFuZ2VkLCB0aGlzKTsKICAgIHRoaXMub25CdXR0b25Eb3duID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICdkb3duJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVXAgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3VwJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAndG91Y2hzdGFydCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoRW5kID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaGVuZCcsIHNlbGYpOyB9OwogICAgdGhpcy5jb250cm9sbGVyUHJlc2VudCA9IGZhbHNlOwogICAgdGhpcy5sYXN0Q29udHJvbGxlckNoZWNrID0gMDsKICAgIHRoaXMuYmluZE1ldGhvZHMoKTsKICB9LAoKICBhZGRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vZGVsLWxvYWRlZCcsIHRoaXMub25Nb2RlbExvYWRlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdheGlzbW92ZScsIHRoaXMub25BeGlzTW92ZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gdHJ1ZTsKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vZGVsLWxvYWRlZCcsIHRoaXMub25Nb2RlbExvYWRlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdheGlzbW92ZScsIHRoaXMub25BeGlzTW92ZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gZmFsc2U7CiAgfSwKCiAgY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50OiBmdW5jdGlvbiAoKSB7CiAgICBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAodGhpcywgR0FNRVBBRF9JRF9QUkVGSVgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaGFuZCA/IHtoYW5kOiB0aGlzLmRhdGEuaGFuZH0gOiB7fSk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICAgIHRoaXMuYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcigpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICBpbmplY3RUcmFja2VkQ29udHJvbHM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGVsLnNldEF0dHJpYnV0ZSgndHJhY2tlZC1jb250cm9scycsIHsKICAgICAgYXJtTW9kZWw6IGRhdGEuYXJtTW9kZWwsCiAgICAgIGlkUHJlZml4OiBHQU1FUEFEX0lEX1BSRUZJWCwKICAgICAgb3JpZW50YXRpb25PZmZzZXQ6IGRhdGEub3JpZW50YXRpb25PZmZzZXQKICAgIH0pOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnb2JqLW1vZGVsJywgewogICAgICBvYmo6IEdFQVJWUl9DT05UUk9MTEVSX01PREVMX09CSl9VUkwsCiAgICAgIG10bDogR0VBUlZSX0NPTlRST0xMRVJfTU9ERUxfT0JKX01UTAogICAgfSk7CiAgfSwKCiAgYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbC5zY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJzdXBkYXRlZCcsIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSwgZmFsc2UpOwogIH0sCgogIHJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICBvbkNvbnRyb2xsZXJzVXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCgpOwogIH0sCgogIC8vIE5vIG5lZWQgZm9yIG9uQnV0dG9uQ2hhbmdlZCwgc2luY2UgR2VhciBWUiBjb250cm9sbGVyIGhhcyBubyBhbmFsb2cgYnV0dG9ucy4KCiAgb25Nb2RlbExvYWRlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIGNvbnRyb2xsZXJPYmplY3QzRCA9IGV2dC5kZXRhaWwubW9kZWw7CiAgICB2YXIgYnV0dG9uTWVzaGVzOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlcyA9IHt9OwogICAgYnV0dG9uTWVzaGVzLnRyaWdnZXIgPSBjb250cm9sbGVyT2JqZWN0M0QuY2hpbGRyZW5bMl07CiAgICBidXR0b25NZXNoZXMudHJhY2twYWQgPSBjb250cm9sbGVyT2JqZWN0M0QuY2hpbGRyZW5bMV07CiAgfSwKCiAgb25CdXR0b25DaGFuZ2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgYnV0dG9uID0gdGhpcy5tYXBwaW5nLmJ1dHRvbnNbZXZ0LmRldGFpbC5pZF07CiAgICBpZiAoIWJ1dHRvbikgcmV0dXJuOwogICAgLy8gUGFzcyBhbG9uZyBjaGFuZ2VkIGV2ZW50IHdpdGggYnV0dG9uIHN0YXRlLCB1c2luZyBidXR0b24gbWFwcGluZyBmb3IgY29udmVuaWVuY2UuCiAgICB0aGlzLmVsLmVtaXQoYnV0dG9uICsgJ2NoYW5nZWQnLCBldnQuZGV0YWlsLnN0YXRlKTsKICB9LAoKICBvbkF4aXNNb3ZlZDogZnVuY3Rpb24gKGV2dCkgewogICAgZW1pdElmQXhlc0NoYW5nZWQodGhpcywgdGhpcy5tYXBwaW5nLmF4ZXMsIGV2dCk7CiAgfSwKCiAgdXBkYXRlTW9kZWw6IGZ1bmN0aW9uIChidXR0b25OYW1lLCBldnROYW1lKSB7CiAgICBpZiAoIXRoaXMuZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIHRoaXMudXBkYXRlQnV0dG9uTW9kZWwoYnV0dG9uTmFtZSwgZXZ0TmFtZSk7CiAgfSwKCiAgdXBkYXRlQnV0dG9uTW9kZWw6IGZ1bmN0aW9uIChidXR0b25OYW1lLCBzdGF0ZSkgewogICAgdmFyIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzOwogICAgaWYgKCFidXR0b25NZXNoZXMgfHwgIWJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXSkgeyByZXR1cm47IH0KICAgIHZhciBjb2xvcjsKICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgY2FzZSAnZG93bic6CiAgICAgICAgY29sb3IgPSB0aGlzLmRhdGEuYnV0dG9uSGlnaGxpZ2h0Q29sb3I7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3RvdWNoc3RhcnQnOgogICAgICAgIGNvbG9yID0gdGhpcy5kYXRhLmJ1dHRvblRvdWNoZWRDb2xvcjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBjb2xvciA9IHRoaXMuZGF0YS5idXR0b25Db2xvcjsKICAgIH0KICAgIGJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXS5tYXRlcmlhbC5jb2xvci5zZXQoY29sb3IpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vdXRpbHMvYmluZCI6MTczLCIuLi91dGlscy90cmFja2VkLWNvbnRyb2xzIjoxODd9XSw2MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBnZW9tZXRyaWVzID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLmdlb21ldHJpZXM7CnZhciBnZW9tZXRyeU5hbWVzID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLmdlb21ldHJ5TmFtZXM7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKdmFyIGR1bW15R2VvbWV0cnkgPSBuZXcgVEhSRUUuR2VvbWV0cnkoKTsKCi8qKgogKiBHZW9tZXRyeSBjb21wb25lbnQuIENvbWJpbmVkIHdpdGggbWF0ZXJpYWwgY29tcG9uZW50IHRvIG1ha2UgYSBtZXNoIGluIDNEIG9iamVjdC4KICogRXh0ZW5kZWQgd2l0aCByZWdpc3RlcmVkIGdlb21ldHJpZXMuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnZ2VvbWV0cnknLCB7CiAgc2NoZW1hOiB7CiAgICBidWZmZXI6IHtkZWZhdWx0OiB0cnVlfSwKICAgIHByaW1pdGl2ZToge2RlZmF1bHQ6ICdib3gnLCBvbmVPZjogZ2VvbWV0cnlOYW1lcywgc2NoZW1hQ2hhbmdlOiB0cnVlfSwKICAgIHNraXBDYWNoZToge2RlZmF1bHQ6IGZhbHNlfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZ2VvbWV0cnkgPSBudWxsOwogIH0sCgogIC8qKgogICAqIFRhbGsgdG8gZ2VvbWV0cnkgc3lzdGVtIHRvIGdldCBvciBjcmVhdGUgZ2VvbWV0cnkuCiAgICovCiAgdXBkYXRlOiBmdW5jdGlvbiAocHJldmlvdXNEYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgbWVzaDsKICAgIHZhciBzeXN0ZW0gPSB0aGlzLnN5c3RlbTsKCiAgICAvLyBEaXNwb3NlIG9sZCBnZW9tZXRyeSBpZiB3ZSBjcmVhdGVkIG9uZS4KICAgIGlmICh0aGlzLmdlb21ldHJ5KSB7CiAgICAgIHN5c3RlbS51bnVzZUdlb21ldHJ5KHByZXZpb3VzRGF0YSk7CiAgICAgIHRoaXMuZ2VvbWV0cnkgPSBudWxsOwogICAgfQoKICAgIC8vIENyZWF0ZSBuZXcgZ2VvbWV0cnkuCiAgICB0aGlzLmdlb21ldHJ5ID0gc3lzdGVtLmdldE9yQ3JlYXRlR2VvbWV0cnkoZGF0YSk7CgogICAgLy8gU2V0IG9uIG1lc2guIElmIG1lc2ggZG9lcyBub3QgZXhpc3QsIGNyZWF0ZSBpdC4KICAgIG1lc2ggPSBlbC5nZXRPYmplY3QzRCgnbWVzaCcpOwogICAgaWYgKG1lc2gpIHsKICAgICAgbWVzaC5nZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICB9IGVsc2UgewogICAgICBtZXNoID0gbmV3IFRIUkVFLk1lc2goKTsKICAgICAgbWVzaC5nZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAgIGVsLnNldE9iamVjdDNEKCdtZXNoJywgbWVzaCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogVGVsbCBnZW9tZXRyeSBzeXN0ZW0gdGhhdCBlbnRpdHkgaXMgbm8gbG9uZ2VyIHVzaW5nIHRoZSBnZW9tZXRyeS4KICAgKiBVbnNldCB0aGUgZ2VvbWV0cnkgb24gdGhlIG1lc2gKICAgKi8KICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc3lzdGVtLnVudXNlR2VvbWV0cnkodGhpcy5kYXRhKTsKICAgIHRoaXMuZWwuZ2V0T2JqZWN0M0QoJ21lc2gnKS5nZW9tZXRyeSA9IGR1bW15R2VvbWV0cnk7CiAgICB0aGlzLmdlb21ldHJ5ID0gbnVsbDsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgZ2VvbWV0cnkgY29tcG9uZW50IHNjaGVtYSBiYXNlZCBvbiBnZW9tZXRyeSB0eXBlLgogICAqLwogIHVwZGF0ZVNjaGVtYTogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBjdXJyZW50R2VvbWV0cnlUeXBlID0gdGhpcy5vbGREYXRhICYmIHRoaXMub2xkRGF0YS5wcmltaXRpdmU7CiAgICB2YXIgbmV3R2VvbWV0cnlUeXBlID0gZGF0YS5wcmltaXRpdmU7CiAgICB2YXIgc2NoZW1hID0gZ2VvbWV0cmllc1tuZXdHZW9tZXRyeVR5cGVdICYmIGdlb21ldHJpZXNbbmV3R2VvbWV0cnlUeXBlXS5zY2hlbWE7CgogICAgLy8gR2VvbWV0cnkgaGFzIG5vIHNjaGVtYS4KICAgIGlmICghc2NoZW1hKSB7IHRocm93IG5ldyBFcnJvcignVW5rbm93biBnZW9tZXRyeSBzY2hlbWEgYCcgKyBuZXdHZW9tZXRyeVR5cGUgKyAnYCcpOyB9CiAgICAvLyBOb3RoaW5nIGhhcyBjaGFuZ2VkLgogICAgaWYgKGN1cnJlbnRHZW9tZXRyeVR5cGUgJiYgY3VycmVudEdlb21ldHJ5VHlwZSA9PT0gbmV3R2VvbWV0cnlUeXBlKSB7IHJldHVybjsgfQoKICAgIHRoaXMuZXh0ZW5kU2NoZW1hKHNjaGVtYSk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2xpYi90aHJlZSI6MTU0fV0sNjE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7CnZhciB3YXJuID0gdXRpbHMuZGVidWcoJ2NvbXBvbmVudHM6Z2x0Zi1tb2RlbDp3YXJuJyk7CgovKioKICogZ2xURiBtb2RlbCBsb2FkZXIuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnZ2x0Zi1tb2RlbCcsIHsKICBzY2hlbWE6IHt0eXBlOiAnbW9kZWwnfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIGRyYWNvTG9hZGVyID0gdGhpcy5zeXN0ZW0uZ2V0RFJBQ09Mb2FkZXIoKTsKICAgIHRoaXMubW9kZWwgPSBudWxsOwogICAgdGhpcy5sb2FkZXIgPSBuZXcgVEhSRUUuR0xURkxvYWRlcigpOwogICAgaWYgKGRyYWNvTG9hZGVyKSB7CiAgICAgIHRoaXMubG9hZGVyLnNldERSQUNPTG9hZGVyKGRyYWNvTG9hZGVyKTsKICAgIH0KICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgc3JjID0gdGhpcy5kYXRhOwoKICAgIGlmICghc3JjKSB7IHJldHVybjsgfQoKICAgIHRoaXMucmVtb3ZlKCk7CgogICAgdGhpcy5sb2FkZXIubG9hZChzcmMsIGZ1bmN0aW9uIGdsdGZMb2FkZWQgKGdsdGZNb2RlbCkgewogICAgICBzZWxmLm1vZGVsID0gZ2x0Zk1vZGVsLnNjZW5lIHx8IGdsdGZNb2RlbC5zY2VuZXNbMF07CiAgICAgIHNlbGYubW9kZWwuYW5pbWF0aW9ucyA9IGdsdGZNb2RlbC5hbmltYXRpb25zOwogICAgICBlbC5zZXRPYmplY3QzRCgnbWVzaCcsIHNlbGYubW9kZWwpOwogICAgICBlbC5lbWl0KCdtb2RlbC1sb2FkZWQnLCB7Zm9ybWF0OiAnZ2x0ZicsIG1vZGVsOiBzZWxmLm1vZGVsfSk7CiAgICB9LCB1bmRlZmluZWQgLyogb25Qcm9ncmVzcyAqLywgZnVuY3Rpb24gZ2x0ZkZhaWxlZCAoZXJyb3IpIHsKICAgICAgdmFyIG1lc3NhZ2UgPSAoZXJyb3IgJiYgZXJyb3IubWVzc2FnZSkgPyBlcnJvci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBsb2FkIGdsVEYgbW9kZWwnOwogICAgICB3YXJuKG1lc3NhZ2UpOwogICAgICBlbC5lbWl0KCdtb2RlbC1lcnJvcicsIHtmb3JtYXQ6ICdnbHRmJywgc3JjOiBzcmN9KTsKICAgIH0pOwogIH0sCgogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aGlzLm1vZGVsKSB7IHJldHVybjsgfQogICAgdGhpcy5lbC5yZW1vdmVPYmplY3QzRCgnbWVzaCcpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzLyI6MTc5fV0sNjI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgVEhSRUUgKi8KdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKCi8vIEZvdW5kIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9hZnJhbWV2ci9hc3NldHMuCnZhciBNT0RFTF9VUkxTID0gewogIGxlZnQ6ICdodHRwczovL2Nkbi5hZnJhbWUuaW8vY29udHJvbGxlcnMvaGFuZHMvbGVmdEhhbmQuZ2xiJywKICByaWdodDogJ2h0dHBzOi8vY2RuLmFmcmFtZS5pby9jb250cm9sbGVycy9oYW5kcy9yaWdodEhhbmQuZ2xiJwp9OwoKLy8gUG9zZXMuCnZhciBBTklNQVRJT05TID0gewogIG9wZW46ICdPcGVuJywKICAvLyBwb2ludDogZ3JpcCBhY3RpdmUsIHRyYWNrcGFkIHN1cmZhY2UgYWN0aXZlLCB0cmlnZ2VyIGluYWN0aXZlLgogIHBvaW50OiAnUG9pbnQnLAogIC8vIHBvaW50VGh1bWI6IGdyaXAgYWN0aXZlLCB0cmlnZ2VyIGluYWN0aXZlLCB0cmFja3BhZCBzdXJmYWNlIGluYWN0aXZlLgogIHBvaW50VGh1bWI6ICdQb2ludCArIFRodW1iJywKICAvLyBmaXN0OiBncmlwIGFjdGl2ZSwgdHJpZ2dlciBhY3RpdmUsIHRyYWNrcGFkIHN1cmZhY2UgYWN0aXZlLgogIGZpc3Q6ICdGaXN0JywKICAvLyBob2xkOiB0cmlnZ2VyIGFjdGl2ZSwgZ3JpcCBpbmFjdGl2ZS4KICBob2xkOiAnSG9sZCcsCiAgLy8gdGh1bWJVcDogZ3JpcCBhY3RpdmUsIHRyaWdnZXIgYWN0aXZlLCB0cmFja3BhZCBzdXJmYWNlIGluYWN0aXZlLgogIHRodW1iVXA6ICdUaHVtYiBVcCcKfTsKCi8vIE1hcCBhbmltYXRpb24gdG8gcHVibGljIGV2ZW50cyBmb3IgdGhlIEFQSS4KdmFyIEVWRU5UUyA9IHt9OwpFVkVOVFNbQU5JTUFUSU9OUy5maXN0XSA9ICdncmlwJzsKRVZFTlRTW0FOSU1BVElPTlMudGh1bWJVcF0gPSAncGlzdG9sJzsKRVZFTlRTW0FOSU1BVElPTlMucG9pbnRdID0gJ3BvaW50aW5nJzsKRVZFTlRTW0FOSU1BVElPTlMudGh1bWJdID0gJ3RodW1iJzsKCi8qKgogKiBIYW5kIGNvbnRyb2xzIGNvbXBvbmVudCB0aGF0IGFic3RyYWN0cyA2RG9GIGNvbnRyb2xzOgogKiAgIG9jdWx1cy10b3VjaC1jb250cm9scywgdml2ZS1jb250cm9scywgd2luZG93cy1tb3Rpb24tY29udHJvbHMuCiAqCiAqIE9yaWdpbmFsbHkgbWVhbnQgdG8gYmUgYSBzYW1wbGUgaW1wbGVtZW50YXRpb24gb2YgYXBwbGljYXRpb25zLXNwZWNpZmljIGNvbnRyb2xzIHRoYXQKICogYWJzdHJhY3RzIG11bHRpcGxlIHR5cGVzIG9mIGNvbnRyb2xsZXJzLgogKgogKiBBdXRvLWRldGVjdCBhcHByb3ByaWF0ZSBjb250cm9sbGVyLgogKiBIYW5kbGUgY29tbW9uIGV2ZW50cyBjb21pbmcgZnJvbSB0aGUgZGV0ZWN0ZWQgdmVuZG9yLXNwZWNpZmljIGNvbnRyb2xzLgogKiBUcmFuc2xhdGUgYnV0dG9uIGV2ZW50cyB0byBzZW1hbnRpYyBoYW5kLXJlbGF0ZWQgZXZlbnQgbmFtZXM6CiAqICAgKGdyaXBjbG9zZSwgZ3JpcG9wZW4sIHRodW1idXAsIHRodW1iZG93biwgcG9pbnR1cCwgcG9pbnRkb3duKQogKiBMb2FkIGhhbmQgbW9kZWwgd2l0aCBnZXN0dXJlcyB0aGF0IGFyZSBhcHBsaWVkIGJhc2VkIG9uIHRoZSBidXR0b24gcHJlc3NlZC4KICoKICogQHByb3BlcnR5IHtzdHJpbmd9IEhhbmQgbWFwcGluZyAoYGxlZnRgLCBgcmlnaHRgKS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdoYW5kLWNvbnRyb2xzJywgewogIHNjaGVtYToge2RlZmF1bHQ6ICdsZWZ0J30sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICAvLyBDdXJyZW50IHBvc2UuCiAgICB0aGlzLmdlc3R1cmUgPSBBTklNQVRJT05TLm9wZW47CiAgICAvLyBBY3RpdmUgYnV0dG9ucyBwb3B1bGF0ZWQgYnkgZXZlbnRzIHByb3ZpZGVkIGJ5IHRoZSBhdHRhY2hlZCBjb250cm9scy4KICAgIHRoaXMucHJlc3NlZEJ1dHRvbnMgPSB7fTsKICAgIHRoaXMudG91Y2hlZEJ1dHRvbnMgPSB7fTsKICAgIHRoaXMubG9hZGVyID0gbmV3IFRIUkVFLkdMVEZMb2FkZXIoKTsKICAgIHRoaXMubG9hZGVyLnNldENyb3NzT3JpZ2luKCdhbm9ueW1vdXMnKTsKCiAgICB0aGlzLm9uR3JpcERvd24gPSBmdW5jdGlvbiAoKSB7IHNlbGYuaGFuZGxlQnV0dG9uKCdncmlwJywgJ2Rvd24nKTsgfTsKICAgIHRoaXMub25HcmlwVXAgPSBmdW5jdGlvbiAoKSB7IHNlbGYuaGFuZGxlQnV0dG9uKCdncmlwJywgJ3VwJyk7IH07CiAgICB0aGlzLm9uVHJhY2twYWREb3duID0gZnVuY3Rpb24gKCkgeyBzZWxmLmhhbmRsZUJ1dHRvbigndHJhY2twYWQnLCAnZG93bicpOyB9OwogICAgdGhpcy5vblRyYWNrcGFkVXAgPSBmdW5jdGlvbiAoKSB7IHNlbGYuaGFuZGxlQnV0dG9uKCd0cmFja3BhZCcsICd1cCcpOyB9OwogICAgdGhpcy5vblRyYWNrcGFkVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RyYWNrcGFkJywgJ3RvdWNoc3RhcnQnKTsgfTsKICAgIHRoaXMub25UcmFja3BhZFRvdWNoRW5kID0gZnVuY3Rpb24gKCkgeyBzZWxmLmhhbmRsZUJ1dHRvbigndHJhY2twYWQnLCAndG91Y2hlbmQnKTsgfTsKICAgIHRoaXMub25UcmlnZ2VyRG93biA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RyaWdnZXInLCAnZG93bicpOyB9OwogICAgdGhpcy5vblRyaWdnZXJVcCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RyaWdnZXInLCAndXAnKTsgfTsKICAgIHRoaXMub25UcmlnZ2VyVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RyaWdnZXInLCAndG91Y2hzdGFydCcpOyB9OwogICAgdGhpcy5vblRyaWdnZXJUb3VjaEVuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RyaWdnZXInLCAndG91Y2hlbmQnKTsgfTsKICAgIHRoaXMub25HcmlwVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ2dyaXAnLCAndG91Y2hzdGFydCcpOyB9OwogICAgdGhpcy5vbkdyaXBUb3VjaEVuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ2dyaXAnLCAndG91Y2hlbmQnKTsgfTsKICAgIHRoaXMub25UaHVtYnN0aWNrRG93biA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RodW1ic3RpY2snLCAnZG93bicpOyB9OwogICAgdGhpcy5vblRodW1ic3RpY2tVcCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3RodW1ic3RpY2snLCAndXAnKTsgfTsKICAgIHRoaXMub25Bb3JYVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ0FvclgnLCAndG91Y2hzdGFydCcpOyB9OwogICAgdGhpcy5vbkFvclhUb3VjaEVuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ0FvclgnLCAndG91Y2hlbmQnKTsgfTsKICAgIHRoaXMub25Cb3JZVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ0JvclknLCAndG91Y2hzdGFydCcpOyB9OwogICAgdGhpcy5vbkJvcllUb3VjaEVuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ0JvclknLCAndG91Y2hlbmQnKTsgfTsKICAgIHRoaXMub25TdXJmYWNlVG91Y2hTdGFydCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3N1cmZhY2UnLCAndG91Y2hzdGFydCcpOyB9OwogICAgdGhpcy5vblN1cmZhY2VUb3VjaEVuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5oYW5kbGVCdXR0b24oJ3N1cmZhY2UnLCAndG91Y2hlbmQnKTsgfTsKCiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY29ubmVjdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJDb25uZWN0ZWQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcmRpc2Nvbm5lY3RlZCcsIHRoaXMub25Db250cm9sbGVyRGlzY29ubmVjdGVkKTsKCiAgICAvLyBIaWRkZW4gYnkgZGVmYXVsdC4KICAgIGVsLm9iamVjdDNELnZpc2libGUgPSBmYWxzZTsKICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICB0aWNrOiBmdW5jdGlvbiAodGltZSwgZGVsdGEpIHsKICAgIHZhciBtZXNoID0gdGhpcy5lbC5nZXRPYmplY3QzRCgnbWVzaCcpOwoKICAgIGlmICghbWVzaCB8fCAhbWVzaC5taXhlcikgeyByZXR1cm47IH0KCiAgICBtZXNoLm1peGVyLnVwZGF0ZShkZWx0YSAvIDEwMDApOwogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZ3JpcGRvd24nLCB0aGlzLm9uR3JpcERvd24pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZ3JpcHVwJywgdGhpcy5vbkdyaXBVcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0cmFja3BhZGRvd24nLCB0aGlzLm9uVHJhY2twYWREb3duKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYWNrcGFkdXAnLCB0aGlzLm9uVHJhY2twYWRVcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0cmFja3BhZHRvdWNoc3RhcnQnLCB0aGlzLm9uVHJhY2twYWRUb3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYWNrcGFkdG91Y2hlbmQnLCB0aGlzLm9uVHJhY2twYWRUb3VjaEVuZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0cmlnZ2VyZG93bicsIHRoaXMub25UcmlnZ2VyRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0cmlnZ2VydXAnLCB0aGlzLm9uVHJpZ2dlclVwKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RyaWdnZXJ0b3VjaHN0YXJ0JywgdGhpcy5vblRyaWdnZXJUb3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RyaWdnZXJ0b3VjaGVuZCcsIHRoaXMub25UcmlnZ2VyVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZ3JpcHRvdWNoc3RhcnQnLCB0aGlzLm9uR3JpcFRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZ3JpcHRvdWNoZW5kJywgdGhpcy5vbkdyaXBUb3VjaEVuZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0aHVtYnN0aWNrZG93bicsIHRoaXMub25UaHVtYnN0aWNrRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0aHVtYnN0aWNrdXAnLCB0aGlzLm9uVGh1bWJzdGlja1VwKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2FidXR0b250b3VjaHN0YXJ0JywgdGhpcy5vbkFvclhUb3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2FidXR0b250b3VjaGVuZCcsIHRoaXMub25Bb3JYVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYmJ1dHRvbnRvdWNoc3RhcnQnLCB0aGlzLm9uQm9yWVRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYmJ1dHRvbnRvdWNoZW5kJywgdGhpcy5vbkJvcllUb3VjaEVuZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd4YnV0dG9udG91Y2hzdGFydCcsIHRoaXMub25Bb3JYVG91Y2hTdGFydCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd4YnV0dG9udG91Y2hlbmQnLCB0aGlzLm9uQW9yWFRvdWNoRW5kKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3lidXR0b250b3VjaHN0YXJ0JywgdGhpcy5vbkJvcllUb3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3lidXR0b250b3VjaGVuZCcsIHRoaXMub25Cb3JZVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignc3VyZmFjZXRvdWNoc3RhcnQnLCB0aGlzLm9uU3VyZmFjZVRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignc3VyZmFjZXRvdWNoZW5kJywgdGhpcy5vblN1cmZhY2VUb3VjaEVuZCk7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdncmlwZG93bicsIHRoaXMub25HcmlwRG93bik7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdncmlwdXAnLCB0aGlzLm9uR3JpcFVwKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYWNrcGFkZG93bicsIHRoaXMub25UcmFja3BhZERvd24pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhY2twYWR1cCcsIHRoaXMub25UcmFja3BhZFVwKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYWNrcGFkdG91Y2hzdGFydCcsIHRoaXMub25UcmFja3BhZFRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhY2twYWR0b3VjaGVuZCcsIHRoaXMub25UcmFja3BhZFRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyaWdnZXJkb3duJywgdGhpcy5vblRyaWdnZXJEb3duKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyaWdnZXJ1cCcsIHRoaXMub25UcmlnZ2VyVXApOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJpZ2dlcnRvdWNoc3RhcnQnLCB0aGlzLm9uVHJpZ2dlclRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJpZ2dlcnRvdWNoZW5kJywgdGhpcy5vblRyaWdnZXJUb3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdncmlwdG91Y2hzdGFydCcsIHRoaXMub25HcmlwVG91Y2hTdGFydCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdncmlwdG91Y2hlbmQnLCB0aGlzLm9uR3JpcFRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RodW1ic3RpY2tkb3duJywgdGhpcy5vblRodW1ic3RpY2tEb3duKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RodW1ic3RpY2t1cCcsIHRoaXMub25UaHVtYnN0aWNrVXApOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJ1dHRvbnRvdWNoc3RhcnQnLCB0aGlzLm9uQW9yWFRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJ1dHRvbnRvdWNoZW5kJywgdGhpcy5vbkFvclhUb3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdiYnV0dG9udG91Y2hzdGFydCcsIHRoaXMub25Cb3JZVG91Y2hTdGFydCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdiYnV0dG9udG91Y2hlbmQnLCB0aGlzLm9uQm9yWVRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3hidXR0b250b3VjaHN0YXJ0JywgdGhpcy5vbkFvclhUb3VjaFN0YXJ0KTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3hidXR0b250b3VjaGVuZCcsIHRoaXMub25Bb3JYVG91Y2hFbmQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigneWJ1dHRvbnRvdWNoc3RhcnQnLCB0aGlzLm9uQm9yWVRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigneWJ1dHRvbnRvdWNoZW5kJywgdGhpcy5vbkJvcllUb3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdXJmYWNldG91Y2hzdGFydCcsIHRoaXMub25TdXJmYWNlVG91Y2hTdGFydCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdXJmYWNldG91Y2hlbmQnLCB0aGlzLm9uU3VyZmFjZVRvdWNoRW5kKTsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgaGFuZGxlci4gTW9yZSBsaWtlIHRoZSBgaW5pdGAgaGFuZGxlciBzaW5jZSB0aGUgb25seSBwcm9wZXJ0eSBpcyB0aGUgaGFuZCwgYW5kCiAgICogdGhhdCB3b24ndCBiZSBjaGFuZ2luZyBtdWNoLgogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gKHByZXZpb3VzSGFuZCkgewogICAgdmFyIGNvbnRyb2xDb25maWd1cmF0aW9uOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBoYW5kID0gdGhpcy5kYXRhOwogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIC8vIEdldCBjb21tb24gY29uZmlndXJhdGlvbiB0byBhYnN0cmFjdCBkaWZmZXJlbnQgdmVuZG9yIGNvbnRyb2xzLgogICAgY29udHJvbENvbmZpZ3VyYXRpb24gPSB7CiAgICAgIGhhbmQ6IGhhbmQsCiAgICAgIG1vZGVsOiBmYWxzZSwKICAgICAgb3JpZW50YXRpb25PZmZzZXQ6IHt4OiAwLCB5OiAwLCB6OiBoYW5kID09PSAnbGVmdCcgPyA5MCA6IC05MH0KICAgIH07CgogICAgLy8gU2V0IG1vZGVsLgogICAgaWYgKGhhbmQgIT09IHByZXZpb3VzSGFuZCkgewogICAgICB0aGlzLmxvYWRlci5sb2FkKE1PREVMX1VSTFNbaGFuZF0sIGZ1bmN0aW9uIChnbHRmKSB7CiAgICAgICAgdmFyIG1lc2ggPSBnbHRmLnNjZW5lLmNoaWxkcmVuWzBdOwogICAgICAgIG1lc2gubWl4ZXIgPSBuZXcgVEhSRUUuQW5pbWF0aW9uTWl4ZXIobWVzaCk7CiAgICAgICAgc2VsZi5jbGlwcyA9IGdsdGYuYW5pbWF0aW9uczsKICAgICAgICBlbC5zZXRPYmplY3QzRCgnbWVzaCcsIG1lc2gpOwogICAgICAgIG1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgIG1lc2gucm90YXRpb24uc2V0KDAsIDAsIDApOwogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgndml2ZS1jb250cm9scycsIGNvbnRyb2xDb25maWd1cmF0aW9uKTsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ29jdWx1cy10b3VjaC1jb250cm9scycsIGNvbnRyb2xDb25maWd1cmF0aW9uKTsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3dpbmRvd3MtbW90aW9uLWNvbnRyb2xzJywgY29udHJvbENvbmZpZ3VyYXRpb24pOwogICAgICB9KTsKICAgIH0KICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwucmVtb3ZlT2JqZWN0M0QoJ21lc2gnKTsKICB9LAoKICAvKioKICAgKiBQbGF5IG1vZGVsIGFuaW1hdGlvbiwgYmFzZWQgb24gd2hpY2ggYnV0dG9uIHdhcyBwcmVzc2VkIGFuZCB3aGljaCBraW5kIG9mIGV2ZW50LgogICAqCiAgICogMS4gUHJvY2VzcyBidXR0b25zLgogICAqIDIuIERldGVybWluZSBnZXN0dXJlICh0aGlzLmRldGVybWluZUdlc3R1cmUoKSkuCiAgICogMy4gQW5pbWF0aW9uIGdlc3R1cmUgKHRoaXMuYW5pbWF0aW9uR2VzdHVyZSgpKS4KICAgKiA0LiBFbWl0IGdlc3R1cmUgZXZlbnRzICh0aGlzLmVtaXRHZXN0dXJlRXZlbnRzKCkpLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbiAtIE5hbWUgb2YgdGhlIGJ1dHRvbi4KICAgKiBAcGFyYW0ge3N0cmluZ30gZXZ0IC0gVHlwZSBvZiBldmVudCBmb3IgdGhlIGJ1dHRvbiAoaS5lLiwgZG93bi91cC90b3VjaHN0YXJ0L3RvdWNoZW5kKS4KICAgKi8KICBoYW5kbGVCdXR0b246IGZ1bmN0aW9uIChidXR0b24sIGV2dCkgewogICAgdmFyIGxhc3RHZXN0dXJlOwogICAgdmFyIGlzUHJlc3NlZCA9IGV2dCA9PT0gJ2Rvd24nOwogICAgdmFyIGlzVG91Y2hlZCA9IGV2dCA9PT0gJ3RvdWNoc3RhcnQnOwoKICAgIC8vIFVwZGF0ZSBvYmplY3RzLgogICAgaWYgKGV2dC5pbmRleE9mKCd0b3VjaCcpID09PSAwKSB7CiAgICAgIC8vIFVwZGF0ZSB0b3VjaCBvYmplY3QuCiAgICAgIGlmIChpc1RvdWNoZWQgPT09IHRoaXMudG91Y2hlZEJ1dHRvbnNbYnV0dG9uXSkgeyByZXR1cm47IH0KICAgICAgdGhpcy50b3VjaGVkQnV0dG9uc1tidXR0b25dID0gaXNUb3VjaGVkOwogICAgfSBlbHNlIHsKICAgICAgLy8gVXBkYXRlIGJ1dHRvbiBvYmplY3QuCiAgICAgIGlmIChpc1ByZXNzZWQgPT09IHRoaXMucHJlc3NlZEJ1dHRvbnNbYnV0dG9uXSkgeyByZXR1cm47IH0KICAgICAgdGhpcy5wcmVzc2VkQnV0dG9uc1tidXR0b25dID0gaXNQcmVzc2VkOwogICAgfQoKICAgIC8vIERldGVybWluZSB0aGUgZ2VzdHVyZS4KICAgIGxhc3RHZXN0dXJlID0gdGhpcy5nZXN0dXJlOwogICAgdGhpcy5nZXN0dXJlID0gdGhpcy5kZXRlcm1pbmVHZXN0dXJlKCk7CgogICAgLy8gU2FtZSBnZXN0dXJlLgogICAgaWYgKHRoaXMuZ2VzdHVyZSA9PT0gbGFzdEdlc3R1cmUpIHsgcmV0dXJuOyB9CiAgICAvLyBBbmltYXRlIGdlc3R1cmUuCiAgICB0aGlzLmFuaW1hdGVHZXN0dXJlKHRoaXMuZ2VzdHVyZSwgbGFzdEdlc3R1cmUpOwoKICAgIC8vIEVtaXQgZXZlbnRzLgogICAgdGhpcy5lbWl0R2VzdHVyZUV2ZW50cyh0aGlzLmdlc3R1cmUsIGxhc3RHZXN0dXJlKTsKICB9LAoKICAvKioKICAgKiBEZXRlcm1pbmUgd2hpY2ggcG9zZSBoYW5kIHNob3VsZCBiZSBpbiBjb25zaWRlcmluZyBhY3RpdmUgYW5kIHRvdWNoZWQgYnV0dG9ucy4KICAgKi8KICBkZXRlcm1pbmVHZXN0dXJlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZ2VzdHVyZTsKICAgIHZhciBpc0dyaXBBY3RpdmUgPSB0aGlzLnByZXNzZWRCdXR0b25zWydncmlwJ107CiAgICB2YXIgaXNTdXJmYWNlQWN0aXZlID0gdGhpcy5wcmVzc2VkQnV0dG9uc1snc3VyZmFjZSddIHx8IHRoaXMudG91Y2hlZEJ1dHRvbnNbJ3N1cmZhY2UnXTsKICAgIHZhciBpc1RyYWNrcGFkQWN0aXZlID0gdGhpcy5wcmVzc2VkQnV0dG9uc1sndHJhY2twYWQnXSB8fCB0aGlzLnRvdWNoZWRCdXR0b25zWyd0cmFja3BhZCddOwogICAgdmFyIGlzVHJpZ2dlckFjdGl2ZSA9IHRoaXMucHJlc3NlZEJ1dHRvbnNbJ3RyaWdnZXInXSB8fCB0aGlzLnRvdWNoZWRCdXR0b25zWyd0cmlnZ2VyJ107CiAgICB2YXIgaXNBQlhZQWN0aXZlID0gdGhpcy50b3VjaGVkQnV0dG9uc1snQW9yWCddIHx8IHRoaXMudG91Y2hlZEJ1dHRvbnNbJ0JvclknXTsKICAgIHZhciBpc1ZpdmUgPSBpc1ZpdmVDb250cm9sbGVyKHRoaXMuZWwuY29tcG9uZW50c1sndHJhY2tlZC1jb250cm9scyddKTsKCiAgICAvLyBXb3JrcyB3ZWxsIHdpdGggT2N1bHVzIFRvdWNoIGFuZCBXaW5kb3dzIE1vdGlvbiBDb250cm9scywgYnV0IFZpdmUgbmVlZHMgdHdlYWtzLgogICAgaWYgKGlzVml2ZSkgewogICAgICBpZiAoaXNHcmlwQWN0aXZlIHx8IGlzVHJpZ2dlckFjdGl2ZSkgewogICAgICAgIGdlc3R1cmUgPSBBTklNQVRJT05TLmZpc3Q7CiAgICAgIH0gZWxzZSBpZiAoaXNUcmFja3BhZEFjdGl2ZSkgewogICAgICAgIGdlc3R1cmUgPSBBTklNQVRJT05TLnBvaW50OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoaXNHcmlwQWN0aXZlKSB7CiAgICAgICAgaWYgKGlzU3VyZmFjZUFjdGl2ZSB8fCBpc0FCWFlBY3RpdmUgfHwgaXNUcmFja3BhZEFjdGl2ZSkgewogICAgICAgICAgZ2VzdHVyZSA9IGlzVHJpZ2dlckFjdGl2ZSA/IEFOSU1BVElPTlMuZmlzdCA6IEFOSU1BVElPTlMucG9pbnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdlc3R1cmUgPSBpc1RyaWdnZXJBY3RpdmUgPyBBTklNQVRJT05TLnRodW1iVXAgOiBBTklNQVRJT05TLnBvaW50VGh1bWI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGlzVHJpZ2dlckFjdGl2ZSkgewogICAgICAgIGdlc3R1cmUgPSBBTklNQVRJT05TLmhvbGQ7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZ2VzdHVyZTsKICB9LAoKICAvKioKICAgKiBQbGF5IGNvcnJlc3BvbmRpbmcgY2xpcCB0byBhIGdlc3R1cmUKICAgKi8KICBnZXRDbGlwOiBmdW5jdGlvbiAoZ2VzdHVyZSkgewogICAgdmFyIGNsaXA7CiAgICB2YXIgaTsKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmNsaXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNsaXAgPSB0aGlzLmNsaXBzW2ldOwogICAgICBpZiAoY2xpcC5uYW1lICE9PSBnZXN0dXJlKSB7IGNvbnRpbnVlOyB9CiAgICAgIHJldHVybiBjbGlwOwogICAgfQogIH0sCgogIC8qKgogICAqIFBsYXkgZ2VzdHVyZSBhbmltYXRpb24uCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gZ2VzdHVyZSAtIFdoaWNoIHBvc2UgdG8gYW5pbWF0ZSB0by4gSWYgYWJzZW50LCB0aGVuIGFuaW1hdGUgdG8gb3Blbi4KICAgKiBAcGFyYW0ge3N0cmluZ30gbGFzdEdlc3R1cmUgLSBQcmV2aW91cyBnZXN0dXJlLCB0byByZXZlcnNlIGJhY2sgdG8gb3BlbiBpZiBuZWVkZWQuCiAgICovCiAgYW5pbWF0ZUdlc3R1cmU6IGZ1bmN0aW9uIChnZXN0dXJlLCBsYXN0R2VzdHVyZSkgewogICAgaWYgKGdlc3R1cmUpIHsKICAgICAgdGhpcy5wbGF5QW5pbWF0aW9uKGdlc3R1cmUgfHwgQU5JTUFUSU9OUy5vcGVuLCBsYXN0R2VzdHVyZSwgZmFsc2UpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSWYgbm8gZ2VzdHVyZSwgdGhlbiByZXZlcnNlIHRoZSBjdXJyZW50IGdlc3R1cmUgYmFjayB0byBvcGVuIHBvc2UuCiAgICB0aGlzLnBsYXlBbmltYXRpb24obGFzdEdlc3R1cmUsIGxhc3RHZXN0dXJlLCB0cnVlKTsKICB9LAoKICAvKioKICAgKiBFbWl0IGBoYW5kLWNvbnRyb2xzYC1zcGVjaWZpYyBldmVudHMuCiAgICovCiAgZW1pdEdlc3R1cmVFdmVudHM6IGZ1bmN0aW9uIChnZXN0dXJlLCBsYXN0R2VzdHVyZSkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBldmVudE5hbWU7CgogICAgaWYgKGxhc3RHZXN0dXJlID09PSBnZXN0dXJlKSB7IHJldHVybjsgfQoKICAgIC8vIEVtaXQgZXZlbnQgZm9yIGxhc3RHZXN0dXJlIG5vdCBpbmFjdGl2ZS4KICAgIGV2ZW50TmFtZSA9IGdldEdlc3R1cmVFdmVudE5hbWUobGFzdEdlc3R1cmUsIGZhbHNlKTsKICAgIGlmIChldmVudE5hbWUpIHsgZWwuZW1pdChldmVudE5hbWUpOyB9CgogICAgLy8gRW1pdCBldmVudCBmb3IgY3VycmVudCBnZXN0dXJlIG5vdyBhY3RpdmUuCiAgICBldmVudE5hbWUgPSBnZXRHZXN0dXJlRXZlbnROYW1lKGdlc3R1cmUsIHRydWUpOwogICAgaWYgKGV2ZW50TmFtZSkgeyBlbC5lbWl0KGV2ZW50TmFtZSk7IH0KICB9LAoKLyoqCiAgKiBQbGF5IGhhbmQgYW5pbWF0aW9uIGJhc2VkIG9uIGJ1dHRvbiBzdGF0ZS4KICAqCiAgKiBAcGFyYW0ge3N0cmluZ30gZ2VzdHVyZSAtIE5hbWUgb2YgdGhlIGFuaW1hdGlvbiBhcyBzcGVjaWZpZWQgYnkgdGhlIG1vZGVsLgogICogQHBhcmFtIHtzdHJpbmd9IGxhc3RHZXN0dXJlIC0gUHJldmlvdXMgcG9zZS4KICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmV2ZXJzZSAtIFdoZXRoZXIgYW5pbWF0aW9uIHNob3VsZCBwbGF5IGluIHJldmVyc2UuCiAgKi8KICBwbGF5QW5pbWF0aW9uOiBmdW5jdGlvbiAoZ2VzdHVyZSwgbGFzdEdlc3R1cmUsIHJldmVyc2UpIHsKICAgIHZhciBjbGlwOwogICAgdmFyIGZyb21BY3Rpb247CiAgICB2YXIgbWVzaCA9IHRoaXMuZWwuZ2V0T2JqZWN0M0QoJ21lc2gnKTsKICAgIHZhciB0b0FjdGlvbjsKCiAgICBpZiAoIW1lc2gpIHsgcmV0dXJuOyB9CgogICAgLy8gU3RvcCBhbGwgY3VycmVudCBhbmltYXRpb25zLgogICAgbWVzaC5taXhlci5zdG9wQWxsQWN0aW9uKCk7CgogICAgLy8gR3JhYiBjbGlwIGFjdGlvbi4KICAgIGNsaXAgPSB0aGlzLmdldENsaXAoZ2VzdHVyZSk7CiAgICB0b0FjdGlvbiA9IG1lc2gubWl4ZXIuY2xpcEFjdGlvbihjbGlwKTsKICAgIHRvQWN0aW9uLmNsYW1wV2hlbkZpbmlzaGVkID0gdHJ1ZTsKICAgIHRvQWN0aW9uLmxvb3AgPSBUSFJFRS5Mb29wUmVwZWF0OwogICAgdG9BY3Rpb24ucmVwZXRpdGlvbnMgPSAwOwogICAgdG9BY3Rpb24udGltZVNjYWxlID0gcmV2ZXJzZSA/IC0xIDogMTsKICAgIHRvQWN0aW9uLnRpbWUgPSByZXZlcnNlID8gY2xpcC5kdXJhdGlvbiA6IDA7CiAgICB0b0FjdGlvbi53ZWlnaHQgPSAxOwoKICAgIC8vIE5vIGdlc3R1cmUgdG8gZ2VzdHVyZSBvciBnZXN0dXJlIHRvIG5vIGdlc3R1cmUuCiAgICBpZiAoIWxhc3RHZXN0dXJlIHx8IGdlc3R1cmUgPT09IGxhc3RHZXN0dXJlKSB7CiAgICAgIC8vIFN0b3AgYWxsIGN1cnJlbnQgYW5pbWF0aW9ucy4KICAgICAgbWVzaC5taXhlci5zdG9wQWxsQWN0aW9uKCk7CiAgICAgIC8vIFBsYXkgYW5pbWF0aW9uLgogICAgICB0b0FjdGlvbi5wbGF5KCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBBbmltYXRlIG9yIGNyb3NzZmFkZSBmcm9tIGdlc3R1cmUgdG8gZ2VzdHVyZS4KICAgIGNsaXAgPSB0aGlzLmdldENsaXAobGFzdEdlc3R1cmUpOwogICAgZnJvbUFjdGlvbiA9IG1lc2gubWl4ZXIuY2xpcEFjdGlvbihjbGlwKTsKICAgIGZyb21BY3Rpb24ud2VpZ2h0ID0gMC4xNTsKICAgIGZyb21BY3Rpb24ucGxheSgpOwogICAgdG9BY3Rpb24ucGxheSgpOwogICAgZnJvbUFjdGlvbi5jcm9zc0ZhZGVUbyh0b0FjdGlvbiwgMC4xNSwgdHJ1ZSk7CiAgfQp9KTsKCi8qKgogKiBTdWZmaXggZ2VzdHVyZXMgYmFzZWQgb24gdG9nZ2xlIHN0YXRlIChlLmcuLCBvcGVuL2Nsb3NlLCB1cC9kb3duLCBzdGFydC9lbmQpLgogKgogKiBAcGFyYW0ge3N0cmluZ30gZ2VzdHVyZQogKiBAcGFyYW0ge2Jvb2xlYW59IGFjdGl2ZQogKi8KZnVuY3Rpb24gZ2V0R2VzdHVyZUV2ZW50TmFtZSAoZ2VzdHVyZSwgYWN0aXZlKSB7CiAgdmFyIGV2ZW50TmFtZTsKCiAgaWYgKCFnZXN0dXJlKSB7IHJldHVybjsgfQoKICBldmVudE5hbWUgPSBFVkVOVFNbZ2VzdHVyZV07CiAgaWYgKGV2ZW50TmFtZSA9PT0gJ2dyaXAnKSB7CiAgICByZXR1cm4gZXZlbnROYW1lICsgKGFjdGl2ZSA/ICdjbG9zZScgOiAnb3BlbicpOwogIH0KICBpZiAoZXZlbnROYW1lID09PSAncG9pbnQnIHx8IGV2ZW50TmFtZSA9PT0gJ3RodW1iJykgewogICAgcmV0dXJuIGV2ZW50TmFtZSArIChhY3RpdmUgPyAndXAnIDogJ2Rvd24nKTsKICB9CiAgaWYgKGV2ZW50TmFtZSA9PT0gJ3BvaW50aW5nJyB8fCBldmVudE5hbWUgPT09ICdwaXN0b2wnKSB7CiAgICByZXR1cm4gZXZlbnROYW1lICsgKGFjdGl2ZSA/ICdzdGFydCcgOiAnZW5kJyk7CiAgfQogIHJldHVybjsKfQoKZnVuY3Rpb24gaXNWaXZlQ29udHJvbGxlciAodHJhY2tlZENvbnRyb2xzKSB7CiAgdmFyIGNvbnRyb2xsZXJJZCA9IHRyYWNrZWRDb250cm9scyAmJiB0cmFja2VkQ29udHJvbHMuY29udHJvbGxlciAmJgogICAgICAgICAgICAgICAgICAgICB0cmFja2VkQ29udHJvbHMuY29udHJvbGxlci5pZDsKICByZXR1cm4gY29udHJvbGxlcklkICYmIGNvbnRyb2xsZXJJZC5pbmRleE9mKCdPcGVuVlIgJykgPT09IDA7Cn0KCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sNjM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewpfZGVyZXFfKCcuL2FuaW1hdGlvbicpOwpfZGVyZXFfKCcuL2NhbWVyYScpOwpfZGVyZXFfKCcuL2N1cnNvcicpOwpfZGVyZXFfKCcuL2RheWRyZWFtLWNvbnRyb2xzJyk7Cl9kZXJlcV8oJy4vZ2VhcnZyLWNvbnRyb2xzJyk7Cl9kZXJlcV8oJy4vZ2VvbWV0cnknKTsKX2RlcmVxXygnLi9nbHRmLW1vZGVsJyk7Cl9kZXJlcV8oJy4vaGFuZC1jb250cm9scycpOwpfZGVyZXFfKCcuL2xhc2VyLWNvbnRyb2xzJyk7Cl9kZXJlcV8oJy4vbGlnaHQnKTsKX2RlcmVxXygnLi9saW5lJyk7Cl9kZXJlcV8oJy4vbGluaycpOwpfZGVyZXFfKCcuL2xvb2stY29udHJvbHMnKTsKX2RlcmVxXygnLi9tYXRlcmlhbCcpOwpfZGVyZXFfKCcuL29iai1tb2RlbCcpOwpfZGVyZXFfKCcuL29jdWx1cy1nby1jb250cm9scycpOwpfZGVyZXFfKCcuL29jdWx1cy10b3VjaC1jb250cm9scycpOwpfZGVyZXFfKCcuL3Bvc2l0aW9uJyk7Cl9kZXJlcV8oJy4vcmF5Y2FzdGVyJyk7Cl9kZXJlcV8oJy4vcm90YXRpb24nKTsKX2RlcmVxXygnLi9zY2FsZScpOwpfZGVyZXFfKCcuL3NoYWRvdycpOwpfZGVyZXFfKCcuL3NvdW5kJyk7Cl9kZXJlcV8oJy4vdGV4dCcpOwpfZGVyZXFfKCcuL3RyYWNrZWQtY29udHJvbHMnKTsKX2RlcmVxXygnLi90cmFja2VkLWNvbnRyb2xzLXdlYnZyJyk7Cl9kZXJlcV8oJy4vdHJhY2tlZC1jb250cm9scy13ZWJ4cicpOwpfZGVyZXFfKCcuL3Zpc2libGUnKTsKX2RlcmVxXygnLi92aXZlLWNvbnRyb2xzJyk7Cl9kZXJlcV8oJy4vdml2ZS1mb2N1cy1jb250cm9scycpOwpfZGVyZXFfKCcuL3dhc2QtY29udHJvbHMnKTsKX2RlcmVxXygnLi93aW5kb3dzLW1vdGlvbi1jb250cm9scycpOwoKX2RlcmVxXygnLi9zY2VuZS9iYWNrZ3JvdW5kJyk7Cl9kZXJlcV8oJy4vc2NlbmUvZGVidWcnKTsKX2RlcmVxXygnLi9zY2VuZS9lbWJlZGRlZCcpOwpfZGVyZXFfKCcuL3NjZW5lL2luc3BlY3RvcicpOwpfZGVyZXFfKCcuL3NjZW5lL2ZvZycpOwpfZGVyZXFfKCcuL3NjZW5lL2tleWJvYXJkLXNob3J0Y3V0cycpOwpfZGVyZXFfKCcuL3NjZW5lL3Bvb2wnKTsKX2RlcmVxXygnLi9zY2VuZS9zY3JlZW5zaG90Jyk7Cl9kZXJlcV8oJy4vc2NlbmUvc3RhdHMnKTsKX2RlcmVxXygnLi9zY2VuZS92ci1tb2RlLXVpJyk7Cgp9LHsiLi9hbmltYXRpb24iOjU1LCIuL2NhbWVyYSI6NTYsIi4vY3Vyc29yIjo1NywiLi9kYXlkcmVhbS1jb250cm9scyI6NTgsIi4vZ2VhcnZyLWNvbnRyb2xzIjo1OSwiLi9nZW9tZXRyeSI6NjAsIi4vZ2x0Zi1tb2RlbCI6NjEsIi4vaGFuZC1jb250cm9scyI6NjIsIi4vbGFzZXItY29udHJvbHMiOjY0LCIuL2xpZ2h0Ijo2NSwiLi9saW5lIjo2NiwiLi9saW5rIjo2NywiLi9sb29rLWNvbnRyb2xzIjo2OCwiLi9tYXRlcmlhbCI6NjksIi4vb2JqLW1vZGVsIjo3MCwiLi9vY3VsdXMtZ28tY29udHJvbHMiOjcxLCIuL29jdWx1cy10b3VjaC1jb250cm9scyI6NzIsIi4vcG9zaXRpb24iOjczLCIuL3JheWNhc3RlciI6NzQsIi4vcm90YXRpb24iOjc1LCIuL3NjYWxlIjo3NiwiLi9zY2VuZS9iYWNrZ3JvdW5kIjo3NywiLi9zY2VuZS9kZWJ1ZyI6NzgsIi4vc2NlbmUvZW1iZWRkZWQiOjc5LCIuL3NjZW5lL2ZvZyI6ODAsIi4vc2NlbmUvaW5zcGVjdG9yIjo4MSwiLi9zY2VuZS9rZXlib2FyZC1zaG9ydGN1dHMiOjgyLCIuL3NjZW5lL3Bvb2wiOjgzLCIuL3NjZW5lL3NjcmVlbnNob3QiOjg0LCIuL3NjZW5lL3N0YXRzIjo4NSwiLi9zY2VuZS92ci1tb2RlLXVpIjo4NiwiLi9zaGFkb3ciOjg3LCIuL3NvdW5kIjo4OCwiLi90ZXh0Ijo4OSwiLi90cmFja2VkLWNvbnRyb2xzIjo5MiwiLi90cmFja2VkLWNvbnRyb2xzLXdlYnZyIjo5MCwiLi90cmFja2VkLWNvbnRyb2xzLXdlYnhyIjo5MSwiLi92aXNpYmxlIjo5MywiLi92aXZlLWNvbnRyb2xzIjo5NCwiLi92aXZlLWZvY3VzLWNvbnRyb2xzIjo5NSwiLi93YXNkLWNvbnRyb2xzIjo5NiwiLi93aW5kb3dzLW1vdGlvbi1jb250cm9scyI6OTd9XSw2NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwoKcmVnaXN0ZXJDb21wb25lbnQoJ2xhc2VyLWNvbnRyb2xzJywgewogIHNjaGVtYTogewogICAgaGFuZDoge2RlZmF1bHQ6ICdyaWdodCd9LAogICAgbW9kZWw6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGRlZmF1bHRNb2RlbENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJ2dyZXknfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZzsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBtb2RlbEVuYWJsZWQgPSB0aGlzLmRhdGEubW9kZWwgJiYgIXRoaXMuZWwuc2NlbmVFbC5oYXNXZWJYUjsKICAgIHZhciBjb250cm9sc0NvbmZpZ3VyYXRpb24gPSB7aGFuZDogZGF0YS5oYW5kLCBtb2RlbDogbW9kZWxFbmFibGVkfTsKCiAgICAvLyBTZXQgYWxsIGNvbnRyb2xsZXIgbW9kZWxzLgogICAgZWwuc2V0QXR0cmlidXRlKCdkYXlkcmVhbS1jb250cm9scycsIGNvbnRyb2xzQ29uZmlndXJhdGlvbik7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2dlYXJ2ci1jb250cm9scycsIGNvbnRyb2xzQ29uZmlndXJhdGlvbik7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ29jdWx1cy1nby1jb250cm9scycsIGNvbnRyb2xzQ29uZmlndXJhdGlvbik7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ29jdWx1cy10b3VjaC1jb250cm9scycsIGNvbnRyb2xzQ29uZmlndXJhdGlvbik7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ3ZpdmUtY29udHJvbHMnLCBjb250cm9sc0NvbmZpZ3VyYXRpb24pOwogICAgZWwuc2V0QXR0cmlidXRlKCd2aXZlLWZvY3VzLWNvbnRyb2xzJywgY29udHJvbHNDb25maWd1cmF0aW9uKTsKICAgIGVsLnNldEF0dHJpYnV0ZSgnd2luZG93cy1tb3Rpb24tY29udHJvbHMnLCBjb250cm9sc0NvbmZpZ3VyYXRpb24pOwoKICAgIC8vIFdlYlhSIGRvZXNuJ3QgYWxsb3cgdG8gZGlzY3JpbWluYXRlIGJldHdlZW4gY29udHJvbGxlcnMsIGEgZGVmYXVsdCBtb2RlbCBpcyB1c2VkLgogICAgaWYgKHRoaXMuZGF0YS5tb2RlbCAmJiB0aGlzLmVsLnNjZW5lRWwuaGFzV2ViWFIpIHsgdGhpcy5pbml0RGVmYXVsdE1vZGVsKCk7IH0KCiAgICAvLyBXYWl0IGZvciBjb250cm9sbGVyIHRvIGNvbm5lY3QsIG9yIGhhdmUgYSB2YWxpZCBwb2ludGluZyBwb3NlLCBiZWZvcmUgY3JlYXRpbmcgcmF5CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY29ubmVjdGVkJywgY3JlYXRlUmF5KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJkaXNjb25uZWN0ZWQnLCBoaWRlUmF5KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJtb2RlbHJlYWR5JywgZnVuY3Rpb24gKGV2dCkgewogICAgICBjcmVhdGVSYXkoZXZ0KTsKICAgICAgc2VsZi5tb2RlbFJlYWR5ID0gdHJ1ZTsKICAgIH0pOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJheSAoZXZ0KSB7CiAgICAgIHZhciBjb250cm9sbGVyQ29uZmlnID0gY29uZmlnW2V2dC5kZXRhaWwubmFtZV07CgogICAgICBpZiAoIWNvbnRyb2xsZXJDb25maWcpIHsgcmV0dXJuOyB9CgogICAgICAvLyBTaG93IHRoZSBsaW5lIHVubGVzcyBhIHBhcnRpY3VsYXIgY29uZmlnIG9wdHMgdG8gaGlkZSBpdCwgdW50aWwgYSBjb250cm9sbGVybW9kZWxyZWFkeQogICAgICAvLyBldmVudCBjb21lcyB0aHJvdWdoLgogICAgICB2YXIgcmF5Y2FzdGVyQ29uZmlnID0gdXRpbHMuZXh0ZW5kKHsKICAgICAgICBzaG93TGluZTogdHJ1ZQogICAgICB9LCBjb250cm9sbGVyQ29uZmlnLnJheWNhc3RlciB8fCB7fSk7CgogICAgICAvLyBUaGUgY29udHJvbGxlcm1vZGVscmVhZHkgZXZlbnQgY29udGFpbnMgYSByYXlPcmlnaW4gdGhhdCB0YWtlcyBpbnRvIGFjY291bnQKICAgICAgLy8gb2Zmc2V0cyBzcGVjaWZpYyB0byB0aGUgbG9hZGVkIG1vZGVsLgogICAgICBpZiAoZXZ0LmRldGFpbC5yYXlPcmlnaW4pIHsKICAgICAgICByYXljYXN0ZXJDb25maWcub3JpZ2luID0gZXZ0LmRldGFpbC5yYXlPcmlnaW4ub3JpZ2luOwogICAgICAgIHJheWNhc3RlckNvbmZpZy5kaXJlY3Rpb24gPSBldnQuZGV0YWlsLnJheU9yaWdpbi5kaXJlY3Rpb247CiAgICAgICAgcmF5Y2FzdGVyQ29uZmlnLnNob3dMaW5lID0gdHJ1ZTsKICAgICAgfQoKICAgICAgLy8gT25seSBhcHBseSBhIGRlZmF1bHQgcmF5Y2FzdGVyIGlmIGl0IGRvZXMgbm90IHlldCBleGlzdC4gVGhpcyBwcmV2ZW50cyBpdCBvdmVyd3JpdGluZwogICAgICAvLyBjb25maWcgYXBwbGllZCBmcm9tIGEgY29udHJvbGxlcm1vZGVscmVhZHkgZXZlbnQuCiAgICAgIGlmIChldnQuZGV0YWlsLnJheU9yaWdpbiB8fCAhc2VsZi5tb2RlbFJlYWR5KSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdyYXljYXN0ZXInLCByYXljYXN0ZXJDb25maWcpOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgncmF5Y2FzdGVyJywgJ3Nob3dMaW5lJywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY3Vyc29yJywgdXRpbHMuZXh0ZW5kKHsKICAgICAgICBmdXNlOiBmYWxzZQogICAgICB9LCBjb250cm9sbGVyQ29uZmlnLmN1cnNvcikpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhpZGVSYXkgKCkgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3JheWNhc3RlcicsICdzaG93TGluZScsIGZhbHNlKTsKICAgIH0KICB9LAoKICBjb25maWc6IHsKICAgICdkYXlkcmVhbS1jb250cm9scyc6IHsKICAgICAgY3Vyc29yOiB7ZG93bkV2ZW50czogWyd0cmFja3BhZGRvd24nLCAndHJpZ2dlcmRvd24nXSwgdXBFdmVudHM6IFsndHJhY2twYWR1cCcsICd0cmlnZ2VydXAnXX0KICAgIH0sCgogICAgJ2dlYXJ2ci1jb250cm9scyc6IHsKICAgICAgY3Vyc29yOiB7ZG93bkV2ZW50czogWyd0cmlnZ2VyZG93biddLCB1cEV2ZW50czogWyd0cmlnZ2VydXAnXX0sCiAgICAgIHJheWNhc3Rlcjoge29yaWdpbjoge3g6IDAsIHk6IDAuMDAwNSwgejogMH19CiAgICB9LAoKICAgICdvY3VsdXMtZ28tY29udHJvbHMnOiB7CiAgICAgIGN1cnNvcjoge2Rvd25FdmVudHM6IFsndHJpZ2dlcmRvd24nXSwgdXBFdmVudHM6IFsndHJpZ2dlcnVwJ119LAogICAgICByYXljYXN0ZXI6IHtvcmlnaW46IHt4OiAwLCB5OiAwLjAwMDUsIHo6IDB9fQogICAgfSwKCiAgICAnb2N1bHVzLXRvdWNoLWNvbnRyb2xzJzogewogICAgICBjdXJzb3I6IHtkb3duRXZlbnRzOiBbJ3RyaWdnZXJkb3duJ10sIHVwRXZlbnRzOiBbJ3RyaWdnZXJ1cCddfSwKICAgICAgcmF5Y2FzdGVyOiB7b3JpZ2luOiB7eDogMCwgeTogMCwgejogMH19CiAgICB9LAoKICAgICd2aXZlLWNvbnRyb2xzJzogewogICAgICBjdXJzb3I6IHtkb3duRXZlbnRzOiBbJ3RyaWdnZXJkb3duJ10sIHVwRXZlbnRzOiBbJ3RyaWdnZXJ1cCddfQogICAgfSwKCiAgICAndml2ZS1mb2N1cy1jb250cm9scyc6IHsKICAgICAgY3Vyc29yOiB7ZG93bkV2ZW50czogWyd0cmFja3BhZGRvd24nLCAndHJpZ2dlcmRvd24nXSwgdXBFdmVudHM6IFsndHJhY2twYWR1cCcsICd0cmlnZ2VydXAnXX0KICAgIH0sCgogICAgJ3dpbmRvd3MtbW90aW9uLWNvbnRyb2xzJzogewogICAgICBjdXJzb3I6IHtkb3duRXZlbnRzOiBbJ3RyaWdnZXJkb3duJ10sIHVwRXZlbnRzOiBbJ3RyaWdnZXJ1cCddfSwKICAgICAgcmF5Y2FzdGVyOiB7c2hvd0xpbmU6IGZhbHNlfQogICAgfQogIH0sCgogIGluaXREZWZhdWx0TW9kZWw6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBtb2RlbEVsID0gdGhpcy5tb2RlbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1lbnRpdHknKTsKICAgIG1vZGVsRWwuc2V0QXR0cmlidXRlKCdnZW9tZXRyeScsIHsKICAgICAgcHJpbWl0aXZlOiAnc3BoZXJlJywKICAgICAgcmFkaXVzOiAwLjAzCiAgICB9KTsKICAgIG1vZGVsRWwuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsIHtjb2xvcjogdGhpcy5kYXRhLmNvbG9yfSk7CiAgICB0aGlzLmVsLmFwcGVuZENoaWxkKG1vZGVsRWwpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vdXRpbHMvIjoxNzl9XSw2NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBiaW5kID0gX2RlcmVxXygnLi4vdXRpbHMvYmluZCcpOwp2YXIgZGlmZiA9IF9kZXJlcV8oJy4uL3V0aWxzJykuZGlmZjsKdmFyIGRlYnVnID0gX2RlcmVxXygnLi4vdXRpbHMvZGVidWcnKTsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgZGVnVG9SYWQgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkOwp2YXIgd2FybiA9IGRlYnVnKCdjb21wb25lbnRzOmxpZ2h0Ondhcm4nKTsKCi8qKgogKiBMaWdodCBjb21wb25lbnQuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnbGlnaHQnLCB7CiAgc2NoZW1hOiB7CiAgICBhbmdsZToge2RlZmF1bHQ6IDYwLCBpZjoge3R5cGU6IFsnc3BvdCddfX0sCiAgICBjb2xvcjoge3R5cGU6ICdjb2xvcid9LAogICAgZ3JvdW5kQ29sb3I6IHt0eXBlOiAnY29sb3InLCBpZjoge3R5cGU6IFsnaGVtaXNwaGVyZSddfX0sCiAgICBkZWNheToge2RlZmF1bHQ6IDEsIGlmOiB7dHlwZTogWydwb2ludCcsICdzcG90J119fSwKICAgIGRpc3RhbmNlOiB7ZGVmYXVsdDogMC4wLCBtaW46IDAsIGlmOiB7dHlwZTogWydwb2ludCcsICdzcG90J119fSwKICAgIGludGVuc2l0eToge2RlZmF1bHQ6IDEuMCwgbWluOiAwLCBpZjoge3R5cGU6IFsnYW1iaWVudCcsICdkaXJlY3Rpb25hbCcsICdoZW1pc3BoZXJlJywgJ3BvaW50JywgJ3Nwb3QnXX19LAogICAgcGVudW1icmE6IHtkZWZhdWx0OiAwLCBtaW46IDAsIG1heDogMSwgaWY6IHt0eXBlOiBbJ3Nwb3QnXX19LAogICAgdHlwZTogewogICAgICBkZWZhdWx0OiAnZGlyZWN0aW9uYWwnLAogICAgICBvbmVPZjogWydhbWJpZW50JywgJ2RpcmVjdGlvbmFsJywgJ2hlbWlzcGhlcmUnLCAncG9pbnQnLCAnc3BvdCddLAogICAgICBzY2hlbWFDaGFuZ2U6IHRydWUKICAgIH0sCiAgICB0YXJnZXQ6IHt0eXBlOiAnc2VsZWN0b3InLCBpZjoge3R5cGU6IFsnc3BvdCcsICdkaXJlY3Rpb25hbCddfX0sCgogICAgLy8gU2hhZG93cy4KICAgIGNhc3RTaGFkb3c6IHtkZWZhdWx0OiBmYWxzZSwgaWY6IHt0eXBlOiBbJ3BvaW50JywgJ3Nwb3QnLCAnZGlyZWN0aW9uYWwnXX19LAogICAgc2hhZG93Qmlhczoge2RlZmF1bHQ6IDAsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93Q2FtZXJhRmFyOiB7ZGVmYXVsdDogNTAwLCBpZjoge2Nhc3RTaGFkb3c6IHRydWV9fSwKICAgIHNoYWRvd0NhbWVyYUZvdjoge2RlZmF1bHQ6IDkwLCBpZjoge2Nhc3RTaGFkb3c6IHRydWV9fSwKICAgIHNoYWRvd0NhbWVyYU5lYXI6IHtkZWZhdWx0OiAwLjUsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93Q2FtZXJhVG9wOiB7ZGVmYXVsdDogNSwgaWY6IHtjYXN0U2hhZG93OiB0cnVlfX0sCiAgICBzaGFkb3dDYW1lcmFSaWdodDoge2RlZmF1bHQ6IDUsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93Q2FtZXJhQm90dG9tOiB7ZGVmYXVsdDogLTUsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93Q2FtZXJhTGVmdDoge2RlZmF1bHQ6IC01LCBpZjoge2Nhc3RTaGFkb3c6IHRydWV9fSwKICAgIHNoYWRvd0NhbWVyYVZpc2libGU6IHtkZWZhdWx0OiBmYWxzZSwgaWY6IHtjYXN0U2hhZG93OiB0cnVlfX0sCiAgICBzaGFkb3dNYXBIZWlnaHQ6IHtkZWZhdWx0OiA1MTIsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93TWFwV2lkdGg6IHtkZWZhdWx0OiA1MTIsIGlmOiB7Y2FzdFNoYWRvdzogdHJ1ZX19LAogICAgc2hhZG93UmFkaXVzOiB7ZGVmYXVsdDogMSwgaWY6IHtjYXN0U2hhZG93OiB0cnVlfX0KICB9LAoKICAvKioKICAgKiBOb3RpZmllcyBzY2VuZSBhIGxpZ2h0IGhhcyBiZWVuIGFkZGVkIHRvIHJlbW92ZSBkZWZhdWx0IGxpZ2h0aW5nLgogICAqLwogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB0aGlzLmxpZ2h0ID0gbnVsbDsKICAgIHRoaXMuZGVmYXVsdFRhcmdldCA9IG51bGw7CiAgICB0aGlzLnJlbmRlcmVyU3lzdGVtID0gdGhpcy5lbC5zY2VuZUVsLnN5c3RlbXMucmVuZGVyZXI7CiAgICB0aGlzLnN5c3RlbS5yZWdpc3RlckxpZ2h0KGVsKTsKICB9LAoKICAvKioKICAgKiAoUmUpY3JlYXRlIG9yIHVwZGF0ZSBsaWdodC4KICAgKi8KICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBkaWZmRGF0YSA9IGRpZmYoZGF0YSwgb2xkRGF0YSk7CiAgICB2YXIgbGlnaHQgPSB0aGlzLmxpZ2h0OwogICAgdmFyIHJlbmRlcmVyU3lzdGVtID0gdGhpcy5yZW5kZXJlclN5c3RlbTsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAvLyBFeGlzdGluZyBsaWdodC4KICAgIGlmIChsaWdodCAmJiAhKCd0eXBlJyBpbiBkaWZmRGF0YSkpIHsKICAgICAgdmFyIHNoYWRvd3NMb2FkZWQgPSBmYWxzZTsKICAgICAgLy8gTGlnaHQgdHlwZSBoYXMgbm90IGNoYW5nZWQuIFVwZGF0ZSBsaWdodC4KICAgICAgT2JqZWN0LmtleXMoZGlmZkRhdGEpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciB2YWx1ZSA9IGRhdGFba2V5XTsKCiAgICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICAgIGNhc2UgJ2NvbG9yJzogewogICAgICAgICAgICBsaWdodC5jb2xvci5zZXQodmFsdWUpOwogICAgICAgICAgICByZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbihsaWdodC5jb2xvcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgJ2dyb3VuZENvbG9yJzogewogICAgICAgICAgICBsaWdodC5ncm91bmRDb2xvci5zZXQodmFsdWUpOwogICAgICAgICAgICByZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbihsaWdodC5ncm91bmRDb2xvcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgJ2FuZ2xlJzogewogICAgICAgICAgICBsaWdodC5hbmdsZSA9IGRlZ1RvUmFkKHZhbHVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAndGFyZ2V0JzogewogICAgICAgICAgICAvLyBSZXNldCB0YXJnZXQgaWYgc2VsZWN0b3IgaXMgbnVsbC4KICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3Nwb3QnIHx8IGRhdGEudHlwZSA9PT0gJ2RpcmVjdGlvbmFsJykgewogICAgICAgICAgICAgICAgbGlnaHQudGFyZ2V0ID0gc2VsZi5kZWZhdWx0VGFyZ2V0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBUYXJnZXQgc3BlY2lmaWVkLCBzZXQgdGFyZ2V0IHRvIGVudGl0eSdzIGBvYmplY3QzRGAgd2hlbiBpdCBpcyBsb2FkZWQuCiAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc0xvYWRlZCkgewogICAgICAgICAgICAgICAgc2VsZi5vblNldFRhcmdldCh2YWx1ZSwgbGlnaHQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YWx1ZS5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBiaW5kKHNlbGYub25TZXRUYXJnZXQsIHNlbGYsIHZhbHVlLCBsaWdodCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlICdjYXN0U2hhZG93JzoKICAgICAgICAgIGNhc2UgJ3NoYWRvd0JpYXMnOgogICAgICAgICAgY2FzZSAnc2hhZG93Q2FtZXJhRmFyJzoKICAgICAgICAgIGNhc2UgJ3NoYWRvd0NhbWVyYUZvdic6CiAgICAgICAgICBjYXNlICdzaGFkb3dDYW1lcmFOZWFyJzoKICAgICAgICAgIGNhc2UgJ3NoYWRvd0NhbWVyYVRvcCc6CiAgICAgICAgICBjYXNlICdzaGFkb3dDYW1lcmFSaWdodCc6CiAgICAgICAgICBjYXNlICdzaGFkb3dDYW1lcmFCb3R0b20nOgogICAgICAgICAgY2FzZSAnc2hhZG93Q2FtZXJhTGVmdCc6CiAgICAgICAgICBjYXNlICdzaGFkb3dDYW1lcmFWaXNpYmxlJzoKICAgICAgICAgIGNhc2UgJ3NoYWRvd01hcEhlaWdodCc6CiAgICAgICAgICBjYXNlICdzaGFkb3dNYXBXaWR0aCc6CiAgICAgICAgICBjYXNlICdzaGFkb3dSYWRpdXMnOgogICAgICAgICAgICBpZiAoIXNoYWRvd3NMb2FkZWQpIHsKICAgICAgICAgICAgICBzZWxmLnVwZGF0ZVNoYWRvdygpOwogICAgICAgICAgICAgIHNoYWRvd3NMb2FkZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgbGlnaHRba2V5XSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBObyBsaWdodCB5ZXQgb3IgbGlnaHQgdHlwZSBoYXMgY2hhbmdlZC4gQ3JlYXRlIGFuZCBhZGQgbGlnaHQuCiAgICB0aGlzLnNldExpZ2h0KHRoaXMuZGF0YSk7CiAgICB0aGlzLnVwZGF0ZVNoYWRvdygpOwogIH0sCgogIHNldExpZ2h0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBuZXdMaWdodCA9IHRoaXMuZ2V0TGlnaHQoZGF0YSk7CiAgICBpZiAobmV3TGlnaHQpIHsKICAgICAgaWYgKHRoaXMubGlnaHQpIHsKICAgICAgICBlbC5yZW1vdmVPYmplY3QzRCgnbGlnaHQnKTsKICAgICAgfQoKICAgICAgdGhpcy5saWdodCA9IG5ld0xpZ2h0OwogICAgICB0aGlzLmxpZ2h0LmVsID0gZWw7CiAgICAgIGVsLnNldE9iamVjdDNEKCdsaWdodCcsIHRoaXMubGlnaHQpOwoKICAgICAgLy8gSEFDSyBzb2x1dGlvbiBmb3IgaXNzdWUgIzE2MjQKICAgICAgaWYgKGRhdGEudHlwZSA9PT0gJ3Nwb3QnIHx8IGRhdGEudHlwZSA9PT0gJ2RpcmVjdGlvbmFsJyB8fCBkYXRhLnR5cGUgPT09ICdoZW1pc3BoZXJlJykgewogICAgICAgIGVsLmdldE9iamVjdDNEKCdsaWdodCcpLnRyYW5zbGF0ZVkoLTEpOwogICAgICB9CgogICAgICAvLyBzZXQgYW5kIHBvc2l0aW9uIGRlZmF1bHQgbGlnaHR0YXJnZXQgYXMgYSBjaGlsZCB0byBlbmFibGUgc3BvdGxpZ2h0IG9yaWVudGF0aW9uCiAgICAgIGlmIChkYXRhLnR5cGUgPT09ICdzcG90JykgewogICAgICAgIGVsLnNldE9iamVjdDNEKCdsaWdodC10YXJnZXQnLCB0aGlzLmRlZmF1bHRUYXJnZXQpOwogICAgICAgIGVsLmdldE9iamVjdDNEKCdsaWdodC10YXJnZXQnKS5wb3NpdGlvbi5zZXQoMCwgMCwgLTEpOwogICAgICB9CiAgICB9CiAgfSwKCiAgLyoqCiAgICogVXBkYXRlcyBzaGFkb3ctcmVsYXRlZCBwcm9wZXJ0aWVzIG9uIHRoZSBjdXJyZW50IGxpZ2h0LgogICAqLwogIHVwZGF0ZVNoYWRvdzogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGxpZ2h0ID0gdGhpcy5saWdodDsKCiAgICBsaWdodC5jYXN0U2hhZG93ID0gZGF0YS5jYXN0U2hhZG93OwoKICAgIC8vIFNoYWRvdyBjYW1lcmEgaGVscGVyLgogICAgdmFyIGNhbWVyYUhlbHBlciA9IGVsLmdldE9iamVjdDNEKCdjYW1lcmFIZWxwZXInKTsKICAgIGlmIChkYXRhLnNoYWRvd0NhbWVyYVZpc2libGUgJiYgIWNhbWVyYUhlbHBlcikgewogICAgICBlbC5zZXRPYmplY3QzRCgnY2FtZXJhSGVscGVyJywgbmV3IFRIUkVFLkNhbWVyYUhlbHBlcihsaWdodC5zaGFkb3cuY2FtZXJhKSk7CiAgICB9IGVsc2UgaWYgKCFkYXRhLnNoYWRvd0NhbWVyYVZpc2libGUgJiYgY2FtZXJhSGVscGVyKSB7CiAgICAgIGVsLnJlbW92ZU9iamVjdDNEKCdjYW1lcmFIZWxwZXInKTsKICAgIH0KCiAgICBpZiAoIWRhdGEuY2FzdFNoYWRvdykgeyByZXR1cm4gbGlnaHQ7IH0KCiAgICAvLyBTaGFkb3cgYXBwZWFyYW5jZS4KICAgIGxpZ2h0LnNoYWRvdy5iaWFzID0gZGF0YS5zaGFkb3dCaWFzOwogICAgbGlnaHQuc2hhZG93LnJhZGl1cyA9IGRhdGEuc2hhZG93UmFkaXVzOwogICAgbGlnaHQuc2hhZG93Lm1hcFNpemUuaGVpZ2h0ID0gZGF0YS5zaGFkb3dNYXBIZWlnaHQ7CiAgICBsaWdodC5zaGFkb3cubWFwU2l6ZS53aWR0aCA9IGRhdGEuc2hhZG93TWFwV2lkdGg7CgogICAgLy8gU2hhZG93IGNhbWVyYS4KICAgIGxpZ2h0LnNoYWRvdy5jYW1lcmEubmVhciA9IGRhdGEuc2hhZG93Q2FtZXJhTmVhcjsKICAgIGxpZ2h0LnNoYWRvdy5jYW1lcmEuZmFyID0gZGF0YS5zaGFkb3dDYW1lcmFGYXI7CiAgICBpZiAobGlnaHQuc2hhZG93LmNhbWVyYSBpbnN0YW5jZW9mIFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYSkgewogICAgICBsaWdodC5zaGFkb3cuY2FtZXJhLnRvcCA9IGRhdGEuc2hhZG93Q2FtZXJhVG9wOwogICAgICBsaWdodC5zaGFkb3cuY2FtZXJhLnJpZ2h0ID0gZGF0YS5zaGFkb3dDYW1lcmFSaWdodDsKICAgICAgbGlnaHQuc2hhZG93LmNhbWVyYS5ib3R0b20gPSBkYXRhLnNoYWRvd0NhbWVyYUJvdHRvbTsKICAgICAgbGlnaHQuc2hhZG93LmNhbWVyYS5sZWZ0ID0gZGF0YS5zaGFkb3dDYW1lcmFMZWZ0OwogICAgfSBlbHNlIHsKICAgICAgbGlnaHQuc2hhZG93LmNhbWVyYS5mb3YgPSBkYXRhLnNoYWRvd0NhbWVyYUZvdjsKICAgIH0KICAgIGxpZ2h0LnNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIGlmIChjYW1lcmFIZWxwZXIpIHsgY2FtZXJhSGVscGVyLnVwZGF0ZSgpOyB9CiAgfSwKCiAgLyoqCiAgICogQ3JlYXRlcyBhIG5ldyB0aHJlZS5qcyBsaWdodCBvYmplY3QgZ2l2ZW4gZGF0YSBvYmplY3QgZGVmaW5pbmcgdGhlIGxpZ2h0LgogICAqCiAgICogQHBhcmFtIHtvYmplY3R9IGRhdGEKICAgKi8KICBnZXRMaWdodDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBhbmdsZSA9IGRhdGEuYW5nbGU7CiAgICB2YXIgY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoZGF0YS5jb2xvcik7CiAgICB0aGlzLnJlbmRlcmVyU3lzdGVtLmFwcGx5Q29sb3JDb3JyZWN0aW9uKGNvbG9yKTsKICAgIGNvbG9yID0gY29sb3IuZ2V0SGV4KCk7CiAgICB2YXIgZGVjYXkgPSBkYXRhLmRlY2F5OwogICAgdmFyIGRpc3RhbmNlID0gZGF0YS5kaXN0YW5jZTsKICAgIHZhciBncm91bmRDb2xvciA9IG5ldyBUSFJFRS5Db2xvcihkYXRhLmdyb3VuZENvbG9yKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24oZ3JvdW5kQ29sb3IpOwogICAgZ3JvdW5kQ29sb3IgPSBncm91bmRDb2xvci5nZXRIZXgoKTsKICAgIHZhciBpbnRlbnNpdHkgPSBkYXRhLmludGVuc2l0eTsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwogICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0OwogICAgdmFyIGxpZ2h0ID0gbnVsbDsKCiAgICBzd2l0Y2ggKHR5cGUudG9Mb3dlckNhc2UoKSkgewogICAgICBjYXNlICdhbWJpZW50JzogewogICAgICAgIHJldHVybiBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KGNvbG9yLCBpbnRlbnNpdHkpOwogICAgICB9CgogICAgICBjYXNlICdkaXJlY3Rpb25hbCc6IHsKICAgICAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KGNvbG9yLCBpbnRlbnNpdHkpOwogICAgICAgIHRoaXMuZGVmYXVsdFRhcmdldCA9IGxpZ2h0LnRhcmdldDsKICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0xvYWRlZCkgewogICAgICAgICAgICB0aGlzLm9uU2V0VGFyZ2V0KHRhcmdldCwgbGlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGJpbmQodGhpcy5vblNldFRhcmdldCwgdGhpcywgdGFyZ2V0LCBsaWdodCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlnaHQ7CiAgICAgIH0KCiAgICAgIGNhc2UgJ2hlbWlzcGhlcmUnOiB7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5IZW1pc3BoZXJlTGlnaHQoY29sb3IsIGdyb3VuZENvbG9yLCBpbnRlbnNpdHkpOwogICAgICB9CgogICAgICBjYXNlICdwb2ludCc6IHsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLlBvaW50TGlnaHQoY29sb3IsIGludGVuc2l0eSwgZGlzdGFuY2UsIGRlY2F5KTsKICAgICAgfQoKICAgICAgY2FzZSAnc3BvdCc6IHsKICAgICAgICBsaWdodCA9IG5ldyBUSFJFRS5TcG90TGlnaHQoY29sb3IsIGludGVuc2l0eSwgZGlzdGFuY2UsIGRlZ1RvUmFkKGFuZ2xlKSwgZGF0YS5wZW51bWJyYSwgZGVjYXkpOwogICAgICAgIHRoaXMuZGVmYXVsdFRhcmdldCA9IGxpZ2h0LnRhcmdldDsKICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICBpZiAodGFyZ2V0Lmhhc0xvYWRlZCkgewogICAgICAgICAgICB0aGlzLm9uU2V0VGFyZ2V0KHRhcmdldCwgbGlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZCcsIGJpbmQodGhpcy5vblNldFRhcmdldCwgdGhpcywgdGFyZ2V0LCBsaWdodCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlnaHQ7CiAgICAgIH0KCiAgICAgIGRlZmF1bHQ6IHsKICAgICAgICB3YXJuKCclcyBpcyBub3QgYSB2YWxpZCBsaWdodCB0eXBlLiAnICsKICAgICAgICAgICAnQ2hvb3NlIGZyb20gYW1iaWVudCwgZGlyZWN0aW9uYWwsIGhlbWlzcGhlcmUsIHBvaW50LCBzcG90LicsIHR5cGUpOwogICAgICB9CiAgICB9CiAgfSwKCiAgb25TZXRUYXJnZXQ6IGZ1bmN0aW9uICh0YXJnZXRFbCwgbGlnaHQpIHsKICAgIGxpZ2h0LnRhcmdldCA9IHRhcmdldEVsLm9iamVjdDNEOwogIH0sCgogIC8qKgogICAqIFJlbW92ZSBsaWdodCBvbiByZW1vdmUgKGNhbGxiYWNrKS4KICAgKi8KICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVPYmplY3QzRCgnbGlnaHQnKTsKICAgIGlmIChlbC5nZXRPYmplY3QzRCgnY2FtZXJhSGVscGVyJykpIHsKICAgICAgZWwucmVtb3ZlT2JqZWN0M0QoJ2NhbWVyYUhlbHBlcicpOwogICAgfQogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzIjoxNzksIi4uL3V0aWxzL2JpbmQiOjE3MywiLi4vdXRpbHMvZGVidWciOjE3NX1dLDY2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyogZ2xvYmFsIFRIUkVFICovCnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7Cgptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnbGluZScsIHsKICBzY2hlbWE6IHsKICAgIHN0YXJ0OiB7dHlwZTogJ3ZlYzMnLCBkZWZhdWx0OiB7eDogMCwgeTogMCwgejogMH19LAogICAgZW5kOiB7dHlwZTogJ3ZlYzMnLCBkZWZhdWx0OiB7eDogMCwgeTogMCwgejogMH19LAogICAgY29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnIzc0QkVDMSd9LAogICAgb3BhY2l0eToge3R5cGU6ICdudW1iZXInLCBkZWZhdWx0OiAxfSwKICAgIHZpc2libGU6IHtkZWZhdWx0OiB0cnVlfQogIH0sCgogIG11bHRpcGxlOiB0cnVlLAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBnZW9tZXRyeTsKICAgIHZhciBtYXRlcmlhbDsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0gPSB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5yZW5kZXJlcjsKICAgIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7CiAgICAgIGNvbG9yOiBkYXRhLmNvbG9yLAogICAgICBvcGFjaXR5OiBkYXRhLm9wYWNpdHksCiAgICAgIHRyYW5zcGFyZW50OiBkYXRhLm9wYWNpdHkgPCAxLAogICAgICB2aXNpYmxlOiBkYXRhLnZpc2libGUKICAgIH0pOwogICAgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CiAgICBnZW9tZXRyeS5hZGRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkJ1ZmZlckF0dHJpYnV0ZShuZXcgRmxvYXQzMkFycmF5KDIgKiAzKSwgMykpOwoKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24obWF0ZXJpYWwuY29sb3IpOwogICAgdGhpcy5saW5lID0gbmV3IFRIUkVFLkxpbmUoZ2VvbWV0cnksIG1hdGVyaWFsKTsKICAgIHRoaXMuZWwuc2V0T2JqZWN0M0QodGhpcy5hdHRyTmFtZSwgdGhpcy5saW5lKTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICB2YXIgZ2VvTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIHZhciBtYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB2YXIgcG9zaXRpb25BcnJheSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXk7CgogICAgLy8gVXBkYXRlIGdlb21ldHJ5LgogICAgaWYgKCFpc0VxdWFsVmVjMyhkYXRhLnN0YXJ0LCBvbGREYXRhLnN0YXJ0KSkgewogICAgICBwb3NpdGlvbkFycmF5WzBdID0gZGF0YS5zdGFydC54OwogICAgICBwb3NpdGlvbkFycmF5WzFdID0gZGF0YS5zdGFydC55OwogICAgICBwb3NpdGlvbkFycmF5WzJdID0gZGF0YS5zdGFydC56OwogICAgICBnZW9OZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CgogICAgaWYgKCFpc0VxdWFsVmVjMyhkYXRhLmVuZCwgb2xkRGF0YS5lbmQpKSB7CiAgICAgIHBvc2l0aW9uQXJyYXlbM10gPSBkYXRhLmVuZC54OwogICAgICBwb3NpdGlvbkFycmF5WzRdID0gZGF0YS5lbmQueTsKICAgICAgcG9zaXRpb25BcnJheVs1XSA9IGRhdGEuZW5kLno7CiAgICAgIGdlb05lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0KCiAgICBpZiAoZ2VvTmVlZHNVcGRhdGUpIHsKICAgICAgZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwogICAgfQoKICAgIG1hdGVyaWFsLmNvbG9yLnNldFN0eWxlKGRhdGEuY29sb3IpOwogICAgdGhpcy5yZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbihtYXRlcmlhbC5jb2xvcik7CiAgICBtYXRlcmlhbC5vcGFjaXR5ID0gZGF0YS5vcGFjaXR5OwogICAgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBkYXRhLm9wYWNpdHkgPCAxOwogICAgbWF0ZXJpYWwudmlzaWJsZSA9IGRhdGEudmlzaWJsZTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwucmVtb3ZlT2JqZWN0M0QoJ2xpbmUnLCB0aGlzLmxpbmUpOwogIH0KfSk7CgpmdW5jdGlvbiBpc0VxdWFsVmVjMyAoYSwgYikgewogIGlmICghYSB8fCAhYikgeyByZXR1cm4gZmFsc2U7IH0KICByZXR1cm4gKGEueCA9PT0gYi54ICYmIGEueSA9PT0gYi55ICYmIGEueiA9PT0gYi56KTsKfQoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDZ9XSw2NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciByZWdpc3RlclNoYWRlciA9IF9kZXJlcV8oJy4uL2NvcmUvc2hhZGVyJykucmVnaXN0ZXJTaGFkZXI7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKLyoqCiAqIExpbmsgY29tcG9uZW50LiBDb25uZWN0IGV4cGVyaWVuY2VzIGFuZCB0cmF2ZXJzZSBiZXR3ZWVuIHRoZW0gaW4gVlIKICoKICogQG1lbWJlciB7b2JqZWN0fSBoaWRkZW5FbHMgLSBTdG9yZSB0aGUgaGlkZGVuIGVsZW1lbnRzIGR1cmluZyBwZWVrIG1vZGUuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnbGluaycsIHsKICBzY2hlbWE6IHsKICAgIGJhY2tncm91bmRDb2xvcjoge2RlZmF1bHQ6ICdyZWQnLCB0eXBlOiAnY29sb3InfSwKICAgIGJvcmRlckNvbG9yOiB7ZGVmYXVsdDogJ3doaXRlJywgdHlwZTogJ2NvbG9yJ30sCiAgICBoaWdobGlnaHRlZDoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIGhpZ2hsaWdodGVkQ29sb3I6IHtkZWZhdWx0OiAnIzI0Q0FGRicsIHR5cGU6ICdjb2xvcid9LAogICAgaHJlZjoge2RlZmF1bHQ6ICcnfSwKICAgIGltYWdlOiB7dHlwZTogJ2Fzc2V0J30sCiAgICBvbjoge2RlZmF1bHQ6ICdjbGljayd9LAogICAgcGVla01vZGU6IHtkZWZhdWx0OiBmYWxzZX0sCiAgICB0aXRsZToge2RlZmF1bHQ6ICcnfSwKICAgIHRpdGxlQ29sb3I6IHtkZWZhdWx0OiAnd2hpdGUnLCB0eXBlOiAnY29sb3InfSwKICAgIHZpc3VhbEFzcGVjdEVuYWJsZWQ6IHtkZWZhdWx0OiBmYWxzZX0KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm5hdmlnYXRlID0gdGhpcy5uYXZpZ2F0ZS5iaW5kKHRoaXMpOwogICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSB1bmRlZmluZWQ7CiAgICB0aGlzLnF1YXRlcm5pb25DbG9uZSA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICAvLyBTdG9yZSBoaWRkZW4gZWxlbWVudHMgZHVyaW5nIHBlZWsgbW9kZSBzbyB3ZSBjYW4gc2hvdyB0aGVtIGFnYWluIGxhdGVyLgogICAgdGhpcy5oaWRkZW5FbHMgPSBbXTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgYmFja2dyb3VuZENvbG9yOwogICAgdmFyIHN0cm9rZUNvbG9yOwoKICAgIGlmICghZGF0YS52aXN1YWxBc3BlY3RFbmFibGVkKSB7IHJldHVybjsgfQoKICAgIHRoaXMuaW5pdFZpc3VhbEFzcGVjdCgpOwoKICAgIGJhY2tncm91bmRDb2xvciA9IGRhdGEuaGlnaGxpZ2h0ZWQgPyBkYXRhLmhpZ2hsaWdodGVkQ29sb3IgOiBkYXRhLmJhY2tncm91bmRDb2xvcjsKICAgIHN0cm9rZUNvbG9yID0gZGF0YS5oaWdobGlnaHRlZCA/IGRhdGEuaGlnaGxpZ2h0ZWRDb2xvciA6IGRhdGEuYm9yZGVyQ29sb3I7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ21hdGVyaWFsJywgJ2JhY2tncm91bmRDb2xvcicsIGJhY2tncm91bmRDb2xvcik7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ21hdGVyaWFsJywgJ3N0cm9rZUNvbG9yJywgc3Ryb2tlQ29sb3IpOwoKICAgIGlmIChkYXRhLm9uICE9PSBvbGREYXRhLm9uKSB7IHRoaXMudXBkYXRlRXZlbnRMaXN0ZW5lcigpOyB9CgogICAgaWYgKG9sZERhdGEucGVla01vZGUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIGRhdGEucGVla01vZGUgIT09IG9sZERhdGEucGVla01vZGUpIHsgdGhpcy51cGRhdGVQZWVrTW9kZSgpOyB9CgogICAgaWYgKCFkYXRhLmltYWdlIHx8IG9sZERhdGEuaW1hZ2UgPT09IGRhdGEuaW1hZ2UpIHsgcmV0dXJuOyB9CgogICAgZWwuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsICdwYW5vJywKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgZGF0YS5pbWFnZSA9PT0gJ3N0cmluZycgPyBkYXRhLmltYWdlIDogZGF0YS5pbWFnZS5zcmMpOwogIH0sCgogIC8qCiAgICogVG9nZ2xlIGFsbCBlbGVtZW50cyBhbmQgZnVsbCAzNjAgcHJldmlldyBvZiB0aGUgbGlua2VkIHBhZ2UuCiAgICovCiAgdXBkYXRlUGVla01vZGU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgc3BoZXJlRWwgPSB0aGlzLnNwaGVyZUVsOwogICAgaWYgKHRoaXMuZGF0YS5wZWVrTW9kZSkgewogICAgICB0aGlzLmhpZGVBbGwoKTsKICAgICAgZWwuZ2V0T2JqZWN0M0QoJ21lc2gnKS52aXNpYmxlID0gZmFsc2U7CiAgICAgIHNwaGVyZUVsLnNldEF0dHJpYnV0ZSgndmlzaWJsZScsIHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zaG93QWxsKCk7CiAgICAgIGVsLmdldE9iamVjdDNEKCdtZXNoJykudmlzaWJsZSA9IHRydWU7CiAgICAgIHNwaGVyZUVsLnNldEF0dHJpYnV0ZSgndmlzaWJsZScsIGZhbHNlKTsKICAgIH0KICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnVwZGF0ZUV2ZW50TGlzdGVuZXIoKTsKICB9LAoKICBwYXVzZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCk7CiAgfSwKCiAgdXBkYXRlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGlmICghZWwuaXNQbGF5aW5nKSB7IHJldHVybjsgfQogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKHRoaXMuZGF0YS5vbiwgdGhpcy5uYXZpZ2F0ZSk7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgdmFyIG9uID0gdGhpcy5kYXRhLm9uOwogICAgaWYgKCFvbikgeyByZXR1cm47IH0KICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihvbiwgdGhpcy5uYXZpZ2F0ZSk7CiAgfSwKCiAgaW5pdFZpc3VhbEFzcGVjdDogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzZW1pU3BoZXJlRWw7CiAgICB2YXIgc3BoZXJlRWw7CiAgICB2YXIgdGV4dEVsOwoKICAgIGlmICghdGhpcy5kYXRhLnZpc3VhbEFzcGVjdEVuYWJsZWQgfHwgdGhpcy52aXN1YWxBc3BlY3RJbml0aWFsaXplZCkgeyByZXR1cm47IH0KCiAgICB0ZXh0RWwgPSB0aGlzLnRleHRFbCA9IHRoaXMudGV4dEVsIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7CiAgICBzcGhlcmVFbCA9IHRoaXMuc3BoZXJlRWwgPSB0aGlzLnNwaGVyZUVsIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7CiAgICBzZW1pU3BoZXJlRWwgPSB0aGlzLnNlbWlTcGhlcmVFbCA9IHRoaXMuc2VtaVNwaGVyZUVsIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7CgogICAgLy8gU2V0IHBvcnRhbC4KICAgIGVsLnNldEF0dHJpYnV0ZSgnZ2VvbWV0cnknLCB7cHJpbWl0aXZlOiAnY2lyY2xlJywgcmFkaXVzOiAxLjAsIHNlZ21lbnRzOiA2NH0pOwogICAgZWwuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsIHtzaGFkZXI6ICdwb3J0YWwnLCBwYW5vOiB0aGlzLmRhdGEuaW1hZ2UsIHNpZGU6ICdkb3VibGUnfSk7CgogICAgLy8gU2V0IHRleHQgdGhhdCBkaXNwbGF5cyB0aGUgbGluayB0aXRsZSBhbmQgVVJMLgogICAgdGV4dEVsLnNldEF0dHJpYnV0ZSgndGV4dCcsIHsKICAgICAgY29sb3I6IHRoaXMuZGF0YS50aXRsZUNvbG9yLAogICAgICBhbGlnbjogJ2NlbnRlcicsCiAgICAgIGZvbnQ6ICdrZWxzb25zYW5zJywKICAgICAgdmFsdWU6IHRoaXMuZGF0YS50aXRsZSB8fCB0aGlzLmRhdGEuaHJlZiwKICAgICAgd2lkdGg6IDQKICAgIH0pOwogICAgdGV4dEVsLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCAnMCAxLjUgMCcpOwogICAgZWwuYXBwZW5kQ2hpbGQodGV4dEVsKTsKCiAgICAvLyBTZXQgc3BoZXJlIHJlbmRlcmVkIHdoZW4gY2FtZXJhIGlzIGNsb3NlIHRvIHBvcnRhbCB0byBhbGxvdyB1c2VyIHRvIHBlZWsgaW5zaWRlLgogICAgc2VtaVNwaGVyZUVsLnNldEF0dHJpYnV0ZSgnZ2VvbWV0cnknLCB7CiAgICAgIHByaW1pdGl2ZTogJ3NwaGVyZScsCiAgICAgIHJhZGl1czogMS4wLAogICAgICBwaGlTdGFydDogMCwKICAgICAgc2VnbWVudHNXaWR0aDogNjQsCiAgICAgIHNlZ21lbnRzSGVpZ2h0OiA2NCwKICAgICAgcGhpTGVuZ3RoOiAxODAsCiAgICAgIHRoZXRhU3RhcnQ6IDAsCiAgICAgIHRoZXRhTGVuZ3RoOiAzNjAKICAgIH0pOwogICAgc2VtaVNwaGVyZUVsLnNldEF0dHJpYnV0ZSgnbWF0ZXJpYWwnLCB7CiAgICAgIHNoYWRlcjogJ3BvcnRhbCcsCiAgICAgIGJvcmRlckVuYWJsZWQ6IDAuMCwKICAgICAgcGFubzogdGhpcy5kYXRhLmltYWdlLAogICAgICBzaWRlOiAnYmFjaycKICAgIH0pOwogICAgc2VtaVNwaGVyZUVsLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAnMCAxODAgMCcpOwogICAgc2VtaVNwaGVyZUVsLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCAnMCAwIDAnKTsKICAgIHNlbWlTcGhlcmVFbC5zZXRBdHRyaWJ1dGUoJ3Zpc2libGUnLCBmYWxzZSk7CiAgICBlbC5hcHBlbmRDaGlsZChzZW1pU3BoZXJlRWwpOwoKICAgIC8vIFNldCBzcGhlcmUgcmVuZGVyZWQgd2hlbiBjYW1lcmEgaXMgY2xvc2UgdG8gcG9ydGFsIHRvIGFsbG93IHVzZXIgdG8gcGVlayBpbnNpZGUuCiAgICBzcGhlcmVFbC5zZXRBdHRyaWJ1dGUoJ2dlb21ldHJ5JywgewogICAgICBwcmltaXRpdmU6ICdzcGhlcmUnLAogICAgICByYWRpdXM6IDEwLAogICAgICBzZWdtZW50c1dpZHRoOiA2NCwKICAgICAgc2VnbWVudHNIZWlnaHQ6IDY0CiAgICB9KTsKICAgIHNwaGVyZUVsLnNldEF0dHJpYnV0ZSgnbWF0ZXJpYWwnLCB7CiAgICAgIHNoYWRlcjogJ3BvcnRhbCcsCiAgICAgIGJvcmRlckVuYWJsZWQ6IDAuMCwKICAgICAgcGFubzogdGhpcy5kYXRhLmltYWdlLAogICAgICBzaWRlOiAnYmFjaycKICAgIH0pOwogICAgc3BoZXJlRWwuc2V0QXR0cmlidXRlKCd2aXNpYmxlJywgZmFsc2UpOwogICAgZWwuYXBwZW5kQ2hpbGQoc3BoZXJlRWwpOwoKICAgIHRoaXMudmlzdWFsQXNwZWN0SW5pdGlhbGl6ZWQgPSB0cnVlOwogIH0sCgogIG5hdmlnYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB3aW5kb3cubG9jYXRpb24gPSB0aGlzLmRhdGEuaHJlZjsKICB9LAoKICAvKioKICAgKiAxLiBTd2FwIHBsYW5lIHRoYXQgcmVwcmVzZW50cyBwb3J0YWwgd2l0aCBzcGhlcmUgd2l0aCBhIGhvbGUgd2hlbiB0aGUgY2FtZXJhIGlzIGNsb3NlCiAgICogc28gdXNlciBjYW4gcGVlayBpbnNpZGUgcG9ydGFsLiBTcGhlcmUgaXMgcmVuZGVyZWQgb24gb3Bvc2l0ZSBzaWRlIG9mIHBvcnRhbAogICAqIGZyb20gd2hlcmUgdXNlciBlbnRlcnMuCiAgICogMi4gUGxhY2UgdGhlIHVybC90aXRsZSBhYm92ZSBvciBpbnNpZGUgcG9ydGFsIGRlcGVuZGluZyBvbiBkaXN0YW5jZSB0byBjYW1lcmEuCiAgICogMy4gRmFjZSBwb3J0YWwgdG8gY2FtZXJhIHdoZW4gZmFyIGF3YXkgZnJvbSB1c2VyLgogICAqLwogIHRpY2s6IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FtZXJhV29ybGRQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICB2YXIgZWxXb3JsZFBvc2l0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIHZhciBxdWF0ZXJuaW9uID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTsKICAgIHZhciBzY2FsZSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKICAgICAgdmFyIG9iamVjdDNEID0gZWwub2JqZWN0M0Q7CiAgICAgIHZhciBjYW1lcmEgPSBlbC5zY2VuZUVsLmNhbWVyYTsKICAgICAgdmFyIGNhbWVyYVBvcnRhbE9yaWVudGF0aW9uOwogICAgICB2YXIgZGlzdGFuY2U7CiAgICAgIHZhciB0ZXh0RWwgPSB0aGlzLnRleHRFbDsKCiAgICAgIGlmICghdGhpcy5kYXRhLnZpc3VhbEFzcGVjdEVuYWJsZWQpIHsgcmV0dXJuOyB9CgogICAgICAvLyBVcGRhdGUgbWF0cmljZXMKICAgICAgb2JqZWN0M0QudXBkYXRlTWF0cml4V29ybGQoKTsKICAgICAgY2FtZXJhLnBhcmVudC51cGRhdGVNYXRyaXhXb3JsZCgpOwogICAgICBjYW1lcmEudXBkYXRlTWF0cml4V29ybGQoKTsKCiAgICAgIG9iamVjdDNELm1hdHJpeC5kZWNvbXBvc2UoZWxXb3JsZFBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSk7CiAgICAgIGVsV29ybGRQb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24ob2JqZWN0M0QubWF0cml4V29ybGQpOwogICAgICBjYW1lcmFXb3JsZFBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpOwogICAgICBkaXN0YW5jZSA9IGVsV29ybGRQb3NpdGlvbi5kaXN0YW5jZVRvKGNhbWVyYVdvcmxkUG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gMjApIHsKICAgICAgICAvLyBTdG9yZSBvcmlnaW5hbCBvcmllbnRhdGlvbiB0byBiZSByZXN0b3JlZCB3aGVuIHRoZSBwb3J0YWwgc3RvcHMgZmFjaW5nIHRoZSBjYW1lcmEuCiAgICAgICAgaWYgKCF0aGlzLnByZXZpb3VzUXVhdGVybmlvbikgewogICAgICAgICAgdGhpcy5xdWF0ZXJuaW9uQ2xvbmUuY29weShxdWF0ZXJuaW9uKTsKICAgICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gdGhpcy5xdWF0ZXJuaW9uQ2xvbmU7CiAgICAgICAgfQogICAgICAgIC8vIElmIHRoZSBwb3J0YWwgaXMgZmFyIGF3YXkgZnJvbSB0aGUgdXNlciwgZmFjZSBwb3J0YWwgdG8gY2FtZXJhLgogICAgICAgIG9iamVjdDNELmxvb2tBdChjYW1lcmFXb3JsZFBvc2l0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBXaGVuIHBvcnRhbCBpcyBjbG9zZSB0byB0aGUgdXNlci9jYW1lcmEuCiAgICAgICAgY2FtZXJhUG9ydGFsT3JpZW50YXRpb24gPSB0aGlzLmNhbGN1bGF0ZUNhbWVyYVBvcnRhbE9yaWVudGF0aW9uKCk7CiAgICAgICAgLy8gSWYgdXNlciBnZXRzIHZlcnkgY2xvc2UgdG8gcG9ydGFsLCByZXBsYWNlIHdpdGggaG9sZWQgc3BoZXJlIHRoZXkgY2FuIHBlZWsgaW4uCiAgICAgICAgaWYgKGRpc3RhbmNlIDwgMC41KSB7CiAgICAgICAgICAvLyBDb25maWd1cmUgdGV4dCBzaXplIGFuZCBzcGhlcmUgb3JpZW50YXRpb24gZGVwZW5kaW5nIHNpZGUgdXNlciBhcHByb2FjaGVzIHBvcnRhbC4KICAgICAgICAgIGlmICh0aGlzLnNlbWlTcGhlcmVFbC5nZXRBdHRyaWJ1dGUoJ3Zpc2libGUnKSA9PT0gdHJ1ZSkgeyByZXR1cm47IH0KICAgICAgICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ3RleHQnLCAnd2lkdGgnLCAxLjUpOwogICAgICAgICAgaWYgKGNhbWVyYVBvcnRhbE9yaWVudGF0aW9uIDw9IDAuMCkgewogICAgICAgICAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsICcwIDAgMC43NScpOwogICAgICAgICAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCdyb3RhdGlvbicsICcwIDE4MCAwJyk7CiAgICAgICAgICAgIHRoaXMuc2VtaVNwaGVyZUVsLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAnMCAwIDAnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgJzAgMCAtMC43NScpOwogICAgICAgICAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCdyb3RhdGlvbicsICcwIDAgMCcpOwogICAgICAgICAgICB0aGlzLnNlbWlTcGhlcmVFbC5zZXRBdHRyaWJ1dGUoJ3JvdGF0aW9uJywgJzAgMTgwIDAnKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsLmdldE9iamVjdDNEKCdtZXNoJykudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgdGhpcy5zZW1pU3BoZXJlRWwuc2V0QXR0cmlidXRlKCd2aXNpYmxlJywgdHJ1ZSk7CiAgICAgICAgICB0aGlzLnBlZWtDYW1lcmFQb3J0YWxPcmllbnRhdGlvbiA9IGNhbWVyYVBvcnRhbE9yaWVudGF0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBDYWxjdWxhdGUgd2ljaCBzaWRlIHRoZSBjYW1lcmEgaXMgYXBwcm9hY2hpbmcgdGhlIGNhbWVyYSAoYmFjayAvIGZyb250KS4KICAgICAgICAgIC8vIEFkanVzdCB0ZXh0IG9yaWVudGF0aW9uIGJhc2VkIG9uIGNhbWVyYSBwb3NpdGlvbi4KICAgICAgICAgIGlmIChjYW1lcmFQb3J0YWxPcmllbnRhdGlvbiA8PSAwLjApIHsKICAgICAgICAgICAgdGV4dEVsLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAnMCAxODAgMCcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dEVsLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAnMCAwIDAnKTsKICAgICAgICAgIH0KICAgICAgICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ3RleHQnLCAnd2lkdGgnLCA1KTsKICAgICAgICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgJzAgMS41IDAnKTsKICAgICAgICAgIGVsLmdldE9iamVjdDNEKCdtZXNoJykudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICB0aGlzLnNlbWlTcGhlcmVFbC5zZXRBdHRyaWJ1dGUoJ3Zpc2libGUnLCBmYWxzZSk7CiAgICAgICAgICB0aGlzLnBlZWtDYW1lcmFQb3J0YWxPcmllbnRhdGlvbiA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uKSB7CiAgICAgICAgICBvYmplY3QzRC5xdWF0ZXJuaW9uLmNvcHkodGhpcy5wcmV2aW91c1F1YXRlcm5pb24pOwogICAgICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0pKCksCgogIGhpZGVBbGw6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgaGlkZGVuRWxzID0gdGhpcy5oaWRkZW5FbHM7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoaGlkZGVuRWxzLmxlbmd0aCA+IDApIHsgcmV0dXJuOyB9CiAgICBlbC5zY2VuZUVsLm9iamVjdDNELnRyYXZlcnNlKGZ1bmN0aW9uIChvYmplY3QpIHsKICAgICAgaWYgKG9iamVjdCAmJiBvYmplY3QuZWwgJiYgb2JqZWN0LmVsLmhhc0F0dHJpYnV0ZSgnbGluay1jb250cm9scycpKSB7IHJldHVybjsgfQogICAgICBpZiAoIW9iamVjdC5lbCB8fCBvYmplY3QgPT09IGVsLnNjZW5lRWwub2JqZWN0M0QgfHwgb2JqZWN0LmVsID09PSBlbCB8fAogICAgICAgICAgb2JqZWN0LmVsID09PSBzZWxmLnNwaGVyZUVsIHx8IG9iamVjdC5lbCA9PT0gZWwuc2NlbmVFbC5jYW1lcmFFbCB8fAogICAgICAgICAgb2JqZWN0LmVsLmdldEF0dHJpYnV0ZSgndmlzaWJsZScpID09PSBmYWxzZSB8fCBvYmplY3QuZWwgPT09IHNlbGYudGV4dEVsIHx8CiAgICAgICAgICBvYmplY3QuZWwgPT09IHNlbGYuc2VtaVNwaGVyZUVsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIG9iamVjdC5lbC5zZXRBdHRyaWJ1dGUoJ3Zpc2libGUnLCBmYWxzZSk7CiAgICAgIGhpZGRlbkVscy5wdXNoKG9iamVjdC5lbCk7CiAgICB9KTsKICB9LAoKICBzaG93QWxsOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmhpZGRlbkVscy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgeyBlbC5zZXRBdHRyaWJ1dGUoJ3Zpc2libGUnLCB0cnVlKTsgfSk7CiAgICB0aGlzLmhpZGRlbkVscyA9IFtdOwogIH0sCgogIC8qKgogICAqIENhbGN1bGF0ZSB3aGV0aGVyIHRoZSBjYW1lcmEgZmFjZXMgdGhlIGZyb250IG9yIGJhY2sgZmFjZSBvZiB0aGUgcG9ydGFsLgogICAqIEByZXR1cm5zIHtudW1iZXJ9ID4gMCBpZiBjYW1lcmEgZmFjZXMgZnJvbnQgb2YgcG9ydGFsLCA8IDAgaWYgaXQgZmFjZXMgYmFjayBvZiBwb3J0YWwuCiAgICovCiAgY2FsY3VsYXRlQ2FtZXJhUG9ydGFsT3JpZW50YXRpb246IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgbWF0NCA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7CiAgICB2YXIgY2FtZXJhUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgdmFyIHBvcnRhbE5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpOwogICAgdmFyIHBvcnRhbFBvc2l0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVsID0gdGhpcy5lbDsKICAgICAgdmFyIGNhbWVyYSA9IGVsLnNjZW5lRWwuY2FtZXJhOwoKICAgICAgLy8gUmVzZXQgdG1wIHZhcmlhYmxlcy4KICAgICAgY2FtZXJhUG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgICBwb3J0YWxOb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwb3J0YWxQb3NpdGlvbi5zZXQoMCwgMCwgMCk7CgogICAgICAvLyBBcHBseSBwb3J0YWwgb3JpZW50YXRpb24gdG8gdGhlIG5vcm1hbC4KICAgICAgZWwub2JqZWN0M0QubWF0cml4V29ybGQuZXh0cmFjdFJvdGF0aW9uKG1hdDQpOwogICAgICBwb3J0YWxOb3JtYWwuYXBwbHlNYXRyaXg0KG1hdDQpOwoKICAgICAgLy8gQ2FsY3VsYXRlIHBvcnRhbCB3b3JsZCBwb3NpdGlvbi4KICAgICAgZWwub2JqZWN0M0QudXBkYXRlTWF0cml4V29ybGQoKTsKICAgICAgZWwub2JqZWN0M0QubG9jYWxUb1dvcmxkKHBvcnRhbFBvc2l0aW9uKTsKCiAgICAgIC8vIENhbGN1bGF0ZSBjYW1lcmEgd29ybGQgcG9zaXRpb24uCiAgICAgIGNhbWVyYS5wYXJlbnQucGFyZW50LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CiAgICAgIGNhbWVyYS5wYXJlbnQudXBkYXRlTWF0cml4V29ybGQoKTsKICAgICAgY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CiAgICAgIGNhbWVyYS5sb2NhbFRvV29ybGQoY2FtZXJhUG9zaXRpb24pOwoKICAgICAgLy8gQ2FsY3VsYXRlIHZlY3RvciBmcm9tIHBvcnRhbCB0byBjYW1lcmEuCiAgICAgIC8vIChwb3J0YWwpIC0tLS0tLS0+IChjYW1lcmEpCiAgICAgIGNhbWVyYVBvc2l0aW9uLnN1Yihwb3J0YWxQb3NpdGlvbikubm9ybWFsaXplKCk7CiAgICAgIHBvcnRhbE5vcm1hbC5ub3JtYWxpemUoKTsKCiAgICAgIC8vIFNpZGUgd2hlcmUgY2FtZXJhIGFwcHJvYWNoZXMgcG9ydGFsIGlzIGdpdmVuIGJ5IHNpZ24gb2YgZG90IHByb2R1Y3Qgb2YgcG9ydGFsIG5vcm1hbAogICAgICAvLyBhbmQgcG9ydGFsIHRvIGNhbWVyYSB2ZWN0b3JzLgogICAgICByZXR1cm4gTWF0aC5zaWduKHBvcnRhbE5vcm1hbC5kb3QoY2FtZXJhUG9zaXRpb24pKTsKICAgIH07CiAgfSkoKSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoKTsKICB9Cn0pOwoKLyogZXNsaW50LWRpc2FibGUgKi8KcmVnaXN0ZXJTaGFkZXIoJ3BvcnRhbCcsIHsKICBzY2hlbWE6IHsKICAgIGJvcmRlckVuYWJsZWQ6IHtkZWZhdWx0OiAxLjAsIHR5cGU6ICdpbnQnLCBpczogJ3VuaWZvcm0nfSwKICAgIGJhY2tncm91bmRDb2xvcjoge2RlZmF1bHQ6ICdyZWQnLCB0eXBlOiAnY29sb3InLCBpczogJ3VuaWZvcm0nfSwKICAgIHBhbm86IHt0eXBlOiAnbWFwJywgaXM6ICd1bmlmb3JtJ30sCiAgICBzdHJva2VDb2xvcjoge2RlZmF1bHQ6ICd3aGl0ZScsIHR5cGU6ICdjb2xvcicsIGlzOiAndW5pZm9ybSd9CiAgfSwKCiAgdmVydGV4U2hhZGVyOiBbCiAgICAndmVjMyBwb3J0YWxQb3NpdGlvbjsnLAogICAgJ3ZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjsnLAogICAgJ3ZhcnlpbmcgZmxvYXQgdkRpc3RhbmNlVG9DZW50ZXI7JywKICAgICd2YXJ5aW5nIGZsb2F0IHZEaXN0YW5jZTsnLAogICAgJ3ZvaWQgbWFpbigpIHsnLAogICAgJ3ZEaXN0YW5jZVRvQ2VudGVyID0gY2xhbXAobGVuZ3RoKHBvc2l0aW9uIC0gdmVjMygwLjAsIDAuMCwgMC4wKSksIDAuMCwgMS4wKTsnLAogICAgJ3BvcnRhbFBvc2l0aW9uID0gKG1vZGVsTWF0cml4ICogdmVjNCgwLjAsIDAuMCwgMC4wLCAxLjApKS54eXo7JywKICAgICd2RGlzdGFuY2UgPSBsZW5ndGgocG9ydGFsUG9zaXRpb24gLSBjYW1lcmFQb3NpdGlvbik7JywKICAgICd2V29ybGRQb3NpdGlvbiA9IChtb2RlbE1hdHJpeCAqIHZlYzQocG9zaXRpb24sIDEuMCkpLnh5ejsnLAogICAgJ2dsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQocG9zaXRpb24sIDEuMCk7JywKICAgICd9JwogIF0uam9pbignXG4nKSwKCiAgZnJhZ21lbnRTaGFkZXI6IFsKICAgICcjZGVmaW5lIFJFQ0lQUk9DQUxfUEkyIDAuMTU5MTU0OTQnLAogICAgJ3VuaWZvcm0gc2FtcGxlcjJEIHBhbm87JywKICAgICd1bmlmb3JtIHZlYzMgc3Ryb2tlQ29sb3I7JywKICAgICd1bmlmb3JtIHZlYzMgYmFja2dyb3VuZENvbG9yOycsCiAgICAndW5pZm9ybSBmbG9hdCBib3JkZXJFbmFibGVkOycsCiAgICAndmFyeWluZyBmbG9hdCB2RGlzdGFuY2VUb0NlbnRlcjsnLAogICAgJ3ZhcnlpbmcgZmxvYXQgdkRpc3RhbmNlOycsCiAgICAndmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uOycsCiAgICAndm9pZCBtYWluKCkgeycsCiAgICAndmVjMyBkaXJlY3Rpb24gPSBub3JtYWxpemUodldvcmxkUG9zaXRpb24gLSBjYW1lcmFQb3NpdGlvbik7JywKICAgICd2ZWMyIHNhbXBsZVVWOycsCiAgICAnZmxvYXQgYm9yZGVyVGhpY2tuZXNzID0gY2xhbXAoZXhwKC12RGlzdGFuY2UgLyA1MC4wKSwgMC42LCAwLjk1KTsnLAogICAgJ3NhbXBsZVVWLnkgPSBzYXR1cmF0ZShkaXJlY3Rpb24ueSAqIDAuNSAgKyAwLjUpOycsCiAgICAnc2FtcGxlVVYueCA9IGF0YW4oZGlyZWN0aW9uLnosIC1kaXJlY3Rpb24ueCkgKiAtUkVDSVBST0NBTF9QSTIgKyAwLjU7JywKICAgICdpZiAodkRpc3RhbmNlVG9DZW50ZXIgPiBib3JkZXJUaGlja25lc3MgJiYgYm9yZGVyRW5hYmxlZCA9PSAxLjApIHsnLAogICAgJ2dsX0ZyYWdDb2xvciA9IHZlYzQoc3Ryb2tlQ29sb3IsIDEuMCk7JywKICAgICd9IGVsc2UgeycsCiAgICAnZ2xfRnJhZ0NvbG9yID0gbWl4KHRleHR1cmUyRChwYW5vLCBzYW1wbGVVViksIHZlYzQoYmFja2dyb3VuZENvbG9yLCAxLjApLCBjbGFtcChwb3coKHZEaXN0YW5jZSAvIDE1LjApLCAyLjApLCAwLjAsIDEuMCkpOycsCiAgICAnfScsCiAgICAnfScKICBdLmpvaW4oJ1xuJykKfSk7Ci8qIGVzbGludC1lbmFibGUgKi8KCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9jb3JlL3NoYWRlciI6MTE2LCIuLi9saWIvdGhyZWUiOjE1NH1dLDY4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwp2YXIgYmluZCA9IHV0aWxzLmJpbmQ7CnZhciBQb2x5ZmlsbENvbnRyb2xzID0gX2RlcmVxXygnLi4vdXRpbHMnKS5kZXZpY2UuUG9seWZpbGxDb250cm9sczsKCi8vIFRvIGF2b2lkIHJlY2FsY3VsYXRpb24gYXQgZXZlcnkgbW91c2UgbW92ZW1lbnQgdGljawp2YXIgUElfMiA9IE1hdGguUEkgLyAyOwoKLyoqCiAqIGxvb2stY29udHJvbHMuIFVwZGF0ZSBlbnRpdHkgcG9zZSwgZmFjdG9yaW5nIG1vdXNlLCB0b3VjaCwgYW5kIFdlYlZSIEFQSSBkYXRhLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ2xvb2stY29udHJvbHMnLCB7CiAgZGVwZW5kZW5jaWVzOiBbJ3Bvc2l0aW9uJywgJ3JvdGF0aW9uJ10sCgogIHNjaGVtYTogewogICAgZW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9LAogICAgaG1kRW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9LAogICAgcG9pbnRlckxvY2tFbmFibGVkOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgcmV2ZXJzZU1vdXNlRHJhZzoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIHJldmVyc2VUb3VjaERyYWc6IHtkZWZhdWx0OiBmYWxzZX0sCiAgICB0b3VjaEVuYWJsZWQ6IHtkZWZhdWx0OiB0cnVlfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucHJldmlvdXNITURQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICB0aGlzLmhtZFF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwogICAgdGhpcy5obWRFdWxlciA9IG5ldyBUSFJFRS5FdWxlcigpOwogICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICAvLyBUbyBzYXZlIC8gcmVzdG9yZSBjYW1lcmEgcG9zZQogICAgdGhpcy5zYXZlZFJvdGF0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIHRoaXMuc2F2ZWRQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICB0aGlzLnBvbHlmaWxsT2JqZWN0ID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7CiAgICB0aGlzLnBvbHlmaWxsQ29udHJvbHMgPSBuZXcgUG9seWZpbGxDb250cm9scyh0aGlzLnBvbHlmaWxsT2JqZWN0KTsKICAgIHRoaXMucm90YXRpb24gPSB7fTsKICAgIHRoaXMuZGVsdGFSb3RhdGlvbiA9IHt9OwogICAgdGhpcy5zYXZlZFBvc2UgPSBudWxsOwogICAgdGhpcy5wb2ludGVyTG9ja2VkID0gZmFsc2U7CiAgICB0aGlzLnNldHVwTW91c2VDb250cm9scygpOwogICAgdGhpcy5iaW5kTWV0aG9kcygpOwogICAgdGhpcy5lbC5vYmplY3QzRC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICB0aGlzLmVsLm9iamVjdDNELnVwZGF0ZU1hdHJpeCgpOwoKICAgIHRoaXMuc2F2ZWRQb3NlID0gewogICAgICBwb3NpdGlvbjogbmV3IFRIUkVFLlZlY3RvcjMoKSwKICAgICAgcm90YXRpb246IG5ldyBUSFJFRS5FdWxlcigpCiAgICB9OwoKICAgIC8vIENhbGwgZW50ZXIgVlIgaGFuZGxlciBpZiB0aGUgc2NlbmUgaGFzIGVudGVyZWQgVlIgYmVmb3JlIHRoZSBldmVudCBsaXN0ZW5lcnMgYXR0YWNoZWQuCiAgICBpZiAodGhpcy5lbC5zY2VuZUVsLmlzKCd2ci1tb2RlJykpIHsgdGhpcy5vbkVudGVyVlIoKTsgfQogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwoKICAgIC8vIERpc2FibGUgZ3JhYiBjdXJzb3IgY2xhc3NlcyBpZiBubyBsb25nZXIgZW5hYmxlZC4KICAgIGlmIChkYXRhLmVuYWJsZWQgIT09IG9sZERhdGEuZW5hYmxlZCkgewogICAgICB0aGlzLnVwZGF0ZUdyYWJDdXJzb3IoZGF0YS5lbmFibGVkKTsKICAgIH0KCiAgICAvLyBSZXNldCBwaXRjaCBhbmQgeWF3IGlmIGRpc2FibGluZyBITUQuCiAgICBpZiAob2xkRGF0YSAmJiAhZGF0YS5obWRFbmFibGVkICYmICFvbGREYXRhLmhtZEVuYWJsZWQpIHsKICAgICAgdGhpcy5waXRjaE9iamVjdC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMueWF3T2JqZWN0LnJvdGF0aW9uLnNldCgwLCAwLCAwKTsKICAgIH0KCiAgICBpZiAob2xkRGF0YSAmJiAhZGF0YS5wb2ludGVyTG9ja0VuYWJsZWQgIT09IG9sZERhdGEucG9pbnRlckxvY2tFbmFibGVkKSB7CiAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpOwogICAgICBpZiAodGhpcy5wb2ludGVyTG9ja2VkKSB7IHRoaXMuZXhpdFBvaW50ZXJMb2NrKCk7IH0KICAgIH0KICB9LAoKICB0aWNrOiBmdW5jdGlvbiAodCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICBpZiAoIWRhdGEuZW5hYmxlZCkgeyByZXR1cm47IH0KICAgIHRoaXMudXBkYXRlT3JpZW50YXRpb24oKTsKICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICAgIGlmICh0aGlzLnBvaW50ZXJMb2NrZWQpIHsgdGhpcy5leGl0UG9pbnRlckxvY2soKTsgfQogIH0sCgogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpOwogICAgaWYgKHRoaXMucG9pbnRlckxvY2tlZCkgeyB0aGlzLmV4aXRQb2ludGVyTG9jaygpOyB9CiAgfSwKCiAgYmluZE1ldGhvZHM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub25Nb3VzZURvd24gPSBiaW5kKHRoaXMub25Nb3VzZURvd24sIHRoaXMpOwogICAgdGhpcy5vbk1vdXNlTW92ZSA9IGJpbmQodGhpcy5vbk1vdXNlTW92ZSwgdGhpcyk7CiAgICB0aGlzLm9uTW91c2VVcCA9IGJpbmQodGhpcy5vbk1vdXNlVXAsIHRoaXMpOwogICAgdGhpcy5vblRvdWNoU3RhcnQgPSBiaW5kKHRoaXMub25Ub3VjaFN0YXJ0LCB0aGlzKTsKICAgIHRoaXMub25Ub3VjaE1vdmUgPSBiaW5kKHRoaXMub25Ub3VjaE1vdmUsIHRoaXMpOwogICAgdGhpcy5vblRvdWNoRW5kID0gYmluZCh0aGlzLm9uVG91Y2hFbmQsIHRoaXMpOwogICAgdGhpcy5vbkVudGVyVlIgPSBiaW5kKHRoaXMub25FbnRlclZSLCB0aGlzKTsKICAgIHRoaXMub25FeGl0VlIgPSBiaW5kKHRoaXMub25FeGl0VlIsIHRoaXMpOwogICAgdGhpcy5vblBvaW50ZXJMb2NrQ2hhbmdlID0gYmluZCh0aGlzLm9uUG9pbnRlckxvY2tDaGFuZ2UsIHRoaXMpOwogICAgdGhpcy5vblBvaW50ZXJMb2NrRXJyb3IgPSBiaW5kKHRoaXMub25Qb2ludGVyTG9ja0Vycm9yLCB0aGlzKTsKICB9LAoKIC8qKgogICogU2V0IHVwIHN0YXRlcyBhbmQgT2JqZWN0M0RzIG5lZWRlZCB0byBzdG9yZSByb3RhdGlvbiBkYXRhLgogICovCiAgc2V0dXBNb3VzZUNvbnRyb2xzOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlOwogICAgdGhpcy5waXRjaE9iamVjdCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpOwogICAgdGhpcy55YXdPYmplY3QgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTsKICAgIHRoaXMueWF3T2JqZWN0LnBvc2l0aW9uLnkgPSAxMDsKICAgIHRoaXMueWF3T2JqZWN0LmFkZCh0aGlzLnBpdGNoT2JqZWN0KTsKICB9LAoKICAvKioKICAgKiBBZGQgbW91c2UgYW5kIHRvdWNoIGV2ZW50IGxpc3RlbmVycyB0byBjYW52YXMuCiAgICovCiAgYWRkRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbC5zY2VuZUVsOwogICAgdmFyIGNhbnZhc0VsID0gc2NlbmVFbC5jYW52YXM7CgogICAgLy8gV2FpdCBmb3IgY2FudmFzIHRvIGxvYWQuCiAgICBpZiAoIWNhbnZhc0VsKSB7CiAgICAgIHNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyLXRhcmdldC1sb2FkZWQnLCBiaW5kKHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMsIHRoaXMpKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIE1vdXNlIGV2ZW50cy4KICAgIGNhbnZhc0VsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMub25Nb3VzZURvd24sIGZhbHNlKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlLCBmYWxzZSk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwLCBmYWxzZSk7CgogICAgLy8gVG91Y2ggZXZlbnRzLgogICAgY2FudmFzRWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25Ub3VjaFN0YXJ0KTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm9uVG91Y2hNb3ZlKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25Ub3VjaEVuZCk7CgogICAgLy8gc2NlbmVFbCBldmVudHMuCiAgICBzY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ2VudGVyLXZyJywgdGhpcy5vbkVudGVyVlIpOwogICAgc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdleGl0LXZyJywgdGhpcy5vbkV4aXRWUik7CgogICAgLy8gUG9pbnRlciBMb2NrIGV2ZW50cy4KICAgIGlmICh0aGlzLmRhdGEucG9pbnRlckxvY2tFbmFibGVkKSB7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgdGhpcy5vblBvaW50ZXJMb2NrQ2hhbmdlLCBmYWxzZSk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21venBvaW50ZXJsb2NrY2hhbmdlJywgdGhpcy5vblBvaW50ZXJMb2NrQ2hhbmdlLCBmYWxzZSk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrZXJyb3InLCB0aGlzLm9uUG9pbnRlckxvY2tFcnJvciwgZmFsc2UpOwogICAgfQogIH0sCgogIC8qKgogICAqIFJlbW92ZSBtb3VzZSBhbmQgdG91Y2ggZXZlbnQgbGlzdGVuZXJzIGZyb20gY2FudmFzLgogICAqLwogIHJlbW92ZUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIHZhciBjYW52YXNFbCA9IHNjZW5lRWwgJiYgc2NlbmVFbC5jYW52YXM7CgogICAgaWYgKCFjYW52YXNFbCkgeyByZXR1cm47IH0KCiAgICAvLyBNb3VzZSBldmVudHMuCiAgICBjYW52YXNFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2VEb3duKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlVXApOwoKICAgIC8vIFRvdWNoIGV2ZW50cy4KICAgIGNhbnZhc0VsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uVG91Y2hTdGFydCk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5vblRvdWNoTW92ZSk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uVG91Y2hFbmQpOwoKICAgIC8vIHNjZW5lRWwgZXZlbnRzLgogICAgc2NlbmVFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdlbnRlci12cicsIHRoaXMub25FbnRlclZSKTsKICAgIHNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXhpdC12cicsIHRoaXMub25FeGl0VlIpOwoKICAgIC8vIFBvaW50ZXIgTG9jayBldmVudHMuCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2NoYW5nZScsIHRoaXMub25Qb2ludGVyTG9ja0NoYW5nZSwgZmFsc2UpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96cG9pbnRlcmxvY2tjaGFuZ2UnLCB0aGlzLm9uUG9pbnRlckxvY2tDaGFuZ2UsIGZhbHNlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrZXJyb3InLCB0aGlzLm9uUG9pbnRlckxvY2tFcnJvciwgZmFsc2UpOwogIH0sCgogIC8qKgogICAqIFVwZGF0ZSBvcmllbnRhdGlvbiBmb3IgbW9iaWxlLCBtb3VzZSBkcmFnLCBhbmQgaGVhZHNldC4KICAgKiBNb3VzZS1kcmFnIG9ubHkgZW5hYmxlZCBpZiBITUQgaXMgbm90IGFjdGl2ZS4KICAgKi8KICB1cGRhdGVPcmllbnRhdGlvbjogKGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3NlTWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDQoKTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaG1kRXVsZXIgPSB0aGlzLmhtZEV1bGVyOwogICAgICB2YXIgb2JqZWN0M0QgPSB0aGlzLmVsLm9iamVjdDNEOwogICAgICB2YXIgcGl0Y2hPYmplY3QgPSB0aGlzLnBpdGNoT2JqZWN0OwogICAgICB2YXIgeWF3T2JqZWN0ID0gdGhpcy55YXdPYmplY3Q7CiAgICAgIHZhciBwb3NlOwogICAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKCiAgICAgIC8vIFdlYlhSIEFQSSB1cGRhdGVzIGFwcGxpZXMgaGVhZHNldCBwb3NlIHRvIHRoZSBvYmplY3QzRCBtYXRyaXhXb3JsZCBpbnRlcm5hbGx5LgogICAgICAvLyBSZWZsZWN0IHZhbHVlcyBiYWNrIG9uIHBvc2l0aW9uLCByb3RhdGlvbiwgc2NhbGUgc28gc2V0QXR0cmlidXRlIHJldHVybnMgZXhwZWN0ZWQgdmFsdWVzLgogICAgICBpZiAoc2NlbmVFbC5pcygndnItbW9kZScpICYmIHNjZW5lRWwuaGFzV2ViWFIpIHsKICAgICAgICBwb3NlID0gc2NlbmVFbC5yZW5kZXJlci52ci5nZXRDYW1lcmFQb3NlKCk7CiAgICAgICAgaWYgKHBvc2UpIHsKICAgICAgICAgIHBvc2VNYXRyaXguZWxlbWVudHMgPSBwb3NlLnBvc2VNb2RlbE1hdHJpeDsKICAgICAgICAgIHBvc2VNYXRyaXguZGVjb21wb3NlKG9iamVjdDNELnBvc2l0aW9uLCBvYmplY3QzRC5yb3RhdGlvbiwgb2JqZWN0M0Quc2NhbGUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBvYmplY3QzRC51cGRhdGVNYXRyaXgoKTsKICAgICAgfQoKICAgICAgLy8gSW4gVlIgbW9kZSwgVEhSRUUgaXMgaW4gY2hhcmdlIG9mIHVwZGF0aW5nIHRoZSBjYW1lcmEgcm90YXRpb24uCiAgICAgIGlmIChzY2VuZUVsLmlzKCd2ci1tb2RlJykgJiYgc2NlbmVFbC5jaGVja0hlYWRzZXRDb25uZWN0ZWQoKSkgeyByZXR1cm47IH0KICAgICAgLy8gQ2FsY3VsYXRlIHBvbHlmaWxsZWQgSE1EIHF1YXRlcm5pb24uCiAgICAgIHRoaXMucG9seWZpbGxDb250cm9scy51cGRhdGUoKTsKICAgICAgaG1kRXVsZXIuc2V0RnJvbVF1YXRlcm5pb24odGhpcy5wb2x5ZmlsbE9iamVjdC5xdWF0ZXJuaW9uLCAnWVhaJyk7CgogICAgICAvLyBPbiBtb2JpbGUsIGRvIGNhbWVyYSByb3RhdGlvbiB3aXRoIHRvdWNoIGV2ZW50cyBhbmQgc2Vuc29ycy4KICAgICAgb2JqZWN0M0Qucm90YXRpb24ueCA9IGhtZEV1bGVyLnggKyBwaXRjaE9iamVjdC5yb3RhdGlvbi54OwogICAgICBvYmplY3QzRC5yb3RhdGlvbi55ID0gaG1kRXVsZXIueSArIHlhd09iamVjdC5yb3RhdGlvbi55OwogICAgfTsKICB9KSgpLAoKICAvKioKICAgKiBUcmFuc2xhdGUgbW91c2UgZHJhZyBpbnRvIHJvdGF0aW9uLgogICAqCiAgICogRHJhZ2dpbmcgdXAgYW5kIGRvd24gcm90YXRlcyB0aGUgY2FtZXJhIGFyb3VuZCB0aGUgWC1heGlzICh5YXcpLgogICAqIERyYWdnaW5nIGxlZnQgYW5kIHJpZ2h0IHJvdGF0ZXMgdGhlIGNhbWVyYSBhcm91bmQgdGhlIFktYXhpcyAocGl0Y2gpLgogICAqLwogIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBkaXJlY3Rpb247CiAgICB2YXIgbW92ZW1lbnRYOwogICAgdmFyIG1vdmVtZW50WTsKICAgIHZhciBwaXRjaE9iamVjdCA9IHRoaXMucGl0Y2hPYmplY3Q7CiAgICB2YXIgcHJldmlvdXNNb3VzZUV2ZW50ID0gdGhpcy5wcmV2aW91c01vdXNlRXZlbnQ7CiAgICB2YXIgeWF3T2JqZWN0ID0gdGhpcy55YXdPYmplY3Q7CgogICAgLy8gTm90IGRyYWdnaW5nIG9yIG5vdCBlbmFibGVkLgogICAgaWYgKCF0aGlzLmRhdGEuZW5hYmxlZCB8fCAoIXRoaXMubW91c2VEb3duICYmICF0aGlzLnBvaW50ZXJMb2NrZWQpKSB7IHJldHVybjsgfQoKICAgIC8vIENhbGN1bGF0ZSBkZWx0YS4KICAgIGlmICh0aGlzLnBvaW50ZXJMb2NrZWQpIHsKICAgICAgbW92ZW1lbnRYID0gZXZlbnQubW92ZW1lbnRYIHx8IGV2ZW50Lm1vek1vdmVtZW50WCB8fCAwOwogICAgICBtb3ZlbWVudFkgPSBldmVudC5tb3ZlbWVudFkgfHwgZXZlbnQubW96TW92ZW1lbnRZIHx8IDA7CiAgICB9IGVsc2UgewogICAgICBtb3ZlbWVudFggPSBldmVudC5zY3JlZW5YIC0gcHJldmlvdXNNb3VzZUV2ZW50LnNjcmVlblg7CiAgICAgIG1vdmVtZW50WSA9IGV2ZW50LnNjcmVlblkgLSBwcmV2aW91c01vdXNlRXZlbnQuc2NyZWVuWTsKICAgIH0KICAgIHRoaXMucHJldmlvdXNNb3VzZUV2ZW50ID0gZXZlbnQ7CgogICAgLy8gQ2FsY3VsYXRlIHJvdGF0aW9uLgogICAgZGlyZWN0aW9uID0gdGhpcy5kYXRhLnJldmVyc2VNb3VzZURyYWcgPyAxIDogLTE7CiAgICB5YXdPYmplY3Qucm90YXRpb24ueSArPSBtb3ZlbWVudFggKiAwLjAwMiAqIGRpcmVjdGlvbjsKICAgIHBpdGNoT2JqZWN0LnJvdGF0aW9uLnggKz0gbW92ZW1lbnRZICogMC4wMDIgKiBkaXJlY3Rpb247CiAgICBwaXRjaE9iamVjdC5yb3RhdGlvbi54ID0gTWF0aC5tYXgoLVBJXzIsIE1hdGgubWluKFBJXzIsIHBpdGNoT2JqZWN0LnJvdGF0aW9uLngpKTsKICB9LAoKICAvKioKICAgKiBSZWdpc3RlciBtb3VzZSBkb3duIHRvIGRldGVjdCBtb3VzZSBkcmFnLgogICAqLwogIG9uTW91c2VEb3duOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICBpZiAoIXRoaXMuZGF0YS5lbmFibGVkKSB7IHJldHVybjsgfQogICAgLy8gSGFuZGxlIG9ubHkgcHJpbWFyeSBidXR0b24uCiAgICBpZiAoZXZ0LmJ1dHRvbiAhPT0gMCkgeyByZXR1cm47IH0KCiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIHZhciBjYW52YXNFbCA9IHNjZW5lRWwgJiYgc2NlbmVFbC5jYW52YXM7CgogICAgdGhpcy5tb3VzZURvd24gPSB0cnVlOwogICAgdGhpcy5wcmV2aW91c01vdXNlRXZlbnQgPSBldnQ7CiAgICB0aGlzLnNob3dHcmFiYmluZ0N1cnNvcigpOwoKICAgIGlmICh0aGlzLmRhdGEucG9pbnRlckxvY2tFbmFibGVkICYmICF0aGlzLnBvaW50ZXJMb2NrZWQpIHsKICAgICAgaWYgKGNhbnZhc0VsLnJlcXVlc3RQb2ludGVyTG9jaykgewogICAgICAgIGNhbnZhc0VsLnJlcXVlc3RQb2ludGVyTG9jaygpOwogICAgICB9IGVsc2UgaWYgKGNhbnZhc0VsLm1velJlcXVlc3RQb2ludGVyTG9jaykgewogICAgICAgIGNhbnZhc0VsLm1velJlcXVlc3RQb2ludGVyTG9jaygpOwogICAgICB9CiAgICB9CiAgfSwKCiAgLyoqCiAgICogU2hvd3MgZ3JhYmJpbmcgY3Vyc29yIG9uIHNjZW5lCiAgICovCiAgc2hvd0dyYWJiaW5nQ3Vyc29yOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwuY2FudmFzLnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7CiAgfSwKCiAgLyoqCiAgICogSGlkZXMgZ3JhYmJpbmcgY3Vyc29yIG9uIHNjZW5lCiAgICovCiAgaGlkZUdyYWJiaW5nQ3Vyc29yOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwuY2FudmFzLnN0eWxlLmN1cnNvciA9ICcnOwogIH0sCgogIC8qKgogICAqIFJlZ2lzdGVyIG1vdXNlIHVwIHRvIGRldGVjdCByZWxlYXNlIG9mIG1vdXNlIGRyYWcuCiAgICovCiAgb25Nb3VzZVVwOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm1vdXNlRG93biA9IGZhbHNlOwogICAgdGhpcy5oaWRlR3JhYmJpbmdDdXJzb3IoKTsKICB9LAoKICAvKioKICAgKiBSZWdpc3RlciB0b3VjaCBkb3duIHRvIGRldGVjdCB0b3VjaCBkcmFnLgogICAqLwogIG9uVG91Y2hTdGFydDogZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKGV2dC50b3VjaGVzLmxlbmd0aCAhPT0gMSB8fCAhdGhpcy5kYXRhLnRvdWNoRW5hYmxlZCkgeyByZXR1cm47IH0KICAgIHRoaXMudG91Y2hTdGFydCA9IHsKICAgICAgeDogZXZ0LnRvdWNoZXNbMF0ucGFnZVgsCiAgICAgIHk6IGV2dC50b3VjaGVzWzBdLnBhZ2VZCiAgICB9OwogICAgdGhpcy50b3VjaFN0YXJ0ZWQgPSB0cnVlOwogIH0sCgogIC8qKgogICAqIFRyYW5zbGF0ZSB0b3VjaCBtb3ZlIHRvIFktYXhpcyByb3RhdGlvbi4KICAgKi8KICBvblRvdWNoTW92ZTogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIGRpcmVjdGlvbjsKICAgIHZhciBjYW52YXMgPSB0aGlzLmVsLnNjZW5lRWwuY2FudmFzOwogICAgdmFyIGRlbHRhWTsKICAgIHZhciB5YXdPYmplY3QgPSB0aGlzLnlhd09iamVjdDsKCiAgICBpZiAoIXRoaXMudG91Y2hTdGFydGVkIHx8ICF0aGlzLmRhdGEudG91Y2hFbmFibGVkKSB7IHJldHVybjsgfQoKICAgIGRlbHRhWSA9IDIgKiBNYXRoLlBJICogKGV2dC50b3VjaGVzWzBdLnBhZ2VYIC0gdGhpcy50b3VjaFN0YXJ0LngpIC8gY2FudmFzLmNsaWVudFdpZHRoOwoKICAgIGRpcmVjdGlvbiA9IHRoaXMuZGF0YS5yZXZlcnNlVG91Y2hEcmFnID8gMSA6IC0xOwogICAgLy8gTGltaXQgdG91Y2ggb3JpZW50YWlvbiB0byB0byB5YXcgKHkgYXhpcykuCiAgICB5YXdPYmplY3Qucm90YXRpb24ueSAtPSBkZWx0YVkgKiAwLjUgKiBkaXJlY3Rpb247CiAgICB0aGlzLnRvdWNoU3RhcnQgPSB7CiAgICAgIHg6IGV2dC50b3VjaGVzWzBdLnBhZ2VYLAogICAgICB5OiBldnQudG91Y2hlc1swXS5wYWdlWQogICAgfTsKICB9LAoKICAvKioKICAgKiBSZWdpc3RlciB0b3VjaCBlbmQgdG8gZGV0ZWN0IHJlbGVhc2Ugb2YgdG91Y2ggZHJhZy4KICAgKi8KICBvblRvdWNoRW5kOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnRvdWNoU3RhcnRlZCA9IGZhbHNlOwogIH0sCgogIC8qKgogICAqIFNhdmUgcG9zZS4KICAgKi8KICBvbkVudGVyVlI6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5lbC5zY2VuZUVsLmNoZWNrSGVhZHNldENvbm5lY3RlZCgpKSB7IHJldHVybjsgfQogICAgdGhpcy5zYXZlQ2FtZXJhUG9zZSgpOwogICAgdGhpcy5lbC5vYmplY3QzRC5wb3NpdGlvbi5zZXQoMCwgMCwgMCk7CiAgICB0aGlzLmVsLm9iamVjdDNELnVwZGF0ZU1hdHJpeCgpOwogIH0sCgogIC8qKgogICAqIFJlc3RvcmUgdGhlIHBvc2UuCiAgICovCiAgb25FeGl0VlI6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5lbC5zY2VuZUVsLmNoZWNrSGVhZHNldENvbm5lY3RlZCgpKSB7IHJldHVybjsgfQogICAgdGhpcy5yZXN0b3JlQ2FtZXJhUG9zZSgpOwogICAgdGhpcy5wcmV2aW91c0hNRFBvc2l0aW9uLnNldCgwLCAwLCAwKTsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgUG9pbnRlciBMb2NrIHN0YXRlLgogICAqLwogIG9uUG9pbnRlckxvY2tDaGFuZ2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucG9pbnRlckxvY2tlZCA9ICEhKGRvY3VtZW50LnBvaW50ZXJMb2NrRWxlbWVudCB8fCBkb2N1bWVudC5tb3pQb2ludGVyTG9ja0VsZW1lbnQpOwogIH0sCgogIC8qKgogICAqIFJlY292ZXIgZnJvbSBQb2ludGVyIExvY2sgZXJyb3IuCiAgICovCiAgb25Qb2ludGVyTG9ja0Vycm9yOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnBvaW50ZXJMb2NrZWQgPSBmYWxzZTsKICB9LAoKICAvLyBFeGl0cyBwb2ludGVyLWxvY2tlZCBtb2RlLgogIGV4aXRQb2ludGVyTG9jazogZnVuY3Rpb24gKCkgewogICAgZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrKCk7CiAgICB0aGlzLnBvaW50ZXJMb2NrZWQgPSBmYWxzZTsKICB9LAoKICAvKioKICAgKiBUb2dnbGUgdGhlIGZlYXR1cmUgb2Ygc2hvd2luZy9oaWRpbmcgdGhlIGdyYWIgY3Vyc29yLgogICAqLwogIHVwZGF0ZUdyYWJDdXJzb3I6IGZ1bmN0aW9uIChlbmFibGVkKSB7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKCiAgICBmdW5jdGlvbiBlbmFibGVHcmFiQ3Vyc29yICgpIHsgc2NlbmVFbC5jYW52YXMuY2xhc3NMaXN0LmFkZCgnYS1ncmFiLWN1cnNvcicpOyB9CiAgICBmdW5jdGlvbiBkaXNhYmxlR3JhYkN1cnNvciAoKSB7IHNjZW5lRWwuY2FudmFzLmNsYXNzTGlzdC5yZW1vdmUoJ2EtZ3JhYi1jdXJzb3InKTsgfQoKICAgIGlmICghc2NlbmVFbC5jYW52YXMpIHsKICAgICAgaWYgKGVuYWJsZWQpIHsKICAgICAgICBzY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbmRlci10YXJnZXQtbG9hZGVkJywgZW5hYmxlR3JhYkN1cnNvcik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdyZW5kZXItdGFyZ2V0LWxvYWRlZCcsIGRpc2FibGVHcmFiQ3Vyc29yKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGVuYWJsZWQpIHsKICAgICAgZW5hYmxlR3JhYkN1cnNvcigpOwogICAgICByZXR1cm47CiAgICB9CiAgICBkaXNhYmxlR3JhYkN1cnNvcigpOwogIH0sCgogIC8qKgogICAqIFNhdmUgY2FtZXJhIHBvc2UgYmVmb3JlIGVudGVyaW5nIFZSIHRvIHJlc3RvcmUgbGF0ZXIgaWYgZXhpdGluZy4KICAgKi8KICBzYXZlQ2FtZXJhUG9zZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKCiAgICB0aGlzLnNhdmVkUG9zZS5wb3NpdGlvbi5jb3B5KGVsLm9iamVjdDNELnBvc2l0aW9uKTsKICAgIHRoaXMuc2F2ZWRQb3NlLnJvdGF0aW9uLmNvcHkoZWwub2JqZWN0M0Qucm90YXRpb24pOwogICAgdGhpcy5oYXNTYXZlZFBvc2UgPSB0cnVlOwogIH0sCgogIC8qKgogICAqIFJlc2V0IGNhbWVyYSBwb3NlIHRvIGJlZm9yZSBlbnRlcmluZyBWUi4KICAgKi8KICByZXN0b3JlQ2FtZXJhUG9zZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzYXZlZFBvc2UgPSB0aGlzLnNhdmVkUG9zZTsKCiAgICBpZiAoIXRoaXMuaGFzU2F2ZWRQb3NlKSB7IHJldHVybjsgfQoKICAgIC8vIFJlc2V0IGNhbWVyYSBvcmllbnRhdGlvbi4KICAgIGVsLm9iamVjdDNELnBvc2l0aW9uLmNvcHkoc2F2ZWRQb3NlLnBvc2l0aW9uKTsKICAgIGVsLm9iamVjdDNELnJvdGF0aW9uLmNvcHkoc2F2ZWRQb3NlLnJvdGF0aW9uKTsKICAgIHRoaXMuaGFzU2F2ZWRQb3NlID0gZmFsc2U7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMiOjE3OSwiLi4vdXRpbHMvIjoxNzl9XSw2OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qIGdsb2JhbCBQcm9taXNlICovCnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwp2YXIgY29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciBzaGFkZXIgPSBfZGVyZXFfKCcuLi9jb3JlL3NoYWRlcicpOwoKdmFyIGVycm9yID0gdXRpbHMuZGVidWcoJ2NvbXBvbmVudHM6bWF0ZXJpYWw6ZXJyb3InKTsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gY29tcG9uZW50LnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgc2hhZGVycyA9IHNoYWRlci5zaGFkZXJzOwp2YXIgc2hhZGVyTmFtZXMgPSBzaGFkZXIuc2hhZGVyTmFtZXM7CgovKioKICogTWF0ZXJpYWwgY29tcG9uZW50LgogKgogKiBAbWVtYmVyIHtvYmplY3R9IHNoYWRlciAtIERldGVybWluZXMgaG93IG1hdGVyaWFsIGlzIHNoYWRlZC4gRGVmYXVsdHMgdG8gYHN0YW5kYXJkYCwKICogICAgICAgICB0aHJlZS5qcydzIGltcGxlbWVudGF0aW9uIG9mIFBCUi4gQW5vdGhlciBzdGFuZGFyZCBzaGFkaW5nIG1vZGVsIGlzIGBmbGF0YCB3aGljaAogKiAgICAgICAgIHVzZXMgTWVzaEJhc2ljTWF0ZXJpYWwuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnbWF0ZXJpYWwnLCB7CiAgc2NoZW1hOiB7CiAgICBhbHBoYVRlc3Q6IHtkZWZhdWx0OiAwLjAsIG1pbjogMC4wLCBtYXg6IDEuMH0sCiAgICBkZXB0aFRlc3Q6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGRlcHRoV3JpdGU6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGZsYXRTaGFkaW5nOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgbnBvdDoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIG9mZnNldDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDAsIHk6IDB9fSwKICAgIG9wYWNpdHk6IHtkZWZhdWx0OiAxLjAsIG1pbjogMC4wLCBtYXg6IDEuMH0sCiAgICByZXBlYXQ6IHt0eXBlOiAndmVjMicsIGRlZmF1bHQ6IHt4OiAxLCB5OiAxfX0sCiAgICBzaGFkZXI6IHtkZWZhdWx0OiAnc3RhbmRhcmQnLCBvbmVPZjogc2hhZGVyTmFtZXMsIHNjaGVtYUNoYW5nZTogdHJ1ZX0sCiAgICBzaWRlOiB7ZGVmYXVsdDogJ2Zyb250Jywgb25lT2Y6IFsnZnJvbnQnLCAnYmFjaycsICdkb3VibGUnXX0sCiAgICB0cmFuc3BhcmVudDoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIHZlcnRleENvbG9yczoge3R5cGU6ICdzdHJpbmcnLCBkZWZhdWx0OiAnbm9uZScsIG9uZU9mOiBbJ2ZhY2UnLCAndmVydGV4J119LAogICAgdmlzaWJsZToge2RlZmF1bHQ6IHRydWV9LAogICAgYmxlbmRpbmc6IHtkZWZhdWx0OiAnbm9ybWFsJywgb25lT2Y6IFsnbm9uZScsICdub3JtYWwnLCAnYWRkaXRpdmUnLCAnc3VidHJhY3RpdmUnLCAnbXVsdGlwbHknXX0KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm1hdGVyaWFsID0gbnVsbDsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgb3IgY3JlYXRlIG1hdGVyaWFsLgogICAqCiAgICogQHBhcmFtIHtvYmplY3R8bnVsbH0gb2xkRGF0YQogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgaWYgKCF0aGlzLnNoYWRlciB8fCBkYXRhLnNoYWRlciAhPT0gb2xkRGF0YS5zaGFkZXIpIHsKICAgICAgdGhpcy51cGRhdGVTaGFkZXIoZGF0YS5zaGFkZXIpOwogICAgfQogICAgdGhpcy5zaGFkZXIudXBkYXRlKHRoaXMuZGF0YSk7CiAgICB0aGlzLnVwZGF0ZU1hdGVyaWFsKG9sZERhdGEpOwogIH0sCgogIHVwZGF0ZVNjaGVtYTogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBjdXJyZW50U2hhZGVyOwogICAgdmFyIG5ld1NoYWRlcjsKICAgIHZhciBzY2hlbWE7CiAgICB2YXIgc2hhZGVyOwoKICAgIG5ld1NoYWRlciA9IGRhdGEgJiYgZGF0YS5zaGFkZXI7CiAgICBjdXJyZW50U2hhZGVyID0gdGhpcy5vbGREYXRhICYmIHRoaXMub2xkRGF0YS5zaGFkZXI7CiAgICBzaGFkZXIgPSBuZXdTaGFkZXIgfHwgY3VycmVudFNoYWRlcjsKICAgIHNjaGVtYSA9IHNoYWRlcnNbc2hhZGVyXSAmJiBzaGFkZXJzW3NoYWRlcl0uc2NoZW1hOwoKICAgIGlmICghc2NoZW1hKSB7IGVycm9yKCdVbmtub3duIHNoYWRlciBzY2hlbWEgJyArIHNoYWRlcik7IH0KICAgIGlmIChjdXJyZW50U2hhZGVyICYmIG5ld1NoYWRlciA9PT0gY3VycmVudFNoYWRlcikgeyByZXR1cm47IH0KICAgIHRoaXMuZXh0ZW5kU2NoZW1hKHNjaGVtYSk7CiAgICB0aGlzLnVwZGF0ZUJlaGF2aW9yKCk7CiAgfSwKCiAgdXBkYXRlQmVoYXZpb3I6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBrZXk7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIHZhciBzY2hlbWEgPSB0aGlzLnNjaGVtYTsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciB0aWNrUHJvcGVydGllczsKCiAgICBmdW5jdGlvbiB0aWNrVGltZSAodGltZSwgZGVsdGEpIHsKICAgICAgdmFyIGtleTsKICAgICAgZm9yIChrZXkgaW4gdGlja1Byb3BlcnRpZXMpIHsKICAgICAgICB0aWNrUHJvcGVydGllc1trZXldID0gdGltZTsKICAgICAgfQogICAgICBzZWxmLnNoYWRlci51cGRhdGUodGlja1Byb3BlcnRpZXMpOwogICAgfQoKICAgIHRoaXMudGljayA9IHVuZGVmaW5lZDsKCiAgICB0aWNrUHJvcGVydGllcyA9IHt9OwogICAgZm9yIChrZXkgaW4gc2NoZW1hKSB7CiAgICAgIGlmIChzY2hlbWFba2V5XS50eXBlID09PSAndGltZScpIHsKICAgICAgICB0aGlzLnRpY2sgPSB0aWNrVGltZTsKICAgICAgICB0aWNrUHJvcGVydGllc1trZXldID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGlmICghc2NlbmVFbCkgeyByZXR1cm47IH0KICAgIGlmICh0aGlzLnRpY2spIHsKICAgICAgc2NlbmVFbC5hZGRCZWhhdmlvcih0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgIHNjZW5lRWwucmVtb3ZlQmVoYXZpb3IodGhpcyk7CiAgICB9CiAgfSwKCiAgdXBkYXRlU2hhZGVyOiBmdW5jdGlvbiAoc2hhZGVyTmFtZSkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgU2hhZGVyID0gc2hhZGVyc1tzaGFkZXJOYW1lXSAmJiBzaGFkZXJzW3NoYWRlck5hbWVdLlNoYWRlcjsKICAgIHZhciBzaGFkZXJJbnN0YW5jZTsKCiAgICBpZiAoIVNoYWRlcikgeyB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gc2hhZGVyICcgKyBzaGFkZXJOYW1lKTsgfQoKICAgIC8vIEdldCBtYXRlcmlhbCBmcm9tIEEtRnJhbWUgc2hhZGVyLgogICAgc2hhZGVySW5zdGFuY2UgPSB0aGlzLnNoYWRlciA9IG5ldyBTaGFkZXIoKTsKICAgIHNoYWRlckluc3RhbmNlLmVsID0gdGhpcy5lbDsKICAgIHNoYWRlckluc3RhbmNlLmluaXQoZGF0YSk7CiAgICB0aGlzLnNldE1hdGVyaWFsKHNoYWRlckluc3RhbmNlLm1hdGVyaWFsKTsKICAgIHRoaXMudXBkYXRlU2NoZW1hKGRhdGEpOwogIH0sCgogIC8qKgogICAqIFNldCBhbmQgdXBkYXRlIGJhc2UgbWF0ZXJpYWwgcHJvcGVydGllcy4KICAgKiBTZXQgYG5lZWRzVXBkYXRlYCB3aGVuIG5lZWRlZC4KICAgKi8KICB1cGRhdGVNYXRlcmlhbDogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIHZhciBvbGREYXRhSGFzS2V5czsKCiAgICAvLyBCYXNlIG1hdGVyaWFsIHByb3BlcnRpZXMuCiAgICBtYXRlcmlhbC5hbHBoYVRlc3QgPSBkYXRhLmFscGhhVGVzdDsKICAgIG1hdGVyaWFsLmRlcHRoVGVzdCA9IGRhdGEuZGVwdGhUZXN0ICE9PSBmYWxzZTsKICAgIG1hdGVyaWFsLmRlcHRoV3JpdGUgPSBkYXRhLmRlcHRoV3JpdGUgIT09IGZhbHNlOwogICAgbWF0ZXJpYWwub3BhY2l0eSA9IGRhdGEub3BhY2l0eTsKICAgIG1hdGVyaWFsLmZsYXRTaGFkaW5nID0gZGF0YS5mbGF0U2hhZGluZzsKICAgIG1hdGVyaWFsLnNpZGUgPSBwYXJzZVNpZGUoZGF0YS5zaWRlKTsKICAgIG1hdGVyaWFsLnRyYW5zcGFyZW50ID0gZGF0YS50cmFuc3BhcmVudCAhPT0gZmFsc2UgfHwgZGF0YS5vcGFjaXR5IDwgMS4wOwogICAgbWF0ZXJpYWwudmVydGV4Q29sb3JzID0gcGFyc2VWZXJ0ZXhDb2xvcnMoZGF0YS52ZXJ0ZXhDb2xvcnMpOwogICAgbWF0ZXJpYWwudmlzaWJsZSA9IGRhdGEudmlzaWJsZTsKICAgIG1hdGVyaWFsLmJsZW5kaW5nID0gcGFyc2VCbGVuZGluZyhkYXRhLmJsZW5kaW5nKTsKCiAgICAvLyBDaGVjayBpZiBtYXRlcmlhbCBuZWVkcyB1cGRhdGUuCiAgICBmb3IgKG9sZERhdGFIYXNLZXlzIGluIG9sZERhdGEpIHsgYnJlYWs7IH0KICAgIGlmIChvbGREYXRhSGFzS2V5cyAmJgogICAgICAgIChvbGREYXRhLmFscGhhVGVzdCAhPT0gZGF0YS5hbHBoYVRlc3QgfHwKICAgICAgICAgb2xkRGF0YS5zaWRlICE9PSBkYXRhLnNpZGUgfHwKICAgICAgICAgb2xkRGF0YS52ZXJ0ZXhDb2xvcnMgIT09IGRhdGEudmVydGV4Q29sb3JzKSkgewogICAgICBtYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogUmVtb3ZlIG1hdGVyaWFsIG9uIHJlbW92ZSAoY2FsbGJhY2spLgogICAqIERpc3Bvc2Ugb2YgaXQgZnJvbSBtZW1vcnkgYW5kIHVuc3Vic2NyaWJlIGZyb20gc2NlbmUgdXBkYXRlcy4KICAgKi8KICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkZWZhdWx0TWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoKTsKICAgIHZhciBtYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB2YXIgb2JqZWN0M0QgPSB0aGlzLmVsLmdldE9iamVjdDNEKCdtZXNoJyk7CiAgICBpZiAob2JqZWN0M0QpIHsgb2JqZWN0M0QubWF0ZXJpYWwgPSBkZWZhdWx0TWF0ZXJpYWw7IH0KICAgIGRpc3Bvc2VNYXRlcmlhbChtYXRlcmlhbCwgdGhpcy5zeXN0ZW0pOwogIH0sCgogIC8qKgogICAqIChSZSljcmVhdGUgbmV3IG1hdGVyaWFsLiBIYXMgc2lkZS1lZmZlY3RzIG9mIHNldHRpbmcgYHRoaXMubWF0ZXJpYWxgIGFuZCB1cGRhdGluZwogICAqIG1hdGVyaWFsIHJlZ2lzdHJhdGlvbiBpbiBzY2VuZS4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gTWF0ZXJpYWwgY29tcG9uZW50IGRhdGEuCiAgICogQHBhcmFtIHtvYmplY3R9IHR5cGUgLSBNYXRlcmlhbCB0eXBlIHRvIGNyZWF0ZS4KICAgKiBAcmV0dXJucyB7b2JqZWN0fSBNYXRlcmlhbC4KICAgKi8KICBzZXRNYXRlcmlhbDogZnVuY3Rpb24gKG1hdGVyaWFsKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIG1lc2g7CiAgICB2YXIgc3lzdGVtID0gdGhpcy5zeXN0ZW07CgogICAgaWYgKHRoaXMubWF0ZXJpYWwpIHsgZGlzcG9zZU1hdGVyaWFsKHRoaXMubWF0ZXJpYWwsIHN5c3RlbSk7IH0KCiAgICB0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICBzeXN0ZW0ucmVnaXN0ZXJNYXRlcmlhbChtYXRlcmlhbCk7CgogICAgLy8gU2V0IG9uIG1lc2guIElmIG1lc2ggZG9lcyBub3QgZXhpc3QsIHdhaXQgZm9yIGl0LgogICAgbWVzaCA9IGVsLmdldE9iamVjdDNEKCdtZXNoJyk7CiAgICBpZiAobWVzaCkgewogICAgICBtZXNoLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICB9IGVsc2UgewogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdvYmplY3QzZHNldCcsIGZ1bmN0aW9uIHdhaXRGb3JNZXNoIChldnQpIHsKICAgICAgICBpZiAoZXZ0LmRldGFpbC50eXBlICE9PSAnbWVzaCcgfHwgZXZ0LnRhcmdldCAhPT0gZWwpIHsgcmV0dXJuOyB9CiAgICAgICAgZWwuZ2V0T2JqZWN0M0QoJ21lc2gnKS5tYXRlcmlhbCA9IG1hdGVyaWFsOwogICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29iamVjdDNkc2V0Jywgd2FpdEZvck1lc2gpOwogICAgICB9KTsKICAgIH0KICB9Cn0pOwoKLyoqCiAqIFJldHVybiBhIHRocmVlLmpzIGNvbnN0YW50IGRldGVybWluaW5nIHdoaWNoIG1hdGVyaWFsIGZhY2Ugc2lkZXMgdG8gcmVuZGVyCiAqIGJhc2VkIG9uIHRoZSBzaWRlIHBhcmFtZXRlciAocGFzc2VkIGFzIGEgY29tcG9uZW50IHByb3BlcnR5KS4KICoKICogQHBhcmFtIHtzdHJpbmd9IFtzaWRlPWZyb250XSAtIGBmcm9udGAsIGBiYWNrYCwgb3IgYGRvdWJsZWAuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFRIUkVFLkZyb250U2lkZSwgVEhSRUUuQmFja1NpZGUsIG9yIFRIUkVFLkRvdWJsZVNpZGUuCiAqLwpmdW5jdGlvbiBwYXJzZVNpZGUgKHNpZGUpIHsKICBzd2l0Y2ggKHNpZGUpIHsKICAgIGNhc2UgJ2JhY2snOiB7CiAgICAgIHJldHVybiBUSFJFRS5CYWNrU2lkZTsKICAgIH0KICAgIGNhc2UgJ2RvdWJsZSc6IHsKICAgICAgcmV0dXJuIFRIUkVFLkRvdWJsZVNpZGU7CiAgICB9CiAgICBkZWZhdWx0OiB7CiAgICAgIC8vIEluY2x1ZGluZyBjYXNlIGBmcm9udGAuCiAgICAgIHJldHVybiBUSFJFRS5Gcm9udFNpZGU7CiAgICB9CiAgfQp9CgovKioKICogUmV0dXJuIGEgdGhyZWUuanMgY29uc3RhbnQgZGV0ZXJtaW5pbmcgdmVydGV4IGNvbG9yaW5nLgogKi8KZnVuY3Rpb24gcGFyc2VWZXJ0ZXhDb2xvcnMgKGNvbG9yaW5nKSB7CiAgc3dpdGNoIChjb2xvcmluZykgewogICAgY2FzZSAnZmFjZSc6IHsKICAgICAgcmV0dXJuIFRIUkVFLkZhY2VDb2xvcnM7CiAgICB9CiAgICBjYXNlICd2ZXJ0ZXgnOiB7CiAgICAgIHJldHVybiBUSFJFRS5WZXJ0ZXhDb2xvcnM7CiAgICB9CiAgICBkZWZhdWx0OiB7CiAgICAgIHJldHVybiBUSFJFRS5Ob0NvbG9yczsKICAgIH0KICB9Cn0KCi8qKgogKiBSZXR1cm4gYSB0aHJlZS5qcyBjb25zdGFudCBkZXRlcm1pbmluZyBibGVuZGluZwogKgogKiBAcGFyYW0ge3N0cmluZ30gW2JsZW5kaW5nPW5vcm1hbF0KICogLSBgbm9uZWAsIGFkZGl0aXZlYCwgYHN1YnRyYWN0aXZlYCxgbXVsdGlwbHlgIG9yIGBub3JtYWxgLgogKiBAcmV0dXJucyB7bnVtYmVyfQogKi8KZnVuY3Rpb24gcGFyc2VCbGVuZGluZyAoYmxlbmRpbmcpIHsKICBzd2l0Y2ggKGJsZW5kaW5nKSB7CiAgICBjYXNlICdub25lJzogewogICAgICByZXR1cm4gVEhSRUUuTm9CbGVuZGluZzsKICAgIH0KICAgIGNhc2UgJ2FkZGl0aXZlJzogewogICAgICByZXR1cm4gVEhSRUUuQWRkaXRpdmVCbGVuZGluZzsKICAgIH0KICAgIGNhc2UgJ3N1YnRyYWN0aXZlJzogewogICAgICByZXR1cm4gVEhSRUUuU3VidHJhY3RpdmVCbGVuZGluZzsKICAgIH0KICAgIGNhc2UgJ211bHRpcGx5JzogewogICAgICByZXR1cm4gVEhSRUUuTXVsdGlwbHlCbGVuZGluZzsKICAgIH0KICAgIGRlZmF1bHQ6IHsKICAgICAgcmV0dXJuIFRIUkVFLk5vcm1hbEJsZW5kaW5nOwogICAgfQogIH0KfQoKLyoqCiAqIERpc3Bvc2Ugb2YgbWF0ZXJpYWwgZnJvbSBtZW1vcnkgYW5kIHVuc3Vic2NyaWJlIG1hdGVyaWFsIGZyb20gc2NlbmUgdXBkYXRlcyBsaWtlIGZvZy4KICovCmZ1bmN0aW9uIGRpc3Bvc2VNYXRlcmlhbCAobWF0ZXJpYWwsIHN5c3RlbSkgewogIG1hdGVyaWFsLmRpc3Bvc2UoKTsKICBzeXN0ZW0udW5yZWdpc3Rlck1hdGVyaWFsKG1hdGVyaWFsKTsKfQoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL2NvcmUvc2hhZGVyIjoxMTYsIi4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy8iOjE3OX1dLDcwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGRlYnVnID0gX2RlcmVxXygnLi4vdXRpbHMvZGVidWcnKTsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgd2FybiA9IGRlYnVnKCdjb21wb25lbnRzOm9iai1tb2RlbDp3YXJuJyk7Cgptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnb2JqLW1vZGVsJywgewogIHNjaGVtYTogewogICAgbXRsOiB7dHlwZTogJ21vZGVsJ30sCiAgICBvYmo6IHt0eXBlOiAnbW9kZWwnfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB0aGlzLm1vZGVsID0gbnVsbDsKICAgIHRoaXMub2JqTG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpOwogICAgdGhpcy5tdGxMb2FkZXIgPSBuZXcgVEhSRUUuTVRMTG9hZGVyKHRoaXMub2JqTG9hZGVyLm1hbmFnZXIpOwogICAgLy8gQWxsb3cgY3Jvc3Mtb3JpZ2luIGltYWdlcyB0byBiZSBsb2FkZWQuCiAgICB0aGlzLm10bExvYWRlci5jcm9zc09yaWdpbiA9ICcnOwoKICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9uZW50aW5pdGlhbGl6ZWQnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGlmICghc2VsZi5tb2RlbCkgeyByZXR1cm47IH0KICAgICAgaWYgKGV2dC5kZXRhaWwubmFtZSAhPT0gJ21hdGVyaWFsJykgeyByZXR1cm47IH0KICAgICAgc2VsZi5hcHBseU1hdGVyaWFsKCk7CiAgICB9KTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgaWYgKCFkYXRhLm9iaikgeyByZXR1cm47IH0KICAgIHRoaXMucmVzZXRNZXNoKCk7CiAgICB0aGlzLmxvYWRPYmooZGF0YS5vYmosIGRhdGEubXRsKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5tb2RlbCkgeyByZXR1cm47IH0KICAgIHRoaXMucmVzZXRNZXNoKCk7CiAgfSwKCiAgcmVzZXRNZXNoOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnJlbW92ZU9iamVjdDNEKCdtZXNoJyk7CiAgfSwKCiAgbG9hZE9iajogZnVuY3Rpb24gKG9ialVybCwgbXRsVXJsKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIG10bExvYWRlciA9IHRoaXMubXRsTG9hZGVyOwogICAgdmFyIG9iakxvYWRlciA9IHRoaXMub2JqTG9hZGVyOwogICAgdmFyIHJlbmRlcmVyU3lzdGVtID0gdGhpcy5lbC5zY2VuZUVsLnN5c3RlbXMucmVuZGVyZXI7CiAgICB2YXIgQkFTRV9QQVRIID0gbXRsVXJsLnN1YnN0cigwLCBtdGxVcmwubGFzdEluZGV4T2YoJy8nKSArIDEpOwoKICAgIGlmIChtdGxVcmwpIHsKICAgICAgLy8gLk9CSiB3aXRoIGFuIC5NVEwuCiAgICAgIGlmIChlbC5oYXNBdHRyaWJ1dGUoJ21hdGVyaWFsJykpIHsKICAgICAgICB3YXJuKCdNYXRlcmlhbCBjb21wb25lbnQgcHJvcGVydGllcyBhcmUgaWdub3JlZCB3aGVuIGEgLk1UTCBpcyBwcm92aWRlZCcpOwogICAgICB9CiAgICAgIG10bExvYWRlci5zZXRSZXNvdXJjZVBhdGgoQkFTRV9QQVRIKTsKICAgICAgbXRsTG9hZGVyLmxvYWQobXRsVXJsLCBmdW5jdGlvbiAobWF0ZXJpYWxzKSB7CiAgICAgICAgbWF0ZXJpYWxzLnByZWxvYWQoKTsKICAgICAgICBvYmpMb2FkZXIuc2V0TWF0ZXJpYWxzKG1hdGVyaWFscyk7CiAgICAgICAgb2JqTG9hZGVyLmxvYWQob2JqVXJsLCBmdW5jdGlvbiAob2JqTW9kZWwpIHsKICAgICAgICAgIHNlbGYubW9kZWwgPSBvYmpNb2RlbDsKICAgICAgICAgIHNlbGYubW9kZWwudHJhdmVyc2UoZnVuY3Rpb24gKG9iamVjdCkgewogICAgICAgICAgICBpZiAob2JqZWN0LmlzTWVzaCkgewogICAgICAgICAgICAgIHZhciBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKICAgICAgICAgICAgICBpZiAobWF0ZXJpYWwuY29sb3IpIHJlbmRlcmVyU3lzdGVtLmFwcGx5Q29sb3JDb3JyZWN0aW9uKG1hdGVyaWFsLmNvbG9yKTsKICAgICAgICAgICAgICBpZiAobWF0ZXJpYWwubWFwKSByZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbihtYXRlcmlhbC5tYXApOwogICAgICAgICAgICAgIGlmIChtYXRlcmlhbC5lbWlzc2l2ZSkgcmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24obWF0ZXJpYWwuZW1pc3NpdmUpOwogICAgICAgICAgICAgIGlmIChtYXRlcmlhbC5lbWlzc2l2ZU1hcCkgcmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24obWF0ZXJpYWwuZW1pc3NpdmVNYXApOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGVsLnNldE9iamVjdDNEKCdtZXNoJywgb2JqTW9kZWwpOwogICAgICAgICAgZWwuZW1pdCgnbW9kZWwtbG9hZGVkJywge2Zvcm1hdDogJ29iaicsIG1vZGVsOiBvYmpNb2RlbH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIC5PQkogb25seS4KICAgIG9iakxvYWRlci5sb2FkKG9ialVybCwgZnVuY3Rpb24gbG9hZE9iak9ubHkgKG9iak1vZGVsKSB7CiAgICAgIHNlbGYubW9kZWwgPSBvYmpNb2RlbDsKICAgICAgc2VsZi5hcHBseU1hdGVyaWFsKCk7CiAgICAgIGVsLnNldE9iamVjdDNEKCdtZXNoJywgb2JqTW9kZWwpOwogICAgICBlbC5lbWl0KCdtb2RlbC1sb2FkZWQnLCB7Zm9ybWF0OiAnb2JqJywgbW9kZWw6IG9iak1vZGVsfSk7CiAgICB9KTsKICB9LAoKICAvKioKICAgKiBBcHBseSBtYXRlcmlhbCBmcm9tIG1hdGVyaWFsIGNvbXBvbmVudCByZWN1cnNpdmVseS4KICAgKi8KICBhcHBseU1hdGVyaWFsOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbWF0ZXJpYWwgPSB0aGlzLmVsLmNvbXBvbmVudHMubWF0ZXJpYWw7CiAgICBpZiAoIW1hdGVyaWFsKSB7IHJldHVybjsgfQogICAgdGhpcy5tb2RlbC50cmF2ZXJzZShmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEhSRUUuTWVzaCkgewogICAgICAgIGNoaWxkLm1hdGVyaWFsID0gbWF0ZXJpYWwubWF0ZXJpYWw7CiAgICAgIH0KICAgIH0pOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzL2RlYnVnIjoxNzV9XSw3MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciBiaW5kID0gX2RlcmVxXygnLi4vdXRpbHMvYmluZCcpOwoKdmFyIHRyYWNrZWRDb250cm9sc1V0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scycpOwp2YXIgY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwID0gdHJhY2tlZENvbnRyb2xzVXRpbHMuY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwOwp2YXIgZW1pdElmQXhlc0NoYW5nZWQgPSB0cmFja2VkQ29udHJvbHNVdGlscy5lbWl0SWZBeGVzQ2hhbmdlZDsKdmFyIG9uQnV0dG9uRXZlbnQgPSB0cmFja2VkQ29udHJvbHNVdGlscy5vbkJ1dHRvbkV2ZW50OwoKdmFyIEdBTUVQQURfSURfUFJFRklYID0gJ09jdWx1cyBHbyc7Cgp2YXIgT0NVTFVTX0dPX0NPTlRST0xMRVJfTU9ERUxfVVJMID0gJ2h0dHBzOi8vY2RuLmFmcmFtZS5pby9jb250cm9sbGVycy9vY3VsdXMvZ28vb2N1bHVzLWdvLWNvbnRyb2xsZXIuZ2x0Zic7CgovKioKICogT2N1bHVzIEdvIGNvbnRyb2xzLgogKiBJbnRlcmZhY2Ugd2l0aCBPY3VsdXMgR28gY29udHJvbGxlciBhbmQgbWFwIEdhbWVwYWQgZXZlbnRzIHRvCiAqIGNvbnRyb2xsZXIgYnV0dG9uczogdHJhY2twYWQsIHRyaWdnZXIKICogTG9hZCBhIGNvbnRyb2xsZXIgbW9kZWwgYW5kIGhpZ2hsaWdodCB0aGUgcHJlc3NlZCBidXR0b25zLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ29jdWx1cy1nby1jb250cm9scycsIHsKICBzY2hlbWE6IHsKICAgIGhhbmQ6IHtkZWZhdWx0OiAnJ30sICAvLyBUaGlzIGluZm9ybXMgdGhlIGRlZ2VuZXJhdGUgYXJtIG1vZGVsLgogICAgYnV0dG9uQ29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnI0ZGRkZGRid9LAogICAgYnV0dG9uVG91Y2hlZENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyNCQkJCQkInfSwKICAgIGJ1dHRvbkhpZ2hsaWdodENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyM3QTdBN0EnfSwKICAgIG1vZGVsOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBvcmllbnRhdGlvbk9mZnNldDoge3R5cGU6ICd2ZWMzJ30sCiAgICBhcm1Nb2RlbDoge2RlZmF1bHQ6IHRydWV9CiAgfSwKCiAgLyoqCiAgICogQnV0dG9uIElEczoKICAgKiAwIC0gdHJhY2twYWQKICAgKiAxIC0gdHJpZ2dlcgogICAqLwogIG1hcHBpbmc6IHsKICAgIGF4ZXM6IHt0cmFja3BhZDogWzAsIDFdfSwKICAgIGJ1dHRvbnM6IFsndHJhY2twYWQnLCAndHJpZ2dlciddCiAgfSwKCiAgYmluZE1ldGhvZHM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub25Nb2RlbExvYWRlZCA9IGJpbmQodGhpcy5vbk1vZGVsTG9hZGVkLCB0aGlzKTsKICAgIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSA9IGJpbmQodGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCB0aGlzKTsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50ID0gYmluZCh0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCwgdGhpcyk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIgPSBiaW5kKHRoaXMucmVtb3ZlQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lciwgdGhpcyk7CiAgICB0aGlzLm9uQXhpc01vdmVkID0gYmluZCh0aGlzLm9uQXhpc01vdmVkLCB0aGlzKTsKICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLm9uQnV0dG9uQ2hhbmdlZCA9IGJpbmQodGhpcy5vbkJ1dHRvbkNoYW5nZWQsIHRoaXMpOwogICAgdGhpcy5vbkJ1dHRvbkRvd24gPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ2Rvd24nLCBzZWxmKTsgfTsKICAgIHRoaXMub25CdXR0b25VcCA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAndXAnLCBzZWxmKTsgfTsKICAgIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaHN0YXJ0Jywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hFbmQgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3RvdWNoZW5kJywgc2VsZik7IH07CiAgICB0aGlzLmNvbnRyb2xsZXJQcmVzZW50ID0gZmFsc2U7CiAgICB0aGlzLmxhc3RDb250cm9sbGVyQ2hlY2sgPSAwOwogICAgdGhpcy5yZW5kZXJlclN5c3RlbSA9IHRoaXMuZWwuc2NlbmVFbC5zeXN0ZW1zLnJlbmRlcmVyOwogICAgdGhpcy5iaW5kTWV0aG9kcygpOwogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uQnV0dG9uVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICB0aGlzLmNvbnRyb2xsZXJFdmVudHNBY3RpdmUgPSB0cnVlOwogIH0sCgogIHJlbW92ZUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uQnV0dG9uVG91Y2hFbmQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICB0aGlzLmNvbnRyb2xsZXJFdmVudHNBY3RpdmUgPSBmYWxzZTsKICB9LAoKICBjaGVja0lmQ29udHJvbGxlclByZXNlbnQ6IGZ1bmN0aW9uICgpIHsKICAgIGNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cCh0aGlzLCBHQU1FUEFEX0lEX1BSRUZJWCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5oYW5kID8ge2hhbmQ6IHRoaXMuZGF0YS5oYW5kfSA6IHt9KTsKICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCgpOwogICAgdGhpcy5hZGRDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyKCk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICAgIHRoaXMucmVtb3ZlQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcigpOwogIH0sCgogIGluamVjdFRyYWNrZWRDb250cm9sczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgZWwuc2V0QXR0cmlidXRlKCd0cmFja2VkLWNvbnRyb2xzJywgewogICAgICBhcm1Nb2RlbDogZGF0YS5hcm1Nb2RlbCwKICAgICAgaWRQcmVmaXg6IEdBTUVQQURfSURfUFJFRklYLAogICAgICBvcmllbnRhdGlvbk9mZnNldDogZGF0YS5vcmllbnRhdGlvbk9mZnNldAogICAgfSk7CiAgICBpZiAoIXRoaXMuZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdnbHRmLW1vZGVsJywgT0NVTFVTX0dPX0NPTlRST0xMRVJfTU9ERUxfVVJMKTsKICB9LAoKICBhZGRDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCBmYWxzZSk7CiAgfSwKCiAgcmVtb3ZlQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbC5zY2VuZUVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJzdXBkYXRlZCcsIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSwgZmFsc2UpOwogIH0sCgogIG9uQ29udHJvbGxlcnNVcGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50KCk7CiAgfSwKCiAgLy8gTm8gbmVlZCBmb3Igb25CdXR0b25DaGFuZ2VkLCBzaW5jZSBPY3VsdXMgR28gY29udHJvbGxlciBoYXMgbm8gYW5hbG9nIGJ1dHRvbnMuCgogIG9uTW9kZWxMb2FkZWQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBjb250cm9sbGVyT2JqZWN0M0QgPSBldnQuZGV0YWlsLm1vZGVsOwogICAgdmFyIGJ1dHRvbk1lc2hlczsKCiAgICBpZiAoIXRoaXMuZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzID0ge307CiAgICBidXR0b25NZXNoZXMudHJpZ2dlciA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ29jdWx1c19nb19idXR0b25fdHJpZ2dlcicpOwogICAgYnV0dG9uTWVzaGVzLnRyYWNrcGFkID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnb2N1bHVzX2dvX3RvdWNocGFkJyk7CiAgfSwKCiAgb25CdXR0b25DaGFuZ2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgYnV0dG9uID0gdGhpcy5tYXBwaW5nLmJ1dHRvbnNbZXZ0LmRldGFpbC5pZF07CiAgICBpZiAoIWJ1dHRvbikgcmV0dXJuOwogICAgLy8gUGFzcyBhbG9uZyBjaGFuZ2VkIGV2ZW50IHdpdGggYnV0dG9uIHN0YXRlLCB1c2luZyBidXR0b24gbWFwcGluZyBmb3IgY29udmVuaWVuY2UuCiAgICB0aGlzLmVsLmVtaXQoYnV0dG9uICsgJ2NoYW5nZWQnLCBldnQuZGV0YWlsLnN0YXRlKTsKICB9LAoKICBvbkF4aXNNb3ZlZDogZnVuY3Rpb24gKGV2dCkgewogICAgZW1pdElmQXhlc0NoYW5nZWQodGhpcywgdGhpcy5tYXBwaW5nLmF4ZXMsIGV2dCk7CiAgfSwKCiAgdXBkYXRlTW9kZWw6IGZ1bmN0aW9uIChidXR0b25OYW1lLCBldnROYW1lKSB7CiAgICBpZiAoIXRoaXMuZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIHRoaXMudXBkYXRlQnV0dG9uTW9kZWwoYnV0dG9uTmFtZSwgZXZ0TmFtZSk7CiAgfSwKCiAgdXBkYXRlQnV0dG9uTW9kZWw6IGZ1bmN0aW9uIChidXR0b25OYW1lLCBzdGF0ZSkgewogICAgdmFyIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzOwogICAgaWYgKCFidXR0b25NZXNoZXMgfHwgIWJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXSkgeyByZXR1cm47IH0KICAgIHZhciBjb2xvcjsKICAgIHZhciBidXR0b247CiAgICBzd2l0Y2ggKHN0YXRlKSB7CiAgICAgIGNhc2UgJ2Rvd24nOgogICAgICAgIGNvbG9yID0gdGhpcy5kYXRhLmJ1dHRvbkhpZ2hsaWdodENvbG9yOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICd0b3VjaHN0YXJ0JzoKICAgICAgICBjb2xvciA9IHRoaXMuZGF0YS5idXR0b25Ub3VjaGVkQ29sb3I7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29sb3IgPSB0aGlzLmRhdGEuYnV0dG9uQ29sb3I7CiAgICB9CiAgICBidXR0b24gPSBidXR0b25NZXNoZXNbYnV0dG9uTmFtZV07CiAgICBidXR0b24ubWF0ZXJpYWwuY29sb3Iuc2V0KGNvbG9yKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24oYnV0dG9uLm1hdGVyaWFsLmNvbG9yKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL3V0aWxzL2JpbmQiOjE3MywiLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scyI6MTg3fV0sNzI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgYmluZCA9IF9kZXJlcV8oJy4uL3V0aWxzL2JpbmQnKTsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgdHJhY2tlZENvbnRyb2xzVXRpbHMgPSBfZGVyZXFfKCcuLi91dGlscy90cmFja2VkLWNvbnRyb2xzJyk7CnZhciBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAgPSB0cmFja2VkQ29udHJvbHNVdGlscy5jaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXA7CnZhciBlbWl0SWZBeGVzQ2hhbmdlZCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLmVtaXRJZkF4ZXNDaGFuZ2VkOwp2YXIgb25CdXR0b25FdmVudCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLm9uQnV0dG9uRXZlbnQ7Cgp2YXIgVE9VQ0hfQ09OVFJPTExFUl9NT0RFTF9CQVNFX1VSTCA9ICdodHRwczovL2Nkbi5hZnJhbWUuaW8vY29udHJvbGxlcnMvb2N1bHVzL29jdWx1cy10b3VjaC1jb250cm9sbGVyLSc7CnZhciBUT1VDSF9DT05UUk9MTEVSX01PREVMX1VSTCA9IHsKICBsZWZ0OiBUT1VDSF9DT05UUk9MTEVSX01PREVMX0JBU0VfVVJMICsgJ2xlZnQuZ2x0ZicsCiAgcmlnaHQ6IFRPVUNIX0NPTlRST0xMRVJfTU9ERUxfQkFTRV9VUkwgKyAncmlnaHQuZ2x0ZicKfTsKCnZhciBHQU1FUEFEX0lEX1BSRUZJWCA9ICdPY3VsdXMgVG91Y2gnOwoKdmFyIERFRkFVTFRfTU9ERUxfUElWT1RfT0ZGU0VUID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgLTAuMDUzKTsKdmFyIFJBWV9PUklHSU4gPSB7CiAgbGVmdDoge29yaWdpbjoge3g6IDAuMDA4LCB5OiAtMC4wMDQsIHo6IDB9LCBkaXJlY3Rpb246IHt4OiAwLCB5OiAtMC44LCB6OiAtMX19LAogIHJpZ2h0OiB7b3JpZ2luOiB7eDogLTAuMDA4LCB5OiAtMC4wMDQsIHo6IDB9LCBkaXJlY3Rpb246IHt4OiAwLCB5OiAtMC44LCB6OiAtMX19Cn07CgovKioKICogT2N1bHVzIFRvdWNoIGNvbnRyb2xzLgogKiBJbnRlcmZhY2Ugd2l0aCBPY3VsdXMgVG91Y2ggY29udHJvbGxlcnMgYW5kIG1hcCBHYW1lcGFkIGV2ZW50cyB0bwogKiBjb250cm9sbGVyIGJ1dHRvbnM6IHRodW1ic3RpY2ssIHRyaWdnZXIsIGdyaXAsIHhidXR0b24sIHlidXR0b24sIHN1cmZhY2UKICogTG9hZCBhIGNvbnRyb2xsZXIgbW9kZWwgYW5kIGhpZ2hsaWdodCB0aGUgcHJlc3NlZCBidXR0b25zLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ29jdWx1cy10b3VjaC1jb250cm9scycsIHsKICBzY2hlbWE6IHsKICAgIGhhbmQ6IHtkZWZhdWx0OiAnbGVmdCd9LAogICAgYnV0dG9uQ29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnIzk5OSd9LCAgLy8gT2ZmLXdoaXRlLgogICAgYnV0dG9uVG91Y2hDb2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjOEFCJ30sCiAgICBidXR0b25IaWdobGlnaHRDb2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjMkRGJ30sICAvLyBMaWdodCBibHVlLgogICAgbW9kZWw6IHtkZWZhdWx0OiB0cnVlfSwKICAgIG9yaWVudGF0aW9uT2Zmc2V0OiB7dHlwZTogJ3ZlYzMnLCBkZWZhdWx0OiB7eDogNDMsIHk6IDAsIHo6IDB9fQogIH0sCgogIC8qKgogICAqIEJ1dHRvbiBJRHM6CiAgICogMCAtIHRodW1ic3RpY2sgKHdoaWNoIGhhcyBzZXBhcmF0ZSBheGlzbW92ZSAvIHRodW1ic3RpY2ttb3ZlZCBldmVudHMpCiAgICogMSAtIHRyaWdnZXIgKHdpdGggYW5hbG9nIHZhbHVlLCB3aGljaCBnb2VzIHVwIHRvIDEpCiAgICogMiAtIGdyaXAgKHdpdGggYW5hbG9nIHZhbHVlLCB3aGljaCBnb2VzIHVwIHRvIDEpCiAgICogMyAtIFggKGxlZnQpIG9yIEEgKHJpZ2h0KQogICAqIDQgLSBZIChsZWZ0KSBvciBCIChyaWdodCkKICAgKiA1IC0gc3VyZmFjZSAodG91Y2ggb25seSkKICAgKi8KICBtYXBwaW5nOiB7CiAgICBsZWZ0OiB7CiAgICAgIGF4ZXM6IHt0aHVtYnN0aWNrOiBbMCwgMV19LAogICAgICBidXR0b25zOiBbJ3RodW1ic3RpY2snLCAndHJpZ2dlcicsICdncmlwJywgJ3hidXR0b24nLCAneWJ1dHRvbicsICdzdXJmYWNlJ10KICAgIH0sCiAgICByaWdodDogewogICAgICBheGVzOiB7dGh1bWJzdGljazogWzAsIDFdfSwKICAgICAgYnV0dG9uczogWyd0aHVtYnN0aWNrJywgJ3RyaWdnZXInLCAnZ3JpcCcsICdhYnV0dG9uJywgJ2JidXR0b24nLCAnc3VyZmFjZSddCiAgICB9CiAgfSwKCiAgYmluZE1ldGhvZHM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub25Nb2RlbExvYWRlZCA9IGJpbmQodGhpcy5vbk1vZGVsTG9hZGVkLCB0aGlzKTsKICAgIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSA9IGJpbmQodGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCB0aGlzKTsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50ID0gYmluZCh0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCwgdGhpcyk7CiAgICB0aGlzLm9uQXhpc01vdmVkID0gYmluZCh0aGlzLm9uQXhpc01vdmVkLCB0aGlzKTsKICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLm9uQnV0dG9uQ2hhbmdlZCA9IGJpbmQodGhpcy5vbkJ1dHRvbkNoYW5nZWQsIHRoaXMpOwogICAgdGhpcy5vbkJ1dHRvbkRvd24gPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ2Rvd24nLCBzZWxmLCBzZWxmLmRhdGEuaGFuZCk7IH07CiAgICB0aGlzLm9uQnV0dG9uVXAgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3VwJywgc2VsZiwgc2VsZi5kYXRhLmhhbmQpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3RvdWNoc3RhcnQnLCBzZWxmLCBzZWxmLmRhdGEuaGFuZCk7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hFbmQgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3RvdWNoZW5kJywgc2VsZiwgc2VsZi5kYXRhLmhhbmQpOyB9OwogICAgdGhpcy5jb250cm9sbGVyUHJlc2VudCA9IGZhbHNlOwogICAgdGhpcy5sYXN0Q29udHJvbGxlckNoZWNrID0gMDsKICAgIHRoaXMucHJldmlvdXNCdXR0b25WYWx1ZXMgPSB7fTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0gPSB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5yZW5kZXJlcjsKICAgIHRoaXMuYmluZE1ldGhvZHMoKTsKICB9LAoKICBhZGRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdtb2RlbC1sb2FkZWQnLCB0aGlzLm9uTW9kZWxMb2FkZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gdHJ1ZTsKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLm9uQnV0dG9uQ2hhbmdlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b25kb3duJywgdGhpcy5vbkJ1dHRvbkRvd24pOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9udXAnLCB0aGlzLm9uQnV0dG9uVXApOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0KTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vbkJ1dHRvblRvdWNoRW5kKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb2RlbC1sb2FkZWQnLCB0aGlzLm9uTW9kZWxMb2FkZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gZmFsc2U7CiAgfSwKCiAgY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50OiBmdW5jdGlvbiAoKSB7CiAgICBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAodGhpcywgR0FNRVBBRF9JRF9QUkVGSVgsIHsKICAgICAgaGFuZDogdGhpcy5kYXRhLmhhbmQKICAgIH0pOwogIH0sCgogIHBsYXk6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50KCk7CiAgICB0aGlzLmFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICBwYXVzZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVycygpOwogICAgdGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyKCk7CiAgfSwKCiAgbG9hZE1vZGVsOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGlmICghZGF0YS5tb2RlbCkgeyByZXR1cm47IH0KICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdnbHRmLW1vZGVsJywgJ3VybCgnICsgVE9VQ0hfQ09OVFJPTExFUl9NT0RFTF9VUkxbZGF0YS5oYW5kXSArICcpJyk7CiAgfSwKCiAgaW5qZWN0VHJhY2tlZENvbnRyb2xzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCd0cmFja2VkLWNvbnRyb2xzJywgewogICAgICBpZDogZGF0YS5oYW5kID09PSAncmlnaHQnID8gJ09jdWx1cyBUb3VjaCAoUmlnaHQpJyA6ICdPY3VsdXMgVG91Y2ggKExlZnQpJywKICAgICAgY29udHJvbGxlcjogMCwKICAgICAgaGFuZDogZGF0YS5oYW5kLAogICAgICBvcmllbnRhdGlvbk9mZnNldDogZGF0YS5vcmllbnRhdGlvbk9mZnNldAogICAgfSk7CiAgICB0aGlzLmxvYWRNb2RlbCgpOwogIH0sCgogIGFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICByZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCBmYWxzZSk7CiAgfSwKCiAgb25Db250cm9sbGVyc1VwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgLy8gTm90ZSB0aGF0IGR1ZSB0byBnYW1lcGFkY29ubmVjdGVkIGV2ZW50IHByb3BhZ2F0aW9uIGlzc3Vlcywgd2UgZG9uJ3QgcmVseSBvbiBldmVudHMuCiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCgpOwogIH0sCgogIG9uQnV0dG9uQ2hhbmdlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIGJ1dHRvbiA9IHRoaXMubWFwcGluZ1t0aGlzLmRhdGEuaGFuZF0uYnV0dG9uc1tldnQuZGV0YWlsLmlkXTsKICAgIHZhciBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlczsKICAgIHZhciBhbmFsb2dWYWx1ZTsKCiAgICBpZiAoIWJ1dHRvbikgeyByZXR1cm47IH0KCiAgICBpZiAoYnV0dG9uID09PSAndHJpZ2dlcicgfHwgYnV0dG9uID09PSAnZ3JpcCcpIHsgYW5hbG9nVmFsdWUgPSBldnQuZGV0YWlsLnN0YXRlLnZhbHVlOyB9CgogICAgLy8gVXBkYXRlIHRyaWdnZXIgYW5kL29yIGdyaXAgbWVzaGVzLCBpZiBhbnkuCiAgICBpZiAoYnV0dG9uTWVzaGVzKSB7CiAgICAgIGlmIChidXR0b24gPT09ICd0cmlnZ2VyJyAmJiBidXR0b25NZXNoZXMudHJpZ2dlcikgewogICAgICAgIGJ1dHRvbk1lc2hlcy50cmlnZ2VyLnJvdGF0aW9uLnggPSB0aGlzLm9yaWdpbmFsWFJvdGF0aW9uVHJpZ2dlciAtIGFuYWxvZ1ZhbHVlICogKE1hdGguUEkgLyAyNik7CiAgICAgIH0KICAgICAgaWYgKGJ1dHRvbiA9PT0gJ2dyaXAnICYmIGJ1dHRvbk1lc2hlcy5ncmlwKSB7CiAgICAgICAgYnV0dG9uTWVzaGVzLmdyaXAucG9zaXRpb24ueCA9IHRoaXMub3JpZ2luYWxYUG9zaXRpb25HcmlwICsgKHRoaXMuZGF0YS5oYW5kID09PSAnbGVmdCcgPyAtMSA6IDEpICogYW5hbG9nVmFsdWUgKiAwLjAwNDsKICAgICAgfQogICAgfQoKICAgIC8vIFBhc3MgYWxvbmcgY2hhbmdlZCBldmVudCB3aXRoIGJ1dHRvbiBzdGF0ZSwgdXNpbmcgdGhlIGJ1dHRvbSBtYXBwaW5nIGZvciBjb252ZW5pZW5jZS4KICAgIHRoaXMuZWwuZW1pdChidXR0b24gKyAnY2hhbmdlZCcsIGV2dC5kZXRhaWwuc3RhdGUpOwogIH0sCgogIG9uTW9kZWxMb2FkZWQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBjb250cm9sbGVyT2JqZWN0M0QgPSBldnQuZGV0YWlsLm1vZGVsOwogICAgdmFyIGJ1dHRvbk1lc2hlczsKICAgIGlmICghdGhpcy5kYXRhLm1vZGVsKSB7IHJldHVybjsgfQoKICAgIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzID0ge307CgogICAgYnV0dG9uTWVzaGVzLmdyaXAgPSBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdidXR0b25IYW5kJyk7CiAgICB0aGlzLm9yaWdpbmFsWFBvc2l0aW9uR3JpcCA9IGJ1dHRvbk1lc2hlcy5ncmlwLnBvc2l0aW9uLng7CiAgICBidXR0b25NZXNoZXMudGh1bWJzdGljayA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ3N0aWNrJyk7CiAgICBidXR0b25NZXNoZXMudHJpZ2dlciA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ2J1dHRvblRyaWdnZXInKTsKICAgIHRoaXMub3JpZ2luYWxYUm90YXRpb25UcmlnZ2VyID0gYnV0dG9uTWVzaGVzLnRyaWdnZXIucm90YXRpb24ueDsKICAgIGJ1dHRvbk1lc2hlcy54YnV0dG9uID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnYnV0dG9uWCcpOwogICAgYnV0dG9uTWVzaGVzLmFidXR0b24gPSBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdidXR0b25BJyk7CiAgICBidXR0b25NZXNoZXMueWJ1dHRvbiA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ2J1dHRvblknKTsKICAgIGJ1dHRvbk1lc2hlcy5iYnV0dG9uID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnYnV0dG9uQicpOwoKICAgIC8vIE9mZnNldCBwaXZvdCBwb2ludAogICAgY29udHJvbGxlck9iamVjdDNELnBvc2l0aW9uLmNvcHkoREVGQVVMVF9NT0RFTF9QSVZPVF9PRkZTRVQpOwoKICAgIHRoaXMuZWwuZW1pdCgnY29udHJvbGxlcm1vZGVscmVhZHknLCB7CiAgICAgIG5hbWU6ICdvY3VsdXMtdG91Y2gtY29udHJvbHMnLAogICAgICBtb2RlbDogdGhpcy5kYXRhLm1vZGVsLAogICAgICByYXlPcmlnaW46IFJBWV9PUklHSU5bdGhpcy5kYXRhLmhhbmRdCiAgICB9KTsKICB9LAoKICBvbkF4aXNNb3ZlZDogZnVuY3Rpb24gKGV2dCkgewogICAgZW1pdElmQXhlc0NoYW5nZWQodGhpcywgdGhpcy5tYXBwaW5nW3RoaXMuZGF0YS5oYW5kXS5heGVzLCBldnQpOwogIH0sCgogIHVwZGF0ZU1vZGVsOiBmdW5jdGlvbiAoYnV0dG9uTmFtZSwgZXZ0TmFtZSkgewogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICB0aGlzLnVwZGF0ZUJ1dHRvbk1vZGVsKGJ1dHRvbk5hbWUsIGV2dE5hbWUpOwogIH0sCgogIHVwZGF0ZUJ1dHRvbk1vZGVsOiBmdW5jdGlvbiAoYnV0dG9uTmFtZSwgc3RhdGUpIHsKICAgIHZhciBidXR0b247CiAgICB2YXIgY29sb3IgPSAoc3RhdGUgPT09ICd1cCcgfHwgc3RhdGUgPT09ICd0b3VjaGVuZCcpID8gdGhpcy5kYXRhLmJ1dHRvbkNvbG9yIDogc3RhdGUgPT09ICd0b3VjaHN0YXJ0JyA/IHRoaXMuZGF0YS5idXR0b25Ub3VjaENvbG9yIDogdGhpcy5kYXRhLmJ1dHRvbkhpZ2hsaWdodENvbG9yOwogICAgdmFyIGJ1dHRvbk1lc2hlcyA9IHRoaXMuYnV0dG9uTWVzaGVzOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICBpZiAoYnV0dG9uTWVzaGVzICYmIGJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXSkgewogICAgICBidXR0b24gPSBidXR0b25NZXNoZXNbYnV0dG9uTmFtZV07CiAgICAgIGJ1dHRvbi5tYXRlcmlhbC5jb2xvci5zZXQoY29sb3IpOwogICAgICB0aGlzLnJlbmRlcmVyU3lzdGVtLmFwcGx5Q29sb3JDb3JyZWN0aW9uKGJ1dHRvbi5tYXRlcmlhbC5jb2xvcik7CiAgICB9CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMvYmluZCI6MTczLCIuLi91dGlscy90cmFja2VkLWNvbnRyb2xzIjoxODd9XSw3MzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7Cgptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgncG9zaXRpb24nLCB7CiAgc2NoZW1hOiB7dHlwZTogJ3ZlYzMnfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgb2JqZWN0M0QgPSB0aGlzLmVsLm9iamVjdDNEOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICBvYmplY3QzRC5wb3NpdGlvbi5zZXQoZGF0YS54LCBkYXRhLnksIGRhdGEueik7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICAvLyBQcmV0dHkgbXVjaCBmb3IgbWl4aW5zLgogICAgdGhpcy5lbC5vYmplY3QzRC5wb3NpdGlvbi5zZXQoMCwgMCwgMCk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sNzQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgTXV0YXRpb25PYnNlcnZlciAqLwoKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwoKdmFyIHdhcm4gPSB1dGlscy5kZWJ1ZygnY29tcG9uZW50czpyYXljYXN0ZXI6d2FybicpOwoKLy8gRGVmaW5lcyBzZWxlY3RvcnMgdGhhdCBzaG91bGQgYmUgJ3NhZmUnIGZvciB0aGUgTXV0YXRpb25PYnNlcnZlciB1c2VkIHRvCi8vIHJlZnJlc2ggdGhlIHdoaXRlbGlzdC4gTWF0Y2hlcyBjbGFzc25hbWVzLCBJRHMsIGFuZCBwcmVzZW5jZSBvZiBhdHRyaWJ1dGVzLgovLyBTZWxlY3RvcnMgZm9yIHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIGxpa2UgW3Bvc2l0aW9uPTAgMiAwXSwgY2Fubm90IGJlCi8vIHJlbGlhYmx5IGRldGVjdGVkIGFuZCBhcmUgdGhlcmVmb3JlIGRpc2FsbG93ZWQuCnZhciBPQlNFUlZFUl9TRUxFQ1RPUl9SRSA9IC9eW1x3XHMtLixbXF0jXSokLzsKCi8vIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBNdXRhdGlvbk9ic2VydmVyIHVzZWQgdG8gcmVmcmVzaCB0aGUgd2hpdGVsaXN0LgovLyBMaXN0ZW5zIGZvciBhZGRpdGlvbi9yZW1vdmFsIG9mIGVsZW1lbnRzIGFuZCBhdHRyaWJ1dGVzIHdpdGhpbiB0aGUgc2NlbmUuCnZhciBPQlNFUlZFUl9DT05GSUcgPSB7CiAgY2hpbGRMaXN0OiB0cnVlLAogIGF0dHJpYnV0ZXM6IHRydWUsCiAgc3VidHJlZTogdHJ1ZQp9OwoKdmFyIEVWRU5UUyA9IHsKICBJTlRFUlNFQ1Q6ICdyYXljYXN0ZXItaW50ZXJzZWN0ZWQnLAogIElOVEVSU0VDVElPTjogJ3JheWNhc3Rlci1pbnRlcnNlY3Rpb24nLAogIElOVEVSU0VDVF9DTEVBUjogJ3JheWNhc3Rlci1pbnRlcnNlY3RlZC1jbGVhcmVkJywKICBJTlRFUlNFQ1RJT05fQ0xFQVI6ICdyYXljYXN0ZXItaW50ZXJzZWN0aW9uLWNsZWFyZWQnCn07CgovKioKICogUmF5Y2FzdGVyIGNvbXBvbmVudC4KICoKICogUGFzcyBvcHRpb25zIHRvIHRocmVlLmpzIFJheWNhc3RlciBpbmNsdWRpbmcgd2hpY2ggb2JqZWN0cyB0byB0ZXN0LgogKiBQb2xsIGZvciBpbnRlcnNlY3Rpb25zLgogKiBFbWl0IGV2ZW50IG9uIG9yaWdpbiBlbnRpdHkgYW5kIG9uIHRhcmdldCBlbnRpdHkgb24gaW50ZXJzZWN0LgogKgogKiBAbWVtYmVyIHthcnJheX0gaW50ZXJzZWN0ZWRFbHMgLSBMaXN0IG9mIGN1cnJlbnRseSBpbnRlcnNlY3RlZCBlbnRpdGllcy4KICogQG1lbWJlciB7YXJyYXl9IG9iamVjdHMgLSBDYWNoZWQgbGlzdCBvZiBtZXNoZXMgdG8gaW50ZXJzZWN0LgogKiBAbWVtYmVyIHtudW1iZXJ9IHByZXZDaGVja1RpbWUgLSBQcmV2aW91cyB0aW1lIGludGVyc2VjdGlvbiB3YXMgY2hlY2tlZC4gVG8gaGVscCBpbnRlcnZhbC4KICogQG1lbWJlciB7b2JqZWN0fSByYXljYXN0ZXIgLSB0aHJlZS5qcyBSYXljYXN0ZXIuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgncmF5Y2FzdGVyJywgewogIHNjaGVtYTogewogICAgYXV0b1JlZnJlc2g6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGRpcmVjdGlvbjoge3R5cGU6ICd2ZWMzJywgZGVmYXVsdDoge3g6IDAsIHk6IDAsIHo6IC0xfX0sCiAgICBlbmFibGVkOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBmYXI6IHtkZWZhdWx0OiAxMDAwfSwKICAgIGludGVydmFsOiB7ZGVmYXVsdDogMH0sCiAgICBuZWFyOiB7ZGVmYXVsdDogMH0sCiAgICBvYmplY3RzOiB7ZGVmYXVsdDogJyd9LAogICAgb3JpZ2luOiB7dHlwZTogJ3ZlYzMnfSwKICAgIHNob3dMaW5lOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgdXNlV29ybGRDb29yZGluYXRlczoge2RlZmF1bHQ6IGZhbHNlfQogIH0sCgogIG11bHRpcGxlOiB0cnVlLAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNsZWFyZWRJbnRlcnNlY3RlZEVscyA9IFtdOwogICAgdGhpcy51bml0TGluZUVuZFZlYzMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgdGhpcy5pbnRlcnNlY3RlZEVscyA9IFtdOwogICAgdGhpcy5pbnRlcnNlY3Rpb25zID0gW107CiAgICB0aGlzLm5ld0ludGVyc2VjdGVkRWxzID0gW107CiAgICB0aGlzLm5ld0ludGVyc2VjdGlvbnMgPSBbXTsKICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgdGhpcy5wcmV2Q2hlY2tUaW1lID0gdW5kZWZpbmVkOwogICAgdGhpcy5wcmV2SW50ZXJzZWN0ZWRFbHMgPSBbXTsKICAgIHRoaXMucmF3SW50ZXJzZWN0aW9ucyA9IFtdOwogICAgdGhpcy5yYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7CiAgICB0aGlzLnVwZGF0ZU9yaWdpbkRpcmVjdGlvbigpOwogICAgdGhpcy5zZXREaXJ0eSA9IHRoaXMuc2V0RGlydHkuYmluZCh0aGlzKTsKICAgIHRoaXMudXBkYXRlTGluZSA9IHRoaXMudXBkYXRlTGluZS5iaW5kKHRoaXMpOwogICAgdGhpcy5vYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHRoaXMuc2V0RGlydHkpOwogICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB0aGlzLmxpbmVFbmRWZWMzID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKICAgIHRoaXMub3RoZXJMaW5lRW5kVmVjMyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICB0aGlzLmxpbmVEYXRhID0ge2VuZDogdGhpcy5saW5lRW5kVmVjM307CgogICAgdGhpcy5nZXRJbnRlcnNlY3Rpb24gPSB0aGlzLmdldEludGVyc2VjdGlvbi5iaW5kKHRoaXMpOwogICAgdGhpcy5pbnRlcnNlY3RlZERldGFpbCA9IHtlbDogdGhpcy5lbCwgZ2V0SW50ZXJzZWN0aW9uOiB0aGlzLmdldEludGVyc2VjdGlvbn07CiAgICB0aGlzLmludGVyc2VjdGVkQ2xlYXJlZERldGFpbCA9IHtlbDogdGhpcy5lbH07CiAgICB0aGlzLmludGVyc2VjdGlvbkNsZWFyZWREZXRhaWwgPSB7Y2xlYXJlZEVsczogdGhpcy5jbGVhcmVkSW50ZXJzZWN0ZWRFbHN9OwogICAgdGhpcy5pbnRlcnNlY3Rpb25EZXRhaWwgPSB7fTsKICB9LAoKICAvKioKICAgKiBDcmVhdGUgb3IgdXBkYXRlIHJheWNhc3RlciBvYmplY3QuCiAgICovCiAgdXBkYXRlOiBmdW5jdGlvbiAob2xkRGF0YSkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIHJheWNhc3RlciA9IHRoaXMucmF5Y2FzdGVyOwoKICAgIC8vIFNldCByYXljYXN0ZXIgcHJvcGVydGllcy4KICAgIHJheWNhc3Rlci5mYXIgPSBkYXRhLmZhcjsKICAgIHJheWNhc3Rlci5uZWFyID0gZGF0YS5uZWFyOwoKICAgIC8vIERyYXcgbGluZS4KICAgIGlmIChkYXRhLnNob3dMaW5lICYmCiAgICAgICAgKGRhdGEuZmFyICE9PSBvbGREYXRhLmZhciB8fCBkYXRhLm9yaWdpbiAhPT0gb2xkRGF0YS5vcmlnaW4gfHwKICAgICAgICAgZGF0YS5kaXJlY3Rpb24gIT09IG9sZERhdGEuZGlyZWN0aW9uIHx8ICFvbGREYXRhLnNob3dMaW5lKSkgewogICAgICAvLyBDYWxjdWxhdGUgdW5pdCB2ZWN0b3IgZm9yIGxpbmUgZGlyZWN0aW9uLiBDYW4gYmUgbXVsdGlwbGllZCB2aWEgc2NhbGFyIHRvIHBlcmZvcm1hbnRseQogICAgICAvLyBhZGp1c3QgbGluZSBsZW5ndGguCiAgICAgIHRoaXMudW5pdExpbmVFbmRWZWMzLmNvcHkoZGF0YS5vcmlnaW4pLmFkZChkYXRhLmRpcmVjdGlvbikubm9ybWFsaXplKCk7CiAgICAgIHRoaXMuZHJhd0xpbmUoKTsKICAgIH0KCiAgICBpZiAoIWRhdGEuc2hvd0xpbmUgJiYgb2xkRGF0YS5zaG93TGluZSkgewogICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2xpbmUnKTsKICAgIH0KCiAgICBpZiAoZGF0YS5vYmplY3RzICE9PSBvbGREYXRhLm9iamVjdHMgJiYgIU9CU0VSVkVSX1NFTEVDVE9SX1JFLnRlc3QoZGF0YS5vYmplY3RzKSkgewogICAgICB3YXJuKCdbcmF5Y2FzdGVyXSBTZWxlY3RvciAiJyArIGRhdGEub2JqZWN0cyArCiAgICAgICAgICAgJyIgbWF5IG5vdCB1cGRhdGUgYXV0b21hdGljYWxseSB3aXRoIERPTSBjaGFuZ2VzLicpOwogICAgfQoKICAgIGlmICghZGF0YS5vYmplY3RzKSB7CiAgICAgIHdhcm4oJ1tyYXljYXN0ZXJdIEZvciBwZXJmb3JtYW5jZSwgcGxlYXNlIGRlZmluZSByYXljYXN0ZXIub2JqZWN0cyB3aGVuIHVzaW5nICcgKwogICAgICAgICAgICdyYXljYXN0ZXIgb3IgY3Vyc29yIGNvbXBvbmVudHMgdG8gd2hpdGVsaXN0IHdoaWNoIGVudGl0aWVzIHRvIGludGVyc2VjdCB3aXRoLiAnICsKICAgICAgICAgICAnZS5nLiwgcmF5Y2FzdGVyPSJvYmplY3RzOiBbZGF0YS1yYXljYXN0YWJsZV0iLicpOwogICAgfQoKICAgIGlmIChkYXRhLmF1dG9SZWZyZXNoICE9PSBvbGREYXRhLmF1dG9SZWZyZXNoICYmIGVsLmlzUGxheWluZykgewogICAgICBkYXRhLmF1dG9SZWZyZXNoCiAgICAgICAgPyB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCkKICAgICAgICA6IHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICAgIH0KCiAgICBpZiAob2xkRGF0YS5lbmFibGVkICYmICFkYXRhLmVuYWJsZWQpIHsgdGhpcy5jbGVhckFsbEludGVyc2VjdGlvbnMoKTsgfQoKICAgIHRoaXMuc2V0RGlydHkoKTsKICB9LAoKICBwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmRhdGEuc2hvd0xpbmUpIHsKICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJ2xpbmUnKTsKICAgIH0KICAgIHRoaXMuY2xlYXJBbGxJbnRlcnNlY3Rpb25zKCk7CiAgfSwKCiAgYWRkRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5kYXRhLmF1dG9SZWZyZXNoKSB7IHJldHVybjsgfQogICAgdGhpcy5vYnNlcnZlci5vYnNlcnZlKHRoaXMuZWwuc2NlbmVFbCwgT0JTRVJWRVJfQ09ORklHKTsKICAgIHRoaXMuZWwuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdvYmplY3QzZHNldCcsIHRoaXMuc2V0RGlydHkpOwogICAgdGhpcy5lbC5zY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ29iamVjdDNkcmVtb3ZlJywgdGhpcy5zZXREaXJ0eSk7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgdGhpcy5lbC5zY2VuZUVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29iamVjdDNkc2V0JywgdGhpcy5zZXREaXJ0eSk7CiAgICB0aGlzLmVsLnNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignb2JqZWN0M2RyZW1vdmUnLCB0aGlzLnNldERpcnR5KTsKICB9LAoKICAvKioKICAgKiBNYXJrIHRoZSBvYmplY3QgbGlzdCBhcyBkaXJ0eSwgdG8gYmUgcmVmcmVzaGVkIGJlZm9yZSBuZXh0IHJheWNhc3QuCiAgICovCiAgc2V0RGlydHk6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZGlydHkgPSB0cnVlOwogIH0sCgogIC8qKgogICAqIFVwZGF0ZSBsaXN0IG9mIG9iamVjdHMgdG8gdGVzdCBmb3IgaW50ZXJzZWN0aW9uLgogICAqLwogIHJlZnJlc2hPYmplY3RzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbHM7CgogICAgLy8gSWYgb2JqZWN0cyBub3QgZGVmaW5lZCwgaW50ZXJzZWN0IHdpdGggZXZlcnl0aGluZy4KICAgIGVscyA9IGRhdGEub2JqZWN0cwogICAgICA/IHRoaXMuZWwuc2NlbmVFbC5xdWVyeVNlbGVjdG9yQWxsKGRhdGEub2JqZWN0cykKICAgICAgOiB0aGlzLmVsLnNjZW5lRWwucXVlcnlTZWxlY3RvckFsbCgnKicpOwogICAgdGhpcy5vYmplY3RzID0gdGhpcy5mbGF0dGVuT2JqZWN0M0RNYXBzKGVscyk7CiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgfSwKCiAgLyoqCiAgICogQ2hlY2sgZm9yIGludGVyc2VjdGlvbnMgYW5kIGNsZWFyZWQgaW50ZXJzZWN0aW9ucyBvbiBhbiBpbnRlcnZhbC4KICAgKi8KICB0aWNrOiBmdW5jdGlvbiAodGltZSkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgcHJldkNoZWNrVGltZSA9IHRoaXMucHJldkNoZWNrVGltZTsKCiAgICBpZiAoIWRhdGEuZW5hYmxlZCkgeyByZXR1cm47IH0KCiAgICAvLyBPbmx5IGNoZWNrIGZvciBpbnRlcnNlY3Rpb24gaWYgaW50ZXJ2YWwgdGltZSBoYXMgcGFzc2VkLgogICAgaWYgKHByZXZDaGVja1RpbWUgJiYgKHRpbWUgLSBwcmV2Q2hlY2tUaW1lIDwgZGF0YS5pbnRlcnZhbCkpIHsgcmV0dXJuOyB9CgogICAgLy8gVXBkYXRlIGNoZWNrIHRpbWUuCiAgICB0aGlzLnByZXZDaGVja1RpbWUgPSB0aW1lOwogICAgdGhpcy5jaGVja0ludGVyc2VjdGlvbnMoKTsKICB9LAoKICAvKioKICAgKiBSYXljYXN0IGZvciBpbnRlcnNlY3Rpb25zIGFuZCBlbWl0IGV2ZW50cyBmb3IgY3VycmVudCBhbmQgY2xlYXJlZCBpbmVyc2VjdGlvbnMuCiAgICovCiAgY2hlY2tJbnRlcnNlY3Rpb25zOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2xlYXJlZEludGVyc2VjdGVkRWxzID0gdGhpcy5jbGVhcmVkSW50ZXJzZWN0ZWRFbHM7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgaTsKICAgIHZhciBpbnRlcnNlY3RlZEVscyA9IHRoaXMuaW50ZXJzZWN0ZWRFbHM7CiAgICB2YXIgaW50ZXJzZWN0aW9uOwogICAgdmFyIGludGVyc2VjdGlvbnMgPSB0aGlzLmludGVyc2VjdGlvbnM7CiAgICB2YXIgbmV3SW50ZXJzZWN0ZWRFbHMgPSB0aGlzLm5ld0ludGVyc2VjdGVkRWxzOwogICAgdmFyIG5ld0ludGVyc2VjdGlvbnMgPSB0aGlzLm5ld0ludGVyc2VjdGlvbnM7CiAgICB2YXIgcHJldkludGVyc2VjdGVkRWxzID0gdGhpcy5wcmV2SW50ZXJzZWN0ZWRFbHM7CiAgICB2YXIgcmF3SW50ZXJzZWN0aW9ucyA9IHRoaXMucmF3SW50ZXJzZWN0aW9uczsKCiAgICAvLyBSZWZyZXNoIHRoZSBvYmplY3Qgd2hpdGVsaXN0IGlmIG5lZWRlZC4KICAgIGlmICh0aGlzLmRpcnR5KSB7IHRoaXMucmVmcmVzaE9iamVjdHMoKTsgfQoKICAgIC8vIFN0b3JlIG9sZCBwcmV2aW91c2x5IGludGVyc2VjdGVkIGVudGl0aWVzLgogICAgY29weUFycmF5KHRoaXMucHJldkludGVyc2VjdGVkRWxzLCB0aGlzLmludGVyc2VjdGVkRWxzKTsKCiAgICAvLyBSYXljYXN0LgogICAgdGhpcy51cGRhdGVPcmlnaW5EaXJlY3Rpb24oKTsKICAgIHJhd0ludGVyc2VjdGlvbnMubGVuZ3RoID0gMDsKICAgIHRoaXMucmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHModGhpcy5vYmplY3RzLCB0cnVlLCByYXdJbnRlcnNlY3Rpb25zKTsKCiAgICAvLyBPbmx5IGtlZXAgaW50ZXJzZWN0aW9ucyBhZ2FpbnN0IG9iamVjdHMgdGhhdCBoYXZlIGEgcmVmZXJlbmNlIHRvIGFuIGVudGl0eS4KICAgIGludGVyc2VjdGlvbnMubGVuZ3RoID0gMDsKICAgIGludGVyc2VjdGVkRWxzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgcmF3SW50ZXJzZWN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICBpbnRlcnNlY3Rpb24gPSByYXdJbnRlcnNlY3Rpb25zW2ldOwogICAgICAvLyBEb24ndCBpbnRlcnNlY3Qgd2l0aCBvd24gbGluZS4KICAgICAgaWYgKGRhdGEuc2hvd0xpbmUgJiYgaW50ZXJzZWN0aW9uLm9iamVjdCA9PT0gZWwuZ2V0T2JqZWN0M0QoJ2xpbmUnKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChpbnRlcnNlY3Rpb24ub2JqZWN0LmVsKSB7CiAgICAgICAgaW50ZXJzZWN0aW9ucy5wdXNoKGludGVyc2VjdGlvbik7CiAgICAgICAgaW50ZXJzZWN0ZWRFbHMucHVzaChpbnRlcnNlY3Rpb24ub2JqZWN0LmVsKTsKICAgICAgfQogICAgfQoKICAgIC8vIEdldCBuZXdseSBpbnRlcnNlY3RlZCBlbnRpdGllcy4KICAgIG5ld0ludGVyc2VjdGlvbnMubGVuZ3RoID0gMDsKICAgIG5ld0ludGVyc2VjdGVkRWxzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgaW50ZXJzZWN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICBpZiAocHJldkludGVyc2VjdGVkRWxzLmluZGV4T2YoaW50ZXJzZWN0aW9uc1tpXS5vYmplY3QuZWwpID09PSAtMSkgewogICAgICAgIG5ld0ludGVyc2VjdGlvbnMucHVzaChpbnRlcnNlY3Rpb25zW2ldKTsKICAgICAgICBuZXdJbnRlcnNlY3RlZEVscy5wdXNoKGludGVyc2VjdGlvbnNbaV0ub2JqZWN0LmVsKTsKICAgICAgfQogICAgfQoKICAgIC8vIEVtaXQgaW50ZXJzZWN0aW9uIGNsZWFyZWQgb24gYm90aCBlbnRpdGllcyBwZXIgZm9ybWVybHkgaW50ZXJzZWN0ZWQgZW50aXR5LgogICAgY2xlYXJlZEludGVyc2VjdGVkRWxzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgcHJldkludGVyc2VjdGVkRWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChpbnRlcnNlY3RlZEVscy5pbmRleE9mKHByZXZJbnRlcnNlY3RlZEVsc1tpXSkgIT09IC0xKSB7IGNvbnRpbnVlOyB9CiAgICAgIHByZXZJbnRlcnNlY3RlZEVsc1tpXS5lbWl0KEVWRU5UUy5JTlRFUlNFQ1RfQ0xFQVIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJzZWN0ZWRDbGVhcmVkRGV0YWlsKTsKICAgICAgY2xlYXJlZEludGVyc2VjdGVkRWxzLnB1c2gocHJldkludGVyc2VjdGVkRWxzW2ldKTsKICAgIH0KICAgIGlmIChjbGVhcmVkSW50ZXJzZWN0ZWRFbHMubGVuZ3RoKSB7CiAgICAgIGVsLmVtaXQoRVZFTlRTLklOVEVSU0VDVElPTl9DTEVBUiwgdGhpcy5pbnRlcnNlY3Rpb25DbGVhcmVkRGV0YWlsKTsKICAgIH0KCiAgICAvLyBFbWl0IGludGVyc2VjdGVkIG9uIGludGVyc2VjdGVkIGVudGl0eSBwZXIgaW50ZXJzZWN0ZWQgZW50aXR5LgogICAgZm9yIChpID0gMDsgaSA8IG5ld0ludGVyc2VjdGVkRWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgIG5ld0ludGVyc2VjdGVkRWxzW2ldLmVtaXQoRVZFTlRTLklOVEVSU0VDVCwgdGhpcy5pbnRlcnNlY3RlZERldGFpbCk7CiAgICB9CgogICAgLy8gRW1pdCBhbGwgaW50ZXJzZWN0aW9ucyBhdCBvbmNlIG9uIHJheWNhc3RpbmcgZW50aXR5LgogICAgaWYgKG5ld0ludGVyc2VjdGlvbnMubGVuZ3RoKSB7CiAgICAgIHRoaXMuaW50ZXJzZWN0aW9uRGV0YWlsLmVscyA9IG5ld0ludGVyc2VjdGVkRWxzOwogICAgICB0aGlzLmludGVyc2VjdGlvbkRldGFpbC5pbnRlcnNlY3Rpb25zID0gbmV3SW50ZXJzZWN0aW9uczsKICAgICAgZWwuZW1pdChFVkVOVFMuSU5URVJTRUNUSU9OLCB0aGlzLmludGVyc2VjdGlvbkRldGFpbCk7CiAgICB9CgogICAgLy8gVXBkYXRlIGxpbmUgbGVuZ3RoLgogICAgc2V0VGltZW91dCh0aGlzLnVwZGF0ZUxpbmUpOwogIH0sCgogIHVwZGF0ZUxpbmU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgaW50ZXJzZWN0aW9ucyA9IHRoaXMuaW50ZXJzZWN0aW9uczsKICAgIHZhciBsaW5lTGVuZ3RoOwoKICAgIGlmICh0aGlzLmRhdGEuc2hvd0xpbmUpIHsKICAgICAgaWYgKGludGVyc2VjdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgaWYgKGludGVyc2VjdGlvbnNbMF0ub2JqZWN0LmVsID09PSBlbCAmJiBpbnRlcnNlY3Rpb25zWzFdKSB7CiAgICAgICAgICBsaW5lTGVuZ3RoID0gaW50ZXJzZWN0aW9uc1sxXS5kaXN0YW5jZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGluZUxlbmd0aCA9IGludGVyc2VjdGlvbnNbMF0uZGlzdGFuY2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZHJhd0xpbmUobGluZUxlbmd0aCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBtb3N0IHJlY2VudCBpbnRlcnNlY3Rpb24gZGV0YWlscyBmb3IgYSBnaXZlbiBlbnRpdHksIGlmIGFueS4KICAgKiBAcGFyYW0ge0FFbnRpdHl9IGVsCiAgICogQHJldHVybiB7T2JqZWN0fQogICAqLwogIGdldEludGVyc2VjdGlvbjogZnVuY3Rpb24gKGVsKSB7CiAgICB2YXIgaTsKICAgIHZhciBpbnRlcnNlY3Rpb247CiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5pbnRlcnNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGludGVyc2VjdGlvbiA9IHRoaXMuaW50ZXJzZWN0aW9uc1tpXTsKICAgICAgaWYgKGludGVyc2VjdGlvbi5vYmplY3QuZWwgPT09IGVsKSB7IHJldHVybiBpbnRlcnNlY3Rpb247IH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0sCgogIC8qKgogICAqIFVwZGF0ZSBvcmlnaW4gYW5kIGRpcmVjdGlvbiBvZiByYXljYXN0ZXIgdXNpbmcgZW50aXR5IHRyYW5zZm9ybXMgYW5kIHN1cHBsaWVkIG9yaWdpbiBvcgogICAqIGRpcmVjdGlvbiBvZmZzZXRzLgogICAqLwogIHVwZGF0ZU9yaWdpbkRpcmVjdGlvbjogKGZ1bmN0aW9uICgpIHsKICAgIHZhciBkaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOwogICAgdmFyIG9yaWdpblZlYzMgPSBuZXcgVEhSRUUuVmVjdG9yMygpOwoKICAgIC8vIENsb3N1cmUgdG8gbWFrZSBxdWF0ZXJuaW9uL3ZlY3RvcjMgb2JqZWN0cyBwcml2YXRlLgogICAgcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZU9yaWdpbkRpcmVjdGlvbiAoKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwoKICAgICAgaWYgKGRhdGEudXNlV29ybGRDb29yZGluYXRlcykgewogICAgICAgIHRoaXMucmF5Y2FzdGVyLnNldChkYXRhLm9yaWdpbiwgZGF0YS5kaXJlY3Rpb24pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gR3JhYiB0aGUgcG9zaXRpb24gYW5kIHJvdGF0aW9uLiAoQXMgYSBzaWRlIGVmZmVjdCwgdGhpcyB1cGRhdGVzIGVsLm9iamVjdDNELm1hdHJpeFdvcmxkLikKICAgICAgZWwub2JqZWN0M0QuZ2V0V29ybGRQb3NpdGlvbihvcmlnaW5WZWMzKTsKCiAgICAgIC8vIElmIG5vbi16ZXJvIG9yaWdpbiwgdHJhbnNsYXRlIHRoZSBvcmlnaW4gaW50byB3b3JsZCBzcGFjZS4KICAgICAgaWYgKGRhdGEub3JpZ2luLnggIT09IDAgfHwgZGF0YS5vcmlnaW4ueSAhPT0gMCB8fCBkYXRhLm9yaWdpbi56ICE9PSAwKSB7CiAgICAgICAgb3JpZ2luVmVjMyA9IGVsLm9iamVjdDNELmxvY2FsVG9Xb3JsZChvcmlnaW5WZWMzLmNvcHkoZGF0YS5vcmlnaW4pKTsKICAgICAgfQoKICAgICAgLy8gdGhyZWUuanMgcmF5Y2FzdGVyIGRpcmVjdGlvbiBpcyByZWxhdGl2ZSB0byAwLCAwLCAwIE5PVCB0aGUgb3JpZ2luIC8gb2Zmc2V0IHdlCiAgICAgIC8vIHByb3ZpZGUuIEFwcGx5IHRoZSBvZmZzZXQgdG8gdGhlIGRpcmVjdGlvbiwgdGhlbiByb3RhdGlvbiBmcm9tIHRoZSBvYmplY3QsCiAgICAgIC8vIGFuZCBub3JtYWxpemUuCiAgICAgIGRpcmVjdGlvbi5jb3B5KGRhdGEuZGlyZWN0aW9uKS50cmFuc2Zvcm1EaXJlY3Rpb24oZWwub2JqZWN0M0QubWF0cml4V29ybGQpLm5vcm1hbGl6ZSgpOwoKICAgICAgLy8gQXBwbHkgb2Zmc2V0IGFuZCBkaXJlY3Rpb24sIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICB0aGlzLnJheWNhc3Rlci5zZXQob3JpZ2luVmVjMywgZGlyZWN0aW9uKTsKICAgIH07CiAgfSkoKSwKCiAgLyoqCiAgICogQ3JlYXRlIG9yIHVwZGF0ZSBsaW5lIHRvIGdpdmUgcmF5Y2FzdGVyIHZpc3VhbCByZXByZXNlbnRhdGlvbi4KICAgKiBDdXN0b21pemUgdGhlIGxpbmUgdGhyb3VnaCB0aHJvdWdoIGxpbmUgY29tcG9uZW50LgogICAqIFdlIGRyYXcgdGhlIGxpbmUgaW4gdGhlIHJheWNhc3RlciBjb21wb25lbnQgdG8gY3VzdG9taXplIHRoZSBsaW5lIHRvIHRoZQogICAqIHJheWNhc3RlcidzIG9yaWdpbiwgZGlyZWN0aW9uLCBhbmQgZmFyLgogICAqCiAgICogVW5saWtlIHRoZSByYXljYXN0ZXIsIHdlIGNyZWF0ZSB0aGUgbGluZSBhcyBhIGNoaWxkIG9mIHRoZSBvYmplY3QuIFRoZSBsaW5lIHdpbGwKICAgKiBiZSBhZmZlY3RlZCBieSB0aGUgdHJhbnNmb3JtcyBvZiB0aGUgb2JqZWN0cywgc28gd2UgZG9uJ3QgaGF2ZSB0byBjYWxjdWxhdGUgdHJhbnNmb3JtcwogICAqIGxpa2Ugd2UgZG8gd2l0aCB0aGUgcmF5Y2FzdGVyLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIExlbmd0aCBvZiBsaW5lLiBQYXNzIGluIHRvIHNob3J0ZW4gdGhlIGxpbmUgdG8gdGhlIGludGVyc2VjdGlvbgogICAqICAgcG9pbnQuIElmIG5vdCBwcm92aWRlZCwgbGVuZ3RoIHdpbGwgZGVmYXVsdCB0byB0aGUgbWF4IGxlbmd0aCwgYHJheWNhc3Rlci5mYXJgLgogICAqLwogIGRyYXdMaW5lOiBmdW5jdGlvbiAobGVuZ3RoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgZW5kVmVjMzsKCiAgICAvLyBTd2l0Y2ggZWFjaCB0aW1lIHZlY3RvciBzbyBsaW5lIHVwZGF0ZSB0cmlnZ2VyZWQgYW5kIHRvIGF2b2lkIHVubmVjZXNzYXJ5IHZlY3RvciBjbG9uZS4KICAgIGVuZFZlYzMgPSB0aGlzLmxpbmVEYXRhLmVuZCA9PT0gdGhpcy5saW5lRW5kVmVjMwogICAgICA/IHRoaXMub3RoZXJMaW5lRW5kVmVjMwogICAgICA6IHRoaXMubGluZUVuZFZlYzM7CgogICAgLy8gVHJlYXQgSW5maW5pdHkgYXMgMTAwMG0gZm9yIHRoZSBsaW5lLgogICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGxlbmd0aCA9IGRhdGEuZmFyID09PSBJbmZpbml0eSA/IDEwMDAgOiBkYXRhLmZhcjsKICAgIH0KCiAgICAvLyBVcGRhdGUgdGhlIGxlbmd0aCBvZiB0aGUgbGluZSBpZiBnaXZlbi4gYHVuaXRMaW5lRW5kVmVjM2AgaXMgdGhlIGRpcmVjdGlvbgogICAgLy8gZ2l2ZW4gYnkgZGF0YS5kaXJlY3Rpb24sIHRoZW4gd2UgYXBwbHkgYSBzY2FsYXIgdG8gZ2l2ZSBpdCBhIGxlbmd0aC4KICAgIHRoaXMubGluZURhdGEuc3RhcnQgPSBkYXRhLm9yaWdpbjsKICAgIHRoaXMubGluZURhdGEuZW5kID0gZW5kVmVjMy5jb3B5KHRoaXMudW5pdExpbmVFbmRWZWMzKS5tdWx0aXBseVNjYWxhcihsZW5ndGgpOwogICAgZWwuc2V0QXR0cmlidXRlKCdsaW5lJywgdGhpcy5saW5lRGF0YSk7CiAgfSwKCiAgLyoqCiAgICogUmV0dXJuIEEtRnJhbWUgYXR0YWNobWVudHMgb2YgZWFjaCBlbGVtZW50J3Mgb2JqZWN0M0QgZ3JvdXAgKGUuZy4sIG1lc2gpLgogICAqIENoaWxkcmVuIGFyZSBmbGF0dGVuZWQgYnkgb25lIGxldmVsLCByZW1vdmluZyB0aGUgVEhSRUUuR3JvdXAgd3JhcHBlciwKICAgKiBzbyB0aGF0IG5vbi1yZWN1cnNpdmUgcmF5Y2FzdGluZyByZW1haW5zIHVzZWZ1bC4KICAgKgogICAqIE9ubHkgcHVzaCBjaGlsZHJlbiBkZWZpbmVkIGFzIGNvbXBvbmVudCBhdHRhY2hlbW50cyAoZS5nLiwgc2V0T2JqZWN0M0QpLAogICAqIE5PVCBhY3R1YWwgY2hpbGRyZW4gaW4gdGhlIHNjZW5lIGdyYXBoIGhpZXJhcmNoeS4KICAgKgogICAqIEBwYXJhbSAge0FycmF5PEVsZW1lbnQ+fSBlbHMKICAgKiBAcmV0dXJuIHtBcnJheTxUSFJFRS5PYmplY3QzRD59CiAgICovCiAgZmxhdHRlbk9iamVjdDNETWFwczogZnVuY3Rpb24gKGVscykgewogICAgdmFyIGtleTsKICAgIHZhciBpOwogICAgdmFyIG9iamVjdHMgPSB0aGlzLm9iamVjdHM7CgogICAgLy8gUHVzaCBtZXNoZXMgYW5kIG90aGVyIGF0dGFjaG1lbnRzIG9udG8gbGlzdCBvZiBvYmplY3RzIHRvIGludGVyc2VjdC4KICAgIG9iamVjdHMubGVuZ3RoID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGVsc1tpXS5pc0VudGl0eSAmJiBlbHNbaV0ub2JqZWN0M0QpIHsKICAgICAgICBmb3IgKGtleSBpbiBlbHNbaV0ub2JqZWN0M0RNYXApIHsKICAgICAgICAgIG9iamVjdHMucHVzaChlbHNbaV0uZ2V0T2JqZWN0M0Qoa2V5KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG9iamVjdHM7CiAgfSwKCiAgY2xlYXJBbGxJbnRlcnNlY3Rpb25zOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaTsKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmludGVyc2VjdGVkRWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHRoaXMuaW50ZXJzZWN0ZWRFbHNbaV0uZW1pdChFVkVOVFMuSU5URVJTRUNUX0NMRUFSLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcnNlY3RlZENsZWFyZWREZXRhaWwpOwogICAgfQogICAgY29weUFycmF5KHRoaXMuY2xlYXJlZEludGVyc2VjdGVkRWxzLCB0aGlzLmludGVyc2VjdGVkRWxzKTsKICAgIHRoaXMuaW50ZXJzZWN0ZWRFbHMubGVuZ3RoID0gMDsKICAgIHRoaXMuaW50ZXJzZWN0aW9ucy5sZW5ndGggPSAwOwogICAgdGhpcy5lbC5lbWl0KEVWRU5UUy5JTlRFUlNFQ1RJT05fQ0xFQVIsIHRoaXMuaW50ZXJzZWN0aW9uQ2xlYXJlZERldGFpbCk7CiAgfQp9KTsKCi8qKgogKiBDb3B5IGNvbnRlbnRzIG9mIG9uZSBhcnJheSB0byBhbm90aGVyIHdpdGhvdXQgYWxsb2NhdGluZyBuZXcgYXJyYXkuCiAqLwpmdW5jdGlvbiBjb3B5QXJyYXkgKGEsIGIpIHsKICB2YXIgaTsKICBhLmxlbmd0aCA9IGIubGVuZ3RoOwogIGZvciAoaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7CiAgICBhW2ldID0gYltpXTsKICB9Cn0KCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMvIjoxNzl9XSw3NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBkZWdUb1JhZCA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpLk1hdGguZGVnVG9SYWQ7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7Cgptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgncm90YXRpb24nLCB7CiAgc2NoZW1hOiB7dHlwZTogJ3ZlYzMnfSwKCiAgLyoqCiAgICogVXBkYXRlcyBvYmplY3QzRCByb3RhdGlvbi4KICAgKi8KICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIG9iamVjdDNEID0gdGhpcy5lbC5vYmplY3QzRDsKICAgIG9iamVjdDNELnJvdGF0aW9uLnNldChkZWdUb1JhZChkYXRhLngpLCBkZWdUb1JhZChkYXRhLnkpLCBkZWdUb1JhZChkYXRhLnopKTsKICAgIG9iamVjdDNELnJvdGF0aW9uLm9yZGVyID0gJ1lYWic7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICAvLyBQcmV0dHkgbXVjaCBmb3IgbWl4aW5zLgogICAgdGhpcy5lbC5vYmplY3QzRC5yb3RhdGlvbi5zZXQoMCwgMCwgMCk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NH1dLDc2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKCi8vIEF2b2lkcyB0cmlnZ2VyaW5nIGEgemVyby1kZXRlcm1pbmFudCB3aGljaCBtYWtlcyBvYmplY3QzRCBtYXRyaXggbm9uLWludmVydGlibGUuCnZhciB6ZXJvU2NhbGUgPSAwLjAwMDAxOwoKbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3NjYWxlJywgewogIHNjaGVtYTogewogICAgdHlwZTogJ3ZlYzMnLAogICAgZGVmYXVsdDoge3g6IDEsIHk6IDEsIHo6IDF9CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBvYmplY3QzRCA9IHRoaXMuZWwub2JqZWN0M0Q7CiAgICB2YXIgeCA9IGRhdGEueCA9PT0gMCA/IHplcm9TY2FsZSA6IGRhdGEueDsKICAgIHZhciB5ID0gZGF0YS55ID09PSAwID8gemVyb1NjYWxlIDogZGF0YS55OwogICAgdmFyIHogPSBkYXRhLnogPT09IDAgPyB6ZXJvU2NhbGUgOiBkYXRhLno7CiAgICBvYmplY3QzRC5zY2FsZS5zZXQoeCwgeSwgeik7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICAvLyBQcmV0dHkgbXVjaCBmb3IgbWl4aW5zLgogICAgdGhpcy5lbC5vYmplY3QzRC5zY2FsZS5zZXQoMSwgMSwgMSk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sNzc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgVEhSRUUgKi8KdmFyIHJlZ2lzdGVyID0gX2RlcmVxXygnLi4vLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyKCdiYWNrZ3JvdW5kJywgewogIHNjaGVtYTogewogICAgY29sb3I6IHt0eXBlOiAnY29sb3InLCBkZWZhdWx0OiAnYmxhY2snfSwKICAgIHRyYW5zcGFyZW50OiB7ZGVmYXVsdDogZmFsc2V9CiAgfSwKICB1cGRhdGU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIG9iamVjdDNEID0gdGhpcy5lbC5vYmplY3QzRDsKICAgIGlmIChkYXRhLnRyYW5zcGFyZW50KSB7CiAgICAgIG9iamVjdDNELmJhY2tncm91bmQgPSBudWxsOwogICAgICByZXR1cm47CiAgICB9CiAgICBvYmplY3QzRC5iYWNrZ3JvdW5kID0gbmV3IFRIUkVFLkNvbG9yKGRhdGEuY29sb3IpOwogIH0KfSk7Cgp9LHsiLi4vLi4vY29yZS9jb21wb25lbnQiOjEwNn1dLDc4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyID0gX2RlcmVxXygnLi4vLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyKCdkZWJ1ZycsIHsKICBzY2hlbWE6IHtkZWZhdWx0OiB0cnVlfQp9KTsKCn0seyIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sNzk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50OwoKLyoqCiAqIENvbXBvbmVudCB0byBlbWJlZCBhbiBhLWZyYW1lIHNjZW5lIHdpdGhpbiB0aGUgbGF5b3V0IG9mIGEgMkQgcGFnZS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdlbWJlZGRlZCcsIHsKICBkZXBlbmRlbmNpZXM6IFsndnItbW9kZS11aSddLAoKICBzY2hlbWE6IHtkZWZhdWx0OiB0cnVlfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWw7CiAgICB2YXIgZW50ZXJWUkVsID0gc2NlbmVFbC5xdWVyeVNlbGVjdG9yKCcuYS1lbnRlci12cicpOwogICAgaWYgKHRoaXMuZGF0YSA9PT0gdHJ1ZSkgewogICAgICBpZiAoZW50ZXJWUkVsKSB7IGVudGVyVlJFbC5jbGFzc0xpc3QuYWRkKCdlbWJlZGRlZCcpOyB9CiAgICAgIHNjZW5lRWwucmVtb3ZlRnVsbFNjcmVlblN0eWxlcygpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGVudGVyVlJFbCkgeyBlbnRlclZSRWwuY2xhc3NMaXN0LnJlbW92ZSgnZW1iZWRkZWQnKTsgfQogICAgICBzY2VuZUVsLmFkZEZ1bGxTY3JlZW5TdHlsZXMoKTsKICAgIH0KICB9Cgp9KTsKCn0seyIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sODA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXIgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi8uLi9saWIvdGhyZWUnKTsKdmFyIGRlYnVnID0gX2RlcmVxXygnLi4vLi4vdXRpbHMvZGVidWcnKTsKCnZhciB3YXJuID0gZGVidWcoJ2NvbXBvbmVudHM6Zm9nOndhcm4nKTsKCi8qKgogKiBGb2cgY29tcG9uZW50LgogKiBBcHBsaWVzIG9ubHkgdG8gdGhlIHNjZW5lIGVudGl0eS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyKCdmb2cnLCB7CiAgc2NoZW1hOiB7CiAgICBjb2xvcjoge3R5cGU6ICdjb2xvcicsIGRlZmF1bHQ6ICcjMDAwJ30sCiAgICBkZW5zaXR5OiB7ZGVmYXVsdDogMC4wMDAyNX0sCiAgICBmYXI6IHtkZWZhdWx0OiAxMDAwLCBtaW46IDB9LAogICAgbmVhcjoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICB0eXBlOiB7ZGVmYXVsdDogJ2xpbmVhcicsIG9uZU9mOiBbJ2xpbmVhcicsICdleHBvbmVudGlhbCddfQogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGZvZyA9IHRoaXMuZWwub2JqZWN0M0QuZm9nOwoKICAgIGlmICghZWwuaXNTY2VuZSkgewogICAgICB3YXJuKCdGb2cgY29tcG9uZW50IGNhbiBvbmx5IGJlIGFwcGxpZWQgdG8gPGEtc2NlbmU+Jyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAoUmUpY3JlYXRlIGZvZyBpZiBmb2cgZG9lc24ndCBleGlzdCBvciBmb2cgdHlwZSBjaGFuZ2VkLgogICAgaWYgKCFmb2cgfHwgZGF0YS50eXBlICE9PSBmb2cubmFtZSkgewogICAgICBlbC5vYmplY3QzRC5mb2cgPSBnZXRGb2coZGF0YSk7CiAgICAgIGVsLnN5c3RlbXMubWF0ZXJpYWwudXBkYXRlTWF0ZXJpYWxzKCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBGb2cgZGF0YSBjaGFuZ2VkLiBVcGRhdGUgZm9nLgogICAgT2JqZWN0LmtleXModGhpcy5zY2hlbWEpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07CiAgICAgIGlmIChrZXkgPT09ICdjb2xvcicpIHsgdmFsdWUgPSBuZXcgVEhSRUUuQ29sb3IodmFsdWUpOyB9CiAgICAgIGZvZ1trZXldID0gdmFsdWU7CiAgICB9KTsKICB9LAoKICAvKioKICAgKiBSZW1vdmUgZm9nIG9uIHJlbW92ZSAoY2FsbGJhY2spLgogICAqLwogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGZvZyA9IHRoaXMuZWwub2JqZWN0M0QuZm9nOwogICAgaWYgKCFmb2cpIHsgcmV0dXJuOyB9CiAgICBmb2cuZmFyID0gMDsKICAgIGZvZy5uZWFyID0gMC4xOwogIH0KfSk7CgovKioKICogQ3JlYXRlcyBhIGZvZyBvYmplY3QuIFNldHMgZm9nLm5hbWUgdG8gYmUgYWJsZSB0byBkZXRlY3QgZm9nIHR5cGUgY2hhbmdlcy4KICoKICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBGb2cgZGF0YS4KICogQHJldHVybnMge29iamVjdH0gZm9nCiAqLwpmdW5jdGlvbiBnZXRGb2cgKGRhdGEpIHsKICB2YXIgZm9nOwogIGlmIChkYXRhLnR5cGUgPT09ICdleHBvbmVudGlhbCcpIHsKICAgIGZvZyA9IG5ldyBUSFJFRS5Gb2dFeHAyKGRhdGEuY29sb3IsIGRhdGEuZGVuc2l0eSk7CiAgfSBlbHNlIHsKICAgIGZvZyA9IG5ldyBUSFJFRS5Gb2coZGF0YS5jb2xvciwgZGF0YS5uZWFyLCBkYXRhLmZhcik7CiAgfQogIGZvZy5uYW1lID0gZGF0YS50eXBlOwogIHJldHVybiBmb2c7Cn0KCn0seyIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi8uLi9saWIvdGhyZWUiOjE1NCwiLi4vLi4vdXRpbHMvZGVidWciOjE3NX1dLDgxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChwcm9jZXNzKXsKLyogZ2xvYmFsIEFGUkFNRSAqLwp2YXIgQUZSQU1FX0lOSkVDVEVEID0gX2RlcmVxXygnLi4vLi4vY29uc3RhbnRzJykuQUZSQU1FX0lOSkVDVEVEOwp2YXIgcGtnID0gX2RlcmVxXygnLi4vLi4vLi4vcGFja2FnZScpOwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi8uLi91dGlscy8nKTsKCi8qKgogKiAwLjQuMiB0byAwLjQueAogKiBXaWxsIG5lZWQgdG8gdXBkYXRlIHRoaXMgd2hlbiBBLUZyYW1lIGdvZXMgdG8gMS54LnguCiAqLwpmdW5jdGlvbiBnZXRGdXp6eVBhdGNoVmVyc2lvbiAodmVyc2lvbikgewogIHZhciBzcGxpdCA9IHZlcnNpb24uc3BsaXQoJy4nKTsKICBzcGxpdFsyXSA9ICd4JzsKICByZXR1cm4gc3BsaXQuam9pbignLicpOwp9Cgp2YXIgSU5TUEVDVE9SX0RFVl9VUkwgPSAnaHR0cHM6Ly9hZnJhbWUuaW8vYWZyYW1lLWluc3BlY3Rvci9kaXN0L2FmcmFtZS1pbnNwZWN0b3IuanMnOwp2YXIgSU5TUEVDVE9SX1JFTEVBU0VfVVJMID0gJ2h0dHBzOi8vdW5wa2cuY29tL2FmcmFtZS1pbnNwZWN0b3JAJyArIGdldEZ1enp5UGF0Y2hWZXJzaW9uKHBrZy52ZXJzaW9uKSArICcvZGlzdC9hZnJhbWUtaW5zcGVjdG9yLm1pbi5qcyc7CnZhciBJTlNQRUNUT1JfVVJMID0gcHJvY2Vzcy5lbnYuSU5TUEVDVE9SX1ZFUlNJT04gPT09ICdkZXYnID8gSU5TUEVDVE9SX0RFVl9VUkwgOiBJTlNQRUNUT1JfUkVMRUFTRV9VUkw7CnZhciBMT0FESU5HX01FU1NBR0UgPSAnTG9hZGluZyBJbnNwZWN0b3InOwp2YXIgTE9BRElOR19FUlJPUl9NRVNTQUdFID0gJ0Vycm9yIGxvYWRpbmcgSW5zcGVjdG9yJzsKCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdpbnNwZWN0b3InLCB7CiAgc2NoZW1hOiB7CiAgICB1cmw6IHtkZWZhdWx0OiBJTlNQRUNUT1JfVVJMfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZmlyc3RQbGF5ID0gdHJ1ZTsKICAgIHRoaXMub25LZXlkb3duID0gdGhpcy5vbktleWRvd24uYmluZCh0aGlzKTsKICAgIHRoaXMub25NZXNzYWdlID0gdGhpcy5vbk1lc3NhZ2UuYmluZCh0aGlzKTsKICAgIHRoaXMuaW5pdE92ZXJsYXkoKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleWRvd24pOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZSk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdmFyIHVybFBhcmFtOwogICAgaWYgKCF0aGlzLmZpcnN0UGxheSkgeyByZXR1cm47IH0KICAgIHVybFBhcmFtID0gdXRpbHMuZ2V0VXJsUGFyYW1ldGVyKCdpbnNwZWN0b3InKTsKICAgIGlmICh1cmxQYXJhbSAhPT0gJ2ZhbHNlJyAmJiAhIXVybFBhcmFtKSB7CiAgICAgIHRoaXMub3Blbkluc3BlY3RvcigpOwogICAgICB0aGlzLmZpcnN0UGxheSA9IGZhbHNlOwogICAgfQogIH0sCgogIGluaXRPdmVybGF5OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZG90c0hUTUwgPSAnPHNwYW4gY2xhc3M9ImRvdHMiPjxzcGFuPi48L3NwYW4+PHNwYW4+Ljwvc3Bhbj48c3Bhbj4uPC9zcGFuPjwvc3Bhbj4nOwogICAgdGhpcy5sb2FkaW5nTWVzc2FnZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmxvYWRpbmdNZXNzYWdlRWwuY2xhc3NMaXN0LmFkZCgnYS1pbnNwZWN0b3ItbG9hZGVyJyk7CiAgICB0aGlzLmxvYWRpbmdNZXNzYWdlRWwuaW5uZXJIVE1MID0gTE9BRElOR19NRVNTQUdFICsgZG90c0hUTUw7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgLyoqCiAgICogPGN0cmw+ICsgPGFsdD4gKyBpIGtleWJvYXJkIHNob3J0Y3V0LgogICAqLwogIG9uS2V5ZG93bjogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIHNob3J0Y3V0UHJlc3NlZCA9IGV2dC5rZXlDb2RlID09PSA3MyAmJiBldnQuY3RybEtleSAmJiBldnQuYWx0S2V5OwogICAgaWYgKCFzaG9ydGN1dFByZXNzZWQpIHsgcmV0dXJuOyB9CiAgICB0aGlzLm9wZW5JbnNwZWN0b3IoKTsKICB9LAoKICBzaG93TG9hZGVyOiBmdW5jdGlvbiAoKSB7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubG9hZGluZ01lc3NhZ2VFbCk7CiAgfSwKCiAgaGlkZUxvYWRlcjogZnVuY3Rpb24gKCkgewogICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmxvYWRpbmdNZXNzYWdlRWwpOwogIH0sCgogIC8qKgogICAqIHBvc3RNZXNzYWdlLiBhZnJhbWUuaW8gdXNlcyB0aGlzIHRvIGNyZWF0ZSBhIGJ1dHRvbiBvbiBleGFtcGxlcyB0byBvcGVuIEluc3BlY3Rvci4KICAgKi8KICBvbk1lc3NhZ2U6IGZ1bmN0aW9uIChldnQpIHsKICAgIGlmIChldnQuZGF0YSA9PT0gJ0lOSkVDVF9BRlJBTUVfSU5TUEVDVE9SJykgeyB0aGlzLm9wZW5JbnNwZWN0b3IoKTsgfQogIH0sCgogIG9wZW5JbnNwZWN0b3I6IGZ1bmN0aW9uIChmb2N1c0VsKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgc2NyaXB0OwoKICAgIC8vIEFscmVhZHkgaW5qZWN0ZWQuIE9wZW4uCiAgICBpZiAoQUZSQU1FLklOU1BFQ1RPUiB8fCBBRlJBTUUuaW5zcGVjdG9ySW5qZWN0ZWQpIHsKICAgICAgQUZSQU1FLklOU1BFQ1RPUi5vcGVuKGZvY3VzRWwpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5zaG93TG9hZGVyKCk7CgogICAgLy8gSW5qZWN0LgogICAgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICBzY3JpcHQuc3JjID0gdGhpcy5kYXRhLnVybDsKICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbmFtZScsICdhZnJhbWUtaW5zcGVjdG9yJyk7CiAgICBzY3JpcHQuc2V0QXR0cmlidXRlKEFGUkFNRV9JTkpFQ1RFRCwgJycpOwogICAgc2NyaXB0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgQUZSQU1FLklOU1BFQ1RPUi5vcGVuKGZvY3VzRWwpOwogICAgICBzZWxmLmhpZGVMb2FkZXIoKTsKICAgICAgc2VsZi5yZW1vdmVFdmVudExpc3RlbmVycygpOwogICAgfTsKICAgIHNjcmlwdC5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICBzZWxmLmxvYWRpbmdNZXNzYWdlRWwuaW5uZXJIVE1MID0gTE9BRElOR19FUlJPUl9NRVNTQUdFOwogICAgfTsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIEFGUkFNRS5pbnNwZWN0b3JJbmplY3RlZCA9IHRydWU7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleWRvd24pOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZSk7CiAgfQp9KTsKCn0pLmNhbGwodGhpcyxfZGVyZXFfKCdfcHJvY2VzcycpKQoKfSx7Ii4uLy4uLy4uL3BhY2thZ2UiOjU0LCIuLi8uLi9jb25zdGFudHMiOjk4LCIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi8uLi91dGlscy8iOjE3OSwiX3Byb2Nlc3MiOjV9XSw4MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uLy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciBzaG91bGRDYXB0dXJlS2V5RXZlbnQgPSBfZGVyZXFfKCcuLi8uLi91dGlscy8nKS5zaG91bGRDYXB0dXJlS2V5RXZlbnQ7Cgptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgna2V5Ym9hcmQtc2hvcnRjdXRzJywgewogIHNjaGVtYTogewogICAgZW50ZXJWUjoge2RlZmF1bHQ6IHRydWV9LAogICAgZXhpdFZSOiB7ZGVmYXVsdDogdHJ1ZX0KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9uS2V5dXAgPSB0aGlzLm9uS2V5dXAuYmluZCh0aGlzKTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHRoaXMuZW50ZXJWUkVuYWJsZWQgPSBkYXRhLmVudGVyVlI7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5vbktleXVwLCBmYWxzZSk7CiAgfSwKCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMub25LZXl1cCk7CiAgfSwKCiAgb25LZXl1cDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIHNjZW5lID0gdGhpcy5lbDsKICAgIGlmICghc2hvdWxkQ2FwdHVyZUtleUV2ZW50KGV2dCkpIHsgcmV0dXJuOyB9CiAgICBpZiAodGhpcy5lbnRlclZSRW5hYmxlZCAmJiBldnQua2V5Q29kZSA9PT0gNzApIHsgIC8vIGYuCiAgICAgIHNjZW5lLmVudGVyVlIoKTsKICAgIH0KICAgIGlmICh0aGlzLmVudGVyVlJFbmFibGVkICYmIGV2dC5rZXlDb2RlID09PSAyNykgeyAgLy8gZXNjYXBlLgogICAgICBzY2VuZS5leGl0VlIoKTsKICAgIH0KICB9Cn0pOwoKfSx7Ii4uLy4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uLy4uL3V0aWxzLyI6MTc5fV0sODM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZGVidWcgPSBfZGVyZXFfKCcuLi8uLi91dGlscy9kZWJ1ZycpOwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50OwoKdmFyIHdhcm4gPSBkZWJ1ZygnY29tcG9uZW50czpwb29sOndhcm4nKTsKCi8qKgogKiBQb29sIGNvbXBvbmVudCB0byByZXVzZSBlbnRpdGllcy4KICogQXZvaWRzIGNyZWF0aW5nIGFuZCBkZXN0cm95aW5nIHRoZSBzYW1lIGtpbmQgb2YgZW50aXRpZXMuCiAqIEhlbHBzIHJlZHVjZSBHQyBwYXVzZXMuIEZvciBleGFtcGxlIGluIGEgZ2FtZSB0byByZXVzZSBlbmVtaWVzIGVudGl0aWVzLgogKgogKiBAbWVtYmVyIHthcnJheX0gYXZhaWxhYmxlRWxzIC0gQXZhaWxhYmxlIGVudGl0aWVzIGluIHRoZSBwb29sLgogKiBAbWVtYmVyIHthcnJheX0gdXNlZEVscyAtIEVudGl0aWVzIG9mIHRoZSBwb29sIGluIHVzZS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdwb29sJywgewogIHNjaGVtYTogewogICAgY29udGFpbmVyOiB7ZGVmYXVsdDogJyd9LAogICAgbWl4aW46IHtkZWZhdWx0OiAnJ30sCiAgICBzaXplOiB7ZGVmYXVsdDogMH0sCiAgICBkeW5hbWljOiB7ZGVmYXVsdDogZmFsc2V9CiAgfSwKCiAgbXVsdGlwbGU6IHRydWUsCgogIGluaXRQb29sOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaTsKCiAgICB0aGlzLmF2YWlsYWJsZUVscyA9IFtdOwogICAgdGhpcy51c2VkRWxzID0gW107CgogICAgaWYgKCF0aGlzLmRhdGEubWl4aW4pIHsKICAgICAgd2FybignTm8gbWl4aW4gcHJvdmlkZWQgZm9yIHBvb2wgY29tcG9uZW50LicpOwogICAgfQoKICAgIGlmICh0aGlzLmRhdGEuY29udGFpbmVyKSB7CiAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLmRhdGEuY29udGFpbmVyKTsKICAgICAgaWYgKCF0aGlzLmNvbnRhaW5lcikgewogICAgICAgIHdhcm4oJ0NvbnRhaW5lciAnICsgdGhpcy5kYXRhLmNvbnRhaW5lciArICcgbm90IGZvdW5kLicpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyIHx8IHRoaXMuZWw7CgogICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZGF0YS5zaXplOyArK2kpIHsKICAgICAgdGhpcy5jcmVhdGVFbnRpdHkoKTsKICAgIH0KICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGlmIChvbGREYXRhLm1peGluICE9PSBkYXRhLm1peGluIHx8IG9sZERhdGEuc2l6ZSAhPT0gZGF0YS5zaXplKSB7CiAgICAgIHRoaXMuaW5pdFBvb2woKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBBZGQgYSBuZXcgZW50aXR5IHRvIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBlbnRpdGllcy4KICAgKi8KICBjcmVhdGVFbnRpdHk6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbDsKICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1lbnRpdHknKTsKICAgIGVsLnBsYXkgPSB0aGlzLndyYXBQbGF5KGVsLnBsYXkpOwogICAgZWwuc2V0QXR0cmlidXRlKCdtaXhpbicsIHRoaXMuZGF0YS5taXhpbik7CiAgICBlbC5vYmplY3QzRC52aXNpYmxlID0gZmFsc2U7CiAgICBlbC5wYXVzZSgpOwogICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoZWwpOwogICAgdGhpcy5hdmFpbGFibGVFbHMucHVzaChlbCk7CiAgfSwKCiAgLyoqCiAgICogUGxheSB3cmFwcGVyIGZvciBwb29sZWQgZW50aXRpZXMuIFdoZW4gcGF1c2luZyBhbmQgcGxheWluZyBhIHNjZW5lLCBkb24ndCB3YW50IHRvIHBsYXkKICAgKiBlbnRpdGllcyB0aGF0IGFyZSBub3QgaW4gdXNlLgogICAqLwogIHdyYXBQbGF5OiBmdW5jdGlvbiAocGxheU1ldGhvZCkgewogICAgdmFyIHVzZWRFbHMgPSB0aGlzLnVzZWRFbHM7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBpZiAodXNlZEVscy5pbmRleE9mKHRoaXMpID09PSAtMSkgeyByZXR1cm47IH0KICAgICAgcGxheU1ldGhvZC5jYWxsKHRoaXMpOwogICAgfTsKICB9LAoKICAvKioKICAgKiBVc2VkIHRvIHJlcXVlc3Qgb25lIG9mIHRoZSBhdmFpbGFibGUgZW50aXRpZXMgb2YgdGhlIHBvb2wuCiAgICovCiAgcmVxdWVzdEVudGl0eTogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsOwogICAgaWYgKHRoaXMuYXZhaWxhYmxlRWxzLmxlbmd0aCA9PT0gMCkgewogICAgICBpZiAodGhpcy5kYXRhLmR5bmFtaWMgPT09IGZhbHNlKSB7CiAgICAgICAgd2FybignUmVxdWVzdGVkIGVudGl0eSBmcm9tIGVtcHR5IHBvb2w6ICcgKyB0aGlzLmF0dHJOYW1lKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybignUmVxdWVzdGVkIGVudGl0eSBmcm9tIGVtcHR5IHBvb2wuIFRoaXMgcG9vbCBpcyBkeW5hbWljIGFuZCB3aWxsIHJlc2l6ZSAnICsKICAgICAgICAgICAgICdhdXRvbWF0aWNhbGx5LiBZb3UgbWlnaHQgd2FudCB0byBpbmNyZWFzZSBpdHMgaW5pdGlhbCBzaXplOiAnICsgdGhpcy5hdHRyTmFtZSk7CiAgICAgIH0KICAgICAgdGhpcy5jcmVhdGVFbnRpdHkoKTsKICAgIH0KICAgIGVsID0gdGhpcy5hdmFpbGFibGVFbHMuc2hpZnQoKTsKICAgIHRoaXMudXNlZEVscy5wdXNoKGVsKTsKICAgIGVsLm9iamVjdDNELnZpc2libGUgPSB0cnVlOwogICAgcmV0dXJuIGVsOwogIH0sCgogIC8qKgogICAqIFVzZWQgdG8gcmV0dXJuIGEgdXNlZCBlbnRpdHkgdG8gdGhlIHBvb2wuCiAgICovCiAgcmV0dXJuRW50aXR5OiBmdW5jdGlvbiAoZWwpIHsKICAgIHZhciBpbmRleCA9IHRoaXMudXNlZEVscy5pbmRleE9mKGVsKTsKICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgd2FybignVGhlIHJldHVybmVkIGVudGl0eSB3YXMgbm90IHByZXZpb3VzbHkgcG9vbGVkIGZyb20gJyArIHRoaXMuYXR0ck5hbWUpOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnVzZWRFbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgIHRoaXMuYXZhaWxhYmxlRWxzLnB1c2goZWwpOwogICAgZWwub2JqZWN0M0QudmlzaWJsZSA9IGZhbHNlOwogICAgZWwucGF1c2UoKTsKICAgIHJldHVybiBlbDsKICB9Cn0pOwoKfSx7Ii4uLy4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uLy4uL3V0aWxzL2RlYnVnIjoxNzV9XSw4NDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qIGdsb2JhbCBJbWFnZURhdGEsIFVSTCAqLwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi8uLi9saWIvdGhyZWUnKTsKCnZhciBWRVJURVhfU0hBREVSID0gWwogICdhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsnLAogICdhdHRyaWJ1dGUgdmVjMiB1djsnLAogICd1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsnLAogICd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCiAgJ3ZhcnlpbmcgdmVjMiB2VXY7JywKICAndm9pZCBtYWluKCkgIHsnLAogICcgIHZVdiA9IHZlYzIoIDEuLSB1di54LCB1di55ICk7JywKICAnICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7JywKICAnfScKXS5qb2luKCdcbicpOwoKdmFyIEZSQUdNRU5UX1NIQURFUiA9IFsKICAncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JywKICAndW5pZm9ybSBzYW1wbGVyQ3ViZSBtYXA7JywKICAndmFyeWluZyB2ZWMyIHZVdjsnLAogICcjZGVmaW5lIE1fUEkgMy4xNDE1OTI2NTM1ODk3OTMyMzg0NjI2NDMzODMyNzknLAogICd2b2lkIG1haW4oKSB7JywKICAnICB2ZWMyIHV2ID0gdlV2OycsCiAgJyAgZmxvYXQgbG9uZ2l0dWRlID0gdXYueCAqIDIuICogTV9QSSAtIE1fUEkgKyBNX1BJIC8gMi47JywKICAnICBmbG9hdCBsYXRpdHVkZSA9IHV2LnkgKiBNX1BJOycsCiAgJyAgdmVjMyBkaXIgPSB2ZWMzKCcsCiAgJyAgICAtIHNpbiggbG9uZ2l0dWRlICkgKiBzaW4oIGxhdGl0dWRlICksJywKICAnICAgIGNvcyggbGF0aXR1ZGUgKSwnLAogICcgICAgLSBjb3MoIGxvbmdpdHVkZSApICogc2luKCBsYXRpdHVkZSApJywKICAnICApOycsCiAgJyAgbm9ybWFsaXplKCBkaXIgKTsnLAogICcgIGdsX0ZyYWdDb2xvciA9IHZlYzQoIHRleHR1cmVDdWJlKCBtYXAsIGRpciApLnJnYiwgMS4wICk7JywKICAnfScKXS5qb2luKCdcbicpOwoKLyoqCiAqIENvbXBvbmVudCB0byB0YWtlIHNjcmVlbnNob3RzIG9mIHRoZSBzY2VuZSB1c2luZyBhIGtlYm9hcmQgc2hvcnRjdXQgKGFsdCtzKS4KICogSXQgY2FuIGJlIGNvbmZpZ3VyZWQgdG8gZWl0aGVyIHRha2UgMzYwJmRlZzsgY2FwdHVyZXMgKGBlcXVpcmVjdGFuZ3VsYXJgKQogKiBvciByZWd1bGFyIHNjcmVlbnNob3RzIChgcHJvamVjdGlvbmApCiAqCiAqIFRoaXMgaXMgYmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL3NwaXRlL1RIUkVFLkN1YmVtYXBUb0VxdWlyZWN0YW5ndWxhcgogKiBUbyBjYXB0dXJlIGFuIGVxdWlyZWN0YW5ndWxhciBwcm9qZWN0aW9uIG9mIHRoZSBzY2VuZSBhIFRIUkVFLkN1YmVDYW1lcmEgaXMgdXNlZAogKiBUaGUgY3ViZSBtYXAgcHJvZHVjZWQgYnkgdGhlIEN1YmVDYW1lcmEgaXMgcHJvamVjdGVkIG9uIGEgcXVhZCBhbmQgdGhlbiByZW5kZXJlZCB0bwogKiBXZWJHTFJlbmRlclRhcmdldCB3aXRoIGFuIG9ydG9ncmFwaGljIGNhbWVyYS4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCdzY3JlZW5zaG90JywgewogIHNjaGVtYTogewogICAgd2lkdGg6IHtkZWZhdWx0OiA0MDk2fSwKICAgIGhlaWdodDoge2RlZmF1bHQ6IDIwNDh9LAogICAgY2FtZXJhOiB7dHlwZTogJ3NlbGVjdG9yJ30KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIGlmIChlbC5yZW5kZXJlcikgewogICAgICBzZXR1cCgpOwogICAgfSBlbHNlIHsKICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigncmVuZGVyLXRhcmdldC1sb2FkZWQnLCBzZXR1cCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0dXAgKCkgewogICAgICB2YXIgZ2wgPSBlbC5yZW5kZXJlci5nZXRDb250ZXh0KCk7CiAgICAgIGlmICghZ2wpIHsgcmV0dXJuOyB9CiAgICAgIHNlbGYuY3ViZU1hcFNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuTUFYX0NVQkVfTUFQX1RFWFRVUkVfU0laRSk7CiAgICAgIHNlbGYubWF0ZXJpYWwgPSBuZXcgVEhSRUUuUmF3U2hhZGVyTWF0ZXJpYWwoewogICAgICAgIHVuaWZvcm1zOiB7bWFwOiB7dHlwZTogJ3QnLCB2YWx1ZTogbnVsbH19LAogICAgICAgIHZlcnRleFNoYWRlcjogVkVSVEVYX1NIQURFUiwKICAgICAgICBmcmFnbWVudFNoYWRlcjogRlJBR01FTlRfU0hBREVSLAogICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUKICAgICAgfSk7CiAgICAgIHNlbGYucXVhZCA9IG5ldyBUSFJFRS5NZXNoKAogICAgICAgIG5ldyBUSFJFRS5QbGFuZUJ1ZmZlckdlb21ldHJ5KDEsIDEpLAogICAgICAgIHNlbGYubWF0ZXJpYWwKICAgICAgKTsKICAgICAgc2VsZi5xdWFkLnZpc2libGUgPSBmYWxzZTsKICAgICAgc2VsZi5jYW1lcmEgPSBuZXcgVEhSRUUuT3J0aG9ncmFwaGljQ2FtZXJhKC0xIC8gMiwgMSAvIDIsIDEgLyAyLCAtMSAvIDIsIC0xMDAwMCwgMTAwMDApOwogICAgICBzZWxmLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBzZWxmLmN0eCA9IHNlbGYuY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGVsLm9iamVjdDNELmFkZChzZWxmLnF1YWQpOwogICAgICBzZWxmLm9uS2V5RG93biA9IHNlbGYub25LZXlEb3duLmJpbmQoc2VsZik7CiAgICB9CiAgfSwKCiAgZ2V0UmVuZGVyVGFyZ2V0OiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkgewogICAgcmV0dXJuIG5ldyBUSFJFRS5XZWJHTFJlbmRlclRhcmdldCh3aWR0aCwgaGVpZ2h0LCB7CiAgICAgIG1pbkZpbHRlcjogVEhSRUUuTGluZWFyRmlsdGVyLAogICAgICBtYWdGaWx0ZXI6IFRIUkVFLkxpbmVhckZpbHRlciwKICAgICAgd3JhcFM6IFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmcsCiAgICAgIHdyYXBUOiBUSFJFRS5DbGFtcFRvRWRnZVdyYXBwaW5nLAogICAgICBmb3JtYXQ6IFRIUkVFLlJHQkFGb3JtYXQsCiAgICAgIHR5cGU6IFRIUkVFLlVuc2lnbmVkQnl0ZVR5cGUKICAgIH0pOwogIH0sCgogIHJlc2l6ZTogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHsKICAgIC8vIFJlc2l6ZSBxdWFkLgogICAgdGhpcy5xdWFkLnNjYWxlLnNldCh3aWR0aCwgaGVpZ2h0LCAxKTsKCiAgICAvLyBSZXNpemUgY2FtZXJhLgogICAgdGhpcy5jYW1lcmEubGVmdCA9IC0xICogd2lkdGggLyAyOwogICAgdGhpcy5jYW1lcmEucmlnaHQgPSB3aWR0aCAvIDI7CiAgICB0aGlzLmNhbWVyYS50b3AgPSBoZWlnaHQgLyAyOwogICAgdGhpcy5jYW1lcmEuYm90dG9tID0gLTEgKiBoZWlnaHQgLyAyOwogICAgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIC8vIFJlc2l6ZSBjYW52YXMuCiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gaGVpZ2h0OwogIH0sCgogIHBsYXk6IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleURvd24pOwogIH0sCgogIC8qKgogICAqIDxjdHJsPiArIDxhbHQ+ICsgcyA9IFJlZ3VsYXIgc2NyZWVuc2hvdC4KICAgKiA8Y3RybD4gKyA8YWx0PiArIDxzaGlmdD4gKyBzID0gRXF1aXJlY3Rhbmd1bGFyIHNjcmVlbnNob3QuCiAgKi8KICBvbktleURvd246IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBzaG9ydGN1dFByZXNzZWQgPSBldnQua2V5Q29kZSA9PT0gODMgJiYgZXZ0LmN0cmxLZXkgJiYgZXZ0LmFsdEtleTsKICAgIGlmICghdGhpcy5kYXRhIHx8ICFzaG9ydGN1dFByZXNzZWQpIHsgcmV0dXJuOyB9CiAgICB2YXIgcHJvamVjdGlvbiA9IGV2dC5zaGlmdEtleSA/ICdlcXVpcmVjdGFuZ3VsYXInIDogJ3BlcnNwZWN0aXZlJzsKICAgIHRoaXMuY2FwdHVyZShwcm9qZWN0aW9uKTsKICB9LAoKICAvKioKICAgKiBDYXB0dXJlIGEgc2NyZWVuc2hvdCBvZiB0aGUgc2NlbmUuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvamVjdGlvbiAtIFNjcmVlbnNob3QgcHJvamVjdGlvbiAoZXF1aXJlY3Rhbmd1bGFyIG9yIHBlcnNwZWN0aXZlKS4KICAgKi8KICBzZXRDYXB0dXJlOiBmdW5jdGlvbiAocHJvamVjdGlvbikgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBzaXplOwogICAgdmFyIGNhbWVyYTsKICAgIHZhciBjdWJlQ2FtZXJhOwogICAgLy8gQ29uZmlndXJlIGNhbWVyYS4KICAgIGlmIChwcm9qZWN0aW9uID09PSAncGVyc3BlY3RpdmUnKSB7CiAgICAgIC8vIFF1YWQgaXMgb25seSB1c2VkIGluIGVxdWlyZWN0YW5ndWxhciBtb2RlLiBIaWRlIGl0IGluIHRoaXMgY2FzZS4KICAgICAgdGhpcy5xdWFkLnZpc2libGUgPSBmYWxzZTsKICAgICAgLy8gVXNlIHNjZW5lIGNhbWVyYS4KICAgICAgY2FtZXJhID0gKHRoaXMuZGF0YS5jYW1lcmEgJiYgdGhpcy5kYXRhLmNhbWVyYS5jb21wb25lbnRzLmNhbWVyYS5jYW1lcmEpIHx8IGVsLmNhbWVyYTsKICAgICAgc2l6ZSA9IHt3aWR0aDogdGhpcy5kYXRhLndpZHRoLCBoZWlnaHQ6IHRoaXMuZGF0YS5oZWlnaHR9OwogICAgfSBlbHNlIHsKICAgICAgLy8gVXNlIG9ydGhvIGNhbWVyYS4KICAgICAgY2FtZXJhID0gdGhpcy5jYW1lcmE7CiAgICAgIC8vIENyZWF0ZSBjdWJlIGNhbWVyYSBhbmQgY29weSBwb3NpdGlvbiBmcm9tIHNjZW5lIGNhbWVyYS4KICAgICAgY3ViZUNhbWVyYSA9IG5ldyBUSFJFRS5DdWJlQ2FtZXJhKGVsLmNhbWVyYS5uZWFyLCBlbC5jYW1lcmEuZmFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4odGhpcy5jdWJlTWFwU2l6ZSwgMjA0OCkpOwogICAgICAvLyBDb3B5IGNhbWVyYSBwb3NpdGlvbiBpbnRvIGN1YmUgY2FtZXJhOwogICAgICBlbC5jYW1lcmEuZ2V0V29ybGRQb3NpdGlvbihjdWJlQ2FtZXJhLnBvc2l0aW9uKTsKICAgICAgZWwuY2FtZXJhLmdldFdvcmxkUXVhdGVybmlvbihjdWJlQ2FtZXJhLnF1YXRlcm5pb24pOwogICAgICAvLyBSZW5kZXIgc2NlbmUgd2l0aCBjdWJlIGNhbWVyYS4KICAgICAgY3ViZUNhbWVyYS51cGRhdGUoZWwucmVuZGVyZXIsIGVsLm9iamVjdDNEKTsKICAgICAgdGhpcy5xdWFkLm1hdGVyaWFsLnVuaWZvcm1zLm1hcC52YWx1ZSA9IGN1YmVDYW1lcmEucmVuZGVyVGFyZ2V0LnRleHR1cmU7CiAgICAgIHNpemUgPSB7d2lkdGg6IHRoaXMuZGF0YS53aWR0aCwgaGVpZ2h0OiB0aGlzLmRhdGEuaGVpZ2h0fTsKICAgICAgLy8gVXNlIHF1YWQgdG8gcHJvamVjdCBpbWFnZSB0YWtlbiBieSB0aGUgY3ViZSBjYW1lcmEuCiAgICAgIHRoaXMucXVhZC52aXNpYmxlID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGNhbWVyYTogY2FtZXJhLAogICAgICBzaXplOiBzaXplLAogICAgICBwcm9qZWN0aW9uOiBwcm9qZWN0aW9uCiAgICB9OwogIH0sCgogIC8qKgogICAqIE1haW50YWluZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogICAqLwogIGNhcHR1cmU6IGZ1bmN0aW9uIChwcm9qZWN0aW9uKSB7CiAgICB2YXIgaXNWUkVuYWJsZWQgPSB0aGlzLmVsLnJlbmRlcmVyLnZyLmVuYWJsZWQ7CiAgICB2YXIgcmVuZGVyZXIgPSB0aGlzLmVsLnJlbmRlcmVyOwogICAgdmFyIHBhcmFtczsKICAgIC8vIERpc2FibGUgVlIuCiAgICByZW5kZXJlci52ci5lbmFibGVkID0gZmFsc2U7CiAgICBwYXJhbXMgPSB0aGlzLnNldENhcHR1cmUocHJvamVjdGlvbik7CiAgICB0aGlzLnJlbmRlckNhcHR1cmUocGFyYW1zLmNhbWVyYSwgcGFyYW1zLnNpemUsIHBhcmFtcy5wcm9qZWN0aW9uKTsKICAgIC8vIFRyaWdnZXIgZmlsZSBkb3dubG9hZC4KICAgIHRoaXMuc2F2ZUNhcHR1cmUoKTsKICAgIC8vIFJlc3RvcmUgVlIuCiAgICByZW5kZXJlci52ci5lbmFibGVkID0gaXNWUkVuYWJsZWQ7CiAgfSwKCiAgLyoqCiAgICogUmV0dXJuIGNhbnZhcyBpbnN0ZWFkIG9mIHRyaWdnZXJpbmcgZG93bmxvYWQgKGUuZy4sIGZvciB1cGxvYWRpbmcgYmxvYiB0byBzZXJ2ZXIpLgogICAqLwogIGdldENhbnZhczogZnVuY3Rpb24gKHByb2plY3Rpb24pIHsKICAgIHZhciBwYXJhbXMgPSB0aGlzLnNldENhcHR1cmUocHJvamVjdGlvbik7CiAgICB0aGlzLnJlbmRlckNhcHR1cmUocGFyYW1zLmNhbWVyYSwgcGFyYW1zLnNpemUsIHBhcmFtcy5wcm9qZWN0aW9uKTsKICAgIHJldHVybiB0aGlzLmNhbnZhczsKICB9LAoKICByZW5kZXJDYXB0dXJlOiBmdW5jdGlvbiAoY2FtZXJhLCBzaXplLCBwcm9qZWN0aW9uKSB7CiAgICB2YXIgYXV0b0NsZWFyID0gdGhpcy5lbC5yZW5kZXJlci5hdXRvQ2xlYXI7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGltYWdlRGF0YTsKICAgIHZhciBvdXRwdXQ7CiAgICB2YXIgcGl4ZWxzOwogICAgdmFyIHJlbmRlcmVyID0gZWwucmVuZGVyZXI7CiAgICAvLyBDcmVhdGUgcmVuZGVyaW5nIHRhcmdldCBhbmQgYnVmZmVyIHRvIHN0b3JlIHRoZSByZWFkIHBpeGVscy4KICAgIG91dHB1dCA9IHRoaXMuZ2V0UmVuZGVyVGFyZ2V0KHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTsKICAgIHBpeGVscyA9IG5ldyBVaW50OEFycmF5KDQgKiBzaXplLndpZHRoICogc2l6ZS5oZWlnaHQpOwogICAgLy8gUmVzaXplIHF1YWQsIGNhbWVyYSwgYW5kIGNhbnZhcy4KICAgIHRoaXMucmVzaXplKHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTsKICAgIC8vIFJlbmRlciBzY2VuZSB0byByZW5kZXIgdGFyZ2V0LgogICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gdHJ1ZTsKICAgIHJlbmRlcmVyLnJlbmRlcihlbC5vYmplY3QzRCwgY2FtZXJhLCBvdXRwdXQsIHRydWUpOwogICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gYXV0b0NsZWFyOwogICAgLy8gUmVhZCBpbWFnZSBwaXplbHMgYmFjay4KICAgIHJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHMob3V0cHV0LCAwLCAwLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCwgcGl4ZWxzKTsKICAgIGlmIChwcm9qZWN0aW9uID09PSAncGVyc3BlY3RpdmUnKSB7CiAgICAgIHBpeGVscyA9IHRoaXMuZmxpcFBpeGVsc1ZlcnRpY2FsbHkocGl4ZWxzLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCk7CiAgICB9CiAgICBpbWFnZURhdGEgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShwaXhlbHMpLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCk7CiAgICAvLyBIaWRlIHF1YWQgYWZ0ZXIgcHJvamVjdGluZyB0aGUgaW1hZ2UuCiAgICB0aGlzLnF1YWQudmlzaWJsZSA9IGZhbHNlOwogICAgLy8gQ29weSBwaXhlbHMgaW50byBjYW52YXMuCiAgICB0aGlzLmN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICB9LAoKICBmbGlwUGl4ZWxzVmVydGljYWxseTogZnVuY3Rpb24gKHBpeGVscywgd2lkdGgsIGhlaWdodCkgewogICAgdmFyIGZsaXBwZWRQaXhlbHMgPSBwaXhlbHMuc2xpY2UoMCk7CiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHsKICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkgewogICAgICAgIGZsaXBwZWRQaXhlbHNbeCAqIDQgKyB5ICogd2lkdGggKiA0XSA9IHBpeGVsc1t4ICogNCArIChoZWlnaHQgLSB5KSAqIHdpZHRoICogNF07CiAgICAgICAgZmxpcHBlZFBpeGVsc1t4ICogNCArIDEgKyB5ICogd2lkdGggKiA0XSA9IHBpeGVsc1t4ICogNCArIDEgKyAoaGVpZ2h0IC0geSkgKiB3aWR0aCAqIDRdOwogICAgICAgIGZsaXBwZWRQaXhlbHNbeCAqIDQgKyAyICsgeSAqIHdpZHRoICogNF0gPSBwaXhlbHNbeCAqIDQgKyAyICsgKGhlaWdodCAtIHkpICogd2lkdGggKiA0XTsKICAgICAgICBmbGlwcGVkUGl4ZWxzW3ggKiA0ICsgMyArIHkgKiB3aWR0aCAqIDRdID0gcGl4ZWxzW3ggKiA0ICsgMyArIChoZWlnaHQgLSB5KSAqIHdpZHRoICogNF07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmbGlwcGVkUGl4ZWxzOwogIH0sCgogIC8qKgogICAqIERvd25sb2FkIGNhcHR1cmUgdG8gZmlsZS4KICAgKi8KICBzYXZlQ2FwdHVyZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jYW52YXMudG9CbG9iKGZ1bmN0aW9uIChibG9iKSB7CiAgICAgIHZhciBmaWxlTmFtZSA9ICdzY3JlZW5zaG90LScgKyBkb2N1bWVudC50aXRsZS50b0xvd2VyQ2FzZSgpICsgJy0nICsgRGF0ZS5ub3coKSArICcucG5nJzsKICAgICAgdmFyIGxpbmtFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgdmFyIHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgIGxpbmtFbC5ocmVmID0gdXJsOwogICAgICBsaW5rRWwuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVOYW1lKTsKICAgICAgbGlua0VsLmlubmVySFRNTCA9ICdkb3dubG9hZGluZy4uLic7CiAgICAgIGxpbmtFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmtFbCk7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGxpbmtFbC5jbGljaygpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGlua0VsKTsKICAgICAgfSwgMSk7CiAgICB9LCAnaW1hZ2UvcG5nJyk7CiAgfQp9KTsKCn0seyIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi8uLi9saWIvdGhyZWUiOjE1NH1dLDg1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFJTdGF0cyA9IF9kZXJlcV8oJy4uLy4uLy4uL3ZlbmRvci9yU3RhdHMnKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vdXRpbHMnKTsKX2RlcmVxXygnLi4vLi4vLi4vdmVuZG9yL3JTdGF0cy5leHRyYXMnKTsKX2RlcmVxXygnLi4vLi4vbGliL3JTdGF0c0FmcmFtZScpOwoKdmFyIEFGcmFtZVN0YXRzID0gd2luZG93LmFmcmFtZVN0YXRzOwp2YXIgYmluZCA9IHV0aWxzLmJpbmQ7CnZhciBISURERU5fQ0xBU1MgPSAnYS1oaWRkZW4nOwp2YXIgVGhyZWVTdGF0cyA9IHdpbmRvdy50aHJlZVN0YXRzOwoKLyoqCiAqIFN0YXRzIGFwcGVuZGVkIHRvIGRvY3VtZW50LmJvZHkgYnkgUlN0YXRzLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3N0YXRzJywgewogIHNjaGVtYToge2RlZmF1bHQ6IHRydWV9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2NlbmUgPSB0aGlzLmVsOwoKICAgIGlmICh1dGlscy5nZXRVcmxQYXJhbWV0ZXIoJ3N0YXRzJykgPT09ICdmYWxzZScpIHsgcmV0dXJuOyB9CgogICAgdGhpcy5zdGF0cyA9IGNyZWF0ZVN0YXRzKHNjZW5lKTsKICAgIHRoaXMuc3RhdHNFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ycy1iYXNlJyk7CgogICAgdGhpcy5oaWRlQm91bmQgPSBiaW5kKHRoaXMuaGlkZSwgdGhpcyk7CiAgICB0aGlzLnNob3dCb3VuZCA9IGJpbmQodGhpcy5zaG93LCB0aGlzKTsKCiAgICBzY2VuZS5hZGRFdmVudExpc3RlbmVyKCdlbnRlci12cicsIHRoaXMuaGlkZUJvdW5kKTsKICAgIHNjZW5lLmFkZEV2ZW50TGlzdGVuZXIoJ2V4aXQtdnInLCB0aGlzLnNob3dCb3VuZCk7CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuc3RhdHMpIHsgcmV0dXJuOyB9CiAgICByZXR1cm4gKCF0aGlzLmRhdGEpID8gdGhpcy5oaWRlKCkgOiB0aGlzLnNob3coKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW50ZXItdnInLCB0aGlzLmhpZGVCb3VuZCk7CiAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2V4aXQtdnInLCB0aGlzLnNob3dCb3VuZCk7CiAgICBpZiAoIXRoaXMuc3RhdHNFbCkgeyByZXR1cm47IH0gIC8vIFNjZW5lIGRldGFjaGVkLgogICAgdGhpcy5zdGF0c0VsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zdGF0c0VsKTsKICB9LAoKICB0aWNrOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc3RhdHMgPSB0aGlzLnN0YXRzOwoKICAgIGlmICghc3RhdHMpIHsgcmV0dXJuOyB9CgogICAgc3RhdHMoJ3JBRicpLnRpY2soKTsKICAgIHN0YXRzKCdGUFMnKS5mcmFtZSgpOwogICAgc3RhdHMoKS51cGRhdGUoKTsKICB9LAoKICBoaWRlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnN0YXRzRWwuY2xhc3NMaXN0LmFkZChISURERU5fQ0xBU1MpOwogIH0sCgogIHNob3c6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc3RhdHNFbC5jbGFzc0xpc3QucmVtb3ZlKEhJRERFTl9DTEFTUyk7CiAgfQp9KTsKCmZ1bmN0aW9uIGNyZWF0ZVN0YXRzIChzY2VuZSkgewogIHZhciB0aHJlZVN0YXRzID0gbmV3IFRocmVlU3RhdHMoc2NlbmUucmVuZGVyZXIpOwogIHZhciBhZnJhbWVTdGF0cyA9IG5ldyBBRnJhbWVTdGF0cyhzY2VuZSk7CiAgdmFyIHBsdWdpbnMgPSBzY2VuZS5pc01vYmlsZSA/IFtdIDogW3RocmVlU3RhdHMsIGFmcmFtZVN0YXRzXTsKICByZXR1cm4gbmV3IFJTdGF0cyh7CiAgICBjc3M6IFtdLCAgLy8gT3VyIHN0eWxlc2hlZXQgaXMgaW5qZWN0ZWQgZnJvbSBgc3JjL2luZGV4LmpzYC4KICAgIHZhbHVlczogewogICAgICBmcHM6IHtjYXB0aW9uOiAnZnBzJywgYmVsb3c6IDMwfQogICAgfSwKICAgIGdyb3VwczogWwogICAgICB7Y2FwdGlvbjogJ0ZyYW1lcmF0ZScsIHZhbHVlczogWydmcHMnLCAncmFmJ119CiAgICBdLAogICAgcGx1Z2luczogcGx1Z2lucwogIH0pOwp9Cgp9LHsiLi4vLi4vLi4vdmVuZG9yL3JTdGF0cyI6MTg5LCIuLi8uLi8uLi92ZW5kb3IvclN0YXRzLmV4dHJhcyI6MTg4LCIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi8uLi9saWIvclN0YXRzQWZyYW1lIjoxNTMsIi4uLy4uL3V0aWxzIjoxNzl9XSw4NjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uLy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciBjb25zdGFudHMgPSBfZGVyZXFfKCcuLi8uLi9jb25zdGFudHMvJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uLy4uL3V0aWxzLycpOwp2YXIgYmluZCA9IHV0aWxzLmJpbmQ7Cgp2YXIgRU5URVJfVlJfQ0xBU1MgPSAnYS1lbnRlci12cic7CnZhciBFTlRFUl9WUl9CVE5fQ0xBU1MgPSAnYS1lbnRlci12ci1idXR0b24nOwp2YXIgSElEREVOX0NMQVNTID0gJ2EtaGlkZGVuJzsKdmFyIE9SSUVOVEFUSU9OX01PREFMX0NMQVNTID0gJ2Etb3JpZW50YXRpb24tbW9kYWwnOwoKLyoqCiAqIFVJIGZvciBlbnRlcmluZyBWUiBtb2RlLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3ZyLW1vZGUtdWknLCB7CiAgZGVwZW5kZW5jaWVzOiBbJ2NhbnZhcyddLAoKICBzY2hlbWE6IHsKICAgIGVuYWJsZWQ6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGVudGVyVlJCdXR0b246IHtkZWZhdWx0OiAnJ30KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWw7CgogICAgaWYgKHV0aWxzLmdldFVybFBhcmFtZXRlcigndWknKSA9PT0gJ2ZhbHNlJykgeyByZXR1cm47IH0KCiAgICB0aGlzLmluc2lkZUxvYWRlciA9IGZhbHNlOwogICAgdGhpcy5lbnRlclZSRWwgPSBudWxsOwogICAgdGhpcy5vcmllbnRhdGlvbk1vZGFsRWwgPSBudWxsOwogICAgdGhpcy5iaW5kTWV0aG9kcygpOwoKICAgIC8vIEhpZGUvc2hvdyBWUiBVSSB3aGVuIGVudGVyaW5nL2V4aXRpbmcgVlIgbW9kZS4KICAgIHNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignZW50ZXItdnInLCB0aGlzLnVwZGF0ZUVudGVyVlJJbnRlcmZhY2UpOwogICAgc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdleGl0LXZyJywgdGhpcy51cGRhdGVFbnRlclZSSW50ZXJmYWNlKTsKCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQuZGF0YS50eXBlID09PSAnbG9hZGVyUmVhZHknKSB7CiAgICAgICAgc2VsZi5pbnNpZGVMb2FkZXIgPSB0cnVlOwogICAgICAgIHNlbGYucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIE1vZGFsIHRoYXQgdGVsbHMgdGhlIHVzZXIgdG8gY2hhbmdlIG9yaWVudGF0aW9uIGlmIGluIHBvcnRyYWl0LgogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy50b2dnbGVPcmllbnRhdGlvbk1vZGFsSWZOZWVkZWQpOwogIH0sCgogIGJpbmRNZXRob2RzOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLm9uRW50ZXJWUkJ1dHRvbkNsaWNrID0gYmluZCh0aGlzLm9uRW50ZXJWUkJ1dHRvbkNsaWNrLCB0aGlzKTsKICAgIHRoaXMub25Nb2RhbENsaWNrID0gYmluZCh0aGlzLm9uTW9kYWxDbGljaywgdGhpcyk7CiAgICB0aGlzLnRvZ2dsZU9yaWVudGF0aW9uTW9kYWxJZk5lZWRlZCA9IGJpbmQodGhpcy50b2dnbGVPcmllbnRhdGlvbk1vZGFsSWZOZWVkZWQsIHRoaXMpOwogICAgdGhpcy51cGRhdGVFbnRlclZSSW50ZXJmYWNlID0gYmluZCh0aGlzLnVwZGF0ZUVudGVyVlJJbnRlcmZhY2UsIHRoaXMpOwogIH0sCgogIC8qKgogICAqIEV4aXQgVlIgd2hlbiBtb2RhbCBjbGlja2VkLgogICAqLwogIG9uTW9kYWxDbGljazogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbC5leGl0VlIoKTsKICB9LAoKICAvKioKICAgKiBFbnRlciBWUiB3aGVuIG1vZGFsIGNsaWNrZWQuCiAgICovCiAgb25FbnRlclZSQnV0dG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuZW50ZXJWUigpOwogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWw7CgogICAgaWYgKCFkYXRhLmVuYWJsZWQgfHwgdGhpcy5pbnNpZGVMb2FkZXIgfHwgdXRpbHMuZ2V0VXJsUGFyYW1ldGVyKCd1aScpID09PSAnZmFsc2UnKSB7CiAgICAgIHJldHVybiB0aGlzLnJlbW92ZSgpOwogICAgfQogICAgaWYgKHRoaXMuZW50ZXJWUkVsIHx8IHRoaXMub3JpZW50YXRpb25Nb2RhbEVsKSB7IHJldHVybjsgfQoKICAgIC8vIEFkZCBVSSBpZiBlbmFibGVkIGFuZCBub3QgYWxyZWFkeSBwcmVzZW50LgogICAgaWYgKGRhdGEuZW50ZXJWUkJ1dHRvbikgewogICAgICAvLyBDdXN0b20gYnV0dG9uLgogICAgICB0aGlzLmVudGVyVlJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZGF0YS5lbnRlclZSQnV0dG9uKTsKICAgICAgdGhpcy5lbnRlclZSRWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uRW50ZXJWUkJ1dHRvbkNsaWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZW50ZXJWUkVsID0gY3JlYXRlRW50ZXJWUkJ1dHRvbih0aGlzLm9uRW50ZXJWUkJ1dHRvbkNsaWNrKTsKICAgICAgc2NlbmVFbC5hcHBlbmRDaGlsZCh0aGlzLmVudGVyVlJFbCk7CiAgICB9CgogICAgdGhpcy5vcmllbnRhdGlvbk1vZGFsRWwgPSBjcmVhdGVPcmllbnRhdGlvbk1vZGFsKHRoaXMub25Nb2RhbENsaWNrKTsKICAgIHNjZW5lRWwuYXBwZW5kQ2hpbGQodGhpcy5vcmllbnRhdGlvbk1vZGFsRWwpOwoKICAgIHRoaXMudXBkYXRlRW50ZXJWUkludGVyZmFjZSgpOwogIH0sCgogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgW3RoaXMuZW50ZXJWUkVsLCB0aGlzLm9yaWVudGF0aW9uTW9kYWxFbF0uZm9yRWFjaChmdW5jdGlvbiAodWlFbGVtZW50KSB7CiAgICAgIGlmICh1aUVsZW1lbnQgJiYgdWlFbGVtZW50LnBhcmVudE5vZGUpIHsKICAgICAgICB1aUVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh1aUVsZW1lbnQpOwogICAgICB9CiAgICB9KTsKICB9LAoKICB1cGRhdGVFbnRlclZSSW50ZXJmYWNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnRvZ2dsZUVudGVyVlJCdXR0b25JZk5lZWRlZCgpOwogICAgdGhpcy50b2dnbGVPcmllbnRhdGlvbk1vZGFsSWZOZWVkZWQoKTsKICB9LAoKICB0b2dnbGVFbnRlclZSQnV0dG9uSWZOZWVkZWQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbDsKICAgIGlmICghdGhpcy5lbnRlclZSRWwpIHsgcmV0dXJuOyB9CiAgICBpZiAoc2NlbmVFbC5pcygndnItbW9kZScpKSB7CiAgICAgIHRoaXMuZW50ZXJWUkVsLmNsYXNzTGlzdC5hZGQoSElEREVOX0NMQVNTKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZW50ZXJWUkVsLmNsYXNzTGlzdC5yZW1vdmUoSElEREVOX0NMQVNTKTsKICAgIH0KICB9LAoKICB0b2dnbGVPcmllbnRhdGlvbk1vZGFsSWZOZWVkZWQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbDsKICAgIHZhciBvcmllbnRhdGlvbk1vZGFsRWwgPSB0aGlzLm9yaWVudGF0aW9uTW9kYWxFbDsKICAgIGlmICghb3JpZW50YXRpb25Nb2RhbEVsIHx8ICFzY2VuZUVsLmlzTW9iaWxlKSB7IHJldHVybjsgfQogICAgaWYgKCF1dGlscy5kZXZpY2UuaXNMYW5kc2NhcGUoKSAmJiBzY2VuZUVsLmlzKCd2ci1tb2RlJykpIHsKICAgICAgLy8gU2hvdyBpZiBpbiBWUiBtb2RlIG9uIHBvcnRyYWl0LgogICAgICBvcmllbnRhdGlvbk1vZGFsRWwuY2xhc3NMaXN0LnJlbW92ZShISURERU5fQ0xBU1MpOwogICAgfSBlbHNlIHsKICAgICAgb3JpZW50YXRpb25Nb2RhbEVsLmNsYXNzTGlzdC5hZGQoSElEREVOX0NMQVNTKTsKICAgIH0KICB9Cn0pOwoKLyoqCiAqIENyZWF0ZSBhIGJ1dHRvbiB0aGF0IHdoZW4gY2xpY2tlZCB3aWxsIGVudGVyIGludG8gc3RlcmVvLXJlbmRlcmluZyBtb2RlIGZvciBWUi4KICoKICogU3RydWN0dXJlOiA8ZGl2PjxidXR0b24+PC9kaXY+CiAqCiAqIEBwYXJhbSB7ZnVuY3Rpb259IG9uQ2xpY2sgLSBjbGljayBldmVudCBoYW5kbGVyCiAqIEByZXR1cm5zIHtFbGVtZW50fSBXcmFwcGVyIDxkaXY+LgogKi8KZnVuY3Rpb24gY3JlYXRlRW50ZXJWUkJ1dHRvbiAob25DbGljaykgewogIHZhciB2ckJ1dHRvbjsKICB2YXIgd3JhcHBlcjsKCiAgLy8gQ3JlYXRlIGVsZW1lbnRzLgogIHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoRU5URVJfVlJfQ0xBU1MpOwogIHdyYXBwZXIuc2V0QXR0cmlidXRlKGNvbnN0YW50cy5BRlJBTUVfSU5KRUNURUQsICcnKTsKICB2ckJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIHZyQnV0dG9uLmNsYXNzTmFtZSA9IEVOVEVSX1ZSX0JUTl9DTEFTUzsKICB2ckJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywKICAgICdFbnRlciBWUiBtb2RlIHdpdGggYSBoZWFkc2V0IG9yIGZ1bGxzY3JlZW4gbW9kZSBvbiBhIGRlc2t0b3AuICcgKwogICAgJ1Zpc2l0IGh0dHBzOi8vd2VidnIucm9ja3Mgb3IgaHR0cHM6Ly93ZWJ2ci5pbmZvIGZvciBtb3JlIGluZm9ybWF0aW9uLicpOwogIHZyQnV0dG9uLnNldEF0dHJpYnV0ZShjb25zdGFudHMuQUZSQU1FX0lOSkVDVEVELCAnJyk7CgogIC8vIEluc2VydCBlbGVtZW50cy4KICB3cmFwcGVyLmFwcGVuZENoaWxkKHZyQnV0dG9uKTsKICB2ckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldnQpIHsKICAgIG9uQ2xpY2soKTsKICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTsKICB9KTsKICByZXR1cm4gd3JhcHBlcjsKfQoKLyoqCiAqIENyZWF0ZXMgYSBtb2RhbCBkaWFsb2cgdG8gcmVxdWVzdCB0aGUgdXNlciB0byBzd2l0Y2ggdG8gbGFuZHNjYXBlIG9yaWVudGF0aW9uLgogKgogKiBAcGFyYW0ge2Z1bmN0aW9ufSBvbkNsaWNrIC0gY2xpY2sgZXZlbnQgaGFuZGxlcgogKiBAcmV0dXJucyB7RWxlbWVudH0gV3JhcHBlciA8ZGl2Pi4KICovCmZ1bmN0aW9uIGNyZWF0ZU9yaWVudGF0aW9uTW9kYWwgKG9uQ2xpY2spIHsKICB2YXIgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBtb2RhbC5jbGFzc05hbWUgPSBPUklFTlRBVElPTl9NT0RBTF9DTEFTUzsKICBtb2RhbC5jbGFzc0xpc3QuYWRkKEhJRERFTl9DTEFTUyk7CiAgbW9kYWwuc2V0QXR0cmlidXRlKGNvbnN0YW50cy5BRlJBTUVfSU5KRUNURUQsICcnKTsKCiAgdmFyIGV4aXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBleGl0LnNldEF0dHJpYnV0ZShjb25zdGFudHMuQUZSQU1FX0lOSkVDVEVELCAnJyk7CiAgZXhpdC5pbm5lckhUTUwgPSAnRXhpdCBWUic7CgogIC8vIEV4aXQgVlIgb24gY2xvc2UuCiAgZXhpdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xpY2spOwoKICBtb2RhbC5hcHBlbmRDaGlsZChleGl0KTsKCiAgcmV0dXJuIG1vZGFsOwp9Cgp9LHsiLi4vLi4vY29uc3RhbnRzLyI6OTgsIi4uLy4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uLy4uL3V0aWxzLyI6MTc5fV0sODc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgY29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciBiaW5kID0gX2RlcmVxXygnLi4vdXRpbHMvYmluZCcpOwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBjb21wb25lbnQucmVnaXN0ZXJDb21wb25lbnQ7CgovKioKICogU2hhZG93IGNvbXBvbmVudC4KICoKICogV2hlbiBhcHBsaWVkIHRvIGFuIGVudGl0eSwgdGhhdCBlbnRpdHkncyBnZW9tZXRyeSBhbmQgYW55IGRlc2NlbmRhbnRzIHdpbGwgY2FzdCBvciByZWNlaXZlCiAqIHNoYWRvd3MgYXMgc3BlY2lmaWVkIGJ5IHRoZSBgY2FzdGAgYW5kIGByZWNlaXZlYCBwcm9wZXJ0aWVzLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3NoYWRvdycsIHsKICBzY2hlbWE6IHsKICAgIGNhc3Q6IHtkZWZhdWx0OiB0cnVlfSwKICAgIHJlY2VpdmU6IHtkZWZhdWx0OiB0cnVlfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub25NZXNoQ2hhbmdlZCA9IGJpbmQodGhpcy51cGRhdGUsIHRoaXMpOwogICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdvYmplY3QzZHNldCcsIHRoaXMub25NZXNoQ2hhbmdlZCk7CiAgICB0aGlzLnN5c3RlbS5zZXRTaGFkb3dNYXBFbmFibGVkKHRydWUpOwogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB0aGlzLnVwZGF0ZURlc2NlbmRhbnRzKGRhdGEuY2FzdCwgZGF0YS5yZWNlaXZlKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdvYmplY3QzZHNldCcsIHRoaXMub25NZXNoQ2hhbmdlZCk7CiAgICB0aGlzLnVwZGF0ZURlc2NlbmRhbnRzKGZhbHNlLCBmYWxzZSk7CiAgfSwKCiAgdXBkYXRlRGVzY2VuZGFudHM6IGZ1bmN0aW9uIChjYXN0LCByZWNlaXZlKSB7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIHRoaXMuZWwub2JqZWN0M0QudHJhdmVyc2UoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgaWYgKCEobm9kZSBpbnN0YW5jZW9mIFRIUkVFLk1lc2gpKSB7IHJldHVybjsgfQoKICAgICAgbm9kZS5jYXN0U2hhZG93ID0gY2FzdDsKICAgICAgbm9kZS5yZWNlaXZlU2hhZG93ID0gcmVjZWl2ZTsKCiAgICAgIC8vIElmIHNjZW5lIGhhcyBhbHJlYWR5IHJlbmRlcmVkLCBtYXRlcmlhbHMgbXVzdCBiZSB1cGRhdGVkLgogICAgICBpZiAoc2NlbmVFbC5oYXNMb2FkZWQgJiYgbm9kZS5tYXRlcmlhbCkgewogICAgICAgIHZhciBtYXRlcmlhbHMgPSBBcnJheS5pc0FycmF5KG5vZGUubWF0ZXJpYWwpID8gbm9kZS5tYXRlcmlhbCA6IFtub2RlLm1hdGVyaWFsXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hdGVyaWFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbWF0ZXJpYWxzW2ldLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzL2JpbmQiOjE3M31dLDg4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIGRlYnVnID0gX2RlcmVxXygnLi4vdXRpbHMvZGVidWcnKTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgd2FybiA9IGRlYnVnKCdjb21wb25lbnRzOnNvdW5kOndhcm4nKTsKCi8qKgogKiBTb3VuZCBjb21wb25lbnQuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgnc291bmQnLCB7CiAgc2NoZW1hOiB7CiAgICBhdXRvcGxheToge2RlZmF1bHQ6IGZhbHNlfSwKICAgIGRpc3RhbmNlTW9kZWw6IHtkZWZhdWx0OiAnaW52ZXJzZScsIG9uZU9mOiBbJ2xpbmVhcicsICdpbnZlcnNlJywgJ2V4cG9uZW50aWFsJ119LAogICAgbG9vcDoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIG1heERpc3RhbmNlOiB7ZGVmYXVsdDogMTAwMDB9LAogICAgb246IHtkZWZhdWx0OiAnJ30sCiAgICBwb29sU2l6ZToge2RlZmF1bHQ6IDF9LAogICAgcG9zaXRpb25hbDoge2RlZmF1bHQ6IHRydWV9LAogICAgcmVmRGlzdGFuY2U6IHtkZWZhdWx0OiAxfSwKICAgIHJvbGxvZmZGYWN0b3I6IHtkZWZhdWx0OiAxfSwKICAgIHNyYzoge3R5cGU6ICdhdWRpbyd9LAogICAgdm9sdW1lOiB7ZGVmYXVsdDogMX0KICB9LAoKICBtdWx0aXBsZTogdHJ1ZSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgIHRoaXMubGlzdGVuZXIgPSBudWxsOwogICAgdGhpcy5hdWRpb0xvYWRlciA9IG5ldyBUSFJFRS5BdWRpb0xvYWRlcigpOwogICAgdGhpcy5wb29sID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgdGhpcy5tdXN0UGxheSA9IGZhbHNlOwoKICAgIC8vIERvbid0IHBhc3MgZXZ0IGJlY2F1c2UgcGxheVNvdW5kIHRha2VzIGEgZnVuY3Rpb24gYXMgcGFyYW1ldGVyLgogICAgdGhpcy5wbGF5U291bmRCb3VuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5wbGF5U291bmQoKTsgfTsKICB9LAoKICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBpOwogICAgdmFyIHNvdW5kOwogICAgdmFyIHNyY0NoYW5nZWQgPSBkYXRhLnNyYyAhPT0gb2xkRGF0YS5zcmM7CgogICAgLy8gQ3JlYXRlIG5ldyBzb3VuZCBpZiBub3QgeWV0IGNyZWF0ZWQgb3IgY2hhbmdpbmcgYHNyY2AuCiAgICBpZiAoc3JjQ2hhbmdlZCkgewogICAgICBpZiAoIWRhdGEuc3JjKSB7IHJldHVybjsgfQogICAgICB0aGlzLnNldHVwU291bmQoKTsKICAgIH0KCiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5wb29sLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNvdW5kID0gdGhpcy5wb29sLmNoaWxkcmVuW2ldOwogICAgICBpZiAoZGF0YS5wb3NpdGlvbmFsKSB7CiAgICAgICAgc291bmQuc2V0RGlzdGFuY2VNb2RlbChkYXRhLmRpc3RhbmNlTW9kZWwpOwogICAgICAgIHNvdW5kLnNldE1heERpc3RhbmNlKGRhdGEubWF4RGlzdGFuY2UpOwogICAgICAgIHNvdW5kLnNldFJlZkRpc3RhbmNlKGRhdGEucmVmRGlzdGFuY2UpOwogICAgICAgIHNvdW5kLnNldFJvbGxvZmZGYWN0b3IoZGF0YS5yb2xsb2ZmRmFjdG9yKTsKICAgICAgfQogICAgICBzb3VuZC5zZXRMb29wKGRhdGEubG9vcCk7CiAgICAgIHNvdW5kLnNldFZvbHVtZShkYXRhLnZvbHVtZSk7CiAgICAgIHNvdW5kLmlzUGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgaWYgKGRhdGEub24gIT09IG9sZERhdGEub24pIHsKICAgICAgdGhpcy51cGRhdGVFdmVudExpc3RlbmVyKG9sZERhdGEub24pOwogICAgfQoKICAgIC8vIEFsbCBzb3VuZCB2YWx1ZXMgc2V0LiBMb2FkIGluIGBzcmNgLgogICAgaWYgKHNyY0NoYW5nZWQpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdGhpcy5sb2FkZWQgPSBmYWxzZTsKICAgICAgdGhpcy5hdWRpb0xvYWRlci5sb2FkKGRhdGEuc3JjLCBmdW5jdGlvbiAoYnVmZmVyKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNlbGYucG9vbC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgc291bmQgPSBzZWxmLnBvb2wuY2hpbGRyZW5baV07CiAgICAgICAgICBzb3VuZC5zZXRCdWZmZXIoYnVmZmVyKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5sb2FkZWQgPSB0cnVlOwoKICAgICAgICAvLyBSZW1vdmUgdGhpcyBrZXkgZnJvbSBjYWNoZSwgb3RoZXJ3aXNlIHdlIGNhbid0IHBsYXkgaXQgYWdhaW4KICAgICAgICBUSFJFRS5DYWNoZS5yZW1vdmUoZGF0YS5zcmMpOwogICAgICAgIGlmIChzZWxmLmRhdGEuYXV0b3BsYXkgfHwgc2VsZi5tdXN0UGxheSkgeyBzZWxmLnBsYXlTb3VuZCgpOyB9CiAgICAgICAgc2VsZi5lbC5lbWl0KCdzb3VuZC1sb2FkZWQnLCBzZWxmLmV2dERldGFpbCwgZmFsc2UpOwogICAgICB9KTsKICAgIH0KICB9LAoKICBwYXVzZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5zdG9wU291bmQoKTsKICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigpOwogIH0sCgogIHBsYXk6IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmRhdGEuYXV0b3BsYXkpIHsgdGhpcy5wbGF5U291bmQoKTsgfQogICAgdGhpcy51cGRhdGVFdmVudExpc3RlbmVyKCk7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaTsKICAgIHZhciBzb3VuZDsKCiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoKTsKCiAgICBpZiAodGhpcy5lbC5nZXRPYmplY3QzRCh0aGlzLmF0dHJOYW1lKSkgewogICAgICB0aGlzLmVsLnJlbW92ZU9iamVjdDNEKHRoaXMuYXR0ck5hbWUpOwogICAgfQoKICAgIHRyeSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLnBvb2wuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb3VuZCA9IHRoaXMucG9vbC5jaGlsZHJlbltpXTsKICAgICAgICBzb3VuZC5kaXNjb25uZWN0KCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gZGlzY29ubmVjdCgpIHdpbGwgdGhyb3cgaWYgaXQgd2FzIG5ldmVyIGNvbm5lY3RlZCBpbml0aWFsbHkuCiAgICAgIHdhcm4oJ0F1ZGlvIHNvdXJjZSBub3QgcHJvcGVybHkgZGlzY29ubmVjdGVkJyk7CiAgICB9CiAgfSwKCiAgLyoqCiAgKiAgVXBkYXRlIGxpc3RlbmVyIGF0dGFjaGVkIHRvIHRoZSB1c2VyIGRlZmluZWQgb24gZXZlbnQuCiAgKi8KICB1cGRhdGVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAob2xkRXZ0KSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgaWYgKG9sZEV2dCkgeyBlbC5yZW1vdmVFdmVudExpc3RlbmVyKG9sZEV2dCwgdGhpcy5wbGF5U291bmRCb3VuZCk7IH0KICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5kYXRhLm9uLCB0aGlzLnBsYXlTb3VuZEJvdW5kKTsKICB9LAoKICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5kYXRhLm9uLCB0aGlzLnBsYXlTb3VuZEJvdW5kKTsKICB9LAoKICAvKioKICAgKiBSZW1vdmVzIGN1cnJlbnQgc291bmQgb2JqZWN0LCBjcmVhdGVzIG5ldyBzb3VuZCBvYmplY3QsIGFkZHMgdG8gZW50aXR5LgogICAqCiAgICogQHJldHVybnMge29iamVjdH0gc291bmQKICAgKi8KICBzZXR1cFNvdW5kOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGk7CiAgICB2YXIgc2NlbmVFbCA9IGVsLnNjZW5lRWw7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgc291bmQ7CgogICAgaWYgKHRoaXMucG9vbC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMuc3RvcFNvdW5kKCk7CiAgICAgIGVsLnJlbW92ZU9iamVjdDNEKCdzb3VuZCcpOwogICAgfQoKICAgIC8vIE9ubHkgd2FudCBvbmUgQXVkaW9MaXN0ZW5lci4gQ2FjaGUgaXQgb24gdGhlIHNjZW5lLgogICAgdmFyIGxpc3RlbmVyID0gdGhpcy5saXN0ZW5lciA9IHNjZW5lRWwuYXVkaW9MaXN0ZW5lciB8fCBuZXcgVEhSRUUuQXVkaW9MaXN0ZW5lcigpOwogICAgc2NlbmVFbC5hdWRpb0xpc3RlbmVyID0gbGlzdGVuZXI7CgogICAgaWYgKHNjZW5lRWwuY2FtZXJhKSB7CiAgICAgIHNjZW5lRWwuY2FtZXJhLmFkZChsaXN0ZW5lcik7CiAgICB9CgogICAgLy8gV2FpdCBmb3IgY2FtZXJhIGlmIG5lY2Vzc2FyeS4KICAgIHNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignY2FtZXJhLXNldC1hY3RpdmUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGV2dC5kZXRhaWwuY2FtZXJhRWwuZ2V0T2JqZWN0M0QoJ2NhbWVyYScpLmFkZChsaXN0ZW5lcik7CiAgICB9KTsKCiAgICAvLyBDcmVhdGUgW3Bvb2xTaXplXSBhdWRpbyBpbnN0YW5jZXMgYW5kIGF0dGFjaCB0aGVtIHRvIHBvb2wKICAgIHRoaXMucG9vbCA9IG5ldyBUSFJFRS5Hcm91cCgpOwogICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZGF0YS5wb29sU2l6ZTsgaSsrKSB7CiAgICAgIHNvdW5kID0gdGhpcy5kYXRhLnBvc2l0aW9uYWwKICAgICAgICA/IG5ldyBUSFJFRS5Qb3NpdGlvbmFsQXVkaW8obGlzdGVuZXIpCiAgICAgICAgOiBuZXcgVEhSRUUuQXVkaW8obGlzdGVuZXIpOwogICAgICB0aGlzLnBvb2wuYWRkKHNvdW5kKTsKICAgIH0KICAgIGVsLnNldE9iamVjdDNEKHRoaXMuYXR0ck5hbWUsIHRoaXMucG9vbCk7CgogICAgZm9yIChpID0gMDsgaSA8IHRoaXMucG9vbC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICBzb3VuZCA9IHRoaXMucG9vbC5jaGlsZHJlbltpXTsKICAgICAgc291bmQub25FbmRlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlOwogICAgICAgIHNlbGYuZWwuZW1pdCgnc291bmQtZW5kZWQnLCBzZWxmLmV2dERldGFpbCwgZmFsc2UpOwogICAgICB9OwogICAgfQogIH0sCgogIC8qKgogICAqIFBhdXNlIGFsbCB0aGUgc291bmRzIGluIHRoZSBwb29sLgogICAqLwogIHBhdXNlU291bmQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBpOwogICAgdmFyIHNvdW5kOwoKICAgIHRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5wb29sLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNvdW5kID0gdGhpcy5wb29sLmNoaWxkcmVuW2ldOwogICAgICBpZiAoIXNvdW5kLnNvdXJjZSB8fCAhc291bmQuc291cmNlLmJ1ZmZlciB8fCAhc291bmQuaXNQbGF5aW5nIHx8IHNvdW5kLmlzUGF1c2VkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc291bmQuaXNQYXVzZWQgPSB0cnVlOwogICAgICBzb3VuZC5wYXVzZSgpOwogICAgfQogIH0sCgogIC8qKgogICAqIExvb2sgZm9yIGFuIHVudXNlZCBzb3VuZCBpbiB0aGUgcG9vbCBhbmQgcGxheSBpdCBpZiBmb3VuZC4KICAgKi8KICBwbGF5U291bmQ6IGZ1bmN0aW9uIChwcm9jZXNzU291bmQpIHsKICAgIHZhciBmb3VuZDsKICAgIHZhciBpOwogICAgdmFyIHNvdW5kOwoKICAgIGlmICghdGhpcy5sb2FkZWQpIHsKICAgICAgd2FybignU291bmQgbm90IGxvYWRlZCB5ZXQuIEl0IHdpbGwgYmUgcGxheWVkIG9uY2UgaXQgZmluaXNoZWQgbG9hZGluZycpOwogICAgICB0aGlzLm11c3RQbGF5ID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZvdW5kID0gZmFsc2U7CiAgICB0aGlzLmlzUGxheWluZyA9IHRydWU7CiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5wb29sLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNvdW5kID0gdGhpcy5wb29sLmNoaWxkcmVuW2ldOwogICAgICBpZiAoIXNvdW5kLmlzUGxheWluZyAmJiBzb3VuZC5idWZmZXIgJiYgIWZvdW5kKSB7CiAgICAgICAgaWYgKHByb2Nlc3NTb3VuZCkgeyBwcm9jZXNzU291bmQoc291bmQpOyB9CiAgICAgICAgc291bmQucGxheSgpOwogICAgICAgIHNvdW5kLmlzUGF1c2VkID0gZmFsc2U7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CgogICAgaWYgKCFmb3VuZCkgewogICAgICB3YXJuKCdBbGwgdGhlIHNvdW5kcyBhcmUgcGxheWluZy4gSWYgeW91IG5lZWQgdG8gcGxheSBtb3JlIHNvdW5kcyBzaW11bHRhbmVvdXNseSAnICsKICAgICAgICAgICAnY29uc2lkZXIgaW5jcmVhc2luZyB0aGUgc2l6ZSBvZiBwb29sIHdpdGggdGhlIGBwb29sU2l6ZWAgYXR0cmlidXRlLicsIHRoaXMuZWwpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5tdXN0UGxheSA9IGZhbHNlOwogIH0sCgogIC8qKgogICAqIFN0b3AgYWxsIHRoZSBzb3VuZHMgaW4gdGhlIHBvb2wuCiAgICovCiAgc3RvcFNvdW5kOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaTsKICAgIHZhciBzb3VuZDsKICAgIHRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5wb29sLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNvdW5kID0gdGhpcy5wb29sLmNoaWxkcmVuW2ldOwogICAgICBpZiAoIXNvdW5kLnNvdXJjZSB8fCAhc291bmQuc291cmNlLmJ1ZmZlcikgeyByZXR1cm47IH0KICAgICAgc291bmQuc3RvcCgpOwogICAgfQogIH0KfSk7Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzL2RlYnVnIjoxNzV9XSw4OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBjcmVhdGVUZXh0R2VvbWV0cnkgPSBfZGVyZXFfKCd0aHJlZS1ibWZvbnQtdGV4dCcpOwp2YXIgbG9hZEJNRm9udCA9IF9kZXJlcV8oJ2xvYWQtYm1mb250Jyk7Cgp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgY29yZVNoYWRlciA9IF9kZXJlcV8oJy4uL2NvcmUvc2hhZGVyJyk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi91dGlscy8nKTsKCnZhciBlcnJvciA9IHV0aWxzLmRlYnVnKCdjb21wb25lbnRzOnRleHQ6ZXJyb3InKTsKdmFyIHNoYWRlcnMgPSBjb3JlU2hhZGVyLnNoYWRlcnM7CnZhciB3YXJuID0gdXRpbHMuZGVidWcoJ2NvbXBvbmVudHM6dGV4dDp3YXJuJyk7CgovLyAxIHRvIG1hdGNoIG90aGVyIEEtRnJhbWUgZGVmYXVsdCB3aWR0aHMuCnZhciBERUZBVUxUX1dJRFRIID0gMTsKCi8vIEBicnlpayBzZXQgYW5pc290cm9weSB0byAxNi4gSW1wcm92ZXMgbG9vayBvZiBsYXJnZSBhbW91bnRzIG9mIHRleHQgd2hlbiB2aWV3ZWQgZnJvbSBhbmdsZS4KdmFyIE1BWF9BTklTT1RST1BZID0gMTY7Cgp2YXIgRk9OVF9CQVNFX1VSTCA9ICdodHRwczovL2Nkbi5hZnJhbWUuaW8vZm9udHMvJzsKdmFyIEZPTlRTID0gewogIGFpbGVyb25zZW1pYm9sZDogRk9OVF9CQVNFX1VSTCArICdBaWxlcm9uLVNlbWlib2xkLmZudCcsCiAgZGVqYXZ1OiBGT05UX0JBU0VfVVJMICsgJ0RlamFWdS1zZGYuZm50JywKICBleG8yYm9sZDogRk9OVF9CQVNFX1VSTCArICdFeG8yQm9sZC5mbnQnLAogIGV4bzJzZW1pYm9sZDogRk9OVF9CQVNFX1VSTCArICdFeG8yU2VtaUJvbGQuZm50JywKICBrZWxzb25zYW5zOiBGT05UX0JBU0VfVVJMICsgJ0tlbHNvblNhbnMuZm50JywKICBtb25vaWQ6IEZPTlRfQkFTRV9VUkwgKyAnTW9ub2lkLmZudCcsCiAgbW96aWxsYXZyOiBGT05UX0JBU0VfVVJMICsgJ21vemlsbGF2ci5mbnQnLAogIHJvYm90bzogRk9OVF9CQVNFX1VSTCArICdSb2JvdG8tbXNkZi5qc29uJywKICBzb3VyY2Vjb2RlcHJvOiBGT05UX0JBU0VfVVJMICsgJ1NvdXJjZUNvZGVQcm8uZm50Jwp9Owp2YXIgTVNERl9GT05UUyA9IFsncm9ib3RvJ107CnZhciBERUZBVUxUX0ZPTlQgPSAncm9ib3RvJzsKbW9kdWxlLmV4cG9ydHMuRk9OVFMgPSBGT05UUzsKCnZhciBjYWNoZSA9IG5ldyBQcm9taXNlQ2FjaGUoKTsKdmFyIGZvbnRXaWR0aEZhY3RvcnMgPSB7fTsKdmFyIHRleHR1cmVzID0ge307CgovLyBSZWd1bGFyIGV4cHJlc3Npb24gZm9yIGRldGVjdGluZyBhIFVSTHMgd2l0aCBhIHByb3RvY29sIHByZWZpeC4KdmFyIHByb3RvY29sUmUgPSAvXlx3KzovOwoKLyoqCiAqIFNERi1iYXNlZCB0ZXh0IGNvbXBvbmVudC4KICogQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL0phbTMvdGhyZWUtYm1mb250LXRleHQuCiAqCiAqIEFsbCB0aGUgc3RvY2sgZm9udHMgYXJlIGZvciB0aGUgYHNkZmAgcmVnaXN0ZXJlZCBzaGFkZXIsIGFuIGltcHJvdmVkIHZlcnNpb24gb2YgamFtMydzCiAqIG9yaWdpbmFsIGBzZGZgIHNoYWRlci4KICovCm1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IHJlZ2lzdGVyQ29tcG9uZW50KCd0ZXh0JywgewogIG11bHRpcGxlOiB0cnVlLAoKICBzY2hlbWE6IHsKICAgIGFsaWduOiB7dHlwZTogJ3N0cmluZycsIGRlZmF1bHQ6ICdsZWZ0Jywgb25lT2Y6IFsnbGVmdCcsICdyaWdodCcsICdjZW50ZXInXX0sCiAgICBhbHBoYVRlc3Q6IHtkZWZhdWx0OiAwLjV9LAogICAgLy8gYGFuY2hvcmAgZGVmYXVsdHMgdG8gY2VudGVyIHRvIG1hdGNoIGdlb21ldHJpZXMuCiAgICBhbmNob3I6IHtkZWZhdWx0OiAnY2VudGVyJywgb25lT2Y6IFsnbGVmdCcsICdyaWdodCcsICdjZW50ZXInLCAnYWxpZ24nXX0sCiAgICBiYXNlbGluZToge2RlZmF1bHQ6ICdjZW50ZXInLCBvbmVPZjogWyd0b3AnLCAnY2VudGVyJywgJ2JvdHRvbSddfSwKICAgIGNvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyNGRkYnfSwKICAgIGZvbnQ6IHt0eXBlOiAnc3RyaW5nJywgZGVmYXVsdDogREVGQVVMVF9GT05UfSwKICAgIC8vIGBmb250SW1hZ2VgIGRlZmF1bHRzIHRvIHRoZSBmb250IG5hbWUgYXMgYSAucG5nIChlLmcuLCBtb3ppbGxhdnIuZm50IC0+IG1vemlsbGF2ci5wbmcpLgogICAgZm9udEltYWdlOiB7dHlwZTogJ3N0cmluZyd9LAogICAgLy8gYGhlaWdodGAgaGFzIG5vIGRlZmF1bHQsIHdpbGwgYmUgcG9wdWxhdGVkIGF0IGxheW91dC4KICAgIGhlaWdodDoge3R5cGU6ICdudW1iZXInfSwKICAgIGxldHRlclNwYWNpbmc6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogMH0sCiAgICAvLyBgbGluZUhlaWdodGAgZGVmYXVsdHMgdG8gZm9udCdzIGBsaW5lSGVpZ2h0YCB2YWx1ZS4KICAgIGxpbmVIZWlnaHQ6IHt0eXBlOiAnbnVtYmVyJ30sCiAgICAvLyBgbmVnYXRlYCBtdXN0IGJlIHRydWUgZm9yIGZvbnRzIGdlbmVyYXRlZCB3aXRoIG9sZGVyIHZlcnNpb25zIG9mIG1zZGZnZW4gKHdoaXRlIGJhY2tncm91bmQpLgogICAgbmVnYXRlOiB7dHlwZTogJ2Jvb2xlYW4nLCBkZWZhdWx0OiB0cnVlfSwKICAgIG9wYWNpdHk6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogMS4wfSwKICAgIHNoYWRlcjoge2RlZmF1bHQ6ICdzZGYnLCBvbmVPZjogc2hhZGVyc30sCiAgICBzaWRlOiB7ZGVmYXVsdDogJ2Zyb250Jywgb25lT2Y6IFsnZnJvbnQnLCAnYmFjaycsICdkb3VibGUnXX0sCiAgICB0YWJTaXplOiB7ZGVmYXVsdDogNH0sCiAgICB0cmFuc3BhcmVudDoge2RlZmF1bHQ6IHRydWV9LAogICAgdmFsdWU6IHt0eXBlOiAnc3RyaW5nJ30sCiAgICB3aGl0ZVNwYWNlOiB7ZGVmYXVsdDogJ25vcm1hbCcsIG9uZU9mOiBbJ25vcm1hbCcsICdwcmUnLCAnbm93cmFwJ119LAogICAgLy8gYHdpZHRoYCBkZWZhdWx0cyB0byBnZW9tZXRyeSB3aWR0aCBpZiBwcmVzZW50LCBlbHNlIGBERUZBVUxUX1dJRFRIYC4KICAgIHdpZHRoOiB7dHlwZTogJ251bWJlcid9LAogICAgLy8gYHdyYXBDb3VudGAgdW5pdHMgYXJlIGFib3V0IG9uZSBkZWZhdWx0IGZvbnQgY2hhcmFjdGVyLiBXcmFwIHJvdWdobHkgYXQgdGhpcyBudW1iZXIuCiAgICB3cmFwQ291bnQ6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogNDB9LAogICAgLy8gYHdyYXBQaXhlbHNgIHdpbGwgd3JhcCB1c2luZyBibWZvbnQgcGl4ZWwgdW5pdHMgKGUuZy4sIGRlamF2dSdzIGlzIDMyIHBpeGVscykuCiAgICB3cmFwUGl4ZWxzOiB7dHlwZTogJ251bWJlcid9LAogICAgLy8gYHhPZmZzZXRgIHRvIGFkZCBwYWRkaW5nLgogICAgeE9mZnNldDoge3R5cGU6ICdudW1iZXInLCBkZWZhdWx0OiAwfSwKICAgIC8vIGB5T2Zmc2V0YCB0byBhZGp1c3QgZ2VuZXJhdGVkIGZvbnRzIGZyb20gdG9vbHMgdGhhdCBtYXkgaGF2ZSBpbmNvcnJlY3QgbWV0cmljcy4KICAgIHlPZmZzZXQ6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogMH0sCiAgICAvLyBgek9mZnNldGAgd2lsbCBwcm92aWRlIGEgc21hbGwgeiBvZmZzZXQgdG8gYXZvaWQgei1maWdodGluZy4KICAgIHpPZmZzZXQ6IHt0eXBlOiAnbnVtYmVyJywgZGVmYXVsdDogMC4wMDF9CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5zaGFkZXJEYXRhID0ge307CiAgICB0aGlzLmdlb21ldHJ5ID0gY3JlYXRlVGV4dEdlb21ldHJ5KCk7CiAgICB0aGlzLmNyZWF0ZU9yVXBkYXRlTWF0ZXJpYWwoKTsKICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKHRoaXMuZ2VvbWV0cnksIHRoaXMubWF0ZXJpYWwpOwogICAgdGhpcy5lbC5zZXRPYmplY3QzRCh0aGlzLmF0dHJOYW1lLCB0aGlzLm1lc2gpOwogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKG9sZERhdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGZvbnQgPSB0aGlzLmN1cnJlbnRGb250OwoKICAgIGlmICh0ZXh0dXJlc1tkYXRhLmZvbnRdKSB7CiAgICAgIHRoaXMudGV4dHVyZSA9IHRleHR1cmVzW2RhdGEuZm9udF07CiAgICB9IGVsc2UgewogICAgICAvLyBDcmVhdGUgdGV4dHVyZSBwZXIgZm9udC4KICAgICAgdGhpcy50ZXh0dXJlID0gdGV4dHVyZXNbZGF0YS5mb250XSA9IG5ldyBUSFJFRS5UZXh0dXJlKCk7CiAgICAgIHRoaXMudGV4dHVyZS5hbmlzb3Ryb3B5ID0gTUFYX0FOSVNPVFJPUFk7CiAgICB9CgogICAgLy8gVXBkYXRlIG1hdGVyaWFsLgogICAgdGhpcy5jcmVhdGVPclVwZGF0ZU1hdGVyaWFsKCk7CgogICAgLy8gTmV3IGZvbnQuIGB1cGRhdGVGb250YCB3aWxsIGxhdGVyIGNoYW5nZSBkYXRhIGFuZCBsYXlvdXQuCiAgICBpZiAob2xkRGF0YS5mb250ICE9PSBkYXRhLmZvbnQpIHsKICAgICAgdGhpcy51cGRhdGVGb250KCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBVcGRhdGUgZ2VvbWV0cnkgYW5kIGxheW91dC4KICAgIGlmIChmb250KSB7CiAgICAgIHRoaXMudXBkYXRlR2VvbWV0cnkodGhpcy5nZW9tZXRyeSwgZm9udCk7CiAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogQ2xlYW4gdXAgZ2VvbWV0cnksIG1hdGVyaWFsLCB0ZXh0dXJlLCBtZXNoLCBvYmplY3RzLgogICAqLwogIHJlbW92ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CiAgICB0aGlzLmdlb21ldHJ5ID0gbnVsbDsKICAgIHRoaXMuZWwucmVtb3ZlT2JqZWN0M0QodGhpcy5hdHRyTmFtZSk7CiAgICB0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKICAgIHRoaXMubWF0ZXJpYWwgPSBudWxsOwogICAgdGhpcy50ZXh0dXJlLmRpc3Bvc2UoKTsKICAgIHRoaXMudGV4dHVyZSA9IG51bGw7CiAgICBpZiAodGhpcy5zaGFkZXJPYmplY3QpIHsKICAgICAgZGVsZXRlIHRoaXMuc2hhZGVyT2JqZWN0OwogICAgfQogIH0sCgogIC8qKgogICAqIFVwZGF0ZSB0aGUgc2hhZGVyIG9mIHRoZSBtYXRlcmlhbC4KICAgKi8KICBjcmVhdGVPclVwZGF0ZU1hdGVyaWFsOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBoYXNDaGFuZ2VkU2hhZGVyOwogICAgdmFyIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIHZhciBOZXdTaGFkZXI7CiAgICB2YXIgc2hhZGVyRGF0YSA9IHRoaXMuc2hhZGVyRGF0YTsKICAgIHZhciBzaGFkZXJOYW1lOwoKICAgIC8vIEluZmVyIHNoYWRlciBpZiB1c2luZyBhIHN0b2NrIGZvbnQgKG9yIGZyb20gYC1tc2RmYCBmaWxlbmFtZSBjb252ZW50aW9uKS4KICAgIHNoYWRlck5hbWUgPSBkYXRhLnNoYWRlcjsKICAgIGlmIChNU0RGX0ZPTlRTLmluZGV4T2YoZGF0YS5mb250KSAhPT0gLTEgfHwgZGF0YS5mb250LmluZGV4T2YoJy1tc2RmLicpID49IDApIHsKICAgICAgc2hhZGVyTmFtZSA9ICdtc2RmJzsKICAgIH0gZWxzZSBpZiAoZGF0YS5mb250IGluIEZPTlRTICYmIE1TREZfRk9OVFMuaW5kZXhPZihkYXRhLmZvbnQpID09PSAtMSkgewogICAgICBzaGFkZXJOYW1lID0gJ3NkZic7CiAgICB9CgogICAgaGFzQ2hhbmdlZFNoYWRlciA9ICh0aGlzLnNoYWRlck9iamVjdCAmJiB0aGlzLnNoYWRlck9iamVjdC5uYW1lKSAhPT0gc2hhZGVyTmFtZTsKCiAgICBzaGFkZXJEYXRhLmFscGhhVGVzdCA9IGRhdGEuYWxwaGFUZXN0OwogICAgc2hhZGVyRGF0YS5jb2xvciA9IGRhdGEuY29sb3I7CiAgICBzaGFkZXJEYXRhLm1hcCA9IHRoaXMudGV4dHVyZTsKICAgIHNoYWRlckRhdGEub3BhY2l0eSA9IGRhdGEub3BhY2l0eTsKICAgIHNoYWRlckRhdGEuc2lkZSA9IHBhcnNlU2lkZShkYXRhLnNpZGUpOwogICAgc2hhZGVyRGF0YS50cmFuc3BhcmVudCA9IGRhdGEudHJhbnNwYXJlbnQ7CiAgICBzaGFkZXJEYXRhLm5lZ2F0ZSA9IGRhdGEubmVnYXRlOwoKICAgIC8vIFNoYWRlciBoYXMgbm90IGNoYW5nZWQsIGRvIGFuIHVwZGF0ZS4KICAgIGlmICghaGFzQ2hhbmdlZFNoYWRlcikgewogICAgICAvLyBVcGRhdGUgc2hhZGVyIG1hdGVyaWFsLgogICAgICB0aGlzLnNoYWRlck9iamVjdC51cGRhdGUoc2hhZGVyRGF0YSk7CiAgICAgIC8vIEFwcGFyZW50bHksIHdhcyBub3Qgc2V0IG9uIGBpbml0YCBub3IgYHVwZGF0ZWAuCiAgICAgIG1hdGVyaWFsLnRyYW5zcGFyZW50ID0gc2hhZGVyRGF0YS50cmFuc3BhcmVudDsKICAgICAgbWF0ZXJpYWwuc2lkZSA9IHNoYWRlckRhdGEuc2lkZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFNoYWRlciBoYXMgY2hhbmdlZC4gQ3JlYXRlIGEgc2hhZGVyIG1hdGVyaWFsLgogICAgTmV3U2hhZGVyID0gY3JlYXRlU2hhZGVyKHRoaXMuZWwsIHNoYWRlck5hbWUsIHNoYWRlckRhdGEpOwogICAgdGhpcy5tYXRlcmlhbCA9IE5ld1NoYWRlci5tYXRlcmlhbDsKICAgIHRoaXMuc2hhZGVyT2JqZWN0ID0gTmV3U2hhZGVyLnNoYWRlcjsKCiAgICAvLyBTZXQgbmV3IHNoYWRlciBtYXRlcmlhbC4KICAgIHRoaXMubWF0ZXJpYWwuc2lkZSA9IHNoYWRlckRhdGEuc2lkZTsKICAgIGlmICh0aGlzLm1lc2gpIHsgdGhpcy5tZXNoLm1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsgfQogIH0sCgogIC8qKgogICAqIExvYWQgZm9udCBmb3IgZ2VvbWV0cnksIGxvYWQgZm9udCBpbWFnZSBmb3IgbWF0ZXJpYWwsIGFuZCBhcHBseS4KICAgKi8KICB1cGRhdGVGb250OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgZm9udFNyYzsKICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKCFkYXRhLmZvbnQpIHsgd2FybignTm8gZm9udCBzcGVjaWZpZWQuIFVzaW5nIHRoZSBkZWZhdWx0IGZvbnQuJyk7IH0KCiAgICAvLyBNYWtlIGludmlzaWJsZSBkdXJpbmcgZm9udCBzd2FwLgogICAgdGhpcy5tZXNoLnZpc2libGUgPSBmYWxzZTsKCiAgICAvLyBMb29rIHVwIGZvbnQgVVJMIHRvIHVzZSwgYW5kIHBlcmZvcm0gY2FjaGVkIGxvYWQuCiAgICBmb250U3JjID0gdGhpcy5sb29rdXBGb250KGRhdGEuZm9udCB8fCBERUZBVUxUX0ZPTlQpIHx8IGRhdGEuZm9udDsKICAgIGNhY2hlLmdldChmb250U3JjLCBmdW5jdGlvbiBkb0xvYWRGb250ICgpIHsKICAgICAgcmV0dXJuIGxvYWRGb250KGZvbnRTcmMsIGRhdGEueU9mZnNldCk7CiAgICB9KS50aGVuKGZ1bmN0aW9uIHNldEZvbnQgKGZvbnQpIHsKICAgICAgdmFyIGZvbnRJbWdTcmM7CgogICAgICBpZiAoZm9udC5wYWdlcy5sZW5ndGggIT09IDEpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0N1cnJlbnRseSBvbmx5IHNpbmdsZS1wYWdlIGJpdG1hcCBmb250cyBhcmUgc3VwcG9ydGVkLicpOwogICAgICB9CgogICAgICBpZiAoIWZvbnRXaWR0aEZhY3RvcnNbZm9udFNyY10pIHsKICAgICAgICBmb250LndpZHRoRmFjdG9yID0gZm9udFdpZHRoRmFjdG9yc1tmb250XSA9IGNvbXB1dGVGb250V2lkdGhGYWN0b3IoZm9udCk7CiAgICAgIH0KCiAgICAgIC8vIFVwZGF0ZSBnZW9tZXRyeSBnaXZlbiBmb250IG1ldHJpY3MuCiAgICAgIHNlbGYudXBkYXRlR2VvbWV0cnkoZ2VvbWV0cnksIGZvbnQpOwoKICAgICAgLy8gU2V0IGZvbnQgYW5kIHVwZGF0ZSBsYXlvdXQuCiAgICAgIHNlbGYuY3VycmVudEZvbnQgPSBmb250OwogICAgICBzZWxmLnVwZGF0ZUxheW91dCgpOwoKICAgICAgLy8gTG9vayB1cCBmb250IGltYWdlIFVSTCB0byB1c2UsIGFuZCBwZXJmb3JtIGNhY2hlZCBsb2FkLgogICAgICBmb250SW1nU3JjID0gc2VsZi5nZXRGb250SW1hZ2VTcmMoKTsKICAgICAgY2FjaGUuZ2V0KGZvbnRJbWdTcmMsIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbG9hZFRleHR1cmUoZm9udEltZ1NyYyk7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGltYWdlKSB7CiAgICAgICAgLy8gTWFrZSBtZXNoIHZpc2libGUgYW5kIGFwcGx5IGZvbnQgaW1hZ2UgYXMgdGV4dHVyZS4KICAgICAgICB2YXIgdGV4dHVyZSA9IHNlbGYudGV4dHVyZTsKICAgICAgICB0ZXh0dXJlLmltYWdlID0gaW1hZ2U7CiAgICAgICAgdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgICAgdGV4dHVyZXNbZGF0YS5mb250XSA9IHRleHR1cmU7CiAgICAgICAgc2VsZi50ZXh0dXJlID0gdGV4dHVyZTsKICAgICAgICBzZWxmLm1lc2gudmlzaWJsZSA9IHRydWU7CiAgICAgICAgZWwuZW1pdCgndGV4dGZvbnRzZXQnLCB7Zm9udDogZGF0YS5mb250LCBmb250T2JqOiBmb250fSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICBlcnJvcihlcnIubWVzc2FnZSk7CiAgICAgICAgZXJyb3IoZXJyLnN0YWNrKTsKICAgICAgfSk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgIGVycm9yKGVyci5tZXNzYWdlKTsKICAgICAgZXJyb3IoZXJyLnN0YWNrKTsKICAgIH0pOwogIH0sCgogIGdldEZvbnRJbWFnZVNyYzogZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuZGF0YS5mb250SW1hZ2UpIHsgcmV0dXJuIHRoaXMuZGF0YS5mb250SW1hZ2U7IH0KICAgIHZhciBmb250U3JjID0gdGhpcy5sb29rdXBGb250KHRoaXMuZGF0YS5mb250IHx8IERFRkFVTFRfRk9OVCkgfHwgdGhpcy5kYXRhLmZvbnQ7CiAgICB2YXIgaW1hZ2VTcmMgPSB0aGlzLmN1cnJlbnRGb250LnBhZ2VzWzBdOwogICAgLy8gSWYgdGhlIGltYWdlIFVSTCBjb250YWlucyBhIG5vbi1IVFRQKFMpIHByb3RvY29sLCBhc3N1bWUgaXQncyBhbiBhYnNvbHV0ZQogICAgLy8gcGF0aCBvbiBkaXNrIGFuZCB0cnkgdG8gaW5mZXIgdGhlIHBhdGggZnJvbSB0aGUgZm9udCBzb3VyY2UgaW5zdGVhZC4KICAgIGlmIChpbWFnZVNyYy5tYXRjaChwcm90b2NvbFJlKSAmJiBpbWFnZVNyYy5pbmRleE9mKCdodHRwJykgIT09IDApIHsKICAgICAgcmV0dXJuIGZvbnRTcmMucmVwbGFjZSgvKFwuZm50KXwoXC5qc29uKS8sICcucG5nJyk7CiAgICB9CiAgICByZXR1cm4gVEhSRUUuTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UoZm9udFNyYykgKyBpbWFnZVNyYzsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgbGF5b3V0IHdpdGggYW5jaG9yLCBhbGlnbm1lbnQsIGJhc2VsaW5lLCBhbmQgY29uc2lkZXJpbmcgYW55IG1lc2hlcy4KICAgKi8KICB1cGRhdGVMYXlvdXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBhbmNob3I7CiAgICB2YXIgYmFzZWxpbmU7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgdmFyIGdlb21ldHJ5Q29tcG9uZW50OwogICAgdmFyIGhlaWdodDsKICAgIHZhciBsYXlvdXQ7CiAgICB2YXIgbWVzaCA9IHRoaXMubWVzaDsKICAgIHZhciB0ZXh0UmVuZGVyV2lkdGg7CiAgICB2YXIgdGV4dFNjYWxlOwogICAgdmFyIHdpZHRoOwogICAgdmFyIHg7CiAgICB2YXIgeTsKCiAgICBpZiAoIWdlb21ldHJ5LmxheW91dCkgeyByZXR1cm47IH0KCiAgICAvLyBEZXRlcm1pbmUgd2lkdGggdG8gdXNlIChkZWZpbmVkIHdpZHRoLCBnZW9tZXRyeSdzIHdpZHRoLCBvciBkZWZhdWx0IHdpZHRoKS4KICAgIGdlb21ldHJ5Q29tcG9uZW50ID0gZWwuZ2V0QXR0cmlidXRlKCdnZW9tZXRyeScpOwogICAgd2lkdGggPSBkYXRhLndpZHRoIHx8IChnZW9tZXRyeUNvbXBvbmVudCAmJiBnZW9tZXRyeUNvbXBvbmVudC53aWR0aCkgfHwgREVGQVVMVF9XSURUSDsKCiAgICAvLyBEZXRlcm1pbmUgd3JhcCBwaXhlbCBjb3VudC4gRWl0aGVyIHNwZWNpZmllZCBvciBieSBleHBlcmltZW50YWwgZnVkZ2UgZmFjdG9yLgogICAgLy8gTm90ZSB0aGF0IGV4cGVyaW1lbnRhbCBmYWN0b3Igd2lsbCBuZXZlciBiZSBjb3JyZWN0IGZvciB2YXJpYWJsZSB3aWR0aCBmb250cy4KICAgIHRleHRSZW5kZXJXaWR0aCA9IGNvbXB1dGVXaWR0aChkYXRhLndyYXBQaXhlbHMsIGRhdGEud3JhcENvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEZvbnQud2lkdGhGYWN0b3IpOwogICAgdGV4dFNjYWxlID0gd2lkdGggLyB0ZXh0UmVuZGVyV2lkdGg7CgogICAgLy8gRGV0ZXJtaW5lIGhlaWdodCB0byB1c2UuCiAgICBsYXlvdXQgPSBnZW9tZXRyeS5sYXlvdXQ7CiAgICBoZWlnaHQgPSB0ZXh0U2NhbGUgKiAobGF5b3V0LmhlaWdodCArIGxheW91dC5kZXNjZW5kZXIpOwoKICAgIC8vIFVwZGF0ZSBnZW9tZXRyeSBkaW1lbnNpb25zIHRvIG1hdGNoIHRleHQgbGF5b3V0IGlmIHdpZHRoIGFuZCBoZWlnaHQgYXJlIHNldCB0byAwLgogICAgLy8gRm9yIGV4YW1wbGUsIHNjYWxlcyBhIHBsYW5lIHRvIGZpdCB0ZXh0LgogICAgaWYgKGdlb21ldHJ5Q29tcG9uZW50ICYmIGdlb21ldHJ5Q29tcG9uZW50LnByaW1pdGl2ZSA9PT0gJ3BsYW5lJykgewogICAgICBpZiAoIWdlb21ldHJ5Q29tcG9uZW50LndpZHRoKSB7IGVsLnNldEF0dHJpYnV0ZSgnZ2VvbWV0cnknLCAnd2lkdGgnLCB3aWR0aCk7IH0KICAgICAgaWYgKCFnZW9tZXRyeUNvbXBvbmVudC5oZWlnaHQpIHsgZWwuc2V0QXR0cmlidXRlKCdnZW9tZXRyeScsICdoZWlnaHQnLCBoZWlnaHQpOyB9CiAgICB9CgogICAgLy8gQ2FsY3VsYXRlIFggcG9zaXRpb24gdG8gYW5jaG9yIHRleHQgbGVmdCwgY2VudGVyLCBvciByaWdodC4KICAgIGFuY2hvciA9IGRhdGEuYW5jaG9yID09PSAnYWxpZ24nID8gZGF0YS5hbGlnbiA6IGRhdGEuYW5jaG9yOwogICAgaWYgKGFuY2hvciA9PT0gJ2xlZnQnKSB7CiAgICAgIHggPSAwOwogICAgfSBlbHNlIGlmIChhbmNob3IgPT09ICdyaWdodCcpIHsKICAgICAgeCA9IC0xICogbGF5b3V0LndpZHRoOwogICAgfSBlbHNlIGlmIChhbmNob3IgPT09ICdjZW50ZXInKSB7CiAgICAgIHggPSAtMSAqIGxheW91dC53aWR0aCAvIDI7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIHRleHQuYW5jaG9yIHByb3BlcnR5IHZhbHVlJywgYW5jaG9yKTsKICAgIH0KCiAgICAvLyBDYWxjdWxhdGUgWSBwb3NpdGlvbiB0byBhbmNob3IgdGV4dCB0b3AsIGNlbnRlciwgb3IgYm90dG9tLgogICAgYmFzZWxpbmUgPSBkYXRhLmJhc2VsaW5lOwogICAgaWYgKGJhc2VsaW5lID09PSAnYm90dG9tJykgewogICAgICB5ID0gMDsKICAgIH0gZWxzZSBpZiAoYmFzZWxpbmUgPT09ICd0b3AnKSB7CiAgICAgIHkgPSAtMSAqIGxheW91dC5oZWlnaHQgKyBsYXlvdXQuYXNjZW5kZXI7CiAgICB9IGVsc2UgaWYgKGJhc2VsaW5lID09PSAnY2VudGVyJykgewogICAgICB5ID0gLTEgKiBsYXlvdXQuaGVpZ2h0IC8gMjsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgdGV4dC5iYXNlbGluZSBwcm9wZXJ0eSB2YWx1ZScsIGJhc2VsaW5lKTsKICAgIH0KCiAgICAvLyBQb3NpdGlvbiBhbmQgc2NhbGUgbWVzaCB0byBhcHBseSBsYXlvdXQuCiAgICBtZXNoLnBvc2l0aW9uLnggPSB4ICogdGV4dFNjYWxlICsgZGF0YS54T2Zmc2V0OwogICAgbWVzaC5wb3NpdGlvbi55ID0geSAqIHRleHRTY2FsZTsKICAgIC8vIFBsYWNlIHRleHQgc2xpZ2h0bHkgaW4gZnJvbnQgdG8gYXZvaWQgWi1maWdodGluZy4KICAgIG1lc2gucG9zaXRpb24ueiA9IGRhdGEuek9mZnNldDsKICAgIG1lc2guc2NhbGUuc2V0KHRleHRTY2FsZSwgLTEgKiB0ZXh0U2NhbGUsIHRleHRTY2FsZSk7CiAgfSwKCiAgLyoqCiAgICogR3JhYiBmb250IGZyb20gdGhlIGNvbnN0YW50LgogICAqIFNldCBhcyBhIG1ldGhvZCBmb3IgdGVzdCBzdHViYmluZyBwdXJwb3Nlcy4KICAgKi8KICBsb29rdXBGb250OiBmdW5jdGlvbiAoa2V5KSB7CiAgICByZXR1cm4gRk9OVFNba2V5XTsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgdGhlIHRleHQgZ2VvbWV0cnkgdXNpbmcgYHRocmVlLWJtZm9udC10ZXh0LnVwZGF0ZWAuCiAgICovCiAgdXBkYXRlR2VvbWV0cnk6IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgZ2VvbWV0cnlVcGRhdGVCYXNlID0ge307CiAgICB2YXIgZ2VvbWV0cnlVcGRhdGVEYXRhID0ge307CiAgICB2YXIgbmV3TGluZVJlZ2V4ID0gL1xcbi9nOwogICAgdmFyIHRhYlJlZ2V4ID0gL1xcdC9nOwoKICAgIHJldHVybiBmdW5jdGlvbiAoZ2VvbWV0cnksIGZvbnQpIHsKICAgICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBnZW9tZXRyeVVwZGF0ZURhdGEuZm9udCA9IGZvbnQ7CiAgICAgIGdlb21ldHJ5VXBkYXRlRGF0YS5saW5lSGVpZ2h0ID0gZGF0YS5saW5lSGVpZ2h0ICYmIGlzRmluaXRlKGRhdGEubGluZUhlaWdodCkKICAgICAgICA/IGRhdGEubGluZUhlaWdodAogICAgICAgIDogZm9udC5jb21tb24ubGluZUhlaWdodDsKICAgICAgZ2VvbWV0cnlVcGRhdGVEYXRhLnRleHQgPSBkYXRhLnZhbHVlLnRvU3RyaW5nKCkucmVwbGFjZShuZXdMaW5lUmVnZXgsICdcbicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UodGFiUmVnZXgsICdcdCcpOwogICAgICBnZW9tZXRyeVVwZGF0ZURhdGEud2lkdGggPSBjb21wdXRlV2lkdGgoZGF0YS53cmFwUGl4ZWxzLCBkYXRhLndyYXBDb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnQud2lkdGhGYWN0b3IpOwogICAgICBnZW9tZXRyeS51cGRhdGUodXRpbHMuZXh0ZW5kKGdlb21ldHJ5VXBkYXRlQmFzZSwgZGF0YSwgZ2VvbWV0cnlVcGRhdGVEYXRhKSk7CiAgICB9OwogIH0pKCkKfSk7CgovKioKICogRHVlIHRvIHVzaW5nIG5lZ2F0aXZlIHNjYWxlLCB3ZSByZXR1cm4gdGhlIG9wcG9zaXRlIHNpZGUgc3BlY2lmaWVkLgogKiBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMTI3ODcvCiAqLwpmdW5jdGlvbiBwYXJzZVNpZGUgKHNpZGUpIHsKICBzd2l0Y2ggKHNpZGUpIHsKICAgIGNhc2UgJ2JhY2snOiB7CiAgICAgIHJldHVybiBUSFJFRS5Gcm9udFNpZGU7CiAgICB9CiAgICBjYXNlICdkb3VibGUnOiB7CiAgICAgIHJldHVybiBUSFJFRS5Eb3VibGVTaWRlOwogICAgfQogICAgZGVmYXVsdDogewogICAgICByZXR1cm4gVEhSRUUuQmFja1NpZGU7CiAgICB9CiAgfQp9CgovKioKICogQHJldHVybnMge1Byb21pc2V9CiAqLwpmdW5jdGlvbiBsb2FkRm9udCAoc3JjLCB5T2Zmc2V0KSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIGxvYWRCTUZvbnQoc3JjLCBmdW5jdGlvbiAoZXJyLCBmb250KSB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICBlcnJvcignRXJyb3IgbG9hZGluZyBmb250Jywgc3JjKTsKICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIEZpeCBuZWdhdGl2ZSBZIG9mZnNldHMgZm9yIFJvYm90byBNU0RGIGZvbnQgZnJvbSB0b29sLiBFeHBlcmltZW50YWxseSBkZXRlcm1pbmVkLgogICAgICBpZiAoc3JjLmluZGV4T2YoJy9Sb2JvdG8tbXNkZi5qc29uJykgPj0gMCkgeyB5T2Zmc2V0ID0gMzA7IH0KICAgICAgaWYgKHlPZmZzZXQpIHsgZm9udC5jaGFycy5tYXAoZnVuY3Rpb24gZG9PZmZzZXQgKGNoKSB7IGNoLnlvZmZzZXQgKz0geU9mZnNldDsgfSk7IH0KCiAgICAgIHJlc29sdmUoZm9udCk7CiAgICB9KTsKICB9KTsKfQoKLyoqCiAqIEByZXR1cm5zIHtQcm9taXNlfQogKi8KZnVuY3Rpb24gbG9hZFRleHR1cmUgKHNyYykgewogIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICBuZXcgVEhSRUUuSW1hZ2VMb2FkZXIoKS5sb2FkKHNyYywgZnVuY3Rpb24gKGltYWdlKSB7CiAgICAgIHJlc29sdmUoaW1hZ2UpOwogICAgfSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAoKSB7CiAgICAgIGVycm9yKCdFcnJvciBsb2FkaW5nIGZvbnQgaW1hZ2UnLCBzcmMpOwogICAgICByZWplY3QobnVsbCk7CiAgICB9KTsKICB9KTsKfQoKZnVuY3Rpb24gY3JlYXRlU2hhZGVyIChlbCwgc2hhZGVyTmFtZSwgZGF0YSkgewogIHZhciBzaGFkZXI7CiAgdmFyIHNoYWRlck9iamVjdDsKCiAgLy8gU2V0IHVwIFNoYWRlci4KICBzaGFkZXJPYmplY3QgPSBuZXcgc2hhZGVyc1tzaGFkZXJOYW1lXS5TaGFkZXIoKTsKICBzaGFkZXJPYmplY3QuZWwgPSBlbDsKICBzaGFkZXJPYmplY3QuaW5pdChkYXRhKTsKICBzaGFkZXJPYmplY3QudXBkYXRlKGRhdGEpOwoKICAvLyBHZXQgbWF0ZXJpYWwuCiAgc2hhZGVyID0gc2hhZGVyT2JqZWN0Lm1hdGVyaWFsOwogIC8vIEFwcGFyZW50bHksIHdhcyBub3Qgc2V0IG9uIGBpbml0YCBub3IgYHVwZGF0ZWAuCiAgc2hhZGVyLnRyYW5zcGFyZW50ID0gZGF0YS50cmFuc3BhcmVudDsKCiAgcmV0dXJuIHsKICAgIG1hdGVyaWFsOiBzaGFkZXIsCiAgICBzaGFkZXI6IHNoYWRlck9iamVjdAogIH07Cn0KCi8qKgogKiBEZXRlcm1pbmUgd3JhcCBwaXhlbCBjb3VudC4gRWl0aGVyIHNwZWNpZmllZCBvciBieSBleHBlcmltZW50YWwgZnVkZ2UgZmFjdG9yLgogKiBOb3RlIHRoYXQgZXhwZXJpbWVudGFsIGZhY3RvciB3aWxsIG5ldmVyIGJlIGNvcnJlY3QgZm9yIHZhcmlhYmxlIHdpZHRoIGZvbnRzLgogKi8KZnVuY3Rpb24gY29tcHV0ZVdpZHRoICh3cmFwUGl4ZWxzLCB3cmFwQ291bnQsIHdpZHRoRmFjdG9yKSB7CiAgcmV0dXJuIHdyYXBQaXhlbHMgfHwgKCgwLjUgKyB3cmFwQ291bnQpICogd2lkdGhGYWN0b3IpOwp9CgovKioKICogQ29tcHV0ZSBkZWZhdWx0IGZvbnQgd2lkdGggZmFjdG9yIHRvIHVzZS4KICovCmZ1bmN0aW9uIGNvbXB1dGVGb250V2lkdGhGYWN0b3IgKGZvbnQpIHsKICB2YXIgc3VtID0gMDsKICB2YXIgZGlnaXRzdW0gPSAwOwogIHZhciBkaWdpdHMgPSAwOwogIGZvbnQuY2hhcnMubWFwKGZ1bmN0aW9uIChjaCkgewogICAgc3VtICs9IGNoLnhhZHZhbmNlOwogICAgaWYgKGNoLmlkID49IDQ4ICYmIGNoLmlkIDw9IDU3KSB7CiAgICAgIGRpZ2l0cysrOwogICAgICBkaWdpdHN1bSArPSBjaC54YWR2YW5jZTsKICAgIH0KICB9KTsKICByZXR1cm4gZGlnaXRzID8gZGlnaXRzdW0gLyBkaWdpdHMgOiBzdW0gLyBmb250LmNoYXJzLmxlbmd0aDsKfQoKLyoqCiAqIEdldCBvciBjcmVhdGUgYSBwcm9taXNlIGdpdmVuIGEga2V5IGFuZCBwcm9taXNlIGdlbmVyYXRvci4KICogQHRvZG8gTW92ZSB0byBhIHV0aWxpdHkgYW5kIHVzZSBpbiBvdGhlciBwYXJ0cyBvZiBBLUZyYW1lLgogKi8KZnVuY3Rpb24gUHJvbWlzZUNhY2hlICgpIHsKICB2YXIgY2FjaGUgPSB0aGlzLmNhY2hlID0ge307CgogIHRoaXMuZ2V0ID0gZnVuY3Rpb24gKGtleSwgcHJvbWlzZUdlbmVyYXRvcikgewogICAgaWYgKGtleSBpbiBjYWNoZSkgewogICAgICByZXR1cm4gY2FjaGVba2V5XTsKICAgIH0KICAgIGNhY2hlW2tleV0gPSBwcm9taXNlR2VuZXJhdG9yKCk7CiAgICByZXR1cm4gY2FjaGVba2V5XTsKICB9Owp9Cgp9LHsiLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vY29yZS9zaGFkZXIiOjExNiwiLi4vbGliL3RocmVlIjoxNTQsIi4uL3V0aWxzLyI6MTc5LCJsb2FkLWJtZm9udCI6MjUsInRocmVlLWJtZm9udC10ZXh0Ijo0Mn1dLDkwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIGNvbnRyb2xsZXJVdGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMnKTsKdmFyIERFRkFVTFRfQ0FNRVJBX0hFSUdIVCA9IF9kZXJlcV8oJy4uL2NvbnN0YW50cycpLkRFRkFVTFRfQ0FNRVJBX0hFSUdIVDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgREVGQVVMVF9IQU5ERURORVNTID0gX2RlcmVxXygnLi4vY29uc3RhbnRzJykuREVGQVVMVF9IQU5ERURORVNTOwovLyBWZWN0b3IgZnJvbSBleWVzIHRvIGVsYm93IChkaXZpZGVkIGJ5IHVzZXIgaGVpZ2h0KS4KdmFyIEVZRVNfVE9fRUxCT1cgPSB7eDogMC4xNzUsIHk6IC0wLjMsIHo6IC0wLjAzfTsKLy8gVmVjdG9yIGZyb20gZXllcyB0byBlbGJvdyAoZGl2aWRlZCBieSB1c2VyIGhlaWdodCkuCnZhciBGT1JFQVJNID0ge3g6IDAsIHk6IDAsIHo6IC0wLjE3NX07CgovLyBEdWUgdG8gdW5mb3J0dW5hdGUgbmFtZSBjb2xsaXNpb24sIGFkZCBlbXB0eSB0b3VjaGVzIGFycmF5IHRvIGF2b2lkIERheWRyZWFtIGVycm9yLgp2YXIgRU1QVFlfREFZRFJFQU1fVE9VQ0hFUyA9IHt0b3VjaGVzOiBbXX07Cgp2YXIgRVZFTlRTID0gewogIEFYSVNNT1ZFOiAnYXhpc21vdmUnLAogIEJVVFRPTkNIQU5HRUQ6ICdidXR0b25jaGFuZ2VkJywKICBCVVRUT05ET1dOOiAnYnV0dG9uZG93bicsCiAgQlVUVE9OVVA6ICdidXR0b251cCcsCiAgVE9VQ0hTVEFSVDogJ3RvdWNoc3RhcnQnLAogIFRPVUNIRU5EOiAndG91Y2hlbmQnCn07CgovKioKICogVHJhY2tlZCBjb250cm9scyBjb21wb25lbnQuCiAqIFdyYXAgdGhlIGdhbWVwYWQgQVBJIGZvciBwb3NlIGFuZCBidXR0b24gc3RhdGVzLgogKiBTZWxlY3QgdGhlIGFwcHJvcHJpYXRlIGNvbnRyb2xsZXIgYW5kIGFwcGx5IHBvc2UgdG8gdGhlIGVudGl0eS4KICogT2JzZXJ2ZSBidXR0b24gc3RhdGVzIGFuZCBlbWl0IGFwcHJvcHJpYXRlIGV2ZW50cy4KICoKICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbnRyb2xsZXIgLSBJbmRleCBvZiBjb250cm9sbGVyIGluIGFycmF5IHJldHVybmVkIGJ5IEdhbWVwYWQgQVBJLgogKiAgT25seSB1c2VkIGlmIGhhbmQgcHJvcGVydHkgaXMgbm90IHNldC4KICogQHByb3BlcnR5IHtzdHJpbmd9IGlkIC0gU2VsZWN0ZWQgY29udHJvbGxlciBhbW9uZyB0aG9zZSByZXR1cm5lZCBieSBHYW1lcGFkIEFQSS4KICogQHByb3BlcnR5IHtudW1iZXJ9IGhhbmQgLSBJZiBtdWx0aXBsZSBjb250cm9sbGVycyBmb3VuZCB3aXRoIGlkLCBjaG9vc2UgdGhlIG9uZSB3aXRoIHRoZQogKiAgZ2l2ZW4gdmFsdWUgZm9yIGhhbmQuIElmIHNldCwgd2UgaWdub3JlICdjb250cm9sbGVyJyBwcm9wZXJ0eQogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3RyYWNrZWQtY29udHJvbHMtd2VidnInLCB7CiAgc2NoZW1hOiB7CiAgICBhdXRvSGlkZToge2RlZmF1bHQ6IHRydWV9LAogICAgY29udHJvbGxlcjoge2RlZmF1bHQ6IDB9LAogICAgaWQ6IHt0eXBlOiAnc3RyaW5nJywgZGVmYXVsdDogJyd9LAogICAgaGFuZDoge3R5cGU6ICdzdHJpbmcnLCBkZWZhdWx0OiAnJ30sCiAgICBpZFByZWZpeDoge3R5cGU6ICdzdHJpbmcnLCBkZWZhdWx0OiAnJ30sCiAgICBvcmllbnRhdGlvbk9mZnNldDoge3R5cGU6ICd2ZWMzJ30sCiAgICAvLyBBcm0gbW9kZWwgcGFyYW1ldGVycyB3aGVuIG5vdCA2RG9GLgogICAgYXJtTW9kZWw6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGhlYWRFbGVtZW50OiB7dHlwZTogJ3NlbGVjdG9yJ30KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICAvLyBDb3B5IHZhcmlhYmxlcyBiYWNrIHRvIHRyYWNrZWQtY29udHJvbHMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogICAgLy8gU29tZSAzcmQgY29tcG9uZW50cyByZWx5IG9uIHRoZW0uCiAgICB0aGlzLmF4aXMgPSB0aGlzLmVsLmNvbXBvbmVudHNbJ3RyYWNrZWQtY29udHJvbHMnXS5heGlzID0gWzAsIDAsIDBdOwogICAgdGhpcy5idXR0b25TdGF0ZXMgPSB0aGlzLmVsLmNvbXBvbmVudHNbJ3RyYWNrZWQtY29udHJvbHMnXS5idXR0b25TdGF0ZXMgPSB7fTsKICAgIHRoaXMuY2hhbmdlZEF4ZXMgPSBbXTsKICAgIHRoaXMudGFyZ2V0Q29udHJvbGxlck51bWJlciA9IHRoaXMuZGF0YS5jb250cm9sbGVyOwoKICAgIHRoaXMuYXhpc01vdmVFdmVudERldGFpbCA9IHtheGlzOiB0aGlzLmF4aXMsIGNoYW5nZWQ6IHRoaXMuY2hhbmdlZEF4ZXN9OwogICAgdGhpcy5kZWx0YUNvbnRyb2xsZXJQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CiAgICB0aGlzLmNvbnRyb2xsZXJRdWF0ZXJuaW9uID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oKTsKICAgIHRoaXMuY29udHJvbGxlckV1bGVyID0gbmV3IFRIUkVFLkV1bGVyKCk7CgogICAgdGhpcy51cGRhdGVHYW1lcGFkKCk7CgogICAgdGhpcy5idXR0b25FdmVudERldGFpbHMgPSB7fTsKICB9LAoKICB0aWNrOiBmdW5jdGlvbiAodGltZSwgZGVsdGEpIHsKICAgIHZhciBtZXNoID0gdGhpcy5lbC5nZXRPYmplY3QzRCgnbWVzaCcpOwogICAgLy8gVXBkYXRlIG1lc2ggYW5pbWF0aW9ucy4KICAgIGlmIChtZXNoICYmIG1lc2gudXBkYXRlKSB7IG1lc2gudXBkYXRlKGRlbHRhIC8gMTAwMCk7IH0KICAgIHRoaXMudXBkYXRlR2FtZXBhZCgpOwogICAgdGhpcy51cGRhdGVQb3NlKCk7CiAgICB0aGlzLnVwZGF0ZUJ1dHRvbnMoKTsKICB9LAoKICAvKioKICAgKiBSZXR1cm4gZGVmYXVsdCB1c2VyIGhlaWdodCB0byB1c2UgZm9yIG5vbi02RE9GIGFybSBtb2RlbC4KICAgKi8KICBkZWZhdWx0VXNlckhlaWdodDogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIERFRkFVTFRfQ0FNRVJBX0hFSUdIVDsKICB9LAoKICAvKioKICAgKiBSZXR1cm4gaGVhZCBlbGVtZW50IHRvIHVzZSBmb3Igbm9uLTZET0YgYXJtIG1vZGVsLgogICAqLwogIGdldEhlYWRFbGVtZW50OiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhLmhlYWRFbGVtZW50IHx8IHRoaXMuZWwuc2NlbmVFbC5jYW1lcmEuZWw7CiAgfSwKCiAgLyoqCiAgICogSGFuZGxlIHVwZGF0ZSBjb250cm9sbGVyIG1hdGNoIGNyaXRlcmlhIChzdWNoIGFzIGBpZGAsIGBpZFByZWZpeGAsIGBoYW5kYCwgYGNvbnRyb2xsZXJgKQogICAqLwogIHVwZGF0ZUdhbWVwYWQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGNvbnRyb2xsZXIgPSBjb250cm9sbGVyVXRpbHMuZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlZSKAogICAgICB0aGlzLnN5c3RlbS5jb250cm9sbGVycywKICAgICAgZGF0YS5pZCwKICAgICAgZGF0YS5pZFByZWZpeCwKICAgICAgZGF0YS5oYW5kLAogICAgICBkYXRhLmNvbnRyb2xsZXIKICAgICk7CgogICAgdGhpcy5jb250cm9sbGVyID0gY29udHJvbGxlcjsKICAgIC8vIExlZ2FjeSBoYW5kbGUgdG8gdGhlIGNvbnRyb2xsZXIgZm9yIG9sZCBjb21wb25lbnRzLgogICAgdGhpcy5lbC5jb21wb25lbnRzWyd0cmFja2VkLWNvbnRyb2xzJ10uY29udHJvbGxlciA9IGNvbnRyb2xsZXI7CgogICAgaWYgKHRoaXMuZGF0YS5hdXRvSGlkZSkgeyB0aGlzLmVsLm9iamVjdDNELnZpc2libGUgPSAhIXRoaXMuY29udHJvbGxlcjsgfQogIH0sCgogIC8qKgogICAqIEFwcGxpZXMgYW4gYXJ0aWZpY2lhbCBhcm0gbW9kZWwgdG8gc2ltdWxhdGUgZWxib3cgdG8gd3Jpc3QgcG9zaXRpb25pbmcKICAgKiBiYXNlZCBvbiB0aGUgb3JpZW50YXRpb24gb2YgdGhlIGNvbnRyb2xsZXIuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gY29udHJvbGxlclBvc2l0aW9uIC0gRXhpc3RpbmcgdmVjdG9yIHRvIHVwZGF0ZSB3aXRoIGNvbnRyb2xsZXIgcG9zaXRpb24uCiAgICovCiAgYXBwbHlBcm1Nb2RlbDogZnVuY3Rpb24gKGNvbnRyb2xsZXJQb3NpdGlvbikgewogICAgLy8gVXNlIGNvbnRyb2xsZXJQb3NpdGlvbiBhbmQgZGVsdGFDb250cm9sbGVyUG9zaXRpb24gdG8gYXZvaWQgY3JlYXRpbmcgdmFyaWFibGVzLgogICAgdmFyIGNvbnRyb2xsZXIgPSB0aGlzLmNvbnRyb2xsZXI7CiAgICB2YXIgY29udHJvbGxlckV1bGVyID0gdGhpcy5jb250cm9sbGVyRXVsZXI7CiAgICB2YXIgY29udHJvbGxlclF1YXRlcm5pb24gPSB0aGlzLmNvbnRyb2xsZXJRdWF0ZXJuaW9uOwogICAgdmFyIGRlbHRhQ29udHJvbGxlclBvc2l0aW9uID0gdGhpcy5kZWx0YUNvbnRyb2xsZXJQb3NpdGlvbjsKICAgIHZhciBoYW5kOwogICAgdmFyIGhlYWRFbDsKICAgIHZhciBoZWFkT2JqZWN0M0Q7CiAgICB2YXIgcG9zZTsKICAgIHZhciB1c2VySGVpZ2h0OwoKICAgIGhlYWRFbCA9IHRoaXMuZ2V0SGVhZEVsZW1lbnQoKTsKICAgIGhlYWRPYmplY3QzRCA9IGhlYWRFbC5vYmplY3QzRDsKICAgIHVzZXJIZWlnaHQgPSB0aGlzLmRlZmF1bHRVc2VySGVpZ2h0KCk7CgogICAgcG9zZSA9IGNvbnRyb2xsZXIucG9zZTsKICAgIGhhbmQgPSAoY29udHJvbGxlciA/IGNvbnRyb2xsZXIuaGFuZCA6IHVuZGVmaW5lZCkgfHwgREVGQVVMVF9IQU5ERURORVNTOwoKICAgIC8vIFVzZSBjYW1lcmEgcG9zaXRpb24gYXMgaGVhZCBwb3NpdGlvbi4KICAgIGNvbnRyb2xsZXJQb3NpdGlvbi5jb3B5KGhlYWRPYmplY3QzRC5wb3NpdGlvbik7CiAgICAvLyBTZXQgb2Zmc2V0IGZvciBkZWdlbmVyYXRlICJhcm0gbW9kZWwiIHRvIGVsYm93LgogICAgZGVsdGFDb250cm9sbGVyUG9zaXRpb24uc2V0KAogICAgICBFWUVTX1RPX0VMQk9XLnggKiAoaGFuZCA9PT0gJ2xlZnQnID8gLTEgOiBoYW5kID09PSAncmlnaHQnID8gMSA6IDApLAogICAgICBFWUVTX1RPX0VMQk9XLnksICAvLyBMb3dlciB0aGFuIG91ciBleWVzLgogICAgICBFWUVTX1RPX0VMQk9XLnopOyAgLy8gU2xpZ2h0bHkgb3V0IGluIGZyb250LgogICAgLy8gU2NhbGUgb2Zmc2V0IGJ5IHVzZXIgaGVpZ2h0LgogICAgZGVsdGFDb250cm9sbGVyUG9zaXRpb24ubXVsdGlwbHlTY2FsYXIodXNlckhlaWdodCk7CiAgICAvLyBBcHBseSBjYW1lcmEgWSByb3RhdGlvbiAobm90IFggb3IgWiwgc28geW91IGNhbiBsb29rIGRvd24gYXQgeW91ciBoYW5kKS4KICAgIGRlbHRhQ29udHJvbGxlclBvc2l0aW9uLmFwcGx5QXhpc0FuZ2xlKGhlYWRPYmplY3QzRC51cCwgaGVhZE9iamVjdDNELnJvdGF0aW9uLnkpOwogICAgLy8gQXBwbHkgcm90YXRlZCBvZmZzZXQgdG8gcG9zaXRpb24uCiAgICBjb250cm9sbGVyUG9zaXRpb24uYWRkKGRlbHRhQ29udHJvbGxlclBvc2l0aW9uKTsKCiAgICAvLyBTZXQgb2Zmc2V0IGZvciBkZWdlbmVyYXRlICJhcm0gbW9kZWwiIGZvcmVhcm0uIEZvcmVhcm0gc3RpY2tpbmcgb3V0IGZyb20gZWxib3cuCiAgICBkZWx0YUNvbnRyb2xsZXJQb3NpdGlvbi5zZXQoRk9SRUFSTS54LCBGT1JFQVJNLnksIEZPUkVBUk0ueik7CiAgICAvLyBTY2FsZSBvZmZzZXQgYnkgdXNlciBoZWlnaHQuCiAgICBkZWx0YUNvbnRyb2xsZXJQb3NpdGlvbi5tdWx0aXBseVNjYWxhcih1c2VySGVpZ2h0KTsKICAgIC8vIEFwcGx5IGNvbnRyb2xsZXIgWC9ZIHJvdGF0aW9uICh0aWx0aW5nIHVwL2Rvd24vbGVmdC9yaWdodCBpcyB1c3VhbGx5IG1vdmluZyB0aGUgYXJtKS4KICAgIGlmIChwb3NlLm9yaWVudGF0aW9uKSB7CiAgICAgIGNvbnRyb2xsZXJRdWF0ZXJuaW9uLmZyb21BcnJheShwb3NlLm9yaWVudGF0aW9uKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnRyb2xsZXJRdWF0ZXJuaW9uLmNvcHkoaGVhZE9iamVjdDNELnF1YXRlcm5pb24pOwogICAgfQogICAgY29udHJvbGxlckV1bGVyLnNldEZyb21RdWF0ZXJuaW9uKGNvbnRyb2xsZXJRdWF0ZXJuaW9uKTsKICAgIGNvbnRyb2xsZXJFdWxlci5zZXQoY29udHJvbGxlckV1bGVyLngsIGNvbnRyb2xsZXJFdWxlci55LCAwKTsKICAgIGRlbHRhQ29udHJvbGxlclBvc2l0aW9uLmFwcGx5RXVsZXIoY29udHJvbGxlckV1bGVyKTsKICAgIC8vIEFwcGx5IHJvdGF0ZWQgb2Zmc2V0IHRvIHBvc2l0aW9uLgogICAgY29udHJvbGxlclBvc2l0aW9uLmFkZChkZWx0YUNvbnRyb2xsZXJQb3NpdGlvbik7CiAgfSwKCiAgLyoqCiAgICogUmVhZCBwb3NlIGZyb20gY29udHJvbGxlciAoZnJvbSBHYW1lcGFkIEFQSSksIGFwcGx5IHRyYW5zZm9ybXMsIGFwcGx5IHRvIGVudGl0eS4KICAgKi8KICB1cGRhdGVQb3NlOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY29udHJvbGxlciA9IHRoaXMuY29udHJvbGxlcjsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIG9iamVjdDNEID0gdGhpcy5lbC5vYmplY3QzRDsKICAgIHZhciBwb3NlOwogICAgdmFyIHZyRGlzcGxheSA9IHRoaXMuc3lzdGVtLnZyRGlzcGxheTsKICAgIHZhciBzdGFuZGluZ01hdHJpeDsKCiAgICBpZiAoIWNvbnRyb2xsZXIpIHsgcmV0dXJuOyB9CgogICAgLy8gQ29tcG9zZSBwb3NlIGZyb20gR2FtZXBhZC4KICAgIHBvc2UgPSBjb250cm9sbGVyLnBvc2U7CgogICAgaWYgKHBvc2UucG9zaXRpb24pIHsKICAgICAgb2JqZWN0M0QucG9zaXRpb24uZnJvbUFycmF5KHBvc2UucG9zaXRpb24pOwogICAgfSBlbHNlIHsKICAgICAgLy8gQ29udHJvbGxlciBub3QgNkRPRiwgYXBwbHkgYXJtIG1vZGVsLgogICAgICBpZiAoZGF0YS5hcm1Nb2RlbCkgeyB0aGlzLmFwcGx5QXJtTW9kZWwob2JqZWN0M0QucG9zaXRpb24pOyB9CiAgICB9CgogICAgaWYgKHBvc2Uub3JpZW50YXRpb24pIHsKICAgICAgb2JqZWN0M0QucXVhdGVybmlvbi5mcm9tQXJyYXkocG9zZS5vcmllbnRhdGlvbik7CiAgICB9CgogICAgLy8gQXBwbHkgdHJhbnNmb3JtcywgaWYgNkRPRiBhbmQgaW4gVlIuCiAgICBpZiAodnJEaXNwbGF5ICYmIHBvc2UucG9zaXRpb24pIHsKICAgICAgc3RhbmRpbmdNYXRyaXggPSB0aGlzLmVsLnNjZW5lRWwucmVuZGVyZXIudnIuZ2V0U3RhbmRpbmdNYXRyaXgoKTsKICAgICAgb2JqZWN0M0QubWF0cml4LmNvbXBvc2Uob2JqZWN0M0QucG9zaXRpb24sIG9iamVjdDNELnF1YXRlcm5pb24sIG9iamVjdDNELnNjYWxlKTsKICAgICAgb2JqZWN0M0QubWF0cml4Lm11bHRpcGx5TWF0cmljZXMoc3RhbmRpbmdNYXRyaXgsIG9iamVjdDNELm1hdHJpeCk7CiAgICAgIG9iamVjdDNELm1hdHJpeC5kZWNvbXBvc2Uob2JqZWN0M0QucG9zaXRpb24sIG9iamVjdDNELnF1YXRlcm5pb24sIG9iamVjdDNELnNjYWxlKTsKICAgIH0KCiAgICBvYmplY3QzRC5yb3RhdGVYKHRoaXMuZGF0YS5vcmllbnRhdGlvbk9mZnNldC54ICogVEhSRUUuTWF0aC5ERUcyUkFEKTsKICAgIG9iamVjdDNELnJvdGF0ZVkodGhpcy5kYXRhLm9yaWVudGF0aW9uT2Zmc2V0LnkgKiBUSFJFRS5NYXRoLkRFRzJSQUQpOwogICAgb2JqZWN0M0Qucm90YXRlWih0aGlzLmRhdGEub3JpZW50YXRpb25PZmZzZXQueiAqIFRIUkVFLk1hdGguREVHMlJBRCk7CiAgfSwKCiAgLyoqCiAgICogSGFuZGxlIGJ1dHRvbiBjaGFuZ2VzIGluY2x1ZGluZyBheGVzLCBwcmVzc2VzLCB0b3VjaGVzLCB2YWx1ZXMuCiAgICovCiAgdXBkYXRlQnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgdmFyIGJ1dHRvblN0YXRlOwogICAgdmFyIGNvbnRyb2xsZXIgPSB0aGlzLmNvbnRyb2xsZXI7CiAgICB2YXIgaWQ7CgogICAgaWYgKCFjb250cm9sbGVyKSB7IHJldHVybjsgfQoKICAgIC8vIENoZWNrIGV2ZXJ5IGJ1dHRvbi4KICAgIGZvciAoaWQgPSAwOyBpZCA8IGNvbnRyb2xsZXIuYnV0dG9ucy5sZW5ndGg7ICsraWQpIHsKICAgICAgLy8gSW5pdGlhbGl6ZSBidXR0b24gc3RhdGUuCiAgICAgIGlmICghdGhpcy5idXR0b25TdGF0ZXNbaWRdKSB7CiAgICAgICAgdGhpcy5idXR0b25TdGF0ZXNbaWRdID0ge3ByZXNzZWQ6IGZhbHNlLCB0b3VjaGVkOiBmYWxzZSwgdmFsdWU6IDB9OwogICAgICB9CiAgICAgIGlmICghdGhpcy5idXR0b25FdmVudERldGFpbHNbaWRdKSB7CiAgICAgICAgdGhpcy5idXR0b25FdmVudERldGFpbHNbaWRdID0ge2lkOiBpZCwgc3RhdGU6IHRoaXMuYnV0dG9uU3RhdGVzW2lkXX07CiAgICAgIH0KCiAgICAgIGJ1dHRvblN0YXRlID0gY29udHJvbGxlci5idXR0b25zW2lkXTsKICAgICAgdGhpcy5oYW5kbGVCdXR0b24oaWQsIGJ1dHRvblN0YXRlKTsKICAgIH0KICAgIC8vIENoZWNrIGF4ZXMuCiAgICB0aGlzLmhhbmRsZUF4ZXMoKTsKICB9LAoKICAvKioKICAgKiBIYW5kbGUgcHJlc3NlcyBhbmQgdG91Y2hlcyBmb3IgYSBzaW5nbGUgYnV0dG9uLgogICAqCiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIC0gSW5kZXggb2YgYnV0dG9uIGluIEdhbWVwYWQgYnV0dG9uIGFycmF5LgogICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b25TdGF0ZSAtIFZhbHVlIG9mIGJ1dHRvbiBzdGF0ZSBmcm9tIDAgdG8gMS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBidXR0b24gaGFzIGNoYW5nZWQgaW4gYW55IHdheS4KICAgKi8KICBoYW5kbGVCdXR0b246IGZ1bmN0aW9uIChpZCwgYnV0dG9uU3RhdGUpIHsKICAgIHZhciBjaGFuZ2VkOwogICAgY2hhbmdlZCA9IHRoaXMuaGFuZGxlUHJlc3MoaWQsIGJ1dHRvblN0YXRlKSB8CiAgICAgICAgICAgICAgdGhpcy5oYW5kbGVUb3VjaChpZCwgYnV0dG9uU3RhdGUpIHwKICAgICAgICAgICAgICB0aGlzLmhhbmRsZVZhbHVlKGlkLCBidXR0b25TdGF0ZSk7CiAgICBpZiAoIWNoYW5nZWQpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICB0aGlzLmVsLmVtaXQoRVZFTlRTLkJVVFRPTkNIQU5HRUQsIHRoaXMuYnV0dG9uRXZlbnREZXRhaWxzW2lkXSwgZmFsc2UpOwogICAgcmV0dXJuIHRydWU7CiAgfSwKCiAgLyoqCiAgICogQW4gYXhpcyBpcyBhbiBhcnJheSBvZiB2YWx1ZXMgZnJvbSAtMSAodXAsIGxlZnQpIHRvIDEgKGRvd24sIHJpZ2h0KS4KICAgKiBDb21wYXJlIGVhY2ggY29tcG9uZW50IG9mIHRoZSBheGlzIHRvIHRoZSBwcmV2aW91cyB2YWx1ZSB0byBkZXRlcm1pbmUgY2hhbmdlLgogICAqCiAgICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgYXhlcyBjaGFuZ2VkLgogICAqLwogIGhhbmRsZUF4ZXM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICB2YXIgY29udHJvbGxlckF4ZXMgPSB0aGlzLmNvbnRyb2xsZXIuYXhlczsKICAgIHZhciBpOwogICAgdmFyIHByZXZpb3VzQXhpcyA9IHRoaXMuYXhpczsKICAgIHZhciBjaGFuZ2VkQXhlcyA9IHRoaXMuY2hhbmdlZEF4ZXM7CgogICAgLy8gQ2hlY2sgaWYgYXhpcyBjaGFuZ2VkLgogICAgdGhpcy5jaGFuZ2VkQXhlcy5sZW5ndGggPSAwOwogICAgZm9yIChpID0gMDsgaSA8IGNvbnRyb2xsZXJBeGVzLmxlbmd0aDsgKytpKSB7CiAgICAgIGNoYW5nZWRBeGVzLnB1c2gocHJldmlvdXNBeGlzW2ldICE9PSBjb250cm9sbGVyQXhlc1tpXSk7CiAgICAgIGlmIChjaGFuZ2VkQXhlc1tpXSkgeyBjaGFuZ2VkID0gdHJ1ZTsgfQogICAgfQogICAgaWYgKCFjaGFuZ2VkKSB7IHJldHVybiBmYWxzZTsgfQoKICAgIHRoaXMuYXhpcy5sZW5ndGggPSAwOwogICAgZm9yIChpID0gMDsgaSA8IGNvbnRyb2xsZXJBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHRoaXMuYXhpcy5wdXNoKGNvbnRyb2xsZXJBeGVzW2ldKTsKICAgIH0KICAgIHRoaXMuZWwuZW1pdChFVkVOVFMuQVhJU01PVkUsIHRoaXMuYXhpc01vdmVFdmVudERldGFpbCwgZmFsc2UpOwogICAgcmV0dXJuIHRydWU7CiAgfSwKCiAgLyoqCiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgYSBidXR0b24gcHJlc3MgaGFzIG9jY3VyZWQgYW5kIGVtaXQgZXZlbnRzIGFzIGFwcHJvcHJpYXRlLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gSUQgb2YgdGhlIGJ1dHRvbiB0byBjaGVjay4KICAgKiBAcGFyYW0ge29iamVjdH0gYnV0dG9uU3RhdGUgLSBTdGF0ZSBvZiB0aGUgYnV0dG9uIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIGJ1dHRvbiBwcmVzcyBzdGF0ZSBjaGFuZ2VkLgogICAqLwogIGhhbmRsZVByZXNzOiBmdW5jdGlvbiAoaWQsIGJ1dHRvblN0YXRlKSB7CiAgICB2YXIgZXZ0TmFtZTsKICAgIHZhciBwcmV2aW91c0J1dHRvblN0YXRlID0gdGhpcy5idXR0b25TdGF0ZXNbaWRdOwoKICAgIC8vIE5vdCBjaGFuZ2VkLgogICAgaWYgKGJ1dHRvblN0YXRlLnByZXNzZWQgPT09IHByZXZpb3VzQnV0dG9uU3RhdGUucHJlc3NlZCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICBldnROYW1lID0gYnV0dG9uU3RhdGUucHJlc3NlZCA/IEVWRU5UUy5CVVRUT05ET1dOIDogRVZFTlRTLkJVVFRPTlVQOwogICAgdGhpcy5lbC5lbWl0KGV2dE5hbWUsIHRoaXMuYnV0dG9uRXZlbnREZXRhaWxzW2lkXSwgZmFsc2UpOwogICAgcHJldmlvdXNCdXR0b25TdGF0ZS5wcmVzc2VkID0gYnV0dG9uU3RhdGUucHJlc3NlZDsKICAgIHJldHVybiB0cnVlOwogIH0sCgogIC8qKgogICAqIERldGVybWluZSB3aGV0aGVyIGEgYnV0dG9uIHRvdWNoIGhhcyBvY2N1cmVkIGFuZCBlbWl0IGV2ZW50cyBhcyBhcHByb3ByaWF0ZS4KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIElEIG9mIHRoZSBidXR0b24gdG8gY2hlY2suCiAgICogQHBhcmFtIHtvYmplY3R9IGJ1dHRvblN0YXRlIC0gU3RhdGUgb2YgdGhlIGJ1dHRvbiB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBidXR0b24gdG91Y2ggc3RhdGUgY2hhbmdlZC4KICAgKi8KICBoYW5kbGVUb3VjaDogZnVuY3Rpb24gKGlkLCBidXR0b25TdGF0ZSkgewogICAgdmFyIGV2dE5hbWU7CiAgICB2YXIgcHJldmlvdXNCdXR0b25TdGF0ZSA9IHRoaXMuYnV0dG9uU3RhdGVzW2lkXTsKCiAgICAvLyBOb3QgY2hhbmdlZC4KICAgIGlmIChidXR0b25TdGF0ZS50b3VjaGVkID09PSBwcmV2aW91c0J1dHRvblN0YXRlLnRvdWNoZWQpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgZXZ0TmFtZSA9IGJ1dHRvblN0YXRlLnRvdWNoZWQgPyBFVkVOVFMuVE9VQ0hTVEFSVCA6IEVWRU5UUy5UT1VDSEVORDsKICAgIHRoaXMuZWwuZW1pdChldnROYW1lLCB0aGlzLmJ1dHRvbkV2ZW50RGV0YWlsc1tpZF0sIGZhbHNlLCBFTVBUWV9EQVlEUkVBTV9UT1VDSEVTKTsKICAgIHByZXZpb3VzQnV0dG9uU3RhdGUudG91Y2hlZCA9IGJ1dHRvblN0YXRlLnRvdWNoZWQ7CiAgICByZXR1cm4gdHJ1ZTsKICB9LAoKICAvKioKICAgKiBEZXRlcm1pbmUgd2hldGhlciBhIGJ1dHRvbiB2YWx1ZSBoYXMgY2hhbmdlZC4KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIElkIG9mIHRoZSBidXR0b24gdG8gY2hlY2suCiAgICogQHBhcmFtIHtvYmplY3R9IGJ1dHRvblN0YXRlIC0gU3RhdGUgb2YgdGhlIGJ1dHRvbiB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBidXR0b24gdmFsdWUgY2hhbmdlZC4KICAgKi8KICBoYW5kbGVWYWx1ZTogZnVuY3Rpb24gKGlkLCBidXR0b25TdGF0ZSkgewogICAgdmFyIHByZXZpb3VzQnV0dG9uU3RhdGUgPSB0aGlzLmJ1dHRvblN0YXRlc1tpZF07CgogICAgLy8gTm90IGNoYW5nZWQuCiAgICBpZiAoYnV0dG9uU3RhdGUudmFsdWUgPT09IHByZXZpb3VzQnV0dG9uU3RhdGUudmFsdWUpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgcHJldmlvdXNCdXR0b25TdGF0ZS52YWx1ZSA9IGJ1dHRvblN0YXRlLnZhbHVlOwogICAgcmV0dXJuIHRydWU7CiAgfQp9KTsKCn0seyIuLi9jb25zdGFudHMiOjk4LCIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scyI6MTg3fV0sOTE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgY29udHJvbGxlclV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scycpOwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50OwoKbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3RyYWNrZWQtY29udHJvbHMtd2VieHInLCB7CiAgc2NoZW1hOiB7CiAgICBoYW5kOiB7dHlwZTogJ3N0cmluZycsIGRlZmF1bHQ6ICcnfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYWRkU2Vzc2lvbkV2ZW50TGlzdGVuZXJzID0gdGhpcy5hZGRTZXNzaW9uRXZlbnRMaXN0ZW5lcnMuYmluZCh0aGlzKTsKICAgIHRoaXMudXBkYXRlQ29udHJvbGxlciA9IHRoaXMudXBkYXRlQ29udHJvbGxlci5iaW5kKHRoaXMpOwogICAgdGhpcy5lbWl0QnV0dG9uVXBFdmVudCA9IHRoaXMuZW1pdEJ1dHRvblVwRXZlbnQuYmluZCh0aGlzKTsKICAgIHRoaXMuZW1pdEJ1dHRvbkRvd25FdmVudCA9IHRoaXMuZW1pdEJ1dHRvbkRvd25FdmVudC5iaW5kKHRoaXMpOwogICAgdGhpcy5idXR0b25FdmVudERldGFpbHMgPSB7aWQ6ICd0cmlnZ2VyJywgc3RhdGU6IHtwcmVzc2VkOiBmYWxzZX19OwogIH0sCgogIHBsYXk6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbC5zY2VuZUVsOwogICAgdGhpcy51cGRhdGVDb250cm9sbGVyKCk7CiAgICB0aGlzLmFkZFNlc3Npb25FdmVudExpc3RlbmVycygpOwogICAgc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdlbnRlci12cicsIHRoaXMuYWRkU2Vzc2lvbkV2ZW50TGlzdGVuZXJzKTsKICAgIHNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy51cGRhdGVDb250cm9sbGVyKTsKICB9LAoKICBwYXVzZTogZnVuY3Rpb24gKCkgewogICAgdmFyIHNjZW5lRWwgPSB0aGlzLmVsLnNjZW5lRWw7CiAgICB0aGlzLnJlbW92ZVNlc3Npb25FdmVudExpc3RlbmVycygpOwogICAgc2NlbmVFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdlbnRlci12cicsIHRoaXMuYWRkU2Vzc2lvbkV2ZW50TGlzdGVuZXJzKTsKICAgIHNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy51cGRhdGVDb250cm9sbGVyKTsKICB9LAoKICBhZGRTZXNzaW9uRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbC5zY2VuZUVsOwogICAgaWYgKCFzY2VuZUVsLnhyU2Vzc2lvbikgeyByZXR1cm47IH0KICAgIHNjZW5lRWwueHJTZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdHN0YXJ0JywgdGhpcy5lbWl0QnV0dG9uRG93bkV2ZW50KTsKICAgIHNjZW5lRWwueHJTZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdGVuZCcsIHRoaXMuZW1pdEJ1dHRvblVwRXZlbnQpOwogIH0sCgogIHJlbW92ZVNlc3Npb25FdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkgewogICAgdmFyIHNjZW5lRWwgPSB0aGlzLmVsLnNjZW5lRWw7CiAgICBpZiAoIXNjZW5lRWwueHJTZXNzaW9uKSB7IHJldHVybjsgfQogICAgc2NlbmVFbC54clNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0c3RhcnQnLCB0aGlzLmVtaXRCdXR0b25Eb3duRXZlbnQpOwogICAgc2NlbmVFbC54clNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignc2VsZWN0ZW5kJywgdGhpcy5lbWl0QnV0dG9uVXBFdmVudCk7CiAgfSwKCiAgZW1pdEJ1dHRvbkRvd25FdmVudDogZnVuY3Rpb24gKGV2dCkgewogICAgaWYgKCF0aGlzLmNvbnRyb2xsZXIgfHwgZXZ0LmlucHV0U291cmNlLmhhbmRlZG5lc3MgIT09IHRoaXMuZGF0YS5oYW5kKSB7IHJldHVybjsgfQogICAgdGhpcy5idXR0b25FdmVudERldGFpbHMuc3RhdGUucHJlc3NlZCA9IHRydWU7CiAgICB0aGlzLmVsLmVtaXQoJ2J1dHRvbmRvd24nLCB0aGlzLmJ1dHRvbkV2ZW50RGV0YWlscyk7CiAgICB0aGlzLmVsLmVtaXQoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLmJ1dHRvbkV2ZW50RGV0YWlscyk7CiAgICB0aGlzLmVsLmVtaXQoJ3RyaWdnZXJkb3duJyk7CiAgfSwKCiAgZW1pdEJ1dHRvblVwRXZlbnQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIGlmICghdGhpcy5jb250cm9sbGVyIHx8IGV2dC5pbnB1dFNvdXJjZS5oYW5kZWRuZXNzICE9PSB0aGlzLmRhdGEuaGFuZCkgeyByZXR1cm47IH0KICAgIHRoaXMuYnV0dG9uRXZlbnREZXRhaWxzLnN0YXRlLnByZXNzZWQgPSBmYWxzZTsKICAgIHRoaXMuZWwuZW1pdCgnYnV0dG9udXAnLCB0aGlzLmJ1dHRvbkV2ZW50RGV0YWlscyk7CiAgICB0aGlzLmVsLmVtaXQoJ2J1dHRvbmNoYW5nZWQnLCB0aGlzLmJ1dHRvbkV2ZW50RGV0YWlscyk7CiAgICB0aGlzLmVsLmVtaXQoJ3RyaWdnZXJ1cCcpOwogIH0sCgogIC8qKgogICAqIEhhbmRsZSB1cGRhdGUgY29udHJvbGxlciBtYXRjaCBjcml0ZXJpYSAoc3VjaCBhcyBgaWRgLCBgaWRQcmVmaXhgLCBgaGFuZGAsIGBjb250cm9sbGVyYCkKICAgKi8KICB1cGRhdGVDb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyVXRpbHMuZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlhSKAogICAgICB0aGlzLnN5c3RlbS5jb250cm9sbGVycywKICAgICAgdGhpcy5kYXRhLmhhbmQKICAgICk7CiAgICAvLyBMZWdhY3kgaGFuZGxlIHRvIHRoZSBjb250cm9sbGVyIGZvciBvbGQgY29tcG9uZW50cy4KICAgIHRoaXMuZWwuY29tcG9uZW50c1sndHJhY2tlZC1jb250cm9scyddLmNvbnRyb2xsZXIgPSB0aGlzLmNvbnRyb2xsZXI7CgogICAgaWYgKHRoaXMuZGF0YS5hdXRvSGlkZSkgeyB0aGlzLmVsLm9iamVjdDNELnZpc2libGUgPSAhIXRoaXMuY29udHJvbGxlcjsgfQogIH0sCgogIHRpY2s6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3NlOwogICAgdmFyIHNjZW5lRWwgPSB0aGlzLmVsLnNjZW5lRWw7CiAgICB2YXIgb2JqZWN0M0QgPSB0aGlzLmVsLm9iamVjdDNEOwogICAgaWYgKCF0aGlzLmNvbnRyb2xsZXIgfHwgIXNjZW5lRWwuZnJhbWUpIHsgcmV0dXJuOyB9CiAgICBwb3NlID0gc2NlbmVFbC5mcmFtZS5nZXRJbnB1dFBvc2UodGhpcy5jb250cm9sbGVyLCBzY2VuZUVsLmZyYW1lT2ZSZWZlcmVuY2UpOwogICAgaWYgKCFwb3NlKSB7IHJldHVybjsgfQogICAgb2JqZWN0M0QubWF0cml4LmVsZW1lbnRzID0gcG9zZS50YXJnZXRSYXkudHJhbnNmb3JtTWF0cml4OwogICAgb2JqZWN0M0QubWF0cml4LmRlY29tcG9zZShvYmplY3QzRC5wb3NpdGlvbiwgb2JqZWN0M0Qucm90YXRpb24sIG9iamVjdDNELnNjYWxlKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMiOjE4N31dLDkyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKCi8qKgogKiBUcmFja2VkIGNvbnRyb2xzLgogKiBBYnN0cmFjdCBjb250cm9scyB0aGF0IGRlY2lkZSBpZiB0aGUgV2ViVlIgb3IgV2ViWFIgdmVyc2lvbiBpcyBnb2luZyB0byBiZSBhcHBsaWVkLgogKgogKiBAcHJvcGVydHkge251bWJlcn0gY29udHJvbGxlciAtIEluZGV4IG9mIGNvbnRyb2xsZXIgaW4gYXJyYXkgcmV0dXJuZWQgYnkgR2FtZXBhZCBBUEkuCiAqICBPbmx5IHVzZWQgaWYgaGFuZCBwcm9wZXJ0eSBpcyBub3Qgc2V0LgogKiBAcHJvcGVydHkge3N0cmluZ30gaWQgLSBTZWxlY3RlZCBjb250cm9sbGVyIGFtb25nIHRob3NlIHJldHVybmVkIGJ5IEdhbWVwYWQgQVBJLgogKiBAcHJvcGVydHkge251bWJlcn0gaGFuZCAtIElmIG11bHRpcGxlIGNvbnRyb2xsZXJzIGZvdW5kIHdpdGggaWQsIGNob29zZSB0aGUgb25lIHdpdGggdGhlCiAqICBnaXZlbiB2YWx1ZSBmb3IgaGFuZC4gSWYgc2V0LCB3ZSBpZ25vcmUgJ2NvbnRyb2xsZXInIHByb3BlcnR5CiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgndHJhY2tlZC1jb250cm9scycsIHsKICBzY2hlbWE6IHsKICAgIGF1dG9IaWRlOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBjb250cm9sbGVyOiB7ZGVmYXVsdDogMH0sCiAgICBpZDoge3R5cGU6ICdzdHJpbmcnLCBkZWZhdWx0OiAnJ30sCiAgICBoYW5kOiB7dHlwZTogJ3N0cmluZycsIGRlZmF1bHQ6ICcnfSwKICAgIGlkUHJlZml4OiB7dHlwZTogJ3N0cmluZycsIGRlZmF1bHQ6ICcnfSwKICAgIG9yaWVudGF0aW9uT2Zmc2V0OiB7dHlwZTogJ3ZlYzMnfSwKICAgIC8vIEFybSBtb2RlbCBwYXJhbWV0ZXJzIHdoZW4gbm90IDZEb0YuCiAgICBhcm1Nb2RlbDoge2RlZmF1bHQ6IHRydWV9LAogICAgaGVhZEVsZW1lbnQ6IHt0eXBlOiAnc2VsZWN0b3InfQogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgaWYgKGVsLnNjZW5lRWwuaGFzV2ViWFIpIHsKICAgICAgZWwuc2V0QXR0cmlidXRlKCd0cmFja2VkLWNvbnRyb2xzLXdlYnhyJywgZGF0YSk7CiAgICB9IGVsc2UgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RyYWNrZWQtY29udHJvbHMtd2VidnInLCBkYXRhKTsKICAgIH0KICB9Cn0pOwoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDZ9XSw5MzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CgovKioKICogVmlzaWJpbGl0eSBjb21wb25lbnQuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgndmlzaWJsZScsIHsKICBzY2hlbWE6IHtkZWZhdWx0OiB0cnVlfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLm9iamVjdDNELnZpc2libGUgPSB0aGlzLmRhdGE7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2fV0sOTQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgYmluZCA9IF9kZXJlcV8oJy4uL3V0aWxzL2JpbmQnKTsKCnZhciB0cmFja2VkQ29udHJvbHNVdGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMnKTsKdmFyIGNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLmNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cDsKdmFyIGVtaXRJZkF4ZXNDaGFuZ2VkID0gdHJhY2tlZENvbnRyb2xzVXRpbHMuZW1pdElmQXhlc0NoYW5nZWQ7CnZhciBvbkJ1dHRvbkV2ZW50ID0gdHJhY2tlZENvbnRyb2xzVXRpbHMub25CdXR0b25FdmVudDsKCnZhciBWSVZFX0NPTlRST0xMRVJfTU9ERUxfT0JKX1VSTCA9ICdodHRwczovL2Nkbi5hZnJhbWUuaW8vY29udHJvbGxlcnMvdml2ZS92cl9jb250cm9sbGVyX3ZpdmUub2JqJzsKdmFyIFZJVkVfQ09OVFJPTExFUl9NT0RFTF9PQkpfTVRMID0gJ2h0dHBzOi8vY2RuLmFmcmFtZS5pby9jb250cm9sbGVycy92aXZlL3ZyX2NvbnRyb2xsZXJfdml2ZS5tdGwnOwoKdmFyIEdBTUVQQURfSURfUFJFRklYID0gJ09wZW5WUiAnOwoKLyoqCiAqIFZpdmUgY29udHJvbHMuCiAqIEludGVyZmFjZSB3aXRoIFZpdmUgY29udHJvbGxlcnMgYW5kIG1hcCBHYW1lcGFkIGV2ZW50cyB0byBjb250cm9sbGVyIGJ1dHRvbnM6CiAqIHRyYWNrcGFkLCB0cmlnZ2VyLCBncmlwLCBtZW51LCBzeXN0ZW0KICogTG9hZCBhIGNvbnRyb2xsZXIgbW9kZWwgYW5kIGhpZ2hsaWdodCB0aGUgcHJlc3NlZCBidXR0b25zLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3ZpdmUtY29udHJvbHMnLCB7CiAgc2NoZW1hOiB7CiAgICBoYW5kOiB7ZGVmYXVsdDogJ2xlZnQnfSwKICAgIGJ1dHRvbkNvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyNGQUZBRkEnfSwgIC8vIE9mZi13aGl0ZS4KICAgIGJ1dHRvbkhpZ2hsaWdodENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyMyMkQxRUUnfSwgIC8vIExpZ2h0IGJsdWUuCiAgICBtb2RlbDoge2RlZmF1bHQ6IHRydWV9LAogICAgb3JpZW50YXRpb25PZmZzZXQ6IHt0eXBlOiAndmVjMyd9CiAgfSwKCiAgLyoqCiAgICogQnV0dG9uIElEczoKICAgKiAwIC0gdHJhY2twYWQKICAgKiAxIC0gdHJpZ2dlciAoaW50ZW5zaXR5IHZhbHVlIGZyb20gMC41IHRvIDEpCiAgICogMiAtIGdyaXAKICAgKiAzIC0gbWVudSAoZGlzcGF0Y2ggYnV0IGJldHRlciBmb3IgbWVudSBvcHRpb25zKQogICAqIDQgLSBzeXN0ZW0gKG5ldmVyIGRpc3BhdGNoZWQgb24gdGhpcyBsYXllcikKICAgKi8KICBtYXBwaW5nOiB7CiAgICBheGVzOiB7dHJhY2twYWQ6IFswLCAxXX0sCiAgICBidXR0b25zOiBbJ3RyYWNrcGFkJywgJ3RyaWdnZXInLCAnZ3JpcCcsICdtZW51JywgJ3N5c3RlbSddCiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdGhpcy5jb250cm9sbGVyUHJlc2VudCA9IGZhbHNlOwogICAgdGhpcy5sYXN0Q29udHJvbGxlckNoZWNrID0gMDsKICAgIHRoaXMub25CdXR0b25DaGFuZ2VkID0gYmluZCh0aGlzLm9uQnV0dG9uQ2hhbmdlZCwgdGhpcyk7CiAgICB0aGlzLm9uQnV0dG9uRG93biA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAnZG93bicsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblVwID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd1cCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoRW5kID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaGVuZCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3RvdWNoc3RhcnQnLCBzZWxmKTsgfTsKICAgIHRoaXMucHJldmlvdXNCdXR0b25WYWx1ZXMgPSB7fTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0gPSB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5yZW5kZXJlcjsKCiAgICB0aGlzLmJpbmRNZXRob2RzKCk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICAgIHRoaXMuYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcigpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICBiaW5kTWV0aG9kczogZnVuY3Rpb24gKCkgewogICAgdGhpcy5vbk1vZGVsTG9hZGVkID0gYmluZCh0aGlzLm9uTW9kZWxMb2FkZWQsIHRoaXMpOwogICAgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlID0gYmluZCh0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIHRoaXMpOwogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQgPSBiaW5kKHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50LCB0aGlzKTsKICAgIHRoaXMucmVtb3ZlQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lciA9IGJpbmQodGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyLCB0aGlzKTsKICAgIHRoaXMub25BeGlzTW92ZWQgPSBiaW5kKHRoaXMub25BeGlzTW92ZWQsIHRoaXMpOwogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25CdXR0b25Ub3VjaEVuZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICB0aGlzLmNvbnRyb2xsZXJFdmVudHNBY3RpdmUgPSB0cnVlOwogIH0sCgogIHJlbW92ZUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25CdXR0b25Ub3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICB0aGlzLmNvbnRyb2xsZXJFdmVudHNBY3RpdmUgPSBmYWxzZTsKICB9LAoKICAvKioKICAgKiBPbmNlIE9wZW5WUiByZXR1cm5zIGNvcnJlY3QgaGFuZCBkYXRhIGluIHN1cHBvcnRpbmcgYnJvd3NlcnMsIHdlIGNhbiB1c2UgaGFuZCBwcm9wZXJ0eS4KICAgKiB2YXIgaXNQcmVzZW50ID0gY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwKHRoaXMuZWwuc2NlbmVFbCwgR0FNRVBBRF9JRF9QUkVGSVgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBoYW5kOiBkYXRhLmhhbmQgfSk7CiAgICogVW50aWwgdGhlbiwgdXNlIGhhcmRjb2RlZCBpbmRleC4KICAgKi8KICBjaGVja0lmQ29udHJvbGxlclByZXNlbnQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGNvbnRyb2xsZXJJbmRleCA9IGRhdGEuaGFuZCA9PT0gJ3JpZ2h0JyA/IDAgOiBkYXRhLmhhbmQgPT09ICdsZWZ0JyA/IDEgOiAyOwogICAgY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwKHRoaXMsIEdBTUVQQURfSURfUFJFRklYLCB7aW5kZXg6IGNvbnRyb2xsZXJJbmRleH0pOwogIH0sCgogIGluamVjdFRyYWNrZWRDb250cm9sczogZnVuY3Rpb24gKCkgewogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwoKICAgIC8vIElmIHdlIGhhdmUgYW4gT3BlblZSIEdhbWVwYWQsIHVzZSB0aGUgZml4ZWQgbWFwcGluZy4KICAgIGVsLnNldEF0dHJpYnV0ZSgndHJhY2tlZC1jb250cm9scycsIHsKICAgICAgaWRQcmVmaXg6IEdBTUVQQURfSURfUFJFRklYLAogICAgICAvLyBIYW5kIElEczogMSA9IHJpZ2h0LCAwID0gbGVmdCwgMiA9IGFueXRoaW5nIGVsc2UuCiAgICAgIGNvbnRyb2xsZXI6IGRhdGEuaGFuZCA9PT0gJ3JpZ2h0JyA/IDEgOiBkYXRhLmhhbmQgPT09ICdsZWZ0JyA/IDAgOiAyLAogICAgICBvcmllbnRhdGlvbk9mZnNldDogZGF0YS5vcmllbnRhdGlvbk9mZnNldAogICAgfSk7CgogICAgLy8gTG9hZCBtb2RlbC4KICAgIGlmICghdGhpcy5kYXRhLm1vZGVsKSB7IHJldHVybjsgfQogICAgdGhpcy5lbC5zZXRBdHRyaWJ1dGUoJ29iai1tb2RlbCcsIHsKICAgICAgb2JqOiBWSVZFX0NPTlRST0xMRVJfTU9ERUxfT0JKX1VSTCwKICAgICAgbXRsOiBWSVZFX0NPTlRST0xMRVJfTU9ERUxfT0JKX01UTAogICAgfSk7CiAgfSwKCiAgYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgdGhpcy5lbC5zY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJzdXBkYXRlZCcsIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSwgZmFsc2UpOwogIH0sCgogIHJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICBvbkNvbnRyb2xsZXJzVXBkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCgpOwogIH0sCgogIC8qKgogICAqIFJvdGF0ZSB0aGUgdHJpZ2dlciBidXR0b24gYmFzZWQgb24gaG93IGhhcmQgdGhlIHRyaWdnZXIgaXMgcHJlc3NlZC4KICAgKi8KICBvbkJ1dHRvbkNoYW5nZWQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBidXR0b24gPSB0aGlzLm1hcHBpbmcuYnV0dG9uc1tldnQuZGV0YWlsLmlkXTsKICAgIHZhciBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlczsKICAgIHZhciBhbmFsb2dWYWx1ZTsKCiAgICBpZiAoIWJ1dHRvbikgeyByZXR1cm47IH0KCiAgICBpZiAoYnV0dG9uID09PSAndHJpZ2dlcicpIHsKICAgICAgYW5hbG9nVmFsdWUgPSBldnQuZGV0YWlsLnN0YXRlLnZhbHVlOwogICAgICAvLyBVcGRhdGUgdHJpZ2dlciByb3RhdGlvbiBkZXBlbmRpbmcgb24gYnV0dG9uIHZhbHVlLgogICAgICBpZiAoYnV0dG9uTWVzaGVzICYmIGJ1dHRvbk1lc2hlcy50cmlnZ2VyKSB7CiAgICAgICAgYnV0dG9uTWVzaGVzLnRyaWdnZXIucm90YXRpb24ueCA9IC1hbmFsb2dWYWx1ZSAqIChNYXRoLlBJIC8gMTIpOwogICAgICB9CiAgICB9CgogICAgLy8gUGFzcyBhbG9uZyBjaGFuZ2VkIGV2ZW50IHdpdGggYnV0dG9uIHN0YXRlLCB1c2luZyBidXR0b24gbWFwcGluZyBmb3IgY29udmVuaWVuY2UuCiAgICB0aGlzLmVsLmVtaXQoYnV0dG9uICsgJ2NoYW5nZWQnLCBldnQuZGV0YWlsLnN0YXRlKTsKICB9LAoKICBvbk1vZGVsTG9hZGVkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgYnV0dG9uTWVzaGVzOwogICAgdmFyIGNvbnRyb2xsZXJPYmplY3QzRCA9IGV2dC5kZXRhaWwubW9kZWw7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CgogICAgLy8gU3RvcmUgYnV0dG9uIG1lc2hlcyBvYmplY3QgdG8gYmUgYWJsZSB0byBjaGFuZ2UgdGhlaXIgY29sb3JzLgogICAgYnV0dG9uTWVzaGVzID0gdGhpcy5idXR0b25NZXNoZXMgPSB7fTsKICAgIGJ1dHRvbk1lc2hlcy5ncmlwID0gewogICAgICBsZWZ0OiBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdsZWZ0Z3JpcCcpLAogICAgICByaWdodDogY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgncmlnaHRncmlwJykKICAgIH07CiAgICBidXR0b25NZXNoZXMubWVudSA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ21lbnVidXR0b24nKTsKICAgIGJ1dHRvbk1lc2hlcy5zeXN0ZW0gPSBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdzeXN0ZW1idXR0b24nKTsKICAgIGJ1dHRvbk1lc2hlcy50cmFja3BhZCA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ3RvdWNocGFkJyk7CiAgICBidXR0b25NZXNoZXMudHJpZ2dlciA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ3RyaWdnZXInKTsKCiAgICAvLyBTZXQgZGVmYXVsdCBjb2xvcnMuCiAgICBPYmplY3Qua2V5cyhidXR0b25NZXNoZXMpLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbk5hbWUpIHsKICAgICAgc2VsZi5zZXRCdXR0b25Db2xvcihidXR0b25OYW1lLCBzZWxmLmRhdGEuYnV0dG9uQ29sb3IpOwogICAgfSk7CgogICAgLy8gT2Zmc2V0IHBpdm90IHBvaW50LgogICAgY29udHJvbGxlck9iamVjdDNELnBvc2l0aW9uLnNldCgwLCAtMC4wMTUsIDAuMDQpOwogIH0sCgogIG9uQXhpc01vdmVkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICBlbWl0SWZBeGVzQ2hhbmdlZCh0aGlzLCB0aGlzLm1hcHBpbmcuYXhlcywgZXZ0KTsKICB9LAoKICB1cGRhdGVNb2RlbDogZnVuY3Rpb24gKGJ1dHRvbk5hbWUsIGV2dE5hbWUpIHsKICAgIHZhciBjb2xvcjsKICAgIHZhciBpc1RvdWNoOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CgogICAgaXNUb3VjaCA9IGV2dE5hbWUuaW5kZXhPZigndG91Y2gnKSAhPT0gLTE7CiAgICAvLyBEb24ndCBjaGFuZ2UgY29sb3IgZm9yIHRyYWNrcGFkIHRvdWNoLgogICAgaWYgKGlzVG91Y2gpIHsgcmV0dXJuOyB9CgogICAgLy8gVXBkYXRlIGNvbG9ycy4KICAgIGNvbG9yID0gZXZ0TmFtZSA9PT0gJ3VwJyA/IHRoaXMuZGF0YS5idXR0b25Db2xvciA6IHRoaXMuZGF0YS5idXR0b25IaWdobGlnaHRDb2xvcjsKICAgIHRoaXMuc2V0QnV0dG9uQ29sb3IoYnV0dG9uTmFtZSwgY29sb3IpOwogIH0sCgogIHNldEJ1dHRvbkNvbG9yOiBmdW5jdGlvbiAoYnV0dG9uTmFtZSwgY29sb3IpIHsKICAgIHZhciBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlczsKICAgIHZhciByZW5kZXJlclN5c3RlbSA9IHRoaXMucmVuZGVyZXJTeXN0ZW07CgogICAgaWYgKCFidXR0b25NZXNoZXMpIHsgcmV0dXJuOyB9CgogICAgLy8gTmVlZCB0byBkbyBib3RoIGxlZnQgYW5kIHJpZ2h0IHNpZGVzIGZvciBncmlwLgogICAgaWYgKGJ1dHRvbk5hbWUgPT09ICdncmlwJykgewogICAgICBidXR0b25NZXNoZXMuZ3JpcC5sZWZ0Lm1hdGVyaWFsLmNvbG9yLnNldChjb2xvcik7CiAgICAgIGJ1dHRvbk1lc2hlcy5ncmlwLnJpZ2h0Lm1hdGVyaWFsLmNvbG9yLnNldChjb2xvcik7CiAgICAgIHJlbmRlcmVyU3lzdGVtLmFwcGx5Q29sb3JDb3JyZWN0aW9uKGJ1dHRvbk1lc2hlcy5ncmlwLmxlZnQubWF0ZXJpYWwuY29sb3IpOwogICAgICByZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbihidXR0b25NZXNoZXMuZ3JpcC5yaWdodC5tYXRlcmlhbC5jb2xvcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXS5tYXRlcmlhbC5jb2xvci5zZXQoY29sb3IpOwogICAgcmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24oYnV0dG9uTWVzaGVzW2J1dHRvbk5hbWVdLm1hdGVyaWFsLmNvbG9yKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL3V0aWxzL2JpbmQiOjE3MywiLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scyI6MTg3fV0sOTU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgYmluZCA9IF9kZXJlcV8oJy4uL3V0aWxzL2JpbmQnKTsKCnZhciB0cmFja2VkQ29udHJvbHNVdGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMnKTsKdmFyIGNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cCA9IHRyYWNrZWRDb250cm9sc1V0aWxzLmNoZWNrQ29udHJvbGxlclByZXNlbnRBbmRTZXR1cDsKdmFyIGVtaXRJZkF4ZXNDaGFuZ2VkID0gdHJhY2tlZENvbnRyb2xzVXRpbHMuZW1pdElmQXhlc0NoYW5nZWQ7CnZhciBvbkJ1dHRvbkV2ZW50ID0gdHJhY2tlZENvbnRyb2xzVXRpbHMub25CdXR0b25FdmVudDsKCnZhciBHQU1FUEFEX0lEX1BSRUZJWCA9ICdIVEMgVml2ZSBGb2N1cyc7Cgp2YXIgVklWRV9GT0NVU19DT05UUk9MTEVSX01PREVMX1VSTCA9ICdodHRwczovL2Nkbi5hZnJhbWUuaW8vY29udHJvbGxlcnMvdml2ZS9mb2N1cy1jb250cm9sbGVyL2ZvY3VzLWNvbnRyb2xsZXIuZ2x0Zic7CgovKioKICogVml2ZSBGb2N1cyBjb250cm9scy4KICogSW50ZXJmYWNlIHdpdGggVml2ZSBGb2N1cyBjb250cm9sbGVyIGFuZCBtYXAgR2FtZXBhZCBldmVudHMgdG8KICogY29udHJvbGxlciBidXR0b25zOiB0cmFja3BhZCwgdHJpZ2dlcgogKiBMb2FkIGEgY29udHJvbGxlciBtb2RlbCBhbmQgaGlnaGxpZ2h0IHRoZSBwcmVzc2VkIGJ1dHRvbnMuCiAqLwptb2R1bGUuZXhwb3J0cy5Db21wb25lbnQgPSByZWdpc3RlckNvbXBvbmVudCgndml2ZS1mb2N1cy1jb250cm9scycsIHsKICBzY2hlbWE6IHsKICAgIGhhbmQ6IHtkZWZhdWx0OiAnJ30sICAvLyBUaGlzIGluZm9ybXMgdGhlIGRlZ2VuZXJhdGUgYXJtIG1vZGVsLgogICAgYnV0dG9uVG91Y2hlZENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyNCQkJCQkInfSwKICAgIGJ1dHRvbkhpZ2hsaWdodENvbG9yOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyM3QTdBN0EnfSwKICAgIG1vZGVsOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBvcmllbnRhdGlvbk9mZnNldDoge3R5cGU6ICd2ZWMzJ30sCiAgICBhcm1Nb2RlbDoge2RlZmF1bHQ6IHRydWV9CiAgfSwKCiAgLyoqCiAgICogQnV0dG9uIElEczoKICAgKiAwIC0gdHJhY2twYWQKICAgKiAxIC0gdHJpZ2dlcgogICAqLwogIG1hcHBpbmc6IHsKICAgIGF4ZXM6IHt0cmFja3BhZDogWzAsIDFdfSwKICAgIGJ1dHRvbnM6IFsndHJpZ2dlcicsICd0cmFja3BhZCddCiAgfSwKCiAgYmluZE1ldGhvZHM6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub25Nb2RlbExvYWRlZCA9IGJpbmQodGhpcy5vbk1vZGVsTG9hZGVkLCB0aGlzKTsKICAgIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSA9IGJpbmQodGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCB0aGlzKTsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50ID0gYmluZCh0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCwgdGhpcyk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIgPSBiaW5kKHRoaXMucmVtb3ZlQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lciwgdGhpcyk7CiAgICB0aGlzLm9uQXhpc01vdmVkID0gYmluZCh0aGlzLm9uQXhpc01vdmVkLCB0aGlzKTsKICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLm9uQnV0dG9uQ2hhbmdlZCA9IGJpbmQodGhpcy5vbkJ1dHRvbkNoYW5nZWQsIHRoaXMpOwogICAgdGhpcy5vbkJ1dHRvbkRvd24gPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ2Rvd24nLCBzZWxmKTsgfTsKICAgIHRoaXMub25CdXR0b25VcCA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAndXAnLCBzZWxmKTsgfTsKICAgIHRoaXMub25CdXR0b25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaHN0YXJ0Jywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hFbmQgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3RvdWNoZW5kJywgc2VsZik7IH07CiAgICB0aGlzLmNvbnRyb2xsZXJQcmVzZW50ID0gZmFsc2U7CiAgICB0aGlzLmxhc3RDb250cm9sbGVyQ2hlY2sgPSAwOwogICAgdGhpcy5iaW5kTWV0aG9kcygpOwogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uQnV0dG9uVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2F4aXNtb3ZlJywgdGhpcy5vbkF4aXNNb3ZlZCk7CiAgICB0aGlzLmNvbnRyb2xsZXJFdmVudHNBY3RpdmUgPSB0cnVlOwogICAgdGhpcy5hZGRDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyKCk7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b25jaGFuZ2VkJywgdGhpcy5vbkJ1dHRvbkNoYW5nZWQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9uZG93bicsIHRoaXMub25CdXR0b25Eb3duKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbnVwJywgdGhpcy5vbkJ1dHRvblVwKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uQnV0dG9uVG91Y2hTdGFydCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25CdXR0b25Ub3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb2RlbC1sb2FkZWQnLCB0aGlzLm9uTW9kZWxMb2FkZWQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYXhpc21vdmUnLCB0aGlzLm9uQXhpc01vdmVkKTsKICAgIHRoaXMuY29udHJvbGxlckV2ZW50c0FjdGl2ZSA9IGZhbHNlOwogICAgdGhpcy5yZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyKCk7CiAgfSwKCiAgY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50OiBmdW5jdGlvbiAoKSB7CiAgICBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAodGhpcywgR0FNRVBBRF9JRF9QUkVGSVgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaGFuZCA/IHtoYW5kOiB0aGlzLmRhdGEuaGFuZH0gOiB7fSk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICAgIHRoaXMuYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcigpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICBpbmplY3RUcmFja2VkQ29udHJvbHM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIGVsLnNldEF0dHJpYnV0ZSgndHJhY2tlZC1jb250cm9scycsIHsKICAgICAgYXJtTW9kZWw6IGRhdGEuYXJtTW9kZWwsCiAgICAgIGlkUHJlZml4OiBHQU1FUEFEX0lEX1BSRUZJWCwKICAgICAgb3JpZW50YXRpb25PZmZzZXQ6IGRhdGEub3JpZW50YXRpb25PZmZzZXQKICAgIH0pOwogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnZ2x0Zi1tb2RlbCcsIFZJVkVfRk9DVVNfQ09OVFJPTExFUl9NT0RFTF9VUkwpOwogIH0sCgogIGFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICByZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCBmYWxzZSk7CiAgfSwKCiAgb25Db250cm9sbGVyc1VwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICB9LAoKICBvbk1vZGVsTG9hZGVkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICB2YXIgY29udHJvbGxlck9iamVjdDNEID0gZXZ0LmRldGFpbC5tb2RlbDsKICAgIHZhciBidXR0b25NZXNoZXM7CgogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlcyA9IHt9OwogICAgYnV0dG9uTWVzaGVzLnRyaWdnZXIgPSBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdCdW1wZXJLZXknKTsKICAgIGJ1dHRvbk1lc2hlcy50cmlnZ2VyUHJlc3NlZCA9IGNvbnRyb2xsZXJPYmplY3QzRC5nZXRPYmplY3RCeU5hbWUoJ0J1bXBlcktleV9QcmVzcycpOwogICAgaWYgKGJ1dHRvbk1lc2hlcy50cmlnZ2VyUHJlc3NlZCkgewogICAgICBidXR0b25NZXNoZXMudHJpZ2dlclByZXNzZWQudmlzaWJsZSA9IGZhbHNlOwogICAgfQogICAgYnV0dG9uTWVzaGVzLnRyYWNrcGFkID0gY29udHJvbGxlck9iamVjdDNELmdldE9iamVjdEJ5TmFtZSgnVG91Y2hQYWQnKTsKICAgIGJ1dHRvbk1lc2hlcy50cmFja3BhZFByZXNzZWQgPSBjb250cm9sbGVyT2JqZWN0M0QuZ2V0T2JqZWN0QnlOYW1lKCdUb3VjaFBhZF9QcmVzcycpOwogICAgaWYgKGJ1dHRvbk1lc2hlcy50cmFja3BhZFByZXNzZWQpIHsKICAgICAgYnV0dG9uTWVzaGVzLnRyYWNrcGFkUHJlc3NlZC52aXNpYmxlID0gZmFsc2U7CiAgICB9CiAgfSwKCiAgLy8gTm8gYW5hbG9nIGJ1dHRvbnMsIG9ubHkgZW1pdHMgMC8xIHZhbHVlcwogIG9uQnV0dG9uQ2hhbmdlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIGJ1dHRvbiA9IHRoaXMubWFwcGluZy5idXR0b25zW2V2dC5kZXRhaWwuaWRdOwogICAgaWYgKCFidXR0b24pIHJldHVybjsKICAgIC8vIFBhc3MgYWxvbmcgY2hhbmdlZCBldmVudCB3aXRoIGJ1dHRvbiBzdGF0ZSwgdXNpbmcgYnV0dG9uIG1hcHBpbmcgZm9yIGNvbnZlbmllbmNlLgogICAgdGhpcy5lbC5lbWl0KGJ1dHRvbiArICdjaGFuZ2VkJywgZXZ0LmRldGFpbC5zdGF0ZSk7CiAgfSwKCiAgb25BeGlzTW92ZWQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIGVtaXRJZkF4ZXNDaGFuZ2VkKHRoaXMsIHRoaXMubWFwcGluZy5heGVzLCBldnQpOwogIH0sCgogIHVwZGF0ZU1vZGVsOiBmdW5jdGlvbiAoYnV0dG9uTmFtZSwgZXZ0TmFtZSkgewogICAgaWYgKCF0aGlzLmRhdGEubW9kZWwpIHsgcmV0dXJuOyB9CiAgICB0aGlzLnVwZGF0ZUJ1dHRvbk1vZGVsKGJ1dHRvbk5hbWUsIGV2dE5hbWUpOwogIH0sCgogIHVwZGF0ZUJ1dHRvbk1vZGVsOiBmdW5jdGlvbiAoYnV0dG9uTmFtZSwgc3RhdGUpIHsKICAgIHZhciBidXR0b25NZXNoZXMgPSB0aGlzLmJ1dHRvbk1lc2hlczsKICAgIHZhciBwcmVzc2VkTmFtZSA9IGJ1dHRvbk5hbWUgKyAnUHJlc3NlZCc7CiAgICBpZiAoIWJ1dHRvbk1lc2hlcyB8fCAhYnV0dG9uTWVzaGVzW2J1dHRvbk5hbWVdIHx8ICFidXR0b25NZXNoZXNbcHJlc3NlZE5hbWVdKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciBjb2xvcjsKICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgY2FzZSAnZG93bic6CiAgICAgICAgY29sb3IgPSB0aGlzLmRhdGEuYnV0dG9uSGlnaGxpZ2h0Q29sb3I7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3RvdWNoc3RhcnQnOgogICAgICAgIGNvbG9yID0gdGhpcy5kYXRhLmJ1dHRvblRvdWNoZWRDb2xvcjsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChjb2xvcikgewogICAgICBidXR0b25NZXNoZXNbcHJlc3NlZE5hbWVdLm1hdGVyaWFsLmNvbG9yLnNldChjb2xvcik7CiAgICB9CiAgICBidXR0b25NZXNoZXNbcHJlc3NlZE5hbWVdLnZpc2libGUgPSAhIWNvbG9yOwogICAgYnV0dG9uTWVzaGVzW2J1dHRvbk5hbWVdLnZpc2libGUgPSAhY29sb3I7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi91dGlscy9iaW5kIjoxNzMsIi4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMiOjE4N31dLDk2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIEtFWUNPREVfVE9fQ09ERSA9IF9kZXJlcV8oJy4uL2NvbnN0YW50cycpLmtleWJvYXJkZXZlbnQuS0VZQ09ERV9UT19DT0RFOwp2YXIgcmVnaXN0ZXJDb21wb25lbnQgPSBfZGVyZXFfKCcuLi9jb3JlL2NvbXBvbmVudCcpLnJlZ2lzdGVyQ29tcG9uZW50Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7Cgp2YXIgYmluZCA9IHV0aWxzLmJpbmQ7CnZhciBzaG91bGRDYXB0dXJlS2V5RXZlbnQgPSB1dGlscy5zaG91bGRDYXB0dXJlS2V5RXZlbnQ7Cgp2YXIgQ0xBTVBfVkVMT0NJVFkgPSAwLjAwMDAxOwp2YXIgTUFYX0RFTFRBID0gMC4yOwp2YXIgS0VZUyA9IFsKICAnS2V5VycsICdLZXlBJywgJ0tleVMnLCAnS2V5RCcsCiAgJ0Fycm93VXAnLCAnQXJyb3dMZWZ0JywgJ0Fycm93UmlnaHQnLCAnQXJyb3dEb3duJwpdOwoKLyoqCiAqIFdBU0QgY29tcG9uZW50IHRvIGNvbnRyb2wgZW50aXRpZXMgdXNpbmcgV0FTRCBrZXlzLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3dhc2QtY29udHJvbHMnLCB7CiAgc2NoZW1hOiB7CiAgICBhY2NlbGVyYXRpb246IHtkZWZhdWx0OiA2NX0sCiAgICBhZEF4aXM6IHtkZWZhdWx0OiAneCcsIG9uZU9mOiBbJ3gnLCAneScsICd6J119LAogICAgYWRFbmFibGVkOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBhZEludmVydGVkOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgZW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9LAogICAgZmx5OiB7ZGVmYXVsdDogZmFsc2V9LAogICAgd3NBeGlzOiB7ZGVmYXVsdDogJ3onLCBvbmVPZjogWyd4JywgJ3knLCAneiddfSwKICAgIHdzRW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9LAogICAgd3NJbnZlcnRlZDoge2RlZmF1bHQ6IGZhbHNlfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIC8vIFRvIGtlZXAgdHJhY2sgb2YgdGhlIHByZXNzZWQga2V5cy4KICAgIHRoaXMua2V5cyA9IHt9OwogICAgdGhpcy5lYXNpbmcgPSAxLjE7CgogICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CgogICAgLy8gQmluZCBtZXRob2RzIGFuZCBhZGQgZXZlbnQgbGlzdGVuZXJzLgogICAgdGhpcy5vbkJsdXIgPSBiaW5kKHRoaXMub25CbHVyLCB0aGlzKTsKICAgIHRoaXMub25Gb2N1cyA9IGJpbmQodGhpcy5vbkZvY3VzLCB0aGlzKTsKICAgIHRoaXMub25LZXlEb3duID0gYmluZCh0aGlzLm9uS2V5RG93biwgdGhpcyk7CiAgICB0aGlzLm9uS2V5VXAgPSBiaW5kKHRoaXMub25LZXlVcCwgdGhpcyk7CiAgICB0aGlzLm9uVmlzaWJpbGl0eUNoYW5nZSA9IGJpbmQodGhpcy5vblZpc2liaWxpdHlDaGFuZ2UsIHRoaXMpOwogICAgdGhpcy5hdHRhY2hWaXNpYmlsaXR5RXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICB0aWNrOiBmdW5jdGlvbiAodGltZSwgZGVsdGEpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciB2ZWxvY2l0eSA9IHRoaXMudmVsb2NpdHk7CgogICAgaWYgKCF2ZWxvY2l0eVtkYXRhLmFkQXhpc10gJiYgIXZlbG9jaXR5W2RhdGEud3NBeGlzXSAmJgogICAgICAgIGlzRW1wdHlPYmplY3QodGhpcy5rZXlzKSkgeyByZXR1cm47IH0KCiAgICAvLyBVcGRhdGUgdmVsb2NpdHkuCiAgICBkZWx0YSA9IGRlbHRhIC8gMTAwMDsKICAgIHRoaXMudXBkYXRlVmVsb2NpdHkoZGVsdGEpOwoKICAgIGlmICghdmVsb2NpdHlbZGF0YS5hZEF4aXNdICYmICF2ZWxvY2l0eVtkYXRhLndzQXhpc10pIHsgcmV0dXJuOyB9CgogICAgLy8gR2V0IG1vdmVtZW50IHZlY3RvciBhbmQgdHJhbnNsYXRlIHBvc2l0aW9uLgogICAgZWwub2JqZWN0M0QucG9zaXRpb24uYWRkKHRoaXMuZ2V0TW92ZW1lbnRWZWN0b3IoZGVsdGEpKTsKICB9LAoKICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucmVtb3ZlS2V5RXZlbnRMaXN0ZW5lcnMoKTsKICAgIHRoaXMucmVtb3ZlVmlzaWJpbGl0eUV2ZW50TGlzdGVuZXJzKCk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5hdHRhY2hLZXlFdmVudExpc3RlbmVycygpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmtleXMgPSB7fTsKICAgIHRoaXMucmVtb3ZlS2V5RXZlbnRMaXN0ZW5lcnMoKTsKICB9LAoKICB1cGRhdGVWZWxvY2l0eTogZnVuY3Rpb24gKGRlbHRhKSB7CiAgICB2YXIgYWNjZWxlcmF0aW9uOwogICAgdmFyIGFkQXhpczsKICAgIHZhciBhZFNpZ247CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBrZXlzID0gdGhpcy5rZXlzOwogICAgdmFyIHZlbG9jaXR5ID0gdGhpcy52ZWxvY2l0eTsKICAgIHZhciB3c0F4aXM7CiAgICB2YXIgd3NTaWduOwoKICAgIGFkQXhpcyA9IGRhdGEuYWRBeGlzOwogICAgd3NBeGlzID0gZGF0YS53c0F4aXM7CgogICAgLy8gSWYgRlBTIHRvbyBsb3csIHJlc2V0IHZlbG9jaXR5LgogICAgaWYgKGRlbHRhID4gTUFYX0RFTFRBKSB7CiAgICAgIHZlbG9jaXR5W2FkQXhpc10gPSAwOwogICAgICB2ZWxvY2l0eVt3c0F4aXNdID0gMDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGh0dHBzOi8vZ2FtZWRldi5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvMTUxMzgzL2ZyYW1lLXJhdGUtaW5kZXBlbmRhbnQtbW92ZW1lbnQtd2l0aC1hY2NlbGVyYXRpb24KICAgIHZhciBzY2FsZWRFYXNpbmcgPSBNYXRoLnBvdygxIC8gdGhpcy5lYXNpbmcsIGRlbHRhICogNjApOwogICAgLy8gVmVsb2NpdHkgRWFzaW5nLgogICAgaWYgKHZlbG9jaXR5W2FkQXhpc10gIT09IDApIHsKICAgICAgdmVsb2NpdHlbYWRBeGlzXSAtPSB2ZWxvY2l0eVthZEF4aXNdICogc2NhbGVkRWFzaW5nOwogICAgfQogICAgaWYgKHZlbG9jaXR5W3dzQXhpc10gIT09IDApIHsKICAgICAgdmVsb2NpdHlbd3NBeGlzXSAtPSB2ZWxvY2l0eVt3c0F4aXNdICogc2NhbGVkRWFzaW5nOwogICAgfQoKICAgIC8vIENsYW1wIHZlbG9jaXR5IGVhc2luZy4KICAgIGlmIChNYXRoLmFicyh2ZWxvY2l0eVthZEF4aXNdKSA8IENMQU1QX1ZFTE9DSVRZKSB7IHZlbG9jaXR5W2FkQXhpc10gPSAwOyB9CiAgICBpZiAoTWF0aC5hYnModmVsb2NpdHlbd3NBeGlzXSkgPCBDTEFNUF9WRUxPQ0lUWSkgeyB2ZWxvY2l0eVt3c0F4aXNdID0gMDsgfQoKICAgIGlmICghZGF0YS5lbmFibGVkKSB7IHJldHVybjsgfQoKICAgIC8vIFVwZGF0ZSB2ZWxvY2l0eSB1c2luZyBrZXlzIHByZXNzZWQuCiAgICBhY2NlbGVyYXRpb24gPSBkYXRhLmFjY2VsZXJhdGlvbjsKICAgIGlmIChkYXRhLmFkRW5hYmxlZCkgewogICAgICBhZFNpZ24gPSBkYXRhLmFkSW52ZXJ0ZWQgPyAtMSA6IDE7CiAgICAgIGlmIChrZXlzLktleUEgfHwga2V5cy5BcnJvd0xlZnQpIHsgdmVsb2NpdHlbYWRBeGlzXSAtPSBhZFNpZ24gKiBhY2NlbGVyYXRpb24gKiBkZWx0YTsgfQogICAgICBpZiAoa2V5cy5LZXlEIHx8IGtleXMuQXJyb3dSaWdodCkgeyB2ZWxvY2l0eVthZEF4aXNdICs9IGFkU2lnbiAqIGFjY2VsZXJhdGlvbiAqIGRlbHRhOyB9CiAgICB9CiAgICBpZiAoZGF0YS53c0VuYWJsZWQpIHsKICAgICAgd3NTaWduID0gZGF0YS53c0ludmVydGVkID8gLTEgOiAxOwogICAgICBpZiAoa2V5cy5LZXlXIHx8IGtleXMuQXJyb3dVcCkgeyB2ZWxvY2l0eVt3c0F4aXNdIC09IHdzU2lnbiAqIGFjY2VsZXJhdGlvbiAqIGRlbHRhOyB9CiAgICAgIGlmIChrZXlzLktleVMgfHwga2V5cy5BcnJvd0Rvd24pIHsgdmVsb2NpdHlbd3NBeGlzXSArPSB3c1NpZ24gKiBhY2NlbGVyYXRpb24gKiBkZWx0YTsgfQogICAgfQogIH0sCgogIGdldE1vdmVtZW50VmVjdG9yOiAoZnVuY3Rpb24gKCkgewogICAgdmFyIGRpcmVjdGlvblZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApOwogICAgdmFyIHJvdGF0aW9uRXVsZXIgPSBuZXcgVEhSRUUuRXVsZXIoMCwgMCwgMCwgJ1lYWicpOwoKICAgIHJldHVybiBmdW5jdGlvbiAoZGVsdGEpIHsKICAgICAgdmFyIHJvdGF0aW9uID0gdGhpcy5lbC5nZXRBdHRyaWJ1dGUoJ3JvdGF0aW9uJyk7CiAgICAgIHZhciB2ZWxvY2l0eSA9IHRoaXMudmVsb2NpdHk7CiAgICAgIHZhciB4Um90YXRpb247CgogICAgICBkaXJlY3Rpb25WZWN0b3IuY29weSh2ZWxvY2l0eSk7CiAgICAgIGRpcmVjdGlvblZlY3Rvci5tdWx0aXBseVNjYWxhcihkZWx0YSk7CgogICAgICAvLyBBYnNvbHV0ZS4KICAgICAgaWYgKCFyb3RhdGlvbikgeyByZXR1cm4gZGlyZWN0aW9uVmVjdG9yOyB9CgogICAgICB4Um90YXRpb24gPSB0aGlzLmRhdGEuZmx5ID8gcm90YXRpb24ueCA6IDA7CgogICAgICAvLyBUcmFuc2Zvcm0gZGlyZWN0aW9uIHJlbGF0aXZlIHRvIGhlYWRpbmcuCiAgICAgIHJvdGF0aW9uRXVsZXIuc2V0KFRIUkVFLk1hdGguZGVnVG9SYWQoeFJvdGF0aW9uKSwgVEhSRUUuTWF0aC5kZWdUb1JhZChyb3RhdGlvbi55KSwgMCk7CiAgICAgIGRpcmVjdGlvblZlY3Rvci5hcHBseUV1bGVyKHJvdGF0aW9uRXVsZXIpOwogICAgICByZXR1cm4gZGlyZWN0aW9uVmVjdG9yOwogICAgfTsKICB9KSgpLAoKICBhdHRhY2hWaXNpYmlsaXR5RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5vbkJsdXIpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5vbkZvY3VzKTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCB0aGlzLm9uVmlzaWJpbGl0eUNoYW5nZSk7CiAgfSwKCiAgcmVtb3ZlVmlzaWJpbGl0eUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIHRoaXMub25CbHVyKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMub25Gb2N1cyk7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgdGhpcy5vblZpc2liaWxpdHlDaGFuZ2UpOwogIH0sCgogIGF0dGFjaEtleUV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMub25LZXlEb3duKTsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMub25LZXlVcCk7CiAgfSwKCiAgcmVtb3ZlS2V5RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5vbktleURvd24pOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5vbktleVVwKTsKICB9LAoKICBvbkJsdXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMucGF1c2UoKTsKICB9LAoKICBvbkZvY3VzOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnBsYXkoKTsKICB9LAoKICBvblZpc2liaWxpdHlDaGFuZ2U6IGZ1bmN0aW9uICgpIHsKICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHsKICAgICAgdGhpcy5vbkJsdXIoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMub25Gb2N1cygpOwogICAgfQogIH0sCgogIG9uS2V5RG93bjogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB2YXIgY29kZTsKICAgIGlmICghc2hvdWxkQ2FwdHVyZUtleUV2ZW50KGV2ZW50KSkgeyByZXR1cm47IH0KICAgIGNvZGUgPSBldmVudC5jb2RlIHx8IEtFWUNPREVfVE9fQ09ERVtldmVudC5rZXlDb2RlXTsKICAgIGlmIChLRVlTLmluZGV4T2YoY29kZSkgIT09IC0xKSB7IHRoaXMua2V5c1tjb2RlXSA9IHRydWU7IH0KICB9LAoKICBvbktleVVwOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBjb2RlOwogICAgY29kZSA9IGV2ZW50LmNvZGUgfHwgS0VZQ09ERV9UT19DT0RFW2V2ZW50LmtleUNvZGVdOwogICAgZGVsZXRlIHRoaXMua2V5c1tjb2RlXTsKICB9Cn0pOwoKZnVuY3Rpb24gaXNFbXB0eU9iamVjdCAoa2V5cykgewogIHZhciBrZXk7CiAgZm9yIChrZXkgaW4ga2V5cykgeyByZXR1cm4gZmFsc2U7IH0KICByZXR1cm4gdHJ1ZTsKfQoKfSx7Ii4uL2NvbnN0YW50cyI6OTgsIi4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy8iOjE3OX1dLDk3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyogZ2xvYmFsIFRIUkVFICovCnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4uL2NvcmUvY29tcG9uZW50JykucmVnaXN0ZXJDb21wb25lbnQ7CnZhciBiaW5kID0gX2RlcmVxXygnLi4vdXRpbHMvYmluZCcpOwoKdmFyIHRyYWNrZWRDb250cm9sc1V0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvdHJhY2tlZC1jb250cm9scycpOwp2YXIgY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwID0gdHJhY2tlZENvbnRyb2xzVXRpbHMuY2hlY2tDb250cm9sbGVyUHJlc2VudEFuZFNldHVwOwp2YXIgZW1pdElmQXhlc0NoYW5nZWQgPSB0cmFja2VkQ29udHJvbHNVdGlscy5lbWl0SWZBeGVzQ2hhbmdlZDsKdmFyIG9uQnV0dG9uRXZlbnQgPSB0cmFja2VkQ29udHJvbHNVdGlscy5vbkJ1dHRvbkV2ZW50OwoKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7Cgp2YXIgZGVidWcgPSB1dGlscy5kZWJ1ZygnY29tcG9uZW50czp3aW5kb3dzLW1vdGlvbi1jb250cm9sczpkZWJ1ZycpOwp2YXIgd2FybiA9IHV0aWxzLmRlYnVnKCdjb21wb25lbnRzOndpbmRvd3MtbW90aW9uLWNvbnRyb2xzOndhcm4nKTsKCnZhciBERUZBVUxUX0hBTkRFRE5FU1MgPSBfZGVyZXFfKCcuLi9jb25zdGFudHMnKS5ERUZBVUxUX0hBTkRFRE5FU1M7Cgp2YXIgTU9ERUxfQkFTRV9VUkwgPSAnaHR0cHM6Ly9jZG4uYWZyYW1lLmlvL2NvbnRyb2xsZXJzL21pY3Jvc29mdC8nOwp2YXIgTU9ERUxfRklMRU5BTUVTID0geyBsZWZ0OiAnbGVmdC5nbGInLCByaWdodDogJ3JpZ2h0LmdsYicsIGRlZmF1bHQ6ICd1bml2ZXJzYWwuZ2xiJyB9OwoKdmFyIEdBTUVQQURfSURfUFJFRklYID0gJ1NwYXRpYWwgQ29udHJvbGxlciAoU3BhdGlhbCBJbnRlcmFjdGlvbiBTb3VyY2UpICc7CnZhciBHQU1FUEFEX0lEX1BBVFRFUk4gPSAvKFswLTlhLXpBLVpdKy1bMC05YS16QS1aXSspJC87CgovKioKICogV2luZG93cyBNb3Rpb24gQ29udHJvbGxlciBjb250cm9scy4KICogSW50ZXJmYWNlIHdpdGggV2luZG93cyBNb3Rpb24gQ29udHJvbGxlciBjb250cm9sbGVycyBhbmQgbWFwIEdhbWVwYWQgZXZlbnRzIHRvCiAqIGNvbnRyb2xsZXIgYnV0dG9uczogdHJhY2twYWQsIHRyaWdnZXIsIGdyaXAsIG1lbnUsIHRodW1ic3RpY2sKICogTG9hZCBhIGNvbnRyb2xsZXIgbW9kZWwgYW5kIHRyYW5zZm9ybSB0aGUgcHJlc3NlZCBidXR0b25zLgogKi8KbW9kdWxlLmV4cG9ydHMuQ29tcG9uZW50ID0gcmVnaXN0ZXJDb21wb25lbnQoJ3dpbmRvd3MtbW90aW9uLWNvbnRyb2xzJywgewogIHNjaGVtYTogewogICAgaGFuZDoge2RlZmF1bHQ6IERFRkFVTFRfSEFOREVETkVTU30sCiAgICAvLyBJdCBpcyBwb3NzaWJsZSB0byBoYXZlIG11bHRpcGxlIHBhaXJzIG9mIGNvbnRyb2xsZXJzIGF0dGFjaGVkIChhIHBhaXIgaGFzIGJvdGggbGVmdCBhbmQgcmlnaHQpLgogICAgLy8gU2V0IHRoaXMgdG8gMSB0byB1c2UgYSBjb250cm9sbGVyIGZyb20gdGhlIHNlY29uZCBwYWlyLCAyIGZyb20gdGhlIHRoaXJkIHBhaXIsIGV0Yy4KICAgIHBhaXI6IHtkZWZhdWx0OiAwfSwKICAgIC8vIElmIHRydWUsIGxvYWRzIHRoZSBjb250cm9sbGVyIGdsVEYgYXNzZXQuCiAgICBtb2RlbDoge2RlZmF1bHQ6IHRydWV9LAogICAgLy8gSWYgdHJ1ZSwgd2lsbCBoaWRlIHRoZSBtb2RlbCBmcm9tIHRoZSBzY2VuZSBpZiBubyBtYXRjaGluZyBnYW1lcGFkIChiYXNlZCBvbiBJRCAmIGhhbmQpIGlzIGNvbm5lY3RlZC4KICAgIGhpZGVEaXNjb25uZWN0ZWQ6IHtkZWZhdWx0OiB0cnVlfQogIH0sCgogIG1hcHBpbmc6IHsKICAgIC8vIEEtRnJhbWUgc3BlY2lmaWMgc2VtYW50aWMgYXhpcyBuYW1lcwogICAgYXhlczogeyd0aHVtYnN0aWNrJzogWzAsIDFdLCAndHJhY2twYWQnOiBbMiwgM119LAogICAgLy8gQS1GcmFtZSBzcGVjaWZpYyBzZW1hbnRpYyBidXR0b24gbmFtZXMKICAgIGJ1dHRvbnM6IFsndGh1bWJzdGljaycsICd0cmlnZ2VyJywgJ2dyaXAnLCAnbWVudScsICd0cmFja3BhZCddLAogICAgLy8gQSBtYXBwaW5nIG9mIHRoZSBzZW1hbnRpYyBuYW1lIHRvIG5vZGUgbmFtZSBpbiB0aGUgZ2xURiBtb2RlbCBmaWxlLAogICAgLy8gdGhhdCBzaG91bGQgYmUgdHJhbnNmb3JtZWQgYnkgYXhpcyB2YWx1ZS4KICAgIC8vIFRoaXMgYXJyYXkgbWlycm9ycyB0aGUgYnJvd3NlciBHYW1lcGFkLmF4ZXMgYXJyYXksIHN1Y2ggdGhhdAogICAgLy8gdGhlIG1lc2ggY29ycmVzcG9uZGluZyB0byBheGlzIDAgaXMgaW4gdGhpcyBhcnJheSBpbmRleCAwLgogICAgYXhpc01lc2hOYW1lczogWwogICAgICAnVEhVTUJTVElDS19YJywKICAgICAgJ1RIVU1CU1RJQ0tfWScsCiAgICAgICdUT1VDSFBBRF9UT1VDSF9YJywKICAgICAgJ1RPVUNIUEFEX1RPVUNIX1knCiAgICBdLAogICAgLy8gQSBtYXBwaW5nIG9mIHRoZSBzZW1hbnRpYyBuYW1lIHRvIGJ1dHRvbiBub2RlIG5hbWUgaW4gdGhlIGdsVEYgbW9kZWwgZmlsZSwKICAgIC8vIHRoYXQgc2hvdWxkIGJlIHRyYW5zZm9ybWVkIGJ5IGJ1dHRvbiB2YWx1ZS4KICAgIGJ1dHRvbk1lc2hOYW1lczogewogICAgICAndHJpZ2dlcic6ICdTRUxFQ1QnLAogICAgICAnbWVudSc6ICdNRU5VJywKICAgICAgJ2dyaXAnOiAnR1JBU1AnLAogICAgICAndGh1bWJzdGljayc6ICdUSFVNQlNUSUNLX1BSRVNTJywKICAgICAgJ3RyYWNrcGFkJzogJ1RPVUNIUEFEX1BSRVNTJwogICAgfSwKICAgIHBvaW50aW5nUG9zZU1lc2hOYW1lOiAnUE9JTlRJTkdfUE9TRScKICB9LAoKICBiaW5kTWV0aG9kczogZnVuY3Rpb24gKCkgewogICAgdGhpcy5vbk1vZGVsRXJyb3IgPSBiaW5kKHRoaXMub25Nb2RlbEVycm9yLCB0aGlzKTsKICAgIHRoaXMub25Nb2RlbExvYWRlZCA9IGJpbmQodGhpcy5vbk1vZGVsTG9hZGVkLCB0aGlzKTsKICAgIHRoaXMub25Db250cm9sbGVyc1VwZGF0ZSA9IGJpbmQodGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCB0aGlzKTsKICAgIHRoaXMuY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50ID0gYmluZCh0aGlzLmNoZWNrSWZDb250cm9sbGVyUHJlc2VudCwgdGhpcyk7CiAgICB0aGlzLm9uQXhpc01vdmVkID0gYmluZCh0aGlzLm9uQXhpc01vdmVkLCB0aGlzKTsKICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgdGhpcy5vbkJ1dHRvbkNoYW5nZWQgPSBiaW5kKHRoaXMub25CdXR0b25DaGFuZ2VkLCB0aGlzKTsKICAgIHRoaXMub25CdXR0b25Eb3duID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICdkb3duJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVXAgPSBmdW5jdGlvbiAoZXZ0KSB7IG9uQnV0dG9uRXZlbnQoZXZ0LmRldGFpbC5pZCwgJ3VwJywgc2VsZik7IH07CiAgICB0aGlzLm9uQnV0dG9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uIChldnQpIHsgb25CdXR0b25FdmVudChldnQuZGV0YWlsLmlkLCAndG91Y2hzdGFydCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkJ1dHRvblRvdWNoRW5kID0gZnVuY3Rpb24gKGV2dCkgeyBvbkJ1dHRvbkV2ZW50KGV2dC5kZXRhaWwuaWQsICd0b3VjaGVuZCcsIHNlbGYpOyB9OwogICAgdGhpcy5vbkNvbnRyb2xsZXJDb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7IHNlbGYuc2V0TW9kZWxWaXNpYmlsaXR5KHRydWUpOyB9OwogICAgdGhpcy5vbkNvbnRyb2xsZXJEaXNjb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7IHNlbGYuc2V0TW9kZWxWaXNpYmlsaXR5KGZhbHNlKTsgfTsKICAgIHRoaXMuY29udHJvbGxlclByZXNlbnQgPSBmYWxzZTsKICAgIHRoaXMubGFzdENvbnRyb2xsZXJDaGVjayA9IDA7CiAgICB0aGlzLnByZXZpb3VzQnV0dG9uVmFsdWVzID0ge307CiAgICB0aGlzLmJpbmRNZXRob2RzKCk7CgogICAgLy8gQ2FjaGUgZm9yIHN1Ym1lc2hlcyB0aGF0IHdlIGhhdmUgbG9va2VkIHVwIGJ5IG5hbWUuCiAgICB0aGlzLmxvYWRlZE1lc2hJbmZvID0gewogICAgICBidXR0b25NZXNoZXM6IG51bGwsCiAgICAgIGF4aXNNZXNoZXM6IG51bGwKICAgIH07CgogICAgLy8gUG9pbnRpbmcgcG9zZXMKICAgIHRoaXMucmF5T3JpZ2luID0gewogICAgICBvcmlnaW46IG5ldyBUSFJFRS5WZWN0b3IzKCksCiAgICAgIGRpcmVjdGlvbjogbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgLTEpLAogICAgICBjcmVhdGVkRnJvbU1lc2g6IGZhbHNlCiAgICB9OwoKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRyb2xsZXJjb25uZWN0ZWQnLCB0aGlzLm9uQ29udHJvbGxlckNvbm5lY3RlZCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyZGlzY29ubmVjdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJEaXNjb25uZWN0ZWQpOwogIH0sCgogIGFkZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZWwgPSB0aGlzLmVsOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYnV0dG9uY2hhbmdlZCcsIHRoaXMub25CdXR0b25DaGFuZ2VkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2J1dHRvbmRvd24nLCB0aGlzLm9uQnV0dG9uRG93bik7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdidXR0b251cCcsIHRoaXMub25CdXR0b25VcCk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vbkJ1dHRvblRvdWNoU3RhcnQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLm9uQnV0dG9uVG91Y2hFbmQpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignYXhpc21vdmUnLCB0aGlzLm9uQXhpc01vdmVkKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vZGVsLWVycm9yJywgdGhpcy5vbk1vZGVsRXJyb3IpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbW9kZWwtbG9hZGVkJywgdGhpcy5vbk1vZGVsTG9hZGVkKTsKICAgIHRoaXMuY29udHJvbGxlckV2ZW50c0FjdGl2ZSA9IHRydWU7CiAgfSwKCiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdidXR0b25jaGFuZ2VkJywgdGhpcy5vbkJ1dHRvbkNoYW5nZWQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYnV0dG9uZG93bicsIHRoaXMub25CdXR0b25Eb3duKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2J1dHRvbnVwJywgdGhpcy5vbkJ1dHRvblVwKTsKICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uQnV0dG9uVG91Y2hTdGFydCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25CdXR0b25Ub3VjaEVuZCk7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdheGlzbW92ZScsIHRoaXMub25BeGlzTW92ZWQpOwogICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW9kZWwtZXJyb3InLCB0aGlzLm9uTW9kZWxFcnJvcik7CiAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb2RlbC1sb2FkZWQnLCB0aGlzLm9uTW9kZWxMb2FkZWQpOwogICAgdGhpcy5jb250cm9sbGVyRXZlbnRzQWN0aXZlID0gZmFsc2U7CiAgfSwKCiAgY2hlY2tJZkNvbnRyb2xsZXJQcmVzZW50OiBmdW5jdGlvbiAoKSB7CiAgICBjaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAodGhpcywgR0FNRVBBRF9JRF9QUkVGSVgsIHsKICAgICAgaGFuZDogdGhpcy5kYXRhLmhhbmQsCiAgICAgIGluZGV4OiB0aGlzLmRhdGEucGFpcgogICAgfSk7CiAgfSwKCiAgcGxheTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICAgIHRoaXMuYWRkQ29udHJvbGxlcnNVcGRhdGVMaXN0ZW5lcigpOwogIH0sCgogIHBhdXNlOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICB0aGlzLnJlbW92ZUNvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXIoKTsKICB9LAoKICB1cGRhdGVDb250cm9sbGVyTW9kZWw6IGZ1bmN0aW9uICgpIHsKICAgIC8vIElmIHdlIGRvIG5vdCB3YW50IHRvIGxvYWQgYSBtb2RlbCwgb3IsIGhhdmUgYWxyZWFkeSBsb2FkZWQgdGhlIG1vZGVsLCBlbWl0IHRoZSBjb250cm9sbGVybW9kZWxyZWFkeSBldmVudC4KICAgIGlmICghdGhpcy5kYXRhLm1vZGVsIHx8IHRoaXMucmF5T3JpZ2luLmNyZWF0ZWRGcm9tTWVzaCkgewogICAgICB0aGlzLm1vZGVsUmVhZHkoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBzb3VyY2VVcmwgPSB0aGlzLmNyZWF0ZUNvbnRyb2xsZXJNb2RlbFVybCgpOwogICAgdGhpcy5sb2FkTW9kZWwoc291cmNlVXJsKTsKICB9LAoKICAvKioKICAgKiBIZWxwZXIgZnVuY3Rpb24gdGhhdCBjb25zdHJ1Y3RzIGEgVVJMIGZyb20gdGhlIGNvbnRyb2xsZXIgSUQgc3VmZml4LCBmb3IgZnV0dXJlIHByb29mZWQKICAgKiBhcnQgYXNzZXRzLgogICAqLwogIGNyZWF0ZUNvbnRyb2xsZXJNb2RlbFVybDogZnVuY3Rpb24gKGZvcmNlRGVmYXVsdCkgewogICAgLy8gRGV0ZXJtaW5lIHRoZSBkZXZpY2Ugc3BlY2lmaWMgZm9sZGVyIGJhc2VkIG9uIHRoZSBJRCBzdWZmaXgKICAgIHZhciB0cmFja2VkQ29udHJvbHNDb21wb25lbnQgPSB0aGlzLmVsLmNvbXBvbmVudHNbJ3RyYWNrZWQtY29udHJvbHMnXTsKICAgIHZhciBjb250cm9sbGVyID0gdHJhY2tlZENvbnRyb2xzQ29tcG9uZW50ID8gdHJhY2tlZENvbnRyb2xzQ29tcG9uZW50LmNvbnRyb2xsZXIgOiBudWxsOwogICAgdmFyIGRldmljZSA9ICdkZWZhdWx0JzsKICAgIHZhciBoYW5kID0gdGhpcy5kYXRhLmhhbmQ7CiAgICB2YXIgZmlsZW5hbWU7CgogICAgaWYgKGNvbnRyb2xsZXIpIHsKICAgICAgLy8gUmVhZCBoYW5kIGRpcmVjdGx5IGZyb20gdGhlIGNvbnRyb2xsZXIsIHJhdGhlciB0aGFuIHRoaXMuZGF0YSwgYXMgaW4gdGhlIGNhc2UgdGhhdCB0aGUgY29udHJvbGxlcgogICAgICAvLyBpcyB1bmhhbmRlZCB0aGlzLmRhdGEgd2lsbCBzdGlsbCBoYXZlICdsZWZ0JyBvciAncmlnaHQnIChkZXBlbmRpbmcgb24gd2hhdCB0aGUgdXNlciBpbnNlcnRlZCBpbiB0byB0aGUgc2NlbmUpLgogICAgICAvLyBJbiB0aGlzIGNhc2UsIHdlIHdhbnQgdG8gbG9hZCB0aGUgdW5pdmVyc2FsIG1vZGVsLCBzbyBuZWVkIHRvIGdldCB0aGUgJycgZnJvbSB0aGUgY29udHJvbGxlci4KICAgICAgaGFuZCA9IGNvbnRyb2xsZXIuaGFuZDsKCiAgICAgIGlmICghZm9yY2VEZWZhdWx0KSB7CiAgICAgICAgdmFyIG1hdGNoID0gY29udHJvbGxlci5pZC5tYXRjaChHQU1FUEFEX0lEX1BBVFRFUk4pOwogICAgICAgIGRldmljZSA9ICgobWF0Y2ggJiYgbWF0Y2hbMF0pIHx8IGRldmljZSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBIYW5kCiAgICBmaWxlbmFtZSA9IE1PREVMX0ZJTEVOQU1FU1toYW5kXSB8fCBNT0RFTF9GSUxFTkFNRVMuZGVmYXVsdDsKCiAgICAvLyBGaW5hbCB1cmwKICAgIHJldHVybiBNT0RFTF9CQVNFX1VSTCArIGRldmljZSArICcvJyArIGZpbGVuYW1lOwogIH0sCgogIGluamVjdFRyYWNrZWRDb250cm9sczogZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CiAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgndHJhY2tlZC1jb250cm9scycsIHsKICAgICAgaWRQcmVmaXg6IEdBTUVQQURfSURfUFJFRklYLAogICAgICBjb250cm9sbGVyOiBkYXRhLnBhaXIsCiAgICAgIGhhbmQ6IGRhdGEuaGFuZCwKICAgICAgYXJtTW9kZWw6IGZhbHNlCiAgICB9KTsKCiAgICB0aGlzLnVwZGF0ZUNvbnRyb2xsZXJNb2RlbCgpOwogIH0sCgogIGFkZENvbnRyb2xsZXJzVXBkYXRlTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZWwuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyc3VwZGF0ZWQnLCB0aGlzLm9uQ29udHJvbGxlcnNVcGRhdGUsIGZhbHNlKTsKICB9LAoKICByZW1vdmVDb250cm9sbGVyc1VwZGF0ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLnNjZW5lRWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29udHJvbGxlcnN1cGRhdGVkJywgdGhpcy5vbkNvbnRyb2xsZXJzVXBkYXRlLCBmYWxzZSk7CiAgfSwKCiAgb25Db250cm9sbGVyc1VwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jaGVja0lmQ29udHJvbGxlclByZXNlbnQoKTsKICB9LAoKICBvbk1vZGVsRXJyb3I6IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBkZWZhdWx0VXJsID0gdGhpcy5jcmVhdGVDb250cm9sbGVyTW9kZWxVcmwodHJ1ZSk7CiAgICBpZiAoZXZ0LmRldGFpbC5zcmMgIT09IGRlZmF1bHRVcmwpIHsKICAgICAgd2FybignRmFpbGVkIHRvIGxvYWQgY29udHJvbGxlciBtb2RlbCBmb3IgZGV2aWNlLCBhdHRlbXB0aW5nIHRvIGxvYWQgZGVmYXVsdC4nKTsKICAgICAgdGhpcy5sb2FkTW9kZWwoZGVmYXVsdFVybCk7CiAgICB9IGVsc2UgewogICAgICB3YXJuKCdGYWlsZWQgdG8gbG9hZCBkZWZhdWx0IGNvbnRyb2xsZXIgbW9kZWwuJyk7CiAgICB9CiAgfSwKCiAgbG9hZE1vZGVsOiBmdW5jdGlvbiAodXJsKSB7CiAgICAvLyBUaGUgbW9kZWwgaXMgbG9hZGVkIGJ5IHRoZSBnbHRmLW1vZGVsIGNvbXBvZW50IHdoZW4gdGhpcyBhdHRyaWJ1dGUgaXMgaW5pdGlhbGx5IHNldCwKICAgIC8vIHJlbW92ZWQgYW5kIHJlLWxvYWRlZCBpZiB0aGUgZ2l2ZW4gdXJsIGNoYW5nZXMuCiAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnZ2x0Zi1tb2RlbCcsICd1cmwoJyArIHVybCArICcpJyk7CiAgfSwKCiAgb25Nb2RlbExvYWRlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIHJvb3ROb2RlID0gdGhpcy5jb250cm9sbGVyTW9kZWwgPSBldnQuZGV0YWlsLm1vZGVsOwogICAgdmFyIGxvYWRlZE1lc2hJbmZvID0gdGhpcy5sb2FkZWRNZXNoSW5mbzsKICAgIHZhciBpOwogICAgdmFyIG1lc2hOYW1lOwogICAgdmFyIG1lc2g7CiAgICB2YXIgbWVzaEluZm87CgogICAgZGVidWcoJ1Byb2Nlc3NpbmcgbW9kZWwnKTsKCiAgICAvLyBSZXNldCB0aGUgY2FjaGVzCiAgICBsb2FkZWRNZXNoSW5mby5idXR0b25NZXNoZXMgPSB7fTsKICAgIGxvYWRlZE1lc2hJbmZvLmF4aXNNZXNoZXMgPSB7fTsKCiAgICAvLyBDYWNoZSBvdXIgbWVzaGVzIHNvIHdlIGFyZW4ndCB0cmF2ZXJzaW5nIHRoZSBoaWVyYXJjaHkgcGVyIGZyYW1lCiAgICBpZiAocm9vdE5vZGUpIHsKICAgICAgLy8gQnV0dG9uIE1lc2hlcwogICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5tYXBwaW5nLmJ1dHRvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBtZXNoTmFtZSA9IHRoaXMubWFwcGluZy5idXR0b25NZXNoTmFtZXNbdGhpcy5tYXBwaW5nLmJ1dHRvbnNbaV1dOwogICAgICAgIGlmICghbWVzaE5hbWUpIHsKICAgICAgICAgIGRlYnVnKCdTa2lwcGluZyB1bmtub3duIGJ1dHRvbiBhdCBpbmRleDogJyArIGkgKyAnIHdpdGggbWFwcGVkIG5hbWU6ICcgKyB0aGlzLm1hcHBpbmcuYnV0dG9uc1tpXSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIG1lc2ggPSByb290Tm9kZS5nZXRPYmplY3RCeU5hbWUobWVzaE5hbWUpOwogICAgICAgIGlmICghbWVzaCkgewogICAgICAgICAgd2FybignTWlzc2luZyBidXR0b24gbWVzaCB3aXRoIG5hbWU6ICcgKyBtZXNoTmFtZSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIG1lc2hJbmZvID0gewogICAgICAgICAgaW5kZXg6IGksCiAgICAgICAgICB2YWx1ZTogZ2V0SW1tZWRpYXRlQ2hpbGRCeU5hbWUobWVzaCwgJ1ZBTFVFJyksCiAgICAgICAgICBwcmVzc2VkOiBnZXRJbW1lZGlhdGVDaGlsZEJ5TmFtZShtZXNoLCAnUFJFU1NFRCcpLAogICAgICAgICAgdW5wcmVzc2VkOiBnZXRJbW1lZGlhdGVDaGlsZEJ5TmFtZShtZXNoLCAnVU5QUkVTU0VEJykKICAgICAgICB9OwogICAgICAgIGlmIChtZXNoSW5mby52YWx1ZSAmJiBtZXNoSW5mby5wcmVzc2VkICYmIG1lc2hJbmZvLnVucHJlc3NlZCkgewogICAgICAgICAgbG9hZGVkTWVzaEluZm8uYnV0dG9uTWVzaGVzW3RoaXMubWFwcGluZy5idXR0b25zW2ldXSA9IG1lc2hJbmZvOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBJZiB3ZSBkaWRuJ3QgZmluZCB0aGUgbWVzaCwgaXQgc2ltcGx5IG1lYW5zIHRoaXMgYnV0dG9uIHdvbid0IGhhdmUgdHJhbnNmb3JtcyBhcHBsaWVkIGFzIG1hcHBlZCBidXR0b24gdmFsdWUgY2hhbmdlcy4KICAgICAgICAgIHdhcm4oJ01pc3NpbmcgYnV0dG9uIHN1Ym1lc2ggdW5kZXIgbWVzaCB3aXRoIG5hbWU6ICcgKyBtZXNoTmFtZSArCiAgICAgICAgICAgICcoVkFMVUU6ICcgKyAhIW1lc2hJbmZvLnZhbHVlICsKICAgICAgICAgICAgJywgUFJFU1NFRDogJyArICEhbWVzaEluZm8ucHJlc3NlZCArCiAgICAgICAgICAgICcsIFVOUFJFU1NFRDonICsgISFtZXNoSW5mby51bnByZXNzZWQgKwogICAgICAgICAgICAnKScpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gQXhpcyBNZXNoZXMKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubWFwcGluZy5heGlzTWVzaE5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbWVzaE5hbWUgPSB0aGlzLm1hcHBpbmcuYXhpc01lc2hOYW1lc1tpXTsKICAgICAgICBpZiAoIW1lc2hOYW1lKSB7CiAgICAgICAgICBkZWJ1ZygnU2tpcHBpbmcgdW5rbm93biBheGlzIGF0IGluZGV4OiAnICsgaSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIG1lc2ggPSByb290Tm9kZS5nZXRPYmplY3RCeU5hbWUobWVzaE5hbWUpOwogICAgICAgIGlmICghbWVzaCkgewogICAgICAgICAgd2FybignTWlzc2luZyBheGlzIG1lc2ggd2l0aCBuYW1lOiAnICsgbWVzaE5hbWUpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBtZXNoSW5mbyA9IHsKICAgICAgICAgIGluZGV4OiBpLAogICAgICAgICAgdmFsdWU6IGdldEltbWVkaWF0ZUNoaWxkQnlOYW1lKG1lc2gsICdWQUxVRScpLAogICAgICAgICAgbWluOiBnZXRJbW1lZGlhdGVDaGlsZEJ5TmFtZShtZXNoLCAnTUlOJyksCiAgICAgICAgICBtYXg6IGdldEltbWVkaWF0ZUNoaWxkQnlOYW1lKG1lc2gsICdNQVgnKQogICAgICAgIH07CiAgICAgICAgaWYgKG1lc2hJbmZvLnZhbHVlICYmIG1lc2hJbmZvLm1pbiAmJiBtZXNoSW5mby5tYXgpIHsKICAgICAgICAgIGxvYWRlZE1lc2hJbmZvLmF4aXNNZXNoZXNbaV0gPSBtZXNoSW5mbzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgdGhlIG1lc2gsIGl0IHNpbXBseSBtZWFucyB0aGlzIGF4aXMgd29uJ3QgaGF2ZSB0cmFuc2Zvcm1zIGFwcGxpZWQgYXMgbWFwcGVkIGF4aXMgdmFsdWVzIGNoYW5nZS4KICAgICAgICAgIHdhcm4oJ01pc3NpbmcgYXhpcyBzdWJtZXNoIHVuZGVyIG1lc2ggd2l0aCBuYW1lOiAnICsgbWVzaE5hbWUgKwogICAgICAgICAgICAnKFZBTFVFOiAnICsgISFtZXNoSW5mby52YWx1ZSArCiAgICAgICAgICAgICcsIE1JTjogJyArICEhbWVzaEluZm8ubWluICsKICAgICAgICAgICAgJywgTUFYOicgKyAhIW1lc2hJbmZvLm1heCArCiAgICAgICAgICAgICcpJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNhbGN1bGF0ZVJheU9yaWdpbkZyb21NZXNoKHJvb3ROb2RlKTsKICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBtb2RlbCBoYXMgdG8gYmUgdmlzaWJsZSBvciBub3QuCiAgICAgIHRoaXMuc2V0TW9kZWxWaXNpYmlsaXR5KCk7CiAgICB9CgogICAgZGVidWcoJ01vZGVsIGxvYWQgY29tcGxldGUuJyk7CgogICAgLy8gTG9vayB0aHJvdWdoIG9ubHkgaW1tZWRpYXRlIGNoaWxkcmVuLiBUaGlzIHdpbGwgcmV0dXJuIG51bGwgaWYgbm8gbWVzaCBleGlzdHMgd2l0aCB0aGUgZ2l2ZW4gbmFtZS4KICAgIGZ1bmN0aW9uIGdldEltbWVkaWF0ZUNoaWxkQnlOYW1lIChvYmplY3QzZCwgdmFsdWUpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBvYmplY3QzZC5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgb2JqID0gb2JqZWN0M2QuY2hpbGRyZW5baV07CiAgICAgICAgaWYgKG9iaiAmJiBvYmpbJ25hbWUnXSA9PT0gdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgfSwKCiAgY2FsY3VsYXRlUmF5T3JpZ2luRnJvbU1lc2g6IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgcXVhdGVybmlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICByZXR1cm4gZnVuY3Rpb24gKHJvb3ROb2RlKSB7CiAgICAgIHZhciBtZXNoOwoKICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBwb2ludGVyIHBvc2UgKHVzZWQgZm9yIHJheXMpLCBieSBhcHBseWluZyB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIHRoIFBPSU5URVJfUE9TRSBub2RlCiAgICAgIC8vIGluIHRoZSBnbFRGIChhc3N1bWVzIHRoYXQgcm9vdCBub2RlIGlzIGF0IHdvcmxkIG9yaWdpbikKICAgICAgdGhpcy5yYXlPcmlnaW4ub3JpZ2luLnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy5yYXlPcmlnaW4uZGlyZWN0aW9uLnNldCgwLCAwLCAtMSk7CiAgICAgIHRoaXMucmF5T3JpZ2luLmNyZWF0ZWRGcm9tTWVzaCA9IHRydWU7CgogICAgICAvLyBUcnkgdG8gcmVhZCBQb2ludGluZyBwb3NlIGZyb20gdGhlIHNvdXJjZSBtb2RlbAogICAgICBtZXNoID0gcm9vdE5vZGUuZ2V0T2JqZWN0QnlOYW1lKHRoaXMubWFwcGluZy5wb2ludGluZ1Bvc2VNZXNoTmFtZSk7CiAgICAgIGlmIChtZXNoKSB7CiAgICAgICAgdmFyIHBhcmVudCA9IHJvb3ROb2RlLnBhcmVudDsKCiAgICAgICAgLy8gV2UgbmVlZCB0byByZWFkIHBvc2UgdHJhbnNmb3JtcyBhY2N1bXVsYXRlZCBmcm9tIHRoZSByb290IG9mIHRoZSBnbFRGLCBub3QgdGhlIHNjZW5lLgogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgIHJvb3ROb2RlLnBhcmVudCA9IG51bGw7CiAgICAgICAgICByb290Tm9kZS51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsKICAgICAgICAgIHJvb3ROb2RlLnBhcmVudCA9IHBhcmVudDsKICAgICAgICB9CgogICAgICAgIG1lc2guZ2V0V29ybGRQb3NpdGlvbih0aGlzLnJheU9yaWdpbi5vcmlnaW4pOwogICAgICAgIG1lc2guZ2V0V29ybGRRdWF0ZXJuaW9uKHF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucmF5T3JpZ2luLmRpcmVjdGlvbi5hcHBseVF1YXRlcm5pb24ocXVhdGVybmlvbik7CgogICAgICAgIC8vIFJlY2FsY3VsYXRlIHRoZSB3b3JsZCBtYXRyaWNlcyBub3cgdGhhdCB0aGUgcm9vdE5vZGUgaXMgcmUtYXR0YWNoZWQgdG8gdGhlIHBhcmVudC4KICAgICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgICByb290Tm9kZS51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVidWcoJ01lc2ggZG9lcyBub3QgY29udGFpbiBwb2ludGluZyBvcmlnaW4gZGF0YSwgZGVmYXVsdGluZyB0byBub25lLicpOwogICAgICB9CgogICAgICAvLyBFbWl0IGV2ZW50IHN0YXRpbmcgdGhhdCBvdXIgcG9pbnRpbmcgcmF5IGlzIG5vdyBhY2N1cmF0ZS4KICAgICAgdGhpcy5tb2RlbFJlYWR5KCk7CiAgICB9OwogIH0pKCksCgogIGxlcnBBeGlzVHJhbnNmb3JtOiAoZnVuY3Rpb24gKCkgewogICAgdmFyIHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwogICAgcmV0dXJuIGZ1bmN0aW9uIChheGlzLCBheGlzVmFsdWUpIHsKICAgICAgdmFyIGF4aXNNZXNoSW5mbyA9IHRoaXMubG9hZGVkTWVzaEluZm8uYXhpc01lc2hlc1theGlzXTsKICAgICAgaWYgKCFheGlzTWVzaEluZm8pIHJldHVybjsKCiAgICAgIHZhciBtaW4gPSBheGlzTWVzaEluZm8ubWluOwogICAgICB2YXIgbWF4ID0gYXhpc01lc2hJbmZvLm1heDsKICAgICAgdmFyIHRhcmdldCA9IGF4aXNNZXNoSW5mby52YWx1ZTsKCiAgICAgIC8vIENvbnZlcnQgZnJvbSBnYW1lcGFkIHZhbHVlIHJhbmdlICgtMSB0byArMSkgdG8gbGVycCByYW5nZSAoMCB0byAxKQogICAgICB2YXIgbGVycFZhbHVlID0gYXhpc1ZhbHVlICogMC41ICsgMC41OwogICAgICB0YXJnZXQuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbihxdWF0ZXJuaW9uLmNvcHkobWluLnF1YXRlcm5pb24pLnNsZXJwKG1heC5xdWF0ZXJuaW9uLCBsZXJwVmFsdWUpKTsKICAgICAgdGFyZ2V0LnBvc2l0aW9uLmxlcnBWZWN0b3JzKG1pbi5wb3NpdGlvbiwgbWF4LnBvc2l0aW9uLCBsZXJwVmFsdWUpOwogICAgfTsKICB9KSgpLAoKICBsZXJwQnV0dG9uVHJhbnNmb3JtOiAoZnVuY3Rpb24gKCkgewogICAgdmFyIHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwogICAgcmV0dXJuIGZ1bmN0aW9uIChidXR0b25OYW1lLCBidXR0b25WYWx1ZSkgewogICAgICB2YXIgYnV0dG9uTWVzaEluZm8gPSB0aGlzLmxvYWRlZE1lc2hJbmZvLmJ1dHRvbk1lc2hlc1tidXR0b25OYW1lXTsKICAgICAgaWYgKCFidXR0b25NZXNoSW5mbykgcmV0dXJuOwoKICAgICAgdmFyIG1pbiA9IGJ1dHRvbk1lc2hJbmZvLnVucHJlc3NlZDsKICAgICAgdmFyIG1heCA9IGJ1dHRvbk1lc2hJbmZvLnByZXNzZWQ7CiAgICAgIHZhciB0YXJnZXQgPSBidXR0b25NZXNoSW5mby52YWx1ZTsKCiAgICAgIHRhcmdldC5zZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHF1YXRlcm5pb24uY29weShtaW4ucXVhdGVybmlvbikuc2xlcnAobWF4LnF1YXRlcm5pb24sIGJ1dHRvblZhbHVlKSk7CiAgICAgIHRhcmdldC5wb3NpdGlvbi5sZXJwVmVjdG9ycyhtaW4ucG9zaXRpb24sIG1heC5wb3NpdGlvbiwgYnV0dG9uVmFsdWUpOwogICAgfTsKICB9KSgpLAoKICBtb2RlbFJlYWR5OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmVsLmVtaXQoJ2NvbnRyb2xsZXJtb2RlbHJlYWR5JywgewogICAgICBuYW1lOiAnd2luZG93cy1tb3Rpb24tY29udHJvbHMnLAogICAgICBtb2RlbDogdGhpcy5kYXRhLm1vZGVsLAogICAgICByYXlPcmlnaW46IHRoaXMucmF5T3JpZ2luCiAgICB9KTsKICB9LAoKICBvbkJ1dHRvbkNoYW5nZWQ6IGZ1bmN0aW9uIChldnQpIHsKICAgIHZhciBidXR0b25OYW1lID0gdGhpcy5tYXBwaW5nLmJ1dHRvbnNbZXZ0LmRldGFpbC5pZF07CgogICAgaWYgKGJ1dHRvbk5hbWUpIHsKICAgICAgLy8gVXBkYXRlIHRoZSBidXR0b24gbWVzaCB0cmFuc2Zvcm0KICAgICAgaWYgKHRoaXMubG9hZGVkTWVzaEluZm8gJiYgdGhpcy5sb2FkZWRNZXNoSW5mby5idXR0b25NZXNoZXMpIHsKICAgICAgICB0aGlzLmxlcnBCdXR0b25UcmFuc2Zvcm0oYnV0dG9uTmFtZSwgZXZ0LmRldGFpbC5zdGF0ZS52YWx1ZSk7CiAgICAgIH0KCiAgICAgIC8vIE9ubHkgZW1pdCBldmVudHMgZm9yIGJ1dHRvbnMgdGhhdCB3ZSBrbm93IGhvdyB0byBtYXAgZnJvbSBpbmRleCB0byBuYW1lCiAgICAgIHRoaXMuZWwuZW1pdChidXR0b25OYW1lICsgJ2NoYW5nZWQnLCBldnQuZGV0YWlsLnN0YXRlKTsKICAgIH0KICB9LAoKICBvbkF4aXNNb3ZlZDogZnVuY3Rpb24gKGV2dCkgewogICAgdmFyIG51bUF4ZXMgPSB0aGlzLm1hcHBpbmcuYXhpc01lc2hOYW1lcy5sZW5ndGg7CgogICAgLy8gT25seSBhdHRlbXB0IHRvIHVwZGF0ZSBtZXNoZXMgaWYgd2UgaGF2ZSB2YWxpZCBkYXRhLgogICAgaWYgKHRoaXMubG9hZGVkTWVzaEluZm8gJiYgdGhpcy5sb2FkZWRNZXNoSW5mby5heGlzTWVzaGVzKSB7CiAgICAgIGZvciAodmFyIGF4aXMgPSAwOyBheGlzIDwgbnVtQXhlczsgYXhpcysrKSB7CiAgICAgICAgLy8gVXBkYXRlIHRoZSBidXR0b24gbWVzaCB0cmFuc2Zvcm0KICAgICAgICB0aGlzLmxlcnBBeGlzVHJhbnNmb3JtKGF4aXMsIGV2dC5kZXRhaWwuYXhpc1theGlzXSB8fCAwLjApOwogICAgICB9CiAgICB9CgogICAgZW1pdElmQXhlc0NoYW5nZWQodGhpcywgdGhpcy5tYXBwaW5nLmF4ZXMsIGV2dCk7CiAgfSwKCiAgc2V0TW9kZWxWaXNpYmlsaXR5OiBmdW5jdGlvbiAodmlzaWJsZSkgewogICAgdmFyIG1vZGVsID0gdGhpcy5lbC5nZXRPYmplY3QzRCgnbWVzaCcpOwogICAgdmlzaWJsZSA9IHZpc2libGUgIT09IHVuZGVmaW5lZCA/IHZpc2libGUgOiB0aGlzLm1vZGVsVmlzaWJsZTsKICAgIHRoaXMubW9kZWxWaXNpYmxlID0gdmlzaWJsZTsKICAgIGlmICghbW9kZWwpIHsgcmV0dXJuOyB9CiAgICBtb2RlbC52aXNpYmxlID0gdmlzaWJsZTsKICB9Cn0pOwoKfSx7Ii4uL2NvbnN0YW50cyI6OTgsIi4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uL3V0aWxzLyI6MTc5LCIuLi91dGlscy9iaW5kIjoxNzMsIi4uL3V0aWxzL3RyYWNrZWQtY29udHJvbHMiOjE4N31dLDk4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7CiAgQUZSQU1FX0lOSkVDVEVEOiAnYWZyYW1lLWluamVjdGVkJywKICBERUZBVUxUX0NBTUVSQV9IRUlHSFQ6IDEuNiwKICBERUZBVUxUX0hBTkRFRE5FU1M6ICdyaWdodCcsCiAga2V5Ym9hcmRldmVudDogX2RlcmVxXygnLi9rZXlib2FyZGV2ZW50JykKfTsKCn0seyIuL2tleWJvYXJkZXZlbnQiOjk5fV0sOTk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsKICAvLyBUaW55IEtleWJvYXJkRXZlbnQuY29kZSBwb2x5ZmlsbC4KICBLRVlDT0RFX1RPX0NPREU6IHsKICAgICczOCc6ICdBcnJvd1VwJywKICAgICczNyc6ICdBcnJvd0xlZnQnLAogICAgJzQwJzogJ0Fycm93RG93bicsCiAgICAnMzknOiAnQXJyb3dSaWdodCcsCiAgICAnODcnOiAnS2V5VycsCiAgICAnNjUnOiAnS2V5QScsCiAgICAnODMnOiAnS2V5UycsCiAgICAnNjgnOiAnS2V5RCcKICB9Cn07Cgp9LHt9XSwxMDA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgQU5vZGUgPSBfZGVyZXFfKCcuL2Etbm9kZScpOwp2YXIgYmluZCA9IF9kZXJlcV8oJy4uL3V0aWxzL2JpbmQnKTsKdmFyIGRlYnVnID0gX2RlcmVxXygnLi4vdXRpbHMvZGVidWcnKTsKdmFyIHJlZ2lzdGVyRWxlbWVudCA9IF9kZXJlcV8oJy4vYS1yZWdpc3Rlci1lbGVtZW50JykucmVnaXN0ZXJFbGVtZW50Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKCnZhciBmaWxlTG9hZGVyID0gbmV3IFRIUkVFLkZpbGVMb2FkZXIoKTsKdmFyIHdhcm4gPSBkZWJ1ZygnY29yZTphLWFzc2V0czp3YXJuJyk7CgovKioKICogQXNzZXQgbWFuYWdlbWVudCBzeXN0ZW0uIEhhbmRsZXMgYmxvY2tpbmcgb24gYXNzZXQgbG9hZGluZy4KICovCm1vZHVsZS5leHBvcnRzID0gcmVnaXN0ZXJFbGVtZW50KCdhLWFzc2V0cycsIHsKICBwcm90b3R5cGU6IE9iamVjdC5jcmVhdGUoQU5vZGUucHJvdG90eXBlLCB7CiAgICBjcmVhdGVkQ2FsbGJhY2s6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmlzQXNzZXRzID0gdHJ1ZTsKICAgICAgICB0aGlzLmZpbGVMb2FkZXIgPSBmaWxlTG9hZGVyOwogICAgICAgIHRoaXMudGltZW91dCA9IG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgYXR0YWNoZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgbG9hZGVkID0gW107CiAgICAgICAgdmFyIG1lZGlhRWw7CiAgICAgICAgdmFyIG1lZGlhRWxzOwogICAgICAgIHZhciBpbWdFbDsKICAgICAgICB2YXIgaW1nRWxzOwogICAgICAgIHZhciB0aW1lb3V0OwoKICAgICAgICBpZiAoIXRoaXMucGFyZW50Tm9kZS5pc1NjZW5lKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJzxhLWFzc2V0cz4gbXVzdCBiZSBhIGNoaWxkIG9mIGEgPGEtc2NlbmU+LicpOwogICAgICAgIH0KCiAgICAgICAgLy8gV2FpdCBmb3IgPGltZz5zLgogICAgICAgIGltZ0VscyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW1nJyk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGltZ0Vscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaW1nRWwgPSBmaXhVcE1lZGlhRWxlbWVudChpbWdFbHNbaV0pOwogICAgICAgICAgbG9hZGVkLnB1c2gobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAvLyBTZXQgaW4gY2FjaGUgYmVjYXVzZSB3ZSB3b24ndCBiZSBuZWVkaW5nIHRvIGNhbGwgdGhyZWUuanMgbG9hZGVyIGlmIHdlIGhhdmUuCiAgICAgICAgICAgIC8vIGEgbG9hZGVkIG1lZGlhIGVsZW1lbnQuCiAgICAgICAgICAgIFRIUkVFLkNhY2hlLmZpbGVzW2ltZ0Vsc1tpXS5nZXRBdHRyaWJ1dGUoJ3NyYycpXSA9IGltZ0VsOwogICAgICAgICAgICBpbWdFbC5vbmxvYWQgPSByZXNvbHZlOwogICAgICAgICAgICBpbWdFbC5vbmVycm9yID0gcmVqZWN0OwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gV2FpdCBmb3IgPGF1ZGlvPnMgYW5kIDx2aWRlbz5zLgogICAgICAgIG1lZGlhRWxzID0gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdhdWRpbywgdmlkZW8nKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbWVkaWFFbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG1lZGlhRWwgPSBmaXhVcE1lZGlhRWxlbWVudChtZWRpYUVsc1tpXSk7CiAgICAgICAgICBpZiAoIW1lZGlhRWwuc3JjICYmICFtZWRpYUVsLnNyY09iamVjdCkgewogICAgICAgICAgICB3YXJuKCdBdWRpby92aWRlbyBhc3NldCBoYXMgbmVpdGhlciBgc3JjYCBub3IgYHNyY09iamVjdGAgYXR0cmlidXRlcy4nKTsKICAgICAgICAgIH0KICAgICAgICAgIGxvYWRlZC5wdXNoKG1lZGlhRWxlbWVudExvYWRlZChtZWRpYUVsKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBUcmlnZ2VyIGxvYWRlZCBmb3Igc2NlbmUgdG8gc3RhcnQgcmVuZGVyaW5nLgogICAgICAgIFByb21pc2UuYWxsKGxvYWRlZCkudGhlbihiaW5kKHRoaXMubG9hZCwgdGhpcykpOwoKICAgICAgICAvLyBUaW1lb3V0IHRvIHN0YXJ0IGxvYWRpbmcgYW55d2F5cy4KICAgICAgICB0aW1lb3V0ID0gcGFyc2VJbnQodGhpcy5nZXRBdHRyaWJ1dGUoJ3RpbWVvdXQnKSwgMTApIHx8IDMwMDA7CiAgICAgICAgdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoc2VsZi5oYXNMb2FkZWQpIHsgcmV0dXJuOyB9CiAgICAgICAgICB3YXJuKCdBc3NldCBsb2FkaW5nIHRpbWVkIG91dCBpbiAnLCB0aW1lb3V0LCAnbXMnKTsKICAgICAgICAgIHNlbGYuZW1pdCgndGltZW91dCcpOwogICAgICAgICAgc2VsZi5sb2FkKCk7CiAgICAgICAgfSwgdGltZW91dCk7CiAgICAgIH0KICAgIH0sCgogICAgZGV0YWNoZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLnRpbWVvdXQpIHsgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7IH0KICAgICAgfQogICAgfSwKCiAgICBsb2FkOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgQU5vZGUucHJvdG90eXBlLmxvYWQuY2FsbCh0aGlzLCBudWxsLCBmdW5jdGlvbiB3YWl0T25GaWx0ZXIgKGVsKSB7CiAgICAgICAgICByZXR1cm4gZWwuaXNBc3NldEl0ZW0gJiYgZWwuaGFzQXR0cmlidXRlKCdzcmMnKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0pCn0pOwoKLyoqCiAqIFByZWxvYWQgdXNpbmcgWEhSTG9hZGVyIGZvciBhbnkgdHlwZSBvZiBhc3NldC4KICovCnJlZ2lzdGVyRWxlbWVudCgnYS1hc3NldC1pdGVtJywgewogIHByb3RvdHlwZTogT2JqZWN0LmNyZWF0ZShBTm9kZS5wcm90b3R5cGUsIHsKICAgIGNyZWF0ZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuZGF0YSA9IG51bGw7CiAgICAgICAgdGhpcy5pc0Fzc2V0SXRlbSA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgYXR0YWNoZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgc3JjID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ3NyYycpOwogICAgICAgIGZpbGVMb2FkZXIuc2V0UmVzcG9uc2VUeXBlKAogICAgICAgICAgdGhpcy5nZXRBdHRyaWJ1dGUoJ3Jlc3BvbnNlLXR5cGUnKSB8fCBpbmZlclJlc3BvbnNlVHlwZShzcmMpKTsKICAgICAgICBmaWxlTG9hZGVyLmxvYWQoc3JjLCBmdW5jdGlvbiBoYW5kbGVPbkxvYWQgKHJlc3BvbnNlKSB7CiAgICAgICAgICBzZWxmLmRhdGEgPSByZXNwb25zZTsKICAgICAgICAgIC8qCiAgICAgICAgICAgIFdvcmthcm91bmQgZm9yIGEgQ2hyb21lIGJ1Zy4gSWYgYW5vdGhlciBYSFIgaXMgc2VudCB0byB0aGUgc2FtZSB1cmwgYmVmb3JlIHRoZQogICAgICAgICAgICBwcmV2aW91cyBvbmUgY2xvc2VzLCB0aGUgc2Vjb25kIHJlcXVlc3QgbmV2ZXIgZmluaXNoZXMuCiAgICAgICAgICAgIHNldFRpbWVvdXQgZmluaXNoZXMgdGhlIGZpcnN0IHJlcXVlc3QgYW5kIGxldHMgdGhlIGxvZ2ljIHRyaWdnZXJlZCBieSBsb2FkIG9wZW4KICAgICAgICAgICAgc3Vic2VxdWVudCByZXF1ZXN0cy4KICAgICAgICAgICAgc2V0VGltZW91dCBjYW4gYmUgcmVtb3ZlZCBvbmNlIHRoZSBmaXggZm9yIHRoZSBidWcgYmVsb3cgc2hpcHM6CiAgICAgICAgICAgIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTYzMzY5NiZxPWNvbXBvbmVudCUzQUJsaW5rJTNFTmV0d29yayUzRVhIUiUyMCZjb2xzcGVjPUlEJTIwUHJpJTIwTSUyMFN0YXJzJTIwUmVsZWFzZUJsb2NrJTIwQ29tcG9uZW50JTIwU3RhdHVzJTIwT3duZXIlMjBTdW1tYXJ5JTIwT1MlMjBNb2RpZmllZAogICAgICAgICAgKi8KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gbG9hZCAoKSB7IEFOb2RlLnByb3RvdHlwZS5sb2FkLmNhbGwoc2VsZik7IH0pOwogICAgICAgIH0sIGZ1bmN0aW9uIGhhbmRsZU9uUHJvZ3Jlc3MgKHhocikgewogICAgICAgICAgc2VsZi5lbWl0KCdwcm9ncmVzcycsIHsKICAgICAgICAgICAgbG9hZGVkQnl0ZXM6IHhoci5sb2FkZWQsCiAgICAgICAgICAgIHRvdGFsQnl0ZXM6IHhoci50b3RhbCwKICAgICAgICAgICAgeGhyOiB4aHIKICAgICAgICAgIH0pOwogICAgICAgIH0sIGZ1bmN0aW9uIGhhbmRsZU9uRXJyb3IgKHhocikgewogICAgICAgICAgc2VsZi5lbWl0KCdlcnJvcicsIHt4aHI6IHhocn0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSkKfSk7CgovKioKICogQ3JlYXRlIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIG1lZGlhIGVsZW1lbnQgaGFzIGZpbmlzaGVkIGJ1ZmZlcmluZy4KICoKICogQHBhcmFtIHtFbGVtZW50fSBlbCAtIEhUTUxNZWRpYUVsZW1lbnQuCiAqIEByZXR1cm5zIHtQcm9taXNlfQogKi8KZnVuY3Rpb24gbWVkaWFFbGVtZW50TG9hZGVkIChlbCkgewogIGlmICghZWwuaGFzQXR0cmlidXRlKCdhdXRvcGxheScpICYmIGVsLmdldEF0dHJpYnV0ZSgncHJlbG9hZCcpICE9PSAnYXV0bycpIHsKICAgIHJldHVybjsKICB9CgogIC8vIElmIG1lZGlhIHNwZWNpZmllcyBhdXRvcGxheSBvciBwcmVsb2FkLCB3YWl0IHVudGlsIG1lZGlhIGlzIGNvbXBsZXRlbHkgYnVmZmVyZWQuCiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIGlmIChlbC5yZWFkeVN0YXRlID09PSA0KSB7IHJldHVybiByZXNvbHZlKCk7IH0gIC8vIEFscmVhZHkgbG9hZGVkLgogICAgaWYgKGVsLmVycm9yKSB7IHJldHVybiByZWplY3QoKTsgfSAgLy8gRXJyb3IuCgogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVkZGF0YScsIGNoZWNrUHJvZ3Jlc3MsIGZhbHNlKTsKICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgY2hlY2tQcm9ncmVzcywgZmFsc2UpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCByZWplY3QsIGZhbHNlKTsKCiAgICBmdW5jdGlvbiBjaGVja1Byb2dyZXNzICgpIHsKICAgICAgLy8gQWRkIHVwIHRoZSBzZWNvbmRzIGJ1ZmZlcmVkLgogICAgICB2YXIgc2Vjb25kc0J1ZmZlcmVkID0gMDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5idWZmZXJlZC5sZW5ndGg7IGkrKykgewogICAgICAgIHNlY29uZHNCdWZmZXJlZCArPSBlbC5idWZmZXJlZC5lbmQoaSkgLSBlbC5idWZmZXJlZC5zdGFydChpKTsKICAgICAgfQoKICAgICAgLy8gQ29tcGFyZSBzZWNvbmRzIGJ1ZmZlcmVkIHRvIG1lZGlhIGR1cmF0aW9uLgogICAgICBpZiAoc2Vjb25kc0J1ZmZlcmVkID49IGVsLmR1cmF0aW9uKSB7CiAgICAgICAgLy8gU2V0IGluIGNhY2hlIGJlY2F1c2Ugd2Ugd29uJ3QgYmUgbmVlZGluZyB0byBjYWxsIHRocmVlLmpzIGxvYWRlciBpZiB3ZSBoYXZlLgogICAgICAgIC8vIGEgbG9hZGVkIG1lZGlhIGVsZW1lbnQuCiAgICAgICAgLy8gU3RvcmUgdmlkZW8gZWxlbWVudHMgb25seS4gdGhyZWUuanMgbG9hZGVyIGlzIHVzZWQgZm9yIGF1ZGlvIGVsZW1lbnRzLgogICAgICAgIC8vIFNlZSBhc3NldFBhcnNlIHRvby4KICAgICAgICBpZiAoZWwudGFnTmFtZSA9PT0gJ1ZJREVPJykgewogICAgICAgICAgVEhSRUUuQ2FjaGUuZmlsZXNbZWwuZ2V0QXR0cmlidXRlKCdzcmMnKV0gPSBlbDsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9CiAgICB9CiAgfSk7Cn0KCi8qKgogKiBBdXRvbWF0aWNhbGx5IGFkZCBhdHRyaWJ1dGVzIHRvIG1lZGlhIGVsZW1lbnRzIHdoZXJlIGNvbnZlbmllbnQuCiAqIGNyb3Nzb3JpZ2luLCBwbGF5c2lubGluZS4KICovCmZ1bmN0aW9uIGZpeFVwTWVkaWFFbGVtZW50IChtZWRpYUVsKSB7CiAgLy8gQ3Jvc3Mtb3JpZ2luLgogIHZhciBuZXdNZWRpYUVsID0gc2V0Q3Jvc3NPcmlnaW4obWVkaWFFbCk7CgogIC8vIFBsYXlzIGlubGluZSBmb3IgbW9iaWxlLgogIGlmIChuZXdNZWRpYUVsLnRhZ05hbWUgJiYgbmV3TWVkaWFFbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICd2aWRlbycpIHsKICAgIG5ld01lZGlhRWwuc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTsKICAgIG5ld01lZGlhRWwuc2V0QXR0cmlidXRlKCd3ZWJraXQtcGxheXNpbmxpbmUnLCAnJyk7CiAgfQoKICBpZiAobmV3TWVkaWFFbCAhPT0gbWVkaWFFbCkgewogICAgbWVkaWFFbC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKG5ld01lZGlhRWwpOwogICAgbWVkaWFFbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG1lZGlhRWwpOwogIH0KICByZXR1cm4gbmV3TWVkaWFFbDsKfQoKLyoqCiAqIEF1dG9tYXRpY2FsbHkgc2V0IGBjcm9zc29yaWdpbmAgaWYgbm90IGRlZmluZWQgb24gdGhlIG1lZGlhIGVsZW1lbnQuCiAqIElmIGl0IGlzIG5vdCBkZWZpbmVkLCB3ZSBtdXN0IGNyZWF0ZSBhbmQgcmUtYXBwZW5kIGEgbmV3IG1lZGlhIGVsZW1lbnQgPGltZz4gYW5kCiAqIGhhdmUgdGhlIGJyb3dzZXIgcmUtcmVxdWVzdCBpdCB3aXRoIGBjcm9zc29yaWdpbmAgc2V0LgogKgogKiBAcGFyYW0ge0VsZW1lbnR9IE1lZGlhIGVsZW1lbnQgKGUuZy4sIDxpbWc+LCA8YXVkaW8+LCA8dmlkZW8+KS4KICogQHJldHVybnMge0VsZW1lbnR9IE1lZGlhIGVsZW1lbnQgdG8gYmUgdXNlZCB0byBsaXN0ZW4gdG8gZm9yIGxvYWRlZCBldmVudHMuCiAqLwpmdW5jdGlvbiBzZXRDcm9zc09yaWdpbiAobWVkaWFFbCkgewogIHZhciBuZXdNZWRpYUVsOwogIHZhciBzcmM7CgogIC8vIEFscmVhZHkgaGFzIGNyb3Nzb3JpZ2luIHNldC4KICBpZiAobWVkaWFFbC5oYXNBdHRyaWJ1dGUoJ2Nyb3Nzb3JpZ2luJykpIHsgcmV0dXJuIG1lZGlhRWw7IH0KCiAgc3JjID0gbWVkaWFFbC5nZXRBdHRyaWJ1dGUoJ3NyYycpOwoKICBpZiAoc3JjICE9PSBudWxsKSB7CiAgICAvLyBEb2VzIG5vdCBoYXZlIHByb3RvY29sLgogICAgaWYgKHNyYy5pbmRleE9mKCc6Ly8nKSA9PT0gLTEpIHsgcmV0dXJuIG1lZGlhRWw7IH0KCiAgICAvLyBEZXRlcm1pbmUgaWYgY3Jvc3Mgb3JpZ2luIGlzIGFjdHVhbGx5IG5lZWRlZC4KICAgIGlmIChleHRyYWN0RG9tYWluKHNyYykgPT09IHdpbmRvdy5sb2NhdGlvbi5ob3N0KSB7IHJldHVybiBtZWRpYUVsOyB9CiAgfQoKICB3YXJuKCdDcm9zcy1vcmlnaW4gZWxlbWVudCAoZS5nLiwgPGltZz4pIHdhcyByZXF1ZXN0ZWQgd2l0aG91dCBgY3Jvc3NvcmlnaW5gIHNldC4gJyArCiAgICAgICAnQS1GcmFtZSB3aWxsIHJlLXJlcXVlc3QgdGhlIGFzc2V0IHdpdGggYGNyb3Nzb3JpZ2luYCBhdHRyaWJ1dGUgc2V0LiAnICsKICAgICAgICdQbGVhc2Ugc2V0IGBjcm9zc29yaWdpbmAgb24gdGhlIGVsZW1lbnQgKGUuZy4sIDxpbWcgY3Jvc3NvcmlnaW49ImFub255bW91cyI+KScsIHNyYyk7CiAgbWVkaWFFbC5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwogIG5ld01lZGlhRWwgPSBtZWRpYUVsLmNsb25lTm9kZSh0cnVlKTsKICByZXR1cm4gbmV3TWVkaWFFbDsKfQoKLyoqCiAqIEV4dHJhY3QgZG9tYWluIG91dCBvZiBVUkwuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB1cmwKICogQHJldHVybnMge3N0cmluZ30KICovCmZ1bmN0aW9uIGV4dHJhY3REb21haW4gKHVybCkgewogIC8vIEZpbmQgYW5kIHJlbW92ZSBwcm90b2NvbCAoZS5nLiwgaHR0cCwgZnRwLCBldGMuKSB0byBnZXQgZG9tYWluLgogIHZhciBkb21haW4gPSB1cmwuaW5kZXhPZignOi8vJykgPiAtMSA/IHVybC5zcGxpdCgnLycpWzJdIDogdXJsLnNwbGl0KCcvJylbMF07CgogIC8vIEZpbmQgYW5kIHJlbW92ZSBwb3J0IG51bWJlci4KICByZXR1cm4gZG9tYWluLnN1YnN0cmluZygwLCBkb21haW4uaW5kZXhPZignOicpKTsKfQoKLyoqCiAqIEluZmVyIHJlc3BvbnNlLXR5cGUgYXR0cmlidXRlIGZyb20gc3JjLgogKiBEZWZhdWx0IGlzIHRleHQoZGVmYXVsdCBYTUxIdHRwUmVxdWVzdC5yZXNwb25zZVR5cGUpCiAqIGJ1dCB3ZSB1c2UgYXJyYXlidWZmZXIgZm9yIC5nbHRmIGFuZCAuZ2xiIGZpbGVzCiAqIGJlY2F1c2Ugb2YgVEhSRUUuR0xURkxvYWRlciBzcGVjaWZpY2F0aW9uLgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3JjCiAqIEByZXR1cm5zIHtzdHJpbmd9CiAqLwpmdW5jdGlvbiBpbmZlclJlc3BvbnNlVHlwZSAoc3JjKSB7CiAgdmFyIGRvdExhc3RJbmRleCA9IHNyYy5sYXN0SW5kZXhPZignLicpOwogIGlmIChkb3RMYXN0SW5kZXggPj0gMCkgewogICAgdmFyIGV4dGVuc2lvbiA9IHNyYy5zbGljZShkb3RMYXN0SW5kZXgsIHNyYy5sZW5ndGgpOwogICAgaWYgKGV4dGVuc2lvbiA9PT0gJy5nbHRmJyB8fCBleHRlbnNpb24gPT09ICcuZ2xiJykgewogICAgICByZXR1cm4gJ2FycmF5YnVmZmVyJzsKICAgIH0KICB9CiAgcmV0dXJuICd0ZXh0JzsKfQptb2R1bGUuZXhwb3J0cy5pbmZlclJlc3BvbnNlVHlwZSA9IGluZmVyUmVzcG9uc2VUeXBlOwoKfSx7Ii4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy9iaW5kIjoxNzMsIi4uL3V0aWxzL2RlYnVnIjoxNzUsIi4vYS1ub2RlIjoxMDQsIi4vYS1yZWdpc3Rlci1lbGVtZW50IjoxMDV9XSwxMDE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZGVidWcgPSBfZGVyZXFfKCcuLi91dGlscy9kZWJ1ZycpOwp2YXIgcmVnaXN0ZXJFbGVtZW50ID0gX2RlcmVxXygnLi9hLXJlZ2lzdGVyLWVsZW1lbnQnKS5yZWdpc3RlckVsZW1lbnQ7Cgp2YXIgd2FybiA9IGRlYnVnKCdjb3JlOmN1YmVtYXA6d2FybicpOwoKLyoqCiAqIEN1YmVtYXAgZWxlbWVudCB0aGF0IGhhbmRsZXMgdmFsaWRhdGlvbiBhbmQgZXhwb3NlcyBsaXN0IG9mIFVSTHMuCiAqIERvZXMgbm90IGxpc3RlbiB0byB1cGRhdGVzLgogKi8KbW9kdWxlLmV4cG9ydHMgPSByZWdpc3RlckVsZW1lbnQoJ2EtY3ViZW1hcCcsIHsKICBwcm90b3R5cGU6IE9iamVjdC5jcmVhdGUod2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZSwgewogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIHRoaXMuc3Jjcy4KICAgICAqLwogICAgYXR0YWNoZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuc3JjcyA9IHRoaXMudmFsaWRhdGUoKTsKICAgICAgfSwKICAgICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrcyBmb3IgZXhhY3RseSBzaXggZWxlbWVudHMgd2l0aCBbc3JjXS4KICAgICAqIERvZXMgbm90IGNoZWNrIGV4cGxpY2l0bHkgZm9yIDxpbWc+cyBpbiBjYXNlIHVzZXIgZG9lcyBub3Qgd2FudAogICAgICogcHJlZmV0Y2hpbmcuCiAgICAgKgogICAgICogQHJldHVybnMge0FycmF5fG51bGx9IC0gc2l4IFVSTHMgaWYgdmFsaWQsIGVsc2UgbnVsbC4KICAgICAqLwogICAgdmFsaWRhdGU6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWxlbWVudHMgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tzcmNdJyk7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHNyY3MgPSBbXTsKICAgICAgICBpZiAoZWxlbWVudHMubGVuZ3RoID09PSA2KSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3Jjcy5wdXNoKGVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnc3JjJykpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHNyY3M7CiAgICAgICAgfQogICAgICAgIC8vIEVsc2UgaWYgdGhlcmUgYXJlIG5vdCBzaXggZWxlbWVudHMsIHRocm93IGEgd2FybmluZy4KICAgICAgICB3YXJuKAogICAgICAgICAgJzxhLWN1YmVtYXA+IGRpZCBub3QgY29udGFpbiBleGFjdGx5IHNpeCBlbGVtZW50cyBlYWNoIHdpdGggYSAnICsKICAgICAgICAgICdgc3JjYCBhdHRyaWJ1dGUuJyk7CiAgICAgIH0sCiAgICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICAgIH0KICB9KQp9KTsKCn0seyIuLi91dGlscy9kZWJ1ZyI6MTc1LCIuL2EtcmVnaXN0ZXItZWxlbWVudCI6MTA1fV0sMTAyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIEFOb2RlID0gX2RlcmVxXygnLi9hLW5vZGUnKTsKdmFyIENPTVBPTkVOVFMgPSBfZGVyZXFfKCcuL2NvbXBvbmVudCcpLmNvbXBvbmVudHM7CnZhciByZWdpc3RlckVsZW1lbnQgPSBfZGVyZXFfKCcuL2EtcmVnaXN0ZXItZWxlbWVudCcpLnJlZ2lzdGVyRWxlbWVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwoKdmFyIEFFbnRpdHk7CnZhciBkZWJ1ZyA9IHV0aWxzLmRlYnVnKCdjb3JlOmEtZW50aXR5OmRlYnVnJyk7CnZhciB3YXJuID0gdXRpbHMuZGVidWcoJ2NvcmU6YS1lbnRpdHk6d2FybicpOwoKdmFyIE1VTFRJUExFX0NPTVBPTkVOVF9ERUxJTUlURVIgPSAnX18nOwp2YXIgT0JKRUNUM0RfQ09NUE9ORU5UUyA9IFsncG9zaXRpb24nLCAncm90YXRpb24nLCAnc2NhbGUnLCAndmlzaWJsZSddOwp2YXIgT05DRSA9IHtvbmNlOiB0cnVlfTsKCi8qKgogKiBFbnRpdHkgaXMgYSBjb250YWluZXIgb2JqZWN0IHRoYXQgY29tcG9uZW50cyBhcmUgcGx1Z2dlZCBpbnRvIHRvIGNvbXByaXNlIGV2ZXJ5dGhpbmcgaW4KICogdGhlIHNjZW5lLiBJbiBBLUZyYW1lLCB0aGV5IGluaGVyZW50bHkgaGF2ZSBwb3NpdGlvbiwgcm90YXRpb24sIGFuZCBzY2FsZS4KICoKICogVG8gYmUgYWJsZSB0byB0YWtlIGNvbXBvbmVudHMsIHRoZSBzY2VuZSBlbGVtZW50IGluaGVyaXRzIGZyb20gdGhlIGVudGl0eSBkZWZpbml0aW9uLgogKgogKiBAbWVtYmVyIHtvYmplY3R9IGNvbXBvbmVudHMgLSBlbnRpdHkncyBjdXJyZW50bHkgaW5pdGlhbGl6ZWQgY29tcG9uZW50cy4KICogQG1lbWJlciB7b2JqZWN0fSBvYmplY3QzRCAtIHRocmVlLmpzIG9iamVjdC4KICogQG1lbWJlciB7YXJyYXl9IHN0YXRlcwogKiBAbWVtYmVyIHtib29sZWFufSBpc1BsYXlpbmcgLSBmYWxzZSBpZiBkeW5hbWljIGJlaGF2aW9yIG9mIHRoZSBlbnRpdHkgaXMgcGF1c2VkLgogKi8KdmFyIHByb3RvID0gT2JqZWN0LmNyZWF0ZShBTm9kZS5wcm90b3R5cGUsIHsKICBjcmVhdGVkQ2FsbGJhY2s6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuY29tcG9uZW50cyA9IHt9OwogICAgICAvLyBUbyBhdm9pZCBkb3VibGUgaW5pdGlhbGl6YXRpb25zIGFuZCBpbmZpbml0ZSBsb29wcy4KICAgICAgdGhpcy5pbml0aWFsaXppbmdDb21wb25lbnRzID0ge307CiAgICAgIHRoaXMuY29tcG9uZW50c1RvVXBkYXRlID0ge307CiAgICAgIHRoaXMuaXNFbnRpdHkgPSB0cnVlOwogICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlOwogICAgICB0aGlzLm9iamVjdDNEID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgIHRoaXMub2JqZWN0M0QuZWwgPSB0aGlzOwogICAgICB0aGlzLm9iamVjdDNETWFwID0ge307CiAgICAgIHRoaXMucGFyZW50RWwgPSBudWxsOwogICAgICB0aGlzLnJvdGF0aW9uT2JqID0ge307CiAgICAgIHRoaXMuc3RhdGVzID0gW107CiAgICB9CiAgfSwKCiAgLyoqCiAgICogSGFuZGxlIGNoYW5nZXMgY29taW5nIGZyb20gdGhlIGJyb3dzZXIgRE9NIGluc3BlY3Rvci4KICAgKi8KICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2s6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0ciwgb2xkVmFsLCBuZXdWYWwpIHsKICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50c1thdHRyXTsKICAgICAgLy8gSWYgdGhlIGVtcHR5IHN0cmluZyBpcyBwYXNzZWQgYnkgdGhlIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbgogICAgICAvLyBsb2dpYyB3ZSBpZ25vcmUgdGhlIGNvbXBvbmVudCB1cGRhdGUuCiAgICAgIGlmIChjb21wb25lbnQgJiYgY29tcG9uZW50Lmp1c3RJbml0aWFsaXplZCAmJiBuZXdWYWwgPT09ICcnKSB7CiAgICAgICAgZGVsZXRlIGNvbXBvbmVudC5qdXN0SW5pdGlhbGl6ZWQ7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIFdoZW4gYSBjb21wb25lbnQgaXMgcmVtb3ZlZCBhZnRlciBjYWxsaW5nIGVsLnJlbW92ZUF0dHJpYnV0ZSgnbWF0ZXJpYWwnKQogICAgICBpZiAoIWNvbXBvbmVudCAmJiBuZXdWYWwgPT09IG51bGwpIHsgcmV0dXJuOyB9CiAgICAgIHRoaXMuc2V0RW50aXR5QXR0cmlidXRlKGF0dHIsIG9sZFZhbCwgbmV3VmFsKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBBZGQgdG8gcGFyZW50LCBsb2FkLCBwbGF5LgogICAqLwogIGF0dGFjaGVkQ2FsbGJhY2s6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhc3NldHNFbDsgIC8vIEFzc2V0IG1hbmFnZW1lbnQgc3lzdGVtIGVsZW1lbnQuCiAgICAgIHZhciBzY2VuZUVsID0gdGhpcy5zY2VuZUVsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7ICAvLyBDb21wb25lbnQuCgogICAgICB0aGlzLmFkZFRvUGFyZW50KCk7CgogICAgICAvLyBEb24ndCAubG9hZCgpIHNjZW5lIG9uIGF0dGFjaGVkQ2FsbGJhY2suCiAgICAgIGlmICh0aGlzLmlzU2NlbmUpIHsgcmV0dXJuOyB9CgogICAgICAvLyBHcmFjZWZ1bGx5IG5vdCBlcnJvciB3aGVuIG91dHNpZGUgb2YgPGEtc2NlbmU+IChlLmcuLCB0ZXN0cykuCiAgICAgIGlmICghc2NlbmVFbCkgewogICAgICAgIHRoaXMubG9hZCgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gV2FpdCBmb3IgYXNzZXQgbWFuYWdlbWVudCBzeXN0ZW0gdG8gZmluaXNoIGJlZm9yZSBsb2FkaW5nLgogICAgICBhc3NldHNFbCA9IHNjZW5lRWwucXVlcnlTZWxlY3RvcignYS1hc3NldHMnKTsKICAgICAgaWYgKGFzc2V0c0VsICYmICFhc3NldHNFbC5oYXNMb2FkZWQpIHsKICAgICAgICBhc3NldHNFbC5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBmdW5jdGlvbiAoKSB7IHNlbGYubG9hZCgpOyB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5sb2FkKCk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogVGVsbCBwYXJlbnQgdG8gcmVtb3ZlIHRoaXMgZWxlbWVudCdzIG9iamVjdDNEIGZyb20gaXRzIG9iamVjdDNELgogICAqIERvIG5vdCBjYWxsIG9uIHNjZW5lIGVsZW1lbnQgYmVjYXVzZSB0aGF0IHdpbGwgY2F1c2UgYSBjYWxsIHRvIGRvY3VtZW50LmJvZHkucmVtb3ZlKCkuCiAgICovCiAgZGV0YWNoZWRDYWxsYmFjazogewogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGNvbXBvbmVudE5hbWU7CgogICAgICBpZiAoIXRoaXMucGFyZW50RWwpIHsgcmV0dXJuOyB9CgogICAgICAvLyBSZW1vdmUgY29tcG9uZW50cy4KICAgICAgZm9yIChjb21wb25lbnROYW1lIGluIHRoaXMuY29tcG9uZW50cykgewogICAgICAgIHRoaXMucmVtb3ZlQ29tcG9uZW50KGNvbXBvbmVudE5hbWUsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuaXNTY2VuZSkgeyByZXR1cm47IH0KCiAgICAgIHRoaXMucmVtb3ZlRnJvbVBhcmVudCgpOwogICAgICBBTm9kZS5wcm90b3R5cGUuZGV0YWNoZWRDYWxsYmFjay5jYWxsKHRoaXMpOwoKICAgICAgLy8gUmVtb3ZlIGN5Y2xpYyByZWZlcmVuY2UuCiAgICAgIHRoaXMub2JqZWN0M0QuZWwgPSBudWxsOwogICAgfQogIH0sCgogIGdldE9iamVjdDNEOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgcmV0dXJuIHRoaXMub2JqZWN0M0RNYXBbdHlwZV07CiAgICB9CiAgfSwKCiAgLyoqCiAgICogU2V0IGEgVEhSRUUuT2JqZWN0M0QgaW50byB0aGUgbWFwLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBEZXZlbG9wZXItc2V0IG5hbWUgb2YgdGhlIHR5cGUgb2Ygb2JqZWN0LCB3aWxsIGJlIHVuaXF1ZSBwZXIgdHlwZS4KICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIC0gQSBUSFJFRS5PYmplY3QzRC4KICAgKi8KICBzZXRPYmplY3QzRDogewogICAgdmFsdWU6IGZ1bmN0aW9uICh0eXBlLCBvYmopIHsKICAgICAgdmFyIG9sZE9iajsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgVEhSRUUuT2JqZWN0M0QpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgJ2BFbnRpdHkuc2V0T2JqZWN0M0RgIHdhcyBjYWxsZWQgd2l0aCBhbiBvYmplY3QgdGhhdCB3YXMgbm90IGFuIGluc3RhbmNlIG9mICcgKwogICAgICAgICAgJ1RIUkVFLk9iamVjdDNELicKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBSZW1vdmUgZXhpc3Rpbmcgb2JqZWN0IG9mIHRoZSB0eXBlLgogICAgICBvbGRPYmogPSB0aGlzLmdldE9iamVjdDNEKHR5cGUpOwogICAgICBpZiAob2xkT2JqKSB7IHRoaXMub2JqZWN0M0QucmVtb3ZlKG9sZE9iaik7IH0KCiAgICAgIC8vIFNldCByZWZlcmVuY2VzIHRvIEEtRnJhbWUgZW50aXR5LgogICAgICBvYmouZWwgPSB0aGlzOwogICAgICBpZiAob2JqLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIG9iai50cmF2ZXJzZShmdW5jdGlvbiBiaW5kRWwgKGNoaWxkKSB7CiAgICAgICAgICBjaGlsZC5lbCA9IHNlbGY7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIC8vIEFkZC4KICAgICAgdGhpcy5vYmplY3QzRC5hZGQob2JqKTsKICAgICAgdGhpcy5vYmplY3QzRE1hcFt0eXBlXSA9IG9iajsKICAgICAgdGhpcy5lbWl0KCdvYmplY3QzZHNldCcsIHtvYmplY3Q6IG9iaiwgdHlwZTogdHlwZX0pOwogICAgfQogIH0sCgogIC8qKgogICAqIFJlbW92ZSBvYmplY3QgZnJvbSBzY2VuZSBhbmQgZW50aXR5IG9iamVjdDNEIG1hcC4KICAgKi8KICByZW1vdmVPYmplY3QzRDogewogICAgdmFsdWU6IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLmdldE9iamVjdDNEKHR5cGUpOwogICAgICBpZiAoIW9iaikgewogICAgICAgIHdhcm4oJ1RyaWVkIHRvIHJlbW92ZSBgT2JqZWN0M0RgIG9mIHR5cGU6JywgdHlwZSwgJ3doaWNoIHdhcyBub3QgZGVmaW5lZC4nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5vYmplY3QzRC5yZW1vdmUob2JqKTsKICAgICAgZGVsZXRlIHRoaXMub2JqZWN0M0RNYXBbdHlwZV07CiAgICAgIHRoaXMuZW1pdCgnb2JqZWN0M2RyZW1vdmUnLCB7dHlwZTogdHlwZX0pOwogICAgfQogIH0sCgogIC8qKgogICAqIEdldHMgb3IgY3JlYXRlcyBhbiBvYmplY3QzRCBvZiBhIGdpdmVuIHR5cGUuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFR5cGUgb2YgdGhlIG9iamVjdDNELgogICAqIEBwYXJhbSB7c3RyaW5nfSBDb25zdHJ1Y3RvciAtIENvbnN0cnVjdG9yIHRvIHVzZSB0byBjcmVhdGUgdGhlIG9iamVjdDNEIGlmIG5lZWRlZC4KICAgKiBAcmV0dXJucyB7b2JqZWN0fQogICAqLwogIGdldE9yQ3JlYXRlT2JqZWN0M0Q6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAodHlwZSwgQ29uc3RydWN0b3IpIHsKICAgICAgdmFyIG9iamVjdDNEID0gdGhpcy5nZXRPYmplY3QzRCh0eXBlKTsKICAgICAgaWYgKCFvYmplY3QzRCAmJiBDb25zdHJ1Y3RvcikgewogICAgICAgIG9iamVjdDNEID0gbmV3IENvbnN0cnVjdG9yKCk7CiAgICAgICAgdGhpcy5zZXRPYmplY3QzRCh0eXBlLCBvYmplY3QzRCk7CiAgICAgIH0KICAgICAgd2FybignYGdldE9yQ3JlYXRlT2JqZWN0M0RgIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSBgc2V0T2JqZWN0M0QoKWAgJyArCiAgICAgICAgICAgJ2FuZCBgb2JqZWN0M2RzZXRgIGV2ZW50IGluc3RlYWQuJyk7CiAgICAgIHJldHVybiBvYmplY3QzRDsKICAgIH0KICB9LAoKICAvKioKICAgKiBBZGQgY2hpbGQgZW50aXR5LgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbCAtIENoaWxkIGVudGl0eS4KICAgKi8KICBhZGQ6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoZWwpIHsKICAgICAgaWYgKCFlbC5vYmplY3QzRCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiVHJ5aW5nIHRvIGFkZCBhbiBlbGVtZW50IHRoYXQgZG9lc24ndCBoYXZlIGFuIGBvYmplY3QzRGAiKTsKICAgICAgfQogICAgICB0aGlzLm9iamVjdDNELmFkZChlbC5vYmplY3QzRCk7CiAgICAgIHRoaXMuZW1pdCgnY2hpbGQtYXR0YWNoZWQnLCB7ZWw6IGVsfSk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogVGVsbCBwYXJlbnROb2RlIHRvIGFkZCB0aGlzIGVudGl0eSB0byBpdHNlbGYuCiAgICovCiAgYWRkVG9QYXJlbnQ6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwYXJlbnROb2RlID0gdGhpcy5wYXJlbnRFbCA9IHRoaXMucGFyZW50Tm9kZTsKCiAgICAgIC8vIGAhcGFyZW50Tm9kZWAgY2hlY2sgcHJpbWFyaWx5IGZvciB1bml0IHRlc3RzLgogICAgICBpZiAoIXBhcmVudE5vZGUgfHwgIXBhcmVudE5vZGUuYWRkIHx8IHRoaXMuYXR0YWNoZWRUb1BhcmVudCkgeyByZXR1cm47IH0KCiAgICAgIHBhcmVudE5vZGUuYWRkKHRoaXMpOwogICAgICB0aGlzLmF0dGFjaGVkVG9QYXJlbnQgPSB0cnVlOyAgLy8gVG8gcHJldmVudCBtdWx0aXBsZSBhdHRhY2htZW50cyB0byBzYW1lIHBhcmVudC4KICAgIH0KICB9LAoKICAvKioKICAgKiBUZWxsIHBhcmVudE5vZGUgdG8gcmVtb3ZlIHRoaXMgZW50aXR5IGZyb20gaXRzZWxmLgogICAqLwogIHJlbW92ZUZyb21QYXJlbnQ6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwYXJlbnRFbCA9IHRoaXMucGFyZW50RWw7CiAgICAgIHRoaXMucGFyZW50RWwucmVtb3ZlKHRoaXMpOwogICAgICB0aGlzLmF0dGFjaGVkVG9QYXJlbnQgPSBmYWxzZTsKICAgICAgdGhpcy5wYXJlbnRFbCA9IG51bGw7CiAgICAgIHBhcmVudEVsLmVtaXQoJ2NoaWxkLWRldGFjaGVkJywge2VsOiB0aGlzfSk7CiAgICB9CiAgfSwKCiAgbG9hZDogewogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuaGFzTG9hZGVkIHx8ICF0aGlzLnBhcmVudEVsKSB7IHJldHVybjsgfQoKICAgICAgQU5vZGUucHJvdG90eXBlLmxvYWQuY2FsbCh0aGlzLCBmdW5jdGlvbiBlbnRpdHlMb2FkQ2FsbGJhY2sgKCkgewogICAgICAgIC8vIENoZWNrIGlmIGVudGl0eSB3YXMgZGV0YWNoZWQgd2hpbGUgaXQgd2FzIHdhaXRpbmcgdG8gbG9hZC4KICAgICAgICBpZiAoIXNlbGYucGFyZW50RWwpIHsgcmV0dXJuOyB9CgogICAgICAgIHNlbGYudXBkYXRlQ29tcG9uZW50cygpOwogICAgICAgIGlmIChzZWxmLmlzU2NlbmUgfHwgc2VsZi5wYXJlbnRFbC5pc1BsYXlpbmcpIHsgc2VsZi5wbGF5KCk7IH0KICAgICAgfSk7CiAgICB9LAogICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogIH0sCgogIC8qKgogICAqIFJlbW92ZSBjaGlsZCBlbnRpdHkuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsIC0gQ2hpbGQgZW50aXR5LgogICAqLwogIHJlbW92ZTogewogICAgdmFsdWU6IGZ1bmN0aW9uIChlbCkgewogICAgICBpZiAoZWwpIHsKICAgICAgICB0aGlzLm9iamVjdDNELnJlbW92ZShlbC5vYmplY3QzRCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpOwogICAgICB9CiAgICB9CiAgfSwKCiAgLyoqCiAgICogQHJldHVybnMge2FycmF5fSBEaXJlY3QgY2hpbGRyZW4gdGhhdCBhcmUgZW50aXRpZXMuCiAgICovCiAgZ2V0Q2hpbGRFbnRpdGllczogewogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgdmFyIGNoaWxkRW50aXRpZXMgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBBRW50aXR5KSB7CiAgICAgICAgICBjaGlsZEVudGl0aWVzLnB1c2goY2hpbGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGNoaWxkRW50aXRpZXM7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogSW5pdGlhbGl6ZSBjb21wb25lbnQuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gYXR0ck5hbWUgLSBBdHRyaWJ1dGUgbmFtZSBhc29jaWF0ZWQgdG8gdGhlIGNvbXBvbmVudC4KICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIENvbXBvbmVudCBkYXRhCiAgICogQHBhcmFtIHtib29sZWFufSBpc0RlcGVuZGVuY3kgLSBUcnVlIGlmIHRoZSBjb21wb25lbnQgaXMgYSBkZXBlbmRlbmN5LgogICAqLwogIGluaXRDb21wb25lbnQ6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0ck5hbWUsIGRhdGEsIGlzRGVwZW5kZW5jeSkgewogICAgICB2YXIgY29tcG9uZW50OwogICAgICB2YXIgY29tcG9uZW50SWQ7CiAgICAgIHZhciBjb21wb25lbnRJbmZvOwogICAgICB2YXIgY29tcG9uZW50TmFtZTsKICAgICAgdmFyIGlzQ29tcG9uZW50RGVmaW5lZDsKCiAgICAgIGNvbXBvbmVudEluZm8gPSB1dGlscy5zcGxpdChhdHRyTmFtZSwgTVVMVElQTEVfQ09NUE9ORU5UX0RFTElNSVRFUik7CiAgICAgIGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnRJbmZvWzBdOwogICAgICBjb21wb25lbnRJZCA9IGNvbXBvbmVudEluZm8ubGVuZ3RoID4gMgogICAgICAgID8gY29tcG9uZW50SW5mby5zbGljZSgxKS5qb2luKCdfXycpCiAgICAgICAgOiBjb21wb25lbnRJbmZvWzFdOwoKICAgICAgLy8gTm90IGEgcmVnaXN0ZXJlZCBjb21wb25lbnQuCiAgICAgIGlmICghQ09NUE9ORU5UU1tjb21wb25lbnROYW1lXSkgeyByZXR1cm47IH0KCiAgICAgIC8vIENvbXBvbmVudCBpcyBub3QgYSBkZXBlbmRlbmN5IGFuZCBpcyB1bmRlZmluZWQuCiAgICAgIC8vIElmIGEgY29tcG9uZW50IGlzIGEgZGVwZW5kZW5jeSwgdGhlbiBpdCBpcyBva2F5IHRvIGhhdmUgbm8gZGF0YS4KICAgICAgaXNDb21wb25lbnREZWZpbmVkID0gY2hlY2tDb21wb25lbnREZWZpbmVkKHRoaXMsIGF0dHJOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhICE9PSB1bmRlZmluZWQ7CiAgICAgIGlmICghaXNDb21wb25lbnREZWZpbmVkICYmICFpc0RlcGVuZGVuY3kpIHsgcmV0dXJuOyB9CgogICAgICAvLyBDb21wb25lbnQgYWxyZWFkeSBpbml0aWFsaXplZC4KICAgICAgaWYgKGF0dHJOYW1lIGluIHRoaXMuY29tcG9uZW50cykgeyByZXR1cm47IH0KCiAgICAgIC8vIEluaXRpYWxpemUgZGVwZW5kZW5jaWVzIGZpcnN0CiAgICAgIHRoaXMuaW5pdENvbXBvbmVudERlcGVuZGVuY2llcyhjb21wb25lbnROYW1lKTsKCiAgICAgIC8vIElmIGNvbXBvbmVudCBuYW1lIGhhcyBhbiBpZCB3ZSBjaGVjayBjb21wb25lbnQgdHlwZSBtdWx0aXBsaWMKICAgICAgaWYgKGNvbXBvbmVudElkICYmICFDT01QT05FTlRTW2NvbXBvbmVudE5hbWVdLm11bHRpcGxlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcnlpbmcgdG8gaW5pdGlhbGl6ZSBtdWx0aXBsZSAnICsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbXBvbmVudHMgb2YgdHlwZSBgJyArIGNvbXBvbmVudE5hbWUgKwogICAgICAgICAgICAgICAgICAgICAgICAnYC4gVGhlcmUgY2FuIG9ubHkgYmUgb25lIGNvbXBvbmVudCBvZiB0aGlzIHR5cGUgcGVyIGVudGl0eS4nKTsKICAgICAgfQogICAgICBjb21wb25lbnQgPSBuZXcgQ09NUE9ORU5UU1tjb21wb25lbnROYW1lXS5Db21wb25lbnQodGhpcywgZGF0YSwgY29tcG9uZW50SWQpOwogICAgICBpZiAodGhpcy5pc1BsYXlpbmcpIHsgY29tcG9uZW50LnBsYXkoKTsgfQoKICAgICAgLy8gQ29tcG9uZW50cyBhcmUgcmVmbGVjdGVkIGluIHRoZSBET00gYXMgYXR0cmlidXRlcyBidXQgdGhlIHN0YXRlIGlzIG5vdCBzaG93bgogICAgICAvLyBoZW5jZSB3ZSBzZXQgdGhlIGF0dHJpYnV0ZSB0byBlbXB0eSBzdHJpbmcuCiAgICAgIC8vIFRoZSBmbGFnIGp1c3RJbml0aWFsaXplZCBpcyBmb3IgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrIHRvIG5vdCBvdmVyd3JpdGUKICAgICAgLy8gdGhlIGNvbXBvbmVudCB3aXRoIHRoZSBlbXB0eSBzdHJpbmcuCiAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUoYXR0ck5hbWUpKSB7CiAgICAgICAgY29tcG9uZW50Lmp1c3RJbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyTmFtZSwgJycpOwogICAgICB9CgogICAgICBkZWJ1ZygnQ29tcG9uZW50IGluaXRpYWxpemVkOiAlcycsIGF0dHJOYW1lKTsKICAgIH0sCiAgICB3cml0YWJsZTogd2luZG93LmRlYnVnCiAgfSwKCiAgLyoqCiAgICogSW5pdGlhbGl6ZSBkZXBlbmRlbmNpZXMgb2YgYSBjb21wb25lbnQuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFJvb3QgY29tcG9uZW50IG5hbWUuCiAgICovCiAgaW5pdENvbXBvbmVudERlcGVuZGVuY2llczogewogICAgdmFsdWU6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNvbXBvbmVudCA9IENPTVBPTkVOVFNbbmFtZV07CiAgICAgIHZhciBkZXBlbmRlbmNpZXM7CiAgICAgIHZhciBpOwoKICAgICAgLy8gTm90IGEgY29tcG9uZW50LgogICAgICBpZiAoIWNvbXBvbmVudCkgeyByZXR1cm47IH0KCiAgICAgIC8vIE5vIGRlcGVuZGVuY2llcy4KICAgICAgZGVwZW5kZW5jaWVzID0gQ09NUE9ORU5UU1tuYW1lXS5kZXBlbmRlbmNpZXM7CgogICAgICBpZiAoIWRlcGVuZGVuY2llcykgeyByZXR1cm47IH0KCiAgICAgIC8vIEluaXRpYWxpemUgZGVwZW5kZW5jaWVzLgogICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwZW5kZW5jaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gQ2FsbCBnZXRBdHRyaWJ1dGUgdG8gaW5pdGlhbGl6ZSB0aGUgZGF0YSBmcm9tIHRoZSBET00uCiAgICAgICAgc2VsZi5pbml0Q29tcG9uZW50KAogICAgICAgICAgZGVwZW5kZW5jaWVzW2ldLAogICAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUuY2FsbChzZWxmLCBkZXBlbmRlbmNpZXNbaV0pIHx8IHVuZGVmaW5lZCwKICAgICAgICAgIHRydWUKICAgICAgICApOwogICAgICB9CiAgICB9CiAgfSwKCiAgcmVtb3ZlQ29tcG9uZW50OiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKG5hbWUsIGRlc3Ryb3kpIHsKICAgICAgdmFyIGNvbXBvbmVudDsKCiAgICAgIGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50c1tuYW1lXTsKICAgICAgaWYgKCFjb21wb25lbnQpIHsgcmV0dXJuOyB9CgogICAgICAvLyBXYWl0IGZvciBjb21wb25lbnQgdG8gaW5pdGlhbGl6ZS4KICAgICAgaWYgKCFjb21wb25lbnQuaW5pdGlhbGl6ZWQpIHsKICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBvbmVudGluaXRpYWxpemVkJywgZnVuY3Rpb24gdHJ5UmVtb3ZlTGF0ZXIgKGV2dCkgewogICAgICAgICAgaWYgKGV2dC5kZXRhaWwubmFtZSAhPT0gbmFtZSkgeyByZXR1cm47IH0KICAgICAgICAgIHRoaXMucmVtb3ZlQ29tcG9uZW50KG5hbWUsIGRlc3Ryb3kpOwogICAgICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCdjb21wb25lbnRpbml0aWFsaXplZCcsIHRyeVJlbW92ZUxhdGVyKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbXBvbmVudC5wYXVzZSgpOwogICAgICBjb21wb25lbnQucmVtb3ZlKCk7CgogICAgICAvLyBLZWVwIGNvbXBvbmVudCBhdHRhY2hlZCB0byBlbnRpdHkgaW4gY2FzZSBvZiBqdXN0IGZ1bGwgZW50aXR5IGRldGFjaC4KICAgICAgaWYgKGRlc3Ryb3kpIHsKICAgICAgICBjb21wb25lbnQuZGVzdHJveSgpOwogICAgICAgIGRlbGV0ZSB0aGlzLmNvbXBvbmVudHNbbmFtZV07CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdCgnY29tcG9uZW50cmVtb3ZlZCcsIGNvbXBvbmVudC5ldnREZXRhaWwsIGZhbHNlKTsKICAgIH0sCiAgICB3cml0YWJsZTogd2luZG93LmRlYnVnCiAgfSwKCiAgLyoqCiAgICogSW5pdGlhbGl6ZSBvciB1cGRhdGUgYWxsIGNvbXBvbmVudHMuCiAgICogQnVpbGQgZGF0YSB1c2luZyBpbml0aWFsIGNvbXBvbmVudHMsIGRlZmluZWQgYXR0cmlidXRlcywgbWl4aW5zLCBhbmQgZGVmYXVsdHMuCiAgICogVXBkYXRlIGRlZmF1bHQgY29tcG9uZW50cyBiZWZvcmUgdGhlIHJlc3QuCiAgICoKICAgKiBAbWVtYmVyIHtmdW5jdGlvbn0gZ2V0RXh0cmFDb21wb25lbnRzIC0gQ2FuIGJlIGltcGxlbWVudGVkIHRvIGluY2x1ZGUgY29tcG9uZW50IGRhdGEKICAgKiAgIGZyb20gb3RoZXIgc291cmNlcyAoZS5nLiwgaW1wbGVtZW50ZWQgYnkgcHJpbWl0aXZlcykuCiAgICovCiAgdXBkYXRlQ29tcG9uZW50czogewogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGRhdGE7CiAgICAgIHZhciBleHRyYUNvbXBvbmVudHM7CiAgICAgIHZhciBpOwogICAgICB2YXIgbmFtZTsKICAgICAgdmFyIGNvbXBvbmVudHNUb1VwZGF0ZSA9IHRoaXMuY29tcG9uZW50c1RvVXBkYXRlOwoKICAgICAgaWYgKCF0aGlzLmhhc0xvYWRlZCkgeyByZXR1cm47IH0KCiAgICAgIC8vIEdhdGhlciBtaXhpbi1kZWZpbmVkIGNvbXBvbmVudHMuCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLm1peGluRWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChuYW1lIGluIHRoaXMubWl4aW5FbHNbaV0uY29tcG9uZW50Q2FjaGUpIHsKICAgICAgICAgIGlmIChpc0NvbXBvbmVudChuYW1lKSkgeyBjb21wb25lbnRzVG9VcGRhdGVbbmFtZV0gPSB0cnVlOyB9CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBHYXRoZXIgZnJvbSBleHRyYSBpbml0aWFsIGNvbXBvbmVudCBkYXRhIGlmIGRlZmluZWQgKGUuZy4sIHByaW1pdGl2ZXMpLgogICAgICBpZiAodGhpcy5nZXRFeHRyYUNvbXBvbmVudHMpIHsKICAgICAgICBleHRyYUNvbXBvbmVudHMgPSB0aGlzLmdldEV4dHJhQ29tcG9uZW50cygpOwogICAgICAgIGZvciAobmFtZSBpbiBleHRyYUNvbXBvbmVudHMpIHsKICAgICAgICAgIGlmIChpc0NvbXBvbmVudChuYW1lKSkgeyBjb21wb25lbnRzVG9VcGRhdGVbbmFtZV0gPSB0cnVlOyB9CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBHYXRoZXIgZW50aXR5LWRlZmluZWQgY29tcG9uZW50cy4KICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuYXR0cmlidXRlcy5sZW5ndGg7ICsraSkgewogICAgICAgIG5hbWUgPSB0aGlzLmF0dHJpYnV0ZXNbaV0ubmFtZTsKICAgICAgICBpZiAoT0JKRUNUM0RfQ09NUE9ORU5UUy5pbmRleE9mKG5hbWUpICE9PSAtMSkgeyBjb250aW51ZTsgfQogICAgICAgIGlmIChpc0NvbXBvbmVudChuYW1lKSkgeyBjb21wb25lbnRzVG9VcGRhdGVbbmFtZV0gPSB0cnVlOyB9CiAgICAgIH0KCiAgICAgIC8vIG9iamVjdDNEIGNvbXBvbmVudHMgZmlyc3QgKHBvc2l0aW9uLCByb3RhdGlvbiwgc2NhbGUsIHZpc2libGUpLgogICAgICBmb3IgKGkgPSAwOyBpIDwgT0JKRUNUM0RfQ09NUE9ORU5UUy5sZW5ndGg7IGkrKykgewogICAgICAgIG5hbWUgPSBPQkpFQ1QzRF9DT01QT05FTlRTW2ldOwogICAgICAgIGlmICghdGhpcy5oYXNBdHRyaWJ1dGUobmFtZSkpIHsgY29udGludWU7IH0KICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudChuYW1lLCB0aGlzLmdldERPTUF0dHJpYnV0ZShuYW1lKSk7CiAgICAgIH0KCiAgICAgIC8vIEluaXRpYWxpemUgb3IgdXBkYXRlIHJlc3Qgb2YgY29tcG9uZW50cy4KICAgICAgZm9yIChuYW1lIGluIGNvbXBvbmVudHNUb1VwZGF0ZSkgewogICAgICAgIGRhdGEgPSBtZXJnZUNvbXBvbmVudERhdGEodGhpcy5nZXRET01BdHRyaWJ1dGUobmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYUNvbXBvbmVudHMgJiYgZXh0cmFDb21wb25lbnRzW25hbWVdKTsKICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudChuYW1lLCBkYXRhKTsKICAgICAgICBkZWxldGUgY29tcG9uZW50c1RvVXBkYXRlW25hbWVdOwogICAgICB9CiAgICB9LAogICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogIH0sCgogIC8qKgogICAqIEluaXRpYWxpemUsIHVwZGF0ZSwgb3IgcmVtb3ZlIGEgc2luZ2xlIGNvbXBvbmVudC4KICAgKgogICAqIFdoZW4gaW5pdGlhbGl6aW5nLCB3ZSBzZXQgdGhlIGNvbXBvbmVudCBvbiBgdGhpcy5jb21wb25lbnRzYC4KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyIC0gQ29tcG9uZW50IG5hbWUuCiAgICogQHBhcmFtIHtvYmplY3R9IGF0dHJWYWx1ZSAtIFZhbHVlIG9mIHRoZSBET00gYXR0cmlidXRlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gY2xvYmJlciAtIElmIG5ldyBhdHRyVmFsdWUgY29tcGxldGVseSByZXBsYWNlcyBwcmV2aW91cyBwcm9wZXJ0aWVzLgogICAqLwogIHVwZGF0ZUNvbXBvbmVudDogewogICAgdmFsdWU6IGZ1bmN0aW9uIChhdHRyLCBhdHRyVmFsdWUsIGNsb2JiZXIpIHsKICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50c1thdHRyXTsKCiAgICAgIGlmIChjb21wb25lbnQpIHsKICAgICAgICAvLyBSZW1vdmUgY29tcG9uZW50LgogICAgICAgIGlmIChhdHRyVmFsdWUgPT09IG51bGwgJiYgIWNoZWNrQ29tcG9uZW50RGVmaW5lZCh0aGlzLCBhdHRyKSkgewogICAgICAgICAgdGhpcy5yZW1vdmVDb21wb25lbnQoYXR0ciwgdHJ1ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIENvbXBvbmVudCBhbHJlYWR5IGluaXRpYWxpemVkLiBVcGRhdGUgY29tcG9uZW50LgogICAgICAgIGNvbXBvbmVudC51cGRhdGVQcm9wZXJ0aWVzKGF0dHJWYWx1ZSwgY2xvYmJlcik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBDb21wb25lbnQgbm90IHlldCBpbml0aWFsaXplZC4gSW5pdGlhbGl6ZSBjb21wb25lbnQuCiAgICAgIHRoaXMuaW5pdENvbXBvbmVudChhdHRyLCBhdHRyVmFsdWUsIGZhbHNlKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBJZiBgYXR0cmAgaXMgYSBjb21wb25lbnQgbmFtZSwgZGV0YWNoIHRoZSBjb21wb25lbnQgZnJvbSB0aGUgZW50aXR5LgogICAqCiAgICogSWYgYHByb3BlcnR5TmFtZWAgaXMgZ2l2ZW4sIHJlc2V0IHRoZSBjb21wb25lbnQgcHJvcGVydHkgdmFsdWUgdG8gaXRzIGRlZmF1bHQuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gYXR0ciAtIEF0dHJpYnV0ZSBuYW1lLCB3aGljaCBjb3VsZCBhbHNvIGJlIGEgY29tcG9uZW50IG5hbWUuCiAgICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5TmFtZSAtIENvbXBvbmVudCBwcm9wIG5hbWUsIGlmIHJlc2V0dGluZyBhbiBpbmRpdmlkdWFsIHByb3AuCiAgICovCiAgcmVtb3ZlQXR0cmlidXRlOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIHByb3BlcnR5TmFtZSkgewogICAgICB2YXIgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2F0dHJdOwoKICAgICAgLy8gUmVtb3ZlIGNvbXBvbmVudC4KICAgICAgaWYgKGNvbXBvbmVudCAmJiBwcm9wZXJ0eU5hbWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucmVtb3ZlQ29tcG9uZW50KGF0dHIsIHRydWUpOwogICAgICB9CgogICAgICAvLyBSZXNldCBjb21wb25lbnQgcHJvcGVydHkgdmFsdWUuCiAgICAgIGlmIChjb21wb25lbnQgJiYgcHJvcGVydHlOYW1lICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjb21wb25lbnQucmVzZXRQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gUmVtb3ZlIG1peGlucy4KICAgICAgaWYgKGF0dHIgPT09ICdtaXhpbicpIHsKICAgICAgICB0aGlzLm1peGluVXBkYXRlKCcnKTsKICAgICAgfQoKICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBTdGFydCBkeW5hbWljIGJlaGF2aW9yIGFzc29jaWF0ZWQgd2l0aCBlbnRpdHkgc3VjaCBhcyBkeW5hbWljIGNvbXBvbmVudHMgYW5kIGFuaW1hdGlvbnMuCiAgICogVGVsbCBhbGwgY2hpbGRyZW4gZW50aXRpZXMgdG8gYWxzbyBwbGF5LgogICAqLwogIHBsYXk6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlbnRpdGllczsKICAgICAgdmFyIGk7CiAgICAgIHZhciBrZXk7CgogICAgICAvLyBBbHJlYWR5IHBsYXlpbmcuCiAgICAgIGlmICh0aGlzLmlzUGxheWluZyB8fCAhdGhpcy5oYXNMb2FkZWQpIHsgcmV0dXJuOyB9CiAgICAgIHRoaXMuaXNQbGF5aW5nID0gdHJ1ZTsKCiAgICAgIC8vIFdha2UgdXAgYWxsIGNvbXBvbmVudHMuCiAgICAgIGZvciAoa2V5IGluIHRoaXMuY29tcG9uZW50cykgeyB0aGlzLmNvbXBvbmVudHNba2V5XS5wbGF5KCk7IH0KCiAgICAgIC8vIFRlbGwgYWxsIGNoaWxkIGVudGl0aWVzIHRvIHBsYXkuCiAgICAgIGVudGl0aWVzID0gdGhpcy5nZXRDaGlsZEVudGl0aWVzKCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBlbnRpdGllcy5sZW5ndGg7IGkrKykgeyBlbnRpdGllc1tpXS5wbGF5KCk7IH0KCiAgICAgIHRoaXMuZW1pdCgncGxheScpOwogICAgfSwKICAgIHdyaXRhYmxlOiB0cnVlCiAgfSwKCiAgLyoqCiAgICogUGF1c2UgZHluYW1pYyBiZWhhdmlvciBhc3NvY2lhdGVkIHdpdGggZW50aXR5IHN1Y2ggYXMgZHluYW1pYyBjb21wb25lbnRzIGFuZCBhbmltYXRpb25zLgogICAqIFRlbGwgYWxsIGNoaWxkcmVuIGVudGl0aWVzIHRvIGFsc28gcGF1c2UuCiAgICovCiAgcGF1c2U6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlbnRpdGllczsKICAgICAgdmFyIGk7CiAgICAgIHZhciBrZXk7CgogICAgICBpZiAoIXRoaXMuaXNQbGF5aW5nKSB7IHJldHVybjsgfQogICAgICB0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoKICAgICAgLy8gU2xlZXAgYWxsIGNvbXBvbmVudHMuCiAgICAgIGZvciAoa2V5IGluIHRoaXMuY29tcG9uZW50cykgeyB0aGlzLmNvbXBvbmVudHNba2V5XS5wYXVzZSgpOyB9CgogICAgICAvLyBUZWxsIGFsbCBjaGlsZCBlbnRpdGllcyB0byBwYXVzZS4KICAgICAgZW50aXRpZXMgPSB0aGlzLmdldENoaWxkRW50aXRpZXMoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IGVudGl0aWVzLmxlbmd0aDsgaSsrKSB7IGVudGl0aWVzW2ldLnBhdXNlKCk7IH0KCiAgICAgIHRoaXMuZW1pdCgncGF1c2UnKTsKICAgIH0sCiAgICB3cml0YWJsZTogdHJ1ZQogIH0sCgogIC8qKgogICAqIERlYWxzIHdpdGggdXBkYXRlcyBvbiBlbnRpdHktc3BlY2lmaWMgYXR0cmlidXRlcyAoaS5lLiwgY29tcG9uZW50cyBhbmQgbWl4aW5zKS4KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyCiAgICogQHBhcmFtIHtzdHJpbmd9IG9sZFZhbAogICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gbmV3VmFsCiAgICovCiAgc2V0RW50aXR5QXR0cmlidXRlOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIG9sZFZhbCwgbmV3VmFsKSB7CiAgICAgIGlmIChDT01QT05FTlRTW2F0dHJdIHx8IHRoaXMuY29tcG9uZW50c1thdHRyXSkgewogICAgICAgIHRoaXMudXBkYXRlQ29tcG9uZW50KGF0dHIsIG5ld1ZhbCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChhdHRyID09PSAnbWl4aW4nKSB7CiAgICAgICAgLy8gSWdub3JlIGlmIGA8YS1ub2RlPmAgY29kZSBpcyBqdXN0IHVwZGF0aW5nIGNvbXB1dGVkIG1peGluIGluIHRoZSBET00uCiAgICAgICAgaWYgKG5ld1ZhbCA9PT0gdGhpcy5jb21wdXRlZE1peGluU3RyKSB7IHJldHVybjsgfQogICAgICAgIHRoaXMubWl4aW5VcGRhdGUobmV3VmFsLCBvbGRWYWwpOwogICAgICB9CiAgICB9CiAgfSwKCiAgLyoqCiAgICogV2hlbiBtaXhpbnMgdXBkYXRlZCwgdHJpZ2dlciBpbml0IG9yIG9wdGltaXplZC11cGRhdGUgb2YgcmVsZXZhbnQgY29tcG9uZW50cy4KICAgKi8KICBtaXhpblVwZGF0ZTogewogICAgdmFsdWU6IChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjb21wb25lbnRzVXBkYXRlZCA9IFtdOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuZXdNaXhpbnMsIG9sZE1peGlucykgewogICAgICAgIHZhciBjb21wb25lbnQ7CiAgICAgICAgdmFyIG1peGluRWw7CiAgICAgICAgdmFyIG1peGluSWRzOwogICAgICAgIHZhciBpOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgaWYgKCF0aGlzLmhhc0xvYWRlZCkgewogICAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHNlbGYubWl4aW5VcGRhdGUobmV3TWl4aW5zLCBvbGRNaXhpbnMpOwogICAgICAgICAgfSwgT05DRSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBvbGRNaXhpbnMgPSBvbGRNaXhpbnMgfHwgdGhpcy5nZXRBdHRyaWJ1dGUoJ21peGluJyk7CiAgICAgICAgbWl4aW5JZHMgPSB0aGlzLnVwZGF0ZU1peGlucyhuZXdNaXhpbnMsIG9sZE1peGlucyk7CgogICAgICAgIC8vIExvb3Agb3ZlciBjdXJyZW50IG1peGlucy4KICAgICAgICBjb21wb25lbnRzVXBkYXRlZC5sZW5ndGggPSAwOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLm1peGluRWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBmb3IgKGNvbXBvbmVudCBpbiB0aGlzLm1peGluRWxzW2ldLmNvbXBvbmVudENhY2hlKSB7CiAgICAgICAgICAgIGlmIChjb21wb25lbnRzVXBkYXRlZC5pbmRleE9mKGNvbXBvbmVudCkgPT09IC0xKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50c1tjb21wb25lbnRdKSB7CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUuIEp1c3QgcmVidWlsZCBkYXRhLgogICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnRzW2NvbXBvbmVudF0uaGFuZGxlTWl4aW5VcGRhdGUoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSW5pdC4gYnVpbGREYXRhIHdpbGwgZ2F0aGVyIG1peGluIHZhbHVlcy4KICAgICAgICAgICAgICAgIHRoaXMuaW5pdENvbXBvbmVudChjb21wb25lbnQsIG51bGwpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb21wb25lbnRzVXBkYXRlZC5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIExvb3Agb3ZlciBvbGQgbWl4aW5zIHRvIGNhbGwgZm9yIGRhdGEgcmVidWlsZC4KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbWl4aW5JZHMub2xkTWl4aW5JZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG1peGluRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtaXhpbklkcy5vbGRNaXhpbklkc1tpXSk7CiAgICAgICAgICBpZiAoIW1peGluRWwpIHsgY29udGludWU7IH0KICAgICAgICAgIGZvciAoY29tcG9uZW50IGluIG1peGluRWwuY29tcG9uZW50Q2FjaGUpIHsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudHNVcGRhdGVkLmluZGV4T2YoY29tcG9uZW50KSA9PT0gLTEpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5jb21wb25lbnRzW2NvbXBvbmVudF0pIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldERPTUF0dHJpYnV0ZShjb21wb25lbnQpKSB7CiAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBjb21wb25lbnQgaWYgZXhwbGljaXRseSBkZWZpbmVkLgogICAgICAgICAgICAgICAgICB0aGlzLmNvbXBvbmVudHNbY29tcG9uZW50XS5oYW5kbGVNaXhpblVwZGF0ZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGNvbXBvbmVudCBpZiBub3QgZXhwbGljaXRseSBkZWZpbmVkLgogICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNvbXBvbmVudChjb21wb25lbnQsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0pKCkKICB9LAoKICAvKioKICAgKiBzZXRBdHRyaWJ1dGUgY2FuOgogICAqCiAgICogMS4gU2V0IGEgc2luZ2xlIHByb3BlcnR5IG9mIGEgbXVsdGktcHJvcGVydHkgY29tcG9uZW50LgogICAqIDIuIFNldCBtdWx0aXBsZSBwcm9wZXJ0aWVzIG9mIGEgbXVsdGktcHJvcGVydHkgY29tcG9uZW50LgogICAqIDMuIFJlcGxhY2UgcHJvcGVydGllcyBvZiBhIG11bHRpLXByb3BlcnR5IGNvbXBvbmVudC4KICAgKiA0LiBTZXQgYSB2YWx1ZSBmb3IgYSBzaW5nbGUtcHJvcGVydHkgY29tcG9uZW50LCBtaXhpbiwgb3Igbm9ybWFsIEhUTUwgYXR0cmlidXRlLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGF0dHJOYW1lIC0gQ29tcG9uZW50IG9yIGF0dHJpYnV0ZSBuYW1lLgogICAqIEBwYXJhbSB7Kn0gYXJnMSAtIENhbiBiZSBhIHZhbHVlLCBwcm9wZXJ0eSBuYW1lLCBDU1Mtc3R5bGUgcHJvcGVydHkgc3RyaW5nLCBvcgogICAqICAgb2JqZWN0IG9mIHByb3BlcnRpZXMuCiAgICogQHBhcmFtIHsqfGJvb2x9IGFyZzIgLSBJZiBhcmcxIGlzIGEgcHJvcGVydHkgbmFtZSwgdGhpcyBzaG91bGQgYmUgYSB2YWx1ZS4gT3RoZXJ3aXNlLAogICAqICAgaXQgaXMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0byBjbG9iYmVyIHByZXZpb3VzIHZhbHVlcyAoZGVmYXVsdHMgdG8gZmFsc2UpLgogICAqLwogIHNldEF0dHJpYnV0ZTogewogICAgdmFsdWU6IChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzaW5nbGVQcm9wVXBkYXRlID0ge307CgogICAgICByZXR1cm4gZnVuY3Rpb24gKGF0dHJOYW1lLCBhcmcxLCBhcmcyKSB7CiAgICAgICAgdmFyIG5ld0F0dHJWYWx1ZTsKICAgICAgICB2YXIgY2xvYmJlcjsKICAgICAgICB2YXIgY29tcG9uZW50TmFtZTsKICAgICAgICB2YXIgZGVsaW1pdGVySW5kZXg7CiAgICAgICAgdmFyIGlzRGVidWdNb2RlOwogICAgICAgIHZhciBrZXk7CgogICAgICAgIGRlbGltaXRlckluZGV4ID0gYXR0ck5hbWUuaW5kZXhPZihNVUxUSVBMRV9DT01QT05FTlRfREVMSU1JVEVSKTsKICAgICAgICBjb21wb25lbnROYW1lID0gZGVsaW1pdGVySW5kZXggPiAwID8gYXR0ck5hbWUuc3Vic3RyaW5nKDAsIGRlbGltaXRlckluZGV4KSA6IGF0dHJOYW1lOwoKICAgICAgICAvLyBOb3QgYSBjb21wb25lbnQuIE5vcm1hbCBzZXQgYXR0cmlidXRlLgogICAgICAgIGlmICghQ09NUE9ORU5UU1tjb21wb25lbnROYW1lXSkgewogICAgICAgICAgaWYgKGF0dHJOYW1lID09PSAnbWl4aW4nKSB7IHRoaXMubWl4aW5VcGRhdGUoYXJnMSk7IH0KICAgICAgICAgIEFOb2RlLnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyTmFtZSwgYXJnMSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBJbml0aWFsaXplIGNvbXBvbmVudCBmaXJzdCBpZiBub3QgeWV0IGluaXRpYWxpemVkLgogICAgICAgIGlmICghdGhpcy5jb21wb25lbnRzW2F0dHJOYW1lXSAmJiB0aGlzLmhhc0F0dHJpYnV0ZShhdHRyTmFtZSkpIHsKICAgICAgICAgIHRoaXMudXBkYXRlQ29tcG9uZW50KAogICAgICAgICAgICBhdHRyTmFtZSwKICAgICAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyTmFtZSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gRGV0ZXJtaW5lIG5ldyBhdHRyaWJ1dGVzIGZyb20gdGhlIGFyZ3VtZW50cwogICAgICAgIGlmICh0eXBlb2YgYXJnMiAhPT0gJ3VuZGVmaW5lZCcgJiYKICAgICAgICAgICAgdHlwZW9mIGFyZzEgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgIGFyZzEubGVuZ3RoID4gMCAmJgogICAgICAgICAgICB0eXBlb2YgdXRpbHMuc3R5bGVQYXJzZXIucGFyc2UoYXJnMSkgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAvLyBVcGRhdGUgYSBzaW5nbGUgcHJvcGVydHkgb2YgYSBtdWx0aS1wcm9wZXJ0eSBjb21wb25lbnQKICAgICAgICAgIGZvciAoa2V5IGluIHNpbmdsZVByb3BVcGRhdGUpIHsgZGVsZXRlIHNpbmdsZVByb3BVcGRhdGVba2V5XTsgfQogICAgICAgICAgbmV3QXR0clZhbHVlID0gc2luZ2xlUHJvcFVwZGF0ZTsKICAgICAgICAgIG5ld0F0dHJWYWx1ZVthcmcxXSA9IGFyZzI7CiAgICAgICAgICBjbG9iYmVyID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFVwZGF0ZSB3aXRoIGEgdmFsdWUsIG9iamVjdCwgb3IgQ1NTLXN0eWxlIHByb3BlcnR5IHN0cmluZywgd2l0aCB0aGUgcG9zc2libGl0eQogICAgICAgICAgLy8gb2YgY2xvYmJlcmluZyBwcmV2aW91cyB2YWx1ZXMuCiAgICAgICAgICBuZXdBdHRyVmFsdWUgPSBhcmcxOwogICAgICAgICAgY2xvYmJlciA9IChhcmcyID09PSB0cnVlKTsKICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSBjb21wb25lbnQKICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudChhdHRyTmFtZSwgbmV3QXR0clZhbHVlLCBjbG9iYmVyKTsKCiAgICAgICAgLy8gSW4gZGVidWcgbW9kZSwgd3JpdGUgY29tcG9uZW50IGRhdGEgdXAgdG8gdGhlIERPTS4KICAgICAgICBpc0RlYnVnTW9kZSA9IHRoaXMuc2NlbmVFbCAmJiB0aGlzLnNjZW5lRWwuZ2V0QXR0cmlidXRlKCdkZWJ1ZycpOwogICAgICAgIGlmIChpc0RlYnVnTW9kZSkgeyB0aGlzLmNvbXBvbmVudHNbYXR0ck5hbWVdLmZsdXNoVG9ET00oKTsgfQogICAgICB9OwogICAgfSkoKSwKICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICB9LAoKICAvKioKICAgKiBSZWZsZWN0IGNvbXBvbmVudCBkYXRhIGluIHRoZSBET00gKGFzIHNlZW4gZnJvbSB0aGUgYnJvd3NlciBET00gSW5zcGVjdG9yKS4KICAgKgogICAqIEBwYXJhbSB7Ym9vbH0gcmVjdXJzaXZlIC0gQWxzbyBmbHVzaFRvRE9NIG9uIHRoZSBjaGlsZHJlbi4KICAgKiovCiAgZmx1c2hUb0RPTTogewogICAgdmFsdWU6IGZ1bmN0aW9uIChyZWN1cnNpdmUpIHsKICAgICAgdmFyIGNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHM7CiAgICAgIHZhciBjaGlsZDsKICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgdmFyIGk7CiAgICAgIHZhciBrZXk7CgogICAgICAvLyBGbHVzaCBlbnRpdHkncyBjb21wb25lbnRzIHRvIERPTS4KICAgICAgZm9yIChrZXkgaW4gY29tcG9uZW50cykgewogICAgICAgIGNvbXBvbmVudHNba2V5XS5mbHVzaFRvRE9NKCk7CiAgICAgIH0KCiAgICAgIC8vIFJlY3Vyc2UuCiAgICAgIGlmICghcmVjdXJzaXZlKSB7IHJldHVybjsgfQogICAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICBjaGlsZCA9IGNoaWxkcmVuW2ldOwogICAgICAgIGlmICghY2hpbGQuZmx1c2hUb0RPTSkgeyBjb250aW51ZTsgfQogICAgICAgIGNoaWxkLmZsdXNoVG9ET00ocmVjdXJzaXZlKTsKICAgICAgfQogICAgfQogIH0sCgogIC8qKgogICAqIElmIGBhdHRyYCBpcyBhIGNvbXBvbmVudCwgcmV0dXJucyBBTEwgY29tcG9uZW50IGRhdGEgaW5jbHVkaW5nIGFwcGxpZWQgbWl4aW5zIGFuZAogICAqIGRlZmF1bHRzLgogICAqCiAgICogSWYgYGF0dHJgIGlzIG5vdCBhIGNvbXBvbmVudCwgZmFsbCBiYWNrIHRvIEhUTUwgZ2V0QXR0cmlidXRlLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGF0dHIKICAgKiBAcmV0dXJucyB7b2JqZWN0fHN0cmluZ30gT2JqZWN0IGlmIGNvbXBvbmVudCwgZWxzZSBzdHJpbmcuCiAgICovCiAgZ2V0QXR0cmlidXRlOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgLy8gSWYgY29tcG9uZW50LCByZXR1cm4gY29tcG9uZW50IGRhdGEuCiAgICAgIHZhciBjb21wb25lbnQ7CiAgICAgIGlmIChhdHRyID09PSAncG9zaXRpb24nKSB7IHJldHVybiB0aGlzLm9iamVjdDNELnBvc2l0aW9uOyB9CiAgICAgIGlmIChhdHRyID09PSAncm90YXRpb24nKSB7IHJldHVybiBnZXRSb3RhdGlvbih0aGlzKTsgfQogICAgICBpZiAoYXR0ciA9PT0gJ3NjYWxlJykgeyByZXR1cm4gdGhpcy5vYmplY3QzRC5zY2FsZTsgfQogICAgICBpZiAoYXR0ciA9PT0gJ3Zpc2libGUnKSB7IHJldHVybiB0aGlzLm9iamVjdDNELnZpc2libGU7IH0KICAgICAgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2F0dHJdOwogICAgICBpZiAoY29tcG9uZW50KSB7IHJldHVybiBjb21wb25lbnQuZGF0YTsgfQogICAgICByZXR1cm4gd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyKTsKICAgIH0sCiAgICB3cml0YWJsZTogd2luZG93LmRlYnVnCiAgfSwKCiAgLyoqCiAgICogSWYgYGF0dHJgIGlzIGEgY29tcG9uZW50LCByZXR1cm5zIEpVU1QgdGhlIGNvbXBvbmVudCBkYXRhIGRlZmluZWQgb24gdGhlIGVudGl0eS4KICAgKiBMaWtlIGEgcGFydGlhbCB2ZXJzaW9uIG9mIGBnZXRDb21wdXRlZEF0dHJpYnV0ZWAgYXMgcmV0dXJuZWQgY29tcG9uZW50IGRhdGEKICAgKiBkb2VzIG5vdCBpbmNsdWRlIGFwcGxpZWQgbWl4aW5zIG9yIGRlZmF1bHRzLgogICAqCiAgICogSWYgYGF0dHJgIGlzIG5vdCBhIGNvbXBvbmVudCwgZmFsbCBiYWNrIHRvIEhUTUwgZ2V0QXR0cmlidXRlLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGF0dHIKICAgKiBAcmV0dXJucyB7b2JqZWN0fHN0cmluZ30gT2JqZWN0IGlmIGNvbXBvbmVudCwgZWxzZSBzdHJpbmcuCiAgICovCiAgZ2V0RE9NQXR0cmlidXRlOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgLy8gSWYgY2FjaGVkIHZhbHVlIGV4aXN0cywgcmV0dXJuIHBhcnRpYWwgY29tcG9uZW50IGRhdGEuCiAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzLmNvbXBvbmVudHNbYXR0cl07CiAgICAgIGlmIChjb21wb25lbnQpIHsgcmV0dXJuIGNvbXBvbmVudC5hdHRyVmFsdWU7IH0KICAgICAgcmV0dXJuIHdpbmRvdy5IVE1MRWxlbWVudC5wcm90b3R5cGUuZ2V0QXR0cmlidXRlLmNhbGwodGhpcywgYXR0cik7CiAgICB9LAogICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogIH0sCgogIGFkZFN0YXRlOiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKHN0YXRlKSB7CiAgICAgIGlmICh0aGlzLmlzKHN0YXRlKSkgeyByZXR1cm47IH0KICAgICAgdGhpcy5zdGF0ZXMucHVzaChzdGF0ZSk7CiAgICAgIHRoaXMuZW1pdCgnc3RhdGVhZGRlZCcsIHN0YXRlKTsKICAgIH0KICB9LAoKICByZW1vdmVTdGF0ZTogewogICAgdmFsdWU6IGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICB2YXIgc3RhdGVJbmRleCA9IHRoaXMuc3RhdGVzLmluZGV4T2Yoc3RhdGUpOwogICAgICBpZiAoc3RhdGVJbmRleCA9PT0gLTEpIHsgcmV0dXJuOyB9CiAgICAgIHRoaXMuc3RhdGVzLnNwbGljZShzdGF0ZUluZGV4LCAxKTsKICAgICAgdGhpcy5lbWl0KCdzdGF0ZXJlbW92ZWQnLCBzdGF0ZSk7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogQ2hlY2tzIGlmIHRoZSBlbGVtZW50IGlzIGluIGEgZ2l2ZW4gc3RhdGUuIGUuZy4gZWwuaXMoJ2FsaXZlJyk7CiAgICogQHR5cGUge3N0cmluZ30gc3RhdGUgLSBOYW1lIG9mIHRoZSBzdGF0ZSB3ZSB3YW50IHRvIGNoZWNrCiAgICovCiAgaXM6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGVzLmluZGV4T2Yoc3RhdGUpICE9PSAtMTsKICAgIH0KICB9LAoKICAvKioKICAgKiBPcGVuIEluc3BlY3RvciB0byB0aGlzIGVudGl0eS4KICAgKi8KICBpbnNwZWN0OiB7CiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnNjZW5lRWwuY29tcG9uZW50cy5pbnNwZWN0b3Iub3Blbkluc3BlY3Rvcih0aGlzKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBDbGVhbiB1cCBtZW1vcnkgYW5kIHJldHVybiBtZW1vcnkgdG8gb2JqZWN0IHBvb2xzLgogICAqLwogIGRlc3Ryb3k6IHsKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBrZXk7CiAgICAgIGlmICh0aGlzLnBhcmVudE5vZGUpIHsKICAgICAgICB3YXJuKCdFbnRpdHkgY2FuIG9ubHkgYmUgZGVzdHJveWVkIGlmIGRldGFjaGVkIGZyb20gc2NlbmVncmFwaC4nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChrZXkgaW4gdGhpcy5jb21wb25lbnRzKSB7CiAgICAgICAgdGhpcy5jb21wb25lbnRzW2tleV0uZGVzdHJveSgpOwogICAgICB9CiAgICB9CiAgfQp9KTsKCi8qKgogKiBDaGVjayBpZiBhIGNvbXBvbmVudCBpcyAqZGVmaW5lZCogZm9yIGFuIGVudGl0eSwgaW5jbHVkaW5nIGRlZmF1bHRzIGFuZCBtaXhpbnMuCiAqIERvZXMgbm90IGNoZWNrIHdoZXRoZXIgdGhlIGNvbXBvbmVudCBoYXMgYmVlbiAqaW5pdGlhbGl6ZWQqIGZvciBhbiBlbnRpdHkuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBlbCAtIEVudGl0eS4KICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBDb21wb25lbnQgbmFtZS4KICogQHJldHVybnMge2Jvb2xlYW59CiAqLwpmdW5jdGlvbiBjaGVja0NvbXBvbmVudERlZmluZWQgKGVsLCBuYW1lKSB7CiAgLy8gQ2hlY2sgaWYgZWxlbWVudCBjb250YWlucyB0aGUgY29tcG9uZW50LgogIGlmIChlbC5jb21wb25lbnRzW25hbWVdICYmIGVsLmNvbXBvbmVudHNbbmFtZV0uYXR0clZhbHVlKSB7IHJldHVybiB0cnVlOyB9CgogIHJldHVybiBpc0NvbXBvbmVudE1peGVkSW4obmFtZSwgZWwubWl4aW5FbHMpOwp9CgovKioKICogQ2hlY2sgaWYgYW55IG1peGlucyBjb250YWlucyBhIGNvbXBvbmVudC4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBDb21wb25lbnQgbmFtZS4KICogQHBhcmFtIHthcnJheX0gbWl4aW5FbHMgLSBBcnJheSBvZiA8YS1taXhpbj5zLgogKi8KZnVuY3Rpb24gaXNDb21wb25lbnRNaXhlZEluIChuYW1lLCBtaXhpbkVscykgewogIHZhciBpOwogIHZhciBpbk1peGluID0gZmFsc2U7CiAgZm9yIChpID0gMDsgaSA8IG1peGluRWxzLmxlbmd0aDsgKytpKSB7CiAgICBpbk1peGluID0gbWl4aW5FbHNbaV0uaGFzQXR0cmlidXRlKG5hbWUpOwogICAgaWYgKGluTWl4aW4pIHsgYnJlYWs7IH0KICB9CiAgcmV0dXJuIGluTWl4aW47Cn0KCi8qKgogKiBHaXZlbiBlbnRpdHkgZGVmaW5lZCB2YWx1ZSwgbWVyZ2UgaW4gZXh0cmEgZGF0YSBpZiBuZWNlc3NhcnkuCiAqIEhhbmRsZSBib3RoIHNpbmdsZSBhbmQgbXVsdGktcHJvcGVydHkgY29tcG9uZW50cy4KICoKICogQHBhcmFtIHtzdHJpbmd9IGF0dHJWYWx1ZSAtIEVudGl0eSBkYXRhLgogKiBAcGFyYW0gZXh0cmFEYXRhIC0gRW50aXR5IGRhdGEgZnJvbSBhbm90aGVyIHNvdXJjZSB0byBtZXJnZSBpbi4KICovCmZ1bmN0aW9uIG1lcmdlQ29tcG9uZW50RGF0YSAoYXR0clZhbHVlLCBleHRyYURhdGEpIHsKICAvLyBFeHRyYSBkYXRhIG5vdCBkZWZpbmVkLCBqdXN0IHJldHVybiBhdHRyVmFsdWUuCiAgaWYgKCFleHRyYURhdGEpIHsgcmV0dXJuIGF0dHJWYWx1ZTsgfQoKICAvLyBNZXJnZSBtdWx0aS1wcm9wZXJ0eSBkYXRhLgogIGlmIChleHRyYURhdGEuY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgcmV0dXJuIHV0aWxzLmV4dGVuZChleHRyYURhdGEsIHV0aWxzLnN0eWxlUGFyc2VyLnBhcnNlKGF0dHJWYWx1ZSB8fCB7fSkpOwogIH0KCiAgLy8gUmV0dXJuIGRhdGEsIHByZWNlbmRlbmNlIHRvIHRoZSBkZWZpbmVkIHZhbHVlLgogIHJldHVybiBhdHRyVmFsdWUgfHwgZXh0cmFEYXRhOwp9CgpmdW5jdGlvbiBpc0NvbXBvbmVudCAoY29tcG9uZW50TmFtZSkgewogIGlmIChjb21wb25lbnROYW1lLmluZGV4T2YoTVVMVElQTEVfQ09NUE9ORU5UX0RFTElNSVRFUikgIT09IC0xKSB7CiAgICBjb21wb25lbnROYW1lID0gdXRpbHMuc3BsaXQoY29tcG9uZW50TmFtZSwgTVVMVElQTEVfQ09NUE9ORU5UX0RFTElNSVRFUilbMF07CiAgfQogIGlmICghQ09NUE9ORU5UU1tjb21wb25lbnROYW1lXSkgeyByZXR1cm4gZmFsc2U7IH0KICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0Um90YXRpb24gKGVudGl0eUVsKSB7CiAgdmFyIHJhZFRvRGVnID0gVEhSRUUuTWF0aC5yYWRUb0RlZzsKICB2YXIgcm90YXRpb24gPSBlbnRpdHlFbC5vYmplY3QzRC5yb3RhdGlvbjsKICB2YXIgcm90YXRpb25PYmogPSBlbnRpdHlFbC5yb3RhdGlvbk9iajsKICByb3RhdGlvbk9iai54ID0gcmFkVG9EZWcocm90YXRpb24ueCk7CiAgcm90YXRpb25PYmoueSA9IHJhZFRvRGVnKHJvdGF0aW9uLnkpOwogIHJvdGF0aW9uT2JqLnogPSByYWRUb0RlZyhyb3RhdGlvbi56KTsKICByZXR1cm4gcm90YXRpb25PYmo7Cn0KCkFFbnRpdHkgPSByZWdpc3RlckVsZW1lbnQoJ2EtZW50aXR5Jywge3Byb3RvdHlwZTogcHJvdG99KTsKbW9kdWxlLmV4cG9ydHMgPSBBRW50aXR5OwoKfSx7Ii4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy8iOjE3OSwiLi9hLW5vZGUiOjEwNCwiLi9hLXJlZ2lzdGVyLWVsZW1lbnQiOjEwNSwiLi9jb21wb25lbnQiOjEwNn1dLDEwMzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBBTm9kZSA9IF9kZXJlcV8oJy4vYS1ub2RlJyk7CnZhciByZWdpc3RlckVsZW1lbnQgPSBfZGVyZXFfKCcuL2EtcmVnaXN0ZXItZWxlbWVudCcpLnJlZ2lzdGVyRWxlbWVudDsKdmFyIGNvbXBvbmVudHMgPSBfZGVyZXFfKCcuL2NvbXBvbmVudCcpLmNvbXBvbmVudHM7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzJyk7Cgp2YXIgTVVMVElQTEVfQ09NUE9ORU5UX0RFTElNSVRFUiA9ICdfXyc7CgovKioKICogQG1lbWJlciB7b2JqZWN0fSBjb21wb25lbnRDYWNoZSAtIENhY2hlIG9mIHByZS1wYXJzZWQgdmFsdWVzLiBBbiBvYmplY3Qgd2hlcmUgdGhlIGtleXMKICogICAgICAgICBhcmUgY29tcG9uZW50IG5hbWVzIGFuZCB0aGUgdmFsdWVzIGFyZSBhbHJlYWR5IHBhcnNlZCBieSB0aGUgY29tcG9uZW50LgogKi8KbW9kdWxlLmV4cG9ydHMgPSByZWdpc3RlckVsZW1lbnQoJ2EtbWl4aW4nLCB7CiAgcHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKEFOb2RlLnByb3RvdHlwZSwgewogICAgY3JlYXRlZENhbGxiYWNrOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jb21wb25lbnRDYWNoZSA9IHt9OwogICAgICAgIHRoaXMuaWQgPSB0aGlzLmdldEF0dHJpYnV0ZSgnaWQnKTsKICAgICAgICB0aGlzLmlzTWl4aW4gPSB0cnVlOwogICAgICB9CiAgICB9LAoKICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIG9sZFZhbCwgbmV3VmFsKSB7CiAgICAgICAgdGhpcy5jYWNoZUF0dHJpYnV0ZShhdHRyLCBuZXdWYWwpOwogICAgICAgIHRoaXMudXBkYXRlRW50aXRpZXMoKTsKICAgICAgfQogICAgfSwKCiAgICBhdHRhY2hlZENhbGxiYWNrOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5zY2VuZUVsID0gdGhpcy5jbG9zZXN0U2NlbmUoKTsKICAgICAgICB0aGlzLmNhY2hlQXR0cmlidXRlcygpOwogICAgICAgIHRoaXMudXBkYXRlRW50aXRpZXMoKTsKICAgICAgICB0aGlzLmxvYWQoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIHNldEF0dHJpYnV0ZSB0aGF0IHBhcnNlcyBhbmQgY2FjaGVzIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAgKi8KICAgIHNldEF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIHZhbHVlKSB7CiAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5jYWNoZUF0dHJpYnV0ZShhdHRyLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBJZiBgYXR0cmAgaXMgYSBjb21wb25lbnQsIHRoZW4gcGFyc2UgdGhlIHZhbHVlIHVzaW5nIHRoZSBzY2hlbWEgYW5kIHN0b3JlIGl0LgogICAgICovCiAgICBjYWNoZUF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIHZhbHVlKSB7CiAgICAgICAgdmFyIGNvbXBvbmVudDsKICAgICAgICB2YXIgY29tcG9uZW50TmFtZTsKCiAgICAgICAgLy8gR2V0IGNvbXBvbmVudCBkYXRhLgogICAgICAgIGNvbXBvbmVudE5hbWUgPSB1dGlscy5zcGxpdChhdHRyLCBNVUxUSVBMRV9DT01QT05FTlRfREVMSU1JVEVSKVswXTsKICAgICAgICBjb21wb25lbnQgPSBjb21wb25lbnRzW2NvbXBvbmVudE5hbWVdOwogICAgICAgIGlmICghY29tcG9uZW50KSB7IHJldHVybjsgfQogICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YWx1ZSA9IHdpbmRvdy5IVE1MRWxlbWVudC5wcm90b3R5cGUuZ2V0QXR0cmlidXRlLmNhbGwodGhpcywgYXR0cik7CiAgICAgICAgfQogICAgICAgIHRoaXMuY29tcG9uZW50Q2FjaGVbYXR0cl0gPSBjb21wb25lbnQucGFyc2VBdHRyVmFsdWVGb3JDYWNoZSh2YWx1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBJZiBgYXR0cmAgaXMgYSBjb21wb25lbnQsIHRoZW4gZ3JhYiBwcmUtcGFyc2VkIHZhbHVlIGZyb20gdGhlIGNhY2hlLgogICAgICogRWxzZSBkbyBhIG5vcm1hbCBnZXRBdHRyaWJ1dGUuCiAgICAgKi8KICAgIGdldEF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRDYWNoZVthdHRyXSB8fAogICAgICAgICAgICAgICB3aW5kb3cuSFRNTEVsZW1lbnQucHJvdG90eXBlLmdldEF0dHJpYnV0ZS5jYWxsKHRoaXMsIGF0dHIpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUGFyc2UgYW5kIGNhY2hlIGV2ZXJ5IGNvbXBvbmVudCBkZWZpbmVkIG9uIHRoZSBtaXhpbi4KICAgICAqLwogICAgY2FjaGVBdHRyaWJ1dGVzOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgICAgdmFyIGF0dHJOYW1lOwogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhdHRyTmFtZSA9IGF0dHJpYnV0ZXNbaV0ubmFtZTsKICAgICAgICAgIHRoaXMuY2FjaGVBdHRyaWJ1dGUoYXR0ck5hbWUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEZvciBlbnRpdGllcyB0aGF0IGFscmVhZHkgaGF2ZSBiZWVuIGxvYWRlZCBieSB0aGUgdGltZSB0aGUgbWl4aW4gd2FzIGF0dGFjaGVkLCB0ZWxsCiAgICAgKiB0aG9zZSBlbnRpdGllcyB0byByZWdpc3RlciB0aGUgbWl4aW4gYW5kIHJlZnJlc2ggdGhlaXIgY29tcG9uZW50IGRhdGEuCiAgICAgKi8KICAgIHVwZGF0ZUVudGl0aWVzOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVudGl0eTsKICAgICAgICB2YXIgZW50aXRpZXM7CiAgICAgICAgdmFyIGk7CgogICAgICAgIGlmICghdGhpcy5zY2VuZUVsKSB7IHJldHVybjsgfQoKICAgICAgICBlbnRpdGllcyA9IHRoaXMuc2NlbmVFbC5xdWVyeVNlbGVjdG9yQWxsKCdbbWl4aW5+PScgKyB0aGlzLmlkICsgJ10nKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZW50aXRpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGVudGl0eSA9IGVudGl0aWVzW2ldOwogICAgICAgICAgaWYgKCFlbnRpdHkuaGFzTG9hZGVkIHx8IGVudGl0eS5pc01peGluKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgICBlbnRpdHkubWl4aW5VcGRhdGUodGhpcy5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSkKfSk7Cgp9LHsiLi4vdXRpbHMiOjE3OSwiLi9hLW5vZGUiOjEwNCwiLi9hLXJlZ2lzdGVyLWVsZW1lbnQiOjEwNSwiLi9jb21wb25lbnQiOjEwNn1dLDEwNDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qIGdsb2JhbCBDdXN0b21FdmVudCAqLwp2YXIgcmVnaXN0ZXJFbGVtZW50ID0gX2RlcmVxXygnLi9hLXJlZ2lzdGVyLWVsZW1lbnQnKS5yZWdpc3RlckVsZW1lbnQ7CnZhciBpc05vZGUgPSBfZGVyZXFfKCcuL2EtcmVnaXN0ZXItZWxlbWVudCcpLmlzTm9kZTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7Cgp2YXIgd2FybiA9IHV0aWxzLmRlYnVnKCdjb3JlOmEtbm9kZTp3YXJuJyk7CnZhciBlcnJvciA9IHV0aWxzLmRlYnVnKCdjb3JlOmEtbm9kZTplcnJvcicpOwoKLyoqCiAqIEJhc2UgY2xhc3MgZm9yIEEtRnJhbWUgdGhhdCBtYW5hZ2VzIGxvYWRpbmcgb2Ygb2JqZWN0cy4KICoKICogTm9kZXMgY2FuIGJlIG1vZGlmaWVkIHVzaW5nIG1peGlucy4KICogTm9kZXMgZW1pdCBhIGBsb2FkZWRgIGV2ZW50IHdoZW4gdGhleSBhbmQgdGhlaXIgY2hpbGRyZW4gaGF2ZSBpbml0aWFsaXplZC4KICovCm1vZHVsZS5leHBvcnRzID0gcmVnaXN0ZXJFbGVtZW50KCdhLW5vZGUnLCB7CiAgcHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKHdpbmRvdy5IVE1MRWxlbWVudC5wcm90b3R5cGUsIHsKICAgIGNyZWF0ZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuY29tcHV0ZWRNaXhpblN0ciA9ICcnOwogICAgICAgIHRoaXMuaGFzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc05vZGUgPSB0cnVlOwogICAgICAgIHRoaXMubWl4aW5FbHMgPSBbXTsKICAgICAgfSwKICAgICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogICAgfSwKCiAgICBhdHRhY2hlZENhbGxiYWNrOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG1peGluczsKICAgICAgICB0aGlzLnNjZW5lRWwgPSB0aGlzLmNsb3Nlc3RTY2VuZSgpOwoKICAgICAgICBpZiAoIXRoaXMuc2NlbmVFbCkgewogICAgICAgICAgd2FybignWW91IGFyZSBhdHRlbXB0aW5nIHRvIGF0dGFjaCA8JyArIHRoaXMudGFnTmFtZSArICc+IG91dHNpZGUgb2YgYW4gQS1GcmFtZSAnICsKICAgICAgICAgICAgICAgJ3NjZW5lLiBBcHBlbmQgdGhpcyBlbGVtZW50IHRvIGA8YS1zY2VuZT5gIGluc3RlYWQuJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmhhc0xvYWRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuZW1pdCgnbm9kZXJlYWR5JywgdW5kZWZpbmVkLCBmYWxzZSk7CgogICAgICAgIGlmICghdGhpcy5pc01peGluKSB7CiAgICAgICAgICBtaXhpbnMgPSB0aGlzLmdldEF0dHJpYnV0ZSgnbWl4aW4nKTsKICAgICAgICAgIGlmIChtaXhpbnMpIHsgdGhpcy51cGRhdGVNaXhpbnMobWl4aW5zKTsgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogICAgfSwKCiAgICAvKioKICAgICAqIEhhbmRsZSBtaXhpbi4KICAgICAqLwogICAgYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0ciwgb2xkVmFsLCBuZXdWYWwpIHsKICAgICAgICAvLyBJZ25vcmUgaWYgYDxhLW5vZGU+YCBjb2RlIGlzIGp1c3QgdXBkYXRpbmcgY29tcHV0ZWQgbWl4aW4gaW4gdGhlIERPTS4KICAgICAgICBpZiAobmV3VmFsID09PSB0aGlzLmNvbXB1dGVkTWl4aW5TdHIpIHsgcmV0dXJuOyB9CgogICAgICAgIGlmIChhdHRyID09PSAnbWl4aW4nICYmICF0aGlzLmlzTWl4aW4pIHsKICAgICAgICAgIHRoaXMudXBkYXRlTWl4aW5zKG5ld1ZhbCwgb2xkVmFsKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAvKioKICAgICogUmV0dXJucyB0aGUgZmlyc3Qgc2NlbmUgYnkgdHJhdmVyc2luZyB1cCB0aGUgdHJlZSBzdGFydGluZyBmcm9tIGFuZAogICAgKiBpbmNsdWRpbmcgcmVjZWl2ZXIgZWxlbWVudC4KICAgICovCiAgICBjbG9zZXN0U2NlbmU6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3Nlc3QgKCkgewogICAgICAgIHZhciBlbGVtZW50ID0gdGhpczsKICAgICAgICB3aGlsZSAoZWxlbWVudCkgewogICAgICAgICAgaWYgKGVsZW1lbnQuaXNTY2VuZSkgeyBicmVhazsgfQogICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGZpcnN0IGVsZW1lbnQgbWF0Y2hpbmcgYSBzZWxlY3RvciBieSB0cmF2ZXJzaW5nIHVwIHRoZSB0cmVlIHN0YXJ0aW5nCiAgICAgKiBmcm9tIGFuZCBpbmNsdWRpbmcgcmVjZWl2ZXIgZWxlbWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IgLSBTZWxlY3RvciBvZiBlbGVtZW50IHRvIGZpbmQuCiAgICAgKi8KICAgIGNsb3Nlc3Q6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsb3Nlc3QgKHNlbGVjdG9yKSB7CiAgICAgICAgdmFyIG1hdGNoZXMgPSB0aGlzLm1hdGNoZXMgfHwgdGhpcy5tb3pNYXRjaGVzU2VsZWN0b3IgfHwKICAgICAgICAgIHRoaXMubXNNYXRjaGVzU2VsZWN0b3IgfHwgdGhpcy5vTWF0Y2hlc1NlbGVjdG9yIHx8IHRoaXMud2Via2l0TWF0Y2hlc1NlbGVjdG9yOwogICAgICAgIHZhciBlbGVtZW50ID0gdGhpczsKICAgICAgICB3aGlsZSAoZWxlbWVudCkgewogICAgICAgICAgaWYgKG1hdGNoZXMuY2FsbChlbGVtZW50LCBzZWxlY3RvcikpIHsgYnJlYWs7IH0KICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICB9CiAgICB9LAoKICAgIGRldGFjaGVkQ2FsbGJhY2s6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmhhc0xvYWRlZCA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogV2FpdCBmb3IgY2hpbGRyZW4gdG8gbG9hZCwgaWYgYW55LgogICAgICogVGhlbiBlbWl0IGBsb2FkZWRgIGV2ZW50IGFuZCBzZXQgYGhhc0xvYWRlZGAuCiAgICAgKi8KICAgIGxvYWQ6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uIChjYiwgY2hpbGRGaWx0ZXIpIHsKICAgICAgICB2YXIgY2hpbGRyZW47CiAgICAgICAgdmFyIGNoaWxkcmVuTG9hZGVkOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMuaGFzTG9hZGVkKSB7IHJldHVybjsgfQoKICAgICAgICAvLyBEZWZhdWx0IHRvIHdhaXRpbmcgZm9yIGFsbCBub2Rlcy4KICAgICAgICBjaGlsZEZpbHRlciA9IGNoaWxkRmlsdGVyIHx8IGlzTm9kZTsKICAgICAgICAvLyBXYWl0IGZvciBjaGlsZHJlbiB0byBsb2FkIChpZiBhbnkpLCB0aGVuIGxvYWQuCiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuKCk7CiAgICAgICAgY2hpbGRyZW5Mb2FkZWQgPSBjaGlsZHJlbi5maWx0ZXIoY2hpbGRGaWx0ZXIpLm1hcChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiB3YWl0Rm9yTG9hZGVkIChyZXNvbHZlKSB7CiAgICAgICAgICAgIGlmIChjaGlsZC5oYXNMb2FkZWQpIHsgcmV0dXJuIHJlc29sdmUoKTsgfQogICAgICAgICAgICBjaGlsZC5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCByZXNvbHZlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBQcm9taXNlLmFsbChjaGlsZHJlbkxvYWRlZCkudGhlbihmdW5jdGlvbiBlbWl0TG9hZGVkICgpIHsKICAgICAgICAgIHNlbGYuaGFzTG9hZGVkID0gdHJ1ZTsKICAgICAgICAgIGlmIChjYikgeyBjYigpOyB9CiAgICAgICAgICBzZWxmLmVtaXQoJ2xvYWRlZCcsIHVuZGVmaW5lZCwgZmFsc2UpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIGVycm9yKCdGYWlsdXJlIGxvYWRpbmcgbm9kZTogJywgZXJyKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0sCgogICAgZ2V0Q2hpbGRyZW46IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5jaGlsZHJlbiwgMCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBVbnJlZ2lzdGVyIG9sZCBtaXhpbnMgYW5kIGxpc3RlbmVycy4KICAgICAqIFJlZ2lzdGVyIG5ldyBtaXhpbnMgYW5kIGxpc3RlbmVycy4KICAgICAqIFJlZ2lzdGVyaW5nIG1lYW5zIHRvIHVwZGF0ZSBgdGhpcy5taXhpbkVsc2Agd2l0aCBsaXN0ZW5lcnMuCiAgICAgKi8KICAgIHVwZGF0ZU1peGluczogewogICAgICB2YWx1ZTogKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbmV3TWl4aW5JZEFycmF5ID0gW107CiAgICAgICAgdmFyIG9sZE1peGluSWRBcnJheSA9IFtdOwogICAgICAgIHZhciBtaXhpbklkcyA9IHt9OwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5ld01peGlucywgb2xkTWl4aW5zKSB7CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIHZhciBuZXdNaXhpbklkczsKICAgICAgICAgIHZhciBvbGRNaXhpbklkczsKCiAgICAgICAgICBuZXdNaXhpbklkQXJyYXkubGVuZ3RoID0gMDsKICAgICAgICAgIG9sZE1peGluSWRBcnJheS5sZW5ndGggPSAwOwogICAgICAgICAgbmV3TWl4aW5JZHMgPSBuZXdNaXhpbnMgPyB1dGlscy5zcGxpdChuZXdNaXhpbnMudHJpbSgpLCAvXHMrLykgOiBuZXdNaXhpbklkQXJyYXk7CiAgICAgICAgICBvbGRNaXhpbklkcyA9IG9sZE1peGlucyA/IHV0aWxzLnNwbGl0KG9sZE1peGlucy50cmltKCksIC9ccysvKSA6IG9sZE1peGluSWRBcnJheTsKCiAgICAgICAgICBtaXhpbklkcy5uZXdNaXhpbklkcyA9IG5ld01peGluSWRzOwogICAgICAgICAgbWl4aW5JZHMub2xkTWl4aW5JZHMgPSBvbGRNaXhpbklkczsKCiAgICAgICAgICAvLyBVbnJlZ2lzdGVyIG9sZCBtaXhpbnMuCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgb2xkTWl4aW5JZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKG5ld01peGluSWRzLmluZGV4T2Yob2xkTWl4aW5JZHNbaV0pID09PSAtMSkgewogICAgICAgICAgICAgIHRoaXMudW5yZWdpc3Rlck1peGluKG9sZE1peGluSWRzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJlZ2lzdGVyIG5ldyBtaXhpbnMuCiAgICAgICAgICB0aGlzLmNvbXB1dGVkTWl4aW5TdHIgPSAnJzsKICAgICAgICAgIHRoaXMubWl4aW5FbHMubGVuZ3RoID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuZXdNaXhpbklkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTWl4aW4oZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobmV3TWl4aW5JZHNbaV0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBVcGRhdGUgRE9NLiBLZWVwIHRyYWNrIG9mIGBjb21wdXRlZE1peGluU3RyYCB0byBub3QgcmVjdXJzZSBiYWNrIGhlcmUgYWZ0ZXIKICAgICAgICAgIC8vIHVwZGF0ZS4KICAgICAgICAgIGlmICh0aGlzLmNvbXB1dGVkTWl4aW5TdHIpIHsKICAgICAgICAgICAgdGhpcy5jb21wdXRlZE1peGluU3RyID0gdGhpcy5jb21wdXRlZE1peGluU3RyLnRyaW0oKTsKICAgICAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCAnbWl4aW4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcHV0ZWRNaXhpblN0cik7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1peGluSWRzOwogICAgICAgIH07CiAgICAgIH0pKCkKICAgIH0sCgogICAgLyoqCiAgICAgKiBGcm9tIG1peGluIElELCBhZGQgbWl4aW4gZWxlbWVudCB0byBgbWl4aW5FbHNgLgogICAgICoKICAgICAqIEBwYXJhbSB7RWxlbWVudH0gbWl4aW5FbAogICAgICovCiAgICByZWdpc3Rlck1peGluOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAobWl4aW5FbCkgewogICAgICAgIHZhciBjb21wb3NpdGVkTWl4aW5JZHM7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIG1peGluOwoKICAgICAgICBpZiAoIW1peGluRWwpIHsgcmV0dXJuOyB9CgogICAgICAgIC8vIFJlZ2lzdGVyIGNvbXBvc2l0ZWQgbWl4aW5zIChpZiBtaXhpbiBoYXMgbWl4aW5zKS4KICAgICAgICBtaXhpbiA9IG1peGluRWwuZ2V0QXR0cmlidXRlKCdtaXhpbicpOwogICAgICAgIGlmIChtaXhpbikgewogICAgICAgICAgY29tcG9zaXRlZE1peGluSWRzID0gdXRpbHMuc3BsaXQobWl4aW4udHJpbSgpLCAvXHMrLyk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9zaXRlZE1peGluSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJNaXhpbihkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb21wb3NpdGVkTWl4aW5JZHNbaV0pKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFJlZ2lzdGVyIG1peGluLgogICAgICAgIHRoaXMuY29tcHV0ZWRNaXhpblN0ciA9IHRoaXMuY29tcHV0ZWRNaXhpblN0ciArICcgJyArIG1peGluRWwuaWQ7CiAgICAgICAgdGhpcy5taXhpbkVscy5wdXNoKG1peGluRWwpOwogICAgICB9CiAgICB9LAoKICAgIHNldEF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIG5ld1ZhbHVlKSB7CiAgICAgICAgaWYgKGF0dHIgPT09ICdtaXhpbicpIHsgdGhpcy51cGRhdGVNaXhpbnMobmV3VmFsdWUpOyB9CiAgICAgICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyLCBuZXdWYWx1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgdW5yZWdpc3Rlck1peGluOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAobWl4aW5JZCkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBtaXhpbkVscyA9IHRoaXMubWl4aW5FbHM7CiAgICAgICAgdmFyIG1peGluRWw7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG1peGluRWxzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBtaXhpbkVsID0gbWl4aW5FbHNbaV07CiAgICAgICAgICBpZiAobWl4aW5JZCA9PT0gbWl4aW5FbC5pZCkgewogICAgICAgICAgICBtaXhpbkVscy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEVtaXQgYSBET00gZXZlbnQuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBOYW1lIG9mIGV2ZW50LgogICAgICogQHBhcmFtIHtvYmplY3R9IFtkZXRhaWw9e31dIC0gQ3VzdG9tIGRhdGEgdG8gcGFzcyBhcyBgZGV0YWlsYCB0byB0aGUgZXZlbnQuCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtidWJibGVzPXRydWVdIC0gV2hldGhlciB0aGUgZXZlbnQgc2hvdWxkIGJ1YmJsZS4KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbZXh0cmFEYXRhXSAtIEV4dHJhIGRhdGEgdG8gcGFzcyB0byB0aGUgZXZlbnQsIGlmIGFueS4KICAgICAqLwogICAgZW1pdDogewogICAgICB2YWx1ZTogKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGF0YSA9IHt9OwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUsIGRldGFpbCwgYnViYmxlcywgZXh0cmFEYXRhKSB7CiAgICAgICAgICBpZiAoYnViYmxlcyA9PT0gdW5kZWZpbmVkKSB7IGJ1YmJsZXMgPSB0cnVlOyB9CiAgICAgICAgICBkYXRhLmJ1YmJsZXMgPSAhIWJ1YmJsZXM7CiAgICAgICAgICBkYXRhLmRldGFpbCA9IGRldGFpbDsKCiAgICAgICAgICAvLyBJZiBleHRyYSBkYXRhIGlzIHByZXNlbnQsIHdlIG5lZWQgdG8gY3JlYXRlIGEgbmV3IG9iamVjdC4KICAgICAgICAgIGlmIChleHRyYURhdGEpIHsgZGF0YSA9IHV0aWxzLmV4dGVuZCh7fSwgZXh0cmFEYXRhLCBkYXRhKTsgfQoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQobmFtZSwgZGF0YSkpOwogICAgICAgIH07CiAgICAgIH0pKCksCiAgICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICAgIH0KICB9KQp9KTsKCn0seyIuLi91dGlscy8iOjE3OSwiLi9hLXJlZ2lzdGVyLWVsZW1lbnQiOjEwNX1dLDEwNTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qCiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgLS0tLS0tLS0tLS0tLSBXQVJOSU5HIFdBUk5JTkcgV0FSTklORyBXQVJOSU5HIC0tLS0tLS0tLS0tLS0tCiAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIFRoaXMgbW9kdWxlIHdyYXBzIHJlZ2lzdGVyRWxlbWVudCB0byBkZWFsIHdpdGggY29tcG9uZW50cyB0aGF0IGluaGVyaXQgZnJvbQogIGBBTm9kZWAgYW5kIGBBRW50aXR5YC4gIEl0J3MgYSBwYXNzIHRocm91Z2ggaW4gYW55IG90aGVyIGNhc2UuCgogIEl0IHdyYXBzIHNvbWUgb2YgdGhlIHByb3RvdHlwZSBtZXRob2RzIG9mIHRoZSBjcmVhdGVkIGVsZW1lbnQgdG8gbWFrZSBzdXJlCiAgdGhhdCB0aGUgY29ycmVzcG9uZGluZyBmdW5jdGlvbnMgaW4gdGhlIGJhc2UgcHJvdG90eXBlcyAoYEFFbnRpdHlgIGFuZCBgQU5vZGVgKQogIGFyZSBhbHNvIGludm9rZWQuIFRoZSBtZXRob2QgaW4gdGhlIGJhc2UgcHJvdG90eXBlIGlzIGFsd2F5cyBjYWxsZWQgYmVmb3JlIHRoZSBvbmUKICBpbiB0aGUgZGVyaXZlZCBwcm90b3R5cGUuCiovCgovLyBQb2x5ZmlsbCBgZG9jdW1lbnQucmVnaXN0ZXJFbGVtZW50YC4KX2RlcmVxXygnZG9jdW1lbnQtcmVnaXN0ZXItZWxlbWVudCcpOwoKdmFyIEFOb2RlOyAgLy8gTXVzdCBkZWNsYXJlIGJlZm9yZSBBRW50aXR5LiBJbml0aWFsaXplZCBhdCB0aGUgYm90dG9tLgp2YXIgQUVudGl0eTsKdmFyIGtub3duVGFncyA9IG1vZHVsZS5leHBvcnRzLmtub3duVGFncyA9IHt9OwoKZnVuY3Rpb24gYWRkVGFnTmFtZSAodGFnTmFtZSkgewogIGtub3duVGFnc1t0YWdOYW1lLnRvTG93ZXJDYXNlKCldID0gdHJ1ZTsKfQoKLyoqCiAqIFJldHVybiB3aGV0aGVyIHRoZSBlbGVtZW50IHR5cGUgaXMgb25lIG9mIG91ciBrbm93biByZWdpc3RlcmVkIG9uZXMuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBub2RlIC0gVGhlIG5hbWUgb2YgdGhlIHRhZyB0byByZWdpc3Rlci4KICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRhZyBuYW1lIG1hdGNoZXMgdGhhdCBvZiBvdXIgcmVnaXN0ZXJlZCBjdXN0b20gZWxlbWVudHMuCiAqLwptb2R1bGUuZXhwb3J0cy5pc05vZGUgPSBmdW5jdGlvbiAobm9kZSkgewogIHJldHVybiBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSBpbiBrbm93blRhZ3MgfHwgbm9kZS5pc05vZGU7Cn07CgovKioKICogQHBhcmFtIHtzdHJpbmd9IHRhZ05hbWUgLSBUaGUgbmFtZSBvZiB0aGUgdGFnIHRvIHJlZ2lzdGVyLgogKiBAcGFyYW0ge29iamVjdH0gb2JqIC0gVGhlIHByb3RvdHlwZSBvZiB0aGUgbmV3IGVsZW1lbnQuCiAqIEByZXR1cm5zIHtvYmplY3R9IFRoZSBwcm90b3R5cGUgb2YgdGhlIG5ldyBlbGVtZW50LgogKi8KbW9kdWxlLmV4cG9ydHMucmVnaXN0ZXJFbGVtZW50ID0gZnVuY3Rpb24gKHRhZ05hbWUsIG9iaikgewogIHZhciBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmoucHJvdG90eXBlKTsKICB2YXIgbmV3T2JqID0gb2JqOwogIHZhciBpc0FOb2RlID0gQU5vZGUgJiYgcHJvdG8gPT09IEFOb2RlLnByb3RvdHlwZTsKICB2YXIgaXNBRW50aXR5ID0gQUVudGl0eSAmJiBwcm90byA9PT0gQUVudGl0eS5wcm90b3R5cGU7CgogIGlmIChpc0FOb2RlIHx8IGlzQUVudGl0eSkgeyBhZGRUYWdOYW1lKHRhZ05hbWUpOyB9CgogIC8vIFdyYXAgaWYgZWxlbWVudCBpbmhlcml0cyBmcm9tIGBBTm9kZWAuCiAgaWYgKGlzQU5vZGUpIHsKICAgIG5ld09iaiA9IHdyYXBBTm9kZU1ldGhvZHMob2JqLnByb3RvdHlwZSk7CiAgICBuZXdPYmogPSB7cHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKHByb3RvLCBuZXdPYmopfTsKICB9CgogIC8vIFdyYXAgaWYgZWxlbWVudCBpbmhlcml0cyBmcm9tIGBBRW50aXR5YC4KICBpZiAoaXNBRW50aXR5KSB7CiAgICBuZXdPYmogPSB3cmFwQUVudGl0eU1ldGhvZHMob2JqLnByb3RvdHlwZSk7CiAgICBuZXdPYmogPSB7cHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKHByb3RvLCBuZXdPYmopfTsKICB9CgogIC8vIEdpdmUgYWxsIGZ1bmN0aW9ucyB0aGVpciBwcm9wZXIgbmFtZS4KICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuZXdPYmoucHJvdG90eXBlKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wTmFtZSkgewogICAgdmFyIHByb3BWYWwgPSBuZXdPYmoucHJvdG90eXBlW3Byb3BOYW1lXTsKICAgIGlmICh0eXBlb2YgcHJvcFZhbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBwcm9wVmFsLmRpc3BsYXlOYW1lID0gcHJvcE5hbWU7CiAgICB9CiAgfSk7CgogIHJldHVybiBkb2N1bWVudC5yZWdpc3RlckVsZW1lbnQodGFnTmFtZSwgbmV3T2JqKTsKfTsKCi8qKgogKiBXcmFwIHNvbWUgb2JqIG1ldGhvZHMgdG8gY2FsbCB0aG9zZSBvbiBgQU5vZGVgIGJhc2UgcHJvdG90eXBlLgogKgogKiBAcGFyYW0ge29iamVjdH0gb2JqIC0gT2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIG1ldGhvZHMgdGhhdCB3aWxsIGJlIHdyYXBwZWQuCiAqIEByZXR1cm4ge29iamVjdH0gQW4gb2JqZWN0IHdpdGggdGhlIHNhbWUgcHJvcGVydGllcyBhcyB0aGUgaW5wdXQgcGFyYW1ldGVyIGJ1dAogKiB3aXRoIHNvbWUgb2YgbWV0aG9kcyB3cmFwcGVkLgogKi8KZnVuY3Rpb24gd3JhcEFOb2RlTWV0aG9kcyAob2JqKSB7CiAgdmFyIG5ld09iaiA9IHt9OwogIHZhciBBTm9kZU1ldGhvZHMgPSBbCiAgICAnYXR0YWNoZWRDYWxsYmFjaycsCiAgICAnYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrJywKICAgICdjcmVhdGVkQ2FsbGJhY2snLAogICAgJ2RldGFjaGVkQ2FsbGJhY2snCiAgXTsKICB3cmFwTWV0aG9kcyhuZXdPYmosIEFOb2RlTWV0aG9kcywgb2JqLCBBTm9kZS5wcm90b3R5cGUpOwogIGNvcHlQcm9wZXJ0aWVzKG9iaiwgbmV3T2JqKTsKICByZXR1cm4gbmV3T2JqOwp9CgovKioKICogVGhpcyB3cmFwcyBzb21lIG9mIHRoZSBvYmogbWV0aG9kcyB0byBjYWxsIHRob3NlIG9uIGBBRW50aXR5YCBiYXNlIHByb3RvdHlwZS4KICoKICogQHBhcmFtIHtvYmplY3R9IG9iaiAtIFRoZSBvYmplY3RzIHRoYXQgY29udGFpbnMgdGhlIG1ldGhvZHMgdGhhdCB3aWxsIGJlIHdyYXBwZWQuCiAqIEByZXR1cm4ge29iamVjdH0gLSBBbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBwcm9wZXJ0aWVzIGFzIHRoZSBpbnB1dCBwYXJhbWV0ZXIgYnV0CiAqIHdpdGggc29tZSBvZiBtZXRob2RzIHdyYXBwZWQuCiAqLwpmdW5jdGlvbiB3cmFwQUVudGl0eU1ldGhvZHMgKG9iaikgewogIHZhciBuZXdPYmogPSB7fTsKICB2YXIgQU5vZGVNZXRob2RzID0gWwogICAgJ2F0dGFjaGVkQ2FsbGJhY2snLAogICAgJ2F0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjaycsCiAgICAnY3JlYXRlZENhbGxiYWNrJywKICAgICdkZXRhY2hlZENhbGxiYWNrJwogIF07CiAgdmFyIEFFbnRpdHlNZXRob2RzID0gWwogICAgJ2F0dGFjaGVkQ2FsbGJhY2snLAogICAgJ2F0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjaycsCiAgICAnY3JlYXRlZENhbGxiYWNrJywKICAgICdkZXRhY2hlZENhbGxiYWNrJwogIF07CgogIHdyYXBNZXRob2RzKG5ld09iaiwgQU5vZGVNZXRob2RzLCBvYmosIEFOb2RlLnByb3RvdHlwZSk7CiAgd3JhcE1ldGhvZHMobmV3T2JqLCBBRW50aXR5TWV0aG9kcywgb2JqLCBBRW50aXR5LnByb3RvdHlwZSk7CiAgLy8gQ29waWVzIHRoZSByZW1haW5pbmcgcHJvcGVydGllcyBpbnRvIHRoZSBuZXcgb2JqZWN0LgogIGNvcHlQcm9wZXJ0aWVzKG9iaiwgbmV3T2JqKTsKICByZXR1cm4gbmV3T2JqOwp9CgovKioKICogV3JhcCBhIGxpc3QgYSBtZXRob2RzIHRvIGVuc3VyZSB0aGF0IHRob3NlIGluIHRoZSBiYXNlIHByb3RvdHlwZSBhcmUgY2FsbGVkCiAqIGJlZm9yZSB0aGUgZGVyaXZlZCBvbmUuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSB0YXJnZXRPYmogLSBPYmplY3QgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIHdyYXBwZWQgbWV0aG9kcy4KICogQHBhcmFtIHthcnJheX0gbWV0aG9kTGlzdCAtIExpc3Qgb2YgbWV0aG9kcyBmcm9tIHRoZSBkZXJpdmVkT2JqIHRoYXQgd2lsbCBiZSB3cmFwcGVkLgogKiBAcGFyYW0ge29iamVjdH0gZGVyaXZlZE9iamVjdCAtIE9iamVjdCB0aGF0IGluaGVyaXRzIGZyb20gdGhlIGJhc2VPYmouCiAqIEBwYXJhbSB7b2JqZWN0fSBiYXNlT2JqIC0gT2JqZWN0IHRoYXQgZGVyaXZlZE9iaiBpbmhlcml0cyBmcm9tLgogKi8KZnVuY3Rpb24gd3JhcE1ldGhvZHMgKHRhcmdldE9iaiwgbWV0aG9kTGlzdCwgZGVyaXZlZE9iaiwgYmFzZU9iaikgewogIG1ldGhvZExpc3QuZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kTmFtZSkgewogICAgd3JhcE1ldGhvZCh0YXJnZXRPYmosIG1ldGhvZE5hbWUsIGRlcml2ZWRPYmosIGJhc2VPYmopOwogIH0pOwp9Cm1vZHVsZS5leHBvcnRzLndyYXBNZXRob2RzID0gd3JhcE1ldGhvZHM7CgovKioKICogV3JhcCBvbmUgbWV0aG9kIHRvIGVuc3VyZSB0aGF0IHRoZSBvbmUgaW4gdGhlIGJhc2UgcHJvdG90eXBlIGlzIGNhbGxlZCBiZWZvcmUKICogdGhlIG9uZSBpbiB0aGUgZGVyaXZlZCBvbmUuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBvYmogLSBPYmplY3QgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIHdyYXBwZWQgbWV0aG9kLgogKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBtZXRob2QgdGhhdCB3aWxsIGJlIHdyYXBwZWQuCiAqIEBwYXJhbSB7b2JqZWN0fSBkZXJpdmVkT2JqZWN0IC0gT2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSB0aGUgYmFzZU9iai4KICogQHBhcmFtIHtvYmplY3R9IGJhc2VPYmogLSBPYmplY3QgdGhhdCBkZXJpdmVkT2JqIGluaGVyaXRzIGZyb20uCiAqLwpmdW5jdGlvbiB3cmFwTWV0aG9kIChvYmosIG1ldGhvZE5hbWUsIGRlcml2ZWRPYmosIGJhc2VPYmopIHsKICB2YXIgZGVyaXZlZE1ldGhvZCA9IGRlcml2ZWRPYmpbbWV0aG9kTmFtZV07CiAgdmFyIGJhc2VNZXRob2QgPSBiYXNlT2JqW21ldGhvZE5hbWVdOwoKICAvLyBEZXJpdmVkIHByb3RvdHlwZSBkb2VzIG5vdCBkZWZpbmUgbWV0aG9kLCBubyBuZWVkIHRvIHdyYXAuCiAgaWYgKCFkZXJpdmVkTWV0aG9kIHx8ICFiYXNlTWV0aG9kKSB7IHJldHVybjsgfQoKICAvLyBEZXJpdmVkIHByb3RvdHlwZSBkb2Vzbid0IG92ZXJyaWRlIHRoZSBvbmUgaW4gdGhlIGJhc2Ugb25lLCBubyBuZWVkIHRvIHdyYXAuCiAgaWYgKGRlcml2ZWRNZXRob2QgPT09IGJhc2VNZXRob2QpIHsgcmV0dXJuOyB9CgogIC8vIFdyYXAgdG8gZW5zdXJlIHRoZSBiYXNlIG1ldGhvZCBpcyBjYWxsZWQgYmVmb3JlIHRoZSBvbmUgaW4gdGhlIGRlcml2ZWQgcHJvdG90eXBlLgogIG9ialttZXRob2ROYW1lXSA9IHsKICAgIHZhbHVlOiBmdW5jdGlvbiB3cmFwcGVkTWV0aG9kICgpIHsKICAgICAgYmFzZU1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gZGVyaXZlZE1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICB9Owp9CgovKioKICogSXQgY29waWVzIHRoZSBwcm9wZXJ0aWVzIGZyb20gc291cmNlIHRvIGRlc3RpbmF0aW9uIG9iamVjdCBpZiB0aGV5IGRvbid0CiAqIGV4aXN0IGFscmVhZHkuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBzb3VyY2UgLSBUaGUgb2JqZWN0IHdoZXJlIHByb3BlcnRpZXMgYXJlIGNvcGllZCBmcm9tLgogKiBAcGFyYW0ge3R5cGV9IGRlc3RpbmF0aW9uIC0gVGhlIG9iamVjdCB3aGVyZSBwcm9wZXJ0aWVzIGFyZSBjb3BpZWQgdG8uCiAqLwpmdW5jdGlvbiBjb3B5UHJvcGVydGllcyAoc291cmNlLCBkZXN0aW5hdGlvbikgewogIHZhciBwcm9wcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHNvdXJjZSk7CiAgcHJvcHMuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkgewogICAgdmFyIGRlc2M7CiAgICBpZiAoIWRlc3RpbmF0aW9uW3Byb3BdKSB7CiAgICAgIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgcHJvcCk7CiAgICAgIGRlc3RpbmF0aW9uW3Byb3BdID0ge3ZhbHVlOiBzb3VyY2VbcHJvcF0sIHdyaXRhYmxlOiBkZXNjLndyaXRhYmxlfTsKICAgIH0KICB9KTsKfQoKQU5vZGUgPSBfZGVyZXFfKCcuL2Etbm9kZScpOwpBRW50aXR5ID0gX2RlcmVxXygnLi9hLWVudGl0eScpOwoKfSx7Ii4vYS1lbnRpdHkiOjEwMiwiLi9hLW5vZGUiOjEwNCwiZG9jdW1lbnQtcmVnaXN0ZXItZWxlbWVudCI6MTN9XSwxMDY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgTm9kZSAqLwp2YXIgc2NoZW1hID0gX2RlcmVxXygnLi9zY2hlbWEnKTsKdmFyIHNjZW5lcyA9IF9kZXJlcV8oJy4vc2NlbmUvc2NlbmVzJyk7CnZhciBzeXN0ZW1zID0gX2RlcmVxXygnLi9zeXN0ZW0nKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7Cgp2YXIgY29tcG9uZW50cyA9IG1vZHVsZS5leHBvcnRzLmNvbXBvbmVudHMgPSB7fTsgIC8vIEtlZXAgdHJhY2sgb2YgcmVnaXN0ZXJlZCBjb21wb25lbnRzLgp2YXIgcGFyc2VQcm9wZXJ0aWVzID0gc2NoZW1hLnBhcnNlUHJvcGVydGllczsKdmFyIHBhcnNlUHJvcGVydHkgPSBzY2hlbWEucGFyc2VQcm9wZXJ0eTsKdmFyIHByb2Nlc3NTY2hlbWEgPSBzY2hlbWEucHJvY2VzczsKdmFyIGlzU2luZ2xlUHJvcCA9IHNjaGVtYS5pc1NpbmdsZVByb3BlcnR5Owp2YXIgc3RyaW5naWZ5UHJvcGVydGllcyA9IHNjaGVtYS5zdHJpbmdpZnlQcm9wZXJ0aWVzOwp2YXIgc3RyaW5naWZ5UHJvcGVydHkgPSBzY2hlbWEuc3RyaW5naWZ5UHJvcGVydHk7CnZhciBzdHlsZVBhcnNlciA9IHV0aWxzLnN0eWxlUGFyc2VyOwp2YXIgd2FybiA9IHV0aWxzLmRlYnVnKCdjb3JlOmNvbXBvbmVudDp3YXJuJyk7Cgp2YXIgYWZyYW1lU2NyaXB0ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdDsKdmFyIHVwcGVyQ2FzZVJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1tBLVpdKycpOwoKLy8gT2JqZWN0IHBvb2xzIGJ5IGNvbXBvbmVudCwgY3JlYXRlZCB1cG9uIHJlZ2lzdHJhdGlvbi4KdmFyIG9iamVjdFBvb2xzID0ge307CgovKioKICogQ29tcG9uZW50IGNsYXNzIGRlZmluaXRpb24uCiAqCiAqIENvbXBvbmVudHMgY29uZmlndXJlIGFwcGVhcmFuY2UsIG1vZGlmeSBiZWhhdmlvciwgb3IgYWRkIGZ1bmN0aW9uYWxpdHkgdG8KICogZW50aXRpZXMuIFRoZSBiZWhhdmlvciBhbmQgYXBwZWFyYW5jZSBvZiBhbiBlbnRpdHkgY2FuIGJlIGNoYW5nZWQgYXQgcnVudGltZQogKiBieSBhZGRpbmcsIHJlbW92aW5nLCBvciB1cGRhdGluZyBjb21wb25lbnRzLiBFbnRpdGllcyBkbyBub3Qgc2hhcmUgaW5zdGFuY2VzCiAqIG9mIGNvbXBvbmVudHMuCiAqCiAqIEBtZW1iZXIge29iamVjdH0gZWwgLSBSZWZlcmVuY2UgdG8gdGhlIGVudGl0eSBlbGVtZW50LgogKiBAbWVtYmVyIHtzdHJpbmd9IGF0dHJWYWx1ZSAtIFZhbHVlIG9mIHRoZSBjb3JyZXNwb25kaW5nIEhUTUwgYXR0cmlidXRlLgogKiBAbWVtYmVyIHtvYmplY3R9IGRhdGEgLSBDb21wb25lbnQgZGF0YSBwb3B1bGF0ZWQgYnkgcGFyc2luZyB0aGUKICogICAgICAgICBtYXBwZWQgYXR0cmlidXRlIG9mIHRoZSBjb21wb25lbnQgcGx1cyBhcHBseWluZyBkZWZhdWx0cyBhbmQgbWl4aW5zLgogKi8KdmFyIENvbXBvbmVudCA9IG1vZHVsZS5leHBvcnRzLkNvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCwgYXR0clZhbHVlLCBpZCkgewogIHZhciBzZWxmID0gdGhpczsKICB0aGlzLmVsID0gZWw7CiAgdGhpcy5pZCA9IGlkOwogIHRoaXMuYXR0ck5hbWUgPSB0aGlzLm5hbWUgKyAoaWQgPyAnX18nICsgaWQgOiAnJyk7CiAgdGhpcy5ldnREZXRhaWwgPSB7aWQ6IHRoaXMuaWQsIG5hbWU6IHRoaXMubmFtZX07CiAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlOwogIHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSA9IGlzU2luZ2xlUHJvcCh0aGlzLnNjaGVtYSk7CiAgdGhpcy5pc1NpbmdsZVByb3BlcnR5T2JqZWN0ID0gdGhpcy5pc1NpbmdsZVByb3BlcnR5ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNPYmplY3QocGFyc2VQcm9wZXJ0eSh1bmRlZmluZWQsIHRoaXMuc2NoZW1hKSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhKHRoaXMuc2NoZW1hLmRlZmF1bHQgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTEVsZW1lbnQpOwogIHRoaXMuaXNPYmplY3RCYXNlZCA9ICF0aGlzLmlzU2luZ2xlUHJvcGVydHkgfHwgdGhpcy5pc1NpbmdsZVByb3BlcnR5T2JqZWN0OwogIHRoaXMuZWwuY29tcG9uZW50c1t0aGlzLmF0dHJOYW1lXSA9IHRoaXM7CiAgdGhpcy5vYmplY3RQb29sID0gb2JqZWN0UG9vbHNbdGhpcy5uYW1lXTsKCiAgZXZlbnRzQmluZCh0aGlzLCB0aGlzLmV2ZW50cyk7CgogIC8vIFN0b3JlIGNvbXBvbmVudCBkYXRhIGZyb20gcHJldmlvdXMgdXBkYXRlIGNhbGwuCiAgdGhpcy5hdHRyVmFsdWUgPSB1bmRlZmluZWQ7CiAgaWYgKHRoaXMuaXNPYmplY3RCYXNlZCkgewogICAgdGhpcy5uZXh0RGF0YSA9IHRoaXMub2JqZWN0UG9vbC51c2UoKTsKICAgIC8vIERyb3AgYW55IHByb3BlcnRpZXMgYWRkZWQgYnkgZHluYW1pYyBzY2hlbWFzIGluIHByZXZpb3VzIHVzZQogICAgdXRpbHMub2JqZWN0UG9vbC5yZW1vdmVVbnVzZWRLZXlzKHRoaXMubmV4dERhdGEsIHRoaXMuc2NoZW1hKTsKICAgIHRoaXMub2xkRGF0YSA9IHRoaXMub2JqZWN0UG9vbC51c2UoKTsKICAgIHV0aWxzLm9iamVjdFBvb2wucmVtb3ZlVW51c2VkS2V5cyh0aGlzLm9sZERhdGEsIHRoaXMuc2NoZW1hKTsKICAgIHRoaXMucHJldmlvdXNPbGREYXRhID0gdGhpcy5vYmplY3RQb29sLnVzZSgpOwogICAgdXRpbHMub2JqZWN0UG9vbC5yZW1vdmVVbnVzZWRLZXlzKHRoaXMucHJldmlvdXNPbGREYXRhLCB0aGlzLnNjaGVtYSk7CiAgICB0aGlzLnBhcnNpbmdBdHRyVmFsdWUgPSB0aGlzLm9iamVjdFBvb2wudXNlKCk7CiAgICB1dGlscy5vYmplY3RQb29sLnJlbW92ZVVudXNlZEtleXModGhpcy5wYXJzaW5nQXR0clZhbHVlLCB0aGlzLnNjaGVtYSk7CiAgfSBlbHNlIHsKICAgIHRoaXMubmV4dERhdGEgPSB1bmRlZmluZWQ7CiAgICB0aGlzLm9sZERhdGEgPSB1bmRlZmluZWQ7CiAgICB0aGlzLnByZXZpb3VzT2xkRGF0YSA9IHVuZGVmaW5lZDsKICAgIHRoaXMucGFyc2luZ0F0dHJWYWx1ZSA9IHVuZGVmaW5lZDsKICB9CgogIC8vIExhc3QgdmFsdWUgcGFzc2VkIHRvIHVwZGF0ZVByb3BlcnRpZXMuCiAgdGhpcy50aHJvdHRsZWRFbWl0Q29tcG9uZW50Q2hhbmdlZCA9IHV0aWxzLnRocm90dGxlKGZ1bmN0aW9uIGVtaXRDaGFuZ2UgKCkgewogICAgZWwuZW1pdCgnY29tcG9uZW50Y2hhbmdlZCcsIHNlbGYuZXZ0RGV0YWlsLCBmYWxzZSk7CiAgfSwgMjAwKTsKICB0aGlzLnVwZGF0ZVByb3BlcnRpZXMoYXR0clZhbHVlKTsKfTsKCkNvbXBvbmVudC5wcm90b3R5cGUgPSB7CiAgLyoqCiAgICogQ29udGFpbnMgdGhlIHR5cGUgc2NoZW1hIGFuZCBkZWZhdWx0cyBmb3IgdGhlIGRhdGEgdmFsdWVzLgogICAqIERhdGEgaXMgY29lcmNlZCBpbnRvIHRoZSB0eXBlcyBvZiB0aGUgdmFsdWVzIG9mIHRoZSBkZWZhdWx0cy4KICAgKi8KICBzY2hlbWE6IHt9LAoKICAvKioKICAgKiBJbml0IGhhbmRsZXIuIFNpbWlsYXIgdG8gYXR0YWNoZWRDYWxsYmFjay4KICAgKiBDYWxsZWQgZHVyaW5nIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbiBhbmQgaXMgb25seSBydW4gb25jZS4KICAgKiBDb21wb25lbnRzIGNhbiB1c2UgdGhpcyB0byBzZXQgaW5pdGlhbCBzdGF0ZS4KICAgKi8KICBpbml0OiBmdW5jdGlvbiAoKSB7IC8qIG5vLW9wICovIH0sCgogIC8qKgogICAqIE1hcCBvZiBldmVudCBuYW1lcyB0byBiaW5kZWQgZXZlbnQgaGFuZGxlcnMgdGhhdCB3aWxsIGJlIGxpZmVjeWNsZS1oYW5kbGVkLgogICAqIFdpbGwgYmUgZGV0YWNoZWQgb24gcGF1c2UgLyByZW1vdmUuCiAgICogV2lsbCBiZSBhdHRhY2hlZCBvbiBwbGF5LgogICAqLwogIGV2ZW50czoge30sCgogIC8qKgogICAqIFVwZGF0ZSBoYW5kbGVyLiBTaW1pbGFyIHRvIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjay4KICAgKiBDYWxsZWQgd2hlbmV2ZXIgY29tcG9uZW50J3MgZGF0YSBjaGFuZ2VzLgogICAqIEFsc28gY2FsbGVkIG9uIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbiB3aGVuIHRoZSBjb21wb25lbnQgcmVjZWl2ZXMgaW5pdGlhbCBkYXRhLgogICAqCiAgICogQHBhcmFtIHtvYmplY3R9IHByZXZEYXRhIC0gUHJldmlvdXMgYXR0cmlidXRlcyBvZiB0aGUgY29tcG9uZW50LgogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gKHByZXZEYXRhKSB7IC8qIG5vLW9wICovIH0sCgogIHVwZGF0ZVNjaGVtYTogdW5kZWZpbmVkLAoKICAvKioKICAgKiBUaWNrIGhhbmRsZXIuCiAgICogQ2FsbGVkIG9uIGVhY2ggdGljayBvZiB0aGUgc2NlbmUgcmVuZGVyIGxvb3AuCiAgICogQWZmZWN0ZWQgYnkgcGxheSBhbmQgcGF1c2UuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdGltZSAtIFNjZW5lIHRpY2sgdGltZS4KICAgKiBAcGFyYW0ge251bWJlcn0gdGltZURlbHRhIC0gRGlmZmVyZW5jZSBpbiBjdXJyZW50IHJlbmRlciB0aW1lIGFuZCBwcmV2aW91cyByZW5kZXIgdGltZS4KICAgKi8KICB0aWNrOiB1bmRlZmluZWQsCgogIC8qKgogICAqIFRvY2sgaGFuZGxlci4KICAgKiBDYWxsZWQgb24gZWFjaCB0b2NrIG9mIHRoZSBzY2VuZSByZW5kZXIgbG9vcC4KICAgKiBBZmZlY3RlZCBieSBwbGF5IGFuZCBwYXVzZS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lIC0gU2NlbmUgdGljayB0aW1lLgogICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lRGVsdGEgLSBEaWZmZXJlbmNlIGluIGN1cnJlbnQgcmVuZGVyIHRpbWUgYW5kIHByZXZpb3VzIHJlbmRlciB0aW1lLgogICAqIEBwYXJhbSB7b2JqZWN0fSBjYW1lcmEgLSBDYW1lcmEgdXNlZCB0byByZW5kZXIgdGhlIGxhc3QgZnJhbWUuCiAgICovCiAgdG9jazogdW5kZWZpbmVkLAoKICAvKioKICAgKiBDYWxsZWQgdG8gc3RhcnQgYW55IGR5bmFtaWMgYmVoYXZpb3IgKGUuZy4sIGFuaW1hdGlvbiwgQUksIGV2ZW50cywgcGh5c2ljcykuCiAgICovCiAgcGxheTogZnVuY3Rpb24gKCkgeyAvKiBuby1vcCAqLyB9LAoKICAvKioKICAgKiBDYWxsZWQgdG8gc3RvcCBhbnkgZHluYW1pYyBiZWhhdmlvciAoZS5nLiwgYW5pbWF0aW9uLCBBSSwgZXZlbnRzLCBwaHlzaWNzKS4KICAgKi8KICBwYXVzZTogZnVuY3Rpb24gKCkgeyAvKiBuby1vcCAqLyB9LAoKICAvKioKICAgKiBSZW1vdmUgaGFuZGxlci4gU2ltaWxhciB0byBkZXRhY2hlZENhbGxiYWNrLgogICAqIENhbGxlZCB3aGVuZXZlciBjb21wb25lbnQgaXMgcmVtb3ZlZCBmcm9tIHRoZSBlbnRpdHkgKGkuZS4sIHJlbW92ZUF0dHJpYnV0ZSkuCiAgICogQ29tcG9uZW50cyBjYW4gdXNlIHRoaXMgdG8gcmVzZXQgYmVoYXZpb3Igb24gdGhlIGVudGl0eS4KICAgKi8KICByZW1vdmU6IGZ1bmN0aW9uICgpIHsgLyogbm8tb3AgKi8gfSwKCiAgLyoqCiAgICogUGFyc2VzIGVhY2ggcHJvcGVydHkgYmFzZWQgb24gcHJvcGVydHkgdHlwZS4KICAgKiBJZiBjb21wb25lbnQgaXMgc2luZ2xlLXByb3BlcnR5LCB0aGVuIHBhcnNlcyB0aGUgc2luZ2xlIHByb3BlcnR5IHZhbHVlLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gSFRNTCBhdHRyaWJ1dGUgdmFsdWUuCiAgICogQHBhcmFtIHtib29sZWFufSBzaWxlbnQgLSBTdXBwcmVzcyB3YXJuaW5nIG1lc3NhZ2VzLgogICAqIEByZXR1cm5zIHtvYmplY3R9IENvbXBvbmVudCBkYXRhLgogICAqLwogIHBhcnNlOiBmdW5jdGlvbiAodmFsdWUsIHNpbGVudCkgewogICAgdmFyIHNjaGVtYSA9IHRoaXMuc2NoZW1hOwogICAgaWYgKHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSkgeyByZXR1cm4gcGFyc2VQcm9wZXJ0eSh2YWx1ZSwgc2NoZW1hKTsgfQogICAgcmV0dXJuIHBhcnNlUHJvcGVydGllcyhzdHlsZVBhcnNlci5wYXJzZSh2YWx1ZSksIHNjaGVtYSwgdHJ1ZSwgdGhpcy5uYW1lLCBzaWxlbnQpOwogIH0sCgogIC8qKgogICAqIFN0cmluZ2lmeSBwcm9wZXJ0aWVzIGlmIG5lY2Vzc2FyeS4KICAgKgogICAqIE9ubHkgY2FsbGVkIGZyb20gYEVudGl0eS5zZXRBdHRyaWJ1dGVgIGZvciBwcm9wZXJ0aWVzIHdob3NlIHBhcnNlcnMgYWNjZXB0IGEgbm9uLXN0cmluZwogICAqIHZhbHVlIChlLmcuLCBzZWxlY3RvciwgdmVjMyBwcm9wZXJ0eSB0eXBlcykuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIENvbXBsZXRlIGNvbXBvbmVudCBkYXRhLgogICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICovCiAgc3RyaW5naWZ5OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIHNjaGVtYSA9IHRoaXMuc2NoZW1hOwogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgeyByZXR1cm4gZGF0YTsgfQogICAgaWYgKHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSkgeyByZXR1cm4gc3RyaW5naWZ5UHJvcGVydHkoZGF0YSwgc2NoZW1hKTsgfQogICAgZGF0YSA9IHN0cmluZ2lmeVByb3BlcnRpZXMoZGF0YSwgc2NoZW1hKTsKICAgIHJldHVybiBzdHlsZVBhcnNlci5zdHJpbmdpZnkoZGF0YSk7CiAgfSwKCiAgLyoqCiAgICogVXBkYXRlIHRoZSBjYWNoZSBvZiB0aGUgcHJlLXBhcnNlZCBhdHRyaWJ1dGUgdmFsdWUuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBOZXcgZGF0YS4KICAgKiBAcGFyYW0ge2Jvb2xlYW4gfSBjbG9iYmVyIC0gV2hldGhlciB0byB3aXBlIG91dCBhbmQgcmVwbGFjZSBwcmV2aW91cyBkYXRhLgogICAqLwogIHVwZGF0ZUNhY2hlZEF0dHJWYWx1ZTogZnVuY3Rpb24gKHZhbHVlLCBjbG9iYmVyKSB7CiAgICB2YXIgbmV3QXR0clZhbHVlOwogICAgdmFyIHRlbXBPYmplY3Q7CiAgICB2YXIgcHJvcGVydHk7CgogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsgcmV0dXJuOyB9CgogICAgLy8gSWYgbnVsbCB2YWx1ZSBpcyB0aGUgbmV3IGF0dHJpYnV0ZSB2YWx1ZSwgbWFrZSB0aGUgYXR0cmlidXRlIHZhbHVlIGZhbHN5LgogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIGlmICh0aGlzLmlzT2JqZWN0QmFzZWQgJiYgdGhpcy5hdHRyVmFsdWUpIHsKICAgICAgICB0aGlzLm9iamVjdFBvb2wucmVjeWNsZSh0aGlzLmF0dHJWYWx1ZSk7CiAgICAgIH0KICAgICAgdGhpcy5hdHRyVmFsdWUgPSB1bmRlZmluZWQ7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MRWxlbWVudCkpIHsKICAgICAgLy8gSWYgdmFsdWUgaXMgYW4gb2JqZWN0LCBjb3B5IGl0IHRvIG91ciBwb29sZWQgbmV3QXR0clZhbHVlIG9iamVjdCB0byB1c2UgdG8gdXBkYXRlCiAgICAgIC8vIHRoZSBhdHRyVmFsdWUuCiAgICAgIHRlbXBPYmplY3QgPSB0aGlzLm9iamVjdFBvb2wudXNlKCk7CiAgICAgIG5ld0F0dHJWYWx1ZSA9IHV0aWxzLmV4dGVuZCh0ZW1wT2JqZWN0LCB2YWx1ZSk7CiAgICB9IGVsc2UgewogICAgICBuZXdBdHRyVmFsdWUgPSB0aGlzLnBhcnNlQXR0clZhbHVlRm9yQ2FjaGUodmFsdWUpOwogICAgfQoKICAgIC8vIE1lcmdlIG5ldyBkYXRhIHdpdGggcHJldmlvdXMgYGF0dHJWYWx1ZWAgaWYgdXBkYXRpbmcgYW5kIG5vdCBjbG9iYmVyaW5nLgogICAgaWYgKHRoaXMuaXNPYmplY3RCYXNlZCAmJiAhY2xvYmJlciAmJiB0aGlzLmF0dHJWYWx1ZSkgewogICAgICBmb3IgKHByb3BlcnR5IGluIHRoaXMuYXR0clZhbHVlKSB7CiAgICAgICAgaWYgKG5ld0F0dHJWYWx1ZVtwcm9wZXJ0eV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbmV3QXR0clZhbHVlW3Byb3BlcnR5XSA9IHRoaXMuYXR0clZhbHVlW3Byb3BlcnR5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBVcGRhdGUgYXR0clZhbHVlLgogICAgaWYgKHRoaXMuaXNPYmplY3RCYXNlZCAmJiAhdGhpcy5hdHRyVmFsdWUpIHsKICAgICAgdGhpcy5hdHRyVmFsdWUgPSB0aGlzLm9iamVjdFBvb2wudXNlKCk7CiAgICB9CiAgICB1dGlscy5vYmplY3RQb29sLmNsZWFyT2JqZWN0KHRoaXMuYXR0clZhbHVlKTsKICAgIHRoaXMuYXR0clZhbHVlID0gZXh0ZW5kUHJvcGVydGllcyh0aGlzLmF0dHJWYWx1ZSwgbmV3QXR0clZhbHVlLCB0aGlzLmlzT2JqZWN0QmFzZWQpOwogICAgdXRpbHMub2JqZWN0UG9vbC5jbGVhck9iamVjdCh0ZW1wT2JqZWN0KTsKICB9LAoKICAvKioKICAgKiBHaXZlbiBhbiBIVE1MIGF0dHJpYnV0ZSB2YWx1ZSBwYXJzZXMgdGhlIHN0cmluZyBiYXNlZCBvbiB0aGUgY29tcG9uZW50IHNjaGVtYS4KICAgKiBUbyBhdm9pZCBkb3VibGUgcGFyc2luZ3Mgb2Ygc3RyaW5ncyBpbnRvIHN0cmluZ3Mgd2Ugc3RvcmUgdGhlIG9yaWdpbmFsIGluc3RlYWQKICAgKiBvZiB0aGUgcGFyc2VkIG9uZQogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gSFRNTCBhdHRyaWJ1dGUgdmFsdWUKICAgKi8KICBwYXJzZUF0dHJWYWx1ZUZvckNhY2hlOiBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhciBwYXJzZWRWYWx1ZTsKICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7IHJldHVybiB2YWx1ZTsgfQogICAgaWYgKHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSkgewogICAgICBwYXJzZWRWYWx1ZSA9IHRoaXMuc2NoZW1hLnBhcnNlKHZhbHVlKTsKICAgICAgLyoqCiAgICAgICAqIFRvIGF2b2lkIGJvZ3VzIGRvdWJsZSBwYXJzaW5ncy4gQ2FjaGVkIHZhbHVlcyB3aWxsIGJlIHBhcnNlZCB3aGVuIGJ1aWxkaW5nCiAgICAgICAqIGNvbXBvbmVudCBkYXRhLiBGb3IgaW5zdGFuY2Ugd2hlbiBwYXJzaW5nIGEgc3JjIGlkIHRvIGl0cyB1cmwsIHdlIHdhbnQgdG8gY2FjaGUKICAgICAgICogb3JpZ2luYWwgc3RyaW5nIGFuZCBub3QgdGhlIHBhcnNlZCBvbmUgKCNtb25zdGVyIC0+IG1vZGVscy9tb25zdGVyLmRhZSkKICAgICAgICogc28gd2hlbiBidWlsZGluZyBkYXRhIHdlIHBhcnNlIHRoZSBleHBlY3RlZCB2YWx1ZS4KICAgICAgICovCiAgICAgIGlmICh0eXBlb2YgcGFyc2VkVmFsdWUgPT09ICdzdHJpbmcnKSB7IHBhcnNlZFZhbHVlID0gdmFsdWU7IH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFBhcnNlIHVzaW5nIHRoZSBzdHlsZSBwYXJzZXIgdG8gYXZvaWQgZG91YmxlIHBhcnNpbmcgb2YgaW5kaXZpZHVhbCBwcm9wZXJ0aWVzLgogICAgICB1dGlscy5vYmplY3RQb29sLmNsZWFyT2JqZWN0KHRoaXMucGFyc2luZ0F0dHJWYWx1ZSk7CiAgICAgIHBhcnNlZFZhbHVlID0gc3R5bGVQYXJzZXIucGFyc2UodmFsdWUsIHRoaXMucGFyc2luZ0F0dHJWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gcGFyc2VkVmFsdWU7CiAgfSwKCiAgLyoqCiAgICogV3JpdGUgY2FjaGVkIGF0dHJpYnV0ZSBkYXRhIHRvIHRoZSBlbnRpdHkgRE9NIGVsZW1lbnQuCiAgICoKICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRGVmYXVsdCAtIFdoZXRoZXIgY29tcG9uZW50IGlzIGEgZGVmYXVsdCBjb21wb25lbnQuIEFsd2F5cyBmbHVzaCBmb3IKICAgKiAgIGRlZmF1bHQgY29tcG9uZW50cy4KICAgKi8KICBmbHVzaFRvRE9NOiBmdW5jdGlvbiAoaXNEZWZhdWx0KSB7CiAgICB2YXIgYXR0clZhbHVlID0gaXNEZWZhdWx0ID8gdGhpcy5kYXRhIDogdGhpcy5hdHRyVmFsdWU7CiAgICBpZiAoYXR0clZhbHVlID09PSBudWxsIHx8IGF0dHJWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7IHJldHVybjsgfQogICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLmVsLCB0aGlzLmF0dHJOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0cmluZ2lmeShhdHRyVmFsdWUpKTsKICB9LAoKICAvKioKICAgKiBBcHBseSBuZXcgY29tcG9uZW50IGRhdGEgaWYgZGF0YSBoYXMgY2hhbmdlZCAoZnJvbSBzZXRBdHRyaWJ1dGUpLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGF0dHJWYWx1ZSAtIEhUTUwgYXR0cmlidXRlIHZhbHVlLgogICAqICAgICAgICBJZiB1bmRlZmluZWQsIHVzZSB0aGUgY2FjaGVkIGF0dHJpYnV0ZSB2YWx1ZSBhbmQgY29udGludWUgdXBkYXRpbmcgcHJvcGVydGllcy4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGNsb2JiZXIgLSBUaGUgcHJldmlvdXMgY29tcG9uZW50IGRhdGEgaXMgb3ZlcndyaXR0ZW4gYnkgdGhlIGF0cnJWYWx1ZQogICAqLwogIHVwZGF0ZVByb3BlcnRpZXM6IGZ1bmN0aW9uIChhdHRyVmFsdWUsIGNsb2JiZXIpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CgogICAgLy8gSnVzdCBjYWNoZSB0aGUgYXR0cmlidXRlIGlmIHRoZSBlbnRpdHkgaGFzIG5vdCBsb2FkZWQKICAgIC8vIENvbXBvbmVudHMgYXJlIG5vdCBpbml0aWFsaXplZCB1bnRpbCB0aGUgZW50aXR5IGhhcyBsb2FkZWQKICAgIGlmICghZWwuaGFzTG9hZGVkKSB7CiAgICAgIHRoaXMudXBkYXRlQ2FjaGVkQXR0clZhbHVlKGF0dHJWYWx1ZSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBQYXJzZSB0aGUgYXR0cmlidXRlIHZhbHVlLgogICAgLy8gQ2FjaGUgY3VycmVudCBhdHRyVmFsdWUgZm9yIGZ1dHVyZSB1cGRhdGVzLiBVcGRhdGVzIGB0aGlzLmF0dHJWYWx1ZWAuCiAgICAvLyBgbnVsbGAgbWVhbnMgbm8gdmFsdWUgb24gcHVycG9zZSwgZG8gbm90IHNldCBhIGRlZmF1bHQgdmFsdWUsIGxldCBtaXhpbnMgdGFrZSBvdmVyLgogICAgaWYgKGF0dHJWYWx1ZSAhPT0gbnVsbCkgewogICAgICBhdHRyVmFsdWUgPSB0aGlzLnBhcnNlQXR0clZhbHVlRm9yQ2FjaGUoYXR0clZhbHVlKTsKICAgIH0KCiAgICAvLyBDYWNoZSBjdXJyZW50IGF0dHJWYWx1ZSBmb3IgZnV0dXJlIHVwZGF0ZXMuCiAgICB0aGlzLnVwZGF0ZUNhY2hlZEF0dHJWYWx1ZShhdHRyVmFsdWUsIGNsb2JiZXIpOwoKICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7CiAgICAgIHRoaXMudXBkYXRlQ29tcG9uZW50KGF0dHJWYWx1ZSwgY2xvYmJlcik7CiAgICAgIHRoaXMuY2FsbFVwZGF0ZUhhbmRsZXIoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuaW5pdENvbXBvbmVudCgpOwogICAgfQogIH0sCgogIGluaXRDb21wb25lbnQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbCA9IHRoaXMuZWw7CiAgICB2YXIgaW5pdGlhbE9sZERhdGE7CgogICAgLy8gQnVpbGQgZGF0YS4KICAgIGlmICh0aGlzLnVwZGF0ZVNjaGVtYSkgeyB0aGlzLnVwZGF0ZVNjaGVtYSh0aGlzLmJ1aWxkRGF0YSh0aGlzLmF0dHJWYWx1ZSwgZmFsc2UsIHRydWUpKTsgfQogICAgdGhpcy5kYXRhID0gdGhpcy5idWlsZERhdGEodGhpcy5hdHRyVmFsdWUpOwoKICAgIC8vIENvbXBvbmVudCBpcyBiZWluZyBhbHJlYWR5IGluaXRpYWxpemVkLgogICAgaWYgKGVsLmluaXRpYWxpemluZ0NvbXBvbmVudHNbdGhpcy5uYW1lXSkgeyByZXR1cm47IH0KCiAgICAvLyBQcmV2ZW50IGluZmluaXRlIGxvb3AgaW4gY2FzZSBvZiBpbml0IG1ldGhvZCBzZXR0aW5nIHNhbWUgY29tcG9uZW50IG9uIHRoZSBlbnRpdHkuCiAgICBlbC5pbml0aWFsaXppbmdDb21wb25lbnRzW3RoaXMubmFtZV0gPSB0cnVlOwogICAgLy8gSW5pdGlhbGl6ZSBjb21wb25lbnQuCiAgICB0aGlzLmluaXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgZGVsZXRlIGVsLmluaXRpYWxpemluZ0NvbXBvbmVudHNbdGhpcy5uYW1lXTsKCiAgICAvLyBTdG9yZSBjdXJyZW50IGRhdGEgYXMgcHJldmlvdXMgZGF0YSBmb3IgZnV0dXJlIHVwZGF0ZXMuCiAgICB0aGlzLm9sZERhdGEgPSBleHRlbmRQcm9wZXJ0aWVzKHRoaXMub2xkRGF0YSwgdGhpcy5kYXRhLCB0aGlzLmlzT2JqZWN0QmFzZWQpOwoKICAgIC8vIEZvciBvbGREYXRhLCBwYXNzIGVtcHR5IG9iamVjdCB0byBtdWx0aXBsZS1wcm9wIHNjaGVtYXMgb3Igb2JqZWN0IHNpbmdsZS1wcm9wIHNjaGVtYS4KICAgIC8vIFBhc3MgdW5kZWZpbmVkIHRvIHJlc3Qgb2YgdHlwZXMuCiAgICBpbml0aWFsT2xkRGF0YSA9IHRoaXMuaXNPYmplY3RCYXNlZCA/IHRoaXMub2JqZWN0UG9vbC51c2UoKSA6IHVuZGVmaW5lZDsKICAgIHRoaXMudXBkYXRlKGluaXRpYWxPbGREYXRhKTsKICAgIGlmICh0aGlzLmlzT2JqZWN0QmFzZWQpIHsgdGhpcy5vYmplY3RQb29sLnJlY3ljbGUoaW5pdGlhbE9sZERhdGEpOyB9CgogICAgLy8gUGxheSB0aGUgY29tcG9uZW50IGlmIHRoZSBlbnRpdHkgaXMgcGxheWluZy4KICAgIGlmIChlbC5pc1BsYXlpbmcpIHsgdGhpcy5wbGF5KCk7IH0KICAgIGVsLmVtaXQoJ2NvbXBvbmVudGluaXRpYWxpemVkJywgdGhpcy5ldnREZXRhaWwsIGZhbHNlKTsKICB9LAoKICAvKioKICAgKiBAcGFyYW0gYXR0clZhbHVlIC0gUGFzc2VkIGFyZ3VtZW50IGZyb20gc2V0QXR0cmlidXRlLgogICAqLwogIHVwZGF0ZUNvbXBvbmVudDogZnVuY3Rpb24gKGF0dHJWYWx1ZSwgY2xvYmJlcikgewogICAgdmFyIGtleTsKICAgIHZhciBtYXlOZWVkU2NoZW1hVXBkYXRlOwoKICAgIGlmIChjbG9iYmVyKSB7CiAgICAgIC8vIENsb2JiZXIuIFJlYnVpbGQuCiAgICAgIGlmICh0aGlzLnVwZGF0ZVNjaGVtYSkgewogICAgICAgIHRoaXMudXBkYXRlU2NoZW1hKHRoaXMuYnVpbGREYXRhKHRoaXMuYXR0clZhbHVlLCB0cnVlLCB0cnVlKSk7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhID0gdGhpcy5idWlsZERhdGEodGhpcy5hdHRyVmFsdWUsIHRydWUsIGZhbHNlKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIEFwcGx5IG5ldyB2YWx1ZSB0byB0aGlzLmRhdGEgaW4gcGxhY2Ugc2luY2UgZGlyZWN0IHVwZGF0ZS4KICAgIGlmICh0aGlzLmlzU2luZ2xlUHJvcGVydHkpIHsKICAgICAgaWYgKHRoaXMuaXNPYmplY3RCYXNlZCkgewogICAgICAgIHBhcnNlUHJvcGVydHkoYXR0clZhbHVlLCB0aGlzLnNjaGVtYSk7CiAgICAgIH0KICAgICAgLy8gU2luZ2xlLXByb3BlcnR5IChhbHJlYWR5IHBhcnNlZCkuCiAgICAgIHRoaXMuZGF0YSA9IGF0dHJWYWx1ZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHBhcnNlUHJvcGVydGllcyhhdHRyVmFsdWUsIHRoaXMuc2NoZW1hLCB0cnVlLCB0aGlzLm5hbWUpOwoKICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gdXBkYXRlIHNjaGVtYS4KICAgIGlmICh0aGlzLnNjaGVtYUNoYW5nZUtleXMubGVuZ3RoKSB7CiAgICAgIGZvciAoa2V5IGluIGF0dHJWYWx1ZSkgewogICAgICAgIGlmICh0aGlzLnNjaGVtYVtrZXldLnNjaGVtYUNoYW5nZSkgewogICAgICAgICAgbWF5TmVlZFNjaGVtYVVwZGF0ZSA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXlOZWVkU2NoZW1hVXBkYXRlKSB7CiAgICAgIC8vIFJlYnVpbGQgZGF0YSBpZiBuZWVkIHNjaGVtYSB1cGRhdGUuCiAgICAgIGlmICh0aGlzLnVwZGF0ZVNjaGVtYSkgewogICAgICAgIHRoaXMudXBkYXRlU2NoZW1hKHRoaXMuYnVpbGREYXRhKHRoaXMuYXR0clZhbHVlLCB0cnVlLCB0cnVlKSk7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhID0gdGhpcy5idWlsZERhdGEodGhpcy5hdHRyVmFsdWUsIHRydWUsIGZhbHNlKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIE5vcm1hbCB1cGRhdGUuCiAgICBmb3IgKGtleSBpbiBhdHRyVmFsdWUpIHsKICAgICAgaWYgKGF0dHJWYWx1ZVtrZXldID09PSB1bmRlZmluZWQpIHsgY29udGludWU7IH0KICAgICAgdGhpcy5kYXRhW2tleV0gPSBhdHRyVmFsdWVba2V5XTsKICAgIH0KICB9LAoKICAvKioKICAgKiBDaGVjayBpZiBjb21wb25lbnQgc2hvdWxkIGZpcmUgdXBkYXRlIGFuZCBmaXJlIHVwZGF0ZSBsaWZlY3ljbGUgaGFuZGxlci4KICAgKi8KICBjYWxsVXBkYXRlSGFuZGxlcjogZnVuY3Rpb24gKCkgewogICAgdmFyIGhhc0NvbXBvbmVudENoYW5nZWQ7CgogICAgLy8gU3RvcmUgdGhlIHByZXZpb3VzIG9sZCBkYXRhIGJlZm9yZSB3ZSBjYWxjdWxhdGUgdGhlIG5ldyBvbGREYXRhLgogICAgaWYgKHRoaXMucHJldmlvdXNPbGREYXRhIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgIHV0aWxzLm9iamVjdFBvb2wuY2xlYXJPYmplY3QodGhpcy5wcmV2aW91c09sZERhdGEpOwogICAgfQogICAgaWYgKHRoaXMuaXNPYmplY3RCYXNlZCkgewogICAgICBjb3B5RGF0YSh0aGlzLnByZXZpb3VzT2xkRGF0YSwgdGhpcy5vbGREYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucHJldmlvdXNPbGREYXRhID0gdGhpcy5vbGREYXRhOwogICAgfQoKICAgIGhhc0NvbXBvbmVudENoYW5nZWQgPSAhdXRpbHMuZGVlcEVxdWFsKHRoaXMub2xkRGF0YSwgdGhpcy5kYXRhKTsKCiAgICAvLyBEb24ndCB1cGRhdGUgaWYgcHJvcGVydGllcyBoYXZlbid0IGNoYW5nZWQuCiAgICAvLyBBbHdheXMgdXBkYXRlIHJvdGF0aW9uLCBwb3NpdGlvbiwgc2NhbGUuCiAgICBpZiAoIXRoaXMuaXNQb3NpdGlvblJvdGF0aW9uU2NhbGUgJiYgIWhhc0NvbXBvbmVudENoYW5nZWQpIHsgcmV0dXJuOyB9CgogICAgLy8gU3RvcmUgY3VycmVudCBkYXRhIGFzIHByZXZpb3VzIGRhdGEgZm9yIGZ1dHVyZSB1cGRhdGVzLgogICAgLy8gUmV1c2UgYHRoaXMub2xkRGF0YWAgb2JqZWN0IHRvIHRyeSBub3QgdG8gYWxsb2NhdGUgYW5vdGhlciBvbmUuCiAgICBpZiAodGhpcy5vbGREYXRhIGluc3RhbmNlb2YgT2JqZWN0KSB7IHV0aWxzLm9iamVjdFBvb2wuY2xlYXJPYmplY3QodGhpcy5vbGREYXRhKTsgfQogICAgdGhpcy5vbGREYXRhID0gZXh0ZW5kUHJvcGVydGllcyh0aGlzLm9sZERhdGEsIHRoaXMuZGF0YSwgdGhpcy5pc09iamVjdEJhc2VkKTsKCiAgICAvLyBVcGRhdGUgY29tcG9uZW50IHdpdGggdGhlIHByZXZpb3VzIG9sZCBkYXRhLgogICAgdGhpcy51cGRhdGUodGhpcy5wcmV2aW91c09sZERhdGEpOwoKICAgIHRoaXMudGhyb3R0bGVkRW1pdENvbXBvbmVudENoYW5nZWQoKTsKICB9LAoKICBoYW5kbGVNaXhpblVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5kYXRhID0gdGhpcy5idWlsZERhdGEodGhpcy5hdHRyVmFsdWUpOwogICAgdGhpcy5jYWxsVXBkYXRlSGFuZGxlcigpOwogIH0sCgogIC8qKgogICAqIFJlc2V0IHZhbHVlIG9mIGEgcHJvcGVydHkgdG8gdGhlIHByb3BlcnR5J3MgZGVmYXVsdCB2YWx1ZS4KICAgKiBJZiBzaW5nbGUtcHJvcCBjb21wb25lbnQsIHJlc2V0IHZhbHVlIHRvIGNvbXBvbmVudCdzIGRlZmF1bHQgdmFsdWUuCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gcHJvcGVydHlOYW1lIC0gTmFtZSBvZiBwcm9wZXJ0eSB0byByZXNldC4KICAgKi8KICByZXNldFByb3BlcnR5OiBmdW5jdGlvbiAocHJvcGVydHlOYW1lKSB7CiAgICBpZiAodGhpcy5pc09iamVjdEJhc2VkKSB7CiAgICAgIGlmICghKHByb3BlcnR5TmFtZSBpbiB0aGlzLmF0dHJWYWx1ZSkpIHsgcmV0dXJuOyB9CiAgICAgIGRlbGV0ZSB0aGlzLmF0dHJWYWx1ZVtwcm9wZXJ0eU5hbWVdOwogICAgICB0aGlzLmRhdGFbcHJvcGVydHlOYW1lXSA9IHRoaXMuc2NoZW1hW3Byb3BlcnR5TmFtZV0uZGVmYXVsdDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYXR0clZhbHVlID0gdGhpcy5zY2hlbWEuZGVmYXVsdDsKICAgICAgdGhpcy5kYXRhID0gdGhpcy5zY2hlbWEuZGVmYXVsdDsKICAgIH0KICAgIHRoaXMudXBkYXRlUHJvcGVydGllcyh0aGlzLmF0dHJWYWx1ZSk7CiAgfSwKCiAgLyoqCiAgICogRXh0ZW5kIHNjaGVtYSBvZiBjb21wb25lbnQgZ2l2ZW4gYSBwYXJ0aWFsIHNjaGVtYS4KICAgKgogICAqIFNvbWUgY29tcG9uZW50cyBtaWdodCB3YW50IHRvIG11dGF0ZSB0aGVpciBzY2hlbWEgYmFzZWQgb24gY2VydGFpbiBwcm9wZXJ0aWVzLgogICAqIGUuZy4sIE1hdGVyaWFsIGNvbXBvbmVudCBjaGFuZ2VzIGl0cyBzY2hlbWEgYmFzZWQgb24gYHNoYWRlcmAgdG8gYWNjb3VudCBmb3IgZGlmZmVyZW50CiAgICogdW5pZm9ybXMKICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBzY2hlbWFBZGRvbiAtIFNjaGVtYSBjaHVuayB0aGF0IGV4dGVuZCBiYXNlIHNjaGVtYS4KICAgKi8KICBleHRlbmRTY2hlbWE6IGZ1bmN0aW9uIChzY2hlbWFBZGRvbikgewogICAgdmFyIGV4dGVuZGVkU2NoZW1hOwogICAgLy8gQ2xvbmUgYmFzZSBzY2hlbWEuCiAgICBleHRlbmRlZFNjaGVtYSA9IHV0aWxzLmV4dGVuZCh7fSwgY29tcG9uZW50c1t0aGlzLm5hbWVdLnNjaGVtYSk7CiAgICAvLyBFeHRlbmQgYmFzZSBzY2hlbWEgd2l0aCBuZXcgc2NoZW1hIGNodW5rLgogICAgdXRpbHMuZXh0ZW5kKGV4dGVuZGVkU2NoZW1hLCBzY2hlbWFBZGRvbik7CiAgICB0aGlzLnNjaGVtYSA9IHByb2Nlc3NTY2hlbWEoZXh0ZW5kZWRTY2hlbWEpOwogICAgdGhpcy5lbC5lbWl0KCdzY2hlbWFjaGFuZ2VkJywgdGhpcy5ldnREZXRhaWwpOwogIH0sCgogIC8qKgogICAqIEJ1aWxkIGNvbXBvbmVudCBkYXRhIGZyb20gdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGVudGl0eS5kYXRhLgogICAqCiAgICogUHJlY2VkZW5jZToKICAgKiAxLiBEZWZhdWx0cyBkYXRhCiAgICogMi4gTWl4aW4gZGF0YS4KICAgKiAzLiBBdHRyaWJ1dGUgZGF0YS4KICAgKgogICAqIEZpbmFsbHkgY29lcmNlIHRoZSBkYXRhIHRvIHRoZSB0eXBlcyBvZiB0aGUgZGVmYXVsdHMuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gbmV3RGF0YSAtIEVsZW1lbnQgbmV3IGRhdGEuCiAgICogQHBhcmFtIHtib29sZWFufSBjbG9iYmVyIC0gVGhlIHByZXZpb3VzIGRhdGEgaXMgY29tcGxldGVseSByZXBsYWNlZCBieSB0aGUgbmV3IG9uZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNpbGVudCAtIFN1cHByZXNzIHdhcm5pbmcgbWVzc2FnZXMuCiAgICogQHJldHVybiB7b2JqZWN0fSBUaGUgY29tcG9uZW50IGRhdGEKICAgKi8KICBidWlsZERhdGE6IGZ1bmN0aW9uIChuZXdEYXRhLCBjbG9iYmVyLCBzaWxlbnQpIHsKICAgIHZhciBjb21wb25lbnREZWZpbmVkOwogICAgdmFyIGRhdGE7CiAgICB2YXIgZGVmYXVsdFZhbHVlOwogICAgdmFyIGtleTsKICAgIHZhciBtaXhpbkRhdGE7CiAgICB2YXIgbmV4dERhdGEgPSB0aGlzLm5leHREYXRhOwogICAgdmFyIHNjaGVtYSA9IHRoaXMuc2NoZW1hOwogICAgdmFyIGk7CiAgICB2YXIgbWl4aW5FbHMgPSB0aGlzLmVsLm1peGluRWxzOwogICAgdmFyIHByZXZpb3VzRGF0YTsKCiAgICAvLyBXaGV0aGVyIGNvbXBvbmVudCBoYXMgYSBkZWZpbmVkIHZhbHVlLiBGb3IgYXJyYXlzLCB0cmVhdCBlbXB0eSBhcyBub3QgZGVmaW5lZC4KICAgIGNvbXBvbmVudERlZmluZWQgPSBuZXdEYXRhICYmIG5ld0RhdGEuY29uc3RydWN0b3IgPT09IEFycmF5CiAgICAgID8gbmV3RGF0YS5sZW5ndGgKICAgICAgOiBuZXdEYXRhICE9PSB1bmRlZmluZWQgJiYgbmV3RGF0YSAhPT0gbnVsbDsKCiAgICBpZiAodGhpcy5pc09iamVjdEJhc2VkKSB7IHV0aWxzLm9iamVjdFBvb2wuY2xlYXJPYmplY3QobmV4dERhdGEpOyB9CgogICAgLy8gMS4gR2F0aGVyIGRlZmF1bHQgdmFsdWVzIChsb3dlc3QgcHJlY2VuZGVuY2UpLgogICAgaWYgKHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSkgewogICAgICBpZiAodGhpcy5pc09iamVjdEJhc2VkKSB7CiAgICAgICAgLy8gSWYgb2JqZWN0LWJhc2VkIHNpbmdsZS1wcm9wLCB0aGVuIGNvcHkgb3ZlciB0aGUgZGF0YSB0byBvdXIgcG9vbGVkIG9iamVjdC4KICAgICAgICBkYXRhID0gY29weURhdGEobmV4dERhdGEsIHNjaGVtYS5kZWZhdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJZiBpcyBwbGFpbiBzaW5nbGUtcHJvcCwgY29weSBieSB2YWx1ZSB0aGUgZGVmYXVsdC4KICAgICAgICBkYXRhID0gaXNPYmplY3RPckFycmF5KHNjaGVtYS5kZWZhdWx0KQogICAgICAgICAgPyB1dGlscy5jbG9uZShzY2hlbWEuZGVmYXVsdCkKICAgICAgICAgIDogc2NoZW1hLmRlZmF1bHQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFByZXNlcnZlIHByZXZpb3VzbHkgc2V0IHByb3BlcnRpZXMgaWYgY2xvYmJlciBub3QgZW5hYmxlZC4KICAgICAgcHJldmlvdXNEYXRhID0gIWNsb2JiZXIgJiYgdGhpcy5hdHRyVmFsdWU7CgogICAgICAvLyBDbG9uZSBkZWZhdWx0IHZhbHVlIGlmIG9iamVjdCBzbyBjb21wb25lbnRzIGRvbid0IHNoYXJlIG9iamVjdAogICAgICBkYXRhID0gcHJldmlvdXNEYXRhIGluc3RhbmNlb2YgT2JqZWN0CiAgICAgICAgPyBjb3B5RGF0YShuZXh0RGF0YSwgcHJldmlvdXNEYXRhKQogICAgICAgIDogbmV4dERhdGE7CgogICAgICAvLyBBcHBseSBkZWZhdWx0cy4KICAgICAgZm9yIChrZXkgaW4gc2NoZW1hKSB7CiAgICAgICAgZGVmYXVsdFZhbHVlID0gc2NoZW1hW2tleV0uZGVmYXVsdDsKICAgICAgICBpZiAoZGF0YVtrZXldICE9PSB1bmRlZmluZWQpIHsgY29udGludWU7IH0KICAgICAgICAvLyBDbG9uZSBkZWZhdWx0IHZhbHVlIGlmIG9iamVjdCBzbyBjb21wb25lbnRzIGRvbid0IHNoYXJlIG9iamVjdAogICAgICAgIGRhdGFba2V5XSA9IGlzT2JqZWN0T3JBcnJheShkZWZhdWx0VmFsdWUpCiAgICAgICAgICA/IHV0aWxzLmNsb25lKGRlZmF1bHRWYWx1ZSkKICAgICAgICAgIDogZGVmYXVsdFZhbHVlOwogICAgICB9CiAgICB9CgogICAgLy8gMi4gR2F0aGVyIG1peGluIHZhbHVlcy4KICAgIGZvciAoaSA9IDA7IGkgPCBtaXhpbkVscy5sZW5ndGg7IGkrKykgewogICAgICBtaXhpbkRhdGEgPSBtaXhpbkVsc1tpXS5nZXRBdHRyaWJ1dGUodGhpcy5hdHRyTmFtZSk7CiAgICAgIGlmICghbWl4aW5EYXRhKSB7IGNvbnRpbnVlOyB9CiAgICAgIGRhdGEgPSBleHRlbmRQcm9wZXJ0aWVzKGRhdGEsIG1peGluRGF0YSwgdGhpcy5pc09iamVjdEJhc2VkKTsKICAgIH0KCiAgICAvLyAzLiBHYXRoZXIgYXR0cmlidXRlIHZhbHVlcyAoaGlnaGVzdCBwcmVjZW5kZW5jZSkuCiAgICBpZiAoY29tcG9uZW50RGVmaW5lZCkgewogICAgICBpZiAodGhpcy5pc1NpbmdsZVByb3BlcnR5KSB7CiAgICAgICAgLy8gSWYgb2JqZWN0LWJhc2VkLCBjb3B5IHRoZSB2YWx1ZSB0byBub3QgbW9kaWZ5IHRoZSBvcmlnaW5hbC4KICAgICAgICBpZiAoaXNPYmplY3QobmV3RGF0YSkpIHsKICAgICAgICAgIGNvcHlEYXRhKHRoaXMucGFyc2luZ0F0dHJWYWx1ZSwgbmV3RGF0YSk7CiAgICAgICAgICByZXR1cm4gcGFyc2VQcm9wZXJ0eSh0aGlzLnBhcnNpbmdBdHRyVmFsdWUsIHNjaGVtYSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZVByb3BlcnR5KG5ld0RhdGEsIHNjaGVtYSk7CiAgICAgIH0KICAgICAgZGF0YSA9IGV4dGVuZFByb3BlcnRpZXMoZGF0YSwgbmV3RGF0YSwgdGhpcy5pc09iamVjdEJhc2VkKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIFBhcnNlIGFuZCBjb2VyY2UgdXNpbmcgdGhlIHNjaGVtYS4KICAgICAgaWYgKHRoaXMuaXNTaW5nbGVQcm9wZXJ0eSkgeyByZXR1cm4gcGFyc2VQcm9wZXJ0eShkYXRhLCBzY2hlbWEpOyB9CiAgICB9CgogICAgcmV0dXJuIHBhcnNlUHJvcGVydGllcyhkYXRhLCBzY2hlbWEsIHVuZGVmaW5lZCwgdGhpcy5uYW1lLCBzaWxlbnQpOwogIH0sCgogIC8qKgogICAqIEF0dGFjaCBldmVudHMgZnJvbSBjb21wb25lbnQtZGVmaW5lZCBldmVudHMgbWFwLgogICAqLwogIGV2ZW50c0F0dGFjaDogZnVuY3Rpb24gKCkgewogICAgdmFyIGV2ZW50TmFtZTsKICAgIC8vIFNhZmV0eSBkZXRhY2ggdG8gcHJldmVudCBkb3VibGUtcmVnaXN0cmF0aW9uLgogICAgdGhpcy5ldmVudHNEZXRhY2goKTsKICAgIGZvciAoZXZlbnROYW1lIGluIHRoaXMuZXZlbnRzKSB7CiAgICAgIHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuZXZlbnRzW2V2ZW50TmFtZV0pOwogICAgfQogIH0sCgogIC8qKgogICAqIERldGFjaCBldmVudHMgZnJvbSBjb21wb25lbnQtZGVmaW5lZCBldmVudHMgbWFwLgogICAqLwogIGV2ZW50c0RldGFjaDogZnVuY3Rpb24gKCkgewogICAgdmFyIGV2ZW50TmFtZTsKICAgIGZvciAoZXZlbnROYW1lIGluIHRoaXMuZXZlbnRzKSB7CiAgICAgIHRoaXMuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMuZXZlbnRzW2V2ZW50TmFtZV0pOwogICAgfQogIH0sCgogIC8qKgogICAqIFJlbGVhc2UgYW5kIGZyZWUgbWVtb3J5LgogICAqLwogIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub2JqZWN0UG9vbC5yZWN5Y2xlKHRoaXMuYXR0clZhbHVlKTsKICAgIHRoaXMub2JqZWN0UG9vbC5yZWN5Y2xlKHRoaXMub2xkRGF0YSk7CiAgICB0aGlzLm9iamVjdFBvb2wucmVjeWNsZSh0aGlzLnBhcnNpbmdBdHRyVmFsdWUpOwogICAgdGhpcy5hdHRyVmFsdWUgPSB0aGlzLm9sZERhdGEgPSB0aGlzLnBhcnNpbmdBdHRyVmFsdWUgPSB1bmRlZmluZWQ7CiAgfQp9OwoKZnVuY3Rpb24gZXZlbnRzQmluZCAoY29tcG9uZW50LCBldmVudHMpIHsKICB2YXIgZXZlbnROYW1lOwogIGZvciAoZXZlbnROYW1lIGluIGV2ZW50cykgewogICAgZXZlbnRzW2V2ZW50TmFtZV0gPSBldmVudHNbZXZlbnROYW1lXS5iaW5kKGNvbXBvbmVudCk7CiAgfQp9CgovLyBGb3IgdGVzdGluZy4KaWYgKHdpbmRvdy5kZWJ1ZykgewogIHZhciByZWdpc3RyYXRpb25PcmRlcldhcm5pbmdzID0gbW9kdWxlLmV4cG9ydHMucmVnaXN0cmF0aW9uT3JkZXJXYXJuaW5ncyA9IHt9Owp9CgovKioKICogUmVnaXN0ZXIgYSBjb21wb25lbnQgdG8gQS1GcmFtZS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBDb21wb25lbnQgbmFtZS4KICogQHBhcmFtIHtvYmplY3R9IGRlZmluaXRpb24gLSBDb21wb25lbnQgc2NoZW1hIGFuZCBsaWZlY3ljbGUgbWV0aG9kIGhhbmRsZXJzLgogKiBAcmV0dXJucyB7b2JqZWN0fSBDb21wb25lbnQuCiAqLwptb2R1bGUuZXhwb3J0cy5yZWdpc3RlckNvbXBvbmVudCA9IGZ1bmN0aW9uIChuYW1lLCBkZWZpbml0aW9uKSB7CiAgdmFyIE5ld0NvbXBvbmVudDsKICB2YXIgcHJvcGVydHlOYW1lOwogIHZhciBwcm90byA9IHt9OwogIHZhciBzY2hlbWE7CiAgdmFyIHNjaGVtYUlzU2luZ2xlUHJvcDsKCiAgLy8gV2FybmluZyBpZiBjb21wb25lbnQgaXMgc3RhdGljYWxseSByZWdpc3RlcmVkIGFmdGVyIHRoZSBzY2VuZS4KICBpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0ICE9PSBhZnJhbWVTY3JpcHQpIHsKICAgIHNjZW5lcy5mb3JFYWNoKGZ1bmN0aW9uIGNoZWNrUG9zaXRpb24gKHNjZW5lRWwpIHsKICAgICAgLy8gT2theSB0byByZWdpc3RlciBjb21wb25lbnQgYWZ0ZXIgdGhlIHNjZW5lIGF0IHJ1bnRpbWUuCiAgICAgIGlmIChzY2VuZUVsLmhhc0xvYWRlZCkgeyByZXR1cm47IH0KCiAgICAgIC8vIENoZWNrIHRoYXQgY29tcG9uZW50IGlzIGRlY2xhcmVkIGJlZm9yZSB0aGUgc2NlbmUuCiAgICAgIGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHNjZW5lRWwpID09PQogICAgICAgICAgTm9kZS5ET0NVTUVOVF9QT1NJVElPTl9GT0xMT1dJTkcpIHsgcmV0dXJuOyB9CgogICAgICB3YXJuKCdUaGUgY29tcG9uZW50IGAnICsgbmFtZSArICdgIHdhcyByZWdpc3RlcmVkIGluIGEgPHNjcmlwdD4gdGFnIGFmdGVyIHRoZSBzY2VuZS4gJyArCiAgICAgICAgICAgJ0NvbXBvbmVudCA8c2NyaXB0PiB0YWdzIGluIGFuIEhUTUwgZmlsZSBzaG91bGQgYmUgZGVjbGFyZWQgKmJlZm9yZSogdGhlIHNjZW5lICcgKwogICAgICAgICAgICdzdWNoIHRoYXQgdGhlIGNvbXBvbmVudCBpcyBhdmFpbGFibGUgdG8gZW50aXRpZXMgZHVyaW5nIHNjZW5lIGluaXRpYWxpemF0aW9uLicpOwoKICAgICAgLy8gRm9yIHRlc3RpbmcuCiAgICAgIGlmICh3aW5kb3cuZGVidWcpIHsgcmVnaXN0cmF0aW9uT3JkZXJXYXJuaW5nc1tuYW1lXSA9IHRydWU7IH0KICAgIH0pOwogIH0KCiAgaWYgKHVwcGVyQ2FzZVJlZ0V4cC50ZXN0KG5hbWUpID09PSB0cnVlKSB7CiAgICB3YXJuKCdUaGUgY29tcG9uZW50IG5hbWUgYCcgKyBuYW1lICsgJ2AgY29udGFpbnMgdXBwZXJjYXNlIGNoYXJhY3RlcnMsIGJ1dCAnICsKICAgICAgICAgJ0hUTUwgd2lsbCBpZ25vcmUgdGhlIGNhcGl0YWxpemF0aW9uIG9mIGF0dHJpYnV0ZSBuYW1lcy4gJyArCiAgICAgICAgICdDaGFuZ2UgdGhlIG5hbWUgdG8gYmUgbG93ZXJjYXNlOiBgJyArIG5hbWUudG9Mb3dlckNhc2UoKSArICdgJyk7CiAgfQoKICBpZiAobmFtZS5pbmRleE9mKCdfXycpICE9PSAtMSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29tcG9uZW50IG5hbWUgYCcgKyBuYW1lICsgJ2AgaXMgbm90IGFsbG93ZWQuICcgKwogICAgICAgICAgICAgICAgICAgICdUaGUgc2VxdWVuY2UgX18gKGRvdWJsZSB1bmRlcnNjb3JlKSBpcyByZXNlcnZlZCB0byBzcGVjaWZ5IGFuIGlkJyArCiAgICAgICAgICAgICAgICAgICAgJyBmb3IgbXVsdGlwbGUgY29tcG9uZW50cyBvZiB0aGUgc2FtZSB0eXBlJyk7CiAgfQoKICAvLyBGb3JtYXQgZGVmaW5pdGlvbiBvYmplY3QgdG8gcHJvdG90eXBlIG9iamVjdC4KICBPYmplY3Qua2V5cyhkZWZpbml0aW9uKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgIHByb3RvW2tleV0gPSB7CiAgICAgIHZhbHVlOiBkZWZpbml0aW9uW2tleV0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9OwogIH0pOwoKICBpZiAoY29tcG9uZW50c1tuYW1lXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29tcG9uZW50IGAnICsgbmFtZSArICdgIGhhcyBiZWVuIGFscmVhZHkgcmVnaXN0ZXJlZC4gJyArCiAgICAgICAgICAgICAgICAgICAgJ0NoZWNrIHRoYXQgeW91IGFyZSBub3QgbG9hZGluZyB0d28gdmVyc2lvbnMgb2YgdGhlIHNhbWUgY29tcG9uZW50ICcgKwogICAgICAgICAgICAgICAgICAgICdvciB0d28gZGlmZmVyZW50IGNvbXBvbmVudHMgb2YgdGhlIHNhbWUgbmFtZS4nKTsKICB9CgogIE5ld0NvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCwgYXR0ciwgaWQpIHsKICAgIENvbXBvbmVudC5jYWxsKHRoaXMsIGVsLCBhdHRyLCBpZCk7CiAgfTsKCiAgTmV3Q29tcG9uZW50LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ29tcG9uZW50LnByb3RvdHlwZSwgcHJvdG8pOwogIE5ld0NvbXBvbmVudC5wcm90b3R5cGUubmFtZSA9IG5hbWU7CiAgTmV3Q29tcG9uZW50LnByb3RvdHlwZS5pc1Bvc2l0aW9uUm90YXRpb25TY2FsZSA9CiAgICBuYW1lID09PSAncG9zaXRpb24nIHx8IG5hbWUgPT09ICdyb3RhdGlvbicgfHwgbmFtZSA9PT0gJ3NjYWxlJzsKICBOZXdDb21wb25lbnQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTmV3Q29tcG9uZW50OwogIE5ld0NvbXBvbmVudC5wcm90b3R5cGUuc3lzdGVtID0gc3lzdGVtcyAmJiBzeXN0ZW1zLnN5c3RlbXNbbmFtZV07CiAgTmV3Q29tcG9uZW50LnByb3RvdHlwZS5wbGF5ID0gd3JhcFBsYXkoTmV3Q29tcG9uZW50LnByb3RvdHlwZS5wbGF5KTsKICBOZXdDb21wb25lbnQucHJvdG90eXBlLnBhdXNlID0gd3JhcFBhdXNlKE5ld0NvbXBvbmVudC5wcm90b3R5cGUucGF1c2UpOwoKICBzY2hlbWEgPSB1dGlscy5leHRlbmQocHJvY2Vzc1NjaGVtYShOZXdDb21wb25lbnQucHJvdG90eXBlLnNjaGVtYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXdDb21wb25lbnQucHJvdG90eXBlLm5hbWUpKTsKICBzY2hlbWFJc1NpbmdsZVByb3AgPSBpc1NpbmdsZVByb3AoTmV3Q29tcG9uZW50LnByb3RvdHlwZS5zY2hlbWEpOwoKICAvLyBLZWVwIHRyYWNrIG9mIGtleXMgdGhhdCBtYXkgcG90ZW50aWFsbHkgY2hhbmdlIHRoZSBzY2hlbWEuCiAgaWYgKCFzY2hlbWFJc1NpbmdsZVByb3ApIHsKICAgIE5ld0NvbXBvbmVudC5wcm90b3R5cGUuc2NoZW1hQ2hhbmdlS2V5cyA9IFtdOwogICAgZm9yIChwcm9wZXJ0eU5hbWUgaW4gc2NoZW1hKSB7CiAgICAgIGlmIChzY2hlbWFbcHJvcGVydHlOYW1lXS5zY2hlbWFDaGFuZ2UpIHsKICAgICAgICBOZXdDb21wb25lbnQucHJvdG90eXBlLnNjaGVtYUNoYW5nZUtleXMucHVzaChwcm9wZXJ0eU5hbWUpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBDcmVhdGUgb2JqZWN0IHBvb2wgZm9yIGNsYXNzIG9mIGNvbXBvbmVudHMuCiAgb2JqZWN0UG9vbHNbbmFtZV0gPSB1dGlscy5vYmplY3RQb29sLmNyZWF0ZVBvb2woKTsKCiAgY29tcG9uZW50c1tuYW1lXSA9IHsKICAgIENvbXBvbmVudDogTmV3Q29tcG9uZW50LAogICAgZGVwZW5kZW5jaWVzOiBOZXdDb21wb25lbnQucHJvdG90eXBlLmRlcGVuZGVuY2llcywKICAgIGlzU2luZ2xlUHJvcDogc2NoZW1hSXNTaW5nbGVQcm9wLAogICAgbXVsdGlwbGU6IE5ld0NvbXBvbmVudC5wcm90b3R5cGUubXVsdGlwbGUsCiAgICBuYW1lOiBuYW1lLAogICAgcGFyc2U6IE5ld0NvbXBvbmVudC5wcm90b3R5cGUucGFyc2UsCiAgICBwYXJzZUF0dHJWYWx1ZUZvckNhY2hlOiBOZXdDb21wb25lbnQucHJvdG90eXBlLnBhcnNlQXR0clZhbHVlRm9yQ2FjaGUsCiAgICBzY2hlbWE6IHNjaGVtYSwKICAgIHN0cmluZ2lmeTogTmV3Q29tcG9uZW50LnByb3RvdHlwZS5zdHJpbmdpZnksCiAgICB0eXBlOiBOZXdDb21wb25lbnQucHJvdG90eXBlLnR5cGUKICB9OwogIHJldHVybiBOZXdDb21wb25lbnQ7Cn07CgovKioKKiBDbG9uZSBjb21wb25lbnQgZGF0YS4KKiBDbG9uZSBvbmx5IHRoZSBwcm9wZXJ0aWVzIHRoYXQgYXJlIHBsYWluIG9iamVjdHMgd2hpbGUga2VlcGluZyBhIHJlZmVyZW5jZSBmb3IgdGhlIHJlc3QuCioKKiBAcGFyYW0gZGF0YSAtIENvbXBvbmVudCBkYXRhIHRvIGNsb25lLgoqIEByZXR1cm5zIENsb25lZCBkYXRhLgoqLwpmdW5jdGlvbiBjb3B5RGF0YSAoZGVzdCwgc291cmNlRGF0YSkgewogIHZhciBwYXJzZWRQcm9wZXJ0eTsKICB2YXIga2V5OwogIGZvciAoa2V5IGluIHNvdXJjZURhdGEpIHsKICAgIGlmIChzb3VyY2VEYXRhW2tleV0gPT09IHVuZGVmaW5lZCkgeyBjb250aW51ZTsgfQogICAgcGFyc2VkUHJvcGVydHkgPSBzb3VyY2VEYXRhW2tleV07CiAgICBkZXN0W2tleV0gPSBpc09iamVjdE9yQXJyYXkocGFyc2VkUHJvcGVydHkpCiAgICAgID8gdXRpbHMuY2xvbmUocGFyc2VkUHJvcGVydHkpCiAgICAgIDogcGFyc2VkUHJvcGVydHk7CiAgfQogIHJldHVybiBkZXN0Owp9CgovKioKKiBPYmplY3QgZXh0ZW5kaW5nIHdpdGggY2hlY2tpbmcgZm9yIHNpbmdsZS1wcm9wZXJ0eSBzY2hlbWEuCioKKiBAcGFyYW0gZGVzdCAtIERlc3RpbmF0aW9uIG9iamVjdCBvciB2YWx1ZS4KKiBAcGFyYW0gc291cmNlIC0gU291cmNlIG9iamVjdCBvciB2YWx1ZQoqIEBwYXJhbSB7Ym9vbGVhbn0gaXNPYmplY3RCYXNlZCAtIFdoZXRoZXIgdmFsdWVzIGFyZSBvYmplY3RzLgoqIEByZXR1cm5zIE92ZXJyaWRkZW4gb2JqZWN0IG9yIHZhbHVlLgoqLwpmdW5jdGlvbiBleHRlbmRQcm9wZXJ0aWVzIChkZXN0LCBzb3VyY2UsIGlzT2JqZWN0QmFzZWQpIHsKICB2YXIga2V5OwogIGlmIChpc09iamVjdEJhc2VkICYmIHNvdXJjZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZVtrZXldID09PSB1bmRlZmluZWQpIHsgY29udGludWU7IH0KICAgICAgaWYgKHNvdXJjZVtrZXldICYmIHNvdXJjZVtrZXldLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsKICAgICAgICBkZXN0W2tleV0gPSB1dGlscy5jbG9uZShzb3VyY2Vba2V5XSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVzdFtrZXldID0gc291cmNlW2tleV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkZXN0OwogIH0KICByZXR1cm4gc291cmNlOwp9CgovKioKICogQ2hlY2tzIGlmIGEgY29tcG9uZW50IGhhcyBkZWZpbmVkIGEgbWV0aG9kIHRoYXQgbmVlZHMgdG8gcnVuIGV2ZXJ5IGZyYW1lLgogKi8KZnVuY3Rpb24gaGFzQmVoYXZpb3IgKGNvbXBvbmVudCkgewogIHJldHVybiBjb21wb25lbnQudGljayB8fCBjb21wb25lbnQudG9jazsKfQoKLyoqCiAqIFdyYXBwZXIgZm9yIGRlZmluZWQgcGF1c2UgbWV0aG9kLgogKiBQYXVzZSBjb21wb25lbnQgYnkgcmVtb3ZpbmcgdGljayBiZWhhdmlvciBhbmQgY2FsbGluZyB1c2VyJ3MgcGF1c2UgbWV0aG9kLgogKgogKiBAcGFyYW0gcGF1c2VNZXRob2Qge2Z1bmN0aW9ufQogKi8KZnVuY3Rpb24gd3JhcFBhdXNlIChwYXVzZU1ldGhvZCkgewogIHJldHVybiBmdW5jdGlvbiBwYXVzZSAoKSB7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIGlmICghdGhpcy5pc1BsYXlpbmcpIHsgcmV0dXJuOyB9CiAgICBwYXVzZU1ldGhvZC5jYWxsKHRoaXMpOwogICAgdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKICAgIHRoaXMuZXZlbnRzRGV0YWNoKCk7CiAgICAvLyBSZW1vdmUgdGljayBiZWhhdmlvci4KICAgIGlmICghaGFzQmVoYXZpb3IodGhpcykpIHsgcmV0dXJuOyB9CiAgICBzY2VuZUVsLnJlbW92ZUJlaGF2aW9yKHRoaXMpOwogIH07Cn0KCi8qKgogKiBXcmFwcGVyIGZvciBkZWZpbmVkIHBsYXkgbWV0aG9kLgogKiBQbGF5IGNvbXBvbmVudCBieSBhZGRpbmcgdGljayBiZWhhdmlvciBhbmQgY2FsbGluZyB1c2VyJ3MgcGxheSBtZXRob2QuCiAqCiAqIEBwYXJhbSBwbGF5TWV0aG9kIHtmdW5jdGlvbn0KICovCmZ1bmN0aW9uIHdyYXBQbGF5IChwbGF5TWV0aG9kKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIHBsYXkgKCkgewogICAgdmFyIHNjZW5lRWwgPSB0aGlzLmVsLnNjZW5lRWw7CiAgICB2YXIgc2hvdWxkUGxheSA9IHRoaXMuZWwuaXNQbGF5aW5nICYmICF0aGlzLmlzUGxheWluZzsKICAgIGlmICghdGhpcy5pbml0aWFsaXplZCB8fCAhc2hvdWxkUGxheSkgeyByZXR1cm47IH0KICAgIHBsYXlNZXRob2QuY2FsbCh0aGlzKTsKICAgIHRoaXMuaXNQbGF5aW5nID0gdHJ1ZTsKICAgIHRoaXMuZXZlbnRzQXR0YWNoKCk7CiAgICAvLyBBZGQgdGljayBiZWhhdmlvci4KICAgIGlmICghaGFzQmVoYXZpb3IodGhpcykpIHsgcmV0dXJuOyB9CiAgICBzY2VuZUVsLmFkZEJlaGF2aW9yKHRoaXMpOwogIH07Cn0KCmZ1bmN0aW9uIGlzT2JqZWN0ICh2YWx1ZSkgewogIHJldHVybiB2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmICEodmFsdWUgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTEVsZW1lbnQpOwp9CgpmdW5jdGlvbiBpc09iamVjdE9yQXJyYXkgKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlICYmICh2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0IHx8IHZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheSkgJiYKICAgICAgICAgISh2YWx1ZSBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MRWxlbWVudCk7Cn0KCn0seyIuLi91dGlscy8iOjE3OSwiLi9zY2VuZS9zY2VuZXMiOjExMywiLi9zY2hlbWEiOjExNSwiLi9zeXN0ZW0iOjExN31dLDEwNzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBzY2hlbWEgPSBfZGVyZXFfKCcuL3NjaGVtYScpOwoKdmFyIHByb2Nlc3NTY2hlbWEgPSBzY2hlbWEucHJvY2VzczsKdmFyIGdlb21ldHJpZXMgPSBtb2R1bGUuZXhwb3J0cy5nZW9tZXRyaWVzID0ge307ICAvLyBSZWdpc3RlcmVkIGdlb21ldHJpZXMuCnZhciBnZW9tZXRyeU5hbWVzID0gbW9kdWxlLmV4cG9ydHMuZ2VvbWV0cnlOYW1lcyA9IFtdOyAgLy8gTmFtZXMgb2YgcmVnaXN0ZXJlZCBnZW9tZXRyaWVzLgp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKCi8qKgogKiBHZW9tZXRyeSBjbGFzcyBkZWZpbml0aW9uLgogKgogKiBHZW9tZXRyaWVzIGV4dGVuZCB0aGUgZ2VvbWV0cnkgY29tcG9uZW50IEFQSSB0byBjcmVhdGUgYW5kIHJlZ2lzdGVyIGdlb21ldHJ5IHR5cGVzLgogKi8KdmFyIEdlb21ldHJ5ID0gbW9kdWxlLmV4cG9ydHMuR2VvbWV0cnkgPSBmdW5jdGlvbiAoKSB7fTsKCkdlb21ldHJ5LnByb3RvdHlwZSA9IHsKICAvKioKICAgKiBDb250YWlucyB0aGUgdHlwZSBzY2hlbWEgYW5kIGRlZmF1bHRzIGZvciB0aGUgZGF0YSB2YWx1ZXMuCiAgICogRGF0YSBpcyBjb2VyY2VkIGludG8gdGhlIHR5cGVzIG9mIHRoZSB2YWx1ZXMgb2YgdGhlIGRlZmF1bHRzLgogICAqLwogIHNjaGVtYToge30sCgogIC8qKgogICAqIEluaXQgaGFuZGxlci4gU2ltaWxhciB0byBhdHRhY2hlZENhbGxiYWNrLgogICAqIENhbGxlZCBkdXJpbmcgc2hhZGVyIGluaXRpYWxpemF0aW9uIGFuZCBpcyBvbmx5IHJ1biBvbmNlLgogICAqLwogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7CiAgICByZXR1cm4gdGhpcy5nZW9tZXRyeTsKICB9LAoKICAvKioKICAgKiBVcGRhdGUgaGFuZGxlci4gU2ltaWxhciB0byBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2suCiAgICogQ2FsbGVkIHdoZW5ldmVyIHRoZSBhc3NvY2lhdGVkIGdlb21ldHJ5IGRhdGEgY2hhbmdlcy4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gTmV3IGdlb21ldHJ5IGRhdGEuCiAgICovCiAgdXBkYXRlOiBmdW5jdGlvbiAoZGF0YSkgeyAvKiBuby1vcCAqLyB9Cn07CgovKioKICogUmVnaXN0ZXJzIGEgZ2VvbWV0cnkgdG8gQS1GcmFtZS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBHZW9tZXRyeSBuYW1lLgogKiBAcGFyYW0ge29iamVjdH0gZGVmaW5pdGlvbiAtIEdlb21ldHJ5IHByb3BlcnR5IGFuZCBtZXRob2RzLgogKiBAcmV0dXJucyB7b2JqZWN0fSBHZW9tZXRyeS4KICovCm1vZHVsZS5leHBvcnRzLnJlZ2lzdGVyR2VvbWV0cnkgPSBmdW5jdGlvbiAobmFtZSwgZGVmaW5pdGlvbikgewogIHZhciBOZXdHZW9tZXRyeTsKICB2YXIgcHJvdG8gPSB7fTsKCiAgLy8gRm9ybWF0IGRlZmluaXRpb24gb2JqZWN0IHRvIHByb3RvdHlwZSBvYmplY3QuCiAgT2JqZWN0LmtleXMoZGVmaW5pdGlvbikuZm9yRWFjaChmdW5jdGlvbiBleHBhbmREZWZpbml0aW9uIChrZXkpIHsKICAgIHByb3RvW2tleV0gPSB7CiAgICAgIHZhbHVlOiBkZWZpbml0aW9uW2tleV0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9OwogIH0pOwoKICBpZiAoZ2VvbWV0cmllc1tuYW1lXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgZ2VvbWV0cnkgYCcgKyBuYW1lICsgJ2AgaGFzIGJlZW4gYWxyZWFkeSByZWdpc3RlcmVkJyk7CiAgfQogIE5ld0dlb21ldHJ5ID0gZnVuY3Rpb24gKCkgeyBHZW9tZXRyeS5jYWxsKHRoaXMpOyB9OwogIE5ld0dlb21ldHJ5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR2VvbWV0cnkucHJvdG90eXBlLCBwcm90byk7CiAgTmV3R2VvbWV0cnkucHJvdG90eXBlLm5hbWUgPSBuYW1lOwogIE5ld0dlb21ldHJ5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE5ld0dlb21ldHJ5OwogIGdlb21ldHJpZXNbbmFtZV0gPSB7CiAgICBHZW9tZXRyeTogTmV3R2VvbWV0cnksCiAgICBzY2hlbWE6IHByb2Nlc3NTY2hlbWEoTmV3R2VvbWV0cnkucHJvdG90eXBlLnNjaGVtYSkKICB9OwogIGdlb21ldHJ5TmFtZXMucHVzaChuYW1lKTsKICByZXR1cm4gTmV3R2VvbWV0cnk7Cn07Cgp9LHsiLi4vbGliL3RocmVlIjoxNTQsIi4vc2NoZW1hIjoxMTV9XSwxMDg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgY29vcmRpbmF0ZXMgPSBfZGVyZXFfKCcuLi91dGlscy9jb29yZGluYXRlcycpOwp2YXIgZGVidWcgPSBfZGVyZXFfKCdkZWJ1ZycpOwoKdmFyIGVycm9yID0gZGVidWcoJ2NvcmU6cHJvcGVydHlUeXBlczp3YXJuJyk7CnZhciB3YXJuID0gZGVidWcoJ2NvcmU6cHJvcGVydHlUeXBlczp3YXJuJyk7Cgp2YXIgcHJvcGVydHlUeXBlcyA9IG1vZHVsZS5leHBvcnRzLnByb3BlcnR5VHlwZXMgPSB7fTsKdmFyIG5vbkNoYXJSZWdleCA9IC9bLD4gLltcXTpdLzsKdmFyIHVybFJlZ2V4ID0gL1x1cmxcKCguKylcKS87CgovLyBCdWlsdC1pbiBwcm9wZXJ0eSB0eXBlcy4KcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ2F1ZGlvJywgJycsIGFzc2V0UGFyc2UpOwpyZWdpc3RlclByb3BlcnR5VHlwZSgnYXJyYXknLCBbXSwgYXJyYXlQYXJzZSwgYXJyYXlTdHJpbmdpZnkpOwpyZWdpc3RlclByb3BlcnR5VHlwZSgnYXNzZXQnLCAnJywgYXNzZXRQYXJzZSk7CnJlZ2lzdGVyUHJvcGVydHlUeXBlKCdib29sZWFuJywgZmFsc2UsIGJvb2xQYXJzZSk7CnJlZ2lzdGVyUHJvcGVydHlUeXBlKCdjb2xvcicsICcjRkZGJywgZGVmYXVsdFBhcnNlLCBkZWZhdWx0U3RyaW5naWZ5KTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ2ludCcsIDAsIGludFBhcnNlKTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ251bWJlcicsIDAsIG51bWJlclBhcnNlKTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ21hcCcsICcnLCBhc3NldFBhcnNlKTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ21vZGVsJywgJycsIGFzc2V0UGFyc2UpOwpyZWdpc3RlclByb3BlcnR5VHlwZSgnc2VsZWN0b3InLCBudWxsLCBzZWxlY3RvclBhcnNlLCBzZWxlY3RvclN0cmluZ2lmeSk7CnJlZ2lzdGVyUHJvcGVydHlUeXBlKCdzZWxlY3RvckFsbCcsIG51bGwsIHNlbGVjdG9yQWxsUGFyc2UsIHNlbGVjdG9yQWxsU3RyaW5naWZ5KTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ3NyYycsICcnLCBzcmNQYXJzZSk7CnJlZ2lzdGVyUHJvcGVydHlUeXBlKCdzdHJpbmcnLCAnJywgZGVmYXVsdFBhcnNlLCBkZWZhdWx0U3RyaW5naWZ5KTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ3RpbWUnLCAwLCBpbnRQYXJzZSk7CnJlZ2lzdGVyUHJvcGVydHlUeXBlKCd2ZWMyJywge3g6IDAsIHk6IDB9LCB2ZWNQYXJzZSwgY29vcmRpbmF0ZXMuc3RyaW5naWZ5KTsKcmVnaXN0ZXJQcm9wZXJ0eVR5cGUoJ3ZlYzMnLCB7eDogMCwgeTogMCwgejogMH0sIHZlY1BhcnNlLCBjb29yZGluYXRlcy5zdHJpbmdpZnkpOwpyZWdpc3RlclByb3BlcnR5VHlwZSgndmVjNCcsIHt4OiAwLCB5OiAwLCB6OiAwLCB3OiAxfSwgdmVjUGFyc2UsIGNvb3JkaW5hdGVzLnN0cmluZ2lmeSk7CgovKioKICogUmVnaXN0ZXIgYSBwYXJzZXIgZm9yIHJlLXVzZSBzdWNoIHRoYXQgd2hlbiBzb21lb25lIHVzZXMgYHR5cGVgIGluIHRoZSBzY2hlbWEsCiAqIGBzY2hlbWEucHJvY2Vzc2Agd2lsbCBzZXQgdGhlIHByb3BlcnR5IGBwYXJzZWAgYW5kIGBzdHJpbmdpZnlgLgogKgogKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFR5cGUgbmFtZS4KICogQHBhcmFtIFtkZWZhdWx0VmFsdWU9bnVsbF0gLQogKiAgIERlZmF1bHQgdmFsdWUgdG8gdXNlIGlmIGNvbXBvbmVudCBkb2VzIG5vdCBkZWZpbmUgZGVmYXVsdCB2YWx1ZS4KICogQHBhcmFtIHtmdW5jdGlvbn0gW3BhcnNlPWRlZmF1bHRQYXJzZV0gLSBQYXJzZSBzdHJpbmcgZnVuY3Rpb24uCiAqIEBwYXJhbSB7ZnVuY3Rpb259IFtzdHJpbmdpZnk9ZGVmYXVsdFN0cmluZ2lmeV0gLSBTdHJpbmdpZnkgdG8gRE9NIGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gcmVnaXN0ZXJQcm9wZXJ0eVR5cGUgKHR5cGUsIGRlZmF1bHRWYWx1ZSwgcGFyc2UsIHN0cmluZ2lmeSkgewogIGlmICgndHlwZScgaW4gcHJvcGVydHlUeXBlcykgewogICAgZXJyb3IoJ1Byb3BlcnR5IHR5cGUgJyArIHR5cGUgKyAnIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4nKTsKICAgIHJldHVybjsKICB9CgogIHByb3BlcnR5VHlwZXNbdHlwZV0gPSB7CiAgICBkZWZhdWx0OiBkZWZhdWx0VmFsdWUsCiAgICBwYXJzZTogcGFyc2UgfHwgZGVmYXVsdFBhcnNlLAogICAgc3RyaW5naWZ5OiBzdHJpbmdpZnkgfHwgZGVmYXVsdFN0cmluZ2lmeQogIH07Cn0KbW9kdWxlLmV4cG9ydHMucmVnaXN0ZXJQcm9wZXJ0eVR5cGUgPSByZWdpc3RlclByb3BlcnR5VHlwZTsKCmZ1bmN0aW9uIGFycmF5UGFyc2UgKHZhbHVlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7IHJldHVybiB2YWx1ZTsgfQogIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgeyByZXR1cm4gW107IH0KICByZXR1cm4gdmFsdWUuc3BsaXQoJywnKS5tYXAodHJpbSk7CiAgZnVuY3Rpb24gdHJpbSAoc3RyKSB7IHJldHVybiBzdHIudHJpbSgpOyB9Cn0KCmZ1bmN0aW9uIGFycmF5U3RyaW5naWZ5ICh2YWx1ZSkgewogIHJldHVybiB2YWx1ZS5qb2luKCcsICcpOwp9CgovKioKICogRm9yIGdlbmVyYWwgYXNzZXRzLgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgLSBDYW4gZWl0aGVyIGJlIGB1cmwoPHZhbHVlPilgLCBhbiBJRCBzZWxlY3RvciB0byBhbiBhc3NldCwgb3IKICogICBqdXN0IHN0cmluZy4KICogQHJldHVybnMge3N0cmluZ30gUGFyc2VkIHZhbHVlIGZyb20gYHVybCg8dmFsdWU+KWAsIHNyYyBmcm9tIGA8c29tZWFzc2V0IHNyYz5gLCBvcgogKiAgIGp1c3Qgc3RyaW5nLgogKi8KZnVuY3Rpb24gYXNzZXRQYXJzZSAodmFsdWUpIHsKICB2YXIgZWw7CiAgdmFyIHBhcnNlZFVybDsKCiAgLy8gSWYgYW4gZWxlbWVudCB3YXMgcHJvdmlkZWQgKGUuZy4gY2FudmFzIG9yIHZpZGVvKSwganVzdCByZXR1cm4gaXQuCiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHsgcmV0dXJuIHZhbHVlOyB9CgogIC8vIFdyYXBwZWQgYHVybCgpYCBpbiBjYXNlIG9mIGRhdGEgVVJJLgogIHBhcnNlZFVybCA9IHZhbHVlLm1hdGNoKHVybFJlZ2V4KTsKICBpZiAocGFyc2VkVXJsKSB7IHJldHVybiBwYXJzZWRVcmxbMV07IH0KCiAgLy8gSUQuCiAgaWYgKHZhbHVlLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHZhbHVlLnN1YnN0cmluZygxKSk7CiAgICBpZiAoZWwpIHsKICAgICAgLy8gUGFzcyB0aHJvdWdoIG1lZGlhIGVsZW1lbnRzLiBJZiB3ZSBoYXZlIHRoZSBlbGVtZW50cywgd2UgZG9uJ3QgaGF2ZSB0byBjYWxsCiAgICAgIC8vIHRocmVlLmpzIGxvYWRlcnMgd2hpY2ggd291bGQgcmUtcmVxdWVzdCB0aGUgYXNzZXRzLgogICAgICBpZiAoZWwudGFnTmFtZSA9PT0gJ0NBTlZBUycgfHwgZWwudGFnTmFtZSA9PT0gJ1ZJREVPJyB8fCBlbC50YWdOYW1lID09PSAnSU1HJykgewogICAgICAgIHJldHVybiBlbDsKICAgICAgfQogICAgICByZXR1cm4gZWwuZ2V0QXR0cmlidXRlKCdzcmMnKTsKICAgIH0KICAgIHdhcm4oJyInICsgdmFsdWUgKyAnIiBhc3NldCBub3QgZm91bmQuJyk7CiAgICByZXR1cm47CiAgfQoKICAvLyBOb24td3JhcHBlZCB1cmwoKS4KICByZXR1cm4gdmFsdWU7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRQYXJzZSAodmFsdWUpIHsKICByZXR1cm4gdmFsdWU7Cn0KCmZ1bmN0aW9uIGRlZmF1bHRTdHJpbmdpZnkgKHZhbHVlKSB7CiAgaWYgKHZhbHVlID09PSBudWxsKSB7IHJldHVybiAnbnVsbCc7IH0KICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTsKfQoKZnVuY3Rpb24gYm9vbFBhcnNlICh2YWx1ZSkgewogIHJldHVybiB2YWx1ZSAhPT0gJ2ZhbHNlJyAmJiB2YWx1ZSAhPT0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGludFBhcnNlICh2YWx1ZSkgewogIHJldHVybiBwYXJzZUludCh2YWx1ZSwgMTApOwp9CgpmdW5jdGlvbiBudW1iZXJQYXJzZSAodmFsdWUpIHsKICByZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZSwgMTApOwp9CgpmdW5jdGlvbiBzZWxlY3RvclBhcnNlICh2YWx1ZSkgewogIGlmICghdmFsdWUpIHsgcmV0dXJuIG51bGw7IH0KICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgeyByZXR1cm4gdmFsdWU7IH0KICBpZiAodmFsdWVbMF0gPT09ICcjJyAmJiAhbm9uQ2hhclJlZ2V4LnRlc3QodmFsdWUpKSB7CiAgICAvLyBXaGVuIHNlbGVjdGluZyBlbGVtZW50IGJ5IElEIG9ubHksIHVzZSBnZXRFbGVtZW50QnlJZCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlLgogICAgLy8gRG9uJ3QgbWF0Y2ggbGlrZSAjbXlJZCAuY2hpbGQuCiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodmFsdWUuc3Vic3RyaW5nKDEpKTsKICB9CiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodmFsdWUpOwp9CgpmdW5jdGlvbiBzZWxlY3RvckFsbFBhcnNlICh2YWx1ZSkgewogIGlmICghdmFsdWUpIHsgcmV0dXJuIG51bGw7IH0KICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgeyByZXR1cm4gdmFsdWU7IH0KICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWx1ZSksIDApOwp9CgpmdW5jdGlvbiBzZWxlY3RvclN0cmluZ2lmeSAodmFsdWUpIHsKICBpZiAodmFsdWUuZ2V0QXR0cmlidXRlKSB7CiAgICByZXR1cm4gJyMnICsgdmFsdWUuZ2V0QXR0cmlidXRlKCdpZCcpOwogIH0KICByZXR1cm4gZGVmYXVsdFN0cmluZ2lmeSh2YWx1ZSk7Cn0KCmZ1bmN0aW9uIHNlbGVjdG9yQWxsU3RyaW5naWZ5ICh2YWx1ZSkgewogIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICByZXR1cm4gdmFsdWUubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgIHJldHVybiAnIycgKyBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaWQnKTsKICAgIH0pLmpvaW4oJywgJyk7CiAgfQogIHJldHVybiBkZWZhdWx0U3RyaW5naWZ5KHZhbHVlKTsKfQoKZnVuY3Rpb24gc3JjUGFyc2UgKHZhbHVlKSB7CiAgd2FybignYHNyY2AgcHJvcGVydHkgdHlwZSBpcyBkZXByZWNhdGVkLiBVc2UgYGFzc2V0YCBpbnN0ZWFkLicpOwogIHJldHVybiBhc3NldFBhcnNlKHZhbHVlKTsKfQoKZnVuY3Rpb24gdmVjUGFyc2UgKHZhbHVlKSB7CiAgcmV0dXJuIGNvb3JkaW5hdGVzLnBhcnNlKHZhbHVlLCB0aGlzLmRlZmF1bHQpOwp9CgovKioKICogVmFsaWRhdGUgdGhlIGRlZmF1bHQgdmFsdWVzIGluIGEgc2NoZW1hIHRvIG1hdGNoIHRoZWlyIHR5cGUuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gUHJvcGVydHkgdHlwZSBuYW1lLgogKiBAcGFyYW0gZGVmYXVsdFZhbCAtIFByb3BlcnR5IHR5cGUgZGVmYXVsdCB2YWx1ZS4KICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgZGVmYXVsdCB2YWx1ZSBpcyBhY2N1cmF0ZSBnaXZlbiB0aGUgdHlwZS4KICovCmZ1bmN0aW9uIGlzVmFsaWREZWZhdWx0VmFsdWUgKHR5cGUsIGRlZmF1bHRWYWwpIHsKICBpZiAodHlwZSA9PT0gJ2F1ZGlvJyAmJiB0eXBlb2YgZGVmYXVsdFZhbCAhPT0gJ3N0cmluZycpIHsgcmV0dXJuIGZhbHNlOyB9CiAgaWYgKHR5cGUgPT09ICdhcnJheScgJiYgIUFycmF5LmlzQXJyYXkoZGVmYXVsdFZhbCkpIHsgcmV0dXJuIGZhbHNlOyB9CiAgaWYgKHR5cGUgPT09ICdhc3NldCcgJiYgdHlwZW9mIGRlZmF1bHRWYWwgIT09ICdzdHJpbmcnKSB7IHJldHVybiBmYWxzZTsgfQogIGlmICh0eXBlID09PSAnYm9vbGVhbicgJiYgdHlwZW9mIGRlZmF1bHRWYWwgIT09ICdib29sZWFuJykgeyByZXR1cm4gZmFsc2U7IH0KICBpZiAodHlwZSA9PT0gJ2NvbG9yJyAmJiB0eXBlb2YgZGVmYXVsdFZhbCAhPT0gJ3N0cmluZycpIHsgcmV0dXJuIGZhbHNlOyB9CiAgaWYgKHR5cGUgPT09ICdpbnQnICYmIHR5cGVvZiBkZWZhdWx0VmFsICE9PSAnbnVtYmVyJykgeyByZXR1cm4gZmFsc2U7IH0KICBpZiAodHlwZSA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGRlZmF1bHRWYWwgIT09ICdudW1iZXInKSB7IHJldHVybiBmYWxzZTsgfQogIGlmICh0eXBlID09PSAnbWFwJyAmJiB0eXBlb2YgZGVmYXVsdFZhbCAhPT0gJ3N0cmluZycpIHsgcmV0dXJuIGZhbHNlOyB9CiAgaWYgKHR5cGUgPT09ICdtb2RlbCcgJiYgdHlwZW9mIGRlZmF1bHRWYWwgIT09ICdzdHJpbmcnKSB7IHJldHVybiBmYWxzZTsgfQogIGlmICh0eXBlID09PSAnc2VsZWN0b3InICYmIHR5cGVvZiBkZWZhdWx0VmFsICE9PSAnc3RyaW5nJyAmJgogICAgICBkZWZhdWx0VmFsICE9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfQogIGlmICh0eXBlID09PSAnc2VsZWN0b3JBbGwnICYmIHR5cGVvZiBkZWZhdWx0VmFsICE9PSAnc3RyaW5nJyAmJgogICAgICBkZWZhdWx0VmFsICE9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfQogIGlmICh0eXBlID09PSAnc3JjJyAmJiB0eXBlb2YgZGVmYXVsdFZhbCAhPT0gJ3N0cmluZycpIHsgcmV0dXJuIGZhbHNlOyB9CiAgaWYgKHR5cGUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBkZWZhdWx0VmFsICE9PSAnc3RyaW5nJykgeyByZXR1cm4gZmFsc2U7IH0KICBpZiAodHlwZSA9PT0gJ3RpbWUnICYmIHR5cGVvZiBkZWZhdWx0VmFsICE9PSAnbnVtYmVyJykgeyByZXR1cm4gZmFsc2U7IH0KICBpZiAodHlwZSA9PT0gJ3ZlYzInKSB7IHJldHVybiBpc1ZhbGlkRGVmYXVsdENvb3JkaW5hdGUoZGVmYXVsdFZhbCwgMik7IH0KICBpZiAodHlwZSA9PT0gJ3ZlYzMnKSB7IHJldHVybiBpc1ZhbGlkRGVmYXVsdENvb3JkaW5hdGUoZGVmYXVsdFZhbCwgMyk7IH0KICBpZiAodHlwZSA9PT0gJ3ZlYzQnKSB7IHJldHVybiBpc1ZhbGlkRGVmYXVsdENvb3JkaW5hdGUoZGVmYXVsdFZhbCwgNCk7IH0KICByZXR1cm4gdHJ1ZTsKfQptb2R1bGUuZXhwb3J0cy5pc1ZhbGlkRGVmYXVsdFZhbHVlID0gaXNWYWxpZERlZmF1bHRWYWx1ZTsKCi8qKgogKiBDaGVja3MgaWYgZGVmYXVsdCBjb29yZGluYXRlcyBhcmUgdmFsaWQuCiAqCiAqIEBwYXJhbSBwb3NzaWJsZUNvb3JkaW5hdGVzCiAqIEBwYXJhbSB7bnVtYmVyfSBkaW1lbnNpb25zIC0gMiBmb3IgMkQgVmVjdG9yLCAzIGZvciAzRCB2ZWN0b3IuCiAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIGNvb3JkaW5hdGVzIGFyZSBwYXJzZWQgY29ycmVjdGx5LgogKi8KZnVuY3Rpb24gaXNWYWxpZERlZmF1bHRDb29yZGluYXRlIChwb3NzaWJsZUNvb3JkaW5hdGVzLCBkaW1lbnNpb25zKSB7CiAgaWYgKHBvc3NpYmxlQ29vcmRpbmF0ZXMgPT09IG51bGwpIHsgcmV0dXJuIHRydWU7IH0KICBpZiAodHlwZW9mIHBvc3NpYmxlQ29vcmRpbmF0ZXMgIT09ICdvYmplY3QnKSB7IHJldHVybiBmYWxzZTsgfQoKICBpZiAoT2JqZWN0LmtleXMocG9zc2libGVDb29yZGluYXRlcykubGVuZ3RoICE9PSBkaW1lbnNpb25zKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfSBlbHNlIHsKICAgIHZhciB4ID0gcG9zc2libGVDb29yZGluYXRlcy54OwogICAgdmFyIHkgPSBwb3NzaWJsZUNvb3JkaW5hdGVzLnk7CiAgICB2YXIgeiA9IHBvc3NpYmxlQ29vcmRpbmF0ZXMuejsKICAgIHZhciB3ID0gcG9zc2libGVDb29yZGluYXRlcy53OwoKICAgIGlmICh0eXBlb2YgeCAhPT0gJ251bWJlcicgfHwgdHlwZW9mIHkgIT09ICdudW1iZXInKSB7IHJldHVybiBmYWxzZTsgfQogICAgaWYgKGRpbWVuc2lvbnMgPiAyICYmIHR5cGVvZiB6ICE9PSAnbnVtYmVyJykgeyByZXR1cm4gZmFsc2U7IH0KICAgIGlmIChkaW1lbnNpb25zID4gMyAmJiB0eXBlb2YgdyAhPT0gJ251bWJlcicpIHsgcmV0dXJuIGZhbHNlOyB9CiAgfQoKICByZXR1cm4gdHJ1ZTsKfQptb2R1bGUuZXhwb3J0cy5pc1ZhbGlkRGVmYXVsdENvb3JkaW5hdGUgPSBpc1ZhbGlkRGVmYXVsdENvb3JkaW5hdGU7Cgp9LHsiLi4vdXRpbHMvY29vcmRpbmF0ZXMiOjE3NCwiZGVidWciOjEwfV0sMTA5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyogZ2xvYmFsIFByb21pc2UsIHNjcmVlbiAqLwp2YXIgaW5pdE1ldGFUYWdzID0gX2RlcmVxXygnLi9tZXRhVGFncycpLmluamVjdDsKdmFyIGluaXRXYWtlbG9jayA9IF9kZXJlcV8oJy4vd2FrZWxvY2snKTsKdmFyIGxvYWRpbmdTY3JlZW4gPSBfZGVyZXFfKCcuL2xvYWRpbmdTY3JlZW4nKTsKdmFyIHJlID0gX2RlcmVxXygnLi4vYS1yZWdpc3Rlci1lbGVtZW50Jyk7CnZhciBzY2VuZXMgPSBfZGVyZXFfKCcuL3NjZW5lcycpOwp2YXIgc3lzdGVtcyA9IF9kZXJlcV8oJy4uL3N5c3RlbScpLnN5c3RlbXM7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uLy4uL2xpYi90aHJlZScpOwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi8uLi91dGlscy8nKTsKLy8gUmVxdWlyZSBhZnRlci4KdmFyIEFFbnRpdHkgPSBfZGVyZXFfKCcuLi9hLWVudGl0eScpOwp2YXIgQU5vZGUgPSBfZGVyZXFfKCcuLi9hLW5vZGUnKTsKdmFyIGluaXRQb3N0TWVzc2FnZUFQSSA9IF9kZXJlcV8oJy4vcG9zdE1lc3NhZ2UnKTsKCnZhciBiaW5kID0gdXRpbHMuYmluZDsKdmFyIGlzSU9TID0gdXRpbHMuZGV2aWNlLmlzSU9TKCk7CnZhciBpc01vYmlsZSA9IHV0aWxzLmRldmljZS5pc01vYmlsZSgpOwp2YXIgaXNXZWJYUkF2YWlsYWJsZSA9IHV0aWxzLmRldmljZS5pc1dlYlhSQXZhaWxhYmxlOwp2YXIgcmVnaXN0ZXJFbGVtZW50ID0gcmUucmVnaXN0ZXJFbGVtZW50Owp2YXIgd2FybiA9IHV0aWxzLmRlYnVnKCdjb3JlOmEtc2NlbmU6d2FybicpOwoKLyoqCiAqIFNjZW5lIGVsZW1lbnQsIGhvbGRzIGFsbCBlbnRpdGllcy4KICoKICogQG1lbWJlciB7YXJyYXl9IGJlaGF2aW9ycyAtIENvbXBvbmVudCBpbnN0YW5jZXMgdGhhdCBoYXZlIHJlZ2lzdGVyZWQgdGhlbXNlbHZlcyB0byBiZQogICAgICAgICAgIHVwZGF0ZWQgb24gZXZlcnkgdGljay4KICogQG1lbWJlciB7b2JqZWN0fSBjYW1lcmEgLSB0aHJlZS5qcyBDYW1lcmEgb2JqZWN0LgogKiBAbWVtYmVyIHtvYmplY3R9IGNhbnZhcwogKiBAbWVtYmVyIHtib29sfSBpc1NjZW5lIC0gRGlmZmVyZW50aWF0ZXMgYXMgc2NlbmUgZW50aXR5IGFzIG9wcG9zZWQgdG8gb3RoZXIgZW50aXRlcy4KICogQG1lbWJlciB7Ym9vbH0gaXNNb2JpbGUgLSBXaGV0aGVyIGJyb3dzZXIgaXMgbW9iaWxlICh2aWEgVUEgZGV0ZWN0aW9uKS4KICogQG1lbWJlciB7b2JqZWN0fSBvYmplY3QzRCAtIFJvb3QgdGhyZWUuanMgU2NlbmUgb2JqZWN0LgogKiBAbWVtYmVyIHtvYmplY3R9IHJlbmRlcmVyCiAqIEBtZW1iZXIge2Jvb2x9IHJlbmRlclN0YXJ0ZWQKICogQG1lbWJlciB7b2JqZWN0fSBzeXN0ZW1zIC0gUmVnaXN0ZXJlZCBpbnN0YW50aWF0ZWQgc3lzdGVtcy4KICogQG1lbWJlciB7bnVtYmVyfSB0aW1lCiAqLwptb2R1bGUuZXhwb3J0cy5BU2NlbmUgPSByZWdpc3RlckVsZW1lbnQoJ2Etc2NlbmUnLCB7CiAgcHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKEFFbnRpdHkucHJvdG90eXBlLCB7CiAgICBjcmVhdGVkQ2FsbGJhY2s6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmNsb2NrID0gbmV3IFRIUkVFLkNsb2NrKCk7CiAgICAgICAgdGhpcy5pc0lPUyA9IGlzSU9TOwogICAgICAgIHRoaXMuaXNNb2JpbGUgPSBpc01vYmlsZTsKICAgICAgICB0aGlzLmhhc1dlYlhSID0gaXNXZWJYUkF2YWlsYWJsZTsKICAgICAgICB0aGlzLmlzU2NlbmUgPSB0cnVlOwogICAgICAgIHRoaXMub2JqZWN0M0QgPSBuZXcgVEhSRUUuU2NlbmUoKTsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdGhpcy5vYmplY3QzRC5vbkFmdGVyUmVuZGVyID0gZnVuY3Rpb24gKHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhKSB7CiAgICAgICAgICAvLyBUSFJFRSBtYXkgc3dhcCB0aGUgY2FtZXJhIHVzZWQgZm9yIHRoZSByZW5kZXJpbmcgaWYgaW4gVlIsIHNvIHdlIHBhc3MgaXQgdG8gdG9jawogICAgICAgICAgaWYgKHNlbGYuaXNQbGF5aW5nKSB7IHNlbGYudG9jayhzZWxmLnRpbWUsIHNlbGYuZGVsdGEsIGNhbWVyYSk7IH0KICAgICAgICB9OwogICAgICAgIHRoaXMucmVuZGVyID0gYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7CiAgICAgICAgdGhpcy5zeXN0ZW1zID0ge307CiAgICAgICAgdGhpcy5zeXN0ZW1OYW1lcyA9IFtdOwogICAgICAgIHRoaXMudGltZSA9IHRoaXMuZGVsdGEgPSAwOwoKICAgICAgICB0aGlzLmJlaGF2aW9ycyA9IHt0aWNrOiBbXSwgdG9jazogW119OwogICAgICAgIHRoaXMuaGFzTG9hZGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLm9yaWdpbmFsSFRNTCA9IHRoaXMuaW5uZXJIVE1MOwoKICAgICAgICAvLyBEZWZhdWx0IGNvbXBvbmVudHMuCiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoJ2luc3BlY3RvcicsICcnKTsKICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgna2V5Ym9hcmQtc2hvcnRjdXRzJywgJycpOwogICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdzY3JlZW5zaG90JywgJycpOwogICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCd2ci1tb2RlLXVpJywgJycpOwogICAgICB9CiAgICB9LAoKICAgIGFkZEZ1bGxTY3JlZW5TdHlsZXM6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYS1mdWxsc2NyZWVuJyk7CiAgICAgIH0KICAgIH0sCgogICAgcmVtb3ZlRnVsbFNjcmVlblN0eWxlczogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdhLWZ1bGxzY3JlZW4nKTsKICAgICAgfQogICAgfSwKCiAgICBhdHRhY2hlZENhbGxiYWNrOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIC8vIFJlbmRlcmVyIGluaXRpYWxpemF0aW9uCiAgICAgICAgc2V0dXBDYW52YXModGhpcyk7CiAgICAgICAgdGhpcy5zZXR1cFJlbmRlcmVyKCk7CgogICAgICAgIHRoaXMucmVzaXplKCk7CiAgICAgICAgdGhpcy5hZGRGdWxsU2NyZWVuU3R5bGVzKCk7CiAgICAgICAgaW5pdFBvc3RNZXNzYWdlQVBJKHRoaXMpOwoKICAgICAgICBpbml0TWV0YVRhZ3ModGhpcyk7CiAgICAgICAgaW5pdFdha2Vsb2NrKHRoaXMpOwoKICAgICAgICAvLyBIYW5kbGVyIHRvIGV4aXQgVlIgKGUuZy4sIE9jdWx1cyBCcm93c2VyIGJhY2sgYnV0dG9uKS4KICAgICAgICB0aGlzLm9uVlJQcmVzZW50Q2hhbmdlQm91bmQgPSBiaW5kKHRoaXMub25WUlByZXNlbnRDaGFuZ2UsIHRoaXMpOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgdGhpcy5vblZSUHJlc2VudENoYW5nZUJvdW5kKTsKCiAgICAgICAgLy8gQmluZCBmdW5jdGlvbnMuCiAgICAgICAgdGhpcy5lbnRlclZSQm91bmQgPSBmdW5jdGlvbiAoKSB7IHNlbGYuZW50ZXJWUigpOyB9OwogICAgICAgIHRoaXMuZXhpdFZSQm91bmQgPSBmdW5jdGlvbiAoKSB7IHNlbGYuZXhpdFZSKCk7IH07CiAgICAgICAgdGhpcy5leGl0VlJUcnVlQm91bmQgPSBmdW5jdGlvbiAoKSB7IHNlbGYuZXhpdFZSKHRydWUpOyB9OwogICAgICAgIHRoaXMucG9pbnRlclJlc3RyaWN0ZWRCb3VuZCA9IGZ1bmN0aW9uICgpIHsgc2VsZi5wb2ludGVyUmVzdHJpY3RlZCgpOyB9OwogICAgICAgIHRoaXMucG9pbnRlclVucmVzdHJpY3RlZEJvdW5kID0gZnVuY3Rpb24gKCkgeyBzZWxmLnBvaW50ZXJVbnJlc3RyaWN0ZWQoKTsgfTsKCiAgICAgICAgaWYgKCFpc1dlYlhSQXZhaWxhYmxlKSB7CiAgICAgICAgICAvLyBFeGl0IFZSIG9uIGB2cmRpc3BsYXlkZWFjdGl2YXRlYCAoZS5nLiB0YWtpbmcgb2ZmIFJpZnQgaGVhZHNldCkuCiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5ZGVhY3RpdmF0ZScsIHRoaXMuZXhpdFZSQm91bmQpOwoKICAgICAgICAgIC8vIEV4aXQgVlIgb24gYHZyZGlzcGxheWRpc2Nvbm5lY3RgIChlLmcuIHVucGx1Z2dpbmcgUmlmdCBoZWFkc2V0KS4KICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlkaXNjb25uZWN0JywgdGhpcy5leGl0VlJUcnVlQm91bmQpOwoKICAgICAgICAgIC8vIFJlZ2lzdGVyIGZvciBtb3VzZSByZXN0cmljdGVkIGV2ZW50cyB3aGlsZSBpbiBWUgogICAgICAgICAgLy8gKGUuZy4gbW91c2Ugbm8gbG9uZ2VyIGF2YWlsYWJsZSBvbiBkZXNrdG9wIDJEIHZpZXcpCiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cG9pbnRlcnJlc3RyaWN0ZWQnLCB0aGlzLnBvaW50ZXJSZXN0cmljdGVkQm91bmQpOwoKICAgICAgICAgIC8vIFJlZ2lzdGVyIGZvciBtb3VzZSB1bnJlc3RyaWN0ZWQgZXZlbnRzIHdoaWxlIGluIFZSCiAgICAgICAgICAvLyAoZS5nLiBtb3VzZSBvbmNlIGFnYWluIGF2YWlsYWJsZSBvbiBkZXNrdG9wIDJEIHZpZXcpCiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cG9pbnRlcnVucmVzdHJpY3RlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvaW50ZXJVbnJlc3RyaWN0ZWRCb3VuZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBDYW1lcmEgc2V0IHVwIGJ5IGNhbWVyYSBzeXN0ZW0uCiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdjYW1lcmFyZWFkeScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNlbGYuYXR0YWNoZWRDYWxsYmFja1Bvc3RDYW1lcmEoKTsKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5pbml0U3lzdGVtcygpOwogICAgICB9CiAgICB9LAoKICAgIGF0dGFjaGVkQ2FsbGJhY2tQb3N0Q2FtZXJhOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJlc2l6ZTsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHJlc2l6ZSA9IGJpbmQodGhpcy5yZXNpemUsIHRoaXMpOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgcmVzaXplKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgYSBXZWJraXQgYnVnIChodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTcwNTk1KQogICAgICAgICAgLy8gd2hlcmUgdGhlIHdpbmRvdyBkb2VzIG5vdCBjb250YWluIHRoZSBjb3JyZWN0IHZpZXdwb3J0IHNpemUKICAgICAgICAgIC8vIGFmdGVyIGFuIG9yaWVudGF0aW9uIGNoYW5nZS4gVGhlIHdpbmRvdyBzaXplIGlzIGNvcnJlY3QgaWYgdGhlIG9wZXJhdGlvbgogICAgICAgICAgLy8gaXMgcG9zdHBvbmVkIGEgZmV3IG1pbGxpc2Vjb25kcy4KICAgICAgICAgIC8vIHNlbGYucmVzaXplIGNhbiBiZSBjYWxsZWQgZGlyZWN0bHkgb25jZSB0aGUgYnVnIGFib3ZlIGlzIGZpeGVkLgogICAgICAgICAgaWYgKHNlbGYuaXNJT1MpIHsKICAgICAgICAgICAgc2V0VGltZW91dChyZXNpemUsIDEwMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXNpemUoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXkoKTsKCiAgICAgICAgLy8gQWRkIHRvIHNjZW5lIGluZGV4LgogICAgICAgIHNjZW5lcy5wdXNoKHRoaXMpOwogICAgICB9LAogICAgICB3cml0YWJsZTogd2luZG93LmRlYnVnCiAgICB9LAoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBhbGwgc3lzdGVtcy4KICAgICAqLwogICAgaW5pdFN5c3RlbXM6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbmFtZTsKCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBjYW1lcmEgc3lzdGVtIGZpcnN0LgogICAgICAgIHRoaXMuaW5pdFN5c3RlbSgnY2FtZXJhJyk7CgogICAgICAgIGZvciAobmFtZSBpbiBzeXN0ZW1zKSB7CiAgICAgICAgICBpZiAobmFtZSA9PT0gJ2NhbWVyYScpIHsgY29udGludWU7IH0KICAgICAgICAgIHRoaXMuaW5pdFN5c3RlbShuYW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplIGEgc3lzdGVtLgogICAgICovCiAgICBpbml0U3lzdGVtOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgIGlmICh0aGlzLnN5c3RlbXNbbmFtZV0pIHsgcmV0dXJuOyB9CiAgICAgICAgdGhpcy5zeXN0ZW1zW25hbWVdID0gbmV3IHN5c3RlbXNbbmFtZV0odGhpcyk7CiAgICAgICAgdGhpcy5zeXN0ZW1OYW1lcy5wdXNoKG5hbWUpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogU2h1dCBkb3duIHNjZW5lIG9uIGRldGFjaC4KICAgICAqLwogICAgZGV0YWNoZWRDYWxsYmFjazogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIC8vIFJlbW92ZSBmcm9tIHNjZW5lIGluZGV4LgogICAgICAgIHZhciBzY2VuZUluZGV4ID0gc2NlbmVzLmluZGV4T2YodGhpcyk7CiAgICAgICAgc2NlbmVzLnNwbGljZShzY2VuZUluZGV4LCAxKTsKCiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLm9uVlJQcmVzZW50Q2hhbmdlQm91bmQpOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlhY3RpdmF0ZScsIHRoaXMuZW50ZXJWUkJvdW5kKTsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5ZGVhY3RpdmF0ZScsIHRoaXMuZXhpdFZSQm91bmQpOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd2cmRpc3BsYXljb25uZWN0JywgdGhpcy5lbnRlclZSQm91bmQpOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlkaXNjb25uZWN0JywgdGhpcy5leGl0VlJUcnVlQm91bmQpOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwb2ludGVycmVzdHJpY3RlZCcsIHRoaXMucG9pbnRlclJlc3RyaWN0ZWRCb3VuZCk7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXBvaW50ZXJ1bnJlc3RyaWN0ZWQnLCB0aGlzLnBvaW50ZXJVbnJlc3RyaWN0ZWRCb3VuZCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBBZGQgdGlja3MgYW5kIHRvY2tzLgogICAgICoKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBiZWhhdmlvciAtIEEgY29tcG9uZW50LgogICAgICovCiAgICBhZGRCZWhhdmlvcjogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGJlaGF2aW9yKSB7CiAgICAgICAgdmFyIGJlaGF2aW9yQXJyOwogICAgICAgIHZhciBiZWhhdmlvcnMgPSB0aGlzLmJlaGF2aW9yczsKICAgICAgICB2YXIgYmVoYXZpb3JUeXBlOwoKICAgICAgICAvLyBDaGVjayBpZiBiZWhhdmlvciBoYXMgdGljayBhbmQvb3IgdG9jayBhbmQgYWRkIHRoZSBiZWhhdmlvciB0byB0aGUgYXBwcm9wcmlhdGUgbGlzdC4KICAgICAgICBmb3IgKGJlaGF2aW9yVHlwZSBpbiBiZWhhdmlvcnMpIHsKICAgICAgICAgIGlmICghYmVoYXZpb3JbYmVoYXZpb3JUeXBlXSkgeyBjb250aW51ZTsgfQogICAgICAgICAgYmVoYXZpb3JBcnIgPSB0aGlzLmJlaGF2aW9yc1tiZWhhdmlvclR5cGVdOwogICAgICAgICAgaWYgKGJlaGF2aW9yQXJyLmluZGV4T2YoYmVoYXZpb3IpID09PSAtMSkgewogICAgICAgICAgICBiZWhhdmlvckFyci5wdXNoKGJlaGF2aW9yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBGb3IgdGVzdHMuCiAgICAgKi8KICAgIGdldFBvaW50ZXJMb2NrRWxlbWVudDogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBkb2N1bWVudC5wb2ludGVyTG9ja0VsZW1lbnQ7CiAgICAgIH0sCiAgICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICAgIH0sCgogICAgLyoqCiAgICAgKiBGb3IgdGVzdHMuCiAgICAgKi8KICAgIGNoZWNrSGVhZHNldENvbm5lY3RlZDogewogICAgICB2YWx1ZTogdXRpbHMuZGV2aWNlLmNoZWNrSGVhZHNldENvbm5lY3RlZCwKICAgICAgd3JpdGFibGU6IHdpbmRvdy5kZWJ1ZwogICAgfSwKCiAgICAvKioKICAgICAqIENhbGwgYHJlcXVlc3RQcmVzZW50YCBpZiBXZWJWUiBvciBXZWJWUiBwb2x5ZmlsbC4KICAgICAqIENhbGwgYHJlcXVlc3RGdWxsc2NyZWVuYCBvbiBkZXNrdG9wLgogICAgICogSGFuZGxlIGV2ZW50cywgc3RhdGVzLCBmdWxsc2NyZWVuIHN0eWxlcy4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICAqLwogICAgZW50ZXJWUjogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgdnJEaXNwbGF5OwogICAgICAgIHZhciB2ck1hbmFnZXIgPSBzZWxmLnJlbmRlcmVyLnZyOwoKICAgICAgICAvLyBEb24ndCBlbnRlciBWUiBpZiBhbHJlYWR5IGluIFZSLgogICAgICAgIGlmICh0aGlzLmlzKCd2ci1tb2RlJykpIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgnQWxyZWFkeSBpbiBWUi4nKTsgfQoKICAgICAgICAvLyBIYXMgVlIuCiAgICAgICAgaWYgKHRoaXMuY2hlY2tIZWFkc2V0Q29ubmVjdGVkKCkgfHwgdGhpcy5pc01vYmlsZSkgewogICAgICAgICAgdnJEaXNwbGF5ID0gdXRpbHMuZGV2aWNlLmdldFZSRGlzcGxheSgpOwogICAgICAgICAgdnJNYW5hZ2VyLmVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgdnJNYW5hZ2VyLnNldERldmljZSh2ckRpc3BsYXkpOwoKICAgICAgICAgIGlmICh0aGlzLmhhc1dlYlhSKSB7CiAgICAgICAgICAgIC8vIFhSIEFQSS4KICAgICAgICAgICAgaWYgKHRoaXMueHJTZXNzaW9uKSB7CiAgICAgICAgICAgICAgdGhpcy54clNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW5kJywgdGhpcy5leGl0VlJCb3VuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdnJEaXNwbGF5LnJlcXVlc3RTZXNzaW9uKHsKICAgICAgICAgICAgICBpbW1lcnNpdmU6IHRydWUsCiAgICAgICAgICAgICAgZXhjbHVzaXZlOiB0cnVlCiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gcmVxdWVzdFN1Y2Nlc3MgKHhyU2Vzc2lvbikgewogICAgICAgICAgICAgIHNlbGYueHJTZXNzaW9uID0geHJTZXNzaW9uOwogICAgICAgICAgICAgIHZyTWFuYWdlci5zZXRTZXNzaW9uKHhyU2Vzc2lvbik7CiAgICAgICAgICAgICAgeHJTZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZCcsIHNlbGYuZXhpdFZSQm91bmQpOwogICAgICAgICAgICAgIHhyU2Vzc2lvbi5yZXF1ZXN0RnJhbWVPZlJlZmVyZW5jZSgnc3RhZ2UnKS50aGVuKGZ1bmN0aW9uIChmcmFtZU9mUmVmZXJlbmNlKSB7CiAgICAgICAgICAgICAgICBzZWxmLmZyYW1lT2ZSZWZlcmVuY2UgPSBmcmFtZU9mUmVmZXJlbmNlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGVudGVyVlJTdWNjZXNzKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHZyRGlzcGxheS5pc1ByZXNlbnRpbmcgJiYKICAgICAgICAgICAgICAgICF3aW5kb3cuaGFzTmF0aXZlV2ViVlJJbXBsZW1lbnRhdGlvbikgewogICAgICAgICAgICAgIGVudGVyVlJTdWNjZXNzKCk7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZW5kZXJlclN5c3RlbSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdyZW5kZXJlcicpOwogICAgICAgICAgICB2YXIgcHJlc2VudGF0aW9uQXR0cmlidXRlcyA9IHsKICAgICAgICAgICAgICBoaWdoUmVmcmVzaFJhdGU6IHJlbmRlcmVyU3lzdGVtLmhpZ2hSZWZyZXNoUmF0ZSwKICAgICAgICAgICAgICBmb3ZlYXRpb25MZXZlbDogcmVuZGVyZXJTeXN0ZW0uZm92ZWF0aW9uTGV2ZWwKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiB2ckRpc3BsYXkucmVxdWVzdFByZXNlbnQoW3sKICAgICAgICAgICAgICBzb3VyY2U6IHRoaXMuY2FudmFzLAogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHByZXNlbnRhdGlvbkF0dHJpYnV0ZXMKICAgICAgICAgICAgfV0pLnRoZW4oZW50ZXJWUlN1Y2Nlc3MsIGVudGVyVlJGYWlsdXJlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICB9CgogICAgICAgIC8vIE5vIFZSLgogICAgICAgIGVudGVyVlJTdWNjZXNzKCk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwoKICAgICAgICAvLyBDYWxsYmFjayB0aGF0IGhhcHBlbnMgb24gZW50ZXIgVlIgc3VjY2VzcyBvciBlbnRlciBmdWxsc2NyZWVuIChhbnkgQVBJKS4KICAgICAgICBmdW5jdGlvbiBlbnRlclZSU3VjY2VzcyAoKSB7CiAgICAgICAgICBzZWxmLmFkZFN0YXRlKCd2ci1tb2RlJyk7CiAgICAgICAgICBzZWxmLmVtaXQoJ2VudGVyLXZyJywge3RhcmdldDogc2VsZn0pOwogICAgICAgICAgLy8gTG9jayB0byBsYW5kc2NhcGUgb3JpZW50YXRpb24gb24gbW9iaWxlLgogICAgICAgICAgaWYgKHNlbGYuaXNNb2JpbGUgJiYgc2NyZWVuLm9yaWVudGF0aW9uICYmIHNjcmVlbi5vcmllbnRhdGlvbi5sb2NrKSB7CiAgICAgICAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi5sb2NrKCdsYW5kc2NhcGUnKTsKICAgICAgICAgIH0KICAgICAgICAgIHNlbGYuYWRkRnVsbFNjcmVlblN0eWxlcygpOwoKICAgICAgICAgIC8vIE9uIG1vYmlsZSwgdGhlIHBvbHlmaWxsIGhhbmRsZXMgZnVsbHNjcmVlbi4KICAgICAgICAgIC8vIFRPRE86IDA3LzE2IENocm9taXVtIGJ1aWxkcyBicmVhayB3aGVuIGByZXF1ZXN0RnVsbHNjcmVlbmBpbmcgb24gYSBjYW52YXMKICAgICAgICAgIC8vIHRoYXQgd2UgYXJlIGFsc28gYHJlcXVlc3RQcmVzZW50YGluZy4gVW50aWwgdGhlbiwgZG9uJ3QgZnVsbHNjcmVlbiBpZiBoZWFkc2V0CiAgICAgICAgICAvLyBjb25uZWN0ZWQuCiAgICAgICAgICBpZiAoIXNlbGYuaXNNb2JpbGUgJiYgIXNlbGYuY2hlY2tIZWFkc2V0Q29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgcmVxdWVzdEZ1bGxzY3JlZW4oc2VsZi5jYW52YXMpOwogICAgICAgICAgfQoKICAgICAgICAgIHNlbGYucmVuZGVyZXIuc2V0QW5pbWF0aW9uTG9vcChzZWxmLnJlbmRlcik7CiAgICAgICAgICBzZWxmLnJlc2l6ZSgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZW50ZXJWUkZhaWx1cmUgKGVycikgewogICAgICAgICAgaWYgKGVyciAmJiBlcnIubWVzc2FnZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBlbnRlciBWUiBtb2RlIChgcmVxdWVzdFByZXNlbnRgKTogJyArIGVyci5tZXNzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGVudGVyIFZSIG1vZGUgKGByZXF1ZXN0UHJlc2VudGApLicpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0sCiAgICAgLyoqCiAgICAgKiBDYWxsIGBleGl0UHJlc2VudGAgaWYgV2ViVlIgLyBXZWJYUiBvciBXZWJWUiBwb2x5ZmlsbC4KICAgICAqIEhhbmRsZSBldmVudHMsIHN0YXRlcywgZnVsbHNjcmVlbiBzdHlsZXMuCiAgICAgKgogICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAgKi8KICAgIGV4aXRWUjogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgdnJEaXNwbGF5OwogICAgICAgIHZhciB2ck1hbmFnZXIgPSB0aGlzLnJlbmRlcmVyLnZyOwoKICAgICAgICAvLyBEb24ndCBleGl0IFZSIGlmIG5vdCBpbiBWUi4KICAgICAgICBpZiAoIXRoaXMuaXMoJ3ZyLW1vZGUnKSkgeyByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCdOb3QgaW4gVlIuJyk7IH0KCiAgICAgICAgLy8gSGFuZGxlIGV4aXRpbmcgVlIgaWYgbm90IHlldCBhbHJlYWR5IGFuZCBpbiBhIGhlYWRzZXQgb3IgcG9seWZpbGwuCiAgICAgICAgaWYgKHRoaXMuY2hlY2tIZWFkc2V0Q29ubmVjdGVkKCkgfHwgdGhpcy5pc01vYmlsZSkgewogICAgICAgICAgdnJNYW5hZ2VyLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgIHZyRGlzcGxheSA9IHV0aWxzLmRldmljZS5nZXRWUkRpc3BsYXkoKTsKICAgICAgICAgIGlmICh0aGlzLmhhc1dlYlhSKSB7CiAgICAgICAgICAgIHRoaXMueHJTZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VuZCcsIHRoaXMuZXhpdFZSQm91bmQpOwogICAgICAgICAgICB0aGlzLnhyU2Vzc2lvbi5lbmQoKTsKICAgICAgICAgICAgdnJNYW5hZ2VyLnNldFNlc3Npb24obnVsbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodnJEaXNwbGF5LmlzUHJlc2VudGluZykgewogICAgICAgICAgICAgIHJldHVybiB2ckRpc3BsYXkuZXhpdFByZXNlbnQoKS50aGVuKGV4aXRWUlN1Y2Nlc3MsIGV4aXRWUkZhaWx1cmUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBIYW5kbGUgZXhpdGluZyBWUiBpbiBhbGwgb3RoZXIgY2FzZXMgKDJEIGZ1bGxzY3JlZW4sIGV4dGVybmFsIGV4aXQgVlIgZXZlbnQpLgogICAgICAgIGV4aXRWUlN1Y2Nlc3MoKTsKCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwoKICAgICAgICBmdW5jdGlvbiBleGl0VlJTdWNjZXNzICgpIHsKICAgICAgICAgIHNlbGYucmVtb3ZlU3RhdGUoJ3ZyLW1vZGUnKTsKICAgICAgICAgIC8vIExvY2sgdG8gbGFuZHNjYXBlIG9yaWVudGF0aW9uIG9uIG1vYmlsZS4KICAgICAgICAgIGlmIChzZWxmLmlzTW9iaWxlICYmIHNjcmVlbi5vcmllbnRhdGlvbiAmJiBzY3JlZW4ub3JpZW50YXRpb24udW5sb2NrKSB7CiAgICAgICAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi51bmxvY2soKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEV4aXRpbmcgVlIgaW4gZW1iZWRkZWQgbW9kZSwgbm8gbG9uZ2VyIG5lZWQgZnVsbHNjcmVlbiBzdHlsZXMuCiAgICAgICAgICBpZiAoc2VsZi5oYXNBdHRyaWJ1dGUoJ2VtYmVkZGVkJykpIHsgc2VsZi5yZW1vdmVGdWxsU2NyZWVuU3R5bGVzKCk7IH0KICAgICAgICAgIHNlbGYucmVzaXplKCk7CiAgICAgICAgICBpZiAoc2VsZi5pc0lPUykgeyB1dGlscy5mb3JjZUNhbnZhc1Jlc2l6ZVNhZmFyaU1vYmlsZShzZWxmLmNhbnZhcyk7IH0KICAgICAgICAgIHNlbGYuZW1pdCgnZXhpdC12cicsIHt0YXJnZXQ6IHNlbGZ9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4aXRWUkZhaWx1cmUgKGVycikgewogICAgICAgICAgaWYgKGVyciAmJiBlcnIubWVzc2FnZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBleGl0IFZSIG1vZGUgKGBleGl0UHJlc2VudGApOiAnICsgZXJyLm1lc3NhZ2UpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZXhpdCBWUiBtb2RlIChgZXhpdFByZXNlbnRgKS4nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9LAoKICAgIHBvaW50ZXJSZXN0cmljdGVkOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMuY2FudmFzKSB7CiAgICAgICAgICB2YXIgcG9pbnRlckxvY2tFbGVtZW50ID0gdGhpcy5nZXRQb2ludGVyTG9ja0VsZW1lbnQoKTsKICAgICAgICAgIGlmIChwb2ludGVyTG9ja0VsZW1lbnQgJiYgcG9pbnRlckxvY2tFbGVtZW50ICE9PSB0aGlzLmNhbnZhcyAmJiBkb2N1bWVudC5leGl0UG9pbnRlckxvY2spIHsKICAgICAgICAgICAgLy8gUmVjcmVhdGUgcG9pbnRlciBsb2NrIG9uIHRoZSBjYW52YXMsIGlmIHRha2VuIG9uIGFub3RoZXIgZWxlbWVudC4KICAgICAgICAgICAgZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuY2FudmFzLnJlcXVlc3RQb2ludGVyTG9jaykgewogICAgICAgICAgICB0aGlzLmNhbnZhcy5yZXF1ZXN0UG9pbnRlckxvY2soKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgcG9pbnRlclVucmVzdHJpY3RlZDogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBwb2ludGVyTG9ja0VsZW1lbnQgPSB0aGlzLmdldFBvaW50ZXJMb2NrRWxlbWVudCgpOwogICAgICAgIGlmIChwb2ludGVyTG9ja0VsZW1lbnQgJiYgcG9pbnRlckxvY2tFbGVtZW50ID09PSB0aGlzLmNhbnZhcyAmJiBkb2N1bWVudC5leGl0UG9pbnRlckxvY2spIHsKICAgICAgICAgIGRvY3VtZW50LmV4aXRQb2ludGVyTG9jaygpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEhhbmRsZSBgdnJkaXNwbGF5cHJlc2VudGNoYW5nZWAgZXZlbnQgZm9yIGV4aXRpbmcgVlIgdGhyb3VnaCBvdGhlciBtZWFucyB0aGFuCiAgICAgKiBgPEVTQz5gIGtleS4gRm9yIGV4YW1wbGUsIEdlYXJWUiBiYWNrIGJ1dHRvbiBvbiBPY3VsdXMgQnJvd3Nlci4KICAgICAqLwogICAgb25WUlByZXNlbnRDaGFuZ2U6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAvLyBQb2x5ZmlsbCBwbGFjZXMgZGlzcGxheSBpbnNpZGUgdGhlIGRldGFpbCBwcm9wZXJ0eQogICAgICAgIHZhciBkaXNwbGF5ID0gZXZ0LmRpc3BsYXkgfHwgZXZ0LmRldGFpbC5kaXNwbGF5OwogICAgICAgIC8vIEVudGVyaW5nIFZSLgogICAgICAgIGlmIChkaXNwbGF5LmlzUHJlc2VudGluZykgewogICAgICAgICAgdGhpcy5lbnRlclZSKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIEV4aXRpbmcgVlIuCiAgICAgICAgdGhpcy5leGl0VlIoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFdyYXBzIEVudGl0eS5nZXRBdHRyaWJ1dGUgdG8gdGFrZSBpbnRvIGFjY291bnQgZm9yIHN5c3RlbXMuCiAgICAgKiBJZiBzeXN0ZW0gZXhpc3RzLCB0aGVuIHJldHVybiBzeXN0ZW0gZGF0YSByYXRoZXIgdGhhbiBwb3NzaWJsZSBjb21wb25lbnQgZGF0YS4KICAgICAqLwogICAgZ2V0QXR0cmlidXRlOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0cikgewogICAgICAgIHZhciBzeXN0ZW0gPSB0aGlzLnN5c3RlbXNbYXR0cl07CiAgICAgICAgaWYgKHN5c3RlbSkgeyByZXR1cm4gc3lzdGVtLmRhdGE7IH0KICAgICAgICByZXR1cm4gQUVudGl0eS5wcm90b3R5cGUuZ2V0QXR0cmlidXRlLmNhbGwodGhpcywgYXR0cik7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBgZ2V0QXR0cmlidXRlYCB1c2VkIHRvIGJlIGBnZXRET01BdHRyaWJ1dGVgIGFuZCBgZ2V0Q29tcHV0ZWRBdHRyaWJ1dGVgIHVzZWQgdG8gYmUKICAgICAqIHdoYXQgYGdldEF0dHJpYnV0ZWAgaXMgbm93LiBOb3cgbGVnYWN5IGNvZGUuCiAgICAgKi8KICAgIGdldENvbXB1dGVkQXR0cmlidXRlOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0cikgewogICAgICAgIHdhcm4oJ2BnZXRDb21wdXRlZEF0dHJpYnV0ZWAgaXMgZGVwcmVjYXRlZC4gVXNlIGBnZXRBdHRyaWJ1dGVgIGluc3RlYWQuJyk7CiAgICAgICAgdGhpcy5nZXRBdHRyaWJ1dGUoYXR0cik7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBXcmFwcyBFbnRpdHkuZ2V0RE9NQXR0cmlidXRlIHRvIHRha2UgaW50byBhY2NvdW50IGZvciBzeXN0ZW1zLgogICAgICogSWYgc3lzdGVtIGV4aXN0cywgdGhlbiByZXR1cm4gc3lzdGVtIGRhdGEgcmF0aGVyIHRoYW4gcG9zc2libGUgY29tcG9uZW50IGRhdGEuCiAgICAgKi8KICAgIGdldERPTUF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICB2YXIgc3lzdGVtID0gdGhpcy5zeXN0ZW1zW2F0dHJdOwogICAgICAgIGlmIChzeXN0ZW0pIHsgcmV0dXJuIHN5c3RlbS5kYXRhOyB9CiAgICAgICAgcmV0dXJuIEFFbnRpdHkucHJvdG90eXBlLmdldERPTUF0dHJpYnV0ZS5jYWxsKHRoaXMsIGF0dHIpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogV3JhcCBFbnRpdHkuc2V0QXR0cmlidXRlIHRvIHRha2UgaW50byBhY2NvdW50IGZvciBzeXN0ZW1zLgogICAgICogSWYgc3lzdGVtIGV4aXN0cywgdGhlbiBza2lwIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbiBjaGVja3MgYW5kIGRvIGEgbm9ybWFsCiAgICAgKiBzZXRBdHRyaWJ1dGUuCiAgICAgKi8KICAgIHNldEF0dHJpYnV0ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGF0dHIsIHZhbHVlLCBjb21wb25lbnRQcm9wVmFsdWUpIHsKICAgICAgICB2YXIgc3lzdGVtID0gdGhpcy5zeXN0ZW1zW2F0dHJdOwogICAgICAgIGlmIChzeXN0ZW0pIHsKICAgICAgICAgIEFOb2RlLnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUuY2FsbCh0aGlzLCBhdHRyLCB2YWx1ZSk7CiAgICAgICAgICBzeXN0ZW0udXBkYXRlUHJvcGVydGllcyh2YWx1ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIEFFbnRpdHkucHJvdG90eXBlLnNldEF0dHJpYnV0ZS5jYWxsKHRoaXMsIGF0dHIsIHZhbHVlLCBjb21wb25lbnRQcm9wVmFsdWUpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHBhcmFtIHtvYmplY3R9IGJlaGF2aW9yIC0gQSBjb21wb25lbnQuCiAgICAgKi8KICAgIHJlbW92ZUJlaGF2aW9yOiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoYmVoYXZpb3IpIHsKICAgICAgICB2YXIgYmVoYXZpb3JBcnI7CiAgICAgICAgdmFyIGJlaGF2aW9yVHlwZTsKICAgICAgICB2YXIgYmVoYXZpb3JzID0gdGhpcy5iZWhhdmlvcnM7CiAgICAgICAgdmFyIGluZGV4OwoKICAgICAgICAvLyBDaGVjayBpZiBiZWhhdmlvciBoYXMgdGljayBhbmQvb3IgdG9jayBhbmQgcmVtb3ZlIHRoZSBiZWhhdmlvciBmcm9tIHRoZSBhcHByb3ByaWF0ZQogICAgICAgIC8vIGFycmF5LgogICAgICAgIGZvciAoYmVoYXZpb3JUeXBlIGluIGJlaGF2aW9ycykgewogICAgICAgICAgaWYgKCFiZWhhdmlvcltiZWhhdmlvclR5cGVdKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgICBiZWhhdmlvckFyciA9IHRoaXMuYmVoYXZpb3JzW2JlaGF2aW9yVHlwZV07CiAgICAgICAgICBpbmRleCA9IGJlaGF2aW9yQXJyLmluZGV4T2YoYmVoYXZpb3IpOwogICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgeyBiZWhhdmlvckFyci5zcGxpY2UoaW5kZXgsIDEpOyB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIHJlc2l6ZTogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjYW1lcmEgPSB0aGlzLmNhbWVyYTsKICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5jYW52YXM7CiAgICAgICAgdmFyIGVtYmVkZGVkOwogICAgICAgIHZhciBpc1ZSUHJlc2VudGluZzsKICAgICAgICB2YXIgc2l6ZTsKICAgICAgICB2YXIgdnJEZXZpY2U7CgogICAgICAgIHZyRGV2aWNlID0gdGhpcy5yZW5kZXJlci52ci5nZXREZXZpY2UoKTsKICAgICAgICBpc1ZSUHJlc2VudGluZyA9IHRoaXMucmVuZGVyZXIudnIuZW5hYmxlZCAmJiB2ckRldmljZSAmJiB2ckRldmljZS5pc1ByZXNlbnRpbmc7CgogICAgICAgIC8vIERvIG5vdCB1cGRhdGUgcmVuZGVyZXIsIGlmIGEgY2FtZXJhIG9yIGEgY2FudmFzIGhhdmUgbm90IGJlZW4gaW5qZWN0ZWQuCiAgICAgICAgLy8gSW4gVlIgbW9kZSwgdGhyZWUgaGFuZGxlcyBjYW52YXMgcmVzaXplIGJhc2VkIG9uIHRoZSBkaW1lbnNpb25zIHJldHVybmVkIGJ5CiAgICAgICAgLy8gdGhlIGdldEV5ZVBhcmFtZXRlcnMgZnVuY3Rpb24gb2YgdGhlIFdlYlZSIEFQSS4gVGhlc2UgZGltZW5zaW9ucyBhcmUgaW5kZXBlbmRlbnQgb2YKICAgICAgICAvLyB0aGUgd2luZG93IHNpemUsIHRoZXJlZm9yZSBzaG91bGQgbm90IGJlIG92ZXJ3cml0dGVuIHdpdGggdGhlIHdpbmRvdydzIHdpZHRoIGFuZAogICAgICAgIC8vIGhlaWdodCwgLy8gZXhjZXB0IHdoZW4gaW4gZnVsbHNjcmVlbiBtb2RlLgogICAgICAgIGlmICghY2FtZXJhIHx8ICFjYW52YXMgfHwgKHRoaXMuaXMoJ3ZyLW1vZGUnKSAmJiAodGhpcy5pc01vYmlsZSB8fCBpc1ZSUHJlc2VudGluZykpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgY2FtZXJhLgogICAgICAgIGVtYmVkZGVkID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2VtYmVkZGVkJykgJiYgIXRoaXMuaXMoJ3ZyLW1vZGUnKTsKICAgICAgICBzaXplID0gZ2V0Q2FudmFzU2l6ZShjYW52YXMsIGVtYmVkZGVkLCB0aGlzLm1heENhbnZhc1NpemUsIHRoaXMuaXMoJ3ZyLW1vZGUnKSk7CiAgICAgICAgY2FtZXJhLmFzcGVjdCA9IHNpemUud2lkdGggLyBzaXplLmhlaWdodDsKICAgICAgICBjYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgICAgICAvLyBOb3RpZnkgcmVuZGVyZXIgb2Ygc2l6ZSBjaGFuZ2UuCiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKHNpemUud2lkdGgsIHNpemUuaGVpZ2h0LCBmYWxzZSk7CiAgICAgICAgdGhpcy5lbWl0KCdyZW5kZXJlcnJlc2l6ZScsIG51bGwsIGZhbHNlKTsKICAgICAgfSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0sCgogICAgc2V0dXBSZW5kZXJlcjogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgcmVuZGVyZXI7CiAgICAgICAgdmFyIHJlbmRlcmVyQXR0cjsKICAgICAgICB2YXIgcmVuZGVyZXJBdHRyU3RyaW5nOwogICAgICAgIHZhciByZW5kZXJlckNvbmZpZzsKCiAgICAgICAgcmVuZGVyZXJDb25maWcgPSB7CiAgICAgICAgICBhbHBoYTogdHJ1ZSwKICAgICAgICAgIGFudGlhbGlhczogIWlzTW9iaWxlLAogICAgICAgICAgY2FudmFzOiB0aGlzLmNhbnZhcywKICAgICAgICAgIGxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGZhbHNlCiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5tYXhDYW52YXNTaXplID0ge2hlaWdodDogMTkyMCwgd2lkdGg6IDE5MjB9OwoKICAgICAgICBpZiAodGhpcy5oYXNBdHRyaWJ1dGUoJ3JlbmRlcmVyJykpIHsKICAgICAgICAgIHJlbmRlcmVyQXR0clN0cmluZyA9IHRoaXMuZ2V0QXR0cmlidXRlKCdyZW5kZXJlcicpOwogICAgICAgICAgcmVuZGVyZXJBdHRyID0gdXRpbHMuc3R5bGVQYXJzZXIucGFyc2UocmVuZGVyZXJBdHRyU3RyaW5nKTsKCiAgICAgICAgICBpZiAocmVuZGVyZXJBdHRyLnByZWNpc2lvbikgewogICAgICAgICAgICByZW5kZXJlckNvbmZpZy5wcmVjaXNpb24gPSByZW5kZXJlckF0dHIucHJlY2lzaW9uICsgJ3AnOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChyZW5kZXJlckF0dHIuYW50aWFsaWFzICYmIHJlbmRlcmVyQXR0ci5hbnRpYWxpYXMgIT09ICdhdXRvJykgewogICAgICAgICAgICByZW5kZXJlckNvbmZpZy5hbnRpYWxpYXMgPSByZW5kZXJlckF0dHIuYW50aWFsaWFzID09PSAndHJ1ZSc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlbmRlcmVyQXR0ci5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICYmIHJlbmRlcmVyQXR0ci5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICE9PSAnYXV0bycpIHsKICAgICAgICAgICAgcmVuZGVyZXJDb25maWcubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHJlbmRlcmVyQXR0ci5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID09PSAndHJ1ZSc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlbmRlcmVyQXR0ci5hbHBoYSkgewogICAgICAgICAgICByZW5kZXJlckNvbmZpZy5hbHBoYSA9IHJlbmRlcmVyQXR0ci5hbHBoYSA9PT0gJ3RydWUnOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMubWF4Q2FudmFzU2l6ZSA9IHsKICAgICAgICAgICAgd2lkdGg6IHJlbmRlcmVyQXR0ci5tYXhDYW52YXNXaWR0aAogICAgICAgICAgICAgID8gcGFyc2VJbnQocmVuZGVyZXJBdHRyLm1heENhbnZhc1dpZHRoKQogICAgICAgICAgICAgIDogdGhpcy5tYXhDYW52YXNTaXplLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHJlbmRlcmVyQXR0ci5tYXhDYW52YXNIZWlnaHQKICAgICAgICAgICAgICA/IHBhcnNlSW50KHJlbmRlcmVyQXR0ci5tYXhDYW52YXNIZWlnaHQpCiAgICAgICAgICAgICAgOiB0aGlzLm1heENhbnZhc1NpemUuaGVpZ2h0CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmVuZGVyZXIgPSB0aGlzLnJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIocmVuZGVyZXJDb25maWcpOwogICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pOwogICAgICAgIHJlbmRlcmVyLnNvcnRPYmplY3RzID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMuY2FtZXJhKSB7IHJlbmRlcmVyLnZyLnNldFBvc2VUYXJnZXQodGhpcy5jYW1lcmEuZWwub2JqZWN0M0QpOyB9CiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdjYW1lcmEtc2V0LWFjdGl2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlbmRlcmVyLnZyLnNldFBvc2VUYXJnZXQoc2VsZi5jYW1lcmEuZWwub2JqZWN0M0QpOwogICAgICAgIH0pOwogICAgICAgIGxvYWRpbmdTY3JlZW4uc2V0dXAodGhpcywgZ2V0Q2FudmFzU2l6ZSk7CiAgICAgIH0sCiAgICAgIHdyaXRhYmxlOiB3aW5kb3cuZGVidWcKICAgIH0sCgogICAgLyoqCiAgICAgKiBIYW5kbGVyIGF0dGFjaGVkIHRvIGVsZW1lbnRzIHRvIGhlbHAgc2NlbmUga25vdyB3aGVuIHRvIGtpY2sgb2ZmLgogICAgICogU2NlbmUgd2FpdHMgZm9yIGFsbCBlbnRpdGllcyB0byBsb2FkLgogICAgICovCiAgICBwbGF5OiB7CiAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBzY2VuZUVsID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMucmVuZGVyU3RhcnRlZCkgewogICAgICAgICAgQUVudGl0eS5wcm90b3R5cGUucGxheS5jYWxsKHRoaXMpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcmVuZGVyZXIgPSB0aGlzLnJlbmRlcmVyOwogICAgICAgICAgdmFyIHZyRGlzcGxheTsKICAgICAgICAgIHZhciB2ck1hbmFnZXIgPSB0aGlzLnJlbmRlcmVyLnZyOwogICAgICAgICAgQUVudGl0eS5wcm90b3R5cGUucGxheS5jYWxsKHRoaXMpOyAgLy8gLnBsYXkoKSAqYmVmb3JlKiByZW5kZXIuCgogICAgICAgICAgaWYgKHNjZW5lRWwucmVuZGVyU3RhcnRlZCkgeyByZXR1cm47IH0KICAgICAgICAgIHNjZW5lRWwucmVzaXplKCk7CgogICAgICAgICAgLy8gS2ljayBvZmYgcmVuZGVyIGxvb3AuCiAgICAgICAgICBpZiAoc2NlbmVFbC5yZW5kZXJlcikgewogICAgICAgICAgICBpZiAod2luZG93LnBlcmZvcm1hbmNlKSB7IHdpbmRvdy5wZXJmb3JtYW5jZS5tYXJrKCdyZW5kZXItc3RhcnRlZCcpOyB9CiAgICAgICAgICAgIGxvYWRpbmdTY3JlZW4ucmVtb3ZlKCk7CiAgICAgICAgICAgIHZyRGlzcGxheSA9IHV0aWxzLmRldmljZS5nZXRWUkRpc3BsYXkoKTsKICAgICAgICAgICAgaWYgKHZyRGlzcGxheSAmJiB2ckRpc3BsYXkuaXNQcmVzZW50aW5nKSB7CiAgICAgICAgICAgICAgdnJNYW5hZ2VyLnNldERldmljZSh2ckRpc3BsYXkpOwogICAgICAgICAgICAgIHZyTWFuYWdlci5lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBzY2VuZUVsLmVudGVyVlIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5zZXRBbmltYXRpb25Mb29wKHRoaXMucmVuZGVyKTsKICAgICAgICAgICAgc2NlbmVFbC5yZW5kZXJTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgc2NlbmVFbC5lbWl0KCdyZW5kZXJzdGFydCcpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBzZXRUaW1lb3V0IHRvIHdhaXQgZm9yIGFsbCBub2RlcyB0byBhdHRhY2ggYW5kIHJ1biB0aGVpciBjYWxsYmFja3MuCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBRW50aXR5LnByb3RvdHlwZS5sb2FkLmNhbGwoc2VsZik7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBXcmFwIGB1cGRhdGVDb21wb25lbnRgIHRvIG5vdCBpbml0aWFsaXplIHRoZSBjb21wb25lbnQgaWYgdGhlIGNvbXBvbmVudCBoYXMgYSBzeXN0ZW0KICAgICAqIChhZnJhbWV2ci9hZnJhbWUjMjM2NSkuCiAgICAgKi8KICAgIHVwZGF0ZUNvbXBvbmVudDogewogICAgICB2YWx1ZTogZnVuY3Rpb24gKGNvbXBvbmVudE5hbWUpIHsKICAgICAgICBpZiAoY29tcG9uZW50TmFtZSBpbiBzeXN0ZW1zKSB7IHJldHVybjsgfQogICAgICAgIEFFbnRpdHkucHJvdG90eXBlLnVwZGF0ZUNvbXBvbmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQmVoYXZpb3ItdXBkYXRlciBtZWFudCB0byBiZSBjYWxsZWQgZnJvbSBzY2VuZSByZW5kZXIuCiAgICAgKiBBYnN0cmFjdGVkIHRvIGEgZGlmZmVyZW50IGZ1bmN0aW9uIHRvIGZhY2lsaXRhdGUgdW5pdCB0ZXN0aW5nIChgc2NlbmUudGljaygpYCkgd2l0aG91dAogICAgICogbmVlZGluZyB0byByZW5kZXIuCiAgICAgKi8KICAgIHRpY2s6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICh0aW1lLCB0aW1lRGVsdGEpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgc3lzdGVtcyA9IHRoaXMuc3lzdGVtczsKCiAgICAgICAgLy8gQ29tcG9uZW50cy4KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5iZWhhdmlvcnMudGljay5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCF0aGlzLmJlaGF2aW9ycy50aWNrW2ldLmVsLmlzUGxheWluZykgeyBjb250aW51ZTsgfQogICAgICAgICAgdGhpcy5iZWhhdmlvcnMudGlja1tpXS50aWNrKHRpbWUsIHRpbWVEZWx0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyBTeXN0ZW1zLgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLnN5c3RlbU5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoIXN5c3RlbXNbdGhpcy5zeXN0ZW1OYW1lc1tpXV0udGljaykgeyBjb250aW51ZTsgfQogICAgICAgICAgc3lzdGVtc1t0aGlzLnN5c3RlbU5hbWVzW2ldXS50aWNrKHRpbWUsIHRpbWVEZWx0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQmVoYXZpb3ItdXBkYXRlciBtZWFudCB0byBiZSBjYWxsZWQgYWZ0ZXIgc2NlbmUgcmVuZGVyIGZvciBwb3N0IHByb2Nlc3NpbmcgcHVycG9zZXMuCiAgICAgKiBBYnN0cmFjdGVkIHRvIGEgZGlmZmVyZW50IGZ1bmN0aW9uIHRvIGZhY2lsaXRhdGUgdW5pdCB0ZXN0aW5nIChgc2NlbmUudG9jaygpYCkgd2l0aG91dAogICAgICogbmVlZGluZyB0byByZW5kZXIuCiAgICAgKi8KICAgIHRvY2s6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICh0aW1lLCB0aW1lRGVsdGEsIGNhbWVyYSkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBzeXN0ZW1zID0gdGhpcy5zeXN0ZW1zOwoKICAgICAgICAvLyBDb21wb25lbnRzLgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmJlaGF2aW9ycy50b2NrLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoIXRoaXMuYmVoYXZpb3JzLnRvY2tbaV0uZWwuaXNQbGF5aW5nKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgICB0aGlzLmJlaGF2aW9ycy50b2NrW2ldLnRvY2sodGltZSwgdGltZURlbHRhLCBjYW1lcmEpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3lzdGVtcy4KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5zeXN0ZW1OYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKCFzeXN0ZW1zW3RoaXMuc3lzdGVtTmFtZXNbaV1dLnRvY2spIHsgY29udGludWU7IH0KICAgICAgICAgIHN5c3RlbXNbdGhpcy5zeXN0ZW1OYW1lc1tpXV0udG9jayh0aW1lLCB0aW1lRGVsdGEsIGNhbWVyYSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogVGhlIHJlbmRlciBsb29wLgogICAgICoKICAgICAqIFVwZGF0ZXMgYW5pbWF0aW9ucy4KICAgICAqIFVwZGF0ZXMgYmVoYXZpb3JzLgogICAgICogUmVuZGVycyB3aXRoIHJlcXVlc3QgYW5pbWF0aW9uIGZyYW1lLgogICAgICovCiAgICByZW5kZXI6IHsKICAgICAgdmFsdWU6IGZ1bmN0aW9uICh0aW1lLCBmcmFtZSkgewogICAgICAgIHZhciByZW5kZXJlciA9IHRoaXMucmVuZGVyZXI7CgogICAgICAgIHRoaXMuZnJhbWUgPSBmcmFtZTsKICAgICAgICB0aGlzLmRlbHRhID0gdGhpcy5jbG9jay5nZXREZWx0YSgpICogMTAwMDsKICAgICAgICB0aGlzLnRpbWUgPSB0aGlzLmNsb2NrLmVsYXBzZWRUaW1lICogMTAwMDsKCiAgICAgICAgaWYgKHRoaXMuaXNQbGF5aW5nKSB7IHRoaXMudGljayh0aGlzLnRpbWUsIHRoaXMuZGVsdGEpOyB9CgogICAgICAgIHJlbmRlcmVyLnJlbmRlcih0aGlzLm9iamVjdDNELCB0aGlzLmNhbWVyYSk7CiAgICAgIH0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9CiAgfSkKfSk7CgovKioKICogUmV0dXJuIHRoZSBjYW52YXMgc2l6ZSB3aGVyZSB0aGUgc2NlbmUgd2lsbCBiZSByZW5kZXJlZC4KICogV2lsbCBiZSBhbHdheXMgdGhlIHdpbmRvdyBzaXplIGV4Y2VwdCB3aGVuIHRoZSBzY2VuZSBpcyBlbWJlZGRlZC4KICogVGhlIHBhcmVudCBzaXplIChsZXNzIHRoYW4gbWF4IHNpemUpIHdpbGwgYmUgcmV0dXJuZWQgaW4gdGhhdCBjYXNlLgogKgogKiBAcGFyYW0ge29iamVjdH0gY2FudmFzRWwgLSB0aGUgY2FudmFzIGVsZW1lbnQKICogQHBhcmFtIHtib29sZWFufSBlbWJlZGRlZCAtIElzIHRoZSBzY2VuZSBlbWJlZGRlZD8KICogQHBhcmFtIHtvYmplY3R9IG1heCAtIE1heCBzaXplIHBhcmFtZXRlcnMKICogQHBhcmFtIHtib29sZWFufSBpc1ZSIC0gSWYgaW4gVlIKICovCmZ1bmN0aW9uIGdldENhbnZhc1NpemUgKGNhbnZhc0VsLCBlbWJlZGRlZCwgbWF4U2l6ZSwgaXNWUikgewogIGlmIChlbWJlZGRlZCkgewogICAgcmV0dXJuIHsKICAgICAgaGVpZ2h0OiBjYW52YXNFbC5wYXJlbnRFbGVtZW50Lm9mZnNldEhlaWdodCwKICAgICAgd2lkdGg6IGNhbnZhc0VsLnBhcmVudEVsZW1lbnQub2Zmc2V0V2lkdGgKICAgIH07CiAgfQogIHJldHVybiBnZXRNYXhTaXplKG1heFNpemUsIGlzVlIpOwp9CgovKioKICogUmV0dXJuIHRoZSBjYW52YXMgc2l6ZS4gV2lsbCBiZSB0aGUgd2luZG93IHNpemUgdW5sZXNzIHRoYXQgc2l6ZSBpcyBncmVhdGVyIHRoYW4gdGhlCiAqIG1heGltdW0gc2l6ZSAoMTkyMHgxOTIwIGJ5IGRlZmF1bHQpLiAgVGhlIGNvbnN0cmFpbmVkIHNpemUgd2lsbCBiZSByZXR1cm5lZCBpbiB0aGF0IGNhc2UsCiAqIG1haW50YWluaW5nIGFzcGVjdCByYXRpbwogKgogKiBAcGFyYW0ge29iamVjdH0gbWF4U2l6ZSAtIE1heCBzaXplIHBhcmFtZXRlcnMgKHdpZHRoIGFuZCBoZWlnaHQpLgogKiBAcGFyYW0ge2Jvb2xlYW59IGlzVlIgLSBJZiBpbiBWUi4KICogQHJldHVybnMge29iamVjdH0gV2lkdGggYW5kIGhlaWdodC4KICovCmZ1bmN0aW9uIGdldE1heFNpemUgKG1heFNpemUsIGlzVlIpIHsKICB2YXIgYXNwZWN0UmF0aW87CiAgdmFyIHNpemU7CiAgdmFyIHBpeGVsUmF0aW8gPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKCiAgc2l6ZSA9IHtoZWlnaHQ6IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0LCB3aWR0aDogZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aH07CiAgaWYgKCFtYXhTaXplIHx8IGlzVlIgfHwgKG1heFNpemUud2lkdGggPT09IC0xICYmIG1heFNpemUuaGVpZ2h0ID09PSAtMSkpIHsKICAgIHJldHVybiBzaXplOwogIH0KCiAgaWYgKHNpemUud2lkdGggKiBwaXhlbFJhdGlvIDwgbWF4U2l6ZS53aWR0aCAmJgogICAgc2l6ZS5oZWlnaHQgKiBwaXhlbFJhdGlvIDwgbWF4U2l6ZS5oZWlnaHQpIHsKICAgIHJldHVybiBzaXplOwogIH0KCiAgYXNwZWN0UmF0aW8gPSBzaXplLndpZHRoIC8gc2l6ZS5oZWlnaHQ7CgogIGlmICgoc2l6ZS53aWR0aCAqIHBpeGVsUmF0aW8pID4gbWF4U2l6ZS53aWR0aCAmJiBtYXhTaXplLndpZHRoICE9PSAtMSkgewogICAgc2l6ZS53aWR0aCA9IE1hdGgucm91bmQobWF4U2l6ZS53aWR0aCAvIHBpeGVsUmF0aW8pOwogICAgc2l6ZS5oZWlnaHQgPSBNYXRoLnJvdW5kKG1heFNpemUud2lkdGggLyBhc3BlY3RSYXRpbyAvIHBpeGVsUmF0aW8pOwogIH0KCiAgaWYgKChzaXplLmhlaWdodCAqIHBpeGVsUmF0aW8pID4gbWF4U2l6ZS5oZWlnaHQgJiYgbWF4U2l6ZS5oZWlnaHQgIT09IC0xKSB7CiAgICBzaXplLmhlaWdodCA9IE1hdGgucm91bmQobWF4U2l6ZS5oZWlnaHQgLyBwaXhlbFJhdGlvKTsKICAgIHNpemUud2lkdGggPSBNYXRoLnJvdW5kKG1heFNpemUuaGVpZ2h0ICogYXNwZWN0UmF0aW8gLyBwaXhlbFJhdGlvKTsKICB9CgogIHJldHVybiBzaXplOwp9CgpmdW5jdGlvbiByZXF1ZXN0RnVsbHNjcmVlbiAoY2FudmFzKSB7CiAgdmFyIHJlcXVlc3RGdWxsc2NyZWVuID0KICAgIGNhbnZhcy5yZXF1ZXN0RnVsbHNjcmVlbiB8fAogICAgY2FudmFzLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuIHx8CiAgICBjYW52YXMubW96UmVxdWVzdEZ1bGxTY3JlZW4gfHwgIC8vIFRoZSBjYXBpdGFsaXplZCBgU2AgaXMgbm90IGEgdHlwby4KICAgIGNhbnZhcy5tc1JlcXVlc3RGdWxsc2NyZWVuOwogIC8vIEhpZGUgbmF2aWdhdGlvbiBidXR0b25zIG9uIEFuZHJvaWQuCiAgcmVxdWVzdEZ1bGxzY3JlZW4uYXBwbHkoY2FudmFzLCBbe25hdmlnYXRpb25VSTogJ2hpZGUnfV0pOwp9CgpmdW5jdGlvbiBleGl0RnVsbHNjcmVlbiAoKSB7CiAgdmFyIGZ1bGxzY3JlZW5FbCA9CiAgICBkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fAogICAgZG9jdW1lbnQud2Via2l0RnVsbHNjcmVlbkVsZW1lbnQgfHwKICAgIGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50OwogIGlmICghZnVsbHNjcmVlbkVsKSB7IHJldHVybjsgfQogIGlmIChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikgewogICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKSB7CiAgICBkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpOwogIH0KfQoKZnVuY3Rpb24gc2V0dXBDYW52YXMgKHNjZW5lRWwpIHsKICB2YXIgY2FudmFzRWw7CgogIGNhbnZhc0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgY2FudmFzRWwuY2xhc3NMaXN0LmFkZCgnYS1jYW52YXMnKTsKICAvLyBNYXJrIGNhbnZhcyBhcyBwcm92aWRlZC9pbmplY3RlZCBieSBBLUZyYW1lLgogIGNhbnZhc0VsLmRhdGFzZXQuYWZyYW1lQ2FudmFzID0gdHJ1ZTsKICBzY2VuZUVsLmFwcGVuZENoaWxkKGNhbnZhc0VsKTsKCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIG9uRnVsbFNjcmVlbkNoYW5nZSk7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScsIG9uRnVsbFNjcmVlbkNoYW5nZSk7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0ZnVsbHNjcmVlbmNoYW5nZScsIG9uRnVsbFNjcmVlbkNoYW5nZSk7CgogIC8vIFByZXZlbnQgb3ZlcnNjcm9sbCBvbiBtb2JpbGUuCiAgY2FudmFzRWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IH0pOwoKICAvLyBTZXQgY2FudmFzIG9uIHNjZW5lLgogIHNjZW5lRWwuY2FudmFzID0gY2FudmFzRWw7CiAgc2NlbmVFbC5lbWl0KCdyZW5kZXItdGFyZ2V0LWxvYWRlZCcsIHt0YXJnZXQ6IGNhbnZhc0VsfSk7CiAgLy8gRm9yIHVua25vd24gcmVhc29ucyBhIHN5bmNocm9ub3VzIHJlc2l6ZSBkb2VzIG5vdCB3b3JrIG9uIGRlc2t0b3Agd2hlbgogIC8vIGVudGVyaW5nL2V4aXRpbmcgZnVsbHNjcmVlbi4KICBzZXRUaW1lb3V0KGJpbmQoc2NlbmVFbC5yZXNpemUsIHNjZW5lRWwpLCAwKTsKCiAgZnVuY3Rpb24gb25GdWxsU2NyZWVuQ2hhbmdlICgpIHsKICAgIHZhciBmdWxsc2NyZWVuRWwgPQogICAgICBkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fAogICAgICBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCB8fAogICAgICBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudDsKICAgIC8vIE5vIGZ1bGxzY3JlbiBlbGVtZW50ID09PSBleGl0IGZ1bGxzY3JlZW4KICAgIGlmICghZnVsbHNjcmVlbkVsKSB7IHNjZW5lRWwuZXhpdFZSKCk7IH0KICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpOwogICAgZG9jdW1lbnQuYm9keS5mb2N1cygpOwogIH0KfQptb2R1bGUuZXhwb3J0cy5zZXR1cENhbnZhcyA9IHNldHVwQ2FudmFzOyAgLy8gRm9yIHRlc3RpbmcuCgp9LHsiLi4vLi4vbGliL3RocmVlIjoxNTQsIi4uLy4uL3V0aWxzLyI6MTc5LCIuLi9hLWVudGl0eSI6MTAyLCIuLi9hLW5vZGUiOjEwNCwiLi4vYS1yZWdpc3Rlci1lbGVtZW50IjoxMDUsIi4uL3N5c3RlbSI6MTE3LCIuL2xvYWRpbmdTY3JlZW4iOjExMCwiLi9tZXRhVGFncyI6MTExLCIuL3Bvc3RNZXNzYWdlIjoxMTIsIi4vc2NlbmVzIjoxMTMsIi4vd2FrZWxvY2siOjExNH1dLDExMDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qIGdsb2JhbCBUSFJFRSAqLwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi8uLi91dGlscy8nKTsKdmFyIHN0eWxlUGFyc2VyID0gdXRpbHMuc3R5bGVQYXJzZXI7Cgp2YXIgc2NlbmVFbDsKdmFyIHRpdGxlRWw7CnZhciBnZXRTY2VuZUNhbnZhc1NpemU7Cgp2YXIgQVRUUl9OQU1FID0gJ2xvYWRpbmctc2NyZWVuJzsKdmFyIExPQURFUl9USVRMRV9DTEFTUyA9ICdhLWxvYWRlci10aXRsZSc7Cgptb2R1bGUuZXhwb3J0cy5zZXR1cCA9IGZ1bmN0aW9uIHNldHVwIChlbCwgZ2V0Q2FudmFzU2l6ZSkgewogIHNjZW5lRWwgPSBlbDsKICBnZXRTY2VuZUNhbnZhc1NpemUgPSBnZXRDYW52YXNTaXplOwogIHZhciBsb2FkZXJBdHRyaWJ1dGUgPSBzY2VuZUVsLmhhc0F0dHJpYnV0ZShBVFRSX05BTUUpID8gc3R5bGVQYXJzZXIucGFyc2Uoc2NlbmVFbC5nZXRBdHRyaWJ1dGUoQVRUUl9OQU1FKSkgOiB1bmRlZmluZWQ7CiAgdmFyIGRvdHNDb2xvciA9IGxvYWRlckF0dHJpYnV0ZSAmJiBsb2FkZXJBdHRyaWJ1dGUuZG90c0NvbG9yIHx8ICd3aGl0ZSc7CiAgdmFyIGJhY2tncm91bmRDb2xvciA9IGxvYWRlckF0dHJpYnV0ZSAmJiBsb2FkZXJBdHRyaWJ1dGUuYmFja2dyb3VuZENvbG9yIHx8ICcjMjRDQUZGJzsKICB2YXIgbG9hZGVyRW5hYmxlZCA9IGxvYWRlckF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkIHx8IGxvYWRlckF0dHJpYnV0ZS5lbmFibGVkID09PSB0cnVlIHx8IGxvYWRlckF0dHJpYnV0ZS5lbmFibGVkID09PSB1bmRlZmluZWQ7IC8vIHRydWUgZGVmYXVsdAogIHZhciBsb2FkZXJTY2VuZTsKICB2YXIgc3BoZXJlR2VvbWV0cnk7CiAgdmFyIHNwaGVyZU1hdGVyaWFsOwogIHZhciBzcGhlcmVNZXNoMTsKICB2YXIgc3BoZXJlTWVzaDI7CiAgdmFyIHNwaGVyZU1lc2gzOwogIHZhciBjYW1lcmE7CiAgdmFyIGNsb2NrOwogIHZhciB0aW1lOwogIHZhciByZW5kZXI7CgogIGlmICghbG9hZGVyRW5hYmxlZCkgeyByZXR1cm47IH0KCiAgLy8gU2V0dXAgU2NlbmUuCiAgbG9hZGVyU2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTsKICBzcGhlcmVHZW9tZXRyeSA9IG5ldyBUSFJFRS5TcGhlcmVHZW9tZXRyeSgwLjIwLCAzNiwgMTgsIDAsIDIgKiBNYXRoLlBJLCAwLCBNYXRoLlBJKTsKICBzcGhlcmVNYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7Y29sb3I6IGRvdHNDb2xvcn0pOwogIHNwaGVyZU1lc2gxID0gbmV3IFRIUkVFLk1lc2goc3BoZXJlR2VvbWV0cnksIHNwaGVyZU1hdGVyaWFsKTsKICBzcGhlcmVNZXNoMiA9IHNwaGVyZU1lc2gxLmNsb25lKCk7CiAgc3BoZXJlTWVzaDMgPSBzcGhlcmVNZXNoMS5jbG9uZSgpOwogIGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSg4MCwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDAuMDAwNSwgMTAwMDApOwogIGNsb2NrID0gbmV3IFRIUkVFLkNsb2NrKCk7CiAgdGltZSA9IDA7CiAgcmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgc2NlbmVFbC5yZW5kZXJlci5yZW5kZXIobG9hZGVyU2NlbmUsIGNhbWVyYSk7CiAgICB0aW1lID0gY2xvY2suZ2V0RWxhcHNlZFRpbWUoKSAlIDQ7CiAgICBzcGhlcmVNZXNoMS52aXNpYmxlID0gdGltZSA+PSAxOwogICAgc3BoZXJlTWVzaDIudmlzaWJsZSA9IHRpbWUgPj0gMjsKICAgIHNwaGVyZU1lc2gzLnZpc2libGUgPSB0aW1lID49IDM7CiAgfTsKCiAgbG9hZGVyU2NlbmUuYmFja2dyb3VuZCA9IG5ldyBUSFJFRS5Db2xvcihiYWNrZ3JvdW5kQ29sb3IpOwogIGxvYWRlclNjZW5lLmFkZChjYW1lcmEpOwogIHNwaGVyZU1lc2gxLnBvc2l0aW9uLnNldCgtMSwgMCwgLTE1KTsKICBzcGhlcmVNZXNoMi5wb3NpdGlvbi5zZXQoMCwgMCwgLTE1KTsKICBzcGhlcmVNZXNoMy5wb3NpdGlvbi5zZXQoMSwgMCwgLTE1KTsKICBjYW1lcmEuYWRkKHNwaGVyZU1lc2gxKTsKICBjYW1lcmEuYWRkKHNwaGVyZU1lc2gyKTsKICBjYW1lcmEuYWRkKHNwaGVyZU1lc2gzKTsKICBzZXR1cFRpdGxlKCk7CgogIC8vIERlbGF5IDIwMG1zIHRvIGF2b2lkIGxvYWRlciBmbGFzaGVzLgogIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgaWYgKHNjZW5lRWwuaGFzTG9hZGVkKSB7IHJldHVybjsgfQogICAgcmVzaXplKGNhbWVyYSk7CiAgICB0aXRsZUVsLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsgcmVzaXplKGNhbWVyYSk7IH0pOwogICAgc2NlbmVFbC5yZW5kZXJlci5zZXRBbmltYXRpb25Mb29wKHJlbmRlcik7CiAgfSwgMjAwKTsKfTsKCm1vZHVsZS5leHBvcnRzLnJlbW92ZSA9IGZ1bmN0aW9uIHJlbW92ZSAoKSB7CiAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHJlc2l6ZSk7CiAgaWYgKCF0aXRsZUVsKSB7IHJldHVybjsgfQogIC8vIEhpZGUgdGl0bGUuCiAgdGl0bGVFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9OwoKZnVuY3Rpb24gcmVzaXplIChjYW1lcmEpIHsKICB2YXIgc2l6ZSA9IGdldFNjZW5lQ2FudmFzU2l6ZShzY2VuZUVsLmNhbnZhcywgZmFsc2UsIHNjZW5lRWwubWF4Q2FudmFzU2l6ZSwgc2NlbmVFbC5pcygndnItbW9kZScpKTsKICBjYW1lcmEuYXNwZWN0ID0gc2l6ZS53aWR0aCAvIHNpemUuaGVpZ2h0OwogIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgIC8vIE5vdGlmeSByZW5kZXJlciBvZiBzaXplIGNoYW5nZS4KICBzY2VuZUVsLnJlbmRlcmVyLnNldFNpemUoc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQsIGZhbHNlKTsKfQoKZnVuY3Rpb24gc2V0dXBUaXRsZSAoKSB7CiAgdGl0bGVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHRpdGxlRWwuY2xhc3NOYW1lID0gTE9BREVSX1RJVExFX0NMQVNTOwogIHRpdGxlRWwuaW5uZXJIVE1MID0gZG9jdW1lbnQudGl0bGU7CiAgdGl0bGVFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIHNjZW5lRWwuYXBwZW5kQ2hpbGQodGl0bGVFbCk7Cn0KCn0seyIuLi8uLi91dGlscy8iOjE3OX1dLDExMTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBjb25zdGFudHMgPSBfZGVyZXFfKCcuLi8uLi9jb25zdGFudHMvJyk7CnZhciBleHRlbmQgPSBfZGVyZXFfKCcuLi8uLi91dGlscycpLmV4dGVuZDsKCnZhciBNT0JJTEVfSEVBRF9UQUdTID0gbW9kdWxlLmV4cG9ydHMuTU9CSUxFX0hFQURfVEFHUyA9IFsKICBNZXRhKHtuYW1lOiAndmlld3BvcnQnLCBjb250ZW50OiAnd2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MSxtYXhpbXVtLXNjYWxlPTEsc2hyaW5rLXRvLWZpdD1ubyx1c2VyLXNjYWxhYmxlPW5vLG1pbmltYWwtdWksdmlld3BvcnQtZml0PWNvdmVyJ30pLAoKICAvLyBXM0Mtc3RhbmRhcmRpc2VkIG1ldGEgdGFncy4KICBNZXRhKHtuYW1lOiAnbW9iaWxlLXdlYi1hcHAtY2FwYWJsZScsIGNvbnRlbnQ6ICd5ZXMnfSksCiAgTWV0YSh7bmFtZTogJ3RoZW1lLWNvbG9yJywgY29udGVudDogJ2JsYWNrJ30pCl07Cgp2YXIgTU9CSUxFX0lPU19IRUFEX1RBR1MgPSBbCiAgLy8gaU9TLXNwZWNpZmljIG1ldGEgdGFncyBmb3IgZnVsbHNjcmVlbiB3aGVuIHBpbm5pbmcgdG8gaG9tZXNjcmVlbi4KICBNZXRhKHtuYW1lOiAnYXBwbGUtbW9iaWxlLXdlYi1hcHAtY2FwYWJsZScsIGNvbnRlbnQ6ICd5ZXMnfSksCiAgTWV0YSh7bmFtZTogJ2FwcGxlLW1vYmlsZS13ZWItYXBwLXN0YXR1cy1iYXItc3R5bGUnLCBjb250ZW50OiAnYmxhY2snfSksCiAgTGluayh7cmVsOiAnYXBwbGUtdG91Y2gtaWNvbicsIGhyZWY6ICdodHRwczovL2FmcmFtZS5pby9pbWFnZXMvYWZyYW1lLWxvZ28tMTUyLnBuZyd9KQpdOwoKZnVuY3Rpb24gTWV0YSAoYXR0cnMpIHsKICByZXR1cm4gewogICAgdGFnTmFtZTogJ21ldGEnLAogICAgYXR0cmlidXRlczogYXR0cnMsCiAgICBleGlzdHM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21ldGFbbmFtZT0iJyArIGF0dHJzLm5hbWUgKyAnIl0nKTsgfQogIH07Cn0KCmZ1bmN0aW9uIExpbmsgKGF0dHJzKSB7CiAgcmV0dXJuIHsKICAgIHRhZ05hbWU6ICdsaW5rJywKICAgIGF0dHJpYnV0ZXM6IGF0dHJzLAogICAgZXhpc3RzOiBmdW5jdGlvbiAoKSB7IHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsaW5rW3JlbD0iJyArIGF0dHJzLnJlbCArICciXScpOyB9CiAgfTsKfQoKLyoqCiAqIEluamVjdHMgdGhlIG5lY2Vzc2FyeSBtZXRhdGFncyBpbiB0aGUgZG9jdW1lbnQgZm9yIG1vYmlsZSBzdXBwb3J0OgogKiAxLiBQcmV2ZW50IHRoZSB1c2VyIHRvIHpvb20gaW4gdGhlIGRvY3VtZW50LgogKiAyLiBFbnN1cmUgdGhhdCB3aW5kb3cuaW5uZXJXaWR0aCBhbmQgd2luZG93LmlubmVySGVpZ2h0IGhhdmUgdGhlIGNvcnJlY3QKICogICAgdmFsdWVzIGFuZCB0aGUgY2FudmFzIGlzIHByb3Blcmx5IHNjYWxlZC4KICogMy4gVG8gYWxsb3cgZnVsbHNjcmVlbiBtb2RlIHdoZW4gcGlubmluZyBhIHdlYiBhcHAgb24gdGhlIGhvbWUgc2NyZWVuIG9uCiAqICAgIGlPUy4KICogQWRhcHRlZCBmcm9tIGh0dHBzOi8vd3d3LnJlZGRpdC5jb20vci93ZWJfZGVzaWduL2NvbW1lbnRzLzNsYTA0cC8KICoKICogQHBhcmFtIHtvYmplY3R9IHNjZW5lIC0gU2NlbmUgZWxlbWVudAogKiBAcmV0dXJucyB7QXJyYXl9CiAqLwptb2R1bGUuZXhwb3J0cy5pbmplY3QgPSBmdW5jdGlvbiBpbmplY3RIZWFkVGFncyAoc2NlbmUpIHsKICB2YXIgaGVhZEVsID0gZG9jdW1lbnQuaGVhZDsKICB2YXIgaGVhZFNjcmlwdEVsID0gaGVhZEVsLnF1ZXJ5U2VsZWN0b3IoJ3NjcmlwdCcpOwogIHZhciB0YWc7CiAgdmFyIGhlYWRUYWdzID0gW107CiAgTU9CSUxFX0hFQURfVEFHUy5mb3JFYWNoKGNyZWF0ZUFuZEluamVjdFRhZyk7CiAgaWYgKHNjZW5lLmlzSU9TKSB7CiAgICBNT0JJTEVfSU9TX0hFQURfVEFHUy5mb3JFYWNoKGNyZWF0ZUFuZEluamVjdFRhZyk7CiAgfQogIHJldHVybiBoZWFkVGFnczsKCiAgZnVuY3Rpb24gY3JlYXRlQW5kSW5qZWN0VGFnICh0YWdPYmopIHsKICAgIGlmICghdGFnT2JqIHx8IHRhZ09iai5leGlzdHMoKSkgeyByZXR1cm47IH0KCiAgICB0YWcgPSBjcmVhdGVUYWcodGFnT2JqKTsKICAgIGlmICghdGFnKSB7IHJldHVybjsgfQoKICAgIGlmIChoZWFkU2NyaXB0RWwpIHsKICAgICAgaGVhZFNjcmlwdEVsLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRhZywgaGVhZFNjcmlwdEVsKTsKICAgIH0gZWxzZSB7CiAgICAgIGhlYWRFbC5hcHBlbmRDaGlsZCh0YWcpOwogICAgfQoKICAgIGhlYWRUYWdzLnB1c2godGFnKTsKICB9Cn07CgpmdW5jdGlvbiBjcmVhdGVUYWcgKHRhZ09iaikgewogIGlmICghdGFnT2JqIHx8ICF0YWdPYmoudGFnTmFtZSkgeyByZXR1cm47IH0KICB2YXIgbWV0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnT2JqLnRhZ05hbWUpOwogIG1ldGEuc2V0QXR0cmlidXRlKGNvbnN0YW50cy5BRlJBTUVfSU5KRUNURUQsICcnKTsKICByZXR1cm4gZXh0ZW5kKG1ldGEsIHRhZ09iai5hdHRyaWJ1dGVzKTsKfQoKfSx7Ii4uLy4uL2NvbnN0YW50cy8iOjk4LCIuLi8uLi91dGlscyI6MTc5fV0sMTEyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGJpbmQgPSBfZGVyZXFfKCcuLi8uLi91dGlscy9iaW5kJyk7CnZhciBpc0lmcmFtZWQgPSBfZGVyZXFfKCcuLi8uLi91dGlscy8nKS5pc0lmcmFtZWQ7CgovKioKICogUHJvdmlkZXMgYSBwb3N0IG1lc3NhZ2UgQVBJIGZvciBzY2VuZXMgY29udGFpbmVkCiAqIGluIGFuIGlmcmFtZS4KICovCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gaW5pdFBvc3RNZXNzYWdlQVBJIChzY2VuZSkgewogIC8vIEhhbmRsZXMgZnVsbHNjcmVlbiBiZWhhdmlvciB3aGVuIGluc2lkZSBhbiBpZnJhbWUuCiAgaWYgKCFpc0lmcmFtZWQoKSkgeyByZXR1cm47IH0KICAvLyBwb3N0TWVzc2FnZSBBUEkgaGFuZGxlcgogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgYmluZChwb3N0TWVzc2FnZUFQSUhhbmRsZXIsIHNjZW5lKSk7Cn07CgpmdW5jdGlvbiBwb3N0TWVzc2FnZUFQSUhhbmRsZXIgKGV2ZW50KSB7CiAgdmFyIHNjZW5lID0gdGhpczsKICBpZiAoIWV2ZW50LmRhdGEpIHsgcmV0dXJuOyB9CgogIHN3aXRjaCAoZXZlbnQuZGF0YS50eXBlKSB7CiAgICBjYXNlICd2cic6IHsKICAgICAgc3dpdGNoIChldmVudC5kYXRhLmRhdGEpIHsKICAgICAgICBjYXNlICdlbnRlcic6CiAgICAgICAgICBzY2VuZS5lbnRlclZSKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdleGl0JzoKICAgICAgICAgIHNjZW5lLmV4aXRWUigpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Cn0KCn0seyIuLi8uLi91dGlscy8iOjE3OSwiLi4vLi4vdXRpbHMvYmluZCI6MTczfV0sMTEzOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyoKICBTY2VuZSBpbmRleCBmb3Iga2VlcGluZyB0cmFjayBvZiBjcmVhdGVkIHNjZW5lcy4KKi8KbW9kdWxlLmV4cG9ydHMgPSBbXTsKCn0se31dLDExNDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBXYWtlbG9jayA9IF9kZXJlcV8oJy4uLy4uLy4uL3ZlbmRvci93YWtlbG9jay93YWtlbG9jaycpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpbml0V2FrZWxvY2sgKHNjZW5lKSB7CiAgaWYgKCFzY2VuZS5pc01vYmlsZSkgeyByZXR1cm47IH0KCiAgdmFyIHdha2Vsb2NrID0gc2NlbmUud2FrZWxvY2sgPSBuZXcgV2FrZWxvY2soKTsKICBzY2VuZS5hZGRFdmVudExpc3RlbmVyKCdlbnRlci12cicsIGZ1bmN0aW9uICgpIHsgd2FrZWxvY2sucmVxdWVzdCgpOyB9KTsKICBzY2VuZS5hZGRFdmVudExpc3RlbmVyKCdleGl0LXZyJywgZnVuY3Rpb24gKCkgeyB3YWtlbG9jay5yZWxlYXNlKCk7IH0pOwp9OwoKfSx7Ii4uLy4uLy4uL3ZlbmRvci93YWtlbG9jay93YWtlbG9jayI6MTkyfV0sMTE1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7CnZhciBQcm9wZXJ0eVR5cGVzID0gX2RlcmVxXygnLi9wcm9wZXJ0eVR5cGVzJyk7Cgp2YXIgZGVidWcgPSB1dGlscy5kZWJ1ZzsKdmFyIGlzVmFsaWREZWZhdWx0VmFsdWUgPSBQcm9wZXJ0eVR5cGVzLmlzVmFsaWREZWZhdWx0VmFsdWU7CnZhciBwcm9wZXJ0eVR5cGVzID0gUHJvcGVydHlUeXBlcy5wcm9wZXJ0eVR5cGVzOwoKdmFyIHdhcm4gPSBkZWJ1ZygnY29yZTpzY2hlbWE6d2FybicpOwoKLyoqCiAqIEEgc2NoZW1hIGlzIGNsYXNzaWZpZWQgYXMgYSBzY2hlbWEgZm9yIGEgc2luZ2xlIHByb3BlcnR5IGlmOgogKiAtIGB0eXBlYCBpcyBkZWZpbmVkIG9uIHRoZSBzY2hlbWEgYXMgYSBzdHJpbmcuCiAqIC0gT1IgYGRlZmF1bHRgIGlzIGRlZmluZWQgb24gdGhlIHNjaGVtYSwgYXMgYSByZXNlcnZlZCBrZXl3b3JkLgogKiAtIE9SIHNjaGVtYSBpcyBlbXB0eS4KICovCmZ1bmN0aW9uIGlzU2luZ2xlUHJvcGVydHkgKHNjaGVtYSkgewogIGlmICgndHlwZScgaW4gc2NoZW1hKSB7CiAgICByZXR1cm4gdHlwZW9mIHNjaGVtYS50eXBlID09PSAnc3RyaW5nJzsKICB9CiAgcmV0dXJuICdkZWZhdWx0JyBpbiBzY2hlbWE7Cn0KbW9kdWxlLmV4cG9ydHMuaXNTaW5nbGVQcm9wZXJ0eSA9IGlzU2luZ2xlUHJvcGVydHk7CgovKioKICogQnVpbGQgc3RlcCB0byBzY2hlbWEgdG8gdXNlIGB0eXBlYCB0byBpbmplY3QgZGVmYXVsdCB2YWx1ZSwgcGFyc2VyLCBhbmQgc3RyaW5naWZpZXIuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBzY2hlbWEKICogQHBhcmFtIHtzdHJpbmd9IGNvbXBvbmVudE5hbWUKICogQHJldHVybnMge29iamVjdH0gU2NoZW1hLgogKi8KbW9kdWxlLmV4cG9ydHMucHJvY2VzcyA9IGZ1bmN0aW9uIChzY2hlbWEsIGNvbXBvbmVudE5hbWUpIHsKICB2YXIgcHJvcE5hbWU7CgogIC8vIEZvciBzaW5nbGUgcHJvcGVydHkgc2NoZW1hLCBydW4gcHJvY2Vzc1Byb3BEZWZpbml0aW9uIG92ZXIgdGhlIHdob2xlIHNjaGVtYS4KICBpZiAoaXNTaW5nbGVQcm9wZXJ0eShzY2hlbWEpKSB7CiAgICByZXR1cm4gcHJvY2Vzc1Byb3BlcnR5RGVmaW5pdGlvbihzY2hlbWEsIGNvbXBvbmVudE5hbWUpOwogIH0KCiAgLy8gRm9yIG11bHRpLXByb3BlcnR5IHNjaGVtYSwgcnVuIHByb2Nlc3NQcm9wRGVmaW5pdGlvbiBvdmVyIGVhY2ggcHJvcGVydHkgZGVmaW5pdGlvbi4KICBmb3IgKHByb3BOYW1lIGluIHNjaGVtYSkgewogICAgc2NoZW1hW3Byb3BOYW1lXSA9IHByb2Nlc3NQcm9wZXJ0eURlZmluaXRpb24oc2NoZW1hW3Byb3BOYW1lXSwgY29tcG9uZW50TmFtZSk7CiAgfQogIHJldHVybiBzY2hlbWE7Cn07CgovKioKICogSW5qZWN0IGRlZmF1bHQgdmFsdWUsIHBhcnNlciwgc3RyaW5naWZpZXIgZm9yIHNpbmdsZSBwcm9wZXJ0eS4KICoKICogQHBhcmFtIHtvYmplY3R9IHByb3BEZWZpbml0aW9uCiAqIEBwYXJhbSB7c3RyaW5nfSBjb21wb25lbnROYW1lCiAqLwpmdW5jdGlvbiBwcm9jZXNzUHJvcGVydHlEZWZpbml0aW9uIChwcm9wRGVmaW5pdGlvbiwgY29tcG9uZW50TmFtZSkgewogIHZhciBkZWZhdWx0VmFsID0gcHJvcERlZmluaXRpb24uZGVmYXVsdDsKICB2YXIgaXNDdXN0b21UeXBlOwogIHZhciBwcm9wVHlwZTsKICB2YXIgdHlwZU5hbWUgPSBwcm9wRGVmaW5pdGlvbi50eXBlOwoKICAvLyBUeXBlIGluZmVyZW5jZS4KICBpZiAoIXByb3BEZWZpbml0aW9uLnR5cGUpIHsKICAgIGlmIChkZWZhdWx0VmFsICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAodHlwZW9mIGRlZmF1bHRWYWwgPT09ICdib29sZWFuJyB8fCB0eXBlb2YgZGVmYXVsdFZhbCA9PT0gJ251bWJlcicpKSB7CiAgICAgIC8vIFR5cGUgaW5mZXJlbmNlLgogICAgICB0eXBlTmFtZSA9IHR5cGVvZiBkZWZhdWx0VmFsOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRlZmF1bHRWYWwpKSB7CiAgICAgIHR5cGVOYW1lID0gJ2FycmF5JzsKICAgIH0gZWxzZSB7CiAgICAgIC8vIEZhbGwgYmFjayB0byBzdHJpbmcuCiAgICAgIHR5cGVOYW1lID0gJ3N0cmluZyc7CiAgICB9CiAgfSBlbHNlIGlmIChwcm9wRGVmaW5pdGlvbi50eXBlID09PSAnYm9vbCcpIHsKICAgIHR5cGVOYW1lID0gJ2Jvb2xlYW4nOwogIH0gZWxzZSBpZiAocHJvcERlZmluaXRpb24udHlwZSA9PT0gJ2Zsb2F0JykgewogICAgdHlwZU5hbWUgPSAnbnVtYmVyJzsKICB9CgogIHByb3BUeXBlID0gcHJvcGVydHlUeXBlc1t0eXBlTmFtZV07CiAgaWYgKCFwcm9wVHlwZSkgewogICAgd2FybignVW5rbm93biBwcm9wZXJ0eSB0eXBlIGZvciBjb21wb25lbnQgYCcgKyBjb21wb25lbnROYW1lICsgJ2A6ICcgKyB0eXBlTmFtZSk7CiAgfQoKICAvLyBGaWxsIGluIHBhcnNlIGFuZCBzdHJpbmdpZnkgdXNpbmcgcHJvcGVydHkgdHlwZXMuCiAgaXNDdXN0b21UeXBlID0gISFwcm9wRGVmaW5pdGlvbi5wYXJzZTsKICBwcm9wRGVmaW5pdGlvbi5wYXJzZSA9IHByb3BEZWZpbml0aW9uLnBhcnNlIHx8IHByb3BUeXBlLnBhcnNlOwogIHByb3BEZWZpbml0aW9uLnN0cmluZ2lmeSA9IHByb3BEZWZpbml0aW9uLnN0cmluZ2lmeSB8fCBwcm9wVHlwZS5zdHJpbmdpZnk7CgogIC8vIEZpbGwgaW4gdHlwZSBuYW1lLgogIHByb3BEZWZpbml0aW9uLnR5cGUgPSB0eXBlTmFtZTsKCiAgLy8gQ2hlY2sgdGhhdCBkZWZhdWx0IHZhbHVlIGV4aXN0cy4KICBpZiAoJ2RlZmF1bHQnIGluIHByb3BEZWZpbml0aW9uKSB7CiAgICAvLyBDaGVjayB0aGF0IGRlZmF1bHQgdmFsdWVzIGFyZSB2YWxpZC4KICAgIGlmICghaXNDdXN0b21UeXBlICYmICFpc1ZhbGlkRGVmYXVsdFZhbHVlKHR5cGVOYW1lLCBkZWZhdWx0VmFsKSkgewogICAgICB3YXJuKCdEZWZhdWx0IHZhbHVlIGAnICsgZGVmYXVsdFZhbCArICdgIGRvZXMgbm90IG1hdGNoIHR5cGUgYCcgKyB0eXBlTmFtZSArCiAgICAgICAgICAgJ2AgaW4gY29tcG9uZW50IGAnICsgY29tcG9uZW50TmFtZSArICdgJyk7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIEZpbGwgaW4gZGVmYXVsdCB2YWx1ZS4KICAgIHByb3BEZWZpbml0aW9uLmRlZmF1bHQgPSBwcm9wVHlwZS5kZWZhdWx0OwogIH0KCiAgcmV0dXJuIHByb3BEZWZpbml0aW9uOwp9Cm1vZHVsZS5leHBvcnRzLnByb2Nlc3NQcm9wZXJ0eURlZmluaXRpb24gPSBwcm9jZXNzUHJvcGVydHlEZWZpbml0aW9uOwoKLyoqCiAqIFBhcnNlIHByb3BEYXRhIHVzaW5nIHNjaGVtYS4gVXNlIGRlZmF1bHQgdmFsdWVzIGlmIG5vdCBleGlzdGluZyBpbiBwcm9wRGF0YS4KICoKICogQHBhcmFtIHtvYmplY3R9IHByb3BEYXRhIC0gVW5wYXJzZWQgcHJvcGVydGllcy4KICogQHBhcmFtIHtvYmplY3R9IHNjaGVtYSAtIFByb3BlcnR5IHR5cGVzIGRlZmluaXRpb24uCiAqIEBwYXJhbSB7Ym9vbGVhbn0gZ2V0UGFydGlhbERhdGEgLSBXaGV0aGVyIHRvIHJldHVybiBmdWxsIGNvbXBvbmVudCBkYXRhIG9yIGp1c3QgdGhlIGRhdGEKICogICAgICAgIHdpdGgga2V5cyBpbiBgcHJvcERhdGFgLgogKiBAcGFyYW0ge3N0cmluZyB9IGNvbXBvbmVudE5hbWUgLSBOYW1lIG9mIHRoZSBjb21wb25lbnQsIHVzZWQgZm9yIHRoZSBwcm9wZXJ0eSB3YXJuaW5nLgogKiBAcGFyYW0ge2Jvb2xlYW59IHNpbGVudCAtIFN1cHByZXNzIHdhcm5pbmcgbWVzc2FnZXMuCiAqLwptb2R1bGUuZXhwb3J0cy5wYXJzZVByb3BlcnRpZXMgPSAoZnVuY3Rpb24gKCkgewogIHZhciBwcm9wTmFtZXMgPSBbXTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChwcm9wRGF0YSwgc2NoZW1hLCBnZXRQYXJ0aWFsRGF0YSwgY29tcG9uZW50TmFtZSwgc2lsZW50KSB7CiAgICB2YXIgaTsKICAgIHZhciBwcm9wTmFtZTsKICAgIHZhciBwcm9wRGVmaW5pdGlvbjsKICAgIHZhciBwcm9wVmFsdWU7CgogICAgcHJvcE5hbWVzLmxlbmd0aCA9IDA7CiAgICBmb3IgKHByb3BOYW1lIGluIChnZXRQYXJ0aWFsRGF0YSA/IHByb3BEYXRhIDogc2NoZW1hKSkgewogICAgICBpZiAoZ2V0UGFydGlhbERhdGEgJiYgcHJvcERhdGFbcHJvcE5hbWVdID09PSB1bmRlZmluZWQpIHsgY29udGludWU7IH0KICAgICAgcHJvcE5hbWVzLnB1c2gocHJvcE5hbWUpOwogICAgfQoKICAgIGlmIChwcm9wRGF0YSA9PT0gbnVsbCB8fCB0eXBlb2YgcHJvcERhdGEgIT09ICdvYmplY3QnKSB7IHJldHVybiBwcm9wRGF0YTsgfQoKICAgIC8vIFZhbGlkYXRpb24gZXJyb3JzLgogICAgZm9yIChwcm9wTmFtZSBpbiBwcm9wRGF0YSkgewogICAgICBpZiAocHJvcERhdGFbcHJvcE5hbWVdICE9PSB1bmRlZmluZWQgJiYgIXNjaGVtYVtwcm9wTmFtZV0gJiYgIXNpbGVudCkgewogICAgICAgIHdhcm4oJ1Vua25vd24gcHJvcGVydHkgYCcgKyBwcm9wTmFtZSArCiAgICAgICAgICAgICAnYCBmb3IgY29tcG9uZW50L3N5c3RlbSBgJyArIGNvbXBvbmVudE5hbWUgKyAnYC4nKTsKICAgICAgfQogICAgfQoKICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wTmFtZXMubGVuZ3RoOyBpKyspIHsKICAgICAgcHJvcE5hbWUgPSBwcm9wTmFtZXNbaV07CiAgICAgIHByb3BEZWZpbml0aW9uID0gc2NoZW1hW3Byb3BOYW1lXTsKICAgICAgcHJvcFZhbHVlID0gcHJvcERhdGFbcHJvcE5hbWVdOwogICAgICBpZiAoIShzY2hlbWFbcHJvcE5hbWVdKSkgeyByZXR1cm47IH0KICAgICAgcHJvcERhdGFbcHJvcE5hbWVdID0gcGFyc2VQcm9wZXJ0eShwcm9wVmFsdWUsIHByb3BEZWZpbml0aW9uKTsKICAgIH0KCiAgICByZXR1cm4gcHJvcERhdGE7CiAgfTsKfSkoKTsKCi8qKgogKiBEZXNlcmlhbGl6ZSBhIHNpbmdsZSBwcm9wZXJ0eS4KICovCmZ1bmN0aW9uIHBhcnNlUHJvcGVydHkgKHZhbHVlLCBwcm9wRGVmaW5pdGlvbikgewogIC8vIFVzZSBkZWZhdWx0IHZhbHVlIGlmIHZhbHVlIGlzIGZhbHN5LgogIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSAnJykgewogICAgdmFsdWUgPSBwcm9wRGVmaW5pdGlvbi5kZWZhdWx0OwogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7IHZhbHVlID0gdmFsdWUuc2xpY2UoKTsgfQogIH0KICAvLyBJbnZva2UgcHJvcGVydHkgdHlwZSBwYXJzZXIuCiAgcmV0dXJuIHByb3BEZWZpbml0aW9uLnBhcnNlKHZhbHVlLCBwcm9wRGVmaW5pdGlvbi5kZWZhdWx0KTsKfQptb2R1bGUuZXhwb3J0cy5wYXJzZVByb3BlcnR5ID0gcGFyc2VQcm9wZXJ0eTsKCi8qKgogKiBTZXJpYWxpemUgYSBncm91cCBvZiBwcm9wZXJ0aWVzLgogKi8KbW9kdWxlLmV4cG9ydHMuc3RyaW5naWZ5UHJvcGVydGllcyA9IGZ1bmN0aW9uIChwcm9wRGF0YSwgc2NoZW1hKSB7CiAgdmFyIHByb3BOYW1lOwogIHZhciBwcm9wRGVmaW5pdGlvbjsKICB2YXIgcHJvcFZhbHVlOwogIHZhciBzdHJpbmdpZmllZERhdGEgPSB7fTsKICB2YXIgdmFsdWU7CgogIGZvciAocHJvcE5hbWUgaW4gcHJvcERhdGEpIHsKICAgIHByb3BEZWZpbml0aW9uID0gc2NoZW1hW3Byb3BOYW1lXTsKICAgIHByb3BWYWx1ZSA9IHByb3BEYXRhW3Byb3BOYW1lXTsKICAgIHZhbHVlID0gcHJvcFZhbHVlOwogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHsKICAgICAgdmFsdWUgPSBzdHJpbmdpZnlQcm9wZXJ0eShwcm9wVmFsdWUsIHByb3BEZWZpbml0aW9uKTsKICAgICAgaWYgKCFwcm9wRGVmaW5pdGlvbikgeyB3YXJuKCdVbmtub3duIGNvbXBvbmVudCBwcm9wZXJ0eTogJyArIHByb3BOYW1lKTsgfQogICAgfQogICAgc3RyaW5naWZpZWREYXRhW3Byb3BOYW1lXSA9IHZhbHVlOwogIH0KICByZXR1cm4gc3RyaW5naWZpZWREYXRhOwp9OwoKLyoqCiAqIFNlcmlhbGl6ZSBhIHNpbmdsZSBwcm9wZXJ0eS4KICovCmZ1bmN0aW9uIHN0cmluZ2lmeVByb3BlcnR5ICh2YWx1ZSwgcHJvcERlZmluaXRpb24pIHsKICAvLyBUaGlzIGZ1bmN0aW9uIHN0cmluZ2lmaWVzIGJ1dCBpdCdzIHVzZWQgaW4gYSBjb250ZXh0IHdoZXJlCiAgLy8gdGhlcmUncyBhbHdheXMgc2Vjb25kIHN0cmluZ2lmaWNhdGlvbiBwYXNzLiBCeSByZXR1cm5pbmcgdGhlIG9yaWdpbmFsCiAgLy8gdmFsdWUgd2hlbiBpdCdzIG5vdCBhbiBvYmplY3Qgd2Ugc2F2ZSBvbmUgdW5uZWNlc3NhcnkgY2FsbAogIC8vIHRvIEpTT04uc3RyaW5naWZ5LgogIGlmICh0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7IHJldHVybiB2YWx1ZTsgfQogIC8vIGlmIHRoZXJlJ3Mgbm8gc2NoZW1hIGZvciB0aGUgcHJvcGVydHkgd2UgdXNlIHN0YW5kYXIgSlNPTiBzdHJpbmdpZnkKICBpZiAoIXByb3BEZWZpbml0aW9uIHx8IHZhbHVlID09PSBudWxsKSB7IHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7IH0KICByZXR1cm4gcHJvcERlZmluaXRpb24uc3RyaW5naWZ5KHZhbHVlKTsKfQptb2R1bGUuZXhwb3J0cy5zdHJpbmdpZnlQcm9wZXJ0eSA9IHN0cmluZ2lmeVByb3BlcnR5OwoKfSx7Ii4uL3V0aWxzLyI6MTc5LCIuL3Byb3BlcnR5VHlwZXMiOjEwOH1dLDExNjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBzY2hlbWEgPSBfZGVyZXFfKCcuL3NjaGVtYScpOwoKdmFyIHByb2Nlc3NTY2hlbWEgPSBzY2hlbWEucHJvY2VzczsKdmFyIHNoYWRlcnMgPSBtb2R1bGUuZXhwb3J0cy5zaGFkZXJzID0ge307ICAvLyBLZWVwIHRyYWNrIG9mIHJlZ2lzdGVyZWQgc2hhZGVycy4KdmFyIHNoYWRlck5hbWVzID0gbW9kdWxlLmV4cG9ydHMuc2hhZGVyTmFtZXMgPSBbXTsgIC8vIEtlZXAgdHJhY2sgb2YgdGhlIG5hbWVzIG9mIHJlZ2lzdGVyZWQgc2hhZGVycy4KdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzJyk7CgovLyBBLUZyYW1lIHByb3BlcnRpZXMgdG8gdGhyZWUuanMgdW5pZm9ybSB0eXBlcy4KdmFyIHByb3BlcnR5VG9UaHJlZU1hcHBpbmcgPSB7CiAgYXJyYXk6ICd2MycsCiAgY29sb3I6ICd2MycsCiAgaW50OiAnaScsCiAgbnVtYmVyOiAnZicsCiAgbWFwOiAndCcsCiAgdGltZTogJ2YnLAogIHZlYzI6ICd2MicsCiAgdmVjMzogJ3YzJywKICB2ZWM0OiAndjQnCn07CgovKioKICogU2hhZGVyIGNsYXNzIGRlZmluaXRpb24uCiAqCiAqIFNoYWRlcnMgZXh0ZW5kIHRoZSBtYXRlcmlhbCBjb21wb25lbnQgQVBJIHNvIHlvdSBjYW4gY3JlYXRlIHlvdXIgb3duIGxpYnJhcnkKICogb2YgY3VzdG9taXplZCBtYXRlcmlhbHMKICoKICovCnZhciBTaGFkZXIgPSBtb2R1bGUuZXhwb3J0cy5TaGFkZXIgPSBmdW5jdGlvbiAoKSB7fTsKClNoYWRlci5wcm90b3R5cGUgPSB7CiAgLyoqCiAgICogQ29udGFpbnMgdGhlIHR5cGUgc2NoZW1hIGFuZCBkZWZhdWx0cyBmb3IgdGhlIGRhdGEgdmFsdWVzLgogICAqIERhdGEgaXMgY29lcmNlZCBpbnRvIHRoZSB0eXBlcyBvZiB0aGUgdmFsdWVzIG9mIHRoZSBkZWZhdWx0cy4KICAgKi8KICBzY2hlbWE6IHt9LAoKICB2ZXJ0ZXhTaGFkZXI6CiAgICAndm9pZCBtYWluKCkgeycgKwogICAgICAnZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsnICsKICAgICd9JywKCiAgZnJhZ21lbnRTaGFkZXI6CiAgICAndm9pZCBtYWluKCkgeycgKwogICAgICAnZ2xfRnJhZ0NvbG9yID0gdmVjNCgxLjAsIDAuMCwgMS4wLCAxLjApOycgKwogICAgJ30nLAoKICAvKioKICAgKiBJbml0IGhhbmRsZXIuIFNpbWlsYXIgdG8gYXR0YWNoZWRDYWxsYmFjay4KICAgKiBDYWxsZWQgZHVyaW5nIHNoYWRlciBpbml0aWFsaXphdGlvbiBhbmQgaXMgb25seSBydW4gb25jZS4KICAgKi8KICBpbml0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy5hdHRyaWJ1dGVzID0gdGhpcy5pbml0VmFyaWFibGVzKGRhdGEsICdhdHRyaWJ1dGUnKTsKICAgIHRoaXMudW5pZm9ybXMgPSB0aGlzLmluaXRWYXJpYWJsZXMoZGF0YSwgJ3VuaWZvcm0nKTsKICAgIHRoaXMubWF0ZXJpYWwgPSBuZXcgKHRoaXMucmF3ID8gVEhSRUUuUmF3U2hhZGVyTWF0ZXJpYWwgOiBUSFJFRS5TaGFkZXJNYXRlcmlhbCkoewogICAgICAvLyBhdHRyaWJ1dGVzOiB0aGlzLmF0dHJpYnV0ZXMsCiAgICAgIHVuaWZvcm1zOiB0aGlzLnVuaWZvcm1zLAogICAgICB2ZXJ0ZXhTaGFkZXI6IHRoaXMudmVydGV4U2hhZGVyLAogICAgICBmcmFnbWVudFNoYWRlcjogdGhpcy5mcmFnbWVudFNoYWRlcgogICAgfSk7CiAgICByZXR1cm4gdGhpcy5tYXRlcmlhbDsKICB9LAoKICBpbml0VmFyaWFibGVzOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewogICAgdmFyIGtleTsKICAgIHZhciBzY2hlbWEgPSB0aGlzLnNjaGVtYTsKICAgIHZhciB2YXJpYWJsZXMgPSB7fTsKICAgIHZhciB2YXJUeXBlOwoKICAgIGZvciAoa2V5IGluIHNjaGVtYSkgewogICAgICBpZiAoc2NoZW1hW2tleV0uaXMgIT09IHR5cGUpIHsgY29udGludWU7IH0KICAgICAgdmFyVHlwZSA9IHByb3BlcnR5VG9UaHJlZU1hcHBpbmdbc2NoZW1hW2tleV0udHlwZV07CiAgICAgIHZhcmlhYmxlc1trZXldID0gewogICAgICAgIHR5cGU6IHZhclR5cGUsCiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCAgLy8gTGV0IHVwZGF0ZVZhcmlhYmxlcyBoYW5kbGUgc2V0dGluZyB0aGVzZS4KICAgICAgfTsKICAgIH0KICAgIHJldHVybiB2YXJpYWJsZXM7CiAgfSwKCiAgLyoqCiAgICogVXBkYXRlIGhhbmRsZXIuIFNpbWlsYXIgdG8gYXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrLgogICAqIENhbGxlZCB3aGVuZXZlciB0aGUgYXNzb2NpYXRlZCBtYXRlcmlhbCBkYXRhIGNoYW5nZXMuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIE5ldyBtYXRlcmlhbCBkYXRhLgogICAqLwogIHVwZGF0ZTogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMudXBkYXRlVmFyaWFibGVzKGRhdGEsICdhdHRyaWJ1dGUnKTsKICAgIHRoaXMudXBkYXRlVmFyaWFibGVzKGRhdGEsICd1bmlmb3JtJyk7CiAgfSwKCiAgdXBkYXRlVmFyaWFibGVzOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewogICAgdmFyIGtleTsKICAgIHZhciBtYXRlcmlhbEtleTsKICAgIHZhciBzY2hlbWEgPSB0aGlzLnNjaGVtYTsKICAgIHZhciB2YXJpYWJsZXM7CgogICAgdmFyaWFibGVzID0gdHlwZSA9PT0gJ3VuaWZvcm0nID8gdGhpcy51bmlmb3JtcyA6IHRoaXMuYXR0cmlidXRlczsKICAgIGZvciAoa2V5IGluIGRhdGEpIHsKICAgICAgaWYgKCFzY2hlbWFba2V5XSB8fCBzY2hlbWFba2V5XS5pcyAhPT0gdHlwZSkgeyBjb250aW51ZTsgfQoKICAgICAgaWYgKHNjaGVtYVtrZXldLnR5cGUgPT09ICdtYXAnKSB7CiAgICAgICAgLy8gSWYgZGF0YSB1bmNoYW5nZWQsIGdldCBvdXQgZWFybHkuCiAgICAgICAgaWYgKCF2YXJpYWJsZXNba2V5XSB8fCB2YXJpYWJsZXNba2V5XS52YWx1ZSA9PT0gZGF0YVtrZXldKSB7IGNvbnRpbnVlOyB9CgogICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgaXMgbmVlZGVkIGZvciB0ZXh0dXJlcy4KICAgICAgICBtYXRlcmlhbEtleSA9ICdfdGV4dHVyZV8nICsga2V5OwoKICAgICAgICAvLyBXZSBjYW4ndCBhY3R1YWxseSBzZXQgdGhlIHZhcmlhYmxlIGNvcnJlY3RseSB1bnRpbCB3ZSd2ZSBsb2FkZWQgdGhlIHRleHR1cmUuCiAgICAgICAgdGhpcy5zZXRNYXBPblRleHR1cmVMb2FkKHZhcmlhYmxlcywga2V5LCBtYXRlcmlhbEtleSk7CgogICAgICAgIC8vIEtpY2sgb2ZmIHRoZSB0ZXh0dXJlIHVwZGF0ZSBub3cgdGhhdCBoYW5kbGVyIGlzIGFkZGVkLgogICAgICAgIHV0aWxzLm1hdGVyaWFsLnVwZGF0ZU1hcE1hdGVyaWFsRnJvbURhdGEobWF0ZXJpYWxLZXksIGtleSwgdGhpcywgZGF0YSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdmFyaWFibGVzW2tleV0udmFsdWUgPSB0aGlzLnBhcnNlVmFsdWUoc2NoZW1hW2tleV0udHlwZSwgZGF0YVtrZXldKTsKICAgICAgdmFyaWFibGVzW2tleV0ubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgfQogIH0sCgogIHBhcnNlVmFsdWU6IGZ1bmN0aW9uICh0eXBlLCB2YWx1ZSkgewogICAgdmFyIGNvbG9yOwogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ3ZlYzInOiB7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3IyKHZhbHVlLngsIHZhbHVlLnkpOwogICAgICB9CiAgICAgIGNhc2UgJ3ZlYzMnOiB7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3IzKHZhbHVlLngsIHZhbHVlLnksIHZhbHVlLnopOwogICAgICB9CiAgICAgIGNhc2UgJ3ZlYzQnOiB7CiAgICAgICAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3I0KHZhbHVlLngsIHZhbHVlLnksIHZhbHVlLnosIHZhbHVlLncpOwogICAgICB9CiAgICAgIGNhc2UgJ2NvbG9yJzogewogICAgICAgIGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKHZhbHVlKTsKICAgICAgICByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjMoY29sb3IuciwgY29sb3IuZywgY29sb3IuYik7CiAgICAgIH0KICAgICAgY2FzZSAnbWFwJzogewogICAgICAgIHJldHVybiBUSFJFRS5JbWFnZVV0aWxzLmxvYWRUZXh0dXJlKHZhbHVlKTsKICAgICAgfQogICAgICBkZWZhdWx0OiB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICB9CiAgfSwKCiAgc2V0TWFwT25UZXh0dXJlTG9hZDogZnVuY3Rpb24gKHZhcmlhYmxlcywga2V5LCBtYXRlcmlhbEtleSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdtYXRlcmlhbHRleHR1cmVsb2FkZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhcmlhYmxlc1trZXldLnZhbHVlID0gc2VsZi5tYXRlcmlhbFttYXRlcmlhbEtleV07CiAgICAgIHZhcmlhYmxlc1trZXldLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0pOwogIH0KfTsKCi8qKgogKiBSZWdpc3RlcnMgYSBzaGFkZXIgdG8gQS1GcmFtZS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBzaGFkZXIgbmFtZS4KICogQHBhcmFtIHtvYmplY3R9IGRlZmluaXRpb24gLSBzaGFkZXIgcHJvcGVydHkgYW5kIG1ldGhvZHMuCiAqIEByZXR1cm5zIHtvYmplY3R9IFNoYWRlci4KICovCm1vZHVsZS5leHBvcnRzLnJlZ2lzdGVyU2hhZGVyID0gZnVuY3Rpb24gKG5hbWUsIGRlZmluaXRpb24pIHsKICB2YXIgTmV3U2hhZGVyOwogIHZhciBwcm90byA9IHt9OwoKICAvLyBGb3JtYXQgZGVmaW5pdGlvbiBvYmplY3QgdG8gcHJvdG90eXBlIG9iamVjdC4KICBPYmplY3Qua2V5cyhkZWZpbml0aW9uKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgIHByb3RvW2tleV0gPSB7CiAgICAgIHZhbHVlOiBkZWZpbml0aW9uW2tleV0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9OwogIH0pOwoKICBpZiAoc2hhZGVyc1tuYW1lXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc2hhZGVyICcgKyBuYW1lICsgJyBoYXMgYmVlbiBhbHJlYWR5IHJlZ2lzdGVyZWQnKTsKICB9CiAgTmV3U2hhZGVyID0gZnVuY3Rpb24gKCkgeyBTaGFkZXIuY2FsbCh0aGlzKTsgfTsKICBOZXdTaGFkZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTaGFkZXIucHJvdG90eXBlLCBwcm90byk7CiAgTmV3U2hhZGVyLnByb3RvdHlwZS5uYW1lID0gbmFtZTsKICBOZXdTaGFkZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTmV3U2hhZGVyOwogIHNoYWRlcnNbbmFtZV0gPSB7CiAgICBTaGFkZXI6IE5ld1NoYWRlciwKICAgIHNjaGVtYTogcHJvY2Vzc1NjaGVtYShOZXdTaGFkZXIucHJvdG90eXBlLnNjaGVtYSkKICB9OwogIHNoYWRlck5hbWVzLnB1c2gobmFtZSk7CiAgcmV0dXJuIE5ld1NoYWRlcjsKfTsKCn0seyIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMiOjE3OSwiLi9zY2hlbWEiOjExNX1dLDExNzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBjb21wb25lbnRzID0gX2RlcmVxXygnLi9jb21wb25lbnQnKTsKdmFyIHNjaGVtYSA9IF9kZXJlcV8oJy4vc2NoZW1hJyk7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzLycpOwoKdmFyIHBhcnNlUHJvcGVydGllcyA9IHNjaGVtYS5wYXJzZVByb3BlcnRpZXM7CnZhciBwYXJzZVByb3BlcnR5ID0gc2NoZW1hLnBhcnNlUHJvcGVydHk7CnZhciBwcm9jZXNzU2NoZW1hID0gc2NoZW1hLnByb2Nlc3M7CnZhciBpc1NpbmdsZVByb3AgPSBzY2hlbWEuaXNTaW5nbGVQcm9wZXJ0eTsKdmFyIHN0eWxlUGFyc2VyID0gdXRpbHMuc3R5bGVQYXJzZXI7Cgp2YXIgc3lzdGVtcyA9IG1vZHVsZS5leHBvcnRzLnN5c3RlbXMgPSB7fTsgIC8vIEtlZXAgdHJhY2sgb2YgcmVnaXN0ZXJlZCBzeXN0ZW1zLgoKLyoqCiAqIFN5c3RlbSBjbGFzcyBkZWZpbml0aW9uLgogKgogKiBTeXN0ZW1zIHByb3ZpZGUgZ2xvYmFsIHNjb3BlIGFuZCBzZXJ2aWNlcyB0byBhIGdyb3VwIG9mIGluc3RhbnRpYXRlZCBjb21wb25lbnRzIG9mIHRoZQogKiBzYW1lIGNsYXNzLiBUaGV5IGNhbiBhbHNvIGhlbHAgYWJzdHJhY3QgbG9naWMgYXdheSBmcm9tIGNvbXBvbmVudHMgc3VjaCB0aGF0IGNvbXBvbmVudHMKICogb25seSBoYXZlIHRvIHdvcnJ5IGFib3V0IGRhdGEuCiAqCiAqIEZvciBleGFtcGxlLCBhIHBoeXNpY3MgY29tcG9uZW50IHRoYXQgY3JlYXRlcyBhIHBoeXNpY3Mgd29ybGQgdGhhdCBvdmVyc2VlcwogKiBhbGwgZW50aXRpZXMgd2l0aCBhIHBoeXNpY3Mgb3IgcmlnaWQgYm9keSBjb21wb25lbnQuCiAqCiAqIFRPRE86IEhhdmUgdGhlIFN5c3RlbSBwcm90b3R5cGUgcmV1c2UgdGhlIENvbXBvbmVudCBwcm90b3R5cGUuIE1vc3QgY29kZSBpcyBjb3BpZWQKICogYW5kIHNvbWUgcGllY2VzIGFyZSBtaXNzaW5nIGZyb20gdGhlIENvbXBvbmVudCBmYWNpbGl0aWVzIChlLmcuLCBhdHRyaWJ1dGUgY2FjaGluZywKICogc2V0QXR0cmlidXRlIGJlaGF2aW9yKS4KICoKICogQG1lbWJlciB7c3RyaW5nfSBuYW1lIC0gTmFtZSB0aGF0IHN5c3RlbSBpcyByZWdpc3RlcmVkIHVuZGVyLgogKiBAbWVtYmVyIHtFbGVtZW50fSBzY2VuZUVsIC0gSGFuZGxlIHRvIHRoZSBzY2VuZSBlbGVtZW50IHdoZXJlIHN5c3RlbSBhcHBsaWVzIHRvLgogKi8KdmFyIFN5c3RlbSA9IG1vZHVsZS5leHBvcnRzLlN5c3RlbSA9IGZ1bmN0aW9uIChzY2VuZUVsKSB7CiAgdmFyIGNvbXBvbmVudCA9IGNvbXBvbmVudHMgJiYgY29tcG9uZW50cy5jb21wb25lbnRzW3RoaXMubmFtZV07CgogIC8vIFNldCByZWZlcmVuY2UgdG8gc2NlbmUuCiAgdGhpcy5lbCA9IHNjZW5lRWw7CiAgdGhpcy5zY2VuZUVsID0gc2NlbmVFbDsKCiAgLy8gU2V0IHJlZmVyZW5jZSB0byBtYXRjaGluZyBjb21wb25lbnQgKGlmIGV4aXN0cykuCiAgaWYgKGNvbXBvbmVudCkgeyBjb21wb25lbnQuQ29tcG9uZW50LnByb3RvdHlwZS5zeXN0ZW0gPSB0aGlzOyB9CgogIC8vIFByb2Nlc3Mgc3lzdGVtIGNvbmZpZ3VyYXRpb24uCiAgdGhpcy5idWlsZERhdGEoKTsKICB0aGlzLmluaXQoKTsKICB0aGlzLnVwZGF0ZSh7fSk7Cn07CgpTeXN0ZW0ucHJvdG90eXBlID0gewogIC8qKgogICAqIFNjaGVtYSB0byBjb25maWd1cmUgc3lzdGVtLgogICAqLwogIHNjaGVtYToge30sCgogIC8qKgogICAqIEluaXQgaGFuZGxlci4gQ2FsbGVkIGR1cmluZyBzY2VuZSBpbml0aWFsaXphdGlvbiBhbmQgaXMgb25seSBydW4gb25jZS4KICAgKiBTeXN0ZW1zIGNhbiB1c2UgdGhpcyB0byBzZXQgaW5pdGlhbCBzdGF0ZS4KICAgKi8KICBpbml0OiBmdW5jdGlvbiAoKSB7IC8qIG5vLW9wICovIH0sCgogIC8qKgogICAqIFVwZGF0ZSBoYW5kbGVyLiBDYWxsZWQgZHVyaW5nIHNjZW5lIGF0dHJpYnV0ZSB1cGRhdGVzLgogICAqIFN5c3RlbXMgY2FuIHVzZSB0aGlzIHRvIGR5bmFtaWNhbGx5IHVwZGF0ZSB0aGVpciBzdGF0ZS4KICAgKi8KICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7IC8qIG5vLW9wICovIH0sCgogIC8qKgogICAqIEJ1aWxkIGRhdGEgYW5kIGNhbGwgdXBkYXRlIGhhbmRsZXIuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqLwogIHVwZGF0ZVByb3BlcnRpZXM6IGZ1bmN0aW9uIChyYXdEYXRhKSB7CiAgICB2YXIgb2xkRGF0YSA9IHRoaXMuZGF0YTsKICAgIGlmICghT2JqZWN0LmtleXMoc2NoZW1hKS5sZW5ndGgpIHsgcmV0dXJuOyB9CiAgICB0aGlzLmJ1aWxkRGF0YShyYXdEYXRhKTsKICAgIHRoaXMudXBkYXRlKG9sZERhdGEpOwogIH0sCgogIC8qKgogICAqIFBhcnNlIGRhdGEuCiAgICovCiAgYnVpbGREYXRhOiBmdW5jdGlvbiAocmF3RGF0YSkgewogICAgdmFyIHNjaGVtYSA9IHRoaXMuc2NoZW1hOwogICAgaWYgKCFPYmplY3Qua2V5cyhzY2hlbWEpLmxlbmd0aCkgeyByZXR1cm47IH0KICAgIHJhd0RhdGEgPSByYXdEYXRhIHx8IHdpbmRvdy5IVE1MRWxlbWVudC5wcm90b3R5cGUuZ2V0QXR0cmlidXRlLmNhbGwodGhpcy5zY2VuZUVsLCB0aGlzLm5hbWUpOwogICAgaWYgKGlzU2luZ2xlUHJvcChzY2hlbWEpKSB7CiAgICAgIHRoaXMuZGF0YSA9IHBhcnNlUHJvcGVydHkocmF3RGF0YSwgc2NoZW1hKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YSA9IHBhcnNlUHJvcGVydGllcyhzdHlsZVBhcnNlci5wYXJzZShyYXdEYXRhKSB8fCB7fSwgc2NoZW1hKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBUaWNrIGhhbmRsZXIuCiAgICogQ2FsbGVkIG9uIGVhY2ggdGljayBvZiB0aGUgc2NlbmUgcmVuZGVyIGxvb3AuCiAgICogQWZmZWN0ZWQgYnkgcGxheSBhbmQgcGF1c2UuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gdGltZSAtIFNjZW5lIHRpY2sgdGltZS4KICAgKiBAcGFyYW0ge251bWJlcn0gdGltZURlbHRhIC0gRGlmZmVyZW5jZSBpbiBjdXJyZW50IHJlbmRlciB0aW1lIGFuZCBwcmV2aW91cyByZW5kZXIgdGltZS4KICAgKi8KICB0aWNrOiB1bmRlZmluZWQsCgogIC8qKgogICAqIFRvY2sgaGFuZGxlci4KICAgKiBDYWxsZWQgb24gZWFjaCB0b2NrIG9mIHRoZSBzY2VuZSByZW5kZXIgbG9vcC4KICAgKiBBZmZlY3RlZCBieSBwbGF5IGFuZCBwYXVzZS4KICAgKgogICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lIC0gU2NlbmUgdGljayB0aW1lLgogICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lRGVsdGEgLSBEaWZmZXJlbmNlIGluIGN1cnJlbnQgcmVuZGVyIHRpbWUgYW5kIHByZXZpb3VzIHJlbmRlciB0aW1lLgogICAqLwogIHRvY2s6IHVuZGVmaW5lZCwKCiAgLyoqCiAgICogQ2FsbGVkIHRvIHN0YXJ0IGFueSBkeW5hbWljIGJlaGF2aW9yIChlLmcuLCBhbmltYXRpb24sIEFJLCBldmVudHMsIHBoeXNpY3MpLgogICAqLwogIHBsYXk6IGZ1bmN0aW9uICgpIHsgLyogbm8tb3AgKi8gfSwKCiAgLyoqCiAgICogQ2FsbGVkIHRvIHN0b3AgYW55IGR5bmFtaWMgYmVoYXZpb3IgKGUuZy4sIGFuaW1hdGlvbiwgQUksIGV2ZW50cywgcGh5c2ljcykuCiAgICovCiAgcGF1c2U6IGZ1bmN0aW9uICgpIHsgLyogbm8tb3AgKi8gfQp9OwoKLyoqCiAqIFJlZ2lzdGVycyBhIHN5c3RlbSB0byBBLUZyYW1lLgogKgogKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIENvbXBvbmVudCBuYW1lLgogKiBAcGFyYW0ge29iamVjdH0gZGVmaW5pdGlvbiAtIENvbXBvbmVudCBwcm9wZXJ0eSBhbmQgbWV0aG9kcy4KICogQHJldHVybnMge29iamVjdH0gQ29tcG9uZW50LgogKi8KbW9kdWxlLmV4cG9ydHMucmVnaXN0ZXJTeXN0ZW0gPSBmdW5jdGlvbiAobmFtZSwgZGVmaW5pdGlvbikgewogIHZhciBpOwogIHZhciBOZXdTeXN0ZW07CiAgdmFyIHByb3RvID0ge307CiAgdmFyIHNjZW5lcyA9IHV0aWxzLmZpbmRBbGxTY2VuZXMoZG9jdW1lbnQpOwoKICAvLyBGb3JtYXQgZGVmaW5pdGlvbiBvYmplY3QgdG8gcHJvdG90eXBlIG9iamVjdC4KICBPYmplY3Qua2V5cyhkZWZpbml0aW9uKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgIHByb3RvW2tleV0gPSB7CiAgICAgIHZhbHVlOiBkZWZpbml0aW9uW2tleV0sCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9OwogIH0pOwoKICBpZiAoc3lzdGVtc1tuYW1lXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc3lzdGVtIGAnICsgbmFtZSArICdgIGhhcyBiZWVuIGFscmVhZHkgcmVnaXN0ZXJlZC4gJyArCiAgICAgICAgICAgICAgICAgICAgJ0NoZWNrIHRoYXQgeW91IGFyZSBub3QgbG9hZGluZyB0d28gdmVyc2lvbnMgb2YgdGhlIHNhbWUgc3lzdGVtICcgKwogICAgICAgICAgICAgICAgICAgICdvciB0d28gZGlmZmVyZW50IHN5c3RlbXMgb2YgdGhlIHNhbWUgbmFtZS4nKTsKICB9CiAgTmV3U3lzdGVtID0gZnVuY3Rpb24gKHNjZW5lRWwpIHsgU3lzdGVtLmNhbGwodGhpcywgc2NlbmVFbCk7IH07CiAgTmV3U3lzdGVtLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU3lzdGVtLnByb3RvdHlwZSwgcHJvdG8pOwogIE5ld1N5c3RlbS5wcm90b3R5cGUubmFtZSA9IG5hbWU7CiAgTmV3U3lzdGVtLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE5ld1N5c3RlbTsKICBOZXdTeXN0ZW0ucHJvdG90eXBlLnNjaGVtYSA9IHV0aWxzLmV4dGVuZChwcm9jZXNzU2NoZW1hKE5ld1N5c3RlbS5wcm90b3R5cGUuc2NoZW1hKSk7CiAgc3lzdGVtc1tuYW1lXSA9IE5ld1N5c3RlbTsKCiAgLy8gSW5pdGlhbGl6ZSBzeXN0ZW1zIGZvciBleGlzdGluZyBzY2VuZXMKICBmb3IgKGkgPSAwOyBpIDwgc2NlbmVzLmxlbmd0aDsgaSsrKSB7IHNjZW5lc1tpXS5pbml0U3lzdGVtKG5hbWUpOyB9Cn07Cgp9LHsiLi4vdXRpbHMvIjoxNzksIi4vY29tcG9uZW50IjoxMDYsIi4vc2NoZW1hIjoxMTV9XSwxMTg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewpfZGVyZXFfKCcuL3Bpdm90Jyk7Cgp9LHsiLi9waXZvdCI6MTE5fV0sMTE5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyQ29tcG9uZW50ID0gX2RlcmVxXygnLi4vLi4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vLi4vbGliL3RocmVlJyk7Cgp2YXIgb3JpZ2luYWxQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7CnZhciBvcmlnaW5hbFJvdGF0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsKCi8qKgogKiBXcmFwIGVsLm9iamVjdDNEIHdpdGhpbiBhbiBvdXRlciBncm91cC4gQXBwbHkgcGl2b3QgdG8gZWwub2JqZWN0M0QgYXMgcG9zaXRpb24uCiAqLwpyZWdpc3RlckNvbXBvbmVudCgncGl2b3QnLCB7CiAgZGVwZW5kZW5jaWVzOiBbJ3Bvc2l0aW9uJ10sCgogIHNjaGVtYToge3R5cGU6ICd2ZWMzJ30sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkYXRhID0gdGhpcy5kYXRhOwogICAgdmFyIGVsID0gdGhpcy5lbDsKICAgIHZhciBvcmlnaW5hbFBhcmVudCA9IGVsLm9iamVjdDNELnBhcmVudDsKICAgIHZhciBvcmlnaW5hbEdyb3VwID0gZWwub2JqZWN0M0Q7CiAgICB2YXIgb3V0ZXJHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOwoKICAgIG9yaWdpbmFsUG9zaXRpb24uY29weShvcmlnaW5hbEdyb3VwLnBvc2l0aW9uKTsKICAgIG9yaWdpbmFsUm90YXRpb24uY29weShvcmlnaW5hbEdyb3VwLnJvdGF0aW9uKTsKCiAgICAvLyBEZXRhY2ggY3VycmVudCBncm91cCBmcm9tIHBhcmVudC4KICAgIG9yaWdpbmFsUGFyZW50LnJlbW92ZShvcmlnaW5hbEdyb3VwKTsKICAgIG91dGVyR3JvdXAuYWRkKG9yaWdpbmFsR3JvdXApOwoKICAgIC8vIFNldCBuZXcgZ3JvdXAgYXMgdGhlIG91dGVyIGdyb3VwLgogICAgb3JpZ2luYWxQYXJlbnQuYWRkKG91dGVyR3JvdXApOwoKICAgIC8vIFNldCBvdXRlciBncm91cCBhcyBuZXcgb2JqZWN0M0QuCiAgICBlbC5vYmplY3QzRCA9IG91dGVyR3JvdXA7CgogICAgLy8gQXBwbHkgcGl2b3QgdG8gb3JpZ2luYWwgZ3JvdXAuCiAgICBvcmlnaW5hbEdyb3VwLnBvc2l0aW9uLnNldCgtMSAqIGRhdGEueCwgLTEgKiBkYXRhLnksIC0xICogZGF0YS56KTsKCiAgICAvLyBPZmZzZXQgdGhlIHBpdm90IHNvIHRoYXQgd29ybGQgcG9zaXRpb24gbm90IGFmZmVjdGVkLgogICAgLy8gQW5kIHJlc3RvcmUgcG9zaXRpb24gb250byBvdXRlciBncm91cC4KICAgIG91dGVyR3JvdXAucG9zaXRpb24uc2V0KGRhdGEueCArIG9yaWdpbmFsUG9zaXRpb24ueCwgZGF0YS55ICsgb3JpZ2luYWxQb3NpdGlvbi55LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS56ICsgb3JpZ2luYWxQb3NpdGlvbi56KTsKCiAgICAvLyBUcmFuc2ZlciByb3RhdGlvbiB0byBvdXRlciBncm91cC4KICAgIG91dGVyR3JvdXAucm90YXRpb24uY29weShvcmlnaW5hbEdyb3VwLnJvdGF0aW9uKTsKICAgIG9yaWdpbmFsR3JvdXAucm90YXRpb24uc2V0KDAsIDAsIDApOwogIH0KfSk7Cgp9LHsiLi4vLi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi4vLi4vbGliL3RocmVlIjoxNTR9XSwxMjA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogQ29tbW9uIG1lc2ggZGVmYXVsdHMsIG1hcHBpbmdzLCBhbmQgdHJhbnNmb3Jtcy4KICovCnZhciBjb21wb25lbnRzID0gX2RlcmVxXygnLi4vLi4vY29yZS9jb21wb25lbnQnKS5jb21wb25lbnRzOwp2YXIgc2hhZGVycyA9IF9kZXJlcV8oJy4uLy4uL2NvcmUvc2hhZGVyJykuc2hhZGVyczsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vdXRpbHMvJyk7Cgp2YXIgbWF0ZXJpYWxNYXBwaW5ncyA9IHt9OwpPYmplY3Qua2V5cyhjb21wb25lbnRzLm1hdGVyaWFsLnNjaGVtYSkuZm9yRWFjaChhZGRNYXBwaW5nKTsKT2JqZWN0LmtleXMoc2hhZGVycy5zdGFuZGFyZC5zY2hlbWEpLmZvckVhY2goYWRkTWFwcGluZyk7CgpmdW5jdGlvbiBhZGRNYXBwaW5nIChwcm9wKSB7CiAgLy8gVG8gaHlwaGVuYXRlZC4KICB2YXIgaHRtbEF0dHJOYW1lID0gcHJvcC5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpOwogIGlmIChwcm9wID09PSAnZm9nJykgeyBodG1sQXR0ck5hbWUgPSAnbWF0ZXJpYWwtZm9nJzsgfQogIGlmIChwcm9wID09PSAndmlzaWJsZScpIHsgaHRtbEF0dHJOYW1lID0gJ21hdGVyaWFsLXZpc2libGUnOyB9CiAgbWF0ZXJpYWxNYXBwaW5nc1todG1sQXR0ck5hbWVdID0gJ21hdGVyaWFsLicgKyBwcm9wOwp9Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGdldE1lc2hNaXhpbiAoKSB7CiAgcmV0dXJuIHsKICAgIGRlZmF1bHRDb21wb25lbnRzOiB7bWF0ZXJpYWw6IHt9fSwKICAgIG1hcHBpbmdzOiB1dGlscy5leHRlbmQoe30sIG1hdGVyaWFsTWFwcGluZ3MpCiAgfTsKfTsKCn0seyIuLi8uLi9jb3JlL2NvbXBvbmVudCI6MTA2LCIuLi8uLi9jb3JlL3NoYWRlciI6MTE2LCIuLi8uLi91dGlscy8iOjE3OX1dLDEyMTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Cl9kZXJlcV8oJy4vcHJpbWl0aXZlcy9hLWNhbWVyYScpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS1jdXJzb3InKTsKX2RlcmVxXygnLi9wcmltaXRpdmVzL2EtY3VydmVkaW1hZ2UnKTsKX2RlcmVxXygnLi9wcmltaXRpdmVzL2EtZ2x0Zi1tb2RlbCcpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS1pbWFnZScpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS1saWdodCcpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS1saW5rJyk7Cl9kZXJlcV8oJy4vcHJpbWl0aXZlcy9hLW9iai1tb2RlbCcpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS1za3knKTsKX2RlcmVxXygnLi9wcmltaXRpdmVzL2Etc291bmQnKTsKX2RlcmVxXygnLi9wcmltaXRpdmVzL2EtdGV4dCcpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS12aWRlbycpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvYS12aWRlb3NwaGVyZScpOwpfZGVyZXFfKCcuL3ByaW1pdGl2ZXMvbWVzaFByaW1pdGl2ZXMnKTsKCn0seyIuL3ByaW1pdGl2ZXMvYS1jYW1lcmEiOjEyMywiLi9wcmltaXRpdmVzL2EtY3Vyc29yIjoxMjQsIi4vcHJpbWl0aXZlcy9hLWN1cnZlZGltYWdlIjoxMjUsIi4vcHJpbWl0aXZlcy9hLWdsdGYtbW9kZWwiOjEyNiwiLi9wcmltaXRpdmVzL2EtaW1hZ2UiOjEyNywiLi9wcmltaXRpdmVzL2EtbGlnaHQiOjEyOCwiLi9wcmltaXRpdmVzL2EtbGluayI6MTI5LCIuL3ByaW1pdGl2ZXMvYS1vYmotbW9kZWwiOjEzMCwiLi9wcmltaXRpdmVzL2Etc2t5IjoxMzEsIi4vcHJpbWl0aXZlcy9hLXNvdW5kIjoxMzIsIi4vcHJpbWl0aXZlcy9hLXRleHQiOjEzMywiLi9wcmltaXRpdmVzL2EtdmlkZW8iOjEzNCwiLi9wcmltaXRpdmVzL2EtdmlkZW9zcGhlcmUiOjEzNSwiLi9wcmltaXRpdmVzL21lc2hQcmltaXRpdmVzIjoxMzZ9XSwxMjI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgQUVudGl0eSA9IF9kZXJlcV8oJy4uLy4uL2NvcmUvYS1lbnRpdHknKTsKdmFyIGNvbXBvbmVudHMgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2NvbXBvbmVudCcpLmNvbXBvbmVudHM7CnZhciByZWdpc3RlckVsZW1lbnQgPSBfZGVyZXFfKCcuLi8uLi9jb3JlL2EtcmVnaXN0ZXItZWxlbWVudCcpLnJlZ2lzdGVyRWxlbWVudDsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vdXRpbHMvJyk7Cgp2YXIgZGVidWcgPSB1dGlscy5kZWJ1ZzsKdmFyIHNldENvbXBvbmVudFByb3BlcnR5ID0gdXRpbHMuZW50aXR5LnNldENvbXBvbmVudFByb3BlcnR5Owp2YXIgbG9nID0gZGVidWcoJ2V4dHJhczpwcmltaXRpdmVzOmRlYnVnJyk7CnZhciB3YXJuID0gZGVidWcoJ2V4dHJhczpwcmltaXRpdmVzOndhcm4nKTsKCnZhciBwcmltaXRpdmVzID0gbW9kdWxlLmV4cG9ydHMucHJpbWl0aXZlcyA9IHt9OwoKbW9kdWxlLmV4cG9ydHMucmVnaXN0ZXJQcmltaXRpdmUgPSBmdW5jdGlvbiByZWdpc3RlclByaW1pdGl2ZSAobmFtZSwgZGVmaW5pdGlvbikgewogIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgbG9nKCdSZWdpc3RlcmluZyA8JXM+JywgbmFtZSk7CgogIC8vIERlcHJlY2F0aW9uIHdhcm5pbmcgZm9yIGRlZmF1bHRBdHRyaWJ1dGVzIHVzYWdlLgogIGlmIChkZWZpbml0aW9uLmRlZmF1bHRBdHRyaWJ1dGVzKSB7CiAgICB3YXJuKCJUaGUgJ2RlZmF1bHRBdHRyaWJ1dGVzJyBvYmplY3QgaXMgZGVwcmVjYXRlZC4gVXNlICdkZWZhdWx0Q29tcG9uZW50cycgaW5zdGVhZC4iKTsKICB9CgogIHZhciBwcmltaXRpdmUgPSByZWdpc3RlckVsZW1lbnQobmFtZSwgewogICAgcHJvdG90eXBlOiBPYmplY3QuY3JlYXRlKEFFbnRpdHkucHJvdG90eXBlLCB7CiAgICAgIGRlZmF1bHRDb21wb25lbnRzRnJvbVByaW1pdGl2ZTogewogICAgICAgIHZhbHVlOiBkZWZpbml0aW9uLmRlZmF1bHRDb21wb25lbnRzIHx8IGRlZmluaXRpb24uZGVmYXVsdEF0dHJpYnV0ZXMgfHwge30KICAgICAgfSwKICAgICAgZGVwcmVjYXRlZDoge3ZhbHVlOiBkZWZpbml0aW9uLmRlcHJlY2F0ZWQgfHwgbnVsbH0sCiAgICAgIGRlcHJlY2F0ZWRNYXBwaW5nczoge3ZhbHVlOiBkZWZpbml0aW9uLmRlcHJlY2F0ZWRNYXBwaW5ncyB8fCB7fX0sCiAgICAgIG1hcHBpbmdzOiB7dmFsdWU6IGRlZmluaXRpb24ubWFwcGluZ3MgfHwge319LAoKICAgICAgY3JlYXRlZENhbGxiYWNrOiB7CiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChkZWZpbml0aW9uLmRlcHJlY2F0ZWQpIHsgY29uc29sZS53YXJuKGRlZmluaXRpb24uZGVwcmVjYXRlZCk7IH0KICAgICAgICAgIHRoaXMucmVzb2x2ZU1hcHBpbmdDb2xsaXNpb25zKCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIElmIGEgbWFwcGluZyBjb2xsaWRlcyB3aXRoIGEgcmVnaXN0ZXJlZCBjb21wb25lbnQgbmFtZQogICAgICAgKiBpdCByZW5hbWVzIHRoZSBtYXBwaW5nIHRvIGNvbXBvbmVudG5hbWUtcHJvcGVydHkKICAgICAgICovCiAgICAgIHJlc29sdmVNYXBwaW5nQ29sbGlzaW9uczogewogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgbWFwcGluZ3MgPSB0aGlzLm1hcHBpbmdzOwogICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgT2JqZWN0LmtleXMobWFwcGluZ3MpLmZvckVhY2goZnVuY3Rpb24gcmVzb2x2ZUNvbGxpc2lvbiAoa2V5KSB7CiAgICAgICAgICAgIHZhciBuZXdBdHRyaWJ1dGU7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGtleS50b0xvd2VyQ2FzZSgpKSB7IHdhcm4oJ01hcHBpbmcga2V5cyBzaG91bGQgYmUgc3BlY2lmaWVkIGluIGxvd2VyIGNhc2UuIFRoZSBtYXBwaW5nIGtleSAnICsga2V5ICsgJyBtYXkgbm90IGJlIHJlY29nbml6ZWQnKTsgfQogICAgICAgICAgICBpZiAoY29tcG9uZW50c1trZXldKSB7CiAgICAgICAgICAgICAgbmV3QXR0cmlidXRlID0gbWFwcGluZ3Nba2V5XS5yZXBsYWNlKCcuJywgJy0nKTsKICAgICAgICAgICAgICBtYXBwaW5nc1tuZXdBdHRyaWJ1dGVdID0gbWFwcGluZ3Nba2V5XTsKICAgICAgICAgICAgICBkZWxldGUgbWFwcGluZ3Nba2V5XTsKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBwcmltaXRpdmUgJyArIHNlbGYudGFnTmFtZS50b0xvd2VyQ2FzZSgpICsgJyBoYXMgYSBtYXBwaW5nIGNvbGxpc2lvbi4gJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdUaGUgYXR0cmlidXRlICcgKyBrZXkgKyAnIGhhcyB0aGUgc2FtZSBuYW1lIGFzIGEgcmVnaXN0ZXJlZCBjb21wb25lbnQgYW5kJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICcgaGFzIGJlZW4gcmVuYW1lZCB0byAnICsgbmV3QXR0cmlidXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZ2V0RXh0cmFDb21wb25lbnRzOiB7CiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBhdHRyOwogICAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIHZhciBtYXBwaW5nOwogICAgICAgICAgdmFyIG1peGluczsKICAgICAgICAgIHZhciBwYXRoOwogICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgIC8vIEdhdGhlciBjb21wb25lbnQgZGF0YSBmcm9tIGRlZmF1bHQgY29tcG9uZW50cy4KICAgICAgICAgIGRhdGEgPSB1dGlscy5jbG9uZSh0aGlzLmRlZmF1bHRDb21wb25lbnRzRnJvbVByaW1pdGl2ZSk7CgogICAgICAgICAgLy8gRmFjdG9yIGluIG1peGlucyB0byBvdmVyd3JpdGUgZGVmYXVsdCBjb21wb25lbnRzLgogICAgICAgICAgbWl4aW5zID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ21peGluJyk7CiAgICAgICAgICBpZiAobWl4aW5zKSB7CiAgICAgICAgICAgIG1peGlucyA9IG1peGlucy50cmltKCkuc3BsaXQoJyAnKTsKICAgICAgICAgICAgbWl4aW5zLmZvckVhY2goZnVuY3Rpb24gYXBwbHlNaXhpbiAobWl4aW5JZCkgewogICAgICAgICAgICAgIHZhciBtaXhpbkNvbXBvbmVudHMgPSBzZWxmLnNjZW5lRWwucXVlcnlTZWxlY3RvcignIycgKyBtaXhpbklkKS5jb21wb25lbnRDYWNoZTsKICAgICAgICAgICAgICBPYmplY3Qua2V5cyhtaXhpbkNvbXBvbmVudHMpLmZvckVhY2goZnVuY3Rpb24gc2V0Q29tcG9uZW50IChuYW1lKSB7CiAgICAgICAgICAgICAgICBkYXRhW25hbWVdID0gZXh0ZW5kKGRhdGFbbmFtZV0sIG1peGluQ29tcG9uZW50c1tuYW1lXSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIEdhdGhlciBjb21wb25lbnQgZGF0YSBmcm9tIG1hcHBpbmdzLgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhdHRyID0gdGhpcy5hdHRyaWJ1dGVzW2ldOwogICAgICAgICAgICBtYXBwaW5nID0gdGhpcy5tYXBwaW5nc1thdHRyLm5hbWVdOwogICAgICAgICAgICBpZiAobWFwcGluZykgewogICAgICAgICAgICAgIHBhdGggPSB1dGlscy5lbnRpdHkuZ2V0Q29tcG9uZW50UHJvcGVydHlQYXRoKG1hcHBpbmcpOwogICAgICAgICAgICAgIGlmIChwYXRoLmNvbnN0cnVjdG9yID09PSBBcnJheSkgewogICAgICAgICAgICAgICAgZGF0YVtwYXRoWzBdXSA9IGRhdGFbcGF0aFswXV0gfHwge307CiAgICAgICAgICAgICAgICBkYXRhW3BhdGhbMF1dW3BhdGhbMV1dID0gYXR0ci52YWx1ZS50cmltKCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRhdGFbcGF0aF0gPSBhdHRyLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZGF0YTsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEZvciB0aGUgYmFzZSB0byBiZSBleHRlbnNpYmxlLCBib3RoIG9iamVjdHMgbXVzdCBiZSBwdXJlIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgICAgICAgICAqIFRoZSBmdW5jdGlvbiBhc3N1bWVzIHRoYXQgYmFzZSBpcyB1bmRlZmluZWQsIG9yIG51bGwgb3IgYSBwdXJlIG9iamVjdC4KICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZXh0ZW5kIChiYXNlLCBleHRlbnNpb24pIHsKICAgICAgICAgICAgaWYgKGlzVW5kZWZpbmVkKGJhc2UpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNvcHkoZXh0ZW5zaW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQoZXh0ZW5zaW9uKSkgewogICAgICAgICAgICAgIHJldHVybiBjb3B5KGJhc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc1B1cmVPYmplY3QoYmFzZSkgJiYgaXNQdXJlT2JqZWN0KGV4dGVuc2lvbikpIHsKICAgICAgICAgICAgICByZXR1cm4gdXRpbHMuZXh0ZW5kRGVlcChiYXNlLCBleHRlbnNpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3B5KGV4dGVuc2lvbik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNVbmRlZmluZWQgKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvcHkgKHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChpc1B1cmVPYmplY3QodmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHV0aWxzLmV4dGVuZERlZXAoe30sIHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNQdXJlT2JqZWN0ICh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgIT09IG51bGwgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IE9iamVjdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogU3luYyB0byBhdHRyaWJ1dGUgdG8gY29tcG9uZW50IHByb3BlcnR5IHdoZW5ldmVyIG1hcHBlZCBhdHRyaWJ1dGUgY2hhbmdlcy4KICAgICAgICogSWYgYXR0cmlidXRlIGlzIG1hcHBlZCB0byBhIGNvbXBvbmVudCBwcm9wZXJ0eSwgc2V0IHRoZSBjb21wb25lbnQgcHJvcGVydHkgdXNpbmcKICAgICAgICogdGhlIGF0dHJpYnV0ZSB2YWx1ZS4KICAgICAgICovCiAgICAgIGF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjazogewogICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoYXR0ciwgb2xkVmFsLCB2YWx1ZSkgewogICAgICAgICAgdmFyIGNvbXBvbmVudE5hbWUgPSB0aGlzLm1hcHBpbmdzW2F0dHJdOwoKICAgICAgICAgIGlmIChhdHRyIGluIHRoaXMuZGVwcmVjYXRlZE1hcHBpbmdzKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybih0aGlzLmRlcHJlY2F0ZWRNYXBwaW5nc1thdHRyXSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFhdHRyIHx8ICFjb21wb25lbnROYW1lKSB7IHJldHVybjsgfQoKICAgICAgICAgIC8vIFNldCB2YWx1ZS4KICAgICAgICAgIHNldENvbXBvbmVudFByb3BlcnR5KHRoaXMsIGNvbXBvbmVudE5hbWUsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pCiAgfSk7CgogIC8vIFN0b3JlLgogIHByaW1pdGl2ZXNbbmFtZV0gPSBwcmltaXRpdmU7CiAgcmV0dXJuIHByaW1pdGl2ZTsKfTsKCi8qKgogKiBBZGQgY29tcG9uZW50IG1hcHBpbmdzIHVzaW5nIHNjaGVtYS4KICovCmZ1bmN0aW9uIGFkZENvbXBvbmVudE1hcHBpbmcgKGNvbXBvbmVudE5hbWUsIG1hcHBpbmdzKSB7CiAgdmFyIHNjaGVtYSA9IGNvbXBvbmVudHNbY29tcG9uZW50TmFtZV0uc2NoZW1hOwogIE9iamVjdC5rZXlzKHNjaGVtYSkubWFwKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAvLyBIeXBoZW5hdGUgd2hlcmUgdGhlcmUgaXMgY2FtZWxDYXNlLgogICAgdmFyIGF0dHJOYW1lID0gcHJvcC5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpOwogICAgLy8gSWYgdGhlcmUgaXMgYSBtYXBwaW5nIGNvbGxpc2lvbiwgcHJlZml4IHdpdGggY29tcG9uZW50IG5hbWUgYW5kIGh5cGhlbi4KICAgIGlmIChtYXBwaW5nc1thdHRyTmFtZV0gIT09IHVuZGVmaW5lZCkgeyBhdHRyTmFtZSA9IGNvbXBvbmVudE5hbWUgKyAnLScgKyBwcm9wOyB9CiAgICBtYXBwaW5nc1thdHRyTmFtZV0gPSBjb21wb25lbnROYW1lICsgJy4nICsgcHJvcDsKICB9KTsKfQoKLyoqCiAqIEhlbHBlciB0byBkZWZpbmUgYSBwcmltaXRpdmUsIGJ1aWxkaW5nIG1hcHBpbmdzIHVzaW5nIGEgY29tcG9uZW50IHNjaGVtYS4KICovCmZ1bmN0aW9uIGRlZmluZVByaW1pdGl2ZSAodGFnTmFtZSwgZGVmYXVsdENvbXBvbmVudHMsIG1hcHBpbmdzKSB7CiAgLy8gSWYgbm8gaW5pdGlhbCBtYXBwaW5ncyBwcm92aWRlZCwgc3RhcnQgZnJvbSBlbXB0eSBtYXAuCiAgbWFwcGluZ3MgPSBtYXBwaW5ncyB8fCB7fTsKCiAgLy8gRnJvbSB0aGUgZGVmYXVsdCBjb21wb25lbnRzLCBhZGQgbWFwcGluZyBhdXRvbWFnaWNhbGx5LgogIE9iamVjdC5rZXlzKGRlZmF1bHRDb21wb25lbnRzKS5tYXAoZnVuY3Rpb24gYnVpbGRNYXBwaW5ncyAoY29tcG9uZW50TmFtZSkgewogICAgYWRkQ29tcG9uZW50TWFwcGluZyhjb21wb25lbnROYW1lLCBtYXBwaW5ncyk7CiAgfSk7CgogIC8vIFJlZ2lzdGVyIHRoZSBwcmltaXRpdmUuCiAgbW9kdWxlLmV4cG9ydHMucmVnaXN0ZXJQcmltaXRpdmUodGFnTmFtZSwgdXRpbHMuZXh0ZW5kRGVlcCh7fSwgbnVsbCwgewogICAgZGVmYXVsdENvbXBvbmVudHM6IGRlZmF1bHRDb21wb25lbnRzLAogICAgbWFwcGluZ3M6IG1hcHBpbmdzCiAgfSkpOwp9Cm1vZHVsZS5leHBvcnRzLmRlZmluZVByaW1pdGl2ZSA9IGRlZmluZVByaW1pdGl2ZTsKCn0seyIuLi8uLi9jb3JlL2EtZW50aXR5IjoxMDIsIi4uLy4uL2NvcmUvYS1yZWdpc3Rlci1lbGVtZW50IjoxMDUsIi4uLy4uL2NvcmUvY29tcG9uZW50IjoxMDYsIi4uLy4uL3V0aWxzLyI6MTc5fV0sMTIzOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyUHJpbWl0aXZlID0gX2RlcmVxXygnLi4vcHJpbWl0aXZlcycpLnJlZ2lzdGVyUHJpbWl0aXZlOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2EtY2FtZXJhJywgewogIGRlZmF1bHRDb21wb25lbnRzOiB7CiAgICAnY2FtZXJhJzoge30sCiAgICAnbG9vay1jb250cm9scyc6IHt9LAogICAgJ3dhc2QtY29udHJvbHMnOiB7fSwKICAgICdwb3NpdGlvbic6IHt4OiAwLCB5OiAxLjYsIHo6IDB9CiAgfSwKCiAgbWFwcGluZ3M6IHsKICAgIGFjdGl2ZTogJ2NhbWVyYS5hY3RpdmUnLAogICAgZmFyOiAnY2FtZXJhLmZhcicsCiAgICBmb3Y6ICdjYW1lcmEuZm92JywKICAgICdsb29rLWNvbnRyb2xzLWVuYWJsZWQnOiAnbG9vay1jb250cm9scy5lbmFibGVkJywKICAgIG5lYXI6ICdjYW1lcmEubmVhcicsCiAgICAncG9pbnRlci1sb2NrLWVuYWJsZWQnOiAnbG9vay1jb250cm9scy5wb2ludGVyTG9ja0VuYWJsZWQnLAogICAgJ3dhc2QtY29udHJvbHMtZW5hYmxlZCc6ICd3YXNkLWNvbnRyb2xzLmVuYWJsZWQnLAogICAgJ3JldmVyc2UtbW91c2UtZHJhZyc6ICdsb29rLWNvbnRyb2xzLnJldmVyc2VNb3VzZURyYWcnLAogICAgem9vbTogJ2NhbWVyYS56b29tJwogIH0KfSk7Cgp9LHsiLi4vcHJpbWl0aXZlcyI6MTIyfV0sMTI0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdldE1lc2hNaXhpbiA9IF9kZXJlcV8oJy4uL2dldE1lc2hNaXhpbicpOwp2YXIgcmVnaXN0ZXJQcmltaXRpdmUgPSBfZGVyZXFfKCcuLi9wcmltaXRpdmVzJykucmVnaXN0ZXJQcmltaXRpdmU7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uLy4uLy4uL3V0aWxzLycpOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2EtY3Vyc29yJywgdXRpbHMuZXh0ZW5kRGVlcCh7fSwgZ2V0TWVzaE1peGluKCksIHsKICBkZWZhdWx0Q29tcG9uZW50czogewogICAgY3Vyc29yOiB7fSwKICAgIGdlb21ldHJ5OiB7CiAgICAgIHByaW1pdGl2ZTogJ3JpbmcnLAogICAgICByYWRpdXNPdXRlcjogMC4wMTYsCiAgICAgIHJhZGl1c0lubmVyOiAwLjAxLAogICAgICBzZWdtZW50c1RoZXRhOiAzMgogICAgfSwKICAgIG1hdGVyaWFsOiB7CiAgICAgIGNvbG9yOiAnIzAwMCcsCiAgICAgIHNoYWRlcjogJ2ZsYXQnLAogICAgICBvcGFjaXR5OiAwLjgKICAgIH0sCiAgICBwb3NpdGlvbjogewogICAgICB4OiAwLAogICAgICB5OiAwLAogICAgICB6OiAtMQogICAgfQogIH0sCgogIG1hcHBpbmdzOiB7CiAgICBmYXI6ICdyYXljYXN0ZXIuZmFyJywKICAgIGZ1c2U6ICdjdXJzb3IuZnVzZScsCiAgICAnZnVzZS10aW1lb3V0JzogJ2N1cnNvci5mdXNlVGltZW91dCcsCiAgICBpbnRlcnZhbDogJ3JheWNhc3Rlci5pbnRlcnZhbCcsCiAgICBvYmplY3RzOiAncmF5Y2FzdGVyLm9iamVjdHMnCiAgfQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMjU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2V0TWVzaE1peGluID0gX2RlcmVxXygnLi4vZ2V0TWVzaE1peGluJyk7CnZhciByZWdpc3RlclByaW1pdGl2ZSA9IF9kZXJlcV8oJy4uL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vLi4vdXRpbHMvJyk7CgpyZWdpc3RlclByaW1pdGl2ZSgnYS1jdXJ2ZWRpbWFnZScsIHV0aWxzLmV4dGVuZERlZXAoe30sIGdldE1lc2hNaXhpbigpLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgIGdlb21ldHJ5OiB7CiAgICAgIGhlaWdodDogMSwKICAgICAgcHJpbWl0aXZlOiAnY3lsaW5kZXInLAogICAgICByYWRpdXM6IDIsCiAgICAgIHNlZ21lbnRzUmFkaWFsOiA0OCwKICAgICAgdGhldGFMZW5ndGg6IDI3MCwKICAgICAgb3BlbkVuZGVkOiB0cnVlLAogICAgICB0aGV0YVN0YXJ0OiAwCiAgICB9LAogICAgbWF0ZXJpYWw6IHsKICAgICAgY29sb3I6ICcjRkZGJywKICAgICAgc2hhZGVyOiAnZmxhdCcsCiAgICAgIHNpZGU6ICdkb3VibGUnLAogICAgICB0cmFuc3BhcmVudDogdHJ1ZSwKICAgICAgcmVwZWF0OiAnLTEgMScKICAgIH0KICB9LAoKICBtYXBwaW5nczogewogICAgaGVpZ2h0OiAnZ2VvbWV0cnkuaGVpZ2h0JywKICAgICdvcGVuLWVuZGVkJzogJ2dlb21ldHJ5Lm9wZW5FbmRlZCcsCiAgICByYWRpdXM6ICdnZW9tZXRyeS5yYWRpdXMnLAogICAgc2VnbWVudHM6ICdnZW9tZXRyeS5zZWdtZW50c1JhZGlhbCcsCiAgICBzdGFydDogJ2dlb21ldHJ5LnRoZXRhU3RhcnQnLAogICAgJ3RoZXRhLWxlbmd0aCc6ICdnZW9tZXRyeS50aGV0YUxlbmd0aCcsCiAgICAndGhldGEtc3RhcnQnOiAnZ2VvbWV0cnkudGhldGFTdGFydCcsCiAgICAnd2lkdGgnOiAnZ2VvbWV0cnkudGhldGFMZW5ndGgnCiAgfQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMjY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJQcmltaXRpdmUgPSBfZGVyZXFfKCcuLi9wcmltaXRpdmVzJykucmVnaXN0ZXJQcmltaXRpdmU7CgpyZWdpc3RlclByaW1pdGl2ZSgnYS1nbHRmLW1vZGVsJywgewogIG1hcHBpbmdzOiB7CiAgICBzcmM6ICdnbHRmLW1vZGVsJwogIH0KfSk7Cgp9LHsiLi4vcHJpbWl0aXZlcyI6MTIyfV0sMTI3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdldE1lc2hNaXhpbiA9IF9kZXJlcV8oJy4uL2dldE1lc2hNaXhpbicpOwp2YXIgcmVnaXN0ZXJQcmltaXRpdmUgPSBfZGVyZXFfKCcuLi9wcmltaXRpdmVzJykucmVnaXN0ZXJQcmltaXRpdmU7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uLy4uLy4uL3V0aWxzLycpOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2EtaW1hZ2UnLCB1dGlscy5leHRlbmREZWVwKHt9LCBnZXRNZXNoTWl4aW4oKSwgewogIGRlZmF1bHRDb21wb25lbnRzOiB7CiAgICBnZW9tZXRyeTogewogICAgICBwcmltaXRpdmU6ICdwbGFuZScKICAgIH0sCiAgICBtYXRlcmlhbDogewogICAgICBjb2xvcjogJyNGRkYnLAogICAgICBzaGFkZXI6ICdmbGF0JywKICAgICAgc2lkZTogJ2RvdWJsZScsCiAgICAgIHRyYW5zcGFyZW50OiB0cnVlCiAgICB9CiAgfSwKCiAgbWFwcGluZ3M6IHsKICAgIGhlaWdodDogJ2dlb21ldHJ5LmhlaWdodCcsCiAgICB3aWR0aDogJ2dlb21ldHJ5LndpZHRoJwogIH0KfSkpOwoKfSx7Ii4uLy4uLy4uL3V0aWxzLyI6MTc5LCIuLi9nZXRNZXNoTWl4aW4iOjEyMCwiLi4vcHJpbWl0aXZlcyI6MTIyfV0sMTI4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyUHJpbWl0aXZlID0gX2RlcmVxXygnLi4vcHJpbWl0aXZlcycpLnJlZ2lzdGVyUHJpbWl0aXZlOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2EtbGlnaHQnLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgIGxpZ2h0OiB7fQogIH0sCgogIG1hcHBpbmdzOiB7CiAgICBhbmdsZTogJ2xpZ2h0LmFuZ2xlJywKICAgIGNvbG9yOiAnbGlnaHQuY29sb3InLAogICAgJ2dyb3VuZC1jb2xvcic6ICdsaWdodC5ncm91bmRDb2xvcicsCiAgICBkZWNheTogJ2xpZ2h0LmRlY2F5JywKICAgIGRpc3RhbmNlOiAnbGlnaHQuZGlzdGFuY2UnLAogICAgaW50ZW5zaXR5OiAnbGlnaHQuaW50ZW5zaXR5JywKICAgIHBlbnVtYnJhOiAnbGlnaHQucGVudW1icmEnLAogICAgdHlwZTogJ2xpZ2h0LnR5cGUnLAogICAgdGFyZ2V0OiAnbGlnaHQudGFyZ2V0JwogIH0KfSk7Cgp9LHsiLi4vcHJpbWl0aXZlcyI6MTIyfV0sMTI5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyUHJpbWl0aXZlID0gX2RlcmVxXygnLi4vcHJpbWl0aXZlcycpLnJlZ2lzdGVyUHJpbWl0aXZlOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2EtbGluaycsIHsKICBkZWZhdWx0Q29tcG9uZW50czogewogICAgbGluazogewogICAgICB2aXN1YWxBc3BlY3RFbmFibGVkOiB0cnVlCiAgICB9CiAgfSwKCiAgbWFwcGluZ3M6IHsKICAgIGhyZWY6ICdsaW5rLmhyZWYnLAogICAgaW1hZ2U6ICdsaW5rLmltYWdlJywKICAgIHRpdGxlOiAnbGluay50aXRsZScKICB9Cn0pOwoKfSx7Ii4uL3ByaW1pdGl2ZXMiOjEyMn1dLDEzMDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBtZXNoTWl4aW4gPSBfZGVyZXFfKCcuLi9nZXRNZXNoTWl4aW4nKSgpOwp2YXIgcmVnaXN0ZXJQcmltaXRpdmUgPSBfZGVyZXFfKCcuLi9wcmltaXRpdmVzJykucmVnaXN0ZXJQcmltaXRpdmU7CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uLy4uLy4uL3V0aWxzLycpOwoKcmVnaXN0ZXJQcmltaXRpdmUoJ2Etb2JqLW1vZGVsJywgdXRpbHMuZXh0ZW5kRGVlcCh7fSwgbWVzaE1peGluLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgICdvYmotbW9kZWwnOiB7fQogIH0sCgogIG1hcHBpbmdzOiB7CiAgICBzcmM6ICdvYmotbW9kZWwub2JqJywKICAgIG10bDogJ29iai1tb2RlbC5tdGwnCiAgfQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMzE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2V0TWVzaE1peGluID0gX2RlcmVxXygnLi4vZ2V0TWVzaE1peGluJyk7CnZhciByZWdpc3RlclByaW1pdGl2ZSA9IF9kZXJlcV8oJy4uL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vLi4vdXRpbHMvJyk7CnZhciBtZXNoUHJpbWl0aXZlcyA9IF9kZXJlcV8oJy4vbWVzaFByaW1pdGl2ZXMnKTsKCnJlZ2lzdGVyUHJpbWl0aXZlKCdhLXNreScsIHV0aWxzLmV4dGVuZERlZXAoe30sIGdldE1lc2hNaXhpbigpLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgIGdlb21ldHJ5OiB7CiAgICAgIHByaW1pdGl2ZTogJ3NwaGVyZScsCiAgICAgIHJhZGl1czogNTAwMCwKICAgICAgc2VnbWVudHNXaWR0aDogNjQsCiAgICAgIHNlZ21lbnRzSGVpZ2h0OiAzMgogICAgfSwKICAgIG1hdGVyaWFsOiB7CiAgICAgIGNvbG9yOiAnI0ZGRicsCiAgICAgIHNpZGU6ICdiYWNrJywKICAgICAgc2hhZGVyOiAnZmxhdCcsCiAgICAgIG5wb3Q6IHRydWUKICAgIH0sCiAgICBzY2FsZTogJy0xIDEgMScKICB9LAoKICBtYXBwaW5nczogdXRpbHMuZXh0ZW5kRGVlcCh7fSwgbWVzaFByaW1pdGl2ZXNbJ2Etc3BoZXJlJ10ucHJvdG90eXBlLm1hcHBpbmdzKQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjIsIi4vbWVzaFByaW1pdGl2ZXMiOjEzNn1dLDEzMjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlclByaW1pdGl2ZSA9IF9kZXJlcV8oJy4uL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKCnJlZ2lzdGVyUHJpbWl0aXZlKCdhLXNvdW5kJywgewogIGRlZmF1bHRDb21wb25lbnRzOiB7CiAgICBzb3VuZDoge30KICB9LAoKICBtYXBwaW5nczogewogICAgc3JjOiAnc291bmQuc3JjJywKICAgIG9uOiAnc291bmQub24nLAogICAgYXV0b3BsYXk6ICdzb3VuZC5hdXRvcGxheScsCiAgICBsb29wOiAnc291bmQubG9vcCcsCiAgICB2b2x1bWU6ICdzb3VuZC52b2x1bWUnCiAgfQp9KTsKCn0seyIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMzM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovLyA8YS10ZXh0PiB1c2luZyBgZGVmaW5lUHJpbWl0aXZlYCBoZWxwZXIuCnZhciBkZWZpbmVQcmltaXRpdmUgPSBfZGVyZXFfKCcuLi9wcmltaXRpdmVzJykuZGVmaW5lUHJpbWl0aXZlOwpkZWZpbmVQcmltaXRpdmUoJ2EtdGV4dCcsIHt0ZXh0OiB7YW5jaG9yOiAnYWxpZ24nLCB3aWR0aDogNX19KTsKCn0seyIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMzQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2V0TWVzaE1peGluID0gX2RlcmVxXygnLi4vZ2V0TWVzaE1peGluJyk7CnZhciByZWdpc3RlclByaW1pdGl2ZSA9IF9kZXJlcV8oJy4uL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vLi4vdXRpbHMvJyk7CgpyZWdpc3RlclByaW1pdGl2ZSgnYS12aWRlbycsIHV0aWxzLmV4dGVuZERlZXAoe30sIGdldE1lc2hNaXhpbigpLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgIGdlb21ldHJ5OiB7CiAgICAgIHByaW1pdGl2ZTogJ3BsYW5lJwogICAgfSwKICAgIG1hdGVyaWFsOiB7CiAgICAgIGNvbG9yOiAnI0ZGRicsCiAgICAgIHNoYWRlcjogJ2ZsYXQnLAogICAgICBzaWRlOiAnZG91YmxlJywKICAgICAgdHJhbnNwYXJlbnQ6IHRydWUKICAgIH0KICB9LAoKICBtYXBwaW5nczogewogICAgaGVpZ2h0OiAnZ2VvbWV0cnkuaGVpZ2h0JywKICAgIHdpZHRoOiAnZ2VvbWV0cnkud2lkdGgnCiAgfQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMzU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2V0TWVzaE1peGluID0gX2RlcmVxXygnLi4vZ2V0TWVzaE1peGluJyk7CnZhciByZWdpc3RlclByaW1pdGl2ZSA9IF9kZXJlcV8oJy4uL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vLi4vLi4vdXRpbHMvJyk7CgpyZWdpc3RlclByaW1pdGl2ZSgnYS12aWRlb3NwaGVyZScsIHV0aWxzLmV4dGVuZERlZXAoe30sIGdldE1lc2hNaXhpbigpLCB7CiAgZGVmYXVsdENvbXBvbmVudHM6IHsKICAgIGdlb21ldHJ5OiB7CiAgICAgIHByaW1pdGl2ZTogJ3NwaGVyZScsCiAgICAgIHJhZGl1czogNTAwMCwKICAgICAgc2VnbWVudHNXaWR0aDogNjQsCiAgICAgIHNlZ21lbnRzSGVpZ2h0OiAzMgogICAgfSwKICAgIG1hdGVyaWFsOiB7CiAgICAgIGNvbG9yOiAnI0ZGRicsCiAgICAgIHNoYWRlcjogJ2ZsYXQnLAogICAgICBzaWRlOiAnYmFjaycsCiAgICAgIG5wb3Q6IHRydWUKICAgIH0sCiAgICBzY2FsZTogJy0xIDEgMScKICB9LAoKICBtYXBwaW5nczogewogICAgcmFkaXVzOiAnZ2VvbWV0cnkucmFkaXVzJywKICAgICdzZWdtZW50cy1oZWlnaHQnOiAnZ2VvbWV0cnkuc2VnbWVudHNIZWlnaHQnLAogICAgJ3NlZ21lbnRzLXdpZHRoJzogJ2dlb21ldHJ5LnNlZ21lbnRzV2lkdGgnCiAgfQp9KSk7Cgp9LHsiLi4vLi4vLi4vdXRpbHMvIjoxNzksIi4uL2dldE1lc2hNaXhpbiI6MTIwLCIuLi9wcmltaXRpdmVzIjoxMjJ9XSwxMzY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogQXV0b21hdGVkIG1lc2ggcHJpbWl0aXZlIHJlZ2lzdHJhdGlvbi4KICovCnZhciBnZXRNZXNoTWl4aW4gPSBfZGVyZXFfKCcuLi9nZXRNZXNoTWl4aW4nKTsKdmFyIGdlb21ldHJpZXMgPSBfZGVyZXFfKCcuLi8uLi8uLi9jb3JlL2dlb21ldHJ5JykuZ2VvbWV0cmllczsKdmFyIGdlb21ldHJ5TmFtZXMgPSBfZGVyZXFfKCcuLi8uLi8uLi9jb3JlL2dlb21ldHJ5JykuZ2VvbWV0cnlOYW1lczsKdmFyIHJlZ2lzdGVyUHJpbWl0aXZlID0gX2RlcmVxXygnLi4vcHJpbWl0aXZlcycpLnJlZ2lzdGVyUHJpbWl0aXZlOwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi8uLi8uLi91dGlscy8nKTsKCi8vIEZvciB0ZXN0aW5nLgp2YXIgbWVzaFByaW1pdGl2ZXMgPSBtb2R1bGUuZXhwb3J0cyA9IHt9OwoKLy8gR2VuZXJhdGUgcHJpbWl0aXZlIGZvciBlYWNoIGdlb21ldHJ5IHR5cGUuCmdlb21ldHJ5TmFtZXMuZm9yRWFjaChmdW5jdGlvbiByZWdpc3Rlck1lc2hQcmltaXRpdmUgKGdlb21ldHJ5TmFtZSkgewogIHZhciBnZW9tZXRyeSA9IGdlb21ldHJpZXNbZ2VvbWV0cnlOYW1lXTsKICB2YXIgZ2VvbWV0cnlIeXBoZW5lZCA9IHVuQ2FtZWxDYXNlKGdlb21ldHJ5TmFtZSk7CgogIC8vIEdlbmVyYXRlIG1hcHBpbmdzLgogIHZhciBtYXBwaW5ncyA9IHt9OwogIE9iamVjdC5rZXlzKGdlb21ldHJ5LnNjaGVtYSkuZm9yRWFjaChmdW5jdGlvbiBjcmVhdGVNYXBwaW5nIChwcm9wZXJ0eSkgewogICAgbWFwcGluZ3NbdW5DYW1lbENhc2UocHJvcGVydHkpXSA9ICdnZW9tZXRyeS4nICsgcHJvcGVydHk7CiAgfSk7CgogIC8vIFJlZ2lzdGVyLgogIHZhciB0YWdOYW1lID0gJ2EtJyArIGdlb21ldHJ5SHlwaGVuZWQ7CiAgdmFyIHByaW1pdGl2ZSA9IHJlZ2lzdGVyUHJpbWl0aXZlKHRhZ05hbWUsIHV0aWxzLmV4dGVuZERlZXAoe30sIGdldE1lc2hNaXhpbigpLCB7CiAgICBkZWZhdWx0Q29tcG9uZW50czoge2dlb21ldHJ5OiB7cHJpbWl0aXZlOiBnZW9tZXRyeU5hbWV9fSwKICAgIG1hcHBpbmdzOiBtYXBwaW5ncwogIH0pKTsKICBtZXNoUHJpbWl0aXZlc1t0YWdOYW1lXSA9IHByaW1pdGl2ZTsKfSk7CgovKioKICogY2FtZWxDYXNlIHRvIGh5cGhlbmVkLXN0cmluZy4KICovCmZ1bmN0aW9uIHVuQ2FtZWxDYXNlIChzdHIpIHsKICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csICckMS0kMicpLnRvTG93ZXJDYXNlKCk7Cn0KCn0seyIuLi8uLi8uLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uLy4uLy4uL3V0aWxzLyI6MTc5LCIuLi9nZXRNZXNoTWl4aW4iOjEyMCwiLi4vcHJpbWl0aXZlcyI6MTIyfV0sMTM3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykucmVnaXN0ZXJHZW9tZXRyeTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CgpyZWdpc3Rlckdlb21ldHJ5KCdib3gnLCB7CiAgc2NoZW1hOiB7CiAgICBkZXB0aDoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICBoZWlnaHQ6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgd2lkdGg6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgc2VnbWVudHNIZWlnaHQ6IHtkZWZhdWx0OiAxLCBtaW46IDEsIG1heDogMjAsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzV2lkdGg6IHtkZWZhdWx0OiAxLCBtaW46IDEsIG1heDogMjAsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzRGVwdGg6IHtkZWZhdWx0OiAxLCBtaW46IDEsIG1heDogMjAsIHR5cGU6ICdpbnQnfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KAogICAgICBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS5kZXB0aCwKICAgICAgZGF0YS5zZWdtZW50c1dpZHRoLCBkYXRhLnNlZ21lbnRzSGVpZ2h0LCBkYXRhLnNlZ21lbnRzRGVwdGgpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDEzODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKdmFyIGRlZ1RvUmFkID0gVEhSRUUuTWF0aC5kZWdUb1JhZDsKCnJlZ2lzdGVyR2VvbWV0cnkoJ2NpcmNsZScsIHsKICBzY2hlbWE6IHsKICAgIHJhZGl1czoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICBzZWdtZW50czoge2RlZmF1bHQ6IDMyLCBtaW46IDMsIHR5cGU6ICdpbnQnfSwKICAgIHRoZXRhTGVuZ3RoOiB7ZGVmYXVsdDogMzYwLCBtaW46IDB9LAogICAgdGhldGFTdGFydDoge2RlZmF1bHQ6IDB9CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMuZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQ2lyY2xlR2VvbWV0cnkoCiAgICAgIGRhdGEucmFkaXVzLCBkYXRhLnNlZ21lbnRzLCBkZWdUb1JhZChkYXRhLnRoZXRhU3RhcnQpLCBkZWdUb1JhZChkYXRhLnRoZXRhTGVuZ3RoKSk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2xpYi90aHJlZSI6MTU0fV0sMTM5OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykucmVnaXN0ZXJHZW9tZXRyeTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgZGVnVG9SYWQgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkOwoKcmVnaXN0ZXJHZW9tZXRyeSgnY29uZScsIHsKICBzY2hlbWE6IHsKICAgIGhlaWdodDoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICBvcGVuRW5kZWQ6IHtkZWZhdWx0OiBmYWxzZX0sCiAgICByYWRpdXNCb3R0b206IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgcmFkaXVzVG9wOiB7ZGVmYXVsdDogMC4wMSwgbWluOiAwfSwKICAgIHNlZ21lbnRzSGVpZ2h0OiB7ZGVmYXVsdDogMTgsIG1pbjogMSwgdHlwZTogJ2ludCd9LAogICAgc2VnbWVudHNSYWRpYWw6IHtkZWZhdWx0OiAzNiwgbWluOiAzLCB0eXBlOiAnaW50J30sCiAgICB0aGV0YUxlbmd0aDoge2RlZmF1bHQ6IDM2MCwgbWluOiAwfSwKICAgIHRoZXRhU3RhcnQ6IHtkZWZhdWx0OiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoCiAgICAgICAgZGF0YS5yYWRpdXNUb3AsIGRhdGEucmFkaXVzQm90dG9tLCBkYXRhLmhlaWdodCwgZGF0YS5zZWdtZW50c1JhZGlhbCwKICAgICAgICBkYXRhLnNlZ21lbnRzSGVpZ2h0LCBkYXRhLm9wZW5FbmRlZCwgZGVnVG9SYWQoZGF0YS50aGV0YVN0YXJ0KSwKICAgICAgICBkZWdUb1JhZChkYXRhLnRoZXRhTGVuZ3RoKSk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2xpYi90aHJlZSI6MTU0fV0sMTQwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykucmVnaXN0ZXJHZW9tZXRyeTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgZGVnVG9SYWQgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkOwoKcmVnaXN0ZXJHZW9tZXRyeSgnY3lsaW5kZXInLCB7CiAgc2NoZW1hOiB7CiAgICBoZWlnaHQ6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgb3BlbkVuZGVkOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgcmFkaXVzOiB7ZGVmYXVsdDogMSwgbWluOiAwfSwKICAgIHNlZ21lbnRzSGVpZ2h0OiB7ZGVmYXVsdDogMTgsIG1pbjogMSwgdHlwZTogJ2ludCd9LAogICAgc2VnbWVudHNSYWRpYWw6IHtkZWZhdWx0OiAzNiwgbWluOiAzLCB0eXBlOiAnaW50J30sCiAgICB0aGV0YUxlbmd0aDoge2RlZmF1bHQ6IDM2MCwgbWluOiAwfSwKICAgIHRoZXRhU3RhcnQ6IHtkZWZhdWx0OiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoCiAgICAgICAgZGF0YS5yYWRpdXMsIGRhdGEucmFkaXVzLCBkYXRhLmhlaWdodCwgZGF0YS5zZWdtZW50c1JhZGlhbCwgZGF0YS5zZWdtZW50c0hlaWdodCwKICAgICAgICBkYXRhLm9wZW5FbmRlZCwgZGVnVG9SYWQoZGF0YS50aGV0YVN0YXJ0KSwgZGVnVG9SYWQoZGF0YS50aGV0YUxlbmd0aCkpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE0MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKcmVnaXN0ZXJHZW9tZXRyeSgnZG9kZWNhaGVkcm9uJywgewogIHNjaGVtYTogewogICAgZGV0YWlsOiB7ZGVmYXVsdDogMCwgbWluOiAwLCBtYXg6IDUsIHR5cGU6ICdpbnQnfSwKICAgIHJhZGl1czoge2RlZmF1bHQ6IDEsIG1pbjogMH0KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy5nZW9tZXRyeSA9IG5ldyBUSFJFRS5Eb2RlY2FoZWRyb25HZW9tZXRyeShkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE0MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKcmVnaXN0ZXJHZW9tZXRyeSgnaWNvc2FoZWRyb24nLCB7CiAgc2NoZW1hOiB7CiAgICBkZXRhaWw6IHtkZWZhdWx0OiAwLCBtaW46IDAsIG1heDogNSwgdHlwZTogJ2ludCd9LAogICAgcmFkaXVzOiB7ZGVmYXVsdDogMSwgbWluOiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkljb3NhaGVkcm9uR2VvbWV0cnkoZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvZ2VvbWV0cnkiOjEwNywiLi4vbGliL3RocmVlIjoxNTR9XSwxNDM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewpfZGVyZXFfKCcuL2JveC5qcycpOwpfZGVyZXFfKCcuL2NpcmNsZS5qcycpOwpfZGVyZXFfKCcuL2NvbmUuanMnKTsKX2RlcmVxXygnLi9jeWxpbmRlci5qcycpOwpfZGVyZXFfKCcuL2RvZGVjYWhlZHJvbi5qcycpOwpfZGVyZXFfKCcuL2ljb3NhaGVkcm9uLmpzJyk7Cl9kZXJlcV8oJy4vb2N0YWhlZHJvbi5qcycpOwpfZGVyZXFfKCcuL3BsYW5lLmpzJyk7Cl9kZXJlcV8oJy4vcmluZy5qcycpOwpfZGVyZXFfKCcuL3NwaGVyZS5qcycpOwpfZGVyZXFfKCcuL3RldHJhaGVkcm9uLmpzJyk7Cl9kZXJlcV8oJy4vdG9ydXMuanMnKTsKX2RlcmVxXygnLi90b3J1c0tub3QuanMnKTsKX2RlcmVxXygnLi90cmlhbmdsZS5qcycpOwoKfSx7Ii4vYm94LmpzIjoxMzcsIi4vY2lyY2xlLmpzIjoxMzgsIi4vY29uZS5qcyI6MTM5LCIuL2N5bGluZGVyLmpzIjoxNDAsIi4vZG9kZWNhaGVkcm9uLmpzIjoxNDEsIi4vaWNvc2FoZWRyb24uanMiOjE0MiwiLi9vY3RhaGVkcm9uLmpzIjoxNDQsIi4vcGxhbmUuanMiOjE0NSwiLi9yaW5nLmpzIjoxNDYsIi4vc3BoZXJlLmpzIjoxNDcsIi4vdGV0cmFoZWRyb24uanMiOjE0OCwiLi90b3J1cy5qcyI6MTQ5LCIuL3RvcnVzS25vdC5qcyI6MTUwLCIuL3RyaWFuZ2xlLmpzIjoxNTF9XSwxNDQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJHZW9tZXRyeSA9IF9kZXJlcV8oJy4uL2NvcmUvZ2VvbWV0cnknKS5yZWdpc3Rlckdlb21ldHJ5Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKCnJlZ2lzdGVyR2VvbWV0cnkoJ29jdGFoZWRyb24nLCB7CiAgc2NoZW1hOiB7CiAgICBkZXRhaWw6IHtkZWZhdWx0OiAwLCBtaW46IDAsIG1heDogNSwgdHlwZTogJ2ludCd9LAogICAgcmFkaXVzOiB7ZGVmYXVsdDogMSwgbWluOiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLk9jdGFoZWRyb25HZW9tZXRyeShkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE0NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKcmVnaXN0ZXJHZW9tZXRyeSgncGxhbmUnLCB7CiAgc2NoZW1hOiB7CiAgICBoZWlnaHQ6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgd2lkdGg6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgc2VnbWVudHNIZWlnaHQ6IHtkZWZhdWx0OiAxLCBtaW46IDEsIG1heDogMjAsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzV2lkdGg6IHtkZWZhdWx0OiAxLCBtaW46IDEsIG1heDogMjAsIHR5cGU6ICdpbnQnfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEuc2VnbWVudHNXaWR0aCwgZGF0YS5zZWdtZW50c0hlaWdodCk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2xpYi90aHJlZSI6MTU0fV0sMTQ2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykucmVnaXN0ZXJHZW9tZXRyeTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgZGVnVG9SYWQgPSBUSFJFRS5NYXRoLmRlZ1RvUmFkOwoKcmVnaXN0ZXJHZW9tZXRyeSgncmluZycsIHsKICBzY2hlbWE6IHsKICAgIHJhZGl1c0lubmVyOiB7ZGVmYXVsdDogMC44LCBtaW46IDB9LAogICAgcmFkaXVzT3V0ZXI6IHtkZWZhdWx0OiAxLjIsIG1pbjogMH0sCiAgICBzZWdtZW50c1BoaToge2RlZmF1bHQ6IDEwLCBtaW46IDEsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzVGhldGE6IHtkZWZhdWx0OiAzMiwgbWluOiAzLCB0eXBlOiAnaW50J30sCiAgICB0aGV0YUxlbmd0aDoge2RlZmF1bHQ6IDM2MCwgbWluOiAwfSwKICAgIHRoZXRhU3RhcnQ6IHtkZWZhdWx0OiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLlJpbmdHZW9tZXRyeSgKICAgICAgICBkYXRhLnJhZGl1c0lubmVyLCBkYXRhLnJhZGl1c091dGVyLCBkYXRhLnNlZ21lbnRzVGhldGEsIGRhdGEuc2VnbWVudHNQaGksCiAgICAgICAgZGVnVG9SYWQoZGF0YS50aGV0YVN0YXJ0KSwgZGVnVG9SYWQoZGF0YS50aGV0YUxlbmd0aCkpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE0NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKdmFyIGRlZ1RvUmFkID0gVEhSRUUuTWF0aC5kZWdUb1JhZDsKCnJlZ2lzdGVyR2VvbWV0cnkoJ3NwaGVyZScsIHsKICBzY2hlbWE6IHsKICAgIHJhZGl1czoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICBwaGlMZW5ndGg6IHtkZWZhdWx0OiAzNjB9LAogICAgcGhpU3RhcnQ6IHtkZWZhdWx0OiAwLCBtaW46IDB9LAogICAgdGhldGFMZW5ndGg6IHtkZWZhdWx0OiAxODAsIG1pbjogMH0sCiAgICB0aGV0YVN0YXJ0OiB7ZGVmYXVsdDogMH0sCiAgICBzZWdtZW50c0hlaWdodDoge2RlZmF1bHQ6IDE4LCBtaW46IDIsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzV2lkdGg6IHtkZWZhdWx0OiAzNiwgbWluOiAzLCB0eXBlOiAnaW50J30KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy5nZW9tZXRyeSA9IG5ldyBUSFJFRS5TcGhlcmVHZW9tZXRyeSgKICAgICAgZGF0YS5yYWRpdXMsIGRhdGEuc2VnbWVudHNXaWR0aCwgZGF0YS5zZWdtZW50c0hlaWdodCwgZGVnVG9SYWQoZGF0YS5waGlTdGFydCksCiAgICAgIGRlZ1RvUmFkKGRhdGEucGhpTGVuZ3RoKSwgZGVnVG9SYWQoZGF0YS50aGV0YVN0YXJ0KSwgZGVnVG9SYWQoZGF0YS50aGV0YUxlbmd0aCkpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE0ODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKcmVnaXN0ZXJHZW9tZXRyeSgndGV0cmFoZWRyb24nLCB7CiAgc2NoZW1hOiB7CiAgICBkZXRhaWw6IHtkZWZhdWx0OiAwLCBtaW46IDAsIG1heDogNSwgdHlwZTogJ2ludCd9LAogICAgcmFkaXVzOiB7ZGVmYXVsdDogMSwgbWluOiAwfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLlRldHJhaGVkcm9uR2VvbWV0cnkoZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvZ2VvbWV0cnkiOjEwNywiLi4vbGliL3RocmVlIjoxNTR9XSwxNDk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJHZW9tZXRyeSA9IF9kZXJlcV8oJy4uL2NvcmUvZ2VvbWV0cnknKS5yZWdpc3Rlckdlb21ldHJ5Owp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKCnZhciBkZWdUb1JhZCA9IFRIUkVFLk1hdGguZGVnVG9SYWQ7CgpyZWdpc3Rlckdlb21ldHJ5KCd0b3J1cycsIHsKICBzY2hlbWE6IHsKICAgIGFyYzoge2RlZmF1bHQ6IDM2MH0sCiAgICByYWRpdXM6IHtkZWZhdWx0OiAxLCBtaW46IDB9LAogICAgcmFkaXVzVHVidWxhcjoge2RlZmF1bHQ6IDAuMiwgbWluOiAwfSwKICAgIHNlZ21lbnRzUmFkaWFsOiB7ZGVmYXVsdDogMzYsIG1pbjogMiwgdHlwZTogJ2ludCd9LAogICAgc2VnbWVudHNUdWJ1bGFyOiB7ZGVmYXVsdDogMzIsIG1pbjogMywgdHlwZTogJ2ludCd9CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMuZ2VvbWV0cnkgPSBuZXcgVEhSRUUuVG9ydXNHZW9tZXRyeSgKICAgICAgZGF0YS5yYWRpdXMsIGRhdGEucmFkaXVzVHVidWxhciAqIDIsIGRhdGEuc2VnbWVudHNSYWRpYWwsIGRhdGEuc2VnbWVudHNUdWJ1bGFyLAogICAgICBkZWdUb1JhZChkYXRhLmFyYykpOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9nZW9tZXRyeSI6MTA3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE1MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3Rlckdlb21ldHJ5ID0gX2RlcmVxXygnLi4vY29yZS9nZW9tZXRyeScpLnJlZ2lzdGVyR2VvbWV0cnk7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKcmVnaXN0ZXJHZW9tZXRyeSgndG9ydXNLbm90JywgewogIHNjaGVtYTogewogICAgcDoge2RlZmF1bHQ6IDIsIG1pbjogMX0sCiAgICBxOiB7ZGVmYXVsdDogMywgbWluOiAxfSwKICAgIHJhZGl1czoge2RlZmF1bHQ6IDEsIG1pbjogMH0sCiAgICByYWRpdXNUdWJ1bGFyOiB7ZGVmYXVsdDogMC4yLCBtaW46IDB9LAogICAgc2VnbWVudHNSYWRpYWw6IHtkZWZhdWx0OiA4LCBtaW46IDMsIHR5cGU6ICdpbnQnfSwKICAgIHNlZ21lbnRzVHVidWxhcjoge2RlZmF1bHQ6IDEwMCwgbWluOiAzLCB0eXBlOiAnaW50J30KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy5nZW9tZXRyeSA9IG5ldyBUSFJFRS5Ub3J1c0tub3RHZW9tZXRyeSgKICAgICAgZGF0YS5yYWRpdXMsIGRhdGEucmFkaXVzVHVidWxhciAqIDIsIGRhdGEuc2VnbWVudHNUdWJ1bGFyLCBkYXRhLnNlZ21lbnRzUmFkaWFsLAogICAgICBkYXRhLnAsIGRhdGEucSk7CiAgfQp9KTsKCn0seyIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2xpYi90aHJlZSI6MTU0fV0sMTUxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykucmVnaXN0ZXJHZW9tZXRyeTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgcXVhdGVybmlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CnZhciByb3RhdGVWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAxKTsKdmFyIHV2TWluVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjIoKTsKdmFyIHV2TWF4VmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjIoKTsKdmFyIHV2U2NhbGVWZWN0b3IgPSBuZXcgVEhSRUUuVmVjdG9yMigpOwoKcmVnaXN0ZXJHZW9tZXRyeSgndHJpYW5nbGUnLCB7CiAgc2NoZW1hOiB7CiAgICB2ZXJ0ZXhBOiB7dHlwZTogJ3ZlYzMnLCBkZWZhdWx0OiB7eDogMCwgeTogMC41LCB6OiAwfX0sCiAgICB2ZXJ0ZXhCOiB7dHlwZTogJ3ZlYzMnLCBkZWZhdWx0OiB7eDogLTAuNSwgeTogLTAuNSwgejogMH19LAogICAgdmVydGV4Qzoge3R5cGU6ICd2ZWMzJywgZGVmYXVsdDoge3g6IDAuNSwgeTogLTAuNSwgejogMH19CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBnZW9tZXRyeTsKICAgIHZhciBub3JtYWw7CiAgICB2YXIgdHJpYW5nbGU7CiAgICB2YXIgdXZBOwogICAgdmFyIHV2QjsKICAgIHZhciB1dkM7CgogICAgdHJpYW5nbGUgPSBuZXcgVEhSRUUuVHJpYW5nbGUoKTsKICAgIHRyaWFuZ2xlLmEuc2V0KGRhdGEudmVydGV4QS54LCBkYXRhLnZlcnRleEEueSwgZGF0YS52ZXJ0ZXhBLnopOwogICAgdHJpYW5nbGUuYi5zZXQoZGF0YS52ZXJ0ZXhCLngsIGRhdGEudmVydGV4Qi55LCBkYXRhLnZlcnRleEIueik7CiAgICB0cmlhbmdsZS5jLnNldChkYXRhLnZlcnRleEMueCwgZGF0YS52ZXJ0ZXhDLnksIGRhdGEudmVydGV4Qy56KTsKICAgIG5vcm1hbCA9IHRyaWFuZ2xlLmdldE5vcm1hbChuZXcgVEhSRUUuVmVjdG9yMygpKTsKCiAgICAvLyBSb3RhdGUgdGhlIDNEIHRyaWFuZ2xlIHRvIGJlIHBhcmFsbGVsIHRvIFhZIHBsYW5lLgogICAgcXVhdGVybmlvbi5zZXRGcm9tVW5pdFZlY3RvcnMobm9ybWFsLCByb3RhdGVWZWN0b3IpOwogICAgdXZBID0gdHJpYW5nbGUuYS5jbG9uZSgpLmFwcGx5UXVhdGVybmlvbihxdWF0ZXJuaW9uKTsKICAgIHV2QiA9IHRyaWFuZ2xlLmIuY2xvbmUoKS5hcHBseVF1YXRlcm5pb24ocXVhdGVybmlvbik7CiAgICB1dkMgPSB0cmlhbmdsZS5jLmNsb25lKCkuYXBwbHlRdWF0ZXJuaW9uKHF1YXRlcm5pb24pOwoKICAgIC8vIENvbXB1dGUgVVZzLgogICAgLy8gTm9ybWFsaXplIHgveSB2YWx1ZXMgb2YgVVYgc28gdGhleSBhcmUgd2l0aGluIDAgdG8gMS4KICAgIHV2TWluVmVjdG9yLnNldChNYXRoLm1pbih1dkEueCwgdXZCLngsIHV2Qy54KSwgTWF0aC5taW4odXZBLnksIHV2Qi55LCB1dkMueSkpOwogICAgdXZNYXhWZWN0b3Iuc2V0KE1hdGgubWF4KHV2QS54LCB1dkIueCwgdXZDLngpLCBNYXRoLm1heCh1dkEueSwgdXZCLnksIHV2Qy55KSk7CiAgICB1dlNjYWxlVmVjdG9yLnNldCgwLCAwKS5zdWJWZWN0b3JzKHV2TWF4VmVjdG9yLCB1dk1pblZlY3Rvcik7CiAgICB1dkEgPSBuZXcgVEhSRUUuVmVjdG9yMigpLnN1YlZlY3RvcnModXZBLCB1dk1pblZlY3RvcikuZGl2aWRlKHV2U2NhbGVWZWN0b3IpOwogICAgdXZCID0gbmV3IFRIUkVFLlZlY3RvcjIoKS5zdWJWZWN0b3JzKHV2QiwgdXZNaW5WZWN0b3IpLmRpdmlkZSh1dlNjYWxlVmVjdG9yKTsKICAgIHV2QyA9IG5ldyBUSFJFRS5WZWN0b3IyKCkuc3ViVmVjdG9ycyh1dkMsIHV2TWluVmVjdG9yKS5kaXZpZGUodXZTY2FsZVZlY3Rvcik7CgogICAgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7CiAgICBnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKHRyaWFuZ2xlLmEpOwogICAgZ2VvbWV0cnkudmVydGljZXMucHVzaCh0cmlhbmdsZS5iKTsKICAgIGdlb21ldHJ5LnZlcnRpY2VzLnB1c2godHJpYW5nbGUuYyk7CiAgICBnZW9tZXRyeS5mYWNlcy5wdXNoKG5ldyBUSFJFRS5GYWNlMygwLCAxLCAyLCBub3JtYWwpKTsKICAgIGdlb21ldHJ5LmZhY2VWZXJ0ZXhVdnNbMF0gPSBbW3V2QSwgdXZCLCB1dkNdXTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvZ2VvbWV0cnkiOjEwNywiLi4vbGliL3RocmVlIjoxNTR9XSwxNTI6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovLyBQb2x5ZmlsbCBgUHJvbWlzZWAuCndpbmRvdy5Qcm9taXNlID0gd2luZG93LlByb21pc2UgfHwgX2RlcmVxXygncHJvbWlzZS1wb2x5ZmlsbCcpOwoKLy8gV2ViVlIgcG9seWZpbGwKLy8gQ2hlY2sgYmVmb3JlIHRoZSBwb2x5ZmlsbCBydW5zLgp3aW5kb3cuaGFzTmF0aXZlV2ViVlJJbXBsZW1lbnRhdGlvbiA9ICEhd2luZG93Lm5hdmlnYXRvci5nZXRWUkRpc3BsYXlzIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISF3aW5kb3cubmF2aWdhdG9yLmdldFZSRGV2aWNlczsKd2luZG93Lmhhc05hdGl2ZVdlYlhSSW1wbGVtZW50YXRpb24gPSBuYXZpZ2F0b3IueHIgIT09IHVuZGVmaW5lZDsKCi8vIElmIG5hdGl2ZSBXZWJYUiBvciBXZWJWUiBhcmUgZGVmaW5lZCBXZWJWUlBvbHlmaWxsIGRvZXMgbm90IGluaXRpYWxpemUuCmlmICghd2luZG93Lmhhc05hdGl2ZVdlYlhSSW1wbGVtZW50YXRpb24gJiYgIXdpbmRvdy5oYXNOYXRpdmVXZWJWUkltcGxlbWVudGF0aW9uKSB7CiAgdmFyIGlzSU9TT2xkZXJUaGFuMTAgPSBfZGVyZXFfKCcuL3V0aWxzL2lzSU9TT2xkZXJUaGFuMTAnKTsKICAvLyBXb3JrYXJvdW5kIGZvciBpT1MgU2FmYXJpIGNhbnZhcyBzaXppbmcgaXNzdWVzIGluIHN0ZXJlbyAod2VidnItcG9seWZpbGwvaXNzdWVzLzEwMikuCiAgLy8gT25seSBmb3IgaU9TIG9uIHZlcnNpb25zIG9sZGVyIHRoYW4gMTAuCiAgdmFyIGJ1ZmZlclNjYWxlID0gaXNJT1NPbGRlclRoYW4xMCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkgPyAxIC8gd2luZG93LmRldmljZVBpeGVsUmF0aW8gOiAxOwogIHZhciBXZWJWUlBvbHlmaWxsID0gX2RlcmVxXygnd2VidnItcG9seWZpbGwnKTsKICB2YXIgcG9seWZpbGxDb25maWcgPSB7CiAgICBCVUZGRVJfU0NBTEU6IGJ1ZmZlclNjYWxlLAogICAgQ0FSREJPQVJEX1VJX0RJU0FCTEVEOiB0cnVlLAogICAgUk9UQVRFX0lOU1RSVUNUSU9OU19ESVNBQkxFRDogdHJ1ZQogIH07CiAgd2luZG93LndlYnZycG9seWZpbGwgPSBuZXcgV2ViVlJQb2x5ZmlsbChwb2x5ZmlsbENvbmZpZyk7Cn0KCnZhciB1dGlscyA9IF9kZXJlcV8oJy4vdXRpbHMvJyk7CnZhciBkZWJ1ZyA9IHV0aWxzLmRlYnVnOwoKaWYgKHV0aWxzLmlzSUUxMSkgewogIC8vIFBvbHlmaWxsIGBDdXN0b21FdmVudGAuCiAgX2RlcmVxXygnY3VzdG9tLWV2ZW50LXBvbHlmaWxsJyk7CiAgLy8gUG9seWZpbGwgU3RyaW5nLnN0YXJ0c1dpdGguCiAgX2RlcmVxXygnLi4vdmVuZG9yL3N0YXJ0cy13aXRoLXBvbHlmaWxsJyk7Cn0KCnZhciBlcnJvciA9IGRlYnVnKCdBLUZyYW1lOmVycm9yJyk7CnZhciB3YXJuID0gZGVidWcoJ0EtRnJhbWU6d2FybicpOwoKaWYgKHdpbmRvdy5kb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIHdpbmRvdy5kb2N1bWVudC5jdXJyZW50U2NyaXB0LnBhcmVudE5vZGUgIT09CiAgICB3aW5kb3cuZG9jdW1lbnQuaGVhZCAmJiAhd2luZG93LmRlYnVnKSB7CiAgd2FybignUHV0IHRoZSBBLUZyYW1lIDxzY3JpcHQ+IHRhZyBpbiB0aGUgPGhlYWQ+IG9mIHRoZSBIVE1MICpiZWZvcmUqIHRoZSBzY2VuZSB0byAnICsKICAgICAgICdlbnN1cmUgZXZlcnl0aGluZyBmb3IgQS1GcmFtZSBpcyBwcm9wZXJseSByZWdpc3RlcmVkIGJlZm9yZSB0aGV5IGFyZSB1c2VkIGZyb20gJyArCiAgICAgICAnSFRNTC4nKTsKfQoKLy8gRXJyb3IgaWYgbm90IHVzaW5nIGEgc2VydmVyLgppZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSAnZmlsZTonKSB7CiAgZXJyb3IoCiAgICAnVGhpcyBIVE1MIGZpbGUgaXMgY3VycmVudGx5IGJlaW5nIHNlcnZlZCB2aWEgdGhlIGZpbGU6Ly8gcHJvdG9jb2wuICcgKwogICAgJ0Fzc2V0cywgdGV4dHVyZXMsIGFuZCBtb2RlbHMgV0lMTCBOT1QgV09SSyBkdWUgdG8gY3Jvc3Mtb3JpZ2luIHBvbGljeSEgJyArCiAgICAnUGxlYXNlIHVzZSBhIGxvY2FsIG9yIGhvc3RlZCBzZXJ2ZXI6ICcgKwogICAgJ2h0dHBzOi8vYWZyYW1lLmlvL2RvY3MvMC41LjAvaW50cm9kdWN0aW9uL2dldHRpbmctc3RhcnRlZC5odG1sI3VzaW5nLWEtbG9jYWwtc2VydmVyLicpOwp9CgpfZGVyZXFfKCdwcmVzZW50Jyk7IC8vIFBvbHlmaWxsIGBwZXJmb3JtYW5jZS5ub3coKWAuCgovLyBDU1MuCmlmICh1dGlscy5kZXZpY2UuaXNCcm93c2VyRW52aXJvbm1lbnQpIHsKICBfZGVyZXFfKCcuL3N0eWxlL2FmcmFtZS5jc3MnKTsKICBfZGVyZXFfKCcuL3N0eWxlL3JTdGF0cy5jc3MnKTsKfQoKLy8gUmVxdWlyZWQgYmVmb3JlIGBBRW50aXR5YCBzbyB0aGF0IGFsbCBjb21wb25lbnRzIGFyZSByZWdpc3RlcmVkLgp2YXIgQVNjZW5lID0gX2RlcmVxXygnLi9jb3JlL3NjZW5lL2Etc2NlbmUnKS5BU2NlbmU7CnZhciBjb21wb25lbnRzID0gX2RlcmVxXygnLi9jb3JlL2NvbXBvbmVudCcpLmNvbXBvbmVudHM7CnZhciByZWdpc3RlckNvbXBvbmVudCA9IF9kZXJlcV8oJy4vY29yZS9jb21wb25lbnQnKS5yZWdpc3RlckNvbXBvbmVudDsKdmFyIHJlZ2lzdGVyR2VvbWV0cnkgPSBfZGVyZXFfKCcuL2NvcmUvZ2VvbWV0cnknKS5yZWdpc3Rlckdlb21ldHJ5Owp2YXIgcmVnaXN0ZXJQcmltaXRpdmUgPSBfZGVyZXFfKCcuL2V4dHJhcy9wcmltaXRpdmVzL3ByaW1pdGl2ZXMnKS5yZWdpc3RlclByaW1pdGl2ZTsKdmFyIHJlZ2lzdGVyU2hhZGVyID0gX2RlcmVxXygnLi9jb3JlL3NoYWRlcicpLnJlZ2lzdGVyU2hhZGVyOwp2YXIgcmVnaXN0ZXJTeXN0ZW0gPSBfZGVyZXFfKCcuL2NvcmUvc3lzdGVtJykucmVnaXN0ZXJTeXN0ZW07CnZhciBzaGFkZXJzID0gX2RlcmVxXygnLi9jb3JlL3NoYWRlcicpLnNoYWRlcnM7CnZhciBzeXN0ZW1zID0gX2RlcmVxXygnLi9jb3JlL3N5c3RlbScpLnN5c3RlbXM7Ci8vIEV4cG9ydHMgVEhSRUUgdG8gd2luZG93IHNvIHRocmVlLmpzIGNhbiBiZSB1c2VkIHdpdGhvdXQgYWx0ZXJhdGlvbi4KdmFyIFRIUkVFID0gd2luZG93LlRIUkVFID0gX2RlcmVxXygnLi9saWIvdGhyZWUnKTsKCnZhciBwa2cgPSBfZGVyZXFfKCcuLi9wYWNrYWdlJyk7CgpfZGVyZXFfKCcuL2NvbXBvbmVudHMvaW5kZXgnKTsgLy8gUmVnaXN0ZXIgc3RhbmRhcmQgY29tcG9uZW50cy4KX2RlcmVxXygnLi9nZW9tZXRyaWVzL2luZGV4Jyk7IC8vIFJlZ2lzdGVyIHN0YW5kYXJkIGdlb21ldHJpZXMuCl9kZXJlcV8oJy4vc2hhZGVycy9pbmRleCcpOyAvLyBSZWdpc3RlciBzdGFuZGFyZCBzaGFkZXJzLgpfZGVyZXFfKCcuL3N5c3RlbXMvaW5kZXgnKTsgLy8gUmVnaXN0ZXIgc3RhbmRhcmQgc3lzdGVtcy4KdmFyIEFOb2RlID0gX2RlcmVxXygnLi9jb3JlL2Etbm9kZScpOwp2YXIgQUVudGl0eSA9IF9kZXJlcV8oJy4vY29yZS9hLWVudGl0eScpOyAvLyBEZXBlbmRzIG9uIEFOb2RlIGFuZCBjb3JlIGNvbXBvbmVudHMuCgpfZGVyZXFfKCcuL2NvcmUvYS1hc3NldHMnKTsKX2RlcmVxXygnLi9jb3JlL2EtY3ViZW1hcCcpOwpfZGVyZXFfKCcuL2NvcmUvYS1taXhpbicpOwoKLy8gRXh0cmFzLgpfZGVyZXFfKCcuL2V4dHJhcy9jb21wb25lbnRzLycpOwpfZGVyZXFfKCcuL2V4dHJhcy9wcmltaXRpdmVzLycpOwoKY29uc29sZS5sb2coJ0EtRnJhbWUgVmVyc2lvbjogMC45LjIgKERhdGUgMjAxOS0wNS0wNiwgQ29tbWl0ICNmNTdhMWZhKScpOwpjb25zb2xlLmxvZygndGhyZWUgVmVyc2lvbiAoaHR0cHM6Ly9naXRodWIuY29tL3N1cGVybWVkaXVtL3RocmVlLmpzKTonLAogICAgICAgICAgICBwa2cuZGVwZW5kZW5jaWVzWydzdXBlci10aHJlZSddKTsKY29uc29sZS5sb2coJ1dlYlZSIFBvbHlmaWxsIFZlcnNpb246JywgcGtnLmRlcGVuZGVuY2llc1snd2VidnItcG9seWZpbGwnXSk7Cgptb2R1bGUuZXhwb3J0cyA9IHdpbmRvdy5BRlJBTUUgPSB7CiAgQUNvbXBvbmVudDogX2RlcmVxXygnLi9jb3JlL2NvbXBvbmVudCcpLkNvbXBvbmVudCwKICBBRW50aXR5OiBBRW50aXR5LAogIEFOb2RlOiBBTm9kZSwKICBBTklNRTogX2RlcmVxXygnc3VwZXItYW5pbWVqcycpLAogIEFTY2VuZTogQVNjZW5lLAogIGNvbXBvbmVudHM6IGNvbXBvbmVudHMsCiAgY29yZUNvbXBvbmVudHM6IE9iamVjdC5rZXlzKGNvbXBvbmVudHMpLAogIGdlb21ldHJpZXM6IF9kZXJlcV8oJy4vY29yZS9nZW9tZXRyeScpLmdlb21ldHJpZXMsCiAgcmVnaXN0ZXJDb21wb25lbnQ6IHJlZ2lzdGVyQ29tcG9uZW50LAogIHJlZ2lzdGVyRWxlbWVudDogX2RlcmVxXygnLi9jb3JlL2EtcmVnaXN0ZXItZWxlbWVudCcpLnJlZ2lzdGVyRWxlbWVudCwKICByZWdpc3Rlckdlb21ldHJ5OiByZWdpc3Rlckdlb21ldHJ5LAogIHJlZ2lzdGVyUHJpbWl0aXZlOiByZWdpc3RlclByaW1pdGl2ZSwKICByZWdpc3RlclNoYWRlcjogcmVnaXN0ZXJTaGFkZXIsCiAgcmVnaXN0ZXJTeXN0ZW06IHJlZ2lzdGVyU3lzdGVtLAogIHByaW1pdGl2ZXM6IHsKICAgIGdldE1lc2hNaXhpbjogX2RlcmVxXygnLi9leHRyYXMvcHJpbWl0aXZlcy9nZXRNZXNoTWl4aW4nKSwKICAgIHByaW1pdGl2ZXM6IF9kZXJlcV8oJy4vZXh0cmFzL3ByaW1pdGl2ZXMvcHJpbWl0aXZlcycpLnByaW1pdGl2ZXMKICB9LAogIHNjZW5lczogX2RlcmVxXygnLi9jb3JlL3NjZW5lL3NjZW5lcycpLAogIHNjaGVtYTogX2RlcmVxXygnLi9jb3JlL3NjaGVtYScpLAogIHNoYWRlcnM6IHNoYWRlcnMsCiAgc3lzdGVtczogc3lzdGVtcywKICBUSFJFRTogVEhSRUUsCiAgdXRpbHM6IHV0aWxzLAogIHZlcnNpb246IHBrZy52ZXJzaW9uCn07Cgp9LHsiLi4vcGFja2FnZSI6NTQsIi4uL3ZlbmRvci9zdGFydHMtd2l0aC1wb2x5ZmlsbCI6MTkwLCIuL2NvbXBvbmVudHMvaW5kZXgiOjYzLCIuL2NvcmUvYS1hc3NldHMiOjEwMCwiLi9jb3JlL2EtY3ViZW1hcCI6MTAxLCIuL2NvcmUvYS1lbnRpdHkiOjEwMiwiLi9jb3JlL2EtbWl4aW4iOjEwMywiLi9jb3JlL2Etbm9kZSI6MTA0LCIuL2NvcmUvYS1yZWdpc3Rlci1lbGVtZW50IjoxMDUsIi4vY29yZS9jb21wb25lbnQiOjEwNiwiLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4vY29yZS9zY2VuZS9hLXNjZW5lIjoxMDksIi4vY29yZS9zY2VuZS9zY2VuZXMiOjExMywiLi9jb3JlL3NjaGVtYSI6MTE1LCIuL2NvcmUvc2hhZGVyIjoxMTYsIi4vY29yZS9zeXN0ZW0iOjExNywiLi9leHRyYXMvY29tcG9uZW50cy8iOjExOCwiLi9leHRyYXMvcHJpbWl0aXZlcy8iOjEyMSwiLi9leHRyYXMvcHJpbWl0aXZlcy9nZXRNZXNoTWl4aW4iOjEyMCwiLi9leHRyYXMvcHJpbWl0aXZlcy9wcmltaXRpdmVzIjoxMjIsIi4vZ2VvbWV0cmllcy9pbmRleCI6MTQzLCIuL2xpYi90aHJlZSI6MTU0LCIuL3NoYWRlcnMvaW5kZXgiOjE1NiwiLi9zdHlsZS9hZnJhbWUuY3NzIjoxNjEsIi4vc3R5bGUvclN0YXRzLmNzcyI6MTYyLCIuL3N5c3RlbXMvaW5kZXgiOjE2NiwiLi91dGlscy8iOjE3OSwiLi91dGlscy9pc0lPU09sZGVyVGhhbjEwIjoxODEsImN1c3RvbS1ldmVudC1wb2x5ZmlsbCI6OSwicHJlc2VudCI6MzMsInByb21pc2UtcG9seWZpbGwiOjM0LCJzdXBlci1hbmltZWpzIjozNiwid2VidnItcG9seWZpbGwiOjQ5fV0sMTUzOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKd2luZG93LmFmcmFtZVN0YXRzID0gZnVuY3Rpb24gKHNjZW5lKSB7CiAgdmFyIF9yUyA9IG51bGw7CiAgdmFyIF9zY2VuZSA9IHNjZW5lOwogIHZhciBfdmFsdWVzID0gewogICAgdGU6IHsKICAgICAgY2FwdGlvbjogJ0VudGl0aWVzJwogICAgfSwKICAgIGx0OiB7CiAgICAgIGNhcHRpb246ICdMb2FkIFRpbWUnCiAgICB9CiAgfTsKICB2YXIgX2dyb3VwcyA9IFsgewogICAgY2FwdGlvbjogJ0EtRnJhbWUnLAogICAgdmFsdWVzOiBbICd0ZScsICdsdCcgXQogIH0gXTsKCiAgZnVuY3Rpb24gX3VwZGF0ZSAoKSB7CiAgICBfclMoJ3RlJykuc2V0KGdldEVudGl0eUNvdW50KCkpOwogICAgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlOYW1lKSB7CiAgICAgIF9yUygnbHQnKS5zZXQod2luZG93LnBlcmZvcm1hbmNlLmdldEVudHJpZXNCeU5hbWUoJ3JlbmRlci1zdGFydGVkJylbMF0uc3RhcnRUaW1lLnRvRml4ZWQoMCkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0RW50aXR5Q291bnQgKCkgewogICAgdmFyIGVsZW1lbnRzID0gX3NjZW5lLnF1ZXJ5U2VsZWN0b3JBbGwoJyonKTsKICAgIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGVsZW1lbnRzKS5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7CiAgICAgIHJldHVybiBlbC5pc0VudGl0eTsKICAgIH0pOwogICAgcmV0dXJuIGVsZW1lbnRzLmxlbmd0aDsKICB9CgogIGZ1bmN0aW9uIF9zdGFydCAoKSB7fQoKICBmdW5jdGlvbiBfZW5kICgpIHt9CgogIGZ1bmN0aW9uIF9hdHRhY2ggKHIpIHsKICAgIF9yUyA9IHI7CiAgfQoKICByZXR1cm4gewogICAgdXBkYXRlOiBfdXBkYXRlLAogICAgc3RhcnQ6IF9zdGFydCwKICAgIGVuZDogX2VuZCwKICAgIGF0dGFjaDogX2F0dGFjaCwKICAgIHZhbHVlczogX3ZhbHVlcywKICAgIGdyb3VwczogX2dyb3VwcywKICAgIGZyYWN0aW9uczogW10KICB9Owp9OwoKaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKSB7CiAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICBhZnJhbWVTdGF0czogd2luZG93LmFmcmFtZVN0YXRzCiAgfTsKfQoKfSx7fV0sMTU0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKKGZ1bmN0aW9uIChnbG9iYWwpewp2YXIgVEhSRUUgPSBnbG9iYWwuVEhSRUUgPSBfZGVyZXFfKCdzdXBlci10aHJlZScpOwoKLy8gQWxsb3cgY3Jvc3Mtb3JpZ2luIGltYWdlcyB0byBiZSBsb2FkZWQuCgovLyBUaGlzIHNob3VsZCBub3QgYmUgb24gYFRIUkVFLkxvYWRlcmAgbm9yIGBUSFJFRS5JbWFnZVV0aWxzYC4KLy8gTXVzdCBiZSBvbiBgVEhSRUUuVGV4dHVyZUxvYWRlcmAuCmlmIChUSFJFRS5UZXh0dXJlTG9hZGVyKSB7CiAgVEhSRUUuVGV4dHVyZUxvYWRlci5wcm90b3R5cGUuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKfQoKLy8gVGhpcyBpcyBmb3IgaW1hZ2VzIGxvYWRlZCBmcm9tIHRoZSBtb2RlbCBsb2FkZXJzLgppZiAoVEhSRUUuSW1hZ2VMb2FkZXIpIHsKICBUSFJFRS5JbWFnZUxvYWRlci5wcm90b3R5cGUuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKfQoKLy8gSW4tbWVtb3J5IGNhY2hpbmcgZm9yIFhIUnMgKGZvciBpbWFnZXMsIGF1ZGlvIGZpbGVzLCB0ZXh0dXJlcywgZXRjLikuCmlmIChUSFJFRS5DYWNoZSkgewogIFRIUkVFLkNhY2hlLmVuYWJsZWQgPSB0cnVlOwp9CgovLyBUT0RPOiBFdmVudHVhbGx5IGluY2x1ZGUgdGhlc2Ugb25seSBpZiB0aGV5IGFyZSBuZWVkZWQgYnkgYSBjb21wb25lbnQuCl9kZXJlcV8oJ3N1cGVyLXRocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvRFJBQ09Mb2FkZXInKTsgIC8vIFRIUkVFLkRSQUNPTG9hZGVyCl9kZXJlcV8oJ3N1cGVyLXRocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvR0xURkxvYWRlcicpOyAgLy8gVEhSRUUuR0xURkxvYWRlcgpfZGVyZXFfKCdzdXBlci10aHJlZS9leGFtcGxlcy9qcy9sb2FkZXJzL09CSkxvYWRlcicpOyAgLy8gVEhSRUUuT0JKTG9hZGVyCl9kZXJlcV8oJ3N1cGVyLXRocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvTVRMTG9hZGVyJyk7ICAvLyBUSFJFRS5NVExMb2FkZXIKClRIUkVFLkRSQUNPTG9hZGVyLnByb3RvdHlwZS5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwpUSFJFRS5HTFRGTG9hZGVyLnByb3RvdHlwZS5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwpUSFJFRS5NVExMb2FkZXIucHJvdG90eXBlLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7ClRIUkVFLk9CSkxvYWRlci5wcm90b3R5cGUuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKCm1vZHVsZS5leHBvcnRzID0gVEhSRUU7Cgp9KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIgPyBzZWxmIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCn0seyJzdXBlci10aHJlZSI6MzcsInN1cGVyLXRocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvRFJBQ09Mb2FkZXIiOjM4LCJzdXBlci10aHJlZS9leGFtcGxlcy9qcy9sb2FkZXJzL0dMVEZMb2FkZXIiOjM5LCJzdXBlci10aHJlZS9leGFtcGxlcy9qcy9sb2FkZXJzL01UTExvYWRlciI6NDAsInN1cGVyLXRocmVlL2V4YW1wbGVzL2pzL2xvYWRlcnMvT0JKTG9hZGVyIjo0MX1dLDE1NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlclNoYWRlciA9IF9kZXJlcV8oJy4uL2NvcmUvc2hhZGVyJykucmVnaXN0ZXJTaGFkZXI7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi91dGlscy8nKTsKCi8qKgogKiBGbGF0IHNoYWRlciB1c2luZyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbC4KICovCm1vZHVsZS5leHBvcnRzLlNoYWRlciA9IHJlZ2lzdGVyU2hhZGVyKCdmbGF0JywgewogIHNjaGVtYTogewogICAgY29sb3I6IHt0eXBlOiAnY29sb3InfSwKICAgIGZvZzoge2RlZmF1bHQ6IHRydWV9LAogICAgaGVpZ2h0OiB7ZGVmYXVsdDogMjU2fSwKICAgIG9mZnNldDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDAsIHk6IDB9fSwKICAgIHJlcGVhdDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKICAgIHNyYzoge3R5cGU6ICdtYXAnfSwKICAgIHdpZHRoOiB7ZGVmYXVsdDogNTEyfSwKICAgIHdpcmVmcmFtZToge2RlZmF1bHQ6IGZhbHNlfSwKICAgIHdpcmVmcmFtZUxpbmV3aWR0aDoge2RlZmF1bHQ6IDJ9CiAgfSwKCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgdGhlIHNoYWRlci4KICAgKiBBZGRzIGEgcmVmZXJlbmNlIGZyb20gdGhlIHNjZW5lIHRvIHRoaXMgZW50aXR5IGFzIHRoZSBjYW1lcmEuCiAgICovCiAgaW5pdDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0gPSB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5yZW5kZXJlcjsKICAgIHRoaXMubWF0ZXJpYWxEYXRhID0ge2NvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKX07CiAgICB0aGlzLnRleHR1cmVTcmMgPSBudWxsOwogICAgZ2V0TWF0ZXJpYWxEYXRhKGRhdGEsIHRoaXMubWF0ZXJpYWxEYXRhKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24odGhpcy5tYXRlcmlhbERhdGEuY29sb3IpOwogICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh0aGlzLm1hdGVyaWFsRGF0YSk7CiAgICB1dGlscy5tYXRlcmlhbC51cGRhdGVNYXAodGhpcywgZGF0YSk7CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy51cGRhdGVNYXRlcmlhbChkYXRhKTsKICAgIHV0aWxzLm1hdGVyaWFsLnVwZGF0ZU1hcCh0aGlzLCBkYXRhKTsKICB9LAoKICAvKioKICAgKiBVcGRhdGluZyBleGlzdGluZyBtYXRlcmlhbC4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gTWF0ZXJpYWwgY29tcG9uZW50IGRhdGEuCiAgICovCiAgdXBkYXRlTWF0ZXJpYWw6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIga2V5OwogICAgZ2V0TWF0ZXJpYWxEYXRhKGRhdGEsIHRoaXMubWF0ZXJpYWxEYXRhKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24odGhpcy5tYXRlcmlhbERhdGEuY29sb3IpOwogICAgZm9yIChrZXkgaW4gdGhpcy5tYXRlcmlhbERhdGEpIHsKICAgICAgdGhpcy5tYXRlcmlhbFtrZXldID0gdGhpcy5tYXRlcmlhbERhdGFba2V5XTsKICAgIH0KICB9Cn0pOwoKLyoqCiAqIEJ1aWxkcyBhbmQgbm9ybWFsaXplIG1hdGVyaWFsIGRhdGEsIG5vcm1hbGl6aW5nIHN0dWZmIGFsb25nIHRoZSB3YXkuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gTWF0ZXJpYWwgZGF0YS4KICogQHBhcmFtIHtvYmplY3R9IG1hdGVyaWFsRGF0YSAtIE9iamVjdCB0byByZXVzZS4KICogQHJldHVybnMge29iamVjdH0gVXBkYXRlZCBtYXRlcmlhbCBkYXRhLgogKi8KZnVuY3Rpb24gZ2V0TWF0ZXJpYWxEYXRhIChkYXRhLCBtYXRlcmlhbERhdGEpIHsKICBtYXRlcmlhbERhdGEuY29sb3Iuc2V0KGRhdGEuY29sb3IpOwogIG1hdGVyaWFsRGF0YS5mb2cgPSBkYXRhLmZvZzsKICBtYXRlcmlhbERhdGEud2lyZWZyYW1lID0gZGF0YS53aXJlZnJhbWU7CiAgbWF0ZXJpYWxEYXRhLndpcmVmcmFtZUxpbmV3aWR0aCA9IGRhdGEud2lyZWZyYW1lTGluZXdpZHRoOwogIHJldHVybiBtYXRlcmlhbERhdGE7Cn0KCn0seyIuLi9jb3JlL3NoYWRlciI6MTE2LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMvIjoxNzl9XSwxNTY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewpfZGVyZXFfKCcuL2ZsYXQnKTsKX2RlcmVxXygnLi9zdGFuZGFyZCcpOwpfZGVyZXFfKCcuL3NkZicpOwpfZGVyZXFfKCcuL21zZGYnKTsKX2RlcmVxXygnLi9pb3MxMGhscycpOwoKfSx7Ii4vZmxhdCI6MTU1LCIuL2lvczEwaGxzIjoxNTcsIi4vbXNkZiI6MTU4LCIuL3NkZiI6MTU5LCIuL3N0YW5kYXJkIjoxNjB9XSwxNTc6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJTaGFkZXIgPSBfZGVyZXFfKCcuLi9jb3JlL3NoYWRlcicpLnJlZ2lzdGVyU2hhZGVyOwoKLyoqCiAqIEN1c3RvbSBzaGFkZXIgZm9yIGlPUyAxMCBIVFRQIExpdmUgU3RyZWFtaW5nIChITFMpLgogKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBITFMsIHNlZSBodHRwczovL2RhdGF0cmFja2VyLmlldGYub3JnL2RvYy9kcmFmdC1wYW50b3MtaHR0cC1saXZlLXN0cmVhbWluZy8KICovCm1vZHVsZS5leHBvcnRzLlNoYWRlciA9IHJlZ2lzdGVyU2hhZGVyKCdpb3MxMGhscycsIHsKICBzY2hlbWE6IHsKICAgIHNyYzoge3R5cGU6ICdtYXAnLCBpczogJ3VuaWZvcm0nfSwKICAgIG9wYWNpdHk6IHt0eXBlOiAnbnVtYmVyJywgaXM6ICd1bmlmb3JtJywgZGVmYXVsdDogMX0KICB9LAoKICB2ZXJ0ZXhTaGFkZXI6IFsKICAgICd2YXJ5aW5nIHZlYzIgdlVWOycsCiAgICAndm9pZCBtYWluKHZvaWQpIHsnLAogICAgJyAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsnLAogICAgJyAgdlVWID0gdXY7JywKICAgICd9JwogIF0uam9pbignXG4nKSwKCiAgZnJhZ21lbnRTaGFkZXI6IFsKICAgICd1bmlmb3JtIHNhbXBsZXIyRCBzcmM7JywKICAgICd1bmlmb3JtIGZsb2F0IG9wYWNpdHk7JywKICAgICd2YXJ5aW5nIHZlYzIgdlVWOycsCiAgICAndm9pZCBtYWluKCkgeycsCiAgICAnICB2ZWMyIG9mZnNldCA9IHZlYzIoMCwgMCk7JywKICAgICcgIHZlYzIgcmVwZWF0ID0gdmVjMigxLCAxKTsnLAogICAgJyAgdmVjNCBjb2xvciA9IHRleHR1cmUyRChzcmMsIHZlYzIodlVWLnggLyByZXBlYXQueCArIG9mZnNldC54LCAoMS4wIC0gdlVWLnkpIC8gcmVwZWF0LnkgKyBvZmZzZXQueSkpLmJncmE7JywKICAgICcgIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IucmdiLCBvcGFjaXR5KTsnLAogICAgJ30nCiAgXS5qb2luKCdcbicpCn0pOwoKCn0seyIuLi9jb3JlL3NoYWRlciI6MTE2fV0sMTU4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyU2hhZGVyID0gX2RlcmVxXygnLi4vY29yZS9zaGFkZXInKS5yZWdpc3RlclNoYWRlcjsKCi8qKgogKiBNdWx0aS1jaGFubmVsIHNpZ25lZCBkaXN0YW5jZSBmaWVsZC4KICogVXNlZCBieSB0ZXh0IGNvbXBvbmVudC4KICovCm1vZHVsZS5leHBvcnRzLlNoYWRlciA9IHJlZ2lzdGVyU2hhZGVyKCdtc2RmJywgewogIHNjaGVtYTogewogICAgYWxwaGFUZXN0OiB7dHlwZTogJ251bWJlcicsIGlzOiAndW5pZm9ybScsIGRlZmF1bHQ6IDAuNX0sCiAgICBjb2xvcjoge3R5cGU6ICdjb2xvcicsIGlzOiAndW5pZm9ybScsIGRlZmF1bHQ6ICd3aGl0ZSd9LAogICAgbWFwOiB7dHlwZTogJ21hcCcsIGlzOiAndW5pZm9ybSd9LAogICAgbmVnYXRlOiB7dHlwZTogJ2Jvb2xlYW4nLCBpczogJ3VuaWZvcm0nLCBkZWZhdWx0OiB0cnVlfSwKICAgIG9wYWNpdHk6IHt0eXBlOiAnbnVtYmVyJywgaXM6ICd1bmlmb3JtJywgZGVmYXVsdDogMS4wfQogIH0sCgogIHJhdzogdHJ1ZSwKCiAgdmVydGV4U2hhZGVyOiBbCiAgICAnYXR0cmlidXRlIHZlYzIgdXY7JywKICAgICdhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsnLAogICAgJ3VuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4OycsCiAgICAndW5pZm9ybSBtYXQ0IG1vZGVsVmlld01hdHJpeDsnLAogICAgJ3ZhcnlpbmcgdmVjMiB2VVY7JywKICAgICd2b2lkIG1haW4odm9pZCkgeycsCiAgICAnICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHBvc2l0aW9uLCAxLjApOycsCiAgICAnICB2VVYgPSB1djsnLAogICAgJ30nCiAgXS5qb2luKCdcbicpLAoKICBmcmFnbWVudFNoYWRlcjogWwogICAgJyNpZmRlZiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMnLAogICAgJyNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzOiBlbmFibGUnLAogICAgJyNlbmRpZicsCgogICAgJ3ByZWNpc2lvbiBoaWdocCBmbG9hdDsnLAogICAgJ3VuaWZvcm0gYm9vbCBuZWdhdGU7JywKICAgICd1bmlmb3JtIGZsb2F0IGFscGhhVGVzdDsnLAogICAgJ3VuaWZvcm0gZmxvYXQgb3BhY2l0eTsnLAogICAgJ3VuaWZvcm0gc2FtcGxlcjJEIG1hcDsnLAogICAgJ3VuaWZvcm0gdmVjMyBjb2xvcjsnLAogICAgJ3ZhcnlpbmcgdmVjMiB2VVY7JywKCiAgICAnZmxvYXQgbWVkaWFuKGZsb2F0IHIsIGZsb2F0IGcsIGZsb2F0IGIpIHsnLAogICAgJyAgcmV0dXJuIG1heChtaW4ociwgZyksIG1pbihtYXgociwgZyksIGIpKTsnLAogICAgJ30nLAoKICAgIC8vIEZJWE1FOiBFeHBlcmltZW50YWxseSBkZXRlcm1pbmVkIGNvbnN0YW50cy4KICAgICcjZGVmaW5lIEJJR19FTk9VR0ggMC4wMDEnLAogICAgJyNkZWZpbmUgTU9ESUZJRURfQUxQSEFURVNUICgwLjAyICogaXNCaWdFbm91Z2ggLyBCSUdfRU5PVUdIKScsCgogICAgJ3ZvaWQgbWFpbigpIHsnLAogICAgJyAgdmVjMyBzYW1wbGUgPSB0ZXh0dXJlMkQobWFwLCB2VVYpLnJnYjsnLAogICAgJyAgaWYgKG5lZ2F0ZSkgeyBzYW1wbGUgPSAxLjAgLSBzYW1wbGU7IH0nLAoKICAgICcgIGZsb2F0IHNpZ0Rpc3QgPSBtZWRpYW4oc2FtcGxlLnIsIHNhbXBsZS5nLCBzYW1wbGUuYikgLSAwLjU7JywKICAgICcgIGZsb2F0IGFscGhhID0gY2xhbXAoc2lnRGlzdCAvIGZ3aWR0aChzaWdEaXN0KSArIDAuNSwgMC4wLCAxLjApOycsCiAgICAnICBmbG9hdCBkc2NhbGUgPSAwLjM1MzUwNTsnLAogICAgJyAgdmVjMiBkdXYgPSBkc2NhbGUgKiAoZEZkeCh2VVYpICsgZEZkeSh2VVYpKTsnLAogICAgJyAgZmxvYXQgaXNCaWdFbm91Z2ggPSBtYXgoYWJzKGR1di54KSwgYWJzKGR1di55KSk7JywKCiAgICAvLyBXaGVuIHRleGVsIGlzIHRvbyBzbWFsbCwgYmxlbmQgcmF3IGFscGhhIHZhbHVlIHJhdGhlciB0aGFuIHN1cGVyc2FtcGxpbmcuCiAgICAvLyBGSVhNRTogRXhwZXJpbWVudGFsbHkgZGV0ZXJtaW5lZCBjb25zdGFudC4KICAgICcgIC8vIERvIG1vZGlmaWVkIGFscGhhIHRlc3QuJywKICAgICcgIGlmIChpc0JpZ0Vub3VnaCA+IEJJR19FTk9VR0gpIHsnLAogICAgJyAgICBmbG9hdCByYXRpbyA9IEJJR19FTk9VR0ggLyBpc0JpZ0Vub3VnaDsnLAogICAgJyAgICBhbHBoYSA9IHJhdGlvICogYWxwaGEgKyAoMS4wIC0gcmF0aW8pICogKHNpZ0Rpc3QgKyAwLjUpOycsCiAgICAnICB9JywKCiAgICAnICAvLyBEbyBtb2RpZmllZCBhbHBoYSB0ZXN0LicsCiAgICAnICBpZiAoYWxwaGEgPCBhbHBoYVRlc3QgKiBNT0RJRklFRF9BTFBIQVRFU1QpIHsgZGlzY2FyZDsgcmV0dXJuOyB9JywKICAgICcgIGdsX0ZyYWdDb2xvciA9IHZlYzQoY29sb3IueHl6LCBhbHBoYSAqIG9wYWNpdHkpOycsCiAgICAnfScKICBdLmpvaW4oJ1xuJykKfSk7Cgp9LHsiLi4vY29yZS9zaGFkZXIiOjExNn1dLDE1OTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlclNoYWRlciA9IF9kZXJlcV8oJy4uL2NvcmUvc2hhZGVyJykucmVnaXN0ZXJTaGFkZXI7CgovKioKICogU2lnbmVkIGRpc3RhbmNlIGZpZWxkLgogKiBVc2VkIGJ5IHRleHQgY29tcG9uZW50LgogKi8KbW9kdWxlLmV4cG9ydHMuU2hhZGVyID0gcmVnaXN0ZXJTaGFkZXIoJ3NkZicsIHsKICBzY2hlbWE6IHsKICAgIGFscGhhVGVzdDoge3R5cGU6ICdudW1iZXInLCBpczogJ3VuaWZvcm0nLCBkZWZhdWx0OiAwLjV9LAogICAgY29sb3I6IHt0eXBlOiAnY29sb3InLCBpczogJ3VuaWZvcm0nLCBkZWZhdWx0OiAnd2hpdGUnfSwKICAgIG1hcDoge3R5cGU6ICdtYXAnLCBpczogJ3VuaWZvcm0nfSwKICAgIG9wYWNpdHk6IHt0eXBlOiAnbnVtYmVyJywgaXM6ICd1bmlmb3JtJywgZGVmYXVsdDogMS4wfQogIH0sCgogIHJhdzogdHJ1ZSwKCiAgdmVydGV4U2hhZGVyOiBbCiAgICAnYXR0cmlidXRlIHZlYzIgdXY7JywKICAgICdhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsnLAogICAgJ3VuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4OycsCiAgICAndW5pZm9ybSBtYXQ0IG1vZGVsVmlld01hdHJpeDsnLAogICAgJ3ZhcnlpbmcgdmVjMiB2VVY7JywKICAgICd2b2lkIG1haW4odm9pZCkgeycsCiAgICAnICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHBvc2l0aW9uLCAxLjApOycsCiAgICAnICB2VVYgPSB1djsnLAogICAgJ30nCiAgXS5qb2luKCdcbicpLAoKICBmcmFnbWVudFNoYWRlcjogWwogICAgJyNpZmRlZiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMnLAogICAgJyNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzOiBlbmFibGUnLAogICAgJyNlbmRpZicsCgogICAgJ3ByZWNpc2lvbiBoaWdocCBmbG9hdDsnLAogICAgJ3VuaWZvcm0gZmxvYXQgYWxwaGFUZXN0OycsCiAgICAndW5pZm9ybSBmbG9hdCBvcGFjaXR5OycsCiAgICAndW5pZm9ybSBzYW1wbGVyMkQgbWFwOycsCiAgICAndW5pZm9ybSB2ZWMzIGNvbG9yOycsCiAgICAndmFyeWluZyB2ZWMyIHZVVjsnLAoKICAgICcjaWZkZWYgR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzJywKICAgICcgIGZsb2F0IGNvbnRvdXIoZmxvYXQgd2lkdGgsIGZsb2F0IHZhbHVlKSB7JywKICAgICcgICAgcmV0dXJuIHNtb290aHN0ZXAoMC41IC0gdmFsdWUsIDAuNSArIHZhbHVlLCB3aWR0aCk7JywKICAgICcgIH0nLAogICAgJyNlbHNlJywKICAgICcgIGZsb2F0IGFhc3RlcChmbG9hdCB2YWx1ZSwgZmxvYXQgYWZ3aWR0aCkgeycsCiAgICAnICAgIHJldHVybiBzbW9vdGhzdGVwKDAuNSAtIGFmd2lkdGgsIDAuNSArIGFmd2lkdGgsIHZhbHVlKTsnLAogICAgJyAgfScsCiAgICAnI2VuZGlmJywKCiAgICAvLyBGSVhNRTogRXhwZXJpbWVudGFsbHkgZGV0ZXJtaW5lZCBjb25zdGFudHMuCiAgICAnI2RlZmluZSBCSUdfRU5PVUdIIDAuMDAxJywKICAgICcjZGVmaW5lIE1PRElGSUVEX0FMUEhBVEVTVCAoMC4wMiAqIGlzQmlnRW5vdWdoIC8gQklHX0VOT1VHSCknLAogICAgJyNkZWZpbmUgQUxMX1NNT09USCAwLjQnLAogICAgJyNkZWZpbmUgQUxMX1JPVUdIIDAuMDInLAogICAgJyNkZWZpbmUgRElTQ0FSRF9BTFBIQSAoYWxwaGFUZXN0IC8gKDIuMiAtIDEuMiAqIHJhdGlvKSknLAoKICAgICd2b2lkIG1haW4oKSB7JywKICAgICAgIC8vIFdoZW4gd2UgaGF2ZSBkZXJpdmF0aXZlcyBhbmQgY2FuIGdldCB0ZXhlbCBzaXplIGZvciBzdXBlcnNhbXBsaW5nLgogICAgJyAgI2lmZGVmIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcycsCiAgICAnICAgIHZlYzIgdXYgPSB2VVY7JywKICAgICcgICAgdmVjNCB0ZXhDb2xvciA9IHRleHR1cmUyRChtYXAsIHV2KTsnLAogICAgJyAgICBmbG9hdCBkaXN0ID0gdGV4Q29sb3IuYTsnLAogICAgJyAgICBmbG9hdCB3aWR0aCA9IGZ3aWR0aChkaXN0KTsnLAogICAgJyAgICBmbG9hdCBhbHBoYSA9IGNvbnRvdXIoZGlzdCwgd2lkdGgpOycsCiAgICAnICAgIGZsb2F0IGRzY2FsZSA9IDAuMzUzNTA1OycsCgogICAgJyAgICB2ZWMyIGR1diA9IGRzY2FsZSAqIChkRmR4KHV2KSArIGRGZHkodXYpKTsnLAogICAgJyAgICBmbG9hdCBpc0JpZ0Vub3VnaCA9IG1heChhYnMoZHV2LngpLCBhYnMoZHV2LnkpKTsnLAoKICAgICAgICAgLy8gV2hlbiB0ZXhlbCBpcyB0b28gc21hbGwsIGJsZW5kIHJhdyBhbHBoYSB2YWx1ZSByYXRoZXIgdGhhbiBzdXBlcnNhbXBsaW5nLgogICAgICAgICAvLyBGSVhNRTogZXhwZXJpbWVudGFsbHkgZGV0ZXJtaW5lZCBjb25zdGFudAogICAgJyAgICBpZiAoaXNCaWdFbm91Z2ggPiBCSUdfRU5PVUdIKSB7JywKICAgICcgICAgICBmbG9hdCByYXRpbyA9IEJJR19FTk9VR0ggLyBpc0JpZ0Vub3VnaDsnLAogICAgJyAgICAgIGFscGhhID0gcmF0aW8gKiBhbHBoYSArICgxLjAgLSByYXRpbykgKiBkaXN0OycsCiAgICAnICAgIH0nLAoKICAgICAgICAgLy8gT3RoZXJ3aXNlIGRvIHdlaWdodGVkIHN1cGVyc2FtcGxpbmcuCiAgICAgICAgIC8vIEZJWE1FOiB3aHkgdGhpcyB3ZWlnaHRpbmc/CiAgICAnICAgIGlmIChpc0JpZ0Vub3VnaCA8PSBCSUdfRU5PVUdIKSB7JywKICAgICcgICAgICB2ZWM0IGJveCA9IHZlYzQgKHV2IC0gZHV2LCB1diArIGR1dik7JywKICAgICcgICAgICBhbHBoYSA9IChhbHBoYSArIDAuNSAqICgnLAogICAgJyAgICAgICAgY29udG91cih0ZXh0dXJlMkQobWFwLCBib3gueHkpLmEsIHdpZHRoKScsCiAgICAnICAgICAgICArIGNvbnRvdXIodGV4dHVyZTJEKG1hcCwgYm94Lnp3KS5hLCB3aWR0aCknLAogICAgJyAgICAgICAgKyBjb250b3VyKHRleHR1cmUyRChtYXAsIGJveC54dykuYSwgd2lkdGgpJywKICAgICcgICAgICAgICsgY29udG91cih0ZXh0dXJlMkQobWFwLCBib3guenkpLmEsIHdpZHRoKScsCiAgICAnICAgICAgKSkgLyAzLjA7JywKICAgICcgICAgfScsCgogICAgICAgICAvLyBEbyBtb2RpZmllZCBhbHBoYSB0ZXN0LgogICAgJyAgICBpZiAoYWxwaGEgPCBhbHBoYVRlc3QgKiBNT0RJRklFRF9BTFBIQVRFU1QpIHsgZGlzY2FyZDsgcmV0dXJuOyB9JywKCiAgICAnICAjZWxzZScsCiAgICAgICAgIC8vIFdoZW4gd2UgZG9uJ3QgaGF2ZSBkZXJpdmF0aXZlcywgdXNlIGFwcHJveGltYXRpb25zLgogICAgJyAgICB2ZWM0IHRleENvbG9yID0gdGV4dHVyZTJEKG1hcCwgdlVWKTsnLAogICAgJyAgICBmbG9hdCB2YWx1ZSA9IHRleENvbG9yLmE7JywKICAgICAgICAgLy8gRklYTUU6IGlmIHdlIHVuZGVyc3Rvb2QgZm9udCBwaXhlbCBkaW1lbnNpb25zLCB0aGlzIGNvdWxkIHByb2JhYmx5IGJlIGltcHJvdmVkCiAgICAnICAgIGZsb2F0IGFmd2lkdGggPSAoMS4wIC8gMzIuMCkgKiAoMS40MTQyMTM1NjIzNzMwOTUxIC8gKDIuMCAqIGdsX0ZyYWdDb29yZC53KSk7JywKICAgICcgICAgZmxvYXQgYWxwaGEgPSBhYXN0ZXAodmFsdWUsIGFmd2lkdGgpOycsCgogICAgICAgICAvLyBVc2UgZ2xfRnJhZ0Nvb3JkLncgdG8gZ3Vlc3Mgd2hlbiB3ZSBzaG91bGQgYmxlbmQuCiAgICAgICAgIC8vIEZJWE1FOiBJZiB3ZSB1bmRlcnN0b29kIGZvbnQgcGl4ZWwgZGltZW5zaW9ucywgdGhpcyBjb3VsZCBwcm9iYWJseSBiZSBpbXByb3ZlZC4KICAgICcgICAgZmxvYXQgcmF0aW8gPSAoZ2xfRnJhZ0Nvb3JkLncgPj0gQUxMX1NNT09USCkgPyAxLjAgOiAoZ2xfRnJhZ0Nvb3JkLncgPCBBTExfUk9VR0gpID8gMC4wIDogKGdsX0ZyYWdDb29yZC53IC0gQUxMX1JPVUdIKSAvIChBTExfU01PT1RIIC0gQUxMX1JPVUdIKTsnLAogICAgJyAgICBpZiAoYWxwaGEgPCBhbHBoYVRlc3QpIHsgaWYgKHJhdGlvID49IDEuMCkgeyBkaXNjYXJkOyByZXR1cm47IH0gYWxwaGEgPSAwLjA7IH0nLAogICAgJyAgICBhbHBoYSA9IGFscGhhICogcmF0aW8gKyAoMS4wIC0gcmF0aW8pICogdmFsdWU7JywKICAgICcgICAgaWYgKHJhdGlvIDwgMS4wICYmIGFscGhhIDw9IERJU0NBUkRfQUxQSEEpIHsgZGlzY2FyZDsgcmV0dXJuOyB9JywKICAgICcgICNlbmRpZicsCgogICAgJyAgZ2xfRnJhZ0NvbG9yID0gdmVjNChjb2xvciwgb3BhY2l0eSAqIGFscGhhKTsnLAogICAgJ30nCiAgXS5qb2luKCdcbicpCn0pOwoKfSx7Ii4uL2NvcmUvc2hhZGVyIjoxMTZ9XSwxNjA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJTaGFkZXIgPSBfZGVyZXFfKCcuLi9jb3JlL3NoYWRlcicpLnJlZ2lzdGVyU2hhZGVyOwp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7Cgp2YXIgQ3ViZUxvYWRlciA9IG5ldyBUSFJFRS5DdWJlVGV4dHVyZUxvYWRlcigpOwp2YXIgdGV4dHVyZVByb21pc2VzID0ge307CgovKioKICogU3RhbmRhcmQgKHBoeXNpY2FsbHktYmFzZWQpIHNoYWRlciB1c2luZyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbC4KICovCm1vZHVsZS5leHBvcnRzLlNoYWRlciA9IHJlZ2lzdGVyU2hhZGVyKCdzdGFuZGFyZCcsIHsKICBzY2hlbWE6IHsKICAgIGFtYmllbnRPY2NsdXNpb25NYXA6IHt0eXBlOiAnbWFwJ30sCiAgICBhbWJpZW50T2NjbHVzaW9uTWFwSW50ZW5zaXR5OiB7ZGVmYXVsdDogMX0sCiAgICBhbWJpZW50T2NjbHVzaW9uVGV4dHVyZU9mZnNldDoge3R5cGU6ICd2ZWMyJ30sCiAgICBhbWJpZW50T2NjbHVzaW9uVGV4dHVyZVJlcGVhdDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKCiAgICBjb2xvcjoge3R5cGU6ICdjb2xvcid9LAoKICAgIGRpc3BsYWNlbWVudE1hcDoge3R5cGU6ICdtYXAnfSwKICAgIGRpc3BsYWNlbWVudFNjYWxlOiB7ZGVmYXVsdDogMX0sCiAgICBkaXNwbGFjZW1lbnRCaWFzOiB7ZGVmYXVsdDogMC41fSwKICAgIGRpc3BsYWNlbWVudFRleHR1cmVPZmZzZXQ6IHt0eXBlOiAndmVjMid9LAogICAgZGlzcGxhY2VtZW50VGV4dHVyZVJlcGVhdDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKICAgIGVtaXNzaXZlOiB7dHlwZTogJ2NvbG9yJywgZGVmYXVsdDogJyMwMDAnfSwKICAgIGVtaXNzaXZlSW50ZW5zaXR5OiB7ZGVmYXVsdDogMX0sCiAgICBlbnZNYXA6IHtkZWZhdWx0OiAnJ30sCgogICAgZm9nOiB7ZGVmYXVsdDogdHJ1ZX0sCiAgICBoZWlnaHQ6IHtkZWZhdWx0OiAyNTZ9LAoKICAgIG1ldGFsbmVzczoge2RlZmF1bHQ6IDAuMCwgbWluOiAwLjAsIG1heDogMS4wfSwKICAgIG1ldGFsbmVzc01hcDoge3R5cGU6ICdtYXAnfSwKICAgIG1ldGFsbmVzc1RleHR1cmVPZmZzZXQ6IHt0eXBlOiAndmVjMid9LAogICAgbWV0YWxuZXNzVGV4dHVyZVJlcGVhdDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKCiAgICBub3JtYWxNYXA6IHt0eXBlOiAnbWFwJ30sCiAgICBub3JtYWxTY2FsZToge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKICAgIG5vcm1hbFRleHR1cmVPZmZzZXQ6IHt0eXBlOiAndmVjMid9LAogICAgbm9ybWFsVGV4dHVyZVJlcGVhdDoge3R5cGU6ICd2ZWMyJywgZGVmYXVsdDoge3g6IDEsIHk6IDF9fSwKCiAgICBvZmZzZXQ6IHt0eXBlOiAndmVjMicsIGRlZmF1bHQ6IHt4OiAwLCB5OiAwfX0sCiAgICByZXBlYXQ6IHt0eXBlOiAndmVjMicsIGRlZmF1bHQ6IHt4OiAxLCB5OiAxfX0sCgogICAgcm91Z2huZXNzOiB7ZGVmYXVsdDogMC41LCBtaW46IDAuMCwgbWF4OiAxLjB9LAogICAgcm91Z2huZXNzTWFwOiB7dHlwZTogJ21hcCd9LAogICAgcm91Z2huZXNzVGV4dHVyZU9mZnNldDoge3R5cGU6ICd2ZWMyJ30sCiAgICByb3VnaG5lc3NUZXh0dXJlUmVwZWF0OiB7dHlwZTogJ3ZlYzInLCBkZWZhdWx0OiB7eDogMSwgeTogMX19LAoKICAgIHNwaGVyaWNhbEVudk1hcDoge3R5cGU6ICdtYXAnfSwKICAgIHNyYzoge3R5cGU6ICdtYXAnfSwKICAgIHdpZHRoOiB7ZGVmYXVsdDogNTEyfSwKICAgIHdpcmVmcmFtZToge2RlZmF1bHQ6IGZhbHNlfSwKICAgIHdpcmVmcmFtZUxpbmV3aWR0aDoge2RlZmF1bHQ6IDJ9CiAgfSwKCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgdGhlIHNoYWRlci4KICAgKiBBZGRzIGEgcmVmZXJlbmNlIGZyb20gdGhlIHNjZW5lIHRvIHRoaXMgZW50aXR5IGFzIHRoZSBjYW1lcmEuCiAgICovCiAgaW5pdDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0gPSB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5yZW5kZXJlcjsKICAgIHRoaXMubWF0ZXJpYWxEYXRhID0ge2NvbG9yOiBuZXcgVEhSRUUuQ29sb3IoKSwgZW1pc3NpdmU6IG5ldyBUSFJFRS5Db2xvcigpfTsKICAgIGdldE1hdGVyaWFsRGF0YShkYXRhLCB0aGlzLm1hdGVyaWFsRGF0YSk7CiAgICB0aGlzLnJlbmRlcmVyU3lzdGVtLmFwcGx5Q29sb3JDb3JyZWN0aW9uKHRoaXMubWF0ZXJpYWxEYXRhLmNvbG9yKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24odGhpcy5tYXRlcmlhbERhdGEuZW1pc3NpdmUpOwogICAgdGhpcy5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoU3RhbmRhcmRNYXRlcmlhbCh0aGlzLm1hdGVyaWFsRGF0YSk7CgogICAgdXRpbHMubWF0ZXJpYWwudXBkYXRlTWFwKHRoaXMsIGRhdGEpOwogICAgaWYgKGRhdGEubm9ybWFsTWFwKSB7IHV0aWxzLm1hdGVyaWFsLnVwZGF0ZURpc3RvcnRpb25NYXAoJ25vcm1hbCcsIHRoaXMsIGRhdGEpOyB9CiAgICBpZiAoZGF0YS5kaXNwbGFjZW1lbnRNYXApIHsgdXRpbHMubWF0ZXJpYWwudXBkYXRlRGlzdG9ydGlvbk1hcCgnZGlzcGxhY2VtZW50JywgdGhpcywgZGF0YSk7IH0KICAgIGlmIChkYXRhLmFtYmllbnRPY2NsdXNpb25NYXApIHsgdXRpbHMubWF0ZXJpYWwudXBkYXRlRGlzdG9ydGlvbk1hcCgnYW1iaWVudE9jY2x1c2lvbicsIHRoaXMsIGRhdGEpOyB9CiAgICBpZiAoZGF0YS5tZXRhbG5lc3NNYXApIHsgdXRpbHMubWF0ZXJpYWwudXBkYXRlRGlzdG9ydGlvbk1hcCgnbWV0YWxuZXNzJywgdGhpcywgZGF0YSk7IH0KICAgIGlmIChkYXRhLnJvdWdobmVzc01hcCkgeyB1dGlscy5tYXRlcmlhbC51cGRhdGVEaXN0b3J0aW9uTWFwKCdyb3VnaG5lc3MnLCB0aGlzLCBkYXRhKTsgfQogICAgdGhpcy51cGRhdGVFbnZNYXAoZGF0YSk7CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAoZGF0YSkgewogICAgdGhpcy51cGRhdGVNYXRlcmlhbChkYXRhKTsKICAgIHV0aWxzLm1hdGVyaWFsLnVwZGF0ZU1hcCh0aGlzLCBkYXRhKTsKICAgIGlmIChkYXRhLm5vcm1hbE1hcCkgeyB1dGlscy5tYXRlcmlhbC51cGRhdGVEaXN0b3J0aW9uTWFwKCdub3JtYWwnLCB0aGlzLCBkYXRhKTsgfQogICAgaWYgKGRhdGEuZGlzcGxhY2VtZW50TWFwKSB7IHV0aWxzLm1hdGVyaWFsLnVwZGF0ZURpc3RvcnRpb25NYXAoJ2Rpc3BsYWNlbWVudCcsIHRoaXMsIGRhdGEpOyB9CiAgICBpZiAoZGF0YS5hbWJpZW50T2NjbHVzaW9uTWFwKSB7IHV0aWxzLm1hdGVyaWFsLnVwZGF0ZURpc3RvcnRpb25NYXAoJ2FtYmllbnRPY2NsdXNpb24nLCB0aGlzLCBkYXRhKTsgfQogICAgaWYgKGRhdGEubWV0YWxuZXNzTWFwKSB7IHV0aWxzLm1hdGVyaWFsLnVwZGF0ZURpc3RvcnRpb25NYXAoJ21ldGFsbmVzcycsIHRoaXMsIGRhdGEpOyB9CiAgICBpZiAoZGF0YS5yb3VnaG5lc3NNYXApIHsgdXRpbHMubWF0ZXJpYWwudXBkYXRlRGlzdG9ydGlvbk1hcCgncm91Z2huZXNzJywgdGhpcywgZGF0YSk7IH0KICAgIHRoaXMudXBkYXRlRW52TWFwKGRhdGEpOwogIH0sCgogIC8qKgogICAqIFVwZGF0aW5nIGV4aXN0aW5nIG1hdGVyaWFsLgogICAqCiAgICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBNYXRlcmlhbCBjb21wb25lbnQgZGF0YS4KICAgKiBAcmV0dXJucyB7b2JqZWN0fSBNYXRlcmlhbC4KICAgKi8KICB1cGRhdGVNYXRlcmlhbDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBrZXk7CiAgICB2YXIgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgZ2V0TWF0ZXJpYWxEYXRhKGRhdGEsIHRoaXMubWF0ZXJpYWxEYXRhKTsKICAgIHRoaXMucmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24odGhpcy5tYXRlcmlhbERhdGEuY29sb3IpOwogICAgdGhpcy5yZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbih0aGlzLm1hdGVyaWFsRGF0YS5lbWlzc2l2ZSk7CiAgICBmb3IgKGtleSBpbiB0aGlzLm1hdGVyaWFsRGF0YSkgewogICAgICBtYXRlcmlhbFtrZXldID0gdGhpcy5tYXRlcmlhbERhdGFba2V5XTsKICAgIH0KICB9LAoKICAvKioKICAgKiBIYW5kbGUgZW52aXJvbm1lbnQgY3ViZW1hcC4gVGV4dHVyZXMgYXJlIGNhY2hlZCBpbiB0ZXh0dXJlUHJvbWlzZXMuCiAgICovCiAgdXBkYXRlRW52TWFwOiBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIHZhciBlbnZNYXAgPSBkYXRhLmVudk1hcDsKICAgIHZhciBzcGhlcmljYWxFbnZNYXAgPSBkYXRhLnNwaGVyaWNhbEVudk1hcDsKCiAgICAvLyBObyBlbnZNYXAgZGVmaW5lZCBvciBhbHJlYWR5IGxvYWRpbmcuCiAgICBpZiAoKCFlbnZNYXAgJiYgIXNwaGVyaWNhbEVudk1hcCkgfHwgdGhpcy5pc0xvYWRpbmdFbnZNYXApIHsKICAgICAgbWF0ZXJpYWwuZW52TWFwID0gbnVsbDsKICAgICAgbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmlzTG9hZGluZ0Vudk1hcCA9IHRydWU7CgogICAgLy8gaWYgYSBzcGhlcmljYWwgZW52IG1hcCBpcyBkZWZpbmVkIHRoZW4gdXNlIGl0LgogICAgaWYgKHNwaGVyaWNhbEVudk1hcCkgewogICAgICB0aGlzLmVsLnNjZW5lRWwuc3lzdGVtcy5tYXRlcmlhbC5sb2FkVGV4dHVyZShzcGhlcmljYWxFbnZNYXAsIHtzcmM6IHNwaGVyaWNhbEVudk1hcH0sIGZ1bmN0aW9uIHRleHR1cmVMb2FkZWQgKHRleHR1cmUpIHsKICAgICAgICBzZWxmLmlzTG9hZGluZ0Vudk1hcCA9IGZhbHNlOwogICAgICAgIHRleHR1cmUubWFwcGluZyA9IFRIUkVFLlNwaGVyaWNhbFJlZmxlY3Rpb25NYXBwaW5nOwogICAgICAgIG1hdGVyaWFsLmVudk1hcCA9IHRleHR1cmU7CiAgICAgICAgdXRpbHMubWF0ZXJpYWwuaGFuZGxlVGV4dHVyZUV2ZW50cyhzZWxmLmVsLCB0ZXh0dXJlKTsKICAgICAgICBtYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQW5vdGhlciBtYXRlcmlhbCBpcyBhbHJlYWR5IGxvYWRpbmcgdGhpcyB0ZXh0dXJlLiBXYWl0IG9uIHByb21pc2UuCiAgICBpZiAodGV4dHVyZVByb21pc2VzW2Vudk1hcF0pIHsKICAgICAgdGV4dHVyZVByb21pc2VzW2Vudk1hcF0udGhlbihmdW5jdGlvbiAoY3ViZSkgewogICAgICAgIHNlbGYuaXNMb2FkaW5nRW52TWFwID0gZmFsc2U7CiAgICAgICAgbWF0ZXJpYWwuZW52TWFwID0gY3ViZTsKICAgICAgICB1dGlscy5tYXRlcmlhbC5oYW5kbGVUZXh0dXJlRXZlbnRzKHNlbGYuZWwsIGN1YmUpOwogICAgICAgIG1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBNYXRlcmlhbCBpcyBmaXJzdCB0byBsb2FkIHRoaXMgdGV4dHVyZS4gTG9hZCBhbmQgcmVzb2x2ZSB0ZXh0dXJlLgogICAgdGV4dHVyZVByb21pc2VzW2Vudk1hcF0gPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICB1dGlscy5zcmNMb2FkZXIudmFsaWRhdGVDdWJlbWFwU3JjKGVudk1hcCwgZnVuY3Rpb24gbG9hZEVudk1hcCAodXJscykgewogICAgICAgIEN1YmVMb2FkZXIubG9hZCh1cmxzLCBmdW5jdGlvbiAoY3ViZSkgewogICAgICAgICAgLy8gVGV4dHVyZSBsb2FkZWQuCiAgICAgICAgICBzZWxmLmlzTG9hZGluZ0Vudk1hcCA9IGZhbHNlOwogICAgICAgICAgbWF0ZXJpYWwuZW52TWFwID0gY3ViZTsKICAgICAgICAgIHV0aWxzLm1hdGVyaWFsLmhhbmRsZVRleHR1cmVFdmVudHMoc2VsZi5lbCwgY3ViZSk7CiAgICAgICAgICByZXNvbHZlKGN1YmUpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogIH0KfSk7CgovKioKICogQnVpbGRzIGFuZCBub3JtYWxpemUgbWF0ZXJpYWwgZGF0YSwgbm9ybWFsaXppbmcgc3R1ZmYgYWxvbmcgdGhlIHdheS4KICoKICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBNYXRlcmlhbCBkYXRhLgogKiBAcGFyYW0ge29iamVjdH0gbWF0ZXJpYWxEYXRhIC0gT2JqZWN0IHRvIHVzZS4KICogQHJldHVybnMge29iamVjdH0gVXBkYXRlZCBtYXRlcmlhbERhdGEuCiAqLwpmdW5jdGlvbiBnZXRNYXRlcmlhbERhdGEgKGRhdGEsIG1hdGVyaWFsRGF0YSkgewogIG1hdGVyaWFsRGF0YS5jb2xvci5zZXQoZGF0YS5jb2xvcik7CiAgbWF0ZXJpYWxEYXRhLmVtaXNzaXZlLnNldChkYXRhLmVtaXNzaXZlKTsKICBtYXRlcmlhbERhdGEuZW1pc3NpdmVJbnRlbnNpdHkgPSBkYXRhLmVtaXNzaXZlSW50ZW5zaXR5OwogIG1hdGVyaWFsRGF0YS5mb2cgPSBkYXRhLmZvZzsKICBtYXRlcmlhbERhdGEubWV0YWxuZXNzID0gZGF0YS5tZXRhbG5lc3M7CiAgbWF0ZXJpYWxEYXRhLnJvdWdobmVzcyA9IGRhdGEucm91Z2huZXNzOwogIG1hdGVyaWFsRGF0YS53aXJlZnJhbWUgPSBkYXRhLndpcmVmcmFtZTsKICBtYXRlcmlhbERhdGEud2lyZWZyYW1lTGluZXdpZHRoID0gZGF0YS53aXJlZnJhbWVMaW5ld2lkdGg7CgogIGlmIChkYXRhLm5vcm1hbE1hcCkgeyBtYXRlcmlhbERhdGEubm9ybWFsU2NhbGUgPSBkYXRhLm5vcm1hbFNjYWxlOyB9CgogIGlmIChkYXRhLmFtYmllbnRPY2NsdXNpb25NYXApIHsKICAgIG1hdGVyaWFsRGF0YS5hb01hcEludGVuc2l0eSA9IGRhdGEuYW1iaWVudE9jY2x1c2lvbk1hcEludGVuc2l0eTsKICB9CgogIGlmIChkYXRhLmRpc3BsYWNlbWVudE1hcCkgewogICAgbWF0ZXJpYWxEYXRhLmRpc3BsYWNlbWVudFNjYWxlID0gZGF0YS5kaXNwbGFjZW1lbnRTY2FsZTsKICAgIG1hdGVyaWFsRGF0YS5kaXNwbGFjZW1lbnRCaWFzID0gZGF0YS5kaXNwbGFjZW1lbnRCaWFzOwogIH0KCiAgcmV0dXJuIG1hdGVyaWFsRGF0YTsKfQoKfSx7Ii4uL2NvcmUvc2hhZGVyIjoxMTYsIi4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy8iOjE3OX1dLDE2MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBjc3MgPSAiaHRtbC5hLWZ1bGxzY3JlZW57Ym90dG9tOjA7bGVmdDowO3Bvc2l0aW9uOmZpeGVkO3JpZ2h0OjA7dG9wOjB9aHRtbC5hLWZ1bGxzY3JlZW4gYm9keXtoZWlnaHQ6MTAwJTttYXJnaW46MDtvdmVyZmxvdzpoaWRkZW47cGFkZGluZzowO3dpZHRoOjEwMCV9aHRtbC5hLWZ1bGxzY3JlZW4gLmEtY2FudmFze3dpZHRoOjEwMCUhaW1wb3J0YW50O2hlaWdodDoxMDAlIWltcG9ydGFudDt0b3A6MCFpbXBvcnRhbnQ7bGVmdDowIWltcG9ydGFudDtyaWdodDowIWltcG9ydGFudDtib3R0b206MCFpbXBvcnRhbnQ7cG9zaXRpb246Zml4ZWQhaW1wb3J0YW50fWh0bWw6bm90KC5hLWZ1bGxzY3JlZW4pIC5hLWVudGVyLXZye3JpZ2h0OjVweDtib3R0b206NXB4fTotd2Via2l0LWZ1bGwtc2NyZWVue2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnR9LmEtaGlkZGVue2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnR9LmEtY2FudmFze2hlaWdodDoxMDAlO2xlZnQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDt3aWR0aDoxMDAlfS5hLWNhbnZhcy5hLWdyYWItY3Vyc29yOmhvdmVye2N1cnNvcjpncmFiO2N1cnNvcjotbW96LWdyYWI7Y3Vyc29yOi13ZWJraXQtZ3JhYn1jYW52YXMuYS1jYW52YXMuYS1tb3VzZS1jdXJzb3ItaG92ZXI6aG92ZXJ7Y3Vyc29yOnBvaW50ZXJ9LmEtaW5zcGVjdG9yLWxvYWRlcntiYWNrZ3JvdW5kLWNvbG9yOiNlZDMxNjA7cG9zaXRpb246Zml4ZWQ7bGVmdDozcHg7dG9wOjNweDtwYWRkaW5nOjZweCAxMHB4O2NvbG9yOiNmZmY7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Zm9udC1zaXplOjEycHg7Zm9udC1mYW1pbHk6Um9ib3RvLHNhbnMtc2VyaWY7dGV4dC1hbGlnbjpjZW50ZXI7ei1pbmRleDo5OTk5OTt3aWR0aDoyMDRweH1Aa2V5ZnJhbWVzIGRvdHMtMXtmcm9te29wYWNpdHk6MH0yNSV7b3BhY2l0eToxfX1Aa2V5ZnJhbWVzIGRvdHMtMntmcm9te29wYWNpdHk6MH01MCV7b3BhY2l0eToxfX1Aa2V5ZnJhbWVzIGRvdHMtM3tmcm9te29wYWNpdHk6MH03NSV7b3BhY2l0eToxfX1ALXdlYmtpdC1rZXlmcmFtZXMgZG90cy0xe2Zyb217b3BhY2l0eTowfTI1JXtvcGFjaXR5OjF9fUAtd2Via2l0LWtleWZyYW1lcyBkb3RzLTJ7ZnJvbXtvcGFjaXR5OjB9NTAle29wYWNpdHk6MX19QC13ZWJraXQta2V5ZnJhbWVzIGRvdHMtM3tmcm9te29wYWNpdHk6MH03NSV7b3BhY2l0eToxfX0uYS1pbnNwZWN0b3ItbG9hZGVyIC5kb3RzIHNwYW57YW5pbWF0aW9uOmRvdHMtMSAycyBpbmZpbml0ZSBzdGVwcygxKTstd2Via2l0LWFuaW1hdGlvbjpkb3RzLTEgMnMgaW5maW5pdGUgc3RlcHMoMSl9LmEtaW5zcGVjdG9yLWxvYWRlciAuZG90cyBzcGFuOmZpcnN0LWNoaWxkK3NwYW57YW5pbWF0aW9uLW5hbWU6ZG90cy0yOy13ZWJraXQtYW5pbWF0aW9uLW5hbWU6ZG90cy0yfS5hLWluc3BlY3Rvci1sb2FkZXIgLmRvdHMgc3BhbjpmaXJzdC1jaGlsZCtzcGFuK3NwYW57YW5pbWF0aW9uLW5hbWU6ZG90cy0zOy13ZWJraXQtYW5pbWF0aW9uLW5hbWU6ZG90cy0zfWEtc2NlbmV7ZGlzcGxheTpibG9jaztwb3NpdGlvbjpyZWxhdGl2ZTtoZWlnaHQ6MTAwJTt3aWR0aDoxMDAlfWEtYXNzZXRzLGEtc2NlbmUgYXVkaW8sYS1zY2VuZSBpbWcsYS1zY2VuZSB2aWRlb3tkaXNwbGF5Om5vbmV9LmEtZW50ZXItdnItbW9kYWwsLmEtb3JpZW50YXRpb24tbW9kYWx7Zm9udC1mYW1pbHk6Q29uc29sYXMsQW5kYWxlIE1vbm8sQ291cmllciBOZXcsbW9ub3NwYWNlfS5hLWVudGVyLXZyLW1vZGFsIGF7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2ZmZjtwYWRkaW5nOjJweCAwO3RleHQtZGVjb3JhdGlvbjpub25lO3RyYW5zaXRpb246LjFzIGNvbG9yIGVhc2UtaW59LmEtZW50ZXItdnItbW9kYWwgYTpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7Y29sb3I6IzExMTtwYWRkaW5nOjJweCA0cHg7cG9zaXRpb246cmVsYXRpdmU7bGVmdDotNHB4fS5hLWVudGVyLXZye2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWYsbW9ub3NwYWNlO2ZvbnQtc2l6ZToxM3B4O3dpZHRoOjEwMCU7Zm9udC13ZWlnaHQ6MjAwO2xpbmUtaGVpZ2h0OjE2cHg7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MjBweDtib3R0b206MjBweH0uYS1lbnRlci12ci1idXR0b24sLmEtZW50ZXItdnItbW9kYWwsLmEtZW50ZXItdnItbW9kYWwgYXtjb2xvcjojZmZmfS5hLWVudGVyLXZyLWJ1dHRvbntiYWNrZ3JvdW5kOnVybChkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnJTIweG1sbnMlM0QlMjJodHRwJTNBJTJGJTJGd3d3LnczLm9yZyUyRjIwMDAlMkZzdmclMjIlMjB2aWV3Qm94JTNEJTIyMCUyMDAlMjAyNDUuODIlMjAxNDEuNzMlMjIlM0UlM0NkZWZzJTNFJTNDc3R5bGUlM0UuYSU3QmZpbGwlM0ElMjNmZmYlM0JmaWxsLXJ1bGUlM0FldmVub2RkJTNCJTdEJTNDJTJGc3R5bGUlM0UlM0MlMkZkZWZzJTNFJTNDdGl0bGUlM0VtYXNrJTNDJTJGdGl0bGUlM0UlM0NwYXRoJTIwY2xhc3MlM0QlMjJhJTIyJTIwZCUzRCUyMk0xNzUuNTYlMkMxMTEuMzdjLTIyLjUyJTJDMC00MC43Ny0xOC44NC00MC43Ny00Mi4wN1MxNTMlMkMyNy4yNCUyQzE3NS41NiUyQzI3LjI0czQwLjc3JTJDMTguODQlMkM0MC43NyUyQzQyLjA3UzE5OC4wOCUyQzExMS4zNyUyQzE3NS41NiUyQzExMS4zN1pNMjYuODQlMkM2OS4zMWMwLTIzLjIzJTJDMTguMjUtNDIuMDclMkM0MC43Ny00Mi4wN3M0MC43NyUyQzE4Ljg0JTJDNDAuNzclMkM0Mi4wNy0xOC4yNiUyQzQyLjA3LTQwLjc3JTJDNDIuMDdTMjYuODQlMkM5Mi41NCUyQzI2Ljg0JTJDNjkuMzFaTTI3LjI3JTJDMEMxMS41NCUyQzAlMkMwJTJDMTIuMzQlMkMwJTJDMjguNThWMTEwLjljMCUyQzE2LjI0JTJDMTEuNTQlMkMzMC44MyUyQzI3LjI3JTJDMzAuODNIOTkuNTdjMi4xNyUyQzAlMkM0LjE5LTEuODMlMkM1LjQtMy43TDExNi40NyUyQzExOGE4JTJDOCUyQzAlMkMwJTJDMSUyQzEyLjUyLS4xOGwxMS41MSUyQzIwLjM0YzEuMiUyQzEuODYlMkMzLjIyJTJDMy42MSUyQzUuMzklMkMzLjYxaDcyLjI5YzE1Ljc0JTJDMCUyQzI3LjYzLTE0LjYlMkMyNy42My0zMC44M1YyOC41OEMyNDUuODIlMkMxMi4zNCUyQzIzMy45MyUyQzAlMkMyMTguMTklMkMwSDI3LjI3WiUyMiUyRiUzRSUzQyUyRnN2ZyUzRSkgNTAlIDUwJS83MCUgNzAlIG5vLXJlcGVhdCByZ2JhKDAsMCwwLC4zNSk7Ym9yZGVyOjA7Ym90dG9tOjA7Y3Vyc29yOnBvaW50ZXI7bWluLXdpZHRoOjUwcHg7bWluLWhlaWdodDozMHB4O3BhZGRpbmctcmlnaHQ6NSU7cGFkZGluZy10b3A6NCU7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgLjA1cyBlYXNlOy13ZWJraXQtdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIC4wNXMgZWFzZTt6LWluZGV4Ojk5OTl9LmEtZW50ZXItdnItYnV0dG9uOmFjdGl2ZSwuYS1lbnRlci12ci1idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojNjY2fVtkYXRhLWEtZW50ZXItdnItbm8td2VidnJdIC5hLWVudGVyLXZyLWJ1dHRvbntib3JkZXItY29sb3I6IzY2NjtvcGFjaXR5Oi42NX1bZGF0YS1hLWVudGVyLXZyLW5vLXdlYnZyXSAuYS1lbnRlci12ci1idXR0b246YWN0aXZlLFtkYXRhLWEtZW50ZXItdnItbm8td2VidnJdIC5hLWVudGVyLXZyLWJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMCwwLDAsLjM1KTtjdXJzb3I6bm90LWFsbG93ZWR9LmEtZW50ZXItdnItbW9kYWx7YmFja2dyb3VuZC1jb2xvcjojNjY2O2JvcmRlci1yYWRpdXM6MDtkaXNwbGF5Om5vbmU7bWluLWhlaWdodDozMnB4O21hcmdpbi1yaWdodDo3MHB4O3BhZGRpbmc6OXB4O3dpZHRoOjI4MHB4O3JpZ2h0OjIlO3Bvc2l0aW9uOmFic29sdXRlfS5hLWVudGVyLXZyLW1vZGFsOmFmdGVye2JvcmRlci1ib3R0b206MTBweCBzb2xpZCB0cmFuc3BhcmVudDtib3JkZXItbGVmdDoxMHB4IHNvbGlkICM2NjY7Ym9yZGVyLXRvcDoxMHB4IHNvbGlkIHRyYW5zcGFyZW50O2Rpc3BsYXk6aW5saW5lLWJsb2NrO2NvbnRlbnQ6Jyc7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6LTVweDt0b3A6NXB4O3dpZHRoOjA7aGVpZ2h0OjB9LmEtZW50ZXItdnItbW9kYWwgYSwuYS1lbnRlci12ci1tb2RhbCBwe2Rpc3BsYXk6aW5saW5lfS5hLWVudGVyLXZyLW1vZGFsIHB7bWFyZ2luOjB9LmEtZW50ZXItdnItbW9kYWwgcDphZnRlcntjb250ZW50OicgJ31bZGF0YS1hLWVudGVyLXZyLW5vLWhlYWRzZXRdLmEtZW50ZXItdnI6aG92ZXIgLmEtZW50ZXItdnItbW9kYWwsW2RhdGEtYS1lbnRlci12ci1uby13ZWJ2cl0uYS1lbnRlci12cjpob3ZlciAuYS1lbnRlci12ci1tb2RhbHtkaXNwbGF5OmJsb2NrfS5hLW9yaWVudGF0aW9uLW1vZGFse2JhY2tncm91bmQ6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB4bWxucyUzRCUyMmh0dHAlM0EvL3d3dy53My5vcmcvMjAwMC9zdmclMjIlMjB4bWxucyUzQXhsaW5rJTNEJTIyaHR0cCUzQS8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJTIyJTIwdmVyc2lvbiUzRCUyMjEuMSUyMiUyMHglM0QlMjIwcHglMjIlMjB5JTNEJTIyMHB4JTIyJTIwdmlld0JveCUzRCUyMjAlMjAwJTIwOTAlMjA5MCUyMiUyMGVuYWJsZS1iYWNrZ3JvdW5kJTNEJTIybmV3JTIwMCUyMDAlMjA5MCUyMDkwJTIyJTIweG1sJTNBc3BhY2UlM0QlMjJwcmVzZXJ2ZSUyMiUzRSUzQ3BvbHlnb24lMjBwb2ludHMlM0QlMjIwJTJDMCUyMDAlMkMwJTIwMCUyQzAlMjAlMjIlM0UlM0MvcG9seWdvbiUzRSUzQ2clM0UlM0NwYXRoJTIwZCUzRCUyMk03MS41NDUlMkM0OC4xNDVoLTMxLjk4VjIwLjc0M2MwLTIuNjI3LTIuMTM4LTQuNzY1LTQuNzY1LTQuNzY1SDE4LjQ1NmMtMi42MjglMkMwLTQuNzY3JTJDMi4xMzgtNC43NjclMkM0Ljc2NXY0Mi43ODklMjAlMjAlMjBjMCUyQzIuNjI4JTJDMi4xMzglMkM0Ljc2NiUyQzQuNzY3JTJDNC43NjZoNS41MzV2MC45NTljMCUyQzIuNjI4JTJDMi4xMzglMkM0Ljc2NSUyQzQuNzY2JTJDNC43NjVoNDIuNzg4YzIuNjI4JTJDMCUyQzQuNzY2LTIuMTM3JTJDNC43NjYtNC43NjVWNTIuOTE0JTIwJTIwJTIwQzc2LjMxMSUyQzUwLjI4NCUyQzc0LjE3MyUyQzQ4LjE0NSUyQzcxLjU0NSUyQzQ4LjE0NXolMjBNMTguNDU1JTJDMTYuOTM1aDE2LjM0NGMyLjElMkMwJTJDMy44MDglMkMxLjcwOCUyQzMuODA4JTJDMy44MDh2MjcuNDAxSDM3LjI1VjIyLjYzNiUyMCUyMCUyMGMwLTAuMjY0LTAuMjE1LTAuNDc4LTAuNDc5LTAuNDc4SDE2LjQ4MmMtMC4yNjQlMkMwLTAuNDc5JTJDMC4yMTQtMC40NzklMkMwLjQ3OHYzNi41ODVjMCUyQzAuMjY0JTJDMC4yMTUlMkMwLjQ3OCUyQzAuNDc5JTJDMC40NzhoNy41MDd2Ny42NDQlMjAlMjAlMjBoLTUuNTM0Yy0yLjEwMSUyQzAtMy44MS0xLjcwOS0zLjgxLTMuODFWMjAuNzQzQzE0LjY0NSUyQzE4LjY0MyUyQzE2LjM1NCUyQzE2LjkzNSUyQzE4LjQ1NSUyQzE2LjkzNXolMjBNMTYuOTYlMkMyMy4xMTZoMTkuMzMxdjI1LjAzMWgtNy41MzUlMjAlMjAlMjBjLTIuNjI4JTJDMC00Ljc2NiUyQzIuMTM5LTQuNzY2JTJDNC43Njh2NS44MjhoLTcuMDNWMjMuMTE2eiUyME03MS41NDUlMkM3My4wNjRIMjguNzU3Yy0yLjEwMSUyQzAtMy44MS0xLjcwOC0zLjgxLTMuODA4VjUyLjkxNCUyMCUyMCUyMGMwLTIuMTAyJTJDMS43MDktMy44MTIlMkMzLjgxLTMuODEyaDQyLjc4OGMyLjElMkMwJTJDMy44MDklMkMxLjcxJTJDMy44MDklMkMzLjgxMnYxNi4zNDNDNzUuMzU0JTJDNzEuMzU2JTJDNzMuNjQ1JTJDNzMuMDY0JTJDNzEuNTQ1JTJDNzMuMDY0eiUyMiUzRSUzQy9wYXRoJTNFJTNDcGF0aCUyMGQlM0QlMjJNMjguOTE5JTJDNTguNDI0Yy0xLjQ2NiUyQzAtMi42NTklMkMxLjE5My0yLjY1OSUyQzIuNjZjMCUyQzEuNDY2JTJDMS4xOTMlMkMyLjY1OCUyQzIuNjU5JTJDMi42NThjMS40NjglMkMwJTJDMi42NjItMS4xOTIlMkMyLjY2Mi0yLjY1OCUyMCUyMCUyMEMzMS41ODElMkM1OS42MTclMkMzMC4zODclMkM1OC40MjQlMkMyOC45MTklMkM1OC40MjR6JTIwTTI4LjkxOSUyQzYyLjc4NmMtMC45MzklMkMwLTEuNzAzLTAuNzY0LTEuNzAzLTEuNzAyYzAtMC45MzklMkMwLjc2NC0xLjcwNCUyQzEuNzAzLTEuNzA0JTIwJTIwJTIwYzAuOTQlMkMwJTJDMS43MDUlMkMwLjc2NSUyQzEuNzA1JTJDMS43MDRDMzAuNjIzJTJDNjIuMDIyJTJDMjkuODU4JTJDNjIuNzg2JTJDMjguOTE5JTJDNjIuNzg2eiUyMiUzRSUzQy9wYXRoJTNFJTNDcGF0aCUyMGQlM0QlMjJNNjkuNjU0JTJDNTAuNDYxSDMzLjA2OWMtMC4yNjQlMkMwLTAuNDc5JTJDMC4yMTUtMC40NzklMkMwLjQ3OXYyMC4yODhjMCUyQzAuMjY0JTJDMC4yMTUlMkMwLjQ3OCUyQzAuNDc5JTJDMC40NzhoMzYuNTg1JTIwJTIwJTIwYzAuMjYzJTJDMCUyQzAuNDc3LTAuMjE0JTJDMC40NzctMC40NzhWNTAuOTM5QzcwLjEzMSUyQzUwLjY3NiUyQzY5LjkxNyUyQzUwLjQ2MSUyQzY5LjY1NCUyQzUwLjQ2MXolMjBNNjkuMTc0JTJDNTEuNDE3VjcwLjc1SDMzLjU0OFY1MS40MTdINjkuMTc0eiUyMiUzRSUzQy9wYXRoJTNFJTNDcGF0aCUyMGQlM0QlMjJNNDUuMjAxJTJDMzAuMjk2YzYuNjUxJTJDMCUyQzEyLjIzMyUyQzUuMzUxJTJDMTIuNTUxJTJDMTEuOTc3bC0zLjAzMy0yLjYzOGMtMC4xOTMtMC4xNjUtMC41MDctMC4xNDItMC42NzUlMkMwLjA0OCUyMCUyMCUyMGMtMC4xNzQlMkMwLjE5OC0wLjE1MyUyQzAuNTAxJTJDMC4wNDUlMkMwLjY3NmwzLjg4MyUyQzMuMzc1YzAuMDklMkMwLjA3NSUyQzAuMTk4JTJDMC4xMTUlMkMwLjMxMiUyQzAuMTE1YzAuMTQxJTJDMCUyQzAuMjczLTAuMDYxJTJDMC4zNjItMC4xNjYlMjAlMjAlMjBsMy4zNzEtMy44NzdjMC4xNzMtMC4yJTJDMC4xNTEtMC41MDItMC4wNDctMC42NzVjLTAuMTk0LTAuMTY2LTAuNTA4LTAuMTQ0LTAuNjc2JTJDMC4wNDhsLTIuNTkyJTJDMi45NzklMjAlMjAlMjBjLTAuMTgtMy40MTctMS42MjktNi42MDUtNC4wOTktOS4wMDFjLTIuNTM4LTIuNDYxLTUuODc3LTMuODE3LTkuNDA0LTMuODE3Yy0wLjI2NCUyQzAtMC40NzklMkMwLjIxNS0wLjQ3OSUyQzAuNDc5JTIwJTIwJTIwQzQ0LjcyJTJDMzAuMDgzJTJDNDQuOTM2JTJDMzAuMjk2JTJDNDUuMjAxJTJDMzAuMjk2eiUyMiUzRSUzQy9wYXRoJTNFJTNDL2clM0UlM0Mvc3ZnJTNFKSBjZW50ZXIvNTAlIDUwJSBuby1yZXBlYXQgcmdiYSgyNDQsMjQ0LDI0NCwxKTtib3R0b206MDtmb250LXNpemU6MTRweDtmb250LXdlaWdodDo2MDA7bGVmdDowO2xpbmUtaGVpZ2h0OjIwcHg7cmlnaHQ6MDtwb3NpdGlvbjpmaXhlZDt0b3A6MDt6LWluZGV4Ojk5OTk5OTl9LmEtb3JpZW50YXRpb24tbW9kYWw6YWZ0ZXJ7Y29sb3I6IzY2Njtjb250ZW50OlwiSW5zZXJ0IHBob25lIGludG8gQ2FyZGJvYXJkIGhvbGRlci5cIjtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3RleHQtYWxpZ246Y2VudGVyO3RvcDo3MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoLTcwJSk7d2lkdGg6MTAwJX0uYS1vcmllbnRhdGlvbi1tb2RhbCBidXR0b257YmFja2dyb3VuZDp1cmwoZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyUyMHhtbG5zJTNEJTIyaHR0cCUzQS8vd3d3LnczLm9yZy8yMDAwL3N2ZyUyMiUyMHhtbG5zJTNBeGxpbmslM0QlMjJodHRwJTNBLy93d3cudzMub3JnLzE5OTkveGxpbmslMjIlMjB2ZXJzaW9uJTNEJTIyMS4xJTIyJTIweCUzRCUyMjBweCUyMiUyMHklM0QlMjIwcHglMjIlMjB2aWV3Qm94JTNEJTIyMCUyMDAlMjAxMDAlMjAxMDAlMjIlMjBlbmFibGUtYmFja2dyb3VuZCUzRCUyMm5ldyUyMDAlMjAwJTIwMTAwJTIwMTAwJTIyJTIweG1sJTNBc3BhY2UlM0QlMjJwcmVzZXJ2ZSUyMiUzRSUzQ3BhdGglMjBmaWxsJTNEJTIyJTIzMDAwMDAwJTIyJTIwZCUzRCUyMk01NS4yMDklMkM1MGwxNy44MDMtMTcuODAzYzEuNDE2LTEuNDE2JTJDMS40MTYtMy43MTMlMkMwLTUuMTI5Yy0xLjQxNi0xLjQxNy0zLjcxMy0xLjQxNy01LjEyOSUyQzBMNTAuMDglMkM0NC44NzIlMjAlMjBMMzIuMjc4JTJDMjcuMDY5Yy0xLjQxNi0xLjQxNy0zLjcxNC0xLjQxNy01LjEyOSUyQzBjLTEuNDE3JTJDMS40MTYtMS40MTclMkMzLjcxMyUyQzAlMkM1LjEyOUw0NC45NTElMkM1MEwyNy4xNDklMkM2Ny44MDMlMjAlMjBjLTEuNDE3JTJDMS40MTYtMS40MTclMkMzLjcxMyUyQzAlMkM1LjEyOWMwLjcwOCUyQzAuNzA4JTJDMS42MzYlMkMxLjA2MiUyQzIuNTY0JTJDMS4wNjJjMC45MjglMkMwJTJDMS44NTYtMC4zNTQlMkMyLjU2NC0xLjA2Mkw1MC4wOCUyQzU1LjEzbDE3LjgwMyUyQzE3LjgwMiUyMCUyMGMwLjcwOCUyQzAuNzA4JTJDMS42MzclMkMxLjA2MiUyQzIuNTY0JTJDMS4wNjJzMS44NTYtMC4zNTQlMkMyLjU2NC0xLjA2MmMxLjQxNi0xLjQxNiUyQzEuNDE2LTMuNzEzJTJDMC01LjEyOUw1NS4yMDklMkM1MHolMjIlM0UlM0MvcGF0aCUzRSUzQy9zdmclM0UpIG5vLXJlcGVhdDtib3JkZXI6bm9uZTtoZWlnaHQ6NTBweDt0ZXh0LWluZGVudDotOTk5OXB4O3dpZHRoOjUwcHh9LmEtbG9hZGVyLXRpdGxle2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuNik7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZixtb25vc3BhY2U7dGV4dC1hbGlnbjpjZW50ZXI7Zm9udC1zaXplOjIwcHg7aGVpZ2h0OjUwcHg7Zm9udC13ZWlnaHQ6MzAwO2xpbmUtaGVpZ2h0OjUwcHg7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MDtsZWZ0OjA7dG9wOjA7Y29sb3I6I2ZmZn0iOyAoX2RlcmVxXygiYnJvd3NlcmlmeS1jc3MiKS5jcmVhdGVTdHlsZShjc3MsIHsgImhyZWYiOiAic3JjL3N0eWxlL2FmcmFtZS5jc3MifSkpOyBtb2R1bGUuZXhwb3J0cyA9IGNzczsKfSx7ImJyb3dzZXJpZnktY3NzIjo0fV0sMTYyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGNzcyA9ICIucnMtYmFzZXtiYWNrZ3JvdW5kLWNvbG9yOiMzMzM7Y29sb3I6I2ZhZmFmYTtib3JkZXItcmFkaXVzOjA7Zm9udDoxMHB4IG1vbm9zcGFjZTtsZWZ0OjVweDtsaW5lLWhlaWdodDoxZW07b3BhY2l0eTouODU7b3ZlcmZsb3c6aGlkZGVuO3BhZGRpbmc6MTBweDtwb3NpdGlvbjpmaXhlZDt0b3A6NXB4O3dpZHRoOjMwMHB4O3otaW5kZXg6MTAwMDB9LnJzLWJhc2UgZGl2LmhpZGRlbntkaXNwbGF5Om5vbmV9LnJzLWJhc2UgaDF7Y29sb3I6I2ZmZjtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6MS40ZW07Zm9udC13ZWlnaHQ6MzAwO21hcmdpbjowIDAgNXB4O3BhZGRpbmc6MH0ucnMtZ3JvdXB7ZGlzcGxheTotd2Via2l0LWJveDtkaXNwbGF5Oi13ZWJraXQtZmxleDtkaXNwbGF5OmZsZXg7LXdlYmtpdC1mbGV4LWRpcmVjdGlvbjpjb2x1bW4tcmV2ZXJzZTtmbGV4LWRpcmVjdGlvbjpjb2x1bW4tcmV2ZXJzZTttYXJnaW4tYm90dG9tOjVweH0ucnMtZ3JvdXA6bGFzdC1jaGlsZHttYXJnaW4tYm90dG9tOjB9LnJzLWNvdW50ZXItYmFzZXthbGlnbi1pdGVtczpjZW50ZXI7ZGlzcGxheTotd2Via2l0LWJveDtkaXNwbGF5Oi13ZWJraXQtZmxleDtkaXNwbGF5OmZsZXg7aGVpZ2h0OjEwcHg7LXdlYmtpdC1qdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjttYXJnaW46MnB4IDB9LnJzLWNvdW50ZXItYmFzZS5hbGFybXtjb2xvcjojYjcwMDAwO3RleHQtc2hhZG93OjAgMCAwICNiNzAwMDAsMCAwIDFweCAjZmZmLDAgMCAxcHggI2ZmZiwwIDAgMnB4ICNmZmYsMCAwIDJweCAjZmZmLDAgMCAzcHggI2ZmZiwwIDAgM3B4ICNmZmYsMCAwIDRweCAjZmZmLDAgMCA0cHggI2ZmZn0ucnMtY291bnRlci1pZHtmb250LXdlaWdodDozMDA7LXdlYmtpdC1ib3gtb3JkaW5hbC1ncm91cDowOy13ZWJraXQtb3JkZXI6MDtvcmRlcjowO3dpZHRoOjU0cHh9LnJzLWNvdW50ZXItdmFsdWV7Zm9udC13ZWlnaHQ6MzAwOy13ZWJraXQtYm94LW9yZGluYWwtZ3JvdXA6MTstd2Via2l0LW9yZGVyOjE7b3JkZXI6MTt0ZXh0LWFsaWduOnJpZ2h0O3dpZHRoOjM1cHh9LnJzLWNhbnZhc3std2Via2l0LWJveC1vcmRpbmFsLWdyb3VwOjI7LXdlYmtpdC1vcmRlcjoyO29yZGVyOjJ9QG1lZGlhIChtaW4td2lkdGg6NDgwcHgpey5ycy1iYXNle2xlZnQ6MjBweDt0b3A6MjBweH19IjsgKF9kZXJlcV8oImJyb3dzZXJpZnktY3NzIikuY3JlYXRlU3R5bGUoY3NzLCB7ICJocmVmIjogInNyYy9zdHlsZS9yU3RhdHMuY3NzIn0pKTsgbW9kdWxlLmV4cG9ydHMgPSBjc3M7Cn0seyJicm93c2VyaWZ5LWNzcyI6NH1dLDE2MzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBjb25zdGFudHMgPSBfZGVyZXFfKCcuLi9jb25zdGFudHMvJyk7CnZhciByZWdpc3RlclN5c3RlbSA9IF9kZXJlcV8oJy4uL2NvcmUvc3lzdGVtJykucmVnaXN0ZXJTeXN0ZW07Cgp2YXIgREVGQVVMVF9DQU1FUkFfQVRUUiA9ICdkYXRhLWFmcmFtZS1kZWZhdWx0LWNhbWVyYSc7CgovKioKICogQ2FtZXJhIHN5c3RlbS4gTWFuYWdlcyB3aGljaCBjYW1lcmEgaXMgYWN0aXZlIGFtb25nIG11bHRpcGxlIGNhbWVyYXMgaW4gc2NlbmUuCiAqCiAqIEBtZW1iZXIge29iamVjdH0gYWN0aXZlQ2FtZXJhRWwgLSBBY3RpdmUgY2FtZXJhIGVudGl0eS4KICovCm1vZHVsZS5leHBvcnRzLlN5c3RlbSA9IHJlZ2lzdGVyU3lzdGVtKCdjYW1lcmEnLCB7CiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5hY3RpdmVDYW1lcmFFbCA9IG51bGw7CgogICAgdGhpcy5yZW5kZXIgPSB0aGlzLnJlbmRlci5iaW5kKHRoaXMpOwogICAgdGhpcy51bndyYXBSZW5kZXIgPSB0aGlzLnVud3JhcFJlbmRlci5iaW5kKHRoaXMpOwogICAgdGhpcy53cmFwUmVuZGVyID0gdGhpcy53cmFwUmVuZGVyLmJpbmQodGhpcyk7CgogICAgdGhpcy5pbml0aWFsQ2FtZXJhRm91bmQgPSBmYWxzZTsKICAgIHRoaXMubnVtVXNlckNhbWVyYXMgPSAwOwogICAgdGhpcy5udW1Vc2VyQ2FtZXJhc0NoZWNrZWQgPSAwOwogICAgdGhpcy5zZXR1cEluaXRpYWxDYW1lcmEoKTsKICB9LAoKICAvKioKICAgKiBTZXR1cCBpbml0aWFsIGNhbWVyYSwgZWl0aGVyIHNlYXJjaGluZyBmb3IgY2FtZXJhIG9yCiAgICogY3JlYXRpbmcgYSBkZWZhdWx0IGNhbWVyYSBpZiB1c2VyIGhhcyBub3QgYWRkZWQgb25lIGR1cmluZyB0aGUgaW5pdGlhbCBzY2VuZSB0cmF2ZXJzYWwuCiAgICogV2Ugd2FudCBzY2VuZUVsLmNhbWVyYSB0byBiZSByZWFkeSwgc2V0LCBhbmQgaW5pdGlhbGl6ZWQgYmVmb3JlIHRoZSByZXN0IG9mIHRoZSBzY2VuZQogICAqIGxvYWRzLgogICAqCiAgICogRGVmYXVsdCBjYW1lcmEgb2Zmc2V0IGhlaWdodCBpcyBhdCBhdmVyYWdlIGV5ZSBsZXZlbCAofjEuNm0pLgogICAqLwogIHNldHVwSW5pdGlhbENhbWVyYTogZnVuY3Rpb24gKCkgewogICAgdmFyIGNhbWVyYUVsczsKICAgIHZhciBpOwogICAgdmFyIHNjZW5lRWwgPSB0aGlzLnNjZW5lRWw7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgLy8gQ2FtZXJhIGFscmVhZHkgZGVmaW5lZCBvciB0aGUgb25lIGRlZmluZWQgaXQgaXMgYW4gc3BlY3RhdG9yIG9uZS4KICAgIGlmIChzY2VuZUVsLmNhbWVyYSAmJiAhc2NlbmVFbC5jYW1lcmEuZWwuZ2V0QXR0cmlidXRlKCdjYW1lcmEnKS5zcGVjdGF0b3IpIHsKICAgICAgc2NlbmVFbC5lbWl0KCdjYW1lcmFyZWFkeScsIHtjYW1lcmFFbDogc2NlbmVFbC5jYW1lcmEuZWx9KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFNlYXJjaCBmb3IgaW5pdGlhbCB1c2VyLWRlZmluZWQgY2FtZXJhLgogICAgY2FtZXJhRWxzID0gc2NlbmVFbC5xdWVyeVNlbGVjdG9yQWxsKCdhLWNhbWVyYSwgW2NhbWVyYV0nKTsKCiAgICAvLyBObyB1c2VyIGNhbWVyYXMsIGNyZWF0ZSBkZWZhdWx0IG9uZS4KICAgIGlmICghY2FtZXJhRWxzLmxlbmd0aCkgewogICAgICB0aGlzLmNyZWF0ZURlZmF1bHRDYW1lcmEoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMubnVtVXNlckNhbWVyYXMgPSBjYW1lcmFFbHMubGVuZ3RoOwogICAgZm9yIChpID0gMDsgaSA8IGNhbWVyYUVscy5sZW5ndGg7IGkrKykgewogICAgICBjYW1lcmFFbHNbaV0uYWRkRXZlbnRMaXN0ZW5lcignb2JqZWN0M2RzZXQnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgaWYgKGV2dC5kZXRhaWwudHlwZSAhPT0gJ2NhbWVyYScpIHsgcmV0dXJuOyB9CiAgICAgICAgc2VsZi5jaGVja1VzZXJDYW1lcmEodGhpcyk7CiAgICAgIH0pOwoKICAgICAgLy8gTG9hZCBjYW1lcmEgYW5kIHdhaXQgZm9yIGNhbWVyYSB0byBpbml0aWFsaXplLgogICAgICBpZiAoY2FtZXJhRWxzW2ldLmlzTm9kZSkgewogICAgICAgIGNhbWVyYUVsc1tpXS5sb2FkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FtZXJhRWxzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ25vZGVyZWFkeScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMubG9hZCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwKCiAgLyoqCiAgICogQ2hlY2sgaWYgYSB1c2VyLWRlZmluZWQgY2FtZXJhIGVudGl0eSBpcyBhcHByb3ByaWF0ZSB0byBiZSBpbml0aWFsIGNhbWVyYS4KICAgKiAoYWN0aXZlICsgbm9uLXNwZWN0YXRvcikuCiAgICoKICAgKiBLZWVwIHRyYWNrIG9mIHRoZSBudW1iZXIgb2YgY2FtZXJhcyB3ZSBjaGVja2VkIGFuZCB3aGV0aGVyIHdlIGZvdW5kIG9uZS4KICAgKi8KICBjaGVja1VzZXJDYW1lcmE6IGZ1bmN0aW9uIChjYW1lcmFFbCkgewogICAgdmFyIGNhbWVyYURhdGE7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuZWwuc2NlbmVFbDsKICAgIHRoaXMubnVtVXNlckNhbWVyYXNDaGVja2VkKys7CgogICAgLy8gQWxyZWFkeSBmb3VuZCBvbmUuCiAgICBpZiAodGhpcy5pbml0aWFsQ2FtZXJhRm91bmQpIHsgcmV0dXJuOyB9CgogICAgLy8gQ2hlY2sgaWYgY2FtZXJhIGlzIGFwcHJvcHJpYXRlIGZvciBiZWluZyB0aGUgaW5pdGlhbCBjYW1lcmEuCiAgICBjYW1lcmFEYXRhID0gY2FtZXJhRWwuZ2V0QXR0cmlidXRlKCdjYW1lcmEnKTsKICAgIGlmICghY2FtZXJhRGF0YS5hY3RpdmUgfHwgY2FtZXJhRGF0YS5zcGVjdGF0b3IpIHsKICAgICAgLy8gTm8gdXNlciBjYW1lcmFzIGVsaWdpYmxlLCBjcmVhdGUgZGVmYXVsdCBjYW1lcmEuCiAgICAgIGlmICh0aGlzLm51bVVzZXJDYW1lcmFzQ2hlY2tlZCA9PT0gdGhpcy5udW1Vc2VyQ2FtZXJhcykgewogICAgICAgIHRoaXMuY3JlYXRlRGVmYXVsdENhbWVyYSgpOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLmluaXRpYWxDYW1lcmFGb3VuZCA9IHRydWU7CiAgICBzY2VuZUVsLmNhbWVyYSA9IGNhbWVyYUVsLmdldE9iamVjdDNEKCdjYW1lcmEnKTsKICAgIHNjZW5lRWwuZW1pdCgnY2FtZXJhcmVhZHknLCB7Y2FtZXJhRWw6IGNhbWVyYUVsfSk7CiAgfSwKCiAgY3JlYXRlRGVmYXVsdENhbWVyYTogZnVuY3Rpb24gKCkgewogICAgdmFyIGRlZmF1bHRDYW1lcmFFbDsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5zY2VuZUVsOwoKICAgIC8vIFNldCB1cCBkZWZhdWx0IGNhbWVyYS4KICAgIGRlZmF1bHRDYW1lcmFFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7CiAgICBkZWZhdWx0Q2FtZXJhRWwuc2V0QXR0cmlidXRlKCdjYW1lcmEnLCB7YWN0aXZlOiB0cnVlfSk7CiAgICBkZWZhdWx0Q2FtZXJhRWwuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIHsKICAgICAgeDogMCwKICAgICAgeTogY29uc3RhbnRzLkRFRkFVTFRfQ0FNRVJBX0hFSUdIVCwKICAgICAgejogMAogICAgfSk7CiAgICBkZWZhdWx0Q2FtZXJhRWwuc2V0QXR0cmlidXRlKCd3YXNkLWNvbnRyb2xzJywgJycpOwogICAgZGVmYXVsdENhbWVyYUVsLnNldEF0dHJpYnV0ZSgnbG9vay1jb250cm9scycsICcnKTsKICAgIGRlZmF1bHRDYW1lcmFFbC5zZXRBdHRyaWJ1dGUoY29uc3RhbnRzLkFGUkFNRV9JTkpFQ1RFRCwgJycpOwoKICAgIGRlZmF1bHRDYW1lcmFFbC5hZGRFdmVudExpc3RlbmVyKCdvYmplY3QzZHNldCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgaWYgKGV2dC5kZXRhaWwudHlwZSAhPT0gJ2NhbWVyYScpIHsgcmV0dXJuOyB9CiAgICAgIHNjZW5lRWwuY2FtZXJhID0gZXZ0LmRldGFpbC5vYmplY3Q7CiAgICAgIHNjZW5lRWwuZW1pdCgnY2FtZXJhcmVhZHknLCB7Y2FtZXJhRWw6IGRlZmF1bHRDYW1lcmFFbH0pOwogICAgfSk7CgogICAgc2NlbmVFbC5hcHBlbmRDaGlsZChkZWZhdWx0Q2FtZXJhRWwpOwogIH0sCgogIC8qKgogICAqIFNldCBhIGRpZmZlcmVudCBhY3RpdmUgY2FtZXJhLgogICAqIFdoZW4gd2UgY2hvb3NlIGEgKHNvcnQgb2YpIHJhbmRvbSBzY2VuZSBjYW1lcmEgYXMgdGhlIHJlcGxhY2VtZW50LCBzZXQgaXRzIGBhY3RpdmVgIHRvCiAgICogdHJ1ZS4gVGhlIGNhbWVyYSBjb21wb25lbnQgd2lsbCBjYWxsIGBzZXRBY3RpdmVDYW1lcmFgIGFuZCBoYW5kbGUgcGFzc2luZyB0aGUgdG9yY2ggdG8KICAgKiB0aGUgbmV3IGNhbWVyYS4KICAgKi8KICBkaXNhYmxlQWN0aXZlQ2FtZXJhOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FtZXJhRWxzOwogICAgdmFyIG5ld0FjdGl2ZUNhbWVyYUVsOwogICAgY2FtZXJhRWxzID0gdGhpcy5zY2VuZUVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tjYW1lcmFdJyk7CiAgICBuZXdBY3RpdmVDYW1lcmFFbCA9IGNhbWVyYUVsc1tjYW1lcmFFbHMubGVuZ3RoIC0gMV07CiAgICBuZXdBY3RpdmVDYW1lcmFFbC5zZXRBdHRyaWJ1dGUoJ2NhbWVyYScsICdhY3RpdmUnLCB0cnVlKTsKICB9LAoKICAvKioKICAgKiBTZXQgYWN0aXZlIGNhbWVyYSB0byBiZSB1c2VkIGJ5IHJlbmRlcmVyLgogICAqIFJlbW92ZXMgdGhlIGRlZmF1bHQgY2FtZXJhIChpZiBwcmVzZW50KS4KICAgKiBEaXNhYmxlcyBhbGwgb3RoZXIgY2FtZXJhcyBpbiB0aGUgc2NlbmUuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR9IG5ld0NhbWVyYUVsIC0gRW50aXR5IHdpdGggY2FtZXJhIGNvbXBvbmVudC4KICAgKi8KICBzZXRBY3RpdmVDYW1lcmE6IGZ1bmN0aW9uIChuZXdDYW1lcmFFbCkgewogICAgdmFyIGNhbWVyYUVsOwogICAgdmFyIGNhbWVyYUVsczsKICAgIHZhciBpOwogICAgdmFyIG5ld0NhbWVyYTsKICAgIHZhciBwcmV2aW91c0NhbWVyYSA9IHRoaXMuYWN0aXZlQ2FtZXJhRWw7CiAgICB2YXIgc2NlbmVFbCA9IHRoaXMuc2NlbmVFbDsKCiAgICAvLyBTYW1lIGNhbWVyYS4KICAgIG5ld0NhbWVyYSA9IG5ld0NhbWVyYUVsLmdldE9iamVjdDNEKCdjYW1lcmEnKTsKICAgIGlmICghbmV3Q2FtZXJhIHx8IG5ld0NhbWVyYUVsID09PSB0aGlzLmFjdGl2ZUNhbWVyYUVsKSB7IHJldHVybjsgfQoKICAgIC8vIEdyYWIgdGhlIGRlZmF1bHQgY2FtZXJhLgogICAgdmFyIGRlZmF1bHRDYW1lcmFXcmFwcGVyID0gc2NlbmVFbC5xdWVyeVNlbGVjdG9yKCdbJyArIERFRkFVTFRfQ0FNRVJBX0FUVFIgKyAnXScpOwogICAgdmFyIGRlZmF1bHRDYW1lcmFFbCA9IGRlZmF1bHRDYW1lcmFXcmFwcGVyICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENhbWVyYVdyYXBwZXIucXVlcnlTZWxlY3RvcignW2NhbWVyYV0nKTsKCiAgICAvLyBSZW1vdmUgZGVmYXVsdCBjYW1lcmEgaWYgbmV3IGNhbWVyYSBpcyBub3QgdGhlIGRlZmF1bHQgY2FtZXJhLgogICAgaWYgKG5ld0NhbWVyYUVsICE9PSBkZWZhdWx0Q2FtZXJhRWwpIHsgcmVtb3ZlRGVmYXVsdENhbWVyYShzY2VuZUVsKTsgfQoKICAgIC8vIE1ha2UgbmV3IGNhbWVyYSBhY3RpdmUuCiAgICB0aGlzLmFjdGl2ZUNhbWVyYUVsID0gbmV3Q2FtZXJhRWw7CiAgICB0aGlzLmFjdGl2ZUNhbWVyYUVsLnBsYXkoKTsKICAgIHNjZW5lRWwuY2FtZXJhID0gbmV3Q2FtZXJhOwoKICAgIC8vIERpc2FibGUgY3VycmVudCBjYW1lcmEKICAgIGlmIChwcmV2aW91c0NhbWVyYSkgewogICAgICBwcmV2aW91c0NhbWVyYS5zZXRBdHRyaWJ1dGUoJ2NhbWVyYScsICdhY3RpdmUnLCBmYWxzZSk7CiAgICB9CgogICAgLy8gRGlzYWJsZSBvdGhlciBjYW1lcmFzIGluIHRoZSBzY2VuZQogICAgY2FtZXJhRWxzID0gc2NlbmVFbC5xdWVyeVNlbGVjdG9yQWxsKCdbY2FtZXJhXScpOwogICAgZm9yIChpID0gMDsgaSA8IGNhbWVyYUVscy5sZW5ndGg7IGkrKykgewogICAgICBjYW1lcmFFbCA9IGNhbWVyYUVsc1tpXTsKICAgICAgaWYgKCFjYW1lcmFFbC5pc0VudGl0eSB8fCBuZXdDYW1lcmFFbCA9PT0gY2FtZXJhRWwpIHsgY29udGludWU7IH0KICAgICAgY2FtZXJhRWwuc2V0QXR0cmlidXRlKCdjYW1lcmEnLCAnYWN0aXZlJywgZmFsc2UpOwogICAgICBjYW1lcmFFbC5wYXVzZSgpOwogICAgfQogICAgc2NlbmVFbC5lbWl0KCdjYW1lcmEtc2V0LWFjdGl2ZScsIHtjYW1lcmFFbDogbmV3Q2FtZXJhRWx9KTsKICB9LAoKICAvKioKICAgKiBTZXQgc3BlY3RhdG9yIGNhbWVyYSB0byByZW5kZXIgdGhlIHNjZW5lIG9uIGEgMkQgZGlzcGxheS4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gbmV3Q2FtZXJhRWwgLSBFbnRpdHkgd2l0aCBjYW1lcmEgY29tcG9uZW50LgogICAqLwogIHNldFNwZWN0YXRvckNhbWVyYTogZnVuY3Rpb24gKG5ld0NhbWVyYUVsKSB7CiAgICB2YXIgbmV3Q2FtZXJhOwogICAgdmFyIHByZXZpb3VzQ2FtZXJhID0gdGhpcy5zcGVjdGF0b3JDYW1lcmFFbDsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5zY2VuZUVsOwogICAgdmFyIHNwZWN0YXRvckNhbWVyYUVsOwoKICAgIC8vIFNhbWUgY2FtZXJhLgogICAgbmV3Q2FtZXJhID0gbmV3Q2FtZXJhRWwuZ2V0T2JqZWN0M0QoJ2NhbWVyYScpOwogICAgaWYgKCFuZXdDYW1lcmEgfHwgbmV3Q2FtZXJhRWwgPT09IHRoaXMuc3BlY3RhdG9yQ2FtZXJhRWwpIHsgcmV0dXJuOyB9CgogICAgLy8gRGlzYWJsZSBjdXJyZW50IGNhbWVyYQogICAgaWYgKHByZXZpb3VzQ2FtZXJhKSB7CiAgICAgIHByZXZpb3VzQ2FtZXJhLnNldEF0dHJpYnV0ZSgnY2FtZXJhJywgJ3NwZWN0YXRvcicsIGZhbHNlKTsKICAgIH0KCiAgICBzcGVjdGF0b3JDYW1lcmFFbCA9IHRoaXMuc3BlY3RhdG9yQ2FtZXJhRWwgPSBuZXdDYW1lcmFFbDsKCiAgICBzY2VuZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ2VudGVyLXZyJywgdGhpcy53cmFwUmVuZGVyKTsKICAgIHNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignZXhpdC12cicsIHRoaXMudW53cmFwUmVuZGVyKTsKCiAgICBzcGVjdGF0b3JDYW1lcmFFbC5zZXRBdHRyaWJ1dGUoJ2NhbWVyYScsICdhY3RpdmUnLCBmYWxzZSk7CiAgICBzcGVjdGF0b3JDYW1lcmFFbC5wbGF5KCk7CgogICAgc2NlbmVFbC5lbWl0KCdjYW1lcmEtc2V0LXNwZWN0YXRvcicsIHtjYW1lcmFFbDogbmV3Q2FtZXJhRWx9KTsKICB9LAoKICAvKioKICAgKiBEaXNhYmxlcyBjdXJyZW50IHNwZWN0YXRvciBjYW1lcmEuCiAgICovCiAgZGlzYWJsZVNwZWN0YXRvckNhbWVyYTogZnVuY3Rpb24gKCkgewogICAgdGhpcy5zcGVjdGF0b3JDYW1lcmFFbCA9IHVuZGVmaW5lZDsKICB9LAoKICAvKioKICAgKiBXcmFwIHRoZSByZW5kZXIgbWV0aG9kIG9mIHRoZSByZW5kZXJlciB0byByZW5kZXIKICAgKiB0aGUgc3BlY3RhdG9yIGNhbWVyYSBhZnRlciB2ckRpc3BsYXkuc3VibWl0RnJhbWUuCiAgICovCiAgd3JhcFJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aGlzLnNwZWN0YXRvckNhbWVyYUVsKSB7IHJldHVybjsgfQogICAgdGhpcy5vcmlnaW5hbFJlbmRlciA9IHRoaXMuc2NlbmVFbC5yZW5kZXJlci5yZW5kZXI7CiAgICB0aGlzLnNjZW5lRWwucmVuZGVyZXIucmVuZGVyID0gdGhpcy5yZW5kZXI7CiAgfSwKCiAgdW53cmFwUmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMub3JpZ2luYWxSZW5kZXIpIHsgcmV0dXJuOyB9CiAgICB0aGlzLnNjZW5lRWwucmVuZGVyZXIucmVuZGVyID0gdGhpcy5vcmlnaW5hbFJlbmRlcjsKICAgIHRoaXMub3JpZ2luYWxSZW5kZXIgPSB1bmRlZmluZWQ7CiAgfSwKCiAgcmVuZGVyOiBmdW5jdGlvbiAoc2NlbmUsIGNhbWVyYSkgewogICAgdmFyIGlzVlJFbmFibGVkOwogICAgdmFyIHNjZW5lRWwgPSB0aGlzLnNjZW5lRWw7CiAgICB2YXIgc3BlY3RhdG9yQ2FtZXJhOwoKICAgIGlzVlJFbmFibGVkID0gc2NlbmVFbC5yZW5kZXJlci52ci5lbmFibGVkOwogICAgdGhpcy5vcmlnaW5hbFJlbmRlci5jYWxsKHNjZW5lRWwucmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEpOwogICAgaWYgKCF0aGlzLnNwZWN0YXRvckNhbWVyYUVsIHx8IHNjZW5lRWwuaXNNb2JpbGUgfHwgIWlzVlJFbmFibGVkKSB7IHJldHVybjsgfQogICAgc3BlY3RhdG9yQ2FtZXJhID0gdGhpcy5zcGVjdGF0b3JDYW1lcmFFbC5jb21wb25lbnRzLmNhbWVyYS5jYW1lcmE7CiAgICBzY2VuZUVsLnJlbmRlcmVyLnZyLmVuYWJsZWQgPSBmYWxzZTsKICAgIHRoaXMub3JpZ2luYWxSZW5kZXIuY2FsbChzY2VuZUVsLnJlbmRlcmVyLCBzY2VuZSwgc3BlY3RhdG9yQ2FtZXJhKTsKICAgIHNjZW5lRWwucmVuZGVyZXIudnIuZW5hYmxlZCA9IGlzVlJFbmFibGVkOwogIH0KfSk7CgovKioKICogUmVtb3ZlIGluamVjdGVkIGRlZmF1bHQgY2FtZXJhIGZyb20gc2NlbmUsIGlmIHByZXNlbnQuCiAqCiAqIEBwYXJhbSB7RWxlbWVudH0gc2NlbmVFbAogKi8KZnVuY3Rpb24gcmVtb3ZlRGVmYXVsdENhbWVyYSAoc2NlbmVFbCkgewogIHZhciBkZWZhdWx0Q2FtZXJhOwogIHZhciBjYW1lcmEgPSBzY2VuZUVsLmNhbWVyYTsKICBpZiAoIWNhbWVyYSkgeyByZXR1cm47IH0KCiAgLy8gUmVtb3ZlIGRlZmF1bHQgY2FtZXJhIGlmIHByZXNlbnQuCiAgZGVmYXVsdENhbWVyYSA9IHNjZW5lRWwucXVlcnlTZWxlY3RvcignWycgKyBERUZBVUxUX0NBTUVSQV9BVFRSICsgJ10nKTsKICBpZiAoIWRlZmF1bHRDYW1lcmEpIHsgcmV0dXJuOyB9CiAgc2NlbmVFbC5yZW1vdmVDaGlsZChkZWZhdWx0Q2FtZXJhKTsKfQoKfSx7Ii4uL2NvbnN0YW50cy8iOjk4LCIuLi9jb3JlL3N5c3RlbSI6MTE3fV0sMTY0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdlb21ldHJpZXMgPSBfZGVyZXFfKCcuLi9jb3JlL2dlb21ldHJ5JykuZ2VvbWV0cmllczsKdmFyIHJlZ2lzdGVyU3lzdGVtID0gX2RlcmVxXygnLi4vY29yZS9zeXN0ZW0nKS5yZWdpc3RlclN5c3RlbTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CgovKioKICogU3lzdGVtIGZvciBnZW9tZXRyeSBjb21wb25lbnQuCiAqIEhhbmRsZSBnZW9tZXRyeSBjYWNoaW5nLgogKgogKiBAbWVtYmVyIHtvYmplY3R9IGNhY2hlIC0gTWFwcGluZyBvZiBzdHJpbmdpZmllZCBjb21wb25lbnQgZGF0YSB0byBUSFJFRS5HZW9tZXRyeSBvYmplY3RzLgogKiBAbWVtYmVyIHtvYmplY3R9IGNhY2hlQ291bnQgLSBLZWVwIHRyYWNrIG9mIG51bWJlciBvZiBlbnRpdGllcyB1c2luZyBhIGdlb21ldHJ5IHRvCiAqICAgICAgICAga25vdyB3aGV0aGVyIHRvIGRpc3Bvc2Ugb24gcmVtb3ZhbC4KICovCm1vZHVsZS5leHBvcnRzLlN5c3RlbSA9IHJlZ2lzdGVyU3lzdGVtKCdnZW9tZXRyeScsIHsKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmNhY2hlID0ge307CiAgICB0aGlzLmNhY2hlQ291bnQgPSB7fTsKICB9LAoKICAvKioKICAgKiBSZXNldCBjYWNoZS4gTWFpbmx5IGZvciB0ZXN0aW5nLgogICAqLwogIGNsZWFyQ2FjaGU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuY2FjaGUgPSB7fTsKICAgIHRoaXMuY2FjaGVDb3VudCA9IHt9OwogIH0sCgogIC8qKgogICAqIEF0dGVtcHQgdG8gcmV0cmlldmUgZnJvbSBjYWNoZS4KICAgKgogICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gQSBnZW9tZXRyeSBpZiBpdCBleGlzdHMsIGVsc2UgbnVsbC4KICAgKi8KICBnZXRPckNyZWF0ZUdlb21ldHJ5OiBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIHZhciBjYWNoZWRHZW9tZXRyeTsKICAgIHZhciBoYXNoOwoKICAgIC8vIFNraXAgYWxsIGNhY2hpbmcgbG9naWMuCiAgICBpZiAoZGF0YS5za2lwQ2FjaGUpIHsgcmV0dXJuIGNyZWF0ZUdlb21ldHJ5KGRhdGEpOyB9CgogICAgLy8gVHJ5IHRvIHJldHJpZXZlIGZyb20gY2FjaGUgZmlyc3QuCiAgICBoYXNoID0gdGhpcy5oYXNoKGRhdGEpOwogICAgY2FjaGVkR2VvbWV0cnkgPSBjYWNoZVtoYXNoXTsKICAgIGluY3JlbWVudENhY2hlQ291bnQodGhpcy5jYWNoZUNvdW50LCBoYXNoKTsKCiAgICBpZiAoY2FjaGVkR2VvbWV0cnkpIHsgcmV0dXJuIGNhY2hlZEdlb21ldHJ5OyB9CgogICAgLy8gQ3JlYXRlIGdlb21ldHJ5LgogICAgY2FjaGVkR2VvbWV0cnkgPSBjcmVhdGVHZW9tZXRyeShkYXRhKTsKCiAgICAvLyBDYWNoZSBhbmQgcmV0dXJuIGdlb21ldHJ5LgogICAgY2FjaGVbaGFzaF0gPSBjYWNoZWRHZW9tZXRyeTsKICAgIHJldHVybiBjYWNoZWRHZW9tZXRyeTsKICB9LAoKICAvKioKICAgKiBMZXQgc3lzdGVtIGtub3cgdGhhdCBhbiBlbnRpdHkgaXMgbm8gbG9uZ2VyIHVzaW5nIGEgZ2VvbWV0cnkuCiAgICovCiAgdW51c2VHZW9tZXRyeTogZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICB2YXIgY2FjaGVDb3VudCA9IHRoaXMuY2FjaGVDb3VudDsKICAgIHZhciBnZW9tZXRyeTsKICAgIHZhciBoYXNoOwoKICAgIGlmIChkYXRhLnNraXBDYWNoZSkgeyByZXR1cm47IH0KCiAgICBoYXNoID0gdGhpcy5oYXNoKGRhdGEpOwoKICAgIGlmICghY2FjaGVbaGFzaF0pIHsgcmV0dXJuOyB9CgogICAgZGVjcmVtZW50Q2FjaGVDb3VudChjYWNoZUNvdW50LCBoYXNoKTsKCiAgICAvLyBBbm90aGVyIGVudGl0eSBpcyBzdGlsbCB1c2luZyB0aGlzIGdlb21ldHJ5LiBObyBuZWVkIHRvIGRvIGFueXRoaW5nLgogICAgaWYgKGNhY2hlQ291bnRbaGFzaF0gPiAwKSB7IHJldHVybjsgfQoKICAgIC8vIE5vIG1vcmUgZW50aXRpZXMgYXJlIHVzaW5nIHRoaXMgZ2VvbWV0cnkuIERpc3Bvc2UuCiAgICBnZW9tZXRyeSA9IGNhY2hlW2hhc2hdOwogICAgZ2VvbWV0cnkuZGlzcG9zZSgpOwogICAgZGVsZXRlIGNhY2hlW2hhc2hdOwogICAgZGVsZXRlIGNhY2hlQ291bnRbaGFzaF07CiAgfSwKCiAgLyoqCiAgICogVXNlIEpTT04uc3RyaW5naWZ5IHRvIHR1cm4gY29tcG9uZW50IGRhdGEgaW50byBoYXNoLgogICAqIFNob3VsZCBiZSBkZXRlcm1pbmlzdGljIHdpdGhpbiBhIHNpbmdsZSBicm93c2VyIGVuZ2luZS4KICAgKiBJZiBub3QsIHRoZW4gbG9vayBpbnRvIGpzb24tc3RhYmxlLXN0cmluZ2lmeS4KICAgKi8KICBoYXNoOiBmdW5jdGlvbiAoZGF0YSkgewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEpOwogIH0KfSk7CgovKioKICogQ3JlYXRlIGdlb21ldHJ5IHVzaW5nIGNvbXBvbmVudCBkYXRhLgogKgogKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIENvbXBvbmVudCBkYXRhLgogKiBAcmV0dXJucyB7b2JqZWN0fSBHZW9tZXRyeS4KICovCmZ1bmN0aW9uIGNyZWF0ZUdlb21ldHJ5IChkYXRhKSB7CiAgdmFyIGdlb21ldHJ5VHlwZSA9IGRhdGEucHJpbWl0aXZlOwogIHZhciBHZW9tZXRyeUNsYXNzID0gZ2VvbWV0cmllc1tnZW9tZXRyeVR5cGVdICYmIGdlb21ldHJpZXNbZ2VvbWV0cnlUeXBlXS5HZW9tZXRyeTsKICB2YXIgZ2VvbWV0cnlJbnN0YW5jZSA9IG5ldyBHZW9tZXRyeUNsYXNzKCk7CgogIGlmICghR2VvbWV0cnlDbGFzcykgeyB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZ2VvbWV0cnkgYCcgKyBnZW9tZXRyeVR5cGUgKyAnYCcpOyB9CgogIGdlb21ldHJ5SW5zdGFuY2UuaW5pdChkYXRhKTsKICByZXR1cm4gdG9CdWZmZXJHZW9tZXRyeShnZW9tZXRyeUluc3RhbmNlLmdlb21ldHJ5LCBkYXRhLmJ1ZmZlcik7Cn0KCi8qKgogKiBEZWNyZWF0ZSBjb3VudCBvZiBlbnRpdHkgdXNpbmcgYSBnZW9tZXRyeS4KICovCmZ1bmN0aW9uIGRlY3JlbWVudENhY2hlQ291bnQgKGNhY2hlQ291bnQsIGhhc2gpIHsKICBjYWNoZUNvdW50W2hhc2hdLS07Cn0KCi8qKgogKiBJbmNyZWFzZSBjb3VudCBvZiBlbnRpdHkgdXNpbmcgYSBnZW9tZXRyeS4KICovCmZ1bmN0aW9uIGluY3JlbWVudENhY2hlQ291bnQgKGNhY2hlQ291bnQsIGhhc2gpIHsKICBjYWNoZUNvdW50W2hhc2hdID0gY2FjaGVDb3VudFtoYXNoXSA9PT0gdW5kZWZpbmVkID8gMSA6IGNhY2hlQ291bnRbaGFzaF0gKyAxOwp9CgovKioKICogVHJhbnNmb3JtIGdlb21ldHJ5IHRvIEJ1ZmZlckdlb21ldHJ5IGlmIGBkb0J1ZmZlcmAuCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBnZW9tZXRyeQogKiBAcGFyYW0ge2Jvb2xlYW59IGRvQnVmZmVyCiAqIEByZXR1cm5zIHtvYmplY3R9IEdlb21ldHJ5LgogKi8KZnVuY3Rpb24gdG9CdWZmZXJHZW9tZXRyeSAoZ2VvbWV0cnksIGRvQnVmZmVyKSB7CiAgdmFyIGJ1ZmZlckdlb21ldHJ5OwogIGlmICghZG9CdWZmZXIpIHsgcmV0dXJuIGdlb21ldHJ5OyB9CgogIGJ1ZmZlckdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCkuZnJvbUdlb21ldHJ5KGdlb21ldHJ5KTsKICBidWZmZXJHZW9tZXRyeS5tZXRhZGF0YSA9IHt0eXBlOiBnZW9tZXRyeS50eXBlLCBwYXJhbWV0ZXJzOiBnZW9tZXRyeS5wYXJhbWV0ZXJzIHx8IHt9fTsKICBnZW9tZXRyeS5kaXNwb3NlKCk7ICAvLyBEaXNwb3NlIG5vIGxvbmdlciBuZWVkZWQgbm9uLWJ1ZmZlciBnZW9tZXRyeS4KICByZXR1cm4gYnVmZmVyR2VvbWV0cnk7Cn0KCn0seyIuLi9jb3JlL2dlb21ldHJ5IjoxMDcsIi4uL2NvcmUvc3lzdGVtIjoxMTcsIi4uL2xpYi90aHJlZSI6MTU0fV0sMTY1OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyU3lzdGVtID0gX2RlcmVxXygnLi4vY29yZS9zeXN0ZW0nKS5yZWdpc3RlclN5c3RlbTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7CgovKioKICogZ2xURiBtb2RlbCBzeXN0ZW0uCiAqCiAqIENvbmZpZ3VyZXMgZ2xURiBsb2FkaW5nIG9wdGlvbnMuIE1vZGVscyB1c2luZyBnbFRGIGNvbXByZXNzaW9uIHJlcXVpcmUgdGhhdCBhIERyYWNvIGRlY29kZXIgYmUKICogcHJvdmlkZWQgZXh0ZXJuYWxseS4KICoKICogQHBhcmFtIHtzdHJpbmd9IGRyYWNvRGVjb2RlclBhdGggLSBCYXNlIHBhdGggZnJvbSB3aGljaCB0byBsb2FkIERyYWNvIGRlY29kZXIgbGlicmFyeS4KICovCm1vZHVsZS5leHBvcnRzLlN5c3RlbSA9IHJlZ2lzdGVyU3lzdGVtKCdnbHRmLW1vZGVsJywgewogIHNjaGVtYTogewogICAgZHJhY29EZWNvZGVyUGF0aDoge2RlZmF1bHQ6ICcnfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwYXRoID0gdGhpcy5kYXRhLmRyYWNvRGVjb2RlclBhdGg7CiAgICBUSFJFRS5EUkFDT0xvYWRlci5zZXREZWNvZGVyUGF0aChwYXRoKTsKICAgIHRoaXMuZHJhY29Mb2FkZXIgPSBwYXRoID8gbmV3IFRIUkVFLkRSQUNPTG9hZGVyKCkgOiBudWxsOwogIH0sCgogIHVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgdmFyIHBhdGg7CiAgICBpZiAodGhpcy5kcmFjb0xvYWRlcikgeyByZXR1cm47IH0KICAgIHBhdGggPSB0aGlzLmRhdGEuZHJhY29EZWNvZGVyUGF0aDsKICAgIFRIUkVFLkRSQUNPTG9hZGVyLnNldERlY29kZXJQYXRoKHBhdGgpOwogICAgdGhpcy5kcmFjb0xvYWRlciA9IHBhdGggPyBuZXcgVEhSRUUuRFJBQ09Mb2FkZXIoKSA6IG51bGw7CiAgfSwKCiAgZ2V0RFJBQ09Mb2FkZXI6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmRyYWNvTG9hZGVyOwogIH0KfSk7Cgp9LHsiLi4vY29yZS9zeXN0ZW0iOjExNywiLi4vbGliL3RocmVlIjoxNTR9XSwxNjY6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewpfZGVyZXFfKCcuL2NhbWVyYScpOwpfZGVyZXFfKCcuL2dlb21ldHJ5Jyk7Cl9kZXJlcV8oJy4vZ2x0Zi1tb2RlbCcpOwpfZGVyZXFfKCcuL2xpZ2h0Jyk7Cl9kZXJlcV8oJy4vbWF0ZXJpYWwnKTsKX2RlcmVxXygnLi9yZW5kZXJlcicpOwpfZGVyZXFfKCcuL3NoYWRvdycpOwpfZGVyZXFfKCcuL3RyYWNrZWQtY29udHJvbHMtd2VidnInKTsKX2RlcmVxXygnLi90cmFja2VkLWNvbnRyb2xzLXdlYnhyJyk7Cgp9LHsiLi9jYW1lcmEiOjE2MywiLi9nZW9tZXRyeSI6MTY0LCIuL2dsdGYtbW9kZWwiOjE2NSwiLi9saWdodCI6MTY3LCIuL21hdGVyaWFsIjoxNjgsIi4vcmVuZGVyZXIiOjE2OSwiLi9zaGFkb3ciOjE3MCwiLi90cmFja2VkLWNvbnRyb2xzLXdlYnZyIjoxNzEsIi4vdHJhY2tlZC1jb250cm9scy13ZWJ4ciI6MTcyfV0sMTY3OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyU3lzdGVtID0gX2RlcmVxXygnLi4vY29yZS9zeXN0ZW0nKS5yZWdpc3RlclN5c3RlbTsKdmFyIGJpbmQgPSBfZGVyZXFfKCcuLi91dGlscy9iaW5kJyk7CnZhciBjb25zdGFudHMgPSBfZGVyZXFfKCcuLi9jb25zdGFudHMvJyk7Cgp2YXIgREVGQVVMVF9MSUdIVF9BVFRSID0gJ2RhdGEtYWZyYW1lLWRlZmF1bHQtbGlnaHQnOwoKLyoqCiAqIExpZ2h0IHN5c3RlbS4KICoKICogUHJlc2NyaWJlcyBkZWZhdWx0IGxpZ2h0aW5nIGlmIG5vdCBzcGVjaWZpZWQgKG9uZSBhbWJpZW50LCBvbmUgZGlyZWN0aW9uYWwpLgogKiBSZW1vdmVzIGRlZmF1bHQgbGlnaHRpbmcgZnJvbSB0aGUgc2NlbmUgd2hlbiBhIG5ldyBsaWdodCBpcyBhZGRlZC4KICoKICogQHBhcmFtIHtib29sfSBkZWZhdWx0TGlnaHRzIC0gV2hldGhlciBkZWZhdWx0IGxpZ2h0aW5nIGFyZSBkZWZpbmVkLgogKiBAcGFyYW0ge2Jvb2x9IHVzZXJEZWZpbmVkTGlnaHRzIC0gV2hldGhlciB1c2VyIGxpZ2h0aW5nIGlzIGRlZmluZWQuCiAqLwptb2R1bGUuZXhwb3J0cy5TeXN0ZW0gPSByZWdpc3RlclN5c3RlbSgnbGlnaHQnLCB7CiAgc2NoZW1hOiB7CiAgICBkZWZhdWx0TGlnaHRzRW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9CiAgfSwKCiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5kZWZhdWx0TGlnaHRzID0gZmFsc2U7CiAgICB0aGlzLnVzZXJEZWZpbmVkTGlnaHRzID0gZmFsc2U7CiAgICAvLyBXYWl0IGZvciBhbGwgZW50aXRpZXMgdG8gZnVsbHkgbG9hZCBiZWZvcmUgY2hlY2tpbmcgZm9yIGV4aXN0ZW5jZSBvZiBsaWdodHMuCiAgICAvLyBTaW5jZSBlbnRpdGllcyB3YWl0IGZvciA8YS1hc3NldHM+IHRvIGxvYWQsIGFueSBsaWdodHMgYXR0YWNoaW5nIHRvIHRoZSBzY2VuZQogICAgLy8gd2lsbCBkbyBzbyBhc3luY2hyb25vdXNseS4KICAgIHRoaXMuc2NlbmVFbC5hZGRFdmVudExpc3RlbmVyKCdsb2FkZWQnLCBiaW5kKHRoaXMuc2V0dXBEZWZhdWx0TGlnaHRzLCB0aGlzKSk7CiAgfSwKCiAgLyoqCiAgICogTm90aWZ5IHNjZW5lIHRoYXQgbGlnaHQgaGFzIGJlZW4gYWRkZWQgYW5kIHRvIHJlbW92ZSB0aGUgZGVmYXVsdC4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBlbCAtIGVsZW1lbnQgaG9sZGluZyB0aGUgbGlnaHQgY29tcG9uZW50LgogICAqLwogIHJlZ2lzdGVyTGlnaHQ6IGZ1bmN0aW9uIChlbCkgewogICAgaWYgKCFlbC5oYXNBdHRyaWJ1dGUoREVGQVVMVF9MSUdIVF9BVFRSKSkgewogICAgICAvLyBVc2VyIGFkZGVkIGEgbGlnaHQsIHJlbW92ZSBkZWZhdWx0IGxpZ2h0cyB0aHJvdWdoIERPTS4KICAgICAgdGhpcy5yZW1vdmVEZWZhdWx0TGlnaHRzKCk7CiAgICAgIHRoaXMudXNlckRlZmluZWRMaWdodHMgPSB0cnVlOwogICAgfQogIH0sCgogIHJlbW92ZURlZmF1bHRMaWdodHM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkZWZhdWx0TGlnaHRzOwogICAgdmFyIHNjZW5lRWwgPSB0aGlzLnNjZW5lRWw7CgogICAgaWYgKCF0aGlzLmRlZmF1bHRMaWdodHMpIHsgcmV0dXJuOyB9CiAgICBkZWZhdWx0TGlnaHRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBERUZBVUxUX0xJR0hUX0FUVFIgKyAnXScpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWZhdWx0TGlnaHRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHNjZW5lRWwucmVtb3ZlQ2hpbGQoZGVmYXVsdExpZ2h0c1tpXSk7CiAgICB9CiAgICB0aGlzLmRlZmF1bHRMaWdodHMgPSBmYWxzZTsKICB9LAoKICAvKioKICAgKiBQcmVzY2liZSBkZWZhdWx0IGxpZ2h0cyB0byB0aGUgc2NlbmUuCiAgICogRG9lcyBzbyBieSBpbmplY3RpbmcgbWFya3VwIHN1Y2ggdGhhdCB0aGlzIHN0YXRlIGlzIG5vdCBpbnZpc2libGUuCiAgICogVGhlc2UgbGlnaHRzIGFyZSByZW1vdmVkIGlmIHRoZSB1c2VyIGFkZHMgYW55IGxpZ2h0cy4KICAgKi8KICBzZXR1cERlZmF1bHRMaWdodHM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5zY2VuZUVsOwogICAgdmFyIGFtYmllbnRMaWdodDsKICAgIHZhciBkaXJlY3Rpb25hbExpZ2h0OwoKICAgIGlmICh0aGlzLnVzZXJEZWZpbmVkTGlnaHRzIHx8IHRoaXMuZGVmYXVsdExpZ2h0cyB8fCAhdGhpcy5kYXRhLmRlZmF1bHRMaWdodHNFbmFibGVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBhbWJpZW50TGlnaHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWVudGl0eScpOwogICAgYW1iaWVudExpZ2h0LnNldEF0dHJpYnV0ZSgnbGlnaHQnLCB7Y29sb3I6ICcjQkJCJywgdHlwZTogJ2FtYmllbnQnfSk7CiAgICBhbWJpZW50TGlnaHQuc2V0QXR0cmlidXRlKERFRkFVTFRfTElHSFRfQVRUUiwgJycpOwogICAgYW1iaWVudExpZ2h0LnNldEF0dHJpYnV0ZShjb25zdGFudHMuQUZSQU1FX0lOSkVDVEVELCAnJyk7CiAgICBzY2VuZUVsLmFwcGVuZENoaWxkKGFtYmllbnRMaWdodCk7CgogICAgZGlyZWN0aW9uYWxMaWdodCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7CiAgICBkaXJlY3Rpb25hbExpZ2h0LnNldEF0dHJpYnV0ZSgnbGlnaHQnLCB7Y29sb3I6ICcjRkZGJywgaW50ZW5zaXR5OiAwLjYsIGNhc3RTaGFkb3c6IHRydWV9KTsKICAgIGRpcmVjdGlvbmFsTGlnaHQuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIHt4OiAtMC41LCB5OiAxLCB6OiAxfSk7CiAgICBkaXJlY3Rpb25hbExpZ2h0LnNldEF0dHJpYnV0ZShERUZBVUxUX0xJR0hUX0FUVFIsICcnKTsKICAgIGRpcmVjdGlvbmFsTGlnaHQuc2V0QXR0cmlidXRlKGNvbnN0YW50cy5BRlJBTUVfSU5KRUNURUQsICcnKTsKICAgIHNjZW5lRWwuYXBwZW5kQ2hpbGQoZGlyZWN0aW9uYWxMaWdodCk7CgogICAgdGhpcy5kZWZhdWx0TGlnaHRzID0gdHJ1ZTsKICB9Cn0pOwoKfSx7Ii4uL2NvbnN0YW50cy8iOjk4LCIuLi9jb3JlL3N5c3RlbSI6MTE3LCIuLi91dGlscy9iaW5kIjoxNzN9XSwxNjg6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJTeXN0ZW0gPSBfZGVyZXFfKCcuLi9jb3JlL3N5c3RlbScpLnJlZ2lzdGVyU3lzdGVtOwp2YXIgVEhSRUUgPSBfZGVyZXFfKCcuLi9saWIvdGhyZWUnKTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMvJyk7CnZhciBpc0hMUyA9IF9kZXJlcV8oJy4uL3V0aWxzL21hdGVyaWFsJykuaXNITFM7Cgp2YXIgYmluZCA9IHV0aWxzLmJpbmQ7CnZhciBkZWJ1ZyA9IHV0aWxzLmRlYnVnOwp2YXIgZXJyb3IgPSBkZWJ1ZygnY29tcG9uZW50czp0ZXh0dXJlOmVycm9yJyk7CnZhciBUZXh0dXJlTG9hZGVyID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKTsKdmFyIHdhcm4gPSBkZWJ1ZygnY29tcG9uZW50czp0ZXh0dXJlOndhcm4nKTsKClRleHR1cmVMb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oJ2Fub255bW91cycpOwoKLyoqCiAqIFN5c3RlbSBmb3IgbWF0ZXJpYWwgY29tcG9uZW50LgogKiBIYW5kbGUgbWF0ZXJpYWwgcmVnaXN0cmF0aW9uLCB1cGRhdGVzIChmb3IgZm9nKSwgYW5kIHRleHR1cmUgY2FjaGluZy4KICoKICogQG1lbWJlciB7b2JqZWN0fSBtYXRlcmlhbHMgLSBSZWdpc3RlcmVkIG1hdGVyaWFscy4KICogQG1lbWJlciB7b2JqZWN0fSB0ZXh0dXJlQ291bnRzIC0gTnVtYmVyIG9mIHRpbWVzIGVhY2ggdGV4dHVyZSBpcyB1c2VkLiBUcmFja2VkCiAqICAgICAgICAgc2VwYXJhdGVseSBmcm9tIHRleHR1cmVDYWNoZSwgYmVjYXVzZSB0aGUgY2FjaGUgKDEpIGlzIHBvcHVsYXRlZCBpbgogKiAgICAgICAgIG11bHRpcGxlIHBsYWNlcywgYW5kICgyKSBtYXkgYmUgY2xlYXJlZCBhdCBhbnkgdGltZS4KICogQG1lbWJlciB7b2JqZWN0fSB0ZXh0dXJlQ2FjaGUgLSBUZXh0dXJlIGNhY2hlIGZvcjoKICogICAtIEltYWdlczogdGV4dHVyZUNhY2hlIGhhcyBtYXBwaW5nIG9mIHNyYyAtPiByZXBlYXQgLT4gY2FjaGVkIHRocmVlLmpzIHRleHR1cmUuCiAqICAgLSBWaWRlb3M6IHRleHR1cmVDYWNoZSBoYXMgbWFwcGluZyBvZiB2aWRlb0VsZW1lbnQgLT4gY2FjaGVkIHRocmVlLmpzIHRleHR1cmUuCiAqLwptb2R1bGUuZXhwb3J0cy5TeXN0ZW0gPSByZWdpc3RlclN5c3RlbSgnbWF0ZXJpYWwnLCB7CiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5tYXRlcmlhbHMgPSB7fTsKICAgIHRoaXMudGV4dHVyZUNvdW50cyA9IHt9OwogICAgdGhpcy50ZXh0dXJlQ2FjaGUgPSB7fTsKCiAgICB0aGlzLnNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgJ21hdGVyaWFsdGV4dHVyZWxvYWRlZCcsCiAgICAgIGJpbmQodGhpcy5vbk1hdGVyaWFsVGV4dHVyZUxvYWRlZCwgdGhpcykKICAgICk7CiAgfSwKCiAgY2xlYXJUZXh0dXJlQ2FjaGU6IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMudGV4dHVyZUNhY2hlID0ge307CiAgfSwKCiAgLyoqCiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgYHNyY2AgaXMgYSBpbWFnZSBvciB2aWRlby4gVGhlbiB0cnkgdG8gbG9hZCB0aGUgYXNzZXQsIHRoZW4gY2FsbCBiYWNrLgogICAqCiAgICogQHBhcmFtIHtzdHJpbmcsIG9yIGVsZW1lbnR9IHNyYyAtIFRleHR1cmUgVVJMIG9yIGVsZW1lbnQuCiAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGEgLSBSZWxldmFudCB0ZXh0dXJlIGRhdGEgdXNlZCBmb3IgY2FjaGluZy4KICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYiAtIENhbGxiYWNrIHRvIHBhc3MgdGV4dHVyZSB0by4KICAgKi8KICBsb2FkVGV4dHVyZTogZnVuY3Rpb24gKHNyYywgZGF0YSwgY2IpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAvLyBDYW52YXMuCiAgICBpZiAoc3JjLnRhZ05hbWUgPT09ICdDQU5WQVMnKSB7CiAgICAgIHRoaXMubG9hZENhbnZhcyhzcmMsIGRhdGEsIGNiKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFZpZGVvIGVsZW1lbnQuCiAgICBpZiAoc3JjLnRhZ05hbWUgPT09ICdWSURFTycpIHsKICAgICAgaWYgKCFzcmMuc3JjICYmICFzcmMuc3JjT2JqZWN0ICYmICFzcmMuY2hpbGRFbGVtZW50Q291bnQpIHsKICAgICAgICB3YXJuKCdWaWRlbyBlbGVtZW50IHdhcyBkZWZpbmVkIHdpdGggbmVpdGhlciBgc291cmNlYCBlbGVtZW50cyBub3IgYHNyY2AgLyBgc3JjT2JqZWN0YCBhdHRyaWJ1dGVzLicpOwogICAgICB9CiAgICAgIHRoaXMubG9hZFZpZGVvKHNyYywgZGF0YSwgY2IpOwogICAgICByZXR1cm47CiAgICB9CgogICAgdXRpbHMuc3JjTG9hZGVyLnZhbGlkYXRlU3JjKHNyYywgbG9hZEltYWdlQ2IsIGxvYWRWaWRlb0NiKTsKICAgIGZ1bmN0aW9uIGxvYWRJbWFnZUNiIChzcmMpIHsgc2VsZi5sb2FkSW1hZ2Uoc3JjLCBkYXRhLCBjYik7IH0KICAgIGZ1bmN0aW9uIGxvYWRWaWRlb0NiIChzcmMpIHsgc2VsZi5sb2FkVmlkZW8oc3JjLCBkYXRhLCBjYik7IH0KICB9LAoKICAvKioKICAgKiBIaWdoLWxldmVsIGZ1bmN0aW9uIGZvciBsb2FkaW5nIGltYWdlIHRleHR1cmVzIChUSFJFRS5UZXh0dXJlKS4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudHxzdHJpbmd9IHNyYyAtIFRleHR1cmUgc291cmNlLgogICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gVGV4dHVyZSBkYXRhLgogICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNiIC0gQ2FsbGJhY2sgdG8gcGFzcyB0ZXh0dXJlIHRvLgogICAqLwogIGxvYWRJbWFnZTogZnVuY3Rpb24gKHNyYywgZGF0YSwgaGFuZGxlSW1hZ2VUZXh0dXJlTG9hZGVkKSB7CiAgICB2YXIgaGFzaCA9IHRoaXMuaGFzaChkYXRhKTsKICAgIHZhciB0ZXh0dXJlQ2FjaGUgPSB0aGlzLnRleHR1cmVDYWNoZTsKCiAgICAvLyBUZXh0dXJlIGFscmVhZHkgYmVpbmcgbG9hZGVkIG9yIGFscmVhZHkgbG9hZGVkLiBXYWl0IG9uIHByb21pc2UuCiAgICBpZiAodGV4dHVyZUNhY2hlW2hhc2hdKSB7CiAgICAgIHRleHR1cmVDYWNoZVtoYXNoXS50aGVuKGhhbmRsZUltYWdlVGV4dHVyZUxvYWRlZCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBUZXh0dXJlIG5vdCB5ZXQgYmVpbmcgbG9hZGVkLiBTdGFydCBsb2FkaW5nIGl0LgogICAgdGV4dHVyZUNhY2hlW2hhc2hdID0gbG9hZEltYWdlVGV4dHVyZShzcmMsIGRhdGEpOwogICAgdGV4dHVyZUNhY2hlW2hhc2hdLnRoZW4oaGFuZGxlSW1hZ2VUZXh0dXJlTG9hZGVkKTsKICB9LAoKICAvKioKICAgKiBIaWdoLWxldmVsIGZ1bmN0aW9uIGZvciBsb2FkaW5nIGNhbnZhcyB0ZXh0dXJlcyAoVEhSRUUuVGV4dHVyZSkuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR8c3RyaW5nfSBzcmMgLSBUZXh0dXJlIHNvdXJjZS4KICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIFRleHR1cmUgZGF0YS4KICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYiAtIENhbGxiYWNrIHRvIHBhc3MgdGV4dHVyZSB0by4KICAgKi8KICBsb2FkQ2FudmFzOiBmdW5jdGlvbiAoc3JjLCBkYXRhLCBjYikgewogICAgdmFyIHRleHR1cmU7CiAgICB0ZXh0dXJlID0gbmV3IFRIUkVFLkNhbnZhc1RleHR1cmUoc3JjKTsKICAgIHNldFRleHR1cmVQcm9wZXJ0aWVzKHRleHR1cmUsIGRhdGEpOwogICAgY2IodGV4dHVyZSk7CiAgfSwKCiAgICAvKioKICAgKiBMb2FkIHZpZGVvIHRleHR1cmUgKFRIUkVFLlZpZGVvVGV4dHVyZSkuCiAgICogV2hpY2ggaXMganVzdCBhbiBpbWFnZSB0ZXh0dXJlIHRoYXQgUkFGcyArIG5lZWRzVXBkYXRlLgogICAqIE5vdGUgdGhhdCBjcmVhdGluZyBhIHZpZGVvIHRleHR1cmUgaXMgc3luY2hyb25vdXMgdW5saWtlIGxvYWRpbmcgYW4gaW1hZ2UgdGV4dHVyZS4KICAgKiBNYWRlIGFzeW5jaHJvbm91cyB0byBiZSBjb25zaXN0ZW50IHdpdGggaW1hZ2UgdGV4dHVyZXMuCiAgICoKICAgKiBAcGFyYW0ge0VsZW1lbnR8c3RyaW5nfSBzcmMgLSBUZXh0dXJlIHNvdXJjZS4KICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIFRleHR1cmUgZGF0YS4KICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYiAtIENhbGxiYWNrIHRvIHBhc3MgdGV4dHVyZSB0by4KICAgKi8KICBsb2FkVmlkZW86IGZ1bmN0aW9uIChzcmMsIGRhdGEsIGNiKSB7CiAgICB2YXIgaGFzaDsKICAgIHZhciB0ZXh0dXJlOwogICAgdmFyIHRleHR1cmVDYWNoZSA9IHRoaXMudGV4dHVyZUNhY2hlOwogICAgdmFyIHZpZGVvRWw7CiAgICB2YXIgdmlkZW9UZXh0dXJlUmVzdWx0OwoKICAgIGZ1bmN0aW9uIGhhbmRsZVZpZGVvVGV4dHVyZUxvYWRlZCAocmVzdWx0KSB7CiAgICAgIHJlc3VsdC50ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgY2IocmVzdWx0LnRleHR1cmUsIHJlc3VsdC52aWRlb0VsKTsKICAgIH0KCiAgICAvLyBWaWRlbyBlbGVtZW50IHByb3ZpZGVkLgogICAgaWYgKHR5cGVvZiBzcmMgIT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIENoZWNrIGNhY2hlIGJlZm9yZSBjcmVhdGluZyB0ZXh0dXJlLgogICAgICB2aWRlb0VsID0gc3JjOwogICAgICBoYXNoID0gdGhpcy5oYXNoVmlkZW8oZGF0YSwgdmlkZW9FbCk7CiAgICAgIGlmICh0ZXh0dXJlQ2FjaGVbaGFzaF0pIHsKICAgICAgICB0ZXh0dXJlQ2FjaGVbaGFzaF0udGhlbihoYW5kbGVWaWRlb1RleHR1cmVMb2FkZWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAvLyBJZiBub3QgaW4gY2FjaGUsIGZpeCB1cCB0aGUgYXR0cmlidXRlcyB0aGVuIHN0YXJ0IHRvIGNyZWF0ZSB0aGUgdGV4dHVyZS4KICAgICAgZml4VmlkZW9BdHRyaWJ1dGVzKHZpZGVvRWwpOwogICAgfQoKICAgIC8vIE9ubHkgVVJMIHByb3ZpZGVkLiBVc2UgdmlkZW8gZWxlbWVudCB0byBjcmVhdGUgdGV4dHVyZS4KICAgIHZpZGVvRWwgPSB2aWRlb0VsIHx8IGNyZWF0ZVZpZGVvRWwoc3JjLCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCk7CgogICAgLy8gR2VuZXJhdGVkIHZpZGVvIGVsZW1lbnQgYWxyZWFkeSBjYWNoZWQuIFVzZSB0aGF0LgogICAgaGFzaCA9IHRoaXMuaGFzaFZpZGVvKGRhdGEsIHZpZGVvRWwpOwogICAgaWYgKHRleHR1cmVDYWNoZVtoYXNoXSkgewogICAgICB0ZXh0dXJlQ2FjaGVbaGFzaF0udGhlbihoYW5kbGVWaWRlb1RleHR1cmVMb2FkZWQpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQ3JlYXRlIG5ldyB2aWRlbyB0ZXh0dXJlLgogICAgdGV4dHVyZSA9IG5ldyBUSFJFRS5WaWRlb1RleHR1cmUodmlkZW9FbCk7CiAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjsKICAgIHNldFRleHR1cmVQcm9wZXJ0aWVzKHRleHR1cmUsIGRhdGEpOwoKICAgIC8vIElmIGlPUyBhbmQgdmlkZW8gaXMgSExTLCBkbyBzb21lIGhhY2tzLgogICAgaWYgKHRoaXMuc2NlbmVFbC5pc0lPUyAmJgogICAgICAgIGlzSExTKHZpZGVvRWwuc3JjIHx8IHZpZGVvRWwuZ2V0QXR0cmlidXRlKCdzcmMnKSwKICAgICAgICAgICAgICB2aWRlb0VsLnR5cGUgfHwgdmlkZW9FbC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSkpIHsKICAgICAgLy8gQWN0dWFsbHkgQkdSQS4gVGVsbCBzaGFkZXIgdG8gY29ycmVjdCBsYXRlci4KICAgICAgdGV4dHVyZS5mb3JtYXQgPSBUSFJFRS5SR0JBRm9ybWF0OwogICAgICB0ZXh0dXJlLm5lZWRzQ29ycmVjdGlvbkJHUkEgPSB0cnVlOwogICAgICAvLyBBcHBhcmVudGx5IG5lZWRlZCBmb3IgSExTLiBUZWxsIHNoYWRlciB0byBjb3JyZWN0IGxhdGVyLgogICAgICB0ZXh0dXJlLmZsaXBZID0gZmFsc2U7CiAgICAgIHRleHR1cmUubmVlZHNDb3JyZWN0aW9uRmxpcFkgPSB0cnVlOwogICAgfQoKICAgIC8vIENhY2hlIGFzIHByb21pc2UgdG8gYmUgY29uc2lzdGVudCB3aXRoIGltYWdlIHRleHR1cmUgY2FjaGluZy4KICAgIHZpZGVvVGV4dHVyZVJlc3VsdCA9IHt0ZXh0dXJlOiB0ZXh0dXJlLCB2aWRlb0VsOiB2aWRlb0VsfTsKICAgIHRleHR1cmVDYWNoZVtoYXNoXSA9IFByb21pc2UucmVzb2x2ZSh2aWRlb1RleHR1cmVSZXN1bHQpOwogICAgaGFuZGxlVmlkZW9UZXh0dXJlTG9hZGVkKHZpZGVvVGV4dHVyZVJlc3VsdCk7CiAgfSwKCiAgLyoqCiAgICogQ3JlYXRlIGEgaGFzaCBvZiB0aGUgbWF0ZXJpYWwgcHJvcGVydGllcyBmb3IgdGV4dHVyZSBjYWNoZSBrZXkuCiAgICovCiAgaGFzaDogZnVuY3Rpb24gKGRhdGEpIHsKICAgIGlmIChkYXRhLnNyYy50YWdOYW1lKSB7CiAgICAgIC8vIFNpbmNlIGBkYXRhLnNyY2AgY2FuIGJlIGFuIGVsZW1lbnQsIHBhcnNlIG91dCB0aGUgc3RyaW5nIGlmIG5lY2Vzc2FyeSBmb3IgdGhlIGhhc2guCiAgICAgIGRhdGEgPSB1dGlscy5leHRlbmREZWVwKHt9LCBkYXRhKTsKICAgICAgZGF0YS5zcmMgPSBkYXRhLnNyYy5zcmM7CiAgICB9CiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CiAgfSwKCiAgaGFzaFZpZGVvOiBmdW5jdGlvbiAoZGF0YSwgdmlkZW9FbCkgewogICAgcmV0dXJuIGNhbGN1bGF0ZVZpZGVvQ2FjaGVIYXNoKGRhdGEsIHZpZGVvRWwpOwogIH0sCgogIC8qKgogICAqIEtlZXAgdHJhY2sgb2YgbWF0ZXJpYWwgaW4gY2FzZSBhbiB1cGRhdGUgdHJpZ2dlciBpcyBuZWVkZWQgKGUuZy4sIGZvZykuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gbWF0ZXJpYWwKICAgKi8KICByZWdpc3Rlck1hdGVyaWFsOiBmdW5jdGlvbiAobWF0ZXJpYWwpIHsKICAgIHRoaXMubWF0ZXJpYWxzW21hdGVyaWFsLnV1aWRdID0gbWF0ZXJpYWw7CiAgfSwKCiAgLyoqCiAgICogU3RvcCB0cmFja2luZyBtYXRlcmlhbCwgYW5kIGRpc3Bvc2Ugb2YgYW55IHRleHR1cmVzIG5vdCBiZWluZyB1c2VkIGJ5CiAgICogYW5vdGhlciBtYXRlcmlhbCBjb21wb25lbnQuCiAgICoKICAgKiBAcGFyYW0ge29iamVjdH0gbWF0ZXJpYWwKICAgKi8KICB1bnJlZ2lzdGVyTWF0ZXJpYWw6IGZ1bmN0aW9uIChtYXRlcmlhbCkgewogICAgZGVsZXRlIHRoaXMubWF0ZXJpYWxzW21hdGVyaWFsLnV1aWRdOwoKICAgIC8vIElmIGFueSB0ZXh0dXJlcyBvbiB0aGlzIG1hdGVyaWFsIGFyZSBubyBsb25nZXIgaW4gdXNlLCBkaXNwb3NlIG9mIHRoZW0uCiAgICB2YXIgdGV4dHVyZUNvdW50cyA9IHRoaXMudGV4dHVyZUNvdW50czsKICAgIE9iamVjdC5rZXlzKG1hdGVyaWFsKQogICAgICAuZmlsdGVyKGZ1bmN0aW9uIChwcm9wTmFtZSkgewogICAgICAgIHJldHVybiBtYXRlcmlhbFtwcm9wTmFtZV0gJiYgbWF0ZXJpYWxbcHJvcE5hbWVdLmlzVGV4dHVyZTsKICAgICAgfSkKICAgICAgLmZvckVhY2goZnVuY3Rpb24gKG1hcE5hbWUpIHsKICAgICAgICB0ZXh0dXJlQ291bnRzW21hdGVyaWFsW21hcE5hbWVdLnV1aWRdLS07CiAgICAgICAgaWYgKHRleHR1cmVDb3VudHNbbWF0ZXJpYWxbbWFwTmFtZV0udXVpZF0gPD0gMCkgewogICAgICAgICAgbWF0ZXJpYWxbbWFwTmFtZV0uZGlzcG9zZSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgfSwKCiAgLyoqCiAgICogVHJpZ2dlciB1cGRhdGUgdG8gYWxsIHJlZ2lzdGVyZWQgbWF0ZXJpYWxzLgogICAqLwogIHVwZGF0ZU1hdGVyaWFsczogZnVuY3Rpb24gKG1hdGVyaWFsKSB7CiAgICB2YXIgbWF0ZXJpYWxzID0gdGhpcy5tYXRlcmlhbHM7CiAgICBPYmplY3Qua2V5cyhtYXRlcmlhbHMpLmZvckVhY2goZnVuY3Rpb24gKHV1aWQpIHsKICAgICAgbWF0ZXJpYWxzW3V1aWRdLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIH0pOwogIH0sCgogIC8qKgogICAqIFRyYWNrIHRleHR1cmVzIHVzZWQgYnkgbWF0ZXJpYWwgY29tcG9uZW50cywgc28gdGhhdCB0aGV5IGNhbiBiZSBzYWZlbHkKICAgKiBkaXNwb3NlZCB3aGVuIG5vIGxvbmdlciBpbiB1c2UuIFRleHR1cmVzIG11c3QgYmUgcmVnaXN0ZXJlZCBoZXJlLCBhbmQgbm90CiAgICogdGhyb3VnaCByZWdpc3Rlck1hdGVyaWFsKCksIGJlY2F1c2UgdGV4dHVyZXMgbWF5IG5vdCBiZSBhdHRhY2hlZCBhdCB0aGUKICAgKiB0aW1lIHRoZSBtYXRlcmlhbCBpcyByZWdpc3RlcmVkLgogICAqCiAgICogQHBhcmFtIHtFdmVudH0gZQogICAqLwogIG9uTWF0ZXJpYWxUZXh0dXJlTG9hZGVkOiBmdW5jdGlvbiAoZSkgewogICAgaWYgKCF0aGlzLnRleHR1cmVDb3VudHNbZS5kZXRhaWwudGV4dHVyZS51dWlkXSkgewogICAgICB0aGlzLnRleHR1cmVDb3VudHNbZS5kZXRhaWwudGV4dHVyZS51dWlkXSA9IDA7CiAgICB9CiAgICB0aGlzLnRleHR1cmVDb3VudHNbZS5kZXRhaWwudGV4dHVyZS51dWlkXSsrOwogIH0KfSk7CgovKioKICogQ2FsY3VsYXRlcyBjb25zaXN0ZW50IGhhc2ggZnJvbSBhIHZpZGVvIGVsZW1lbnQgdXNpbmcgaXRzIGF0dHJpYnV0ZXMuCiAqIElmIHRoZSB2aWRlbyBlbGVtZW50IGhhcyBhbiBJRCwgdXNlIHRoYXQuCiAqIEVsc2UgYnVpbGQgYSBoYXNoIHRoYXQgbG9va3MgbGlrZSBgc3JjOm15dmlkZW8ubXA0O2hlaWdodDoyMDA7d2lkdGg6NDAwO2AuCiAqCiAqIEBwYXJhbSBkYXRhIHtvYmplY3R9IC0gVGV4dHVyZSBkYXRhIHN1Y2ggYXMgcmVwZWF0LgogKiBAcGFyYW0gdmlkZW9FbCB7RWxlbWVudH0gLSBWaWRlbyBlbGVtZW50LgogKiBAcmV0dXJucyB7c3RyaW5nfQogKi8KZnVuY3Rpb24gY2FsY3VsYXRlVmlkZW9DYWNoZUhhc2ggKGRhdGEsIHZpZGVvRWwpIHsKICB2YXIgaTsKICB2YXIgaWQgPSB2aWRlb0VsLmdldEF0dHJpYnV0ZSgnaWQnKTsKICB2YXIgaGFzaDsKICB2YXIgdmlkZW9BdHRyaWJ1dGVzOwoKICBpZiAoaWQpIHsgcmV0dXJuIGlkOyB9CgogIC8vIENhbGN1bGF0ZSBoYXNoIHVzaW5nIHNvcnRlZCB2aWRlbyBhdHRyaWJ1dGVzLgogIGhhc2ggPSAnJzsKICB2aWRlb0F0dHJpYnV0ZXMgPSBkYXRhIHx8IHt9OwogIGZvciAoaSA9IDA7IGkgPCB2aWRlb0VsLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgIHZpZGVvQXR0cmlidXRlc1t2aWRlb0VsLmF0dHJpYnV0ZXNbaV0ubmFtZV0gPSB2aWRlb0VsLmF0dHJpYnV0ZXNbaV0udmFsdWU7CiAgfQogIE9iamVjdC5rZXlzKHZpZGVvQXR0cmlidXRlcykuc29ydCgpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgIGhhc2ggKz0gbmFtZSArICc6JyArIHZpZGVvQXR0cmlidXRlc1tuYW1lXSArICc7JzsKICB9KTsKCiAgcmV0dXJuIGhhc2g7Cn0KCi8qKgogKiBMb2FkIGltYWdlIHRleHR1cmUuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gc3JjIC0gQW4gPGltZz4gZWxlbWVudCBvciB1cmwgdG8gYW4gaW1hZ2UgZmlsZS4KICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBEYXRhIHRvIHNldCB0ZXh0dXJlIHByb3BlcnRpZXMgbGlrZSBgcmVwZWF0YC4KICogQHJldHVybnMge1Byb21pc2V9IFJlc29sdmVzIG9uY2UgdGV4dHVyZSBpcyBsb2FkZWQuCiAqLwpmdW5jdGlvbiBsb2FkSW1hZ2VUZXh0dXJlIChzcmMsIGRhdGEpIHsKICByZXR1cm4gbmV3IFByb21pc2UoZG9Mb2FkSW1hZ2VUZXh0dXJlKTsKCiAgZnVuY3Rpb24gZG9Mb2FkSW1hZ2VUZXh0dXJlIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHZhciBpc0VsID0gdHlwZW9mIHNyYyAhPT0gJ3N0cmluZyc7CgogICAgZnVuY3Rpb24gcmVzb2x2ZVRleHR1cmUgKHRleHR1cmUpIHsKICAgICAgc2V0VGV4dHVyZVByb3BlcnRpZXModGV4dHVyZSwgZGF0YSk7CiAgICAgIHRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICByZXNvbHZlKHRleHR1cmUpOwogICAgfQoKICAgIC8vIENyZWF0ZSB0ZXh0dXJlIGZyb20gYW4gZWxlbWVudC4KICAgIGlmIChpc0VsKSB7CiAgICAgIHJlc29sdmVUZXh0dXJlKG5ldyBUSFJFRS5UZXh0dXJlKHNyYykpOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gUmVxdWVzdCBhbmQgbG9hZCB0ZXh0dXJlIGZyb20gc3JjIHN0cmluZy4gVEhSRUUgd2lsbCBjcmVhdGUgdW5kZXJseWluZyBlbGVtZW50LgogICAgLy8gVXNlIFRIUkVFLlRleHR1cmVMb2FkZXIgKHNyYywgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yKSB0byBsb2FkIHRleHR1cmUuCiAgICBUZXh0dXJlTG9hZGVyLmxvYWQoCiAgICAgIHNyYywKICAgICAgcmVzb2x2ZVRleHR1cmUsCiAgICAgIGZ1bmN0aW9uICgpIHsgLyogbm8tb3AgKi8gfSwKICAgICAgZnVuY3Rpb24gKHhocikgewogICAgICAgIGVycm9yKCdgJHNgIGNvdWxkIG5vdCBiZSBmZXRjaGVkIChFcnJvciBjb2RlOiAlczsgUmVzcG9uc2U6ICVzKScsIHhoci5zdGF0dXMsCiAgICAgICAgICAgICAgeGhyLnN0YXR1c1RleHQpOwogICAgICB9CiAgICApOwogIH0KfQoKLyoqCiAqIFNldCB0ZXh0dXJlIHByb3BlcnRpZXMgc3VjaCBhcyByZXBlYXQgYW5kIG9mZnNldC4KICoKICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBXaXRoIGtleXMgbGlrZSBgcmVwZWF0YC4KICovCmZ1bmN0aW9uIHNldFRleHR1cmVQcm9wZXJ0aWVzICh0ZXh0dXJlLCBkYXRhKSB7CiAgdmFyIG9mZnNldCA9IGRhdGEub2Zmc2V0IHx8IHt4OiAwLCB5OiAwfTsKICB2YXIgcmVwZWF0ID0gZGF0YS5yZXBlYXQgfHwge3g6IDEsIHk6IDF9OwogIHZhciBucG90ID0gZGF0YS5ucG90IHx8IGZhbHNlOwoKICAvLyBUbyBzdXBwb3J0IE5QT1QgdGV4dHVyZXMsIHdyYXAgbXVzdCBiZSBDbGFtcFRvRWRnZSAobm90IFJlcGVhdCksCiAgLy8gYW5kIGZpbHRlcnMgbXVzdCBub3QgdXNlIG1pcG1hcHMgKGkuZS4gTmVhcmVzdCBvciBMaW5lYXIpLgogIGlmIChucG90KSB7CiAgICB0ZXh0dXJlLndyYXBTID0gVEhSRUUuQ2xhbXBUb0VkZ2VXcmFwcGluZzsKICAgIHRleHR1cmUud3JhcFQgPSBUSFJFRS5DbGFtcFRvRWRnZVdyYXBwaW5nOwogICAgdGV4dHVyZS5tYWdGaWx0ZXIgPSBUSFJFRS5MaW5lYXJGaWx0ZXI7CiAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjsKICB9CgogIC8vIERvbid0IGJvdGhlciBzZXR0aW5nIHJlcGVhdCBpZiBpdCBpcyAxLzEuIFBvd2VyLW9mLXR3byBpcyByZXF1aXJlZCB0byByZXBlYXQuCiAgaWYgKHJlcGVhdC54ICE9PSAxIHx8IHJlcGVhdC55ICE9PSAxKSB7CiAgICB0ZXh0dXJlLndyYXBTID0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7CiAgICB0ZXh0dXJlLndyYXBUID0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7CiAgICB0ZXh0dXJlLnJlcGVhdC5zZXQocmVwZWF0LngsIHJlcGVhdC55KTsKICB9CiAgLy8gRG9uJ3QgYm90aGVyIHNldHRpbmcgb2Zmc2V0IGlmIGl0IGlzIDAvMC4KICBpZiAob2Zmc2V0LnggIT09IDAgfHwgb2Zmc2V0LnkgIT09IDApIHsKICAgIHRleHR1cmUub2Zmc2V0LnNldChvZmZzZXQueCwgb2Zmc2V0LnkpOwogIH0KfQoKLyoqCiAqIENyZWF0ZSB2aWRlbyBlbGVtZW50IHRvIGJlIHVzZWQgYXMgYSB0ZXh0dXJlLgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3JjIC0gVXJsIHRvIGEgdmlkZW8gZmlsZS4KICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gV2lkdGggb2YgdGhlIHZpZGVvLgogKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gSGVpZ2h0IG9mIHRoZSB2aWRlby4KICogQHJldHVybnMge0VsZW1lbnR9IFZpZGVvIGVsZW1lbnQuCiAqLwpmdW5jdGlvbiBjcmVhdGVWaWRlb0VsIChzcmMsIHdpZHRoLCBoZWlnaHQpIHsKICB2YXIgdmlkZW9FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7CiAgdmlkZW9FbC53aWR0aCA9IHdpZHRoOwogIHZpZGVvRWwuaGVpZ2h0ID0gaGVpZ2h0OwogIC8vIFN1cHBvcnQgaW5saW5lIHZpZGVvcyBmb3IgaU9TIHdlYnZpZXdzLgogIHZpZGVvRWwuc2V0QXR0cmlidXRlKCdwbGF5c2lubGluZScsICcnKTsKICB2aWRlb0VsLnNldEF0dHJpYnV0ZSgnd2Via2l0LXBsYXlzaW5saW5lJywgJycpOwogIHZpZGVvRWwuYXV0b3BsYXkgPSB0cnVlOwogIHZpZGVvRWwubG9vcCA9IHRydWU7CiAgdmlkZW9FbC5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOwogIHZpZGVvRWwuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbiAoKSB7CiAgICB3YXJuKCdgJHNgIGlzIG5vdCBhIHZhbGlkIHZpZGVvJywgc3JjKTsKICB9LCB0cnVlKTsKICB2aWRlb0VsLnNyYyA9IHNyYzsKICByZXR1cm4gdmlkZW9FbDsKfQoKLyoqCiAqIEZpeGVzIGEgdmlkZW8gZWxlbWVudCdzIGF0dHJpYnV0ZXMgdG8gcHJldmVudCBkZXZlbG9wZXJzIGZyb20gYWNjaWRlbnRhbGx5IHBhc3NpbmcgdGhlCiAqIHdyb25nIGF0dHJpYnV0ZSB2YWx1ZXMgdG8gY29tbW9ubHkgbWlzdXNlZCB2aWRlbyBhdHRyaWJ1dGVzLgogKgogKiA8dmlkZW8+IGRvZXMgbm90IHRyZWF0IGBhdXRvcGxheWAsIGBjb250cm9sc2AsIGBjcm9zc29yaWdpbmAsIGBsb29wYCwgYW5kIGBwcmVsb2FkYCBhcwogKiBhcyBib29sZWFucy4gRXhpc3RlbmNlIG9mIHRob3NlIGF0dHJpYnV0ZXMgd2lsbCBtZWFuIHRydXRoeS4KICoKICogRm9yIGV4YW1wbGUsIHRyYW5zbGF0ZXMgPHZpZGVvIGxvb3A9ImZhbHNlIj4gdG8gPHZpZGVvPi4KICoKICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9IVE1ML0VsZW1lbnQvdmlkZW8jQXR0cmlidXRlcwogKiBAcGFyYW0ge0VsZW1lbnR9IHZpZGVvRWwgLSBWaWRlbyBlbGVtZW50LgogKiBAcmV0dXJucyB7RWxlbWVudH0gVmlkZW8gZWxlbWVudCB3aXRoIHRoZSBjb3JyZWN0IHByb3BlcnRpZXMgdXBkYXRlZC4KICovCmZ1bmN0aW9uIGZpeFZpZGVvQXR0cmlidXRlcyAodmlkZW9FbCkgewogIHZpZGVvRWwuYXV0b3BsYXkgPSB2aWRlb0VsLmhhc0F0dHJpYnV0ZSgnYXV0b3BsYXknKSAmJiB2aWRlb0VsLmdldEF0dHJpYnV0ZSgnYXV0b3BsYXknKSAhPT0gJ2ZhbHNlJzsKICB2aWRlb0VsLmNvbnRyb2xzID0gdmlkZW9FbC5oYXNBdHRyaWJ1dGUoJ2NvbnRyb2xzJykgJiYgdmlkZW9FbC5nZXRBdHRyaWJ1dGUoJ2NvbnRyb2xzJykgIT09ICdmYWxzZSc7CiAgaWYgKHZpZGVvRWwuZ2V0QXR0cmlidXRlKCdsb29wJykgPT09ICdmYWxzZScpIHsKICAgIHZpZGVvRWwucmVtb3ZlQXR0cmlidXRlKCdsb29wJyk7CiAgfQogIGlmICh2aWRlb0VsLmdldEF0dHJpYnV0ZSgncHJlbG9hZCcpID09PSAnZmFsc2UnKSB7CiAgICB2aWRlb0VsLnByZWxvYWQgPSAnbm9uZSc7CiAgfQogIHZpZGVvRWwuY3Jvc3NPcmlnaW4gPSB2aWRlb0VsLmNyb3NzT3JpZ2luIHx8ICdhbm9ueW1vdXMnOwogIC8vIFRvIHN1cHBvcnQgaW5saW5lIHZpZGVvcyBpbiBpT1Mgd2Vidmlld3MuCiAgdmlkZW9FbC5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgJycpOwogIHZpZGVvRWwuc2V0QXR0cmlidXRlKCd3ZWJraXQtcGxheXNpbmxpbmUnLCAnJyk7CiAgcmV0dXJuIHZpZGVvRWw7Cn0KCn0seyIuLi9jb3JlL3N5c3RlbSI6MTE3LCIuLi9saWIvdGhyZWUiOjE1NCwiLi4vdXRpbHMvIjoxNzksIi4uL3V0aWxzL21hdGVyaWFsIjoxODJ9XSwxNjk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewp2YXIgcmVnaXN0ZXJTeXN0ZW0gPSBfZGVyZXFfKCcuLi9jb3JlL3N5c3RlbScpLnJlZ2lzdGVyU3lzdGVtOwp2YXIgdXRpbHMgPSBfZGVyZXFfKCcuLi91dGlscy8nKTsKdmFyIFRIUkVFID0gX2RlcmVxXygnLi4vbGliL3RocmVlJyk7Cgp2YXIgZGVidWcgPSB1dGlscy5kZWJ1ZzsKdmFyIHdhcm4gPSBkZWJ1ZygnY29tcG9uZW50czpyZW5kZXJlcjp3YXJuJyk7CgovKioKICogRGV0ZXJtaW5lcyBzdGF0ZSBvZiB2YXJpb3VzIHJlbmRlcmVyIHByb3BlcnRpZXMuCiAqLwptb2R1bGUuZXhwb3J0cy5TeXN0ZW0gPSByZWdpc3RlclN5c3RlbSgncmVuZGVyZXInLCB7CiAgc2NoZW1hOiB7CiAgICBhbnRpYWxpYXM6IHtkZWZhdWx0OiAnYXV0bycsIG9uZU9mOiBbJ3RydWUnLCAnZmFsc2UnLCAnYXV0byddfSwKICAgIGhpZ2hSZWZyZXNoUmF0ZToge2RlZmF1bHQ6IGZhbHNlfSwKICAgIGxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IHtkZWZhdWx0OiAnYXV0bycsIG9uZU9mOiBbJ3RydWUnLCAnZmFsc2UnLCAnYXV0byddfSwKICAgIG1heENhbnZhc1dpZHRoOiB7ZGVmYXVsdDogMTkyMH0sCiAgICBtYXhDYW52YXNIZWlnaHQ6IHtkZWZhdWx0OiAxOTIwfSwKICAgIHBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzOiB7ZGVmYXVsdDogZmFsc2V9LAogICAgcHJlY2lzaW9uOiB7ZGVmYXVsdDogJ2hpZ2gnLCBvbmVPZjogWydoaWdoJywgJ21lZGl1bScsICdsb3cnXX0sCiAgICBzb3J0T2JqZWN0czoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIGNvbG9yTWFuYWdlbWVudDoge2RlZmF1bHQ6IGZhbHNlfSwKICAgIGdhbW1hT3V0cHV0OiB7ZGVmYXVsdDogZmFsc2V9LAogICAgYWxwaGE6IHtkZWZhdWx0OiB0cnVlfSwKICAgIGZvdmVhdGlvbkxldmVsOiB7ZGVmYXVsdDogMH0KICB9LAoKICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5lbDsKICAgIC8vIFRoaXMgaXMgdGhlIHJlbmRlcmluZyBlbmdpbmUsIHN1Y2ggYXMgVEhSRUUuanMgc28gY29weSBvdmVyIGFueSBwZXJzaXN0ZW50IHByb3BlcnRpZXMgZnJvbSB0aGUgcmVuZGVyaW5nIHN5c3RlbS4KICAgIHZhciByZW5kZXJlciA9IHNjZW5lRWwucmVuZGVyZXI7CgogICAgcmVuZGVyZXIuc29ydE9iamVjdHMgPSBkYXRhLnNvcnRPYmplY3RzOwogICAgcmVuZGVyZXIucGh5c2ljYWxseUNvcnJlY3RMaWdodHMgPSBkYXRhLnBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzOwoKICAgIGlmIChkYXRhLmNvbG9yTWFuYWdlbWVudCB8fCBkYXRhLmdhbW1hT3V0cHV0KSB7CiAgICAgIHJlbmRlcmVyLmdhbW1hT3V0cHV0ID0gdHJ1ZTsKICAgICAgcmVuZGVyZXIuZ2FtbWFGYWN0b3IgPSAyLjI7CiAgICAgIGlmIChkYXRhLmdhbW1hT3V0cHV0KSB7CiAgICAgICAgd2FybignUHJvcGVydHkgYGdhbW1hT3V0cHV0YCBpcyBkZXByZWNhdGVkLiBVc2UgYHJlbmRlcmVyPSJjb2xvck1hbmFnZW1lbnQ6IHRydWU7ImAgaW5zdGVhZC4nKTsKICAgICAgfQogICAgfQoKICAgIGlmIChzY2VuZUVsLmhhc0F0dHJpYnV0ZSgnYW50aWFsaWFzJykpIHsKICAgICAgd2FybignQ29tcG9uZW50IGBhbnRpYWxpYXNgIGlzIGRlcHJlY2F0ZWQuIFVzZSBgcmVuZGVyZXI9ImFudGlhbGlhczogdHJ1ZSJgIGluc3RlYWQuJyk7CiAgICB9CgogICAgaWYgKHNjZW5lRWwuaGFzQXR0cmlidXRlKCdsb2dhcml0aG1pY0RlcHRoQnVmZmVyJykpIHsKICAgICAgd2FybignQ29tcG9uZW50IGBsb2dhcml0aG1pY0RlcHRoQnVmZmVyYCBpcyBkZXByZWNhdGVkLiBVc2UgYHJlbmRlcmVyPSJsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiB0cnVlImAgaW5zdGVhZC4nKTsKICAgIH0KICB9LAoKICBhcHBseUNvbG9yQ29ycmVjdGlvbjogZnVuY3Rpb24gKGNvbG9yT3JUZXh0dXJlKSB7CiAgICBpZiAoIXRoaXMuZGF0YS5jb2xvck1hbmFnZW1lbnQgfHwgIWNvbG9yT3JUZXh0dXJlKSB7CiAgICAgIHJldHVybjsKICAgIH0gZWxzZSBpZiAoY29sb3JPclRleHR1cmUuaXNDb2xvcikgewogICAgICBjb2xvck9yVGV4dHVyZS5jb252ZXJ0U1JHQlRvTGluZWFyKCk7CiAgICB9IGVsc2UgaWYgKGNvbG9yT3JUZXh0dXJlLmlzVGV4dHVyZSkgewogICAgICBjb2xvck9yVGV4dHVyZS5lbmNvZGluZyA9IFRIUkVFLnNSR0JFbmNvZGluZzsKICAgIH0KICB9Cn0pOwoKfSx7Ii4uL2NvcmUvc3lzdGVtIjoxMTcsIi4uL2xpYi90aHJlZSI6MTU0LCIuLi91dGlscy8iOjE3OX1dLDE3MDpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlclN5c3RlbSA9IF9kZXJlcV8oJy4uL2NvcmUvc3lzdGVtJykucmVnaXN0ZXJTeXN0ZW07CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKdmFyIFNIQURPV19NQVBfVFlQRV9NQVAgPSB7CiAgYmFzaWM6IFRIUkVFLkJhc2ljU2hhZG93TWFwLAogIHBjZjogVEhSRUUuUENGU2hhZG93TWFwLAogIHBjZnNvZnQ6IFRIUkVFLlBDRlNvZnRTaGFkb3dNYXAKfTsKCi8qKgogKiBTaGFkb3cgc3lzdGVtLgogKgogKiBFbmFibGVkIGF1dG9tYXRpY2FsbHkgd2hlbiBvbmUgb3IgbW9yZSBzaGFkb3cgY29tcG9uZW50cyBhcmUgYWRkZWQgdG8gdGhlIHNjZW5lLCB0aGUgc3lzdGVtIHNldHMKICogb3B0aW9ucyBvbiB0aGUgV2ViR0xSZW5kZXJlciBmb3IgY29uZmlndXJpbmcgc2hhZG93IGFwcGVhcmFuY2UuCiAqLwptb2R1bGUuZXhwb3J0cy5TeXN0ZW0gPSByZWdpc3RlclN5c3RlbSgnc2hhZG93JywgewogIHNjaGVtYTogewogICAgZW5hYmxlZDoge2RlZmF1bHQ6IHRydWV9LAogICAgYXV0b1VwZGF0ZToge2RlZmF1bHQ6IHRydWV9LAogICAgdHlwZToge2RlZmF1bHQ6ICdwY2YnLCBvbmVPZjogWydiYXNpYycsICdwY2YnLCAncGNmc29mdCddfQogIH0sCgogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzY2VuZUVsID0gdGhpcy5zY2VuZUVsOwogICAgdmFyIGRhdGEgPSB0aGlzLmRhdGE7CgogICAgdGhpcy5zaGFkb3dNYXBFbmFibGVkID0gZmFsc2U7CgogICAgaWYgKCFzY2VuZUVsLnJlbmRlcmVyKSB7IHJldHVybjsgfSAgLy8gRm9yIHRlc3RzLgoKICAgIHNjZW5lRWwucmVuZGVyZXIuc2hhZG93TWFwLnR5cGUgPSBTSEFET1dfTUFQX1RZUEVfTUFQW2RhdGEudHlwZV07CiAgICBzY2VuZUVsLnJlbmRlcmVyLnNoYWRvd01hcC5hdXRvVXBkYXRlID0gZGF0YS5hdXRvVXBkYXRlOwogICAgdGhpcy5zZXRTaGFkb3dNYXBFbmFibGVkKHRoaXMuc2hhZG93TWFwRW5hYmxlZCk7CiAgfSwKCiAgdXBkYXRlOiBmdW5jdGlvbiAocHJldkRhdGEpIHsKICAgIGlmIChwcmV2RGF0YS5lbmFibGVkICE9PSB0aGlzLmRhdGEuZW5hYmxlZCkgewogICAgICB0aGlzLnNldFNoYWRvd01hcEVuYWJsZWQodGhpcy5kYXRhLmVuYWJsZWQpOwogICAgfQogIH0sCgogIC8qKgogICAqIEVuYWJsZXMvZGlzYWJsZXMgdGhlIHJlbmRlcmVyIHNoYWRvdyBtYXAuCiAgICogQHBhcmFtIHtib29sZWFufSBlbmFibGVkCiAgICovCiAgc2V0U2hhZG93TWFwRW5hYmxlZDogZnVuY3Rpb24gKGVuYWJsZWQpIHsKICAgIHZhciByZW5kZXJlciA9IHRoaXMuc2NlbmVFbC5yZW5kZXJlcjsKICAgIHRoaXMuc2hhZG93TWFwRW5hYmxlZCA9IHRoaXMuZGF0YS5lbmFibGVkICYmIGVuYWJsZWQ7CiAgICBpZiAocmVuZGVyZXIpIHsKICAgICAgcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgPSB0aGlzLnNoYWRvd01hcEVuYWJsZWQ7CiAgICB9CiAgfQp9KTsKCn0seyIuLi9jb3JlL3N5c3RlbSI6MTE3LCIuLi9saWIvdGhyZWUiOjE1NH1dLDE3MTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWdpc3RlclN5c3RlbSA9IF9kZXJlcV8oJy4uL2NvcmUvc3lzdGVtJykucmVnaXN0ZXJTeXN0ZW07CnZhciB1dGlscyA9IF9kZXJlcV8oJy4uL3V0aWxzJyk7CgovKioKICogVHJhY2tlZCBjb250cm9scyBzeXN0ZW0uCiAqIE1haW50YWluIGxpc3Qgd2l0aCBhdmFpbGFibGUgdHJhY2tlZCBjb250cm9sbGVycy4KICovCm1vZHVsZS5leHBvcnRzLlN5c3RlbSA9IHJlZ2lzdGVyU3lzdGVtKCd0cmFja2VkLWNvbnRyb2xzLXdlYnZyJywgewogIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICB0aGlzLmNvbnRyb2xsZXJzID0gW107CiAgICB0aGlzLmlzQ2hyb21lID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUnKSAhPT0gLTE7CgogICAgdGhpcy51cGRhdGVDb250cm9sbGVyTGlzdCgpOwogICAgdGhpcy50aHJvdHRsZWRVcGRhdGVDb250cm9sbGVyTGlzdCA9IHV0aWxzLnRocm90dGxlKHRoaXMudXBkYXRlQ29udHJvbGxlckxpc3QsIDUwMCwgdGhpcyk7CgogICAgaWYgKCFuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cykgeyByZXR1cm47IH0KCiAgICB0aGlzLnNjZW5lRWwuYWRkRXZlbnRMaXN0ZW5lcignZW50ZXItdnInLCBmdW5jdGlvbiAoKSB7CiAgICAgIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKCkudGhlbihmdW5jdGlvbiAoZGlzcGxheXMpIHsKICAgICAgICBpZiAoZGlzcGxheXMubGVuZ3RoKSB7IHNlbGYudnJEaXNwbGF5ID0gZGlzcGxheXNbMF07IH0KICAgICAgfSk7CiAgICB9KTsKICB9LAoKICB0aWNrOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5pc0Nocm9tZSkgewogICAgICAvLyBSZXRyaWV2ZSBuZXcgY29udHJvbGxlciBoYW5kbGVycyB3aXRoIHVwZGF0ZWQgc3RhdGUgKHBvc2UsIGJ1dHRvbnMuLi4pCiAgICAgIHRoaXMudXBkYXRlQ29udHJvbGxlckxpc3QoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudGhyb3R0bGVkVXBkYXRlQ29udHJvbGxlckxpc3QoKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBVcGRhdGUgY29udHJvbGxlciBsaXN0LgogICAqLwogIHVwZGF0ZUNvbnRyb2xsZXJMaXN0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzOwogICAgdmFyIGdhbWVwYWQ7CiAgICB2YXIgZ2FtZXBhZHM7CiAgICB2YXIgaTsKICAgIHZhciBwcmV2Q291bnQ7CgogICAgZ2FtZXBhZHMgPSBuYXZpZ2F0b3IuZ2V0R2FtZXBhZHMgJiYgbmF2aWdhdG9yLmdldEdhbWVwYWRzKCk7CiAgICBpZiAoIWdhbWVwYWRzKSB7IHJldHVybjsgfQoKICAgIHByZXZDb3VudCA9IGNvbnRyb2xsZXJzLmxlbmd0aDsKICAgIGNvbnRyb2xsZXJzLmxlbmd0aCA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgZ2FtZXBhZHMubGVuZ3RoOyArK2kpIHsKICAgICAgZ2FtZXBhZCA9IGdhbWVwYWRzW2ldOwogICAgICBpZiAoZ2FtZXBhZCAmJiBnYW1lcGFkLnBvc2UpIHsKICAgICAgICBjb250cm9sbGVycy5wdXNoKGdhbWVwYWQpOwogICAgICB9CiAgICB9CgogICAgaWYgKGNvbnRyb2xsZXJzLmxlbmd0aCAhPT0gcHJldkNvdW50KSB7CiAgICAgIHRoaXMuZWwuZW1pdCgnY29udHJvbGxlcnN1cGRhdGVkJywgdW5kZWZpbmVkLCBmYWxzZSk7CiAgICB9CiAgfQp9KTsKCn0seyIuLi9jb3JlL3N5c3RlbSI6MTE3LCIuLi91dGlscyI6MTc5fV0sMTcyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKdmFyIHJlZ2lzdGVyU3lzdGVtID0gX2RlcmVxXygnLi4vY29yZS9zeXN0ZW0nKS5yZWdpc3RlclN5c3RlbTsKdmFyIHV0aWxzID0gX2RlcmVxXygnLi4vdXRpbHMnKTsKCi8qKgogKiBUcmFja2VkIGNvbnRyb2xzIHN5c3RlbS4KICogTWFpbnRhaW4gbGlzdCB3aXRoIGF2YWlsYWJsZSB0cmFja2VkIGNvbnRyb2xsZXJzLgogKi8KbW9kdWxlLmV4cG9ydHMuU3lzdGVtID0gcmVnaXN0ZXJTeXN0ZW0oJ3RyYWNrZWQtY29udHJvbHMtd2VieHInLCB7CiAgaW5pdDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5jb250cm9sbGVycyA9IFtdOwogICAgdGhpcy50aHJvdHRsZWRVcGRhdGVDb250cm9sbGVyTGlzdCA9IHV0aWxzLnRocm90dGxlKHRoaXMudXBkYXRlQ29udHJvbGxlckxpc3QsIDUwMCwgdGhpcyk7CiAgfSwKCiAgdGljazogZnVuY3Rpb24gKCkgewogICAgdGhpcy50aHJvdHRsZWRVcGRhdGVDb250cm9sbGVyTGlzdCgpOwogIH0sCgogIHVwZGF0ZUNvbnRyb2xsZXJMaXN0OiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgb2xkQ29udHJvbGxlcnNMZW5ndGggPSB0aGlzLmNvbnRyb2xsZXJzLmxlbmd0aDsKICAgIGlmICghdGhpcy5lbC54clNlc3Npb24pIHsgcmV0dXJuOyB9CiAgICB0aGlzLmNvbnRyb2xsZXJzID0gdGhpcy5lbC54clNlc3Npb24uZ2V0SW5wdXRTb3VyY2VzKCk7CiAgICBpZiAob2xkQ29udHJvbGxlcnNMZW5ndGggPT09IHRoaXMuY29udHJvbGxlcnMubGVuZ3RoKSB7IHJldHVybjsgfQogICAgdGhpcy5lbC5lbWl0KCdjb250cm9sbGVyc3VwZGF0ZWQnLCB1bmRlZmluZWQsIGZhbHNlKTsKICB9Cn0pOwoKfSx7Ii4uL2NvcmUvc3lzdGVtIjoxMTcsIi4uL3V0aWxzIjoxNzl9XSwxNzM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogRmFzdGVyIHZlcnNpb24gb2YgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBGdW5jdGlvbiB0byB3cmFwLgogKiBAcGFyYW0ge09iamVjdH0gY3R4IC0gV2hhdCB0byBiaW5kIGFzIGNvbnRleHQuCiAqIEBwYXJhbSB7Li4uKn0gYXJndW1lbnRzIC0gQXJndW1lbnRzIHRvIHBhc3MgdGhyb3VnaC4KICovCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYmluZCAoZm4sIGN0eC8qICwgYXJnMSwgYXJnMiAqLykgewogIHJldHVybiAoZnVuY3Rpb24gKHByZXBlbmRlZEFyZ3MpIHsKICAgIHJldHVybiBmdW5jdGlvbiBib3VuZCAoKSB7CiAgICAgIC8vIENvbmNhdCB0aGUgYm91bmQgZnVuY3Rpb24gYXJndW1lbnRzIHdpdGggdGhvc2UgcGFzc2VkIHRvIG9yaWdpbmFsIGJpbmQKICAgICAgdmFyIGFyZ3MgPSBwcmVwZW5kZWRBcmdzLmNvbmNhdChBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgcmV0dXJuIGZuLmFwcGx5KGN0eCwgYXJncyk7CiAgICB9OwogIH0pKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMikpOwp9OwoKfSx7fV0sMTc0OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyogZ2xvYmFsIFRIUkVFICovCnZhciBkZWJ1ZyA9IF9kZXJlcV8oJy4vZGVidWcnKTsKdmFyIGV4dGVuZCA9IF9kZXJlcV8oJ29iamVjdC1hc3NpZ24nKTsKCnZhciB3YXJuID0gZGVidWcoJ3V0aWxzOmNvb3JkaW5hdGVzOndhcm4nKTsKCi8vIE9yZGVyIG9mIGNvb3JkaW5hdGVzIHBhcnNlZCBieSBjb29yZGluYXRlcy5wYXJzZS4KdmFyIENPT1JESU5BVEVfS0VZUyA9IFsneCcsICd5JywgJ3onLCAndyddOwoKLy8gQ29vcmRpbmF0ZSBzdHJpbmcgcmVnZXguIEhhbmRsZXMgbmVnYXRpdmUsIHBvc2l0aXZlLCBhbmQgZGVjaW1hbHMuCnZhciByZWdleCA9IC9eXHMqKCgtP1xkKlwuezAsMX1cZCsoZS0/XGQrKT8pXHMrKXsyLDN9KC0/XGQqXC57MCwxfVxkKyhlLT9cZCspPylccyokLzsKbW9kdWxlLmV4cG9ydHMucmVnZXggPSByZWdleDsKCnZhciBPQkpFQ1QgPSAnb2JqZWN0JzsKdmFyIHdoaXRlc3BhY2VSZWdleCA9IC9ccysvZzsKCi8qKgogKiBQYXJzZXMgY29vcmRpbmF0ZXMgZnJvbSBhbiAieCB5IHoiIHN0cmluZy4KICogRXhhbXBsZTogIjMgMTAgLTUiIHRvIHt4OiAzLCB5OiAxMCwgejogLTV9LgogKgogKiBAcGFyYW0ge3N0cmluZ30gdmFsIC0gQW4gInggeSB6IiBzdHJpbmcuCiAqIEBwYXJhbSB7c3RyaW5nfSBkZWZhdWx0cyAtIGZhbGxiYWNrIHZhbHVlLgogKiBAcmV0dXJucyB7b2JqZWN0fSBBbiBvYmplY3Qgd2l0aCBrZXlzIFt4LCB5LCB6XS4KICovCmZ1bmN0aW9uIHBhcnNlICh2YWx1ZSwgZGVmYXVsdFZlYykgewogIHZhciBjb29yZGluYXRlOwogIHZhciBkZWZhdWx0VmFsOwogIHZhciBrZXk7CiAgdmFyIGk7CiAgdmFyIHZlYzsKICB2YXIgeDsKICB2YXIgeTsKICB2YXIgejsKICB2YXIgdzsKCiAgaWYgKHZhbHVlICYmIHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICB4ID0gdmFsdWUueCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZlYyAmJiBkZWZhdWx0VmVjLnggOiB2YWx1ZS54OwogICAgeSA9IHZhbHVlLnkgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRWZWMgJiYgZGVmYXVsdFZlYy55IDogdmFsdWUueTsKICAgIHogPSB2YWx1ZS56ID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmVjICYmIGRlZmF1bHRWZWMueiA6IHZhbHVlLno7CiAgICB3ID0gdmFsdWUudyA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZlYyAmJiBkZWZhdWx0VmVjLncgOiB2YWx1ZS53OwogICAgaWYgKHggIT09IHVuZGVmaW5lZCAmJiB4ICE9PSBudWxsKSB7IHZhbHVlLnggPSBwYXJzZUlmU3RyaW5nKHgpOyB9CiAgICBpZiAoeSAhPT0gdW5kZWZpbmVkICYmIHkgIT09IG51bGwpIHsgdmFsdWUueSA9IHBhcnNlSWZTdHJpbmcoeSk7IH0KICAgIGlmICh6ICE9PSB1bmRlZmluZWQgJiYgeiAhPT0gbnVsbCkgeyB2YWx1ZS56ID0gcGFyc2VJZlN0cmluZyh6KTsgfQogICAgaWYgKHcgIT09IHVuZGVmaW5lZCAmJiB3ICE9PSBudWxsKSB7IHZhbHVlLncgPSBwYXJzZUlmU3RyaW5nKHcpOyB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQoKICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHR5cGVvZiBkZWZhdWx0VmVjID09PSBPQkpFQ1QgPyBleHRlbmQoe30sIGRlZmF1bHRWZWMpIDogZGVmYXVsdFZlYzsKICB9CgogIGNvb3JkaW5hdGUgPSB2YWx1ZS50cmltKCkuc3BsaXQod2hpdGVzcGFjZVJlZ2V4KTsKICB2ZWMgPSB7fTsKICBmb3IgKGkgPSAwOyBpIDwgQ09PUkRJTkFURV9LRVlTLmxlbmd0aDsgaSsrKSB7CiAgICBrZXkgPSBDT09SRElOQVRFX0tFWVNbaV07CiAgICBpZiAoY29vcmRpbmF0ZVtpXSkgewogICAgICB2ZWNba2V5XSA9IHBhcnNlRmxvYXQoY29vcmRpbmF0ZVtpXSwgMTApOwogICAgfSBlbHNlIHsKICAgICAgZGVmYXVsdFZhbCA9IGRlZmF1bHRWZWMgJiYgZGVmYXVsdFZlY1trZXldOwogICAgICBpZiAoZGVmYXVsdFZhbCA9PT0gdW5kZWZpbmVkKSB7IGNvbnRpbnVlOyB9CiAgICAgIHZlY1trZXldID0gcGFyc2VJZlN0cmluZyhkZWZhdWx0VmFsKTsKICAgIH0KICB9CiAgcmV0dXJuIHZlYzsKfQptb2R1bGUuZXhwb3J0cy5wYXJzZSA9IHBhcnNlOwoKLyoqCiAqIFN0cmluZ2lmeSBjb29yZGluYXRlcyBmcm9tIGFuIG9iamVjdCB3aXRoIGtleXMgW3ggeSB6XS4KICogRXhhbXBsZToge3g6IDMsIHk6IDEwLCB6OiAtNX0gdG8gIjMgMTAgLTUiLgogKgogKiBAcGFyYW0ge29iamVjdHxzdHJpbmd9IGRhdGEgLSBBbiBvYmplY3Qgd2l0aCBrZXlzIFt4IHkgel0uCiAqIEByZXR1cm5zIHtzdHJpbmd9IEFuICJ4IHkgeiIgc3RyaW5nLgogKi8KZnVuY3Rpb24gc3RyaW5naWZ5IChkYXRhKSB7CiAgdmFyIHN0cjsKICBpZiAodHlwZW9mIGRhdGEgIT09IE9CSkVDVCkgeyByZXR1cm4gZGF0YTsgfQogIHN0ciA9IGRhdGEueCArICcgJyArIGRhdGEueTsKICBpZiAoZGF0YS56ICE9IG51bGwpIHsgc3RyICs9ICcgJyArIGRhdGEuejsgfQogIGlmIChkYXRhLncgIT0gbnVsbCkgeyBzdHIgKz0gJyAnICsgZGF0YS53OyB9CiAgcmV0dXJuIHN0cjsKfQptb2R1bGUuZXhwb3J0cy5zdHJpbmdpZnkgPSBzdHJpbmdpZnk7CgovKioKICogQHJldHVybnMge2Jvb2x9CiAqLwpmdW5jdGlvbiBpc0Nvb3JkaW5hdGVzICh2YWx1ZSkgewogIHJldHVybiByZWdleC50ZXN0KHZhbHVlKTsKfQptb2R1bGUuZXhwb3J0cy5pc0Nvb3JkaW5hdGVzID0gaXNDb29yZGluYXRlczsKCm1vZHVsZS5leHBvcnRzLmlzQ29vcmRpbmF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogIHdhcm4oJ2BBRlJBTUUudXRpbHMuaXNDb29yZGluYXRlYCBoYXMgYmVlbiByZW5hbWVkIHRvIGBBRlJBTUUudXRpbHMuaXNDb29yZGluYXRlc2AnKTsKICByZXR1cm4gaXNDb29yZGluYXRlcyh2YWx1ZSk7Cn07CgpmdW5jdGlvbiBwYXJzZUlmU3RyaW5nICh2YWwpIHsKICBpZiAodmFsICE9PSBudWxsICYmIHZhbCAhPT0gdW5kZWZpbmVkICYmIHZhbC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7CiAgICByZXR1cm4gcGFyc2VGbG9hdCh2YWwsIDEwKTsKICB9CiAgcmV0dXJuIHZhbDsKfQoKLyoqCiAqIENvbnZlcnQge3gsIHksIHp9IG9iamVjdCB0byB0aHJlZS5qcyBWZWN0b3IzLgogKi8KbW9kdWxlLmV4cG9ydHMudG9WZWN0b3IzID0gZnVuY3Rpb24gKHZlYzMpIHsKICByZXR1cm4gbmV3IFRIUkVFLlZlY3RvcjModmVjMy54LCB2ZWMzLnksIHZlYzMueik7Cn07Cgp9LHsiLi9kZWJ1ZyI6MTc1LCJvYmplY3QtYXNzaWduIjoyN31dLDE3NTpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAocHJvY2Vzcyl7CnZhciBkZWJ1Z0xpYiA9IF9kZXJlcV8oJ2RlYnVnJyk7CnZhciBleHRlbmQgPSBfZGVyZXFfKCdvYmplY3QtYXNzaWduJyk7Cgp2YXIgc2V0dGluZ3MgPSB7CiAgY29sb3JzOiB7CiAgICBkZWJ1ZzogJ2dyYXknLAogICAgZXJyb3I6ICdyZWQnLAogICAgaW5mbzogJ2dyYXknLAogICAgd2FybjogJ29yYW5nZScKICB9Cn07CgovKioKICogTW9ua2V5cGF0Y2hlcyBgZGVidWdgIHNvIHdlIGNhbiBjb2xvcml6ZSBlcnJvci93YXJuaW5nIG1lc3NhZ2VzLgogKgogKiAoU2VlIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vdmlzaW9ubWVkaWEvZGVidWcvaXNzdWVzLzEzNykKICovCnZhciBkZWJ1ZyA9IGZ1bmN0aW9uIChuYW1lc3BhY2UpIHsKICB2YXIgZCA9IGRlYnVnTGliKG5hbWVzcGFjZSk7CgogIGQuY29sb3IgPSBnZXREZWJ1Z05hbWVzcGFjZUNvbG9yKG5hbWVzcGFjZSk7CgogIHJldHVybiBkOwp9OwpleHRlbmQoZGVidWcsIGRlYnVnTGliKTsKCi8qKgogKiBSZXR1cm5zIHRoZSB0eXBlIG9mIHRoZSBuYW1lc3BhY2UgKGUuZy4sIGBlcnJvcmAsIGB3YXJuYCkuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lc3BhY2UKICogICBUaGUgZGVidWcgbG9nZ2VyJ3MgbmFtZXNwYWNlIChlLmcuLCBgY29tcG9uZW50czpnZW9tZXRyeTp3YXJuYCkuCiAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSB0eXBlIG9mIHRoZSBuYW1lc3BhY2UgKGUuZy4sIGB3YXJuYCkuCiAqIEBhcGkgcHJpdmF0ZQogKi8KZnVuY3Rpb24gZ2V0RGVidWdOYW1lc3BhY2VUeXBlIChuYW1lc3BhY2UpIHsKICB2YXIgY2h1bmtzID0gbmFtZXNwYWNlLnNwbGl0KCc6Jyk7CgogIHJldHVybiBjaHVua3NbY2h1bmtzLmxlbmd0aCAtIDFdOyAgLy8gUmV0dXJuIHRoZSBsYXN0IG9uZQp9CgovKioKICogUmV0dXJucyB0aGUgY29sb3Igb2YgdGhlIG5hbWVzcGFjZSAoZS5nLiwgYG9yYW5nZWApLgogKgogKiBAcGFyYW0ge1N0cmluZ30gbmFtZXNwYWNlCiAqICAgVGhlIGRlYnVnIGxvZ2dlcidzIG5hbWVzcGFjZSAoZS5nLiwgYGNvbXBvbmVudHM6Z2VvbWV0cnk6d2FybmApLgogKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgY29sb3Igb2YgdGhlIG5hbWVzcGFjZSAoZS5nLiwgYG9yYW5nZWApLgogKiBAYXBpIHByaXZhdGUKICovCmZ1bmN0aW9uIGdldERlYnVnTmFtZXNwYWNlQ29sb3IgKG5hbWVzcGFjZSkgewogIHZhciB0eXBlID0gZ2V0RGVidWdOYW1lc3BhY2VUeXBlKG5hbWVzcGFjZSk7CgogIHZhciBjb2xvciA9IHNldHRpbmdzLmNvbG9ycyAmJiBzZXR0aW5ncy5jb2xvcnNbdHlwZV07CgogIHJldHVybiBjb2xvciB8fCBudWxsOwp9CgovKioKICogUmV0dXJucyBgbG9jYWxTdG9yYWdlYCBpZiBwb3NzaWJsZS4KICoKICogVGhpcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSBTYWZhcmkgdGhyb3dzIHdoZW4gYSB1c2VyIGRpc2FibGVzCiAqIGNvb2tpZXMgb3IgYGxvY2FsU3RvcmFnZWAgYW5kIHlvdSBhdHRlbXB0IHRvIGFjY2VzcyBpdC4KICoKICogQHJldHVybnMge2xvY2FsU3RvcmFnZX0KICogQGFwaSBwcml2YXRlCiAqLwpmdW5jdGlvbiBzdG9yYWdlICgpIHsKICB0cnkgewogICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2U7CiAgfSBjYXRjaCAoZSkgewogIH0KfQoKLyoqCiAqIFRvIGVuYWJsZSBjb25zb2xlIGxvZ2dpbmcsIHR5cGUgdGhpcyBpbiB0aGUgQ29uc29sZSBvZiB5b3VyIERldiBUb29sczoKICoKICogICBsb2NhbFN0b3JhZ2UubG9ncyA9IDEKICoKICogVG8gZGlzYWJsZSBjb25zb2xlIGxvZ2dpbmc6CiAqCiAqICAgbG9jYWxTdG9yYWdlLmxvZ3MgPSAwCiAqCiAqLwp2YXIgbHMgPSBzdG9yYWdlKCk7CmlmIChscyAmJiAocGFyc2VJbnQobHMubG9ncywgMTApIHx8IGxzLmxvZ3MgPT09ICd0cnVlJykpIHsKICBkZWJ1Zy5lbmFibGUoJyonKTsKfSBlbHNlIHsKICBkZWJ1Zy5lbmFibGUoJyo6ZXJyb3IsKjppbmZvLCo6d2FybicpOwp9CgppZiAocHJvY2Vzcy5icm93c2VyKSB7IHdpbmRvdy5sb2dzID0gZGVidWc7IH0KCm1vZHVsZS5leHBvcnRzID0gZGVidWc7Cgp9KS5jYWxsKHRoaXMsX2RlcmVxXygnX3Byb2Nlc3MnKSkKCn0seyJfcHJvY2VzcyI6NSwiZGVidWciOjEwLCJvYmplY3QtYXNzaWduIjoyN31dLDE3NjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CihmdW5jdGlvbiAocHJvY2Vzcyl7CnZhciBlcnJvciA9IF9kZXJlcV8oJ2RlYnVnJykoJ2RldmljZTplcnJvcicpOwoKdmFyIHZyRGlzcGxheTsKCi8vIENhdGNoIHZyZGlzcGxheWFjdGl2YXRlIGVhcmx5IHRvIGVuc3VyZSB3ZSBjYW4gZW50ZXIgVlIgbW9kZSBhZnRlciB0aGUgc2NlbmUgbG9hZHMuCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlhY3RpdmF0ZScsIGZ1bmN0aW9uIChldnQpIHsKICB2YXIgY2FudmFzRWw7CiAgLy8gV2ViWFIgdGFrZXMgcHJpb3JpdHkgaWYgYXZhaWxhYmxlLgogIGlmIChuYXZpZ2F0b3IueHIpIHsgcmV0dXJuOyB9CiAgY2FudmFzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICB2ckRpc3BsYXkgPSBldnQuZGlzcGxheTsKICAvLyBSZXF1ZXN0IHByZXNlbnQgaW1tZWRpYXRlbHkuIGEtc2NlbmUgd2lsbCBiZSBhbGxvd2VkIHRvIGVudGVyIFZSIHdpdGhvdXQgdXNlciBnZXN0dXJlLgogIHZyRGlzcGxheS5yZXF1ZXN0UHJlc2VudChbe3NvdXJjZTogY2FudmFzRWx9XSkudGhlbihmdW5jdGlvbiAoKSB7fSwgZnVuY3Rpb24gKCkge30pOwp9KTsKCi8vIFN1cHBvcnQgYm90aCBXZWJWUiBhbmQgV2ViWFIgQVBJcy4KaWYgKG5hdmlnYXRvci54cikgewogIG5hdmlnYXRvci54ci5yZXF1ZXN0RGV2aWNlKCkudGhlbihmdW5jdGlvbiAoZGV2aWNlKSB7CiAgICBpZiAoIWRldmljZSkgeyByZXR1cm47IH0KICAgIGRldmljZS5zdXBwb3J0c1Nlc3Npb24oe2ltbWVyc2l2ZTogdHJ1ZSwgZXhjbHVzaXZlOiB0cnVlfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzY2VuZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYS1zY2VuZScpOwogICAgICB2ckRpc3BsYXkgPSBkZXZpY2U7CiAgICAgIGlmIChzY2VuZUVsKSB7IHNjZW5lRWwuZW1pdCgnZGlzcGxheWNvbm5lY3RlZCcsIHt2ckRpc3BsYXk6IHZyRGlzcGxheX0pOyB9CiAgICB9KTsKICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICBlcnJvcignV2ViWFIgUmVxdWVzdCBEZXZpY2U6ICcgKyBlcnIubWVzc2FnZSk7CiAgfSk7Cn0gZWxzZSB7CiAgaWYgKG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKSB7CiAgICBuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cygpLnRoZW4oZnVuY3Rpb24gKGRpc3BsYXlzKSB7CiAgICAgIHZhciBzY2VuZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYS1zY2VuZScpOwogICAgICB2ckRpc3BsYXkgPSBkaXNwbGF5cy5sZW5ndGggJiYgZGlzcGxheXNbMF07CiAgICAgIGlmIChzY2VuZUVsKSB7IHNjZW5lRWwuZW1pdCgnZGlzcGxheWNvbm5lY3RlZCcsIHt2ckRpc3BsYXk6IHZyRGlzcGxheX0pOyB9CiAgICB9KTsKICB9Cn0KCm1vZHVsZS5leHBvcnRzLmlzV2ViWFJBdmFpbGFibGUgPSBuYXZpZ2F0b3IueHIgIT09IHVuZGVmaW5lZDsKCmZ1bmN0aW9uIGdldFZSRGlzcGxheSAoKSB7IHJldHVybiB2ckRpc3BsYXk7IH0KbW9kdWxlLmV4cG9ydHMuZ2V0VlJEaXNwbGF5ID0gZ2V0VlJEaXNwbGF5OwoKLyoqCiAqIERldGVybWluZSBpZiBhIGhlYWRzZXQgaXMgY29ubmVjdGVkIGJ5IGNoZWNraW5nIGlmIGEgdnJEaXNwbGF5IGlzIGF2YWlsYWJsZS4KICovCmZ1bmN0aW9uIGNoZWNrSGVhZHNldENvbm5lY3RlZCAoKSB7IHJldHVybiAhIWdldFZSRGlzcGxheSgpOyB9Cm1vZHVsZS5leHBvcnRzLmNoZWNrSGVhZHNldENvbm5lY3RlZCA9IGNoZWNrSGVhZHNldENvbm5lY3RlZDsKCi8qKgogKiBDaGVja3MgaWYgYnJvd3NlciBpcyBtb2JpbGUgYW5kIG5vdCBzdGFuZC1hbG9uZSBkZWRpY2F0ZWQgdnIgZGV2aWNlLgogKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIG1vYmlsZSBicm93c2VyIGRldGVjdGVkLgogKi8KdmFyIGlzTW9iaWxlID0gKGZ1bmN0aW9uICgpIHsKICB2YXIgX2lzTW9iaWxlID0gZmFsc2U7CiAgKGZ1bmN0aW9uIChhKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1lc2NhcGUKICAgIGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIHsKICAgICAgX2lzTW9iaWxlID0gdHJ1ZTsKICAgIH0KICAgIGlmIChpc0lPUygpIHx8IGlzVGFibGV0KCkgfHwgaXNSNygpKSB7CiAgICAgIF9pc01vYmlsZSA9IHRydWU7CiAgICB9CiAgICBpZiAoaXNNb2JpbGVWUigpKSB7CiAgICAgIF9pc01vYmlsZSA9IGZhbHNlOwogICAgfQogIH0pKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50IHx8IHdpbmRvdy5uYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CgogIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBfaXNNb2JpbGU7IH07Cn0pKCk7Cm1vZHVsZS5leHBvcnRzLmlzTW9iaWxlID0gaXNNb2JpbGU7CgovKioKICogIERldGVjdCB0YWJsZXQgZGV2aWNlcy4KICogIEBwYXJhbSB7c3RyaW5nfSBtb2NrVXNlckFnZW50IC0gQWxsb3cgcGFzc2luZyBhIG1vY2sgdXNlciBhZ2VudCBmb3IgdGVzdGluZy4KICovCmZ1bmN0aW9uIGlzVGFibGV0IChtb2NrVXNlckFnZW50KSB7CiAgdmFyIHVzZXJBZ2VudCA9IG1vY2tVc2VyQWdlbnQgfHwgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgcmV0dXJuIC9pcGFkfE5leHVzICg3fDkpfHhvb218c2NoLWk4MDB8cGxheWJvb2t8dGFibGV0fGtpbmRsZS9pLnRlc3QodXNlckFnZW50KTsKfQptb2R1bGUuZXhwb3J0cy5pc1RhYmxldCA9IGlzVGFibGV0OwoKZnVuY3Rpb24gaXNJT1MgKCkgewogIHJldHVybiAvaVBhZHxpUGhvbmV8aVBvZC8udGVzdCh3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtKTsKfQptb2R1bGUuZXhwb3J0cy5pc0lPUyA9IGlzSU9TOwoKLyoqCiAqICBEZXRlY3QgYnJvd3NlcnMgaW4gU3RhbmQtQWxvbmUgaGVhZHNldHMKICovCmZ1bmN0aW9uIGlzTW9iaWxlVlIgKCkgewogIHJldHVybiAvKE9jdWx1c0Jyb3dzZXIpfChTYW1zdW5nQnJvd3Nlcil8KE1vYmlsZSBWUikvaS50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTsKfQptb2R1bGUuZXhwb3J0cy5pc01vYmlsZVZSID0gaXNNb2JpbGVWUjsKCmZ1bmN0aW9uIGlzUjcgKCkgewogIHJldHVybiAvUjcgQnVpbGQvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpOwp9Cm1vZHVsZS5leHBvcnRzLmlzUjcgPSBpc1I3OwoKLyoqCiAqIENoZWNrcyBtb2JpbGUgZGV2aWNlIG9yaWVudGF0aW9uLgogKiBAcmV0dXJuIHtCb29sZWFufSBUcnVlIGlmIGxhbmRzY2FwZSBvcmllbnRhdGlvbi4KICovCm1vZHVsZS5leHBvcnRzLmlzTGFuZHNjYXBlID0gZnVuY3Rpb24gKCkgewogIHZhciBvcmllbnRhdGlvbiA9IHdpbmRvdy5vcmllbnRhdGlvbjsKICBpZiAoaXNSNygpKSB7IG9yaWVudGF0aW9uICs9IDkwOyB9CiAgcmV0dXJuIG9yaWVudGF0aW9uID09PSA5MCB8fCBvcmllbnRhdGlvbiA9PT0gLTkwOwp9OwoKLyoqCiAqIENoZWNrIGlmIHJ1bm5pbmcgaW4gYSBicm93c2VyIG9yIHNwb29mZWQgYnJvd3NlciAoYnVuZGxlcikuCiAqIFdlIG5lZWQgdG8gY2hlY2sgYSBub2RlIGFwaSB0aGF0IGlzbid0IG1vY2tlZCBvbiBlaXRoZXIgc2lkZS4KICogYHJlcXVpcmVgIGFuZCBgbW9kdWxlLmV4cG9ydHNgIGFyZSBtb2NrZWQgaW4gYnJvd3NlciBieSBidW5kbGVycy4KICogYHdpbmRvd2AgaXMgbW9ja2VkIGluIG5vZGUuCiAqIGBwcm9jZXNzYCBpcyBhbHNvIG1vY2tlZCBieSBicm93c2VyaWZ5LCBidXQgaGFzIGN1c3RvbSBwcm9wZXJ0aWVzLgogKi8KbW9kdWxlLmV4cG9ydHMuaXNCcm93c2VyRW52aXJvbm1lbnQgPSAhISghcHJvY2VzcyB8fCBwcm9jZXNzLmJyb3dzZXIpOwoKLyoqCiAqIENoZWNrIGlmIHJ1bm5pbmcgaW4gbm9kZSBvbiB0aGUgc2VydmVyLgogKi8KbW9kdWxlLmV4cG9ydHMuaXNOb2RlRW52aXJvbm1lbnQgPSAhbW9kdWxlLmV4cG9ydHMuaXNCcm93c2VyRW52aXJvbm1lbnQ7CgovKioKICogVXBkYXRlIGFuIE9iamVjdDNEIHBvc2UgaWYgYSBwb2x5ZmlsbGVkIHZyRGlzcGxheSBpcyBwcmVzZW50LgogKi8KbW9kdWxlLmV4cG9ydHMuUG9seWZpbGxDb250cm9scyA9IGZ1bmN0aW9uIFBvbHlmaWxsQ29udHJvbHMgKG9iamVjdCkgewogIHZhciBmcmFtZURhdGE7CiAgdmFyIHZyRGlzcGxheSA9IHdpbmRvdy53ZWJ2cnBvbHlmaWxsICYmIHdpbmRvdy53ZWJ2cnBvbHlmaWxsLmdldFBvbHlmaWxsRGlzcGxheXMoKVswXTsKICBpZiAod2luZG93LlZSRnJhbWVEYXRhKSB7IGZyYW1lRGF0YSA9IG5ldyB3aW5kb3cuVlJGcmFtZURhdGEoKTsgfQogIHRoaXMudXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHBvc2U7CiAgICBpZiAoIXZyRGlzcGxheSkgeyByZXR1cm47IH0KICAgIHZyRGlzcGxheS5nZXRGcmFtZURhdGEoZnJhbWVEYXRhKTsKICAgIHBvc2UgPSBmcmFtZURhdGEucG9zZTsKICAgIGlmIChwb3NlLm9yaWVudGF0aW9uICE9PSBudWxsKSB7CiAgICAgIG9iamVjdC5xdWF0ZXJuaW9uLmZyb21BcnJheShwb3NlLm9yaWVudGF0aW9uKTsKICAgIH0KICAgIGlmIChwb3NlLnBvc2l0aW9uICE9PSBudWxsKSB7CiAgICAgIG9iamVjdC5wb3NpdGlvbi5mcm9tQXJyYXkocG9zZS5wb3NpdGlvbik7CiAgICB9IGVsc2UgewogICAgICBvYmplY3QucG9zaXRpb24uc2V0KDAsIDAsIDApOwogICAgfQogIH07Cn07CgoKfSkuY2FsbCh0aGlzLF9kZXJlcV8oJ19wcm9jZXNzJykpCgp9LHsiX3Byb2Nlc3MiOjUsImRlYnVnIjoxMH1dLDE3NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7Ci8qKgogKiBTcGxpdCBhIGRlbGltaXRlZCBjb21wb25lbnQgcHJvcGVydHkgc3RyaW5nIChlLmcuLCBgbWF0ZXJpYWwuY29sb3JgKSB0byBhbiBvYmplY3QKICogY29udGFpbmluZyBgY29tcG9uZW50YCBuYW1lIGFuZCBgcHJvcGVydHlgIG5hbWUuIElmIHRoZXJlIGlzIG5vIGRlbGltaXRlciwganVzdCByZXR1cm4gdGhlCiAqIHN0cmluZyBiYWNrLgogKgogKiBDYWNoZSBhcnJheXMgZnJvbSBzcGxpdHRpbmcgc3RyaW5ncyB2aWEgZGVsaW1pdGVyIHRvIHNhdmUgb24gbWVtb3J5LgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3RyIC0gZS5nLiwgYG1hdGVyaWFsLm9wYWNpdHlgLgogKiBAcGFyYW0ge3N0cmluZ30gZGVsaW1pdGVyIC0gZS5nLiwgYC5gLgogKiBAcmV0dXJucyB7YXJyYXl9IGUuZy4sIGBbJ21hdGVyaWFsJywgJ29wYWNpdHknXWAuCiAqLwp2YXIgcHJvcGVydHlQYXRoQ2FjaGUgPSB7fTsKZnVuY3Rpb24gZ2V0Q29tcG9uZW50UHJvcGVydHlQYXRoIChzdHIsIGRlbGltaXRlcikgewogIGRlbGltaXRlciA9IGRlbGltaXRlciB8fCAnLic7CiAgaWYgKCFwcm9wZXJ0eVBhdGhDYWNoZVtkZWxpbWl0ZXJdKSB7IHByb3BlcnR5UGF0aENhY2hlW2RlbGltaXRlcl0gPSB7fTsgfQogIGlmIChzdHIuaW5kZXhPZihkZWxpbWl0ZXIpICE9PSAtMSkgewogICAgcHJvcGVydHlQYXRoQ2FjaGVbZGVsaW1pdGVyXVtzdHJdID0gc3RyLnNwbGl0KGRlbGltaXRlcik7CiAgfSBlbHNlIHsKICAgIHByb3BlcnR5UGF0aENhY2hlW2RlbGltaXRlcl1bc3RyXSA9IHN0cjsKICB9CiAgcmV0dXJuIHByb3BlcnR5UGF0aENhY2hlW2RlbGltaXRlcl1bc3RyXTsKfQptb2R1bGUuZXhwb3J0cy5nZXRDb21wb25lbnRQcm9wZXJ0eVBhdGggPSBnZXRDb21wb25lbnRQcm9wZXJ0eVBhdGg7Cm1vZHVsZS5leHBvcnRzLnByb3BlcnR5UGF0aENhY2hlID0gcHJvcGVydHlQYXRoQ2FjaGU7CgovKioKICogR2V0IGNvbXBvbmVudCBwcm9wZXJ0eSB1c2luZyBlbmNvZGVkIGNvbXBvbmVudCBuYW1lICsgY29tcG9uZW50IHByb3BlcnR5IG5hbWUgd2l0aCBhCiAqIGRlbGltaXRlci4KICovCm1vZHVsZS5leHBvcnRzLmdldENvbXBvbmVudFByb3BlcnR5ID0gZnVuY3Rpb24gKGVsLCBuYW1lLCBkZWxpbWl0ZXIpIHsKICB2YXIgc3BsaXROYW1lOwogIGRlbGltaXRlciA9IGRlbGltaXRlciB8fCAnLic7CiAgaWYgKG5hbWUuaW5kZXhPZihkZWxpbWl0ZXIpICE9PSAtMSkgewogICAgc3BsaXROYW1lID0gZ2V0Q29tcG9uZW50UHJvcGVydHlQYXRoKG5hbWUsIGRlbGltaXRlcik7CiAgICBpZiAoc3BsaXROYW1lLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHsKICAgICAgcmV0dXJuIGVsLmdldEF0dHJpYnV0ZShzcGxpdE5hbWUpOwogICAgfQogICAgcmV0dXJuIGVsLmdldEF0dHJpYnV0ZShzcGxpdE5hbWVbMF0pW3NwbGl0TmFtZVsxXV07CiAgfQogIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUobmFtZSk7Cn07CgovKioKICogU2V0IGNvbXBvbmVudCBwcm9wZXJ0eSB1c2luZyBlbmNvZGVkIGNvbXBvbmVudCBuYW1lICsgY29tcG9uZW50IHByb3BlcnR5IG5hbWUgd2l0aCBhCiAqIGRlbGltaXRlci4KICovCm1vZHVsZS5leHBvcnRzLnNldENvbXBvbmVudFByb3BlcnR5ID0gZnVuY3Rpb24gKGVsLCBuYW1lLCB2YWx1ZSwgZGVsaW1pdGVyKSB7CiAgdmFyIHNwbGl0TmFtZTsKICBkZWxpbWl0ZXIgPSBkZWxpbWl0ZXIgfHwgJy4nOwogIGlmIChuYW1lLmluZGV4T2YoZGVsaW1pdGVyKSAhPT0gLTEpIHsKICAgIHNwbGl0TmFtZSA9IGdldENvbXBvbmVudFByb3BlcnR5UGF0aChuYW1lLCBkZWxpbWl0ZXIpOwogICAgaWYgKHNwbGl0TmFtZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZShzcGxpdE5hbWUsIHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZShzcGxpdE5hbWVbMF0sIHNwbGl0TmFtZVsxXSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuOwogIH0KICBlbC5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpOwp9OwoKfSx7fV0sMTc4OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBmb3JjZUNhbnZhc1Jlc2l6ZVNhZmFyaU1vYmlsZSAoY2FudmFzRWwpIHsKICB2YXIgd2lkdGggPSBjYW52YXNFbC5zdHlsZS53aWR0aDsKICB2YXIgaGVpZ2h0ID0gY2FudmFzRWwuc3R5bGUuaGVpZ2h0OwogIC8vIFRha2VuIGZyb20gd2VidnItcG9seWZpbGwgKGh0dHBzOi8vZ2l0aHViLmNvbS9ib3Jpc211cy93ZWJ2ci1wb2x5ZmlsbC9ibG9iLzg1ZjY1N2NkNTAyZWM5NDE3YmYyNmI4N2MzY2IyYWZhNmE3MGUwNzkvc3JjL3V0aWwuanMjTDIwMCkKICAvLyBpT1Mgb25seSB3b3JrYXJvdW5kIGZvciBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTUyNTU2CiAgLy8gQnkgY2hhbmdpbmcgdGhlIHNpemUgMSBwaXhlbCBhbmQgcmVzdG9yaW5nIHRoZSBwcmV2aW91cyB2YWx1ZQogIC8vIHdlIHRyaWdnZXIgYSBzaXplIHJlY2FsY3VsYXRpb24gY3ljbGUuCiAgY2FudmFzRWwuc3R5bGUud2lkdGggPSAocGFyc2VJbnQod2lkdGgsIDEwKSArIDEpICsgJ3B4JzsKICBjYW52YXNFbC5zdHlsZS5oZWlnaHQgPSAocGFyc2VJbnQoaGVpZ2h0LCAxMCkgKyAxKSArICdweCc7CiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICBjYW52YXNFbC5zdHlsZS53aWR0aCA9IHdpZHRoOwogICAgY2FudmFzRWwuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0OwogIH0sIDIwMCk7Cn07Cgp9LHt9XSwxNzk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgbG9jYXRpb24gKi8KCi8qIENlbnRyYWxpemVkIHBsYWNlIHRvIHJlZmVyZW5jZSB1dGlsaXRpZXMgc2luY2UgdXRpbHMgaXMgZXhwb3NlZCB0byB0aGUgdXNlci4gKi8KdmFyIGRlYnVnID0gX2RlcmVxXygnLi9kZWJ1ZycpOwp2YXIgZGVlcEFzc2lnbiA9IF9kZXJlcV8oJ2RlZXAtYXNzaWduJyk7CnZhciBkZXZpY2UgPSBfZGVyZXFfKCcuL2RldmljZScpOwp2YXIgb2JqZWN0QXNzaWduID0gX2RlcmVxXygnb2JqZWN0LWFzc2lnbicpOwp2YXIgb2JqZWN0UG9vbCA9IF9kZXJlcV8oJy4vb2JqZWN0LXBvb2wnKTsKCnZhciB3YXJuID0gZGVidWcoJ3V0aWxzOndhcm4nKTsKCm1vZHVsZS5leHBvcnRzLmJpbmQgPSBfZGVyZXFfKCcuL2JpbmQnKTsKbW9kdWxlLmV4cG9ydHMuY29vcmRpbmF0ZXMgPSBfZGVyZXFfKCcuL2Nvb3JkaW5hdGVzJyk7Cm1vZHVsZS5leHBvcnRzLmRlYnVnID0gZGVidWc7Cm1vZHVsZS5leHBvcnRzLmRldmljZSA9IGRldmljZTsKbW9kdWxlLmV4cG9ydHMuZW50aXR5ID0gX2RlcmVxXygnLi9lbnRpdHknKTsKbW9kdWxlLmV4cG9ydHMuZm9yY2VDYW52YXNSZXNpemVTYWZhcmlNb2JpbGUgPSBfZGVyZXFfKCcuL2ZvcmNlQ2FudmFzUmVzaXplU2FmYXJpTW9iaWxlJyk7Cm1vZHVsZS5leHBvcnRzLmlzSUUxMSA9IF9kZXJlcV8oJy4vaXMtaWUxMScpOwptb2R1bGUuZXhwb3J0cy5tYXRlcmlhbCA9IF9kZXJlcV8oJy4vbWF0ZXJpYWwnKTsKbW9kdWxlLmV4cG9ydHMub2JqZWN0UG9vbCA9IG9iamVjdFBvb2w7Cm1vZHVsZS5leHBvcnRzLnNwbGl0ID0gX2RlcmVxXygnLi9zcGxpdCcpLnNwbGl0Owptb2R1bGUuZXhwb3J0cy5zdHlsZVBhcnNlciA9IF9kZXJlcV8oJy4vc3R5bGVQYXJzZXInKTsKbW9kdWxlLmV4cG9ydHMudHJhY2tlZENvbnRyb2xzID0gX2RlcmVxXygnLi90cmFja2VkLWNvbnRyb2xzJyk7Cgptb2R1bGUuZXhwb3J0cy5jaGVja0hlYWRzZXRDb25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgd2FybignYHV0aWxzLmNoZWNrSGVhZHNldENvbm5lY3RlZGAgaGFzIG1vdmVkIHRvIGB1dGlscy5kZXZpY2UuY2hlY2tIZWFkc2V0Q29ubmVjdGVkYCcpOwogIHJldHVybiBkZXZpY2UuY2hlY2tIZWFkc2V0Q29ubmVjdGVkKGFyZ3VtZW50cyk7Cn07Cm1vZHVsZS5leHBvcnRzLmlzR2VhclZSID0gbW9kdWxlLmV4cG9ydHMuZGV2aWNlLmlzR2VhclZSID0gZnVuY3Rpb24gKCkgewogIHdhcm4oJ2B1dGlscy5pc0dlYXJWUmAgaGFzIGJlZW4gZGVwcmVjYXRlZCwgdXNlIGB1dGlscy5kZXZpY2UuaXNNb2JpbGVWUmAnKTsKfTsKbW9kdWxlLmV4cG9ydHMuaXNJT1MgPSBmdW5jdGlvbiAoKSB7CiAgd2FybignYHV0aWxzLmlzSU9TYCBoYXMgbW92ZWQgdG8gYHV0aWxzLmRldmljZS5pc0lPU2AnKTsKICByZXR1cm4gZGV2aWNlLmlzSU9TKGFyZ3VtZW50cyk7Cn07Cm1vZHVsZS5leHBvcnRzLmlzT2N1bHVzR28gPSBtb2R1bGUuZXhwb3J0cy5kZXZpY2UuaXNPY3VsdXNHbyA9IGZ1bmN0aW9uICgpIHsKICB3YXJuKCdgdXRpbHMuaXNPY3VsdXNHb2AgaGFzIGJlZW4gZGVwcmVjYXRlZCwgdXNlIGB1dGlscy5kZXZpY2UuaXNNb2JpbGVWUmAnKTsKfTsKbW9kdWxlLmV4cG9ydHMuaXNNb2JpbGUgPSBmdW5jdGlvbiAoKSB7CiAgd2FybignYHV0aWxzLmlzTW9iaWxlIGhhcyBtb3ZlZCB0byBgdXRpbHMuZGV2aWNlLmlzTW9iaWxlYCcpOwogIHJldHVybiBkZXZpY2UuaXNNb2JpbGUoYXJndW1lbnRzKTsKfTsKCi8qKgogKiBSZXR1cm5zIHRocm90dGxlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgYXQgbW9zdCBvbmNlIGV2ZXJ5IGludGVydmFsLgogKgogKiBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jdGlvblRvVGhyb3R0bGUKICogQHBhcmFtIHtudW1iZXJ9IG1pbmltdW1JbnRlcnZhbCAtIE1pbmltYWwgaW50ZXJ2YWwgYmV0d2VlbiBjYWxscyAobWlsbGlzZWNvbmRzKS4KICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbmFsQ29udGV4dCAtIElmIGdpdmVuLCBiaW5kIGZ1bmN0aW9uIHRvIHRocm90dGxlIHRvIHRoaXMgY29udGV4dC4KICogQHJldHVybnMge2Z1bmN0aW9ufSBUaHJvdHRsZWQgZnVuY3Rpb24uCiAqLwptb2R1bGUuZXhwb3J0cy50aHJvdHRsZSA9IGZ1bmN0aW9uIChmdW5jdGlvblRvVGhyb3R0bGUsIG1pbmltdW1JbnRlcnZhbCwgb3B0aW9uYWxDb250ZXh0KSB7CiAgdmFyIGxhc3RUaW1lOwogIGlmIChvcHRpb25hbENvbnRleHQpIHsKICAgIGZ1bmN0aW9uVG9UaHJvdHRsZSA9IG1vZHVsZS5leHBvcnRzLmJpbmQoZnVuY3Rpb25Ub1Rocm90dGxlLCBvcHRpb25hbENvbnRleHQpOwogIH0KICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHRpbWUgPSBEYXRlLm5vdygpOwogICAgdmFyIHNpbmNlTGFzdFRpbWUgPSB0eXBlb2YgbGFzdFRpbWUgPT09ICd1bmRlZmluZWQnID8gbWluaW11bUludGVydmFsIDogdGltZSAtIGxhc3RUaW1lOwogICAgaWYgKHR5cGVvZiBsYXN0VGltZSA9PT0gJ3VuZGVmaW5lZCcgfHwgKHNpbmNlTGFzdFRpbWUgPj0gbWluaW11bUludGVydmFsKSkgewogICAgICBsYXN0VGltZSA9IHRpbWU7CiAgICAgIGZ1bmN0aW9uVG9UaHJvdHRsZS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgfQogIH07Cn07CgovKioKICogUmV0dXJucyB0aHJvdHRsZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIGF0IG1vc3Qgb25jZSBldmVyeSBpbnRlcnZhbC4KICogVXNlcyB0aGUgdGltZS90aW1lRGVsdGEgdGltZXN0YW1wcyBwcm92aWRlZCBieSB0aGUgZ2xvYmFsIHJlbmRlciBsb29wIGZvciBiZXR0ZXIgcGVyZi4KICoKICogQHBhcmFtIHtmdW5jdGlvbn0gZnVuY3Rpb25Ub1Rocm90dGxlCiAqIEBwYXJhbSB7bnVtYmVyfSBtaW5pbXVtSW50ZXJ2YWwgLSBNaW5pbWFsIGludGVydmFsIGJldHdlZW4gY2FsbHMgKG1pbGxpc2Vjb25kcykuCiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25hbENvbnRleHQgLSBJZiBnaXZlbiwgYmluZCBmdW5jdGlvbiB0byB0aHJvdHRsZSB0byB0aGlzIGNvbnRleHQuCiAqIEByZXR1cm5zIHtmdW5jdGlvbn0gVGhyb3R0bGVkIGZ1bmN0aW9uLgogKi8KbW9kdWxlLmV4cG9ydHMudGhyb3R0bGVUaWNrID0gZnVuY3Rpb24gKGZ1bmN0aW9uVG9UaHJvdHRsZSwgbWluaW11bUludGVydmFsLCBvcHRpb25hbENvbnRleHQpIHsKICB2YXIgbGFzdFRpbWU7CiAgaWYgKG9wdGlvbmFsQ29udGV4dCkgewogICAgZnVuY3Rpb25Ub1Rocm90dGxlID0gbW9kdWxlLmV4cG9ydHMuYmluZChmdW5jdGlvblRvVGhyb3R0bGUsIG9wdGlvbmFsQ29udGV4dCk7CiAgfQogIHJldHVybiBmdW5jdGlvbiAodGltZSwgZGVsdGEpIHsKICAgIHZhciBzaW5jZUxhc3RUaW1lID0gdHlwZW9mIGxhc3RUaW1lID09PSAndW5kZWZpbmVkJyA/IGRlbHRhIDogdGltZSAtIGxhc3RUaW1lOwogICAgaWYgKHR5cGVvZiBsYXN0VGltZSA9PT0gJ3VuZGVmaW5lZCcgfHwgKHNpbmNlTGFzdFRpbWUgPj0gbWluaW11bUludGVydmFsKSkgewogICAgICBsYXN0VGltZSA9IHRpbWU7CiAgICAgIGZ1bmN0aW9uVG9UaHJvdHRsZSh0aW1lLCBzaW5jZUxhc3RUaW1lKTsKICAgIH0KICB9Owp9OwoKLyoqCiAqIFJldHVybnMgZGVib3VuY2UgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCBvbmx5IG9uY2UgYWZ0ZXIgYSBzZXQgb2YgcmVwZWF0ZWQgY2FsbHMuCiAqCiAqIEBwYXJhbSB7ZnVuY3Rpb259IGZ1bmN0aW9uVG9EZWJvdW5jZQogKiBAcGFyYW0ge251bWJlcn0gd2FpdCAtIFRpbWUgdG8gd2FpdCBmb3IgcmVwZWF0ZWQgZnVuY3Rpb24gY2FsbHMgKG1pbGxpc2Vjb25kcykuCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaW1tZWRpYXRlIC0gQ2FsbHMgdGhlIGZ1bmN0aW9uIGltbWVkaWF0ZWx5IHJlZ2FyZGxlc3Mgb2YgaWYgaXQgc2hvdWxkIGJlIHdhaXRpbmcuCiAqIEByZXR1cm5zIHtmdW5jdGlvbn0gRGVib3VuY2VkIGZ1bmN0aW9uLgogKi8KbW9kdWxlLmV4cG9ydHMuZGVib3VuY2UgPSBmdW5jdGlvbiAoZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7CiAgdmFyIHRpbWVvdXQ7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBjb250ZXh0ID0gdGhpczsKICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwogICAgdmFyIGxhdGVyID0gZnVuY3Rpb24gKCkgewogICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgaWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICB9OwogICAgdmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICBpZiAoY2FsbE5vdykgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICB9Owp9OwoKLyoqCiAqIE1peCB0aGUgcHJvcGVydGllcyBvZiBzb3VyY2Ugb2JqZWN0KHMpIGludG8gYSBkZXN0aW5hdGlvbiBvYmplY3QuCiAqCiAqIEBwYXJhbSAge29iamVjdH0gZGVzdCAtIFRoZSBvYmplY3QgdG8gd2hpY2ggcHJvcGVydGllcyB3aWxsIGJlIGNvcGllZC4KICogQHBhcmFtICB7Li4ub2JqZWN0fSBzb3VyY2UgLSBUaGUgb2JqZWN0KHMpIGZyb20gd2hpY2ggcHJvcGVydGllcyB3aWxsIGJlIGNvcGllZC4KICovCm1vZHVsZS5leHBvcnRzLmV4dGVuZCA9IG9iamVjdEFzc2lnbjsKbW9kdWxlLmV4cG9ydHMuZXh0ZW5kRGVlcCA9IGRlZXBBc3NpZ247Cgptb2R1bGUuZXhwb3J0cy5jbG9uZSA9IGZ1bmN0aW9uIChvYmopIHsKICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfTsKCi8qKgogKiBDaGVja3MgaWYgdHdvIHZhbHVlcyBhcmUgZXF1YWwuCiAqIEluY2x1ZGVzIG9iamVjdHMgYW5kIGFycmF5cyBhbmQgbmVzdGVkIG9iamVjdHMgYW5kIGFycmF5cy4KICogVHJ5IHRvIGtlZXAgdGhpcyBmdW5jdGlvbiBwZXJmb3JtYW50IGFzIGl0IHdpbGwgYmUgY2FsbGVkIG9mdGVuIHRvIHNlZSBpZiBhIGNvbXBvbmVudAogKiBzaG91bGQgYmUgdXBkYXRlZC4KICoKICogQHBhcmFtIHtvYmplY3R9IGEgLSBGaXJzdCBvYmplY3QuCiAqIEBwYXJhbSB7b2JqZWN0fSBiIC0gU2Vjb25kIG9iamVjdC4KICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgdHdvIG9iamVjdHMgYXJlIGRlZXBseSBlcXVhbC4KICovCnZhciBkZWVwRXF1YWwgPSAoZnVuY3Rpb24gKCkgewogIHZhciBhcnJheVBvb2wgPSBvYmplY3RQb29sLmNyZWF0ZVBvb2woZnVuY3Rpb24gKCkgeyByZXR1cm4gW107IH0pOwoKICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgIHZhciBrZXk7CiAgICB2YXIga2V5c0E7CiAgICB2YXIga2V5c0I7CiAgICB2YXIgaTsKICAgIHZhciB2YWxBOwogICAgdmFyIHZhbEI7CgogICAgLy8gSWYgbm90IG9iamVjdHMgb3IgYXJyYXlzLCBjb21wYXJlIGFzIHZhbHVlcy4KICAgIGlmIChhID09PSB1bmRlZmluZWQgfHwgYiA9PT0gdW5kZWZpbmVkIHx8IGEgPT09IG51bGwgfHwgYiA9PT0gbnVsbCB8fAogICAgICAgICEoYSAmJiBiICYmIChhLmNvbnN0cnVjdG9yID09PSBPYmplY3QgJiYgYi5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB8fAogICAgICAgICAgICAgICAgICAgIChhLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiBiLmNvbnN0cnVjdG9yID09PSBBcnJheSkpKSB7CiAgICAgIHJldHVybiBhID09PSBiOwogICAgfQoKICAgIC8vIERpZmZlcmVudCBudW1iZXIgb2Yga2V5cywgbm90IGVxdWFsLgogICAga2V5c0EgPSBhcnJheVBvb2wudXNlKCk7CiAgICBrZXlzQiA9IGFycmF5UG9vbC51c2UoKTsKICAgIGtleXNBLmxlbmd0aCA9IDA7CiAgICBrZXlzQi5sZW5ndGggPSAwOwogICAgZm9yIChrZXkgaW4gYSkgeyBrZXlzQS5wdXNoKGtleSk7IH0KICAgIGZvciAoa2V5IGluIGIpIHsga2V5c0IucHVzaChrZXkpOyB9CiAgICBpZiAoa2V5c0EubGVuZ3RoICE9PSBrZXlzQi5sZW5ndGgpIHsKICAgICAgYXJyYXlQb29sLnJlY3ljbGUoa2V5c0EpOwogICAgICBhcnJheVBvb2wucmVjeWNsZShrZXlzQik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBSZXR1cm4gYGZhbHNlYCBhdCB0aGUgZmlyc3Qgc2lnbiBvZiBpbmVxdWFsaXR5LgogICAgZm9yIChpID0gMDsgaSA8IGtleXNBLmxlbmd0aDsgKytpKSB7CiAgICAgIHZhbEEgPSBhW2tleXNBW2ldXTsKICAgICAgdmFsQiA9IGJba2V5c0FbaV1dOwogICAgICAvLyBDaGVjayBuZXN0ZWQgYXJyYXkgYW5kIG9iamVjdC4KICAgICAgaWYgKCh0eXBlb2YgdmFsQSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIHZhbEIgPT09ICdvYmplY3QnKSB8fAogICAgICAgICAgKEFycmF5LmlzQXJyYXkodmFsQSkgJiYgQXJyYXkuaXNBcnJheSh2YWxCKSkpIHsKICAgICAgICBpZiAodmFsQSA9PT0gdmFsQikgeyBjb250aW51ZTsgfQogICAgICAgIGlmICghZGVlcEVxdWFsKHZhbEEsIHZhbEIpKSB7CiAgICAgICAgICBhcnJheVBvb2wucmVjeWNsZShrZXlzQSk7CiAgICAgICAgICBhcnJheVBvb2wucmVjeWNsZShrZXlzQik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhbEEgIT09IHZhbEIpIHsKICAgICAgICBhcnJheVBvb2wucmVjeWNsZShrZXlzQSk7CiAgICAgICAgYXJyYXlQb29sLnJlY3ljbGUoa2V5c0IpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGFycmF5UG9vbC5yZWN5Y2xlKGtleXNBKTsKICAgIGFycmF5UG9vbC5yZWN5Y2xlKGtleXNCKTsKICAgIHJldHVybiB0cnVlOwogIH07Cn0pKCk7Cm1vZHVsZS5leHBvcnRzLmRlZXBFcXVhbCA9IGRlZXBFcXVhbDsKCi8qKgogKiBDb21wdXRlcyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHR3byBvYmplY3RzLgogKgogKiBAcGFyYW0ge29iamVjdH0gYSAtIEZpcnN0IG9iamVjdCB0byBjb21wYXJlIChlLmcuLCBvbGREYXRhKS4KICogQHBhcmFtIHtvYmplY3R9IGIgLSBTZWNvbmQgb2JqZWN0IHRvIGNvbXBhcmUgKGUuZy4sIG5ld0RhdGEpLgogKiBAcmV0dXJucyB7b2JqZWN0fQogKiAgIERpZmZlcmVuY2Ugb2JqZWN0IHdoZXJlIHNldCBvZiBrZXlzIG5vdGUgd2hpY2ggdmFsdWVzIHdlcmUgbm90IGVxdWFsLCBhbmQgdmFsdWVzIGFyZQogKiAgIGBiYCdzIHZhbHVlcy4KICovCm1vZHVsZS5leHBvcnRzLmRpZmYgPSAoZnVuY3Rpb24gKCkgewogIHZhciBrZXlzID0gW107CgogIHJldHVybiBmdW5jdGlvbiAoYSwgYiwgdGFyZ2V0T2JqZWN0KSB7CiAgICB2YXIgYVZhbDsKICAgIHZhciBiVmFsOwogICAgdmFyIGJLZXk7CiAgICB2YXIgZGlmZjsKICAgIHZhciBrZXk7CiAgICB2YXIgaTsKICAgIHZhciBpc0NvbXBhcmluZ09iamVjdHM7CgogICAgZGlmZiA9IHRhcmdldE9iamVjdCB8fCB7fTsKCiAgICAvLyBDb2xsZWN0IEEga2V5cy4KICAgIGtleXMubGVuZ3RoID0gMDsKICAgIGZvciAoa2V5IGluIGEpIHsga2V5cy5wdXNoKGtleSk7IH0KCiAgICBpZiAoIWIpIHsgcmV0dXJuIGRpZmY7IH0KCiAgICAvLyBDb2xsZWN0IEIga2V5cy4KICAgIGZvciAoYktleSBpbiBiKSB7CiAgICAgIGlmIChrZXlzLmluZGV4T2YoYktleSkgPT09IC0xKSB7CiAgICAgICAga2V5cy5wdXNoKGJLZXkpOwogICAgICB9CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0ga2V5c1tpXTsKICAgICAgYVZhbCA9IGFba2V5XTsKICAgICAgYlZhbCA9IGJba2V5XTsKICAgICAgaXNDb21wYXJpbmdPYmplY3RzID0gYVZhbCAmJiBiVmFsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgYVZhbC5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0ICYmIGJWYWwuY29uc3RydWN0b3IgPT09IE9iamVjdDsKICAgICAgaWYgKChpc0NvbXBhcmluZ09iamVjdHMgJiYgIWRlZXBFcXVhbChhVmFsLCBiVmFsKSkgfHwKICAgICAgICAgICghaXNDb21wYXJpbmdPYmplY3RzICYmIGFWYWwgIT09IGJWYWwpKSB7CiAgICAgICAgZGlmZltrZXldID0gYlZhbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRpZmY7CiAgfTsKfSkoKTsKCi8qKgogKiBSZXR1cm5zIHdoZXRoZXIgd2Ugc2hvdWxkIGNhcHR1cmUgdGhpcyBrZXlib2FyZCBldmVudCBmb3Iga2V5Ym9hcmQgc2hvcnRjdXRzLgogKiBAcGFyYW0ge0V2ZW50fSBldmVudCBFdmVudCBvYmplY3QuCiAqIEByZXR1cm5zIHtCb29sZWFufSBXaGV0aGVyIHRoZSBrZXkgZXZlbnQgc2hvdWxkIGJlIGNhcHR1cmVkLgogKi8KbW9kdWxlLmV4cG9ydHMuc2hvdWxkQ2FwdHVyZUtleUV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgaWYgKGV2ZW50Lm1ldGFLZXkpIHsgcmV0dXJuIGZhbHNlOyB9CiAgcmV0dXJuIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGRvY3VtZW50LmJvZHk7Cn07CgovKioKICogU3BsaXRzIGEgc3RyaW5nIGludG8gYW4gYXJyYXkgYmFzZWQgb24gYSBkZWxpbWl0ZXIuCiAqCiAqIEBwYXJhbSAgIHtzdHJpbmc9fSBbc3RyPScnXSAgICAgICAgU291cmNlIHN0cmluZwogKiBAcGFyYW0gICB7c3RyaW5nPX0gW2RlbGltaXRlcj0nICddIERlbGltaXRlciB0byB1c2UKICogQHJldHVybnMge2FycmF5fSAgICAgICAgICAgICAgICAgICBBcnJheSBvZiBkZWxpbWl0ZWQgc3RyaW5ncwogKi8KbW9kdWxlLmV4cG9ydHMuc3BsaXRTdHJpbmcgPSBmdW5jdGlvbiAoc3RyLCBkZWxpbWl0ZXIpIHsKICBpZiAodHlwZW9mIGRlbGltaXRlciA9PT0gJ3VuZGVmaW5lZCcpIHsgZGVsaW1pdGVyID0gJyAnOyB9CiAgLy8gRmlyc3QgY29sbGFwc2UgdGhlIHdoaXRlc3BhY2UgKG9yIHdoYXRldmVyIHRoZSBkZWxpbWl0ZXIgaXMpLgogIHZhciByZWdleCA9IG5ldyBSZWdFeHAoZGVsaW1pdGVyLCAnZycpOwogIHN0ciA9IChzdHIgfHwgJycpLnJlcGxhY2UocmVnZXgsIGRlbGltaXRlcik7CiAgLy8gVGhlbiBzcGxpdC4KICByZXR1cm4gc3RyLnNwbGl0KGRlbGltaXRlcik7Cn07CgovKioKICogRXh0cmFjdHMgZGF0YSBmcm9tIHRoZSBlbGVtZW50IGdpdmVuIGFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGV4cGVjdGVkIGtleXMuCiAqCiAqIEBwYXJhbSB7RWxlbWVudH0gU291cmNlIGVsZW1lbnQuCiAqIEBwYXJhbSB7T2JqZWN0fSBbZGVmYXVsdHM9e31dIE9iamVjdCBvZiBkZWZhdWx0IGtleS12YWx1ZSBwYWlycy4KICogQHJldHVybnMge09iamVjdH0KICovCm1vZHVsZS5leHBvcnRzLmdldEVsRGF0YSA9IGZ1bmN0aW9uIChlbCwgZGVmYXVsdHMpIHsKICBkZWZhdWx0cyA9IGRlZmF1bHRzIHx8IHt9OwogIHZhciBkYXRhID0ge307CiAgT2JqZWN0LmtleXMoZGVmYXVsdHMpLmZvckVhY2goY29weUF0dHJpYnV0ZSk7CiAgZnVuY3Rpb24gY29weUF0dHJpYnV0ZSAoa2V5KSB7CiAgICBpZiAoZWwuaGFzQXR0cmlidXRlKGtleSkpIHsKICAgICAgZGF0YVtrZXldID0gZWwuZ2V0QXR0cmlidXRlKGtleSk7CiAgICB9CiAgfQogIHJldHVybiBkYXRhOwp9OwoKLyoqCiAqIFJldHJpZXZlcyBxdWVyeXN0cmluZyB2YWx1ZS4KICogQHBhcmFtICB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgcXVlcnlzdHJpbmcga2V5LgogKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgVmFsdWUKICovCm1vZHVsZS5leHBvcnRzLmdldFVybFBhcmFtZXRlciA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlCiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xbXS8sICdcXFsnKS5yZXBsYWNlKC9bXF1dLywgJ1xcXScpOwogIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJ1tcXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpOwogIHZhciByZXN1bHRzID0gcmVnZXguZXhlYyhsb2NhdGlvbi5zZWFyY2gpOwogIHJldHVybiByZXN1bHRzID09PSBudWxsID8gJycgOiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cKy9nLCAnICcpKTsKfTsKCi8qKgogKiBEZXRlY3RzIHdoZXRoZXIgY29udGV4dCBpcyB3aXRoaW4gaWZyYW1lLgogKi8KbW9kdWxlLmV4cG9ydHMuaXNJZnJhbWVkID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB3aW5kb3cudG9wICE9PSB3aW5kb3cuc2VsZjsKfTsKCi8qKgogKiBGaW5kcyBhbGwgZWxlbWVudHMgdW5kZXIgdGhlIGVsZW1lbnQgdGhhdCBoYXZlIHRoZSBpc1NjZW5lCiAqIHByb3BlcnR5IHNldCB0byB0cnVlCiAqLwptb2R1bGUuZXhwb3J0cy5maW5kQWxsU2NlbmVzID0gZnVuY3Rpb24gKGVsKSB7CiAgdmFyIG1hdGNoaW5nRWxlbWVudHMgPSBbXTsKICB2YXIgYWxsRWxlbWVudHMgPSBlbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpOwogIGZvciAodmFyIGkgPSAwLCBuID0gYWxsRWxlbWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICBpZiAoYWxsRWxlbWVudHNbaV0uaXNTY2VuZSkgewogICAgICAvLyBFbGVtZW50IGV4aXN0cyB3aXRoIGlzU2NlbmUgc2V0LgogICAgICBtYXRjaGluZ0VsZW1lbnRzLnB1c2goYWxsRWxlbWVudHNbaV0pOwogICAgfQogIH0KICByZXR1cm4gbWF0Y2hpbmdFbGVtZW50czsKfTsKCi8vIE11c3QgYmUgYXQgYm90dG9tIHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY3kuCm1vZHVsZS5leHBvcnRzLnNyY0xvYWRlciA9IF9kZXJlcV8oJy4vc3JjLWxvYWRlcicpOwoKfSx7Ii4vYmluZCI6MTczLCIuL2Nvb3JkaW5hdGVzIjoxNzQsIi4vZGVidWciOjE3NSwiLi9kZXZpY2UiOjE3NiwiLi9lbnRpdHkiOjE3NywiLi9mb3JjZUNhbnZhc1Jlc2l6ZVNhZmFyaU1vYmlsZSI6MTc4LCIuL2lzLWllMTEiOjE4MCwiLi9tYXRlcmlhbCI6MTgyLCIuL29iamVjdC1wb29sIjoxODMsIi4vc3BsaXQiOjE4NCwiLi9zcmMtbG9hZGVyIjoxODUsIi4vc3R5bGVQYXJzZXIiOjE4NiwiLi90cmFja2VkLWNvbnRyb2xzIjoxODcsImRlZXAtYXNzaWduIjoxMiwib2JqZWN0LWFzc2lnbiI6Mjd9XSwxODA6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTc5MDc1NjIKZnVuY3Rpb24gZ2V0SW50ZXJuZXRFeHBsb3JlclZlcnNpb24gKCkgewogIHZhciB2ZXJzaW9uID0gLTE7CiAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7CiAgdmFyIHJlOwogIGlmIChuYXZpZ2F0b3IuYXBwTmFtZSA9PT0gJ01pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlcicpIHsKICAgIHJlID0gbmV3IFJlZ0V4cCgnTVNJRSAoWzAtOV17MSx9W1xcLjAtOV17MCx9KScpOwogICAgaWYgKHJlLmV4ZWModXNlckFnZW50KSAhPSBudWxsKSB7IHZlcnNpb24gPSBwYXJzZUZsb2F0KFJlZ0V4cC4kMSk7IH0KICB9IGVsc2UgaWYgKG5hdmlnYXRvci5hcHBOYW1lID09PSAnTmV0c2NhcGUnKSB7CiAgICByZSA9IG5ldyBSZWdFeHAoJ1RyaWRlbnQvLipydjooWzAtOV17MSx9W1xcLjAtOV17MCx9KScpOwogICAgaWYgKHJlLmV4ZWModXNlckFnZW50KSAhPSBudWxsKSB7IHZlcnNpb24gPSBwYXJzZUZsb2F0KFJlZ0V4cC4kMSk7IH0KICB9CiAgcmV0dXJuIHZlcnNpb247Cn0KCm1vZHVsZS5leHBvcnRzID0gZ2V0SW50ZXJuZXRFeHBsb3JlclZlcnNpb24oKSA9PT0gMTE7Cgp9LHt9XSwxODE6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogQ2hlY2sgaWYgZGV2aWNlIGlzIGlPUyBhbmQgb2xkZXIgdGhhbiB2ZXJzaW9uIDEwLgogKi8KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBpc0lPU09sZGVyVGhhbjEwICh1c2VyQWdlbnQpIHsKICByZXR1cm4gLyhpcGhvbmV8aXBvZHxpcGFkKS4qb3MuKDdffDhffDlfKS9pLnRlc3QodXNlckFnZW50KTsKfTsKCn0se31dLDE4MjpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBUSFJFRSA9IF9kZXJlcV8oJy4uL2xpYi90aHJlZScpOwoKdmFyIEhMU19NSU1FVFlQRVMgPSBbJ2FwcGxpY2F0aW9uL3gtbXBlZ3VybCcsICdhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3VybCddOwoKdmFyIENPTE9SX01BUFMgPSBuZXcgU2V0KFsKICAnZW1pc3NpdmVNYXAnLAogICdlbnZNYXAnLAogICdtYXAnLAogICdzcGVjdWxhck1hcCcKXSk7CgovKioKICogVXBkYXRlIGBtYXRlcmlhbGAgdGV4dHVyZSBwcm9wZXJ0eSAodXN1YWxseSBidXQgbm90IGFsd2F5cyBgbWFwYCkKICogZnJvbSBgZGF0YWAgcHJvcGVydHkgKHVzdWFsbHkgYnV0IG5vdCBhbHdheXMgYHNyY2ApCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBzaGFkZXIgLSBBLUZyYW1lIHNoYWRlciBpbnN0YW5jZS4KICogQHBhcmFtIHtvYmplY3R9IGRhdGEKICovCm1vZHVsZS5leHBvcnRzLnVwZGF0ZU1hcE1hdGVyaWFsRnJvbURhdGEgPSBmdW5jdGlvbiAobWF0ZXJpYWxOYW1lLCBkYXRhTmFtZSwgc2hhZGVyLCBkYXRhKSB7CiAgdmFyIGVsID0gc2hhZGVyLmVsOwogIHZhciBtYXRlcmlhbCA9IHNoYWRlci5tYXRlcmlhbDsKICB2YXIgcmVuZGVyZXJTeXN0ZW0gPSBlbC5zY2VuZUVsLnN5c3RlbXMucmVuZGVyZXI7CiAgdmFyIHNyYyA9IGRhdGFbZGF0YU5hbWVdOwoKICAvLyBCZWNhdXNlIGEgc2luZ2xlIG1hdGVyaWFsIC8gc2hhZGVyIG1heSBoYXZlIG11bHRpcGxlIHRleHR1cmVzLAogIC8vIHdlIG5lZWQgdG8gcmVtZW1iZXIgdGhlIHNvdXJjZSB2YWx1ZSBmb3IgdGhpcyBkYXRhIHByb3BlcnR5CiAgLy8gdG8gYXZvaWQgcmVkdW5kYW50IG9wZXJhdGlvbnMgd2hpY2ggY2FuIGJlIGV4cGVuc2l2ZSBvdGhlcndpc2UKICAvLyAoZS5nLiB2aWRlbyB0ZXh0dXJlIGxvYWRzKS4KICBpZiAoIXNoYWRlci5tYXRlcmlhbFNyY3MpIHsgc2hhZGVyLm1hdGVyaWFsU3JjcyA9IHt9OyB9CgogIGlmICghc3JjKSB7CiAgICAvLyBGb3JnZXQgdGhlIHByaW9yIG1hdGVyaWFsIHNyYy4KICAgIGRlbGV0ZSBzaGFkZXIubWF0ZXJpYWxTcmNzW21hdGVyaWFsTmFtZV07CiAgICAvLyBSZW1vdmUgdGhlIHRleHR1cmUuCiAgICBzZXRNYXAobnVsbCk7CiAgICByZXR1cm47CiAgfQoKICAvLyBEb24ndCBwcm9jZXNzIGlmIG1hdGVyaWFsIHNyYyBoYXNuJ3QgY2hhbmdlZC4KICBpZiAoc3JjID09PSBzaGFkZXIubWF0ZXJpYWxTcmNzW21hdGVyaWFsTmFtZV0pIHsgcmV0dXJuOyB9CgogIC8vIFJlbWVtYmVyIHRoZSBuZXcgc3JjIGZvciB0aGlzIHRleHR1cmUgKHRoZXJlIG1heSBiZSBtdWx0aXBsZSkuCiAgc2hhZGVyLm1hdGVyaWFsU3Jjc1ttYXRlcmlhbE5hbWVdID0gc3JjOwoKICAvLyBJZiB0aGUgbmV3IG1hdGVyaWFsIHNyYyBpcyBhbHJlYWR5IGEgdGV4dHVyZSwganVzdCB1c2UgaXQuCiAgaWYgKHNyYyBpbnN0YW5jZW9mIFRIUkVFLlRleHR1cmUpIHsgc2V0TWFwKHNyYyk7IH0gZWxzZSB7CiAgICAvLyBMb2FkIHRleHR1cmUgZm9yIHRoZSBuZXcgbWF0ZXJpYWwgc3JjLgogICAgLy8gKEFuZCBjaGVjayBpZiB3ZSBzaG91bGQgc3RpbGwgdXNlIGl0IG9uY2UgYXZhaWxhYmxlIGluIGNhbGxiYWNrLikKICAgIGVsLnNjZW5lRWwuc3lzdGVtcy5tYXRlcmlhbC5sb2FkVGV4dHVyZShzcmMsCiAgICAgIHtzcmM6IHNyYywgcmVwZWF0OiBkYXRhLnJlcGVhdCwgb2Zmc2V0OiBkYXRhLm9mZnNldCwgbnBvdDogZGF0YS5ucG90fSwKICAgICAgY2hlY2tTZXRNYXApOwogIH0KCiAgZnVuY3Rpb24gY2hlY2tTZXRNYXAgKHRleHR1cmUpIHsKICAgIC8vIElmIHRoZSBzb3VyY2UgaGFzIGJlZW4gY2hhbmdlZCwgZG9uJ3QgdXNlIGxvYWRlZCB0ZXh0dXJlLgogICAgaWYgKHNoYWRlci5tYXRlcmlhbFNyY3NbbWF0ZXJpYWxOYW1lXSAhPT0gc3JjKSB7IHJldHVybjsgfQogICAgc2V0TWFwKHRleHR1cmUpOwogIH0KCiAgZnVuY3Rpb24gc2V0TWFwICh0ZXh0dXJlKSB7CiAgICBtYXRlcmlhbFttYXRlcmlhbE5hbWVdID0gdGV4dHVyZTsKICAgIGlmICh0ZXh0dXJlICYmIENPTE9SX01BUFMuaGFzKG1hdGVyaWFsTmFtZSkpIHsKICAgICAgcmVuZGVyZXJTeXN0ZW0uYXBwbHlDb2xvckNvcnJlY3Rpb24odGV4dHVyZSk7CiAgICB9CiAgICBtYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICBoYW5kbGVUZXh0dXJlRXZlbnRzKGVsLCB0ZXh0dXJlKTsKICB9Cn07CgovKioKICogVXBkYXRlIGBtYXRlcmlhbC5tYXBgIGdpdmVuIGBkYXRhLnNyY2AuIEZvciBzdGFuZGFyZCBhbmQgZmxhdCBzaGFkZXJzLgogKgogKiBAcGFyYW0ge29iamVjdH0gc2hhZGVyIC0gQS1GcmFtZSBzaGFkZXIgaW5zdGFuY2UuCiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhCiAqLwptb2R1bGUuZXhwb3J0cy51cGRhdGVNYXAgPSBmdW5jdGlvbiAoc2hhZGVyLCBkYXRhKSB7CiAgcmV0dXJuIG1vZHVsZS5leHBvcnRzLnVwZGF0ZU1hcE1hdGVyaWFsRnJvbURhdGEoJ21hcCcsICdzcmMnLCBzaGFkZXIsIGRhdGEpOwp9OwoKLyoqCiAqIFVwZGF0ZXMgdGhlIG1hdGVyaWFsJ3MgbWFwcyB3aGljaCBnaXZlIHRoZSBpbGx1c2lvbiBvZiBleHRyYSBnZW9tZXRyeS4KICoKICogQHBhcmFtIHtzdHJpbmd9IGxvbmdUeXBlIC0gVGhlIGZyaWVuZGx5IG5hbWUgb2YgdGhlIG1hcCBmcm9tIHRoZSBjb21wb25lbnQgZS5nLiBhbWJpZW50T2NjbHVzaW9uTWFwIGJlY29tZXMgYW9NYXAgaW4gVEhSRUUuanMKICogQHBhcmFtIHtvYmplY3R9IHNoYWRlciAtIEEtRnJhbWUgc2hhZGVyIGluc3RhbmNlCiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhCiAqLwptb2R1bGUuZXhwb3J0cy51cGRhdGVEaXN0b3J0aW9uTWFwID0gZnVuY3Rpb24gKGxvbmdUeXBlLCBzaGFkZXIsIGRhdGEpIHsKICB2YXIgc2hvcnRUeXBlID0gbG9uZ1R5cGU7CiAgaWYgKGxvbmdUeXBlID09PSAnYW1iaWVudE9jY2x1c2lvbicpIHsgc2hvcnRUeXBlID0gJ2FvJzsgfQogIHZhciBlbCA9IHNoYWRlci5lbDsKICB2YXIgbWF0ZXJpYWwgPSBzaGFkZXIubWF0ZXJpYWw7CiAgdmFyIHJlbmRlcmVyU3lzdGVtID0gZWwuc2NlbmVFbC5zeXN0ZW1zLnJlbmRlcmVyOwogIHZhciBzcmMgPSBkYXRhW2xvbmdUeXBlICsgJ01hcCddOwogIHZhciBpbmZvID0ge307CiAgaW5mby5zcmMgPSBzcmM7CgogIC8vIFBhc3MgdGhyb3VnaCB0aGUgcmVwZWF0IGFuZCBvZmZzZXQgdG8gYmUgaGFuZGxlZCBieSB0aGUgbWF0ZXJpYWwgbG9hZGVyLgogIGluZm8ub2Zmc2V0ID0gZGF0YVtsb25nVHlwZSArICdUZXh0dXJlT2Zmc2V0J107CiAgaW5mby5yZXBlYXQgPSBkYXRhW2xvbmdUeXBlICsgJ1RleHR1cmVSZXBlYXQnXTsKICBpbmZvLndyYXAgPSBkYXRhW2xvbmdUeXBlICsgJ1RleHR1cmVXcmFwJ107CgogIGlmIChzcmMpIHsKICAgIGlmIChzcmMgPT09IHNoYWRlcltsb25nVHlwZSArICdUZXh0dXJlU3JjJ10pIHsgcmV0dXJuOyB9CgogICAgLy8gVGV4dHVyZSBhZGRlZCBvciBjaGFuZ2VkLgogICAgc2hhZGVyW2xvbmdUeXBlICsgJ1RleHR1cmVTcmMnXSA9IHNyYzsKICAgIGVsLnNjZW5lRWwuc3lzdGVtcy5tYXRlcmlhbC5sb2FkVGV4dHVyZShzcmMsIGluZm8sIHNldE1hcCk7CiAgICByZXR1cm47CiAgfQoKICAvLyBUZXh0dXJlIHJlbW92ZWQuCiAgaWYgKCFtYXRlcmlhbC5tYXApIHsgcmV0dXJuOyB9CiAgc2V0TWFwKG51bGwpOwoKICBmdW5jdGlvbiBzZXRNYXAgKHRleHR1cmUpIHsKICAgIHZhciBzbG90ID0gc2hvcnRUeXBlICsgJ01hcCc7CiAgICBtYXRlcmlhbFtzbG90XSA9IHRleHR1cmU7CiAgICBpZiAodGV4dHVyZSAmJiBDT0xPUl9NQVBTLmhhcyhzbG90KSkgewogICAgICByZW5kZXJlclN5c3RlbS5hcHBseUNvbG9yQ29ycmVjdGlvbih0ZXh0dXJlKTsKICAgIH0KICAgIG1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIGhhbmRsZVRleHR1cmVFdmVudHMoZWwsIHRleHR1cmUpOwogIH0KfTsKCi8qKgogKiBFbWl0IGV2ZW50IG9uIGVudGl0aWVzIG9uIHRleHR1cmUtcmVsYXRlZCBldmVudHMuCiAqCiAqIEBwYXJhbSB7RWxlbWVudH0gZWwgLSBFbnRpdHkuCiAqIEBwYXJhbSB7b2JqZWN0fSB0ZXh0dXJlIC0gdGhyZWUuanMgVGV4dHVyZS4KICovCmZ1bmN0aW9uIGhhbmRsZVRleHR1cmVFdmVudHMgKGVsLCB0ZXh0dXJlKSB7CiAgaWYgKCF0ZXh0dXJlKSB7IHJldHVybjsgfQoKICBlbC5lbWl0KCdtYXRlcmlhbHRleHR1cmVsb2FkZWQnLCB7c3JjOiB0ZXh0dXJlLmltYWdlLCB0ZXh0dXJlOiB0ZXh0dXJlfSk7CgogIC8vIFZpZGVvIGV2ZW50cy4KICBpZiAoIXRleHR1cmUuaW1hZ2UgfHwgdGV4dHVyZS5pbWFnZS50YWdOYW1lICE9PSAnVklERU8nKSB7IHJldHVybjsgfQoKICB0ZXh0dXJlLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZGRhdGEnLCBmdW5jdGlvbiBlbWl0VmlkZW9UZXh0dXJlTG9hZGVkRGF0YUFsbCAoKSB7CiAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byB1c2UgaU9TIDEwIEhMUyBzaGFkZXIuCiAgICAvLyBPbmx5IG92ZXJyaWRlIHRoZSBzaGFkZXIgaWYgaXQgaXMgc3RvY2sgc2hhZGVyIHRoYXQgd2Uga25vdyBkb2Vzbid0IGNvcnJlY3QuCiAgICBpZiAoIWVsLmNvbXBvbmVudHMgfHwgIWVsLmNvbXBvbmVudHMubWF0ZXJpYWwpIHsgcmV0dXJuOyB9CgogICAgaWYgKHRleHR1cmUubmVlZHNDb3JyZWN0aW9uQkdSQSAmJiB0ZXh0dXJlLm5lZWRzQ29ycmVjdGlvbkZsaXBZICYmCiAgICAgICAgWydzdGFuZGFyZCcsICdmbGF0J10uaW5kZXhPZihlbC5jb21wb25lbnRzLm1hdGVyaWFsLmRhdGEuc2hhZGVyKSAhPT0gLTEpIHsKICAgICAgZWwuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsICdzaGFkZXInLCAnaW9zMTBobHMnKTsKICAgIH0KCiAgICBlbC5lbWl0KCdtYXRlcmlhbHZpZGVvbG9hZGVkZGF0YScsIHtzcmM6IHRleHR1cmUuaW1hZ2UsIHRleHR1cmU6IHRleHR1cmV9KTsKICB9KTsKICB0ZXh0dXJlLmltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgZnVuY3Rpb24gZW1pdFZpZGVvVGV4dHVyZUVuZGVkQWxsICgpIHsKICAgIC8vIFdvcmtzIGZvciBub24tbG9vcGluZyB2aWRlb3Mgb25seS4KICAgIGVsLmVtaXQoJ21hdGVyaWFsdmlkZW9lbmRlZCcsIHtzcmM6IHRleHR1cmUuaW1hZ2UsIHRleHR1cmU6IHRleHR1cmV9KTsKICB9KTsKfQptb2R1bGUuZXhwb3J0cy5oYW5kbGVUZXh0dXJlRXZlbnRzID0gaGFuZGxlVGV4dHVyZUV2ZW50czsKCi8qKgogKiBHaXZlbiB2aWRlbyBlbGVtZW50IHNyYyBhbmQgdHlwZSwgZ3Vlc3Mgd2hldGhlciBzdHJlYW0gaXMgSExTLgogKgogKiBAcGFyYW0ge3N0cmluZ30gc3JjIC0gc3JjIGZyb20gdmlkZW8gZWxlbWVudCAoZ2VuZXJhbGx5IFVSTCB0byBjb250ZW50KS4KICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSB0eXBlIGZyb20gdmlkZW8gZWxlbWVudCAoZ2VuZXJhbGx5IE1JTUUgdHlwZSBpZiBwcmVzZW50KS4KICovCm1vZHVsZS5leHBvcnRzLmlzSExTID0gZnVuY3Rpb24gKHNyYywgdHlwZSkgewogIGlmICh0eXBlICYmIEhMU19NSU1FVFlQRVMuaW5jbHVkZXModHlwZS50b0xvd2VyQ2FzZSgpKSkgeyByZXR1cm4gdHJ1ZTsgfQogIGlmIChzcmMgJiYgc3JjLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignLm0zdTgnKSA+IDApIHsgcmV0dXJuIHRydWU7IH0KICByZXR1cm4gZmFsc2U7Cn07Cgp9LHsiLi4vbGliL3RocmVlIjoxNTR9XSwxODM6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKgogIEFkYXB0ZWQgZGVlUG9vbCBieSBLeWxlIFNpbXBzb24uCiAgTUlUIExpY2Vuc2U6IGh0dHA6Ly9nZXRpZnkubWl0LWxpY2Vuc2Uub3JnCiovCnZhciBFTVBUWV9TTE9UID0gT2JqZWN0LmZyZWV6ZShPYmplY3QuY3JlYXRlKG51bGwpKTsKCi8vIERlZmF1bHQgb2JqZWN0IGZhY3RvcnkuCmZ1bmN0aW9uIGRlZmF1bHRPYmplY3RGYWN0b3J5ICgpIHsgcmV0dXJuIHt9OyB9CgovKioKICogQ3JlYXRlIGEgbmV3IHBvb2wuCiAqLwptb2R1bGUuZXhwb3J0cy5jcmVhdGVQb29sID0gZnVuY3Rpb24gY3JlYXRlUG9vbCAob2JqZWN0RmFjdG9yeSkgewogIHZhciBvYmpQb29sID0gW107CiAgdmFyIG5leHRGcmVlU2xvdCA9IG51bGw7ICAvLyBQb29sIGxvY2F0aW9uIHRvIGxvb2sgZm9yIGEgZnJlZSBvYmplY3QgdG8gdXNlLgoKICBvYmplY3RGYWN0b3J5ID0gb2JqZWN0RmFjdG9yeSB8fCBkZWZhdWx0T2JqZWN0RmFjdG9yeTsKCiAgZnVuY3Rpb24gdXNlICgpIHsKICAgIHZhciBvYmpUb1VzZTsKICAgIGlmIChuZXh0RnJlZVNsb3QgPT09IG51bGwgfHwgbmV4dEZyZWVTbG90ID09PSBvYmpQb29sLmxlbmd0aCkgewogICAgICBncm93KG9ialBvb2wubGVuZ3RoIHx8IDUpOwogICAgfQogICAgb2JqVG9Vc2UgPSBvYmpQb29sW25leHRGcmVlU2xvdF07CiAgICBvYmpQb29sW25leHRGcmVlU2xvdCsrXSA9IEVNUFRZX1NMT1Q7CiAgICBjbGVhck9iamVjdChvYmpUb1VzZSk7CiAgICByZXR1cm4gb2JqVG9Vc2U7CiAgfQoKICBmdW5jdGlvbiByZWN5Y2xlIChvYmopIHsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkpIHsgcmV0dXJuOyB9CiAgICBpZiAobmV4dEZyZWVTbG90ID09PSBudWxsIHx8IG5leHRGcmVlU2xvdCA9PT0gLTEpIHsKICAgICAgb2JqUG9vbFtvYmpQb29sLmxlbmd0aF0gPSBvYmo7CiAgICAgIHJldHVybjsKICAgIH0KICAgIG9ialBvb2xbLS1uZXh0RnJlZVNsb3RdID0gb2JqOwogIH0KCiAgZnVuY3Rpb24gZ3JvdyAoY291bnQpIHsKICAgIHZhciBjdXJyZW50TGVuZ3RoOwogICAgdmFyIGk7CgogICAgY291bnQgPSBjb3VudCA9PT0gdW5kZWZpbmVkID8gb2JqUG9vbC5sZW5ndGggOiBjb3VudDsKICAgIGlmIChjb3VudCA+IDAgJiYgbmV4dEZyZWVTbG90ID09IG51bGwpIHsKICAgICAgbmV4dEZyZWVTbG90ID0gMDsKICAgIH0KCiAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgIGN1cnJlbnRMZW5ndGggPSBvYmpQb29sLmxlbmd0aDsKICAgICAgb2JqUG9vbC5sZW5ndGggKz0gTnVtYmVyKGNvdW50KTsKICAgICAgZm9yIChpID0gY3VycmVudExlbmd0aDsgaSA8IG9ialBvb2wubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBBZGQgbmV3IG9iaiB0byBwb29sLgogICAgICAgIG9ialBvb2xbaV0gPSBvYmplY3RGYWN0b3J5KCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqUG9vbC5sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBzaXplICgpIHsKICAgIHJldHVybiBvYmpQb29sLmxlbmd0aDsKICB9CgogIHJldHVybiB7CiAgICBncm93OiBncm93LAogICAgcG9vbDogb2JqUG9vbCwKICAgIHJlY3ljbGU6IHJlY3ljbGUsCiAgICBzaXplOiBzaXplLAogICAgdXNlOiB1c2UKICB9Owp9OwoKZnVuY3Rpb24gY2xlYXJPYmplY3QgKG9iaikgewogIHZhciBrZXk7CiAgaWYgKCFvYmogfHwgb2JqLmNvbnN0cnVjdG9yICE9PSBPYmplY3QpIHsgcmV0dXJuOyB9CiAgZm9yIChrZXkgaW4gb2JqKSB7IG9ialtrZXldID0gdW5kZWZpbmVkOyB9Cn0KbW9kdWxlLmV4cG9ydHMuY2xlYXJPYmplY3QgPSBjbGVhck9iamVjdDsKCmZ1bmN0aW9uIHJlbW92ZVVudXNlZEtleXMgKG9iaiwgc2NoZW1hKSB7CiAgdmFyIGtleTsKICBpZiAoIW9iaiB8fCBvYmouY29uc3RydWN0b3IgIT09IE9iamVjdCkgeyByZXR1cm47IH0KICBmb3IgKGtleSBpbiBvYmopIHsKICAgIGlmICghKGtleSBpbiBzY2hlbWEpKSB7CiAgICAgIGRlbGV0ZSBvYmpba2V5XTsKICAgIH0KICB9Cn0KbW9kdWxlLmV4cG9ydHMucmVtb3ZlVW51c2VkS2V5cyA9IHJlbW92ZVVudXNlZEtleXM7Cgp9LHt9XSwxODQ6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKioKICogU3RyaW5nIHNwbGl0IHdpdGggY2FjaGVkIHJlc3VsdC4KICovCm1vZHVsZS5leHBvcnRzLnNwbGl0ID0gKGZ1bmN0aW9uICgpIHsKICB2YXIgc3BsaXRDYWNoZSA9IHt9OwoKICByZXR1cm4gZnVuY3Rpb24gKHN0ciwgZGVsaW1pdGVyKSB7CiAgICBpZiAoIShkZWxpbWl0ZXIgaW4gc3BsaXRDYWNoZSkpIHsgc3BsaXRDYWNoZVtkZWxpbWl0ZXJdID0ge307IH0KCiAgICBpZiAoc3RyIGluIHNwbGl0Q2FjaGVbZGVsaW1pdGVyXSkgeyByZXR1cm4gc3BsaXRDYWNoZVtkZWxpbWl0ZXJdW3N0cl07IH0KCiAgICBzcGxpdENhY2hlW2RlbGltaXRlcl1bc3RyXSA9IHN0ci5zcGxpdChkZWxpbWl0ZXIpOwogICAgcmV0dXJuIHNwbGl0Q2FjaGVbZGVsaW1pdGVyXVtzdHJdOwogIH07Cn0pKCk7Cgp9LHt9XSwxODU6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovKiBnbG9iYWwgSW1hZ2UsIFhNTEh0dHBSZXF1ZXN0ICovCnZhciBkZWJ1ZyA9IF9kZXJlcV8oJy4vZGVidWcnKTsKCnZhciB3YXJuID0gZGVidWcoJ3V0aWxzOnNyYy1sb2FkZXI6d2FybicpOwoKLyoqCiAqIFZhbGlkYXRlIGEgdGV4dHVyZSwgZWl0aGVyIGFzIGEgc2VsZWN0b3Igb3IgYXMgYSBVUkwuCiAqIERldGVjdHMgd2hldGhlciBgc3JjYCBpcyBwb2ludGluZyB0byBhbiBpbWFnZSBvciB2aWRlbyBhbmQgaW52b2tlcyB0aGUgYXBwcm9wcmlhdGUKICogY2FsbGJhY2suCiAqCiAqIGBzcmNgIHdpbGwgYmUgcGFzc2VkIGludG8gdGhlIGNhbGxiYWNrCiAqCiAqIEBwYXJhbXMge3N0cmluZ3xFbGVtZW50fSBzcmMgLSBVUkwgb3IgbWVkaWEgZWxlbWVudC4KICogQHBhcmFtcyB7ZnVuY3Rpb259IGlzSW1hZ2VDYiAtIGNhbGxiYWNrIGlmIHRleHR1cmUgaXMgYW4gaW1hZ2UuCiAqIEBwYXJhbXMge2Z1bmN0aW9ufSBpc1ZpZGVvQ2IgLSBjYWxsYmFjayBpZiB0ZXh0dXJlIGlzIGEgdmlkZW8uCiAqLwpmdW5jdGlvbiB2YWxpZGF0ZVNyYyAoc3JjLCBpc0ltYWdlQ2IsIGlzVmlkZW9DYikgewogIGNoZWNrSXNJbWFnZShzcmMsIGZ1bmN0aW9uIGlzQW5JbWFnZVVybCAoaXNJbWFnZSkgewogICAgaWYgKGlzSW1hZ2UpIHsKICAgICAgaXNJbWFnZUNiKHNyYyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlzVmlkZW9DYihzcmMpOwogIH0pOwp9CgovKioKICogVmFsaWRhdGVzIHNpeCBpbWFnZXMgYXMgYSBjdWJlbWFwLCBlaXRoZXIgYXMgc2VsZWN0b3Igb3IgY29tbWEtc2VwYXJhdGVkCiAqIFVSTHMuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzcmMgLSBBIHNlbGVjdG9yIG9yIGNvbW1hLXNlcGFyYXRlZCBpbWFnZSBVUkxzLiBJbWFnZSBVUkxzCiAgICAgICAgICBtdXN0IGJlIHdyYXBwZWQgYnkgYHVybCgpYC4KICogQHBhcmFtIHtzdHJpbmd9IHNyYyAtIEEgc2VsZWN0b3Igb3IgY29tbWEtc2VwYXJhdGVkIGltYWdlIFVSTHMuIEltYWdlIFVSTHMKICAgICAgICAgIG11c3QgYmUgd3JhcHBlZCBieSBgdXJsKClgLgogKi8KZnVuY3Rpb24gdmFsaWRhdGVDdWJlbWFwU3JjIChzcmMsIGNiKSB7CiAgdmFyIGFDdWJlbWFwOwogIHZhciBjdWJlbWFwU3JjUmVnZXggPSAnJzsKICB2YXIgaTsKICB2YXIgdXJsczsKICB2YXIgdmFsaWRhdGVkVXJscyA9IFtdOwoKICBmb3IgKGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICBjdWJlbWFwU3JjUmVnZXggKz0gJyh1cmxcXCgoPzpbXlxcKV0rKVxcKSxcXHMqKSc7CiAgfQogIGN1YmVtYXBTcmNSZWdleCArPSAnKHVybFxcKCg/OlteXFwpXSspXFwpXFxzKiknOwogIHVybHMgPSBzcmMubWF0Y2gobmV3IFJlZ0V4cChjdWJlbWFwU3JjUmVnZXgpKTsKCiAgLy8gYHNyY2AgaXMgYSBjb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBVUkxzLgogIC8vIEluIHRoaXMgY2FzZSwgcmUtdXNlIHZhbGlkYXRlU3JjIGZvciBlYWNoIHNpZGUgb2YgdGhlIGN1YmUuCiAgZnVuY3Rpb24gaXNJbWFnZUNiICh1cmwpIHsKICAgIHZhbGlkYXRlZFVybHMucHVzaCh1cmwpOwogICAgaWYgKHZhbGlkYXRlZFVybHMubGVuZ3RoID09PSA2KSB7CiAgICAgIGNiKHZhbGlkYXRlZFVybHMpOwogICAgfQogIH0KICBpZiAodXJscykgewogICAgZm9yIChpID0gMTsgaSA8IDc7IGkrKykgewogICAgICB2YWxpZGF0ZVNyYyhwYXJzZVVybCh1cmxzW2ldKSwgaXNJbWFnZUNiKTsKICAgIH0KICAgIHJldHVybjsKICB9CgogIC8vIGBzcmNgIGlzIGEgcXVlcnkgc2VsZWN0b3IgdG8gPGEtY3ViZW1hcD4gY29udGFpbmluZyBzaXggJChbc3JjXSlzLgogIGFDdWJlbWFwID0gdmFsaWRhdGVBbmRHZXRRdWVyeVNlbGVjdG9yKHNyYyk7CiAgaWYgKCFhQ3ViZW1hcCkgeyByZXR1cm47IH0KICBpZiAoYUN1YmVtYXAudGFnTmFtZSA9PT0gJ0EtQ1VCRU1BUCcgJiYgYUN1YmVtYXAuc3JjcykgewogICAgcmV0dXJuIGNiKGFDdWJlbWFwLnNyY3MpOwogIH0KICAvLyBFbHNlIGlmIGFDdWJlTWFwIGlzIG5vdCBhIDxhLWN1YmVtYXA+LgogIHdhcm4oJ1NlbGVjdG9yICIlcyIgZG9lcyBub3QgcG9pbnQgdG8gPGEtY3ViZW1hcD4nLCBzcmMpOwp9CgovKioKICogUGFyc2VzIHNyYyBmcm9tIGB1cmwoc3JjKWAuCiAqIEBwYXJhbSAge3N0cmluZ30gc3JjIC0gU3RyaW5nIHRvIHBhcnNlLgogKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXJzZWQgc3JjLCBpZiBwYXJzZWFibGUuCiAqLwpmdW5jdGlvbiBwYXJzZVVybCAoc3JjKSB7CiAgdmFyIHBhcnNlZFNyYyA9IHNyYy5tYXRjaCgvXHVybFwoKC4rKVwpLyk7CiAgaWYgKCFwYXJzZWRTcmMpIHsgcmV0dXJuOyB9CiAgcmV0dXJuIHBhcnNlZFNyY1sxXTsKfQoKLyoqCiAqIENhbGwgYmFjayB3aGV0aGVyIGBzcmNgIGlzIGFuIGltYWdlLgogKgogKiBAcGFyYW0ge3N0cmluZ3xFbGVtZW50fSBzcmMgLSBVUkwgb3IgZWxlbWVudCB0aGF0IHdpbGwgYmUgdGVzdGVkLgogKiBAcGFyYW0ge2Z1bmN0aW9ufSBvblJlc3VsdCAtIENhbGxiYWNrIHdpdGggd2hldGhlciBgc3JjYCBpcyBhbiBpbWFnZS4KICovCmZ1bmN0aW9uIGNoZWNrSXNJbWFnZSAoc3JjLCBvblJlc3VsdCkgewogIHZhciByZXF1ZXN0OwoKICBpZiAoc3JjLnRhZ05hbWUpIHsKICAgIG9uUmVzdWx0KHNyYy50YWdOYW1lID09PSAnSU1HJyk7CiAgICByZXR1cm47CiAgfQogIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgLy8gVHJ5IHRvIHNlbmQgSEVBRCByZXF1ZXN0IHRvIGNoZWNrIGlmIGltYWdlIGZpcnN0LgogIHJlcXVlc3Qub3BlbignSEVBRCcsIHNyYyk7CiAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB2YXIgY29udGVudFR5cGU7CiAgICBpZiAocmVxdWVzdC5zdGF0dXMgPj0gMjAwICYmIHJlcXVlc3Quc3RhdHVzIDwgMzAwKSB7CiAgICAgIGNvbnRlbnRUeXBlID0gcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcignQ29udGVudC1UeXBlJyk7CiAgICAgIGlmIChjb250ZW50VHlwZSA9PSBudWxsKSB7CiAgICAgICAgY2hlY2tJc0ltYWdlRmFsbGJhY2soc3JjLCBvblJlc3VsdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNvbnRlbnRUeXBlLnN0YXJ0c1dpdGgoJ2ltYWdlJykpIHsKICAgICAgICAgIG9uUmVzdWx0KHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvblJlc3VsdChmYWxzZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjaGVja0lzSW1hZ2VGYWxsYmFjayhzcmMsIG9uUmVzdWx0KTsKICAgIH0KICAgIHJlcXVlc3QuYWJvcnQoKTsKICB9KTsKICByZXF1ZXN0LnNlbmQoKTsKfQoKZnVuY3Rpb24gY2hlY2tJc0ltYWdlRmFsbGJhY2sgKHNyYywgb25SZXN1bHQpIHsKICB2YXIgdGVzdGVyID0gbmV3IEltYWdlKCk7CiAgdGVzdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBvbkxvYWQpOwogIGZ1bmN0aW9uIG9uTG9hZCAoKSB7IG9uUmVzdWx0KHRydWUpOyB9CiAgdGVzdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgb25FcnJvcik7CiAgZnVuY3Rpb24gb25FcnJvciAoKSB7IG9uUmVzdWx0KGZhbHNlKTsgfQogIHRlc3Rlci5zcmMgPSBzcmM7Cn0KCi8qKgogKiBRdWVyeSBhbmQgdmFsaWRhdGUgYSBxdWVyeSBzZWxlY3RvciwKICoKICogQHBhcmFtICB7c3RyaW5nfSBzZWxlY3RvciAtIERPTSBzZWxlY3Rvci4KICogQHJldHVybiB7b2JqZWN0fG51bGx8dW5kZWZpbmVkfSBTZWxlY3RlZCBET00gZWxlbWVudCBpZiBleGlzdHMuCiAgICAgICAgICAgbnVsbCBpZiBxdWVyeSB5aWVsZHMgbm8gcmVzdWx0cy4KICAgICAgICAgICB1bmRlZmluZWQgaWYgYHNlbGVjdG9yYCBpcyBub3QgYSB2YWxpZCBzZWxlY3Rvci4KICovCmZ1bmN0aW9uIHZhbGlkYXRlQW5kR2V0UXVlcnlTZWxlY3RvciAoc2VsZWN0b3IpIHsKICB0cnkgewogICAgdmFyIGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7CiAgICBpZiAoIWVsKSB7CiAgICAgIHdhcm4oJ05vIGVsZW1lbnQgd2FzIGZvdW5kIG1hdGNoaW5nIHRoZSBzZWxlY3RvcjogIiVzIicsIHNlbGVjdG9yKTsKICAgIH0KICAgIHJldHVybiBlbDsKICB9IGNhdGNoIChlKSB7ICAvLyBDYXB0dXJlIGV4Y2VwdGlvbiBpZiBpdCdzIG5vdCBhIHZhbGlkIHNlbGVjdG9yLgogICAgd2FybignIiVzIiBpcyBub3QgYSB2YWxpZCBzZWxlY3RvcicsIHNlbGVjdG9yKTsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQp9Cgptb2R1bGUuZXhwb3J0cyA9IHsKICBwYXJzZVVybDogcGFyc2VVcmwsCiAgdmFsaWRhdGVTcmM6IHZhbGlkYXRlU3JjLAogIHZhbGlkYXRlQ3ViZW1hcFNyYzogdmFsaWRhdGVDdWJlbWFwU3JjCn07Cgp9LHsiLi9kZWJ1ZyI6MTc1fV0sMTg2OltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIFV0aWxzIGZvciBwYXJzaW5nIHN0eWxlLWxpa2Ugc3RyaW5ncyAoZS5nLiwgInByaW1pdGl2ZTogYm94OyB3aWR0aDogNTsgaGVpZ2h0OiA0LjUiKS4KICogU29tZSBjb2RlIGFkYXB0ZWQgZnJvbSBgc3R5bGUtYXR0cmAgKGh0dHBzOi8vZ2l0aHViLmNvbS9qb3Nod25qL3N0eWxlLWF0dHIpCiAqIGJ5IEpvc2ggSm9obnN0b24gKE1JVCBMaWNlbnNlKS4KICovCnZhciBEQVNIX1JFR0VYID0gLy0oW2Etel0pL2c7CgovKioKICogRGVzZXJpYWxpemUgc3R5bGUtbGlrZSBzdHJpbmcgaW50byBhbiBvYmplY3Qgb2YgcHJvcGVydGllcy4KICoKICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gSFRNTCBhdHRyaWJ1dGUgdmFsdWUuCiAqIEBwYXJhbSB7b2JqZWN0fSBvYmogLSBSZXVzZWQgb2JqZWN0IGZvciBvYmplY3QgcG9vbGluZy4KICogQHJldHVybnMge29iamVjdH0gUHJvcGVydHkgZGF0YS4KICovCm1vZHVsZS5leHBvcnRzLnBhcnNlID0gZnVuY3Rpb24gKHZhbHVlLCBvYmopIHsKICB2YXIgcGFyc2VkRGF0YTsKICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgeyByZXR1cm4gdmFsdWU7IH0KICBwYXJzZWREYXRhID0gc3R5bGVQYXJzZSh2YWx1ZSwgb2JqKTsKICAvLyBUaGUgc3R5bGUgcGFyc2VyIHJldHVybnMgYW4gb2JqZWN0IHsgIiIgOiAidGVzdCJ9IHdoZW4gZmVkIGEgc3RyaW5nCiAgaWYgKHBhcnNlZERhdGFbJyddKSB7IHJldHVybiB2YWx1ZTsgfQogIHJldHVybiB0cmFuc2Zvcm1LZXlzVG9DYW1lbENhc2UocGFyc2VkRGF0YSk7Cn07CgovKioKICogU2VyaWFsaXplIGFuIG9iamVjdCBvZiBwcm9wZXJ0aWVzIGludG8gYSBzdHlsZS1saWtlIHN0cmluZy4KICoKICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBQcm9wZXJ0eSBkYXRhLgogKiBAcmV0dXJucyB7c3RyaW5nfQogKi8KbW9kdWxlLmV4cG9ydHMuc3RyaW5naWZ5ID0gZnVuY3Rpb24gKGRhdGEpIHsKICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7IHJldHVybiBkYXRhOyB9CiAgcmV0dXJuIHN0eWxlU3RyaW5naWZ5KGRhdGEpOwp9OwoKLyoqCiAqIENvbnZlcnRzIHN0cmluZyBmcm9tIGh5cGhlbiB0byBjYW1lbENhc2UuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgLSBTdHJpbmcgdG8gY2FtZWxDYXNlLgogKiBAcmV0dXJuIHtzdHJpbmd9IENhbWVsQ2FzZWQgc3RyaW5nLgogKi8KZnVuY3Rpb24gdG9DYW1lbENhc2UgKHN0cikgewogIHJldHVybiBzdHIucmVwbGFjZShEQVNIX1JFR0VYLCB1cHBlckNhc2UpOwp9Cm1vZHVsZS5leHBvcnRzLnRvQ2FtZWxDYXNlID0gdG9DYW1lbENhc2U7CgovKioKICogQ29udmVydHMgb2JqZWN0J3Mga2V5cyBmcm9tIGh5cGhlbnMgdG8gY2FtZWxDYXNlIChlLmcuLCBgbWF4LXZhbHVlYCB0bwogKiBgbWF4VmFsdWVgKS4KICoKICogQHBhcmFtIHtvYmplY3R9IG9iaiAtIFRoZSBvYmplY3QgdG8gY2FtZWxDYXNlIGtleXMuCiAqIEByZXR1cm4ge29iamVjdH0gVGhlIG9iamVjdCB3aXRoIGtleXMgY2FtZWxDYXNlZC4KICovCmZ1bmN0aW9uIHRyYW5zZm9ybUtleXNUb0NhbWVsQ2FzZSAob2JqKSB7CiAgdmFyIGNhbWVsS2V5OwogIHZhciBrZXk7CiAgZm9yIChrZXkgaW4gb2JqKSB7CiAgICBjYW1lbEtleSA9IHRvQ2FtZWxDYXNlKGtleSk7CiAgICBpZiAoa2V5ID09PSBjYW1lbEtleSkgeyBjb250aW51ZTsgfQogICAgb2JqW2NhbWVsS2V5XSA9IG9ialtrZXldOwogICAgZGVsZXRlIG9ialtrZXldOwogIH0KICByZXR1cm4gb2JqOwp9Cm1vZHVsZS5leHBvcnRzLnRyYW5zZm9ybUtleXNUb0NhbWVsQ2FzZSA9IHRyYW5zZm9ybUtleXNUb0NhbWVsQ2FzZTsKCi8qKgogKiBTcGxpdCBhIHN0cmluZyBpbnRvIGNodW5rcyBtYXRjaGluZyBgPGtleT46IDx2YWx1ZT5gCiAqLwp2YXIgZ2V0S2V5VmFsdWVDaHVua3MgPSAoZnVuY3Rpb24gKCkgewogIHZhciBjaHVua3MgPSBbXTsKICB2YXIgaGFzVW5jbG9zZWRVcmwgPSAvdXJsXChbXildKyQvOwoKICByZXR1cm4gZnVuY3Rpb24gZ2V0S2V5VmFsdWVDaHVua3MgKHJhdykgewogICAgdmFyIGNodW5rID0gJyc7CiAgICB2YXIgbmV4dFNwbGl0OwogICAgdmFyIG9mZnNldCA9IDA7CiAgICB2YXIgc2VwID0gJzsnOwoKICAgIGNodW5rcy5sZW5ndGggPSAwOwoKICAgIHdoaWxlIChvZmZzZXQgPCByYXcubGVuZ3RoKSB7CiAgICAgIG5leHRTcGxpdCA9IHJhdy5pbmRleE9mKHNlcCwgb2Zmc2V0KTsKICAgICAgaWYgKG5leHRTcGxpdCA9PT0gLTEpIHsgbmV4dFNwbGl0ID0gcmF3Lmxlbmd0aDsgfQoKICAgICAgY2h1bmsgKz0gcmF3LnN1YnN0cmluZyhvZmZzZXQsIG5leHRTcGxpdCk7CgogICAgICAvLyBkYXRhIFVSSXMgY2FuIGNvbnRhaW4gc2VtaWNvbG9ucywgc28gbWFrZSBzdXJlIHdlIGdldCB0aGUgd2hvbGUgdGhpbmcKICAgICAgaWYgKGhhc1VuY2xvc2VkVXJsLnRlc3QoY2h1bmspKSB7CiAgICAgICAgY2h1bmsgKz0gJzsnOwogICAgICAgIG9mZnNldCA9IG5leHRTcGxpdCArIDE7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGNodW5rcy5wdXNoKGNodW5rLnRyaW0oKSk7CiAgICAgIGNodW5rID0gJyc7CiAgICAgIG9mZnNldCA9IG5leHRTcGxpdCArIDE7CiAgICB9CgogICAgcmV0dXJuIGNodW5rczsKICB9Owp9KSgpOwoKLyoqCiAqIENvbnZlcnQgYSBzdHlsZSBhdHRyaWJ1dGUgc3RyaW5nIHRvIGFuIG9iamVjdC4KICoKICogQHBhcmFtIHtvYmplY3R9IHN0ciAtIEF0dHJpYnV0ZSBzdHJpbmcuCiAqIEBwYXJhbSB7b2JqZWN0fSBvYmogLSBPYmplY3QgdG8gcmV1c2UgYXMgYSBiYXNlLCBlbHNlIGEgbmV3IG9uZSB3aWxsIGJlIGFsbG9jYXRlZC4KICovCmZ1bmN0aW9uIHN0eWxlUGFyc2UgKHN0ciwgb2JqKSB7CiAgdmFyIGNodW5rczsKICB2YXIgaTsKICB2YXIgaXRlbTsKICB2YXIgcG9zOwogIHZhciBrZXk7CiAgdmFyIHZhbDsKCiAgb2JqID0gb2JqIHx8IHt9OwoKICBjaHVua3MgPSBnZXRLZXlWYWx1ZUNodW5rcyhzdHIpOwogIGZvciAoaSA9IDA7IGkgPCBjaHVua3MubGVuZ3RoOyBpKyspIHsKICAgIGl0ZW0gPSBjaHVua3NbaV07CiAgICBpZiAoIWl0ZW0pIHsgY29udGludWU7IH0KICAgIC8vIFNwbGl0IHdpdGggYC5pbmRleE9mYCByYXRoZXIgdGhhbiBgLnNwbGl0YCBiZWNhdXNlIHRoZSB2YWx1ZSBtYXkgYWxzbyBjb250YWluIGNvbG9ucy4KICAgIHBvcyA9IGl0ZW0uaW5kZXhPZignOicpOwogICAga2V5ID0gaXRlbS5zdWJzdHIoMCwgcG9zKS50cmltKCk7CiAgICB2YWwgPSBpdGVtLnN1YnN0cihwb3MgKyAxKS50cmltKCk7CiAgICBvYmpba2V5XSA9IHZhbDsKICB9CiAgcmV0dXJuIG9iajsKfQoKLyoqCiAqIENvbnZlcnQgYW4gb2JqZWN0IGludG8gYW4gYXR0cmlidXRlIHN0cmluZwogKiovCmZ1bmN0aW9uIHN0eWxlU3RyaW5naWZ5IChvYmopIHsKICB2YXIga2V5OwogIHZhciBrZXlDb3VudCA9IDA7CiAgdmFyIGkgPSAwOwogIHZhciBzdHIgPSAnJzsKCiAgZm9yIChrZXkgaW4gb2JqKSB7IGtleUNvdW50Kys7IH0KCiAgZm9yIChrZXkgaW4gb2JqKSB7CiAgICBzdHIgKz0gKGtleSArICc6ICcgKyBvYmpba2V5XSk7CiAgICBpZiAoaSA8IGtleUNvdW50IC0gMSkgeyBzdHIgKz0gJzsgJzsgfQogICAgaSsrOwogIH0KICByZXR1cm4gc3RyOwp9CgpmdW5jdGlvbiB1cHBlckNhc2UgKHN0cikgeyByZXR1cm4gc3RyWzFdLnRvVXBwZXJDYXNlKCk7IH0KCn0se31dLDE4NzpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CnZhciBERUZBVUxUX0hBTkRFRE5FU1MgPSBfZGVyZXFfKCcuLi9jb25zdGFudHMnKS5ERUZBVUxUX0hBTkRFRE5FU1M7CnZhciBBWElTX0xBQkVMUyA9IFsneCcsICd5JywgJ3onLCAndyddOwp2YXIgTlVNX0hBTkRTID0gMjsgIC8vIE51bWJlciBvZiBoYW5kcyBpbiBhIHBhaXIuIFNob3VsZCBhbHdheXMgYmUgMi4KCi8qKgogKiBDYWxsZWQgb24gY29udHJvbGxlciBjb21wb25lbnQgYC5wbGF5YCBoYW5kbGVycy4KICogQ2hlY2sgaWYgY29udHJvbGxlciBtYXRjaGVzIHBhcmFtZXRlcnMgYW5kIGluamVjdCB0cmFja2VkLWNvbnRyb2xzIGNvbXBvbmVudC4KICogSGFuZGxlIGV2ZW50IGxpc3RlbmVycy4KICogR2VuZXJhdGUgY29udHJvbGxlcmNvbm5lY3RlZCBvciBjb250cm9sbGVyZGlzY29ubmVjdGVkIGV2ZW50cy4KICoKICogQHBhcmFtIHtvYmplY3R9IGNvbXBvbmVudCAtIFRyYWNrZWQgY29udHJvbHMgY29tcG9uZW50LgogKiBAcGFyYW0ge29iamVjdH0gaWRQcmVmaXggLSBQcmVmaXggdG8gbWF0Y2ggaW4gZ2FtZXBhZCBpZCBpZiBhbnkuCiAqIEBwYXJhbSB7b2JqZWN0fSBxdWVyeU9iamVjdCAtIE1hcCBvZiB2YWx1ZXMgdG8gbWF0Y2guCiAqLwptb2R1bGUuZXhwb3J0cy5jaGVja0NvbnRyb2xsZXJQcmVzZW50QW5kU2V0dXAgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBpZFByZWZpeCwgcXVlcnlPYmplY3QpIHsKICB2YXIgZWwgPSBjb21wb25lbnQuZWw7CiAgdmFyIGNvbnRyb2xsZXI7CiAgdmFyIGhhc1dlYlhSID0gZWwuc2NlbmVFbC5oYXNXZWJYUjsKICB2YXIgaXNDb250cm9sbGVyUHJlc2VudCA9IGhhc1dlYlhSID8gaXNDb250cm9sbGVyUHJlc2VudFdlYlhSIDogaXNDb250cm9sbGVyUHJlc2VudFdlYlZSOwogIHZhciBpc1ByZXNlbnQ7CgogIGNvbnRyb2xsZXIgPSBpc0NvbnRyb2xsZXJQcmVzZW50KGNvbXBvbmVudCwgaWRQcmVmaXgsIHF1ZXJ5T2JqZWN0KTsKICBpc1ByZXNlbnQgPSAhIWNvbnRyb2xsZXI7CgogIC8vIElmIGNvbXBvbmVudCB3YXMgcHJldmlvdXNseSBwYXVzZWQgYW5kIG5vdyBwbGF5aW5nLCByZS1hZGQgZXZlbnQgbGlzdGVuZXJzLgogIC8vIEhhbmRsZSB0aGUgZXZlbnQgbGlzdGVuZXJzIGhlcmUgc2luY2UgdGhpcyBoZWxwZXIgbWV0aG9kIGlzIGNvbnRyb2wgb2YgY2FsbGluZwogIC8vIGAuYWRkRXZlbnRMaXN0ZW5lcnNgIGFuZCBgLnJlbW92ZUV2ZW50TGlzdGVuZXJzYC4KICBpZiAoY29tcG9uZW50LmNvbnRyb2xsZXJQcmVzZW50ICYmICFjb21wb25lbnQuY29udHJvbGxlckV2ZW50c0FjdGl2ZSAmJiAhaGFzV2ViWFIpIHsKICAgIGNvbXBvbmVudC5hZGRFdmVudExpc3RlbmVycygpOwogIH0KCiAgLy8gTm90aGluZyBjaGFuZ2VkLCBubyBuZWVkIHRvIGRvIGFueXRoaW5nLgogIGlmIChpc1ByZXNlbnQgPT09IGNvbXBvbmVudC5jb250cm9sbGVyUHJlc2VudCkgeyByZXR1cm4gaXNQcmVzZW50OyB9CgogIGNvbXBvbmVudC5jb250cm9sbGVyUHJlc2VudCA9IGlzUHJlc2VudDsKCiAgLy8gVXBkYXRlIGNvbnRyb2xsZXIgcHJlc2VuY2UuCiAgaWYgKGlzUHJlc2VudCkgewogICAgY29tcG9uZW50LmluamVjdFRyYWNrZWRDb250cm9scygpOwogICAgaWYgKCFoYXNXZWJYUikgeyBjb21wb25lbnQuYWRkRXZlbnRMaXN0ZW5lcnMoKTsgfQogICAgZWwuZW1pdCgnY29udHJvbGxlcmNvbm5lY3RlZCcsIHtuYW1lOiBjb21wb25lbnQubmFtZSwgY29tcG9uZW50OiBjb21wb25lbnR9KTsKICB9IGVsc2UgewogICAgY29tcG9uZW50LnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CiAgICBlbC5lbWl0KCdjb250cm9sbGVyZGlzY29ubmVjdGVkJywge25hbWU6IGNvbXBvbmVudC5uYW1lLCBjb21wb25lbnQ6IGNvbXBvbmVudH0pOwogIH0KfTsKCi8qKgogKiBFbnVtZXJhdGUgY29udHJvbGxlciAodGhhdCBoYXZlIHBvc2UpIGFuZCBjaGVjayBpZiB0aGV5IG1hdGNoIHBhcmFtZXRlcnMgZm9yIFdlYlZSCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBjb21wb25lbnQgLSBUcmFja2VkIGNvbnRyb2xzIGNvbXBvbmVudC4KICogQHBhcmFtIHtvYmplY3R9IGlkUHJlZml4IC0gUHJlZml4IHRvIG1hdGNoIGluIGdhbWVwYWQgaWQgaWYgYW55LgogKiBAcGFyYW0ge29iamVjdH0gcXVlcnlPYmplY3QgLSBNYXAgb2YgdmFsdWVzIHRvIG1hdGNoLgogKi8KZnVuY3Rpb24gaXNDb250cm9sbGVyUHJlc2VudFdlYlZSIChjb21wb25lbnQsIGlkUHJlZml4LCBxdWVyeU9iamVjdCkgewogIHZhciBnYW1lcGFkczsKICB2YXIgc2NlbmVFbCA9IGNvbXBvbmVudC5lbC5zY2VuZUVsOwogIHZhciB0cmFja2VkQ29udHJvbHNTeXN0ZW07CiAgdmFyIGZpbHRlckNvbnRyb2xsZXJJbmRleCA9IHF1ZXJ5T2JqZWN0LmluZGV4IHx8IDA7CgogIGlmICghaWRQcmVmaXgpIHsgcmV0dXJuIGZhbHNlOyB9CgogIHRyYWNrZWRDb250cm9sc1N5c3RlbSA9IHNjZW5lRWwgJiYgc2NlbmVFbC5zeXN0ZW1zWyd0cmFja2VkLWNvbnRyb2xzLXdlYnZyJ107CiAgaWYgKCF0cmFja2VkQ29udHJvbHNTeXN0ZW0pIHsgcmV0dXJuIGZhbHNlOyB9CgogIGdhbWVwYWRzID0gdHJhY2tlZENvbnRyb2xzU3lzdGVtLmNvbnRyb2xsZXJzOwogIGlmICghZ2FtZXBhZHMubGVuZ3RoKSB7IHJldHVybiBmYWxzZTsgfQoKICByZXR1cm4gISFmaW5kTWF0Y2hpbmdDb250cm9sbGVyV2ViVlIoZ2FtZXBhZHMsIG51bGwsIGlkUHJlZml4LCBxdWVyeU9iamVjdC5oYW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyQ29udHJvbGxlckluZGV4KTsKfQoKLyoqCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBjb21wb25lbnQgLSBUcmFja2VkIGNvbnRyb2xzIGNvbXBvbmVudC4KICovCmZ1bmN0aW9uIGlzQ29udHJvbGxlclByZXNlbnRXZWJYUiAoY29tcG9uZW50LCBpZFByZWZpeCwgcXVlcnlPYmplY3QpIHsKICB2YXIgY29udHJvbGxlcnM7CiAgdmFyIHNjZW5lRWwgPSBjb21wb25lbnQuZWwuc2NlbmVFbDsKICB2YXIgdHJhY2tlZENvbnRyb2xzU3lzdGVtID0gc2NlbmVFbCAmJiBzY2VuZUVsLnN5c3RlbXNbJ3RyYWNrZWQtY29udHJvbHMtd2VieHInXTsKICBpZiAoIXRyYWNrZWRDb250cm9sc1N5c3RlbSkgeyByZXR1cm4gZmFsc2U7IH0KCiAgY29udHJvbGxlcnMgPSB0cmFja2VkQ29udHJvbHNTeXN0ZW0uY29udHJvbGxlcnM7CiAgaWYgKCFjb250cm9sbGVycyB8fCAhY29udHJvbGxlcnMubGVuZ3RoKSB7IHJldHVybiBmYWxzZTsgfQoKICByZXR1cm4gZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlhSKGNvbnRyb2xsZXJzLCBxdWVyeU9iamVjdC5oYW5kKTsKfQoKbW9kdWxlLmV4cG9ydHMuaXNDb250cm9sbGVyUHJlc2VudFdlYlZSID0gaXNDb250cm9sbGVyUHJlc2VudFdlYlZSOwptb2R1bGUuZXhwb3J0cy5pc0NvbnRyb2xsZXJQcmVzZW50V2ViWFIgPSBpc0NvbnRyb2xsZXJQcmVzZW50V2ViWFI7CgovKioKICogV2FsayB0aHJvdWdoIHRoZSBnaXZlbiBjb250cm9sbGVycyB0byBmaW5kIGFueSB3aGVyZSB0aGUgZGV2aWNlIElEIGVxdWFscwogKiBmaWx0ZXJJZEV4YWN0LCBvciBzdGFydHNXaXRoIGZpbHRlcklkUHJlZml4LgogKiBBIGNvbnRyb2xsZXIgd2hlcmUgdGhpcyBjb25zaWRlcmVkIHRydWUgaXMgY29uc2lkZXJlZCBhICdtYXRjaCcuCiAqCiAqIEZvciBlYWNoIG1hdGNoaW5nIGNvbnRyb2xsZXI6CiAqICAgSWYgZmlsdGVySGFuZCBpcyBzZXQsIGFuZCB0aGUgY29udHJvbGxlcjoKICogICAgIGlzIGhhbmRlZCwgd2UgZnVydGhlciB2ZXJpZnkgdGhhdCBjb250cm9sbGVyLmhhbmQgZXF1YWxzIGZpbHRlckhhbmQuCiAqICAgICBpcyB1bmhhbmRlZCAoY29udHJvbGxlci5oYW5kIGlzICcnKSwgd2Ugc2tpcCB1bnRpbCB3ZSBoYXZlIGZvdW5kIGEKICogICAgIG51bWJlciBvZiBtYXRjaGluZyBjb250cm9sbGVycyB0aGF0IGVxdWFscyBmaWx0ZXJDb250cm9sbGVySW5kZXgKICogICBJZiBmaWx0ZXJIYW5kIGlzIG5vdCBzZXQsIHdlIHNraXAgdW50aWwgd2UgaGF2ZSBmb3VuZCB0aGUgbnRoIG1hdGNoaW5nCiAqICAgY29udHJvbGxlciwgd2hlcmUgbiBlcXVhbHMgZmlsdGVyQ29udHJvbGxlckluZGV4CiAqCiAqIFRoZSBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCB3aXRoIG9uZSBvZjogW2ZpbHRlcklkRXhhY3QsIGZpbHRlcklkUHJlZml4XSBBTkQKICogb25lIG9yIGJvdGggb2Y6IFtmaWx0ZXJIYW5kLCBmaWx0ZXJDb250cm9sbGVySW5kZXhdCiAqCiAqIEBwYXJhbSB7b2JqZWN0fSBjb250cm9sbGVycyAtIEFycmF5IG9mIGdhbWVwYWRzIHRvIHNlYXJjaAogKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVySWRFeGFjdCAtIElmIHNldCwgdXNlZCB0byBmaW5kIGNvbnRyb2xsZXJzIHdpdGggaWQgPT09IHRoaXMgdmFsdWUKICogQHBhcmFtIHtzdHJpbmd9IGZpbHRlcklkUHJlZml4IC0gSWYgc2V0LCB1c2VkIHRvIGZpbmQgY29udHJvbGxlcnMgd2l0aCBpZCBzdGFydHNXaXRoIHRoaXMgdmFsdWUKICogQHBhcmFtIHtvYmplY3R9IGZpbHRlckhhbmQgLSBJZiBzZXQsIGZ1cnRoZXIgZmlsdGVycyBjb250cm9sbGVycyB3aXRoIG1hdGNoaW5nICdoYW5kJyBwcm9wZXJ0eQogKiBAcGFyYW0ge29iamVjdH0gZmlsdGVyQ29udHJvbGxlckluZGV4IC0gRmluZCB0aGUgbnRoIG1hdGNoaW5nIGNvbnRyb2xsZXIsCiAqIHdoZXJlIG4gZXF1YWxzIGZpbHRlckNvbnRyb2xsZXJJbmRleC4gZGVmYXVsdHMgdG8gMC4KICovCmZ1bmN0aW9uIGZpbmRNYXRjaGluZ0NvbnRyb2xsZXJXZWJWUiAoY29udHJvbGxlcnMsIGZpbHRlcklkRXhhY3QsIGZpbHRlcklkUHJlZml4LCBmaWx0ZXJIYW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJDb250cm9sbGVySW5kZXgpIHsKICB2YXIgY29udHJvbGxlcjsKICB2YXIgaTsKICB2YXIgbWF0Y2hpbmdDb250cm9sbGVyT2NjdXJlbmNlID0gMDsKICB2YXIgdGFyZ2V0Q29udHJvbGxlck1hdGNoID0gZmlsdGVyQ29udHJvbGxlckluZGV4IHx8IDA7CgogIGZvciAoaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkrKykgewogICAgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzW2ldOwoKICAgIC8vIERldGVybWluZSBpZiB0aGUgY29udHJvbGxlciBJRCBtYXRjaGVzIG91ciBjcml0ZXJpYS4KICAgIGlmIChmaWx0ZXJJZFByZWZpeCAmJiAhY29udHJvbGxlci5pZC5zdGFydHNXaXRoKGZpbHRlcklkUHJlZml4KSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAoIWZpbHRlcklkUHJlZml4ICYmIGNvbnRyb2xsZXIuaWQgIT09IGZpbHRlcklkRXhhY3QpIHsgY29udGludWU7IH0KCiAgICAvLyBJZiB0aGUgaGFuZCBmaWx0ZXIgYW5kIGNvbnRyb2xsZXIgaGFuZGVkbmVzcyBhcmUgZGVmaW5lZCB3ZSBjb21wYXJlIHRoZW0uCiAgICBpZiAoZmlsdGVySGFuZCAmJiBjb250cm9sbGVyLmhhbmQgJiYgZmlsdGVySGFuZCAhPT0gY29udHJvbGxlci5oYW5kKSB7IGNvbnRpbnVlOyB9CgogICAgLy8gSWYgd2UgaGF2ZSBkZXRlY3RlZCBhbiB1bmhhbmRlZCBjb250cm9sbGVyIGFuZCB0aGUgY29tcG9uZW50IHdhcyBhc2tpbmcKICAgIC8vIGZvciBhIHBhcnRpY3VsYXIgaGFuZCwgd2UgbmVlZCB0byB0cmVhdCB0aGUgY29udHJvbGxlcnMgaW4gdGhlIGFycmF5IGFzCiAgICAvLyBwYWlycyBvZiBjb250cm9sbGVycy4gVGhpcyBlZmZlY3RpdmVseSBtZWFucyB0aGF0IHdlIG5lZWQgdG8gc2tpcAogICAgLy8gTlVNX0hBTkRTIG1hdGNoZXMgZm9yIGVhY2ggY29udHJvbGxlciBudW1iZXIsIGluc3RlYWQgb2YgMS4KICAgIGlmIChmaWx0ZXJIYW5kICYmICFjb250cm9sbGVyLmhhbmQpIHsKICAgICAgdGFyZ2V0Q29udHJvbGxlck1hdGNoID0gTlVNX0hBTkRTICogZmlsdGVyQ29udHJvbGxlckluZGV4ICsgKChmaWx0ZXJIYW5kID09PSBERUZBVUxUX0hBTkRFRE5FU1MpID8gMCA6IDEpOwogICAgfQoKICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciB0aGUgbnRoIG9jY3VyZW5jZSBvZiBhIG1hdGNoaW5nIGNvbnRyb2xsZXIKICAgIC8vIChuIGVxdWFscyB0YXJnZXRDb250cm9sbGVyTWF0Y2gpLgogICAgaWYgKG1hdGNoaW5nQ29udHJvbGxlck9jY3VyZW5jZSA9PT0gdGFyZ2V0Q29udHJvbGxlck1hdGNoKSB7IHJldHVybiBjb250cm9sbGVyOyB9CiAgICArK21hdGNoaW5nQ29udHJvbGxlck9jY3VyZW5jZTsKICB9CiAgcmV0dXJuIHVuZGVmaW5lZDsKfQoKZnVuY3Rpb24gZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlhSIChjb250cm9sbGVycywgaGFuZGVkbmVzcykgewogIHZhciBpOwogIHZhciBjb250cm9sbGVySGFuZGVkbmVzczsKICBmb3IgKGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpKyspIHsKICAgIGNvbnRyb2xsZXJIYW5kZWRuZXNzID0gY29udHJvbGxlcnNbaV0uaGFuZGVkbmVzczsKICAgIGlmICghaGFuZGVkbmVzcyB8fCAoY29udHJvbGxlckhhbmRlZG5lc3MgPT09ICcnICYmIGhhbmRlZG5lc3MgPT09ICdyaWdodCcpIHx8CiAgICAgICAgY29udHJvbGxlcnNbaV0uaGFuZGVkbmVzcyA9PT0gaGFuZGVkbmVzcykgewogICAgICByZXR1cm4gY29udHJvbGxlcnNbaV07CiAgICB9CiAgfQogIHJldHVybiB1bmRlZmluZWQ7Cn0KCm1vZHVsZS5leHBvcnRzLmZpbmRNYXRjaGluZ0NvbnRyb2xsZXJXZWJWUiA9IGZpbmRNYXRjaGluZ0NvbnRyb2xsZXJXZWJWUjsKbW9kdWxlLmV4cG9ydHMuZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlhSID0gZmluZE1hdGNoaW5nQ29udHJvbGxlcldlYlhSOwoKLyoqCiAqIEVtaXQgc3BlY2lmaWMgYG1vdmVkYCBldmVudChzKSBpZiBheGVzIGNoYW5nZWQgYmFzZWQgb24gb3JpZ2luYWwgYXhpc21vdmVkIGV2ZW50LgogKgogKiBAcGFyYW0ge29iamVjdH0gY29tcG9uZW50IC0gQ29udHJvbGxlciBjb21wb25lbnQgaW4gdXNlLgogKiBAcGFyYW0ge2FycmF5fSBheGVzTWFwcGluZyAtIEZvciBleGFtcGxlIGB7dGh1bWJzdGljazogWzAsIDFdfWAuCiAqIEBwYXJhbSB7b2JqZWN0fSBldnQgLSBFdmVudCB0byBwcm9jZXNzLgogKi8KbW9kdWxlLmV4cG9ydHMuZW1pdElmQXhlc0NoYW5nZWQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBheGVzTWFwcGluZywgZXZ0KSB7CiAgdmFyIGF4ZXM7CiAgdmFyIGJ1dHRvblR5cGU7CiAgdmFyIGNoYW5nZWQ7CiAgdmFyIGRldGFpbDsKICB2YXIgajsKCiAgZm9yIChidXR0b25UeXBlIGluIGF4ZXNNYXBwaW5nKSB7CiAgICBheGVzID0gYXhlc01hcHBpbmdbYnV0dG9uVHlwZV07CgogICAgY2hhbmdlZCA9IGZhbHNlOwogICAgZm9yIChqID0gMDsgaiA8IGF4ZXMubGVuZ3RoOyBqKyspIHsKICAgICAgaWYgKGV2dC5kZXRhaWwuY2hhbmdlZFtheGVzW2pdXSkgeyBjaGFuZ2VkID0gdHJ1ZTsgfQogICAgfQoKICAgIGlmICghY2hhbmdlZCkgeyBjb250aW51ZTsgfQoKICAgIC8vIEF4aXMgaGFzIGNoYW5nZWQuIEVtaXQgdGhlIHNwZWNpZmljIG1vdmVkIGV2ZW50IHdpdGggYXhpcyB2YWx1ZXMgaW4gZGV0YWlsLgogICAgZGV0YWlsID0ge307CiAgICBmb3IgKGogPSAwOyBqIDwgYXhlcy5sZW5ndGg7IGorKykgewogICAgICBkZXRhaWxbQVhJU19MQUJFTFNbal1dID0gZXZ0LmRldGFpbC5heGlzW2F4ZXNbal1dOwogICAgfQogICAgY29tcG9uZW50LmVsLmVtaXQoYnV0dG9uVHlwZSArICdtb3ZlZCcsIGRldGFpbCk7CiAgfQp9OwoKLyoqCiAqIEhhbmRsZSBhIGJ1dHRvbiBldmVudCBhbmQgcmVlbWl0cyB0aGUgZXZlbnRzLgogKgogKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBpZCBvZiB0aGUgYnV0dG9uLgogKiBAcGFyYW0ge3N0cmluZ30gZXZ0TmFtZSAtIG5hbWUgb2YgdGhlIHJlZW1pdHRlZCBldmVudAogKiBAcGFyYW0ge29iamVjdH0gY29tcG9uZW50IC0gcmVmZXJlbmNlIHRvIHRoZSBjb21wb25lbnQKICogQHBhcmFtIHtzdHJpbmd9IGhhbmQgLSBoYW5kZWRuZXNzIG9mIHRoZSBjb250cm9sbGVyOiBsZWZ0IG9yIHJpZ2h0LgogKi8KbW9kdWxlLmV4cG9ydHMub25CdXR0b25FdmVudCA9IGZ1bmN0aW9uIChpZCwgZXZ0TmFtZSwgY29tcG9uZW50LCBoYW5kKSB7CiAgdmFyIG1hcHBpbmcgPSBoYW5kID8gY29tcG9uZW50Lm1hcHBpbmdbaGFuZF0gOiBjb21wb25lbnQubWFwcGluZzsKICB2YXIgYnV0dG9uTmFtZSA9IG1hcHBpbmcuYnV0dG9uc1tpZF07CiAgY29tcG9uZW50LmVsLmVtaXQoYnV0dG9uTmFtZSArIGV2dE5hbWUpOwogIGlmIChjb21wb25lbnQudXBkYXRlTW9kZWwpIHsKICAgIGNvbXBvbmVudC51cGRhdGVNb2RlbChidXR0b25OYW1lLCBldnROYW1lKTsKICB9Cn07Cgp9LHsiLi4vY29uc3RhbnRzIjo5OH1dLDE4ODpbZnVuY3Rpb24oX2RlcmVxXyxtb2R1bGUsZXhwb3J0cyl7CndpbmRvdy5nbFN0YXRzID0gZnVuY3Rpb24gKCkgewoKICAgIHZhciBfclMgPSBudWxsOwoKICAgIHZhciBfdG90YWxEcmF3QXJyYXlzQ2FsbHMgPSAwLAogICAgICAgIF90b3RhbERyYXdFbGVtZW50c0NhbGxzID0gMCwKICAgICAgICBfdG90YWxVc2VQcm9ncmFtQ2FsbHMgPSAwLAogICAgICAgIF90b3RhbEZhY2VzID0gMCwKICAgICAgICBfdG90YWxWZXJ0aWNlcyA9IDAsCiAgICAgICAgX3RvdGFsUG9pbnRzID0gMCwKICAgICAgICBfdG90YWxCaW5kVGV4dXJlcyA9IDA7CgogICAgZnVuY3Rpb24gX2ggKCBmLCBjICkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGMuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwogICAgICAgICAgICBmLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKICAgICAgICB9OwogICAgfQoKICAgIFdlYkdMUmVuZGVyaW5nQ29udGV4dC5wcm90b3R5cGUuZHJhd0FycmF5cyA9IF9oKCBXZWJHTFJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLmRyYXdBcnJheXMsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdG90YWxEcmF3QXJyYXlzQ2FsbHMrKzsKICAgICAgICBpZiAoIGFyZ3VtZW50c1sgMCBdID09IHRoaXMuUE9JTlRTICkgX3RvdGFsUG9pbnRzICs9IGFyZ3VtZW50c1sgMiBdOwogICAgICAgIGVsc2UgX3RvdGFsVmVydGljZXMgKz0gYXJndW1lbnRzWyAyIF07CiAgICB9ICk7CgogICAgV2ViR0xSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZS5kcmF3RWxlbWVudHMgPSBfaCggV2ViR0xSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZS5kcmF3RWxlbWVudHMsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdG90YWxEcmF3RWxlbWVudHNDYWxscysrOwogICAgICAgIF90b3RhbEZhY2VzICs9IGFyZ3VtZW50c1sgMSBdIC8gMzsKICAgICAgICBfdG90YWxWZXJ0aWNlcyArPSBhcmd1bWVudHNbIDEgXTsKICAgIH0gKTsKCiAgICBXZWJHTFJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLnVzZVByb2dyYW0gPSBfaCggV2ViR0xSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZS51c2VQcm9ncmFtLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RvdGFsVXNlUHJvZ3JhbUNhbGxzKys7CiAgICB9ICk7CgogICAgV2ViR0xSZW5kZXJpbmdDb250ZXh0LnByb3RvdHlwZS5iaW5kVGV4dHVyZSA9IF9oKCBXZWJHTFJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLmJpbmRUZXh0dXJlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RvdGFsQmluZFRleHVyZXMrKzsKICAgIH0gKTsKCiAgICB2YXIgX3ZhbHVlcyA9IHsKICAgICAgICBhbGxjYWxsczogewogICAgICAgICAgICBvdmVyOiAzMDAwLAogICAgICAgICAgICBjYXB0aW9uOiAnQ2FsbHMgKGhvb2spJwogICAgICAgIH0sCiAgICAgICAgZHJhd2VsZW1lbnRzOiB7CiAgICAgICAgICAgIGNhcHRpb246ICdkcmF3RWxlbWVudHMgKGhvb2spJwogICAgICAgIH0sCiAgICAgICAgZHJhd2FycmF5czogewogICAgICAgICAgICBjYXB0aW9uOiAnZHJhd0FycmF5cyAoaG9vayknCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgX2dyb3VwcyA9IFsgewogICAgICAgIGNhcHRpb246ICdXZWJHTCcsCiAgICAgICAgdmFsdWVzOiBbICdhbGxjYWxscycsICdkcmF3ZWxlbWVudHMnLCAnZHJhd2FycmF5cycsICd1c2Vwcm9ncmFtJywgJ2JpbmR0ZXh0dXJlJywgJ2dsZmFjZXMnLCAnZ2x2ZXJ0aWNlcycsICdnbHBvaW50cycgXQogICAgfSBdOwoKICAgIHZhciBfZnJhY3Rpb25zID0gWyB7CiAgICAgICAgYmFzZTogJ2FsbGNhbGxzJywKICAgICAgICBzdGVwczogWyAnZHJhd2VsZW1lbnRzJywgJ2RyYXdhcnJheXMnIF0KICAgIH0gXTsKCiAgICBmdW5jdGlvbiBfdXBkYXRlICgpIHsKICAgICAgICBfclMoICdhbGxjYWxscycgKS5zZXQoIF90b3RhbERyYXdBcnJheXNDYWxscyArIF90b3RhbERyYXdFbGVtZW50c0NhbGxzICk7CiAgICAgICAgX3JTKCAnZHJhd0VsZW1lbnRzJyApLnNldCggX3RvdGFsRHJhd0VsZW1lbnRzQ2FsbHMgKTsKICAgICAgICBfclMoICdkcmF3QXJyYXlzJyApLnNldCggX3RvdGFsRHJhd0FycmF5c0NhbGxzICk7CiAgICAgICAgX3JTKCAnYmluZFRleHR1cmUnICkuc2V0KCBfdG90YWxCaW5kVGV4dXJlcyApOwogICAgICAgIF9yUyggJ3VzZVByb2dyYW0nICkuc2V0KCBfdG90YWxVc2VQcm9ncmFtQ2FsbHMgKTsKICAgICAgICBfclMoICdnbGZhY2VzJyApLnNldCggX3RvdGFsRmFjZXMgKTsKICAgICAgICBfclMoICdnbHZlcnRpY2VzJyApLnNldCggX3RvdGFsVmVydGljZXMgKTsKICAgICAgICBfclMoICdnbHBvaW50cycgKS5zZXQoIF90b3RhbFBvaW50cyApOwogICAgfQoKICAgIGZ1bmN0aW9uIF9zdGFydCAoKSB7CiAgICAgICAgX3RvdGFsRHJhd0FycmF5c0NhbGxzID0gMDsKICAgICAgICBfdG90YWxEcmF3RWxlbWVudHNDYWxscyA9IDA7CiAgICAgICAgX3RvdGFsVXNlUHJvZ3JhbUNhbGxzID0gMDsKICAgICAgICBfdG90YWxGYWNlcyA9IDA7CiAgICAgICAgX3RvdGFsVmVydGljZXMgPSAwOwogICAgICAgIF90b3RhbFBvaW50cyA9IDA7CiAgICAgICAgX3RvdGFsQmluZFRleHVyZXMgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9lbmQgKCkge30KCiAgICBmdW5jdGlvbiBfYXR0YWNoICggciApIHsKICAgICAgICBfclMgPSByOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdXBkYXRlOiBfdXBkYXRlLAogICAgICAgIHN0YXJ0OiBfc3RhcnQsCiAgICAgICAgZW5kOiBfZW5kLAogICAgICAgIGF0dGFjaDogX2F0dGFjaCwKICAgICAgICB2YWx1ZXM6IF92YWx1ZXMsCiAgICAgICAgZ3JvdXBzOiBfZ3JvdXBzLAogICAgICAgIGZyYWN0aW9uczogX2ZyYWN0aW9ucwogICAgfTsKCn07Cgp3aW5kb3cudGhyZWVTdGF0cyA9IGZ1bmN0aW9uICggcmVuZGVyZXIgKSB7CgogICAgdmFyIF9yUyA9IG51bGw7CgogICAgdmFyIF92YWx1ZXMgPSB7CiAgICAgICAgJ3JlbmRlcmVyLmluZm8ubWVtb3J5Lmdlb21ldHJpZXMnOiB7CiAgICAgICAgICAgIGNhcHRpb246ICdHZW9tZXRyaWVzJwogICAgICAgIH0sCiAgICAgICAgJ3JlbmRlcmVyLmluZm8ubWVtb3J5LnRleHR1cmVzJzogewogICAgICAgICAgICBjYXB0aW9uOiAnVGV4dHVyZXMnCiAgICAgICAgfSwKICAgICAgICAncmVuZGVyZXIuaW5mby5wcm9ncmFtcyc6IHsKICAgICAgICAgICAgY2FwdGlvbjogJ1Byb2dyYW1zJwogICAgICAgIH0sCiAgICAgICAgJ3JlbmRlcmVyLmluZm8ucmVuZGVyLmNhbGxzJzogewogICAgICAgICAgICBjYXB0aW9uOiAnQ2FsbHMnCiAgICAgICAgfSwKICAgICAgICAncmVuZGVyZXIuaW5mby5yZW5kZXIudHJpYW5nbGVzJzogewogICAgICAgICAgICBjYXB0aW9uOiAnVHJpYW5nbGVzJywKICAgICAgICAgICAgb3ZlcjogMTAwMAogICAgICAgIH0sCiAgICAgICAgJ3JlbmRlcmVyLmluZm8ucmVuZGVyLnBvaW50cyc6IHsKICAgICAgICAgICAgY2FwdGlvbjogJ1BvaW50cycKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBfZ3JvdXBzID0gWyB7CiAgICAgICAgY2FwdGlvbjogJ1RocmVlLmpzIC0gTWVtb3J5JywKICAgICAgICB2YWx1ZXM6IFsgJ3JlbmRlcmVyLmluZm8ubWVtb3J5Lmdlb21ldHJpZXMnLCAncmVuZGVyZXIuaW5mby5wcm9ncmFtcycsICdyZW5kZXJlci5pbmZvLm1lbW9yeS50ZXh0dXJlcycgXQogICAgfSwgewogICAgICAgIGNhcHRpb246ICdUaHJlZS5qcyAtIFJlbmRlcicsCiAgICAgICAgdmFsdWVzOiBbICdyZW5kZXJlci5pbmZvLnJlbmRlci5jYWxscycsICdyZW5kZXJlci5pbmZvLnJlbmRlci50cmlhbmdsZXMnLCAncmVuZGVyZXIuaW5mby5yZW5kZXIucG9pbnRzJyBdCiAgICB9IF07CgogICAgdmFyIF9mcmFjdGlvbnMgPSBbXTsKCiAgICBmdW5jdGlvbiBfdXBkYXRlICgpIHsKCiAgICAgICAgX3JTKCAncmVuZGVyZXIuaW5mby5tZW1vcnkuZ2VvbWV0cmllcycgKS5zZXQoIHJlbmRlcmVyLmluZm8ubWVtb3J5Lmdlb21ldHJpZXMgKTsKICAgICAgICBfclMoICdyZW5kZXJlci5pbmZvLnByb2dyYW1zJyApLnNldCggcmVuZGVyZXIuaW5mby5wcm9ncmFtcy5sZW5ndGggKTsKICAgICAgICBfclMoICdyZW5kZXJlci5pbmZvLm1lbW9yeS50ZXh0dXJlcycgKS5zZXQoIHJlbmRlcmVyLmluZm8ubWVtb3J5LnRleHR1cmVzICk7CiAgICAgICAgX3JTKCAncmVuZGVyZXIuaW5mby5yZW5kZXIuY2FsbHMnICkuc2V0KCByZW5kZXJlci5pbmZvLnJlbmRlci5jYWxscyApOwogICAgICAgIF9yUyggJ3JlbmRlcmVyLmluZm8ucmVuZGVyLnRyaWFuZ2xlcycgKS5zZXQoIHJlbmRlcmVyLmluZm8ucmVuZGVyLnRyaWFuZ2xlcyApOwogICAgICAgIF9yUyggJ3JlbmRlcmVyLmluZm8ucmVuZGVyLnBvaW50cycgKS5zZXQoIHJlbmRlcmVyLmluZm8ucmVuZGVyLnBvaW50cyApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBfc3RhcnQgKCkge30KCiAgICBmdW5jdGlvbiBfZW5kICgpIHt9CgogICAgZnVuY3Rpb24gX2F0dGFjaCAoIHIgKSB7CiAgICAgICAgX3JTID0gcjsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHVwZGF0ZTogX3VwZGF0ZSwKICAgICAgICBzdGFydDogX3N0YXJ0LAogICAgICAgIGVuZDogX2VuZCwKICAgICAgICBhdHRhY2g6IF9hdHRhY2gsCiAgICAgICAgdmFsdWVzOiBfdmFsdWVzLAogICAgICAgIGdyb3VwczogX2dyb3VwcywKICAgICAgICBmcmFjdGlvbnM6IF9mcmFjdGlvbnMKICAgIH07Cgp9OwoKLyoKICogICBGcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9wYXVsaXJpc2gvbWVtb3J5LXN0YXRzLmpzCiAqLwoKd2luZG93LkJyb3dzZXJTdGF0cyA9IGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgX3JTID0gbnVsbDsKCiAgICB2YXIgX3VzZWRKU0hlYXBTaXplID0gMCwKICAgICAgICBfdG90YWxKU0hlYXBTaXplID0gMDsKCiAgICBpZiAoIHdpbmRvdy5wZXJmb3JtYW5jZSAmJiAhcGVyZm9ybWFuY2UubWVtb3J5ICkgewogICAgICAgIHBlcmZvcm1hbmNlLm1lbW9yeSA9IHsKICAgICAgICAgICAgdXNlZEpTSGVhcFNpemU6IDAsCiAgICAgICAgICAgIHRvdGFsSlNIZWFwU2l6ZTogMAogICAgICAgIH07CiAgICB9CgogICAgaWYgKCBwZXJmb3JtYW5jZS5tZW1vcnkudG90YWxKU0hlYXBTaXplID09PSAwICkgewogICAgICAgIGNvbnNvbGUud2FybiggJ3RvdGFsSlNIZWFwU2l6ZSA9PT0gMC4uLiBwZXJmb3JtYW5jZS5tZW1vcnkgaXMgb25seSBhdmFpbGFibGUgaW4gQ2hyb21lIC4nICk7CiAgICB9CgogICAgdmFyIF92YWx1ZXMgPSB7CiAgICAgICAgbWVtb3J5OiB7CiAgICAgICAgICAgIGNhcHRpb246ICdVc2VkIE1lbW9yeScsCiAgICAgICAgICAgIGF2ZXJhZ2U6IHRydWUsCiAgICAgICAgICAgIGF2Z01zOiAxMDAwLAogICAgICAgICAgICBvdmVyOiAyMgogICAgICAgIH0sCiAgICAgICAgdG90YWw6IHsKICAgICAgICAgICAgY2FwdGlvbjogJ1RvdGFsIE1lbW9yeScKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBfZ3JvdXBzID0gWyB7CiAgICAgICAgY2FwdGlvbjogJ0Jyb3dzZXInLAogICAgICAgIHZhbHVlczogWyAnbWVtb3J5JywgJ3RvdGFsJyBdCiAgICB9IF07CgogICAgdmFyIF9mcmFjdGlvbnMgPSBbIHsKICAgICAgICBiYXNlOiAndG90YWwnLAogICAgICAgIHN0ZXBzOiBbICdtZW1vcnknIF0KICAgIH0gXTsKCiAgICB2YXIgbG9nMTAyNCA9IE1hdGgubG9nKCAxMDI0ICk7CgogICAgZnVuY3Rpb24gX3NpemUgKCB2ICkgewoKICAgICAgICB2YXIgcHJlY2lzaW9uID0gMTAwOyAvL01hdGgucG93KDEwLCAyKTsKICAgICAgICB2YXIgaSA9IE1hdGguZmxvb3IoIE1hdGgubG9nKCB2ICkgLyBsb2cxMDI0ICk7CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoIHYgKiBwcmVjaXNpb24gLyBNYXRoLnBvdyggMTAyNCwgaSApICkgLyBwcmVjaXNpb247IC8vICsgJyAnICsgc2l6ZXNbaV07CgogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGUgKCkgewogICAgICAgIF91c2VkSlNIZWFwU2l6ZSA9IF9zaXplKCBwZXJmb3JtYW5jZS5tZW1vcnkudXNlZEpTSGVhcFNpemUgKTsKICAgICAgICBfdG90YWxKU0hlYXBTaXplID0gX3NpemUoIHBlcmZvcm1hbmNlLm1lbW9yeS50b3RhbEpTSGVhcFNpemUgKTsKCiAgICAgICAgX3JTKCAnbWVtb3J5JyApLnNldCggX3VzZWRKU0hlYXBTaXplICk7CiAgICAgICAgX3JTKCAndG90YWwnICkuc2V0KCBfdG90YWxKU0hlYXBTaXplICk7CiAgICB9CgogICAgZnVuY3Rpb24gX3N0YXJ0ICgpIHsKICAgICAgICBfdXNlZEpTSGVhcFNpemUgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9lbmQgKCkge30KCiAgICBmdW5jdGlvbiBfYXR0YWNoICggciApIHsKICAgICAgICBfclMgPSByOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdXBkYXRlOiBfdXBkYXRlLAogICAgICAgIHN0YXJ0OiBfc3RhcnQsCiAgICAgICAgZW5kOiBfZW5kLAogICAgICAgIGF0dGFjaDogX2F0dGFjaCwKICAgICAgICB2YWx1ZXM6IF92YWx1ZXMsCiAgICAgICAgZ3JvdXBzOiBfZ3JvdXBzLAogICAgICAgIGZyYWN0aW9uczogX2ZyYWN0aW9ucwogICAgfTsKCn07CgppZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpIHsKICBtb2R1bGUuZXhwb3J0cyA9IHsKICAgIGdsU3RhdHM6IHdpbmRvdy5nbFN0YXRzLAogICAgdGhyZWVTdGF0czogd2luZG93LnRocmVlU3RhdHMsCiAgICBCcm93c2VyU3RhdHM6IHdpbmRvdy5Ccm93c2VyU3RhdHMKICB9Owp9Cgp9LHt9XSwxODk6W2Z1bmN0aW9uKF9kZXJlcV8sbW9kdWxlLGV4cG9ydHMpewovLyBwZXJmb3JtYW5jZS5ub3coKSBwb2x5ZmlsbCBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC81NDM4NjUwCid1c2Ugc3RyaWN0JzsKCiggZnVuY3Rpb24gKCkgewoKICAgIGlmICggJ3BlcmZvcm1hbmNlJyBpbiB3aW5kb3cgPT0gZmFsc2UgKSB7CiAgICAgICAgd2luZG93LnBlcmZvcm1hbmNlID0ge307CiAgICB9CgogICAgdmFyIHBlcmZvcm1hbmNlID0gd2luZG93LnBlcmZvcm1hbmNlOwoKICAgIGlmICggJ25vdycgaW4gcGVyZm9ybWFuY2UgPT0gZmFsc2UgKSB7CgogICAgICAgIHZhciBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgICAgICBpZiAoIHBlcmZvcm1hbmNlLnRpbWluZyAmJiBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0ICkgewogICAgICAgICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgICAgIH0KCiAgICAgICAgcGVyZm9ybWFuY2Uubm93ID0gZnVuY3Rpb24gbm93ICgpIHsKICAgICAgICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgICAgICAgfTsKCiAgICB9CgogICAgaWYoICFwZXJmb3JtYW5jZS5tYXJrICkgewogICAgICAgIHBlcmZvcm1hbmNlLm1hcmsgPSBmdW5jdGlvbigpe30KICAgIH0KCiAgICBpZiggIXBlcmZvcm1hbmNlLm1lYXN1cmUgKSB7CiAgICAgICAgcGVyZm9ybWFuY2UubWVhc3VyZSA9IGZ1bmN0aW9uKCl7fQogICAgfQoKfSApKCk7Cgp3aW5kb3cuclN0YXRzID0gZnVuY3Rpb24gclN0YXRzICggc2V0dGluZ3MgKSB7CgogICAgZnVuY3Rpb24gaXRlcmF0ZUtleXMgKCBhcnJheSwgY2FsbGJhY2sgKSB7CiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyggYXJyYXkgKTsKICAgICAgICBmb3IgKCB2YXIgaiA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaiA8IGw7IGorKyApIHsKICAgICAgICAgICAgY2FsbGJhY2soIGtleXNbIGogXSApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbXBvcnRDU1MgKCB1cmwgKSB7CgogICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2xpbmsnICk7CiAgICAgICAgZWxlbWVudC5ocmVmID0gdXJsOwogICAgICAgIGVsZW1lbnQucmVsID0gJ3N0eWxlc2hlZXQnOwogICAgICAgIGVsZW1lbnQudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICdoZWFkJyApWyAwIF0uYXBwZW5kQ2hpbGQoIGVsZW1lbnQgKTsKCiAgICB9CgogICAgdmFyIF9zZXR0aW5ncyA9IHNldHRpbmdzIHx8IHt9OwogICAgdmFyIF9jb2xvdXJzID0gX3NldHRpbmdzLmNvbG91cnMgfHwgWyAnIzg1MDcwMCcsICcjYzc0OTAwJywgJyNmY2IzMDAnLCAnIzI4NDI4MCcsICcjNGM3YzBjJyBdOwoKICAgIHZhciBfY3NzRm9udCA9ICdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzcz9mYW1pbHk9Um9ib3RvK0NvbmRlbnNlZDo0MDAsNzAwLDMwMCc7CiAgICB2YXIgX2Nzc1JTdGF0cyA9ICggX3NldHRpbmdzLkNTU1BhdGggPyBfc2V0dGluZ3MuQ1NTUGF0aCA6ICcnICkgKyAnclN0YXRzLmNzcyc7CgogICAgdmFyIF9jc3MgPSBfc2V0dGluZ3MuY3NzIHx8IFsgX2Nzc0ZvbnQsIF9jc3NSU3RhdHMgXTsKICAgIF9jc3MuZm9yRWFjaChmdW5jdGlvbiAodXJpKSB7CiAgICAgICAgaW1wb3J0Q1NTKCB1cmkgKTsKICAgIH0pOwoKICAgIGlmICggIV9zZXR0aW5ncy52YWx1ZXMgKSBfc2V0dGluZ3MudmFsdWVzID0ge307CgogICAgdmFyIF9iYXNlLCBfZGl2LCBfZWxIZWlnaHQgPSAxMCwgX2VsV2lkdGggPSAyMDA7CiAgICB2YXIgX3BlcmZDb3VudGVycyA9IHt9OwoKCiAgICBmdW5jdGlvbiBHcmFwaCAoIF9kb20sIF9pZCwgX2RlZkFyZyApIHsKCiAgICAgICAgdmFyIF9kZWYgPSBfZGVmQXJnIHx8IHt9OwogICAgICAgIHZhciBfY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2NhbnZhcycgKSwKICAgICAgICAgICAgX2N0eCA9IF9jYW52YXMuZ2V0Q29udGV4dCggJzJkJyApLAogICAgICAgICAgICBfbWF4ID0gMCwKICAgICAgICAgICAgX2N1cnJlbnQgPSAwOwoKICAgICAgICB2YXIgYyA9IF9kZWYuY29sb3IgPyBfZGVmLmNvbG9yIDogJyM2NjY2NjYnOwoKICAgICAgICB2YXIgX2RvdENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnICksCiAgICAgICAgICAgIF9kb3RDdHggPSBfZG90Q2FudmFzLmdldENvbnRleHQoICcyZCcgKTsKICAgICAgICBfZG90Q2FudmFzLndpZHRoID0gMTsKICAgICAgICBfZG90Q2FudmFzLmhlaWdodCA9IDIgKiBfZWxIZWlnaHQ7CiAgICAgICAgX2RvdEN0eC5maWxsU3R5bGUgPSAnIzQ0NDQ0NCc7CiAgICAgICAgX2RvdEN0eC5maWxsUmVjdCggMCwgMCwgMSwgMiAqIF9lbEhlaWdodCApOwogICAgICAgIF9kb3RDdHguZmlsbFN0eWxlID0gYzsKICAgICAgICBfZG90Q3R4LmZpbGxSZWN0KCAwLCBfZWxIZWlnaHQsIDEsIF9lbEhlaWdodCApOwogICAgICAgIF9kb3RDdHguZmlsbFN0eWxlID0gJyNmZmZmZmYnOwogICAgICAgIF9kb3RDdHguZ2xvYmFsQWxwaGEgPSAwLjU7CiAgICAgICAgX2RvdEN0eC5maWxsUmVjdCggMCwgX2VsSGVpZ2h0LCAxLCAxICk7CiAgICAgICAgX2RvdEN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgIHZhciBfYWxhcm1DYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApLAogICAgICAgICAgICBfYWxhcm1DdHggPSBfYWxhcm1DYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwogICAgICAgIF9hbGFybUNhbnZhcy53aWR0aCA9IDE7CiAgICAgICAgX2FsYXJtQ2FudmFzLmhlaWdodCA9IDIgKiBfZWxIZWlnaHQ7CiAgICAgICAgX2FsYXJtQ3R4LmZpbGxTdHlsZSA9ICcjNDQ0NDQ0JzsKICAgICAgICBfYWxhcm1DdHguZmlsbFJlY3QoIDAsIDAsIDEsIDIgKiBfZWxIZWlnaHQgKTsKICAgICAgICBfYWxhcm1DdHguZmlsbFN0eWxlID0gJyNiNzAwMDAnOwogICAgICAgIF9hbGFybUN0eC5maWxsUmVjdCggMCwgX2VsSGVpZ2h0LCAxLCBfZWxIZWlnaHQgKTsKICAgICAgICBfYWxhcm1DdHguZ2xvYmFsQWxwaGEgPSAwLjU7CiAgICAgICAgX2FsYXJtQ3R4LmZpbGxTdHlsZSA9ICcjZmZmZmZmJzsKICAgICAgICBfYWxhcm1DdHguZmlsbFJlY3QoIDAsIF9lbEhlaWdodCwgMSwgMSApOwogICAgICAgIF9hbGFybUN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgIGZ1bmN0aW9uIF9pbml0ICgpIHsKCiAgICAgICAgICAgIF9jYW52YXMud2lkdGggPSBfZWxXaWR0aDsKICAgICAgICAgICAgX2NhbnZhcy5oZWlnaHQgPSBfZWxIZWlnaHQ7CiAgICAgICAgICAgIF9jYW52YXMuc3R5bGUud2lkdGggPSBfY2FudmFzLndpZHRoICsgJ3B4JzsKICAgICAgICAgICAgX2NhbnZhcy5zdHlsZS5oZWlnaHQgPSBfY2FudmFzLmhlaWdodCArICdweCc7CiAgICAgICAgICAgIF9jYW52YXMuY2xhc3NOYW1lID0gJ3JzLWNhbnZhcyc7CiAgICAgICAgICAgIF9kb20uYXBwZW5kQ2hpbGQoIF9jYW52YXMgKTsKCiAgICAgICAgICAgIF9jdHguZmlsbFN0eWxlID0gJyM0NDQ0NDQnOwogICAgICAgICAgICBfY3R4LmZpbGxSZWN0KCAwLCAwLCBfY2FudmFzLndpZHRoLCBfY2FudmFzLmhlaWdodCApOwoKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9kcmF3ICggdiwgYWxhcm0gKSB7CiAgICAgICAgICAgIF9jdXJyZW50ICs9ICggdiAtIF9jdXJyZW50ICkgKiAwLjE7CiAgICAgICAgICAgIF9tYXggKj0gMC45OTsKICAgICAgICAgICAgaWYgKCBfY3VycmVudCA+IF9tYXggKSBfbWF4ID0gX2N1cnJlbnQ7CiAgICAgICAgICAgIF9jdHguZHJhd0ltYWdlKCBfY2FudmFzLCAxLCAwLCBfY2FudmFzLndpZHRoIC0gMSwgX2NhbnZhcy5oZWlnaHQsIDAsIDAsIF9jYW52YXMud2lkdGggLSAxLCBfY2FudmFzLmhlaWdodCApOwogICAgICAgICAgICBpZiAoIGFsYXJtICkgewogICAgICAgICAgICAgICAgX2N0eC5kcmF3SW1hZ2UoIF9hbGFybUNhbnZhcywgX2NhbnZhcy53aWR0aCAtIDEsIF9jYW52YXMuaGVpZ2h0IC0gX2N1cnJlbnQgKiBfY2FudmFzLmhlaWdodCAvIF9tYXggLSBfZWxIZWlnaHQgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9jdHguZHJhd0ltYWdlKCBfZG90Q2FudmFzLCBfY2FudmFzLndpZHRoIC0gMSwgX2NhbnZhcy5oZWlnaHQgLSBfY3VycmVudCAqIF9jYW52YXMuaGVpZ2h0IC8gX21heCAtIF9lbEhlaWdodCApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfaW5pdCgpOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkcmF3OiBfZHJhdwogICAgICAgIH07CgogICAgfQoKICAgIGZ1bmN0aW9uIFN0YWNrR3JhcGggKCBfZG9tLCBfbnVtICkgewoKICAgICAgICB2YXIgX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnICksCiAgICAgICAgICAgIF9jdHggPSBfY2FudmFzLmdldENvbnRleHQoICcyZCcgKTsKCiAgICAgICAgZnVuY3Rpb24gX2luaXQgKCkgewoKICAgICAgICAgICAgX2NhbnZhcy53aWR0aCA9IF9lbFdpZHRoOwogICAgICAgICAgICBfY2FudmFzLmhlaWdodCA9IF9lbEhlaWdodCAqIF9udW07CiAgICAgICAgICAgIF9jYW52YXMuc3R5bGUud2lkdGggPSBfY2FudmFzLndpZHRoICsgJ3B4JzsKICAgICAgICAgICAgX2NhbnZhcy5zdHlsZS5oZWlnaHQgPSBfY2FudmFzLmhlaWdodCArICdweCc7CiAgICAgICAgICAgIF9jYW52YXMuY2xhc3NOYW1lID0gJ3JzLWNhbnZhcyc7CiAgICAgICAgICAgIF9kb20uYXBwZW5kQ2hpbGQoIF9jYW52YXMgKTsKCiAgICAgICAgICAgIF9jdHguZmlsbFN0eWxlID0gJyM0NDQ0NDQnOwogICAgICAgICAgICBfY3R4LmZpbGxSZWN0KCAwLCAwLCBfY2FudmFzLndpZHRoLCBfY2FudmFzLmhlaWdodCApOwoKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9kcmF3ICggdiApIHsKICAgICAgICAgICAgX2N0eC5kcmF3SW1hZ2UoIF9jYW52YXMsIDEsIDAsIF9jYW52YXMud2lkdGggLSAxLCBfY2FudmFzLmhlaWdodCwgMCwgMCwgX2NhbnZhcy53aWR0aCAtIDEsIF9jYW52YXMuaGVpZ2h0ICk7CiAgICAgICAgICAgIHZhciB0aCA9IDA7CiAgICAgICAgICAgIGl0ZXJhdGVLZXlzKCB2LCBmdW5jdGlvbiAoIGogKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IHZbIGogXSAqIF9jYW52YXMuaGVpZ2h0OwogICAgICAgICAgICAgICAgX2N0eC5maWxsU3R5bGUgPSBfY29sb3Vyc1sgaiBdOwogICAgICAgICAgICAgICAgX2N0eC5maWxsUmVjdCggX2NhbnZhcy53aWR0aCAtIDEsIHRoLCAxLCBoICk7CiAgICAgICAgICAgICAgICB0aCArPSBoOwogICAgICAgICAgICB9ICk7CiAgICAgICAgfQoKICAgICAgICBfaW5pdCgpOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkcmF3OiBfZHJhdwogICAgICAgIH07CgogICAgfQoKICAgIGZ1bmN0aW9uIFBlcmZDb3VudGVyICggaWQsIGdyb3VwICkgewoKICAgICAgICB2YXIgX2lkID0gaWQsCiAgICAgICAgICAgIF90aW1lLAogICAgICAgICAgICBfdmFsdWUgPSAwLAogICAgICAgICAgICBfdG90YWwgPSAwLAogICAgICAgICAgICBfYXZlcmFnZVZhbHVlID0gMCwKICAgICAgICAgICAgX2FjY3VtVmFsdWUgPSAwLAogICAgICAgICAgICBfYWNjdW1TdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpLAogICAgICAgICAgICBfYWNjdW1TYW1wbGVzID0gMCwKICAgICAgICAgICAgX2RvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICksCiAgICAgICAgICAgIF9zcGFuSWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnc3BhbicgKSwKICAgICAgICAgICAgX3NwYW5WYWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICksCiAgICAgICAgICAgIF9zcGFuVmFsdWVUZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoICcnICksCiAgICAgICAgICAgIF9kZWYgPSBfc2V0dGluZ3MgPyBfc2V0dGluZ3MudmFsdWVzWyBfaWQudG9Mb3dlckNhc2UoKSBdIDogbnVsbCwKICAgICAgICAgICAgX2dyYXBoID0gbmV3IEdyYXBoKCBfZG9tLCBfaWQsIF9kZWYgKSwKICAgICAgICAgICAgX3N0YXJ0ZWQgPSBmYWxzZTsKCiAgICAgICAgX3NwYW5JZC5jbGFzc05hbWUgPSAncnMtY291bnRlci1pZCc7CiAgICAgICAgX3NwYW5JZC50ZXh0Q29udGVudCA9ICggX2RlZiAmJiBfZGVmLmNhcHRpb24gKSA/IF9kZWYuY2FwdGlvbiA6IF9pZDsKCiAgICAgICAgX3NwYW5WYWx1ZS5jbGFzc05hbWUgPSAncnMtY291bnRlci12YWx1ZSc7CiAgICAgICAgX3NwYW5WYWx1ZS5hcHBlbmRDaGlsZCggX3NwYW5WYWx1ZVRleHQgKTsKCiAgICAgICAgX2RvbS5hcHBlbmRDaGlsZCggX3NwYW5JZCApOwogICAgICAgIF9kb20uYXBwZW5kQ2hpbGQoIF9zcGFuVmFsdWUgKTsKICAgICAgICBpZiAoIGdyb3VwICkgZ3JvdXAuZGl2LmFwcGVuZENoaWxkKCBfZG9tICk7CiAgICAgICAgZWxzZSBfZGl2LmFwcGVuZENoaWxkKCBfZG9tICk7CgogICAgICAgIF90aW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CgogICAgICAgIGZ1bmN0aW9uIF9hdmVyYWdlICggdiApIHsKICAgICAgICAgICAgaWYgKCBfZGVmICYmIF9kZWYuYXZlcmFnZSApIHsKICAgICAgICAgICAgICAgIF9hY2N1bVZhbHVlICs9IHY7CiAgICAgICAgICAgICAgICBfYWNjdW1TYW1wbGVzKys7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAgICAgaWYgKCB0IC0gX2FjY3VtU3RhcnQgPj0gKCBfZGVmLmF2Z01zIHx8IDEwMDAgKSApIHsKICAgICAgICAgICAgICAgICAgICBfYXZlcmFnZVZhbHVlID0gX2FjY3VtVmFsdWUgLyBfYWNjdW1TYW1wbGVzOwogICAgICAgICAgICAgICAgICAgIF9hY2N1bVZhbHVlID0gMDsKICAgICAgICAgICAgICAgICAgICBfYWNjdW1TdGFydCA9IHQ7CiAgICAgICAgICAgICAgICAgICAgX2FjY3VtU2FtcGxlcyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9zdGFydCAoKSB7CiAgICAgICAgICAgIF90aW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgIGlmKCBfc2V0dGluZ3MudXNlclRpbWluZ0FQSSApIHBlcmZvcm1hbmNlLm1hcmsoIF9pZCArICctc3RhcnQnICk7CiAgICAgICAgICAgIF9zdGFydGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9lbmQgKCkgewogICAgICAgICAgICBfdmFsdWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIF90aW1lOwogICAgICAgICAgICBpZiggX3NldHRpbmdzLnVzZXJUaW1pbmdBUEkgKSB7CiAgICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5tYXJrKCBfaWQgKyAnLWVuZCcgKTsKICAgICAgICAgICAgICAgIGlmKCBfc3RhcnRlZCApIHsKICAgICAgICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5tZWFzdXJlKCBfaWQsIF9pZCArICctc3RhcnQnLCBfaWQgKyAnLWVuZCcgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfYXZlcmFnZSggX3ZhbHVlICk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfdGljayAoKSB7CiAgICAgICAgICAgIF9lbmQoKTsKICAgICAgICAgICAgX3N0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfZHJhdyAoKSB7CiAgICAgICAgICAgIHZhciB2ID0gKCBfZGVmICYmIF9kZWYuYXZlcmFnZSApID8gX2F2ZXJhZ2VWYWx1ZSA6IF92YWx1ZTsKICAgICAgICAgICAgX3NwYW5WYWx1ZVRleHQubm9kZVZhbHVlID0gTWF0aC5yb3VuZCggdiAqIDEwMCApIC8gMTAwOwogICAgICAgICAgICB2YXIgYSA9ICggX2RlZiAmJiAoICggX2RlZi5iZWxvdyAmJiBfdmFsdWUgPCBfZGVmLmJlbG93ICkgfHwgKCBfZGVmLm92ZXIgJiYgX3ZhbHVlID4gX2RlZi5vdmVyICkgKSApOwogICAgICAgICAgICBfZ3JhcGguZHJhdyggX3ZhbHVlLCBhICk7CiAgICAgICAgICAgIF9kb20uY2xhc3NOYW1lID0gYSA/ICdycy1jb3VudGVyLWJhc2UgYWxhcm0nIDogJ3JzLWNvdW50ZXItYmFzZSc7CgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX2ZyYW1lICgpIHsKICAgICAgICAgICAgdmFyIHQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgdmFyIGUgPSB0IC0gX3RpbWU7CiAgICAgICAgICAgIF90b3RhbCsrOwogICAgICAgICAgICBpZiAoIGUgPiAxMDAwICkgewogICAgICAgICAgICAgICAgaWYgKCBfZGVmICYmIF9kZWYuaW50ZXJwb2xhdGUgPT09IGZhbHNlICkgewogICAgICAgICAgICAgICAgICAgIF92YWx1ZSA9IF90b3RhbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgX3ZhbHVlID0gX3RvdGFsICogMTAwMCAvIGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdG90YWwgPSAwOwogICAgICAgICAgICAgICAgX3RpbWUgPSB0OwogICAgICAgICAgICAgICAgX2F2ZXJhZ2UoIF92YWx1ZSApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfc2V0ICggdiApIHsKICAgICAgICAgICAgX3ZhbHVlID0gdjsKICAgICAgICAgICAgX2F2ZXJhZ2UoIF92YWx1ZSApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc2V0OiBfc2V0LAogICAgICAgICAgICBzdGFydDogX3N0YXJ0LAogICAgICAgICAgICB0aWNrOiBfdGljaywKICAgICAgICAgICAgZW5kOiBfZW5kLAogICAgICAgICAgICBmcmFtZTogX2ZyYW1lLAogICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF92YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHJhdzogX2RyYXcKICAgICAgICB9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBzYW1wbGUgKCkgewoKICAgICAgICB2YXIgX3ZhbHVlID0gMDsKCiAgICAgICAgZnVuY3Rpb24gX3NldCAoIHYgKSB7CiAgICAgICAgICAgIF92YWx1ZSA9IHY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzZXQ6IF9zZXQsCiAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3ZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICB9CgogICAgZnVuY3Rpb24gX3BlcmYgKCBpZEFyZyApIHsKCiAgICAgICAgdmFyIGlkID0gaWRBcmcudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAoIGlkID09PSB1bmRlZmluZWQgKSBpZCA9ICdkZWZhdWx0JzsKICAgICAgICBpZiAoIF9wZXJmQ291bnRlcnNbIGlkIF0gKSByZXR1cm4gX3BlcmZDb3VudGVyc1sgaWQgXTsKCiAgICAgICAgdmFyIGdyb3VwID0gbnVsbDsKICAgICAgICBpZiAoIF9zZXR0aW5ncyAmJiBfc2V0dGluZ3MuZ3JvdXBzICkgewogICAgICAgICAgICBpdGVyYXRlS2V5cyggX3NldHRpbmdzLmdyb3VwcywgZnVuY3Rpb24gKCBqICkgewogICAgICAgICAgICAgICAgdmFyIGcgPSBfc2V0dGluZ3MuZ3JvdXBzWyBwYXJzZUludCggaiwgMTAgKSBdOwogICAgICAgICAgICAgICAgaWYgKCAhZ3JvdXAgJiYgZy52YWx1ZXMuaW5kZXhPZiggaWQudG9Mb3dlckNhc2UoKSApICE9PSAtMSApIHsKICAgICAgICAgICAgICAgICAgICBncm91cCA9IGc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gKTsKICAgICAgICB9CgogICAgICAgIHZhciBwID0gbmV3IFBlcmZDb3VudGVyKCBpZCwgZ3JvdXAgKTsKICAgICAgICBfcGVyZkNvdW50ZXJzWyBpZCBdID0gcDsKICAgICAgICByZXR1cm4gcDsKCiAgICB9CgogICAgZnVuY3Rpb24gX2luaXQgKCkgewoKICAgICAgICBpZiAoIF9zZXR0aW5ncy5wbHVnaW5zICkgewogICAgICAgICAgICBpZiAoICFfc2V0dGluZ3MudmFsdWVzICkgX3NldHRpbmdzLnZhbHVlcyA9IHt9OwogICAgICAgICAgICBpZiAoICFfc2V0dGluZ3MuZ3JvdXBzICkgX3NldHRpbmdzLmdyb3VwcyA9IFtdOwogICAgICAgICAgICBpZiAoICFfc2V0dGluZ3MuZnJhY3Rpb25zICkgX3NldHRpbmdzLmZyYWN0aW9ucyA9IFtdOwogICAgICAgICAgICBmb3IgKCB2YXIgaiA9IDA7IGogPCBfc2V0dGluZ3MucGx1Z2lucy5sZW5ndGg7IGorKyApIHsKICAgICAgICAgICAgICAgIF9zZXR0aW5ncy5wbHVnaW5zWyBqIF0uYXR0YWNoKCBfcGVyZiApOwogICAgICAgICAgICAgICAgaXRlcmF0ZUtleXMoIF9zZXR0aW5ncy5wbHVnaW5zWyBqIF0udmFsdWVzLCBmdW5jdGlvbiAoIGsgKSB7CiAgICAgICAgICAgICAgICAgICAgX3NldHRpbmdzLnZhbHVlc1sgayBdID0gX3NldHRpbmdzLnBsdWdpbnNbIGogXS52YWx1ZXNbIGsgXTsKICAgICAgICAgICAgICAgIH0gKTsKICAgICAgICAgICAgICAgIF9zZXR0aW5ncy5ncm91cHMgPSBfc2V0dGluZ3MuZ3JvdXBzLmNvbmNhdCggX3NldHRpbmdzLnBsdWdpbnNbIGogXS5ncm91cHMgKTsKICAgICAgICAgICAgICAgIF9zZXR0aW5ncy5mcmFjdGlvbnMgPSBfc2V0dGluZ3MuZnJhY3Rpb25zLmNvbmNhdCggX3NldHRpbmdzLnBsdWdpbnNbIGogXS5mcmFjdGlvbnMgKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9zZXR0aW5ncy5wbHVnaW5zID0ge307CiAgICAgICAgfQoKICAgICAgICBfYmFzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CiAgICAgICAgX2Jhc2UuY2xhc3NOYW1lID0gJ3JzLWJhc2UnOwogICAgICAgIF9kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwogICAgICAgIF9kaXYuY2xhc3NOYW1lID0gJ3JzLWNvbnRhaW5lcic7CiAgICAgICAgX2Rpdi5zdHlsZS5oZWlnaHQgPSAnYXV0byc7CiAgICAgICAgX2Jhc2UuYXBwZW5kQ2hpbGQoIF9kaXYgKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBfYmFzZSApOwoKICAgICAgICBpZiAoICFfc2V0dGluZ3MgKSByZXR1cm47CgogICAgICAgIGlmICggX3NldHRpbmdzLmdyb3VwcyApIHsKICAgICAgICAgICAgaXRlcmF0ZUtleXMoIF9zZXR0aW5ncy5ncm91cHMsIGZ1bmN0aW9uICggaiApIHsKICAgICAgICAgICAgICAgIHZhciBnID0gX3NldHRpbmdzLmdyb3Vwc1sgcGFyc2VJbnQoIGosIDEwICkgXTsKICAgICAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwogICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICdycy1ncm91cCc7CiAgICAgICAgICAgICAgICBnLmRpdiA9IGRpdjsKICAgICAgICAgICAgICAgIHZhciBoMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdoMScgKTsKICAgICAgICAgICAgICAgIGgxLnRleHRDb250ZW50ID0gZy5jYXB0aW9uOwogICAgICAgICAgICAgICAgaDEuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24gKCBlICkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSggJ2hpZGRlbicgKTsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9LmJpbmQoIGRpdiApICk7CiAgICAgICAgICAgICAgICBfZGl2LmFwcGVuZENoaWxkKCBoMSApOwogICAgICAgICAgICAgICAgX2Rpdi5hcHBlbmRDaGlsZCggZGl2ICk7CiAgICAgICAgICAgIH0gKTsKICAgICAgICB9CgogICAgICAgIGlmICggX3NldHRpbmdzLmZyYWN0aW9ucyApIHsKICAgICAgICAgICAgaXRlcmF0ZUtleXMoIF9zZXR0aW5ncy5mcmFjdGlvbnMsIGZ1bmN0aW9uICggaiApIHsKICAgICAgICAgICAgICAgIHZhciBmID0gX3NldHRpbmdzLmZyYWN0aW9uc1sgcGFyc2VJbnQoIGosIDEwICkgXTsKICAgICAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwogICAgICAgICAgICAgICAgZGl2LmNsYXNzTmFtZSA9ICdycy1mcmFjdGlvbic7CiAgICAgICAgICAgICAgICB2YXIgbGVnZW5kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKICAgICAgICAgICAgICAgIGxlZ2VuZC5jbGFzc05hbWUgPSAncnMtbGVnZW5kJzsKCiAgICAgICAgICAgICAgICB2YXIgaCA9IDA7CiAgICAgICAgICAgICAgICBpdGVyYXRlS2V5cyggX3NldHRpbmdzLmZyYWN0aW9uc1sgaiBdLnN0ZXBzLCBmdW5jdGlvbiAoIGsgKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAncCcgKTsKICAgICAgICAgICAgICAgICAgICBwLnRleHRDb250ZW50ID0gX3NldHRpbmdzLmZyYWN0aW9uc1sgaiBdLnN0ZXBzWyBrIF07CiAgICAgICAgICAgICAgICAgICAgcC5zdHlsZS5jb2xvciA9IF9jb2xvdXJzWyBoIF07CiAgICAgICAgICAgICAgICAgICAgbGVnZW5kLmFwcGVuZENoaWxkKCBwICk7CiAgICAgICAgICAgICAgICAgICAgaCsrOwogICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKCBsZWdlbmQgKTsKICAgICAgICAgICAgICAgIGRpdi5zdHlsZS5oZWlnaHQgPSBoICogX2VsSGVpZ2h0ICsgJ3B4JzsKICAgICAgICAgICAgICAgIGYuZGl2ID0gZGl2OwogICAgICAgICAgICAgICAgdmFyIGdyYXBoID0gbmV3IFN0YWNrR3JhcGgoIGRpdiwgaCApOwogICAgICAgICAgICAgICAgZi5ncmFwaCA9IGdyYXBoOwogICAgICAgICAgICAgICAgX2Rpdi5hcHBlbmRDaGlsZCggZGl2ICk7CiAgICAgICAgICAgIH0gKTsKICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGUgKCkgewoKICAgICAgICBpdGVyYXRlS2V5cyggX3NldHRpbmdzLnBsdWdpbnMsIGZ1bmN0aW9uICggaiApIHsKICAgICAgICAgICAgX3NldHRpbmdzLnBsdWdpbnNbIGogXS51cGRhdGUoKTsKICAgICAgICB9ICk7CgogICAgICAgIGl0ZXJhdGVLZXlzKCBfcGVyZkNvdW50ZXJzLCBmdW5jdGlvbiAoIGogKSB7CiAgICAgICAgICAgIF9wZXJmQ291bnRlcnNbIGogXS5kcmF3KCk7CiAgICAgICAgfSApOwoKICAgICAgICBpZiAoIF9zZXR0aW5ncyAmJiBfc2V0dGluZ3MuZnJhY3Rpb25zICkgewogICAgICAgICAgICBpdGVyYXRlS2V5cyggX3NldHRpbmdzLmZyYWN0aW9ucywgZnVuY3Rpb24gKCBqICkgewogICAgICAgICAgICAgICAgdmFyIGYgPSBfc2V0dGluZ3MuZnJhY3Rpb25zWyBwYXJzZUludCggaiwgMTAgKSBdOwogICAgICAgICAgICAgICAgdmFyIHYgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBiYXNlID0gX3BlcmZDb3VudGVyc1sgZi5iYXNlLnRvTG93ZXJDYXNlKCkgXTsKICAgICAgICAgICAgICAgIGlmICggYmFzZSApIHsKICAgICAgICAgICAgICAgICAgICBiYXNlID0gYmFzZS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIGl0ZXJhdGVLZXlzKCBfc2V0dGluZ3MuZnJhY3Rpb25zWyBqIF0uc3RlcHMsIGZ1bmN0aW9uICggayApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBfc2V0dGluZ3MuZnJhY3Rpb25zWyBqIF0uc3RlcHNbIHBhcnNlSW50KCBrLCAxMCApIF0udG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IF9wZXJmQ291bnRlcnNbIHMgXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB2YWwgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LnB1c2goIHZhbC52YWx1ZSgpIC8gYmFzZSApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZi5ncmFwaC5kcmF3KCB2ICk7CiAgICAgICAgICAgIH0gKTsKICAgICAgICB9CgogICAgICAgIC8qaWYoIF9oZWlnaHQgIT0gX2Rpdi5jbGllbnRIZWlnaHQgKSB7CiAgICAgICAgICAgIF9oZWlnaHQgPSBfZGl2LmNsaWVudEhlaWdodDsKICAgICAgICAgICAgX2Jhc2Uuc3R5bGUuaGVpZ2h0ID0gX2hlaWdodCArIDIgKiBfZWxIZWlnaHQgKyAncHgnOwogICAgICAgIGNvbnNvbGUubG9nKCBfYmFzZS5jbGllbnRIZWlnaHQgKTsKICAgICAgICB9Ki8KCiAgICB9CgogICAgX2luaXQoKTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKCBpZCApIHsKICAgICAgICBpZiAoIGlkICkgcmV0dXJuIF9wZXJmKCBpZCApOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVsZW1lbnQ6IF9iYXNlLAogICAgICAgICAgICB1cGRhdGU6IF91cGRhdGUKICAgICAgICB9OwogICAgfTsKCn0KCmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykgewogIG1vZHVsZS5leHBvcnRzID0gd2luZG93LnJTdGF0czsKfQoKfSx7fV0sMTkwOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM2MjEzNDY0CmlmICghU3RyaW5nLnByb3RvdHlwZS5zdGFydHNXaXRoKSB7CiAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihzZWFyY2hTdHJpbmcsIHBvc2l0aW9uKXsKICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiB8fCAwOwogICAgICByZXR1cm4gdGhpcy5zdWJzdHIocG9zaXRpb24sIHNlYXJjaFN0cmluZy5sZW5ndGgpID09PSBzZWFyY2hTdHJpbmc7CiAgfTsKfQoKfSx7fV0sMTkxOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyoKICogQ29weXJpZ2h0IDIwMTUgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgp2YXIgVXRpbCA9IHt9OwoKVXRpbC5iYXNlNjQgPSBmdW5jdGlvbihtaW1lVHlwZSwgYmFzZTY0KSB7CiAgcmV0dXJuICdkYXRhOicgKyBtaW1lVHlwZSArICc7YmFzZTY0LCcgKyBiYXNlNjQ7Cn07CgpVdGlsLmlzTW9iaWxlID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNoZWNrID0gZmFsc2U7CiAgKGZ1bmN0aW9uKGEpe2lmKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSl8fC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLDQpKSljaGVjayA9IHRydWV9KShuYXZpZ2F0b3IudXNlckFnZW50fHxuYXZpZ2F0b3IudmVuZG9yfHx3aW5kb3cub3BlcmEpOwogIHJldHVybiBjaGVjazsKfTsKClV0aWwuaXNJT1MgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gLyhpUGFkfGlQaG9uZXxpUG9kKS9nLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7Cn07CgpVdGlsLmlzSUZyYW1lID0gZnVuY3Rpb24oKSB7CiAgdHJ5IHsKICAgIHJldHVybiB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDsKICB9IGNhdGNoIChlKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn07CgpVdGlsLmFwcGVuZFF1ZXJ5UGFyYW1ldGVyID0gZnVuY3Rpb24odXJsLCBrZXksIHZhbHVlKSB7CiAgLy8gRGV0ZXJtaW5lIGRlbGltaXRlciBiYXNlZCBvbiBpZiB0aGUgVVJMIGFscmVhZHkgR0VUIHBhcmFtZXRlcnMgaW4gaXQuCiAgdmFyIGRlbGltaXRlciA9ICh1cmwuaW5kZXhPZignPycpIDwgMCA/ICc/JyA6ICcmJyk7CiAgdXJsICs9IGRlbGltaXRlciArIGtleSArICc9JyArIHZhbHVlOwogIHJldHVybiB1cmw7Cn07CgovLyBGcm9tIGh0dHA6Ly9nb28uZ2wvNFdYM3RnClV0aWwuZ2V0UXVlcnlQYXJhbWV0ZXIgPSBmdW5jdGlvbihuYW1lKSB7CiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xbXS8sICJcXFsiKS5yZXBsYWNlKC9bXF1dLywgIlxcXSIpOwogIHZhciByZWdleCA9IG5ldyBSZWdFeHAoIltcXD8mXSIgKyBuYW1lICsgIj0oW14mI10qKSIpLAogICAgICByZXN1bHRzID0gcmVnZXguZXhlYyhsb2NhdGlvbi5zZWFyY2gpOwogIHJldHVybiByZXN1bHRzID09PSBudWxsID8gIiIgOiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXS5yZXBsYWNlKC9cKy9nLCAiICIpKTsKfTsKClV0aWwuaXNMYW5kc2NhcGVNb2RlID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICh3aW5kb3cub3JpZW50YXRpb24gPT0gOTAgfHwgd2luZG93Lm9yaWVudGF0aW9uID09IC05MCk7Cn07CgoKbW9kdWxlLmV4cG9ydHMgPSBVdGlsOwoKfSx7fV0sMTkyOltmdW5jdGlvbihfZGVyZXFfLG1vZHVsZSxleHBvcnRzKXsKLyoKICogQ29weXJpZ2h0IDIwMTUgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgp2YXIgVXRpbCA9IF9kZXJlcV8oJy4vdXRpbC5qcycpOwoKLyoqCiAqIEFuZHJvaWQgYW5kIGlPUyBjb21wYXRpYmxlIHdha2Vsb2NrIGltcGxlbWVudGF0aW9uLgogKgogKiBSZWZhY3RvcmVkIHRoYW5rcyB0byBka292YWxldkAuCiAqLwpmdW5jdGlvbiBBbmRyb2lkV2FrZUxvY2soKSB7CiAgdmFyIHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKCiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBmdW5jdGlvbigpIHsKICAgIHZpZGVvLnBsYXkoKTsKICB9KTsKCiAgdGhpcy5yZXF1ZXN0ID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodmlkZW8ucGF1c2VkKSB7CiAgICAgIC8vIEJhc2U2NCB2ZXJzaW9uIG9mIHZpZGVvc19zcmMvbm8tc2xlZXAtNjBzLndlYm0uCiAgICAgIHZpZGVvLnNyYyA9IFV0aWwuYmFzZTY0KCd2aWRlby93ZWJtJywgJ0drWGZvd0VBQUFBQUFBQWZRb2FCQVVMM2dRRkM4b0VFUXZPQkNFS0NoSGRsWW0xQ2g0RUNRb1dCQWhoVGdHY0JBQUFBQUFBSDR4Rk5tM1JBTEUyN2kxT3JoQlZKcVdaVHJJSGZUYnVNVTZ1RUZsU3VhMU9zZ2dFd1RidU1VNnVFSEZPN2ExT3NnZ2ZHN0FFQUFBQUFBQUNrQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBVlNhbG1BUUFBQUFBQUFFVXExN0dERDBKQVRZQ05UR0YyWmpVMkxqUXdMakV3TVZkQmpVeGhkbVkxTmk0ME1DNHhNREZ6cEpBR1NKVE1ic0xwRHQveVNraXBnWDFmUkltSVFPMU1BQUFBQUFBV1ZLNXJBUUFBQUFBQUFEdXVBUUFBQUFBQUFETFhnUUZ6eFlFQm5JRUFJcldjZzNWdVpJYUZWbDlXVURtRGdRRWo0NE9FTzVyS0FPQUJBQUFBQUFBQUJyQ0JzTHFCa0I5RHRuVUJBQUFBQUFBQW8rZUJBS09tZ1FBQWdLSkpnMElBQVY0QkhzQUhCSU9EQ29BQUNtSDJNQUFBWnhnejRkUFNURmk1SkFDamxvRUQ2QUNtQUVDU25BQk1RQUFEWUFBQVdpMHF1b0NqbG9FSDBBQ21BRUNTbkFCTndBQURZQUFBV2kwcXVvQ2psb0VMdUFDbUFFQ1NuQUJOZ0FBRFlBQUFXaTBxdW9DamxvRVBvQUNtQUVDU25BQk5ZQUFEWUFBQVdpMHF1b0NqbG9FVGlBQ21BRUNTbkFCTklBQURZQUFBV2kwcXVvQWZRN1oxQVFBQUFBQUFBSlRuZ2hkd281YUJBQUFBcGdCQWtwd0FUT0FBQTJBQUFGb3RLcnFBbzVhQkErZ0FwZ0JBa3B3QVRNQUFBMkFBQUZvdEtycUFvNWFCQjlBQXBnQkFrcHdBVElBQUEyQUFBRm90S3JxQW81YUJDN2dBcGdCQWtwd0FURUFBQTJBQUFGb3RLcnFBbzVhQkQ2QUFwZ0RBa3B3QVEyQUFBMkFBQUZvdEtycUFvNWFCRTRnQXBnQkFrcHdBVENBQUEyQUFBRm90S3JxQUgwTzJkUUVBQUFBQUFBQ1U1NEl1NEtPV2dRQUFBS1lBUUpLY0FFdkFBQU5nQUFCYUxTcTZnS09XZ1FQb0FLWUFRSktjQUV0Z0FBTmdBQUJhTFNxNmdLT1dnUWZRQUtZQVFKS2NBRXNBQUFOZ0FBQmFMU3E2Z0tPV2dRdTRBS1lBUUpLY0FFcUFBQU5nQUFCYUxTcTZnS09XZ1ErZ0FLWUFRSktjQUVvZ0FBTmdBQUJhTFNxNmdLT1dnUk9JQUtZQVFKS2NBRW5BQUFOZ0FBQmFMU3E2Z0I5RHRuVUJBQUFBQUFBQWxPZUNSbENqbG9FQUFBQ21BRUNTbkFCSmdBQURZQUFBV2kwcXVvQ2psb0VENkFDbUFFQ1NuQUJKSUFBRFlBQUFXaTBxdW9DamxvRUgwQUNtQU1DU25BQkRZQUFEWUFBQVdpMHF1b0NqbG9FTHVBQ21BRUNTbkFCSTRBQURZQUFBV2kwcXVvQ2psb0VQb0FDbUFFQ1NuQUJJb0FBRFlBQUFXaTBxdW9DamxvRVRpQUNtQUVDU25BQklZQUFEWUFBQVdpMHF1b0FmUTdaMUFRQUFBQUFBQUpUbmdsM0FvNWFCQUFBQXBnQkFrcHdBU0NBQUEyQUFBRm90S3JxQW81YUJBK2dBcGdCQWtwd0FTQUFBQTJBQUFGb3RLcnFBbzVhQkI5QUFwZ0JBa3B3QVI4QUFBMkFBQUZvdEtycUFvNWFCQzdnQXBnQkFrcHdBUjRBQUEyQUFBRm90S3JxQW81YUJENkFBcGdCQWtwd0FSMkFBQTJBQUFGb3RLcnFBbzVhQkU0Z0FwZ0JBa3B3QVJ5QUFBMkFBQUZvdEtycUFIME8yZFFFQUFBQUFBQUNVNTRKMU1LT1dnUUFBQUtZQXdKS2NBRU5nQUFOZ0FBQmFMU3E2Z0tPV2dRUG9BS1lBUUpLY0FFYmdBQU5nQUFCYUxTcTZnS09XZ1FmUUFLWUFRSktjQUVhZ0FBTmdBQUJhTFNxNmdLT1dnUXU0QUtZQVFKS2NBRWFBQUFOZ0FBQmFMU3E2Z0tPV2dRK2dBS1lBUUpLY0FFWkFBQU5nQUFCYUxTcTZnS09XZ1JPSUFLWUFRSktjQUVZQUFBTmdBQUJhTFNxNmdCOUR0blVCQUFBQUFBQUFsT2VDaktDamxvRUFBQUNtQUVDU25BQkY0QUFEWUFBQVdpMHF1b0NqbG9FRDZBQ21BRUNTbkFCRndBQURZQUFBV2kwcXVvQ2psb0VIMEFDbUFFQ1NuQUJGb0FBRFlBQUFXaTBxdW9DamxvRUx1QUNtQUVDU25BQkZnQUFEWUFBQVdpMHF1b0NqbG9FUG9BQ21BTUNTbkFCRFlBQURZQUFBV2kwcXVvQ2psb0VUaUFDbUFFQ1NuQUJGWUFBRFlBQUFXaTBxdW9BZlE3WjFBUUFBQUFBQUFKVG5ncVFRbzVhQkFBQUFwZ0JBa3B3QVJVQUFBMkFBQUZvdEtycUFvNWFCQStnQXBnQkFrcHdBUlNBQUEyQUFBRm90S3JxQW81YUJCOUFBcGdCQWtwd0FSUUFBQTJBQUFGb3RLcnFBbzVhQkM3Z0FwZ0JBa3B3QVJRQUFBMkFBQUZvdEtycUFvNWFCRDZBQXBnQkFrcHdBUk9BQUEyQUFBRm90S3JxQW81YUJFNGdBcGdCQWtwd0FSTUFBQTJBQUFGb3RLcnFBSDBPMmRRRUFBQUFBQUFDVTU0SzdnS09XZ1FBQUFLWUFRSktjQUVTZ0FBTmdBQUJhTFNxNmdLT1dnUVBvQUtZQVFKS2NBRVNBQUFOZ0FBQmFMU3E2Z0tPV2dRZlFBS1lBd0pLY0FFTmdBQU5nQUFCYUxTcTZnS09XZ1F1NEFLWUFRSktjQUVSZ0FBTmdBQUJhTFNxNmdLT1dnUStnQUtZQVFKS2NBRVJBQUFOZ0FBQmFMU3E2Z0tPV2dST0lBS1lBUUpLY0FFUWdBQU5nQUFCYUxTcTZnQjlEdG5VQkFBQUFBQUFBbE9lQzB2Q2psb0VBQUFDbUFFQ1NuQUJFSUFBRFlBQUFXaTBxdW9DamxvRUQ2QUNtQUVDU25BQkVBQUFEWUFBQVdpMHF1b0NqbG9FSDBBQ21BRUNTbkFCRDRBQURZQUFBV2kwcXVvQ2psb0VMdUFDbUFFQ1NuQUJEd0FBRFlBQUFXaTBxdW9DamxvRVBvQUNtQUVDU25BQkRvQUFEWUFBQVdpMHF1b0NqbG9FVGlBQ21BRUNTbkFCRGdBQURZQUFBV2kwcXVvQWNVN3RyQVFBQUFBQUFBQkc3ajdPQkFMZUs5NEVCOFlJQmQvQ0JBdz09Jyk7CiAgICAgIHZpZGVvLnBsYXkoKTsKICAgIH0KICB9OwoKICB0aGlzLnJlbGVhc2UgPSBmdW5jdGlvbigpIHsKICAgIHZpZGVvLnBhdXNlKCk7CiAgICB2aWRlby5zcmMgPSAnJzsKICB9Owp9CgpmdW5jdGlvbiBpT1NXYWtlTG9jaygpIHsKICB2YXIgdGltZXIgPSBudWxsOwoKICB0aGlzLnJlcXVlc3QgPSBmdW5jdGlvbigpIHsKICAgIGlmICghdGltZXIpIHsKICAgICAgdGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJzsKICAgICAgICBzZXRUaW1lb3V0KHdpbmRvdy5zdG9wLCAwKTsKICAgICAgfSwgMTUwMDApOwogICAgfQogIH0KCiAgdGhpcy5yZWxlYXNlID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodGltZXIpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7CiAgICAgIHRpbWVyID0gbnVsbDsKICAgIH0KICB9Cn0KCgpmdW5jdGlvbiBnZXRXYWtlTG9jaygpIHsKICB2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYTsKICBpZiAodXNlckFnZW50Lm1hdGNoKC9pUGhvbmUvaSkgfHwgdXNlckFnZW50Lm1hdGNoKC9pUG9kL2kpKSB7CiAgICByZXR1cm4gaU9TV2FrZUxvY2s7CiAgfSBlbHNlIHsKICAgIHJldHVybiBBbmRyb2lkV2FrZUxvY2s7CiAgfQp9Cgptb2R1bGUuZXhwb3J0cyA9IGdldFdha2VMb2NrKCk7Cgp9LHsiLi91dGlsLmpzIjoxOTF9XX0se30sWzE1Ml0pKDE1MikKfSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWFmcmFtZS12MC45LjIuanMubWFwCg==",
            "mime_type": "application/x-javascript"
        },
        {
           "name": "main.css",
           "file": "LyohCiAqIEJvb3RzdHJhcCB2My4zLjcgKGh0dHA6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMS0yMDE2IFR3aXR0ZXIsIEluYy4KICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICovCi8qISBub3JtYWxpemUuY3NzIHYzLjAuMyB8IE1JVCBMaWNlbnNlIHwgZ2l0aHViLmNvbS9uZWNvbGFzL25vcm1hbGl6ZS5jc3MgKi8KaHRtbCB7CiAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7CiAgLXdlYmtpdC10ZXh0LXNpemUtYWRqdXN0OiAxMDAlOwogICAgICAtbXMtdGV4dC1zaXplLWFkanVzdDogMTAwJTsKfQpib2R5IHsKICBtYXJnaW46IDA7Cn0KYXJ0aWNsZSwKYXNpZGUsCmRldGFpbHMsCmZpZ2NhcHRpb24sCmZpZ3VyZSwKZm9vdGVyLApoZWFkZXIsCmhncm91cCwKbWFpbiwKbWVudSwKbmF2LApzZWN0aW9uLApzdW1tYXJ5IHsKICBkaXNwbGF5OiBibG9jazsKfQphdWRpbywKY2FudmFzLApwcm9ncmVzcywKdmlkZW8gewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB2ZXJ0aWNhbC1hbGlnbjogYmFzZWxpbmU7Cn0KYXVkaW86bm90KFtjb250cm9sc10pIHsKICBkaXNwbGF5OiBub25lOwogIGhlaWdodDogMDsKfQpbaGlkZGVuXSwKdGVtcGxhdGUgewogIGRpc3BsYXk6IG5vbmU7Cn0KYSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KYTphY3RpdmUsCmE6aG92ZXIgewogIG91dGxpbmU6IDA7Cn0KYWJiclt0aXRsZV0gewogIGJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQ7Cn0KYiwKc3Ryb25nIHsKICBmb250LXdlaWdodDogYm9sZDsKfQpkZm4gewogIGZvbnQtc3R5bGU6IGl0YWxpYzsKfQpoMSB7CiAgbWFyZ2luOiAuNjdlbSAwOwogIGZvbnQtc2l6ZTogMmVtOwp9Cm1hcmsgewogIGNvbG9yOiAjMDAwOwogIGJhY2tncm91bmQ6ICNmZjA7Cn0Kc21hbGwgewogIGZvbnQtc2l6ZTogODAlOwp9CnN1YiwKc3VwIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgZm9udC1zaXplOiA3NSU7CiAgbGluZS1oZWlnaHQ6IDA7CiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwp9CnN1cCB7CiAgdG9wOiAtLjVlbTsKfQpzdWIgewogIGJvdHRvbTogLS4yNWVtOwp9CmltZyB7CiAgYm9yZGVyOiAwOwp9CnN2Zzpub3QoOnJvb3QpIHsKICBvdmVyZmxvdzogaGlkZGVuOwp9CmZpZ3VyZSB7CiAgbWFyZ2luOiAxZW0gNDBweDsKfQpociB7CiAgaGVpZ2h0OiAwOwogIC13ZWJraXQtYm94LXNpemluZzogY29udGVudC1ib3g7CiAgICAgLW1vei1ib3gtc2l6aW5nOiBjb250ZW50LWJveDsKICAgICAgICAgIGJveC1zaXppbmc6IGNvbnRlbnQtYm94Owp9CnByZSB7CiAgb3ZlcmZsb3c6IGF1dG87Cn0KY29kZSwKa2JkLApwcmUsCnNhbXAgewogIGZvbnQtZmFtaWx5OiBtb25vc3BhY2UsIG1vbm9zcGFjZTsKICBmb250LXNpemU6IDFlbTsKfQpidXR0b24sCmlucHV0LApvcHRncm91cCwKc2VsZWN0LAp0ZXh0YXJlYSB7CiAgbWFyZ2luOiAwOwogIGZvbnQ6IGluaGVyaXQ7CiAgY29sb3I6IGluaGVyaXQ7Cn0KYnV0dG9uIHsKICBvdmVyZmxvdzogdmlzaWJsZTsKfQpidXR0b24sCnNlbGVjdCB7CiAgdGV4dC10cmFuc2Zvcm06IG5vbmU7Cn0KYnV0dG9uLApodG1sIGlucHV0W3R5cGU9ImJ1dHRvbiJdLAppbnB1dFt0eXBlPSJyZXNldCJdLAppbnB1dFt0eXBlPSJzdWJtaXQiXSB7CiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBidXR0b247CiAgY3Vyc29yOiBwb2ludGVyOwp9CmJ1dHRvbltkaXNhYmxlZF0sCmh0bWwgaW5wdXRbZGlzYWJsZWRdIHsKICBjdXJzb3I6IGRlZmF1bHQ7Cn0KYnV0dG9uOjotbW96LWZvY3VzLWlubmVyLAppbnB1dDo6LW1vei1mb2N1cy1pbm5lciB7CiAgcGFkZGluZzogMDsKICBib3JkZXI6IDA7Cn0KaW5wdXQgewogIGxpbmUtaGVpZ2h0OiBub3JtYWw7Cn0KaW5wdXRbdHlwZT0iY2hlY2tib3giXSwKaW5wdXRbdHlwZT0icmFkaW8iXSB7CiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgcGFkZGluZzogMDsKfQppbnB1dFt0eXBlPSJudW1iZXIiXTo6LXdlYmtpdC1pbm5lci1zcGluLWJ1dHRvbiwKaW5wdXRbdHlwZT0ibnVtYmVyIl06Oi13ZWJraXQtb3V0ZXItc3Bpbi1idXR0b24gewogIGhlaWdodDogYXV0bzsKfQppbnB1dFt0eXBlPSJzZWFyY2giXSB7CiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBjb250ZW50LWJveDsKICAgICAtbW96LWJveC1zaXppbmc6IGNvbnRlbnQtYm94OwogICAgICAgICAgYm94LXNpemluZzogY29udGVudC1ib3g7CiAgLXdlYmtpdC1hcHBlYXJhbmNlOiB0ZXh0ZmllbGQ7Cn0KaW5wdXRbdHlwZT0ic2VhcmNoIl06Oi13ZWJraXQtc2VhcmNoLWNhbmNlbC1idXR0b24sCmlucHV0W3R5cGU9InNlYXJjaCJdOjotd2Via2l0LXNlYXJjaC1kZWNvcmF0aW9uIHsKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7Cn0KZmllbGRzZXQgewogIHBhZGRpbmc6IC4zNWVtIC42MjVlbSAuNzVlbTsKICBtYXJnaW46IDAgMnB4OwogIGJvcmRlcjogMXB4IHNvbGlkICNjMGMwYzA7Cn0KbGVnZW5kIHsKICBwYWRkaW5nOiAwOwogIGJvcmRlcjogMDsKfQp0ZXh0YXJlYSB7CiAgb3ZlcmZsb3c6IGF1dG87Cn0Kb3B0Z3JvdXAgewogIGZvbnQtd2VpZ2h0OiBib2xkOwp9CnRhYmxlIHsKICBib3JkZXItc3BhY2luZzogMDsKICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwp9CnRkLAp0aCB7CiAgcGFkZGluZzogMDsKfQovKiEgU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vaDVicC9odG1sNS1ib2lsZXJwbGF0ZS9ibG9iL21hc3Rlci9zcmMvY3NzL21haW4uY3NzICovCkBtZWRpYSBwcmludCB7CiAgKiwKICAqOmJlZm9yZSwKICAqOmFmdGVyIHsKICAgIGNvbG9yOiAjMDAwICFpbXBvcnRhbnQ7CiAgICB0ZXh0LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50OwogICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQgIWltcG9ydGFudDsKICAgIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50OwogICAgICAgICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7CiAgfQogIGEsCiAgYTp2aXNpdGVkIHsKICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOwogIH0KICBhW2hyZWZdOmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIgKCIgYXR0cihocmVmKSAiKSI7CiAgfQogIGFiYnJbdGl0bGVdOmFmdGVyIHsKICAgIGNvbnRlbnQ6ICIgKCIgYXR0cih0aXRsZSkgIikiOwogIH0KICBhW2hyZWZePSIjIl06YWZ0ZXIsCiAgYVtocmVmXj0iamF2YXNjcmlwdDoiXTphZnRlciB7CiAgICBjb250ZW50OiAiIjsKICB9CiAgcHJlLAogIGJsb2NrcXVvdGUgewogICAgYm9yZGVyOiAxcHggc29saWQgIzk5OTsKCiAgICBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7CiAgfQogIHRoZWFkIHsKICAgIGRpc3BsYXk6IHRhYmxlLWhlYWRlci1ncm91cDsKICB9CiAgdHIsCiAgaW1nIHsKICAgIHBhZ2UtYnJlYWstaW5zaWRlOiBhdm9pZDsKICB9CiAgaW1nIHsKICAgIG1heC13aWR0aDogMTAwJSAhaW1wb3J0YW50OwogIH0KICBwLAogIGgyLAogIGgzIHsKICAgIG9ycGhhbnM6IDM7CiAgICB3aWRvd3M6IDM7CiAgfQogIGgyLAogIGgzIHsKICAgIHBhZ2UtYnJlYWstYWZ0ZXI6IGF2b2lkOwogIH0KICAubmF2YmFyIHsKICAgIGRpc3BsYXk6IG5vbmU7CiAgfQogIC5idG4gPiAuY2FyZXQsCiAgLmRyb3B1cCA+IC5idG4gPiAuY2FyZXQgewogICAgYm9yZGVyLXRvcC1jb2xvcjogIzAwMCAhaW1wb3J0YW50OwogIH0KICAubGFiZWwgewogICAgYm9yZGVyOiAxcHggc29saWQgIzAwMDsKICB9CiAgLnRhYmxlIHsKICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2UgIWltcG9ydGFudDsKICB9CiAgLnRhYmxlIHRkLAogIC50YWJsZSB0aCB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmICFpbXBvcnRhbnQ7CiAgfQogIC50YWJsZS1ib3JkZXJlZCB0aCwKICAudGFibGUtYm9yZGVyZWQgdGQgewogICAgYm9yZGVyOiAxcHggc29saWQgI2RkZCAhaW1wb3J0YW50OwogIH0KfQpAZm9udC1mYWNlIHsKICBmb250LWZhbWlseTogJ0dseXBoaWNvbnMgSGFsZmxpbmdzJzsKCiAgc3JjOiB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIuZW90Jyk7CiAgc3JjOiB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIuZW90PyNpZWZpeCcpIGZvcm1hdCgnZW1iZWRkZWQtb3BlbnR5cGUnKSwgdXJsKCcuLi9mb250cy9nbHlwaGljb25zLWhhbGZsaW5ncy1yZWd1bGFyLndvZmYyJykgZm9ybWF0KCd3b2ZmMicpLCB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIud29mZicpIGZvcm1hdCgnd29mZicpLCB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIudHRmJykgZm9ybWF0KCd0cnVldHlwZScpLCB1cmwoJy4uL2ZvbnRzL2dseXBoaWNvbnMtaGFsZmxpbmdzLXJlZ3VsYXIuc3ZnI2dseXBoaWNvbnNfaGFsZmxpbmdzcmVndWxhcicpIGZvcm1hdCgnc3ZnJyk7Cn0KLmdseXBoaWNvbiB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHRvcDogMXB4OwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBmb250LWZhbWlseTogJ0dseXBoaWNvbnMgSGFsZmxpbmdzJzsKICBmb250LXN0eWxlOiBub3JtYWw7CiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICBsaW5lLWhlaWdodDogMTsKCiAgLXdlYmtpdC1mb250LXNtb290aGluZzogYW50aWFsaWFzZWQ7CiAgLW1vei1vc3gtZm9udC1zbW9vdGhpbmc6IGdyYXlzY2FsZTsKfQouZ2x5cGhpY29uLWFzdGVyaXNrOmJlZm9yZSB7CiAgY29udGVudDogIlwwMDJhIjsKfQouZ2x5cGhpY29uLXBsdXM6YmVmb3JlIHsKICBjb250ZW50OiAiXDAwMmIiOwp9Ci5nbHlwaGljb24tZXVybzpiZWZvcmUsCi5nbHlwaGljb24tZXVyOmJlZm9yZSB7CiAgY29udGVudDogIlwyMGFjIjsKfQouZ2x5cGhpY29uLW1pbnVzOmJlZm9yZSB7CiAgY29udGVudDogIlwyMjEyIjsKfQouZ2x5cGhpY29uLWNsb3VkOmJlZm9yZSB7CiAgY29udGVudDogIlwyNjAxIjsKfQouZ2x5cGhpY29uLWVudmVsb3BlOmJlZm9yZSB7CiAgY29udGVudDogIlwyNzA5IjsKfQouZ2x5cGhpY29uLXBlbmNpbDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcMjcwZiI7Cn0KLmdseXBoaWNvbi1nbGFzczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAwMSI7Cn0KLmdseXBoaWNvbi1tdXNpYzpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAwMiI7Cn0KLmdseXBoaWNvbi1zZWFyY2g6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMDMiOwp9Ci5nbHlwaGljb24taGVhcnQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMDUiOwp9Ci5nbHlwaGljb24tc3RhcjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAwNiI7Cn0KLmdseXBoaWNvbi1zdGFyLWVtcHR5OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDA3IjsKfQouZ2x5cGhpY29uLXVzZXI6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMDgiOwp9Ci5nbHlwaGljb24tZmlsbTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAwOSI7Cn0KLmdseXBoaWNvbi10aC1sYXJnZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAxMCI7Cn0KLmdseXBoaWNvbi10aDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAxMSI7Cn0KLmdseXBoaWNvbi10aC1saXN0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDEyIjsKfQouZ2x5cGhpY29uLW9rOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDEzIjsKfQouZ2x5cGhpY29uLXJlbW92ZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAxNCI7Cn0KLmdseXBoaWNvbi16b29tLWluOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDE1IjsKfQouZ2x5cGhpY29uLXpvb20tb3V0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDE2IjsKfQouZ2x5cGhpY29uLW9mZjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAxNyI7Cn0KLmdseXBoaWNvbi1zaWduYWw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMTgiOwp9Ci5nbHlwaGljb24tY29nOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDE5IjsKfQouZ2x5cGhpY29uLXRyYXNoOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDIwIjsKfQouZ2x5cGhpY29uLWhvbWU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMjEiOwp9Ci5nbHlwaGljb24tZmlsZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAyMiI7Cn0KLmdseXBoaWNvbi10aW1lOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDIzIjsKfQouZ2x5cGhpY29uLXJvYWQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMjQiOwp9Ci5nbHlwaGljb24tZG93bmxvYWQtYWx0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDI1IjsKfQouZ2x5cGhpY29uLWRvd25sb2FkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDI2IjsKfQouZ2x5cGhpY29uLXVwbG9hZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAyNyI7Cn0KLmdseXBoaWNvbi1pbmJveDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAyOCI7Cn0KLmdseXBoaWNvbi1wbGF5LWNpcmNsZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAyOSI7Cn0KLmdseXBoaWNvbi1yZXBlYXQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMzAiOwp9Ci5nbHlwaGljb24tcmVmcmVzaDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAzMSI7Cn0KLmdseXBoaWNvbi1saXN0LWFsdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAzMiI7Cn0KLmdseXBoaWNvbi1sb2NrOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDMzIjsKfQouZ2x5cGhpY29uLWZsYWc6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMzQiOwp9Ci5nbHlwaGljb24taGVhZHBob25lczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAzNSI7Cn0KLmdseXBoaWNvbi12b2x1bWUtb2ZmOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDM2IjsKfQouZ2x5cGhpY29uLXZvbHVtZS1kb3duOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDM3IjsKfQouZ2x5cGhpY29uLXZvbHVtZS11cDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTAzOCI7Cn0KLmdseXBoaWNvbi1xcmNvZGU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwMzkiOwp9Ci5nbHlwaGljb24tYmFyY29kZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA0MCI7Cn0KLmdseXBoaWNvbi10YWc6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNDEiOwp9Ci5nbHlwaGljb24tdGFnczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA0MiI7Cn0KLmdseXBoaWNvbi1ib29rOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDQzIjsKfQouZ2x5cGhpY29uLWJvb2ttYXJrOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDQ0IjsKfQouZ2x5cGhpY29uLXByaW50OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDQ1IjsKfQouZ2x5cGhpY29uLWNhbWVyYTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA0NiI7Cn0KLmdseXBoaWNvbi1mb250OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDQ3IjsKfQouZ2x5cGhpY29uLWJvbGQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNDgiOwp9Ci5nbHlwaGljb24taXRhbGljOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDQ5IjsKfQouZ2x5cGhpY29uLXRleHQtaGVpZ2h0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDUwIjsKfQouZ2x5cGhpY29uLXRleHQtd2lkdGg6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNTEiOwp9Ci5nbHlwaGljb24tYWxpZ24tbGVmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA1MiI7Cn0KLmdseXBoaWNvbi1hbGlnbi1jZW50ZXI6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNTMiOwp9Ci5nbHlwaGljb24tYWxpZ24tcmlnaHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNTQiOwp9Ci5nbHlwaGljb24tYWxpZ24tanVzdGlmeTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA1NSI7Cn0KLmdseXBoaWNvbi1saXN0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDU2IjsKfQouZ2x5cGhpY29uLWluZGVudC1sZWZ0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDU3IjsKfQouZ2x5cGhpY29uLWluZGVudC1yaWdodDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA1OCI7Cn0KLmdseXBoaWNvbi1mYWNldGltZS12aWRlbzpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA1OSI7Cn0KLmdseXBoaWNvbi1waWN0dXJlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDYwIjsKfQouZ2x5cGhpY29uLW1hcC1tYXJrZXI6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNjIiOwp9Ci5nbHlwaGljb24tYWRqdXN0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDYzIjsKfQouZ2x5cGhpY29uLXRpbnQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNjQiOwp9Ci5nbHlwaGljb24tZWRpdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA2NSI7Cn0KLmdseXBoaWNvbi1zaGFyZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA2NiI7Cn0KLmdseXBoaWNvbi1jaGVjazpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA2NyI7Cn0KLmdseXBoaWNvbi1tb3ZlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDY4IjsKfQouZ2x5cGhpY29uLXN0ZXAtYmFja3dhcmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNjkiOwp9Ci5nbHlwaGljb24tZmFzdC1iYWNrd2FyZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA3MCI7Cn0KLmdseXBoaWNvbi1iYWNrd2FyZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA3MSI7Cn0KLmdseXBoaWNvbi1wbGF5OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDcyIjsKfQouZ2x5cGhpY29uLXBhdXNlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDczIjsKfQouZ2x5cGhpY29uLXN0b3A6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNzQiOwp9Ci5nbHlwaGljb24tZm9yd2FyZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA3NSI7Cn0KLmdseXBoaWNvbi1mYXN0LWZvcndhcmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwNzYiOwp9Ci5nbHlwaGljb24tc3RlcC1mb3J3YXJkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDc3IjsKfQouZ2x5cGhpY29uLWVqZWN0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDc4IjsKfQouZ2x5cGhpY29uLWNoZXZyb24tbGVmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA3OSI7Cn0KLmdseXBoaWNvbi1jaGV2cm9uLXJpZ2h0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMDgwIjsKfQouZ2x5cGhpY29uLXBsdXMtc2lnbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA4MSI7Cn0KLmdseXBoaWNvbi1taW51cy1zaWduOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDgyIjsKfQouZ2x5cGhpY29uLXJlbW92ZS1zaWduOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDgzIjsKfQouZ2x5cGhpY29uLW9rLXNpZ246YmVmb3JlIHsKICBjb250ZW50OiAiXGUwODQiOwp9Ci5nbHlwaGljb24tcXVlc3Rpb24tc2lnbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA4NSI7Cn0KLmdseXBoaWNvbi1pbmZvLXNpZ246YmVmb3JlIHsKICBjb250ZW50OiAiXGUwODYiOwp9Ci5nbHlwaGljb24tc2NyZWVuc2hvdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA4NyI7Cn0KLmdseXBoaWNvbi1yZW1vdmUtY2lyY2xlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDg4IjsKfQouZ2x5cGhpY29uLW9rLWNpcmNsZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA4OSI7Cn0KLmdseXBoaWNvbi1iYW4tY2lyY2xlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDkwIjsKfQouZ2x5cGhpY29uLWFycm93LWxlZnQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwOTEiOwp9Ci5nbHlwaGljb24tYXJyb3ctcmlnaHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwOTIiOwp9Ci5nbHlwaGljb24tYXJyb3ctdXA6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwOTMiOwp9Ci5nbHlwaGljb24tYXJyb3ctZG93bjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTA5NCI7Cn0KLmdseXBoaWNvbi1zaGFyZS1hbHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwOTUiOwp9Ci5nbHlwaGljb24tcmVzaXplLWZ1bGw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUwOTYiOwp9Ci5nbHlwaGljb24tcmVzaXplLXNtYWxsOmJlZm9yZSB7CiAgY29udGVudDogIlxlMDk3IjsKfQouZ2x5cGhpY29uLWV4Y2xhbWF0aW9uLXNpZ246YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMDEiOwp9Ci5nbHlwaGljb24tZ2lmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEwMiI7Cn0KLmdseXBoaWNvbi1sZWFmOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTAzIjsKfQouZ2x5cGhpY29uLWZpcmU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMDQiOwp9Ci5nbHlwaGljb24tZXllLW9wZW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMDUiOwp9Ci5nbHlwaGljb24tZXllLWNsb3NlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTA2IjsKfQouZ2x5cGhpY29uLXdhcm5pbmctc2lnbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEwNyI7Cn0KLmdseXBoaWNvbi1wbGFuZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEwOCI7Cn0KLmdseXBoaWNvbi1jYWxlbmRhcjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEwOSI7Cn0KLmdseXBoaWNvbi1yYW5kb206YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMTAiOwp9Ci5nbHlwaGljb24tY29tbWVudDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTExMSI7Cn0KLmdseXBoaWNvbi1tYWduZXQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMTIiOwp9Ci5nbHlwaGljb24tY2hldnJvbi11cDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTExMyI7Cn0KLmdseXBoaWNvbi1jaGV2cm9uLWRvd246YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMTQiOwp9Ci5nbHlwaGljb24tcmV0d2VldDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTExNSI7Cn0KLmdseXBoaWNvbi1zaG9wcGluZy1jYXJ0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTE2IjsKfQouZ2x5cGhpY29uLWZvbGRlci1jbG9zZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTExNyI7Cn0KLmdseXBoaWNvbi1mb2xkZXItb3BlbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTExOCI7Cn0KLmdseXBoaWNvbi1yZXNpemUtdmVydGljYWw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMTkiOwp9Ci5nbHlwaGljb24tcmVzaXplLWhvcml6b250YWw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMjAiOwp9Ci5nbHlwaGljb24taGRkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTIxIjsKfQouZ2x5cGhpY29uLWJ1bGxob3JuOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTIyIjsKfQouZ2x5cGhpY29uLWJlbGw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMjMiOwp9Ci5nbHlwaGljb24tY2VydGlmaWNhdGU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMjQiOwp9Ci5nbHlwaGljb24tdGh1bWJzLXVwOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTI1IjsKfQouZ2x5cGhpY29uLXRodW1icy1kb3duOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTI2IjsKfQouZ2x5cGhpY29uLWhhbmQtcmlnaHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMjciOwp9Ci5nbHlwaGljb24taGFuZC1sZWZ0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTI4IjsKfQouZ2x5cGhpY29uLWhhbmQtdXA6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMjkiOwp9Ci5nbHlwaGljb24taGFuZC1kb3duOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTMwIjsKfQouZ2x5cGhpY29uLWNpcmNsZS1hcnJvdy1yaWdodDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEzMSI7Cn0KLmdseXBoaWNvbi1jaXJjbGUtYXJyb3ctbGVmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEzMiI7Cn0KLmdseXBoaWNvbi1jaXJjbGUtYXJyb3ctdXA6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMzMiOwp9Ci5nbHlwaGljb24tY2lyY2xlLWFycm93LWRvd246YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMzQiOwp9Ci5nbHlwaGljb24tZ2xvYmU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMzUiOwp9Ci5nbHlwaGljb24td3JlbmNoOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTM2IjsKfQouZ2x5cGhpY29uLXRhc2tzOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTM3IjsKfQouZ2x5cGhpY29uLWZpbHRlcjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTEzOCI7Cn0KLmdseXBoaWNvbi1icmllZmNhc2U6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxMzkiOwp9Ci5nbHlwaGljb24tZnVsbHNjcmVlbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE0MCI7Cn0KLmdseXBoaWNvbi1kYXNoYm9hcmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNDEiOwp9Ci5nbHlwaGljb24tcGFwZXJjbGlwOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTQyIjsKfQouZ2x5cGhpY29uLWhlYXJ0LWVtcHR5OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTQzIjsKfQouZ2x5cGhpY29uLWxpbms6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNDQiOwp9Ci5nbHlwaGljb24tcGhvbmU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNDUiOwp9Ci5nbHlwaGljb24tcHVzaHBpbjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE0NiI7Cn0KLmdseXBoaWNvbi11c2Q6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNDgiOwp9Ci5nbHlwaGljb24tZ2JwOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTQ5IjsKfQouZ2x5cGhpY29uLXNvcnQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNTAiOwp9Ci5nbHlwaGljb24tc29ydC1ieS1hbHBoYWJldDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE1MSI7Cn0KLmdseXBoaWNvbi1zb3J0LWJ5LWFscGhhYmV0LWFsdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE1MiI7Cn0KLmdseXBoaWNvbi1zb3J0LWJ5LW9yZGVyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTUzIjsKfQouZ2x5cGhpY29uLXNvcnQtYnktb3JkZXItYWx0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTU0IjsKfQouZ2x5cGhpY29uLXNvcnQtYnktYXR0cmlidXRlczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE1NSI7Cn0KLmdseXBoaWNvbi1zb3J0LWJ5LWF0dHJpYnV0ZXMtYWx0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTU2IjsKfQouZ2x5cGhpY29uLXVuY2hlY2tlZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE1NyI7Cn0KLmdseXBoaWNvbi1leHBhbmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNTgiOwp9Ci5nbHlwaGljb24tY29sbGFwc2UtZG93bjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE1OSI7Cn0KLmdseXBoaWNvbi1jb2xsYXBzZS11cDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE2MCI7Cn0KLmdseXBoaWNvbi1sb2ctaW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNjEiOwp9Ci5nbHlwaGljb24tZmxhc2g6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNjIiOwp9Ci5nbHlwaGljb24tbG9nLW91dDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE2MyI7Cn0KLmdseXBoaWNvbi1uZXctd2luZG93OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTY0IjsKfQouZ2x5cGhpY29uLXJlY29yZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE2NSI7Cn0KLmdseXBoaWNvbi1zYXZlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTY2IjsKfQouZ2x5cGhpY29uLW9wZW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNjciOwp9Ci5nbHlwaGljb24tc2F2ZWQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNjgiOwp9Ci5nbHlwaGljb24taW1wb3J0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTY5IjsKfQouZ2x5cGhpY29uLWV4cG9ydDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE3MCI7Cn0KLmdseXBoaWNvbi1zZW5kOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTcxIjsKfQouZ2x5cGhpY29uLWZsb3BweS1kaXNrOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTcyIjsKfQouZ2x5cGhpY29uLWZsb3BweS1zYXZlZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE3MyI7Cn0KLmdseXBoaWNvbi1mbG9wcHktcmVtb3ZlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTc0IjsKfQouZ2x5cGhpY29uLWZsb3BweS1zYXZlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTc1IjsKfQouZ2x5cGhpY29uLWZsb3BweS1vcGVuOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTc2IjsKfQouZ2x5cGhpY29uLWNyZWRpdC1jYXJkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTc3IjsKfQouZ2x5cGhpY29uLXRyYW5zZmVyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTc4IjsKfQouZ2x5cGhpY29uLWN1dGxlcnk6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxNzkiOwp9Ci5nbHlwaGljb24taGVhZGVyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTgwIjsKfQouZ2x5cGhpY29uLWNvbXByZXNzZWQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxODEiOwp9Ci5nbHlwaGljb24tZWFycGhvbmU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxODIiOwp9Ci5nbHlwaGljb24tcGhvbmUtYWx0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMTgzIjsKfQouZ2x5cGhpY29uLXRvd2VyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTg0IjsKfQouZ2x5cGhpY29uLXN0YXRzOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTg1IjsKfQouZ2x5cGhpY29uLXNkLXZpZGVvOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTg2IjsKfQouZ2x5cGhpY29uLWhkLXZpZGVvOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTg3IjsKfQouZ2x5cGhpY29uLXN1YnRpdGxlczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE4OCI7Cn0KLmdseXBoaWNvbi1zb3VuZC1zdGVyZW86YmVmb3JlIHsKICBjb250ZW50OiAiXGUxODkiOwp9Ci5nbHlwaGljb24tc291bmQtZG9sYnk6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxOTAiOwp9Ci5nbHlwaGljb24tc291bmQtNS0xOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTkxIjsKfQouZ2x5cGhpY29uLXNvdW5kLTYtMTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE5MiI7Cn0KLmdseXBoaWNvbi1zb3VuZC03LTE6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxOTMiOwp9Ci5nbHlwaGljb24tY29weXJpZ2h0LW1hcms6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxOTQiOwp9Ci5nbHlwaGljb24tcmVnaXN0cmF0aW9uLW1hcms6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxOTUiOwp9Ci5nbHlwaGljb24tY2xvdWQtZG93bmxvYWQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUxOTciOwp9Ci5nbHlwaGljb24tY2xvdWQtdXBsb2FkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMTk4IjsKfQouZ2x5cGhpY29uLXRyZWUtY29uaWZlcjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTE5OSI7Cn0KLmdseXBoaWNvbi10cmVlLWRlY2lkdW91czpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIwMCI7Cn0KLmdseXBoaWNvbi1jZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIwMSI7Cn0KLmdseXBoaWNvbi1zYXZlLWZpbGU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMDIiOwp9Ci5nbHlwaGljb24tb3Blbi1maWxlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjAzIjsKfQouZ2x5cGhpY29uLWxldmVsLXVwOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjA0IjsKfQouZ2x5cGhpY29uLWNvcHk6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMDUiOwp9Ci5nbHlwaGljb24tcGFzdGU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMDYiOwp9Ci5nbHlwaGljb24tYWxlcnQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMDkiOwp9Ci5nbHlwaGljb24tZXF1YWxpemVyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjEwIjsKfQouZ2x5cGhpY29uLWtpbmc6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMTEiOwp9Ci5nbHlwaGljb24tcXVlZW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMTIiOwp9Ci5nbHlwaGljb24tcGF3bjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIxMyI7Cn0KLmdseXBoaWNvbi1iaXNob3A6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMTQiOwp9Ci5nbHlwaGljb24ta25pZ2h0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMjE1IjsKfQouZ2x5cGhpY29uLWJhYnktZm9ybXVsYTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIxNiI7Cn0KLmdseXBoaWNvbi10ZW50OmJlZm9yZSB7CiAgY29udGVudDogIlwyNmZhIjsKfQouZ2x5cGhpY29uLWJsYWNrYm9hcmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMTgiOwp9Ci5nbHlwaGljb24tYmVkOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjE5IjsKfQouZ2x5cGhpY29uLWFwcGxlOmJlZm9yZSB7CiAgY29udGVudDogIlxmOGZmIjsKfQouZ2x5cGhpY29uLWVyYXNlOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjIxIjsKfQouZ2x5cGhpY29uLWhvdXJnbGFzczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcMjMxYiI7Cn0KLmdseXBoaWNvbi1sYW1wOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjIzIjsKfQouZ2x5cGhpY29uLWR1cGxpY2F0ZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIyNCI7Cn0KLmdseXBoaWNvbi1waWdneS1iYW5rOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjI1IjsKfQouZ2x5cGhpY29uLXNjaXNzb3JzOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjI2IjsKfQouZ2x5cGhpY29uLWJpdGNvaW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMjciOwp9Ci5nbHlwaGljb24tYnRjOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjI3IjsKfQouZ2x5cGhpY29uLXhidDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIyNyI7Cn0KLmdseXBoaWNvbi15ZW46YmVmb3JlIHsKICBjb250ZW50OiAiXDAwYTUiOwp9Ci5nbHlwaGljb24tanB5OmJlZm9yZSB7CiAgY29udGVudDogIlwwMGE1IjsKfQouZ2x5cGhpY29uLXJ1YmxlOmJlZm9yZSB7CiAgY29udGVudDogIlwyMGJkIjsKfQouZ2x5cGhpY29uLXJ1YjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcMjBiZCI7Cn0KLmdseXBoaWNvbi1zY2FsZTpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIzMCI7Cn0KLmdseXBoaWNvbi1pY2UtbG9sbHk6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMzEiOwp9Ci5nbHlwaGljb24taWNlLWxvbGx5LXRhc3RlZDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIzMiI7Cn0KLmdseXBoaWNvbi1lZHVjYXRpb246YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMzMiOwp9Ci5nbHlwaGljb24tb3B0aW9uLWhvcml6b250YWw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMzQiOwp9Ci5nbHlwaGljb24tb3B0aW9uLXZlcnRpY2FsOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjM1IjsKfQouZ2x5cGhpY29uLW1lbnUtaGFtYnVyZ2VyOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjM2IjsKfQouZ2x5cGhpY29uLW1vZGFsLXdpbmRvdzpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTIzNyI7Cn0KLmdseXBoaWNvbi1vaWw6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMzgiOwp9Ci5nbHlwaGljb24tZ3JhaW46YmVmb3JlIHsKICBjb250ZW50OiAiXGUyMzkiOwp9Ci5nbHlwaGljb24tc3VuZ2xhc3NlczpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI0MCI7Cn0KLmdseXBoaWNvbi10ZXh0LXNpemU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNDEiOwp9Ci5nbHlwaGljb24tdGV4dC1jb2xvcjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI0MiI7Cn0KLmdseXBoaWNvbi10ZXh0LWJhY2tncm91bmQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNDMiOwp9Ci5nbHlwaGljb24tb2JqZWN0LWFsaWduLXRvcDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI0NCI7Cn0KLmdseXBoaWNvbi1vYmplY3QtYWxpZ24tYm90dG9tOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjQ1IjsKfQouZ2x5cGhpY29uLW9iamVjdC1hbGlnbi1ob3Jpem9udGFsOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjQ2IjsKfQouZ2x5cGhpY29uLW9iamVjdC1hbGlnbi1sZWZ0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMjQ3IjsKfQouZ2x5cGhpY29uLW9iamVjdC1hbGlnbi12ZXJ0aWNhbDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI0OCI7Cn0KLmdseXBoaWNvbi1vYmplY3QtYWxpZ24tcmlnaHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNDkiOwp9Ci5nbHlwaGljb24tdHJpYW5nbGUtcmlnaHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNTAiOwp9Ci5nbHlwaGljb24tdHJpYW5nbGUtbGVmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI1MSI7Cn0KLmdseXBoaWNvbi10cmlhbmdsZS1ib3R0b206YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNTIiOwp9Ci5nbHlwaGljb24tdHJpYW5nbGUtdG9wOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjUzIjsKfQouZ2x5cGhpY29uLWNvbnNvbGU6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNTQiOwp9Ci5nbHlwaGljb24tc3VwZXJzY3JpcHQ6YmVmb3JlIHsKICBjb250ZW50OiAiXGUyNTUiOwp9Ci5nbHlwaGljb24tc3Vic2NyaXB0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMjU2IjsKfQouZ2x5cGhpY29uLW1lbnUtbGVmdDpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI1NyI7Cn0KLmdseXBoaWNvbi1tZW51LXJpZ2h0OmJlZm9yZSB7CiAgY29udGVudDogIlxlMjU4IjsKfQouZ2x5cGhpY29uLW1lbnUtZG93bjpiZWZvcmUgewogIGNvbnRlbnQ6ICJcZTI1OSI7Cn0KLmdseXBoaWNvbi1tZW51LXVwOmJlZm9yZSB7CiAgY29udGVudDogIlxlMjYwIjsKfQoqIHsKICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKfQoqOmJlZm9yZSwKKjphZnRlciB7CiAgLXdlYmtpdC1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgIC1tb3otYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7Cn0KaHRtbCB7CiAgZm9udC1zaXplOiAxMHB4OwoKICAtd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3I6IHJnYmEoMCwgMCwgMCwgMCk7Cn0KYm9keSB7CiAgZm9udC1mYW1pbHk6ICJIZWx2ZXRpY2EgTmV1ZSIsIEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgZm9udC1zaXplOiAxNHB4OwogIGxpbmUtaGVpZ2h0OiAxLjQyODU3MTQzOwogIGNvbG9yOiAjMzMzOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KaW5wdXQsCmJ1dHRvbiwKc2VsZWN0LAp0ZXh0YXJlYSB7CiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgZm9udC1zaXplOiBpbmhlcml0OwogIGxpbmUtaGVpZ2h0OiBpbmhlcml0Owp9CmEgewogIGNvbG9yOiAjMzM3YWI3OwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQphOmhvdmVyLAphOmZvY3VzIHsKICBjb2xvcjogIzIzNTI3YzsKICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsKfQphOmZvY3VzIHsKICBvdXRsaW5lOiA1cHggYXV0byAtd2Via2l0LWZvY3VzLXJpbmctY29sb3I7CiAgb3V0bGluZS1vZmZzZXQ6IC0ycHg7Cn0KZmlndXJlIHsKICBtYXJnaW46IDA7Cn0KaW1nIHsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwp9Ci5pbWctcmVzcG9uc2l2ZSwKLnRodW1ibmFpbCA+IGltZywKLnRodW1ibmFpbCBhID4gaW1nLAouY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbSA+IGltZywKLmNhcm91c2VsLWlubmVyID4gLml0ZW0gPiBhID4gaW1nIHsKICBkaXNwbGF5OiBibG9jazsKICBtYXgtd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiBhdXRvOwp9Ci5pbWctcm91bmRlZCB7CiAgYm9yZGVyLXJhZGl1czogNnB4Owp9Ci5pbWctdGh1bWJuYWlsIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgbWF4LXdpZHRoOiAxMDAlOwogIGhlaWdodDogYXV0bzsKICBwYWRkaW5nOiA0cHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICAtd2Via2l0LXRyYW5zaXRpb246IGFsbCAuMnMgZWFzZS1pbi1vdXQ7CiAgICAgICAtby10cmFuc2l0aW9uOiBhbGwgLjJzIGVhc2UtaW4tb3V0OwogICAgICAgICAgdHJhbnNpdGlvbjogYWxsIC4ycyBlYXNlLWluLW91dDsKfQouaW1nLWNpcmNsZSB7CiAgYm9yZGVyLXJhZGl1czogNTAlOwp9CmhyIHsKICBtYXJnaW4tdG9wOiAyMHB4OwogIG1hcmdpbi1ib3R0b206IDIwcHg7CiAgYm9yZGVyOiAwOwogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZWVlOwp9Ci5zci1vbmx5IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgd2lkdGg6IDFweDsKICBoZWlnaHQ6IDFweDsKICBwYWRkaW5nOiAwOwogIG1hcmdpbjogLTFweDsKICBvdmVyZmxvdzogaGlkZGVuOwogIGNsaXA6IHJlY3QoMCwgMCwgMCwgMCk7CiAgYm9yZGVyOiAwOwp9Ci5zci1vbmx5LWZvY3VzYWJsZTphY3RpdmUsCi5zci1vbmx5LWZvY3VzYWJsZTpmb2N1cyB7CiAgcG9zaXRpb246IHN0YXRpYzsKICB3aWR0aDogYXV0bzsKICBoZWlnaHQ6IGF1dG87CiAgbWFyZ2luOiAwOwogIG92ZXJmbG93OiB2aXNpYmxlOwogIGNsaXA6IGF1dG87Cn0KW3JvbGU9ImJ1dHRvbiJdIHsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KaDEsCmgyLApoMywKaDQsCmg1LApoNiwKLmgxLAouaDIsCi5oMywKLmg0LAouaDUsCi5oNiB7CiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBsaW5lLWhlaWdodDogMS4xOwogIGNvbG9yOiBpbmhlcml0Owp9CmgxIHNtYWxsLApoMiBzbWFsbCwKaDMgc21hbGwsCmg0IHNtYWxsLApoNSBzbWFsbCwKaDYgc21hbGwsCi5oMSBzbWFsbCwKLmgyIHNtYWxsLAouaDMgc21hbGwsCi5oNCBzbWFsbCwKLmg1IHNtYWxsLAouaDYgc21hbGwsCmgxIC5zbWFsbCwKaDIgLnNtYWxsLApoMyAuc21hbGwsCmg0IC5zbWFsbCwKaDUgLnNtYWxsLApoNiAuc21hbGwsCi5oMSAuc21hbGwsCi5oMiAuc21hbGwsCi5oMyAuc21hbGwsCi5oNCAuc21hbGwsCi5oNSAuc21hbGwsCi5oNiAuc21hbGwgewogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgbGluZS1oZWlnaHQ6IDE7CiAgY29sb3I6ICM3Nzc7Cn0KaDEsCi5oMSwKaDIsCi5oMiwKaDMsCi5oMyB7CiAgbWFyZ2luLXRvcDogMjBweDsKICBtYXJnaW4tYm90dG9tOiAxMHB4Owp9CmgxIHNtYWxsLAouaDEgc21hbGwsCmgyIHNtYWxsLAouaDIgc21hbGwsCmgzIHNtYWxsLAouaDMgc21hbGwsCmgxIC5zbWFsbCwKLmgxIC5zbWFsbCwKaDIgLnNtYWxsLAouaDIgLnNtYWxsLApoMyAuc21hbGwsCi5oMyAuc21hbGwgewogIGZvbnQtc2l6ZTogNjUlOwp9Cmg0LAouaDQsCmg1LAouaDUsCmg2LAouaDYgewogIG1hcmdpbi10b3A6IDEwcHg7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQpoNCBzbWFsbCwKLmg0IHNtYWxsLApoNSBzbWFsbCwKLmg1IHNtYWxsLApoNiBzbWFsbCwKLmg2IHNtYWxsLApoNCAuc21hbGwsCi5oNCAuc21hbGwsCmg1IC5zbWFsbCwKLmg1IC5zbWFsbCwKaDYgLnNtYWxsLAouaDYgLnNtYWxsIHsKICBmb250LXNpemU6IDc1JTsKfQpoMSwKLmgxIHsKICBmb250LXNpemU6IDM2cHg7Cn0KaDIsCi5oMiB7CiAgZm9udC1zaXplOiAzMHB4Owp9CmgzLAouaDMgewogIGZvbnQtc2l6ZTogMjRweDsKfQpoNCwKLmg0IHsKICBmb250LXNpemU6IDE4cHg7Cn0KaDUsCi5oNSB7CiAgZm9udC1zaXplOiAxNHB4Owp9Cmg2LAouaDYgewogIGZvbnQtc2l6ZTogMTJweDsKfQpwIHsKICBtYXJnaW46IDAgMCAxMHB4Owp9Ci5sZWFkIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIGZvbnQtc2l6ZTogMTZweDsKICBmb250LXdlaWdodDogMzAwOwogIGxpbmUtaGVpZ2h0OiAxLjQ7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmxlYWQgewogICAgZm9udC1zaXplOiAyMXB4OwogIH0KfQpzbWFsbCwKLnNtYWxsIHsKICBmb250LXNpemU6IDg1JTsKfQptYXJrLAoubWFyayB7CiAgcGFkZGluZzogLjJlbTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmNmOGUzOwp9Ci50ZXh0LWxlZnQgewogIHRleHQtYWxpZ246IGxlZnQ7Cn0KLnRleHQtcmlnaHQgewogIHRleHQtYWxpZ246IHJpZ2h0Owp9Ci50ZXh0LWNlbnRlciB7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9Ci50ZXh0LWp1c3RpZnkgewogIHRleHQtYWxpZ246IGp1c3RpZnk7Cn0KLnRleHQtbm93cmFwIHsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9Ci50ZXh0LWxvd2VyY2FzZSB7CiAgdGV4dC10cmFuc2Zvcm06IGxvd2VyY2FzZTsKfQoudGV4dC11cHBlcmNhc2UgewogIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7Cn0KLnRleHQtY2FwaXRhbGl6ZSB7CiAgdGV4dC10cmFuc2Zvcm06IGNhcGl0YWxpemU7Cn0KLnRleHQtbXV0ZWQgewogIGNvbG9yOiAjNzc3Owp9Ci50ZXh0LXByaW1hcnkgewogIGNvbG9yOiAjMzM3YWI3Owp9CmEudGV4dC1wcmltYXJ5OmhvdmVyLAphLnRleHQtcHJpbWFyeTpmb2N1cyB7CiAgY29sb3I6ICMyODYwOTA7Cn0KLnRleHQtc3VjY2VzcyB7CiAgY29sb3I6ICMzYzc2M2Q7Cn0KYS50ZXh0LXN1Y2Nlc3M6aG92ZXIsCmEudGV4dC1zdWNjZXNzOmZvY3VzIHsKICBjb2xvcjogIzJiNTQyYzsKfQoudGV4dC1pbmZvIHsKICBjb2xvcjogIzMxNzA4ZjsKfQphLnRleHQtaW5mbzpob3ZlciwKYS50ZXh0LWluZm86Zm9jdXMgewogIGNvbG9yOiAjMjQ1MjY5Owp9Ci50ZXh0LXdhcm5pbmcgewogIGNvbG9yOiAjOGE2ZDNiOwp9CmEudGV4dC13YXJuaW5nOmhvdmVyLAphLnRleHQtd2FybmluZzpmb2N1cyB7CiAgY29sb3I6ICM2NjUxMmM7Cn0KLnRleHQtZGFuZ2VyIHsKICBjb2xvcjogI2E5NDQ0MjsKfQphLnRleHQtZGFuZ2VyOmhvdmVyLAphLnRleHQtZGFuZ2VyOmZvY3VzIHsKICBjb2xvcjogIzg0MzUzNDsKfQouYmctcHJpbWFyeSB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzN2FiNzsKfQphLmJnLXByaW1hcnk6aG92ZXIsCmEuYmctcHJpbWFyeTpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzI4NjA5MDsKfQouYmctc3VjY2VzcyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2RmZjBkODsKfQphLmJnLXN1Y2Nlc3M6aG92ZXIsCmEuYmctc3VjY2Vzczpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2MxZTJiMzsKfQouYmctaW5mbyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Q5ZWRmNzsKfQphLmJnLWluZm86aG92ZXIsCmEuYmctaW5mbzpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2FmZDllZTsKfQouYmctd2FybmluZyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZjZjhlMzsKfQphLmJnLXdhcm5pbmc6aG92ZXIsCmEuYmctd2FybmluZzpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y3ZWNiNTsKfQouYmctZGFuZ2VyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJkZWRlOwp9CmEuYmctZGFuZ2VyOmhvdmVyLAphLmJnLWRhbmdlcjpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2U0YjliOTsKfQoucGFnZS1oZWFkZXIgewogIHBhZGRpbmctYm90dG9tOiA5cHg7CiAgbWFyZ2luOiA0MHB4IDAgMjBweDsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsKfQp1bCwKb2wgewogIG1hcmdpbi10b3A6IDA7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQp1bCB1bCwKb2wgdWwsCnVsIG9sLApvbCBvbCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQoubGlzdC11bnN0eWxlZCB7CiAgcGFkZGluZy1sZWZ0OiAwOwogIGxpc3Qtc3R5bGU6IG5vbmU7Cn0KLmxpc3QtaW5saW5lIHsKICBwYWRkaW5nLWxlZnQ6IDA7CiAgbWFyZ2luLWxlZnQ6IC01cHg7CiAgbGlzdC1zdHlsZTogbm9uZTsKfQoubGlzdC1pbmxpbmUgPiBsaSB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmctcmlnaHQ6IDVweDsKICBwYWRkaW5nLWxlZnQ6IDVweDsKfQpkbCB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CmR0LApkZCB7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7Cn0KZHQgewogIGZvbnQtd2VpZ2h0OiBib2xkOwp9CmRkIHsKICBtYXJnaW4tbGVmdDogMDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAuZGwtaG9yaXpvbnRhbCBkdCB7CiAgICBmbG9hdDogbGVmdDsKICAgIHdpZHRoOiAxNjBweDsKICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICBjbGVhcjogbGVmdDsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogIH0KICAuZGwtaG9yaXpvbnRhbCBkZCB7CiAgICBtYXJnaW4tbGVmdDogMTgwcHg7CiAgfQp9CmFiYnJbdGl0bGVdLAphYmJyW2RhdGEtb3JpZ2luYWwtdGl0bGVdIHsKICBjdXJzb3I6IGhlbHA7CiAgYm9yZGVyLWJvdHRvbTogMXB4IGRvdHRlZCAjNzc3Owp9Ci5pbml0aWFsaXNtIHsKICBmb250LXNpemU6IDkwJTsKICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwp9CmJsb2NrcXVvdGUgewogIHBhZGRpbmc6IDEwcHggMjBweDsKICBtYXJnaW46IDAgMCAyMHB4OwogIGZvbnQtc2l6ZTogMTcuNXB4OwogIGJvcmRlci1sZWZ0OiA1cHggc29saWQgI2VlZTsKfQpibG9ja3F1b3RlIHA6bGFzdC1jaGlsZCwKYmxvY2txdW90ZSB1bDpsYXN0LWNoaWxkLApibG9ja3F1b3RlIG9sOmxhc3QtY2hpbGQgewogIG1hcmdpbi1ib3R0b206IDA7Cn0KYmxvY2txdW90ZSBmb290ZXIsCmJsb2NrcXVvdGUgc21hbGwsCmJsb2NrcXVvdGUgLnNtYWxsIHsKICBkaXNwbGF5OiBibG9jazsKICBmb250LXNpemU6IDgwJTsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKICBjb2xvcjogIzc3NzsKfQpibG9ja3F1b3RlIGZvb3RlcjpiZWZvcmUsCmJsb2NrcXVvdGUgc21hbGw6YmVmb3JlLApibG9ja3F1b3RlIC5zbWFsbDpiZWZvcmUgewogIGNvbnRlbnQ6ICdcMjAxNCBcMDBBMCc7Cn0KLmJsb2NrcXVvdGUtcmV2ZXJzZSwKYmxvY2txdW90ZS5wdWxsLXJpZ2h0IHsKICBwYWRkaW5nLXJpZ2h0OiAxNXB4OwogIHBhZGRpbmctbGVmdDogMDsKICB0ZXh0LWFsaWduOiByaWdodDsKICBib3JkZXItcmlnaHQ6IDVweCBzb2xpZCAjZWVlOwogIGJvcmRlci1sZWZ0OiAwOwp9Ci5ibG9ja3F1b3RlLXJldmVyc2UgZm9vdGVyOmJlZm9yZSwKYmxvY2txdW90ZS5wdWxsLXJpZ2h0IGZvb3RlcjpiZWZvcmUsCi5ibG9ja3F1b3RlLXJldmVyc2Ugc21hbGw6YmVmb3JlLApibG9ja3F1b3RlLnB1bGwtcmlnaHQgc21hbGw6YmVmb3JlLAouYmxvY2txdW90ZS1yZXZlcnNlIC5zbWFsbDpiZWZvcmUsCmJsb2NrcXVvdGUucHVsbC1yaWdodCAuc21hbGw6YmVmb3JlIHsKICBjb250ZW50OiAnJzsKfQouYmxvY2txdW90ZS1yZXZlcnNlIGZvb3RlcjphZnRlciwKYmxvY2txdW90ZS5wdWxsLXJpZ2h0IGZvb3RlcjphZnRlciwKLmJsb2NrcXVvdGUtcmV2ZXJzZSBzbWFsbDphZnRlciwKYmxvY2txdW90ZS5wdWxsLXJpZ2h0IHNtYWxsOmFmdGVyLAouYmxvY2txdW90ZS1yZXZlcnNlIC5zbWFsbDphZnRlciwKYmxvY2txdW90ZS5wdWxsLXJpZ2h0IC5zbWFsbDphZnRlciB7CiAgY29udGVudDogJ1wwMEEwIFwyMDE0JzsKfQphZGRyZXNzIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIGZvbnQtc3R5bGU6IG5vcm1hbDsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKfQpjb2RlLAprYmQsCnByZSwKc2FtcCB7CiAgZm9udC1mYW1pbHk6IE1lbmxvLCBNb25hY28sIENvbnNvbGFzLCAiQ291cmllciBOZXciLCBtb25vc3BhY2U7Cn0KY29kZSB7CiAgcGFkZGluZzogMnB4IDRweDsKICBmb250LXNpemU6IDkwJTsKICBjb2xvcjogI2M3MjU0ZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmMmY0OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQprYmQgewogIHBhZGRpbmc6IDJweCA0cHg7CiAgZm9udC1zaXplOiA5MCU7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIC0xcHggMCByZ2JhKDAsIDAsIDAsIC4yNSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIC0xcHggMCByZ2JhKDAsIDAsIDAsIC4yNSk7Cn0Ka2JkIGtiZCB7CiAgcGFkZGluZzogMDsKICBmb250LXNpemU6IDEwMCU7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwogICAgICAgICAgYm94LXNoYWRvdzogbm9uZTsKfQpwcmUgewogIGRpc3BsYXk6IGJsb2NrOwogIHBhZGRpbmc6IDkuNXB4OwogIG1hcmdpbjogMCAwIDEwcHg7CiAgZm9udC1zaXplOiAxM3B4OwogIGxpbmUtaGVpZ2h0OiAxLjQyODU3MTQzOwogIGNvbG9yOiAjMzMzOwogIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQpwcmUgY29kZSB7CiAgcGFkZGluZzogMDsKICBmb250LXNpemU6IGluaGVyaXQ7CiAgY29sb3I6IGluaGVyaXQ7CiAgd2hpdGUtc3BhY2U6IHByZS13cmFwOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJvcmRlci1yYWRpdXM6IDA7Cn0KLnByZS1zY3JvbGxhYmxlIHsKICBtYXgtaGVpZ2h0OiAzNDBweDsKICBvdmVyZmxvdy15OiBzY3JvbGw7Cn0KLmNvbnRhaW5lciB7CiAgcGFkZGluZy1yaWdodDogMTVweDsKICBwYWRkaW5nLWxlZnQ6IDE1cHg7CiAgbWFyZ2luLXJpZ2h0OiBhdXRvOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5jb250YWluZXIgewogICAgd2lkdGg6IDc1MHB4OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogOTkycHgpIHsKICAuY29udGFpbmVyIHsKICAgIHdpZHRoOiA5NzBweDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDEyMDBweCkgewogIC5jb250YWluZXIgewogICAgd2lkdGg6IDExNzBweDsKICB9Cn0KLmNvbnRhaW5lci1mbHVpZCB7CiAgcGFkZGluZy1yaWdodDogMTVweDsKICBwYWRkaW5nLWxlZnQ6IDE1cHg7CiAgbWFyZ2luLXJpZ2h0OiBhdXRvOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9Ci5yb3cgewogIG1hcmdpbi1yaWdodDogLTE1cHg7CiAgbWFyZ2luLWxlZnQ6IC0xNXB4Owp9Ci5jb2wteHMtMSwgLmNvbC1zbS0xLCAuY29sLW1kLTEsIC5jb2wtbGctMSwgLmNvbC14cy0yLCAuY29sLXNtLTIsIC5jb2wtbWQtMiwgLmNvbC1sZy0yLCAuY29sLXhzLTMsIC5jb2wtc20tMywgLmNvbC1tZC0zLCAuY29sLWxnLTMsIC5jb2wteHMtNCwgLmNvbC1zbS00LCAuY29sLW1kLTQsIC5jb2wtbGctNCwgLmNvbC14cy01LCAuY29sLXNtLTUsIC5jb2wtbWQtNSwgLmNvbC1sZy01LCAuY29sLXhzLTYsIC5jb2wtc20tNiwgLmNvbC1tZC02LCAuY29sLWxnLTYsIC5jb2wteHMtNywgLmNvbC1zbS03LCAuY29sLW1kLTcsIC5jb2wtbGctNywgLmNvbC14cy04LCAuY29sLXNtLTgsIC5jb2wtbWQtOCwgLmNvbC1sZy04LCAuY29sLXhzLTksIC5jb2wtc20tOSwgLmNvbC1tZC05LCAuY29sLWxnLTksIC5jb2wteHMtMTAsIC5jb2wtc20tMTAsIC5jb2wtbWQtMTAsIC5jb2wtbGctMTAsIC5jb2wteHMtMTEsIC5jb2wtc20tMTEsIC5jb2wtbWQtMTEsIC5jb2wtbGctMTEsIC5jb2wteHMtMTIsIC5jb2wtc20tMTIsIC5jb2wtbWQtMTIsIC5jb2wtbGctMTIgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBtaW4taGVpZ2h0OiAxcHg7CiAgcGFkZGluZy1yaWdodDogMTVweDsKICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KLmNvbC14cy0xLCAuY29sLXhzLTIsIC5jb2wteHMtMywgLmNvbC14cy00LCAuY29sLXhzLTUsIC5jb2wteHMtNiwgLmNvbC14cy03LCAuY29sLXhzLTgsIC5jb2wteHMtOSwgLmNvbC14cy0xMCwgLmNvbC14cy0xMSwgLmNvbC14cy0xMiB7CiAgZmxvYXQ6IGxlZnQ7Cn0KLmNvbC14cy0xMiB7CiAgd2lkdGg6IDEwMCU7Cn0KLmNvbC14cy0xMSB7CiAgd2lkdGg6IDkxLjY2NjY2NjY3JTsKfQouY29sLXhzLTEwIHsKICB3aWR0aDogODMuMzMzMzMzMzMlOwp9Ci5jb2wteHMtOSB7CiAgd2lkdGg6IDc1JTsKfQouY29sLXhzLTggewogIHdpZHRoOiA2Ni42NjY2NjY2NyU7Cn0KLmNvbC14cy03IHsKICB3aWR0aDogNTguMzMzMzMzMzMlOwp9Ci5jb2wteHMtNiB7CiAgd2lkdGg6IDUwJTsKfQouY29sLXhzLTUgewogIHdpZHRoOiA0MS42NjY2NjY2NyU7Cn0KLmNvbC14cy00IHsKICB3aWR0aDogMzMuMzMzMzMzMzMlOwp9Ci5jb2wteHMtMyB7CiAgd2lkdGg6IDI1JTsKfQouY29sLXhzLTIgewogIHdpZHRoOiAxNi42NjY2NjY2NyU7Cn0KLmNvbC14cy0xIHsKICB3aWR0aDogOC4zMzMzMzMzMyU7Cn0KLmNvbC14cy1wdWxsLTEyIHsKICByaWdodDogMTAwJTsKfQouY29sLXhzLXB1bGwtMTEgewogIHJpZ2h0OiA5MS42NjY2NjY2NyU7Cn0KLmNvbC14cy1wdWxsLTEwIHsKICByaWdodDogODMuMzMzMzMzMzMlOwp9Ci5jb2wteHMtcHVsbC05IHsKICByaWdodDogNzUlOwp9Ci5jb2wteHMtcHVsbC04IHsKICByaWdodDogNjYuNjY2NjY2NjclOwp9Ci5jb2wteHMtcHVsbC03IHsKICByaWdodDogNTguMzMzMzMzMzMlOwp9Ci5jb2wteHMtcHVsbC02IHsKICByaWdodDogNTAlOwp9Ci5jb2wteHMtcHVsbC01IHsKICByaWdodDogNDEuNjY2NjY2NjclOwp9Ci5jb2wteHMtcHVsbC00IHsKICByaWdodDogMzMuMzMzMzMzMzMlOwp9Ci5jb2wteHMtcHVsbC0zIHsKICByaWdodDogMjUlOwp9Ci5jb2wteHMtcHVsbC0yIHsKICByaWdodDogMTYuNjY2NjY2NjclOwp9Ci5jb2wteHMtcHVsbC0xIHsKICByaWdodDogOC4zMzMzMzMzMyU7Cn0KLmNvbC14cy1wdWxsLTAgewogIHJpZ2h0OiBhdXRvOwp9Ci5jb2wteHMtcHVzaC0xMiB7CiAgbGVmdDogMTAwJTsKfQouY29sLXhzLXB1c2gtMTEgewogIGxlZnQ6IDkxLjY2NjY2NjY3JTsKfQouY29sLXhzLXB1c2gtMTAgewogIGxlZnQ6IDgzLjMzMzMzMzMzJTsKfQouY29sLXhzLXB1c2gtOSB7CiAgbGVmdDogNzUlOwp9Ci5jb2wteHMtcHVzaC04IHsKICBsZWZ0OiA2Ni42NjY2NjY2NyU7Cn0KLmNvbC14cy1wdXNoLTcgewogIGxlZnQ6IDU4LjMzMzMzMzMzJTsKfQouY29sLXhzLXB1c2gtNiB7CiAgbGVmdDogNTAlOwp9Ci5jb2wteHMtcHVzaC01IHsKICBsZWZ0OiA0MS42NjY2NjY2NyU7Cn0KLmNvbC14cy1wdXNoLTQgewogIGxlZnQ6IDMzLjMzMzMzMzMzJTsKfQouY29sLXhzLXB1c2gtMyB7CiAgbGVmdDogMjUlOwp9Ci5jb2wteHMtcHVzaC0yIHsKICBsZWZ0OiAxNi42NjY2NjY2NyU7Cn0KLmNvbC14cy1wdXNoLTEgewogIGxlZnQ6IDguMzMzMzMzMzMlOwp9Ci5jb2wteHMtcHVzaC0wIHsKICBsZWZ0OiBhdXRvOwp9Ci5jb2wteHMtb2Zmc2V0LTEyIHsKICBtYXJnaW4tbGVmdDogMTAwJTsKfQouY29sLXhzLW9mZnNldC0xMSB7CiAgbWFyZ2luLWxlZnQ6IDkxLjY2NjY2NjY3JTsKfQouY29sLXhzLW9mZnNldC0xMCB7CiAgbWFyZ2luLWxlZnQ6IDgzLjMzMzMzMzMzJTsKfQouY29sLXhzLW9mZnNldC05IHsKICBtYXJnaW4tbGVmdDogNzUlOwp9Ci5jb2wteHMtb2Zmc2V0LTggewogIG1hcmdpbi1sZWZ0OiA2Ni42NjY2NjY2NyU7Cn0KLmNvbC14cy1vZmZzZXQtNyB7CiAgbWFyZ2luLWxlZnQ6IDU4LjMzMzMzMzMzJTsKfQouY29sLXhzLW9mZnNldC02IHsKICBtYXJnaW4tbGVmdDogNTAlOwp9Ci5jb2wteHMtb2Zmc2V0LTUgewogIG1hcmdpbi1sZWZ0OiA0MS42NjY2NjY2NyU7Cn0KLmNvbC14cy1vZmZzZXQtNCB7CiAgbWFyZ2luLWxlZnQ6IDMzLjMzMzMzMzMzJTsKfQouY29sLXhzLW9mZnNldC0zIHsKICBtYXJnaW4tbGVmdDogMjUlOwp9Ci5jb2wteHMtb2Zmc2V0LTIgewogIG1hcmdpbi1sZWZ0OiAxNi42NjY2NjY2NyU7Cn0KLmNvbC14cy1vZmZzZXQtMSB7CiAgbWFyZ2luLWxlZnQ6IDguMzMzMzMzMzMlOwp9Ci5jb2wteHMtb2Zmc2V0LTAgewogIG1hcmdpbi1sZWZ0OiAwOwp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5jb2wtc20tMSwgLmNvbC1zbS0yLCAuY29sLXNtLTMsIC5jb2wtc20tNCwgLmNvbC1zbS01LCAuY29sLXNtLTYsIC5jb2wtc20tNywgLmNvbC1zbS04LCAuY29sLXNtLTksIC5jb2wtc20tMTAsIC5jb2wtc20tMTEsIC5jb2wtc20tMTIgewogICAgZmxvYXQ6IGxlZnQ7CiAgfQogIC5jb2wtc20tMTIgewogICAgd2lkdGg6IDEwMCU7CiAgfQogIC5jb2wtc20tMTEgewogICAgd2lkdGg6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1zbS0xMCB7CiAgICB3aWR0aDogODMuMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLTkgewogICAgd2lkdGg6IDc1JTsKICB9CiAgLmNvbC1zbS04IHsKICAgIHdpZHRoOiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tNyB7CiAgICB3aWR0aDogNTguMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLTYgewogICAgd2lkdGg6IDUwJTsKICB9CiAgLmNvbC1zbS01IHsKICAgIHdpZHRoOiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tNCB7CiAgICB3aWR0aDogMzMuMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLTMgewogICAgd2lkdGg6IDI1JTsKICB9CiAgLmNvbC1zbS0yIHsKICAgIHdpZHRoOiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tMSB7CiAgICB3aWR0aDogOC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtc20tcHVsbC0xMiB7CiAgICByaWdodDogMTAwJTsKICB9CiAgLmNvbC1zbS1wdWxsLTExIHsKICAgIHJpZ2h0OiA5MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tcHVsbC0xMCB7CiAgICByaWdodDogODMuMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLXB1bGwtOSB7CiAgICByaWdodDogNzUlOwogIH0KICAuY29sLXNtLXB1bGwtOCB7CiAgICByaWdodDogNjYuNjY2NjY2NjclOwogIH0KICAuY29sLXNtLXB1bGwtNyB7CiAgICByaWdodDogNTguMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLXB1bGwtNiB7CiAgICByaWdodDogNTAlOwogIH0KICAuY29sLXNtLXB1bGwtNSB7CiAgICByaWdodDogNDEuNjY2NjY2NjclOwogIH0KICAuY29sLXNtLXB1bGwtNCB7CiAgICByaWdodDogMzMuMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLXB1bGwtMyB7CiAgICByaWdodDogMjUlOwogIH0KICAuY29sLXNtLXB1bGwtMiB7CiAgICByaWdodDogMTYuNjY2NjY2NjclOwogIH0KICAuY29sLXNtLXB1bGwtMSB7CiAgICByaWdodDogOC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtc20tcHVsbC0wIHsKICAgIHJpZ2h0OiBhdXRvOwogIH0KICAuY29sLXNtLXB1c2gtMTIgewogICAgbGVmdDogMTAwJTsKICB9CiAgLmNvbC1zbS1wdXNoLTExIHsKICAgIGxlZnQ6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1zbS1wdXNoLTEwIHsKICAgIGxlZnQ6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1wdXNoLTkgewogICAgbGVmdDogNzUlOwogIH0KICAuY29sLXNtLXB1c2gtOCB7CiAgICBsZWZ0OiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tcHVzaC03IHsKICAgIGxlZnQ6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1wdXNoLTYgewogICAgbGVmdDogNTAlOwogIH0KICAuY29sLXNtLXB1c2gtNSB7CiAgICBsZWZ0OiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tcHVzaC00IHsKICAgIGxlZnQ6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1wdXNoLTMgewogICAgbGVmdDogMjUlOwogIH0KICAuY29sLXNtLXB1c2gtMiB7CiAgICBsZWZ0OiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tcHVzaC0xIHsKICAgIGxlZnQ6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLXB1c2gtMCB7CiAgICBsZWZ0OiBhdXRvOwogIH0KICAuY29sLXNtLW9mZnNldC0xMiB7CiAgICBtYXJnaW4tbGVmdDogMTAwJTsKICB9CiAgLmNvbC1zbS1vZmZzZXQtMTEgewogICAgbWFyZ2luLWxlZnQ6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1zbS1vZmZzZXQtMTAgewogICAgbWFyZ2luLWxlZnQ6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1vZmZzZXQtOSB7CiAgICBtYXJnaW4tbGVmdDogNzUlOwogIH0KICAuY29sLXNtLW9mZnNldC04IHsKICAgIG1hcmdpbi1sZWZ0OiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tb2Zmc2V0LTcgewogICAgbWFyZ2luLWxlZnQ6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1vZmZzZXQtNiB7CiAgICBtYXJnaW4tbGVmdDogNTAlOwogIH0KICAuY29sLXNtLW9mZnNldC01IHsKICAgIG1hcmdpbi1sZWZ0OiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tb2Zmc2V0LTQgewogICAgbWFyZ2luLWxlZnQ6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1zbS1vZmZzZXQtMyB7CiAgICBtYXJnaW4tbGVmdDogMjUlOwogIH0KICAuY29sLXNtLW9mZnNldC0yIHsKICAgIG1hcmdpbi1sZWZ0OiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtc20tb2Zmc2V0LTEgewogICAgbWFyZ2luLWxlZnQ6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLXNtLW9mZnNldC0wIHsKICAgIG1hcmdpbi1sZWZ0OiAwOwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogOTkycHgpIHsKICAuY29sLW1kLTEsIC5jb2wtbWQtMiwgLmNvbC1tZC0zLCAuY29sLW1kLTQsIC5jb2wtbWQtNSwgLmNvbC1tZC02LCAuY29sLW1kLTcsIC5jb2wtbWQtOCwgLmNvbC1tZC05LCAuY29sLW1kLTEwLCAuY29sLW1kLTExLCAuY29sLW1kLTEyIHsKICAgIGZsb2F0OiBsZWZ0OwogIH0KICAuY29sLW1kLTEyIHsKICAgIHdpZHRoOiAxMDAlOwogIH0KICAuY29sLW1kLTExIHsKICAgIHdpZHRoOiA5MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbWQtMTAgewogICAgd2lkdGg6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC05IHsKICAgIHdpZHRoOiA3NSU7CiAgfQogIC5jb2wtbWQtOCB7CiAgICB3aWR0aDogNjYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLTcgewogICAgd2lkdGg6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC02IHsKICAgIHdpZHRoOiA1MCU7CiAgfQogIC5jb2wtbWQtNSB7CiAgICB3aWR0aDogNDEuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLTQgewogICAgd2lkdGg6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC0zIHsKICAgIHdpZHRoOiAyNSU7CiAgfQogIC5jb2wtbWQtMiB7CiAgICB3aWR0aDogMTYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLTEgewogICAgd2lkdGg6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLW1kLXB1bGwtMTIgewogICAgcmlnaHQ6IDEwMCU7CiAgfQogIC5jb2wtbWQtcHVsbC0xMSB7CiAgICByaWdodDogOTEuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLXB1bGwtMTAgewogICAgcmlnaHQ6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC1wdWxsLTkgewogICAgcmlnaHQ6IDc1JTsKICB9CiAgLmNvbC1tZC1wdWxsLTggewogICAgcmlnaHQ6IDY2LjY2NjY2NjY3JTsKICB9CiAgLmNvbC1tZC1wdWxsLTcgewogICAgcmlnaHQ6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC1wdWxsLTYgewogICAgcmlnaHQ6IDUwJTsKICB9CiAgLmNvbC1tZC1wdWxsLTUgewogICAgcmlnaHQ6IDQxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1tZC1wdWxsLTQgewogICAgcmlnaHQ6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC1wdWxsLTMgewogICAgcmlnaHQ6IDI1JTsKICB9CiAgLmNvbC1tZC1wdWxsLTIgewogICAgcmlnaHQ6IDE2LjY2NjY2NjY3JTsKICB9CiAgLmNvbC1tZC1wdWxsLTEgewogICAgcmlnaHQ6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLW1kLXB1bGwtMCB7CiAgICByaWdodDogYXV0bzsKICB9CiAgLmNvbC1tZC1wdXNoLTEyIHsKICAgIGxlZnQ6IDEwMCU7CiAgfQogIC5jb2wtbWQtcHVzaC0xMSB7CiAgICBsZWZ0OiA5MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbWQtcHVzaC0xMCB7CiAgICBsZWZ0OiA4My4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtcHVzaC05IHsKICAgIGxlZnQ6IDc1JTsKICB9CiAgLmNvbC1tZC1wdXNoLTggewogICAgbGVmdDogNjYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLXB1c2gtNyB7CiAgICBsZWZ0OiA1OC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtcHVzaC02IHsKICAgIGxlZnQ6IDUwJTsKICB9CiAgLmNvbC1tZC1wdXNoLTUgewogICAgbGVmdDogNDEuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLXB1c2gtNCB7CiAgICBsZWZ0OiAzMy4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtcHVzaC0zIHsKICAgIGxlZnQ6IDI1JTsKICB9CiAgLmNvbC1tZC1wdXNoLTIgewogICAgbGVmdDogMTYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLXB1c2gtMSB7CiAgICBsZWZ0OiA4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC1wdXNoLTAgewogICAgbGVmdDogYXV0bzsKICB9CiAgLmNvbC1tZC1vZmZzZXQtMTIgewogICAgbWFyZ2luLWxlZnQ6IDEwMCU7CiAgfQogIC5jb2wtbWQtb2Zmc2V0LTExIHsKICAgIG1hcmdpbi1sZWZ0OiA5MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbWQtb2Zmc2V0LTEwIHsKICAgIG1hcmdpbi1sZWZ0OiA4My4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtb2Zmc2V0LTkgewogICAgbWFyZ2luLWxlZnQ6IDc1JTsKICB9CiAgLmNvbC1tZC1vZmZzZXQtOCB7CiAgICBtYXJnaW4tbGVmdDogNjYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLW9mZnNldC03IHsKICAgIG1hcmdpbi1sZWZ0OiA1OC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtb2Zmc2V0LTYgewogICAgbWFyZ2luLWxlZnQ6IDUwJTsKICB9CiAgLmNvbC1tZC1vZmZzZXQtNSB7CiAgICBtYXJnaW4tbGVmdDogNDEuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLW9mZnNldC00IHsKICAgIG1hcmdpbi1sZWZ0OiAzMy4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbWQtb2Zmc2V0LTMgewogICAgbWFyZ2luLWxlZnQ6IDI1JTsKICB9CiAgLmNvbC1tZC1vZmZzZXQtMiB7CiAgICBtYXJnaW4tbGVmdDogMTYuNjY2NjY2NjclOwogIH0KICAuY29sLW1kLW9mZnNldC0xIHsKICAgIG1hcmdpbi1sZWZ0OiA4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1tZC1vZmZzZXQtMCB7CiAgICBtYXJnaW4tbGVmdDogMDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDEyMDBweCkgewogIC5jb2wtbGctMSwgLmNvbC1sZy0yLCAuY29sLWxnLTMsIC5jb2wtbGctNCwgLmNvbC1sZy01LCAuY29sLWxnLTYsIC5jb2wtbGctNywgLmNvbC1sZy04LCAuY29sLWxnLTksIC5jb2wtbGctMTAsIC5jb2wtbGctMTEsIC5jb2wtbGctMTIgewogICAgZmxvYXQ6IGxlZnQ7CiAgfQogIC5jb2wtbGctMTIgewogICAgd2lkdGg6IDEwMCU7CiAgfQogIC5jb2wtbGctMTEgewogICAgd2lkdGg6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1sZy0xMCB7CiAgICB3aWR0aDogODMuMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLTkgewogICAgd2lkdGg6IDc1JTsKICB9CiAgLmNvbC1sZy04IHsKICAgIHdpZHRoOiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctNyB7CiAgICB3aWR0aDogNTguMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLTYgewogICAgd2lkdGg6IDUwJTsKICB9CiAgLmNvbC1sZy01IHsKICAgIHdpZHRoOiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctNCB7CiAgICB3aWR0aDogMzMuMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLTMgewogICAgd2lkdGg6IDI1JTsKICB9CiAgLmNvbC1sZy0yIHsKICAgIHdpZHRoOiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctMSB7CiAgICB3aWR0aDogOC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbGctcHVsbC0xMiB7CiAgICByaWdodDogMTAwJTsKICB9CiAgLmNvbC1sZy1wdWxsLTExIHsKICAgIHJpZ2h0OiA5MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctcHVsbC0xMCB7CiAgICByaWdodDogODMuMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLXB1bGwtOSB7CiAgICByaWdodDogNzUlOwogIH0KICAuY29sLWxnLXB1bGwtOCB7CiAgICByaWdodDogNjYuNjY2NjY2NjclOwogIH0KICAuY29sLWxnLXB1bGwtNyB7CiAgICByaWdodDogNTguMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLXB1bGwtNiB7CiAgICByaWdodDogNTAlOwogIH0KICAuY29sLWxnLXB1bGwtNSB7CiAgICByaWdodDogNDEuNjY2NjY2NjclOwogIH0KICAuY29sLWxnLXB1bGwtNCB7CiAgICByaWdodDogMzMuMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLXB1bGwtMyB7CiAgICByaWdodDogMjUlOwogIH0KICAuY29sLWxnLXB1bGwtMiB7CiAgICByaWdodDogMTYuNjY2NjY2NjclOwogIH0KICAuY29sLWxnLXB1bGwtMSB7CiAgICByaWdodDogOC4zMzMzMzMzMyU7CiAgfQogIC5jb2wtbGctcHVsbC0wIHsKICAgIHJpZ2h0OiBhdXRvOwogIH0KICAuY29sLWxnLXB1c2gtMTIgewogICAgbGVmdDogMTAwJTsKICB9CiAgLmNvbC1sZy1wdXNoLTExIHsKICAgIGxlZnQ6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1sZy1wdXNoLTEwIHsKICAgIGxlZnQ6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1wdXNoLTkgewogICAgbGVmdDogNzUlOwogIH0KICAuY29sLWxnLXB1c2gtOCB7CiAgICBsZWZ0OiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctcHVzaC03IHsKICAgIGxlZnQ6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1wdXNoLTYgewogICAgbGVmdDogNTAlOwogIH0KICAuY29sLWxnLXB1c2gtNSB7CiAgICBsZWZ0OiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctcHVzaC00IHsKICAgIGxlZnQ6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1wdXNoLTMgewogICAgbGVmdDogMjUlOwogIH0KICAuY29sLWxnLXB1c2gtMiB7CiAgICBsZWZ0OiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctcHVzaC0xIHsKICAgIGxlZnQ6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLXB1c2gtMCB7CiAgICBsZWZ0OiBhdXRvOwogIH0KICAuY29sLWxnLW9mZnNldC0xMiB7CiAgICBtYXJnaW4tbGVmdDogMTAwJTsKICB9CiAgLmNvbC1sZy1vZmZzZXQtMTEgewogICAgbWFyZ2luLWxlZnQ6IDkxLjY2NjY2NjY3JTsKICB9CiAgLmNvbC1sZy1vZmZzZXQtMTAgewogICAgbWFyZ2luLWxlZnQ6IDgzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1vZmZzZXQtOSB7CiAgICBtYXJnaW4tbGVmdDogNzUlOwogIH0KICAuY29sLWxnLW9mZnNldC04IHsKICAgIG1hcmdpbi1sZWZ0OiA2Ni42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctb2Zmc2V0LTcgewogICAgbWFyZ2luLWxlZnQ6IDU4LjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1vZmZzZXQtNiB7CiAgICBtYXJnaW4tbGVmdDogNTAlOwogIH0KICAuY29sLWxnLW9mZnNldC01IHsKICAgIG1hcmdpbi1sZWZ0OiA0MS42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctb2Zmc2V0LTQgewogICAgbWFyZ2luLWxlZnQ6IDMzLjMzMzMzMzMzJTsKICB9CiAgLmNvbC1sZy1vZmZzZXQtMyB7CiAgICBtYXJnaW4tbGVmdDogMjUlOwogIH0KICAuY29sLWxnLW9mZnNldC0yIHsKICAgIG1hcmdpbi1sZWZ0OiAxNi42NjY2NjY2NyU7CiAgfQogIC5jb2wtbGctb2Zmc2V0LTEgewogICAgbWFyZ2luLWxlZnQ6IDguMzMzMzMzMzMlOwogIH0KICAuY29sLWxnLW9mZnNldC0wIHsKICAgIG1hcmdpbi1sZWZ0OiAwOwogIH0KfQp0YWJsZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KY2FwdGlvbiB7CiAgcGFkZGluZy10b3A6IDhweDsKICBwYWRkaW5nLWJvdHRvbTogOHB4OwogIGNvbG9yOiAjNzc3OwogIHRleHQtYWxpZ246IGxlZnQ7Cn0KdGggewogIHRleHQtYWxpZ246IGxlZnQ7Cn0KLnRhYmxlIHsKICB3aWR0aDogMTAwJTsKICBtYXgtd2lkdGg6IDEwMCU7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoudGFibGUgPiB0aGVhZCA+IHRyID4gdGgsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0aCwKLnRhYmxlID4gdGZvb3QgPiB0ciA+IHRoLAoudGFibGUgPiB0aGVhZCA+IHRyID4gdGQsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0ZCwKLnRhYmxlID4gdGZvb3QgPiB0ciA+IHRkIHsKICBwYWRkaW5nOiA4cHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgdmVydGljYWwtYWxpZ246IHRvcDsKICBib3JkZXItdG9wOiAxcHggc29saWQgI2RkZDsKfQoudGFibGUgPiB0aGVhZCA+IHRyID4gdGggewogIHZlcnRpY2FsLWFsaWduOiBib3R0b207CiAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNkZGQ7Cn0KLnRhYmxlID4gY2FwdGlvbiArIHRoZWFkID4gdHI6Zmlyc3QtY2hpbGQgPiB0aCwKLnRhYmxlID4gY29sZ3JvdXAgKyB0aGVhZCA+IHRyOmZpcnN0LWNoaWxkID4gdGgsCi50YWJsZSA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgPiB0aCwKLnRhYmxlID4gY2FwdGlvbiArIHRoZWFkID4gdHI6Zmlyc3QtY2hpbGQgPiB0ZCwKLnRhYmxlID4gY29sZ3JvdXAgKyB0aGVhZCA+IHRyOmZpcnN0LWNoaWxkID4gdGQsCi50YWJsZSA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgPiB0ZCB7CiAgYm9yZGVyLXRvcDogMDsKfQoudGFibGUgPiB0Ym9keSArIHRib2R5IHsKICBib3JkZXItdG9wOiAycHggc29saWQgI2RkZDsKfQoudGFibGUgLnRhYmxlIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwp9Ci50YWJsZS1jb25kZW5zZWQgPiB0aGVhZCA+IHRyID4gdGgsCi50YWJsZS1jb25kZW5zZWQgPiB0Ym9keSA+IHRyID4gdGgsCi50YWJsZS1jb25kZW5zZWQgPiB0Zm9vdCA+IHRyID4gdGgsCi50YWJsZS1jb25kZW5zZWQgPiB0aGVhZCA+IHRyID4gdGQsCi50YWJsZS1jb25kZW5zZWQgPiB0Ym9keSA+IHRyID4gdGQsCi50YWJsZS1jb25kZW5zZWQgPiB0Zm9vdCA+IHRyID4gdGQgewogIHBhZGRpbmc6IDVweDsKfQoudGFibGUtYm9yZGVyZWQgewogIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7Cn0KLnRhYmxlLWJvcmRlcmVkID4gdGhlYWQgPiB0ciA+IHRoLAoudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGgsCi50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0aCwKLnRhYmxlLWJvcmRlcmVkID4gdGhlYWQgPiB0ciA+IHRkLAoudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGQsCi50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0ZCB7CiAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKfQoudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyID4gdGgsCi50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0ZCB7CiAgYm9yZGVyLWJvdHRvbS13aWR0aDogMnB4Owp9Ci50YWJsZS1zdHJpcGVkID4gdGJvZHkgPiB0cjpudGgtb2YtdHlwZShvZGQpIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5Owp9Ci50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHI6aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7Cn0KdGFibGUgY29sW2NsYXNzKj0iY29sLSJdIHsKICBwb3NpdGlvbjogc3RhdGljOwogIGRpc3BsYXk6IHRhYmxlLWNvbHVtbjsKICBmbG9hdDogbm9uZTsKfQp0YWJsZSB0ZFtjbGFzcyo9ImNvbC0iXSwKdGFibGUgdGhbY2xhc3MqPSJjb2wtIl0gewogIHBvc2l0aW9uOiBzdGF0aWM7CiAgZGlzcGxheTogdGFibGUtY2VsbDsKICBmbG9hdDogbm9uZTsKfQoudGFibGUgPiB0aGVhZCA+IHRyID4gdGQuYWN0aXZlLAoudGFibGUgPiB0Ym9keSA+IHRyID4gdGQuYWN0aXZlLAoudGFibGUgPiB0Zm9vdCA+IHRyID4gdGQuYWN0aXZlLAoudGFibGUgPiB0aGVhZCA+IHRyID4gdGguYWN0aXZlLAoudGFibGUgPiB0Ym9keSA+IHRyID4gdGguYWN0aXZlLAoudGFibGUgPiB0Zm9vdCA+IHRyID4gdGguYWN0aXZlLAoudGFibGUgPiB0aGVhZCA+IHRyLmFjdGl2ZSA+IHRkLAoudGFibGUgPiB0Ym9keSA+IHRyLmFjdGl2ZSA+IHRkLAoudGFibGUgPiB0Zm9vdCA+IHRyLmFjdGl2ZSA+IHRkLAoudGFibGUgPiB0aGVhZCA+IHRyLmFjdGl2ZSA+IHRoLAoudGFibGUgPiB0Ym9keSA+IHRyLmFjdGl2ZSA+IHRoLAoudGFibGUgPiB0Zm9vdCA+IHRyLmFjdGl2ZSA+IHRoIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1Owp9Ci50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIgPiB0ZC5hY3RpdmU6aG92ZXIsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIgPiB0aC5hY3RpdmU6aG92ZXIsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIuYWN0aXZlOmhvdmVyID4gdGQsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHI6aG92ZXIgPiAuYWN0aXZlLAoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyLmFjdGl2ZTpob3ZlciA+IHRoIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZThlOGU4Owp9Ci50YWJsZSA+IHRoZWFkID4gdHIgPiB0ZC5zdWNjZXNzLAoudGFibGUgPiB0Ym9keSA+IHRyID4gdGQuc3VjY2VzcywKLnRhYmxlID4gdGZvb3QgPiB0ciA+IHRkLnN1Y2Nlc3MsCi50YWJsZSA+IHRoZWFkID4gdHIgPiB0aC5zdWNjZXNzLAoudGFibGUgPiB0Ym9keSA+IHRyID4gdGguc3VjY2VzcywKLnRhYmxlID4gdGZvb3QgPiB0ciA+IHRoLnN1Y2Nlc3MsCi50YWJsZSA+IHRoZWFkID4gdHIuc3VjY2VzcyA+IHRkLAoudGFibGUgPiB0Ym9keSA+IHRyLnN1Y2Nlc3MgPiB0ZCwKLnRhYmxlID4gdGZvb3QgPiB0ci5zdWNjZXNzID4gdGQsCi50YWJsZSA+IHRoZWFkID4gdHIuc3VjY2VzcyA+IHRoLAoudGFibGUgPiB0Ym9keSA+IHRyLnN1Y2Nlc3MgPiB0aCwKLnRhYmxlID4gdGZvb3QgPiB0ci5zdWNjZXNzID4gdGggewogIGJhY2tncm91bmQtY29sb3I6ICNkZmYwZDg7Cn0KLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ciA+IHRkLnN1Y2Nlc3M6aG92ZXIsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIgPiB0aC5zdWNjZXNzOmhvdmVyLAoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyLnN1Y2Nlc3M6aG92ZXIgPiB0ZCwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0cjpob3ZlciA+IC5zdWNjZXNzLAoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyLnN1Y2Nlc3M6aG92ZXIgPiB0aCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2QwZTljNjsKfQoudGFibGUgPiB0aGVhZCA+IHRyID4gdGQuaW5mbywKLnRhYmxlID4gdGJvZHkgPiB0ciA+IHRkLmluZm8sCi50YWJsZSA+IHRmb290ID4gdHIgPiB0ZC5pbmZvLAoudGFibGUgPiB0aGVhZCA+IHRyID4gdGguaW5mbywKLnRhYmxlID4gdGJvZHkgPiB0ciA+IHRoLmluZm8sCi50YWJsZSA+IHRmb290ID4gdHIgPiB0aC5pbmZvLAoudGFibGUgPiB0aGVhZCA+IHRyLmluZm8gPiB0ZCwKLnRhYmxlID4gdGJvZHkgPiB0ci5pbmZvID4gdGQsCi50YWJsZSA+IHRmb290ID4gdHIuaW5mbyA+IHRkLAoudGFibGUgPiB0aGVhZCA+IHRyLmluZm8gPiB0aCwKLnRhYmxlID4gdGJvZHkgPiB0ci5pbmZvID4gdGgsCi50YWJsZSA+IHRmb290ID4gdHIuaW5mbyA+IHRoIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDllZGY3Owp9Ci50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIgPiB0ZC5pbmZvOmhvdmVyLAoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyID4gdGguaW5mbzpob3ZlciwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ci5pbmZvOmhvdmVyID4gdGQsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHI6aG92ZXIgPiAuaW5mbywKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ci5pbmZvOmhvdmVyID4gdGggewogIGJhY2tncm91bmQtY29sb3I6ICNjNGUzZjM7Cn0KLnRhYmxlID4gdGhlYWQgPiB0ciA+IHRkLndhcm5pbmcsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0ZC53YXJuaW5nLAoudGFibGUgPiB0Zm9vdCA+IHRyID4gdGQud2FybmluZywKLnRhYmxlID4gdGhlYWQgPiB0ciA+IHRoLndhcm5pbmcsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0aC53YXJuaW5nLAoudGFibGUgPiB0Zm9vdCA+IHRyID4gdGgud2FybmluZywKLnRhYmxlID4gdGhlYWQgPiB0ci53YXJuaW5nID4gdGQsCi50YWJsZSA+IHRib2R5ID4gdHIud2FybmluZyA+IHRkLAoudGFibGUgPiB0Zm9vdCA+IHRyLndhcm5pbmcgPiB0ZCwKLnRhYmxlID4gdGhlYWQgPiB0ci53YXJuaW5nID4gdGgsCi50YWJsZSA+IHRib2R5ID4gdHIud2FybmluZyA+IHRoLAoudGFibGUgPiB0Zm9vdCA+IHRyLndhcm5pbmcgPiB0aCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZjZjhlMzsKfQoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyID4gdGQud2FybmluZzpob3ZlciwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ciA+IHRoLndhcm5pbmc6aG92ZXIsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIud2FybmluZzpob3ZlciA+IHRkLAoudGFibGUtaG92ZXIgPiB0Ym9keSA+IHRyOmhvdmVyID4gLndhcm5pbmcsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIud2FybmluZzpob3ZlciA+IHRoIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmFmMmNjOwp9Ci50YWJsZSA+IHRoZWFkID4gdHIgPiB0ZC5kYW5nZXIsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0ZC5kYW5nZXIsCi50YWJsZSA+IHRmb290ID4gdHIgPiB0ZC5kYW5nZXIsCi50YWJsZSA+IHRoZWFkID4gdHIgPiB0aC5kYW5nZXIsCi50YWJsZSA+IHRib2R5ID4gdHIgPiB0aC5kYW5nZXIsCi50YWJsZSA+IHRmb290ID4gdHIgPiB0aC5kYW5nZXIsCi50YWJsZSA+IHRoZWFkID4gdHIuZGFuZ2VyID4gdGQsCi50YWJsZSA+IHRib2R5ID4gdHIuZGFuZ2VyID4gdGQsCi50YWJsZSA+IHRmb290ID4gdHIuZGFuZ2VyID4gdGQsCi50YWJsZSA+IHRoZWFkID4gdHIuZGFuZ2VyID4gdGgsCi50YWJsZSA+IHRib2R5ID4gdHIuZGFuZ2VyID4gdGgsCi50YWJsZSA+IHRmb290ID4gdHIuZGFuZ2VyID4gdGggewogIGJhY2tncm91bmQtY29sb3I6ICNmMmRlZGU7Cn0KLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ciA+IHRkLmRhbmdlcjpob3ZlciwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ciA+IHRoLmRhbmdlcjpob3ZlciwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0ci5kYW5nZXI6aG92ZXIgPiB0ZCwKLnRhYmxlLWhvdmVyID4gdGJvZHkgPiB0cjpob3ZlciA+IC5kYW5nZXIsCi50YWJsZS1ob3ZlciA+IHRib2R5ID4gdHIuZGFuZ2VyOmhvdmVyID4gdGggewogIGJhY2tncm91bmQtY29sb3I6ICNlYmNjY2M7Cn0KLnRhYmxlLXJlc3BvbnNpdmUgewogIG1pbi1oZWlnaHQ6IC4wMSU7CiAgb3ZlcmZsb3cteDogYXV0bzsKfQpAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA3NjdweCkgewogIC50YWJsZS1yZXNwb25zaXZlIHsKICAgIHdpZHRoOiAxMDAlOwogICAgbWFyZ2luLWJvdHRvbTogMTVweDsKICAgIG92ZXJmbG93LXk6IGhpZGRlbjsKICAgIC1tcy1vdmVyZmxvdy1zdHlsZTogLW1zLWF1dG9oaWRpbmctc2Nyb2xsYmFyOwogICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICB9CiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgewogICAgbWFyZ2luLWJvdHRvbTogMDsKICB9CiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0aGVhZCA+IHRyID4gdGgsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0Ym9keSA+IHRyID4gdGgsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0Zm9vdCA+IHRyID4gdGgsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0aGVhZCA+IHRyID4gdGQsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0Ym9keSA+IHRyID4gdGQsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUgPiB0Zm9vdCA+IHRyID4gdGQgewogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB9CiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgewogICAgYm9yZGVyOiAwOwogIH0KICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCB7CiAgICBib3JkZXItbGVmdDogMDsKICB9CiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyID4gdGg6bGFzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0aDpsYXN0LWNoaWxkLAogIC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRoOmxhc3QtY2hpbGQsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyID4gdGQ6bGFzdC1jaGlsZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0ZDpsYXN0LWNoaWxkLAogIC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRkOmxhc3QtY2hpbGQgewogICAgYm9yZGVyLXJpZ2h0OiAwOwogIH0KICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHI6bGFzdC1jaGlsZCA+IHRoLAogIC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0cjpsYXN0LWNoaWxkID4gdGgsCiAgLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyOmxhc3QtY2hpbGQgPiB0ZCwKICAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHI6bGFzdC1jaGlsZCA+IHRkIHsKICAgIGJvcmRlci1ib3R0b206IDA7CiAgfQp9CmZpZWxkc2V0IHsKICBtaW4td2lkdGg6IDA7CiAgcGFkZGluZzogMDsKICBtYXJnaW46IDA7CiAgYm9yZGVyOiAwOwp9CmxlZ2VuZCB7CiAgZGlzcGxheTogYmxvY2s7CiAgd2lkdGg6IDEwMCU7CiAgcGFkZGluZzogMDsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIGZvbnQtc2l6ZTogMjFweDsKICBsaW5lLWhlaWdodDogaW5oZXJpdDsKICBjb2xvcjogIzMzMzsKICBib3JkZXI6IDA7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlNWU1ZTU7Cn0KbGFiZWwgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBtYXgtd2lkdGg6IDEwMCU7CiAgbWFyZ2luLWJvdHRvbTogNXB4OwogIGZvbnQtd2VpZ2h0OiBib2xkOwp9CmlucHV0W3R5cGU9InNlYXJjaCJdIHsKICAtd2Via2l0LWJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgLW1vei1ib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKfQppbnB1dFt0eXBlPSJyYWRpbyJdLAppbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICBtYXJnaW46IDRweCAwIDA7CiAgbWFyZ2luLXRvcDogMXB4IFw5OwogIGxpbmUtaGVpZ2h0OiBub3JtYWw7Cn0KaW5wdXRbdHlwZT0iZmlsZSJdIHsKICBkaXNwbGF5OiBibG9jazsKfQppbnB1dFt0eXBlPSJyYW5nZSJdIHsKICBkaXNwbGF5OiBibG9jazsKICB3aWR0aDogMTAwJTsKfQpzZWxlY3RbbXVsdGlwbGVdLApzZWxlY3Rbc2l6ZV0gewogIGhlaWdodDogYXV0bzsKfQppbnB1dFt0eXBlPSJmaWxlIl06Zm9jdXMsCmlucHV0W3R5cGU9InJhZGlvIl06Zm9jdXMsCmlucHV0W3R5cGU9ImNoZWNrYm94Il06Zm9jdXMgewogIG91dGxpbmU6IDVweCBhdXRvIC13ZWJraXQtZm9jdXMtcmluZy1jb2xvcjsKICBvdXRsaW5lLW9mZnNldDogLTJweDsKfQpvdXRwdXQgewogIGRpc3BsYXk6IGJsb2NrOwogIHBhZGRpbmctdG9wOiA3cHg7CiAgZm9udC1zaXplOiAxNHB4OwogIGxpbmUtaGVpZ2h0OiAxLjQyODU3MTQzOwogIGNvbG9yOiAjNTU1Owp9Ci5mb3JtLWNvbnRyb2wgewogIGRpc3BsYXk6IGJsb2NrOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMzRweDsKICBwYWRkaW5nOiA2cHggMTJweDsKICBmb250LXNpemU6IDE0cHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgY29sb3I6ICM1NTU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwogIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAuMDc1KTsKICAtd2Via2l0LXRyYW5zaXRpb246IGJvcmRlci1jb2xvciBlYXNlLWluLW91dCAuMTVzLCAtd2Via2l0LWJveC1zaGFkb3cgZWFzZS1pbi1vdXQgLjE1czsKICAgICAgIC1vLXRyYW5zaXRpb246IGJvcmRlci1jb2xvciBlYXNlLWluLW91dCAuMTVzLCBib3gtc2hhZG93IGVhc2UtaW4tb3V0IC4xNXM7CiAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXItY29sb3IgZWFzZS1pbi1vdXQgLjE1cywgYm94LXNoYWRvdyBlYXNlLWluLW91dCAuMTVzOwp9Ci5mb3JtLWNvbnRyb2w6Zm9jdXMgewogIGJvcmRlci1jb2xvcjogIzY2YWZlOTsKICBvdXRsaW5lOiAwOwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwwLDAsLjA3NSksIDAgMCA4cHggcmdiYSgxMDIsIDE3NSwgMjMzLCAuNik7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLDAsMCwuMDc1KSwgMCAwIDhweCByZ2JhKDEwMiwgMTc1LCAyMzMsIC42KTsKfQouZm9ybS1jb250cm9sOjotbW96LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogIzk5OTsKICBvcGFjaXR5OiAxOwp9Ci5mb3JtLWNvbnRyb2w6LW1zLWlucHV0LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogIzk5OTsKfQouZm9ybS1jb250cm9sOjotd2Via2l0LWlucHV0LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogIzk5OTsKfQouZm9ybS1jb250cm9sOjotbXMtZXhwYW5kIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBib3JkZXI6IDA7Cn0KLmZvcm0tY29udHJvbFtkaXNhYmxlZF0sCi5mb3JtLWNvbnRyb2xbcmVhZG9ubHldLApmaWVsZHNldFtkaXNhYmxlZF0gLmZvcm0tY29udHJvbCB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTsKICBvcGFjaXR5OiAxOwp9Ci5mb3JtLWNvbnRyb2xbZGlzYWJsZWRdLApmaWVsZHNldFtkaXNhYmxlZF0gLmZvcm0tY29udHJvbCB7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKfQp0ZXh0YXJlYS5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogYXV0bzsKfQppbnB1dFt0eXBlPSJzZWFyY2giXSB7CiAgLXdlYmtpdC1hcHBlYXJhbmNlOiBub25lOwp9CkBtZWRpYSBzY3JlZW4gYW5kICgtd2Via2l0LW1pbi1kZXZpY2UtcGl4ZWwtcmF0aW86IDApIHsKICBpbnB1dFt0eXBlPSJkYXRlIl0uZm9ybS1jb250cm9sLAogIGlucHV0W3R5cGU9InRpbWUiXS5mb3JtLWNvbnRyb2wsCiAgaW5wdXRbdHlwZT0iZGF0ZXRpbWUtbG9jYWwiXS5mb3JtLWNvbnRyb2wsCiAgaW5wdXRbdHlwZT0ibW9udGgiXS5mb3JtLWNvbnRyb2wgewogICAgbGluZS1oZWlnaHQ6IDM0cHg7CiAgfQogIGlucHV0W3R5cGU9ImRhdGUiXS5pbnB1dC1zbSwKICBpbnB1dFt0eXBlPSJ0aW1lIl0uaW5wdXQtc20sCiAgaW5wdXRbdHlwZT0iZGF0ZXRpbWUtbG9jYWwiXS5pbnB1dC1zbSwKICBpbnB1dFt0eXBlPSJtb250aCJdLmlucHV0LXNtLAogIC5pbnB1dC1ncm91cC1zbSBpbnB1dFt0eXBlPSJkYXRlIl0sCiAgLmlucHV0LWdyb3VwLXNtIGlucHV0W3R5cGU9InRpbWUiXSwKICAuaW5wdXQtZ3JvdXAtc20gaW5wdXRbdHlwZT0iZGF0ZXRpbWUtbG9jYWwiXSwKICAuaW5wdXQtZ3JvdXAtc20gaW5wdXRbdHlwZT0ibW9udGgiXSB7CiAgICBsaW5lLWhlaWdodDogMzBweDsKICB9CiAgaW5wdXRbdHlwZT0iZGF0ZSJdLmlucHV0LWxnLAogIGlucHV0W3R5cGU9InRpbWUiXS5pbnB1dC1sZywKICBpbnB1dFt0eXBlPSJkYXRldGltZS1sb2NhbCJdLmlucHV0LWxnLAogIGlucHV0W3R5cGU9Im1vbnRoIl0uaW5wdXQtbGcsCiAgLmlucHV0LWdyb3VwLWxnIGlucHV0W3R5cGU9ImRhdGUiXSwKICAuaW5wdXQtZ3JvdXAtbGcgaW5wdXRbdHlwZT0idGltZSJdLAogIC5pbnB1dC1ncm91cC1sZyBpbnB1dFt0eXBlPSJkYXRldGltZS1sb2NhbCJdLAogIC5pbnB1dC1ncm91cC1sZyBpbnB1dFt0eXBlPSJtb250aCJdIHsKICAgIGxpbmUtaGVpZ2h0OiA0NnB4OwogIH0KfQouZm9ybS1ncm91cCB7CiAgbWFyZ2luLWJvdHRvbTogMTVweDsKfQoucmFkaW8sCi5jaGVja2JveCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGJsb2NrOwogIG1hcmdpbi10b3A6IDEwcHg7CiAgbWFyZ2luLWJvdHRvbTogMTBweDsKfQoucmFkaW8gbGFiZWwsCi5jaGVja2JveCBsYWJlbCB7CiAgbWluLWhlaWdodDogMjBweDsKICBwYWRkaW5nLWxlZnQ6IDIwcHg7CiAgbWFyZ2luLWJvdHRvbTogMDsKICBmb250LXdlaWdodDogbm9ybWFsOwogIGN1cnNvcjogcG9pbnRlcjsKfQoucmFkaW8gaW5wdXRbdHlwZT0icmFkaW8iXSwKLnJhZGlvLWlubGluZSBpbnB1dFt0eXBlPSJyYWRpbyJdLAouY2hlY2tib3ggaW5wdXRbdHlwZT0iY2hlY2tib3giXSwKLmNoZWNrYm94LWlubGluZSBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgbWFyZ2luLXRvcDogNHB4IFw5OwogIG1hcmdpbi1sZWZ0OiAtMjBweDsKfQoucmFkaW8gKyAucmFkaW8sCi5jaGVja2JveCArIC5jaGVja2JveCB7CiAgbWFyZ2luLXRvcDogLTVweDsKfQoucmFkaW8taW5saW5lLAouY2hlY2tib3gtaW5saW5lIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmctbGVmdDogMjBweDsKICBtYXJnaW4tYm90dG9tOiAwOwogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KLnJhZGlvLWlubGluZSArIC5yYWRpby1pbmxpbmUsCi5jaGVja2JveC1pbmxpbmUgKyAuY2hlY2tib3gtaW5saW5lIHsKICBtYXJnaW4tdG9wOiAwOwogIG1hcmdpbi1sZWZ0OiAxMHB4Owp9CmlucHV0W3R5cGU9InJhZGlvIl1bZGlzYWJsZWRdLAppbnB1dFt0eXBlPSJjaGVja2JveCJdW2Rpc2FibGVkXSwKaW5wdXRbdHlwZT0icmFkaW8iXS5kaXNhYmxlZCwKaW5wdXRbdHlwZT0iY2hlY2tib3giXS5kaXNhYmxlZCwKZmllbGRzZXRbZGlzYWJsZWRdIGlucHV0W3R5cGU9InJhZGlvIl0sCmZpZWxkc2V0W2Rpc2FibGVkXSBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICBjdXJzb3I6IG5vdC1hbGxvd2VkOwp9Ci5yYWRpby1pbmxpbmUuZGlzYWJsZWQsCi5jaGVja2JveC1pbmxpbmUuZGlzYWJsZWQsCmZpZWxkc2V0W2Rpc2FibGVkXSAucmFkaW8taW5saW5lLApmaWVsZHNldFtkaXNhYmxlZF0gLmNoZWNrYm94LWlubGluZSB7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKfQoucmFkaW8uZGlzYWJsZWQgbGFiZWwsCi5jaGVja2JveC5kaXNhYmxlZCBsYWJlbCwKZmllbGRzZXRbZGlzYWJsZWRdIC5yYWRpbyBsYWJlbCwKZmllbGRzZXRbZGlzYWJsZWRdIC5jaGVja2JveCBsYWJlbCB7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKfQouZm9ybS1jb250cm9sLXN0YXRpYyB7CiAgbWluLWhlaWdodDogMzRweDsKICBwYWRkaW5nLXRvcDogN3B4OwogIHBhZGRpbmctYm90dG9tOiA3cHg7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQouZm9ybS1jb250cm9sLXN0YXRpYy5pbnB1dC1sZywKLmZvcm0tY29udHJvbC1zdGF0aWMuaW5wdXQtc20gewogIHBhZGRpbmctcmlnaHQ6IDA7CiAgcGFkZGluZy1sZWZ0OiAwOwp9Ci5pbnB1dC1zbSB7CiAgaGVpZ2h0OiAzMHB4OwogIHBhZGRpbmc6IDVweCAxMHB4OwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogMS41OwogIGJvcmRlci1yYWRpdXM6IDNweDsKfQpzZWxlY3QuaW5wdXQtc20gewogIGhlaWdodDogMzBweDsKICBsaW5lLWhlaWdodDogMzBweDsKfQp0ZXh0YXJlYS5pbnB1dC1zbSwKc2VsZWN0W211bHRpcGxlXS5pbnB1dC1zbSB7CiAgaGVpZ2h0OiBhdXRvOwp9Ci5mb3JtLWdyb3VwLXNtIC5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogMzBweDsKICBwYWRkaW5nOiA1cHggMTBweDsKICBmb250LXNpemU6IDEycHg7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBib3JkZXItcmFkaXVzOiAzcHg7Cn0KLmZvcm0tZ3JvdXAtc20gc2VsZWN0LmZvcm0tY29udHJvbCB7CiAgaGVpZ2h0OiAzMHB4OwogIGxpbmUtaGVpZ2h0OiAzMHB4Owp9Ci5mb3JtLWdyb3VwLXNtIHRleHRhcmVhLmZvcm0tY29udHJvbCwKLmZvcm0tZ3JvdXAtc20gc2VsZWN0W211bHRpcGxlXS5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogYXV0bzsKfQouZm9ybS1ncm91cC1zbSAuZm9ybS1jb250cm9sLXN0YXRpYyB7CiAgaGVpZ2h0OiAzMHB4OwogIG1pbi1oZWlnaHQ6IDMycHg7CiAgcGFkZGluZzogNnB4IDEwcHg7CiAgZm9udC1zaXplOiAxMnB4OwogIGxpbmUtaGVpZ2h0OiAxLjU7Cn0KLmlucHV0LWxnIHsKICBoZWlnaHQ6IDQ2cHg7CiAgcGFkZGluZzogMTBweCAxNnB4OwogIGZvbnQtc2l6ZTogMThweDsKICBsaW5lLWhlaWdodDogMS4zMzMzMzMzOwogIGJvcmRlci1yYWRpdXM6IDZweDsKfQpzZWxlY3QuaW5wdXQtbGcgewogIGhlaWdodDogNDZweDsKICBsaW5lLWhlaWdodDogNDZweDsKfQp0ZXh0YXJlYS5pbnB1dC1sZywKc2VsZWN0W211bHRpcGxlXS5pbnB1dC1sZyB7CiAgaGVpZ2h0OiBhdXRvOwp9Ci5mb3JtLWdyb3VwLWxnIC5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogNDZweDsKICBwYWRkaW5nOiAxMHB4IDE2cHg7CiAgZm9udC1zaXplOiAxOHB4OwogIGxpbmUtaGVpZ2h0OiAxLjMzMzMzMzM7CiAgYm9yZGVyLXJhZGl1czogNnB4Owp9Ci5mb3JtLWdyb3VwLWxnIHNlbGVjdC5mb3JtLWNvbnRyb2wgewogIGhlaWdodDogNDZweDsKICBsaW5lLWhlaWdodDogNDZweDsKfQouZm9ybS1ncm91cC1sZyB0ZXh0YXJlYS5mb3JtLWNvbnRyb2wsCi5mb3JtLWdyb3VwLWxnIHNlbGVjdFttdWx0aXBsZV0uZm9ybS1jb250cm9sIHsKICBoZWlnaHQ6IGF1dG87Cn0KLmZvcm0tZ3JvdXAtbGcgLmZvcm0tY29udHJvbC1zdGF0aWMgewogIGhlaWdodDogNDZweDsKICBtaW4taGVpZ2h0OiAzOHB4OwogIHBhZGRpbmc6IDExcHggMTZweDsKICBmb250LXNpemU6IDE4cHg7CiAgbGluZS1oZWlnaHQ6IDEuMzMzMzMzMzsKfQouaGFzLWZlZWRiYWNrIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLmhhcy1mZWVkYmFjayAuZm9ybS1jb250cm9sIHsKICBwYWRkaW5nLXJpZ2h0OiA0Mi41cHg7Cn0KLmZvcm0tY29udHJvbC1mZWVkYmFjayB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMDsKICByaWdodDogMDsKICB6LWluZGV4OiAyOwogIGRpc3BsYXk6IGJsb2NrOwogIHdpZHRoOiAzNHB4OwogIGhlaWdodDogMzRweDsKICBsaW5lLWhlaWdodDogMzRweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgcG9pbnRlci1ldmVudHM6IG5vbmU7Cn0KLmlucHV0LWxnICsgLmZvcm0tY29udHJvbC1mZWVkYmFjaywKLmlucHV0LWdyb3VwLWxnICsgLmZvcm0tY29udHJvbC1mZWVkYmFjaywKLmZvcm0tZ3JvdXAtbGcgLmZvcm0tY29udHJvbCArIC5mb3JtLWNvbnRyb2wtZmVlZGJhY2sgewogIHdpZHRoOiA0NnB4OwogIGhlaWdodDogNDZweDsKICBsaW5lLWhlaWdodDogNDZweDsKfQouaW5wdXQtc20gKyAuZm9ybS1jb250cm9sLWZlZWRiYWNrLAouaW5wdXQtZ3JvdXAtc20gKyAuZm9ybS1jb250cm9sLWZlZWRiYWNrLAouZm9ybS1ncm91cC1zbSAuZm9ybS1jb250cm9sICsgLmZvcm0tY29udHJvbC1mZWVkYmFjayB7CiAgd2lkdGg6IDMwcHg7CiAgaGVpZ2h0OiAzMHB4OwogIGxpbmUtaGVpZ2h0OiAzMHB4Owp9Ci5oYXMtc3VjY2VzcyAuaGVscC1ibG9jaywKLmhhcy1zdWNjZXNzIC5jb250cm9sLWxhYmVsLAouaGFzLXN1Y2Nlc3MgLnJhZGlvLAouaGFzLXN1Y2Nlc3MgLmNoZWNrYm94LAouaGFzLXN1Y2Nlc3MgLnJhZGlvLWlubGluZSwKLmhhcy1zdWNjZXNzIC5jaGVja2JveC1pbmxpbmUsCi5oYXMtc3VjY2Vzcy5yYWRpbyBsYWJlbCwKLmhhcy1zdWNjZXNzLmNoZWNrYm94IGxhYmVsLAouaGFzLXN1Y2Nlc3MucmFkaW8taW5saW5lIGxhYmVsLAouaGFzLXN1Y2Nlc3MuY2hlY2tib3gtaW5saW5lIGxhYmVsIHsKICBjb2xvcjogIzNjNzYzZDsKfQouaGFzLXN1Y2Nlc3MgLmZvcm0tY29udHJvbCB7CiAgYm9yZGVyLWNvbG9yOiAjM2M3NjNkOwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAuMDc1KTsKfQouaGFzLXN1Y2Nlc3MgLmZvcm0tY29udHJvbDpmb2N1cyB7CiAgYm9yZGVyLWNvbG9yOiAjMmI1NDJjOwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSksIDAgMCA2cHggIzY3YjE2ODsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNzUpLCAwIDAgNnB4ICM2N2IxNjg7Cn0KLmhhcy1zdWNjZXNzIC5pbnB1dC1ncm91cC1hZGRvbiB7CiAgY29sb3I6ICMzYzc2M2Q7CiAgYmFja2dyb3VuZC1jb2xvcjogI2RmZjBkODsKICBib3JkZXItY29sb3I6ICMzYzc2M2Q7Cn0KLmhhcy1zdWNjZXNzIC5mb3JtLWNvbnRyb2wtZmVlZGJhY2sgewogIGNvbG9yOiAjM2M3NjNkOwp9Ci5oYXMtd2FybmluZyAuaGVscC1ibG9jaywKLmhhcy13YXJuaW5nIC5jb250cm9sLWxhYmVsLAouaGFzLXdhcm5pbmcgLnJhZGlvLAouaGFzLXdhcm5pbmcgLmNoZWNrYm94LAouaGFzLXdhcm5pbmcgLnJhZGlvLWlubGluZSwKLmhhcy13YXJuaW5nIC5jaGVja2JveC1pbmxpbmUsCi5oYXMtd2FybmluZy5yYWRpbyBsYWJlbCwKLmhhcy13YXJuaW5nLmNoZWNrYm94IGxhYmVsLAouaGFzLXdhcm5pbmcucmFkaW8taW5saW5lIGxhYmVsLAouaGFzLXdhcm5pbmcuY2hlY2tib3gtaW5saW5lIGxhYmVsIHsKICBjb2xvcjogIzhhNmQzYjsKfQouaGFzLXdhcm5pbmcgLmZvcm0tY29udHJvbCB7CiAgYm9yZGVyLWNvbG9yOiAjOGE2ZDNiOwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAuMDc1KTsKfQouaGFzLXdhcm5pbmcgLmZvcm0tY29udHJvbDpmb2N1cyB7CiAgYm9yZGVyLWNvbG9yOiAjNjY1MTJjOwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSksIDAgMCA2cHggI2MwYTE2YjsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNzUpLCAwIDAgNnB4ICNjMGExNmI7Cn0KLmhhcy13YXJuaW5nIC5pbnB1dC1ncm91cC1hZGRvbiB7CiAgY29sb3I6ICM4YTZkM2I7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZjZjhlMzsKICBib3JkZXItY29sb3I6ICM4YTZkM2I7Cn0KLmhhcy13YXJuaW5nIC5mb3JtLWNvbnRyb2wtZmVlZGJhY2sgewogIGNvbG9yOiAjOGE2ZDNiOwp9Ci5oYXMtZXJyb3IgLmhlbHAtYmxvY2ssCi5oYXMtZXJyb3IgLmNvbnRyb2wtbGFiZWwsCi5oYXMtZXJyb3IgLnJhZGlvLAouaGFzLWVycm9yIC5jaGVja2JveCwKLmhhcy1lcnJvciAucmFkaW8taW5saW5lLAouaGFzLWVycm9yIC5jaGVja2JveC1pbmxpbmUsCi5oYXMtZXJyb3IucmFkaW8gbGFiZWwsCi5oYXMtZXJyb3IuY2hlY2tib3ggbGFiZWwsCi5oYXMtZXJyb3IucmFkaW8taW5saW5lIGxhYmVsLAouaGFzLWVycm9yLmNoZWNrYm94LWlubGluZSBsYWJlbCB7CiAgY29sb3I6ICNhOTQ0NDI7Cn0KLmhhcy1lcnJvciAuZm9ybS1jb250cm9sIHsKICBib3JkZXItY29sb3I6ICNhOTQ0NDI7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAuMDc1KTsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNzUpOwp9Ci5oYXMtZXJyb3IgLmZvcm0tY29udHJvbDpmb2N1cyB7CiAgYm9yZGVyLWNvbG9yOiAjODQzNTM0OwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA3NSksIDAgMCA2cHggI2NlODQ4MzsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNzUpLCAwIDAgNnB4ICNjZTg0ODM7Cn0KLmhhcy1lcnJvciAuaW5wdXQtZ3JvdXAtYWRkb24gewogIGNvbG9yOiAjYTk0NDQyOwogIGJhY2tncm91bmQtY29sb3I6ICNmMmRlZGU7CiAgYm9yZGVyLWNvbG9yOiAjYTk0NDQyOwp9Ci5oYXMtZXJyb3IgLmZvcm0tY29udHJvbC1mZWVkYmFjayB7CiAgY29sb3I6ICNhOTQ0NDI7Cn0KLmhhcy1mZWVkYmFjayBsYWJlbCB+IC5mb3JtLWNvbnRyb2wtZmVlZGJhY2sgewogIHRvcDogMjVweDsKfQouaGFzLWZlZWRiYWNrIGxhYmVsLnNyLW9ubHkgfiAuZm9ybS1jb250cm9sLWZlZWRiYWNrIHsKICB0b3A6IDA7Cn0KLmhlbHAtYmxvY2sgewogIGRpc3BsYXk6IGJsb2NrOwogIG1hcmdpbi10b3A6IDVweDsKICBtYXJnaW4tYm90dG9tOiAxMHB4OwogIGNvbG9yOiAjNzM3MzczOwp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5mb3JtLWlubGluZSAuZm9ybS1ncm91cCB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICBtYXJnaW4tYm90dG9tOiAwOwogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICB9CiAgLmZvcm0taW5saW5lIC5mb3JtLWNvbnRyb2wgewogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgd2lkdGg6IGF1dG87CiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogIH0KICAuZm9ybS1pbmxpbmUgLmZvcm0tY29udHJvbC1zdGF0aWMgewogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIH0KICAuZm9ybS1pbmxpbmUgLmlucHV0LWdyb3VwIHsKICAgIGRpc3BsYXk6IGlubGluZS10YWJsZTsKICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgfQogIC5mb3JtLWlubGluZSAuaW5wdXQtZ3JvdXAgLmlucHV0LWdyb3VwLWFkZG9uLAogIC5mb3JtLWlubGluZSAuaW5wdXQtZ3JvdXAgLmlucHV0LWdyb3VwLWJ0biwKICAuZm9ybS1pbmxpbmUgLmlucHV0LWdyb3VwIC5mb3JtLWNvbnRyb2wgewogICAgd2lkdGg6IGF1dG87CiAgfQogIC5mb3JtLWlubGluZSAuaW5wdXQtZ3JvdXAgPiAuZm9ybS1jb250cm9sIHsKICAgIHdpZHRoOiAxMDAlOwogIH0KICAuZm9ybS1pbmxpbmUgLmNvbnRyb2wtbGFiZWwgewogICAgbWFyZ2luLWJvdHRvbTogMDsKICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgfQogIC5mb3JtLWlubGluZSAucmFkaW8sCiAgLmZvcm0taW5saW5lIC5jaGVja2JveCB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICBtYXJnaW4tdG9wOiAwOwogICAgbWFyZ2luLWJvdHRvbTogMDsKICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgfQogIC5mb3JtLWlubGluZSAucmFkaW8gbGFiZWwsCiAgLmZvcm0taW5saW5lIC5jaGVja2JveCBsYWJlbCB7CiAgICBwYWRkaW5nLWxlZnQ6IDA7CiAgfQogIC5mb3JtLWlubGluZSAucmFkaW8gaW5wdXRbdHlwZT0icmFkaW8iXSwKICAuZm9ybS1pbmxpbmUgLmNoZWNrYm94IGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgbWFyZ2luLWxlZnQ6IDA7CiAgfQogIC5mb3JtLWlubGluZSAuaGFzLWZlZWRiYWNrIC5mb3JtLWNvbnRyb2wtZmVlZGJhY2sgewogICAgdG9wOiAwOwogIH0KfQouZm9ybS1ob3Jpem9udGFsIC5yYWRpbywKLmZvcm0taG9yaXpvbnRhbCAuY2hlY2tib3gsCi5mb3JtLWhvcml6b250YWwgLnJhZGlvLWlubGluZSwKLmZvcm0taG9yaXpvbnRhbCAuY2hlY2tib3gtaW5saW5lIHsKICBwYWRkaW5nLXRvcDogN3B4OwogIG1hcmdpbi10b3A6IDA7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQouZm9ybS1ob3Jpem9udGFsIC5yYWRpbywKLmZvcm0taG9yaXpvbnRhbCAuY2hlY2tib3ggewogIG1pbi1oZWlnaHQ6IDI3cHg7Cn0KLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1ncm91cCB7CiAgbWFyZ2luLXJpZ2h0OiAtMTVweDsKICBtYXJnaW4tbGVmdDogLTE1cHg7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmZvcm0taG9yaXpvbnRhbCAuY29udHJvbC1sYWJlbCB7CiAgICBwYWRkaW5nLXRvcDogN3B4OwogICAgbWFyZ2luLWJvdHRvbTogMDsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwogIH0KfQouZm9ybS1ob3Jpem9udGFsIC5oYXMtZmVlZGJhY2sgLmZvcm0tY29udHJvbC1mZWVkYmFjayB7CiAgcmlnaHQ6IDE1cHg7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1ncm91cC1sZyAuY29udHJvbC1sYWJlbCB7CiAgICBwYWRkaW5nLXRvcDogMTFweDsKICAgIGZvbnQtc2l6ZTogMThweDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1ncm91cC1zbSAuY29udHJvbC1sYWJlbCB7CiAgICBwYWRkaW5nLXRvcDogNnB4OwogICAgZm9udC1zaXplOiAxMnB4OwogIH0KfQouYnRuIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgcGFkZGluZzogNnB4IDEycHg7CiAgbWFyZ2luLWJvdHRvbTogMDsKICBmb250LXNpemU6IDE0cHg7CiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogIC1tcy10b3VjaC1hY3Rpb246IG1hbmlwdWxhdGlvbjsKICAgICAgdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247CiAgY3Vyc29yOiBwb2ludGVyOwogIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOwogICAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLmJ0bjpmb2N1cywKLmJ0bjphY3RpdmU6Zm9jdXMsCi5idG4uYWN0aXZlOmZvY3VzLAouYnRuLmZvY3VzLAouYnRuOmFjdGl2ZS5mb2N1cywKLmJ0bi5hY3RpdmUuZm9jdXMgewogIG91dGxpbmU6IDVweCBhdXRvIC13ZWJraXQtZm9jdXMtcmluZy1jb2xvcjsKICBvdXRsaW5lLW9mZnNldDogLTJweDsKfQouYnRuOmhvdmVyLAouYnRuOmZvY3VzLAouYnRuLmZvY3VzIHsKICBjb2xvcjogIzMzMzsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KLmJ0bjphY3RpdmUsCi5idG4uYWN0aXZlIHsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwogIG91dGxpbmU6IDA7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAuMTI1KTsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgM3B4IDVweCByZ2JhKDAsIDAsIDAsIC4xMjUpOwp9Ci5idG4uZGlzYWJsZWQsCi5idG5bZGlzYWJsZWRdLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0biB7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NjUpOwogIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZTsKICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgb3BhY2l0eTogLjY1Owp9CmEuYnRuLmRpc2FibGVkLApmaWVsZHNldFtkaXNhYmxlZF0gYS5idG4gewogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9Ci5idG4tZGVmYXVsdCB7CiAgY29sb3I6ICMzMzM7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXItY29sb3I6ICNjY2M7Cn0KLmJ0bi1kZWZhdWx0OmZvY3VzLAouYnRuLWRlZmF1bHQuZm9jdXMgewogIGNvbG9yOiAjMzMzOwogIGJhY2tncm91bmQtY29sb3I6ICNlNmU2ZTY7CiAgYm9yZGVyLWNvbG9yOiAjOGM4YzhjOwp9Ci5idG4tZGVmYXVsdDpob3ZlciB7CiAgY29sb3I6ICMzMzM7CiAgYmFja2dyb3VuZC1jb2xvcjogI2U2ZTZlNjsKICBib3JkZXItY29sb3I6ICNhZGFkYWQ7Cn0KLmJ0bi1kZWZhdWx0OmFjdGl2ZSwKLmJ0bi1kZWZhdWx0LmFjdGl2ZSwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1kZWZhdWx0IHsKICBjb2xvcjogIzMzMzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTZlNmU2OwogIGJvcmRlci1jb2xvcjogI2FkYWRhZDsKfQouYnRuLWRlZmF1bHQ6YWN0aXZlOmhvdmVyLAouYnRuLWRlZmF1bHQuYWN0aXZlOmhvdmVyLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWRlZmF1bHQ6aG92ZXIsCi5idG4tZGVmYXVsdDphY3RpdmU6Zm9jdXMsCi5idG4tZGVmYXVsdC5hY3RpdmU6Zm9jdXMsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tZGVmYXVsdDpmb2N1cywKLmJ0bi1kZWZhdWx0OmFjdGl2ZS5mb2N1cywKLmJ0bi1kZWZhdWx0LmFjdGl2ZS5mb2N1cywKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1kZWZhdWx0LmZvY3VzIHsKICBjb2xvcjogIzMzMzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDRkNGQ0OwogIGJvcmRlci1jb2xvcjogIzhjOGM4YzsKfQouYnRuLWRlZmF1bHQ6YWN0aXZlLAouYnRuLWRlZmF1bHQuYWN0aXZlLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWRlZmF1bHQgewogIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7Cn0KLmJ0bi1kZWZhdWx0LmRpc2FibGVkOmhvdmVyLAouYnRuLWRlZmF1bHRbZGlzYWJsZWRdOmhvdmVyLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kZWZhdWx0OmhvdmVyLAouYnRuLWRlZmF1bHQuZGlzYWJsZWQ6Zm9jdXMsCi5idG4tZGVmYXVsdFtkaXNhYmxlZF06Zm9jdXMsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWRlZmF1bHQ6Zm9jdXMsCi5idG4tZGVmYXVsdC5kaXNhYmxlZC5mb2N1cywKLmJ0bi1kZWZhdWx0W2Rpc2FibGVkXS5mb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tZGVmYXVsdC5mb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXItY29sb3I6ICNjY2M7Cn0KLmJ0bi1kZWZhdWx0IC5iYWRnZSB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKfQouYnRuLXByaW1hcnkgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLWNvbG9yOiAjMmU2ZGE0Owp9Ci5idG4tcHJpbWFyeTpmb2N1cywKLmJ0bi1wcmltYXJ5LmZvY3VzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjg2MDkwOwogIGJvcmRlci1jb2xvcjogIzEyMmI0MDsKfQouYnRuLXByaW1hcnk6aG92ZXIgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMyODYwOTA7CiAgYm9yZGVyLWNvbG9yOiAjMjA0ZDc0Owp9Ci5idG4tcHJpbWFyeTphY3RpdmUsCi5idG4tcHJpbWFyeS5hY3RpdmUsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tcHJpbWFyeSB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzI4NjA5MDsKICBib3JkZXItY29sb3I6ICMyMDRkNzQ7Cn0KLmJ0bi1wcmltYXJ5OmFjdGl2ZTpob3ZlciwKLmJ0bi1wcmltYXJ5LmFjdGl2ZTpob3ZlciwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1wcmltYXJ5OmhvdmVyLAouYnRuLXByaW1hcnk6YWN0aXZlOmZvY3VzLAouYnRuLXByaW1hcnkuYWN0aXZlOmZvY3VzLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLXByaW1hcnk6Zm9jdXMsCi5idG4tcHJpbWFyeTphY3RpdmUuZm9jdXMsCi5idG4tcHJpbWFyeS5hY3RpdmUuZm9jdXMsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tcHJpbWFyeS5mb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzIwNGQ3NDsKICBib3JkZXItY29sb3I6ICMxMjJiNDA7Cn0KLmJ0bi1wcmltYXJ5OmFjdGl2ZSwKLmJ0bi1wcmltYXJ5LmFjdGl2ZSwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1wcmltYXJ5IHsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwp9Ci5idG4tcHJpbWFyeS5kaXNhYmxlZDpob3ZlciwKLmJ0bi1wcmltYXJ5W2Rpc2FibGVkXTpob3ZlciwKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tcHJpbWFyeTpob3ZlciwKLmJ0bi1wcmltYXJ5LmRpc2FibGVkOmZvY3VzLAouYnRuLXByaW1hcnlbZGlzYWJsZWRdOmZvY3VzLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1wcmltYXJ5OmZvY3VzLAouYnRuLXByaW1hcnkuZGlzYWJsZWQuZm9jdXMsCi5idG4tcHJpbWFyeVtkaXNhYmxlZF0uZm9jdXMsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXByaW1hcnkuZm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLWNvbG9yOiAjMmU2ZGE0Owp9Ci5idG4tcHJpbWFyeSAuYmFkZ2UgewogIGNvbG9yOiAjMzM3YWI3OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KLmJ0bi1zdWNjZXNzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNWNiODVjOwogIGJvcmRlci1jb2xvcjogIzRjYWU0YzsKfQouYnRuLXN1Y2Nlc3M6Zm9jdXMsCi5idG4tc3VjY2Vzcy5mb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzQ0OWQ0NDsKICBib3JkZXItY29sb3I6ICMyNTU2MjU7Cn0KLmJ0bi1zdWNjZXNzOmhvdmVyIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDQ5ZDQ0OwogIGJvcmRlci1jb2xvcjogIzM5ODQzOTsKfQouYnRuLXN1Y2Nlc3M6YWN0aXZlLAouYnRuLXN1Y2Nlc3MuYWN0aXZlLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLXN1Y2Nlc3MgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICM0NDlkNDQ7CiAgYm9yZGVyLWNvbG9yOiAjMzk4NDM5Owp9Ci5idG4tc3VjY2VzczphY3RpdmU6aG92ZXIsCi5idG4tc3VjY2Vzcy5hY3RpdmU6aG92ZXIsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tc3VjY2Vzczpob3ZlciwKLmJ0bi1zdWNjZXNzOmFjdGl2ZTpmb2N1cywKLmJ0bi1zdWNjZXNzLmFjdGl2ZTpmb2N1cywKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1zdWNjZXNzOmZvY3VzLAouYnRuLXN1Y2Nlc3M6YWN0aXZlLmZvY3VzLAouYnRuLXN1Y2Nlc3MuYWN0aXZlLmZvY3VzLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLXN1Y2Nlc3MuZm9jdXMgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzOTg0Mzk7CiAgYm9yZGVyLWNvbG9yOiAjMjU1NjI1Owp9Ci5idG4tc3VjY2VzczphY3RpdmUsCi5idG4tc3VjY2Vzcy5hY3RpdmUsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tc3VjY2VzcyB7CiAgYmFja2dyb3VuZC1pbWFnZTogbm9uZTsKfQouYnRuLXN1Y2Nlc3MuZGlzYWJsZWQ6aG92ZXIsCi5idG4tc3VjY2Vzc1tkaXNhYmxlZF06aG92ZXIsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXN1Y2Nlc3M6aG92ZXIsCi5idG4tc3VjY2Vzcy5kaXNhYmxlZDpmb2N1cywKLmJ0bi1zdWNjZXNzW2Rpc2FibGVkXTpmb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tc3VjY2Vzczpmb2N1cywKLmJ0bi1zdWNjZXNzLmRpc2FibGVkLmZvY3VzLAouYnRuLXN1Y2Nlc3NbZGlzYWJsZWRdLmZvY3VzLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1zdWNjZXNzLmZvY3VzIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNWNiODVjOwogIGJvcmRlci1jb2xvcjogIzRjYWU0YzsKfQouYnRuLXN1Y2Nlc3MgLmJhZGdlIHsKICBjb2xvcjogIzVjYjg1YzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwp9Ci5idG4taW5mbyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzViYzBkZTsKICBib3JkZXItY29sb3I6ICM0NmI4ZGE7Cn0KLmJ0bi1pbmZvOmZvY3VzLAouYnRuLWluZm8uZm9jdXMgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzMWIwZDU7CiAgYm9yZGVyLWNvbG9yOiAjMWI2ZDg1Owp9Ci5idG4taW5mbzpob3ZlciB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMxYjBkNTsKICBib3JkZXItY29sb3I6ICMyNjlhYmM7Cn0KLmJ0bi1pbmZvOmFjdGl2ZSwKLmJ0bi1pbmZvLmFjdGl2ZSwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1pbmZvIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzFiMGQ1OwogIGJvcmRlci1jb2xvcjogIzI2OWFiYzsKfQouYnRuLWluZm86YWN0aXZlOmhvdmVyLAouYnRuLWluZm8uYWN0aXZlOmhvdmVyLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWluZm86aG92ZXIsCi5idG4taW5mbzphY3RpdmU6Zm9jdXMsCi5idG4taW5mby5hY3RpdmU6Zm9jdXMsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4taW5mbzpmb2N1cywKLmJ0bi1pbmZvOmFjdGl2ZS5mb2N1cywKLmJ0bi1pbmZvLmFjdGl2ZS5mb2N1cywKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1pbmZvLmZvY3VzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjY5YWJjOwogIGJvcmRlci1jb2xvcjogIzFiNmQ4NTsKfQouYnRuLWluZm86YWN0aXZlLAouYnRuLWluZm8uYWN0aXZlLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWluZm8gewogIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7Cn0KLmJ0bi1pbmZvLmRpc2FibGVkOmhvdmVyLAouYnRuLWluZm9bZGlzYWJsZWRdOmhvdmVyLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1pbmZvOmhvdmVyLAouYnRuLWluZm8uZGlzYWJsZWQ6Zm9jdXMsCi5idG4taW5mb1tkaXNhYmxlZF06Zm9jdXMsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWluZm86Zm9jdXMsCi5idG4taW5mby5kaXNhYmxlZC5mb2N1cywKLmJ0bi1pbmZvW2Rpc2FibGVkXS5mb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4taW5mby5mb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzViYzBkZTsKICBib3JkZXItY29sb3I6ICM0NmI4ZGE7Cn0KLmJ0bi1pbmZvIC5iYWRnZSB7CiAgY29sb3I6ICM1YmMwZGU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQouYnRuLXdhcm5pbmcgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICNmMGFkNGU7CiAgYm9yZGVyLWNvbG9yOiAjZWVhMjM2Owp9Ci5idG4td2FybmluZzpmb2N1cywKLmJ0bi13YXJuaW5nLmZvY3VzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWM5NzFmOwogIGJvcmRlci1jb2xvcjogIzk4NWYwZDsKfQouYnRuLXdhcm5pbmc6aG92ZXIgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICNlYzk3MWY7CiAgYm9yZGVyLWNvbG9yOiAjZDU4NTEyOwp9Ci5idG4td2FybmluZzphY3RpdmUsCi5idG4td2FybmluZy5hY3RpdmUsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4td2FybmluZyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VjOTcxZjsKICBib3JkZXItY29sb3I6ICNkNTg1MTI7Cn0KLmJ0bi13YXJuaW5nOmFjdGl2ZTpob3ZlciwKLmJ0bi13YXJuaW5nLmFjdGl2ZTpob3ZlciwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi13YXJuaW5nOmhvdmVyLAouYnRuLXdhcm5pbmc6YWN0aXZlOmZvY3VzLAouYnRuLXdhcm5pbmcuYWN0aXZlOmZvY3VzLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLXdhcm5pbmc6Zm9jdXMsCi5idG4td2FybmluZzphY3RpdmUuZm9jdXMsCi5idG4td2FybmluZy5hY3RpdmUuZm9jdXMsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4td2FybmluZy5mb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Q1ODUxMjsKICBib3JkZXItY29sb3I6ICM5ODVmMGQ7Cn0KLmJ0bi13YXJuaW5nOmFjdGl2ZSwKLmJ0bi13YXJuaW5nLmFjdGl2ZSwKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi13YXJuaW5nIHsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwp9Ci5idG4td2FybmluZy5kaXNhYmxlZDpob3ZlciwKLmJ0bi13YXJuaW5nW2Rpc2FibGVkXTpob3ZlciwKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4td2FybmluZzpob3ZlciwKLmJ0bi13YXJuaW5nLmRpc2FibGVkOmZvY3VzLAouYnRuLXdhcm5pbmdbZGlzYWJsZWRdOmZvY3VzLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi13YXJuaW5nOmZvY3VzLAouYnRuLXdhcm5pbmcuZGlzYWJsZWQuZm9jdXMsCi5idG4td2FybmluZ1tkaXNhYmxlZF0uZm9jdXMsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLXdhcm5pbmcuZm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICNmMGFkNGU7CiAgYm9yZGVyLWNvbG9yOiAjZWVhMjM2Owp9Ci5idG4td2FybmluZyAuYmFkZ2UgewogIGNvbG9yOiAjZjBhZDRlOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KLmJ0bi1kYW5nZXIgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICNkOTUzNGY7CiAgYm9yZGVyLWNvbG9yOiAjZDQzZjNhOwp9Ci5idG4tZGFuZ2VyOmZvY3VzLAouYnRuLWRhbmdlci5mb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2M5MzAyYzsKICBib3JkZXItY29sb3I6ICM3NjFjMTk7Cn0KLmJ0bi1kYW5nZXI6aG92ZXIgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICNjOTMwMmM7CiAgYm9yZGVyLWNvbG9yOiAjYWMyOTI1Owp9Ci5idG4tZGFuZ2VyOmFjdGl2ZSwKLmJ0bi1kYW5nZXIuYWN0aXZlLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWRhbmdlciB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2M5MzAyYzsKICBib3JkZXItY29sb3I6ICNhYzI5MjU7Cn0KLmJ0bi1kYW5nZXI6YWN0aXZlOmhvdmVyLAouYnRuLWRhbmdlci5hY3RpdmU6aG92ZXIsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tZGFuZ2VyOmhvdmVyLAouYnRuLWRhbmdlcjphY3RpdmU6Zm9jdXMsCi5idG4tZGFuZ2VyLmFjdGl2ZTpmb2N1cywKLm9wZW4gPiAuZHJvcGRvd24tdG9nZ2xlLmJ0bi1kYW5nZXI6Zm9jdXMsCi5idG4tZGFuZ2VyOmFjdGl2ZS5mb2N1cywKLmJ0bi1kYW5nZXIuYWN0aXZlLmZvY3VzLAoub3BlbiA+IC5kcm9wZG93bi10b2dnbGUuYnRuLWRhbmdlci5mb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2FjMjkyNTsKICBib3JkZXItY29sb3I6ICM3NjFjMTk7Cn0KLmJ0bi1kYW5nZXI6YWN0aXZlLAouYnRuLWRhbmdlci5hY3RpdmUsCi5vcGVuID4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tZGFuZ2VyIHsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwp9Ci5idG4tZGFuZ2VyLmRpc2FibGVkOmhvdmVyLAouYnRuLWRhbmdlcltkaXNhYmxlZF06aG92ZXIsCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWRhbmdlcjpob3ZlciwKLmJ0bi1kYW5nZXIuZGlzYWJsZWQ6Zm9jdXMsCi5idG4tZGFuZ2VyW2Rpc2FibGVkXTpmb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tZGFuZ2VyOmZvY3VzLAouYnRuLWRhbmdlci5kaXNhYmxlZC5mb2N1cywKLmJ0bi1kYW5nZXJbZGlzYWJsZWRdLmZvY3VzLApmaWVsZHNldFtkaXNhYmxlZF0gLmJ0bi1kYW5nZXIuZm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICNkOTUzNGY7CiAgYm9yZGVyLWNvbG9yOiAjZDQzZjNhOwp9Ci5idG4tZGFuZ2VyIC5iYWRnZSB7CiAgY29sb3I6ICNkOTUzNGY7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQouYnRuLWxpbmsgewogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLXJhZGl1czogMDsKfQouYnRuLWxpbmssCi5idG4tbGluazphY3RpdmUsCi5idG4tbGluay5hY3RpdmUsCi5idG4tbGlua1tkaXNhYmxlZF0sCmZpZWxkc2V0W2Rpc2FibGVkXSAuYnRuLWxpbmsgewogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZTsKICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7Cn0KLmJ0bi1saW5rLAouYnRuLWxpbms6aG92ZXIsCi5idG4tbGluazpmb2N1cywKLmJ0bi1saW5rOmFjdGl2ZSB7CiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKfQouYnRuLWxpbms6aG92ZXIsCi5idG4tbGluazpmb2N1cyB7CiAgY29sb3I6ICMyMzUyN2M7CiAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KLmJ0bi1saW5rW2Rpc2FibGVkXTpob3ZlciwKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tbGluazpob3ZlciwKLmJ0bi1saW5rW2Rpc2FibGVkXTpmb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5idG4tbGluazpmb2N1cyB7CiAgY29sb3I6ICM3Nzc7CiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwp9Ci5idG4tbGcsCi5idG4tZ3JvdXAtbGcgPiAuYnRuIHsKICBwYWRkaW5nOiAxMHB4IDE2cHg7CiAgZm9udC1zaXplOiAxOHB4OwogIGxpbmUtaGVpZ2h0OiAxLjMzMzMzMzM7CiAgYm9yZGVyLXJhZGl1czogNnB4Owp9Ci5idG4tc20sCi5idG4tZ3JvdXAtc20gPiAuYnRuIHsKICBwYWRkaW5nOiA1cHggMTBweDsKICBmb250LXNpemU6IDEycHg7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBib3JkZXItcmFkaXVzOiAzcHg7Cn0KLmJ0bi14cywKLmJ0bi1ncm91cC14cyA+IC5idG4gewogIHBhZGRpbmc6IDFweCA1cHg7CiAgZm9udC1zaXplOiAxMnB4OwogIGxpbmUtaGVpZ2h0OiAxLjU7CiAgYm9yZGVyLXJhZGl1czogM3B4Owp9Ci5idG4tYmxvY2sgewogIGRpc3BsYXk6IGJsb2NrOwogIHdpZHRoOiAxMDAlOwp9Ci5idG4tYmxvY2sgKyAuYnRuLWJsb2NrIHsKICBtYXJnaW4tdG9wOiA1cHg7Cn0KaW5wdXRbdHlwZT0ic3VibWl0Il0uYnRuLWJsb2NrLAppbnB1dFt0eXBlPSJyZXNldCJdLmJ0bi1ibG9jaywKaW5wdXRbdHlwZT0iYnV0dG9uIl0uYnRuLWJsb2NrIHsKICB3aWR0aDogMTAwJTsKfQouZmFkZSB7CiAgb3BhY2l0eTogMDsKICAtd2Via2l0LXRyYW5zaXRpb246IG9wYWNpdHkgLjE1cyBsaW5lYXI7CiAgICAgICAtby10cmFuc2l0aW9uOiBvcGFjaXR5IC4xNXMgbGluZWFyOwogICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAuMTVzIGxpbmVhcjsKfQouZmFkZS5pbiB7CiAgb3BhY2l0eTogMTsKfQouY29sbGFwc2UgewogIGRpc3BsYXk6IG5vbmU7Cn0KLmNvbGxhcHNlLmluIHsKICBkaXNwbGF5OiBibG9jazsKfQp0ci5jb2xsYXBzZS5pbiB7CiAgZGlzcGxheTogdGFibGUtcm93Owp9CnRib2R5LmNvbGxhcHNlLmluIHsKICBkaXNwbGF5OiB0YWJsZS1yb3ctZ3JvdXA7Cn0KLmNvbGxhcHNpbmcgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBoZWlnaHQ6IDA7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICAtd2Via2l0LXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uOiBlYXNlOwogICAgICAgLW8tdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246IGVhc2U7CiAgICAgICAgICB0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjogZWFzZTsKICAtd2Via2l0LXRyYW5zaXRpb24tZHVyYXRpb246IC4zNXM7CiAgICAgICAtby10cmFuc2l0aW9uLWR1cmF0aW9uOiAuMzVzOwogICAgICAgICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogLjM1czsKICAtd2Via2l0LXRyYW5zaXRpb24tcHJvcGVydHk6IGhlaWdodCwgdmlzaWJpbGl0eTsKICAgICAgIC1vLXRyYW5zaXRpb24tcHJvcGVydHk6IGhlaWdodCwgdmlzaWJpbGl0eTsKICAgICAgICAgIHRyYW5zaXRpb24tcHJvcGVydHk6IGhlaWdodCwgdmlzaWJpbGl0eTsKfQouY2FyZXQgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB3aWR0aDogMDsKICBoZWlnaHQ6IDA7CiAgbWFyZ2luLWxlZnQ6IDJweDsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogIGJvcmRlci10b3A6IDRweCBkYXNoZWQ7CiAgYm9yZGVyLXRvcDogNHB4IHNvbGlkIFw5OwogIGJvcmRlci1yaWdodDogNHB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1sZWZ0OiA0cHggc29saWQgdHJhbnNwYXJlbnQ7Cn0KLmRyb3B1cCwKLmRyb3Bkb3duIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLmRyb3Bkb3duLXRvZ2dsZTpmb2N1cyB7CiAgb3V0bGluZTogMDsKfQouZHJvcGRvd24tbWVudSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogMTAwJTsKICBsZWZ0OiAwOwogIHotaW5kZXg6IDEwMDA7CiAgZGlzcGxheTogbm9uZTsKICBmbG9hdDogbGVmdDsKICBtaW4td2lkdGg6IDE2MHB4OwogIHBhZGRpbmc6IDVweCAwOwogIG1hcmdpbjogMnB4IDAgMDsKICBmb250LXNpemU6IDE0cHg7CiAgdGV4dC1hbGlnbjogbGVmdDsKICBsaXN0LXN0eWxlOiBub25lOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHBhZGRpbmctYm94OwogICAgICAgICAgYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveDsKICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgLjE1KTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiAwIDZweCAxMnB4IHJnYmEoMCwgMCwgMCwgLjE3NSk7CiAgICAgICAgICBib3gtc2hhZG93OiAwIDZweCAxMnB4IHJnYmEoMCwgMCwgMCwgLjE3NSk7Cn0KLmRyb3Bkb3duLW1lbnUucHVsbC1yaWdodCB7CiAgcmlnaHQ6IDA7CiAgbGVmdDogYXV0bzsKfQouZHJvcGRvd24tbWVudSAuZGl2aWRlciB7CiAgaGVpZ2h0OiAxcHg7CiAgbWFyZ2luOiA5cHggMDsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJhY2tncm91bmQtY29sb3I6ICNlNWU1ZTU7Cn0KLmRyb3Bkb3duLW1lbnUgPiBsaSA+IGEgewogIGRpc3BsYXk6IGJsb2NrOwogIHBhZGRpbmc6IDNweCAyMHB4OwogIGNsZWFyOiBib3RoOwogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgY29sb3I6ICMzMzM7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQouZHJvcGRvd24tbWVudSA+IGxpID4gYTpob3ZlciwKLmRyb3Bkb3duLW1lbnUgPiBsaSA+IGE6Zm9jdXMgewogIGNvbG9yOiAjMjYyNjI2OwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1Owp9Ci5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSA+IGEsCi5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSA+IGE6aG92ZXIsCi5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSA+IGE6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzM3YWI3OwogIG91dGxpbmU6IDA7Cn0KLmRyb3Bkb3duLW1lbnUgPiAuZGlzYWJsZWQgPiBhLAouZHJvcGRvd24tbWVudSA+IC5kaXNhYmxlZCA+IGE6aG92ZXIsCi5kcm9wZG93bi1tZW51ID4gLmRpc2FibGVkID4gYTpmb2N1cyB7CiAgY29sb3I6ICM3Nzc7Cn0KLmRyb3Bkb3duLW1lbnUgPiAuZGlzYWJsZWQgPiBhOmhvdmVyLAouZHJvcGRvd24tbWVudSA+IC5kaXNhYmxlZCA+IGE6Zm9jdXMgewogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJhY2tncm91bmQtaW1hZ2U6IG5vbmU7CiAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoZW5hYmxlZCA9IGZhbHNlKTsKfQoub3BlbiA+IC5kcm9wZG93bi1tZW51IHsKICBkaXNwbGF5OiBibG9jazsKfQoub3BlbiA+IGEgewogIG91dGxpbmU6IDA7Cn0KLmRyb3Bkb3duLW1lbnUtcmlnaHQgewogIHJpZ2h0OiAwOwogIGxlZnQ6IGF1dG87Cn0KLmRyb3Bkb3duLW1lbnUtbGVmdCB7CiAgcmlnaHQ6IGF1dG87CiAgbGVmdDogMDsKfQouZHJvcGRvd24taGVhZGVyIHsKICBkaXNwbGF5OiBibG9jazsKICBwYWRkaW5nOiAzcHggMjBweDsKICBmb250LXNpemU6IDEycHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgY29sb3I6ICM3Nzc7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKfQouZHJvcGRvd24tYmFja2Ryb3AgewogIHBvc2l0aW9uOiBmaXhlZDsKICB0b3A6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIGxlZnQ6IDA7CiAgei1pbmRleDogOTkwOwp9Ci5wdWxsLXJpZ2h0ID4gLmRyb3Bkb3duLW1lbnUgewogIHJpZ2h0OiAwOwogIGxlZnQ6IGF1dG87Cn0KLmRyb3B1cCAuY2FyZXQsCi5uYXZiYXItZml4ZWQtYm90dG9tIC5kcm9wZG93biAuY2FyZXQgewogIGNvbnRlbnQ6ICIiOwogIGJvcmRlci10b3A6IDA7CiAgYm9yZGVyLWJvdHRvbTogNHB4IGRhc2hlZDsKICBib3JkZXItYm90dG9tOiA0cHggc29saWQgXDk7Cn0KLmRyb3B1cCAuZHJvcGRvd24tbWVudSwKLm5hdmJhci1maXhlZC1ib3R0b20gLmRyb3Bkb3duIC5kcm9wZG93bi1tZW51IHsKICB0b3A6IGF1dG87CiAgYm90dG9tOiAxMDAlOwogIG1hcmdpbi1ib3R0b206IDJweDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyLXJpZ2h0IC5kcm9wZG93bi1tZW51IHsKICAgIHJpZ2h0OiAwOwogICAgbGVmdDogYXV0bzsKICB9CiAgLm5hdmJhci1yaWdodCAuZHJvcGRvd24tbWVudS1sZWZ0IHsKICAgIHJpZ2h0OiBhdXRvOwogICAgbGVmdDogMDsKICB9Cn0KLmJ0bi1ncm91cCwKLmJ0bi1ncm91cC12ZXJ0aWNhbCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwp9Ci5idG4tZ3JvdXAgPiAuYnRuLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0biB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGZsb2F0OiBsZWZ0Owp9Ci5idG4tZ3JvdXAgPiAuYnRuOmhvdmVyLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bjpob3ZlciwKLmJ0bi1ncm91cCA+IC5idG46Zm9jdXMsCi5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuOmZvY3VzLAouYnRuLWdyb3VwID4gLmJ0bjphY3RpdmUsCi5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuOmFjdGl2ZSwKLmJ0bi1ncm91cCA+IC5idG4uYWN0aXZlLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi5hY3RpdmUgewogIHotaW5kZXg6IDI7Cn0KLmJ0bi1ncm91cCAuYnRuICsgLmJ0biwKLmJ0bi1ncm91cCAuYnRuICsgLmJ0bi1ncm91cCwKLmJ0bi1ncm91cCAuYnRuLWdyb3VwICsgLmJ0biwKLmJ0bi1ncm91cCAuYnRuLWdyb3VwICsgLmJ0bi1ncm91cCB7CiAgbWFyZ2luLWxlZnQ6IC0xcHg7Cn0KLmJ0bi10b29sYmFyIHsKICBtYXJnaW4tbGVmdDogLTVweDsKfQouYnRuLXRvb2xiYXIgLmJ0biwKLmJ0bi10b29sYmFyIC5idG4tZ3JvdXAsCi5idG4tdG9vbGJhciAuaW5wdXQtZ3JvdXAgewogIGZsb2F0OiBsZWZ0Owp9Ci5idG4tdG9vbGJhciA+IC5idG4sCi5idG4tdG9vbGJhciA+IC5idG4tZ3JvdXAsCi5idG4tdG9vbGJhciA+IC5pbnB1dC1ncm91cCB7CiAgbWFyZ2luLWxlZnQ6IDVweDsKfQouYnRuLWdyb3VwID4gLmJ0bjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpOm5vdCguZHJvcGRvd24tdG9nZ2xlKSB7CiAgYm9yZGVyLXJhZGl1czogMDsKfQouYnRuLWdyb3VwID4gLmJ0bjpmaXJzdC1jaGlsZCB7CiAgbWFyZ2luLWxlZnQ6IDA7Cn0KLmJ0bi1ncm91cCA+IC5idG46Zmlyc3QtY2hpbGQ6bm90KDpsYXN0LWNoaWxkKTpub3QoLmRyb3Bkb3duLXRvZ2dsZSkgewogIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOwogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOwp9Ci5idG4tZ3JvdXAgPiAuYnRuOmxhc3QtY2hpbGQ6bm90KDpmaXJzdC1jaGlsZCksCi5idG4tZ3JvdXAgPiAuZHJvcGRvd24tdG9nZ2xlOm5vdCg6Zmlyc3QtY2hpbGQpIHsKICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAwOwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7Cn0KLmJ0bi1ncm91cCA+IC5idG4tZ3JvdXAgewogIGZsb2F0OiBsZWZ0Owp9Ci5idG4tZ3JvdXAgPiAuYnRuLWdyb3VwOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCkgPiAuYnRuIHsKICBib3JkZXItcmFkaXVzOiAwOwp9Ci5idG4tZ3JvdXAgPiAuYnRuLWdyb3VwOmZpcnN0LWNoaWxkOm5vdCg6bGFzdC1jaGlsZCkgPiAuYnRuOmxhc3QtY2hpbGQsCi5idG4tZ3JvdXAgPiAuYnRuLWdyb3VwOmZpcnN0LWNoaWxkOm5vdCg6bGFzdC1jaGlsZCkgPiAuZHJvcGRvd24tdG9nZ2xlIHsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsKfQouYnRuLWdyb3VwID4gLmJ0bi1ncm91cDpsYXN0LWNoaWxkOm5vdCg6Zmlyc3QtY2hpbGQpID4gLmJ0bjpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDsKICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAwOwp9Ci5idG4tZ3JvdXAgLmRyb3Bkb3duLXRvZ2dsZTphY3RpdmUsCi5idG4tZ3JvdXAub3BlbiAuZHJvcGRvd24tdG9nZ2xlIHsKICBvdXRsaW5lOiAwOwp9Ci5idG4tZ3JvdXAgPiAuYnRuICsgLmRyb3Bkb3duLXRvZ2dsZSB7CiAgcGFkZGluZy1yaWdodDogOHB4OwogIHBhZGRpbmctbGVmdDogOHB4Owp9Ci5idG4tZ3JvdXAgPiAuYnRuLWxnICsgLmRyb3Bkb3duLXRvZ2dsZSB7CiAgcGFkZGluZy1yaWdodDogMTJweDsKICBwYWRkaW5nLWxlZnQ6IDEycHg7Cn0KLmJ0bi1ncm91cC5vcGVuIC5kcm9wZG93bi10b2dnbGUgewogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAzcHggNXB4IHJnYmEoMCwgMCwgMCwgLjEyNSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDNweCA1cHggcmdiYSgwLCAwLCAwLCAuMTI1KTsKfQouYnRuLWdyb3VwLm9wZW4gLmRyb3Bkb3duLXRvZ2dsZS5idG4tbGluayB7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBub25lOwogICAgICAgICAgYm94LXNoYWRvdzogbm9uZTsKfQouYnRuIC5jYXJldCB7CiAgbWFyZ2luLWxlZnQ6IDA7Cn0KLmJ0bi1sZyAuY2FyZXQgewogIGJvcmRlci13aWR0aDogNXB4IDVweCAwOwogIGJvcmRlci1ib3R0b20td2lkdGg6IDA7Cn0KLmRyb3B1cCAuYnRuLWxnIC5jYXJldCB7CiAgYm9yZGVyLXdpZHRoOiAwIDVweCA1cHg7Cn0KLmJ0bi1ncm91cC12ZXJ0aWNhbCA+IC5idG4sCi5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuLWdyb3VwLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cCA+IC5idG4gewogIGRpc3BsYXk6IGJsb2NrOwogIGZsb2F0OiBub25lOwogIHdpZHRoOiAxMDAlOwogIG1heC13aWR0aDogMTAwJTsKfQouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cCA+IC5idG4gewogIGZsb2F0OiBub25lOwp9Ci5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuICsgLmJ0biwKLmJ0bi1ncm91cC12ZXJ0aWNhbCA+IC5idG4gKyAuYnRuLWdyb3VwLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cCArIC5idG4sCi5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuLWdyb3VwICsgLmJ0bi1ncm91cCB7CiAgbWFyZ2luLXRvcDogLTFweDsKICBtYXJnaW4tbGVmdDogMDsKfQouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpIHsKICBib3JkZXItcmFkaXVzOiAwOwp9Ci5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuOmZpcnN0LWNoaWxkOm5vdCg6bGFzdC1jaGlsZCkgewogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDRweDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNHB4OwogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7Cn0KLmJ0bi1ncm91cC12ZXJ0aWNhbCA+IC5idG46bGFzdC1jaGlsZDpub3QoOmZpcnN0LWNoaWxkKSB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNHB4OwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDRweDsKfQouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cDpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpID4gLmJ0biB7CiAgYm9yZGVyLXJhZGl1czogMDsKfQouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cDpmaXJzdC1jaGlsZDpub3QoOmxhc3QtY2hpbGQpID4gLmJ0bjpsYXN0LWNoaWxkLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cDpmaXJzdC1jaGlsZDpub3QoOmxhc3QtY2hpbGQpID4gLmRyb3Bkb3duLXRvZ2dsZSB7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsKfQouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cDpsYXN0LWNoaWxkOm5vdCg6Zmlyc3QtY2hpbGQpID4gLmJ0bjpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKfQouYnRuLWdyb3VwLWp1c3RpZmllZCB7CiAgZGlzcGxheTogdGFibGU7CiAgd2lkdGg6IDEwMCU7CiAgdGFibGUtbGF5b3V0OiBmaXhlZDsKICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlOwp9Ci5idG4tZ3JvdXAtanVzdGlmaWVkID4gLmJ0biwKLmJ0bi1ncm91cC1qdXN0aWZpZWQgPiAuYnRuLWdyb3VwIHsKICBkaXNwbGF5OiB0YWJsZS1jZWxsOwogIGZsb2F0OiBub25lOwogIHdpZHRoOiAxJTsKfQouYnRuLWdyb3VwLWp1c3RpZmllZCA+IC5idG4tZ3JvdXAgLmJ0biB7CiAgd2lkdGg6IDEwMCU7Cn0KLmJ0bi1ncm91cC1qdXN0aWZpZWQgPiAuYnRuLWdyb3VwIC5kcm9wZG93bi1tZW51IHsKICBsZWZ0OiBhdXRvOwp9CltkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdID4gLmJ0biBpbnB1dFt0eXBlPSJyYWRpbyJdLApbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXSA+IC5idG4tZ3JvdXAgPiAuYnRuIGlucHV0W3R5cGU9InJhZGlvIl0sCltkYXRhLXRvZ2dsZT0iYnV0dG9ucyJdID4gLmJ0biBpbnB1dFt0eXBlPSJjaGVja2JveCJdLApbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXSA+IC5idG4tZ3JvdXAgPiAuYnRuIGlucHV0W3R5cGU9ImNoZWNrYm94Il0gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBjbGlwOiByZWN0KDAsIDAsIDAsIDApOwogIHBvaW50ZXItZXZlbnRzOiBub25lOwp9Ci5pbnB1dC1ncm91cCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IHRhYmxlOwogIGJvcmRlci1jb2xsYXBzZTogc2VwYXJhdGU7Cn0KLmlucHV0LWdyb3VwW2NsYXNzKj0iY29sLSJdIHsKICBmbG9hdDogbm9uZTsKICBwYWRkaW5nLXJpZ2h0OiAwOwogIHBhZGRpbmctbGVmdDogMDsKfQouaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHotaW5kZXg6IDI7CiAgZmxvYXQ6IGxlZnQ7CiAgd2lkdGg6IDEwMCU7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQouaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbDpmb2N1cyB7CiAgei1pbmRleDogMzsKfQouaW5wdXQtZ3JvdXAtbGcgPiAuZm9ybS1jb250cm9sLAouaW5wdXQtZ3JvdXAtbGcgPiAuaW5wdXQtZ3JvdXAtYWRkb24sCi5pbnB1dC1ncm91cC1sZyA+IC5pbnB1dC1ncm91cC1idG4gPiAuYnRuIHsKICBoZWlnaHQ6IDQ2cHg7CiAgcGFkZGluZzogMTBweCAxNnB4OwogIGZvbnQtc2l6ZTogMThweDsKICBsaW5lLWhlaWdodDogMS4zMzMzMzMzOwogIGJvcmRlci1yYWRpdXM6IDZweDsKfQpzZWxlY3QuaW5wdXQtZ3JvdXAtbGcgPiAuZm9ybS1jb250cm9sLApzZWxlY3QuaW5wdXQtZ3JvdXAtbGcgPiAuaW5wdXQtZ3JvdXAtYWRkb24sCnNlbGVjdC5pbnB1dC1ncm91cC1sZyA+IC5pbnB1dC1ncm91cC1idG4gPiAuYnRuIHsKICBoZWlnaHQ6IDQ2cHg7CiAgbGluZS1oZWlnaHQ6IDQ2cHg7Cn0KdGV4dGFyZWEuaW5wdXQtZ3JvdXAtbGcgPiAuZm9ybS1jb250cm9sLAp0ZXh0YXJlYS5pbnB1dC1ncm91cC1sZyA+IC5pbnB1dC1ncm91cC1hZGRvbiwKdGV4dGFyZWEuaW5wdXQtZ3JvdXAtbGcgPiAuaW5wdXQtZ3JvdXAtYnRuID4gLmJ0biwKc2VsZWN0W211bHRpcGxlXS5pbnB1dC1ncm91cC1sZyA+IC5mb3JtLWNvbnRyb2wsCnNlbGVjdFttdWx0aXBsZV0uaW5wdXQtZ3JvdXAtbGcgPiAuaW5wdXQtZ3JvdXAtYWRkb24sCnNlbGVjdFttdWx0aXBsZV0uaW5wdXQtZ3JvdXAtbGcgPiAuaW5wdXQtZ3JvdXAtYnRuID4gLmJ0biB7CiAgaGVpZ2h0OiBhdXRvOwp9Ci5pbnB1dC1ncm91cC1zbSA+IC5mb3JtLWNvbnRyb2wsCi5pbnB1dC1ncm91cC1zbSA+IC5pbnB1dC1ncm91cC1hZGRvbiwKLmlucHV0LWdyb3VwLXNtID4gLmlucHV0LWdyb3VwLWJ0biA+IC5idG4gewogIGhlaWdodDogMzBweDsKICBwYWRkaW5nOiA1cHggMTBweDsKICBmb250LXNpemU6IDEycHg7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBib3JkZXItcmFkaXVzOiAzcHg7Cn0Kc2VsZWN0LmlucHV0LWdyb3VwLXNtID4gLmZvcm0tY29udHJvbCwKc2VsZWN0LmlucHV0LWdyb3VwLXNtID4gLmlucHV0LWdyb3VwLWFkZG9uLApzZWxlY3QuaW5wdXQtZ3JvdXAtc20gPiAuaW5wdXQtZ3JvdXAtYnRuID4gLmJ0biB7CiAgaGVpZ2h0OiAzMHB4OwogIGxpbmUtaGVpZ2h0OiAzMHB4Owp9CnRleHRhcmVhLmlucHV0LWdyb3VwLXNtID4gLmZvcm0tY29udHJvbCwKdGV4dGFyZWEuaW5wdXQtZ3JvdXAtc20gPiAuaW5wdXQtZ3JvdXAtYWRkb24sCnRleHRhcmVhLmlucHV0LWdyb3VwLXNtID4gLmlucHV0LWdyb3VwLWJ0biA+IC5idG4sCnNlbGVjdFttdWx0aXBsZV0uaW5wdXQtZ3JvdXAtc20gPiAuZm9ybS1jb250cm9sLApzZWxlY3RbbXVsdGlwbGVdLmlucHV0LWdyb3VwLXNtID4gLmlucHV0LWdyb3VwLWFkZG9uLApzZWxlY3RbbXVsdGlwbGVdLmlucHV0LWdyb3VwLXNtID4gLmlucHV0LWdyb3VwLWJ0biA+IC5idG4gewogIGhlaWdodDogYXV0bzsKfQouaW5wdXQtZ3JvdXAtYWRkb24sCi5pbnB1dC1ncm91cC1idG4sCi5pbnB1dC1ncm91cCAuZm9ybS1jb250cm9sIHsKICBkaXNwbGF5OiB0YWJsZS1jZWxsOwp9Ci5pbnB1dC1ncm91cC1hZGRvbjpub3QoOmZpcnN0LWNoaWxkKTpub3QoOmxhc3QtY2hpbGQpLAouaW5wdXQtZ3JvdXAtYnRuOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCksCi5pbnB1dC1ncm91cCAuZm9ybS1jb250cm9sOm5vdCg6Zmlyc3QtY2hpbGQpOm5vdCg6bGFzdC1jaGlsZCkgewogIGJvcmRlci1yYWRpdXM6IDA7Cn0KLmlucHV0LWdyb3VwLWFkZG9uLAouaW5wdXQtZ3JvdXAtYnRuIHsKICB3aWR0aDogMSU7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwp9Ci5pbnB1dC1ncm91cC1hZGRvbiB7CiAgcGFkZGluZzogNnB4IDEycHg7CiAgZm9udC1zaXplOiAxNHB4OwogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgbGluZS1oZWlnaHQ6IDE7CiAgY29sb3I6ICM1NTU7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGJhY2tncm91bmQtY29sb3I6ICNlZWU7CiAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLmlucHV0LWdyb3VwLWFkZG9uLmlucHV0LXNtIHsKICBwYWRkaW5nOiA1cHggMTBweDsKICBmb250LXNpemU6IDEycHg7CiAgYm9yZGVyLXJhZGl1czogM3B4Owp9Ci5pbnB1dC1ncm91cC1hZGRvbi5pbnB1dC1sZyB7CiAgcGFkZGluZzogMTBweCAxNnB4OwogIGZvbnQtc2l6ZTogMThweDsKICBib3JkZXItcmFkaXVzOiA2cHg7Cn0KLmlucHV0LWdyb3VwLWFkZG9uIGlucHV0W3R5cGU9InJhZGlvIl0sCi5pbnB1dC1ncm91cC1hZGRvbiBpbnB1dFt0eXBlPSJjaGVja2JveCJdIHsKICBtYXJnaW4tdG9wOiAwOwp9Ci5pbnB1dC1ncm91cCAuZm9ybS1jb250cm9sOmZpcnN0LWNoaWxkLAouaW5wdXQtZ3JvdXAtYWRkb246Zmlyc3QtY2hpbGQsCi5pbnB1dC1ncm91cC1idG46Zmlyc3QtY2hpbGQgPiAuYnRuLAouaW5wdXQtZ3JvdXAtYnRuOmZpcnN0LWNoaWxkID4gLmJ0bi1ncm91cCA+IC5idG4sCi5pbnB1dC1ncm91cC1idG46Zmlyc3QtY2hpbGQgPiAuZHJvcGRvd24tdG9nZ2xlLAouaW5wdXQtZ3JvdXAtYnRuOmxhc3QtY2hpbGQgPiAuYnRuOm5vdCg6bGFzdC1jaGlsZCk6bm90KC5kcm9wZG93bi10b2dnbGUpLAouaW5wdXQtZ3JvdXAtYnRuOmxhc3QtY2hpbGQgPiAuYnRuLWdyb3VwOm5vdCg6bGFzdC1jaGlsZCkgPiAuYnRuIHsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMDsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogMDsKfQouaW5wdXQtZ3JvdXAtYWRkb246Zmlyc3QtY2hpbGQgewogIGJvcmRlci1yaWdodDogMDsKfQouaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbDpsYXN0LWNoaWxkLAouaW5wdXQtZ3JvdXAtYWRkb246bGFzdC1jaGlsZCwKLmlucHV0LWdyb3VwLWJ0bjpsYXN0LWNoaWxkID4gLmJ0biwKLmlucHV0LWdyb3VwLWJ0bjpsYXN0LWNoaWxkID4gLmJ0bi1ncm91cCA+IC5idG4sCi5pbnB1dC1ncm91cC1idG46bGFzdC1jaGlsZCA+IC5kcm9wZG93bi10b2dnbGUsCi5pbnB1dC1ncm91cC1idG46Zmlyc3QtY2hpbGQgPiAuYnRuOm5vdCg6Zmlyc3QtY2hpbGQpLAouaW5wdXQtZ3JvdXAtYnRuOmZpcnN0LWNoaWxkID4gLmJ0bi1ncm91cDpub3QoOmZpcnN0LWNoaWxkKSA+IC5idG4gewogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDA7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMDsKfQouaW5wdXQtZ3JvdXAtYWRkb246bGFzdC1jaGlsZCB7CiAgYm9yZGVyLWxlZnQ6IDA7Cn0KLmlucHV0LWdyb3VwLWJ0biB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGZvbnQtc2l6ZTogMDsKICB3aGl0ZS1zcGFjZTogbm93cmFwOwp9Ci5pbnB1dC1ncm91cC1idG4gPiAuYnRuIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KLmlucHV0LWdyb3VwLWJ0biA+IC5idG4gKyAuYnRuIHsKICBtYXJnaW4tbGVmdDogLTFweDsKfQouaW5wdXQtZ3JvdXAtYnRuID4gLmJ0bjpob3ZlciwKLmlucHV0LWdyb3VwLWJ0biA+IC5idG46Zm9jdXMsCi5pbnB1dC1ncm91cC1idG4gPiAuYnRuOmFjdGl2ZSB7CiAgei1pbmRleDogMjsKfQouaW5wdXQtZ3JvdXAtYnRuOmZpcnN0LWNoaWxkID4gLmJ0biwKLmlucHV0LWdyb3VwLWJ0bjpmaXJzdC1jaGlsZCA+IC5idG4tZ3JvdXAgewogIG1hcmdpbi1yaWdodDogLTFweDsKfQouaW5wdXQtZ3JvdXAtYnRuOmxhc3QtY2hpbGQgPiAuYnRuLAouaW5wdXQtZ3JvdXAtYnRuOmxhc3QtY2hpbGQgPiAuYnRuLWdyb3VwIHsKICB6LWluZGV4OiAyOwogIG1hcmdpbi1sZWZ0OiAtMXB4Owp9Ci5uYXYgewogIHBhZGRpbmctbGVmdDogMDsKICBtYXJnaW4tYm90dG9tOiAwOwogIGxpc3Qtc3R5bGU6IG5vbmU7Cn0KLm5hdiA+IGxpIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgZGlzcGxheTogYmxvY2s7Cn0KLm5hdiA+IGxpID4gYSB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGRpc3BsYXk6IGJsb2NrOwogIHBhZGRpbmc6IDEwcHggMTVweDsKfQoubmF2ID4gbGkgPiBhOmhvdmVyLAoubmF2ID4gbGkgPiBhOmZvY3VzIHsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTsKfQoubmF2ID4gbGkuZGlzYWJsZWQgPiBhIHsKICBjb2xvcjogIzc3NzsKfQoubmF2ID4gbGkuZGlzYWJsZWQgPiBhOmhvdmVyLAoubmF2ID4gbGkuZGlzYWJsZWQgPiBhOmZvY3VzIHsKICBjb2xvcjogIzc3NzsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoubmF2IC5vcGVuID4gYSwKLm5hdiAub3BlbiA+IGE6aG92ZXIsCi5uYXYgLm9wZW4gPiBhOmZvY3VzIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOwogIGJvcmRlci1jb2xvcjogIzMzN2FiNzsKfQoubmF2IC5uYXYtZGl2aWRlciB7CiAgaGVpZ2h0OiAxcHg7CiAgbWFyZ2luOiA5cHggMDsKICBvdmVyZmxvdzogaGlkZGVuOwogIGJhY2tncm91bmQtY29sb3I6ICNlNWU1ZTU7Cn0KLm5hdiA+IGxpID4gYSA+IGltZyB7CiAgbWF4LXdpZHRoOiBub25lOwp9Ci5uYXYtdGFicyB7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkZGQ7Cn0KLm5hdi10YWJzID4gbGkgewogIGZsb2F0OiBsZWZ0OwogIG1hcmdpbi1ib3R0b206IC0xcHg7Cn0KLm5hdi10YWJzID4gbGkgPiBhIHsKICBtYXJnaW4tcmlnaHQ6IDJweDsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICBib3JkZXItcmFkaXVzOiA0cHggNHB4IDAgMDsKfQoubmF2LXRhYnMgPiBsaSA+IGE6aG92ZXIgewogIGJvcmRlci1jb2xvcjogI2VlZSAjZWVlICNkZGQ7Cn0KLm5hdi10YWJzID4gbGkuYWN0aXZlID4gYSwKLm5hdi10YWJzID4gbGkuYWN0aXZlID4gYTpob3ZlciwKLm5hdi10YWJzID4gbGkuYWN0aXZlID4gYTpmb2N1cyB7CiAgY29sb3I6ICM1NTU7CiAgY3Vyc29yOiBkZWZhdWx0OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICBib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCB7CiAgd2lkdGg6IDEwMCU7CiAgYm9yZGVyLWJvdHRvbTogMDsKfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IGxpIHsKICBmbG9hdDogbm9uZTsKfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IGxpID4gYSB7CiAgbWFyZ2luLWJvdHRvbTogNXB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IC5kcm9wZG93biAuZHJvcGRvd24tbWVudSB7CiAgdG9wOiBhdXRvOwogIGxlZnQ6IGF1dG87Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQgPiBsaSB7CiAgICBkaXNwbGF5OiB0YWJsZS1jZWxsOwogICAgd2lkdGg6IDElOwogIH0KICAubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IGxpID4gYSB7CiAgICBtYXJnaW4tYm90dG9tOiAwOwogIH0KfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IGxpID4gYSB7CiAgbWFyZ2luLXJpZ2h0OiAwOwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhLAoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhOmhvdmVyLAoubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhOmZvY3VzIHsKICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5uYXYtdGFicy5uYXYtanVzdGlmaWVkID4gbGkgPiBhIHsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZGRkOwogICAgYm9yZGVyLXJhZGl1czogNHB4IDRweCAwIDA7CiAgfQogIC5uYXYtdGFicy5uYXYtanVzdGlmaWVkID4gLmFjdGl2ZSA+IGEsCiAgLm5hdi10YWJzLm5hdi1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpob3ZlciwKICAubmF2LXRhYnMubmF2LWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhOmZvY3VzIHsKICAgIGJvcmRlci1ib3R0b20tY29sb3I6ICNmZmY7CiAgfQp9Ci5uYXYtcGlsbHMgPiBsaSB7CiAgZmxvYXQ6IGxlZnQ7Cn0KLm5hdi1waWxscyA+IGxpID4gYSB7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9Ci5uYXYtcGlsbHMgPiBsaSArIGxpIHsKICBtYXJnaW4tbGVmdDogMnB4Owp9Ci5uYXYtcGlsbHMgPiBsaS5hY3RpdmUgPiBhLAoubmF2LXBpbGxzID4gbGkuYWN0aXZlID4gYTpob3ZlciwKLm5hdi1waWxscyA+IGxpLmFjdGl2ZSA+IGE6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7Cn0KLm5hdi1zdGFja2VkID4gbGkgewogIGZsb2F0OiBub25lOwp9Ci5uYXYtc3RhY2tlZCA+IGxpICsgbGkgewogIG1hcmdpbi10b3A6IDJweDsKICBtYXJnaW4tbGVmdDogMDsKfQoubmF2LWp1c3RpZmllZCB7CiAgd2lkdGg6IDEwMCU7Cn0KLm5hdi1qdXN0aWZpZWQgPiBsaSB7CiAgZmxvYXQ6IG5vbmU7Cn0KLm5hdi1qdXN0aWZpZWQgPiBsaSA+IGEgewogIG1hcmdpbi1ib3R0b206IDVweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KLm5hdi1qdXN0aWZpZWQgPiAuZHJvcGRvd24gLmRyb3Bkb3duLW1lbnUgewogIHRvcDogYXV0bzsKICBsZWZ0OiBhdXRvOwp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5uYXYtanVzdGlmaWVkID4gbGkgewogICAgZGlzcGxheTogdGFibGUtY2VsbDsKICAgIHdpZHRoOiAxJTsKICB9CiAgLm5hdi1qdXN0aWZpZWQgPiBsaSA+IGEgewogICAgbWFyZ2luLWJvdHRvbTogMDsKICB9Cn0KLm5hdi10YWJzLWp1c3RpZmllZCB7CiAgYm9yZGVyLWJvdHRvbTogMDsKfQoubmF2LXRhYnMtanVzdGlmaWVkID4gbGkgPiBhIHsKICBtYXJnaW4tcmlnaHQ6IDA7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9Ci5uYXYtdGFicy1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYSwKLm5hdi10YWJzLWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhOmhvdmVyLAoubmF2LXRhYnMtanVzdGlmaWVkID4gLmFjdGl2ZSA+IGE6Zm9jdXMgewogIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdi10YWJzLWp1c3RpZmllZCA+IGxpID4gYSB7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RkZDsKICAgIGJvcmRlci1yYWRpdXM6IDRweCA0cHggMCAwOwogIH0KICAubmF2LXRhYnMtanVzdGlmaWVkID4gLmFjdGl2ZSA+IGEsCiAgLm5hdi10YWJzLWp1c3RpZmllZCA+IC5hY3RpdmUgPiBhOmhvdmVyLAogIC5uYXYtdGFicy1qdXN0aWZpZWQgPiAuYWN0aXZlID4gYTpmb2N1cyB7CiAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjZmZmOwogIH0KfQoudGFiLWNvbnRlbnQgPiAudGFiLXBhbmUgewogIGRpc3BsYXk6IG5vbmU7Cn0KLnRhYi1jb250ZW50ID4gLmFjdGl2ZSB7CiAgZGlzcGxheTogYmxvY2s7Cn0KLm5hdi10YWJzIC5kcm9wZG93bi1tZW51IHsKICBtYXJnaW4tdG9wOiAtMXB4OwogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDA7CiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7Cn0KLm5hdmJhciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIG1pbi1oZWlnaHQ6IDUwcHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBib3JkZXI6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyIHsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdmJhci1oZWFkZXIgewogICAgZmxvYXQ6IGxlZnQ7CiAgfQp9Ci5uYXZiYXItY29sbGFwc2UgewogIHBhZGRpbmctcmlnaHQ6IDE1cHg7CiAgcGFkZGluZy1sZWZ0OiAxNXB4OwogIG92ZXJmbG93LXg6IHZpc2libGU7CiAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOwogIGJvcmRlci10b3A6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICAtd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAwIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjEpOwp9Ci5uYXZiYXItY29sbGFwc2UuaW4gewogIG92ZXJmbG93LXk6IGF1dG87Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdmJhci1jb2xsYXBzZSB7CiAgICB3aWR0aDogYXV0bzsKICAgIGJvcmRlci10b3A6IDA7CiAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgfQogIC5uYXZiYXItY29sbGFwc2UuY29sbGFwc2UgewogICAgZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKICAgIGhlaWdodDogYXV0byAhaW1wb3J0YW50OwogICAgcGFkZGluZy1ib3R0b206IDA7CiAgICBvdmVyZmxvdzogdmlzaWJsZSAhaW1wb3J0YW50OwogIH0KICAubmF2YmFyLWNvbGxhcHNlLmluIHsKICAgIG92ZXJmbG93LXk6IHZpc2libGU7CiAgfQogIC5uYXZiYXItZml4ZWQtdG9wIC5uYXZiYXItY29sbGFwc2UsCiAgLm5hdmJhci1zdGF0aWMtdG9wIC5uYXZiYXItY29sbGFwc2UsCiAgLm5hdmJhci1maXhlZC1ib3R0b20gLm5hdmJhci1jb2xsYXBzZSB7CiAgICBwYWRkaW5nLXJpZ2h0OiAwOwogICAgcGFkZGluZy1sZWZ0OiAwOwogIH0KfQoubmF2YmFyLWZpeGVkLXRvcCAubmF2YmFyLWNvbGxhcHNlLAoubmF2YmFyLWZpeGVkLWJvdHRvbSAubmF2YmFyLWNvbGxhcHNlIHsKICBtYXgtaGVpZ2h0OiAzNDBweDsKfQpAbWVkaWEgKG1heC1kZXZpY2Utd2lkdGg6IDQ4MHB4KSBhbmQgKG9yaWVudGF0aW9uOiBsYW5kc2NhcGUpIHsKICAubmF2YmFyLWZpeGVkLXRvcCAubmF2YmFyLWNvbGxhcHNlLAogIC5uYXZiYXItZml4ZWQtYm90dG9tIC5uYXZiYXItY29sbGFwc2UgewogICAgbWF4LWhlaWdodDogMjAwcHg7CiAgfQp9Ci5jb250YWluZXIgPiAubmF2YmFyLWhlYWRlciwKLmNvbnRhaW5lci1mbHVpZCA+IC5uYXZiYXItaGVhZGVyLAouY29udGFpbmVyID4gLm5hdmJhci1jb2xsYXBzZSwKLmNvbnRhaW5lci1mbHVpZCA+IC5uYXZiYXItY29sbGFwc2UgewogIG1hcmdpbi1yaWdodDogLTE1cHg7CiAgbWFyZ2luLWxlZnQ6IC0xNXB4Owp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5jb250YWluZXIgPiAubmF2YmFyLWhlYWRlciwKICAuY29udGFpbmVyLWZsdWlkID4gLm5hdmJhci1oZWFkZXIsCiAgLmNvbnRhaW5lciA+IC5uYXZiYXItY29sbGFwc2UsCiAgLmNvbnRhaW5lci1mbHVpZCA+IC5uYXZiYXItY29sbGFwc2UgewogICAgbWFyZ2luLXJpZ2h0OiAwOwogICAgbWFyZ2luLWxlZnQ6IDA7CiAgfQp9Ci5uYXZiYXItc3RhdGljLXRvcCB7CiAgei1pbmRleDogMTAwMDsKICBib3JkZXItd2lkdGg6IDAgMCAxcHg7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdmJhci1zdGF0aWMtdG9wIHsKICAgIGJvcmRlci1yYWRpdXM6IDA7CiAgfQp9Ci5uYXZiYXItZml4ZWQtdG9wLAoubmF2YmFyLWZpeGVkLWJvdHRvbSB7CiAgcG9zaXRpb246IGZpeGVkOwogIHJpZ2h0OiAwOwogIGxlZnQ6IDA7CiAgei1pbmRleDogMTAzMDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyLWZpeGVkLXRvcCwKICAubmF2YmFyLWZpeGVkLWJvdHRvbSB7CiAgICBib3JkZXItcmFkaXVzOiAwOwogIH0KfQoubmF2YmFyLWZpeGVkLXRvcCB7CiAgdG9wOiAwOwogIGJvcmRlci13aWR0aDogMCAwIDFweDsKfQoubmF2YmFyLWZpeGVkLWJvdHRvbSB7CiAgYm90dG9tOiAwOwogIG1hcmdpbi1ib3R0b206IDA7CiAgYm9yZGVyLXdpZHRoOiAxcHggMCAwOwp9Ci5uYXZiYXItYnJhbmQgewogIGZsb2F0OiBsZWZ0OwogIGhlaWdodDogNTBweDsKICBwYWRkaW5nOiAxNXB4IDE1cHg7CiAgZm9udC1zaXplOiAxOHB4OwogIGxpbmUtaGVpZ2h0OiAyMHB4Owp9Ci5uYXZiYXItYnJhbmQ6aG92ZXIsCi5uYXZiYXItYnJhbmQ6Zm9jdXMgewogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQoubmF2YmFyLWJyYW5kID4gaW1nIHsKICBkaXNwbGF5OiBibG9jazsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyID4gLmNvbnRhaW5lciAubmF2YmFyLWJyYW5kLAogIC5uYXZiYXIgPiAuY29udGFpbmVyLWZsdWlkIC5uYXZiYXItYnJhbmQgewogICAgbWFyZ2luLWxlZnQ6IC0xNXB4OwogIH0KfQoubmF2YmFyLXRvZ2dsZSB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGZsb2F0OiByaWdodDsKICBwYWRkaW5nOiA5cHggMTBweDsKICBtYXJnaW4tdG9wOiA4cHg7CiAgbWFyZ2luLXJpZ2h0OiAxNXB4OwogIG1hcmdpbi1ib3R0b206IDhweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwogIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoubmF2YmFyLXRvZ2dsZTpmb2N1cyB7CiAgb3V0bGluZTogMDsKfQoubmF2YmFyLXRvZ2dsZSAuaWNvbi1iYXIgewogIGRpc3BsYXk6IGJsb2NrOwogIHdpZHRoOiAyMnB4OwogIGhlaWdodDogMnB4OwogIGJvcmRlci1yYWRpdXM6IDFweDsKfQoubmF2YmFyLXRvZ2dsZSAuaWNvbi1iYXIgKyAuaWNvbi1iYXIgewogIG1hcmdpbi10b3A6IDRweDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyLXRvZ2dsZSB7CiAgICBkaXNwbGF5OiBub25lOwogIH0KfQoubmF2YmFyLW5hdiB7CiAgbWFyZ2luOiA3LjVweCAtMTVweDsKfQoubmF2YmFyLW5hdiA+IGxpID4gYSB7CiAgcGFkZGluZy10b3A6IDEwcHg7CiAgcGFkZGluZy1ib3R0b206IDEwcHg7CiAgbGluZS1oZWlnaHQ6IDIwcHg7Cn0KQG1lZGlhIChtYXgtd2lkdGg6IDc2N3B4KSB7CiAgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgewogICAgcG9zaXRpb246IHN0YXRpYzsKICAgIGZsb2F0OiBub25lOwogICAgd2lkdGg6IGF1dG87CiAgICBtYXJnaW4tdG9wOiAwOwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgICBib3JkZXI6IDA7CiAgICAtd2Via2l0LWJveC1zaGFkb3c6IG5vbmU7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgfQogIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gbGkgPiBhLAogIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51IC5kcm9wZG93bi1oZWFkZXIgewogICAgcGFkZGluZzogNXB4IDE1cHggNXB4IDI1cHg7CiAgfQogIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gbGkgPiBhIHsKICAgIGxpbmUtaGVpZ2h0OiAyMHB4OwogIH0KICAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IGxpID4gYTpob3ZlciwKICAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IGxpID4gYTpmb2N1cyB7CiAgICBiYWNrZ3JvdW5kLWltYWdlOiBub25lOwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubmF2YmFyLW5hdiB7CiAgICBmbG9hdDogbGVmdDsKICAgIG1hcmdpbjogMDsKICB9CiAgLm5hdmJhci1uYXYgPiBsaSB7CiAgICBmbG9hdDogbGVmdDsKICB9CiAgLm5hdmJhci1uYXYgPiBsaSA+IGEgewogICAgcGFkZGluZy10b3A6IDE1cHg7CiAgICBwYWRkaW5nLWJvdHRvbTogMTVweDsKICB9Cn0KLm5hdmJhci1mb3JtIHsKICBwYWRkaW5nOiAxMHB4IDE1cHg7CiAgbWFyZ2luLXRvcDogOHB4OwogIG1hcmdpbi1yaWdodDogLTE1cHg7CiAgbWFyZ2luLWJvdHRvbTogOHB4OwogIG1hcmdpbi1sZWZ0OiAtMTVweDsKICBib3JkZXItdG9wOiAxcHggc29saWQgdHJhbnNwYXJlbnQ7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xKSwgMCAxcHggMCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xKTsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMSksIDAgMXB4IDAgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMSk7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdmJhci1mb3JtIC5mb3JtLWdyb3VwIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIG1hcmdpbi1ib3R0b206IDA7CiAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogIH0KICAubmF2YmFyLWZvcm0gLmZvcm0tY29udHJvbCB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICB3aWR0aDogYXV0bzsKICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgfQogIC5uYXZiYXItZm9ybSAuZm9ybS1jb250cm9sLXN0YXRpYyB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgfQogIC5uYXZiYXItZm9ybSAuaW5wdXQtZ3JvdXAgewogICAgZGlzcGxheTogaW5saW5lLXRhYmxlOwogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICB9CiAgLm5hdmJhci1mb3JtIC5pbnB1dC1ncm91cCAuaW5wdXQtZ3JvdXAtYWRkb24sCiAgLm5hdmJhci1mb3JtIC5pbnB1dC1ncm91cCAuaW5wdXQtZ3JvdXAtYnRuLAogIC5uYXZiYXItZm9ybSAuaW5wdXQtZ3JvdXAgLmZvcm0tY29udHJvbCB7CiAgICB3aWR0aDogYXV0bzsKICB9CiAgLm5hdmJhci1mb3JtIC5pbnB1dC1ncm91cCA+IC5mb3JtLWNvbnRyb2wgewogICAgd2lkdGg6IDEwMCU7CiAgfQogIC5uYXZiYXItZm9ybSAuY29udHJvbC1sYWJlbCB7CiAgICBtYXJnaW4tYm90dG9tOiAwOwogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICB9CiAgLm5hdmJhci1mb3JtIC5yYWRpbywKICAubmF2YmFyLWZvcm0gLmNoZWNrYm94IHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIG1hcmdpbi10b3A6IDA7CiAgICBtYXJnaW4tYm90dG9tOiAwOwogICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTsKICB9CiAgLm5hdmJhci1mb3JtIC5yYWRpbyBsYWJlbCwKICAubmF2YmFyLWZvcm0gLmNoZWNrYm94IGxhYmVsIHsKICAgIHBhZGRpbmctbGVmdDogMDsKICB9CiAgLm5hdmJhci1mb3JtIC5yYWRpbyBpbnB1dFt0eXBlPSJyYWRpbyJdLAogIC5uYXZiYXItZm9ybSAuY2hlY2tib3ggaW5wdXRbdHlwZT0iY2hlY2tib3giXSB7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBtYXJnaW4tbGVmdDogMDsKICB9CiAgLm5hdmJhci1mb3JtIC5oYXMtZmVlZGJhY2sgLmZvcm0tY29udHJvbC1mZWVkYmFjayB7CiAgICB0b3A6IDA7CiAgfQp9CkBtZWRpYSAobWF4LXdpZHRoOiA3NjdweCkgewogIC5uYXZiYXItZm9ybSAuZm9ybS1ncm91cCB7CiAgICBtYXJnaW4tYm90dG9tOiA1cHg7CiAgfQogIC5uYXZiYXItZm9ybSAuZm9ybS1ncm91cDpsYXN0LWNoaWxkIHsKICAgIG1hcmdpbi1ib3R0b206IDA7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5uYXZiYXItZm9ybSB7CiAgICB3aWR0aDogYXV0bzsKICAgIHBhZGRpbmctdG9wOiAwOwogICAgcGFkZGluZy1ib3R0b206IDA7CiAgICBtYXJnaW4tcmlnaHQ6IDA7CiAgICBtYXJnaW4tbGVmdDogMDsKICAgIGJvcmRlcjogMDsKICAgIC13ZWJraXQtYm94LXNoYWRvdzogbm9uZTsKICAgICAgICAgICAgYm94LXNoYWRvdzogbm9uZTsKICB9Cn0KLm5hdmJhci1uYXYgPiBsaSA+IC5kcm9wZG93bi1tZW51IHsKICBtYXJnaW4tdG9wOiAwOwogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDA7CiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7Cn0KLm5hdmJhci1maXhlZC1ib3R0b20gLm5hdmJhci1uYXYgPiBsaSA+IC5kcm9wZG93bi1tZW51IHsKICBtYXJnaW4tYm90dG9tOiAwOwogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDRweDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNHB4OwogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAwOwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7Cn0KLm5hdmJhci1idG4gewogIG1hcmdpbi10b3A6IDhweDsKICBtYXJnaW4tYm90dG9tOiA4cHg7Cn0KLm5hdmJhci1idG4uYnRuLXNtIHsKICBtYXJnaW4tdG9wOiAxMHB4OwogIG1hcmdpbi1ib3R0b206IDEwcHg7Cn0KLm5hdmJhci1idG4uYnRuLXhzIHsKICBtYXJnaW4tdG9wOiAxNHB4OwogIG1hcmdpbi1ib3R0b206IDE0cHg7Cn0KLm5hdmJhci10ZXh0IHsKICBtYXJnaW4tdG9wOiAxNXB4OwogIG1hcmdpbi1ib3R0b206IDE1cHg7Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLm5hdmJhci10ZXh0IHsKICAgIGZsb2F0OiBsZWZ0OwogICAgbWFyZ2luLXJpZ2h0OiAxNXB4OwogICAgbWFyZ2luLWxlZnQ6IDE1cHg7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgewogIC5uYXZiYXItbGVmdCB7CiAgICBmbG9hdDogbGVmdCAhaW1wb3J0YW50OwogIH0KICAubmF2YmFyLXJpZ2h0IHsKICAgIGZsb2F0OiByaWdodCAhaW1wb3J0YW50OwogICAgbWFyZ2luLXJpZ2h0OiAtMTVweDsKICB9CiAgLm5hdmJhci1yaWdodCB+IC5uYXZiYXItcmlnaHQgewogICAgbWFyZ2luLXJpZ2h0OiAwOwogIH0KfQoubmF2YmFyLWRlZmF1bHQgewogIGJhY2tncm91bmQtY29sb3I6ICNmOGY4Zjg7CiAgYm9yZGVyLWNvbG9yOiAjZTdlN2U3Owp9Ci5uYXZiYXItZGVmYXVsdCAubmF2YmFyLWJyYW5kIHsKICBjb2xvcjogIzc3NzsKfQoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1icmFuZDpob3ZlciwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItYnJhbmQ6Zm9jdXMgewogIGNvbG9yOiAjNWU1ZTVlOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Owp9Ci5uYXZiYXItZGVmYXVsdCAubmF2YmFyLXRleHQgewogIGNvbG9yOiAjNzc3Owp9Ci5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiA+IGxpID4gYSB7CiAgY29sb3I6ICM3Nzc7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gbGkgPiBhOmhvdmVyLAoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgPiBsaSA+IGE6Zm9jdXMgewogIGNvbG9yOiAjMzMzOwogIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50Owp9Ci5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiA+IC5hY3RpdmUgPiBhLAoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgPiAuYWN0aXZlID4gYTpob3ZlciwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gLmFjdGl2ZSA+IGE6Zm9jdXMgewogIGNvbG9yOiAjNTU1OwogIGJhY2tncm91bmQtY29sb3I6ICNlN2U3ZTc7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gLmRpc2FibGVkID4gYSwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gLmRpc2FibGVkID4gYTpob3ZlciwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gLmRpc2FibGVkID4gYTpmb2N1cyB7CiAgY29sb3I6ICNjY2M7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItdG9nZ2xlIHsKICBib3JkZXItY29sb3I6ICNkZGQ7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItdG9nZ2xlOmhvdmVyLAoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci10b2dnbGU6Zm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICNkZGQ7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItdG9nZ2xlIC5pY29uLWJhciB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzg4ODsKfQoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1jb2xsYXBzZSwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItZm9ybSB7CiAgYm9yZGVyLWNvbG9yOiAjZTdlN2U3Owp9Ci5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiA+IC5vcGVuID4gYSwKLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2ID4gLm9wZW4gPiBhOmhvdmVyLAoubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgPiAub3BlbiA+IGE6Zm9jdXMgewogIGNvbG9yOiAjNTU1OwogIGJhY2tncm91bmQtY29sb3I6ICNlN2U3ZTc7Cn0KQG1lZGlhIChtYXgtd2lkdGg6IDc2N3B4KSB7CiAgLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gbGkgPiBhIHsKICAgIGNvbG9yOiAjNzc3OwogIH0KICAubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiBsaSA+IGE6aG92ZXIsCiAgLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gbGkgPiBhOmZvY3VzIHsKICAgIGNvbG9yOiAjMzMzOwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgfQogIC5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IC5hY3RpdmUgPiBhLAogIC5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IC5hY3RpdmUgPiBhOmhvdmVyLAogIC5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IC5hY3RpdmUgPiBhOmZvY3VzIHsKICAgIGNvbG9yOiAjNTU1OwogICAgYmFja2dyb3VuZC1jb2xvcjogI2U3ZTdlNzsKICB9CiAgLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gLmRpc2FibGVkID4gYSwKICAubmF2YmFyLWRlZmF1bHQgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuZGlzYWJsZWQgPiBhOmhvdmVyLAogIC5uYXZiYXItZGVmYXVsdCAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IC5kaXNhYmxlZCA+IGE6Zm9jdXMgewogICAgY29sb3I6ICNjY2M7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICB9Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbGluayB7CiAgY29sb3I6ICM3Nzc7Cn0KLm5hdmJhci1kZWZhdWx0IC5uYXZiYXItbGluazpob3ZlciB7CiAgY29sb3I6ICMzMzM7Cn0KLm5hdmJhci1kZWZhdWx0IC5idG4tbGluayB7CiAgY29sb3I6ICM3Nzc7Cn0KLm5hdmJhci1kZWZhdWx0IC5idG4tbGluazpob3ZlciwKLm5hdmJhci1kZWZhdWx0IC5idG4tbGluazpmb2N1cyB7CiAgY29sb3I6ICMzMzM7Cn0KLm5hdmJhci1kZWZhdWx0IC5idG4tbGlua1tkaXNhYmxlZF06aG92ZXIsCmZpZWxkc2V0W2Rpc2FibGVkXSAubmF2YmFyLWRlZmF1bHQgLmJ0bi1saW5rOmhvdmVyLAoubmF2YmFyLWRlZmF1bHQgLmJ0bi1saW5rW2Rpc2FibGVkXTpmb2N1cywKZmllbGRzZXRbZGlzYWJsZWRdIC5uYXZiYXItZGVmYXVsdCAuYnRuLWxpbms6Zm9jdXMgewogIGNvbG9yOiAjY2NjOwp9Ci5uYXZiYXItaW52ZXJzZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzIyMjsKICBib3JkZXItY29sb3I6ICMwODA4MDg7Cn0KLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItYnJhbmQgewogIGNvbG9yOiAjOWQ5ZDlkOwp9Ci5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWJyYW5kOmhvdmVyLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1icmFuZDpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItdGV4dCB7CiAgY29sb3I6ICM5ZDlkOWQ7Cn0KLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2ID4gbGkgPiBhIHsKICBjb2xvcjogIzlkOWQ5ZDsKfQoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiBsaSA+IGE6aG92ZXIsCi5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiA+IGxpID4gYTpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Cn0KLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2ID4gLmFjdGl2ZSA+IGEsCi5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiA+IC5hY3RpdmUgPiBhOmhvdmVyLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiAuYWN0aXZlID4gYTpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzA4MDgwODsKfQoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiAuZGlzYWJsZWQgPiBhLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiAuZGlzYWJsZWQgPiBhOmhvdmVyLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiAuZGlzYWJsZWQgPiBhOmZvY3VzIHsKICBjb2xvcjogIzQ0NDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKfQoubmF2YmFyLWludmVyc2UgLm5hdmJhci10b2dnbGUgewogIGJvcmRlci1jb2xvcjogIzMzMzsKfQoubmF2YmFyLWludmVyc2UgLm5hdmJhci10b2dnbGU6aG92ZXIsCi5uYXZiYXItaW52ZXJzZSAubmF2YmFyLXRvZ2dsZTpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKfQoubmF2YmFyLWludmVyc2UgLm5hdmJhci10b2dnbGUgLmljb24tYmFyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwp9Ci5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWNvbGxhcHNlLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1mb3JtIHsKICBib3JkZXItY29sb3I6ICMxMDEwMTA7Cn0KLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2ID4gLm9wZW4gPiBhLAoubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgPiAub3BlbiA+IGE6aG92ZXIsCi5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiA+IC5vcGVuID4gYTpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzA4MDgwODsKfQpAbWVkaWEgKG1heC13aWR0aDogNzY3cHgpIHsKICAubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuZHJvcGRvd24taGVhZGVyIHsKICAgIGJvcmRlci1jb2xvcjogIzA4MDgwODsKICB9CiAgLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51IC5kaXZpZGVyIHsKICAgIGJhY2tncm91bmQtY29sb3I6ICMwODA4MDg7CiAgfQogIC5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IGxpID4gYSB7CiAgICBjb2xvcjogIzlkOWQ5ZDsKICB9CiAgLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gbGkgPiBhOmhvdmVyLAogIC5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IGxpID4gYTpmb2N1cyB7CiAgICBjb2xvcjogI2ZmZjsKICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogIH0KICAubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlID4gYSwKICAubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlID4gYTpob3ZlciwKICAubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuYWN0aXZlID4gYTpmb2N1cyB7CiAgICBjb2xvcjogI2ZmZjsKICAgIGJhY2tncm91bmQtY29sb3I6ICMwODA4MDg7CiAgfQogIC5uYXZiYXItaW52ZXJzZSAubmF2YmFyLW5hdiAub3BlbiAuZHJvcGRvd24tbWVudSA+IC5kaXNhYmxlZCA+IGEsCiAgLm5hdmJhci1pbnZlcnNlIC5uYXZiYXItbmF2IC5vcGVuIC5kcm9wZG93bi1tZW51ID4gLmRpc2FibGVkID4gYTpob3ZlciwKICAubmF2YmFyLWludmVyc2UgLm5hdmJhci1uYXYgLm9wZW4gLmRyb3Bkb3duLW1lbnUgPiAuZGlzYWJsZWQgPiBhOmZvY3VzIHsKICAgIGNvbG9yOiAjNDQ0OwogICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgfQp9Ci5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWxpbmsgewogIGNvbG9yOiAjOWQ5ZDlkOwp9Ci5uYXZiYXItaW52ZXJzZSAubmF2YmFyLWxpbms6aG92ZXIgewogIGNvbG9yOiAjZmZmOwp9Ci5uYXZiYXItaW52ZXJzZSAuYnRuLWxpbmsgewogIGNvbG9yOiAjOWQ5ZDlkOwp9Ci5uYXZiYXItaW52ZXJzZSAuYnRuLWxpbms6aG92ZXIsCi5uYXZiYXItaW52ZXJzZSAuYnRuLWxpbms6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwp9Ci5uYXZiYXItaW52ZXJzZSAuYnRuLWxpbmtbZGlzYWJsZWRdOmhvdmVyLApmaWVsZHNldFtkaXNhYmxlZF0gLm5hdmJhci1pbnZlcnNlIC5idG4tbGluazpob3ZlciwKLm5hdmJhci1pbnZlcnNlIC5idG4tbGlua1tkaXNhYmxlZF06Zm9jdXMsCmZpZWxkc2V0W2Rpc2FibGVkXSAubmF2YmFyLWludmVyc2UgLmJ0bi1saW5rOmZvY3VzIHsKICBjb2xvcjogIzQ0NDsKfQouYnJlYWRjcnVtYiB7CiAgcGFkZGluZzogOHB4IDE1cHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBsaXN0LXN0eWxlOiBub25lOwogIGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CiAgYm9yZGVyLXJhZGl1czogNHB4Owp9Ci5icmVhZGNydW1iID4gbGkgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKfQouYnJlYWRjcnVtYiA+IGxpICsgbGk6YmVmb3JlIHsKICBwYWRkaW5nOiAwIDVweDsKICBjb2xvcjogI2NjYzsKICBjb250ZW50OiAiL1wwMGEwIjsKfQouYnJlYWRjcnVtYiA+IC5hY3RpdmUgewogIGNvbG9yOiAjNzc3Owp9Ci5wYWdpbmF0aW9uIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgcGFkZGluZy1sZWZ0OiAwOwogIG1hcmdpbjogMjBweCAwOwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQoucGFnaW5hdGlvbiA+IGxpIHsKICBkaXNwbGF5OiBpbmxpbmU7Cn0KLnBhZ2luYXRpb24gPiBsaSA+IGEsCi5wYWdpbmF0aW9uID4gbGkgPiBzcGFuIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgZmxvYXQ6IGxlZnQ7CiAgcGFkZGluZzogNnB4IDEycHg7CiAgbWFyZ2luLWxlZnQ6IC0xcHg7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgY29sb3I6ICMzMzdhYjc7CiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKfQoucGFnaW5hdGlvbiA+IGxpOmZpcnN0LWNoaWxkID4gYSwKLnBhZ2luYXRpb24gPiBsaTpmaXJzdC1jaGlsZCA+IHNwYW4gewogIG1hcmdpbi1sZWZ0OiAwOwogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDRweDsKICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiA0cHg7Cn0KLnBhZ2luYXRpb24gPiBsaTpsYXN0LWNoaWxkID4gYSwKLnBhZ2luYXRpb24gPiBsaTpsYXN0LWNoaWxkID4gc3BhbiB7CiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDRweDsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNHB4Owp9Ci5wYWdpbmF0aW9uID4gbGkgPiBhOmhvdmVyLAoucGFnaW5hdGlvbiA+IGxpID4gc3Bhbjpob3ZlciwKLnBhZ2luYXRpb24gPiBsaSA+IGE6Zm9jdXMsCi5wYWdpbmF0aW9uID4gbGkgPiBzcGFuOmZvY3VzIHsKICB6LWluZGV4OiAyOwogIGNvbG9yOiAjMjM1MjdjOwogIGJhY2tncm91bmQtY29sb3I6ICNlZWU7CiAgYm9yZGVyLWNvbG9yOiAjZGRkOwp9Ci5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IGEsCi5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IHNwYW4sCi5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IGE6aG92ZXIsCi5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IHNwYW46aG92ZXIsCi5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IGE6Zm9jdXMsCi5wYWdpbmF0aW9uID4gLmFjdGl2ZSA+IHNwYW46Zm9jdXMgewogIHotaW5kZXg6IDM7CiAgY29sb3I6ICNmZmY7CiAgY3Vyc29yOiBkZWZhdWx0OwogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLWNvbG9yOiAjMzM3YWI3Owp9Ci5wYWdpbmF0aW9uID4gLmRpc2FibGVkID4gc3BhbiwKLnBhZ2luYXRpb24gPiAuZGlzYWJsZWQgPiBzcGFuOmhvdmVyLAoucGFnaW5hdGlvbiA+IC5kaXNhYmxlZCA+IHNwYW46Zm9jdXMsCi5wYWdpbmF0aW9uID4gLmRpc2FibGVkID4gYSwKLnBhZ2luYXRpb24gPiAuZGlzYWJsZWQgPiBhOmhvdmVyLAoucGFnaW5hdGlvbiA+IC5kaXNhYmxlZCA+IGE6Zm9jdXMgewogIGNvbG9yOiAjNzc3OwogIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXItY29sb3I6ICNkZGQ7Cn0KLnBhZ2luYXRpb24tbGcgPiBsaSA+IGEsCi5wYWdpbmF0aW9uLWxnID4gbGkgPiBzcGFuIHsKICBwYWRkaW5nOiAxMHB4IDE2cHg7CiAgZm9udC1zaXplOiAxOHB4OwogIGxpbmUtaGVpZ2h0OiAxLjMzMzMzMzM7Cn0KLnBhZ2luYXRpb24tbGcgPiBsaTpmaXJzdC1jaGlsZCA+IGEsCi5wYWdpbmF0aW9uLWxnID4gbGk6Zmlyc3QtY2hpbGQgPiBzcGFuIHsKICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiA2cHg7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNnB4Owp9Ci5wYWdpbmF0aW9uLWxnID4gbGk6bGFzdC1jaGlsZCA+IGEsCi5wYWdpbmF0aW9uLWxnID4gbGk6bGFzdC1jaGlsZCA+IHNwYW4gewogIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiA2cHg7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDZweDsKfQoucGFnaW5hdGlvbi1zbSA+IGxpID4gYSwKLnBhZ2luYXRpb24tc20gPiBsaSA+IHNwYW4gewogIHBhZGRpbmc6IDVweCAxMHB4OwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogMS41Owp9Ci5wYWdpbmF0aW9uLXNtID4gbGk6Zmlyc3QtY2hpbGQgPiBhLAoucGFnaW5hdGlvbi1zbSA+IGxpOmZpcnN0LWNoaWxkID4gc3BhbiB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogM3B4OwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDNweDsKfQoucGFnaW5hdGlvbi1zbSA+IGxpOmxhc3QtY2hpbGQgPiBhLAoucGFnaW5hdGlvbi1zbSA+IGxpOmxhc3QtY2hpbGQgPiBzcGFuIHsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogM3B4OwogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAzcHg7Cn0KLnBhZ2VyIHsKICBwYWRkaW5nLWxlZnQ6IDA7CiAgbWFyZ2luOiAyMHB4IDA7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGxpc3Qtc3R5bGU6IG5vbmU7Cn0KLnBhZ2VyIGxpIHsKICBkaXNwbGF5OiBpbmxpbmU7Cn0KLnBhZ2VyIGxpID4gYSwKLnBhZ2VyIGxpID4gc3BhbiB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmc6IDVweCAxNHB4OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsKICBib3JkZXItcmFkaXVzOiAxNXB4Owp9Ci5wYWdlciBsaSA+IGE6aG92ZXIsCi5wYWdlciBsaSA+IGE6Zm9jdXMgewogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZWVlOwp9Ci5wYWdlciAubmV4dCA+IGEsCi5wYWdlciAubmV4dCA+IHNwYW4gewogIGZsb2F0OiByaWdodDsKfQoucGFnZXIgLnByZXZpb3VzID4gYSwKLnBhZ2VyIC5wcmV2aW91cyA+IHNwYW4gewogIGZsb2F0OiBsZWZ0Owp9Ci5wYWdlciAuZGlzYWJsZWQgPiBhLAoucGFnZXIgLmRpc2FibGVkID4gYTpob3ZlciwKLnBhZ2VyIC5kaXNhYmxlZCA+IGE6Zm9jdXMsCi5wYWdlciAuZGlzYWJsZWQgPiBzcGFuIHsKICBjb2xvcjogIzc3NzsKICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0KLmxhYmVsIHsKICBkaXNwbGF5OiBpbmxpbmU7CiAgcGFkZGluZzogLjJlbSAuNmVtIC4zZW07CiAgZm9udC1zaXplOiA3NSU7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgbGluZS1oZWlnaHQ6IDE7CiAgY29sb3I6ICNmZmY7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOwogIGJvcmRlci1yYWRpdXM6IC4yNWVtOwp9CmEubGFiZWw6aG92ZXIsCmEubGFiZWw6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBjdXJzb3I6IHBvaW50ZXI7Cn0KLmxhYmVsOmVtcHR5IHsKICBkaXNwbGF5OiBub25lOwp9Ci5idG4gLmxhYmVsIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgdG9wOiAtMXB4Owp9Ci5sYWJlbC1kZWZhdWx0IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNzc3Owp9Ci5sYWJlbC1kZWZhdWx0W2hyZWZdOmhvdmVyLAoubGFiZWwtZGVmYXVsdFtocmVmXTpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzVlNWU1ZTsKfQoubGFiZWwtcHJpbWFyeSB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzN2FiNzsKfQoubGFiZWwtcHJpbWFyeVtocmVmXTpob3ZlciwKLmxhYmVsLXByaW1hcnlbaHJlZl06Zm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICMyODYwOTA7Cn0KLmxhYmVsLXN1Y2Nlc3MgewogIGJhY2tncm91bmQtY29sb3I6ICM1Y2I4NWM7Cn0KLmxhYmVsLXN1Y2Nlc3NbaHJlZl06aG92ZXIsCi5sYWJlbC1zdWNjZXNzW2hyZWZdOmZvY3VzIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDQ5ZDQ0Owp9Ci5sYWJlbC1pbmZvIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNWJjMGRlOwp9Ci5sYWJlbC1pbmZvW2hyZWZdOmhvdmVyLAoubGFiZWwtaW5mb1tocmVmXTpmb2N1cyB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMxYjBkNTsKfQoubGFiZWwtd2FybmluZyB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2YwYWQ0ZTsKfQoubGFiZWwtd2FybmluZ1tocmVmXTpob3ZlciwKLmxhYmVsLXdhcm5pbmdbaHJlZl06Zm9jdXMgewogIGJhY2tncm91bmQtY29sb3I6ICNlYzk3MWY7Cn0KLmxhYmVsLWRhbmdlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Q5NTM0ZjsKfQoubGFiZWwtZGFuZ2VyW2hyZWZdOmhvdmVyLAoubGFiZWwtZGFuZ2VyW2hyZWZdOmZvY3VzIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjYzkzMDJjOwp9Ci5iYWRnZSB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1pbi13aWR0aDogMTBweDsKICBwYWRkaW5nOiAzcHggN3B4OwogIGZvbnQtc2l6ZTogMTJweDsKICBmb250LXdlaWdodDogYm9sZDsKICBsaW5lLWhlaWdodDogMTsKICBjb2xvcjogI2ZmZjsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogIGJhY2tncm91bmQtY29sb3I6ICM3Nzc7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKfQouYmFkZ2U6ZW1wdHkgewogIGRpc3BsYXk6IG5vbmU7Cn0KLmJ0biAuYmFkZ2UgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB0b3A6IC0xcHg7Cn0KLmJ0bi14cyAuYmFkZ2UsCi5idG4tZ3JvdXAteHMgPiAuYnRuIC5iYWRnZSB7CiAgdG9wOiAwOwogIHBhZGRpbmc6IDFweCA1cHg7Cn0KYS5iYWRnZTpob3ZlciwKYS5iYWRnZTpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogIGN1cnNvcjogcG9pbnRlcjsKfQoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZSA+IC5iYWRnZSwKLm5hdi1waWxscyA+IC5hY3RpdmUgPiBhID4gLmJhZGdlIHsKICBjb2xvcjogIzMzN2FiNzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwp9Ci5saXN0LWdyb3VwLWl0ZW0gPiAuYmFkZ2UgewogIGZsb2F0OiByaWdodDsKfQoubGlzdC1ncm91cC1pdGVtID4gLmJhZGdlICsgLmJhZGdlIHsKICBtYXJnaW4tcmlnaHQ6IDVweDsKfQoubmF2LXBpbGxzID4gbGkgPiBhID4gLmJhZGdlIHsKICBtYXJnaW4tbGVmdDogM3B4Owp9Ci5qdW1ib3Ryb24gewogIHBhZGRpbmctdG9wOiAzMHB4OwogIHBhZGRpbmctYm90dG9tOiAzMHB4OwogIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgY29sb3I6IGluaGVyaXQ7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTsKfQouanVtYm90cm9uIGgxLAouanVtYm90cm9uIC5oMSB7CiAgY29sb3I6IGluaGVyaXQ7Cn0KLmp1bWJvdHJvbiBwIHsKICBtYXJnaW4tYm90dG9tOiAxNXB4OwogIGZvbnQtc2l6ZTogMjFweDsKICBmb250LXdlaWdodDogMjAwOwp9Ci5qdW1ib3Ryb24gPiBociB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2Q1ZDVkNTsKfQouY29udGFpbmVyIC5qdW1ib3Ryb24sCi5jb250YWluZXItZmx1aWQgLmp1bWJvdHJvbiB7CiAgcGFkZGluZy1yaWdodDogMTVweDsKICBwYWRkaW5nLWxlZnQ6IDE1cHg7CiAgYm9yZGVyLXJhZGl1czogNnB4Owp9Ci5qdW1ib3Ryb24gLmNvbnRhaW5lciB7CiAgbWF4LXdpZHRoOiAxMDAlOwp9CkBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmp1bWJvdHJvbiB7CiAgICBwYWRkaW5nLXRvcDogNDhweDsKICAgIHBhZGRpbmctYm90dG9tOiA0OHB4OwogIH0KICAuY29udGFpbmVyIC5qdW1ib3Ryb24sCiAgLmNvbnRhaW5lci1mbHVpZCAuanVtYm90cm9uIHsKICAgIHBhZGRpbmctcmlnaHQ6IDYwcHg7CiAgICBwYWRkaW5nLWxlZnQ6IDYwcHg7CiAgfQogIC5qdW1ib3Ryb24gaDEsCiAgLmp1bWJvdHJvbiAuaDEgewogICAgZm9udC1zaXplOiA2M3B4OwogIH0KfQoudGh1bWJuYWlsIHsKICBkaXNwbGF5OiBibG9jazsKICBwYWRkaW5nOiA0cHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIC13ZWJraXQtdHJhbnNpdGlvbjogYm9yZGVyIC4ycyBlYXNlLWluLW91dDsKICAgICAgIC1vLXRyYW5zaXRpb246IGJvcmRlciAuMnMgZWFzZS1pbi1vdXQ7CiAgICAgICAgICB0cmFuc2l0aW9uOiBib3JkZXIgLjJzIGVhc2UtaW4tb3V0Owp9Ci50aHVtYm5haWwgPiBpbWcsCi50aHVtYm5haWwgYSA+IGltZyB7CiAgbWFyZ2luLXJpZ2h0OiBhdXRvOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9CmEudGh1bWJuYWlsOmhvdmVyLAphLnRodW1ibmFpbDpmb2N1cywKYS50aHVtYm5haWwuYWN0aXZlIHsKICBib3JkZXItY29sb3I6ICMzMzdhYjc7Cn0KLnRodW1ibmFpbCAuY2FwdGlvbiB7CiAgcGFkZGluZzogOXB4OwogIGNvbG9yOiAjMzMzOwp9Ci5hbGVydCB7CiAgcGFkZGluZzogMTVweDsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1yYWRpdXM6IDRweDsKfQouYWxlcnQgaDQgewogIG1hcmdpbi10b3A6IDA7CiAgY29sb3I6IGluaGVyaXQ7Cn0KLmFsZXJ0IC5hbGVydC1saW5rIHsKICBmb250LXdlaWdodDogYm9sZDsKfQouYWxlcnQgPiBwLAouYWxlcnQgPiB1bCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQouYWxlcnQgPiBwICsgcCB7CiAgbWFyZ2luLXRvcDogNXB4Owp9Ci5hbGVydC1kaXNtaXNzYWJsZSwKLmFsZXJ0LWRpc21pc3NpYmxlIHsKICBwYWRkaW5nLXJpZ2h0OiAzNXB4Owp9Ci5hbGVydC1kaXNtaXNzYWJsZSAuY2xvc2UsCi5hbGVydC1kaXNtaXNzaWJsZSAuY2xvc2UgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB0b3A6IC0ycHg7CiAgcmlnaHQ6IC0yMXB4OwogIGNvbG9yOiBpbmhlcml0Owp9Ci5hbGVydC1zdWNjZXNzIHsKICBjb2xvcjogIzNjNzYzZDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZGZmMGQ4OwogIGJvcmRlci1jb2xvcjogI2Q2ZTljNjsKfQouYWxlcnQtc3VjY2VzcyBociB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2M5ZTJiMzsKfQouYWxlcnQtc3VjY2VzcyAuYWxlcnQtbGluayB7CiAgY29sb3I6ICMyYjU0MmM7Cn0KLmFsZXJ0LWluZm8gewogIGNvbG9yOiAjMzE3MDhmOwogIGJhY2tncm91bmQtY29sb3I6ICNkOWVkZjc7CiAgYm9yZGVyLWNvbG9yOiAjYmNlOGYxOwp9Ci5hbGVydC1pbmZvIGhyIHsKICBib3JkZXItdG9wLWNvbG9yOiAjYTZlMWVjOwp9Ci5hbGVydC1pbmZvIC5hbGVydC1saW5rIHsKICBjb2xvcjogIzI0NTI2OTsKfQouYWxlcnQtd2FybmluZyB7CiAgY29sb3I6ICM4YTZkM2I7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZjZjhlMzsKICBib3JkZXItY29sb3I6ICNmYWViY2M7Cn0KLmFsZXJ0LXdhcm5pbmcgaHIgewogIGJvcmRlci10b3AtY29sb3I6ICNmN2UxYjU7Cn0KLmFsZXJ0LXdhcm5pbmcgLmFsZXJ0LWxpbmsgewogIGNvbG9yOiAjNjY1MTJjOwp9Ci5hbGVydC1kYW5nZXIgewogIGNvbG9yOiAjYTk0NDQyOwogIGJhY2tncm91bmQtY29sb3I6ICNmMmRlZGU7CiAgYm9yZGVyLWNvbG9yOiAjZWJjY2QxOwp9Ci5hbGVydC1kYW5nZXIgaHIgewogIGJvcmRlci10b3AtY29sb3I6ICNlNGI5YzA7Cn0KLmFsZXJ0LWRhbmdlciAuYWxlcnQtbGluayB7CiAgY29sb3I6ICM4NDM1MzQ7Cn0KQC13ZWJraXQta2V5ZnJhbWVzIHByb2dyZXNzLWJhci1zdHJpcGVzIHsKICBmcm9tIHsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IDQwcHggMDsKICB9CiAgdG8gewogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwOwogIH0KfQpALW8ta2V5ZnJhbWVzIHByb2dyZXNzLWJhci1zdHJpcGVzIHsKICBmcm9tIHsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IDQwcHggMDsKICB9CiAgdG8gewogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwOwogIH0KfQpAa2V5ZnJhbWVzIHByb2dyZXNzLWJhci1zdHJpcGVzIHsKICBmcm9tIHsKICAgIGJhY2tncm91bmQtcG9zaXRpb246IDQwcHggMDsKICB9CiAgdG8gewogICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAwOwogIH0KfQoucHJvZ3Jlc3MgewogIGhlaWdodDogMjBweDsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIG92ZXJmbG93OiBoaWRkZW47CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiBpbnNldCAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAuMSk7CiAgICAgICAgICBib3gtc2hhZG93OiBpbnNldCAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAuMSk7Cn0KLnByb2dyZXNzLWJhciB7CiAgZmxvYXQ6IGxlZnQ7CiAgd2lkdGg6IDA7CiAgaGVpZ2h0OiAxMDAlOwogIGZvbnQtc2l6ZTogMTJweDsKICBsaW5lLWhlaWdodDogMjBweDsKICBjb2xvcjogI2ZmZjsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzN2FiNzsKICAtd2Via2l0LWJveC1zaGFkb3c6IGluc2V0IDAgLTFweCAwIHJnYmEoMCwgMCwgMCwgLjE1KTsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgLTFweCAwIHJnYmEoMCwgMCwgMCwgLjE1KTsKICAtd2Via2l0LXRyYW5zaXRpb246IHdpZHRoIC42cyBlYXNlOwogICAgICAgLW8tdHJhbnNpdGlvbjogd2lkdGggLjZzIGVhc2U7CiAgICAgICAgICB0cmFuc2l0aW9uOiB3aWR0aCAuNnMgZWFzZTsKfQoucHJvZ3Jlc3Mtc3RyaXBlZCAucHJvZ3Jlc3MtYmFyLAoucHJvZ3Jlc3MtYmFyLXN0cmlwZWQgewogIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CiAgYmFja2dyb3VuZC1pbWFnZTogICAgICAtby1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKICBiYWNrZ3JvdW5kLWltYWdlOiAgICAgICAgIGxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwogIC13ZWJraXQtYmFja2dyb3VuZC1zaXplOiA0MHB4IDQwcHg7CiAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6IDQwcHggNDBweDsKfQoucHJvZ3Jlc3MuYWN0aXZlIC5wcm9ncmVzcy1iYXIsCi5wcm9ncmVzcy1iYXIuYWN0aXZlIHsKICAtd2Via2l0LWFuaW1hdGlvbjogcHJvZ3Jlc3MtYmFyLXN0cmlwZXMgMnMgbGluZWFyIGluZmluaXRlOwogICAgICAgLW8tYW5pbWF0aW9uOiBwcm9ncmVzcy1iYXItc3RyaXBlcyAycyBsaW5lYXIgaW5maW5pdGU7CiAgICAgICAgICBhbmltYXRpb246IHByb2dyZXNzLWJhci1zdHJpcGVzIDJzIGxpbmVhciBpbmZpbml0ZTsKfQoucHJvZ3Jlc3MtYmFyLXN1Y2Nlc3MgewogIGJhY2tncm91bmQtY29sb3I6ICM1Y2I4NWM7Cn0KLnByb2dyZXNzLXN0cmlwZWQgLnByb2dyZXNzLWJhci1zdWNjZXNzIHsKICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgLW8tbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CiAgYmFja2dyb3VuZC1pbWFnZTogICAgICAgICBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKfQoucHJvZ3Jlc3MtYmFyLWluZm8gewogIGJhY2tncm91bmQtY29sb3I6ICM1YmMwZGU7Cn0KLnByb2dyZXNzLXN0cmlwZWQgLnByb2dyZXNzLWJhci1pbmZvIHsKICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgLW8tbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CiAgYmFja2dyb3VuZC1pbWFnZTogICAgICAgICBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKfQoucHJvZ3Jlc3MtYmFyLXdhcm5pbmcgewogIGJhY2tncm91bmQtY29sb3I6ICNmMGFkNGU7Cn0KLnByb2dyZXNzLXN0cmlwZWQgLnByb2dyZXNzLWJhci13YXJuaW5nIHsKICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgLW8tbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7CiAgYmFja2dyb3VuZC1pbWFnZTogICAgICAgICBsaW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKfQoucHJvZ3Jlc3MtYmFyLWRhbmdlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Q5NTM0ZjsKfQoucHJvZ3Jlc3Mtc3RyaXBlZCAucHJvZ3Jlc3MtYmFyLWRhbmdlciB7CiAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQoNDVkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSAyNSUsIHRyYW5zcGFyZW50IDI1JSwgdHJhbnNwYXJlbnQgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNTAlLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgNzUlLCB0cmFuc3BhcmVudCA3NSUsIHRyYW5zcGFyZW50KTsKICBiYWNrZ3JvdW5kLWltYWdlOiAgICAgIC1vLWxpbmVhci1ncmFkaWVudCg0NWRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDI1JSwgdHJhbnNwYXJlbnQgMjUlLCB0cmFuc3BhcmVudCA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA1MCUsIHJnYmEoMjU1LCAyNTUsIDI1NSwgLjE1KSA3NSUsIHRyYW5zcGFyZW50IDc1JSwgdHJhbnNwYXJlbnQpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgICAgbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCByZ2JhKDI1NSwgMjU1LCAyNTUsIC4xNSkgMjUlLCB0cmFuc3BhcmVudCAyNSUsIHRyYW5zcGFyZW50IDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDUwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAuMTUpIDc1JSwgdHJhbnNwYXJlbnQgNzUlLCB0cmFuc3BhcmVudCk7Cn0KLm1lZGlhIHsKICBtYXJnaW4tdG9wOiAxNXB4Owp9Ci5tZWRpYTpmaXJzdC1jaGlsZCB7CiAgbWFyZ2luLXRvcDogMDsKfQoubWVkaWEsCi5tZWRpYS1ib2R5IHsKICBvdmVyZmxvdzogaGlkZGVuOwogIHpvb206IDE7Cn0KLm1lZGlhLWJvZHkgewogIHdpZHRoOiAxMDAwMHB4Owp9Ci5tZWRpYS1vYmplY3QgewogIGRpc3BsYXk6IGJsb2NrOwp9Ci5tZWRpYS1vYmplY3QuaW1nLXRodW1ibmFpbCB7CiAgbWF4LXdpZHRoOiBub25lOwp9Ci5tZWRpYS1yaWdodCwKLm1lZGlhID4gLnB1bGwtcmlnaHQgewogIHBhZGRpbmctbGVmdDogMTBweDsKfQoubWVkaWEtbGVmdCwKLm1lZGlhID4gLnB1bGwtbGVmdCB7CiAgcGFkZGluZy1yaWdodDogMTBweDsKfQoubWVkaWEtbGVmdCwKLm1lZGlhLXJpZ2h0LAoubWVkaWEtYm9keSB7CiAgZGlzcGxheTogdGFibGUtY2VsbDsKICB2ZXJ0aWNhbC1hbGlnbjogdG9wOwp9Ci5tZWRpYS1taWRkbGUgewogIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7Cn0KLm1lZGlhLWJvdHRvbSB7CiAgdmVydGljYWwtYWxpZ246IGJvdHRvbTsKfQoubWVkaWEtaGVhZGluZyB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiA1cHg7Cn0KLm1lZGlhLWxpc3QgewogIHBhZGRpbmctbGVmdDogMDsKICBsaXN0LXN0eWxlOiBub25lOwp9Ci5saXN0LWdyb3VwIHsKICBwYWRkaW5nLWxlZnQ6IDA7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKfQoubGlzdC1ncm91cC1pdGVtIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgZGlzcGxheTogYmxvY2s7CiAgcGFkZGluZzogMTBweCAxNXB4OwogIG1hcmdpbi1ib3R0b206IC0xcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwp9Ci5saXN0LWdyb3VwLWl0ZW06Zmlyc3QtY2hpbGQgewogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDRweDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNHB4Owp9Ci5saXN0LWdyb3VwLWl0ZW06bGFzdC1jaGlsZCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogNHB4OwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDRweDsKfQphLmxpc3QtZ3JvdXAtaXRlbSwKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbSB7CiAgY29sb3I6ICM1NTU7Cn0KYS5saXN0LWdyb3VwLWl0ZW0gLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nLApidXR0b24ubGlzdC1ncm91cC1pdGVtIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyB7CiAgY29sb3I6ICMzMzM7Cn0KYS5saXN0LWdyb3VwLWl0ZW06aG92ZXIsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW06aG92ZXIsCmEubGlzdC1ncm91cC1pdGVtOmZvY3VzLApidXR0b24ubGlzdC1ncm91cC1pdGVtOmZvY3VzIHsKICBjb2xvcjogIzU1NTsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsKfQpidXR0b24ubGlzdC1ncm91cC1pdGVtIHsKICB3aWR0aDogMTAwJTsKICB0ZXh0LWFsaWduOiBsZWZ0Owp9Ci5saXN0LWdyb3VwLWl0ZW0uZGlzYWJsZWQsCi5saXN0LWdyb3VwLWl0ZW0uZGlzYWJsZWQ6aG92ZXIsCi5saXN0LWdyb3VwLWl0ZW0uZGlzYWJsZWQ6Zm9jdXMgewogIGNvbG9yOiAjNzc3OwogIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgYmFja2dyb3VuZC1jb2xvcjogI2VlZTsKfQoubGlzdC1ncm91cC1pdGVtLmRpc2FibGVkIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZywKLmxpc3QtZ3JvdXAtaXRlbS5kaXNhYmxlZDpob3ZlciAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcsCi5saXN0LWdyb3VwLWl0ZW0uZGlzYWJsZWQ6Zm9jdXMgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nIHsKICBjb2xvcjogaW5oZXJpdDsKfQoubGlzdC1ncm91cC1pdGVtLmRpc2FibGVkIC5saXN0LWdyb3VwLWl0ZW0tdGV4dCwKLmxpc3QtZ3JvdXAtaXRlbS5kaXNhYmxlZDpob3ZlciAubGlzdC1ncm91cC1pdGVtLXRleHQsCi5saXN0LWdyb3VwLWl0ZW0uZGlzYWJsZWQ6Zm9jdXMgLmxpc3QtZ3JvdXAtaXRlbS10ZXh0IHsKICBjb2xvcjogIzc3NzsKfQoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZSwKLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6aG92ZXIsCi5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlOmZvY3VzIHsKICB6LWluZGV4OiAyOwogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLWNvbG9yOiAjMzM3YWI3Owp9Ci5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZywKLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6aG92ZXIgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nLAoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpmb2N1cyAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcsCi5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyA+IHNtYWxsLAoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpob3ZlciAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcgPiBzbWFsbCwKLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6Zm9jdXMgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nID4gc21hbGwsCi5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyA+IC5zbWFsbCwKLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6aG92ZXIgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nID4gLnNtYWxsLAoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpmb2N1cyAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcgPiAuc21hbGwgewogIGNvbG9yOiBpbmhlcml0Owp9Ci5saXN0LWdyb3VwLWl0ZW0uYWN0aXZlIC5saXN0LWdyb3VwLWl0ZW0tdGV4dCwKLmxpc3QtZ3JvdXAtaXRlbS5hY3RpdmU6aG92ZXIgLmxpc3QtZ3JvdXAtaXRlbS10ZXh0LAoubGlzdC1ncm91cC1pdGVtLmFjdGl2ZTpmb2N1cyAubGlzdC1ncm91cC1pdGVtLXRleHQgewogIGNvbG9yOiAjYzdkZGVmOwp9Ci5saXN0LWdyb3VwLWl0ZW0tc3VjY2VzcyB7CiAgY29sb3I6ICMzYzc2M2Q7CiAgYmFja2dyb3VuZC1jb2xvcjogI2RmZjBkODsKfQphLmxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzLApidXR0b24ubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MgewogIGNvbG9yOiAjM2M3NjNkOwp9CmEubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nLApidXR0b24ubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MgLmxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nIHsKICBjb2xvcjogaW5oZXJpdDsKfQphLmxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzOmhvdmVyLApidXR0b24ubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3M6aG92ZXIsCmEubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3M6Zm9jdXMsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0tc3VjY2Vzczpmb2N1cyB7CiAgY29sb3I6ICMzYzc2M2Q7CiAgYmFja2dyb3VuZC1jb2xvcjogI2QwZTljNjsKfQphLmxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzLmFjdGl2ZSwKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1zdWNjZXNzLmFjdGl2ZSwKYS5saXN0LWdyb3VwLWl0ZW0tc3VjY2Vzcy5hY3RpdmU6aG92ZXIsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0tc3VjY2Vzcy5hY3RpdmU6aG92ZXIsCmEubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MuYWN0aXZlOmZvY3VzLApidXR0b24ubGlzdC1ncm91cC1pdGVtLXN1Y2Nlc3MuYWN0aXZlOmZvY3VzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2M3NjNkOwogIGJvcmRlci1jb2xvcjogIzNjNzYzZDsKfQoubGlzdC1ncm91cC1pdGVtLWluZm8gewogIGNvbG9yOiAjMzE3MDhmOwogIGJhY2tncm91bmQtY29sb3I6ICNkOWVkZjc7Cn0KYS5saXN0LWdyb3VwLWl0ZW0taW5mbywKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1pbmZvIHsKICBjb2xvcjogIzMxNzA4ZjsKfQphLmxpc3QtZ3JvdXAtaXRlbS1pbmZvIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZywKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1pbmZvIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyB7CiAgY29sb3I6IGluaGVyaXQ7Cn0KYS5saXN0LWdyb3VwLWl0ZW0taW5mbzpob3ZlciwKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1pbmZvOmhvdmVyLAphLmxpc3QtZ3JvdXAtaXRlbS1pbmZvOmZvY3VzLApidXR0b24ubGlzdC1ncm91cC1pdGVtLWluZm86Zm9jdXMgewogIGNvbG9yOiAjMzE3MDhmOwogIGJhY2tncm91bmQtY29sb3I6ICNjNGUzZjM7Cn0KYS5saXN0LWdyb3VwLWl0ZW0taW5mby5hY3RpdmUsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0taW5mby5hY3RpdmUsCmEubGlzdC1ncm91cC1pdGVtLWluZm8uYWN0aXZlOmhvdmVyLApidXR0b24ubGlzdC1ncm91cC1pdGVtLWluZm8uYWN0aXZlOmhvdmVyLAphLmxpc3QtZ3JvdXAtaXRlbS1pbmZvLmFjdGl2ZTpmb2N1cywKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1pbmZvLmFjdGl2ZTpmb2N1cyB7CiAgY29sb3I6ICNmZmY7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMxNzA4ZjsKICBib3JkZXItY29sb3I6ICMzMTcwOGY7Cn0KLmxpc3QtZ3JvdXAtaXRlbS13YXJuaW5nIHsKICBjb2xvcjogIzhhNmQzYjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmNmOGUzOwp9CmEubGlzdC1ncm91cC1pdGVtLXdhcm5pbmcsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0td2FybmluZyB7CiAgY29sb3I6ICM4YTZkM2I7Cn0KYS5saXN0LWdyb3VwLWl0ZW0td2FybmluZyAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0td2FybmluZyAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcgewogIGNvbG9yOiBpbmhlcml0Owp9CmEubGlzdC1ncm91cC1pdGVtLXdhcm5pbmc6aG92ZXIsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0td2FybmluZzpob3ZlciwKYS5saXN0LWdyb3VwLWl0ZW0td2FybmluZzpmb2N1cywKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS13YXJuaW5nOmZvY3VzIHsKICBjb2xvcjogIzhhNmQzYjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmFmMmNjOwp9CmEubGlzdC1ncm91cC1pdGVtLXdhcm5pbmcuYWN0aXZlLApidXR0b24ubGlzdC1ncm91cC1pdGVtLXdhcm5pbmcuYWN0aXZlLAphLmxpc3QtZ3JvdXAtaXRlbS13YXJuaW5nLmFjdGl2ZTpob3ZlciwKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS13YXJuaW5nLmFjdGl2ZTpob3ZlciwKYS5saXN0LWdyb3VwLWl0ZW0td2FybmluZy5hY3RpdmU6Zm9jdXMsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0td2FybmluZy5hY3RpdmU6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICM4YTZkM2I7CiAgYm9yZGVyLWNvbG9yOiAjOGE2ZDNiOwp9Ci5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyIHsKICBjb2xvcjogI2E5NDQ0MjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJkZWRlOwp9CmEubGlzdC1ncm91cC1pdGVtLWRhbmdlciwKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1kYW5nZXIgewogIGNvbG9yOiAjYTk0NDQyOwp9CmEubGlzdC1ncm91cC1pdGVtLWRhbmdlciAubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyIC5saXN0LWdyb3VwLWl0ZW0taGVhZGluZyB7CiAgY29sb3I6IGluaGVyaXQ7Cn0KYS5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyOmhvdmVyLApidXR0b24ubGlzdC1ncm91cC1pdGVtLWRhbmdlcjpob3ZlciwKYS5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyOmZvY3VzLApidXR0b24ubGlzdC1ncm91cC1pdGVtLWRhbmdlcjpmb2N1cyB7CiAgY29sb3I6ICNhOTQ0NDI7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ViY2NjYzsKfQphLmxpc3QtZ3JvdXAtaXRlbS1kYW5nZXIuYWN0aXZlLApidXR0b24ubGlzdC1ncm91cC1pdGVtLWRhbmdlci5hY3RpdmUsCmEubGlzdC1ncm91cC1pdGVtLWRhbmdlci5hY3RpdmU6aG92ZXIsCmJ1dHRvbi5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyLmFjdGl2ZTpob3ZlciwKYS5saXN0LWdyb3VwLWl0ZW0tZGFuZ2VyLmFjdGl2ZTpmb2N1cywKYnV0dG9uLmxpc3QtZ3JvdXAtaXRlbS1kYW5nZXIuYWN0aXZlOmZvY3VzIHsKICBjb2xvcjogI2ZmZjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjYTk0NDQyOwogIGJvcmRlci1jb2xvcjogI2E5NDQ0MjsKfQoubGlzdC1ncm91cC1pdGVtLWhlYWRpbmcgewogIG1hcmdpbi10b3A6IDA7CiAgbWFyZ2luLWJvdHRvbTogNXB4Owp9Ci5saXN0LWdyb3VwLWl0ZW0tdGV4dCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKICBsaW5lLWhlaWdodDogMS4zOwp9Ci5wYW5lbCB7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci1yYWRpdXM6IDRweDsKICAtd2Via2l0LWJveC1zaGFkb3c6IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNSk7CiAgICAgICAgICBib3gtc2hhZG93OiAwIDFweCAxcHggcmdiYSgwLCAwLCAwLCAuMDUpOwp9Ci5wYW5lbC1ib2R5IHsKICBwYWRkaW5nOiAxNXB4Owp9Ci5wYW5lbC1oZWFkaW5nIHsKICBwYWRkaW5nOiAxMHB4IDE1cHg7CiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDNweDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogM3B4Owp9Ci5wYW5lbC1oZWFkaW5nID4gLmRyb3Bkb3duIC5kcm9wZG93bi10b2dnbGUgewogIGNvbG9yOiBpbmhlcml0Owp9Ci5wYW5lbC10aXRsZSB7CiAgbWFyZ2luLXRvcDogMDsKICBtYXJnaW4tYm90dG9tOiAwOwogIGZvbnQtc2l6ZTogMTZweDsKICBjb2xvcjogaW5oZXJpdDsKfQoucGFuZWwtdGl0bGUgPiBhLAoucGFuZWwtdGl0bGUgPiBzbWFsbCwKLnBhbmVsLXRpdGxlID4gLnNtYWxsLAoucGFuZWwtdGl0bGUgPiBzbWFsbCA+IGEsCi5wYW5lbC10aXRsZSA+IC5zbWFsbCA+IGEgewogIGNvbG9yOiBpbmhlcml0Owp9Ci5wYW5lbC1mb290ZXIgewogIHBhZGRpbmc6IDEwcHggMTVweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOwogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAzcHg7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogM3B4Owp9Ci5wYW5lbCA+IC5saXN0LWdyb3VwLAoucGFuZWwgPiAucGFuZWwtY29sbGFwc2UgPiAubGlzdC1ncm91cCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKfQoucGFuZWwgPiAubGlzdC1ncm91cCAubGlzdC1ncm91cC1pdGVtLAoucGFuZWwgPiAucGFuZWwtY29sbGFwc2UgPiAubGlzdC1ncm91cCAubGlzdC1ncm91cC1pdGVtIHsKICBib3JkZXItd2lkdGg6IDFweCAwOwogIGJvcmRlci1yYWRpdXM6IDA7Cn0KLnBhbmVsID4gLmxpc3QtZ3JvdXA6Zmlyc3QtY2hpbGQgLmxpc3QtZ3JvdXAtaXRlbTpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnBhbmVsLWNvbGxhcHNlID4gLmxpc3QtZ3JvdXA6Zmlyc3QtY2hpbGQgLmxpc3QtZ3JvdXAtaXRlbTpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcDogMDsKICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAzcHg7CiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDNweDsKfQoucGFuZWwgPiAubGlzdC1ncm91cDpsYXN0LWNoaWxkIC5saXN0LWdyb3VwLWl0ZW06bGFzdC1jaGlsZCwKLnBhbmVsID4gLnBhbmVsLWNvbGxhcHNlID4gLmxpc3QtZ3JvdXA6bGFzdC1jaGlsZCAubGlzdC1ncm91cC1pdGVtOmxhc3QtY2hpbGQgewogIGJvcmRlci1ib3R0b206IDA7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweDsKICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAzcHg7Cn0KLnBhbmVsID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAubGlzdC1ncm91cCAubGlzdC1ncm91cC1pdGVtOmZpcnN0LWNoaWxkIHsKICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAwOwogIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOwp9Ci5wYW5lbC1oZWFkaW5nICsgLmxpc3QtZ3JvdXAgLmxpc3QtZ3JvdXAtaXRlbTpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcC13aWR0aDogMDsKfQoubGlzdC1ncm91cCArIC5wYW5lbC1mb290ZXIgewogIGJvcmRlci10b3Atd2lkdGg6IDA7Cn0KLnBhbmVsID4gLnRhYmxlLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZSwKLnBhbmVsID4gLnBhbmVsLWNvbGxhcHNlID4gLnRhYmxlIHsKICBtYXJnaW4tYm90dG9tOiAwOwp9Ci5wYW5lbCA+IC50YWJsZSBjYXB0aW9uLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZSBjYXB0aW9uLAoucGFuZWwgPiAucGFuZWwtY29sbGFwc2UgPiAudGFibGUgY2FwdGlvbiB7CiAgcGFkZGluZy1yaWdodDogMTVweDsKICBwYWRkaW5nLWxlZnQ6IDE1cHg7Cn0KLnBhbmVsID4gLnRhYmxlOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpmaXJzdC1jaGlsZCA+IC50YWJsZTpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogM3B4OwogIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAzcHg7Cn0KLnBhbmVsID4gLnRhYmxlOmZpcnN0LWNoaWxkID4gdGhlYWQ6Zmlyc3QtY2hpbGQgPiB0cjpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0aGVhZDpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0Ym9keTpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpmaXJzdC1jaGlsZCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgewogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDNweDsKICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogM3B4Owp9Ci5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGQ6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmZpcnN0LWNoaWxkID4gLnRhYmxlOmZpcnN0LWNoaWxkID4gdGhlYWQ6Zmlyc3QtY2hpbGQgPiB0cjpmaXJzdC1jaGlsZCB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlOmZpcnN0LWNoaWxkID4gdGJvZHk6Zmlyc3QtY2hpbGQgPiB0cjpmaXJzdC1jaGlsZCB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0Ym9keTpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRkOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0aGVhZDpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRoOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpmaXJzdC1jaGlsZCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmZpcnN0LWNoaWxkID4gLnRhYmxlOmZpcnN0LWNoaWxkID4gdGJvZHk6Zmlyc3QtY2hpbGQgPiB0cjpmaXJzdC1jaGlsZCB0aDpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogM3B4Owp9Ci5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0aGVhZDpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRkOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0Ym9keTpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRkOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRoZWFkOmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGg6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0aGVhZDpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRoOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpmaXJzdC1jaGlsZCA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGg6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6Zmlyc3QtY2hpbGQgPiAudGFibGU6Zmlyc3QtY2hpbGQgPiB0Ym9keTpmaXJzdC1jaGlsZCA+IHRyOmZpcnN0LWNoaWxkIHRoOmxhc3QtY2hpbGQgewogIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAzcHg7Cn0KLnBhbmVsID4gLnRhYmxlOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmxhc3QtY2hpbGQgPiAudGFibGU6bGFzdC1jaGlsZCB7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweDsKICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAzcHg7Cn0KLnBhbmVsID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Ym9keTpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6bGFzdC1jaGlsZCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGJvZHk6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGZvb3Q6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmxhc3QtY2hpbGQgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRmb290Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHsKICBib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czogM3B4OwogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDNweDsKfQoucGFuZWwgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRib2R5Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHRkOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpsYXN0LWNoaWxkID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Ym9keTpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Zm9vdDpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6bGFzdC1jaGlsZCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGZvb3Q6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGQ6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGJvZHk6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmxhc3QtY2hpbGQgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRib2R5Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHRoOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRmb290Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHRoOmZpcnN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpsYXN0LWNoaWxkID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Zm9vdDpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCB0aDpmaXJzdC1jaGlsZCB7CiAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogM3B4Owp9Ci5wYW5lbCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGJvZHk6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6bGFzdC1jaGlsZCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGJvZHk6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Zm9vdDpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCB0ZDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZTpsYXN0LWNoaWxkID4gLnRhYmxlOmxhc3QtY2hpbGQgPiB0Zm9vdDpsYXN0LWNoaWxkID4gdHI6bGFzdC1jaGlsZCB0ZDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRib2R5Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHRoOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlOmxhc3QtY2hpbGQgPiAudGFibGU6bGFzdC1jaGlsZCA+IHRib2R5Omxhc3QtY2hpbGQgPiB0cjpsYXN0LWNoaWxkIHRoOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGZvb3Q6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGg6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmU6bGFzdC1jaGlsZCA+IC50YWJsZTpsYXN0LWNoaWxkID4gdGZvb3Q6bGFzdC1jaGlsZCA+IHRyOmxhc3QtY2hpbGQgdGg6bGFzdC1jaGlsZCB7CiAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDNweDsKfQoucGFuZWwgPiAucGFuZWwtYm9keSArIC50YWJsZSwKLnBhbmVsID4gLnBhbmVsLWJvZHkgKyAudGFibGUtcmVzcG9uc2l2ZSwKLnBhbmVsID4gLnRhYmxlICsgLnBhbmVsLWJvZHksCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlICsgLnBhbmVsLWJvZHkgewogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOwp9Ci5wYW5lbCA+IC50YWJsZSA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGgsCi5wYW5lbCA+IC50YWJsZSA+IHRib2R5OmZpcnN0LWNoaWxkID4gdHI6Zmlyc3QtY2hpbGQgdGQgewogIGJvcmRlci10b3A6IDA7Cn0KLnBhbmVsID4gLnRhYmxlLWJvcmRlcmVkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCB7CiAgYm9yZGVyOiAwOwp9Ci5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyID4gdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0aDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Zm9vdCA+IHRyID4gdGg6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyID4gdGQ6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGQ6Zmlyc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHIgPiB0ZDpmaXJzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Zm9vdCA+IHRyID4gdGQ6Zmlyc3QtY2hpbGQgewogIGJvcmRlci1sZWZ0OiAwOwp9Ci5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0aDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0aDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGg6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGg6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRoOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRoOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0ZDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRoZWFkID4gdHIgPiB0ZDpsYXN0LWNoaWxkLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyID4gdGQ6bGFzdC1jaGlsZCwKLnBhbmVsID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRkOmxhc3QtY2hpbGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGZvb3QgPiB0ciA+IHRkOmxhc3QtY2hpbGQgewogIGJvcmRlci1yaWdodDogMDsKfQoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyOmZpcnN0LWNoaWxkID4gdGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGhlYWQgPiB0cjpmaXJzdC1jaGlsZCA+IHRkLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyOmZpcnN0LWNoaWxkID4gdGQsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGJvZHkgPiB0cjpmaXJzdC1jaGlsZCA+IHRkLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0aGVhZCA+IHRyOmZpcnN0LWNoaWxkID4gdGgsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGhlYWQgPiB0cjpmaXJzdC1jaGlsZCA+IHRoLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0Ym9keSA+IHRyOmZpcnN0LWNoaWxkID4gdGgsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGJvZHkgPiB0cjpmaXJzdC1jaGlsZCA+IHRoIHsKICBib3JkZXItYm90dG9tOiAwOwp9Ci5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHI6bGFzdC1jaGlsZCA+IHRkLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRib2R5ID4gdHI6bGFzdC1jaGlsZCA+IHRkLAoucGFuZWwgPiAudGFibGUtYm9yZGVyZWQgPiB0Zm9vdCA+IHRyOmxhc3QtY2hpbGQgPiB0ZCwKLnBhbmVsID4gLnRhYmxlLXJlc3BvbnNpdmUgPiAudGFibGUtYm9yZGVyZWQgPiB0Zm9vdCA+IHRyOmxhc3QtY2hpbGQgPiB0ZCwKLnBhbmVsID4gLnRhYmxlLWJvcmRlcmVkID4gdGJvZHkgPiB0cjpsYXN0LWNoaWxkID4gdGgsCi5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlID4gLnRhYmxlLWJvcmRlcmVkID4gdGJvZHkgPiB0cjpsYXN0LWNoaWxkID4gdGgsCi5wYW5lbCA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHI6bGFzdC1jaGlsZCA+IHRoLAoucGFuZWwgPiAudGFibGUtcmVzcG9uc2l2ZSA+IC50YWJsZS1ib3JkZXJlZCA+IHRmb290ID4gdHI6bGFzdC1jaGlsZCA+IHRoIHsKICBib3JkZXItYm90dG9tOiAwOwp9Ci5wYW5lbCA+IC50YWJsZS1yZXNwb25zaXZlIHsKICBtYXJnaW4tYm90dG9tOiAwOwogIGJvcmRlcjogMDsKfQoucGFuZWwtZ3JvdXAgewogIG1hcmdpbi1ib3R0b206IDIwcHg7Cn0KLnBhbmVsLWdyb3VwIC5wYW5lbCB7CiAgbWFyZ2luLWJvdHRvbTogMDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLnBhbmVsLWdyb3VwIC5wYW5lbCArIC5wYW5lbCB7CiAgbWFyZ2luLXRvcDogNXB4Owp9Ci5wYW5lbC1ncm91cCAucGFuZWwtaGVhZGluZyB7CiAgYm9yZGVyLWJvdHRvbTogMDsKfQoucGFuZWwtZ3JvdXAgLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSwKLnBhbmVsLWdyb3VwIC5wYW5lbC1oZWFkaW5nICsgLnBhbmVsLWNvbGxhcHNlID4gLmxpc3QtZ3JvdXAgewogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZGRkOwp9Ci5wYW5lbC1ncm91cCAucGFuZWwtZm9vdGVyIHsKICBib3JkZXItdG9wOiAwOwp9Ci5wYW5lbC1ncm91cCAucGFuZWwtZm9vdGVyICsgLnBhbmVsLWNvbGxhcHNlIC5wYW5lbC1ib2R5IHsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RkZDsKfQoucGFuZWwtZGVmYXVsdCB7CiAgYm9yZGVyLWNvbG9yOiAjZGRkOwp9Ci5wYW5lbC1kZWZhdWx0ID4gLnBhbmVsLWhlYWRpbmcgewogIGNvbG9yOiAjMzMzOwogIGJhY2tncm91bmQtY29sb3I6ICNmNWY1ZjU7CiAgYm9yZGVyLWNvbG9yOiAjZGRkOwp9Ci5wYW5lbC1kZWZhdWx0ID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2RkZDsKfQoucGFuZWwtZGVmYXVsdCA+IC5wYW5lbC1oZWFkaW5nIC5iYWRnZSB7CiAgY29sb3I6ICNmNWY1ZjU7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKfQoucGFuZWwtZGVmYXVsdCA+IC5wYW5lbC1mb290ZXIgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2RkZDsKfQoucGFuZWwtcHJpbWFyeSB7CiAgYm9yZGVyLWNvbG9yOiAjMzM3YWI3Owp9Ci5wYW5lbC1wcmltYXJ5ID4gLnBhbmVsLWhlYWRpbmcgewogIGNvbG9yOiAjZmZmOwogIGJhY2tncm91bmQtY29sb3I6ICMzMzdhYjc7CiAgYm9yZGVyLWNvbG9yOiAjMzM3YWI3Owp9Ci5wYW5lbC1wcmltYXJ5ID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogIzMzN2FiNzsKfQoucGFuZWwtcHJpbWFyeSA+IC5wYW5lbC1oZWFkaW5nIC5iYWRnZSB7CiAgY29sb3I6ICMzMzdhYjc7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQoucGFuZWwtcHJpbWFyeSA+IC5wYW5lbC1mb290ZXIgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzMzN2FiNzsKfQoucGFuZWwtc3VjY2VzcyB7CiAgYm9yZGVyLWNvbG9yOiAjZDZlOWM2Owp9Ci5wYW5lbC1zdWNjZXNzID4gLnBhbmVsLWhlYWRpbmcgewogIGNvbG9yOiAjM2M3NjNkOwogIGJhY2tncm91bmQtY29sb3I6ICNkZmYwZDg7CiAgYm9yZGVyLWNvbG9yOiAjZDZlOWM2Owp9Ci5wYW5lbC1zdWNjZXNzID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2Q2ZTljNjsKfQoucGFuZWwtc3VjY2VzcyA+IC5wYW5lbC1oZWFkaW5nIC5iYWRnZSB7CiAgY29sb3I6ICNkZmYwZDg7CiAgYmFja2dyb3VuZC1jb2xvcjogIzNjNzYzZDsKfQoucGFuZWwtc3VjY2VzcyA+IC5wYW5lbC1mb290ZXIgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2Q2ZTljNjsKfQoucGFuZWwtaW5mbyB7CiAgYm9yZGVyLWNvbG9yOiAjYmNlOGYxOwp9Ci5wYW5lbC1pbmZvID4gLnBhbmVsLWhlYWRpbmcgewogIGNvbG9yOiAjMzE3MDhmOwogIGJhY2tncm91bmQtY29sb3I6ICNkOWVkZjc7CiAgYm9yZGVyLWNvbG9yOiAjYmNlOGYxOwp9Ci5wYW5lbC1pbmZvID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2JjZThmMTsKfQoucGFuZWwtaW5mbyA+IC5wYW5lbC1oZWFkaW5nIC5iYWRnZSB7CiAgY29sb3I6ICNkOWVkZjc7CiAgYmFja2dyb3VuZC1jb2xvcjogIzMxNzA4ZjsKfQoucGFuZWwtaW5mbyA+IC5wYW5lbC1mb290ZXIgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2JjZThmMTsKfQoucGFuZWwtd2FybmluZyB7CiAgYm9yZGVyLWNvbG9yOiAjZmFlYmNjOwp9Ci5wYW5lbC13YXJuaW5nID4gLnBhbmVsLWhlYWRpbmcgewogIGNvbG9yOiAjOGE2ZDNiOwogIGJhY2tncm91bmQtY29sb3I6ICNmY2Y4ZTM7CiAgYm9yZGVyLWNvbG9yOiAjZmFlYmNjOwp9Ci5wYW5lbC13YXJuaW5nID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2ZhZWJjYzsKfQoucGFuZWwtd2FybmluZyA+IC5wYW5lbC1oZWFkaW5nIC5iYWRnZSB7CiAgY29sb3I6ICNmY2Y4ZTM7CiAgYmFja2dyb3VuZC1jb2xvcjogIzhhNmQzYjsKfQoucGFuZWwtd2FybmluZyA+IC5wYW5lbC1mb290ZXIgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogI2ZhZWJjYzsKfQoucGFuZWwtZGFuZ2VyIHsKICBib3JkZXItY29sb3I6ICNlYmNjZDE7Cn0KLnBhbmVsLWRhbmdlciA+IC5wYW5lbC1oZWFkaW5nIHsKICBjb2xvcjogI2E5NDQ0MjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjJkZWRlOwogIGJvcmRlci1jb2xvcjogI2ViY2NkMTsKfQoucGFuZWwtZGFuZ2VyID4gLnBhbmVsLWhlYWRpbmcgKyAucGFuZWwtY29sbGFwc2UgPiAucGFuZWwtYm9keSB7CiAgYm9yZGVyLXRvcC1jb2xvcjogI2ViY2NkMTsKfQoucGFuZWwtZGFuZ2VyID4gLnBhbmVsLWhlYWRpbmcgLmJhZGdlIHsKICBjb2xvcjogI2YyZGVkZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjYTk0NDQyOwp9Ci5wYW5lbC1kYW5nZXIgPiAucGFuZWwtZm9vdGVyICsgLnBhbmVsLWNvbGxhcHNlID4gLnBhbmVsLWJvZHkgewogIGJvcmRlci1ib3R0b20tY29sb3I6ICNlYmNjZDE7Cn0KLmVtYmVkLXJlc3BvbnNpdmUgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBkaXNwbGF5OiBibG9jazsKICBoZWlnaHQ6IDA7CiAgcGFkZGluZzogMDsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5lbWJlZC1yZXNwb25zaXZlIC5lbWJlZC1yZXNwb25zaXZlLWl0ZW0sCi5lbWJlZC1yZXNwb25zaXZlIGlmcmFtZSwKLmVtYmVkLXJlc3BvbnNpdmUgZW1iZWQsCi5lbWJlZC1yZXNwb25zaXZlIG9iamVjdCwKLmVtYmVkLXJlc3BvbnNpdmUgdmlkZW8gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgYm90dG9tOiAwOwogIGxlZnQ6IDA7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGJvcmRlcjogMDsKfQouZW1iZWQtcmVzcG9uc2l2ZS0xNmJ5OSB7CiAgcGFkZGluZy1ib3R0b206IDU2LjI1JTsKfQouZW1iZWQtcmVzcG9uc2l2ZS00YnkzIHsKICBwYWRkaW5nLWJvdHRvbTogNzUlOwp9Ci53ZWxsIHsKICBtaW4taGVpZ2h0OiAyMHB4OwogIHBhZGRpbmc6IDE5cHg7CiAgbWFyZ2luLWJvdHRvbTogMjBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1OwogIGJvcmRlcjogMXB4IHNvbGlkICNlM2UzZTM7CiAgYm9yZGVyLXJhZGl1czogNHB4OwogIC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgMCAxcHggMXB4IHJnYmEoMCwgMCwgMCwgLjA1KTsKICAgICAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMXB4IDFweCByZ2JhKDAsIDAsIDAsIC4wNSk7Cn0KLndlbGwgYmxvY2txdW90ZSB7CiAgYm9yZGVyLWNvbG9yOiAjZGRkOwogIGJvcmRlci1jb2xvcjogcmdiYSgwLCAwLCAwLCAuMTUpOwp9Ci53ZWxsLWxnIHsKICBwYWRkaW5nOiAyNHB4OwogIGJvcmRlci1yYWRpdXM6IDZweDsKfQoud2VsbC1zbSB7CiAgcGFkZGluZzogOXB4OwogIGJvcmRlci1yYWRpdXM6IDNweDsKfQouY2xvc2UgewogIGZsb2F0OiByaWdodDsKICBmb250LXNpemU6IDIxcHg7CiAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgbGluZS1oZWlnaHQ6IDE7CiAgY29sb3I6ICMwMDA7CiAgdGV4dC1zaGFkb3c6IDAgMXB4IDAgI2ZmZjsKICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MjApOwogIG9wYWNpdHk6IC4yOwp9Ci5jbG9zZTpob3ZlciwKLmNsb3NlOmZvY3VzIHsKICBjb2xvcjogIzAwMDsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgY3Vyc29yOiBwb2ludGVyOwogIGZpbHRlcjogYWxwaGEob3BhY2l0eT01MCk7CiAgb3BhY2l0eTogLjU7Cn0KYnV0dG9uLmNsb3NlIHsKICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7CiAgcGFkZGluZzogMDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgYm9yZGVyOiAwOwp9Ci5tb2RhbC1vcGVuIHsKICBvdmVyZmxvdzogaGlkZGVuOwp9Ci5tb2RhbCB7CiAgcG9zaXRpb246IGZpeGVkOwogIHRvcDogMDsKICByaWdodDogMDsKICBib3R0b206IDA7CiAgbGVmdDogMDsKICB6LWluZGV4OiAxMDUwOwogIGRpc3BsYXk6IG5vbmU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7CiAgb3V0bGluZTogMDsKfQoubW9kYWwuZmFkZSAubW9kYWwtZGlhbG9nIHsKICAtd2Via2l0LXRyYW5zaXRpb246IC13ZWJraXQtdHJhbnNmb3JtIC4zcyBlYXNlLW91dDsKICAgICAgIC1vLXRyYW5zaXRpb246ICAgICAgLW8tdHJhbnNmb3JtIC4zcyBlYXNlLW91dDsKICAgICAgICAgIHRyYW5zaXRpb246ICAgICAgICAgdHJhbnNmb3JtIC4zcyBlYXNlLW91dDsKICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIC0yNSUpOwogICAgICAtbXMtdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgLTI1JSk7CiAgICAgICAtby10cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLCAtMjUlKTsKICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIC0yNSUpOwp9Ci5tb2RhbC5pbiAubW9kYWwtZGlhbG9nIHsKICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIDApOwogICAgICAtbXMtdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgMCk7CiAgICAgICAtby10cmFuc2Zvcm06IHRyYW5zbGF0ZSgwLCAwKTsKICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKDAsIDApOwp9Ci5tb2RhbC1vcGVuIC5tb2RhbCB7CiAgb3ZlcmZsb3cteDogaGlkZGVuOwogIG92ZXJmbG93LXk6IGF1dG87Cn0KLm1vZGFsLWRpYWxvZyB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiBhdXRvOwogIG1hcmdpbjogMTBweDsKfQoubW9kYWwtY29udGVudCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHBhZGRpbmctYm94OwogICAgICAgICAgYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveDsKICBib3JkZXI6IDFweCBzb2xpZCAjOTk5OwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgLjIpOwogIGJvcmRlci1yYWRpdXM6IDZweDsKICBvdXRsaW5lOiAwOwogIC13ZWJraXQtYm94LXNoYWRvdzogMCAzcHggOXB4IHJnYmEoMCwgMCwgMCwgLjUpOwogICAgICAgICAgYm94LXNoYWRvdzogMCAzcHggOXB4IHJnYmEoMCwgMCwgMCwgLjUpOwp9Ci5tb2RhbC1iYWNrZHJvcCB7CiAgcG9zaXRpb246IGZpeGVkOwogIHRvcDogMDsKICByaWdodDogMDsKICBib3R0b206IDA7CiAgbGVmdDogMDsKICB6LWluZGV4OiAxMDQwOwogIGJhY2tncm91bmQtY29sb3I6ICMwMDA7Cn0KLm1vZGFsLWJhY2tkcm9wLmZhZGUgewogIGZpbHRlcjogYWxwaGEob3BhY2l0eT0wKTsKICBvcGFjaXR5OiAwOwp9Ci5tb2RhbC1iYWNrZHJvcC5pbiB7CiAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTUwKTsKICBvcGFjaXR5OiAuNTsKfQoubW9kYWwtaGVhZGVyIHsKICBwYWRkaW5nOiAxNXB4OwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZTVlNWU1Owp9Ci5tb2RhbC1oZWFkZXIgLmNsb3NlIHsKICBtYXJnaW4tdG9wOiAtMnB4Owp9Ci5tb2RhbC10aXRsZSB7CiAgbWFyZ2luOiAwOwogIGxpbmUtaGVpZ2h0OiAxLjQyODU3MTQzOwp9Ci5tb2RhbC1ib2R5IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgcGFkZGluZzogMTVweDsKfQoubW9kYWwtZm9vdGVyIHsKICBwYWRkaW5nOiAxNXB4OwogIHRleHQtYWxpZ246IHJpZ2h0OwogIGJvcmRlci10b3A6IDFweCBzb2xpZCAjZTVlNWU1Owp9Ci5tb2RhbC1mb290ZXIgLmJ0biArIC5idG4gewogIG1hcmdpbi1ib3R0b206IDA7CiAgbWFyZ2luLWxlZnQ6IDVweDsKfQoubW9kYWwtZm9vdGVyIC5idG4tZ3JvdXAgLmJ0biArIC5idG4gewogIG1hcmdpbi1sZWZ0OiAtMXB4Owp9Ci5tb2RhbC1mb290ZXIgLmJ0bi1ibG9jayArIC5idG4tYmxvY2sgewogIG1hcmdpbi1sZWZ0OiAwOwp9Ci5tb2RhbC1zY3JvbGxiYXItbWVhc3VyZSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogLTk5OTlweDsKICB3aWR0aDogNTBweDsKICBoZWlnaHQ6IDUwcHg7CiAgb3ZlcmZsb3c6IHNjcm9sbDsKfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIHsKICAubW9kYWwtZGlhbG9nIHsKICAgIHdpZHRoOiA2MDBweDsKICAgIG1hcmdpbjogMzBweCBhdXRvOwogIH0KICAubW9kYWwtY29udGVudCB7CiAgICAtd2Via2l0LWJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLCAwLCAwLCAuNSk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNXB4IDE1cHggcmdiYSgwLCAwLCAwLCAuNSk7CiAgfQogIC5tb2RhbC1zbSB7CiAgICB3aWR0aDogMzAwcHg7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiA5OTJweCkgewogIC5tb2RhbC1sZyB7CiAgICB3aWR0aDogOTAwcHg7CiAgfQp9Ci50b29sdGlwIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgei1pbmRleDogMTA3MDsKICBkaXNwbGF5OiBibG9jazsKICBmb250LWZhbWlseTogIkhlbHZldGljYSBOZXVlIiwgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICBmb250LXNpemU6IDEycHg7CiAgZm9udC1zdHlsZTogbm9ybWFsOwogIGZvbnQtd2VpZ2h0OiBub3JtYWw7CiAgbGluZS1oZWlnaHQ6IDEuNDI4NTcxNDM7CiAgdGV4dC1hbGlnbjogbGVmdDsKICB0ZXh0LWFsaWduOiBzdGFydDsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgdGV4dC1zaGFkb3c6IG5vbmU7CiAgdGV4dC10cmFuc2Zvcm06IG5vbmU7CiAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICB3b3JkLWJyZWFrOiBub3JtYWw7CiAgd29yZC1zcGFjaW5nOiBub3JtYWw7CiAgd29yZC13cmFwOiBub3JtYWw7CiAgd2hpdGUtc3BhY2U6IG5vcm1hbDsKICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9MCk7CiAgb3BhY2l0eTogMDsKCiAgbGluZS1icmVhazogYXV0bzsKfQoudG9vbHRpcC5pbiB7CiAgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTkwKTsKICBvcGFjaXR5OiAuOTsKfQoudG9vbHRpcC50b3AgewogIHBhZGRpbmc6IDVweCAwOwogIG1hcmdpbi10b3A6IC0zcHg7Cn0KLnRvb2x0aXAucmlnaHQgewogIHBhZGRpbmc6IDAgNXB4OwogIG1hcmdpbi1sZWZ0OiAzcHg7Cn0KLnRvb2x0aXAuYm90dG9tIHsKICBwYWRkaW5nOiA1cHggMDsKICBtYXJnaW4tdG9wOiAzcHg7Cn0KLnRvb2x0aXAubGVmdCB7CiAgcGFkZGluZzogMCA1cHg7CiAgbWFyZ2luLWxlZnQ6IC0zcHg7Cn0KLnRvb2x0aXAtaW5uZXIgewogIG1heC13aWR0aDogMjAwcHg7CiAgcGFkZGluZzogM3B4IDhweDsKICBjb2xvcjogI2ZmZjsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLnRvb2x0aXAtYXJyb3cgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogMDsKICBoZWlnaHQ6IDA7CiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICBib3JkZXItc3R5bGU6IHNvbGlkOwp9Ci50b29sdGlwLnRvcCAudG9vbHRpcC1hcnJvdyB7CiAgYm90dG9tOiAwOwogIGxlZnQ6IDUwJTsKICBtYXJnaW4tbGVmdDogLTVweDsKICBib3JkZXItd2lkdGg6IDVweCA1cHggMDsKICBib3JkZXItdG9wLWNvbG9yOiAjMDAwOwp9Ci50b29sdGlwLnRvcC1sZWZ0IC50b29sdGlwLWFycm93IHsKICByaWdodDogNXB4OwogIGJvdHRvbTogMDsKICBtYXJnaW4tYm90dG9tOiAtNXB4OwogIGJvcmRlci13aWR0aDogNXB4IDVweCAwOwogIGJvcmRlci10b3AtY29sb3I6ICMwMDA7Cn0KLnRvb2x0aXAudG9wLXJpZ2h0IC50b29sdGlwLWFycm93IHsKICBib3R0b206IDA7CiAgbGVmdDogNXB4OwogIG1hcmdpbi1ib3R0b206IC01cHg7CiAgYm9yZGVyLXdpZHRoOiA1cHggNXB4IDA7CiAgYm9yZGVyLXRvcC1jb2xvcjogIzAwMDsKfQoudG9vbHRpcC5yaWdodCAudG9vbHRpcC1hcnJvdyB7CiAgdG9wOiA1MCU7CiAgbGVmdDogMDsKICBtYXJnaW4tdG9wOiAtNXB4OwogIGJvcmRlci13aWR0aDogNXB4IDVweCA1cHggMDsKICBib3JkZXItcmlnaHQtY29sb3I6ICMwMDA7Cn0KLnRvb2x0aXAubGVmdCAudG9vbHRpcC1hcnJvdyB7CiAgdG9wOiA1MCU7CiAgcmlnaHQ6IDA7CiAgbWFyZ2luLXRvcDogLTVweDsKICBib3JkZXItd2lkdGg6IDVweCAwIDVweCA1cHg7CiAgYm9yZGVyLWxlZnQtY29sb3I6ICMwMDA7Cn0KLnRvb2x0aXAuYm90dG9tIC50b29sdGlwLWFycm93IHsKICB0b3A6IDA7CiAgbGVmdDogNTAlOwogIG1hcmdpbi1sZWZ0OiAtNXB4OwogIGJvcmRlci13aWR0aDogMCA1cHggNXB4OwogIGJvcmRlci1ib3R0b20tY29sb3I6ICMwMDA7Cn0KLnRvb2x0aXAuYm90dG9tLWxlZnQgLnRvb2x0aXAtYXJyb3cgewogIHRvcDogMDsKICByaWdodDogNXB4OwogIG1hcmdpbi10b3A6IC01cHg7CiAgYm9yZGVyLXdpZHRoOiAwIDVweCA1cHg7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogIzAwMDsKfQoudG9vbHRpcC5ib3R0b20tcmlnaHQgLnRvb2x0aXAtYXJyb3cgewogIHRvcDogMDsKICBsZWZ0OiA1cHg7CiAgbWFyZ2luLXRvcDogLTVweDsKICBib3JkZXItd2lkdGg6IDAgNXB4IDVweDsKICBib3JkZXItYm90dG9tLWNvbG9yOiAjMDAwOwp9Ci5wb3BvdmVyIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIGxlZnQ6IDA7CiAgei1pbmRleDogMTA2MDsKICBkaXNwbGF5OiBub25lOwogIG1heC13aWR0aDogMjc2cHg7CiAgcGFkZGluZzogMXB4OwogIGZvbnQtZmFtaWx5OiAiSGVsdmV0aWNhIE5ldWUiLCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogIGZvbnQtc2l6ZTogMTRweDsKICBmb250LXN0eWxlOiBub3JtYWw7CiAgZm9udC13ZWlnaHQ6IG5vcm1hbDsKICBsaW5lLWhlaWdodDogMS40Mjg1NzE0MzsKICB0ZXh0LWFsaWduOiBsZWZ0OwogIHRleHQtYWxpZ246IHN0YXJ0OwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICB0ZXh0LXNoYWRvdzogbm9uZTsKICB0ZXh0LXRyYW5zZm9ybTogbm9uZTsKICBsZXR0ZXItc3BhY2luZzogbm9ybWFsOwogIHdvcmQtYnJlYWs6IG5vcm1hbDsKICB3b3JkLXNwYWNpbmc6IG5vcm1hbDsKICB3b3JkLXdyYXA6IG5vcm1hbDsKICB3aGl0ZS1zcGFjZTogbm9ybWFsOwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHBhZGRpbmctYm94OwogICAgICAgICAgYmFja2dyb3VuZC1jbGlwOiBwYWRkaW5nLWJveDsKICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOwogIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgLjIpOwogIGJvcmRlci1yYWRpdXM6IDZweDsKICAtd2Via2l0LWJveC1zaGFkb3c6IDAgNXB4IDEwcHggcmdiYSgwLCAwLCAwLCAuMik7CiAgICAgICAgICBib3gtc2hhZG93OiAwIDVweCAxMHB4IHJnYmEoMCwgMCwgMCwgLjIpOwoKICBsaW5lLWJyZWFrOiBhdXRvOwp9Ci5wb3BvdmVyLnRvcCB7CiAgbWFyZ2luLXRvcDogLTEwcHg7Cn0KLnBvcG92ZXIucmlnaHQgewogIG1hcmdpbi1sZWZ0OiAxMHB4Owp9Ci5wb3BvdmVyLmJvdHRvbSB7CiAgbWFyZ2luLXRvcDogMTBweDsKfQoucG9wb3Zlci5sZWZ0IHsKICBtYXJnaW4tbGVmdDogLTEwcHg7Cn0KLnBvcG92ZXItdGl0bGUgewogIHBhZGRpbmc6IDhweCAxNHB4OwogIG1hcmdpbjogMDsKICBmb250LXNpemU6IDE0cHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2Y3ZjdmNzsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2ViZWJlYjsKICBib3JkZXItcmFkaXVzOiA1cHggNXB4IDAgMDsKfQoucG9wb3Zlci1jb250ZW50IHsKICBwYWRkaW5nOiA5cHggMTRweDsKfQoucG9wb3ZlciA+IC5hcnJvdywKLnBvcG92ZXIgPiAuYXJyb3c6YWZ0ZXIgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBkaXNwbGF5OiBibG9jazsKICB3aWR0aDogMDsKICBoZWlnaHQ6IDA7CiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICBib3JkZXItc3R5bGU6IHNvbGlkOwp9Ci5wb3BvdmVyID4gLmFycm93IHsKICBib3JkZXItd2lkdGg6IDExcHg7Cn0KLnBvcG92ZXIgPiAuYXJyb3c6YWZ0ZXIgewogIGNvbnRlbnQ6ICIiOwogIGJvcmRlci13aWR0aDogMTBweDsKfQoucG9wb3Zlci50b3AgPiAuYXJyb3cgewogIGJvdHRvbTogLTExcHg7CiAgbGVmdDogNTAlOwogIG1hcmdpbi1sZWZ0OiAtMTFweDsKICBib3JkZXItdG9wLWNvbG9yOiAjOTk5OwogIGJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwgMCwgMCwgLjI1KTsKICBib3JkZXItYm90dG9tLXdpZHRoOiAwOwp9Ci5wb3BvdmVyLnRvcCA+IC5hcnJvdzphZnRlciB7CiAgYm90dG9tOiAxcHg7CiAgbWFyZ2luLWxlZnQ6IC0xMHB4OwogIGNvbnRlbnQ6ICIgIjsKICBib3JkZXItdG9wLWNvbG9yOiAjZmZmOwogIGJvcmRlci1ib3R0b20td2lkdGg6IDA7Cn0KLnBvcG92ZXIucmlnaHQgPiAuYXJyb3cgewogIHRvcDogNTAlOwogIGxlZnQ6IC0xMXB4OwogIG1hcmdpbi10b3A6IC0xMXB4OwogIGJvcmRlci1yaWdodC1jb2xvcjogIzk5OTsKICBib3JkZXItcmlnaHQtY29sb3I6IHJnYmEoMCwgMCwgMCwgLjI1KTsKICBib3JkZXItbGVmdC13aWR0aDogMDsKfQoucG9wb3Zlci5yaWdodCA+IC5hcnJvdzphZnRlciB7CiAgYm90dG9tOiAtMTBweDsKICBsZWZ0OiAxcHg7CiAgY29udGVudDogIiAiOwogIGJvcmRlci1yaWdodC1jb2xvcjogI2ZmZjsKICBib3JkZXItbGVmdC13aWR0aDogMDsKfQoucG9wb3Zlci5ib3R0b20gPiAuYXJyb3cgewogIHRvcDogLTExcHg7CiAgbGVmdDogNTAlOwogIG1hcmdpbi1sZWZ0OiAtMTFweDsKICBib3JkZXItdG9wLXdpZHRoOiAwOwogIGJvcmRlci1ib3R0b20tY29sb3I6ICM5OTk7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogcmdiYSgwLCAwLCAwLCAuMjUpOwp9Ci5wb3BvdmVyLmJvdHRvbSA+IC5hcnJvdzphZnRlciB7CiAgdG9wOiAxcHg7CiAgbWFyZ2luLWxlZnQ6IC0xMHB4OwogIGNvbnRlbnQ6ICIgIjsKICBib3JkZXItdG9wLXdpZHRoOiAwOwogIGJvcmRlci1ib3R0b20tY29sb3I6ICNmZmY7Cn0KLnBvcG92ZXIubGVmdCA+IC5hcnJvdyB7CiAgdG9wOiA1MCU7CiAgcmlnaHQ6IC0xMXB4OwogIG1hcmdpbi10b3A6IC0xMXB4OwogIGJvcmRlci1yaWdodC13aWR0aDogMDsKICBib3JkZXItbGVmdC1jb2xvcjogIzk5OTsKICBib3JkZXItbGVmdC1jb2xvcjogcmdiYSgwLCAwLCAwLCAuMjUpOwp9Ci5wb3BvdmVyLmxlZnQgPiAuYXJyb3c6YWZ0ZXIgewogIHJpZ2h0OiAxcHg7CiAgYm90dG9tOiAtMTBweDsKICBjb250ZW50OiAiICI7CiAgYm9yZGVyLXJpZ2h0LXdpZHRoOiAwOwogIGJvcmRlci1sZWZ0LWNvbG9yOiAjZmZmOwp9Ci5jYXJvdXNlbCB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Ci5jYXJvdXNlbC1pbm5lciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIG92ZXJmbG93OiBoaWRkZW47Cn0KLmNhcm91c2VsLWlubmVyID4gLml0ZW0gewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBkaXNwbGF5OiBub25lOwogIC13ZWJraXQtdHJhbnNpdGlvbjogLjZzIGVhc2UtaW4tb3V0IGxlZnQ7CiAgICAgICAtby10cmFuc2l0aW9uOiAuNnMgZWFzZS1pbi1vdXQgbGVmdDsKICAgICAgICAgIHRyYW5zaXRpb246IC42cyBlYXNlLWluLW91dCBsZWZ0Owp9Ci5jYXJvdXNlbC1pbm5lciA+IC5pdGVtID4gaW1nLAouY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbSA+IGEgPiBpbWcgewogIGxpbmUtaGVpZ2h0OiAxOwp9CkBtZWRpYSBhbGwgYW5kICh0cmFuc2Zvcm0tM2QpLCAoLXdlYmtpdC10cmFuc2Zvcm0tM2QpIHsKICAuY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbSB7CiAgICAtd2Via2l0LXRyYW5zaXRpb246IC13ZWJraXQtdHJhbnNmb3JtIC42cyBlYXNlLWluLW91dDsKICAgICAgICAgLW8tdHJhbnNpdGlvbjogICAgICAtby10cmFuc2Zvcm0gLjZzIGVhc2UtaW4tb3V0OwogICAgICAgICAgICB0cmFuc2l0aW9uOiAgICAgICAgIHRyYW5zZm9ybSAuNnMgZWFzZS1pbi1vdXQ7CgogICAgLXdlYmtpdC1iYWNrZmFjZS12aXNpYmlsaXR5OiBoaWRkZW47CiAgICAgICAgICAgIGJhY2tmYWNlLXZpc2liaWxpdHk6IGhpZGRlbjsKICAgIC13ZWJraXQtcGVyc3BlY3RpdmU6IDEwMDBweDsKICAgICAgICAgICAgcGVyc3BlY3RpdmU6IDEwMDBweDsKICB9CiAgLmNhcm91c2VsLWlubmVyID4gLml0ZW0ubmV4dCwKICAuY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbS5hY3RpdmUucmlnaHQgewogICAgbGVmdDogMDsKICAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgxMDAlLCAwLCAwKTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgxMDAlLCAwLCAwKTsKICB9CiAgLmNhcm91c2VsLWlubmVyID4gLml0ZW0ucHJldiwKICAuY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbS5hY3RpdmUubGVmdCB7CiAgICBsZWZ0OiAwOwogICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKC0xMDAlLCAwLCAwKTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgtMTAwJSwgMCwgMCk7CiAgfQogIC5jYXJvdXNlbC1pbm5lciA+IC5pdGVtLm5leHQubGVmdCwKICAuY2Fyb3VzZWwtaW5uZXIgPiAuaXRlbS5wcmV2LnJpZ2h0LAogIC5jYXJvdXNlbC1pbm5lciA+IC5pdGVtLmFjdGl2ZSB7CiAgICBsZWZ0OiAwOwogICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIDAsIDApOwogIH0KfQouY2Fyb3VzZWwtaW5uZXIgPiAuYWN0aXZlLAouY2Fyb3VzZWwtaW5uZXIgPiAubmV4dCwKLmNhcm91c2VsLWlubmVyID4gLnByZXYgewogIGRpc3BsYXk6IGJsb2NrOwp9Ci5jYXJvdXNlbC1pbm5lciA+IC5hY3RpdmUgewogIGxlZnQ6IDA7Cn0KLmNhcm91c2VsLWlubmVyID4gLm5leHQsCi5jYXJvdXNlbC1pbm5lciA+IC5wcmV2IHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIHdpZHRoOiAxMDAlOwp9Ci5jYXJvdXNlbC1pbm5lciA+IC5uZXh0IHsKICBsZWZ0OiAxMDAlOwp9Ci5jYXJvdXNlbC1pbm5lciA+IC5wcmV2IHsKICBsZWZ0OiAtMTAwJTsKfQouY2Fyb3VzZWwtaW5uZXIgPiAubmV4dC5sZWZ0LAouY2Fyb3VzZWwtaW5uZXIgPiAucHJldi5yaWdodCB7CiAgbGVmdDogMDsKfQouY2Fyb3VzZWwtaW5uZXIgPiAuYWN0aXZlLmxlZnQgewogIGxlZnQ6IC0xMDAlOwp9Ci5jYXJvdXNlbC1pbm5lciA+IC5hY3RpdmUucmlnaHQgewogIGxlZnQ6IDEwMCU7Cn0KLmNhcm91c2VsLWNvbnRyb2wgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgYm90dG9tOiAwOwogIGxlZnQ6IDA7CiAgd2lkdGg6IDE1JTsKICBmb250LXNpemU6IDIwcHg7CiAgY29sb3I6ICNmZmY7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHRleHQtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLCAwLCAwLCAuNik7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTsKICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NTApOwogIG9wYWNpdHk6IC41Owp9Ci5jYXJvdXNlbC1jb250cm9sLmxlZnQgewogIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KGxlZnQsIHJnYmEoMCwgMCwgMCwgLjUpIDAlLCByZ2JhKDAsIDAsIDAsIC4wMDAxKSAxMDAlKTsKICBiYWNrZ3JvdW5kLWltYWdlOiAgICAgIC1vLWxpbmVhci1ncmFkaWVudChsZWZ0LCByZ2JhKDAsIDAsIDAsIC41KSAwJSwgcmdiYSgwLCAwLCAwLCAuMDAwMSkgMTAwJSk7CiAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1ncmFkaWVudChsaW5lYXIsIGxlZnQgdG9wLCByaWdodCB0b3AsIGZyb20ocmdiYSgwLCAwLCAwLCAuNSkpLCB0byhyZ2JhKDAsIDAsIDAsIC4wMDAxKSkpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgICAgbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCByZ2JhKDAsIDAsIDAsIC41KSAwJSwgcmdiYSgwLCAwLCAwLCAuMDAwMSkgMTAwJSk7CiAgZmlsdGVyOiBwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuZ3JhZGllbnQoc3RhcnRDb2xvcnN0cj0nIzgwMDAwMDAwJywgZW5kQ29sb3JzdHI9JyMwMDAwMDAwMCcsIEdyYWRpZW50VHlwZT0xKTsKICBiYWNrZ3JvdW5kLXJlcGVhdDogcmVwZWF0LXg7Cn0KLmNhcm91c2VsLWNvbnRyb2wucmlnaHQgewogIHJpZ2h0OiAwOwogIGxlZnQ6IGF1dG87CiAgYmFja2dyb3VuZC1pbWFnZTogLXdlYmtpdC1saW5lYXItZ3JhZGllbnQobGVmdCwgcmdiYSgwLCAwLCAwLCAuMDAwMSkgMCUsIHJnYmEoMCwgMCwgMCwgLjUpIDEwMCUpOwogIGJhY2tncm91bmQtaW1hZ2U6ICAgICAgLW8tbGluZWFyLWdyYWRpZW50KGxlZnQsIHJnYmEoMCwgMCwgMCwgLjAwMDEpIDAlLCByZ2JhKDAsIDAsIDAsIC41KSAxMDAlKTsKICBiYWNrZ3JvdW5kLWltYWdlOiAtd2Via2l0LWdyYWRpZW50KGxpbmVhciwgbGVmdCB0b3AsIHJpZ2h0IHRvcCwgZnJvbShyZ2JhKDAsIDAsIDAsIC4wMDAxKSksIHRvKHJnYmEoMCwgMCwgMCwgLjUpKSk7CiAgYmFja2dyb3VuZC1pbWFnZTogICAgICAgICBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsIHJnYmEoMCwgMCwgMCwgLjAwMDEpIDAlLCByZ2JhKDAsIDAsIDAsIC41KSAxMDAlKTsKICBmaWx0ZXI6IHByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yc3RyPScjMDAwMDAwMDAnLCBlbmRDb2xvcnN0cj0nIzgwMDAwMDAwJywgR3JhZGllbnRUeXBlPTEpOwogIGJhY2tncm91bmQtcmVwZWF0OiByZXBlYXQteDsKfQouY2Fyb3VzZWwtY29udHJvbDpob3ZlciwKLmNhcm91c2VsLWNvbnRyb2w6Zm9jdXMgewogIGNvbG9yOiAjZmZmOwogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9OTApOwogIG91dGxpbmU6IDA7CiAgb3BhY2l0eTogLjk7Cn0KLmNhcm91c2VsLWNvbnRyb2wgLmljb24tcHJldiwKLmNhcm91c2VsLWNvbnRyb2wgLmljb24tbmV4dCwKLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLWxlZnQsCi5jYXJvdXNlbC1jb250cm9sIC5nbHlwaGljb24tY2hldnJvbi1yaWdodCB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRvcDogNTAlOwogIHotaW5kZXg6IDU7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1hcmdpbi10b3A6IC0xMHB4Owp9Ci5jYXJvdXNlbC1jb250cm9sIC5pY29uLXByZXYsCi5jYXJvdXNlbC1jb250cm9sIC5nbHlwaGljb24tY2hldnJvbi1sZWZ0IHsKICBsZWZ0OiA1MCU7CiAgbWFyZ2luLWxlZnQ6IC0xMHB4Owp9Ci5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQsCi5jYXJvdXNlbC1jb250cm9sIC5nbHlwaGljb24tY2hldnJvbi1yaWdodCB7CiAgcmlnaHQ6IDUwJTsKICBtYXJnaW4tcmlnaHQ6IC0xMHB4Owp9Ci5jYXJvdXNlbC1jb250cm9sIC5pY29uLXByZXYsCi5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQgewogIHdpZHRoOiAyMHB4OwogIGhlaWdodDogMjBweDsKICBmb250LWZhbWlseTogc2VyaWY7CiAgbGluZS1oZWlnaHQ6IDE7Cn0KLmNhcm91c2VsLWNvbnRyb2wgLmljb24tcHJldjpiZWZvcmUgewogIGNvbnRlbnQ6ICdcMjAzOSc7Cn0KLmNhcm91c2VsLWNvbnRyb2wgLmljb24tbmV4dDpiZWZvcmUgewogIGNvbnRlbnQ6ICdcMjAzYSc7Cn0KLmNhcm91c2VsLWluZGljYXRvcnMgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBib3R0b206IDEwcHg7CiAgbGVmdDogNTAlOwogIHotaW5kZXg6IDE1OwogIHdpZHRoOiA2MCU7CiAgcGFkZGluZy1sZWZ0OiAwOwogIG1hcmdpbi1sZWZ0OiAtMzAlOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBsaXN0LXN0eWxlOiBub25lOwp9Ci5jYXJvdXNlbC1pbmRpY2F0b3JzIGxpIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgd2lkdGg6IDEwcHg7CiAgaGVpZ2h0OiAxMHB4OwogIG1hcmdpbjogMXB4OwogIHRleHQtaW5kZW50OiAtOTk5cHg7CiAgY3Vyc29yOiBwb2ludGVyOwogIGJhY2tncm91bmQtY29sb3I6ICMwMDAgXDk7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTsKICBib3JkZXI6IDFweCBzb2xpZCAjZmZmOwogIGJvcmRlci1yYWRpdXM6IDEwcHg7Cn0KLmNhcm91c2VsLWluZGljYXRvcnMgLmFjdGl2ZSB7CiAgd2lkdGg6IDEycHg7CiAgaGVpZ2h0OiAxMnB4OwogIG1hcmdpbjogMDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwp9Ci5jYXJvdXNlbC1jYXB0aW9uIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgcmlnaHQ6IDE1JTsKICBib3R0b206IDIwcHg7CiAgbGVmdDogMTUlOwogIHotaW5kZXg6IDEwOwogIHBhZGRpbmctdG9wOiAyMHB4OwogIHBhZGRpbmctYm90dG9tOiAyMHB4OwogIGNvbG9yOiAjZmZmOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICB0ZXh0LXNoYWRvdzogMCAxcHggMnB4IHJnYmEoMCwgMCwgMCwgLjYpOwp9Ci5jYXJvdXNlbC1jYXB0aW9uIC5idG4gewogIHRleHQtc2hhZG93OiBub25lOwp9CkBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6IDc2OHB4KSB7CiAgLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLWxlZnQsCiAgLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLXJpZ2h0LAogIC5jYXJvdXNlbC1jb250cm9sIC5pY29uLXByZXYsCiAgLmNhcm91c2VsLWNvbnRyb2wgLmljb24tbmV4dCB7CiAgICB3aWR0aDogMzBweDsKICAgIGhlaWdodDogMzBweDsKICAgIG1hcmdpbi10b3A6IC0xMHB4OwogICAgZm9udC1zaXplOiAzMHB4OwogIH0KICAuY2Fyb3VzZWwtY29udHJvbCAuZ2x5cGhpY29uLWNoZXZyb24tbGVmdCwKICAuY2Fyb3VzZWwtY29udHJvbCAuaWNvbi1wcmV2IHsKICAgIG1hcmdpbi1sZWZ0OiAtMTBweDsKICB9CiAgLmNhcm91c2VsLWNvbnRyb2wgLmdseXBoaWNvbi1jaGV2cm9uLXJpZ2h0LAogIC5jYXJvdXNlbC1jb250cm9sIC5pY29uLW5leHQgewogICAgbWFyZ2luLXJpZ2h0OiAtMTBweDsKICB9CiAgLmNhcm91c2VsLWNhcHRpb24gewogICAgcmlnaHQ6IDIwJTsKICAgIGxlZnQ6IDIwJTsKICAgIHBhZGRpbmctYm90dG9tOiAzMHB4OwogIH0KICAuY2Fyb3VzZWwtaW5kaWNhdG9ycyB7CiAgICBib3R0b206IDIwcHg7CiAgfQp9Ci5jbGVhcmZpeDpiZWZvcmUsCi5jbGVhcmZpeDphZnRlciwKLmRsLWhvcml6b250YWwgZGQ6YmVmb3JlLAouZGwtaG9yaXpvbnRhbCBkZDphZnRlciwKLmNvbnRhaW5lcjpiZWZvcmUsCi5jb250YWluZXI6YWZ0ZXIsCi5jb250YWluZXItZmx1aWQ6YmVmb3JlLAouY29udGFpbmVyLWZsdWlkOmFmdGVyLAoucm93OmJlZm9yZSwKLnJvdzphZnRlciwKLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1ncm91cDpiZWZvcmUsCi5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXA6YWZ0ZXIsCi5idG4tdG9vbGJhcjpiZWZvcmUsCi5idG4tdG9vbGJhcjphZnRlciwKLmJ0bi1ncm91cC12ZXJ0aWNhbCA+IC5idG4tZ3JvdXA6YmVmb3JlLAouYnRuLWdyb3VwLXZlcnRpY2FsID4gLmJ0bi1ncm91cDphZnRlciwKLm5hdjpiZWZvcmUsCi5uYXY6YWZ0ZXIsCi5uYXZiYXI6YmVmb3JlLAoubmF2YmFyOmFmdGVyLAoubmF2YmFyLWhlYWRlcjpiZWZvcmUsCi5uYXZiYXItaGVhZGVyOmFmdGVyLAoubmF2YmFyLWNvbGxhcHNlOmJlZm9yZSwKLm5hdmJhci1jb2xsYXBzZTphZnRlciwKLnBhZ2VyOmJlZm9yZSwKLnBhZ2VyOmFmdGVyLAoucGFuZWwtYm9keTpiZWZvcmUsCi5wYW5lbC1ib2R5OmFmdGVyLAoubW9kYWwtaGVhZGVyOmJlZm9yZSwKLm1vZGFsLWhlYWRlcjphZnRlciwKLm1vZGFsLWZvb3RlcjpiZWZvcmUsCi5tb2RhbC1mb290ZXI6YWZ0ZXIgewogIGRpc3BsYXk6IHRhYmxlOwogIGNvbnRlbnQ6ICIgIjsKfQouY2xlYXJmaXg6YWZ0ZXIsCi5kbC1ob3Jpem9udGFsIGRkOmFmdGVyLAouY29udGFpbmVyOmFmdGVyLAouY29udGFpbmVyLWZsdWlkOmFmdGVyLAoucm93OmFmdGVyLAouZm9ybS1ob3Jpem9udGFsIC5mb3JtLWdyb3VwOmFmdGVyLAouYnRuLXRvb2xiYXI6YWZ0ZXIsCi5idG4tZ3JvdXAtdmVydGljYWwgPiAuYnRuLWdyb3VwOmFmdGVyLAoubmF2OmFmdGVyLAoubmF2YmFyOmFmdGVyLAoubmF2YmFyLWhlYWRlcjphZnRlciwKLm5hdmJhci1jb2xsYXBzZTphZnRlciwKLnBhZ2VyOmFmdGVyLAoucGFuZWwtYm9keTphZnRlciwKLm1vZGFsLWhlYWRlcjphZnRlciwKLm1vZGFsLWZvb3RlcjphZnRlciB7CiAgY2xlYXI6IGJvdGg7Cn0KLmNlbnRlci1ibG9jayB7CiAgZGlzcGxheTogYmxvY2s7CiAgbWFyZ2luLXJpZ2h0OiBhdXRvOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwp9Ci5wdWxsLXJpZ2h0IHsKICBmbG9hdDogcmlnaHQgIWltcG9ydGFudDsKfQoucHVsbC1sZWZ0IHsKICBmbG9hdDogbGVmdCAhaW1wb3J0YW50Owp9Ci5oaWRlIHsKICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7Cn0KLnNob3cgewogIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7Cn0KLmludmlzaWJsZSB7CiAgdmlzaWJpbGl0eTogaGlkZGVuOwp9Ci50ZXh0LWhpZGUgewogIGZvbnQ6IDAvMCBhOwogIGNvbG9yOiB0cmFuc3BhcmVudDsKICB0ZXh0LXNoYWRvdzogbm9uZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDsKICBib3JkZXI6IDA7Cn0KLmhpZGRlbiB7CiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9Ci5hZmZpeCB7CiAgcG9zaXRpb246IGZpeGVkOwp9CkAtbXMtdmlld3BvcnQgewogIHdpZHRoOiBkZXZpY2Utd2lkdGg7Cn0KLnZpc2libGUteHMsCi52aXNpYmxlLXNtLAoudmlzaWJsZS1tZCwKLnZpc2libGUtbGcgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQoudmlzaWJsZS14cy1ibG9jaywKLnZpc2libGUteHMtaW5saW5lLAoudmlzaWJsZS14cy1pbmxpbmUtYmxvY2ssCi52aXNpYmxlLXNtLWJsb2NrLAoudmlzaWJsZS1zbS1pbmxpbmUsCi52aXNpYmxlLXNtLWlubGluZS1ibG9jaywKLnZpc2libGUtbWQtYmxvY2ssCi52aXNpYmxlLW1kLWlubGluZSwKLnZpc2libGUtbWQtaW5saW5lLWJsb2NrLAoudmlzaWJsZS1sZy1ibG9jaywKLnZpc2libGUtbGctaW5saW5lLAoudmlzaWJsZS1sZy1pbmxpbmUtYmxvY2sgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpAbWVkaWEgKG1heC13aWR0aDogNzY3cHgpIHsKICAudmlzaWJsZS14cyB7CiAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwogIH0KICB0YWJsZS52aXNpYmxlLXhzIHsKICAgIGRpc3BsYXk6IHRhYmxlICFpbXBvcnRhbnQ7CiAgfQogIHRyLnZpc2libGUteHMgewogICAgZGlzcGxheTogdGFibGUtcm93ICFpbXBvcnRhbnQ7CiAgfQogIHRoLnZpc2libGUteHMsCiAgdGQudmlzaWJsZS14cyB7CiAgICBkaXNwbGF5OiB0YWJsZS1jZWxsICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWF4LXdpZHRoOiA3NjdweCkgewogIC52aXNpYmxlLXhzLWJsb2NrIHsKICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWF4LXdpZHRoOiA3NjdweCkgewogIC52aXNpYmxlLXhzLWlubGluZSB7CiAgICBkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtYXgtd2lkdGg6IDc2N3B4KSB7CiAgLnZpc2libGUteHMtaW5saW5lLWJsb2NrIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jayAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIGFuZCAobWF4LXdpZHRoOiA5OTFweCkgewogIC52aXNpYmxlLXNtIHsKICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgfQogIHRhYmxlLnZpc2libGUtc20gewogICAgZGlzcGxheTogdGFibGUgIWltcG9ydGFudDsKICB9CiAgdHIudmlzaWJsZS1zbSB7CiAgICBkaXNwbGF5OiB0YWJsZS1yb3cgIWltcG9ydGFudDsKICB9CiAgdGgudmlzaWJsZS1zbSwKICB0ZC52aXNpYmxlLXNtIHsKICAgIGRpc3BsYXk6IHRhYmxlLWNlbGwgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogOTkxcHgpIHsKICAudmlzaWJsZS1zbS1ibG9jayB7CiAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogNzY4cHgpIGFuZCAobWF4LXdpZHRoOiA5OTFweCkgewogIC52aXNpYmxlLXNtLWlubGluZSB7CiAgICBkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogOTkxcHgpIHsKICAudmlzaWJsZS1zbS1pbmxpbmUtYmxvY2sgewogICAgZGlzcGxheTogaW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiA5OTJweCkgYW5kIChtYXgtd2lkdGg6IDExOTlweCkgewogIC52aXNpYmxlLW1kIHsKICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgfQogIHRhYmxlLnZpc2libGUtbWQgewogICAgZGlzcGxheTogdGFibGUgIWltcG9ydGFudDsKICB9CiAgdHIudmlzaWJsZS1tZCB7CiAgICBkaXNwbGF5OiB0YWJsZS1yb3cgIWltcG9ydGFudDsKICB9CiAgdGgudmlzaWJsZS1tZCwKICB0ZC52aXNpYmxlLW1kIHsKICAgIGRpc3BsYXk6IHRhYmxlLWNlbGwgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDk5MnB4KSBhbmQgKG1heC13aWR0aDogMTE5OXB4KSB7CiAgLnZpc2libGUtbWQtYmxvY2sgewogICAgZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDk5MnB4KSBhbmQgKG1heC13aWR0aDogMTE5OXB4KSB7CiAgLnZpc2libGUtbWQtaW5saW5lIHsKICAgIGRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogOTkycHgpIGFuZCAobWF4LXdpZHRoOiAxMTk5cHgpIHsKICAudmlzaWJsZS1tZC1pbmxpbmUtYmxvY2sgewogICAgZGlzcGxheTogaW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiAxMjAwcHgpIHsKICAudmlzaWJsZS1sZyB7CiAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwogIH0KICB0YWJsZS52aXNpYmxlLWxnIHsKICAgIGRpc3BsYXk6IHRhYmxlICFpbXBvcnRhbnQ7CiAgfQogIHRyLnZpc2libGUtbGcgewogICAgZGlzcGxheTogdGFibGUtcm93ICFpbXBvcnRhbnQ7CiAgfQogIHRoLnZpc2libGUtbGcsCiAgdGQudmlzaWJsZS1sZyB7CiAgICBkaXNwbGF5OiB0YWJsZS1jZWxsICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiAxMjAwcHgpIHsKICAudmlzaWJsZS1sZy1ibG9jayB7CiAgICBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogMTIwMHB4KSB7CiAgLnZpc2libGUtbGctaW5saW5lIHsKICAgIGRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1pbi13aWR0aDogMTIwMHB4KSB7CiAgLnZpc2libGUtbGctaW5saW5lLWJsb2NrIHsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jayAhaW1wb3J0YW50OwogIH0KfQpAbWVkaWEgKG1heC13aWR0aDogNzY3cHgpIHsKICAuaGlkZGVuLXhzIHsKICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDc2OHB4KSBhbmQgKG1heC13aWR0aDogOTkxcHgpIHsKICAuaGlkZGVuLXNtIHsKICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIChtaW4td2lkdGg6IDk5MnB4KSBhbmQgKG1heC13aWR0aDogMTE5OXB4KSB7CiAgLmhpZGRlbi1tZCB7CiAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CiAgfQp9CkBtZWRpYSAobWluLXdpZHRoOiAxMjAwcHgpIHsKICAuaGlkZGVuLWxnIHsKICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICB9Cn0KLnZpc2libGUtcHJpbnQgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpAbWVkaWEgcHJpbnQgewogIC52aXNpYmxlLXByaW50IHsKICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgfQogIHRhYmxlLnZpc2libGUtcHJpbnQgewogICAgZGlzcGxheTogdGFibGUgIWltcG9ydGFudDsKICB9CiAgdHIudmlzaWJsZS1wcmludCB7CiAgICBkaXNwbGF5OiB0YWJsZS1yb3cgIWltcG9ydGFudDsKICB9CiAgdGgudmlzaWJsZS1wcmludCwKICB0ZC52aXNpYmxlLXByaW50IHsKICAgIGRpc3BsYXk6IHRhYmxlLWNlbGwgIWltcG9ydGFudDsKICB9Cn0KLnZpc2libGUtcHJpbnQtYmxvY2sgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpAbWVkaWEgcHJpbnQgewogIC52aXNpYmxlLXByaW50LWJsb2NrIHsKICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgfQp9Ci52aXNpYmxlLXByaW50LWlubGluZSB7CiAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9CkBtZWRpYSBwcmludCB7CiAgLnZpc2libGUtcHJpbnQtaW5saW5lIHsKICAgIGRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50OwogIH0KfQoudmlzaWJsZS1wcmludC1pbmxpbmUtYmxvY2sgewogIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKfQpAbWVkaWEgcHJpbnQgewogIC52aXNpYmxlLXByaW50LWlubGluZS1ibG9jayB7CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2sgIWltcG9ydGFudDsKICB9Cn0KQG1lZGlhIHByaW50IHsKICAuaGlkZGVuLXByaW50IHsKICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsKICB9Cn0KLyojIHNvdXJjZU1hcHBpbmdVUkw9Ym9vdHN0cmFwLmNzcy5tYXAgKi8KLyogRmlsZTogc3JjL2Nzcy9tYWluLmNzcyAqLwpib2R5IHsKICBtYXJnaW46IDNlbTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjQ0FDQUNBOyAvKiBHcmV5ICovCn0KYnV0dG9uIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiBibHVlOyAvKiBCbHVlICMwMDhDQkEgKi8KICBjb2xvcjogd2hpdGUKfQouZGVtb2xpc3QgewogIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOwp9Cg==",
           "mime_type": "text/css"
       }
    ]
}
